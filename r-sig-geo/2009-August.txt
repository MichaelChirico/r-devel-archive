From r.hijmans at gmail.com  Sat Aug  1 02:25:39 2009
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Fri, 31 Jul 2009 17:25:39 -0700
Subject: [R-sig-Geo] raster algebra in R
In-Reply-To: <3aaf1a030907311424o61df1a65id757db256103dc25@mail.gmail.com>
References: <451739.74883.qm@web63107.mail.re1.yahoo.com>
	<dc22b2570907311420j325d35eft30d3563a30a5f266@mail.gmail.com>
	<3aaf1a030907311424o61df1a65id757db256103dc25@mail.gmail.com>
Message-ID: <dc22b2570907311725u34291b85t766d3aab9c987b2a@mail.gmail.com>

Here is a sample script where the results are saved to an ascii file.

r1 <- raster('myfile1.asc')
r2 <- raster('myfile2.asc')
r3 <- r1 + sqrt(r2) + 1
filename(r3) <- 'output.asc'
r3 <- writeRaster(r3, filetype='ascii')



On Fri, Jul 31, 2009 at 2:24 PM, milton ruser<milton.ruser at gmail.com> wrote:
> Oops.
>
> Yes! Sorry, I forgot to mention this!
> Robert, cold you just write a example out output a .asc file?
> Just to keep this thread complete.
>
> bests
>
> milton
>
> On Fri, Jul 31, 2009 at 5:20 PM, Robert J. Hijmans <r.hijmans at gmail.com>
> wrote:
>>
>> You can try the raster package, available from R-forge:
>>
>> install.packages("raster", repos="http://R-Forge.R-project.org")
>>
>> It has very simple raster algebra
>>
>> r1 <- raster('myfile1.asc')
>> r2 <- raster('myfile2.asc')
>> r3 <- r1 + sqrt(r2) + 1
>>
>> etc.
>>
>> Robert
>>
>> On Fri, Jul 31, 2009 at 11:21 AM, Jason Robinson<litobrancha at yahoo.com>
>> wrote:
>> >
>> > I need to do some raster algebra on some large rasters. ?right now they
>> > are ascii files. ?I'm a complete R novice. ?Can anyone point me towards a
>> > good source for figuring out how to get my data into R and how to do very
>> > simple raster manipulations? ?no advice is too simple for this guy.
>> > ?appreciate any help that is out there
>> >
>> > Jason Robinson
>> >
>> > _______________________________________________
>> > R-sig-Geo mailing list
>> > R-sig-Geo at stat.math.ethz.ch
>> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> >
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>


From greenberg at ucdavis.edu  Sun Aug  2 20:26:29 2009
From: greenberg at ucdavis.edu (Jonathan Greenberg)
Date: Sun, 02 Aug 2009 11:26:29 -0700
Subject: [R-sig-Geo] Polygon to raster?
Message-ID: <4A75DA55.3060107@ucdavis.edu>

I'm trying to hunt down a function that will take a polygon (derived 
from a shapefile) and "rasterize" it at a given pixel resolution -- any 
hints?

--j

-- 

Jonathan A. Greenberg, PhD
Postdoctoral Scholar
Center for Spatial Technologies and Remote Sensing (CSTARS)
University of California, Davis
One Shields Avenue
The Barn, Room 250N
Davis, CA 95616
Cell: 415-794-5043
AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307


From b.rowlingson at lancaster.ac.uk  Sun Aug  2 20:38:54 2009
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Sun, 2 Aug 2009 19:38:54 +0100
Subject: [R-sig-Geo] Polygon to raster?
In-Reply-To: <4A75DA55.3060107@ucdavis.edu>
References: <4A75DA55.3060107@ucdavis.edu>
Message-ID: <d8ad40b50908021138m7d760505le6228737dae2b9ee@mail.gmail.com>

On Sun, Aug 2, 2009 at 7:26 PM, Jonathan Greenberg<greenberg at ucdavis.edu> wrote:
> I'm trying to hunt down a function that will take a polygon (derived from a
> shapefile) and "rasterize" it at a given pixel resolution -- any hints?

 You could plot it to a png graphics device:

 require(rgdal)
 require(sp)
 myPolygon = readOGR("foo.shp") # or similar...

 png(file="raster.png",height=100,width=100)
 plot(myPolygon)
 dev.off()

 that might plot it with slightly too wide margins though, so there
may be some tweaking required with par(....) after opening the png
device.

Barry


From hengl at spatial-analyst.net  Mon Aug  3 09:42:58 2009
From: hengl at spatial-analyst.net (Tomislav Hengl)
Date: Mon, 3 Aug 2009 09:42:58 +0200
Subject: [R-sig-Geo] Polygon to raster?
In-Reply-To: <4A75DA55.3060107@ucdavis.edu>
References: <4A75DA55.3060107@ucdavis.edu>
Message-ID: <2A78B94D66454E22B95CFB0757DC4FB3@pcibed193>


SAGA has a module to convert from shapes to grids (GRASS can do the same).

See:

> library(RSAGA)
> rsaga.get.usage(lib="grid_gridding", module=0)
SAGA CMD 2.0.3
library path:   C:/Progra~1/saga_vc/modules
library name:   grid_gridding
module name :   Shapes to Grid
Usage: 0 [-GRID <str>] -INPUT <str> [-FIELD <num>] [-TARGET_TYPE <num>] [-LINE_TYPE <num>]
[-USER_CELL_SIZE <str>] [-USER_FIT_EXTENT] [-USER_X_EXTENT_MIN <str>] [-USER_X_EXTENT_MAX <str>]
[-USER_Y_EXTENT_MIN <str>] [-USER_Y_EXTENT_MAX <str>] [-USER_GRID_TYPE <num>] [-GET_SYSTEM_SYSTEM_NX
<num>] [-GET_SYSTEM_SYSTEM_NY <num>] [-GET_SYSTEM_SYSTEM_X <str>] [-GET_SYSTEM_SYSTEM_Y <str>]
[-GET_SYSTEM_SYSTEM_D <str>] [-GET_SYSTEM_GRID_TYPE <num>] [-GRID_GRID <str>]
  -GRID:<str>                   Grid
        Data Object (optional output)
  -INPUT:<str>                  Shapes
        Shapes (input)
  -FIELD:<num>                  Attribute
...

Here is an example:

...
# first, convert the contour map to a raster map:
> rsaga.geoprocessor(lib="grid_gridding", module=3, param=list(GRID="contours_buff.sgrd",
+   INPUT="z_contours.shp", FIELD=1, LINE_TYPE=0, USER_CELL_SIZE=dem.pixelsize,
+   USER_X_EXTENT_MIN=elevations at bbox[1,1], USER_X_EXTENT_MAX=elevations at bbox[1,2],
+   USER_Y_EXTENT_MIN=elevations at bbox[2,1], USER_Y_EXTENT_MAX=elevations at bbox[2,2]))
# now extract a buffer distance map (for 'contours') and load it back to R:
# the parameters DIST and IVAL are estimated based on the grid properties:
> rsaga.geoprocessor(lib="grid_tools", module=10, param=list(SOURCE="contours_buff.sgrd",
+ DISTANCE="contours_dist.sgrd", ALLOC="contours_alloc.sgrd", BUFFER="contours_bdist.sgrd",
+ DIST=sqrt(dem.area)/3, IVAL=dem.pixelsize))
> rsaga.sgrd.to.esri(in.sgrds="contours_dist.sgrd", out.grids="contours_dist.asc", 
+    out.path=getwd(), prec=1)
> contours.dist <- readGDAL("contours_dist.asc")
> spplot(contours.dist[1], col.regions=bpy.colors(), scales=list(draw=TRUE), 
+    sp.layout=list("sp.lines", col="cyan", z.contours))
> hist(contours.dist$band1, col="grey")
...

HTH

T. Hengl
http://spatial-analyst.net/wiki/index.php?title=Grid_size_calculator 


> -----Original Message-----
> From: r-sig-geo-bounces at stat.math.ethz.ch [mailto:r-sig-geo-bounces at stat.math.ethz.ch] On Behalf
> Of Jonathan Greenberg
> Sent: Sunday, August 02, 2009 8:26 PM
> To: r-sig-geo at stat.math.ethz.ch
> Subject: [R-sig-Geo] Polygon to raster?
> 
> I'm trying to hunt down a function that will take a polygon (derived
> from a shapefile) and "rasterize" it at a given pixel resolution -- any
> hints?
> 
> --j
> 
> --
> 
> Jonathan A. Greenberg, PhD
> Postdoctoral Scholar
> Center for Spatial Technologies and Remote Sensing (CSTARS)
> University of California, Davis
> One Shields Avenue
> The Barn, Room 250N
> Davis, CA 95616
> Cell: 415-794-5043
> AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From N.A.Batchelor at sms.ed.ac.uk  Mon Aug  3 10:22:53 2009
From: N.A.Batchelor at sms.ed.ac.uk (Nicola Batchelor)
Date: Mon, 3 Aug 2009 09:22:53 +0100
Subject: [R-sig-Geo] Binom.krige.bayes strange uncertainty outputs
Message-ID: <7FE3AB424E0E44AB96FFD049F2339138@soton.ac.uk>

Dear list,

I'm having a few problems with my uncertainty outputs from the command
binom.krige.bayes in geoRglm.  I am getting sensible looking predictive
medians, and 2.5% quantiles, but the upper quantile and also the uncertainty
outputs are very odd looking (I have attached images of the predictive
median, plus the data points and also the upper limit of the 95% CrI to
illustrate the problem).  

My commands are shown below, but as far as I can see I haven't done anything
that would give this problem.

Has anyone experienced anything like this before?  I've been trying to get
the upper quantile from my prediction simulations to compare the results,
but haven't yet managed (still quite new to R and so these things take me a
while to work out!)...is it possible that the predictive simulations could
be correct and so I could take the uncertainty values from there?  Perhaps
it is some sort of memory problem?

########################

nicola1<-read.csv("MBGdataset.csv", header=TRUE)
nicola1 <-
as.geodata(nicola1,coords.col=3:4,data.col=1,covar.col=5:27,units.m.col=2)
names(nicola1)
attach(nicola1)

########################

#CREATE PREDICTION GRID
predpoints2km<-pred_grid(c(440, 590), c(130, 270), by=2)
plot(predpoints2km)
points(nicola1, add=TRUE)

covars<-read.dbf("covars2km.dbf")
names(covars)

#######################

#Phi = 60
#Set a random seed
set.seed(548)

#Set the prior control
Pri60<-prior.glm.control(beta.prior="flat", sigmasq.prior="uniform",
phi.prior="fixed", phi=60, tausq.rel=1)
#Set the MCMC control
Mc<-mcmc.control(S.scale=0.0133, burn.in=1000000, thin=1000, n.iter=5000000)
#Set the model control
Mod<-model.glm.control(trend.d=trend.spatial(~MARKET+MINLST+HCDIST,
nicola1),trend.l=trend.spatial(~MARKET+MINLST+HCDIST,covars),
cov.model="matern",kappa=0.5, lambda=0)
#Set the output control
Out<-output.glm.control(sim.posterior=TRUE,sim.predict=TRUE,
keep.mcmc.sim=TRUE, quantile=TRUE, inference=TRUE)

#Run the model with inputs (prior control, MCMC control, trend
specification, model control, and output control)
test60<-binom.krige.bayes(nicola1, prior=Pri60, model=Mod,
locations=predpoints2km, mcmc.input=Mc, output=Out)

########################

Thanks,

Nicola

-- 
The University of Edinburgh is a charitable body, registered in
Scotland, with registration number SC005336.

-------------- next part --------------
A non-text attachment was scrubbed...
Name: error.doc
Type: application/msword
Size: 79872 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090803/f8f03317/attachment.doc>

From Hollister.Jeff at epamail.epa.gov  Mon Aug  3 18:01:11 2009
From: Hollister.Jeff at epamail.epa.gov (Hollister.Jeff at epamail.epa.gov)
Date: Mon, 3 Aug 2009 12:01:11 -0400
Subject: [R-sig-Geo] RPyGeo Problem
In-Reply-To: <mailman.11.1249120803.23821.r-sig-geo@stat.math.ethz.ch>
References: <mailman.11.1249120803.23821.r-sig-geo@stat.math.ethz.ch>
Message-ID: <OFA505BC1F.F4A25D95-ON85257607.0057D66E-85257607.0058000A@epamail.epa.gov>

FYI,

I figured out my problem.

I had set a mask via rpyego.env$mask.  The mask should have a character
string for the name of an ArcGIS dataset.  Instead, I set the mask to a
spatial polygons data frame.  Needless to say, that is incorrect.

Cheers,
Jeff

***************************
Dr. Jeffrey W. Hollister
US EPA
Atlantic Ecology Division
27 Tarzwell Drive
Narragansett, RI 02882
(401) 782-9655


From greenberg at ucdavis.edu  Tue Aug  4 00:53:10 2009
From: greenberg at ucdavis.edu (Jonathan Greenberg)
Date: Mon, 03 Aug 2009 15:53:10 -0700
Subject: [R-sig-Geo] Dumping OGR database to dataframe(s)?
Message-ID: <4A776A56.1070207@ucdavis.edu>

R-sig-geo'ers:

    I'm pushing forward with recoding starspan as a set of R functions 
so we can get the program back on track after a long hiatus with the 
development of a C version (I don't know C and don't have time to learn 
it, and we lost our master programmer who did know C), and I'm trying to 
decide if I should allow the vector side of the program to specifically 
require shapefiles, or to allow it to be more flexible and allow any 
type of ogr-readable file.  Here are a couple of questions:

1) Is there a command to dump the database(s) of any ogr file to a 
dataframe, regardless of the data type?  Right now, all I have found is 
that I need to use the read.dbf() function in the shapefiles library for 
a shapefile-associated DBF.
2) Is there any way to figure out the particular driver (aka file type) 
of a file I'm trying to read with ogr without needing the layer name?  
Alternatively, is there any way to list the layer names of an ogr file?

    Thanks -- I'm going to try to make a release of starspan in the next 
few weeks to have people try it out...

--j

-- 
Jonathan A. Greenberg, PhD
Postdoctoral Scholar
Center for Spatial Technologies and Remote Sensing (CSTARS)
University of California, Davis
One Shields Avenue
The Barn, Room 250N
Davis, CA 95616
Cell: 415-794-5043
AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307


From tech_dev at wildintellect.com  Tue Aug  4 01:04:10 2009
From: tech_dev at wildintellect.com (Alex Mandel)
Date: Mon, 03 Aug 2009 16:04:10 -0700
Subject: [R-sig-Geo] Dumping OGR database to dataframe(s)?
In-Reply-To: <4A776A56.1070207@ucdavis.edu>
References: <4A776A56.1070207@ucdavis.edu>
Message-ID: <4A776CEA.2080008@wildintellect.com>

Jonathan Greenberg wrote:
> R-sig-geo'ers:
> 
>    I'm pushing forward with recoding starspan as a set of R functions so
> we can get the program back on track after a long hiatus with the
> development of a C version (I don't know C and don't have time to learn
> it, and we lost our master programmer who did know C), and I'm trying to
> decide if I should allow the vector side of the program to specifically
> require shapefiles, or to allow it to be more flexible and allow any
> type of ogr-readable file.  Here are a couple of questions:
> 
> 1) Is there a command to dump the database(s) of any ogr file to a
> dataframe, regardless of the data type?  Right now, all I have found is
> that I need to use the read.dbf() function in the shapefiles library for
> a shapefile-associated DBF.
> 2) Is there any way to figure out the particular driver (aka file type)
> of a file I'm trying to read with ogr without needing the layer name? 
> Alternatively, is there any way to list the layer names of an ogr file?
> 
>    Thanks -- I'm going to try to make a release of starspan in the next
> few weeks to have people try it out...
> 
> --j
> 

Jonathan,

1.If you read the ogr layer in with the Rgdal package then you can
easily extract the dataframe from the spatial object.

library(rgdal)
layer1 <-
readOGR("/home/madadh/ucd/geo290-sp09/client/data/joined.shp","joined")
dataframe1 <- layer1 at data

2. ogrInfo should have all the information you need you will need at
least the connection string/path to the source to use it though, aka DSN
according to ogr/gdal documentation. You'll just need to parse it's
output to grab the pieces for other commands.

Alex


From friderike.oehler at jrc.ec.europa.eu  Tue Aug  4 08:39:54 2009
From: friderike.oehler at jrc.ec.europa.eu (Friderike Oehler)
Date: Tue, 4 Aug 2009 08:39:54 +0200
Subject: [R-sig-Geo] reduced pair correlation function (spatstat)
Message-ID: <82B6034F5A044DF29267ADE60BC54881@H07.jrc.it>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090804/220b0053/attachment.pl>

From friderike.oehler at jrc.ec.europa.eu  Tue Aug  4 09:52:39 2009
From: friderike.oehler at jrc.ec.europa.eu (Friderike Oehler)
Date: Tue, 4 Aug 2009 09:52:39 +0200
Subject: [R-sig-Geo] reduced pair correlation function (spatstat)
Message-ID: <EBF49A5AE13C4F8B81C633BD3EC9628E@H07.jrc.it>


Apologies for my question. I have now understood the issue:

The pcf of a planar point pattern (that might consist of the central points
of a sectioned fibre system), as implemented in R, directly provides the
estimator for the reduced pcf of a fibre process, i.e. not taking into
account the fibre where the respective point is located.

Apologies again,

Friderike


From marco.helbich at gmx.at  Tue Aug  4 11:32:28 2009
From: marco.helbich at gmx.at (Marco Helbich)
Date: Tue, 04 Aug 2009 11:32:28 +0200
Subject: [R-sig-Geo] aggregate outcome kernel density estimation using saga
	gis and overlay
Message-ID: <20090804093228.109640@gmx.net>

Dear List,

my problem is to aggregate the outcome frome kernel density estimations to some polygons using saga gis and/or the overlay command. In other words, applying a point-in-polygon analysis and calculating the mean of the points inside every polygon. 

I hope the following (cumbersome) example-code helps to reproduce my problem. 

Thank you very much for your help!

Regards
Marco

----
Marco Helbich
Institute for Urban and Regional Research
Austrian Academy of Sciences
Postgasse 7/4/2, A-1010 Vienna, Austria
e-mail: marco.helbich(at)oeaw.ac.at
e-mail priv.: marco.helbich(at)gmx.at

*** Keep on rockin' in the free world ***

####### CODE #############

library(rgdal); library(splancs); library(RSAGA); library(sp)

# test data
sids <- readOGR(system.file("shapes/sids.shp", package = "maptools"), "sids")
crs <- CRS("+proj=longlat +datum=NAD27")
proj4string(sids) <- crs
plot(sids)

ncrs <- CRS("+proj=utm +zone=18 +datum=NAD27")
tsids <- spTransform(sids, ncrs)
win <- unionSpatialPolygons(tsids, rep("x", length(slot(tsids, "polygons"))))
proj4string(win) <- ncrs

tcoord <- cbind(coordinates(tsids)[,1], coordinates(tsids)[,2])
tpoi <- SpatialPoints(tcoord)
proj4string(tpoi) <- ncrs
plot(win)
plot(tpoi, add=T)
tpoi.pts <- as.points(coordinates(tpoi))
win.pol = as.points(list(x=win at polygons[[1]]@Polygons[[1]]@coords[,1],
  y=win at polygons[[1]]@Polygons[[1]]@coords[,2]))

# define grid, bandwith for kernel density estimation
pixs <- 15000
dimx <- ceiling(abs((bbox(win)[1,1] - bbox(win)[1,2])/pixs))
dimy <- ceiling(abs((bbox(win)[2,1] - bbox(win)[2,2])/pixs))
grd <- GridTopology(cellcentre.offset=c(bbox(win)[1,1], bbox(win)[2,1]),
  cellsize=c(pixs, pixs), cells.dim=c(dimx,dimy))
summary(grd)

# kernel density estimation
kde <- spkernel2d(tpoi.pts, win.pol, 2000, grd)
kdf <- data.frame(k0=kde)
k <- SpatialGridDataFrame(grd, data=kdf)
spplot(k, sp.layout = list(list("sp.polygons", tsids)))
k1 <- as(k, "SpatialPointsDataFrame")
k1[["x"]] <- coordinates(k1)[,1]
k1[["y"]] <- coordinates(k1)[,2]

# the following part shows my problem: how can i aggregate the estimations
# (using the mean) for every polygon in tsids?

# version 1: using saga...
# i can not find any command to import the shape (have i missed somthing ?),
# i would like to calculated the point in polygon analysis there and export it
# back to R...
writeOGR(k1, dsn=".", layer="test", driver="ESRI Shapefile")
#write.dbf(slot(k1, "data"), file = "testdbf")

rsaga.env(path="C:/Progra~1/saga_vc")
rsaga.get.modules("shapes_polygons")
rsaga.get.usage("shapes_polygons", 4)

# version 2: using overlay
xx <- overlay(k1, tsids, fn = mean)
# how can i combine the outcome with my transformed sids to plot the result?




-- 

f?r nur 19,99 Euro/mtl.!* http://portal.gmx.net/de/go/dsl02


From Ervan.Rutishauser at ecofog.gf  Tue Aug  4 15:26:51 2009
From: Ervan.Rutishauser at ecofog.gf (Ervan Rutishauser)
Date: Tue, 4 Aug 2009 10:26:51 -0300
Subject: [R-sig-Geo] contourLines() to SpatialLineDataFrame
Message-ID: <D45C8CF4C5CB2A41956F98C65F093A3A52DDF2FC9A@funguti.ecofog.gf>

Dear all ,

I have a problem in converting some interpolated contourLines into SLDF, using the function ContourLines2SLDF. I tried with the example given in "Applied Spatial Data Analysis wit R", but for similar input data, the function returns a strange SLDF with my data... I am then unable to check for equality between first and last coordinates (suitable to create polygons)..
Does someone know what's wrong with my code??
Many thanks for your help!

library(maptools)
load("XXX/interpolated_den.Rdata")  ## the data is called DDD...
AA<-contourLines(DDD,levels=c(2))    ## I keep only the isolines of level 2
test<-ContourLines2SLDF(AA)                  ## library(maptools)   transforme les isolignes en SpatialLinesDataFrame

lns<-slot(test,"lines")           # as in the ASDAR p. 48
table(sapply(lns,function(x) length(slot(x,"Lines"))))

## return 28/1 rather that 1/28 -> lns is a list 1 object composed of 28 lines, rather than being a list of 28 object of 1 lines....
## thus I can't do the next step...

table(sapply(lignes, function(x) {
coord<-slot(slot(x,"Lines")[[1]],"coords")
identical(coord[1,],coord[nrow(coord),])}))


___________________________________________________________

Ervan Rutishauser
PhD student
CIRAD - UMR AMAP
BP 701
97387 Kourou Cedex
tel. 00594.594.32.92.96


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090804/88b99738/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: interpolated_den.Rdata
Type: application/octet-stream
Size: 2182 bytes
Desc: interpolated_den.Rdata
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090804/88b99738/attachment.obj>

From E.Couce.07 at bristol.ac.uk  Tue Aug  4 19:30:47 2009
From: E.Couce.07 at bristol.ac.uk (ElenaC)
Date: Tue, 4 Aug 2009 10:30:47 -0700 (PDT)
Subject: [R-sig-Geo]  subset large file using Spatial polygons?
Message-ID: <1249407047049-3385970.post@n2.nabble.com>


Dear all,

I'm a new user of R and the spatial library, so please forgive me if my
question is too basic/silly, but I haven't been able to find an answer, and
I'd really appreciate some help.

Im trying to use a very large (almost 2 GB) dataset with global elevation
and bathymetry info in NETcdf format. I can't load the whole thing into
memory as it is so large. I'm using GDAL.open to get a handle to the data
and now would like to process the information in subsets.

I know that getRasterData can read a subset of a file if I specify the
offset and size I want to read. But the offset and number of rows and
columns depends on the coordinate limits and resolution of the file. Is
there a general method that works using a SpatialPolygons object to define
the limits of the region I want to load into memory? 

Thanks!
Elena


-- 
View this message in context: http://n2.nabble.com/subset-large-file-using-Spatial-polygons--tp3385970p3385970.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From edzer.pebesma at uni-muenster.de  Wed Aug  5 00:48:44 2009
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Tue, 04 Aug 2009 15:48:44 -0700
Subject: [R-sig-Geo] subset large file using Spatial polygons?
In-Reply-To: <1249407047049-3385970.post@n2.nabble.com>
References: <1249407047049-3385970.post@n2.nabble.com>
Message-ID: <4A78BACC.9060607@uni-muenster.de>



ElenaC wrote:
> Dear all,
>
> I'm a new user of R and the spatial library, so please forgive me if my
> question is too basic/silly, but I haven't been able to find an answer, and
> I'd really appreciate some help.
>
> Im trying to use a very large (almost 2 GB) dataset with global elevation
> and bathymetry info in NETcdf format. I can't load the whole thing into
> memory as it is so large. I'm using GDAL.open to get a handle to the data
> and now would like to process the information in subsets.
>
> I know that getRasterData can read a subset of a file if I specify the
> offset and size I want to read. But the offset and number of rows and
> columns depends on the coordinate limits and resolution of the file. Is
> there a general method that works using a SpatialPolygons object to define
> the limits of the region I want to load into memory? 
>   
AFAIK, no. But this would certainly be a welcome extension!
> Thanks!
> Elena
>
>
>   

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763 http://ifgi.uni-muenster.de/
http://www.springer.com/978-0-387-78170-9 e.pebesma at wwu.de


From smurray444 at hotmail.com  Wed Aug  5 12:23:06 2009
From: smurray444 at hotmail.com (Steve Murray)
Date: Wed, 5 Aug 2009 10:23:06 +0000
Subject: [R-sig-Geo] put.var.ncdf error during NetCDF file creation (ncdf
	package)
Message-ID: <BAY135-W1634260C522AF670581386880D0@phx.gbl>


Dear all,


I am attempting to convert 10 NetCDF files into a single NetCDF file, due to the data input requirements of a model I hope to use. I am using the ncdf package, version 1.6. The data are global-scale water values, on a monthly basis for 10 years (ie. 120 months of data in total; at present the data are separated by year, with 12 months of data in each file - mrunoff_1986 through to mrunoff_1995). For each month there are 720 longitude x 360 latitude values, each with a corresponding runoff value (although some of these may be NAs).


Here is my code so far:



# READ IN NetCDF FILES FROM DISK


library(ncdf)


year <- 1986:1995

file_list <- paste("mrunoff-",year,".nc", sep="")

file_list


start <- 1986


for (i in file_list) {

        assign(paste("netcdf_",start,"_temp", sep=""),open.ncdf(i))

        start = start+1

          }


# Start converting 10 files into 1


latitude <- get.var.ncdf(netcdf_1986_temp, "Lat")

longitude <- get.var.ncdf(netcdf_1986_temp, "Lon")

month <- get.var.ncdf(netcdf_1986_temp, "Mon")


year <- 1986:1995


mrunoff_1986 <- get.var.ncdf(netcdf_1986_temp, "mrunoff")

mrunoff_1987 <- get.var.ncdf(netcdf_1987_temp, "mrunoff")

mrunoff_1988 <- get.var.ncdf(netcdf_1988_temp, "mrunoff")

mrunoff_1989 <- get.var.ncdf(netcdf_1989_temp, "mrunoff")

mrunoff_1990 <- get.var.ncdf(netcdf_1990_temp, "mrunoff")

mrunoff_1991 <- get.var.ncdf(netcdf_1991_temp, "mrunoff")

mrunoff_1992 <- get.var.ncdf(netcdf_1992_temp, "mrunoff")

mrunoff_1993 <- get.var.ncdf(netcdf_1993_temp, "mrunoff")

mrunoff_1994 <- get.var.ncdf(netcdf_1994_temp, "mrunoff")

mrunoff_1995 <- get.var.ncdf(netcdf_1995_temp, "mrunoff")



# Define variable dimensions


dimx <- dim.def.ncdf("Lon", "deg E", as.double(longitude))

dimy <- dim.def.ncdf("Lat", "deg N", as.double(latitude))

month <- dim.def.ncdf("Mon", "Months: Jan 86=1, Dec 95=120)", 1:120)

year <- dim.def.ncdf("Year", "year", year)


# Assign data: extract mrunoff from each of the 10 files and put into one place


mrunoff_data <- dim.def.ncdf("mrunoff",
"mm/month", c(mrunoff_1986, mrunoff_1987, mrunoff_1988, mrunoff_1989,
mrunoff_1990, mrunoff_1991, mrunoff_1992, mrunoff_1993, mrunoff_1994,
mrunoff_1995))


# Define runoff variable


mrunoff_dims <- var.def.ncdf("mrunoff_out", "mm/month", list(dimx, dimy, month), -9999.0, "Global Monthly Runoff for 1986-1995", "double")


# Create file


mrunoff_file <- create.ncdf("mrunoff.nc", mrunoff_dims)


# Put mrunoff data into the file


put.var.ncdf(mrunoff_file, mrunoff_dims, mrunoff_data)


# Write to disk


# close.ncdf(mrunoff_file)





However, when I run the code, I get the following error message:


> put.var.ncdf(mrunoff_file, mrunoff_dims, mrunoff_data)

Error in put.var.ncdf(mrunoff_file, mrunoff_dims, mrunoff_data) : 

  put.var.ncdf: error: you asked to write 31104000 values, but the passed data array only has 8 entries!



I can understand where the 31104000 comes from ((720*360)*12)*10, but am confused as to why only 8 values are being passed to put.var.ncdf. I therefore tried doing a couple of tests to shed some light on this:


> length(dimx); length(dimy); length(mrunoff_dims); length(mrunoff_data)

[1] 8

[1] 8

[1] 9

[1] 8



> str(dimx); str(dimy)

List of 8

 $ name         : chr "Lon"

 $ units        : chr "deg E"

 $ vals         : num [1:720] 0.25 0.75 1.25 1.75 2.25 2.75 3.25 3.75 4.25 4.75 ...

 $ len          : int 720

 $ id           : num -1

 $ unlim        : logi FALSE

 $ dimvarid     : num -1

 $ create_dimvar: logi TRUE

 - attr(*, "class")= chr "dim.ncdf"


List of 8

 $ name         : chr "Lat"

 $ units        : chr "deg N"

 $ vals         : num [1:360] -89.8 -89.2 -88.8 -88.2 -87.8 ...

 $ len          : int 360

 $ id           : num -1

 $ unlim        : logi FALSE

 $ dimvarid     : num -1

 $ create_dimvar: logi TRUE

 - attr(*, "class")= chr "dim.ncdf"



> str(mrunoff_dims); str(mrunoff_data)

List of 9

 $ name    : chr "mrunoff_out"

 $ units   : chr "mm/month"

 $ missval : num -9999

 $ longname: chr "Global Monthly Runoff for 1986-1995"

 $ id      : num -1

 $ prec    : chr "double"

 $ dim     :List of 3

  ..$ :List of 8

  .. ..$ name         : chr "Lon"

  .. ..$ units        : chr "deg E"

  .. ..$ vals         : num [1:720] 0.25 0.75 1.25 1.75 2.25 2.75 3.25 3.75 4.25 4.75 ...

  .. ..$ len          : int 720

  .. ..$ id           : num -1

  .. ..$ unlim        : logi FALSE

  .. ..$ dimvarid     : num -1

  .. ..$ create_dimvar: logi TRUE

  .. ..- attr(*, "class")= chr "dim.ncdf"

  ..$ :List of 8

  .. ..$ name         : chr "Lat"

  .. ..$ units        : chr "deg N"

  .. ..$ vals         : num [1:360] -89.8 -89.2 -88.8 -88.2 -87.8 ...

  .. ..$ len          : int 360

  .. ..$ id           : num -1

  .. ..$ unlim        : logi FALSE

  .. ..$ dimvarid     : num -1

  .. ..$ create_dimvar: logi TRUE

  .. ..- attr(*, "class")= chr "dim.ncdf"

  ..$ :List of 8

  .. ..$ name         : chr "Mon"

  .. ..$ units        : chr "Months since Jan 1986 (Jan 86 =1)"

  .. ..$ vals         : int [1:120] 1 2 3 4 5 6 7 8 9 10 ...

  .. ..$ len          : int 120

  .. ..$ id           : num -1

  .. ..$ unlim        : logi FALSE

  .. ..$ dimvarid     : num -1

  .. ..$ create_dimvar: logi TRUE

  .. ..- attr(*, "class")= chr "dim.ncdf"

 $ ndims   : int 3

 $ unlim   : logi FALSE

 - attr(*, "class")= chr "var.ncdf"


List of 8

 $ name         : chr "mrunoff"

 $ units        : chr "mm/month"

 $ vals         : num [1:31104000] NA NA NA NA NA NA NA NA NA NA ...

 $ len          : int 31104000

 $ id           : num -1

 $ unlim        : logi FALSE

 $ dimvarid     : num -1

 $ create_dimvar: logi TRUE

 - attr(*, "class")= chr "dim.ncdf"




As you can see from this, the length of the objects and the $len values of the objects differ - the latter being the intended values - plus all the data (e.g. 1:31104000) appear to be present in the str of the object. I'm struggling to see therefore why only 8 'bits' of data are being passed on.


Any help would be much appreciated.


Thanks for any suggestions,


Steve


_________________________________________________________________

oticons.


From gerarlab at hotmail.com  Thu Aug  6 02:15:41 2009
From: gerarlab at hotmail.com (Gerardo Laborde)
Date: Wed, 05 Aug 2009 20:15:41 -0400
Subject: [R-sig-Geo] R_Script for Modis in Linux
Message-ID: <BLU0-SMTP94C5A417ADA9555E049FBC30A0@phx.gbl>

Hello:

 I'm trying to run the R-script in a Ubuntu hardy heron, I have already
 installed the libraries needed and also have runed the R and MRT
 correctly.
 Do you know anyone I can contact who run this tool in linux?
 
thank's in advance.


From gianni.lavaredo at gmail.com  Thu Aug  6 08:57:43 2009
From: gianni.lavaredo at gmail.com (gianni lavaredo)
Date: Wed, 5 Aug 2009 23:57:43 -0700
Subject: [R-sig-Geo] RandomForest predictor coefficient to create a MAP
Message-ID: <518dff330908052357h68c7a69dn8a4ea4fc8e6e21a0@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090805/e624c3a0/attachment.pl>

From friderike.oehler at jrc.ec.europa.eu  Thu Aug  6 11:51:03 2009
From: friderike.oehler at jrc.ec.europa.eu (Friderike Oehler)
Date: Thu, 6 Aug 2009 11:51:03 +0200
Subject: [R-sig-Geo] pair correlation function - changes btw 2005-2009 ?
Message-ID: <0A22071D0C1940D183B71EDAD1FC6107@H07.jrc.it>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090806/6416f990/attachment.pl>

From vetter at pik-potsdam.de  Fri Aug  7 14:01:47 2009
From: vetter at pik-potsdam.de (Tobias Vetter)
Date: Fri, 07 Aug 2009 14:01:47 +0200
Subject: [R-sig-Geo]  inverse distance with covariables using gstat
Message-ID: <4A7C17AB.3080104@pik-potsdam.de>

I would like to do inverse distance interpolation with Trend removal.


When doing:
gstat(formula=z~Co,data=values,newdata=grid,nmax=10)

  will gstat first remove  the trend and then interpolate using inverse 
distance?

Here is the output I got:
[ordinary or weighted least squares prediction]


From marcarmu at gmail.com  Fri Aug  7 18:37:05 2009
From: marcarmu at gmail.com (=?UTF-8?Q?Marcia_Mu=C3=B1oz?=)
Date: Fri, 7 Aug 2009 12:37:05 -0400
Subject: [R-sig-Geo] about a variogram
Message-ID: <4d0b5e4f0908070937x389cb87cyc06092da730545a5@mail.gmail.com>

Dear all,



I want to show this variograma to you and ask about the meaning.  These are
data of abundance of a tree species in the forest. I took the values
(abundance = # individuals) and transformed this abundance with root square
(to minimize the variance) for each point. I have 520 point from the forest,
many of them with zero because the species was absent. This variogram means
that there is no spatial pattern?. I fitted this variogram with corSphere or
corRatio models to get these parameters, range and nugget. I choose a model
with base on Akaike Information Criterion (AIC). I would like to use these
values (range) for my results, but I do not known if I am doing right this.
I just want to hear your opinion.



Thanks a lot for your help



Mar


-- 
Marcia C. Mu?oz
Universidad de Puerto Rico
Departamento de Biologia - FB246
POBOX 23360
San Juan, PR 00931-3360
tel: 787-7640000, 2900
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090807/e21be400/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: semivariograma_adultos_ae.sqrt.jpeg
Type: image/jpeg
Size: 19457 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090807/e21be400/attachment.jpeg>

From vetter at pik-potsdam.de  Fri Aug  7 18:48:53 2009
From: vetter at pik-potsdam.de (Tobias Vetter)
Date: Fri, 07 Aug 2009 18:48:53 +0200
Subject: [R-sig-Geo] about a variogram
In-Reply-To: <4d0b5e4f0908070937x389cb87cyc06092da730545a5@mail.gmail.com>
References: <4d0b5e4f0908070937x389cb87cyc06092da730545a5@mail.gmail.com>
Message-ID: <4A7C5AF5.5000009@pik-potsdam.de>

It would be another possibilty to convert the data into classes.
Simplest way:  0  if the species is missing and 1 if existing .
>
> Dear all,
>
>  
>
> I want to show this variograma to you and ask about the meaning.  
> These are data of abundance of a tree species in the forest. I took 
> the values (abundance = # individuals) and transformed this abundance 
> with root square (to minimize the variance) for each point. I have 520 
> point from the forest, many of them with zero because the species was 
> absent. This variogram means that there is no spatial pattern?. I 
> fitted this variogram with corSphere or corRatio models to get these 
> parameters, range and nugget. I choose a model with base on Akaike 
> Information Criterion (AIC). I would like to use these values (range) 
> for my results, but I do not known if I am doing right this. I just 
> want to hear your opinion.
>
>  
>
> Thanks a lot for your help
>
>  
>
> Mar
>
>
>
> -- 
> Marcia C. Mu?oz
> Universidad de Puerto Rico
> Departamento de Biologia - FB246
> POBOX 23360
> San Juan, PR 00931-3360
> tel: 787-7640000, 2900
>
> ------------------------------------------------------------------------
>
> ------------------------------------------------------------------------
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From a.ghisla at gmail.com  Fri Aug  7 20:18:40 2009
From: a.ghisla at gmail.com (Anne Ghisla)
Date: Fri, 07 Aug 2009 20:18:40 +0200
Subject: [R-sig-Geo] [Report #11] Kriging with GRASS and R: v.autokrige port
 to wxPython and more
Message-ID: <4A7C7000.7040908@gmail.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hello all and sorry for cross-posting,

this week I worked on error handling by GUI, adding controls on input
data and parameters and hiding Run and Plot buttons unless all options
are suitable.
Variogram plotting is on its way - I discarded matplotlib to avoid
further dependencies, in favour of wx.lib.plot.

best regards,

Anne


-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.9 (MingW32)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/

iEYEARECAAYFAkp8cAAACgkQzZ3g4YwFFgb3ggCfaO4BeTfAmM4ISuh7K/j+87qq
iqwAoJ7jaz6XMiIuZMOZnMBvfdIlt0nX
=2VfU
-----END PGP SIGNATURE-----


From Adrian.Baddeley at csiro.au  Mon Aug 10 04:52:50 2009
From: Adrian.Baddeley at csiro.au (Adrian.Baddeley at csiro.au)
Date: Mon, 10 Aug 2009 10:52:50 +0800
Subject: [R-sig-Geo] pair correlation function - changes btw 2005-2009?
Message-ID: <57DC18C299094D4299F837570C5DF1C502AA3B4C64@EXWA-MBX01.nexus.csiro.au>

"Friderike Oehler" writes:

> I am still struggling with the pcf (spatstat package):
> I try to reproduce a plot that I did in 2005 using exactly the
> same point pattern (a small sample of 18 points, extremely clustered)
> and the same pcf-parameters:
> kernel="epanechnikov", stoyan=0.15, correction="Ripley" (code see below).

> However there is a shift on the r-axis in my present plot against the one
> from 2005: The form of the curve is the same, but while in 2005 I had one
> prominent peak at about r=135, the same peak is now located at approx.
> r=250. Also, in the earlier plot, g(r)=1 was reached at abour r=20, now at
> r=55.



> I checked the FAQs and Latest releases page at
> http://www.spatstat.org/spatstat/, but could not find what could cause this
> different behaviour of the function. Is is anyway possible that a change in
> the code of the function since 2005 causes the observed differences? If not,
> what else could it be?

Yes, the code for 'pcf' has certainly changed since 2005. A lot of related code in 'R' (such as the code in density.default that is used by pcf.ppp) has also changed since 2005.



First, please check that the window for the point pattern (as well as the x and y coordinates) is exactly the same as the one you used in 2005. The choice of window affects the edge corrections and hence the final result.



If that's not the problem, then the most plausible scenario is the following.

To perform the analysis described above, you had to override some of the defaults in pcf.ppp, in particular, the default maximum value of 'r'. The default is there because it is known in the literature that the standard edge corrections can introduce large bias and variance when r is large.



Since the data are extremely clustered, the most plausible explanation is that the software changes between 2005 and 2009 (which were mostly BUG FIXES) , together with the extreme clustering, have caused the discrepancy in output.



The current output from pcf.ppp in spatstat 1.16-1 looks correct to me. If you look at

     hist(pairdist(ab2))

it's clear that there is a mode of pairwise distances at about r=250. This is also reflected in

    plot(Kest(ab2, r=seq(0,400,2.5)),xlim=c(0,400))

which shows a steep jump in the empirical K function at about r=250. So the blip in the pcf at r=250 is real and correct.



Thus, if there was a discrepancy, it seems likely that the current code is correct and the 2005 code contained a bug that cuased the discrepancy.



A summary of the change history of pcf.ppp is listed below. It was introduced in spatstat 1.6-4 (April 2005). The argument 'r' was introduced in spatstat 1.7-13 (October 2005). A completely new, faster algorithm for computing pairwise distances was implemented in spatstat 1.9-2 (June 2006) along with a change to the default rule for the maximum value of 'r'.  The default value of the x limits for plotting was changed in spatstat 1.9-3 (June 2006). The smoothing algorithm was changed to use the new R function density.default in spatstat 1.11-0. The C routine was modified in spatstat 1.13-0. There were cosmetic changes in spatstat 1.10-0, 1.11-1, 1.12-2, 1.15-2 and 1.16-1.



regards

Adrian Baddeley


From friderike.oehler at jrc.ec.europa.eu  Mon Aug 10 09:50:34 2009
From: friderike.oehler at jrc.ec.europa.eu (Friderike Oehler)
Date: Mon, 10 Aug 2009 09:50:34 +0200
Subject: [R-sig-Geo] pair correlation function - changes btw 2005-2009?
In-Reply-To: <57DC18C299094D4299F837570C5DF1C502AA3B4C64@EXWA-MBX01.nexus.csiro.au>
References: <57DC18C299094D4299F837570C5DF1C502AA3B4C64@EXWA-MBX01.nexus.csiro.au>
Message-ID: <DD77A8B57EFF4CCC8C9B6EDE32924719@H07.jrc.it>

Dear Adrian,

Thank you very much for your thorough answer of my question. In fact, the
observation window and x-/y-coordinates were the same in 2005 and 2009. I
did specify the r parameter in 2009, which was not possible in early 2005.
Using the default r value does not permit to see the peak in the function at
250, because the limit is set to r=200, it thus seems that there is the same
shift of the peak compared to the 2005 plot.

Thank you also for confirming that the new plot should be the correct one.
It is evident that the inter-point distance of 250 occurs very frequently in
the pattern, yes. 

After all, many, many thanks for your continued active development of the
pcf-function and the whole spatstat package which is of great value.

Friderike



-----Original Message-----
From: Adrian.Baddeley at csiro.au [mailto:Adrian.Baddeley at csiro.au] 
Sent: 10 August 2009 04:53
To: r-sig-geo at stat.math.ethz.ch
Cc: friderike.oehler at jrc.ec.europa.eu; r.turner at auckland.ac.nz
Subject: pair correlation function - changes btw 2005-2009?

"Friderike Oehler" writes:

> I am still struggling with the pcf (spatstat package):
> I try to reproduce a plot that I did in 2005 using exactly the same 
> point pattern (a small sample of 18 points, extremely clustered) and 
> the same pcf-parameters:
> kernel="epanechnikov", stoyan=0.15, correction="Ripley" (code see below).

> However there is a shift on the r-axis in my present plot against the 
> one from 2005: The form of the curve is the same, but while in 2005 I 
> had one prominent peak at about r=135, the same peak is now located at
approx.
> r=250. Also, in the earlier plot, g(r)=1 was reached at abour r=20, 
> now at r=55.



> I checked the FAQs and Latest releases page at 
> http://www.spatstat.org/spatstat/, but could not find what could cause 
> this different behaviour of the function. Is is anyway possible that a 
> change in the code of the function since 2005 causes the observed 
> differences? If not, what else could it be?

Yes, the code for 'pcf' has certainly changed since 2005. A lot of related
code in 'R' (such as the code in density.default that is used by pcf.ppp)
has also changed since 2005.



First, please check that the window for the point pattern (as well as the x
and y coordinates) is exactly the same as the one you used in 2005. The
choice of window affects the edge corrections and hence the final result.



If that's not the problem, then the most plausible scenario is the
following.

To perform the analysis described above, you had to override some of the
defaults in pcf.ppp, in particular, the default maximum value of 'r'. The
default is there because it is known in the literature that the standard
edge corrections can introduce large bias and variance when r is large.



Since the data are extremely clustered, the most plausible explanation is
that the software changes between 2005 and 2009 (which were mostly BUG
FIXES) , together with the extreme clustering, have caused the discrepancy
in output.



The current output from pcf.ppp in spatstat 1.16-1 looks correct to me. If
you look at

     hist(pairdist(ab2))

it's clear that there is a mode of pairwise distances at about r=250. This
is also reflected in

    plot(Kest(ab2, r=seq(0,400,2.5)),xlim=c(0,400))

which shows a steep jump in the empirical K function at about r=250. So the
blip in the pcf at r=250 is real and correct.



Thus, if there was a discrepancy, it seems likely that the current code is
correct and the 2005 code contained a bug that cuased the discrepancy.



A summary of the change history of pcf.ppp is listed below. It was
introduced in spatstat 1.6-4 (April 2005). The argument 'r' was introduced
in spatstat 1.7-13 (October 2005). A completely new, faster algorithm for
computing pairwise distances was implemented in spatstat 1.9-2 (June 2006)
along with a change to the default rule for the maximum value of 'r'.  The
default value of the x limits for plotting was changed in spatstat 1.9-3
(June 2006). The smoothing algorithm was changed to use the new R function
density.default in spatstat 1.11-0. The C routine was modified in spatstat
1.13-0. There were cosmetic changes in spatstat 1.10-0, 1.11-1, 1.12-2,
1.15-2 and 1.16-1.



regards

Adrian Baddeley


From axillez at gmail.com  Mon Aug 10 17:00:16 2009
From: axillez at gmail.com (Achilleas Psomas)
Date: Mon, 10 Aug 2009 17:00:16 +0200
Subject: [R-sig-Geo] Help with the Predict function from the Raster package.
Message-ID: <c7dd9d780908100800h1141e57eh20ee3c64d425ee95@mail.gmail.com>

Dear R-sig Help.

I am trying to use the predict function from the Raster package but I
am running into trouble.
I am attaching the code together with the error message I get at the end.
I apologize that my code is not reproducible at your machines but I
believe that if my error is obvious it will help you to identify it.
Please pay not attention to the model quality or type. I am trying to
keep it as simple as possible to avoid any extra errors.

My R version is 2.8.0 since I found that 2.9.1 has a number of
glitches with installing new packages.
I would greatly appreciate your help:

Achilleas.

#####################################################

#Loading required packages

require(foreign)
Loading required package: foreign
Warning message:
package 'foreign' was built under R version 2.8.1
require(raster)
Loading required package: raster
Loading required package: sp
Loading required package: rgdal
Geospatial Data Abstraction Library extensions to R successfully loaded
Loaded GDAL runtime: GDAL 1.6.1, released 2009/05/11
Path to GDAL shared files: C:/PROGRA~1/R/R-28~1.0/library/rgdal/gdal
Loaded PROJ.4 runtime: Rel. 4.6.1, 21 August 2008
Path to PROJ.4 shared files: C:/PROGRA~1/R/R-28~1.0/library/rgdal/proj

raster version 0.8.9-22 (4-August-2009)
Warning messages:
1: package 'raster' was built under R version 2.9.1
2: package 'sp' was built under R version 2.8.1
3: package 'rgdal' was built under R version 2.9.1

#Importing the data
ndvi_2003177<-raster("ndvi_2003177.txt")
ndvi_2003193<-raster("ndvi_2003193.txt")

NDVI_2003 <-stack(ndvi_2003177,ndvi_2003193)

layerNames(NDVI_2003)
[1] "ndvi_2003177" "ndvi_2003193"

#Importing the DBF with the XY coordinates for sampling
require(foreign)
laque_pt<- read.dbf("laque_points_with_xy.dbf")

laque_xy<-laque_pt[,20:21]

#Sampling values from the raster stack
laque_pt_ndvi <- cbind(ver=laque_pt$PROZ_VERSI,xyValues(NDVI_2003,laque_xy))

names(as.data.frame(laque_pt_ndvi))
[1] "ver"          "ndvi_2003177" "ndvi_2003193"
dim(as.data.frame(laque_pt_ndvi))
[1] 177   3

#Building a simple model
model<-lm(ver~ndvi_2003177+ndvi_2003193,as.data.frame(laque_pt_ndvi))
summary(model)

Call:
lm(formula = ver ~ ndvi_2003177 + ndvi_2003193, data =
as.data.frame(laque_pt_ndvi))

Residuals:
    Min      1Q  Median      3Q     Max
-92.462 -14.689   1.360  13.839  60.360

Coefficients:
             Estimate Std. Error t value Pr(>|t|)
(Intercept)   108.813      6.832  15.928  < 2e-16 ***
ndvi_2003177  -73.003     21.477  -3.399 0.000838 ***
ndvi_2003193  -42.644     20.944  -2.036 0.043261 *
---
Signif. codes:  0 ?***? 0.001 ?**? 0.01 ?*? 0.05 ?.? 0.1 ? ? 1

Residual standard error: 23.39 on 174 degrees of freedom
Multiple R-squared: 0.3771,     Adjusted R-squared: 0.3699
F-statistic: 52.67 on 2 and 174 DF,  p-value: < 2.2e-16

#Precicting the model using the raster stack
test.predict<-predict(NDVI_2003,model)
Error in model.frame.default(Terms, newdata, na.action = na.action,
xlev = object$xlevels) :
  object is not a matrix
In addition: Warning message:
'newdata' had 2 rows but variable(s) found have 1 rows


From jrbouldin at ucdavis.edu  Mon Aug 10 18:30:53 2009
From: jrbouldin at ucdavis.edu (Jim Bouldin)
Date: Mon, 10 Aug 2009 09:30:53 -0700 (PDT)
Subject: [R-sig-Geo] inter-point distance calcs
Message-ID: <200908101630.n7AGUrsw028507@diometes.ucdavis.edu>


Can anyone recommend a package that can calculate the distances between
points (either all or a defined sample of) for x,y point locations listed
in long format?  Thanks in advance.

Jim Bouldin, PhD
Research Ecologist
Department of Plant Sciences, UC Davis
Davis CA, 95616
530-554-1740


From michael.denslow at gmail.com  Mon Aug 10 18:49:11 2009
From: michael.denslow at gmail.com (Michael Denslow)
Date: Mon, 10 Aug 2009 12:49:11 -0400
Subject: [R-sig-Geo] inter-point distance calcs
In-Reply-To: <200908101630.n7AGUrsw028507@diometes.ucdavis.edu>
References: <200908101630.n7AGUrsw028507@diometes.ucdavis.edu>
Message-ID: <b440a3f80908100949t7edc707dl7e925169eb6220db@mail.gmail.com>

I recently calculated all pairwise point distances with the fields package.
See ?rdist and ?rdist.earth
Also the sp package has
?spDistsN1

This one seems to be used to calculate the distance from one to point
to a set of multiple points.

Hope this helps,
Michael


On Mon, Aug 10, 2009 at 12:30 PM, Jim Bouldin<jrbouldin at ucdavis.edu> wrote:
>
> Can anyone recommend a package that can calculate the distances between
> points (either all or a defined sample of) for x,y point locations listed
> in long format? ?Thanks in advance.
>
> Jim Bouldin, PhD
> Research Ecologist
> Department of Plant Sciences, UC Davis
> Davis CA, 95616
> 530-554-1740
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



-- 
Michael Denslow

Graduate Student
I.W. Carpenter Jr. Herbarium [BOON]
Department of Biology
Appalachian State University
Boone, North Carolina U.S.A.

-- AND --

Communications Manager
Southeast Regional Network of Expertise and Collections
sernec.org


From debeaudette at ucdavis.edu  Mon Aug 10 18:54:47 2009
From: debeaudette at ucdavis.edu (Dylan Beaudette)
Date: Mon, 10 Aug 2009 09:54:47 -0700
Subject: [R-sig-Geo] inter-point distance calcs
In-Reply-To: <200908101630.n7AGUrsw028507@diometes.ucdavis.edu>
References: <200908101630.n7AGUrsw028507@diometes.ucdavis.edu>
Message-ID: <200908100954.48002.dylan.beaudette@gmail.com>

On Monday 10 August 2009, Jim Bouldin wrote:
> Can anyone recommend a package that can calculate the distances between
> points (either all or a defined sample of) for x,y point locations listed
> in long format?  Thanks in advance.
>

Sure. How about the function dist():

d <- data.frame(x=sample(1:10, 5), y=sample(1:10, 5))

dist(d)
         1        2        3        4
2 3.605551                           
3 6.403124 7.071068                  
4 9.219544 7.211103 5.830952         
5 8.062258 5.099020 7.211103 3.162278


Cheers,
Dylan


-- 
Dylan Beaudette
Soil Resource Laboratory
http://casoilresource.lawr.ucdavis.edu/
University of California at Davis
530.754.7341


From jrbouldin at ucdavis.edu  Mon Aug 10 19:48:27 2009
From: jrbouldin at ucdavis.edu (Jim Bouldin)
Date: Mon, 10 Aug 2009 10:48:27 -0700 (PDT)
Subject: [R-sig-Geo] inter-point distance calcs
Message-ID: <200908101748.n7AHmRrW004296@citheronia.ucdavis.edu>


Good grief, yes dist() will do quite nicely.  Pardon the more or less
continuous brain lock while I learn R.  Thanks.
Jim

> On Monday 10 August 2009, Jim Bouldin wrote:
> > Can anyone recommend a package that can calculate the distances between
> > points (either all or a defined sample of) for x,y point locations
> listed
> > in long format?  Thanks in advance.
> >
> 
> Sure. How about the function dist():
> 
> d <- data.frame(x=sample(1:10, 5), y=sample(1:10, 5))
> 
> dist(d)
>          1        2        3        4
> 2 3.605551                           
> 3 6.403124 7.071068                  
> 4 9.219544 7.211103 5.830952         
> 5 8.062258 5.099020 7.211103 3.162278
> 
> 
> Cheers,
> Dylan
> 
> 
> -- 
> Dylan Beaudette
> Soil Resource Laboratory
> http://casoilresource.lawr.ucdavis.edu/
> University of California at Davis
> 530.754.7341
> 

Jim Bouldin, PhD
Research Ecologist
Department of Plant Sciences, UC Davis
Davis CA, 95616
530-554-1740


From ksafi at orn.mpg.de  Mon Aug 10 20:33:57 2009
From: ksafi at orn.mpg.de (Kamran Safi)
Date: Mon, 10 Aug 2009 20:33:57 +0200
Subject: [R-sig-Geo] inter-point distance calcs
In-Reply-To: <200908101748.n7AHmRrW004296@citheronia.ucdavis.edu>
References: <200908101748.n7AHmRrW004296@citheronia.ucdavis.edu>
Message-ID: <4A806815.2030309@orn.mpg.de>

Hi all,

just a short notice:

dist() is euclidean distance while spDistN1 can take longitude and 
latitude and deliver great circle distance, which is quite something 
else for large distances.
Also, as far as I remember the library(argosfilter) provides some 
distance measures for positions.

Kami


Jim Bouldin wrote:
> Good grief, yes dist() will do quite nicely.  Pardon the more or less
> continuous brain lock while I learn R.  Thanks.
> Jim
>
>   
>> On Monday 10 August 2009, Jim Bouldin wrote:
>>     
>>> Can anyone recommend a package that can calculate the distances between
>>> points (either all or a defined sample of) for x,y point locations
>>>       
>> listed
>>     
>>> in long format?  Thanks in advance.
>>>
>>>       
>> Sure. How about the function dist():
>>
>> d <- data.frame(x=sample(1:10, 5), y=sample(1:10, 5))
>>
>> dist(d)
>>          1        2        3        4
>> 2 3.605551                           
>> 3 6.403124 7.071068                  
>> 4 9.219544 7.211103 5.830952         
>> 5 8.062258 5.099020 7.211103 3.162278
>>
>>
>> Cheers,
>> Dylan
>>
>>
>> -- 
>> Dylan Beaudette
>> Soil Resource Laboratory
>> http://casoilresource.lawr.ucdavis.edu/
>> University of California at Davis
>> 530.754.7341
>>
>>     
>
> Jim Bouldin, PhD
> Research Ecologist
> Department of Plant Sciences, UC Davis
> Davis CA, 95616
> 530-554-1740
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
>   
-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/x-pkcs7-signature
Size: 3275 bytes
Desc: S/MIME Cryptographic Signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090810/7ffcaca4/attachment.bin>

From jrbouldin at ucdavis.edu  Mon Aug 10 20:39:35 2009
From: jrbouldin at ucdavis.edu (Jim Bouldin)
Date: Mon, 10 Aug 2009 11:39:35 -0700 (PDT)
Subject: [R-sig-Geo] inter-point distance calcs
Message-ID: <200908101839.n7AIdZcP015359@tremex.ucdavis.edu>


> Sure. How about the function dist():
> 
> d <- data.frame(x=sample(1:10, 5), y=sample(1:10, 5))
> 
> dist(d)
>          1        2        3        4
> 2 3.605551                           
> 3 6.403124 7.071068                  
> 4 9.219544 7.211103 5.830952         
> 5 8.062258 5.099020 7.211103 3.162278

Actually I spoke a bit too soon--I need to get the distances into the
following format (using your example above):

Point Pair      Distance
1-2             3.6 
1-3             6.4
1-4             9.2
.               etc


From jrbouldin at ucdavis.edu  Mon Aug 10 20:50:43 2009
From: jrbouldin at ucdavis.edu (Jim Bouldin)
Date: Mon, 10 Aug 2009 11:50:43 -0700 (PDT)
Subject: [R-sig-Geo] inter-point distance calcs
Message-ID: <200908101850.n7AIohs2027173@melipona.ucdavis.edu>


Last message got truncated somehow.  To repeat, I forgot to mention that I
need to get the distances into the following format.  Using Dylan's example
above:

Point Pair      Distance
1-2             3.6 
1-3             6.4
1-4             9.2
.               .
.               .
3-4             .
3-4             .
4-5             3.2

That is, I need to be able to create a column vector that labels each pair
of points, which I can then cbin with the distance vector into a new matrix
(I know how to create the distance vector, but not the identifier vector).
 The point pair identifiers (labels) will come from a column in the
original data matrix.
Thanks


From ksafi at orn.mpg.de  Mon Aug 10 21:09:28 2009
From: ksafi at orn.mpg.de (Kamran Safi)
Date: Mon, 10 Aug 2009 21:09:28 +0200
Subject: [R-sig-Geo] inter-point distance calcs
In-Reply-To: <200908101850.n7AIohs2027173@melipona.ucdavis.edu>
References: <200908101850.n7AIohs2027173@melipona.ucdavis.edu>
Message-ID: <4A807068.3060100@orn.mpg.de>

Maybe a little too complicated, but I had it at hands:

d <- data.frame(x=sample(1:10, 5), y=sample(1:10, 5)) #create a sample 
data set
ss2 <- as.data.frame(as.matrix(dist(d))) #create a data.frame to extract 
row and column names
X <- rep(seq(1:length(row.names(ss2))), length(names(ss2))) #make a 
vector containing the X coordinate names
Y <- rep(seq(1:length(names(ss2))), length(row.names(ss2))) #the same for Y
Y <- sort(Y) #first sort
coords <- cbind(X, Y) #then cbind
data <- as.data.frame(cbind(coords, as.vector(as.matrix(dist(d))))) # 
add the data
data <- data[data$V3 >0,] #remove the distance to self


hope this solves it.

Kami


Jim Bouldin wrote:
> Last message got truncated somehow.  To repeat, I forgot to mention that I
> need to get the distances into the following format.  Using Dylan's example
> above:
>
> Point Pair      Distance
> 1-2             3.6 
> 1-3             6.4
> 1-4             9.2
> .               .
> .               .
> 3-4             .
> 3-4             .
> 4-5             3.2
>
> That is, I need to be able to create a column vector that labels each pair
> of points, which I can then cbin with the distance vector into a new matrix
> (I know how to create the distance vector, but not the identifier vector).
>  The point pair identifiers (labels) will come from a column in the
> original data matrix.
> Thanks
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
>   
-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/x-pkcs7-signature
Size: 3275 bytes
Desc: S/MIME Cryptographic Signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090810/bc7079f9/attachment.bin>

From mdw at purdue.edu  Tue Aug 11 04:41:44 2009
From: mdw at purdue.edu (Mark Daniel Ward)
Date: Mon, 10 Aug 2009 22:41:44 -0400
Subject: [R-sig-Geo] cartograms in R
Message-ID: <1249958504.4a80da68604bf@webmail.purdue.edu>

I installed libfftw3, and also Rcartogram from Omegahat, and I am able to run
Duncan's example successfully:

http://www.omegahat.org/Rcartogram/demo/synthetic.R

In fact, the example runs surprisingly fast, even on the humble Mac G4 I have at
home.  Very cool!

So now let's reach for the stars.  I would like to be able to assign a project
for my students to make some cartograms in R.  Has anyone tried this in
practice?  I see that Duncan gave this as a bonus project in fall 2008:

http://eeyore.ucdavis.edu/stat141/Homeworks/hw4.html

My students won't be wizards with R, in fact, they will be first-semester
students in R, but they are in the Honors program (top 1 percent of Purdue
students).  I think it is an excellent opportunity to get them making some
cartograms with R.  What I would like to have are some start-to-finish examples
to give to the students.  Duncan's synthetic.R example is really cool, but it
doesn't produce a cartogram, for instance, of the whole USA or the whole globe.

Maybe it sounds crazy, but I would love to have the students be able to make
some maps of the caliber seen on Worldmapper:
http://www.worldmapper.org/

Is this feasible?  Crazy?  Hints?  Suggestions?  I always like to have some
nice, concrete examples to give to the students before starting (rather than
letting the students jump into water over their heads and sink).

Any advice that you have would be greatly appreciated.


From jutesoro at yahoo.com  Tue Aug 11 06:18:42 2009
From: jutesoro at yahoo.com (Julius Tesoro)
Date: Mon, 10 Aug 2009 21:18:42 -0700 (PDT)
Subject: [R-sig-Geo] storing shapefiles in a function
In-Reply-To: <mailman.11.1249725603.24224.r-sig-geo@stat.math.ethz.ch>
Message-ID: <824780.90831.qm@web57609.mail.re1.yahoo.com>

Hi 

I would like to store shapefiles in a function such that when accessing the xy coordinates or any attribute of a shapefile, you dont have to read the shapefile all over again. How do I read it once and then store it within a function?


Cheers,

Julius Tesoro

--- On Sat, 8/8/09, r-sig-geo-request at stat.math.ethz.ch <r-sig-geo-request at stat.math.ethz.ch> wrote:

> From: r-sig-geo-request at stat.math.ethz.ch <r-sig-geo-request at stat.math.ethz.ch>
> Subject: R-sig-Geo Digest, Vol 72, Issue 6
> To: r-sig-geo at stat.math.ethz.ch
> Date: Saturday, August 8, 2009, 6:00 PM
> Send R-sig-Geo mailing list
> submissions to
> ??? r-sig-geo at stat.math.ethz.ch
> 
> To subscribe or unsubscribe via the World Wide Web, visit
> ??? https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> or, via email, send a message with subject or body 'help'
> to
> ??? r-sig-geo-request at stat.math.ethz.ch
> 
> You can reach the person managing the list at
> ??? r-sig-geo-owner at stat.math.ethz.ch
> 
> When replying, please edit your Subject line so it is more
> specific
> than "Re: Contents of R-sig-Geo digest..."
> 
> 
> Today's Topics:
> 
> ???1.? inverse distance with
> covariables using gstat (Tobias Vetter)
> ???2. about a variogram (Marcia Mu?oz)
> ???3. Re: about a variogram (Tobias Vetter)
> ???4. [Report #11] Kriging with GRASS and R:
> v.autokrige port to
> ? ? ? wxPython and more (Anne Ghisla)
> 
> 
> ----------------------------------------------------------------------
> 
> Message: 1
> Date: Fri, 07 Aug 2009 14:01:47 +0200
> From: Tobias Vetter <vetter at pik-potsdam.de>
> Subject: [R-sig-Geo]? inverse distance with
> covariables using gstat
> To: "r-sig-geo at stat.math.ethz.ch"
> <r-sig-geo at stat.math.ethz.ch>
> Message-ID: <4A7C17AB.3080104 at pik-potsdam.de>
> Content-Type: text/plain; charset=ISO-8859-15;
> format=flowed
> 
> I would like to do inverse distance interpolation with
> Trend removal.
> 
> 
> When doing:
> gstat(formula=z~Co,data=values,newdata=grid,nmax=10)
> 
> ? will gstat first remove? the trend and then
> interpolate using inverse 
> distance?
> 
> Here is the output I got:
> [ordinary or weighted least squares prediction]
> 
> 
> 
> ------------------------------
> 
> Message: 2
> Date: Fri, 7 Aug 2009 12:37:05 -0400
> From: Marcia Mu?oz <marcarmu at gmail.com>
> Subject: [R-sig-Geo] about a variogram
> To: "r-sig-geo at stat.math.ethz.ch"
> <r-sig-geo at stat.math.ethz.ch>
> Message-ID:
> ??? <4d0b5e4f0908070937x389cb87cyc06092da730545a5 at mail.gmail.com>
> Content-Type: text/plain; charset="utf-8"
> 
> Dear all,
> 
> 
> 
> I want to show this variograma to you and ask about the
> meaning.? These are
> data of abundance of a tree species in the forest. I took
> the values
> (abundance = # individuals) and transformed this abundance
> with root square
> (to minimize the variance) for each point. I have 520 point
> from the forest,
> many of them with zero because the species was absent. This
> variogram means
> that there is no spatial pattern?. I fitted this variogram
> with corSphere or
> corRatio models to get these parameters, range and nugget.
> I choose a model
> with base on Akaike Information Criterion (AIC). I would
> like to use these
> values (range) for my results, but I do not known if I am
> doing right this.
> I just want to hear your opinion.
> 
> 
> 
> Thanks a lot for your help
> 
> 
> 
> Mar
> 
> 
> -- 
> Marcia C. Mu?oz
> Universidad de Puerto Rico
> Departamento de Biologia - FB246
> POBOX 23360
> San Juan, PR 00931-3360
> tel: 787-7640000, 2900
> -------------- next part --------------
> An HTML attachment was scrubbed...
> URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090807/e21be400/attachment-0001.html>
> -------------- next part --------------
> A non-text attachment was scrubbed...
> Name: semivariograma_adultos_ae.sqrt.jpeg
> Type: image/jpeg
> Size: 19457 bytes
> Desc: not available
> URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090807/e21be400/attachment-0001.jpeg>
> 
> ------------------------------
> 
> Message: 3
> Date: Fri, 07 Aug 2009 18:48:53 +0200
> From: Tobias Vetter <vetter at pik-potsdam.de>
> Subject: Re: [R-sig-Geo] about a variogram
> To: Marcia Mu?oz <marcarmu at gmail.com>
> Cc: "r-sig-geo at stat.math.ethz.ch"
> <r-sig-geo at stat.math.ethz.ch>
> Message-ID: <4A7C5AF5.5000009 at pik-potsdam.de>
> Content-Type: text/plain; charset=UTF-8; format=flowed
> 
> It would be another possibilty to convert the data into
> classes.
> Simplest way:? 0? if the species is missing and 1
> if existing .
> >
> > Dear all,
> >
> >? 
> >
> > I want to show this variograma to you and ask about
> the meaning.? 
> > These are data of abundance of a tree species in the
> forest. I took 
> > the values (abundance = # individuals) and transformed
> this abundance 
> > with root square (to minimize the variance) for each
> point. I have 520 
> > point from the forest, many of them with zero because
> the species was 
> > absent. This variogram means that there is no spatial
> pattern?. I 
> > fitted this variogram with corSphere or corRatio
> models to get these 
> > parameters, range and nugget. I choose a model with
> base on Akaike 
> > Information Criterion (AIC). I would like to use these
> values (range) 
> > for my results, but I do not known if I am doing right
> this. I just 
> > want to hear your opinion.
> >
> >? 
> >
> > Thanks a lot for your help
> >
> >? 
> >
> > Mar
> >
> >
> >
> > -- 
> > Marcia C. Mu?oz
> > Universidad de Puerto Rico
> > Departamento de Biologia - FB246
> > POBOX 23360
> > San Juan, PR 00931-3360
> > tel: 787-7640000, 2900
> >
> >
> ------------------------------------------------------------------------
> >
> >
> ------------------------------------------------------------------------
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at stat.math.ethz.ch
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
> 
> 
> 
> ------------------------------
> 
> Message: 4
> Date: Fri, 07 Aug 2009 20:18:40 +0200
> From: Anne Ghisla <a.ghisla at gmail.com>
> Subject: [R-sig-Geo] [Report #11] Kriging with GRASS and
> R:
> ??? v.autokrige port to wxPython and more
> To: OSGeo SoC <soc at lists.osgeo.org>,
> grass-dev at lists.osgeo.org,
> ??? r-sig-geo at stat.math.ethz.ch,
> grass-stats at lists.osgeo.org,???
> gfoss italia
> ??? <gfoss at faunalia.com>
> Message-ID: <4A7C7000.7040908 at gmail.com>
> Content-Type: text/plain; charset=ISO-8859-15
> 
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
> 
> Hello all and sorry for cross-posting,
> 
> this week I worked on error handling by GUI, adding
> controls on input
> data and parameters and hiding Run and Plot buttons unless
> all options
> are suitable.
> Variogram plotting is on its way - I discarded matplotlib
> to avoid
> further dependencies, in favour of wx.lib.plot.
> 
> best regards,
> 
> Anne
> 
> 
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v1.4.9 (MingW32)
> Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/
> 
> iEYEARECAAYFAkp8cAAACgkQzZ3g4YwFFgb3ggCfaO4BeTfAmM4ISuh7K/j+87qq
> iqwAoJ7jaz6XMiIuZMOZnMBvfdIlt0nX
> =2VfU
> -----END PGP SIGNATURE-----
> 
> 
> 
> ------------------------------
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 
> 
> End of R-sig-Geo Digest, Vol 72, Issue 6
> ****************************************
> 





From milton.ruser at gmail.com  Tue Aug 11 07:00:40 2009
From: milton.ruser at gmail.com (milton ruser)
Date: Tue, 11 Aug 2009 01:00:40 -0400
Subject: [R-sig-Geo] storing shapefiles in a function
In-Reply-To: <824780.90831.qm@web57609.mail.re1.yahoo.com>
References: <mailman.11.1249725603.24224.r-sig-geo@stat.math.ethz.ch>
	<824780.90831.qm@web57609.mail.re1.yahoo.com>
Message-ID: <3aaf1a030908102200t59c263b5pf3b5a31eb702d7a0@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090811/d30364a9/attachment.pl>

From hi_ono2001 at ybb.ne.jp  Tue Aug 11 20:49:01 2009
From: hi_ono2001 at ybb.ne.jp (Hisaji ONO)
Date: Wed, 12 Aug 2009 03:49:01 +0900 (JST)
Subject: [R-sig-Geo] Bi- or Tri-variate maps for R
Message-ID: <20090811184902.75978.qmail@web10504.mail.ogk.yahoo.co.jp>

Hello.

 Does anyone know any examples of Bi- or Tri-variate maps
for R like this ArcVie example?

    
http://proceedings.esri.com/library/userconf/proc99/proceed/papers/pap171/p171.htm



 Thanks in advance.


From Virgilio.Gomez at uclm.es  Tue Aug 11 21:31:05 2009
From: Virgilio.Gomez at uclm.es (Virgilio =?ISO-8859-1?Q?G=F3mez-Rubio?=)
Date: Tue, 11 Aug 2009 21:31:05 +0200
Subject: [R-sig-Geo] Bi- or Tri-variate maps for R
In-Reply-To: <20090811184902.75978.qmail@web10504.mail.ogk.yahoo.co.jp>
References: <20090811184902.75978.qmail@web10504.mail.ogk.yahoo.co.jp>
Message-ID: <1250019065.26510.18.camel@Virgilio-Gomez>

Hi,

>  Does anyone know any examples of Bi- or Tri-variate maps
> for R like this ArcVie example?

I do not know of any code to do this. However, I am not sure if this is
the best way of displaying bivariate data in one map. The map in Section
IV is difficult to interpret (to me at least). Wouldn't it be better to
provide two separate maps, side by side, or providing a single map with
a summary statistic (for example, the ratio  median house
vale/population)?

I am not a geographer, so really cannot comment on this. But I just
think that trying to put too much information in a map may not be a good
idea.

Best wishes,

Virgilio


From mwkhan at ucdavis.edu  Tue Aug 11 23:06:56 2009
From: mwkhan at ucdavis.edu (Mehdi Khan)
Date: Tue, 11 Aug 2009 14:06:56 -0700
Subject: [R-sig-Geo] projectRaster function
Message-ID: <60b3892e0908111406p7413fff7wa3c74cc4f5cbf3c2@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090811/c4f6a7fe/attachment.pl>

From jrbouldin at ucdavis.edu  Tue Aug 11 23:56:47 2009
From: jrbouldin at ucdavis.edu (Jim Bouldin)
Date: Tue, 11 Aug 2009 14:56:47 -0700 (PDT)
Subject: [R-sig-Geo] inter-point distance calcs
Message-ID: <200908112156.n7BLul3e021624@cucujus.ucdavis.edu>


Thanks much Kami, that works.  If one changed that last line of yours to:

data = subset(data, X>Y)
 
that would eliminate both the duplicates and the diagonal, leaving just one
instance of each distance.
Jim

> Maybe a little too complicated, but I had it at hands:
> 
> d <- data.frame(x=sample(1:10, 5), y=sample(1:10, 5)) #create a sample
> 
> data set
> ss2 <- as.data.frame(as.matrix(dist(d))) #create a data.frame to
> extract 
> row and column names
> X <- rep(seq(1:length(row.names(ss2))), length(names(ss2))) #make a 
> vector containing the X coordinate names
> Y <- rep(seq(1:length(names(ss2))), length(row.names(ss2))) #the same
> for Y
> Y <- sort(Y) #first sort
> coords <- cbind(X, Y) #then cbind
> data <- as.data.frame(cbind(coords, as.vector(as.matrix(dist(d))))) # 
> add the data
> data <- data[data$V3 >0,] #remove the distance to self
> 
> 
> hope this solves it.
> 
> Kami
> 
> 
> Jim Bouldin wrote:
> > Last message got truncated somehow.  To repeat, I forgot to mention that
> I
> > need to get the distances into the following format.  Using Dylan's
> example
> > above:
> >
> > Point Pair      Distance
> > 1-2             3.6 
> > 1-3             6.4
> > 1-4             9.2
> > .               .
> > .               .
> > 3-4             .
> > 3-4             .
> > 4-5             3.2
> >
> > That is, I need to be able to create a column vector that labels each
> pair
> > of points, which I can then cbin with the distance vector into a new
> matrix
> > (I know how to create the distance vector, but not the identifier
> vector).
> >  The point pair identifiers (labels) will come from a column in the
> > original data matrix.
> > Thanks
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at stat.math.ethz.ch
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
> >
> >   
> 

Jim Bouldin, PhD
Research Ecologist
Department of Plant Sciences, UC Davis
Davis CA, 95616
530-554-1740


From milton.ruser at gmail.com  Wed Aug 12 02:51:00 2009
From: milton.ruser at gmail.com (milton ruser)
Date: Tue, 11 Aug 2009 20:51:00 -0400
Subject: [R-sig-Geo] Bi- or Tri-variate maps for R
In-Reply-To: <20090811184902.75978.qmail@web10504.mail.ogk.yahoo.co.jp>
References: <20090811184902.75978.qmail@web10504.mail.ogk.yahoo.co.jp>
Message-ID: <3aaf1a030908111751t70cb0aedh5f130b324f9a55ec@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090811/a300c598/attachment.pl>

From Adrian.Baddeley at csiro.au  Wed Aug 12 04:10:32 2009
From: Adrian.Baddeley at csiro.au (Adrian.Baddeley at csiro.au)
Date: Wed, 12 Aug 2009 10:10:32 +0800
Subject: [R-sig-Geo] inter-point distance calcs
Message-ID: <57DC18C299094D4299F837570C5DF1C502AA3B955C@EXWA-MBX01.nexus.csiro.au>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090812/409d39de/attachment.pl>

From mmotamed at purdue.edu  Wed Aug 12 04:29:27 2009
From: mmotamed at purdue.edu (Motamed, Mesbah J)
Date: Tue, 11 Aug 2009 22:29:27 -0400
Subject: [R-sig-Geo] Question about sum of dissimilarity command in spdep
	(ssw)
Message-ID: <70B620B8164456439DDDE9DAC5BCB9970495D0C1@EXCH04.purdue.lcl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090811/d50d79af/attachment.pl>

From Roger.Bivand at nhh.no  Wed Aug 12 11:11:05 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 12 Aug 2009 11:11:05 +0200 (CEST)
Subject: [R-sig-Geo] Bi- or Tri-variate maps for R
In-Reply-To: <20090811184902.75978.qmail@web10504.mail.ogk.yahoo.co.jp>
References: <20090811184902.75978.qmail@web10504.mail.ogk.yahoo.co.jp>
Message-ID: <alpine.LRH.2.00.0908121106290.25221@reclus.nhh.no>

On Wed, 12 Aug 2009, Hisaji ONO wrote:

> Hello.
>
> Does anyone know any examples of Bi- or Tri-variate maps
> for R like this ArcVie example?
>
>
> http://proceedings.esri.com/library/userconf/proc99/proceed/papers/pap171/p171.htm
>

Hi,

If you are thinking of micromaps, I'm not aware of any code, but for 
conditioned choropleth (CC) maps, I have some code, which is not yet 
polished enough for release, but does work. The references are:

Carr D, Wallin J, Carr D (2000) Two new templates for epidemiology 
applications: linked micromap plots and conditioned choropleth maps. 
Statistics in Medicine 19(17-18):2521?2538

Carr D, White D, MacEachren A (2005) Conditioned choropleth maps and 
hypothesis generation. Annals of the Association of American Geographers 
95(1):32?53

with a good example in:

Friendly M (2007) A.-M. Guerry?s Moral Statistics of France: challenges 
for multivariable spatial analysis. Statistical Science 22(3):368?399

Please let me know if you'd like a copy of my function.

Best wishes,

Roger

>
>
> Thanks in advance.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From Roger.Bivand at nhh.no  Wed Aug 12 20:11:48 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 12 Aug 2009 20:11:48 +0200 (CEST)
Subject: [R-sig-Geo] contourLines() to SpatialLineDataFrame
In-Reply-To: <D45C8CF4C5CB2A41956F98C65F093A3A52DDF2FC9A@funguti.ecofog.gf>
References: <D45C8CF4C5CB2A41956F98C65F093A3A52DDF2FC9A@funguti.ecofog.gf>
Message-ID: <alpine.LRH.2.00.0908121953080.26699@reclus.nhh.no>

On Tue, 4 Aug 2009, Ervan Rutishauser wrote:

> Dear all ,
>
> I have a problem in converting some interpolated contourLines into SLDF, 
> using the function ContourLines2SLDF. I tried with the example given in 
> "Applied Spatial Data Analysis wit R", but for similar input data, the 
> function returns a strange SLDF with my data... I am then unable to 
> check for equality between first and last coordinates (suitable to 
> create polygons).. Does someone know what's wrong with my code??

You have not examined the documentation of the function carefully enough, 
because it says: "the data frame is just the contour levels, with one 
Lines object made up of at least one Line object per level". Since you 
have only given it one level, you get one Lines object containing 28 Line 
objects, all at the same level value. To split them out, you need to make 
28 Lines objects with unique IDs, possibly in this way:

test1 <- SpatialLines(lapply(seq(along=AA), function(i) {
   Lines(
     list(
       Line(cbind(AA[[i]]$x, AA[[i]]$y))
     ),
   ID=as.character(i))
}))

for a SpatialLines object, or for SpatialPolygons:

test2 <- SpatialPolygons(lapply(seq(along=AA), function(i) {
   xy <- cbind(AA[[i]]$x, AA[[i]]$y)
   if (!identical(xy[1,], xy[nrow(xy),])) xy <- rbind(xy, xy[1,])
   Polygons(list(Polygon(xy)), ID=as.character(i))
}))

Hope this helps,

Roger

> Many thanks for your help!
>
> library(maptools)
> load("XXX/interpolated_den.Rdata")  ## the data is called DDD...
> AA<-contourLines(DDD,levels=c(2))    ## I keep only the isolines of level 2
> test<-ContourLines2SLDF(AA)                  ## library(maptools)   transforme les isolignes en SpatialLinesDataFrame
>
> lns<-slot(test,"lines")           # as in the ASDAR p. 48
> table(sapply(lns,function(x) length(slot(x,"Lines"))))
>
> ## return 28/1 rather that 1/28 -> lns is a list 1 object composed of 28 lines, rather than being a list of 28 object of 1 lines....
> ## thus I can't do the next step...
>
> table(sapply(lignes, function(x) {
> coord<-slot(slot(x,"Lines")[[1]],"coords")
> identical(coord[1,],coord[nrow(coord),])}))
>
>
> ___________________________________________________________
>
> Ervan Rutishauser
> PhD student
> CIRAD - UMR AMAP
> BP 701
> 97387 Kourou Cedex
> tel. 00594.594.32.92.96
>
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From Roger.Bivand at nhh.no  Wed Aug 12 20:40:39 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 12 Aug 2009 20:40:39 +0200 (CEST)
Subject: [R-sig-Geo] Question about sum of dissimilarity command in
 spdep (ssw)
In-Reply-To: <70B620B8164456439DDDE9DAC5BCB9970495D0C1@EXCH04.purdue.lcl>
References: <70B620B8164456439DDDE9DAC5BCB9970495D0C1@EXCH04.purdue.lcl>
Message-ID: <alpine.LRH.2.00.0908122024360.26699@reclus.nhh.no>

On Tue, 11 Aug 2009, Motamed, Mesbah J wrote:

> Dear Users,
>
>
>
> May I ask if more information is available concerning the ssw command in
> spdep? Within the spdep documentation, no references appear, and as such
> I'm having trouble understanding exactly what is meant by the term
> "dissimilarity" as well as the methods of distance it describes. If
> somebody could kindly offer a description of the formula underlying the
> sum of dissimilarity I would be sincerely grateful.
>

Please see:

      Assuncao, R. M, Neves, M. C., Camara, G. and Freitas, C. da C.
      (2006). Efficient regionalization techniques for socio-economic
      geographical units using minimum spanning trees. International
      Journal of Geographical Information Science Vol. 20, No. 7, August
      2006, 797-811

refered to in ?skater, which uses ssw(). In fact, the code of ssw is very 
explicit:

> ssw
function (data, id, method = c("euclidean", "maximum", "manhattan",
     "canberra", "binary", "minkowski", "mahalanobis", "other"),
     p = 2, cov, inverted = FALSE, otherfun)
{
     method <- match.arg(method)
     if (method == "other")
         return(otherfun(data, id))
     if (method == "mahalanobis")
         return(sum(mahalanobis(data[id, , drop = FALSE], colMeans(data[id,
             , drop = FALSE]), cov, inverted)))
     else return(sum(dist(rbind(colMeans(data[id, , drop = FALSE]),
         data[id, , drop = FALSE]), method, p = p)[1:length(id)]))
}
<environment: namespace:spdep>

so see ?mahalanobis and ?dist for the underlying explanations of the 
method= argument.

>
>
> On a related note, I would like to ask whether spdep can calculate a
> local measure of the Sokal statistic (close relative to the Moran's I
> and Geary's C). At present, it's not apparent to me whether this
> capability exists within the package, and to that end, if any guidance
> could be offered towards obtaining either a package or R code that can
> calculate the Sokal statistic, it would be much appreciated.
>

See ?sp.mantel.mc for an implementation, type="sokal". There may be others 
in ade4 or similar packages, there is a mantel() function in vegan; you'd 
need to construct the matrices yourself for this.

>
>
> Finally, since this is my first time using this list serve, may I ask
> whether a "search" feature for this list serve is available? I would
> hate to add already-answered questions to the pile.
>

Presently, use search on the full archive of the list in Nabble. 
Previously, RSiteSearch() on the command line also covered this list, but 
resources became overstretched at the search engine administrator's 
department. In fact pre-pending the list name in Google or other search 
engines should work too.

Hope this helps,

Roger

>
>
> With sincere thanks in advance for your responses,
>
>
>
> Mesbah J. Motamed
>
> Ph.D. Candidate
>
> Department of Agricultural Economics
>
> Purdue University
>
> http://web.ics.purdue.edu/~mmotamed
> <http://web.ics.purdue.edu/~mmotamed>
>
>
>
>
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From jrbouldin at ucdavis.edu  Thu Aug 13 01:51:26 2009
From: jrbouldin at ucdavis.edu (Jim Bouldin)
Date: Wed, 12 Aug 2009 16:51:26 -0700 (PDT)
Subject: [R-sig-Geo] inter-point distance calcs
Message-ID: <200908122351.n7CNpQHs002003@berna.ucdavis.edu>


Exactly what I was looking for.  Thank you very much.
Jim

> Jim Bouldin writes:
> 
> > Can anyone recommend a package that can calculate the distances between
> 
> > points (either all or a defined sample of) for x,y point locations
> listed
> 
> > in long format?
> 
> The package 'spatstat'  is optimised for this kind of thing.
> 
> If you have two vectors x,y containing point coordinates, first convert
> them to a point pattern using
> 
>       Z <- ppp(x, y, range(x), range(y))
> 
> Then to get the Euclidean distances between all pairs of points, returned
> as a matrix of distances, use
> 
>     D <- pairdist(X)
> 
> To get the distances between all pairs of points that are closer than a
> distance 'rmax', returned in 'long format', use
> 
>     C <- closepairs(X, rmax)
> 
> If you take rmax=diameter(as.owin(X)) then all pairs of points will be
> included.
> 
> The resulting object C is a list with entries i, j, xi, yi, xj, yj, dx,
> dy, d which are respectively
> 
>     i = index of point X[i]
> 
>     j = index of point X[j]
> 
>    xi, yi = coordinates of point X[i]
> 
>    xj, yj = coordinates of point X[j]
> 
>    dx, dy = vector difference X[j] - X[i]
> 
>    d = distance between X[i] and X[j].
> 
> You could convert this to a data frame using as.data.frame.
> 
> These algorithms are implemented in C and they appear to be at least as
> fast as anything else available.
> 
> There are separate algorithms for finding the nearest neighbour distance
> (nndist), identifying the nearest neighbour (nnwhich) etc etc.
> 
> Adrian Baddeley
> 

Jim Bouldin, PhD
Research Ecologist
Department of Plant Sciences, UC Davis
Davis CA, 95616
530-554-1740


From matthieu.stigler at gmail.com  Thu Aug 13 11:03:18 2009
From: matthieu.stigler at gmail.com (Matthieu Stigler)
Date: Thu, 13 Aug 2009 11:03:18 +0200
Subject: [R-sig-Geo] spplot with quantitative variable
Message-ID: <111060c20908130203r52176799q4ace957af573c48c@mail.gmail.com>

Hi

I'm new to sptial analysis and just dicovers so I have a really basic
question. I could unfortunately not find the answer on  in the tuto,
help files or springer book (tough it is sure there :-(). So sorry if
the answer is trivila but this would help me a lot!

I have a an object say TRY of class "SpatialPolygonsDataFrame"
representing a country and its subareas (26). First question, is there
a generic function to access the name of the subdivisions?
I used the workaround: as.data.frame(TRY)[,"NAME_1"] is there
something more elegant? How to extract the values in general?
TRY[,"NAME_1"] prints a lot of information beside the series I want.

My problem actually concerns to add a new series (say population) to
this dataset, and to plot it...

To add the series, I did:
data$new<-rnorm(100)

is that the right manner?

Then I tried to plot it using spplot() but I hvae the following
problem: the colors are just sorted following the order in which the
values appear in the series (so the first subdivion with name A...
with low pop can have same color as subdivion B with high color). So
the data is not sorted correspondly and the colors are totally messed
up. I just want to have the colors "increasing " with the population.
Furterhmore, my scale just shows the individual values for each
subdivision...

What shoulk I use? Define myself colors palette as in the springer
book at section 3,4? Do I do something wrong when adding the variable?
I don't understand why I dont get the same result as the example in
the demo(gallery):

library(sp); library(lattice) # required for trellis.par.set():
 trellis.par.set(sp.theme()) # sets color ramp to bpy.colors()
 library(maptools)
 nc <- readShapePoly(system.file("shapes/sids.shp",
package="maptools")[1], proj4string=CRS("+proj=longlat +datum=NAD27"))
spplot(nc, "SID79", names.attr = "1979")

here the scale does not give the individual values as in my case. Are
those object "SID79" and the series I entered so different? I can I
caompre them?

Thanks a lot!!

Matthieu Stigler


From Roger.Bivand at nhh.no  Thu Aug 13 11:55:54 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 13 Aug 2009 11:55:54 +0200 (CEST)
Subject: [R-sig-Geo] spplot with quantitative variable
In-Reply-To: <111060c20908130203r52176799q4ace957af573c48c@mail.gmail.com>
References: <111060c20908130203r52176799q4ace957af573c48c@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.0908131141210.30459@reclus.nhh.no>

On Thu, 13 Aug 2009, Matthieu Stigler wrote:

> Hi
>
> I'm new to sptial analysis and just dicovers so I have a really basic
> question. I could unfortunately not find the answer on  in the tuto,
> help files or springer book (tough it is sure there :-(). So sorry if
> the answer is trivila but this would help me a lot!
>
> I have a an object say TRY of class "SpatialPolygonsDataFrame"
> representing a country and its subareas (26). First question, is there
> a generic function to access the name of the subdivisions?
> I used the workaround: as.data.frame(TRY)[,"NAME_1"] is there
> something more elegant? How to extract the values in general?
> TRY[,"NAME_1"] prints a lot of information beside the series I want.

If the observation (feature) IDs are set to the name, row.names(TRY) would 
work (for recent releases of sp). If they are not so set, you can set them 
by:

TRY1 <- spChFIDs(TRY, as.character(TRY$NAME_1))

(see ?spChFIDs in maptools and examples in ch. 5). I suspect that NAME_1 
is a factor - what does str(as(TRY, "data.frame")) say?

>
> My problem actually concerns to add a new series (say population) to
> this dataset, and to plot it...
>
> To add the series, I did:
> data$new<-rnorm(100)

Yes, if the object is TRY, then TRY$new <- will do it. See also ?spCbind 
in maptools if you need more control of the ordering.

>
> is that the right manner?
>
> Then I tried to plot it using spplot() but I hvae the following
> problem: the colors are just sorted following the order in which the
> values appear in the series (so the first subdivion with name A...
> with low pop can have same color as subdivion B with high color). So
> the data is not sorted correspondly and the colors are totally messed
> up. I just want to have the colors "increasing " with the population.
> Furterhmore, my scale just shows the individual values for each
> subdivision...

This sounds very much as though the variable you are using is a factor, 
which will generate one colour per factor level. Are you reading in data 
that say use a comma as the decimal separator in a locale that expects a 
point (or the reverse)? You can convert a wrongly identified factor to 
numeric by coercing first to character, then sub()stituting the "," with 
"." (or the reverse if necessary, be careful to escape the point as it has 
special meanings in regular expressions), then coerce to numeric. This is 
R FAQ 7.10:

http://cran.r-project.org/doc/FAQ/R-FAQ.html#How-do-I-convert-factors-to-numeric_003f

for the conversion, see ?sub for changing the decimal separator.

Hope this helps,

Roger

>
> What shoulk I use? Define myself colors palette as in the springer
> book at section 3,4? Do I do something wrong when adding the variable?
> I don't understand why I dont get the same result as the example in
> the demo(gallery):
>
> library(sp); library(lattice) # required for trellis.par.set():
> trellis.par.set(sp.theme()) # sets color ramp to bpy.colors()
> library(maptools)
> nc <- readShapePoly(system.file("shapes/sids.shp",
> package="maptools")[1], proj4string=CRS("+proj=longlat +datum=NAD27"))
> spplot(nc, "SID79", names.attr = "1979")
>
> here the scale does not give the individual values as in my case. Are
> those object "SID79" and the series I entered so different? I can I
> caompre them?
>
> Thanks a lot!!
>
> Matthieu Stigler
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From pisicandru at hotmail.com  Thu Aug 13 14:35:39 2009
From: pisicandru at hotmail.com (Monica Pisica)
Date: Thu, 13 Aug 2009 12:35:39 +0000
Subject: [R-sig-Geo] creating a geotiff
In-Reply-To: <mailman.9.1250157603.12234.r-sig-geo@stat.math.ethz.ch>
References: <mailman.9.1250157603.12234.r-sig-geo@stat.math.ethz.ch>
Message-ID: <BAY130-W92E0FA6AB2215F1AC6CC9C3050@phx.gbl>


Hi,
 
I have some data as it is required for the function "image" {graphics}, that means a vector x for x coord, a vector y for y coord and a matrix m with x rows and y cols. I want to save this as a geotiff.  If i transform my data to take the form of a 3 column data.frame i can use gridded and writeGDAL to obtain my geotiff, but sincerely it  seems a little silly to do that. Is there any other way in doing it??? I've tried to transform this data in one of the sp objects but .... i was not able to. Any ideas??
 
Thanks for all the help,
 
Monica

 
_________________________________________________________________
Get back to school stuff for them and cashback for you.

B_BackToSchool_Cashback_BTSCashback_1x1

From matthieu.stigler at gmail.com  Thu Aug 13 14:52:16 2009
From: matthieu.stigler at gmail.com (Matthieu Stigler)
Date: Thu, 13 Aug 2009 14:52:16 +0200
Subject: [R-sig-Geo] spplot with quantitative variable
In-Reply-To: <alpine.LRH.2.00.0908131141210.30459@reclus.nhh.no>
References: <111060c20908130203r52176799q4ace957af573c48c@mail.gmail.com>
	<alpine.LRH.2.00.0908131141210.30459@reclus.nhh.no>
Message-ID: <111060c20908130552uccf6157v9bf1083763fbd9ab@mail.gmail.com>

>Hope this helps
yes it does, definitely.. thanks a lot!

Actually you were right, it is just a factor problem, the names were
in factor and the new series I added also :-( I?ll be able to solve
that now, thanks!

2009/8/13, Roger Bivand <Roger.Bivand at nhh.no>:
> On Thu, 13 Aug 2009, Matthieu Stigler wrote:
>
>> Hi
>>
>> I'm new to sptial analysis and just dicovers so I have a really basic
>> question. I could unfortunately not find the answer on  in the tuto,
>> help files or springer book (tough it is sure there :-(). So sorry if
>> the answer is trivila but this would help me a lot!
>>
>> I have a an object say TRY of class "SpatialPolygonsDataFrame"
>> representing a country and its subareas (26). First question, is there
>> a generic function to access the name of the subdivisions?
>> I used the workaround: as.data.frame(TRY)[,"NAME_1"] is there
>> something more elegant? How to extract the values in general?
>> TRY[,"NAME_1"] prints a lot of information beside the series I want.
>
> If the observation (feature) IDs are set to the name, row.names(TRY) would
> work (for recent releases of sp). If they are not so set, you can set them
> by:
>
> TRY1 <- spChFIDs(TRY, as.character(TRY$NAME_1))
>
> (see ?spChFIDs in maptools and examples in ch. 5). I suspect that NAME_1
> is a factor - what does str(as(TRY, "data.frame")) say?
>
>>
>> My problem actually concerns to add a new series (say population) to
>> this dataset, and to plot it...
>>
>> To add the series, I did:
>> data$new<-rnorm(100)
>
> Yes, if the object is TRY, then TRY$new <- will do it. See also ?spCbind
> in maptools if you need more control of the ordering.
>
>>
>> is that the right manner?
>>
>> Then I tried to plot it using spplot() but I hvae the following
>> problem: the colors are just sorted following the order in which the
>> values appear in the series (so the first subdivion with name A...
>> with low pop can have same color as subdivion B with high color). So
>> the data is not sorted correspondly and the colors are totally messed
>> up. I just want to have the colors "increasing " with the population.
>> Furterhmore, my scale just shows the individual values for each
>> subdivision...
>
> This sounds very much as though the variable you are using is a factor,
> which will generate one colour per factor level. Are you reading in data
> that say use a comma as the decimal separator in a locale that expects a
> point (or the reverse)? You can convert a wrongly identified factor to
> numeric by coercing first to character, then sub()stituting the "," with
> "." (or the reverse if necessary, be careful to escape the point as it has
> special meanings in regular expressions), then coerce to numeric. This is
> R FAQ 7.10:
>
> http://cran.r-project.org/doc/FAQ/R-FAQ.html#How-do-I-convert-factors-to-numeric_003f
>
> for the conversion, see ?sub for changing the decimal separator.
>
> Hope this helps,
>
> Roger
>
>>
>> What shoulk I use? Define myself colors palette as in the springer
>> book at section 3,4? Do I do something wrong when adding the variable?
>> I don't understand why I dont get the same result as the example in
>> the demo(gallery):
>>
>> library(sp); library(lattice) # required for trellis.par.set():
>> trellis.par.set(sp.theme()) # sets color ramp to bpy.colors()
>> library(maptools)
>> nc <- readShapePoly(system.file("shapes/sids.shp",
>> package="maptools")[1], proj4string=CRS("+proj=longlat +datum=NAD27"))
>> spplot(nc, "SID79", names.attr = "1979")
>>
>> here the scale does not give the individual values as in my case. Are
>> those object "SID79" and the series I entered so different? I can I
>> caompre them?
>>
>> Thanks a lot!!
>>
>> Matthieu Stigler
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> --
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>
>


From b.rowlingson at lancaster.ac.uk  Thu Aug 13 16:03:38 2009
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Thu, 13 Aug 2009 15:03:38 +0100
Subject: [R-sig-Geo] creating a geotiff
In-Reply-To: <BAY130-W92E0FA6AB2215F1AC6CC9C3050@phx.gbl>
References: <mailman.9.1250157603.12234.r-sig-geo@stat.math.ethz.ch>
	<BAY130-W92E0FA6AB2215F1AC6CC9C3050@phx.gbl>
Message-ID: <d8ad40b50908130703r7e0d01c5x1aaa26fe5f0ee3f3@mail.gmail.com>

On Thu, Aug 13, 2009 at 1:35 PM, Monica Pisica<pisicandru at hotmail.com> wrote:
>
> Hi,
>
> I have some data as it is required for the function "image" {graphics}, that means a vector x for x coord, a vector y for y coord and a matrix m with x rows and y cols. I want to save this as a geotiff. ?If i transform my data to take the form of a 3 column data.frame i can use gridded and writeGDAL to obtain my geotiff, but sincerely it ?seems a little silly to do that. Is there any other way in doing it??? I've tried to transform this data in one of the sp objects but .... i was not able to. Any ideas??

 Looking at the code for writeGDAL, it calls create2GDAL which
eventually converts its sp-class back into a matrix anyway!

    for (i in 1:nbands) {
        band = as.matrix(dataset[i])

It should be possible to write something like create2GDAL that
operates on a list(x,y,z) structure and avoid converting to sp-classes
and than back to matrix form. You just need to work out what
gridparameters(xyzlist) looks like, and then it's a simple cut n paste
job...

Actually, I think I did start doing that, but I can't find the code at
the moment....

Barry


From pisicandru at hotmail.com  Thu Aug 13 16:10:45 2009
From: pisicandru at hotmail.com (Monica Pisica)
Date: Thu, 13 Aug 2009 14:10:45 +0000
Subject: [R-sig-Geo] creating a geotiff
In-Reply-To: <d8ad40b50908130703r7e0d01c5x1aaa26fe5f0ee3f3@mail.gmail.com>
References: <mailman.9.1250157603.12234.r-sig-geo@stat.math.ethz.ch>
	<BAY130-W92E0FA6AB2215F1AC6CC9C3050@phx.gbl> 
	<d8ad40b50908130703r7e0d01c5x1aaa26fe5f0ee3f3@mail.gmail.com>
Message-ID: <BAY130-W172C66F7B38964E8C81C2FC3050@phx.gbl>


Thanks Barry!
 
I will look into it - for now i have my clumsy code and because my dataset is relatively small it does not matter, but for future this might not be the case.
 
Monica

----------------------------------------
> Date: Thu, 13 Aug 2009 15:03:38 +0100
> Subject: Re: [R-sig-Geo] creating a geotiff
> From: b.rowlingson at lancaster.ac.uk
> To: pisicandru at hotmail.com
> CC: r-sig-geo at stat.math.ethz.ch
>
> On Thu, Aug 13, 2009 at 1:35 PM, Monica Pisica wrote:
>>
>> Hi,
>>
>> I have some data as it is required for the function "image" {graphics}, that means a vector x for x coord, a vector y for y coord and a matrix m with x rows and y cols. I want to save this as a geotiff. If i transform my data to take the form of a 3 column data.frame i can use gridded and writeGDAL to obtain my geotiff, but sincerely it seems a little silly to do that. Is there any other way in doing it??? I've tried to transform this data in one of the sp objects but .... i was not able to. Any ideas??
>
> Looking at the code for writeGDAL, it calls create2GDAL which
[[elided Hotmail spam]]
>
> for (i in 1:nbands) {
> band = as.matrix(dataset[i])
>
> It should be possible to write something like create2GDAL that
> operates on a list(x,y,z) structure and avoid converting to sp-classes
> and than back to matrix form. You just need to work out what
> gridparameters(xyzlist) looks like, and then it's a simple cut n paste
> job...
>
> Actually, I think I did start doing that, but I can't find the code at
> the moment....
>
> Barry
_________________________________________________________________


_sync:082009

From b.rowlingson at lancaster.ac.uk  Thu Aug 13 16:28:51 2009
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Thu, 13 Aug 2009 15:28:51 +0100
Subject: [R-sig-Geo] creating a geotiff
In-Reply-To: <BAY130-W172C66F7B38964E8C81C2FC3050@phx.gbl>
References: <mailman.9.1250157603.12234.r-sig-geo@stat.math.ethz.ch>
	<BAY130-W92E0FA6AB2215F1AC6CC9C3050@phx.gbl>
	<d8ad40b50908130703r7e0d01c5x1aaa26fe5f0ee3f3@mail.gmail.com>
	<BAY130-W172C66F7B38964E8C81C2FC3050@phx.gbl>
Message-ID: <d8ad40b50908130728h6ba6977esd90015df9914b44a@mail.gmail.com>

On Thu, Aug 13, 2009 at 3:10 PM, Monica Pisica<pisicandru at hotmail.com> wrote:
>
> Thanks Barry!
>
> I will look into it - for now i have my clumsy code and because my dataset is relatively small it does not matter, but for future this might not be the case.

Found it!

 writeMgdal <-
  function (dataset, fname, drivername = "GTiff", type =
"Float32",options=NULL)
{
require(rgdal)
  if (nchar(fname) == 0)
    stop("empty file name")
  tds.out <- m2GDAL(dataset = dataset, drivername = drivername,
                         type = type, options=options)
  saveDataset(tds.out, fname, options = options)
  invisible(fname)
}


m2GDAL <-
  function (dataset, drivername = "GTiff", type = "Float32", options=NULL)
{
  #if (is.na(match(type, .GDALDataTypes)))
  #  stop(paste("Invalid type:", type, "not in:", paste(.GDALDataTypes,
  #                                                     collapse = "\n")))

  dataset$z = dataset$z[,ncol(dataset$z):1]
  xcs = diff(range(dataset$x))/ncol(dataset$z)
  ycs = diff(range(dataset$y))/nrow(dataset$z)
  gp = list(cellsize=c(xcs,ycs),
    cells.dim=c(nrow(dataset$z),ncol(dataset$z)),
    cellcentre.offset=c(min(dataset$x),min(dataset$y)))
  cellsize = gp$cellsize
  offset = gp$cellcentre.offset
  dims = gp$cells.dim
  d.drv = new("GDALDriver", drivername)
  nbands = 1
  if (!is.null(options) && !is.character(options))
    stop("options not character")
  tds.out = new("GDALTransientDataset", driver = d.drv, rows = dims[2],
    cols = dims[1], bands = nbands, type = type, options = options,
    handle = NULL)
  gt = c(offset[1] - 0.5 * cellsize[1], cellsize[1], 0, offset[2] +
    (dims[2] - 0.5) * cellsize[2], 0, -cellsize[2])
  .Call("RGDAL_SetGeoTransform", tds.out, gt, PACKAGE = "rgdal")
  p4s <- NA
  if (!is.na(p4s) && nchar(p4s) > 0)
    .Call("RGDAL_SetProject", tds.out, p4s, PACKAGE = "rgdal")
  for (i in 1:nbands) {
    band = as.matrix(dataset$z)
    if (!is.numeric(band))
      stop("Numeric bands required")
    putRasterData(tds.out, band, i)
  }
  tds.out
}

Usage:

 > xyz=list(x=seq(0,1,len=10),y=seq(1,2,len=14),z=matrix(runif(10*14),10,14))
 > image(xyz)
 > writeMgdal(xyz,"xyz.gtiff")

The resulting gtiff file when loaded into Quantum GIS looks the same
as the image in R, once I've set Qgis to scale the data.

Obviously this only works for single-band data.

Barry


From zev at zevross.com  Thu Aug 13 16:57:55 2009
From: zev at zevross.com (Zev Ross)
Date: Thu, 13 Aug 2009 10:57:55 -0400
Subject: [R-sig-Geo] Does spatstat round the frequency results?
Message-ID: <4A8429F3.3050308@zevross.com>

Hi All,

I was puzzled when the mark frequency table from the summary of a 
spatstat PPP object did not match the actual count of marks. The 
mismatch was small but unmistakable. After wasting time testing if this 
was related to duplicates or an odd window specification it seems that 
the reason is far simpler -- it seems that the summary.ppp class rounds 
the frequencies for objects with a large number of observations (see 
below for the example).

Is this true? Is there a reason for this?

Zev


mywin<-owin(c(-126,-111), c(28,46))

randData<-rpoispp(10, win=mywin)
marks(randData)<-factor(paste("Level", sample(1:8,
    length(randData$x), replace=TRUE)))

# here the summary table does match the number of marks

length(randData$marks)
table(randData$marks)
summary(randData)
summary(randData)$marks$frequency

###############################################

mywin<-owin(c(-126,-111), c(28,46))

randData<-rpoispp(50, win=mywin)
marks(randData)<-factor(paste("Level", sample(1:8,
    length(randData$x), replace=TRUE)))

# here the summary table does NOT match the number of marks

length(randData$marks)
table(randData$marks)
summary(randData)
summary(randData)$marks$frequency



-- 
Zev Ross
ZevRoss Spatial Analysis
120 N Aurora, Suite 3A
Ithaca, NY 14850
607-277-0004 (phone)
866-877-3690 (fax, toll-free)
zev at zevross.com


From pisicandru at hotmail.com  Thu Aug 13 17:18:01 2009
From: pisicandru at hotmail.com (Monica Pisica)
Date: Thu, 13 Aug 2009 15:18:01 +0000
Subject: [R-sig-Geo] creating a geotiff - and a new question
In-Reply-To: <d8ad40b50908130728h6ba6977esd90015df9914b44a@mail.gmail.com>
References: <mailman.9.1250157603.12234.r-sig-geo@stat.math.ethz.ch>
	<BAY130-W92E0FA6AB2215F1AC6CC9C3050@phx.gbl>
	<d8ad40b50908130703r7e0d01c5x1aaa26fe5f0ee3f3@mail.gmail.com>
	<BAY130-W172C66F7B38964E8C81C2FC3050@phx.gbl> 
	<d8ad40b50908130728h6ba6977esd90015df9914b44a@mail.gmail.com>
Message-ID: <BAY130-W151F58A5696D732903267EC3050@phx.gbl>


WOW! thanks so much for the code. That really makes my life easier. I really appreciate it.

Well, i have a new question - and this time it should be more than easy .... i actually feel ashamed, but for whatever reason i get an error.
 
I am reading a multiband image and i want to get tables out of each band.
 
so:
imag <- new("GDALReadOnlyDataset", pca_list)
 
dim(imag)
[1] 1408 1548    6
 
pcab <- list()
 
for(i in 1:6) {
timag<- getRasterTable(imag, band = i)
pcab[[i]] <- timag$band1
}
 
Error: subscript out of bounds
 
i
[1] 2

So it is clear to me that for band = 1 everything is fine but for band = 2 things are not anymore. So what i am doing wrong??
 
Again sorry for this very basic question, and lots of thanks for the code ;-)
 
Monica

----------------------------------------
> Date: Thu, 13 Aug 2009 15:28:51 +0100
> Subject: Re: [R-sig-Geo] creating a geotiff
> From: b.rowlingson at lancaster.ac.uk
> To: pisicandru at hotmail.com
> CC: r-sig-geo at stat.math.ethz.ch
>
> On Thu, Aug 13, 2009 at 3:10 PM, Monica Pisica wrote:
>>
>> Thanks Barry!
>>
>> I will look into it - for now i have my clumsy code and because my dataset is relatively small it does not matter, but for future this might not be the case.
>
> Found it!
>
> writeMgdal <-
> function (dataset, fname, drivername = "GTiff", type =
> "Float32",options=NULL)
> {
> require(rgdal)
> if (nchar(fname) == 0)
> stop("empty file name")
> tds.out <- m2GDAL(dataset = dataset, drivername = drivername,
> type = type, options=options)
> saveDataset(tds.out, fname, options = options)
> invisible(fname)
> }
>
>
> m2GDAL <-
> function (dataset, drivername = "GTiff", type = "Float32", options=NULL)
> {
> #if (is.na(match(type, .GDALDataTypes)))
> # stop(paste("Invalid type:", type, "not in:", paste(.GDALDataTypes,
> # collapse = "\n")))
>
> dataset$z = dataset$z[,ncol(dataset$z):1]
> xcs = diff(range(dataset$x))/ncol(dataset$z)
> ycs = diff(range(dataset$y))/nrow(dataset$z)
> gp = list(cellsize=c(xcs,ycs),
> cells.dim=c(nrow(dataset$z),ncol(dataset$z)),
> cellcentre.offset=c(min(dataset$x),min(dataset$y)))
> cellsize = gp$cellsize
> offset = gp$cellcentre.offset
> dims = gp$cells.dim
> d.drv = new("GDALDriver", drivername)
> nbands = 1
> if (!is.null(options) && !is.character(options))
> stop("options not character")
> tds.out = new("GDALTransientDataset", driver = d.drv, rows = dims[2],
> cols = dims[1], bands = nbands, type = type, options = options,
> handle = NULL)
> gt = c(offset[1] - 0.5 * cellsize[1], cellsize[1], 0, offset[2] +
> (dims[2] - 0.5) * cellsize[2], 0, -cellsize[2])
> .Call("RGDAL_SetGeoTransform", tds.out, gt, PACKAGE = "rgdal")
> p4s <- NA
> if (!is.na(p4s) && nchar(p4s)> 0)
> .Call("RGDAL_SetProject", tds.out, p4s, PACKAGE = "rgdal")
> for (i in 1:nbands) {
> band = as.matrix(dataset$z)
> if (!is.numeric(band))
> stop("Numeric bands required")
> putRasterData(tds.out, band, i)
> }
> tds.out
> }
>
> Usage:
>
>> xyz=list(x=seq(0,1,len=10),y=seq(1,2,len=14),z=matrix(runif(10*14),10,14))
>> image(xyz)
>> writeMgdal(xyz,"xyz.gtiff")
>
> The resulting gtiff file when loaded into Quantum GIS looks the same
> as the image in R, once I've set Qgis to scale the data.
>
> Obviously this only works for single-band data.
>
> Barry
_________________________________________________________________


_sync:082009

From Roger.Bivand at nhh.no  Thu Aug 13 18:14:21 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 13 Aug 2009 18:14:21 +0200 (CEST)
Subject: [R-sig-Geo] creating a geotiff
In-Reply-To: <BAY130-W92E0FA6AB2215F1AC6CC9C3050@phx.gbl>
References: <mailman.9.1250157603.12234.r-sig-geo@stat.math.ethz.ch>
	<BAY130-W92E0FA6AB2215F1AC6CC9C3050@phx.gbl>
Message-ID: <alpine.LRH.2.00.0908131811480.31478@reclus.nhh.no>

On Thu, 13 Aug 2009, Monica Pisica wrote:

>
> Hi,
>
> I have some data as it is required for the function "image" {graphics}, 
> that means a vector x for x coord, a vector y for y coord and a matrix m 
> with x rows and y cols. I want to save this as a geotiff.  If i 
> transform my data to take the form of a 3 column data.frame i can use 
> gridded and writeGDAL to obtain my geotiff, but sincerely it seems a 
> little silly to do that. Is there any other way in doing it??? I've 
> tried to transform this data in one of the sp objects but .... i was not 
> able to. Any ideas??

Use image2Grid() in sp, contributed by Mike Sumner for exactly this 
situation.

Roger

>
> Thanks for all the help,
>
> Monica
>
>
> _________________________________________________________________
> Get back to school stuff for them and cashback for you.
>
> B_BackToSchool_Cashback_BTSCashback_1x1
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From Roger.Bivand at nhh.no  Thu Aug 13 18:20:11 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 13 Aug 2009 18:20:11 +0200 (CEST)
Subject: [R-sig-Geo] creating a geotiff - and a new question
In-Reply-To: <BAY130-W151F58A5696D732903267EC3050@phx.gbl>
References: <mailman.9.1250157603.12234.r-sig-geo@stat.math.ethz.ch>
	<BAY130-W92E0FA6AB2215F1AC6CC9C3050@phx.gbl>
	<d8ad40b50908130703r7e0d01c5x1aaa26fe5f0ee3f3@mail.gmail.com>
	<BAY130-W172C66F7B38964E8C81C2FC3050@phx.gbl>
	<d8ad40b50908130728h6ba6977esd90015df9914b44a@mail.gmail.com>
	<BAY130-W151F58A5696D732903267EC3050@phx.gbl>
Message-ID: <alpine.LRH.2.00.0908131814490.31478@reclus.nhh.no>

On Thu, 13 Aug 2009, Monica Pisica wrote:

>
> WOW! thanks so much for the code. That really makes my life easier. I really appreciate it.
>
> Well, i have a new question - and this time it should be more than easy 
> .... i actually feel ashamed, but for whatever reason i get an error.
>
> I am reading a multiband image and i want to get tables out of each band.

If you want to extract the bands, they are:

x <- readGDAL("x.tif")
summary(x)
names(x)

the band1, band2, ... in its data slot, so

x$band1

is the first band (as a vector). If you need it as a matrix, you can 
subset to the single band and coerce:

as(x["band1"], "matrix")

Hope this helps,

Roger

>
> so:
> imag <- new("GDALReadOnlyDataset", pca_list)
>
> dim(imag)
> [1] 1408 1548    6
>
> pcab <- list()
>
> for(i in 1:6) {
> timag<- getRasterTable(imag, band = i)
> pcab[[i]] <- timag$band1
> }
>
> Error: subscript out of bounds
>
> i
> [1] 2
>
> So it is clear to me that for band = 1 everything is fine but for band = 2 things are not anymore. So what i am doing wrong??
>
> Again sorry for this very basic question, and lots of thanks for the code ;-)
>
> Monica
>
> ----------------------------------------
>> Date: Thu, 13 Aug 2009 15:28:51 +0100
>> Subject: Re: [R-sig-Geo] creating a geotiff
>> From: b.rowlingson at lancaster.ac.uk
>> To: pisicandru at hotmail.com
>> CC: r-sig-geo at stat.math.ethz.ch
>>
>> On Thu, Aug 13, 2009 at 3:10 PM, Monica Pisica wrote:
>>>
>>> Thanks Barry!
>>>
>>> I will look into it - for now i have my clumsy code and because my dataset is relatively small it does not matter, but for future this might not be the case.
>>
>> Found it!
>>
>> writeMgdal <-
>> function (dataset, fname, drivername = "GTiff", type =
>> "Float32",options=NULL)
>> {
>> require(rgdal)
>> if (nchar(fname) == 0)
>> stop("empty file name")
>> tds.out <- m2GDAL(dataset = dataset, drivername = drivername,
>> type = type, options=options)
>> saveDataset(tds.out, fname, options = options)
>> invisible(fname)
>> }
>>
>>
>> m2GDAL <-
>> function (dataset, drivername = "GTiff", type = "Float32", options=NULL)
>> {
>> #if (is.na(match(type, .GDALDataTypes)))
>> # stop(paste("Invalid type:", type, "not in:", paste(.GDALDataTypes,
>> # collapse = "\n")))
>>
>> dataset$z = dataset$z[,ncol(dataset$z):1]
>> xcs = diff(range(dataset$x))/ncol(dataset$z)
>> ycs = diff(range(dataset$y))/nrow(dataset$z)
>> gp = list(cellsize=c(xcs,ycs),
>> cells.dim=c(nrow(dataset$z),ncol(dataset$z)),
>> cellcentre.offset=c(min(dataset$x),min(dataset$y)))
>> cellsize = gp$cellsize
>> offset = gp$cellcentre.offset
>> dims = gp$cells.dim
>> d.drv = new("GDALDriver", drivername)
>> nbands = 1
>> if (!is.null(options) && !is.character(options))
>> stop("options not character")
>> tds.out = new("GDALTransientDataset", driver = d.drv, rows = dims[2],
>> cols = dims[1], bands = nbands, type = type, options = options,
>> handle = NULL)
>> gt = c(offset[1] - 0.5 * cellsize[1], cellsize[1], 0, offset[2] +
>> (dims[2] - 0.5) * cellsize[2], 0, -cellsize[2])
>> .Call("RGDAL_SetGeoTransform", tds.out, gt, PACKAGE = "rgdal")
>> p4s <- NA
>> if (!is.na(p4s) && nchar(p4s)> 0)
>> .Call("RGDAL_SetProject", tds.out, p4s, PACKAGE = "rgdal")
>> for (i in 1:nbands) {
>> band = as.matrix(dataset$z)
>> if (!is.numeric(band))
>> stop("Numeric bands required")
>> putRasterData(tds.out, band, i)
>> }
>> tds.out
>> }
>>
>> Usage:
>>
>>> xyz=list(x=seq(0,1,len=10),y=seq(1,2,len=14),z=matrix(runif(10*14),10,14))
>>> image(xyz)
>>> writeMgdal(xyz,"xyz.gtiff")
>>
>> The resulting gtiff file when loaded into Quantum GIS looks the same
>> as the image in R, once I've set Qgis to scale the data.
>>
>> Obviously this only works for single-band data.
>>
>> Barry
> _________________________________________________________________
>
>
> _sync:082009
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From pisicandru at hotmail.com  Thu Aug 13 18:34:53 2009
From: pisicandru at hotmail.com (Monica Pisica)
Date: Thu, 13 Aug 2009 16:34:53 +0000
Subject: [R-sig-Geo] creating a geotiff
In-Reply-To: <alpine.LRH.2.00.0908131811480.31478@reclus.nhh.no>
References: <mailman.9.1250157603.12234.r-sig-geo@stat.math.ethz.ch>
	<BAY130-W92E0FA6AB2215F1AC6CC9C3050@phx.gbl>
	<alpine.LRH.2.00.0908131811480.31478@reclus.nhh.no>
Message-ID: <BAY130-W15A8CF502000CCF525E9A4C3050@phx.gbl>


Thanks! I will certainly try it.
 
Monica

----------------------------------------
> Date: Thu, 13 Aug 2009 18:14:21 +0200
> From: Roger.Bivand at nhh.no
> To: pisicandru at hotmail.com
> CC: r-sig-geo at stat.math.ethz.ch
> Subject: Re: [R-sig-Geo] creating a geotiff
>
> On Thu, 13 Aug 2009, Monica Pisica wrote:
>
>>
>> Hi,
>>
>> I have some data as it is required for the function "image" {graphics},
>> that means a vector x for x coord, a vector y for y coord and a matrix m
>> with x rows and y cols. I want to save this as a geotiff. If i
>> transform my data to take the form of a 3 column data.frame i can use
>> gridded and writeGDAL to obtain my geotiff, but sincerely it seems a
>> little silly to do that. Is there any other way in doing it??? I've
>> tried to transform this data in one of the sp objects but .... i was not
>> able to. Any ideas??
>
> Use image2Grid() in sp, contributed by Mike Sumner for exactly this
> situation.
>
> Roger
>
>>
>> Thanks for all the help,
>>
>> Monica
>>
>>
>> _________________________________________________________________
>> Get back to school stuff for them and cashback for you.
>>
>> B_BackToSchool_Cashback_BTSCashback_1x1
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> --
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>
_________________________________________________________________


_sync:082009

From pisicandru at hotmail.com  Thu Aug 13 18:37:32 2009
From: pisicandru at hotmail.com (Monica Pisica)
Date: Thu, 13 Aug 2009 16:37:32 +0000
Subject: [R-sig-Geo] creating a geotiff - and a new question
In-Reply-To: <alpine.LRH.2.00.0908131814490.31478@reclus.nhh.no>
References: <mailman.9.1250157603.12234.r-sig-geo@stat.math.ethz.ch>
	<BAY130-W92E0FA6AB2215F1AC6CC9C3050@phx.gbl>
	<d8ad40b50908130703r7e0d01c5x1aaa26fe5f0ee3f3@mail.gmail.com>
	<BAY130-W172C66F7B38964E8C81C2FC3050@phx.gbl>
	<d8ad40b50908130728h6ba6977esd90015df9914b44a@mail.gmail.com>
	<BAY130-W151F58A5696D732903267EC3050@phx.gbl> 
	<alpine.LRH.2.00.0908131814490.31478@reclus.nhh.no>
Message-ID: <BAY130-W7A7ABF7057F4132D150ABC3050@phx.gbl>


This is much better ..... although i still don't understand why my code gave an error, although i have to recognize that yours is much more elegant.
 
Again thanks so much for your help,
 
Monica

----------------------------------------
> Date: Thu, 13 Aug 2009 18:20:11 +0200
> From: Roger.Bivand at nhh.no
> To: pisicandru at hotmail.com
> CC: b.rowlingson at lancaster.ac.uk; r-sig-geo at stat.math.ethz.ch
> Subject: Re: [R-sig-Geo] creating a geotiff - and a new question
>
> On Thu, 13 Aug 2009, Monica Pisica wrote:
>
>>
>> WOW! thanks so much for the code. That really makes my life easier. I really appreciate it.
>>
>> Well, i have a new question - and this time it should be more than easy
>> .... i actually feel ashamed, but for whatever reason i get an error.
>>
>> I am reading a multiband image and i want to get tables out of each band.
>
> If you want to extract the bands, they are:
>
> x <- readGDAL("x.tif")
> summary(x)
> names(x)
>
> the band1, band2, ... in its data slot, so
>
> x$band1
>
> is the first band (as a vector). If you need it as a matrix, you can
> subset to the single band and coerce:
>
> as(x["band1"], "matrix")
>
> Hope this helps,
>
> Roger
>
>>
>> so:
>> imag <- new("GDALReadOnlyDataset", pca_list)
>>
>> dim(imag)
>> [1] 1408 1548 6
>>
>> pcab <- list()
>>
>> for(i in 1:6) {
>> timag<- getRasterTable(imag, band = i)
>> pcab[[i]] <- timag$band1
>> }
>>
>> Error: subscript out of bounds
>>
>> i
>> [1] 2
>>
>> So it is clear to me that for band = 1 everything is fine but for band = 2 things are not anymore. So what i am doing wrong??
>>
>> Again sorry for this very basic question, and lots of thanks for the code ;-)
>>
>> Monica
>>
>> ----------------------------------------
>>> Date: Thu, 13 Aug 2009 15:28:51 +0100
>>> Subject: Re: [R-sig-Geo] creating a geotiff
>>> From: b.rowlingson at lancaster.ac.uk
>>> To: pisicandru at hotmail.com
>>> CC: r-sig-geo at stat.math.ethz.ch
>>>
>>> On Thu, Aug 13, 2009 at 3:10 PM, Monica Pisica wrote:
>>>>
>>>> Thanks Barry!
>>>>
>>>> I will look into it - for now i have my clumsy code and because my dataset is relatively small it does not matter, but for future this might not be the case.
>>>
>>> Found it!
>>>
>>> writeMgdal <-
>>> function (dataset, fname, drivername = "GTiff", type =
>>> "Float32",options=NULL)
>>> {
>>> require(rgdal)
>>> if (nchar(fname) == 0)
>>> stop("empty file name")
>>> tds.out <- m2GDAL(dataset = dataset, drivername = drivername,
>>> type = type, options=options)
>>> saveDataset(tds.out, fname, options = options)
>>> invisible(fname)
>>> }
>>>
>>>
>>> m2GDAL <-
>>> function (dataset, drivername = "GTiff", type = "Float32", options=NULL)
>>> {
>>> #if (is.na(match(type, .GDALDataTypes)))
>>> # stop(paste("Invalid type:", type, "not in:", paste(.GDALDataTypes,
>>> # collapse = "\n")))
>>>
>>> dataset$z = dataset$z[,ncol(dataset$z):1]
>>> xcs = diff(range(dataset$x))/ncol(dataset$z)
>>> ycs = diff(range(dataset$y))/nrow(dataset$z)
>>> gp = list(cellsize=c(xcs,ycs),
>>> cells.dim=c(nrow(dataset$z),ncol(dataset$z)),
>>> cellcentre.offset=c(min(dataset$x),min(dataset$y)))
>>> cellsize = gp$cellsize
>>> offset = gp$cellcentre.offset
>>> dims = gp$cells.dim
>>> d.drv = new("GDALDriver", drivername)
>>> nbands = 1
>>> if (!is.null(options) && !is.character(options))
>>> stop("options not character")
>>> tds.out = new("GDALTransientDataset", driver = d.drv, rows = dims[2],
>>> cols = dims[1], bands = nbands, type = type, options = options,
>>> handle = NULL)
>>> gt = c(offset[1] - 0.5 * cellsize[1], cellsize[1], 0, offset[2] +
>>> (dims[2] - 0.5) * cellsize[2], 0, -cellsize[2])
>>> .Call("RGDAL_SetGeoTransform", tds.out, gt, PACKAGE = "rgdal")
>>> p4s <- NA
>>> if (!is.na(p4s) && nchar(p4s)> 0)
>>> .Call("RGDAL_SetProject", tds.out, p4s, PACKAGE = "rgdal")
>>> for (i in 1:nbands) {
>>> band = as.matrix(dataset$z)
>>> if (!is.numeric(band))
>>> stop("Numeric bands required")
>>> putRasterData(tds.out, band, i)
>>> }
>>> tds.out
>>> }
>>>
>>> Usage:
>>>
>>>> xyz=list(x=seq(0,1,len=10),y=seq(1,2,len=14),z=matrix(runif(10*14),10,14))
>>>> image(xyz)
>>>> writeMgdal(xyz,"xyz.gtiff")
>>>
>>> The resulting gtiff file when loaded into Quantum GIS looks the same
>>> as the image in R, once I've set Qgis to scale the data.
>>>
>>> Obviously this only works for single-band data.
>>>
>>> Barry
>> _________________________________________________________________
>>
>>
>> _sync:082009
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> --
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>
_________________________________________________________________
Get back to school stuff for them and cashback for you.

B_BackToSchool_Cashback_BTSCashback_1x1

From katakagi at hotmail.com  Thu Aug 13 19:36:51 2009
From: katakagi at hotmail.com (Kenneth Takagi)
Date: Thu, 13 Aug 2009 13:36:51 -0400
Subject: [R-sig-Geo] Correctly aligning two polygon grids
Message-ID: <BLU113-W9E3A58A774AF1D7176354D4050@phx.gbl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090813/0c904411/attachment.pl>

From Roger.Bivand at nhh.no  Thu Aug 13 20:13:13 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 13 Aug 2009 20:13:13 +0200 (CEST)
Subject: [R-sig-Geo] Correctly aligning two polygon grids
In-Reply-To: <BLU113-W9E3A58A774AF1D7176354D4050@phx.gbl>
References: <BLU113-W9E3A58A774AF1D7176354D4050@phx.gbl>
Message-ID: <alpine.LRH.2.00.0908132002240.31478@reclus.nhh.no>

On Thu, 13 Aug 2009, Kenneth Takagi wrote:

>
> Hi,
>
> I would like to align two polygon grids, one with 100x100 cells and the 
> other with 50x50 cells.  The idea is that they would align so that 4 
> 50x50 cells would fall within one 100x100 cell.  Preferably, they would 
> have a common coordinate origin so that I could also make a grid of 
> 200x200 cells and they would also align properly.  It seems to be 
> something to do with where the centroids of each grid cell is placed? 
> Below is a reproducible example of where I am at.  I'm new with the sp 
> package so sorry for the length of the script!  I'm using R 9.1 with XP. 
> Thanks!

It gets much simpler if you start from the GridTopology object:

x.range <- c(1924835, 1926426)
y.range <- c(484673, 485490)
cell.size <- 100
cellcentre.offset <- c(x.range[1], y.range[1])+(cell.size/2)
cellsize <- rep(cell.size, 2)
cells.dim <- c(ceiling(abs(diff(x.range))/cell.size),
   ceiling(abs(diff(y.range))/cell.size))
GRD100 <- GridTopology(cellcentre.offset, cellsize, cells.dim)
pl100 <- as.SpatialPolygons.SpatialPixels(as(SpatialGrid(GRD100),
   "SpatialPixels"))
cell.size <- 50
cellcentre.offset <- c(x.range[1], y.range[1])+(cell.size/2)
cellsize <- rep(cell.size, 2)
cells.dim <- c(ceiling(abs(diff(x.range))/cell.size),
   ceiling(abs(diff(y.range))/cell.size))
GRD50 <- GridTopology(cellcentre.offset, cellsize, cells.dim)
pl50 <- as.SpatialPolygons.SpatialPixels(as(SpatialGrid(GRD50),
   "SpatialPixels"))
plot(pl50, border="magenta")
plot(pl100, add=TRUE)
bbox(pl50)
bbox(pl100)

This lets you tesselate the same area, but using different offsets for the 
anchoring south-west cell, giving matching bounding boxes (the north edge 
doesn't match here, as the number of cells chosen to include the top of 
the range differs).

Hope this helps,

Roger

>
> Code:
>
> ### Range of coordinate space
> x.range = c(1924835, 1926426)
> y.range = c(484673, 485490)
>
> ### Create 100x100 grid
> cell.size = 100
> grd100 <- expand.grid(x=seq(from=x.range[1], to=x.range[2], by=cell.size),
>     y=seq(from=y.range[1], to=y.range[2], by=cell.size))
> coordinates(grd100) <- ~ x+y
> gridded(grd100) <- TRUE
> grd100.SP <- as.SpatialPolygons.SpatialPixels(grd100)
> centroids <- coordinates(grd100.SP)
> x <- centroids[,1]
> y <- centroids[,2]
> row.names100 <- sapply(slot(grd100.SP, "polygons"), function(i) slot(i, "ID"))
> grd100.SPDF <- SpatialPolygonsDataFrame(grd100.SP,
>     data=data.frame(x=x, y=y, row.names=row.names100))
>
>
> ### Create 50x50 grid
> cell.size = 50
> grd50 <- expand.grid(x=seq(from=x.range[1], to=x.range[2], by=cell.size),
>     y=seq(from=y.range[1], to=y.range[2], by=cell.size))
> coordinates(grd50) <- ~ x+y
> gridded(grd50) <- TRUE
> grd50.SP<-as.SpatialPolygons.SpatialPixels(grd50)
> centroids <- coordinates(grd50.SP)
> x <- centroids[,1]
> y <- centroids[,2]
> row.names50 <- sapply(slot(grd50.SP, "polygons"), function(i) slot(i, "ID"))
> grd50.SPDF <- SpatialPolygonsDataFrame(grd50.SP,
>     data=data.frame(x=x, y=y, row.names=row.names50))
>
>
> ### Plot both grids
> s100 <- list("sp.lines", as(grd100.SPDF, "SpatialLinesDataFrame"), "magenta",
>    lwd=2)
> spplot(as(grd50.SPDF, "SpatialLinesDataFrame"), "x", col.regions="black",
>    sp.layout=list(s100),colorkey = F)
>
> _________________________________________________________________
>
>
> _sync:082009
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From etiennebr at gmail.com  Thu Aug 13 22:07:13 2009
From: etiennebr at gmail.com (Etienne Bellemare)
Date: Thu, 13 Aug 2009 16:07:13 -0400
Subject: [R-sig-Geo] Applying generic function to grids using n x n moving
	window
Message-ID: <6e10ffb0908131307t7aa6c75fsea18228cc87d80b5@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090813/521b5f9e/attachment.pl>

From r.hijmans at gmail.com  Fri Aug 14 00:06:58 2009
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Thu, 13 Aug 2009 15:06:58 -0700
Subject: [R-sig-Geo] Correctly aligning two polygon grids
In-Reply-To: <alpine.LRH.2.00.0908132002240.31478@reclus.nhh.no>
References: <BLU113-W9E3A58A774AF1D7176354D4050@phx.gbl>
	<alpine.LRH.2.00.0908132002240.31478@reclus.nhh.no>
Message-ID: <dc22b2570908131506g203a0f16w586dd1c2f9beafdc@mail.gmail.com>

Kenneth,

This is how I would do it with the raster package (
install.packages("raster", repos="http://R-Forge.R-project.org")

library(raster)
r100 <- raster(extent(1924835, 1926426, 484673, 485490))
res(r100) <- 100
r50 <- disaggregate(r100,2)
r200 <- aggregate(r100,2)

#to make a map
# here you could perhaps use the "polygon grid" values?
r100[] <- 1:ncell(r100)
plot(r100)

Robert


On Thu, Aug 13, 2009 at 11:13 AM, Roger Bivand<Roger.Bivand at nhh.no> wrote:
> On Thu, 13 Aug 2009, Kenneth Takagi wrote:
>
>>
>> Hi,
>>
>> I would like to align two polygon grids, one with 100x100 cells and the
>> other with 50x50 cells. ?The idea is that they would align so that 4 50x50
>> cells would fall within one 100x100 cell. ?Preferably, they would have a
>> common coordinate origin so that I could also make a grid of 200x200 cells
>> and they would also align properly. ?It seems to be something to do with
>> where the centroids of each grid cell is placed? Below is a reproducible
>> example of where I am at. ?I'm new with the sp package so sorry for the
>> length of the script! ?I'm using R 9.1 with XP. Thanks!
>
> It gets much simpler if you start from the GridTopology object:
>
> x.range <- c(1924835, 1926426)
> y.range <- c(484673, 485490)
> cell.size <- 100
> cellcentre.offset <- c(x.range[1], y.range[1])+(cell.size/2)
> cellsize <- rep(cell.size, 2)
> cells.dim <- c(ceiling(abs(diff(x.range))/cell.size),
> ?ceiling(abs(diff(y.range))/cell.size))
> GRD100 <- GridTopology(cellcentre.offset, cellsize, cells.dim)
> pl100 <- as.SpatialPolygons.SpatialPixels(as(SpatialGrid(GRD100),
> ?"SpatialPixels"))
> cell.size <- 50
> cellcentre.offset <- c(x.range[1], y.range[1])+(cell.size/2)
> cellsize <- rep(cell.size, 2)
> cells.dim <- c(ceiling(abs(diff(x.range))/cell.size),
> ?ceiling(abs(diff(y.range))/cell.size))
> GRD50 <- GridTopology(cellcentre.offset, cellsize, cells.dim)
> pl50 <- as.SpatialPolygons.SpatialPixels(as(SpatialGrid(GRD50),
> ?"SpatialPixels"))
> plot(pl50, border="magenta")
> plot(pl100, add=TRUE)
> bbox(pl50)
> bbox(pl100)
>
> This lets you tesselate the same area, but using different offsets for the
> anchoring south-west cell, giving matching bounding boxes (the north edge
> doesn't match here, as the number of cells chosen to include the top of the
> range differs).
>
> Hope this helps,
>
> Roger
>
>>
>> Code:
>>
>> ### Range of coordinate space
>> x.range = c(1924835, 1926426)
>> y.range = c(484673, 485490)
>>
>> ### Create 100x100 grid
>> cell.size = 100
>> grd100 <- expand.grid(x=seq(from=x.range[1], to=x.range[2], by=cell.size),
>> ? ?y=seq(from=y.range[1], to=y.range[2], by=cell.size))
>> coordinates(grd100) <- ~ x+y
>> gridded(grd100) <- TRUE
>> grd100.SP <- as.SpatialPolygons.SpatialPixels(grd100)
>> centroids <- coordinates(grd100.SP)
>> x <- centroids[,1]
>> y <- centroids[,2]
>> row.names100 <- sapply(slot(grd100.SP, "polygons"), function(i) slot(i,
>> "ID"))
>> grd100.SPDF <- SpatialPolygonsDataFrame(grd100.SP,
>> ? ?data=data.frame(x=x, y=y, row.names=row.names100))
>>
>>
>> ### Create 50x50 grid
>> cell.size = 50
>> grd50 <- expand.grid(x=seq(from=x.range[1], to=x.range[2], by=cell.size),
>> ? ?y=seq(from=y.range[1], to=y.range[2], by=cell.size))
>> coordinates(grd50) <- ~ x+y
>> gridded(grd50) <- TRUE
>> grd50.SP<-as.SpatialPolygons.SpatialPixels(grd50)
>> centroids <- coordinates(grd50.SP)
>> x <- centroids[,1]
>> y <- centroids[,2]
>> row.names50 <- sapply(slot(grd50.SP, "polygons"), function(i) slot(i,
>> "ID"))
>> grd50.SPDF <- SpatialPolygonsDataFrame(grd50.SP,
>> ? ?data=data.frame(x=x, y=y, row.names=row.names50))
>>
>>
>> ### Plot both grids
>> s100 <- list("sp.lines", as(grd100.SPDF, "SpatialLinesDataFrame"),
>> "magenta",
>> ? lwd=2)
>> spplot(as(grd50.SPDF, "SpatialLinesDataFrame"), "x", col.regions="black",
>> ? sp.layout=list(s100),colorkey = F)
>>
>> _________________________________________________________________
>>
>>
>> _sync:082009
>> ? ? ? ?[[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> --
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From WRoberts at csir.co.za  Fri Aug 14 12:22:02 2009
From: WRoberts at csir.co.za (Wesley Roberts)
Date: Fri, 14 Aug 2009 12:22:02 +0200
Subject: [R-sig-Geo] writeOGR unknown data type
Message-ID: <4A8556EA.8E2F.0073.0@csir.co.za>

Dear r-sig-geo,

I am having trouble exporting an sp object created in R using writeOGR. Below is the code I am using, basically it creates a regular grid to cover a point data set opened using readShapePoints. I then convert the spatialpoints to polygons and then finally to a SpatialPolygonsDataFrame. I would now like to export this sp data set as a shapefile so that I can add some attributes to it. Unfortunately I receive the following error each time I try to run the export,

> poly<-readShapePoints("Poly_one_pts.shp", proj4string=CRS("+proj=tmerc +south +ellips=WGS84 +datum=WGS84 +lon_o=31 +k_0=1 +units=m +no_defs"))
> grd<-spsample(poly,cellsize=c(4,4),type="regular")
> grd<-as(as(as(grd,"SpatialPixels"),"SpatialPolygons"),"SpatialPolygonsDataFrame")
> tp<-tempdir()
> writeOGR(grd,tp,"grd",driver="ESRI Shapefile",verbose = FALSE)
Error in writeOGR(grd, tp, "grd", driver = "ESRI Shapefile", verbose = FALSE) : 
  NULL NULL unknown data type


An export of poly runs fine but it seems when I try to export grd it is an unknown data type. Both classes seem to be similar and writeOGR should be able to export both data sets. 

> class(poly)
[1] "SpatialPointsDataFrame"
attr(,"package")
[1] "sp"
> class(grd)
[1] "SpatialPolygonsDataFrame"
attr(,"package")
[1] "sp"


Any help on this issue would be greatly appreciated.
Many thanks and kind regards,
Wesley

Wesley Roberts MSc.
Researcher: Earth Observation
Natural Resources & the Environment (NRE)
CSIR
Tel: +27 (0)21 888-2490
Fax: +27 (0)21 888-2693
"To know the road ahead, ask those coming back."
- Chinese proverb



-- 
This message is subject to the CSIR's copyright terms and conditions, e-mail legal notice, and implemented Open Document Format (ODF) standard. 
The full disclaimer details can be found at http://www.csir.co.za/disclaimer.html.

This message has been scanned for viruses and dangerous content by MailScanner, 
and is believed to be clean.  MailScanner thanks Transtec Computers for their support.


From Roger.Bivand at nhh.no  Fri Aug 14 12:58:05 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 14 Aug 2009 12:58:05 +0200 (CEST)
Subject: [R-sig-Geo] writeOGR unknown data type
In-Reply-To: <4A8556EA.8E2F.0073.0@csir.co.za>
References: <4A8556EA.8E2F.0073.0@csir.co.za>
Message-ID: <alpine.LRH.2.00.0908141249490.2375@reclus.nhh.no>

On Fri, 14 Aug 2009, Wesley Roberts wrote:

> Dear r-sig-geo,
>
> I am having trouble exporting an sp object created in R using writeOGR. Below is the code I am using, basically it creates a regular grid to cover a point data set opened using readShapePoints. I then convert the spatialpoints to polygons and then finally to a SpatialPolygonsDataFrame. I would now like to export this sp data set as a shapefile so that I can add some attributes to it. Unfortunately I receive the following error each time I try to run the export,
>
>> poly<-readShapePoints("Poly_one_pts.shp", proj4string=CRS("+proj=tmerc +south +ellips=WGS84 +datum=WGS84 +lon_o=31 +k_0=1 +units=m +no_defs"))
>> grd<-spsample(poly,cellsize=c(4,4),type="regular")
>> grd<-as(as(as(grd,"SpatialPixels"),"SpatialPolygons"),"SpatialPolygonsDataFrame")

Coersion can be fun, but don't overdo it without checking. Thr output 
object is a SpatialPolygonsDataFrame object, but has an empty data frame 
in the data slot (actually, this coersion needs blocking, or changing to 
prevent the problem):

library(rgdal)
scot_BNG <- readOGR(system.file("vectors", package = "rgdal")[1],
   "scot_BNG")
grd<-spsample(scot_BNG, cellsize=c(40000, 40000), type="regular")
grd1 <- as(grd,"SpatialPixels")
grd2 <- as(grd1, "SpatialPolygons")
grd3 <- as(grd2, "SpatialPolygonsDataFrame")
str(grd3, max.level=2)

Try:

df <- data.frame(FID=row.names(grd2), row.names=row.names(grd2))
grd3 <- SpatialPolygonsDataFrame(grd2, data=df)
str(grd3, max.level=2)

Hope this helps,

Roger


>> tp<-tempdir()
>> writeOGR(grd,tp,"grd",driver="ESRI Shapefile",verbose = FALSE)
> Error in writeOGR(grd, tp, "grd", driver = "ESRI Shapefile", verbose = FALSE) :
>  NULL NULL unknown data type
>
>
> An export of poly runs fine but it seems when I try to export grd it is an unknown data type. Both classes seem to be similar and writeOGR should be able to export both data sets.
>
>> class(poly)
> [1] "SpatialPointsDataFrame"
> attr(,"package")
> [1] "sp"
>> class(grd)
> [1] "SpatialPolygonsDataFrame"
> attr(,"package")
> [1] "sp"
>
>
> Any help on this issue would be greatly appreciated.
> Many thanks and kind regards,
> Wesley
>
> Wesley Roberts MSc.
> Researcher: Earth Observation
> Natural Resources & the Environment (NRE)
> CSIR
> Tel: +27 (0)21 888-2490
> Fax: +27 (0)21 888-2693
> "To know the road ahead, ask those coming back."
> - Chinese proverb
>
>
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From aruiz at eeza.csic.es  Fri Aug 14 14:17:23 2009
From: aruiz at eeza.csic.es (Alberto Ruiz Moreno)
Date: Fri, 14 Aug 2009 14:17:23 +0200
Subject: [R-sig-Geo] GDAL problem writing Idrisi format
Message-ID: <6841F63430B4D24688A7A64A071886387671886600@MBOX.eeza.csic.es>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090814/72ebf7a6/attachment.pl>

From a.ghisla at gmail.com  Fri Aug 14 15:33:29 2009
From: a.ghisla at gmail.com (Anne Ghisla)
Date: Fri, 14 Aug 2009 15:33:29 +0200
Subject: [R-sig-Geo] [Report #12 - end SoC] Kriging with GRASS and R:
 v.autokrige port to wxPython and more
Message-ID: <4A8567A9.1080000@gmail.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hello all and sorry for cross-posting,

this is last SoC report - bringing variogram plotting into v.krige!
After a long time searching for the lightest and cleanest
implementation, R plotting raised as the best solution. On user demand,
a R graphics window plots variogram and refreshes it, without
interfering with wxGUI.
Documentation includes a full example using Spearfish dataset and all
informations about dependencies.

Many thanks to all who have helped me writing v.krige: GRASS and R
developers, OSGeo SoC crew, wise friends, all testers.
I hope this module will attract people towards GRASS and R, and provide
a valid alternative to closed-source kriging tools.

best regards,

Anne
- --



-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.9 (MingW32)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/

iEYEARECAAYFAkqFZ6gACgkQzZ3g4YwFFgZa0wCfX6PXr2Jk746TohFzvRbk1DiP
iZcAmwc13YIECWcsN118iSVfYYdHhBsk
=buEX
-----END PGP SIGNATURE-----


From Roger.Bivand at nhh.no  Fri Aug 14 15:47:46 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 14 Aug 2009 15:47:46 +0200 (CEST)
Subject: [R-sig-Geo] GDAL problem writing Idrisi format
In-Reply-To: <6841F63430B4D24688A7A64A071886387671886600@MBOX.eeza.csic.es>
References: <6841F63430B4D24688A7A64A071886387671886600@MBOX.eeza.csic.es>
Message-ID: <alpine.LRH.2.00.0908141542390.2375@reclus.nhh.no>

On Fri, 14 Aug 2009, Alberto Ruiz Moreno wrote:

> I get the error
>
> GDAL Error 4: `C:\DOCUME~1\Temp\Rtmplib5Gm\file5f906952' not recognised as a supported file format.
>
> When a try to write a SpatialGridDataframe as Idrisi A.1 raster format
>
>> x <- readGDAL(system.file("external/test.ag", package="sp")[1])
>
> C:/ARCHIV~1/R/R-29~1.1/library/sp/external/test.ag has GDAL driver AAIGrid
> and has 115 rows and 80 columns
>
>> writeGDAL(x,'test.tiff',drivername='GTiff')
>
> That?s OK but..
>
>> writeGDAL(x,'test.rst',drivername='RST')
> Error en .local(.Object, ...) :
>        GDAL Error 4: `C:\DOCUME~1\ARUIZ~1.EEZ\CONFIG~1\Temp\Rtmplib5Gm\file5f906952' not recognised as a supported file format.

This particular driver is written requiring that all files used must use 
the *.rst extension for the raw image file. writeGDAL() creates a file 
corresponding to the required GDAL dataset in the R temporary folder with 
a temporary name with no extension, so when the correctly constructed file 
is being opened, the attempt error exits, because the file extension is 
wrong.

I'll try to find a workaround in the next release of rgdal (after the one 
on its way to CRAN now). I'll try it on you first, if that's OK - 
apparently the driver also likes having environment variable IDRISIDIR set 
pointing to your installed Idrisi.

Roger


>
>> summary(x)
> Object of class SpatialGridDataFrame
> Coordinates:
>     min    max
> x 178400 181600
> y 329400 334000
> Is projected: NA
> proj4string : [NA]
> Number of points: 2
> Grid attributes:
>  cellcentre.offset cellsize cells.dim
> x            178420       40        80
> y            329420       40       115
> Data attributes:
>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's
>  128.4   293.2   371.4   423.2   499.8  1806.0  6097.0
>
>> version
>               _
> platform       i386-pc-mingw32
> arch           i386
> os             mingw32
> system         i386, mingw32
> status
> major          2
> minor          9.1
> year           2009
> month          06
> day            26
> svn rev        48839
> language       R
> version.string R version 2.9.1 (2009-06-26)
>
> Thank for any comment...
>
>
>
>
> -----------------------------------------------
> A  l  b  e  r  t  o     R  u  i  z    M  o  r  e  n  o
> Dept.   Desertificaci?n   y   Geoecolog?a
> Estaci?n  Expermental de  Zonas ?ridas
> EEZA - CSIC                     Almer?a - Espa?a
> ----------------------------------------------
>                   www.eeza.csic.es
> -----------------------------------------------
>
>
> 	[[alternative HTML version deleted]]
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From b.rowlingson at lancaster.ac.uk  Fri Aug 14 15:51:24 2009
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Fri, 14 Aug 2009 14:51:24 +0100
Subject: [R-sig-Geo] Writing PNG files with rgdal
Message-ID: <d8ad40b50908140651g447636cembfc812d4a5cb3396@mail.gmail.com>

I'm wondering if there's an easy way to write PNG files from a matrix?

I've got an NxM matrix of values, z, and I want to produce an NxM
pixel PNG file. I have a function pfunc(.) that converts values to
colours.

So currently I do this:

  library(rtiff)
  library(rgdal)
  z = matrix(runif(100),10,10)
  pfunc=colorRamp(c("blue","yellow"))

  tiffPath = "foo.tif"
  pngPath = "foo.png"

# get the rgb colours:
  rgb = pfunc(t(z)[ncol(z):1,])

# as a pixmapRGB
  rgbpixmap = pixmapRGB(c(rgb[,1],rgb[,2],rgb[,3]),ncol(z),nrow(z))

# save as a tiff (require(rtiff) package)
  writeTiff(rgbpixmap,tiffPath)

# now read in using rgdal and copy, since GDAL PNG driver doesn't have
a 'create' call:
  xp=GDAL.open(tiffPath)
  xx=copyDataset(xp,driver="PNG")
  saveDataset(xx,pngPath)
  GDAL.close(xx)
  GDAL.close(xp)

# we don't need this:
  file.remove(tiffPath)

But it seems a bit kludgy. I know its not really a 'geo' question, but
it seems that rgdal might have a better way to do this that I've not
hit on yet. Any ideas (short of system("convert foo.tif foo.png")). Or
is my solution as elegant as it can be?

Barry


From rebecca.ross at plants.ox.ac.uk  Sun Aug 16 13:20:38 2009
From: rebecca.ross at plants.ox.ac.uk (Rebecca Ross)
Date: Sun, 16 Aug 2009 12:20:38 +0100
Subject: [R-sig-Geo] Overlay bubble chart on map
Message-ID: <20090816112039.06E3A4C007@webmail222.herald.ox.ac.uk>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090816/2d7cab6d/attachment.pl>

From b.rowlingson at lancaster.ac.uk  Sun Aug 16 13:59:59 2009
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Sun, 16 Aug 2009 12:59:59 +0100
Subject: [R-sig-Geo] Overlay bubble chart on map
In-Reply-To: <20090816112039.06E3A4C007@webmail222.herald.ox.ac.uk>
References: <20090816112039.06E3A4C007@webmail222.herald.ox.ac.uk>
Message-ID: <d8ad40b50908160459q3766baaci584aa1dc31ad5b4f@mail.gmail.com>

On Sun, Aug 16, 2009 at 12:20 PM, Rebecca
Ross<rebecca.ross at plants.ox.ac.uk> wrote:
>
> Dear All,
>
> I am new to this list, so apologies if this question has been asked and
> answered many times before!
>
> I would like to overlay a bubble chart onto a map so that the bubbles
> correspond to particular points on the map. I have the shape file for the map
> and the lat long co-ordinates for the points. Could anyone tell me how to put
> the two together? The suggestions I found so far are plot.Map and plot.Spatial,
> neither of which work.
>
> I am working to a bit of a deadline, so a response today would be really
> helpful.

To read foo.shp:

install.packages("rgdal")

require(rgdal)
map = readOGR("/path/to/maps/","foo")
plot(map)

then you can do:

points(p$x,p$y)

 or whatever to overlay on it. If a 'bubble chart' is just points
scaled by some factor, you can either use the 'symbols' function in R
or use pch and cex options to plot - with something like:

p = data.frame(x=1:10,y=1:10,size=1:10)
plot(p$x,p$y,pch=19,cex=p$size)

 hope that helps!

Barry


From hengl at spatial-analyst.net  Sun Aug 16 16:26:22 2009
From: hengl at spatial-analyst.net (Tomislav Hengl)
Date: Sun, 16 Aug 2009 16:26:22 +0200 (CEST)
Subject: [R-sig-Geo] A working draft of lecture notes "A Practical Guide to
 Geostatistical Mapping"
Message-ID: <54471.86.80.191.132.1250432782.squirrel@spatial-analyst.net>


Dear R-sig-geo,


I have just finished with updating the second edition of my lecture notes
that I have used over years for the GEOSTAT summer schools for PhD
students.

A copy of the working draft can be obtained here:

http://spatial-analyst.net/book/

I would like to invite you to read selected chapters (and review the
attached R scripts) and then post comments via the editorial system
(please read the "instructions for reviewers" first!). As a reward for
your effort, I plan to send some 80 free copies to the most active
reviewers (based on the web traffic), so please also make sure you enter a
correct mailing address.

FYI all datasets used in this book have been put on-line:

http://spatial-analyst.net/DATA/
http://spatial-analyst.net/worldmaps/

I sincerely plan to keep this publication of open access. This was a
difficult decision, because open access inevitably carries a risk of lower
quality and lower confidence in what is said. Hopefully, you will also see
the benefits of open access publishing and help me improve this book by
sending me your comments and suggestions. This way it will reach some
minimum quality standards that will make us both happy.


cheers,

T. Hengl


From hengl at spatial-analyst.net  Sun Aug 16 16:31:55 2009
From: hengl at spatial-analyst.net (Tomislav Hengl)
Date: Sun, 16 Aug 2009 16:31:55 +0200 (CEST)
Subject: [R-sig-Geo] Overlay bubble chart on map
In-Reply-To: <d8ad40b50908160459q3766baaci584aa1dc31ad5b4f@mail.gmail.com>
References: <20090816112039.06E3A4C007@webmail222.herald.ox.ac.uk>
	<d8ad40b50908160459q3766baaci584aa1dc31ad5b4f@mail.gmail.com>
Message-ID: <54589.86.80.191.132.1250433115.squirrel@spatial-analyst.net>


Here is another example with overlay from the Reimann et al. (2008) book
(this uses a raster map as background - this if often more impressive):

http://www.statistik.tuwien.ac.at/StatDA/R-scripts/page151.html

The code is rather long, but it will give you good ideas what you have to do.

HTH

T. Hengl

> On Sun, Aug 16, 2009 at 12:20 PM, Rebecca
> Ross<rebecca.ross at plants.ox.ac.uk> wrote:
>>
>> Dear All,
>>
>> I am new to this list, so apologies if this question has been asked and
>> answered many times before!
>>
>> I would like to overlay a bubble chart onto a map so that the bubbles
>> correspond to particular points on the map. I have the shape file for
>> the map
>> and the lat long co-ordinates for the points. Could anyone tell me how
>> to put
>> the two together? The suggestions I found so far are plot.Map and
>> plot.Spatial,
>> neither of which work.
>>
>> I am working to a bit of a deadline, so a response today would be really
>> helpful.
>
> To read foo.shp:
>
> install.packages("rgdal")
>
> require(rgdal)
> map = readOGR("/path/to/maps/","foo")
> plot(map)
>
> then you can do:
>
> points(p$x,p$y)
>
>  or whatever to overlay on it. If a 'bubble chart' is just points
> scaled by some factor, you can either use the 'symbols' function in R
> or use pch and cex options to plot - with something like:
>
> p = data.frame(x=1:10,y=1:10,size=1:10)
> plot(p$x,p$y,pch=19,cex=p$size)
>
>  hope that helps!
>
> Barry
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From marco.helbich at gmx.at  Mon Aug 17 08:22:52 2009
From: marco.helbich at gmx.at (Marco Helbich)
Date: Mon, 17 Aug 2009 08:22:52 +0200
Subject: [R-sig-Geo] kernel density mean value for superimposed polygon
Message-ID: <20090817062252.23240@gmx.net>

Hello,

I am sorry to post this question a second time, but I still got no solution. My starting point are the local densities from a kernel density estimation (my object called k1) using the splancs package, now I want to calculate the mean value for every superimposed polygon (called tsids). The example code below should help to reproduce my question.

Any help would be greatly appreciated!!!

Thanks and kind regards
Marco

-----------

library(rgdal); library(splancs); library(sp); 
library(maptools); library(gpclib)

# test data + window study site
sids <- readOGR(system.file("shapes/sids.shp", package = "maptools"), "sids")
crs <- CRS("+proj=longlat +datum=NAD27")
proj4string(sids) <- crs
plot(sids)
ncrs <- CRS("+proj=utm +zone=18 +datum=NAD27")
tsids <- spTransform(sids, ncrs)
plot(tsids)
win <- unionSpatialPolygons(tsids, rep("x", length(slot(tsids, "polygons"))))
proj4string(win) <- ncrs
tcoord <- cbind(coordinates(tsids)[,1], coordinates(tsids)[,2])
tpoi <- SpatialPoints(tcoord)
proj4string(tpoi) <- ncrs
plot(win)
plot(tpoi, add=T)
# define splancs objects
tpoi.pts <- as.points(coordinates(tpoi))
win.pol = as.points(list(x=win at polygons[[1]]@Polygons[[1]]@coords[,1],
  y=win at polygons[[1]]@Polygons[[1]]@coords[,2]))

# define grid, bandwith for kernel density estimation
pixs <- 15000
dimx <- ceiling(abs((bbox(win)[1,1] - bbox(win)[1,2])/pixs))
dimy <- ceiling(abs((bbox(win)[2,1] - bbox(win)[2,2])/pixs))
grd <- GridTopology(cellcentre.offset=c(bbox(win)[1,1], bbox(win)[2,1]),
  cellsize=c(pixs, pixs), cells.dim=c(dimx,dimy))
summary(grd)

# kernel density estimation
kde <- spkernel2d(tpoi.pts, win.pol, 2000, grd)
kdf <- data.frame(k0=kde)
k <- SpatialGridDataFrame(grd, data=kdf)
spplot(k, sp.layout = list(list("sp.polygons", tsids)))
k1 <- as(k, "SpatialPointsDataFrame")
k1[["x"]] <- coordinates(k1)[,1]
k1[["y"]] <- coordinates(k1)[,2]

# the following part shows my problem: how can i aggregate the kernel estimations (using the mean) for every polygon in the tsids object? using the overlay function: overlay(k1, tsids, fn = mean) ?

-- 
Jetzt kostenlos herunterladen: Internet Explorer 8 und Mozilla Firefox 3 -
sicherer, schneller und einfacher! http://portal.gmx.net/de/go/chbrowser


From Roger.Bivand at nhh.no  Mon Aug 17 09:22:58 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 17 Aug 2009 09:22:58 +0200 (CEST)
Subject: [R-sig-Geo] Overlay bubble chart on map
In-Reply-To: <20090816112039.06E3A4C007@webmail222.herald.ox.ac.uk>
References: <20090816112039.06E3A4C007@webmail222.herald.ox.ac.uk>
Message-ID: <alpine.LRH.2.00.0908170905030.16834@reclus.nhh.no>

On Sun, 16 Aug 2009, Rebecca Ross wrote:

>
> Dear All,
>
> I am new to this list, so apologies if this question has been asked and
> answered many times before!
>
> I would like to overlay a bubble chart onto a map so that the bubbles
> correspond to particular points on the map. I have the shape file for the map
> and the lat long co-ordinates for the points. Could anyone tell me how to put
> the two together? The suggestions I found so far are plot.Map and plot.Spatial,
> neither of which work.
>
> I am working to a bit of a deadline, so a response today would be really
> helpful.

If your shapefile data are lines, read them as a SpatialLinesDataFrame 
object (readOGR() in rgdal) - if polygons as a SpatialPolygonsDataFrame 
object (same function) and coerce to SpatialLines, then use the sp.layout= 
argument in the bubble() function in sp - this argument is documented on 
the help page to spplot() methods in sp:

dsn <- system.file("vectors", package = "rgdal")[1]
scot_BNG <- readOGR(dsn, "scot_BNG")
# using the data in the shapefile as an example
pts <- as(scot_BNG, "data.frame")
# coercing to a SpatialPointsDataFrame
coordinates(pts) <- c("X_COOR", "Y_COOR")
# coercing the polygon outlines to a SpatialLines object
spl <- list("sp.lines", as(scot_BNG, "SpatialLines"))
# simple bubble plot, see ?bubble for other alternatives
bubble(pts, "SMR", sp.layout=spl)

The sp package contains class definitions for classes to contain spatial 
data, and has methods for coercion and plotting, using both base graphics, 
and, as here, lattice graphics. The first hit on:

RSiteSearch("bubble plot")

is to the help page for bubble() in sp.

Hope this helps,

Roger


>
> Thank you,
>
> Rebecca
>
> (rebecca.ross at plants.ox.ac.uk)
>
> ----- End of forwarded message from Rebecca Ross
> <rebecca.ross at queens.ox.ac.uk> -----
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From Michael.Haenlein at whu.edu  Mon Aug 17 13:32:27 2009
From: Michael.Haenlein at whu.edu (Haenlein, Michael)
Date: Mon, 17 Aug 2009 13:32:27 +0200
Subject: [R-sig-Geo] Question spdep package - Moran's I
Message-ID: <FCE3439777D52842B1D4831921FCA0D18515819D5E@EXIDEFIX01.whu.edu>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090817/200f881d/attachment.pl>

From Roger.Bivand at nhh.no  Mon Aug 17 14:14:12 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 17 Aug 2009 14:14:12 +0200 (CEST)
Subject: [R-sig-Geo] Writing PNG files with rgdal
In-Reply-To: <d8ad40b50908140651g447636cembfc812d4a5cb3396@mail.gmail.com>
References: <d8ad40b50908140651g447636cembfc812d4a5cb3396@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.0908171359490.16834@reclus.nhh.no>

On Fri, 14 Aug 2009, Barry Rowlingson wrote:

> I'm wondering if there's an easy way to write PNG files from a matrix?
>
> I've got an NxM matrix of values, z, and I want to produce an NxM
> pixel PNG file. I have a function pfunc(.) that converts values to
> colours.
>
> So currently I do this:
>
>  library(rtiff)
>  library(rgdal)
>  z = matrix(runif(100),10,10)
>  pfunc=colorRamp(c("blue","yellow"))
>
>  tiffPath = "foo.tif"
>  pngPath = "foo.png"
>
> # get the rgb colours:
>  rgb = pfunc(t(z)[ncol(z):1,])
>
> # as a pixmapRGB
>  rgbpixmap = pixmapRGB(c(rgb[,1],rgb[,2],rgb[,3]),ncol(z),nrow(z))
>
> # save as a tiff (require(rtiff) package)
>  writeTiff(rgbpixmap,tiffPath)
>
> # now read in using rgdal and copy, since GDAL PNG driver doesn't have
> a 'create' call:
>  xp=GDAL.open(tiffPath)
>  xx=copyDataset(xp,driver="PNG")
>  saveDataset(xx,pngPath)
>  GDAL.close(xx)
>  GDAL.close(xp)
>
> # we don't need this:
>  file.remove(tiffPath)
>
> But it seems a bit kludgy. I know its not really a 'geo' question, but
> it seems that rgdal might have a better way to do this that I've not
> hit on yet. Any ideas (short of system("convert foo.tif foo.png")). Or
> is my solution as elegant as it can be?

rgdal 0.6-14 (now on sourceforge as source, on its way to CRAN) tries to 
detect whether the driver chosen by the user is one of those flagged as 
not supporting direct creation but supporting GDAL dataset copying, 
including the "PNG" driver. When writeGDAL() sees such a driver, it will 
now write to a temporary dataset (defualt driver "GTiff"), and copy from 
that to the desired file. Using:

GT <- GridTopology(c(0.5, 0.5), c(1, 1), c(10, 10))
set.seed(1)
SGDF <- SpatialGridDataFrame(GT, data=data.frame(z=runif(100)))
opar <- par(mfrow=c(2,2), mar=c(1,1,4,1))
image(SGDF, "z", col=colorRampPalette(c("blue", "yellow"))(20))
title(main="input values")
pfunc <- colorRamp(c("blue","yellow"))
RGB <- pfunc(SGDF$z)
SGDF$red <- RGB[,1]
SGDF$green <- RGB[,2]
SGDF$blue <- RGB[,3]
image(SGDF, red="red", green="green", blue="blue")
title(main="input RGB")
#
# to set up the data for export,
#
tf <- tempfile()
writeGDAL(SGDF[c("red", "green", "blue")], tf, type="Byte",
   drivername="PNG")
#
# will now write the PNG file. Reading in to check gives:
#
t1 <- readGDAL(tf)
image(t1, red=1, green=2, blue=3)
title(main="output PNG RGB")
par(opar)

I know that this is a "geo" answer, but getting the NxM matrix into an 
object that writeGDAL() can export shouldn't be too hard, by first 
defining the GridTopology object, then reshaping the matrix to suit. 
Looking at ?as.image.SpatialGridDataFrame and the code for this function 
may help, as well as image2Grid, to get the right incantation.

Roger

>
> Barry
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From Roger.Bivand at nhh.no  Tue Aug 18 10:37:47 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 18 Aug 2009 10:37:47 +0200 (CEST)
Subject: [R-sig-Geo] Question spdep package - Moran's I
In-Reply-To: <6ABEC29B60534494887ED77999D889F9@MichaelPC>
References: <FCE3439777D52842B1D4831921FCA0D18515819D5E@EXIDEFIX01.whu.edu>
	<alpine.LRH.2.00.0908171421050.16834@reclus.nhh.no>
	<71D1B468282A492ABC025B7CA8E53B5F@MichaelPC>
	<alpine.LRH.2.00.0908171606490.16834@reclus.nhh.no><8CBBF88726C143A1940F8038AF8DE68F@MichaelPC>
	<alpine.LRH.2.00.0908171820580.16834@reclus.nhh.no>
	<6ABEC29B60534494887ED77999D889F9@MichaelPC>
Message-ID: <alpine.LRH.2.00.0908181028280.21131@reclus.nhh.no>

On Tue, 18 Aug 2009, Michael Haenlein wrote:

> Dear Roger,
>
> As you suggested, I transformed my network using listw2U(...) prior to
> running the errorsarlm(...) model and this time it worked fine!
> I did the analysis a couple of times using different definitions of
> proximity and independent variables and the results make sense overall:
>
> Lambda: 0.84064 LR test value: 588.13 p-value: < 2.22e-16
> Lambda: 0.074582 LR test value: 1075.5 p-value: < 2.22e-16
> Lambda: 0.21073 LR test value: 133.26 p-value: < 2.22e-16
>
> Lambda: 0.83978 LR test value: 586.29 p-value: < 2.22e-16
> Lambda: 0.074612 LR test value: 1074.4 p-value: < 2.22e-16
> Lambda: 0.20948 LR test value: 131.68 p-value: < 2.22e-16
>
> Yet, (unfortunately) another problem came up in the meantime. I tried to
> apply the same procedure to test for autocorrelation in another network I'm
> working with which is substantially larger than the first one:
>
> Number of regions: 19668
> Number of nonzero links: 51598
> Percentage nonzero weights: 0.01333867
> Average number of links: 2.623449
> Non-symmetric neighbours list
>
> Again, I applied listw2U(...) and this worked fine resulting in:
>
> Number of regions: 19668
> Number of nonzero links: 32934
> Percentage nonzero weights: 0.008513813
> Average number of links: 1.674497
>
> But when I tried to use errorsarlm(...) in the same way as before I get the
> error message:
> "Error in as_dsTMatrix_listw(listw) : ncard2 incorrectly given"
>
> As I said, the approach I took is exactly the same. Both networks are
> sampled out of a much larger network, it's just that the second network uses
> a different sampling approach and has more regions. So I assume that the
> error message is due to the larger network size.
>
> Is there any chance to work around this problem?
> Should I probably use "spam" instead of "Matrix"?
> Or is errorsarlm(...) simply just not suited to analyze networks of such
> size?

Dear Michael,

There is another implementation of errorsarlm(), called spautolm(). Could 
you try that? "Matrix" is prefered to "spam", and ongoing development is 
with the authors of the now recommended Matrix package. In spautolm(), 
some tricks that they put together are used. If you still run into 
problems, I'd be interested in trying to run the analyses with your data 
and weights, to see what may need fixing, as handling larger data sets is 
not fully settled at all, very much still work in progress.

We know how to do it in theory, and the results are OK, but there are 
wrinkles that need navigating. When the number of observations gets very 
large, there is also the issue of ensuring homogeneity (so spautolm() has 
a weights= argument; it was written to match the development of spatial 
regression in Waller & Gotway (2004)).

Best wishes,

Roger

>
> Thanks very much for your help,
>
> Best,
>
> Michael
>
>
>
> -----Original Message-----
> From: Roger Bivand [mailto:Roger.Bivand at nhh.no]
> Sent: Montag, 17. August 2009 18:27
> To: Michael Haenlein
> Cc: r-sig-geo at stat.math.ethz.ch
> Subject: RE: [R-sig-Geo] Question spdep package - Moran's I
>
> The message from the Matrix method was correct, spam ought not to have tried
> to continue, I guess it is failing and lambda is ending up at the end of its
> interval.
>
> The spatial weights must be symmetric or similar to symmetric for spatial
> regression fitting. The Jacobian is found by a sparse Cholesky
> decomposition, which means that W must be symmetric. listw2U() should get
> you there, I should have spotted the problem before. You may also need to
> play with the interval= argument.
>
> Let me know how it goes.
>
> Roger
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From WRoberts at csir.co.za  Tue Aug 18 10:32:04 2009
From: WRoberts at csir.co.za (Wesley Roberts)
Date: Tue, 18 Aug 2009 10:32:04 +0200
Subject: [R-sig-Geo] Advice on clustering LiDAR point clouds
Message-ID: <4A8A8324.8E2F.0073.0@csir.co.za>

Dear R-sig-Geo,

I am currently looking at clustering a LiDAR point cloud (trees in a plantation forest) using R and have some questions that I hope some of you may be able to answer. 

My method is a two stage approach, firstly I selected potential tree locations by overlaying a static grid on the point data and selecting the maximum value within each grid. These locations were stored as potential tree locations and have been used as sample data in a spatial clustering approach (I would have liked to use a moving filter but could not find a local maximum approach implemented in R). These points and the original data are now being clustered using the clus algorithm in the spatclus package.

My query regards the use of an algorithm developed for disease mapping (Kuldorff's circular zone in 2D) with Lidar data. The density of the lidar points is around 5 per square meter and I am concerned that the algorithm will not be able to identify clusters based on height. I am yet to inspect the results as the clus algorithm is still running so I cant comment on that right now, but I was wondering if anyone on the list had any suggestions wrt the clustering and or segmentation of lidar point clouds using R. I am unwilling to use interpolation as I want to avoid the lengthy process of selecting the correct interpolation procedure and or model and would like to stick with the point cloud.

Any advice on this matter would be greatly appreciated.
Many thanks and kind regards,

Wesley


Wesley Roberts MSc.
Researcher: Earth Observation
Natural Resources & the Environment (NRE)
CSIR
Tel: +27 (0)21 888-2490
Fax: +27 (0)21 888-2693
"To know the road ahead, ask those coming back."
- Chinese proverb



-- 
This message is subject to the CSIR's copyright terms and conditions, e-mail legal notice, and implemented Open Document Format (ODF) standard. 
The full disclaimer details can be found at http://www.csir.co.za/disclaimer.html.

This message has been scanned for viruses and dangerous content by MailScanner, 
and is believed to be clean.  MailScanner thanks Transtec Computers for their support.


From Roger.Bivand at nhh.no  Mon Aug 17 18:27:09 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 17 Aug 2009 18:27:09 +0200 (CEST)
Subject: [R-sig-Geo] Question spdep package - Moran's I
In-Reply-To: <8CBBF88726C143A1940F8038AF8DE68F@MichaelPC>
References: <FCE3439777D52842B1D4831921FCA0D18515819D5E@EXIDEFIX01.whu.edu>
	<alpine.LRH.2.00.0908171421050.16834@reclus.nhh.no>
	<71D1B468282A492ABC025B7CA8E53B5F@MichaelPC>
	<alpine.LRH.2.00.0908171606490.16834@reclus.nhh.no>
	<8CBBF88726C143A1940F8038AF8DE68F@MichaelPC>
Message-ID: <alpine.LRH.2.00.0908171820580.16834@reclus.nhh.no>

On Mon, 17 Aug 2009, Michael Haenlein wrote:

> Dear Roger,
>
> Thanks again for your help!
>
> Based on your recommendations, I switched to errorsarlm.
> Again, method="eigen" resulted in the error message "Error: cannot allocate
> vector of size 340.5 Mb" - but I expected that.
>
> I then tried method="Matrix" and got another error message:
> "Non-symmetric neighbours list
> Error in as_dsTMatrix_listw(listw) : not a symmetric matrix"
>
> Finally I tried method="spam" and got a series of error messages:
> "Error in stop("insufficient space for sparse matrix addition") : no
> function to return from, jumping to top level
> In addition: Warning message: In optimize(sar.error.f.sp, interval =
> interval, maximum = TRUE,  :   NA/Inf replaced by maximum positive value"
>
> Although I got a whole bunch of these messages my model converged to a
> solution, but it does not feel right as Lambda is essentially 1 and I don't
> get a log likelihood:

The message from the Matrix method was correct, spam ought not to have 
tried to continue, I guess it is failing and lambda is ending up at the 
end of its interval.

The spatial weights must be symmetric or similar to symmetric for spatial 
regression fitting. The Jacobian is found by a sparse Cholesky 
decomposition, which means that W must be symmetric. listw2U() should get 
you there, I should have spotted the problem before. You may also need to 
play with the interval= argument.

Let me know how it goes.

Roger

>
> Call: errorsarlm(formula = y ~ Gender, data = Michael_dat, listw =
> Network_01, method = "spam")
> Type: error
>
> Coefficients:
>     lambda (Intercept)     GenderM    GenderND     GenderU
> 0.99899996  3.86318643  0.11191533 -0.08194235 -0.55121204
>
> Log likelihood: NA
>
> I really feel bad about asking you again.
> I will try to make my network symmetrical and hope that this will solve the
> error in the method="Matrix" option.
> Where the other errors in method="spam" are concerned, I honestly don't have
> a clue where the issue might be.
> If you could point me to any direction where I might have made a mistake,
> I'd appreciate it a lot.
>
> Thanks again very, very much for your help,
>
> Best,
>
> Michael
>
>
>
> -----Original Message-----
> From: Roger Bivand [mailto:Roger.Bivand at nhh.no]
> Sent: Montag, 17. August 2009 16:20
> To: Michael Haenlein
> Cc: Haenlein, Michael; r-sig-geo at stat.math.ethz.ch
> Subject: RE: [R-sig-Geo] Question spdep package - Moran's I
>
> On Mon, 17 Aug 2009, Michael Haenlein wrote:
>
>> Dear Roger,
>>
>> Thanks very much for your reply!
>>
>> I think what the reviewer is referring to is a lagsarlm() model --
>> thanks very much for bringing this functionality to my attention!
>>
>> I just tried to fit such a model but I get an error message: "Error:
>> Cannot allocate vector of size 340.5 MB".
>>
>> I assume this is because my network is very large:
>> Number of regions: 6681
>> Number of nonzero links: 39770
>> Percentage nonzero weights: 0.08909896 Average number of links:
>> 5.952702 Non-symmetric neighbours list
>>
>
> ?larsarlm and see method="Matrix". lagsarlm() is not the same model as
> errorsarlm(). It will also run slowly in the sparse matrix version; I
> suggest using errorsarlm() which does include the spatial autocorrelation
> of the error in the model, rather than the spatial autocorrelation of the
> dependent variable, so is better aligned with what lm.morantest() was
> testing. Both will give likelihood ratio tests of the significance of the
> spatial coefficient, but lagsarlm() only gives LR tests of the
> coefficients on the x, while with errorsarlm(), you get more-or-less
> regular t-tests (they are z-tests because the coefficient standard errors
> are the asymptotic ones).
>
> Unless you have a substantive hypothesis for how y_i affects y_j
> irrespective of the x variables, errorsalm() may be a safer fallback,
> because it is only saying that there is some residual autocorrelation in
> the aspatial model, and that is what gets modelled.
>
> Best wishes,
>
> Roger
>
>>
>> I'm working on Lenovo Thinkpad (X300) with Windows Vista Business, SP 2
> and
>> 2.00 GB RAM.
>> Would you know whether there is any chance to run this model without
>> upgrading my RAM?
>> My current memory.limit() in R is 1535 which seems as far as I can get
> with
>> 2.00 GB RAM.
>> Otherwise I might need to find someone with a more powerful machine than
>> mine.
>>
>> Thanks very much again for having pointed me towards lagsarlm()!
>>
>> Best,
>>
>> Michael
>>
>>
>>
>> -----Original Message-----
>> From: Roger Bivand [mailto:Roger.Bivand at nhh.no]
>> Sent: Montag, 17. August 2009 14:30
>> To: Haenlein, Michael
>> Cc: r-sig-geo at stat.math.ethz.ch
>> Subject: Re: [R-sig-Geo] Question spdep package - Moran's I
>>
>> On Mon, 17 Aug 2009, Haenlein, Michael wrote:
>>
>>
>> If the referee is refering to the social networks literature, you will
> have
>> to find out what "one step" means there, if anything.
>> It is not a term used in connection with Moran's I for spatial data.
>>
>> If you believe that the referee's "one step" might be met by fitting a
> model
>> including both the x variables and the dependence in either y or the
>> residuals of the regression, look at lagsarlm() and errorsarlm(). Maybe
>> check against the Ward/Gleditsch "Spatial regression models" Sage volume
> if
>> need be.
>>
>> When working across disciplines, nothing constitutes absolute authority in
>> this way. Testing residuals ought to be OK, but see Schabenberger & Gotway
>> for caveats (especially about concluding that autocorrelation is present
>> when the real problem is model misspecification).
>>
>> Hope this helps,
>>
>> Roger
>>
>>
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From Roger.Bivand at nhh.no  Mon Aug 17 14:17:27 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 17 Aug 2009 14:17:27 +0200 (CEST)
Subject: [R-sig-Geo] GDAL problem writing Idrisi format
In-Reply-To: <alpine.LRH.2.00.0908141542390.2375@reclus.nhh.no>
References: <6841F63430B4D24688A7A64A071886387671886600@MBOX.eeza.csic.es>
	<alpine.LRH.2.00.0908141542390.2375@reclus.nhh.no>
Message-ID: <alpine.LRH.2.00.0908171415530.16834@reclus.nhh.no>

On Fri, 14 Aug 2009, Roger Bivand wrote:

> On Fri, 14 Aug 2009, Alberto Ruiz Moreno wrote:
>
>> I get the error
>> 
>> GDAL Error 4: `C:\DOCUME~1\Temp\Rtmplib5Gm\file5f906952' not recognised as 
>> a supported file format.
>> 
>> When a try to write a SpatialGridDataframe as Idrisi A.1 raster format
>> 
>>> x <- readGDAL(system.file("external/test.ag", package="sp")[1])
>> 
>> C:/ARCHIV~1/R/R-29~1.1/library/sp/external/test.ag has GDAL driver AAIGrid
>> and has 115 rows and 80 columns
>> 
>>> writeGDAL(x,'test.tiff',drivername='GTiff')
>> 
>> That?s OK but..
>> 
>>> writeGDAL(x,'test.rst',drivername='RST')
>> Error en .local(.Object, ...) :
>>        GDAL Error 4: 
>> `C:\DOCUME~1\ARUIZ~1.EEZ\CONFIG~1\Temp\Rtmplib5Gm\file5f906952' not 
>> recognised as a supported file format.
>
> This particular driver is written requiring that all files used must use the 
> *.rst extension for the raw image file. writeGDAL() creates a file 
> corresponding to the required GDAL dataset in the R temporary folder with a 
> temporary name with no extension, so when the correctly constructed file is 
> being opened, the attempt error exits, because the file extension is wrong.
>
> I'll try to find a workaround in the next release of rgdal (after the one on 
> its way to CRAN now). I'll try it on you first, if that's OK - apparently the 
> driver also likes having environment variable IDRISIDIR set pointing to your 
> installed Idrisi.

The fix for the RST driver will be in 0.6-14 which has just been submitted 
to CRAN. The RST driver requires that the coordinate reference system of 
the dataset is specified.

Roger

>
> Roger
>
>
>> 
>>> summary(x)
>> Object of class SpatialGridDataFrame
>> Coordinates:
>>     min    max
>> x 178400 181600
>> y 329400 334000
>> Is projected: NA
>> proj4string : [NA]
>> Number of points: 2
>> Grid attributes:
>>  cellcentre.offset cellsize cells.dim
>> x            178420       40        80
>> y            329420       40       115
>> Data attributes:
>>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's
>>  128.4   293.2   371.4   423.2   499.8  1806.0  6097.0
>> 
>>> version
>>               _
>> platform       i386-pc-mingw32
>> arch           i386
>> os             mingw32
>> system         i386, mingw32
>> status
>> major          2
>> minor          9.1
>> year           2009
>> month          06
>> day            26
>> svn rev        48839
>> language       R
>> version.string R version 2.9.1 (2009-06-26)
>> 
>> Thank for any comment...
>> 
>> 
>> 
>> 
>> -----------------------------------------------
>> A  l  b  e  r  t  o     R  u  i  z    M  o  r  e  n  o
>> Dept.   Desertificaci?n   y   Geoecolog?a
>> Estaci?n  Expermental de  Zonas ?ridas
>> EEZA - CSIC                     Almer?a - Espa?a
>> ----------------------------------------------
>>                   www.eeza.csic.es
>> -----------------------------------------------
>> 
>>
>> 	[[alternative HTML version deleted]]
>> 
>> 
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From Roger.Bivand at nhh.no  Mon Aug 17 16:19:49 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 17 Aug 2009 16:19:49 +0200 (CEST)
Subject: [R-sig-Geo] Question spdep package - Moran's I
In-Reply-To: <71D1B468282A492ABC025B7CA8E53B5F@MichaelPC>
References: <FCE3439777D52842B1D4831921FCA0D18515819D5E@EXIDEFIX01.whu.edu>
	<alpine.LRH.2.00.0908171421050.16834@reclus.nhh.no>
	<71D1B468282A492ABC025B7CA8E53B5F@MichaelPC>
Message-ID: <alpine.LRH.2.00.0908171606490.16834@reclus.nhh.no>

On Mon, 17 Aug 2009, Michael Haenlein wrote:

> Dear Roger,
>
> Thanks very much for your reply!
>
> I think what the reviewer is referring to is a lagsarlm() model -- thanks
> very much for bringing this functionality to my attention!
>
> I just tried to fit such a model but I get an error message: "Error: Cannot
> allocate vector of size 340.5 MB".
>
> I assume this is because my network is very large:
> Number of regions: 6681
> Number of nonzero links: 39770
> Percentage nonzero weights: 0.08909896
> Average number of links: 5.952702
> Non-symmetric neighbours list
>

?larsarlm and see method="Matrix". lagsarlm() is not the same model as 
errorsarlm(). It will also run slowly in the sparse matrix version; I 
suggest using errorsarlm() which does include the spatial autocorrelation 
of the error in the model, rather than the spatial autocorrelation of the 
dependent variable, so is better aligned with what lm.morantest() was 
testing. Both will give likelihood ratio tests of the significance of the 
spatial coefficient, but lagsarlm() only gives LR tests of the 
coefficients on the x, while with errorsarlm(), you get more-or-less 
regular t-tests (they are z-tests because the coefficient standard errors 
are the asymptotic ones).

Unless you have a substantive hypothesis for how y_i affects y_j 
irrespective of the x variables, errorsalm() may be a safer fallback, 
because it is only saying that there is some residual autocorrelation in 
the aspatial model, and that is what gets modelled.

Best wishes,

Roger

>
> I'm working on Lenovo Thinkpad (X300) with Windows Vista Business, SP 2 and
> 2.00 GB RAM.
> Would you know whether there is any chance to run this model without
> upgrading my RAM?
> My current memory.limit() in R is 1535 which seems as far as I can get with
> 2.00 GB RAM.
> Otherwise I might need to find someone with a more powerful machine than
> mine.
>
> Thanks very much again for having pointed me towards lagsarlm()!
>
> Best,
>
> Michael
>
>
>
> -----Original Message-----
> From: Roger Bivand [mailto:Roger.Bivand at nhh.no]
> Sent: Montag, 17. August 2009 14:30
> To: Haenlein, Michael
> Cc: r-sig-geo at stat.math.ethz.ch
> Subject: Re: [R-sig-Geo] Question spdep package - Moran's I
>
> On Mon, 17 Aug 2009, Haenlein, Michael wrote:
>
>
> If the referee is refering to the social networks literature, you will have
> to find out what "one step" means there, if anything.
> It is not a term used in connection with Moran's I for spatial data.
>
> If you believe that the referee's "one step" might be met by fitting a model
> including both the x variables and the dependence in either y or the
> residuals of the regression, look at lagsarlm() and errorsarlm(). Maybe
> check against the Ward/Gleditsch "Spatial regression models" Sage volume if
> need be.
>
> When working across disciplines, nothing constitutes absolute authority in
> this way. Testing residuals ought to be OK, but see Schabenberger & Gotway
> for caveats (especially about concluding that autocorrelation is present
> when the real problem is model misspecification).
>
> Hope this helps,
>
> Roger
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From Roger.Bivand at nhh.no  Mon Aug 17 14:29:59 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 17 Aug 2009 14:29:59 +0200 (CEST)
Subject: [R-sig-Geo] Question spdep package - Moran's I
In-Reply-To: <FCE3439777D52842B1D4831921FCA0D18515819D5E@EXIDEFIX01.whu.edu>
References: <FCE3439777D52842B1D4831921FCA0D18515819D5E@EXIDEFIX01.whu.edu>
Message-ID: <alpine.LRH.2.00.0908171421050.16834@reclus.nhh.no>

On Mon, 17 Aug 2009, Haenlein, Michael wrote:

> Dear all,
>
> I have a question regarding the spdep package:
>
> Assume that each person within my dataset is characterized by a 
> continuous variable y. In order to test for spatial autocorrelation in y 
> I calculated a Moran's I statistic. The problem is that y is also likely 
> to be influenced by a series of other variables x that are unique to 
> each person in my dataset. To test to which extent the autocorrelation 
> effect is present even when accounting for the effect of x, I first did 
> a regression y = f(x) + Epsilon and then used the regression residuals 
> Epsilon to determine a Moran's I statistic using the lm.morantest 
> function. One of the reviewers of my paper now states that this two step 
> approach (first running a regression and then using the residuals to 
> determine Moran's I) could be inefficient. S/he asks me to correct for 
> the potential impact of x on y in one step when calculating Moran's I.

If the referee is refering to the social networks literature, you will 
have to find out what "one step" means there, if anything. It is not a 
term used in connection with Moran's I for spatial data.

>
> Would anyone happen to know any other way of doing what I'd like to do 
> that only requires one step?

If you believe that the referee's "one step" might be met by fitting a 
model including both the x variables and the dependence in either y or the 
residuals of the regression, look at lagsarlm() and errorsarlm(). Maybe 
check against the Ward/Gleditsch "Spatial regression models" Sage volume 
if need be.

>
> Or could you please provide me with a source I could quote that states 
> that this two-step approach is fine from a statistical perspective?
>

When working across disciplines, nothing constitutes absolute authority in 
this way. Testing residuals ought to be OK, but see Schabenberger & Gotway 
for caveats (especially about concluding that autocorrelation is present 
when the real problem is model misspecification).


Hope this helps,

Roger

> Thanks very much for your help in advance,
>
>
>
> Regards,
>
>
>
> Michael
>
>
>
>
>
> Michael Haenlein
> Professor of Marketing
> ESCP Europe - The School of Management for Europe
> 79, Avenue de la R??publique??|??75011 Paris??| France
>
> 	[[alternative HTML version deleted]]

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From Ivan.Soenario at knmi.nl  Tue Aug 18 17:43:48 2009
From: Ivan.Soenario at knmi.nl (Soenario, Ivan (KNMI))
Date: Tue, 18 Aug 2009 17:43:48 +0200
Subject: [R-sig-Geo] daily precipitation idw & kriging and beginner questions
Message-ID: <631152A1D26F5540B73896D2C649DCFA01A7F989@BCSXTC.knmi.nl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090818/31cdfa77/attachment.pl>

From mwkhan at ucdavis.edu  Tue Aug 18 20:36:26 2009
From: mwkhan at ucdavis.edu (Mehdi Khan)
Date: Tue, 18 Aug 2009 11:36:26 -0700
Subject: [R-sig-Geo] Adjusting axis on strip plot
Message-ID: <60b3892e0908181136s6f050f10r903936b64792f9f3@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090818/6f59ac19/attachment.pl>

From etiennebr at gmail.com  Tue Aug 18 21:13:49 2009
From: etiennebr at gmail.com (Etienne Bellemare Racine)
Date: Tue, 18 Aug 2009 15:13:49 -0400
Subject: [R-sig-Geo] Advice on clustering LiDAR point clouds
In-Reply-To: <4A8A8324.8E2F.0073.0@csir.co.za>
References: <4A8A8324.8E2F.0073.0@csir.co.za>
Message-ID: <4A8AFD6D.2040604@gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090818/5f6aad18/attachment.pl>

From debeaudette at ucdavis.edu  Tue Aug 18 21:33:49 2009
From: debeaudette at ucdavis.edu (Dylan Beaudette)
Date: Tue, 18 Aug 2009 12:33:49 -0700
Subject: [R-sig-Geo] Advice on clustering LiDAR point clouds
In-Reply-To: <4A8AFD6D.2040604@gmail.com>
References: <4A8A8324.8E2F.0073.0@csir.co.za> <4A8AFD6D.2040604@gmail.com>
Message-ID: <200908181233.49753.dylan.beaudette@gmail.com>

On Tuesday 18 August 2009, Etienne Bellemare Racine wrote:
> Hi Wesley,
>
> It is unclear to me if you want to aggregate points to distinguish
> individual tree, or if you want to locate the treetops ?
>
> Anyway, I suggest you first use your grid to locate treetops (using
> maximum value as you said), then clustering using the treetops. Is your
> plantation dense ? because if the crowns are touching each other, I
> think it will be pretty hard to cluster them using only points. If you
> have treetops, you can aggregate points around individuals treetops.
>
> To get maximum values, maybe sp::overlay can get you started, but I
> think it is more to get grid value to point than reverse. I do it in
> ArcGIS, but I would be happy to have a solution in R if you find one.
>
> Etienne

Also see r.in.xyz within GRASS GIS.

Dylan

>
> Wesley Roberts a ?crit :
> > Dear R-sig-Geo,
> >
> > I am currently looking at clustering a LiDAR point cloud (trees in a
> > plantation forest) using R and have some questions that I hope some of
> > you may be able to answer.
> >
> > My method is a two stage approach, firstly I selected potential tree
> > locations by overlaying a static grid on the point data and selecting the
> > maximum value within each grid. These locations were stored as potential
> > tree locations and have been used as sample data in a spatial clustering
> > approach (I would have liked to use a moving filter but could not find a
> > local maximum approach implemented in R). These points and the original
> > data are now being clustered using the clus algorithm in the spatclus
> > package.
> >
> > My query regards the use of an algorithm developed for disease mapping
> > (Kuldorff's circular zone in 2D) with Lidar data. The density of the
> > lidar points is around 5 per square meter and I am concerned that the
> > algorithm will not be able to identify clusters based on height. I am yet
> > to inspect the results as the clus algorithm is still running so I cant
> > comment on that right now, but I was wondering if anyone on the list had
> > any suggestions wrt the clustering and or segmentation of lidar point
> > clouds using R. I am unwilling to use interpolation as I want to avoid
> > the lengthy process of selecting the correct interpolation procedure and
> > or model and would like to stick with the point cloud.
> >
> > Any advice on this matter would be greatly appreciated.
> > Many thanks and kind regards,
> >
> > Wesley
> >
> >
> > Wesley Roberts MSc.
> > Researcher: Earth Observation
> > Natural Resources & the Environment (NRE)
> > CSIR
> > Tel: +27 (0)21 888-2490
> > Fax: +27 (0)21 888-2693
> > "To know the road ahead, ask those coming back."
> > - Chinese proverb
>
> 	[[alternative HTML version deleted]]



-- 
Dylan Beaudette
Soil Resource Laboratory
http://casoilresource.lawr.ucdavis.edu/
University of California at Davis
530.754.7341


From edzer.pebesma at uni-muenster.de  Tue Aug 18 22:42:54 2009
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Tue, 18 Aug 2009 22:42:54 +0200
Subject: [R-sig-Geo] daily precipitation idw & kriging and beginner
	questions
In-Reply-To: <631152A1D26F5540B73896D2C649DCFA01A7F989@BCSXTC.knmi.nl>
References: <631152A1D26F5540B73896D2C649DCFA01A7F989@BCSXTC.knmi.nl>
Message-ID: <4A8B124E.4040209@uni-muenster.de>

Hi Ivan,

Soenario, Ivan (KNMI) wrote:
>   
>> Pd.idw <- krige(as.formula(kol), Pd200001, nl.grd)
>>     
>
> [inverse distance weighted interpolation]
>   
There is also the equivalent

Pd.idw <- idw(as.formula(kol), Pd200001, nl.grd)

where the function does what it's named after.
> Warning message:
>
> In points2grid(points, tolerance, round, fuzz.tol) :
>
>   grid has empty column/rows in dimension 2
>   
It means that you have a grid with empty (missing valued) rows and/or
columns. Ignore it.
>  
>
>   
>> spplot(Pd.idw, "var1.pred")
>>     
>
> Warning message:
>
> In data.row.names(row.names, rowsi, i) :
>
>   some row.names duplicated: 2,3,4,5,6,7,8,9,10,
>   
This would not worry me.
>
>
> Question 2
>
> I use 2 different plotting techniques, which makes the images hard to
> compare. At this stage I do not need real map data for further analysis,
> just some jpegs to quickly compare the results. How can I plot the idw's
> and de krige results the same way? They are of different class.
>   
Save the results to a single object, and use spplot to plot in a single
plot. Untried:

Pd.idw$idw = Pd.idw$var1.pred
Pd.idw$ok = Pd.kri$krige_output$var1.pred
spplot(Pd.idw, c("idw", "ok"))

>  
>
> Question 3
>
> automapPlot(plot_data, zcol, col.regions, ...)
>
> The ... is intriguing: "Arguments that are passed on to spplot." This is
> also the case for many R functions, which makes R very flexible, but for
> a beginner this seems endlessly layered. For instance, I would like to
> create my own colour ramp, in either image(), plot() or spplot(). But I
> can't figure it out. Is it also possible to reverse the standard ramps
> heat.colors, topo.colors etc?
>   
yes,  just use col.regions. E.g. col.regions = bpy.colors()

I will ignore your comments on ... , as you will start appreciating it
the day you start writing functions in R. Looking where you are now,
this should be within a few weeks.
>  
>
> Question 4
>
> After the jpg is written to HD, I remove the objects Pd.idw and Pd.kri.
> Need I do this, or is the object overwritten anyway, at the start of the
> next loop? 
It gets overwritten.
> Also, is there another method to deal with the results, for
> instance can I create an object Pd.idw.many which contains all of the 31
> interpolated maps? This would be convenient for further R processing.
>   
Yes, by giving each of the output variables a different name, just as I
did above.

Best wishes,

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763 http://ifgi.uni-muenster.de/
http://www.springer.com/978-0-387-78170-9 e.pebesma at wwu.de


From WRoberts at csir.co.za  Wed Aug 19 08:22:32 2009
From: WRoberts at csir.co.za (Wesley Roberts)
Date: Wed, 19 Aug 2009 08:22:32 +0200
Subject: [R-sig-Geo] Advice on clustering LiDAR point clouds
In-Reply-To: <200908181233.49753.dylan.beaudette@gmail.com>
References: <4A8A8324.8E2F.0073.0@csir.co.za> <4A8AFD6D.2040604@gmail.com>
	<200908181233.49753.dylan.beaudette@gmail.com>
Message-ID: <4A8BB647.8E2F.0073.0@csir.co.za>

Dylan & Etienne,

Many thanks for your suggestions, I am looking for tree location as part of a tree counting analysis in a plantation forest. The espacement of the trees is 2,5 m (within rows) by 3 m (between rows) so the plantation is fairly dense. clus from the spatclus package did not turn out to be a useful approach for my application as it only ever found one cluster. I thought of iteratively feeding it the single tree tops with the population data (all points) but it didnt seem to like that and would not run with only the one data point. In the end I have used ArcGIS to create TINS and then rasters which I will analyse in eCognition. Applications in R seem very specific and I don't have the experience in R to adapt them to my application, still I like R and will use it where I can in the future.

Regards,
Wesley

>>> Dylan Beaudette <debeaudette at ucdavis.edu> 18/08/2009 21:33 >>>
On Tuesday 18 August 2009, Etienne Bellemare Racine wrote:
> Hi Wesley,
>
> It is unclear to me if you want to aggregate points to distinguish
> individual tree, or if you want to locate the treetops ?
>
> Anyway, I suggest you first use your grid to locate treetops (using
> maximum value as you said), then clustering using the treetops. Is your
> plantation dense ? because if the crowns are touching each other, I
> think it will be pretty hard to cluster them using only points. If you
> have treetops, you can aggregate points around individuals treetops.
>
> To get maximum values, maybe sp::overlay can get you started, but I
> think it is more to get grid value to point than reverse. I do it in
> ArcGIS, but I would be happy to have a solution in R if you find one.
>
> Etienne

Also see r.in.xyz within GRASS GIS.

Dylan

>
> Wesley Roberts a crit :
> > Dear R-sig-Geo,
> >
> > I am currently looking at clustering a LiDAR point cloud (trees in a
> > plantation forest) using R and have some questions that I hope some of
> > you may be able to answer.
> >
> > My method is a two stage approach, firstly I selected potential tree
> > locations by overlaying a static grid on the point data and selecting the
> > maximum value within each grid. These locations were stored as potential
> > tree locations and have been used as sample data in a spatial clustering
> > approach (I would have liked to use a moving filter but could not find a
> > local maximum approach implemented in R). These points and the original
> > data are now being clustered using the clus algorithm in the spatclus
> > package.
> >
> > My query regards the use of an algorithm developed for disease mapping
> > (Kuldorff's circular zone in 2D) with Lidar data. The density of the
> > lidar points is around 5 per square meter and I am concerned that the
> > algorithm will not be able to identify clusters based on height. I am yet
> > to inspect the results as the clus algorithm is still running so I cant
> > comment on that right now, but I was wondering if anyone on the list had
> > any suggestions wrt the clustering and or segmentation of lidar point
> > clouds using R. I am unwilling to use interpolation as I want to avoid
> > the lengthy process of selecting the correct interpolation procedure and
> > or model and would like to stick with the point cloud.
> >
> > Any advice on this matter would be greatly appreciated.
> > Many thanks and kind regards,
> >
> > Wesley
> >
> >
> > Wesley Roberts MSc.
> > Researcher: Earth Observation
> > Natural Resources & the Environment (NRE)
> > CSIR
> > Tel: +27 (0)21 888-2490
> > Fax: +27 (0)21 888-2693
> > "To know the road ahead, ask those coming back."
> > - Chinese proverb
>
> 	[[alternative HTML version deleted]]



-- 
Dylan Beaudette
Soil Resource Laboratory
http://casoilresource.lawr.ucdavis.edu/ 
University of California at Davis
530.754.7341



-- 
This message is subject to the CSIR's copyright terms and conditions, e-mail legal notice, and implemented Open Document Format (ODF) standard. 
The full disclaimer details can be found at http://www.csir.co.za/disclaimer.html.

This message has been scanned for viruses and dangerous content by MailScanner, 
and is believed to be clean.  MailScanner thanks Transtec Computers for their support.


From h.greatrex at reading.ac.uk  Wed Aug 19 12:56:33 2009
From: h.greatrex at reading.ac.uk (Helen Greatrex)
Date: Wed, 19 Aug 2009 11:56:33 +0100
Subject: [R-sig-Geo] Daily precipitation kriging
Message-ID: <4A8BDA61.5090309@reading.ac.uk>

Hi Ivan,

I think I have an answer to your problem. Maybe you're getting the 
errors because you're inputting data at more than one time step into the 
kriging process?

Also there might be a slightly more elegant way of approaching the 
situation.

Normally, you would krige at one point in time -(i.e. the structure of 
gold ore doesn't change over time) However, unless you have an extremely 
dense raingauge network, you're not going to obtain a reasonable 
variogram doing this for daily rainfall. Also it's reasonable to assume 
that rainfall on different days has the same spatial structure over a 
short enough time period (i.e. all the days in January). So you can pool 
the data together and make a 'January' variogram and krige using that.

At Reading, we do this through using a climatological variogram. 
Basically, you 'normalise' each day's rainfall by dividing through by 
the total daily variance to create the variogram, then at the end of the 
kriging process you remultiply each day's estimate to give you final 
estimates. The method is explained more briefly in Teo & Grimes, 
"Stochastic Modelling of rainfall from satellite data", J. Hydrology 
346, 2007. We also have another publication on 'Geostatistical analysis 
of rainfall' which has just been accepted for publication in a special 
edition of Geographical Analysis on ?Geostatistical Methods in 
Geography', which should explain the process in detail.

I've created a set of self contained R scripts to do the entire process 
(plus an extensive user manual which should explain things further). 
I'll send it to you as a separate e-mail to stop large attachments 
getting sent to everyone on the list.

I'm aware this e-mail hasn't answered your specific coding problems, but 
I hope it helps!
Best wishes
Helen







-- 
-----------------------------
Helen Greatrex (PhD Student)
Room 1U09
Department of Meteorology
University of Reading
Earley Gate
PO Box 243
READING
RG6 6BB


From tom.gottfried at wzw.tum.de  Wed Aug 19 14:53:45 2009
From: tom.gottfried at wzw.tum.de (Tom Gottfried)
Date: Wed, 19 Aug 2009 14:53:45 +0200
Subject: [R-sig-Geo] daily precipitation idw & kriging and
	beginner	questions
In-Reply-To: <4A8B124E.4040209@uni-muenster.de>
References: <4A8B124E.4040209@uni-muenster.de>
Message-ID: <4A8BF5D9.6090404@wzw.tum.de>

Hi Ivan,

> I use a for-loop to go through the columns (the days) and each loop
> performs an idw and autokrige interpolation, plots images and saves them
> as jpg to hard disk.
...
> Also, is there another method to deal with the results, for
> instance can I create an object Pd.idw.many which contains all of the 31
> interpolated maps? This would be convenient for further R processing.
>
You could consider replacing the for-loop by calls to lapply/mapply. This way the objects
representing one day are held as elements of a single list.

Try the following (with x representing your initial dataset as a data.frame and foo.* your own
functions doing the interpolation/plotting, thus more or less the code from your loop put in a few
functions):

idw.list <- lapply(x, foo.idw) # gives a list with each element representing the map of one day
ok.list <- lapply(x, foo.ok)
plots <- mapply(foo.plotting, idw.list, ok.list) # gives one plot per day, with foo.plotting using
spplot as Edzer suggested for example

For writing your own functions consider the respective chapter in the "Introduction to R" you find
in the build-in help (use help.start() for example).

regards,
Tom


From etiennebr at gmail.com  Wed Aug 19 15:45:43 2009
From: etiennebr at gmail.com (Etienne Bellemare Racine)
Date: Wed, 19 Aug 2009 09:45:43 -0400
Subject: [R-sig-Geo] Advice on clustering LiDAR point clouds
In-Reply-To: <4A8BB647.8E2F.0073.0@csir.co.za>
References: <4A8A8324.8E2F.0073.0@csir.co.za>
	<4A8AFD6D.2040604@gmail.com>	<200908181233.49753.dylan.beaudette@gmail.com>
	<4A8BB647.8E2F.0073.0@csir.co.za>
Message-ID: <4A8C0207.1020103@gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090819/6c903573/attachment.pl>

From alexandre.villers at cebc.cnrs.fr  Wed Aug 19 16:20:02 2009
From: alexandre.villers at cebc.cnrs.fr (Alexandre VILLERS)
Date: Wed, 19 Aug 2009 16:20:02 +0200
Subject: [R-sig-Geo] silly question on quadratcount in spatstat ?
Message-ID: <4A8C0A12.9040003@cebc.cnrs.fr>

Goodafternoon,

I did not find anything in the archives though I'm not sure I didn't 
miss it. If we use this

library(spatstat)
data(humberside)
plot(humberside)
qH <- quadratcount(humberside, 5, 5)
plot(qH, add=TRUE, col="blue", cex=1.5, lwd=2)

There is obviously something wrong with the display of the count and I 
was wondering if this was somehow related to the following question
qH gives a contingency table of counts on a 5 * 5 grid but there are 
only 20 cells lying inside the owin. Why do we get value for cells 
outside our observation window ?  I'm sure there is a way of getting a 
vector for the cells observed it but I couldn't figure how. Is the 
display problem related to this issue ?

Thanks for any hint

Alex

P.S.: I wanted to thank A. Baddeley and R. Turner for the spatstat 
package and all the people helping with the development of spatial 
analysis with R. We (users) always come with problems or questions on 
the list but most of the time, everything works fine and we don't write 
to the R SIG GEO for that !

-- 
Alexandre Villers
PhD Student
Team "Biodiversity"
Centre d'Etudes Biologiques de Chiz?-CNRS UPR1934
79360 Beauvoir sur Niort

Phone +33 (0)5 49 09 96 13
Fax   +33 (0)5 49 09 65 26




__________ Information from ESET Mail Security, version of virus signature database 4348 (20090819) __________

The message was checked by ESET Mail Security.
http://www.eset.com


From p.hiemstra at geo.uu.nl  Wed Aug 19 16:22:32 2009
From: p.hiemstra at geo.uu.nl (Paul Hiemstra)
Date: Wed, 19 Aug 2009 16:22:32 +0200
Subject: [R-sig-Geo] daily precipitation idw & kriging and beginner
	questions
In-Reply-To: <631152A1D26F5540B73896D2C649DCFA01A7F989@BCSXTC.knmi.nl>
References: <631152A1D26F5540B73896D2C649DCFA01A7F989@BCSXTC.knmi.nl>
Message-ID: <4A8C0AA8.9070307@geo.uu.nl>

Hi Ivan,

An interesting paper in this regard is:

Schuurmans, J.; Bierkens, M.; Pebesma, E. & Uijlenhoet, R. Automatic 
prediction of high-resolution daily rainfall fields for multiple 
extents: The potential of operational radar Journal of Hydrometeorology, 
2007, 8, 1204-1224

You are working at the KNMI, so you should be able to get a hold of the 
radar imagery for that day. I know that the author of the paper did all 
the work in R.

cheers,
Paul

Soenario, Ivan (KNMI) wrote:
> Hello experts,
>
>  
>
> Here's another novice to R. Hope you can help me out. Apologies in
> advance if questions have been asked before (in which case, could you
> tell me the thread).
>
>  
>
> My dataset is a table with daily Precipitation for the month January in
> 2000, measured at more than 300 weather stations. Each row is a weather
> station and there are 31 columns (or should I say attribute), each day
> it's own column.
>
>  
>
> I use a for-loop to go through the columns (the days) and each loop
> performs an idw and autokrige interpolation, plots images and saves them
> as jpg to hard disk.
>
>  
>
> Here's the script:
>
>  
>
> Pd200001 <- read.table(paste(wordir, "/Input/", sep=""), sep=("\t"),
> header = TRUE)
>
> coordinates(Pd200001) = ~RD_LOCATION_X + RD_LOCATION_Y
>
> nl.grd <- read.asciigrid(paste(wordir, "/Input/nl_clip_1km.asc",
> sep=("")), as.image=FALSE, plot.image=TRUE)
>
>  
>
> for (i in 1:31) {
>
> kol <- paste(names(Pd200001[i+2]), "~1", sep="")     # first two columns
> are id and stationnr 
>
>  
>
> # INVERSE DISTANCE
>
> Pd.idw <- krige(as.formula(kol), Pd200001, nl.grd)
>
> image(Pd.idw["var1.pred"], col = topo.colors(20))
>
> title(paste("Pd_idw", 20000100+i, sep = ""))
>
> dev.copy(jpeg, file = paste( wordir, "/img/Pd_idw_", 20000100+i, ".jpg",
> sep = ""), height = 17, width = 17, units = "cm", quality = 100,
> res=150, bg="white") ; dev.off()
>
> rm(Pd.idw)
>
>  
>
> # ORDINARY KRIGING
>
> Pd.kri <- autoKrige(as.formula(kol), Pd200001, nl.grd)
>
> plot(Pd.kri)
>
> dev.copy(jpeg, file = paste( wordir, "/img/Pd_kri_", 20000100+i, ".jpg",
> sep = ""), height = 17, width = 17, units = "cm", quality = 100,
> res=150, bg="white") ; dev.off()
>
> rm(Pd.idw)
>
> }
>
>  
>
> The loop works and I get images in files but I also get Warning
> Messages, both after interpolation and after plot().
>
>  
>
>   
>> Pd.idw <- krige(as.formula(kol), Pd200001, nl.grd)
>>     
>
> [inverse distance weighted interpolation]
>
> Warning message:
>
> In points2grid(points, tolerance, round, fuzz.tol) :
>
>   grid has empty column/rows in dimension 2
>
>  
>
>   
>> spplot(Pd.idw, "var1.pred")
>>     
>
> Warning message:
>
> In data.row.names(row.names, rowsi, i) :
>
>   some row.names duplicated: 2,3,4,5,6,7,8,9,10,
>
>  
>
> Question 1
>
> How "bad" are the Warning Messages, how should I prevent them
>
>  
>
> Question 2
>
> I use 2 different plotting techniques, which makes the images hard to
> compare. At this stage I do not need real map data for further analysis,
> just some jpegs to quickly compare the results. How can I plot the idw's
> and de krige results the same way? They are of different class.
>
>  
>
> Question 3
>
> automapPlot(plot_data, zcol, col.regions, ...)
>
> The ... is intriguing: "Arguments that are passed on to spplot." This is
> also the case for many R functions, which makes R very flexible, but for
> a beginner this seems endlessly layered. For instance, I would like to
> create my own colour ramp, in either image(), plot() or spplot(). But I
> can't figure it out. Is it also possible to reverse the standard ramps
> heat.colors, topo.colors etc?
>
>  
>
> Question 4
>
> After the jpg is written to HD, I remove the objects Pd.idw and Pd.kri.
> Need I do this, or is the object overwritten anyway, at the start of the
> next loop? Also, is there another method to deal with the results, for
> instance can I create an object Pd.idw.many which contains all of the 31
> interpolated maps? This would be convenient for further R processing.
>
>  
>
> Many thanks in advance!
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>   


-- 
Drs. Paul Hiemstra
Department of Physical Geography
Faculty of Geosciences
University of Utrecht
Heidelberglaan 2
P.O. Box 80.115
3508 TC Utrecht
Phone:  +3130 274 3113 Mon-Tue
Phone:  +3130 253 5773 Wed-Fri
http://intamap.geo.uu.nl/~paul


From jthomps at fas.harvard.edu  Thu Aug 20 15:58:49 2009
From: jthomps at fas.harvard.edu (Jonathan Thompson)
Date: Thu, 20 Aug 2009 09:58:49 -0400
Subject: [R-sig-Geo] Rgdal and unsigned integers
Message-ID: <4A8D5699.1090506@fas.harvard.edu>

Dear List,

I use a forest landscape model, which produces 16 bit unsigned ".gis" 
raster files. I often read and manipulate them using rgdal and the 
raster package in R.

However, sometimes, when I read in a unsigned 16 bit .gis, I get the 
following:

stnd <- raster("stand_bm.gis", values = T)

summary(stnd)
Cells:  1474962
NAs  :  0

Values             
Min.    -32140
1st Qu.      0
Median       0
Mean      8316
3rd Qu.  19180
Max.     29620


Where are these negative values coming from?   Opening the same file in 
ArcGIS confirms what I know to be true:

Pixel Type  = unsigned integer
Pixel Depth = 16 bit
Min = 0
Max = 48499

Is there anyway to force raster (or RGDAL) to treat it like an unsigned 
integer?

Thank you,
Jonathan Thompson
Harvard Forest
Harvard University
Petersham, MA 01366


From everton.emanuel at gmail.com  Thu Aug 20 17:01:13 2009
From: everton.emanuel at gmail.com (Everton Emanuel)
Date: Thu, 20 Aug 2009 12:01:13 -0300
Subject: [R-sig-Geo] Question concerning the Kulldorff's method
Message-ID: <df06e3df0908200801t13db3052yf8b268ff7b468ae0@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090820/52d68490/attachment.pl>

From everton.emanuel at gmail.com  Thu Aug 20 17:13:55 2009
From: everton.emanuel at gmail.com (Everton Emanuel)
Date: Thu, 20 Aug 2009 12:13:55 -0300
Subject: [R-sig-Geo] Question concerning the Kulldorff's method
In-Reply-To: <df06e3df0908200801t13db3052yf8b268ff7b468ae0@mail.gmail.com>
References: <df06e3df0908200801t13db3052yf8b268ff7b468ae0@mail.gmail.com>
Message-ID: <df06e3df0908200813x47d51465he6bd776e736546bb@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090820/b208d2cc/attachment.pl>

From r.hijmans at gmail.com  Thu Aug 20 18:48:01 2009
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Thu, 20 Aug 2009 09:48:01 -0700
Subject: [R-sig-Geo] Rgdal and unsigned integers
In-Reply-To: <4A8D5699.1090506@fas.harvard.edu>
References: <4A8D5699.1090506@fas.harvard.edu>
Message-ID: <dc22b2570908200948w53215717h386739773c8083d2@mail.gmail.com>

Jonathan,

Do you only get negative values with files that should have values >
32767 ?  If so, that would suggest that the .GIS files are always
interpreted as signed. I believe that values in .GIS are by definition
unsigned (as is common with remote sensing formats), and that there is
no flag for this in the header. I won't speculate where this goes
wrong, but it would be helpful to compare with pure gdal, e.g.
FWTools. Can you make the file available?

For now, I believe you can correct for this :

stnd <- raster("stand_bm.gis", values = T)
stnd[stnd < 0] <- stnd[stnd < 0] + 66535

(only use this for files with 2 byte pixels!)

Robert

On Thu, Aug 20, 2009 at 6:58 AM, Jonathan
Thompson<jthomps at fas.harvard.edu> wrote:
> Dear List,
>
> I use a forest landscape model, which produces 16 bit unsigned ".gis" raster
> files. I often read and manipulate them using rgdal and the raster package
> in R.
>
> However, sometimes, when I read in a unsigned 16 bit .gis, I get the
> following:
>
> stnd <- raster("stand_bm.gis", values = T)
>
> summary(stnd)
> Cells: ?1474962
> NAs ?: ?0
>
> Values ? ? ? ? ? ? Min. ? ?-32140
> 1st Qu. ? ? ?0
> Median ? ? ? 0
> Mean ? ? ?8316
> 3rd Qu. ?19180
> Max. ? ? 29620
>
>
> Where are these negative values coming from? ? Opening the same file in
> ArcGIS confirms what I know to be true:
>
> Pixel Type ?= unsigned integer
> Pixel Depth = 16 bit
> Min = 0
> Max = 48499
>
> Is there anyway to force raster (or RGDAL) to treat it like an unsigned
> integer?
>
> Thank you,
> Jonathan Thompson
> Harvard Forest
> Harvard University
> Petersham, MA 01366
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From b.rowlingson at lancaster.ac.uk  Thu Aug 20 18:48:31 2009
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Thu, 20 Aug 2009 17:48:31 +0100
Subject: [R-sig-Geo] Rgdal and unsigned integers
In-Reply-To: <4A8D5699.1090506@fas.harvard.edu>
References: <4A8D5699.1090506@fas.harvard.edu>
Message-ID: <d8ad40b50908200948q2bd63a92k9ee18137093dc1bd@mail.gmail.com>

On Thu, Aug 20, 2009 at 2:58 PM, Jonathan
Thompson<jthomps at fas.harvard.edu> wrote:
> Dear List,
>
> I use a forest landscape model, which produces 16 bit unsigned ".gis" raster
> files. I often read and manipulate them using rgdal and the raster package
> in R.
>
> However, sometimes, when I read in a unsigned 16 bit .gis, I get the
> following:
>
> stnd <- raster("stand_bm.gis", values = T)
>
> summary(stnd)
> Cells: ?1474962
> NAs ?: ?0
>
> Values ? ? ? ? ? ? Min. ? ?-32140
> 1st Qu. ? ? ?0
> Median ? ? ? 0
> Mean ? ? ?8316
> 3rd Qu. ?19180
> Max. ? ? 29620
>
>
> Where are these negative values coming from? ? Opening the same file in
> ArcGIS confirms what I know to be true:
>
> Pixel Type ?= unsigned integer
> Pixel Depth = 16 bit
> Min = 0
> Max = 48499
>
> Is there anyway to force raster (or RGDAL) to treat it like an unsigned
> integer?

 What are these .gis files? What driver is rgdal using to read them?
For example:

> foo = readGDAL("./Random.png")
./Random.png has GDAL driver PNG
and has 30 rows and 20 columns

> foo = readGDAL("./random.gtiff")
./random.gtiff has GDAL driver GTiff
and has 25 rows and 30 columns

 My rgdal doesn't mention .gis files in its list of drivers that I get
with gdalDrivers()...

 The GDALinfo("foo.png") function might give us some useful info too...

Barry


From b.rowlingson at lancaster.ac.uk  Thu Aug 20 18:54:04 2009
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Thu, 20 Aug 2009 17:54:04 +0100
Subject: [R-sig-Geo] Rgdal and unsigned integers
In-Reply-To: <d8ad40b50908200948q2bd63a92k9ee18137093dc1bd@mail.gmail.com>
References: <4A8D5699.1090506@fas.harvard.edu>
	<d8ad40b50908200948q2bd63a92k9ee18137093dc1bd@mail.gmail.com>
Message-ID: <d8ad40b50908200954j68fdf5e6yedfcc9dd03f7f8f7@mail.gmail.com>

> ?What are these .gis files? What driver is rgdal using to read them?

 Ah, I've just noticed this:

 > gdalDrivers()[38,]
    name       long_name create  copy
 38  LAN Erdas .LAN/.GIS  FALSE FALSE
 >

 The output from GDALinfo will still be interesting, as will the
output from the command line gdalinfo:

$ gdalinfo random.gtiff
Driver: GTiff/GeoTIFF
Size is 30, 25
Coordinate System is `'
Origin = (-2.060000000000000,54.450000000000003)
Pixel Size = (0.120000000000000,-0.100000000000000)
Corner Coordinates:
Upper Left  (  -2.0600000,  54.4500000)
Lower Left  (  -2.0600000,  51.9500000)
Upper Right (   1.5400000,  54.4500000)
Lower Right (   1.5400000,  51.9500000)
Center      (  -0.2600000,  53.2000000)
Band 1 Block=30x25 Type=Float32, ColorInterp=Gray

 - the Band 'Type' is what is useful here. The problem could be in the
underlying gdal library.

Barry


From jthomps at fas.harvard.edu  Thu Aug 20 22:57:21 2009
From: jthomps at fas.harvard.edu (Jonathan Thompson)
Date: Thu, 20 Aug 2009 16:57:21 -0400
Subject: [R-sig-Geo] Rgdal and unsigned integers
Message-ID: <4A8DB8B1.9090401@fas.harvard.edu>

Thank you Barry and Robert

This is all very interesting.   When I use the FWTools Shell and the 
gdalinfo command it says that the Min value is zero (see below) and max 
is 48499. This is different than the summary in Rgdal, which produced 
the negative values.   So I guess the problem is in the Rgdal.

Also, when I try Robert's proposed fix:

stnd <- raster("stand_bm.gis", values = T)
stnd[stnd < 0] <- stnd[stnd < 0] + 66535

It creates an entirely new map (i.e. one with brand new values at the 
high end of the range)

So, I'm still awfully confused.   Any further help would be deeply 
appreciated.

Thanks Jonathan

C:\Program Files\FWTools2.4.2>gdalinfo stand_bm.gis
Driver: LAN/Erdas .LAN/.GIS
Files: c:\landis\harvest_problem\FTT-N_MinT-N\stand_bm.gis
       c:\landis\harvest_problem\FTT-N_MinT-N\stand_bm.gsw
Size is 1758, 839
Coordinate System is:
LOCAL_CS["Unknown",
    UNIT["Meter",1]]
Origin = (33773.261718750000000,945478.062500000000000)
Pixel Size = (100.000000000000000,-100.000000000000000)
Corner Coordinates:
Upper Left  (   33773.262,  945478.063)
Lower Left  (   33773.262,  861578.063)
Upper Right (  209573.262,  945478.063)
Lower Right (  209573.262,  861578.063)
Center      (  121673.262,  903528.063)
Band 1 Block=1758x1 Type=Int16, ColorInterp=Undefined
  Min=0.000 Max=48499.000
  Minimum=0.000, Maximum=48499.000, Mean=12833.830, StdDev=13635.800
  Metadata:
    STATISTICS_MINIMUM=0
    STATISTICS_MAXIMUM=48499
    STATISTICS_MEAN=12833.830260712
    STATISTICS_MEDIAN=8.7254821994872e-239
    STATISTICS_MODE=3.9864100424366e-293
    STATISTICS_STDDEV=13635.800289332
    LAYER_TYPE=thematic


----

On Thu, Aug 20, 2009 at 6:58 AM, Jonathan
Thompson<jtho... at fas.harvard.edu> wrote:
> Dear List,
>
> I use a forest landscape model, which produces 16 bit unsigned ".gis" raster
> files. I often read and manipulate them using rgdal and the raster package
> in R.
>
> However, sometimes, when I read in a unsigned 16 bit .gis, I get the
> following:
>
> stnd <- raster("stand_bm.gis", values = T)
>
> summary(stnd)
> Cells:  1474962
> NAs  :  0
>
> Values             Min.    -32140
> 1st Qu.      0
> Median       0
> Mean      8316
> 3rd Qu.  19180
> Max.     29620
>
>
> Where are these negative values coming from?   Opening the same file in
> ArcGIS confirms what I know to be true:
>
> Pixel Type  = unsigned integer
> Pixel Depth = 16 bit
> Min = 0
> Max = 48499
>
> Is there anyway to force raster (or RGDAL) to treat it like an unsigned
> integer?
>
> Thank you,
> Jonathan Thompson
> Harvard Forest
> Harvard University
> Petersham, MA 01366


From b.rowlingson at lancaster.ac.uk  Thu Aug 20 23:44:49 2009
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Thu, 20 Aug 2009 22:44:49 +0100
Subject: [R-sig-Geo] Rgdal and unsigned integers
In-Reply-To: <4A8DB8B1.9090401@fas.harvard.edu>
References: <4A8DB8B1.9090401@fas.harvard.edu>
Message-ID: <d8ad40b50908201444x53f0ccd8w4ed0cd75369f4293@mail.gmail.com>

On Thu, Aug 20, 2009 at 9:57 PM, Jonathan
Thompson<jthomps at fas.harvard.edu> wrote:

> gdalinfo:
> Band 1 Block=1758x1 Type=Int16, ColorInterp=Undefined
> ?Min=0.000 Max=48499.000

>> Arcgis:
>> Pixel Type ?= unsigned integer
>> Pixel Depth = 16 bit

Arcgis is saying 'unsigned integer' but gdalinfo says 'Int16'. But
then gdalinfo says the max is 48499 - which shouldn't be possible with
(signed) Int16 values (they go from -32k to +32k).

 So something is very odd...

Barry


From Virgilio.Gomez at uclm.es  Fri Aug 21 00:18:54 2009
From: Virgilio.Gomez at uclm.es (Virgilio =?ISO-8859-1?Q?G=F3mez-Rubio?=)
Date: Fri, 21 Aug 2009 00:18:54 +0200
Subject: [R-sig-Geo] Question concerning the Kulldorff's method
In-Reply-To: <df06e3df0908200813x47d51465he6bd776e736546bb@mail.gmail.com>
References: <df06e3df0908200801t13db3052yf8b268ff7b468ae0@mail.gmail.com>
	<df06e3df0908200813x47d51465he6bd776e736546bb@mail.gmail.com>
Message-ID: <1250806734.4893.51.camel@Virgilio-Gomez>

Dear Everton,


> Regarding the rotine that identifies the possible cluster locations, I do
> not know which value should I consider for the fractpop. The spatial
> clustering is very associated to this value and, depending of the considered
> value for the fractpop, I get a different spatial configuration. Is there
> any thumbs rule to define the fractpop?

Not really. I try to keep it within a range of 15-25%. If you have a
very high value of fractpop it is likely that you will test for clusters
with the same configuration of areas and, hence, you will be testing for
the same cluster several times, which is not very efficient.

I have also observed that if the value of fractpop is very high then it
will sometimes find very large clusters (which are difficult to
explain). For smaller values of fractpop, I am able to find smaller
clusters that are nested within that big cluster. Is that what happens
to you too?

Hope this helps.

Virgilio


From r.hijmans at gmail.com  Fri Aug 21 00:52:16 2009
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Thu, 20 Aug 2009 15:52:16 -0700
Subject: [R-sig-Geo] Rgdal and unsigned integers
In-Reply-To: <d8ad40b50908201444x53f0ccd8w4ed0cd75369f4293@mail.gmail.com>
References: <4A8DB8B1.9090401@fas.harvard.edu>
	<d8ad40b50908201444x53f0ccd8w4ed0cd75369f4293@mail.gmail.com>
Message-ID: <dc22b2570908201552k57a9d2b8m5655d3eefc7e218b@mail.gmail.com>

Jonathan,

I used the file you send me. This shows that the problem is already
present in rgdal (i.e. before it gets passed to raster)

> x <- readGDAL("stand_bm.gis")
stand_bm.gis has GDAL driver LAN
and has 839 rows and 1758 columns
> summary(x)
(...)
Data attributes:
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.
 -32140       0       0    8316   19180   29620
>

I opened the file in ArcMap, saved it to a esri grid and read it into R

> stndesri <- raster("esri_stand", values = T)

> stnd <- raster("stand_bm.gis", values = T)

I adjusted the adjustment I send before
> stnd[stnd < 0] <- stnd[stnd < 0] + 65536

and these look good:

> stnd
class       : RasterLayer
filename    :
nrow        : 839
ncol        : 1758
ncells      : 1474962
min value   : 0
max value   : 48499   <--- same is gdal
(...)

the values of the two files are the same:
> dif <- stnd - stndesri

> summary(dif)
Values
Min.    0
1st Qu. 0
Median  0
Mean    0
3rd Qu. 0
Max.    0


The values are still very high in some places, but they should be,
that's what caused the problem to begin with. Whether these high
values are meaningful is another matter; but that could be caused by
LANDIS if that's what you are using.

Apparently something needs to be fixed in rgdal as Barry showed that
gdal gets the right values; it seems somewhere along the line the
INT16 is interpreted as signed, whereas it should be unsigned.

Best,
Robert

On Thu, Aug 20, 2009 at 2:44 PM, Barry
Rowlingson<b.rowlingson at lancaster.ac.uk> wrote:
> On Thu, Aug 20, 2009 at 9:57 PM, Jonathan
> Thompson<jthomps at fas.harvard.edu> wrote:
>
>> gdalinfo:
>> Band 1 Block=1758x1 Type=Int16, ColorInterp=Undefined
>> ?Min=0.000 Max=48499.000
>
>>> Arcgis:
>>> Pixel Type ?= unsigned integer
>>> Pixel Depth = 16 bit
>
> Arcgis is saying 'unsigned integer' but gdalinfo says 'Int16'. But
> then gdalinfo says the max is 48499 - which shouldn't be possible with
> (signed) Int16 values (they go from -32k to +32k).
>
> ?So something is very odd...
>
> Barry
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From marburga at landcareresearch.co.nz  Fri Aug 21 05:39:40 2009
From: marburga at landcareresearch.co.nz (Anna Marburg)
Date: Fri, 21 Aug 2009 15:39:40 +1200
Subject: [R-sig-Geo] silly question on quadratcount in spatstat ?
In-Reply-To: <mailman.17.1250762404.26281.r-sig-geo@stat.math.ethz.ch>
References: <mailman.17.1250762404.26281.r-sig-geo@stat.math.ethz.ch>
Message-ID: <041D3AE0-ABEE-492B-872F-41ABF63D648D@landcareresearch.co.nz>

Dear Alexandre -

Apologies if your question has been answered already, I read r-sig-geo  
as a daily digest.

I'm not sure what is "obviously' wrong with the humberside example.  
Because the observation window is an irregular polygon the quadrats on  
the edge have an irregular shape. Their counts are displayed at the  
center of the largest circle that can be inscribed within them.

Depending on your particular aims, you may wish to exclude quadrats  
that are not completely within the owin. But it's also possible that  
you want to retain all the quadrats. Perhaps a large number of your  
observations are near the edge of the study area (e.g. cities along a  
coastline).

If you do wish to exclude incomplete quadrats, here's some very  
(very!) crude code that will extract the size of each quadrat as well  
as the coordinates quadratcount() uses for it's default labeling.

library(spatstat)
data(humberside)
plot(humberside)

Q <- quadratcount(humberside, 5, 5)
			
tmp <- attr(Q,"tess")		# pull out the definition of the quadrat  
structure
til <- tiles(tmp)			#the definition of the quadrats themselves
incircles <- lapply(til, incircle) #inscribe a circle in each quadrat
#get the x-coord of the center of each circle
x0 <- unlist(lapply(incircles, function(z) { 	z$x	 }))
#get the y-coord of the center of each circle
y0 <- unlist(lapply(incircles, function(z) {  z$y }))
m2 <- unlist(lapply(til, function(x) x[[c(4,1,4)]])) #extract the area  
of each polygon
		
d <- data.frame(x0, y0, Q, m2) #stick it all back together in a  
data.frame
head(d)

As a reminder -  If you're unhappy with the default plotting  
behaviour, just type "plot.quadratcount" (no parentheses!) at the  
prompt to look at the definition of the function, and write a custom  
function that suits your needs.

HTH,

Dr. Anna E.  Marburg

Ecosystem Processes Team
Landcare Research
P O Box 40
Lincoln 7640
NEW ZEALAND

phone + 64  3 321 9729
MarbugA at landcareresearch.co.nz


From Ivan.Soenario at knmi.nl  Fri Aug 21 17:22:46 2009
From: Ivan.Soenario at knmi.nl (Soenario, Ivan (KNMI))
Date: Fri, 21 Aug 2009 17:22:46 +0200
Subject: [R-sig-Geo] daily precipitation idw & kriging
	andbeginner	questions
References: <4A8B124E.4040209@uni-muenster.de> <4A8BF5D9.6090404@wzw.tum.de>
Message-ID: <631152A1D26F5540B73896D2C649DCFA01A7F990@BCSXTC.knmi.nl>

Thanks everyone for the help!

The solutions as proposed by Pebesma & Gottfried got me a little
further. I've replaced the for-loop with:

jan2000_idw <- lapply(1:3, function(i)
idw(as.formula(paste(names(Pd200001[i+2]), "~1", sep="")), Pd200001,
nl.grd))

(Just for first three days, to see if it was working)

And I get an image:
image(jan2000_idw[[1]])

But I don't fully understand Pebesma solution to printing with spplot,
nor Gottfrieds suggestion of mapply.

What I'd like to obtain is 31 images with idw interpolation and 31
images with kriging images, so I can compare them.

plots <- mapply(foo.plotting, jan2000_idw, jan2000_kri)

What should foo.plotting look like?

foo.plotting <- function() {
spplot()
dev.copy(jpg, etc, etc)
dev.off()
}

And what does plots look like? Is it a list with jpg's?

Thanks again

Ivan Soenario



-----Oorspronkelijk bericht-----
Van: r-sig-geo-bounces at stat.math.ethz.ch
[mailto:r-sig-geo-bounces at stat.math.ethz.ch] Namens Tom Gottfried
Verzonden: woensdag 19 augustus 2009 14:54
Aan: r-sig-geo at stat.math.ethz.ch
Onderwerp: Re: [R-sig-Geo] daily precipitation idw & kriging andbeginner
questions

Hi Ivan,

> I use a for-loop to go through the columns (the days) and each loop
> performs an idw and autokrige interpolation, plots images and saves
them
> as jpg to hard disk.
...
> Also, is there another method to deal with the results, for
> instance can I create an object Pd.idw.many which contains all of the
31
> interpolated maps? This would be convenient for further R processing.
>
You could consider replacing the for-loop by calls to lapply/mapply.
This way the objects
representing one day are held as elements of a single list.

Try the following (with x representing your initial dataset as a
data.frame and foo.* your own
functions doing the interpolation/plotting, thus more or less the code
from your loop put in a few
functions):

idw.list <- lapply(x, foo.idw) # gives a list with each element
representing the map of one day
ok.list <- lapply(x, foo.ok)
plots <- mapply(foo.plotting, idw.list, ok.list) # gives one plot per
day, with foo.plotting using
spplot as Edzer suggested for example

For writing your own functions consider the respective chapter in the
"Introduction to R" you find
in the build-in help (use help.start() for example).

regards,
Tom

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at stat.math.ethz.ch
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From edzer.pebesma at uni-muenster.de  Fri Aug 21 17:54:43 2009
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Fri, 21 Aug 2009 17:54:43 +0200
Subject: [R-sig-Geo] daily precipitation idw &
	kriging	andbeginner	questions
In-Reply-To: <631152A1D26F5540B73896D2C649DCFA01A7F990@BCSXTC.knmi.nl>
References: <4A8B124E.4040209@uni-muenster.de> <4A8BF5D9.6090404@wzw.tum.de>
	<631152A1D26F5540B73896D2C649DCFA01A7F990@BCSXTC.knmi.nl>
Message-ID: <4A8EC343.2010109@uni-muenster.de>



Soenario, Ivan (KNMI) wrote:
> What I'd like to obtain is 31 images with idw interpolation and 31
> images with kriging images, so I can compare them.
>   
If I were you, I would want a single image that shows 31 maps, a la
figure 7 of http://r-spatial.sourceforge.net/gallery/

There's many ways to get that, one of them was in my previous email.

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763 http://ifgi.uni-muenster.de/
http://www.springer.com/978-0-387-78170-9 e.pebesma at wwu.de


From mikee at saxicola.idps.co.uk  Fri Aug 21 20:57:42 2009
From: mikee at saxicola.idps.co.uk (Mike Evans)
Date: Fri, 21 Aug 2009 19:57:42 +0100
Subject: [R-sig-Geo] ReadOGR error  Multiple # dimensions:
Message-ID: <200908211957.42809.mikee@saxicola.idps.co.uk>

I would like to read data from postgis database using the command:

aois <-  readOGR("PG:dbname=wales", "aois")

I get the following error:

aois <-  readOGR("PG:dbname=wales", "aois")
Error in ogrInfo(dsn = dsn, layer = layer, input_field_name_encoding = 
input_field_name_encoding) :
  Multiple # dimensions:

I assume I have the syntax correct. Any advise?  I could of course export the 
data into a shape file using pgsql2shp and import that I guess but...



-- 
GPG Key: 1024D/050895C2
Keyserver: http://pgp.mit.edu/          
Search String: 0x050895C2


From mwkhan at ucdavis.edu  Fri Aug 21 21:15:53 2009
From: mwkhan at ucdavis.edu (Mehdi Khan)
Date: Fri, 21 Aug 2009 12:15:53 -0700
Subject: [R-sig-Geo] Creating a Grid out of a matrix of coordinates
Message-ID: <60b3892e0908211215wd8c45f8kf4a25a1acdd9c69e@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090821/91c0aefe/attachment.pl>

From p.hiemstra at geo.uu.nl  Fri Aug 21 21:34:02 2009
From: p.hiemstra at geo.uu.nl (Paul Hiemstra)
Date: Fri, 21 Aug 2009 21:34:02 +0200
Subject: [R-sig-Geo] Creating a Grid out of a matrix of coordinates
In-Reply-To: <60b3892e0908211215wd8c45f8kf4a25a1acdd9c69e@mail.gmail.com>
References: <60b3892e0908211215wd8c45f8kf4a25a1acdd9c69e@mail.gmail.com>
Message-ID: <4A8EF6AA.1090901@geo.uu.nl>

Hi,

If your object's points are regularly spaced and in a SpatialPoints 
object, use:

gridded(myobj) = TRUE

Or you can from a data.frame with the coordinates and attributes to a 
grid by:

coordinates(myobj) = ~x+y
gridded(myobj) = TRUE

or shorthand:

gridded(myobj) = ~x+y

cheers,
Paul

Mehdi Khan schreef:
> Hello, I have a matrix 1.5 million rows long..
>
> wald:
>
>  coordinates  V3
> 1  (-124.996, 42.0458) 150
> 2  (-124.987, 42.0458) 150
> 3  (-124.979, 42.0458) 150
> 4  (-124.971, 42.0458) 150
> 5  (-124.963, 42.0458) 150
> 6  (-124.954, 42.0458) 150
> 7  (-124.946, 42.0458) 150
> 8  (-124.938, 42.0458) 150
> 9  (-124.929, 42.0458) 150
> 10 (-124.921, 42.0458) 150
>   
>
>
> I would like to coerce this into a grid object so that I can overlay points
> onto it.  How exactly could I accomplish that?  Thank you!!
>
> Mehdi Khan
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From Roger.Bivand at nhh.no  Fri Aug 21 21:52:41 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 21 Aug 2009 21:52:41 +0200 (CEST)
Subject: [R-sig-Geo] ReadOGR error  Multiple # dimensions:
In-Reply-To: <200908211957.42809.mikee@saxicola.idps.co.uk>
References: <200908211957.42809.mikee@saxicola.idps.co.uk>
Message-ID: <alpine.LRH.2.00.0908212140160.8417@reclus.nhh.no>

On Fri, 21 Aug 2009, Mike Evans wrote:

> I would like to read data from postgis database using the command:
>
> aois <-  readOGR("PG:dbname=wales", "aois")
>
> I get the following error:
>
> aois <-  readOGR("PG:dbname=wales", "aois")
> Error in ogrInfo(dsn = dsn, layer = layer, input_field_name_encoding =
> input_field_name_encoding) :
>  Multiple # dimensions:

This is occurring where some of the objects are defined without a z value 
(2D), and others have a z value (3D). I cannot debug your database, but if 
you can run (worth knowing, but not simple):

debug(ogrInfo)
zz <- ogrInfo("PG:dbname=wales", "aois")

and copy out

assign("eTypes_save", eTypes, envir=globalenv())

once you pass this line (and str(eTypes) shows lots of content):

   eTypes <- .Call("R_OGR_types",as.character(dsn), as.character(layer),
     PACKAGE = "rgdal")
>>> here
   if (is.null(retain)) {

then c to error-exit the function, and

save(eTypes_save, file="eTypes_save.RData")

and send "eTypes_save.RData" to me off-list as an attachment. If you know 
why some objects have different dimensions, you may already know how to 
resolve this at the database end.

Hope this helps,

Roger

>
> I assume I have the syntax correct. Any advise?  I could of course 
> export the data into a shape file using pgsql2shp and import that I 
> guess but...
>
>
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From mwkhan at ucdavis.edu  Fri Aug 21 23:52:21 2009
From: mwkhan at ucdavis.edu (Mehdi Khan)
Date: Fri, 21 Aug 2009 14:52:21 -0700
Subject: [R-sig-Geo] Creating a Grid out of a matrix of coordinates
In-Reply-To: <4A8EF6AA.1090901@geo.uu.nl>
References: <60b3892e0908211215wd8c45f8kf4a25a1acdd9c69e@mail.gmail.com> 
	<4A8EF6AA.1090901@geo.uu.nl>
Message-ID: <60b3892e0908211452k3b3c97d4y9a44c40c1994f60c@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090821/33a20924/attachment.pl>

From tom.gottfried at wzw.tum.de  Sat Aug 22 00:13:40 2009
From: tom.gottfried at wzw.tum.de (Tom Gottfried)
Date: Sat, 22 Aug 2009 00:13:40 +0200
Subject: [R-sig-Geo] daily precipitation idw & kriging and beginner
	questions
Message-ID: <2451D416-6C25-4E62-BB77-8F42D29821A8@wzw.tum.de>

Hi Ivan,

 > What should foo.plotting look like?

What I thought to do in foo.plotting was what Edzer suggested but on  
the corresponding elements in jan2000_idw and jan2000_kri:

foo.plotting <- function(idw, kri) {
	...
	Pd.idw$idw = idw$var1.pred
	Pd.idw$ok = kri$krige_output$var1.pred
	print(spplot(Pd.idw, c("idw", "ok")))
	dev.copy(.....); dev.off()
	}
dummy <- mapply(foo.plotting, jan2000_idw, jan2000_kri)

This should give you one jpeg or whatever file per day, each with one  
plot showing two maps (one for idw, the other for kriging). I think  
this is already more handy than having every single map in one file,  
but not as handy as having them all on one plot (as Edzer suggested  
in his mail this afternoon).
Remark: spplot and other lattice plots are not plotted automatically  
from within loops or functions! You have to do that explicitly with  
print().

 > And what does plots look like? Is it a list with jpg's?

Plotting is done with print() in foo.plotting(). dev.copy() copies  
the plot to an other device, e.g. a jpeg-file. However the return  
value of foo.plotting() is not a jpeg but the return value of dev.off 
(), as a function always returns what is lastly evaluated. Unless you  
call return() explicitly. Thus dummy in the above "code" won't be a  
list of jpegs but of return values of dev.off(), which might not be  
very useful for you as you are interested in the graphics output  
which is produced before foo.plotting() gives back a return value.

Hope this helps!

Tom


From kabelimefane at yahoo.co.uk  Sat Aug 22 00:38:37 2009
From: kabelimefane at yahoo.co.uk (KABELI MEFANE)
Date: Fri, 21 Aug 2009 22:38:37 +0000 (GMT)
Subject: [R-sig-Geo] Prediction using geoR
Message-ID: <306352.9886.qm@web27807.mail.ukl.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090821/cf979f2d/attachment.pl>

From paulojus at c3sl.ufpr.br  Sat Aug 22 01:02:45 2009
From: paulojus at c3sl.ufpr.br (Paulo Justiniano Ribeiro Jr)
Date: Fri, 21 Aug 2009 20:02:45 -0300 (BRT)
Subject: [R-sig-Geo] Prediction using geoR
In-Reply-To: <306352.9886.qm@web27807.mail.ukl.yahoo.com>
References: <306352.9886.qm@web27807.mail.ukl.yahoo.com>
Message-ID: <alpine.DEB.1.10.0908212000460.2200@cohiba.c3sl.ufpr.br>

Kabeli

geoR is one among several packages which performs spatial prediction via 
kriging.

The page spatial task view on CRAN provides a good overview of the 
resources

For the geoR there are a few tutorials with example code
available from the geoR Tutorial 
Section in the geoR web page at
www.leg.ufpr.br/geoR

Paulo Justiniano Ribeiro Jr
LEG (Laboratorio de Estatistica e Geoinformacao)
Universidade Federal do Parana
Caixa Postal 19.081
CEP 81.531-990
Curitiba, PR  -  Brasil
Tel: (+55) 41 3361 3573
Fax: (+55) 41 3361 3141
e-mail: paulojus AT  ufpr  br
http://www.leg.ufpr.br/~paulojus



On Fri, 21 Aug 2009, KABELI MEFANE wrote:

> Hi All
> ?
> New to the list.? I have a problem of doing of having to predict Z(so)?where so =(0.5,0.5)? assuming we have measured Z(s1)=3 at (0,0), Z(s1)=5 at (0,1), Z(s3)=6, at (1,0), Z(s4)= 4 at (1,1) ,?
> gamma(h) = h^2?????? when h<1
> ??????????????? = h???????? when h>=1
> This is a practical example i am using,
> I am workng at Lesotho Bureau of Statistics, so i am trying to learn R as fast as possible since i would like to use for analysis of data from our coming Demographic health survey to see the concentration of HIV positive people aroung our four regions. i know that i have to use kriging but i can only do that manual for this point, but its?difficult when using R. i can go as far as the coordinates and values
> ?
> ?
> ?coords.1 coords.2 data
> 1??????? 0??????? 0??? 3
> 2??????? 0??????? 1??? 5
> 3??????? 1??????? 0??? 6
> 4??????? 1??????? 1??? 4
>
>
>
>
> 	[[alternative HTML version deleted]]
>
>


From p.hiemstra at geo.uu.nl  Sat Aug 22 08:46:37 2009
From: p.hiemstra at geo.uu.nl (Paul Hiemstra)
Date: Sat, 22 Aug 2009 08:46:37 +0200
Subject: [R-sig-Geo] Creating a Grid out of a matrix of coordinates
In-Reply-To: <60b3892e0908211452k3b3c97d4y9a44c40c1994f60c@mail.gmail.com>
References: <60b3892e0908211215wd8c45f8kf4a25a1acdd9c69e@mail.gmail.com>
	<4A8EF6AA.1090901@geo.uu.nl>
	<60b3892e0908211452k3b3c97d4y9a44c40c1994f60c@mail.gmail.com>
Message-ID: <4A8F944D.8050407@geo.uu.nl>

Hi,

Then your points are not a grid perfectly. Read the docs for gridded, 
specifically the tolerance argument.

cheers,
Paul

Mehdi Khan schreef:
> Hello Paul,
>
> I get the following error: 
>  gridded(wald)= TRUE
> suggested tolerance minimum: 0.125000000000666
> Error in points2grid(points, tolerance, round, fuzz.tol) :
>   dimension 1 : coordinate intervals are not constant
>
> What do I do?  Thanks a lot!
>
> On Fri, Aug 21, 2009 at 12:34 PM, Paul Hiemstra <p.hiemstra at geo.uu.nl 
> <mailto:p.hiemstra at geo.uu.nl>> wrote:
>
>     Hi,
>
>     If your object's points are regularly spaced and in a
>     SpatialPoints object, use:
>
>     gridded(myobj) = TRUE
>
>     Or you can from a data.frame with the coordinates and attributes
>     to a grid by:
>
>     coordinates(myobj) = ~x+y
>     gridded(myobj) = TRUE
>
>     or shorthand:
>
>     gridded(myobj) = ~x+y
>
>     cheers,
>     Paul
>
>     Mehdi Khan schreef:
>
>         Hello, I have a matrix 1.5 million rows long..
>
>         wald:
>
>          coordinates  V3
>         1  (-124.996, 42.0458) 150
>         2  (-124.987, 42.0458) 150
>         3  (-124.979, 42.0458) 150
>         4  (-124.971, 42.0458) 150
>         5  (-124.963, 42.0458) 150
>         6  (-124.954, 42.0458) 150
>         7  (-124.946, 42.0458) 150
>         8  (-124.938, 42.0458) 150
>         9  (-124.929, 42.0458) 150
>         10 (-124.921, 42.0458) 150
>          
>
>         I would like to coerce this into a grid object so that I can
>         overlay points
>         onto it.  How exactly could I accomplish that?  Thank you!!
>
>         Mehdi Khan
>
>                [[alternative HTML version deleted]]
>
>         _______________________________________________
>         R-sig-Geo mailing list
>         R-sig-Geo at stat.math.ethz.ch <mailto:R-sig-Geo at stat.math.ethz.ch>
>         https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>          
>
>
>


From edzer.pebesma at uni-muenster.de  Sat Aug 22 10:03:33 2009
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Sat, 22 Aug 2009 10:03:33 +0200
Subject: [R-sig-Geo] Creating a Grid out of a matrix of coordinates
In-Reply-To: <60b3892e0908211452k3b3c97d4y9a44c40c1994f60c@mail.gmail.com>
References: <60b3892e0908211215wd8c45f8kf4a25a1acdd9c69e@mail.gmail.com>
	<4A8EF6AA.1090901@geo.uu.nl>
	<60b3892e0908211452k3b3c97d4y9a44c40c1994f60c@mail.gmail.com>
Message-ID: <4A8FA655.1010005@uni-muenster.de>

This suggests that the data you want to convert to a grid are not laid
out on a regular grid at all.
--
Edzer

Mehdi Khan wrote:
> Hello Paul,
>
> I get the following error:
>  gridded(wald)= TRUE
> suggested tolerance minimum: 0.125000000000666
> Error in points2grid(points, tolerance, round, fuzz.tol) :
>   dimension 1 : coordinate intervals are not constant
>
> What do I do?  Thanks a lot!
>
> On Fri, Aug 21, 2009 at 12:34 PM, Paul Hiemstra <p.hiemstra at geo.uu.nl>wrote:
>
>   
>> Hi,
>>
>> If your object's points are regularly spaced and in a SpatialPoints object,
>> use:
>>
>> gridded(myobj) = TRUE
>>
>> Or you can from a data.frame with the coordinates and attributes to a grid
>> by:
>>
>> coordinates(myobj) = ~x+y
>> gridded(myobj) = TRUE
>>
>> or shorthand:
>>
>> gridded(myobj) = ~x+y
>>
>> cheers,
>> Paul
>>
>> Mehdi Khan schreef:
>>
>>     
>>> Hello, I have a matrix 1.5 million rows long..
>>>
>>> wald:
>>>
>>>  coordinates  V3
>>> 1  (-124.996, 42.0458) 150
>>> 2  (-124.987, 42.0458) 150
>>> 3  (-124.979, 42.0458) 150
>>> 4  (-124.971, 42.0458) 150
>>> 5  (-124.963, 42.0458) 150
>>> 6  (-124.954, 42.0458) 150
>>> 7  (-124.946, 42.0458) 150
>>> 8  (-124.938, 42.0458) 150
>>> 9  (-124.929, 42.0458) 150
>>> 10 (-124.921, 42.0458) 150
>>>
>>>
>>> I would like to coerce this into a grid object so that I can overlay
>>> points
>>> onto it.  How exactly could I accomplish that?  Thank you!!
>>>
>>> Mehdi Khan
>>>
>>>        [[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>>
>>>       
>>     
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>   

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763 http://ifgi.uni-muenster.de/
http://www.springer.com/978-0-387-78170-9 e.pebesma at wwu.de


From kabelimefane at yahoo.co.uk  Mon Aug 24 03:22:42 2009
From: kabelimefane at yahoo.co.uk (KABELI MEFANE)
Date: Mon, 24 Aug 2009 01:22:42 +0000 (GMT)
Subject: [R-sig-Geo] Matern
Message-ID: <510695.84797.qm@web27801.mail.ukl.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090824/9a393d1a/attachment.pl>

From paulojus at c3sl.ufpr.br  Mon Aug 24 03:49:19 2009
From: paulojus at c3sl.ufpr.br (Paulo Justiniano Ribeiro Jr)
Date: Sun, 23 Aug 2009 22:49:19 -0300 (BRT)
Subject: [R-sig-Geo] Matern
In-Reply-To: <510695.84797.qm@web27801.mail.ukl.yahoo.com>
References: <510695.84797.qm@web27801.mail.ukl.yahoo.com>
Message-ID: <alpine.DEB.1.10.0908232248060.7317@talisker.c3sl.ufpr.br>

matern() funcion in geoR only computer the correlation (it is a 
correlation function)

to add the variance parameters use cov.spatial() such that you can compute 
covariances, or just scole matern by $sigma^2$ and add the nugget




Paulo Justiniano Ribeiro Jr
LEG (Laboratorio de Estatistica e Geoinformacao)
Universidade Federal do Parana
Caixa Postal 19.081
CEP 81.531-990
Curitiba, PR  -  Brasil
Tel: (+55) 41 3361 3573
Fax: (+55) 41 3361 3141
e-mail: paulojus AT  ufpr  br
http://www.leg.ufpr.br/~paulojus



On Mon, 24 Aug 2009, KABELI MEFANE wrote:

> Hi All
> ?
> please help me figure out this problems: give kappa = 1,1.5,2,2.5,3 , phi= say 1, nugget= 0.1 and sigma (squared)= 1.0 how do i calculate the matern? I have tried to come up with a code.
> but i have?manage to draw some curves without using some parameters but not sigma and nugget and i wonder whether they are to be used.........:
> ?
> phi= 1.0, kappa = 1.0),from = 0, to = 1.5,
> +????? xlab = "distance", ylab = expression(rho(h)), lty = 2,
> +????? main=expression(paste("Matern Correlation with varying? ", kappa, "? and fixed? ", phi)))
>> curve(matern(x, phi= 1.0, kappa = 1.5),from = 0, to = 1.5, add = TRUE)
>> curve(matern(x, phi= 1.0, kappa = 2.0),from = 0, to = 1.5, add = TRUE)
>> curve(matern(x, phi= 1.0, kappa = 2.0),from = 0, to = 1.5, add = TRUE,lwd=2,lty=2)
>> curve(matern(x, phi= 1.0, kappa = 2.5),from = 0, to = 1.5, add = TRUE,lwd=2)
>> curve(matern(x, phi= 1.0, kappa = 3.0),from = 0, to = 1.5, add = TRUE,lwd=2,lty=1)
>>
>> legend("topright", expression(kappa==1.0, kappa==1.5, kappa==2.0, kappa==2.5, kappa==3.0),
> +??????? lry= c(2,1,2,1,2),lwd=c(1,1,2,2,2))
> Error in legend("topright", expression(kappa == 1, kappa == 1.5, kappa ==? :
> ? unused argument(s) (lry = c(2, 1, 2, 1, 2))
>> legend("topright", expression(kappa==1.0, kappa==1.5, kappa==2.0, kappa==2.5, kappa==3.0),
> +??????? lty= c(2,1,2,1,2),lwd=c(1,1,2,2,2))
>> legend("topright", expression(kappa==1.0, kappa==1.5, kappa==2.0, kappa==2.5, kappa==3.0),
> +??????? lty= c(2,1,2,1,2),lwd=c(1,1,2,2,1))
>> legend("topright", expression(kappa==1.0, kappa==1.5, kappa==2.0, kappa==2.5, kappa==3.0),
> +??????? lty= c(2,1,2,1,1),lwd=c(1,1,2,2,2))
>
>
>
> 	[[alternative HTML version deleted]]
>
>


From adrian at maths.uwa.edu.au  Mon Aug 24 05:13:43 2009
From: adrian at maths.uwa.edu.au (Adrian Baddeley)
Date: Mon, 24 Aug 2009 11:13:43 +0800
Subject: [R-sig-Geo]  silly question on quadratcount in spatstat ?
Message-ID: <4A920567.20206@maths.uwa.edu.au>

Alexendre Villers writes: 

> library(spatstat)
> data(humberside)
> plot(humberside)
> qH <- quadratcount(humberside, 5, 5)
> plot(qH, add=TRUE, col="blue", cex=1.5, lwd=2)

> There is obviously something wrong with the display of the count 

What is wrong with the display?

Since the window for 'humberside' is an irregular shape, when you issue the command 'quadratcount(humberside, 5, 5)' the rectangle surrounding this region is first divided into a 5 x 5 array of rectangles, and then these rectangles are intersected with the irregular region to form the quadrats. At this stage there are 25 quadrats, some of which may be empty because the rectangle did not intersect the irregular window. The number of data points in each quadrat is counted (yielding 25 numbers). Also the area of each quadrat is counted (yielding 25 numbers, some of which may be zero).

When the object qH is plotted, the plot method shows only the quadrats that have nonzero area (because they intersected the window). For each of these quadrats, the count is displayed as a numeral at the 'centre' of the quadrat. The centre is computed by finding the approximate incentre of the quadrat (the centre of the largest disc inscribed in the quadrat). 

In the case of 'quadratcount(humberside, 5, 5)' some of the quadrats are very small pieces. In these small quadrats, the plot method (plot.quadratcount) has some difficulty in finding a comfortable place to put the numeral that represents the count. 

> qH gives a contingency table of counts on a 5 * 5 grid but there are 
> only 20 cells lying inside the owin. Why do we get value for cells 
> outside our observation window ?  

Well, this is just a convention, so that quadratcount(X, 5, 5) always results in a contingency table with 25 cells. 

> I'm sure there is a way of getting a vector for the cells 
> observed it but I couldn't figure how. 

The easiest way to get all the information you want is to use quadrat.test(). 
This removes quadrats that do not intersect the window. 
You can extract the observed counts and expected counts as follows:

           qtH <- quadrat.test(humberside, 5, 5)

           observed.counts <- qtH$observed
           expected.counts <- qtH$expected

If you want the actual quadrats, 

           quadratsH <- tiles(as.tess(qtH))

If you want the areas of the quadrats,

           quadrat.areas <- unlist(lapply(quadratsH, area.owin))

regards
Adrian Baddeley


From adrian at maths.uwa.edu.au  Mon Aug 24 05:23:19 2009
From: adrian at maths.uwa.edu.au (Adrian Baddeley)
Date: Mon, 24 Aug 2009 11:23:19 +0800
Subject: [R-sig-Geo]  silly question on quadratcount in spatstat ?
Message-ID: <4A9207A7.20605@maths.uwa.edu.au>

Anna Marburg writes:

> library(spatstat)
> data(humberside)
> Q <- quadratcount(humberside, 5, 5)
> tmp <- attr(Q,"tess")	

The last line is somewhat dangerous as it depends on the undocumented internal structure of a 'quadratcount' object. 
The safe way to convert a quadratcount object to a tessellation is to use 'as.tess'

  tmp <- as.tess(Q)


> til <- tiles(tmp)  #the definition of the quadrats themselves
> m2 <- unlist(lapply(til, function(x) x[[c(4,1,4)]])) #extract the area of each polygon

The last line is very dangerous and will not work in some versions of spatstat. 
The safe way to extract the area of each tile in a tessellation is to use 'area.owin'

     m2 <- unlist(lapply(til, area.owin))


Adrian Baddeley


From camilosanin at gmail.com  Mon Aug 24 05:49:35 2009
From: camilosanin at gmail.com (Camilo Sanin)
Date: Sun, 23 Aug 2009 22:49:35 -0500
Subject: [R-sig-Geo] count overlapping polygons
Message-ID: <FE8E80F1-1C0E-45D3-93CB-F5E34F12FF21@gmail.com>

Dear R-sig-Geo users,

I was wondering if any of you knew how to count the number of features  
in a given shapefile that overlap each feature of another shapefile  
(such as a grid). This is sort of what the "count overlapping  
polygons" extension for ArcView (http://www.mosaic-conservation.org/gis/overlap.html 
) does, only that in this case I would like to count features with a  
duplicated value in a certain column on the attribute table only once.

thanks in advance for your help,

Camilo Sanin


From doon75 at hotmail.com  Mon Aug 24 16:29:01 2009
From: doon75 at hotmail.com (Darren Norris)
Date: Mon, 24 Aug 2009 11:29:01 -0300
Subject: [R-sig-Geo] GDAL Error - .grd not recognised as a supported file
Message-ID: <BLU0-SMTP47066D45F097261969D600C7F90@phx.gbl>

Hi all,
I'm trying to work with the "ETOPO1 Global Relief Model", downloaded 
from http://www.ngdc.noaa.gov/mgg/global/global.html .
I chose the netCDF format option, which from the readme should be most 
appropriate for GDAL users.
Snip from discussions - http://n2.nabble.com/flip-raster-td1886005.html
"
I've posted new versions of ETOPO1 that GDAL can read properly (north is 
north) on the ETOPO1 web page 
(http://www.ngdc.noaa.gov/mgg/global/global.html), along with an 
explanatory readme file (in each netcdf folder). I've also created and 
posted geotiff versions of ETOPO1. Please let me know if any more 
problems are encountered.
Thanks,
Barry Eakins
barry.eakins at noaa.gov
ETOPO1 1 Arc-Minute Global Relief Model
http://www.ngdc.noaa.gov/mgg/global/global.html
"
However it looks like rgdal can't read the file. Or am I doing something 
wrong?
Can anyone suggest the simplest way to get this data into R (I'm 
avoiding the geotif due to bad internet and possible memory limitations 
on my PC)?
Many thanks,
Darren


input_file<-c("C:/Users/Darren/Documents/ecology and 
conservation/SP/data_gis/RASTEr/ETOPO1_Ice_g_gdal.grd")
file.exists(input_file)
[1] TRUE

library(gdal)
readGDAL(input_file)

Error in .local(.Object, ...) :
        GDAL Error 4: `C:/Users/Darren/Documents/ecology and 
conservation/SP/data_gis/RASTEr/ETOPO1_Ice_g_gdal.grd' not recognised as 
a supported file format.

R version 2.9.0 (2009-04-17)
i386-pc-mingw32

locale:
LC_COLLATE=English_United Kingdom.1252;LC_CTYPE=English_United 
Kingdom.1252;LC_MONETARY=English_United 
Kingdom.1252;LC_NUMERIC=C;LC_TIME=English_United Kingdom.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base    

other attached packages:
[1] rgdal_0.6-8 sp_0.9-36 

loaded via a namespace (and not attached):
[1] grid_2.9.0      lattice_0.17-22 tools_2.9.0


From b.rowlingson at lancaster.ac.uk  Mon Aug 24 16:42:27 2009
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Mon, 24 Aug 2009 15:42:27 +0100
Subject: [R-sig-Geo] GDAL Error - .grd not recognised as a supported file
In-Reply-To: <BLU0-SMTP47066D45F097261969D600C7F90@phx.gbl>
References: <BLU0-SMTP47066D45F097261969D600C7F90@phx.gbl>
Message-ID: <d8ad40b50908240742k5d5c9d59s7ddda3ded5f07832@mail.gmail.com>

On Mon, Aug 24, 2009 at 3:29 PM, Darren Norris<doon75 at hotmail.com> wrote:

> Can anyone suggest the simplest way to get this data into R (I'm avoiding
> the geotif due to bad internet and possible memory limitations on my PC)?

 Given that its 20,000 by 10,000 pixels you might run into memory
limitations with any file format.

> readGDAL(input_file)
>
> Error in .local(.Object, ...) :
> ? ? ? GDAL Error 4: `C:/Users/Darren/Documents/ecology and
> conservation/SP/data_gis/RASTEr/ETOPO1_Ice_g_gdal.grd' not recognised as a
> supported file format.

 Try this in R:

 GDALinfo(input_file)

 Since you are going to have trouble reading the whole dataset with
readGDAL, it might be easier to use the low-level GDAL functions to
sample from the whole thing. See help(GDAL.open) and
help(getRasterData) for more info.

Barry


From doon75 at hotmail.com  Mon Aug 24 16:54:13 2009
From: doon75 at hotmail.com (Darren Norris)
Date: Mon, 24 Aug 2009 11:54:13 -0300
Subject: [R-sig-Geo] GDAL Error - .grd not recognised as a supported file
In-Reply-To: <d8ad40b50908240742k5d5c9d59s7ddda3ded5f07832@mail.gmail.com>
References: <BLU0-SMTP47066D45F097261969D600C7F90@phx.gbl>
	<d8ad40b50908240742k5d5c9d59s7ddda3ded5f07832@mail.gmail.com>
Message-ID: <BLU0-SMTP673AAE18CF1500EF0BF825C7F90@phx.gbl>

Hi Barry,
Thanks for the comments -

GDALinfo(input_file)
comes back with the same

Error in .local(.Object, ...) :
        GDAL Error 4: `C:/Users/Darren/Documents/ecology and 
conservation/SP/data_gis/RASTEr/ETOPO1_Ice_g_gdal.grd' not recognised as 
a supported file format.

Does this mean it's not possible to open with packages available in R?
If so I'll try the geotiff and work with a subsample .........
Darren

Barry Rowlingson wrote:
> On Mon, Aug 24, 2009 at 3:29 PM, Darren Norris<doon75 at hotmail.com> wrote:
>
>   
>> Can anyone suggest the simplest way to get this data into R (I'm avoiding
>> the geotif due to bad internet and possible memory limitations on my PC)?
>>     
>
>  Given that its 20,000 by 10,000 pixels you might run into memory
> limitations with any file format.
>
>   
>> readGDAL(input_file)
>>
>> Error in .local(.Object, ...) :
>>       GDAL Error 4: `C:/Users/Darren/Documents/ecology and
>> conservation/SP/data_gis/RASTEr/ETOPO1_Ice_g_gdal.grd' not recognised as a
>> supported file format.
>>     
>
>  Try this in R:
>
>  GDALinfo(input_file)
>
>  Since you are going to have trouble reading the whole dataset with
> readGDAL, it might be easier to use the low-level GDAL functions to
> sample from the whole thing. See help(GDAL.open) and
> help(getRasterData) for more info.
>
> Barry
>
>
>


From b.rowlingson at lancaster.ac.uk  Mon Aug 24 16:58:52 2009
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Mon, 24 Aug 2009 15:58:52 +0100
Subject: [R-sig-Geo] GDAL Error - .grd not recognised as a supported file
In-Reply-To: <d8ad40b50908240742k5d5c9d59s7ddda3ded5f07832@mail.gmail.com>
References: <BLU0-SMTP47066D45F097261969D600C7F90@phx.gbl>
	<d8ad40b50908240742k5d5c9d59s7ddda3ded5f07832@mail.gmail.com>
Message-ID: <d8ad40b50908240758m67d43da8s64a5c693ffe68752@mail.gmail.com>

On Mon, Aug 24, 2009 at 3:42 PM, Barry
Rowlingson<b.rowlingson at lancaster.ac.uk> wrote:

> ?Since you are going to have trouble reading the whole dataset with
> readGDAL, it might be easier to use the low-level GDAL functions to
> sample from the whole thing. See help(GDAL.open) and
> help(getRasterData) for more info.
>

 This works for me:

> e=readGDAL("ETOPO1_Ice_g_gdal.grd",output.dim=c(100,100))
ETOPO1_Ice_g_gdal.grd has GDAL driver GMT
and has 10801 rows and 21601 columns

 So it must just be your GDAL not having drivers for these files.

 Note you can sub-sample in readGDAL, you don't need to go to the lower level.

 rgdal'  gdalDrivers() function should tell you what drivers your gdal
supports - I see this in mine:

28        GMT                                   GMT NetCDF Grid Format

 It's a single-band image and I don't think the colour palette is in there.

 Note you can sub-sample in readGDAL, you don't need to go to the
lower level, by doing output.dim=c(y,x).

Barry


From tom.gottfried at wzw.tum.de  Mon Aug 24 18:29:43 2009
From: tom.gottfried at wzw.tum.de (Tom Gottfried)
Date: Mon, 24 Aug 2009 18:29:43 +0200
Subject: [R-sig-Geo] daily precipitation idw & kriging and
	beginnerquestions
In-Reply-To: <631152A1D26F5540B73896D2C649DCFA01A7F993@BCSXTC.knmi.nl>
References: <2451D416-6C25-4E62-BB77-8F42D29821A8@wzw.tum.de>
	<631152A1D26F5540B73896D2C649DCFA01A7F993@BCSXTC.knmi.nl>
Message-ID: <4A92BFF7.0@wzw.tum.de>

Hi Ivan,

Soenario, Ivan (KNMI) schrieb:
> I've got the interpolations
> working, the printing as well, only one detail left:
> The dev.copy action results in overwriting the same file with the last
> component in list P_idw.
> 
> So I tried:
> dummy <- mapply(foo.plotting, jan2000.idw, jan2000.kri)
> 
> foo.plotting <- function(P_idw, P_kri) {
> 	i <- i+1
> 	P_idw$idw = P_idw$var1.pred
> 	P_idw$ok = P_kri$krige_output$var1.pred
> 	print(spplot(P_idw, c("idw", "ok")))
> 	dev.copy(jpeg, file = paste( wordir, "/img/Pd_idwkri_",
> 20000100+i, ".jpg", sep = ""), height = 17, width = 17, units = "cm",
> quality = 100, res=150, bg="white"); dev.off()
> }
> 
> But the 'i' won't increase. 

This lies in nature of all the functions of the "apply-family". They do not loop over the list
elements but apply the given function to list elements somehow in parallel.

> I could go back to a for-loop, but I find
> lapply and mapply too elegant to do that. So I have to use something
> else instead of a counter 'i'.

A further argument to foo.plotting(), giving the filename or something else which is useful in your
call to paste() for example.

> Since P_idw is a list containing the interpolated maps, is there a
> method to retrieve the list element, that is currently being processed
> by mapply? I can use that for the main title and the image file name.

As mapply() actually retrieves each element of the lists given as it's "..." argument and applies
FUN to them, I assume you intend to retrieve the name of the list element. As far as I know this is
impossible from within FUN, but you can retrieve the names before with names() and pass this as an
argument to FUN. Something like

foo.plotting <- function(P_idw, P_kri, names(P_idw)){
	...
	}

> Ps2: what does 'foo' stand for? Function-of-your-own??

Thanks to your hint I found that: http://en.wikipedia.org/wiki/Foobar. Function-of-your-own is not
mentioned but it's at least a good idea which might be added ;-)

regards,
Tom


From BRWIN338 at aol.com  Mon Aug 24 22:50:50 2009
From: BRWIN338 at aol.com (BRWIN338 at aol.com)
Date: Mon, 24 Aug 2009 16:50:50 EDT
Subject: [R-sig-Geo] Reading ESRI-GRID format data
Message-ID: <ced.610e51e7.37c4572a@aol.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090824/b00b7766/attachment.pl>

From b.rowlingson at lancaster.ac.uk  Mon Aug 24 23:07:48 2009
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Mon, 24 Aug 2009 22:07:48 +0100
Subject: [R-sig-Geo] Reading ESRI-GRID format data
In-Reply-To: <ced.610e51e7.37c4572a@aol.com>
References: <ced.610e51e7.37c4572a@aol.com>
Message-ID: <d8ad40b50908241407y73214e38lab829aa2f138df51@mail.gmail.com>

On Mon, Aug 24, 2009 at 9:50 PM, <BRWIN338 at aol.com> wrote:
>
> Good Afternoon
> Does R have the ability to let me have access to the gridded data values
> for the following data?
> We downloaded the zipped file containing the data sets but are not familiar
> ?with how to read the data in R.
>
> Thanks
> Joe
> ######################################################################
> Description on data web page:
> Travel time to major cities: A global map of ?Accessibility
> The data are in geographic projection with a resolution ?of 30 arc seconds.
> The format is integer ESRITM GRID format with ?pixel values representing
> minutes of travel time. The files are stored in a zip ?archive. The archive
> also contains an ESRITM Shapefile of the ?populated places. Other files
> include Metadata (XML), and ArcView 3 Projects and ?Legends (APR and AVL).
> ############################################################################
> ##############

 Short Answer: Quite probably...

 Medium Answer: Get the rgdal package from CRAN and use the readGDAL function.

 Step-by-step and long answer:

 install.packages("rgdal")
 library(rgdal)

 GDALinfo("filename.asc") # prints out info about the raster

 map = readGDAL("filename.asc") # reads in the whole raster

 image(map) # does a plot

 # look at the first five points - locations:
  coordinates(map)[1:5,]
           x       y
[1,] 3366825 5814624
[2,] 3366835 5814624
[3,] 3366845 5814624
[4,] 3366855 5814624
[5,] 3366865 5814624

# values:
 map at data[1:5,]
[1] 1 1 4 1 2

 If your raster is too big for your PC then you'll have to read parts
of it using other options to readGDAL.

Barry


From mwkhan at ucdavis.edu  Tue Aug 25 00:24:13 2009
From: mwkhan at ucdavis.edu (Mehdi Khan)
Date: Mon, 24 Aug 2009 15:24:13 -0700
Subject: [R-sig-Geo] Overlay on raster loses points when merging with data
	frame
Message-ID: <60b3892e0908241524i609b4998veca495349e8bc54e@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090824/087bc06b/attachment.pl>

From edzer.pebesma at uni-muenster.de  Tue Aug 25 08:19:14 2009
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Tue, 25 Aug 2009 08:19:14 +0200
Subject: [R-sig-Geo] Overlay on raster loses points when merging with
 data	frame
In-Reply-To: <60b3892e0908241524i609b4998veca495349e8bc54e@mail.gmail.com>
References: <60b3892e0908241524i609b4998veca495349e8bc54e@mail.gmail.com>
Message-ID: <4A938262.7000105@uni-muenster.de>

Without being able to look over your shoulder I feel a bit like I have
to guess here. Is it possible that some points are outside the grid
(removed by remove.na.rows)? Is it possible that in some instances two
ore more points end up in the same grid cell (removed by unique)?
--
Edzer

Mehdi Khan wrote:
> Hello everyone.  I have overlayed 1611 points on top of a tif file.
>
> tifclassoverlay<-overlay(CRS11, classifiedmodrobin)
>
> overlaydf<-as.data.frame(tifclassoverlay)
>
> tifol<-remove.na.rows(overlaydf)
>
>
> tifol is 854 rows long.   tifol has predicted data, while the
> classifiedmodrobin matrix has observed data.  When I try to merge the two, I
> get a length of 827:
>
>  ngafulldf<-as.data.frame(classifiedmodrobin)
>
>  NGAfiledata<-merge(tifol, ngafulldf,all=FALSE, by=c("LON", "LAT"))
>
> NGAfiledata<-unique(NGAfiledata)
>
> NGAfiledata<-remove.na.rows(NGAfiledata)
> The length should obviously still be 854.  What happened to the missing
> rows?  How can I get them back?  Thank you very much!! Here is a sample of
> what the data looks like:
>         LON     LAT Net  STA ELEVATION vs30 tif.cat
> 1  -3086165 3718184  CI NEE2       271  363       8
> 2  -3143337 3500449  CI  EMS        11  336      14
> 3  -3155773 3704130  CI  DAN       428  304       4
> 4  -3173788 3722206  CI  GRP       978  509       4
> 5  -3188256 3548775  EN  SIM       -64  264      NA
> 6  -3193879 3549663  EN  RED       -64  322      NA
> 7  -3195312 3547901  CI  RXH       -59  331      NA
> 8  -3214063 3540800  CI  ERR       -56  233       8
> 9  -3219756 3587780  CI NSS2        17  246       4
> 10 -3226717 3558278  CI  SAL        14  473       8
> 11 -3229979 3516218  CI  CRR        66  315       4
> 12 -3238308 3596300  CI  THX       -31  244      12
> 13 -3247148 3667171  CI  GTM       836  306       7
> 14 -3254339 3615978  CI  MGE        68  330       4
> 15 -3257283 3597678  CI  PMD       296  257       3
>
> I am assuming there is no precision error since there are no decimals..
>
> Thanks!
>
> Mehdi Khan
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>   

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763 http://ifgi.uni-muenster.de/
http://www.springer.com/978-0-387-78170-9 e.pebesma at wwu.de


From Michael.Haenlein at whu.edu  Tue Aug 25 10:58:16 2009
From: Michael.Haenlein at whu.edu (Haenlein, Michael)
Date: Tue, 25 Aug 2009 10:58:16 +0200
Subject: [R-sig-Geo] Reference for join-count model
Message-ID: <FCE3439777D52842B1D4831921FCA0D18515819D62@EXIDEFIX01.whu.edu>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090825/a97be8cd/attachment.pl>

From marco.helbich at gmx.at  Tue Aug 25 12:14:43 2009
From: marco.helbich at gmx.at (Marco Helbich)
Date: Tue, 25 Aug 2009 12:14:43 +0200
Subject: [R-sig-Geo] Reference for join-count model
In-Reply-To: <mailman.13.1251194403.27318.r-sig-geo@stat.math.ethz.ch>
References: <mailman.13.1251194403.27318.r-sig-geo@stat.math.ethz.ch>
Message-ID: <20090825101443.133380@gmx.net>

Dear Michael,

this one comes to my mind:

@BOOK{Goodchild1986,
  title = {Spatial Autocorrelation},
  publisher = {Geo Books, Norwich},
  year = {1986},
  author = {Goodchild, M},
  timestamp = {2007.05.14}
}

hope it helps
marco
 
> ------------------------------
> 
> Message: 10
> Date: Tue, 25 Aug 2009 10:58:16 +0200
> From: "Haenlein, Michael" <Michael.Haenlein at whu.edu>
> Subject: [R-sig-Geo] Reference for join-count model
> To: "r-sig-geo at stat.math.ethz.ch" <r-sig-geo at stat.math.ethz.ch>
> Message-ID:
> 	<FCE3439777D52842B1D4831921FCA0D18515819D62 at EXIDEFIX01.whu.edu>
> Content-Type: text/plain
> 
> Dear all,
> 
> I'm using the joincount.test function in the spdep package to test for the
> presence of spatial autocorrelation in a nominal variable.
> Given that I'm doing this analysis for a paper I'm currently working on, I
> would need a reference that explains the logic behind the join-count
> model.
> The reference given in the spdep manual is "Cliff, A. D., Ord, J. K. 1981
> Spatial processes". Unfortunatelly I do not have this book available at the
> moment.
> 
> Are there any other references (preferably journal articles) which I could
> cite in this context to explain the basics behind the join-count test?
> I would be very grateful for any references you could send me - and even
> more if you happen to have the pdf of the respective articles which you
> could e-Mail to me.
> 
> Thanks very much in advance,
> 
> Michael
> 
> 
> Michael Haenlein
> ESCP Europe
> Associate Professor of Marketing
> 
> 	[[alternative HTML version deleted]]
> 
> 
> 
> ------------------------------
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 
> 
> End of R-sig-Geo Digest, Vol 72, Issue 20
> *****************************************

-- 
GRATIS f?r alle GMX-Mitglieder: Die maxdome Movie-FLAT!


From Roger.Bivand at nhh.no  Tue Aug 25 12:38:19 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 25 Aug 2009 12:38:19 +0200
Subject: [R-sig-Geo] GDAL Error - .grd not recognised as a supported file
References: <BLU0-SMTP47066D45F097261969D600C7F90@phx.gbl><d8ad40b50908240742k5d5c9d59s7ddda3ded5f07832@mail.gmail.com>
	<d8ad40b50908240758m67d43da8s64a5c693ffe68752@mail.gmail.com>
Message-ID: <AD51AB79BC327C40AB2C7EB75D57A3C40512FD@TOLAR.valuta.nhh.no>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090825/e3c48028/attachment.pl>

From educheyne at avia-gis.be  Tue Aug 25 12:49:36 2009
From: educheyne at avia-gis.be (Els Ducheyne)
Date: Tue, 25 Aug 2009 12:49:36 +0200
Subject: [R-sig-Geo] converting from images or spatialgriddataframes to kasc
References: <00761CB6-DEA6-4FBF-AE97-BF0188DF7169@avia-gis.be>
Message-ID: <4233F66A-B835-4C70-AA90-2ADF580DFC0C@avia-gis.be>


>
>> Dear list
> I have been trying to convert input data from either images or  
> spatialgriddataframes to kasc for enfa modelling
> However I keep getting a strange error that the cell size is not the  
> same in the different dimensions - see below. Is there anyone that  
> can enlighten because I am really stuck
>
> Thanks
> Els
>
> 1. from im to asc
> > summary(aedes.extra)
>               Length Class Mode
> meandaylst     11     im    list
> dem            11     im    list
> water          11     im    list
> dist2water     11     im    list
> corine         11     im    list
> dist2harbour   11     im    list
> dist2protected 11     im    list
> meanyearlyEVI  11     im    list
> EVIA1          11     im    list
> EVIA2          11     im    list
> EVImax         11     im    list
> EVImin         11     im    list
> EVIp1          11     im    list
> EVIp2          11     im    list
> LSTdayA1       11     im    list
> LSTdayA2       11     im    list
> LSTdaymax      11     im    list
> LSTdayp1       11     im    list
> LSTdayp2       11     im    list
> meannightLST   11     im    list
> LSTnightA1     11     im    list
> LSTnightA2     11     im    list
> LSTnightmax    11     im    list
> LSTnightp1     11     im    list
> LSTnightp2     11     im    list
> dens           11     im    list
> > aedes.extra$meandaylst$xstep
> [1] 0.01
> > aedes.extra$meandaylst$ystep
> [1] 0.01
> > test<-im2asc(aedes.extra$meandaylst)
> Error in im2asc(aedes.extra$meandaylst) :
>  the grid cellsize should be identical for both X and Y directions.
>
> 2. from spatialgriddataframe to kasc
>
> > summary(grids)
> Object of class SpatialGridDataFrame
> Coordinates:
>                min       max
> coords.x1  2.546947  7.236947
> coords.x2 49.446575 53.626575
> Is projected: NA
> proj4string : [NA]
> Number of points: 2
> Grid attributes:
>  cellcentre.offset cellsize cells.dim
> 1          2.551947     0.01       469
> 2         49.451575     0.01       418
> Data attributes:
>   meanlstday         dem              soilmoist            
> dist2water             dens               densr                
> corine       dist2harbour       meanyearlyEVI
> Min.   :  0.0   Min.   :  -500.00   Min.   :     0.00   Min.   : 
> 0.000e+00   Min.   :2.364e-07   Min.   :3.742e-09   Min.   :0.000    
> Min.   :0.000e+00   Min.   :0.0000
> 1st Qu.:  0.0   1st Qu.:     2.00   1st Qu.:    97.00   1st Qu.: 
> 2.000e-02   1st Qu.:1.497e-01   1st Qu.:2.369e-03   1st Qu.:0.000    
> 1st Qu.:3.105e-01   1st Qu.:0.3000
> Median :286.4   Median :    16.00   Median :   100.00   Median : 
> 5.099e-02   Median :2.431e+00   Median :3.847e-02   Median :0.000    
> Median :6.938e-01   Median :0.3575
> Mean   :210.5   Mean   :    84.37   Mean   :    94.12   Mean   : 
> 7.541e-02   Mean   :9.006e+00   Mean   :1.425e-01   Mean   :1.003    
> Mean   :7.726e-01   Mean   :0.3627
> 3rd Qu.:287.4   3rd Qu.:   101.00   3rd Qu.:   100.00   3rd Qu.: 
> 1.044e-01   3rd Qu.:1.115e+01   3rd Qu.:1.764e-01   3rd Qu.:2.000    
> 3rd Qu.:1.123e+00   3rd Qu.:0.4260
> Max.   :292.0   Max.   :   687.00   Max.   :   100.00   Max.   : 
> 4.809e-01   Max.   :6.319e+01   Max.   :1.000e+00   Max.   :6.000    
> Max.   :2.458e+00   Max.   :0.6874
>                 NA's   :107457.00   NA's   :107784.00   NA's   : 
> 1.074e+05                                                            
> NA's   :1.069e+05
>     EVIA1               EVIA2               EVImax             
> EVImin             EVIp1           EVIp2          LSTdayA1          
> LSTdayA2        LSTdaymax
> Min.   :0.000e+00   Min.   :0.000e+00   Min.   :-0.3000    
> Min.   :-0.45415   Min.   :  0.0   Min.   :  0.0   Min.   : 0.000    
> Min.   : 0.000   Min.   :  0.0
> 1st Qu.:4.200e-14   1st Qu.:4.100e-14   1st Qu.:-0.1600   1st  
> Qu.:-0.30000   1st Qu.:  0.0   1st Qu.:  0.0   1st Qu.: 0.000   1st  
> Qu.: 0.000   1st Qu.:  0.0
> Median :1.087e-01   Median :2.369e-02   Median : 0.5638   Median :  
> 0.18672   Median :258.1   Median :141.9   Median :10.991   Median :  
> 1.141   Median :298.0
> Mean   :9.665e-02   Mean   :2.708e-02   Mean   : 0.3528   Mean   :  
> 0.08641   Mean   :195.3   Mean   :126.1   Mean   : 8.494   Mean   :  
> 1.139   Mean   :219.5
> 3rd Qu.:1.489e-01   3rd Qu.:4.218e-02   3rd Qu.: 0.6415   3rd Qu.:  
> 0.25174   3rd Qu.:267.5   3rd Qu.:200.2   3rd Qu.:11.655   3rd Qu.:  
> 1.485   3rd Qu.:299.6
> Max.   :3.276e-01   Max.   :1.880e-01   Max.   : 0.9030   Max.   :  
> 0.55256   Max.   :360.0   Max.   :360.0   Max.   :27.253   Max.   : 
> 16.695   Max.   :308.8
>
>    LSTdayp1        LSTdayp2      meannightLST     LSTnightA1         
> LSTnightA2        LSTnightmax      LSTnightp1      LSTnightp2
> Min.   :  0.0   Min.   :  0.0   Min.   :  0.0   Min.   :  0.000    
> Min.   :  0.0000   Min.   :  0.0   Min.   :  0.0   Min.   :  0.0
> 1st Qu.:  0.0   1st Qu.:  0.0   1st Qu.:  0.0   1st Qu.:  0.000    
> 1st Qu.:  0.0000   1st Qu.:  0.0   1st Qu.:  0.0   1st Qu.:  0.0
> Median :264.8   Median :233.0   Median :277.3   Median :  8.162    
> Median :  0.4818   Median :287.4   Median :256.3   Median :212.2
> Mean   :196.0   Mean   :182.8   Mean   :200.3   Mean   :  7.675    
> Mean   :  2.1540   Mean   :211.1   Mean   :190.0   Mean   :171.1
> 3rd Qu.:267.1   3rd Qu.:259.1   3rd Qu.:278.6   3rd Qu.:  9.365    
> 3rd Qu.:  1.8035   3rd Qu.:288.3   3rd Qu.:261.9   3rd Qu.:317.7
> Max.   :298.9   Max.   :351.3   Max.   :283.9   Max.   :181.431    
> Max.   :154.8919   Max.   :293.4   Max.   :360.0   Max.   :360.0
>
> > test<-spixdf2kasc(grids)
> Error in spixdf2kasc(grids) :
>  the cellsize should be the same in x and y directions
>>
>


From milton.ruser at gmail.com  Tue Aug 25 13:21:43 2009
From: milton.ruser at gmail.com (milton ruser)
Date: Tue, 25 Aug 2009 07:21:43 -0400
Subject: [R-sig-Geo] Overlay on raster loses points when merging with
	data frame
In-Reply-To: <60b3892e0908241524i609b4998veca495349e8bc54e@mail.gmail.com>
References: <60b3892e0908241524i609b4998veca495349e8bc54e@mail.gmail.com>
Message-ID: <3aaf1a030908250421w66e86891v7565afc227b8e625@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090825/f44f1b61/attachment.pl>

From b.rowlingson at lancaster.ac.uk  Tue Aug 25 13:55:46 2009
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Tue, 25 Aug 2009 12:55:46 +0100
Subject: [R-sig-Geo] transparency in raster images
Message-ID: <d8ad40b50908250455w2000e248n928718f22789331a@mail.gmail.com>

I've just been hacking image.SpatialGridDataFrame to support
transparency, either via specifying an alpha band or a constant value
of alpha:

image(foo,red=1,green=2,blue=3,alpha="band4",add=TRUE)
image(foo,red=1,green=2,blue=3,alpha=0.5,add=TRUE)

I don't think what I've done works properly with NAs in the data
though. Has anyone else implemented transparency for SGDFs to save me
spending time fixing little awkward bits like that? Roger?

Barry


From mdsumner at gmail.com  Tue Aug 25 14:37:27 2009
From: mdsumner at gmail.com (Michael Sumner)
Date: Tue, 25 Aug 2009 22:37:27 +1000
Subject: [R-sig-Geo] GDAL Error - .grd not recognised as a supported file
Message-ID: <522664f80908250537i36c99c4bi33d10d1a8a032344@mail.gmail.com>

Hello,

(I was trying to send this last night, so it's been covered by Barry
and Roger, but I'm now sending it as a test of this email address
subscription).

Unfortunately you won't be able to read NetCDF with the CRAN version
of Windows rgdal. If you build the package yourself against FWTools,
or a source build of GDAL you can include NetCDF.

For now probably the easiest way is just to use FWTools directly on
the file - the Windows build of FWTools includes NetCDF, but building
rgdal to include that is not simple, especially if you are not
experienced with building software. You can discover the structure of
the file using this at the command line

gdalinfo ETOPO1_Ice_g_gdal.grd

If you want to post the output of that command we can probably help more.

There may be subdatasets in the file (I don't think so, but let us
know if you have problems). If that seems fine then you can convert to
GeoTIFF with the following:

gdal_translate ETOPO1_Ice_g_gdal.grd ETOPO1_Ice_g_gdal.tif

Then you should be able to read it with readGDAL with the GeoTIFF driver.

(If there are subdatasets you need the full string, something like
this: gdal_translate NETCDF:"ETOPO1_Ice_g_gdal.grd":Etopo
ETOPO1_Ice_g_gdal.tif  )

BTW,  I've been using the downloaded ice/cell version of the TIFF (but
I do remember problems and I may have converted it from the .grd)
ftp://ftp.ngdc.noaa.gov/mgg/global/relief/ETOPO1/data/ice_surface/cell_registered/georeferenced_tiff/ETOPO1_Ice_c_geotiff.zip

I usually find there is something missing from datasets like this,
either the source NetCDF assumes Matlab orientation and this
information is not explicit, or therthe pixel registration will be
slightly out - so it's not uncommon to need some manual workarounds
before getting it right.

Finally, I think you could read from the file using one of the R
NetCDF packages if that seems more promising - but you'll still have
to manually create sp objects from the data.  I use RNetCDF a lot -
which will install simply on Windows with install.packages.

Regards, Mike.


From doon75 at hotmail.com  Tue Aug 25 17:28:08 2009
From: doon75 at hotmail.com (Darren Norris)
Date: Tue, 25 Aug 2009 15:28:08 +0000
Subject: [R-sig-Geo] GDAL Error - .grd not recognised as a supported file
In-Reply-To: <AD51AB79BC327C40AB2C7EB75D57A3C40512FD@TOLAR.valuta.nhh.no>
References: <BLU0-SMTP47066D45F097261969D600C7F90@phx.gbl><d8ad40b50908240742k5d5c9d59s7ddda3ded5f07832@mail.gmail.com>
	<d8ad40b50908240758m67d43da8s64a5c693ffe68752@mail.gmail.com>
	<AD51AB79BC327C40AB2C7EB75D57A3C40512FD@TOLAR.valuta.nhh.no>
Message-ID: <SNT102-W2112959F079B7EB0D0EBC8C7F80@phx.gbl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090825/6f1aa84c/attachment.pl>

From mwkhan at ucdavis.edu  Tue Aug 25 19:01:11 2009
From: mwkhan at ucdavis.edu (Mehdi Khan)
Date: Tue, 25 Aug 2009 10:01:11 -0700
Subject: [R-sig-Geo] Overlay on raster loses points when merging with
	data frame
In-Reply-To: <3aaf1a030908250421w66e86891v7565afc227b8e625@mail.gmail.com>
References: <60b3892e0908241524i609b4998veca495349e8bc54e@mail.gmail.com> 
	<3aaf1a030908250421w66e86891v7565afc227b8e625@mail.gmail.com>
Message-ID: <60b3892e0908251001x5f992f0cy3acbebb086dd08dd@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090825/38c6c67c/attachment.pl>

From ogbos.okike at gmail.com  Tue Aug 25 19:56:53 2009
From: ogbos.okike at gmail.com (ogbos okike)
Date: Tue, 25 Aug 2009 19:56:53 +0200
Subject: [R-sig-Geo] Generic mapping tools
Message-ID: <43b418580908251056o5bedf0edj8b2956d03c3772d0@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090825/bce1ca77/attachment.pl>

From r.hijmans at gmail.com  Tue Aug 25 20:10:27 2009
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Tue, 25 Aug 2009 11:10:27 -0700
Subject: [R-sig-Geo] Generic mapping tools
In-Reply-To: <43b418580908251056o5bedf0edj8b2956d03c3772d0@mail.gmail.com>
References: <43b418580908251056o5bedf0edj8b2956d03c3772d0@mail.gmail.com>
Message-ID: <dc22b2570908251110i5e4b5b26wd7927a6429fcba8d@mail.gmail.com>

Ogbos,

You could have a look at pointsToRaster in the raster package to count
the number of points (events?) per raster cell.

to install raster:
install.packages("raster", repos="http://R-Forge.R-project.org")

Robert

On Tue, Aug 25, 2009 at 10:56 AM, ogbos okike<ogbos.okike at gmail.com> wrote:
> Hello to everybody,
>
> I have a huge geographic data labeled latitude and longitude (global). ?I am
> attempting to use Generic mapping tools to plot the distribution of the
> events. I wish to obtain number of events per region on the map. Using
> factor function, I have summed up the number of events on each block of
> latitude and longitude and saved them respectively as x and y. I hoped I
> could plot the matrix x and y by using color plot. But when I used >image(x,
> y), the error message was ? "Error in image.default(y, x) : increasing 'x'
> and 'y' values expected".
>
> I am learning R for the first time and I am not quite sure that my method
> here is alright. I have just subscribed to this mailing list today so as to
> get help.
>
> I would therefore be grateful if you could guide me.
> ?Small portion of the data is:
> ?lat ? ? ? ? ?lon
> -5.1821 147.4462
> -5.1826 147.3733
> -5.1680 147.3855
> 31.4489 -63.2175
> 28.3199 -62.1831
> -18.2495 -44.6471
> -11.3654 -42.8249
> -2.6652 -73.2344
> -13.3543 -56.5338
> 27.9594 -157.9413
> 29.4454 -62.0620
> -5.1953 116.0678
> 31.7057 -62.7211
> -15.6194 124.6710
> -7.1434 -72.2230
> -19.1066 -45.665
>
> Thank you
> Ogbos
>
> ? ? ? ?[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From kabelimefane at yahoo.co.uk  Wed Aug 26 00:56:32 2009
From: kabelimefane at yahoo.co.uk (KABELI MEFANE)
Date: Tue, 25 Aug 2009 22:56:32 +0000 (GMT)
Subject: [R-sig-Geo] Kriging
Message-ID: <592911.74943.qm@web27803.mail.ukl.yahoo.com>

Hi all
?
Please help and correct me, to predict Z(S0) at (0.5,0.5) given Z(S1) = 3 at (0,0), Z(S2) = 5 at(0,1), Z(S3) =?6(1,0) and Z(S4) = 4(1,1). Let 
? (h)=h^2? h<1
?????? = 1???? h>=1 using geo. 
?
I did this: coords<-matrix(c(0,0,1,1,0,1,0,1), nrow=4, ncol=2)
> data<-c(3,5,6,4)
> coordata<-data.frame(coords=coords,data=data)
> geo<-as.geodata(coordata)
> plot(geo$coords, xlim = c(0, 1.2), ylim = c(0,1.2),
+???? xlab = "X-axis", ylab = "Y-axis")
> locations<- matrix(c(0.5, 0.5), ncol = 2)
> text(locations, as.character(0), col = "red")
> polygon(x = c(0, 1, 1, 0), y = c(0, 0, 1, 1),lty = 2)
> szero<- krige.conv(geo, locations=locations,
+???????? krige=krige.control(cov.pars=c(1,1)))
?
how do i?show this points, lines?and values on the gragh like it was done an erview of spatial statistics by Brian Vinyard slides 40 or something similar?.


      
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090825/91d7dbe6/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: kriging.doc
Type: application/octet-stream
Size: 27648 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090825/91d7dbe6/attachment.obj>

From milton.ruser at gmail.com  Wed Aug 26 01:50:36 2009
From: milton.ruser at gmail.com (milton ruser)
Date: Tue, 25 Aug 2009 19:50:36 -0400
Subject: [R-sig-Geo] Kriging
In-Reply-To: <592911.74943.qm@web27803.mail.ukl.yahoo.com>
References: <592911.74943.qm@web27803.mail.ukl.yahoo.com>
Message-ID: <3aaf1a030908251650w74ebf118yb3daac535fd6a010@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090825/d9fcf39c/attachment.pl>

From tankisothejane at yahoo.com  Wed Aug 26 02:14:30 2009
From: tankisothejane at yahoo.com (TANKISO THEJANE)
Date: Tue, 25 Aug 2009 17:14:30 -0700 (PDT)
Subject: [R-sig-Geo] Matern
Message-ID: <712609.64469.qm@web46415.mail.sp1.yahoo.com>



Dear R users
?
Greetings from a novice. I would be grateful if you can help me complete the plot of a matern correlation function Matern Correlation function?with?? kappa?=1,1.5,2,2.5,3?, phi = 1? The problem is that i can manage to get the result when t> 0 using the following code:
?
curve(matern(x, phi= 1.0, kappa = 1.0),from = 0, to = 1.5,
+??? xlab = "distance", ylab = expression(rho(h)), lty = 2,
+??? main=expression(paste("Matern Correlation with varying? ", kappa,
+??? "? and fixed? ", phi)))
> curve(matern(x, phi= 1.0, kappa = 1.5),from = 0, to = 1.5, add = TRUE)
> curve(matern(x, phi= 1.0, kappa = 2.0),from = 0, to = 1.5, add = TRUE,lwd=2,lty=2)
> curve(matern(x, phi= 1.0, kappa = 2.5),from = 0, to = 1.5, add = TRUE,lwd=2)
> curve(matern(x, phi= 1.0, kappa = 3.0),from = 0, to = 1.5, add = TRUE,lwd=3)
> legend("topright", expression(kappa==1, kappa==1.5, kappa==2, kappa==2.5, kappa==3)
+?????? ,lty= c(2,1,2,1,1),lwd=c(1,1,2,2,3))
> 
> curve(matern(x, phi= 1.0, kappa = 1.0),from = 0, to = 1.5,
+??? xlab = "distance", ylab = expression(rho(h)), lty = 2,
+??? main=expression(paste("Matern Correlation with varying? ", kappa,
+??? "? and fixed? ", phi)))
?
now i need to also?add ot a plot the curve at t=0 matern = 0.1+1=1.1.
?
Tankiso


      
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090825/e5e52273/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Matern.doc
Type: application/octet-stream
Size: 28672 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090825/e5e52273/attachment.obj>

From Thomas.Adams at noaa.gov  Wed Aug 26 04:43:07 2009
From: Thomas.Adams at noaa.gov (Thomas.Adams at noaa.gov)
Date: Tue, 25 Aug 2009 22:43:07 -0400
Subject: [R-sig-Geo] Kriging
In-Reply-To: <3aaf1a030908251650w74ebf118yb3daac535fd6a010@mail.gmail.com>
References: <592911.74943.qm@web27803.mail.ukl.yahoo.com>
	<3aaf1a030908251650w74ebf118yb3daac535fd6a010@mail.gmail.com>
Message-ID: <64bbb50d4ed9bc49.4a9468fb@noaa.gov>

Maybe something like this:

http://www.ars.usda.gov/sp2UserFiles/ad_hoc/12000000SpatialWorkshop/01VinyardOverview.pdf



----- Original Message -----
From: milton ruser <milton.ruser at gmail.com>
Date: Tuesday, August 25, 2009 7:50 pm
Subject: Re: [R-sig-Geo] Kriging

> Hi Kabeli,
> 
> I never saw Brian Vinyard slides 40! :-)
> It is accessible on a internet site?
> 
> bests
> milton
> 
> On Tue, Aug 25, 2009 at 6:56 PM, KABELI MEFANE 
> <kabelimefane at yahoo.co.uk>wrote:
> >   Hi all
> >
> > Please help and correct me, to predict Z(S0) at (0.5,0.5) given 
> Z(S1) = 3
> > at (0,0), Z(S2) = 5 at(0,1), Z(S3) = 6(1,0) and Z(S4) = 4(1,1). Let
> >
> > ? (h)=h^2  h<1
> >
> >        = 1     h>=1 using geo.
> >
> >
> >
> > I did this: coords<-matrix(c(0,0,1,1,0,1,0,1), nrow=4, ncol=2)
> > > data<-c(3,5,6,4)
> > > coordata<-data.frame(coords=coords,data=data)
> > > geo<-as.geodata(coordata)
> > > plot(geo$coords, xlim = c(0, 1.2), ylim = c(0,1.2),
> > +     xlab = "X-axis", ylab = "Y-axis")
> > > locations<- matrix(c(0.5, 0.5), ncol = 2)
> > > text(locations, as.character(0), col = "red")
> > > polygon(x = c(0, 1, 1, 0), y = c(0, 0, 1, 1),lty = 2)
> > > szero<- krige.conv(geo, locations=locations,
> > +         krige=krige.control(cov.pars=c(1,1)))
> >
> >
> >
> > how do i show this points, lines and values on the gragh like it 
> was done
> > an erview of spatial statistics by Brian Vinyard slides 40 or 
> something> similar?.
> >
> >
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at stat.math.ethz.ch
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
> >
> 
> 	[[alternative HTML version deleted]]
> 
> 
-------------- next part --------------
_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at stat.math.ethz.ch
https://stat.ethz.ch/mailman/listinfo/r-sig-geo

From Roger.Bivand at nhh.no  Wed Aug 26 08:36:26 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 26 Aug 2009 08:36:26 +0200
Subject: [R-sig-Geo] Reference for join-count model
References: <mailman.13.1251194403.27318.r-sig-geo@stat.math.ethz.ch>
	<20090825101443.133380@gmx.net>
Message-ID: <AD51AB79BC327C40AB2C7EB75D57A3C40512FF@TOLAR.valuta.nhh.no>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090826/b30f094c/attachment.pl>

From tankisothejane at yahoo.com  Wed Aug 26 09:57:51 2009
From: tankisothejane at yahoo.com (TANKISO THEJANE)
Date: Wed, 26 Aug 2009 00:57:51 -0700 (PDT)
Subject: [R-sig-Geo] Fw: Re: Matern
Message-ID: <434629.5984.qm@web46406.mail.sp1.yahoo.com>











Dear R users
?
Greetings from a novice. I would be grateful if you can help me complete the plot of a matern correlation function Matern Correlation function?with?? kappa?=1,1.5,2,2.5,3?, phi = 1? The problem is that i can manage to get the result when t> 0 using the following code:
?
curve(matern(x, phi= 1.0, kappa = 1.0),from = 0, to = 1.5,
+??? xlab = "distance", ylab = expression(rho(h)), lty = 2,
+??? main=expression(paste("Matern Correlation with varying? ", kappa,
+??? "? and fixed? ", phi)))
> curve(matern(x, phi= 1.0, kappa = 1.5),from = 0, to = 1.5, add = TRUE)
> curve(matern(x, phi= 1.0, kappa = 2.0),from = 0, to = 1.5, add = TRUE,lwd=2,lty=2)
> curve(matern(x, phi= 1.0, kappa = 2.5),from = 0, to = 1.5, add = TRUE,lwd=2)
> curve(matern(x, phi= 1.0, kappa = 3.0),from = 0, to = 1.5, add = TRUE,lwd=3)
> legend("topright", expression(kappa==1, kappa==1.5, kappa==2, kappa==2.5, kappa==3)
+?????? ,lty= c(2,1,2,1,1),lwd=c(1,1,2,2,3))
> 
> curve(matern(x, phi= 1.0, kappa = 1.0),from = 0, to = 1.5,
+??? xlab = "distance", ylab = expression(rho(h)), lty = 2,
+??? main=expression(paste("Matern Correlation with varying? ", kappa,
+??? "? and fixed? ", phi)))
?
now i need to also?add ot a plot the curve at t=0 matern = 0.1+1=1.1.
?
Tankiso



      
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090826/875e296f/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Matern.doc
Type: application/octet-stream
Size: 28672 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090826/875e296f/attachment.obj>

From kabelimefane at yahoo.co.uk  Wed Aug 26 12:10:48 2009
From: kabelimefane at yahoo.co.uk (KABELI MEFANE)
Date: Wed, 26 Aug 2009 10:10:48 +0000 (GMT)
Subject: [R-sig-Geo] Fw: Kriging
Message-ID: <352770.43779.qm@web27803.mail.ukl.yahoo.com>


?





Hi all
?
Please help and correct me, to predict Z(S0) at (0.5,0.5) given Z(S1) = 3 at (0,0), Z(S2) = 5 at(0,1), Z(S3) =?6(1,0) and Z(S4) = 4(1,1). Let 
? (h)=h^2? h<1 
?????? = 1???? h>=1 using geo. 
? 
I did this: coords<-matrix(c(0,0,1,1,0,1,0,1), nrow=4, ncol=2)
> data<-c(3,5,6,4)
> coordata<-data.frame(coords=coords,data=data)
> geo<-as.geodata(coordata)
> plot(geo$coords, xlim = c(0, 1.2), ylim = c(0,1.2),
+???? xlab = "X-axis", ylab = "Y-axis")
> locations<- matrix(c(0.5, 0.5), ncol = 2)
> text(locations, as.character(0), col = "red")
> polygon(x = c(0, 1, 1, 0), y = c(0, 0, 1, 1),lty = 2)
> szero<- krige.conv(geo, locations=locations,
+???????? krige=krige.control(cov.pars=c(1,1))) 
? 
how do i?show this points, lines?and values on the gragh like it was done an erview of spatial statistics by Brian Vinyard slides 40 or something similar?.

?


      
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090826/72f00547/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: kriging.doc
Type: application/octet-stream
Size: 27648 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090826/72f00547/attachment.obj>

From kabelimefane at yahoo.co.uk  Wed Aug 26 18:24:08 2009
From: kabelimefane at yahoo.co.uk (KABELI MEFANE)
Date: Wed, 26 Aug 2009 16:24:08 +0000 (GMT)
Subject: [R-sig-Geo] Fw: Kriging
Message-ID: <702160.28395.qm@web27804.mail.ukl.yahoo.com>



?
Hi all
?
Please help and correct me, to predict Z(S0) at (0.5,0.5) given Z(S1) = 3 at (0,0), Z(S2) = 5 at(0,1), Z(S3) =?6(1,0) and Z(S4) = 4(1,1). Let 
? (h)=h^2? h<1 
?????? = 1???? h>=1 using geo. 
? 
I did this: coords<-matrix(c(0,0,1,1,0,1,0,1), nrow=4, ncol=2)
> data<-c(3,5,6,4)
> coordata<-data.frame(coords=coords,data=data)
> geo<-as.geodata(coordata)
> plot(geo$coords, xlim = c(0, 1.2), ylim = c(0,1.2),
+???? xlab = "X-axis", ylab = "Y-axis")
> locations<- matrix(c(0.5, 0.5), ncol = 2)
> text(locations, as.character(0), col = "red")
> polygon(x = c(0, 1, 1, 0), y = c(0, 0, 1, 1),lty = 2)
> szero<- krige.conv(geo, locations=locations,
+???????? krige=krige.control(cov.pars=c(1,1))) 
? 
how do i?show this points, lines?and values on the gragh like it was done an erview of spatial statistics by Brian Vinyard slides 40 or something similar?


      
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090826/743e1f1b/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: kriging.doc
Type: application/octet-stream
Size: 27648 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090826/743e1f1b/attachment.obj>

From reeves at nceas.ucsb.edu  Wed Aug 26 20:58:20 2009
From: reeves at nceas.ucsb.edu (rick reeves)
Date: Wed, 26 Aug 2009 11:58:20 -0700
Subject: [R-sig-Geo] Preparing KML files for GoogleMaps/Earth: Why no
 kmlPoint() in maptools package?
Message-ID: <4A9585CC.6020404@nceas.ucsb.edu>

Hello List:

I'm investigating ways to convert Shape Files to KML format, and of 
course have
taken note of the kmlLine() and kmlPolygon() routines in the maptools 
package.

It is easy to review the code underlying these routines (e.g., > 
kmlLine), and to see
how straightforward the coding is. My question is? Why hasn't a similar 
routine
for Point shape files (eg, kmlPoint() ) been added to maptools?

As it stands, one has to use rgdal package / writeOGR(), or fwtools/ogr2ogr,
to convert Point shape to KML format. This works, but can present problems
for Mac users who haven't built the rgdal library on their machines.

Or, is there another way?

Thanks,
Rick R

-- 
Rick Reeves
Scientific Programmer/Analyst and Data Manager
National Center for Ecological Analysis and Synthesis
UC Santa Barbara
www.nceas.ucsb.edu
805 892 2533


From mwkhan at ucdavis.edu  Wed Aug 26 21:59:52 2009
From: mwkhan at ucdavis.edu (Mehdi Khan)
Date: Wed, 26 Aug 2009 12:59:52 -0700
Subject: [R-sig-Geo] Creating grid from xyz file
Message-ID: <60b3892e0908261259r64bd0d1anba1b374ef726ccd8@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090826/2bfe3ea7/attachment.pl>

From p.hiemstra at geo.uu.nl  Wed Aug 26 22:19:49 2009
From: p.hiemstra at geo.uu.nl (Paul Hiemstra)
Date: Wed, 26 Aug 2009 22:19:49 +0200
Subject: [R-sig-Geo] Creating grid from xyz file
In-Reply-To: <60b3892e0908261259r64bd0d1anba1b374ef726ccd8@mail.gmail.com>
References: <60b3892e0908261259r64bd0d1anba1b374ef726ccd8@mail.gmail.com>
Message-ID: <4A9598E5.5040907@geo.uu.nl>

Mehdi Khan schreef:
> Hello everyone,  I have a table with 2 columns containing geographical
> coordinates (lat, long) and one column containing attribute data.  This is a
> data frame object which I would like to convert into a grid object.  It is
> the 7.3 mb "california" file on this page:
>
> http://earthquake.usgs.gov/research/hazmaps/interactive/vs30/predefined.php
>
> I tried to use the "gridded" command, but it did not work for my data. Is
> there any other method?  Thank you!
>
> Mehdi Khan
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>   
How exactly did you try the gridded command. Please be specific.

cheers,
Paul


From mwkhan at ucdavis.edu  Wed Aug 26 22:21:54 2009
From: mwkhan at ucdavis.edu (Mehdi Khan)
Date: Wed, 26 Aug 2009 13:21:54 -0700
Subject: [R-sig-Geo] Creating grid from xyz file
In-Reply-To: <4A9598E5.5040907@geo.uu.nl>
References: <60b3892e0908261259r64bd0d1anba1b374ef726ccd8@mail.gmail.com> 
	<4A9598E5.5040907@geo.uu.nl>
Message-ID: <60b3892e0908261321u1bcf3a74uf2473a40c27e3c78@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090826/c6459486/attachment.pl>

From mwkhan at ucdavis.edu  Thu Aug 27 00:31:00 2009
From: mwkhan at ucdavis.edu (Mehdi Khan)
Date: Wed, 26 Aug 2009 15:31:00 -0700
Subject: [R-sig-Geo] Creating grid from xyz file
In-Reply-To: <fb9ffecc1c065.4a963d04@utas.edu.au>
References: <60b3892e0908261259r64bd0d1anba1b374ef726ccd8@mail.gmail.com> 
	<4A9598E5.5040907@geo.uu.nl>
	<60b3892e0908261321u1bcf3a74uf2473a40c27e3c78@mail.gmail.com> 
	<fb9ffecc1c065.4a963d04@utas.edu.au>
Message-ID: <60b3892e0908261531u66dd8f08icc556cc1991ef9e@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090826/f7ac0f75/attachment.pl>

From p.hiemstra at geo.uu.nl  Thu Aug 27 09:30:53 2009
From: p.hiemstra at geo.uu.nl (Paul Hiemstra)
Date: Thu, 27 Aug 2009 09:30:53 +0200
Subject: [R-sig-Geo] Creating grid from xyz file
In-Reply-To: <60b3892e0908261321u1bcf3a74uf2473a40c27e3c78@mail.gmail.com>
References: <60b3892e0908261259r64bd0d1anba1b374ef726ccd8@mail.gmail.com>
	<4A9598E5.5040907@geo.uu.nl>
	<60b3892e0908261321u1bcf3a74uf2473a40c27e3c78@mail.gmail.com>
Message-ID: <4A96362D.6060400@geo.uu.nl>

Mehdi Khan wrote:
> Sorry about that, this is what I did:
>
> wald<-read.table ("C:/Documents and Settings/MK/My Documents/USGS/R 
> Data/wald/california.xyz")
>
> names(wald)[1]<- "LON"
>
> names(wald)[2]<- "LAT"
>
> names(wald)[3]<- "vs30"
>
> coordinates(wald)<- c("LON", "LAT")
>
> gridded(wald)<- TRUE
>
> suggested tolerance minimum: 0.125000000000666
> Error in points2grid(points, tolerance, round, fuzz.tol) :
>   dimension 1 : coordinate intervals are not constant
Hi,

This error suggests that the data in california.xyz is actually not on a 
regularly spaced grid.

cheers,
Paul
>
> note: this is the same data frame I asked a question about last week.  
> There is also a grid file available but it seems extremely difficult 
> to get it to read in R.  ideas?
> On Wed, Aug 26, 2009 at 1:19 PM, Paul Hiemstra <p.hiemstra at geo.uu.nl 
> <mailto:p.hiemstra at geo.uu.nl>> wrote:
>
>     Mehdi Khan schreef:
>
>         Hello everyone,  I have a table with 2 columns containing
>         geographical
>         coordinates (lat, long) and one column containing attribute
>         data.  This is a
>         data frame object which I would like to convert into a grid
>         object.  It is
>         the 7.3 mb "california" file on this page:
>
>         http://earthquake.usgs.gov/research/hazmaps/interactive/vs30/predefined.php
>
>         I tried to use the "gridded" command, but it did not work for
>         my data. Is
>         there any other method?  Thank you!
>
>         Mehdi Khan
>
>                [[alternative HTML version deleted]]
>
>         _______________________________________________
>         R-sig-Geo mailing list
>         R-sig-Geo at stat.math.ethz.ch <mailto:R-sig-Geo at stat.math.ethz.ch>
>         https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>          
>
>     How exactly did you try the gridded command. Please be specific.
>
>     cheers,
>     Paul
>
>


-- 
Drs. Paul Hiemstra
Department of Physical Geography
Faculty of Geosciences
University of Utrecht
Heidelberglaan 2
P.O. Box 80.115
3508 TC Utrecht
Phone:  +3130 274 3113 Mon-Tue
Phone:  +3130 253 5773 Wed-Fri
http://intamap.geo.uu.nl/~paul


From matteo.mattiuzzi at boku.ac.at  Thu Aug 27 12:41:56 2009
From: matteo.mattiuzzi at boku.ac.at (Matteo Mattiuzzi)
Date: Thu, 27 Aug 2009 12:41:56 +0200
Subject: [R-sig-Geo] Lat/Lon Polygons
Message-ID: <4A967F140200002700003D75@gwia2.boku.ac.at>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090827/ca31e942/attachment.pl>

From reeves at nceas.ucsb.edu  Thu Aug 27 18:27:53 2009
From: reeves at nceas.ucsb.edu (rick reeves)
Date: Thu, 27 Aug 2009 09:27:53 -0700
Subject: [R-sig-Geo] maptools/kmlPolygon example: two SPDFs,
	different results
Message-ID: <4A96B409.1000405@nceas.ucsb.edu>

Hello List:

I'm using R 2.9 on Windows XP/64 for this example, with recent builds of 
maptools and rgdal packages.

The shape file used in this example can be obtained from:

http://nceas.ucsb.edu/scicomp/upload/UsCountiesGeogProj.zip

While studying the example for kmlPolygon() in the maptools.pdf 
documentation (pp 22  - 23), I ran the
example code (top of page 23), using the wrld_simpl data set, and used 
slot() to extract a subset of the
Polygons component of the sample data set, then create a KML file using 
kmlPolygon. The example
worked as planned with the indicated data set.

Then, I read the attached polygon shape file using readOGR, into a 
SpatialPolygonsDataFrame, and
substituted this dataset for the wrld_simpl data set. In this case, the 
slot() statement returned ONLY
the FIRST polygon from the SPDF. As a result, the resulting KML file 
contains only one polygon,
instead of the entire set.

I have reviewed the structure of each SPDF, using 'str(MySPDF[1:3,])', 
and the data objects seem
to have the same structure. Yet the 'one polygon' problem persists. I 
would appreciate it if someone
could repeat the experiment with the attached data set and let me know 
where I might be mistaken!

Thanks,
Rick Reeves

-- 
Rick Reeves
Scientific Programmer/Analyst and Data Manager
National Center for Ecological Analysis and Synthesis
UC Santa Barbara
www.nceas.ucsb.edu
805 892 2533


From r.hijmans at gmail.com  Thu Aug 27 18:35:57 2009
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Thu, 27 Aug 2009 09:35:57 -0700
Subject: [R-sig-Geo] Preparing KML files for GoogleMaps/Earth: Why no
	kmlPoint() in maptools package?
In-Reply-To: <4A9585CC.6020404@nceas.ucsb.edu>
References: <4A9585CC.6020404@nceas.ucsb.edu>
Message-ID: <dc22b2570908270935t3b48f8c4r75fbcd66342c0563@mail.gmail.com>

Rick, I wondered the same thing a while ago and wrote this script; I
worked for my purposes but never really finished it (e.g.
SpatialPoints objects support; and I wanted to add folders). Perhaps
you or someone else can finish it (or do a better one) and send it to
the maptools maintainers? Robert


kmlPoints <- function(obj, kmlfile, kmlname = "") {
# obj = x,y,desc
	if (kmlname=="") {kmlname <- basename(kmlfile)}
    kmlHeader <- c("<?xml version=\"1.0\" encoding=\"UTF-8\"?>",
        "<kml xmlns=\"http://earth.google.com/kml/2.2\">", "<Document>",
		paste("<name>", kmlname, "</name>", sep = ""))
    kml <- ""
	obj[,3] <- gsub('&', 'and', obj[,3])
	for (p in 1:length(obj[,1])) {
#		kml <- append(kml, "<Folder>")
		kml <- append(kml, "<Placemark>")
		kml <- append(kml, paste("<name>", obj[p,3], "</name>", sep = ""))
		kml <- append(kml, paste("<Point><coordinates>", obj[p,1], ',',
obj[p,2], ",0</coordinates></Point>", sep = ""))
		kml <- append(kml, "</Placemark>")
#		kml <- append(kml, "</Folder>")
	}
    kmlFooter <- c("</Document>", "</kml>")
    cat(paste(c(kmlHeader, kml, kmlFooter), sep = "", collapse =
"\n"), "\n", file = kmlfile, sep = "")
}


>  x <- -10:10
> y <- -10:10
> z <- 1:21
>
> obj <- cbind(x, y, z)
> kmlPoints(obj, 'd:/tst.kml')


On Wed, Aug 26, 2009 at 11:58 AM, rick reeves<reeves at nceas.ucsb.edu> wrote:
> Hello List:
>
> I'm investigating ways to convert Shape Files to KML format, and of course
> have
> taken note of the kmlLine() and kmlPolygon() routines in the maptools
> package.
>
> It is easy to review the code underlying these routines (e.g., > kmlLine),
> and to see
> how straightforward the coding is. My question is? Why hasn't a similar
> routine
> for Point shape files (eg, kmlPoint() ) been added to maptools?
>
> As it stands, one has to use rgdal package / writeOGR(), or fwtools/ogr2ogr,
> to convert Point shape to KML format. This works, but can present problems
> for Mac users who haven't built the rgdal library on their machines.
>
> Or, is there another way?
>
> Thanks,
> Rick R
>
> --
> Rick Reeves
> Scientific Programmer/Analyst and Data Manager
> National Center for Ecological Analysis and Synthesis
> UC Santa Barbara
> www.nceas.ucsb.edu
> 805 892 2533
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From tankisothejane at yahoo.com  Thu Aug 27 18:40:01 2009
From: tankisothejane at yahoo.com (TANKISO THEJANE)
Date: Thu, 27 Aug 2009 09:40:01 -0700 (PDT)
Subject: [R-sig-Geo] help on Initializing the matern at point zero
Message-ID: <550118.76651.qm@web46411.mail.sp1.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090827/517f60ee/attachment.pl>

From r.hijmans at gmail.com  Thu Aug 27 19:06:28 2009
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Thu, 27 Aug 2009 10:06:28 -0700
Subject: [R-sig-Geo] maptools/kmlPolygon example: two SPDFs,
	different 	results
In-Reply-To: <4A96B409.1000405@nceas.ucsb.edu>
References: <4A96B409.1000405@nceas.ucsb.edu>
Message-ID: <dc22b2570908271006r3616d26ew40c724fa7bdce0d6@mail.gmail.com>

Rick, I had the same problem. Perhaps I simply misunderstood the
maptools function. I wrote the script below and that worked for me (it
includes all polygons). It probably has some limitations. Robert


polykml <- function(sw, filename, kmlname, namefield, kmldesc="Made with R" ) {
	out <- sapply(slot(sw, "polygons"),
		function(x) {
			kmlPolygon(x,  name=as(sw, "data.frame")[slot(x, "ID"), namefield],
				col="#df0000aa", lwd=1.5, border='black', description=as(sw,
"data.frame")[slot(x, "ID"), desc] )
		}
	)
	kmlFile <- file(filename, "w")
	cat(kmlPolygon(kmlname=kmlname, kmldescription=kmldesc)$header,
file=kmlFile, sep="\n")
	cat(unlist(out["style",]), file=kmlFile, sep="\n")
	cat(unlist(out["content",]), file=kmlFile, sep="\n")
	cat(kmlPolygon()$footer, file=kmlFile, sep="\n")
	close(kmlFile)
# optional, to make a kmz, I do not know how to make this generic for
all systems
#	kmz <- basename(filename)
# change file extension, from raster package	
#	ext(kmz) <- '.kmz'
#	com <- paste("7za a -tzip", kmz, " ", fn, sep="")
#	sss <- system(com, intern=TRUE)
	return(TRUE)
}


On Thu, Aug 27, 2009 at 9:27 AM, rick reeves<reeves at nceas.ucsb.edu> wrote:
> Hello List:
>
> I'm using R 2.9 on Windows XP/64 for this example, with recent builds of
> maptools and rgdal packages.
>
> The shape file used in this example can be obtained from:
>
> http://nceas.ucsb.edu/scicomp/upload/UsCountiesGeogProj.zip
>
> While studying the example for kmlPolygon() in the maptools.pdf
> documentation (pp 22 ?- 23), I ran the
> example code (top of page 23), using the wrld_simpl data set, and used
> slot() to extract a subset of the
> Polygons component of the sample data set, then create a KML file using
> kmlPolygon. The example
> worked as planned with the indicated data set.
>
> Then, I read the attached polygon shape file using readOGR, into a
> SpatialPolygonsDataFrame, and
> substituted this dataset for the wrld_simpl data set. In this case, the
> slot() statement returned ONLY
> the FIRST polygon from the SPDF. As a result, the resulting KML file
> contains only one polygon,
> instead of the entire set.
>
> I have reviewed the structure of each SPDF, using 'str(MySPDF[1:3,])', and
> the data objects seem
> to have the same structure. Yet the 'one polygon' problem persists. I would
> appreciate it if someone
> could repeat the experiment with the attached data set and let me know where
> I might be mistaken!
>
> Thanks,
> Rick Reeves
>
> --
> Rick Reeves
> Scientific Programmer/Analyst and Data Manager
> National Center for Ecological Analysis and Synthesis
> UC Santa Barbara
> www.nceas.ucsb.edu
> 805 892 2533
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From Bjarke.Christensen at sydbank.dk  Fri Aug 28 13:13:33 2009
From: Bjarke.Christensen at sydbank.dk (Bjarke Christensen)
Date: Fri, 28 Aug 2009 13:13:33 +0200
Subject: [R-sig-Geo] Preparing KML files for GoogleMaps/Earth: Why no
 kmlPoint() in maptools package?
In-Reply-To: <mailman.15.1251453603.29552.r-sig-geo@stat.math.ethz.ch>
Message-ID: <OFE9DC93DF.C100D6CC-ONC1257620.003C0D47-C1257620.003DAA19@bdpnet.dk>

On Wed, Aug 26, 2009 at 11:58 AM, rick reeves<reeves at nceas.ucsb.edu> wrote:
> Hello List:
>
> I'm investigating ways to convert Shape Files to KML format...

I wrote and use these functions: http://www.ssbsk.dk/start/kmlfunctions.r

They work well for me, but no guarantees offered of course. They were not
really programmed for public release, so defaults are as I prefer them (for
instance, default placemarks for SpatialPoints are a little square with a
dot in the middle, instead of the ghastly yellow pins that are Google Earth
default).

They rely on the XML package by Duncan Temple Lang, the Windows binary of
which is not available from CRAN (as I recall, Brian Ripley has made a
windows binary available on a website somewhere). MacOS X binaries are on
CRAN, as is the package source.

Bjarke Christensen


From alexandre.villers at cebc.cnrs.fr  Fri Aug 28 17:16:12 2009
From: alexandre.villers at cebc.cnrs.fr (Alexandre VILLERS)
Date: Fri, 28 Aug 2009 17:16:12 +0200
Subject: [R-sig-Geo] r.neighbors with execGRASS
Message-ID: <4A97F4BC.6000002@cebc.cnrs.fr>

An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090828/7fec4b1f/attachment.html>

From milton.ruser at gmail.com  Fri Aug 28 19:14:49 2009
From: milton.ruser at gmail.com (milton ruser)
Date: Fri, 28 Aug 2009 13:14:49 -0400
Subject: [R-sig-Geo] r.neighbors with execGRASS
In-Reply-To: <4A97F4BC.6000002@cebc.cnrs.fr>
References: <4A97F4BC.6000002@cebc.cnrs.fr>
Message-ID: <3aaf1a030908281014k6d3d52dcwd2766dbe06a316fe@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090828/da7969f7/attachment.pl>

From Roger.Bivand at nhh.no  Fri Aug 28 23:43:07 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 28 Aug 2009 23:43:07 +0200 (CEST)
Subject: [R-sig-Geo] r.neighbors with execGRASS
In-Reply-To: <4A97F4BC.6000002@cebc.cnrs.fr>
References: <4A97F4BC.6000002@cebc.cnrs.fr>
Message-ID: <alpine.LRH.2.00.0908282340290.4592@reclus.nhh.no>

On Fri, 28 Aug 2009, Alexandre VILLERS wrote:

> Goord afternoon,
> 
> I have a bunch of ascii files to smooth and I wanted to start using spgrass6
> (and then looping with GRASS routines).
> So here is a piece of the code I'm using
> 
> loc<-initGRASS("C:/GRASS", home=tempdir(), override=T)?
> execGRASS("r.in.gdal", flags="o",
> parameters=list(input="M:\\MODIS_temp\\PC2000_049.250m_16_days_NDVI.tif",
> output="ref"))? # import of a reference file for the region
> 
> execGRASS("g.region", flags="p", parameters=list(rast="ref")) # define the
> region settings with the characteristics of "ref"
> execGRASS("r.in.gdal", flags="o", parameters=list(input=paste(getwd(), "\\",
> "file1.asc", sep=""), output="temp"))? #import the first ascii file and
> names it "temp"
> execGRASS("r.neighbors", flags="c", parameters=list(input="temp",
> output="tempL", method="average", size=9)???? # tries to apply a circular
> r.neighbors function on temp with a width of 9 cells
> 
> Erreur dans doGRASS(cmd, flags = flags, parameters = parameters) :
> ? Parameter <size> does not have integer value
> 
> How comes that 9 is not considered as an integer value ? Or did I miss
> something ?

Coerce with as.integer(9), as just 9 may be ambiguous - it may take 
storage mode double. In addition, add the closing parenthesis as Milton 
suggested if it didn't just disappear in copying to the message.

Roger

> 
> Thanks for any hint !
> 
> Alex
> 
> P.S.: execGRASS("r.info", parameters=list(map="temp"))
> 
> +--------------------------------------------------------------------------
> --+
> ?| Layer:??? temp?????????????????????????? Date: Fri Aug 28 16:46:47
> 2009??? |
> ?| Mapset:?? filecb94b5f??????????????????? Login of Creator:
> villers???????? |
> ?| Location:
> filea6d66e1????????????????????????????????????????????????????? |
> ?| DataBase:
> C:/DOCUME~1/villers/LOCALS~1/Temp/RtmpAg4EG2???????????????????? |
> ?| Title:???? ( temp
> )??????????????????????????????????????????????????????? |
> ?| Timestamp:
> none??????????????????????????????????????????????????????????? |
> ?|-------------------------------------------------------------------------
> ---|
> ?|????????????????????????????????????????????????????????????????????????
?? ??? |
> ?|?? Type of Map:? raster?????????????? Number of Categories:
> 9973??????????? |
> ?|?? Data Type:???
> CELL?????????????????????????????????????????????????????? |
> ?|?? Rows:????????
> 1123?????????????????????????????????????????????????????? |
> ?|?? Columns:?????
> 1205?????????????????????????????????????????????????????? |
> ?|?? Total Cells:?
> 1353215??????????????????????????????????????????????????? |
> ?|??????? Projection:
> x,y???????????????????????????????????????????????????? |
> ?|??????????? N:???? 280626??? S:?????? -124?? Res:??
> 250???????????????????? |
> ?|??????????? E:???? 301126??? W:?????? -124?? Res:??
> 250???????????????????? |
> ?|?? Range of data:??? min = -2000? max =
> 9973??????????????????????????????? |
> ?|????????????????????????????????????????????????????????????????????????
?? ??? |
> ?|?? Data
> Description:??????????????????????????????????????????????????????? |
> ?|??? generated by
> RINGDA~1?????????????????????????????????????????????????? |
> ?|????????????????????????????????????????????????????????????????????????
?? ??? |
> ?|??
> Comments:??????????????????????????????????????????????????????????????? |
> ?|??? RINGDA~1 -o input="M:/MODIS_temp\PC2000_049.asc"
> output="temp"????????? |
> ?|????????????????????????????????????????????????????????????????????????
?? ??? |
> ?+-------------------------------------------------------------------------
> ---+
> --
> 
> Alexandre Villers
> PhD Student
> Team "Biodiversity"
> Centre d'Etudes Biologiques de Chiz?-CNRS UPR1934
> 79360 Beauvoir sur Niort
> 
> Phone +33 (0)5 49 09 96 13
> Fax   +33 (0)5 49 09 65 26
> 
> 
> __________ Information from ESET Mail Security, version of virus signature
> database 4377 (20090828) __________
> 
> The message was checked by ESET Mail Security.
> http://www.eset.com
> 
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From alexandre.villers at cebc.cnrs.fr  Sat Aug 29 08:18:55 2009
From: alexandre.villers at cebc.cnrs.fr (alexandre villers)
Date: Sat, 29 Aug 2009 08:18:55 +0200
Subject: [R-sig-Geo] r.neighbors with execGRASS
Message-ID: <1251526735.8366eccalexandre.villers@cebc.cnrs.fr>

Thank you Roger,

sometimes the answer is right in front of us !!! I did try as.numeric(9), thinking it could be linked to a format problem but did not even consider as.integer().
Now, the loop works fine... 

Thank you very much.

Alex

-----Original Message-----
From: Roger Bivand <Roger.Bivand at nhh.no>
To: Alexandre VILLERS <alexandre.villers at cebc.cnrs.fr>
Date: Fri, 28 Aug 2009 23:43:07 +0200 (CEST)
Subject: Re: [R-sig-Geo] r.neighbors with execGRASS

On Fri, 28 Aug 2009, Alexandre VILLERS wrote:

> Goord afternoon,
> 
> I have a bunch of ascii files to smooth and I wanted to start using spgrass6
> (and then looping with GRASS routines).
> So here is a piece of the code I'm using
> 
> loc<-initGRASS("C:/GRASS", home=tempdir(), override=T)?
> execGRASS("r.in.gdal", flags="o",
> parameters=list(input="M:\\MODIS_temp\\PC2000_049.250m_16_days_NDVI.tif",
> output="ref"))? # import of a reference file for the region
> 
> execGRASS("g.region", flags="p", parameters=list(rast="ref")) # define the
> region settings with the characteristics of "ref"
> execGRASS("r.in.gdal", flags="o", parameters=list(input=paste(getwd(), "\\",
> "file1.asc", sep=""), output="temp"))? #import the first ascii file and
> names it "temp"
> execGRASS("r.neighbors", flags="c", parameters=list(input="temp",
> output="tempL", method="average", size=9)???? # tries to apply a circular
> r.neighbors function on temp with a width of 9 cells
> 
> Erreur dans doGRASS(cmd, flags = flags, parameters = parameters) :
> ? Parameter <size> does not have integer value
> 
> How comes that 9 is not considered as an integer value ? Or did I miss
> something ?

Coerce with as.integer(9), as just 9 may be ambiguous - it may take 
storage mode double. In addition, add the closing parenthesis as Milton 
suggested if it didn't just disappear in copying to the message.

Roger

> 
> Thanks for any hint !
> 
> Alex
> 
> P.S.: execGRASS("r.info", parameters=list(map="temp"))
> 
> +--------------------------------------------------------------------------
> --+
> ?| Layer:??? temp?????????????????????????? Date: Fri Aug 28 16:46:47
> 2009??? |
> ?| Mapset:?? filecb94b5f??????????????????? Login of Creator:
> villers???????? |
> ?| Location:
> filea6d66e1????????????????????????????????????????????????????? |
> ?| DataBase:
> C:/DOCUME~1/villers/LOCALS~1/Temp/RtmpAg4EG2???????????????????? |
> ?| Title:???? ( temp
> )??????????????????????????????????????????????????????? |
> ?| Timestamp:
> none??????????????????????????????????????????????????????????? |
> ?|-------------------------------------------------------------------------
> ---|
> ?|????????????????????????????????????????????????????????????????????????
?? ??? |
> ?|?? Type of Map:? raster?????????????? Number of Categories:
> 9973??????????? |
> ?|?? Data Type:???
> CELL?????????????????????????????????????????????????????? |
> ?|?? Rows:????????
> 1123?????????????????????????????????????????????????????? |
> ?|?? Columns:?????
> 1205?????????????????????????????????????????????????????? |
> ?|?? Total Cells:?
> 1353215??????????????????????????????????????????????????? |
> ?|??????? Projection:
> x,y???????????????????????????????????????????????????? |
> ?|??????????? N:???? 280626??? S:?????? -124?? Res:??
> 250???????????????????? |
> ?|??????????? E:???? 301126??? W:?????? -124?? Res:??
> 250???????????????????? |
> ?|?? Range of data:??? min = -2000? max =
> 9973??????????????????????????????? |
> ?|????????????????????????????????????????????????????????????????????????
?? ??? |
> ?|?? Data
> Description:??????????????????????????????????????????????????????? |
> ?|??? generated by
> RINGDA~1?????????????????????????????????????????????????? |
> ?|????????????????????????????????????????????????????????????????????????
?? ??? |
> ?|??
> Comments:??????????????????????????????????????????????????????????????? |
> ?|??? RINGDA~1 -o input="M:/MODIS_temp\PC2000_049.asc"
> output="temp"????????? |
> ?|????????????????????????????????????????????????????????????????????????
?? ??? |
> ?+-------------------------------------------------------------------------
> ---+
> --
> 
> Alexandre Villers
> PhD Student
> Team "Biodiversity"
> Centre d'Etudes Biologiques de Chiz?-CNRS UPR1934
> 79360 Beauvoir sur Niort
> 
> Phone +33 (0)5 49 09 96 13
> Fax   +33 (0)5 49 09 65 26
> 
> 
> __________ Information from ESET Mail Security, version of virus signature
> database 4377 (20090828) __________
> 
> The message was checked by ESET Mail Security.
> http://www.eset.com
> 
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


Alexandre Villers
PhD. Student
Team Biodiversity
CEBC CNRS
79360 Beauvoir sur Niort


__________ Information from ESET Mail Security, version of virus signature database 4378 (20090828) __________

The message was checked by ESET Mail Security.
http://www.eset.com


From alexandre.villers at cebc.cnrs.fr  Sat Aug 29 12:12:54 2009
From: alexandre.villers at cebc.cnrs.fr (alexandre villers)
Date: Sat, 29 Aug 2009 12:12:54 +0200
Subject: [R-sig-Geo] NA values with r.neighbors GRASS
Message-ID: <1251540774.836dba4alexandre.villers@cebc.cnrs.fr>

Good morning,

There is something obscure with r.neighbors.
Here is the code

execGRASS("r.in.gdal", flags=c("o"), parameters=list(input=paste(getwd(), "/", listASC[i], sep=""), output="temp"))      
execGRASS("r.null",parameters=list(map="temp",setnull=c("-9999")))#to make sure that NA values (data on the Atlantic ocean) from the ASCII file are interpreted correctly 
execGRASS("r.neighbors", flags="c", parameters=list(input="ref", output="tempL", method="average", size=as.integer(9)))

when checking the output file (either with r.out.gdal or readRAST6), NA values got the value -2999 after the r.neighbors routine and, which is more annoying, cells at the edge (on the coast) were averaged with those value of -2999.

I suppose r.neighbors can not average pixel value when surrounding pixels are empty but could someone confirm me this is really the case ?
Is there a way to keep NA values as NAs (and not -2999) or do I need to modify those values after r.neighbors?

I looked through the r.neighbors documentation but there is nothing, unless I missed it, on the handling of NAs for this routine.

Thanks for your help.

Alex

Alexandre Villers
PhD. Student
Team Biodiversity
CEBC CNRS
79360 Beauvoir sur Niort


__________ Information from ESET Mail Security, version of virus signature database 4378 (20090828) __________

The message was checked by ESET Mail Security.
http://www.eset.com


From mwkhan at ucdavis.edu  Mon Aug 31 03:29:40 2009
From: mwkhan at ucdavis.edu (Mehdi Khan)
Date: Sun, 30 Aug 2009 18:29:40 -0700
Subject: [R-sig-Geo] Accuracy and limitations of Raster and Vector maps
Message-ID: <60b3892e0908301829p19a4ce93s87da23ccf8ec84b3@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090830/2a5fb693/attachment.pl>

From r.hijmans at gmail.com  Mon Aug 31 06:37:35 2009
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Sun, 30 Aug 2009 21:37:35 -0700
Subject: [R-sig-Geo] Accuracy and limitations of Raster and Vector maps
In-Reply-To: <60b3892e0908301829p19a4ce93s87da23ccf8ec84b3@mail.gmail.com>
References: <60b3892e0908301829p19a4ce93s87da23ccf8ec84b3@mail.gmail.com>
Message-ID: <dc22b2570908302137m3d8bd410p465ae0f32fc44ad1@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090830/155167a4/attachment.pl>

From mwkhan at ucdavis.edu  Mon Aug 31 07:36:22 2009
From: mwkhan at ucdavis.edu (Mehdi Khan)
Date: Sun, 30 Aug 2009 22:36:22 -0700
Subject: [R-sig-Geo] Accuracy and limitations of Raster and Vector maps
In-Reply-To: <dc22b2570908302137m3d8bd410p465ae0f32fc44ad1@mail.gmail.com>
References: <60b3892e0908301829p19a4ce93s87da23ccf8ec84b3@mail.gmail.com> 
	<dc22b2570908302137m3d8bd410p465ae0f32fc44ad1@mail.gmail.com>
Message-ID: <60b3892e0908302236w3fe085e7t62d0114de4eb152@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090830/c5bec27c/attachment.pl>

From mwkhan at ucdavis.edu  Mon Aug 31 07:45:20 2009
From: mwkhan at ucdavis.edu (Mehdi Khan)
Date: Sun, 30 Aug 2009 22:45:20 -0700
Subject: [R-sig-Geo] Accuracy and limitations of Raster and Vector maps
In-Reply-To: <60b3892e0908302236w3fe085e7t62d0114de4eb152@mail.gmail.com>
References: <60b3892e0908301829p19a4ce93s87da23ccf8ec84b3@mail.gmail.com> 
	<dc22b2570908302137m3d8bd410p465ae0f32fc44ad1@mail.gmail.com> 
	<60b3892e0908302236w3fe085e7t62d0114de4eb152@mail.gmail.com>
Message-ID: <60b3892e0908302245l6002e0fap3a50dbd210f96d15@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090830/540b6bcf/attachment.pl>

From edzer.pebesma at uni-muenster.de  Mon Aug 31 09:37:10 2009
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Mon, 31 Aug 2009 09:37:10 +0200
Subject: [R-sig-Geo] Accuracy and limitations of Raster and Vector maps
In-Reply-To: <60b3892e0908301829p19a4ce93s87da23ccf8ec84b3@mail.gmail.com>
References: <60b3892e0908301829p19a4ce93s87da23ccf8ec84b3@mail.gmail.com>
Message-ID: <4A9B7DA6.7000703@uni-muenster.de>

I am not sure if I can follow your reasoning. The function
SpatialGridDataFrame tries to form a grid from a set of points. In the
earlier example output you sent, it seemed that the set of points you
had were not exactly on a grid. Look at the following two examples:

> library(sp)
> pts1 = data.frame(x = rnorm(10),y = rnorm(10), z = rnorm(10))
> gridded(pts1) = ~x+y
suggested tolerance minimum: 0.758031516672908
Error in points2grid(points, tolerance, round, fuzz.tol) :
  dimension 1 : coordinate intervals are not constant
> pts2 = data.frame(expand.grid(x=1:10,y=1:10),z=rnorm(100))
> gridded(pts2) = ~x+y
> points2grid(pts2)
                   x  y
cellcentre.offset  1  1
cellsize           1  1
cells.dim         10 10

It is clear that for pts1 it is complete nonsense to try to find a grid
structure, as it is not there. For the second one it is there by
construction -- expand.grid does this.

For cases where data are almost on a grid, but not exactly (often
because of rounding of coordinates that are not round numbers but
written to ascii text), points2grid tries to find a useful grid
topology, but may fail. You can enlarge its tolerance to help it find
one, but no success guaranteed.

If you want to compare overlays, you better make sure you have a real
and identical grid in both environments (R and ArcGIS), and do the
overlay in both. In R, this is done with the overlay method.
--
Edzer

Mehdi Khan wrote:
> Hello everyone, I am trying to investigate what the shortcomings may be of
> using vectors/ rasters in determining attribute data from one program to
> another.  My project has entailed overlaying points on different maps
> (vector as well as raster based) and then determining attribute data from
> each one and comparing them against one another.
> 
> What would the limitations be in this process?  From what I understand, one
> of the limitations is that there are tolerance limits within the program
> which are used to assign points from one pixel to another.  I don't fully
> understand this concept-- why would one need a tolerance when determining if
> a point is within a square or outside of it?
> 
> thank you all for your help!
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763 http://ifgi.uni-muenster.de/
http://www.springer.com/978-0-387-78170-9 e.pebesma at wwu.de


From mwkhan at ucdavis.edu  Mon Aug 31 09:55:49 2009
From: mwkhan at ucdavis.edu (Mehdi Khan)
Date: Mon, 31 Aug 2009 00:55:49 -0700
Subject: [R-sig-Geo] Accuracy and limitations of Raster and Vector maps
In-Reply-To: <4A9B7DA6.7000703@uni-muenster.de>
References: <60b3892e0908301829p19a4ce93s87da23ccf8ec84b3@mail.gmail.com> 
	<4A9B7DA6.7000703@uni-muenster.de>
Message-ID: <60b3892e0908310055x5e78b5e1i210a5c2b17a4a4db@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090831/0bf64869/attachment.pl>

From mwkhan at ucdavis.edu  Mon Aug 31 09:56:54 2009
From: mwkhan at ucdavis.edu (Mehdi Khan)
Date: Mon, 31 Aug 2009 00:56:54 -0700
Subject: [R-sig-Geo] Accuracy and limitations of Raster and Vector maps
In-Reply-To: <60b3892e0908310055x5e78b5e1i210a5c2b17a4a4db@mail.gmail.com>
References: <60b3892e0908301829p19a4ce93s87da23ccf8ec84b3@mail.gmail.com> 
	<4A9B7DA6.7000703@uni-muenster.de>
	<60b3892e0908310055x5e78b5e1i210a5c2b17a4a4db@mail.gmail.com>
Message-ID: <60b3892e0908310056r60379df0qfcc1cc2b5ac98aa4@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090831/98eb0417/attachment.pl>

From edzer.pebesma at uni-muenster.de  Mon Aug 31 10:12:20 2009
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Mon, 31 Aug 2009 10:12:20 +0200
Subject: [R-sig-Geo] Accuracy and limitations of Raster and Vector maps
In-Reply-To: <60b3892e0908310055x5e78b5e1i210a5c2b17a4a4db@mail.gmail.com>
References: <60b3892e0908301829p19a4ce93s87da23ccf8ec84b3@mail.gmail.com>
	<4A9B7DA6.7000703@uni-muenster.de>
	<60b3892e0908310055x5e78b5e1i210a5c2b17a4a4db@mail.gmail.com>
Message-ID: <4A9B85E4.4090901@uni-muenster.de>



Mehdi Khan wrote:
> For that specific problem, this is what I ended up doing:
>
> wald <- SpatialPixelsDataFrame(coordinates(wald),
> as.data.frame(wald)[,3,drop = FALSE], tolerance = 0.125)
>
> So what does this mean exactly?  that since it wasn't an exact grid, a
> tolerance was specified to "straighten" curves into a grid structure? 
Yes.

If you want to compare the coordinates, safe the result to wald1 (so
that wald is still there), and compare coordinates(wald1) to
coordinates(wald).

If you want to see what went on, type points2grid and you'll see what
the function did.
--
Edzer
>  I
> appreciate your help, my experience only goes back 8 weeks or so with this
> program.
>
>
> Mehdi Khan
>
>
> On Mon, Aug 31, 2009 at 12:37 AM, Edzer Pebesma <
> edzer.pebesma at uni-muenster.de> wrote:
>
>   
>> I am not sure if I can follow your reasoning. The function
>> SpatialGridDataFrame tries to form a grid from a set of points. In the
>> earlier example output you sent, it seemed that the set of points you
>> had were not exactly on a grid. Look at the following two examples:
>>
>>     
>>> library(sp)
>>> pts1 = data.frame(x = rnorm(10),y = rnorm(10), z = rnorm(10))
>>> gridded(pts1) = ~x+y
>>>       
>> suggested tolerance minimum: 0.758031516672908
>> Error in points2grid(points, tolerance, round, fuzz.tol) :
>>  dimension 1 : coordinate intervals are not constant
>>     
>>> pts2 = data.frame(expand.grid(x=1:10,y=1:10),z=rnorm(100))
>>> gridded(pts2) = ~x+y
>>> points2grid(pts2)
>>>       
>>                   x  y
>> cellcentre.offset  1  1
>> cellsize           1  1
>> cells.dim         10 10
>>
>> It is clear that for pts1 it is complete nonsense to try to find a grid
>> structure, as it is not there. For the second one it is there by
>> construction -- expand.grid does this.
>>
>> For cases where data are almost on a grid, but not exactly (often
>> because of rounding of coordinates that are not round numbers but
>> written to ascii text), points2grid tries to find a useful grid
>> topology, but may fail. You can enlarge its tolerance to help it find
>> one, but no success guaranteed.
>>
>> If you want to compare overlays, you better make sure you have a real
>> and identical grid in both environments (R and ArcGIS), and do the
>> overlay in both. In R, this is done with the overlay method.
>> --
>> Edzer
>>
>> Mehdi Khan wrote:
>>     
>>> Hello everyone, I am trying to investigate what the shortcomings may be
>>>       
>> of
>>     
>>> using vectors/ rasters in determining attribute data from one program to
>>> another.  My project has entailed overlaying points on different maps
>>> (vector as well as raster based) and then determining attribute data from
>>> each one and comparing them against one another.
>>>
>>> What would the limitations be in this process?  From what I understand,
>>>       
>> one
>>     
>>> of the limitations is that there are tolerance limits within the program
>>> which are used to assign points from one pixel to another.  I don't fully
>>> understand this concept-- why would one need a tolerance when determining
>>>       
>> if
>>     
>>> a point is within a square or outside of it?
>>>
>>> thank you all for your help!
>>>
>>>       [[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>       
>> --
>> Edzer Pebesma
>> Institute for Geoinformatics (ifgi), University of M?nster
>> Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
>> 8333081, Fax: +49 251 8339763 http://ifgi.uni-muenster.de/
>> http://www.springer.com/978-0-387-78170-9 e.pebesma at wwu.de
>>
>>     
>
>   

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763 http://ifgi.uni-muenster.de/
http://www.springer.com/978-0-387-78170-9 e.pebesma at wwu.de


From Tim.Haering at lwf.bayern.de  Mon Aug 31 10:44:26 2009
From: Tim.Haering at lwf.bayern.de (=?iso-8859-1?Q?=22H=E4ring=2C_Tim_=28LWF=29=22?=)
Date: Mon, 31 Aug 2009 10:44:26 +0200
Subject: [R-sig-Geo] writeGDAL produce strage value range
Message-ID: <70FC67C4A585D1489E66225A4E0238BA43CBA2@RZS-EXC-CL06.rz-sued.bayern.de>

Hello List !

With writeGDAL I exported a grid as Erdas Imagine Image: 
writeGDAL(mygrid, fname = "grid6426.img", driver = "HFA",
 type = "Float32")

If I open this Image in ArcGIS all I see is a solid black box with a strange value range from 1.7549e-038 to 3.40282e+038. I can identify the values of single grid-cells and see that the values in my grid were right. But all I see is a black rectangle.

Is this a RGDAL/GDAL problem or is it a ArcGIS problem? Maybe there is someone having the same problem - and hopefully with a solution.

Thanks!

Cheers,
TIM

------------------------------------------------------- 
Tim H?ring
Bavarian State Institute of Forest Research 
Department of Forest Ecology
Am Hochanger 11
D-85354 Freising

http://www.lwf.bayern.de


From Roger.Bivand at nhh.no  Mon Aug 31 10:56:39 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 31 Aug 2009 10:56:39 +0200 (CEST)
Subject: [R-sig-Geo] writeGDAL produce strage value range
In-Reply-To: <70FC67C4A585D1489E66225A4E0238BA43CBA2@RZS-EXC-CL06.rz-sued.bayern.de>
References: <70FC67C4A585D1489E66225A4E0238BA43CBA2@RZS-EXC-CL06.rz-sued.bayern.de>
Message-ID: <alpine.LRH.2.00.0908311051450.19638@reclus.nhh.no>

On Mon, 31 Aug 2009, "H?ring, Tim (LWF)" wrote:

> Hello List !
>
> With writeGDAL I exported a grid as Erdas Imagine Image:
> writeGDAL(mygrid, fname = "grid6426.img", driver = "HFA",
> type = "Float32")
>
> If I open this Image in ArcGIS all I see is a solid black box with a strange value range from 1.7549e-038 to 3.40282e+038. I can identify the values of single grid-cells and see that the values in my grid were right. But all I see is a black rectangle.
>
> Is this a RGDAL/GDAL problem or is it a ArcGIS problem? Maybe there is 
> someone having the same problem - and hopefully with a solution.

ArcGIS typically makes assumptions about symbology that may not be what 
you intend. Make sure that it is displayed in classified mode. If need be, 
build the statistics first using the appropriate toolbox function. This 
also used to be an issue with GTiff. You may also need to use create 
options to find the style of file that ArcGIS likes least poorly, review:

http://www.gdal.org/frmt_hfa.html

Roger

>
> Thanks!
>
> Cheers,
> TIM
>
> -------------------------------------------------------
> Tim H?ring
> Bavarian State Institute of Forest Research
> Department of Forest Ecology
> Am Hochanger 11
> D-85354 Freising
>
> http://www.lwf.bayern.de
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From jmburgos at u.washington.edu  Mon Aug 31 13:04:13 2009
From: jmburgos at u.washington.edu (Julian Burgos)
Date: Mon, 31 Aug 2009 11:04:13 +0000
Subject: [R-sig-Geo] Rotate SpatialPointsDataFrame and convert to raster
Message-ID: <4A9BAE2D.1050706@u.washington.edu>

Dear list,

Hopefully this question will not be too basic.  I have a relatively 
large dataset (~250000 rows) consisting of lat, long and a data value.  
The data has been collected in a regular grid, but the grid is 
"tilted".  In other words, along a row the latitude values increase 
constantly, and along a column the longitude values do the same.  The 
tilt is very slight, but large enough to cause problems when trying to 
convert the SpatialPointsDataFrame object holding the data to a 
SpatialPixels objects.  My ultimate objective is to convert this data to 
a raster file and input it to GRASS.
Any ideas on how to solve this problem?  Is is possible to create raster 
images with a "tilted" grid?
Many thanks,

Julian

-- 

Julian Mariano Burgos
Hafranns?knastofnunin/Marine Research Institute
Sk?lagata 4, 121 Reykjav?k, Iceland
S?mi/Telephone : +354-5752037
Br?fs?mi/Telefax:  +354-5752001
Netfang/Email: julian at hafro.is, jmburgos at u.washington.edu


From Monir.Hossain at uth.tmc.edu  Mon Aug 31 15:26:43 2009
From: Monir.Hossain at uth.tmc.edu (Hossain, Md Monir)
Date: Mon, 31 Aug 2009 08:26:43 -0500
Subject: [R-sig-Geo] Spatial correlation for nominal variable
Message-ID: <FE012FDB2E167148A07CBDE554B3F3A1093DCF0AB3@UTHCMS2.uthouston.edu>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090831/ca943b5c/attachment.pl>

From Tim.Haering at lwf.bayern.de  Mon Aug 31 15:50:06 2009
From: Tim.Haering at lwf.bayern.de (=?iso-8859-1?Q?=22H=E4ring=2C_Tim_=28LWF=29=22?=)
Date: Mon, 31 Aug 2009 15:50:06 +0200
Subject: [R-sig-Geo] majority filter for grids
Message-ID: <70FC67C4A585D1489E66225A4E0238BA43CC7C@RZS-EXC-CL06.rz-sued.bayern.de>

Dear List,

I have a grid as SpatialGridDataFrame with a classified (nominal) attribute and I want to filter this grid in R with a majority filter. I searched the mailing list archive and googled around but I think I?m on the wrong track. 
There are several filters for numeric attributes (mean, median, min, max, gaussian ...) but I didn`t find a way to filter a nominal attribute. I think there has to be a way to do this in R, because it is a day-to-day task in remote sensing.

Is there anybody in the R-Sig-Geo world who solved this problem?
I would be glad to have your explanation.

Thanks a lot.

Cheers,
TIM

---------------------------------------------- 
Tim H?ring
Bavarian State Institute of Forest Research 
Department of Forest Ecology
Am Hochanger 11
D-85354 Freising

http://www.lwf.bayern.de


From p.hiemstra at geo.uu.nl  Mon Aug 31 16:26:59 2009
From: p.hiemstra at geo.uu.nl (Paul Hiemstra)
Date: Mon, 31 Aug 2009 16:26:59 +0200
Subject: [R-sig-Geo] majority filter for grids
In-Reply-To: <70FC67C4A585D1489E66225A4E0238BA43CC7C@RZS-EXC-CL06.rz-sued.bayern.de>
References: <70FC67C4A585D1489E66225A4E0238BA43CC7C@RZS-EXC-CL06.rz-sued.bayern.de>
Message-ID: <4A9BDDB3.2050709@geo.uu.nl>

Hi,

A while back I posted the code for a lowpass filter to the mailing list

http://markmail.org/message/y2vz42c3zbs2llrl#query:r-sig-geo%20smoothing+page:1+mid:fqt6wbgojnawmfnb+state:results

This code could probably be adapted to suit your needs.

cheers and hope this helps,
Paul

H?ring, Tim (LWF) wrote:
> Dear List,
>
> I have a grid as SpatialGridDataFrame with a classified (nominal) attribute and I want to filter this grid in R with a majority filter. I searched the mailing list archive and googled around but I think I?m on the wrong track. 
> There are several filters for numeric attributes (mean, median, min, max, gaussian ...) but I didn`t find a way to filter a nominal attribute. I think there has to be a way to do this in R, because it is a day-to-day task in remote sensing.
>
> Is there anybody in the R-Sig-Geo world who solved this problem?
> I would be glad to have your explanation.
>
> Thanks a lot.
>
> Cheers,
> TIM
>
> ---------------------------------------------- 
> Tim H?ring
> Bavarian State Institute of Forest Research 
> Department of Forest Ecology
> Am Hochanger 11
> D-85354 Freising
>
> http://www.lwf.bayern.de
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>   


-- 
Drs. Paul Hiemstra
Department of Physical Geography
Faculty of Geosciences
University of Utrecht
Heidelberglaan 2
P.O. Box 80.115
3508 TC Utrecht
Phone:  +3130 274 3113 Mon-Tue
Phone:  +3130 253 5773 Wed-Fri
http://intamap.geo.uu.nl/~paul


From milton.ruser at gmail.com  Mon Aug 31 18:43:46 2009
From: milton.ruser at gmail.com (milton ruser)
Date: Mon, 31 Aug 2009 12:43:46 -0400
Subject: [R-sig-Geo] writeGDAL produce strage value range
In-Reply-To: <alpine.LRH.2.00.0908311051450.19638@reclus.nhh.no>
References: <70FC67C4A585D1489E66225A4E0238BA43CBA2@RZS-EXC-CL06.rz-sued.bayern.de>
	<alpine.LRH.2.00.0908311051450.19638@reclus.nhh.no>
Message-ID: <3aaf1a030908310943q5c6b474wd6600e73e3af08e1@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090831/d7bdd86e/attachment.pl>

