From pierluigi.derosa at gmail.com  Mon Sep  2 16:32:15 2013
From: pierluigi.derosa at gmail.com (pierluigi de rosa)
Date: Mon, 2 Sep 2013 16:32:15 +0200
Subject: [R-sig-Geo] extract point values from contour lines
Message-ID: <CAAgsrZjL+iBj3meDGdHUwhbVJhEDXA02X0H+2JuXHJng6NG2mQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130902/e914e94e/attachment.pl>

From carotenuto_francesco at yahoo.it  Tue Sep  3 12:25:33 2013
From: carotenuto_francesco at yahoo.it (Francesco Carotenuto)
Date: Tue, 3 Sep 2013 11:25:33 +0100 (BST)
Subject: [R-sig-Geo] From "ashape" to spatial polygon
Message-ID: <1378203933.92271.YahooMailNeo@web133001.mail.ir2.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130903/fd5c5d03/attachment.pl>

From roman.lustrik at gmail.com  Tue Sep  3 12:30:45 2013
From: roman.lustrik at gmail.com (=?UTF-8?Q?Roman_Lu=C5=A1trik?=)
Date: Tue, 3 Sep 2013 12:30:45 +0200
Subject: [R-sig-Geo] From "ashape" to spatial polygon
In-Reply-To: <1378203933.92271.YahooMailNeo@web133001.mail.ir2.yahoo.com>
References: <1378203933.92271.YahooMailNeo@web133001.mail.ir2.yahoo.com>
Message-ID: <CAHT1vpia_J0+kyRft3QfwyY=aFsxmd3VHd3cWhX-wgT20qAatQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130903/16791b61/attachment.pl>

From mdsumner at gmail.com  Tue Sep  3 14:09:41 2013
From: mdsumner at gmail.com (Michael Sumner)
Date: Tue, 3 Sep 2013 22:09:41 +1000
Subject: [R-sig-Geo] From "ashape" to spatial polygon
In-Reply-To: <1378203933.92271.YahooMailNeo@web133001.mail.ir2.yahoo.com>
References: <1378203933.92271.YahooMailNeo@web133001.mail.ir2.yahoo.com>
Message-ID: <CAAcGz99D0hfuBFjXDhnzbWJF-81_W8DUCiZE13Wja=HXy-rzLw@mail.gmail.com>

I found a few discussions just by searching terms:

https://stat.ethz.ch/pipermail/r-sig-geo/2012-March/014409.html

http://casoilresource.lawr.ucdavis.edu/drupal/book/export/html/519



On Tue, Sep 3, 2013 at 8:25 PM, Francesco Carotenuto
<carotenuto_francesco at yahoo.it> wrote:
> Hi, is there a way to convert an "ashape" object (object class of package alphahull) into a spatial polygon? I need only the alpha hull object (the external contour) and not the delaunay triangles. If not, is there a way to simply create a single spatial polygon from a matrix containing xy coordinates?
> Thanks
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



-- 
Michael Sumner
Hobart, Australia
e-mail: mdsumner at gmail.com


From nicole.ks.barker at gmail.com  Tue Sep  3 14:43:08 2013
From: nicole.ks.barker at gmail.com (Nicole K.S. Barker)
Date: Tue, 3 Sep 2013 08:43:08 -0400
Subject: [R-sig-Geo] From "ashape" to spatial polygon
In-Reply-To: <CAAcGz99D0hfuBFjXDhnzbWJF-81_W8DUCiZE13Wja=HXy-rzLw@mail.gmail.com>
References: <1378203933.92271.YahooMailNeo@web133001.mail.ir2.yahoo.com>
	<CAAcGz99D0hfuBFjXDhnzbWJF-81_W8DUCiZE13Wja=HXy-rzLw@mail.gmail.com>
Message-ID: <CAE8MAJmmtG6qWK=TjrkLa1MgbyMuEitVfL5X41aMndS_yusj7w@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130903/f6301f3f/attachment.pl>

From carotenuto_francesco at yahoo.it  Tue Sep  3 15:39:01 2013
From: carotenuto_francesco at yahoo.it (Francesco Carotenuto)
Date: Tue, 3 Sep 2013 14:39:01 +0100 (BST)
Subject: [R-sig-Geo] From "ashape" to spatial polygon
In-Reply-To: <1378203933.92271.YahooMailNeo@web133001.mail.ir2.yahoo.com>
References: <1378203933.92271.YahooMailNeo@web133001.mail.ir2.yahoo.com>
Message-ID: <1378215541.58381.YahooMailNeo@web133006.mail.ir2.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130903/58cdd4ab/attachment.pl>

From Dominik.Schneider at colorado.edu  Tue Sep  3 16:33:06 2013
From: Dominik.Schneider at colorado.edu (Dominik Schneider)
Date: Tue, 3 Sep 2013 08:33:06 -0600
Subject: [R-sig-Geo] coordinate system in ncdf4
In-Reply-To: <CAAcGz99C5kGXJR7AjZK5yZw66_gC5wUbPo6JZf3gV-m7kGpM_A@mail.gmail.com>
References: <CAHYDKLaxO_Aqy8z4Q2a3HRuaFgAjXEPc6fQOtD+Sjj8tQbxqjw@mail.gmail.com>
	<CAAcGz99C5kGXJR7AjZK5yZw66_gC5wUbPo6JZf3gV-m7kGpM_A@mail.gmail.com>
Message-ID: <CAHYDKLbc=s00SGwSOipvQv3p1QhrVUkiN2qqsjBBtZn9V7tNjw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130903/49901fc1/attachment.pl>

From mehajain13 at gmail.com  Tue Sep  3 19:28:26 2013
From: mehajain13 at gmail.com (mehajain13)
Date: Tue, 3 Sep 2013 10:28:26 -0700 (PDT)
Subject: [R-sig-Geo] Analyzing Large Raster Files in R
Message-ID: <1378229306917-7584531.post@n2.nabble.com>

Dear R-sig-geo users,

I?m using the raster package (mainly the calc function) to calculate new
indices for a large MODIS raster that I am using. The code works perfectly
when run over small rasters (e.g. 100 MB), but I now want to run the process
on a 60 GB raster. My computer has 20 GB of RAM and about 500 GB of storage
space.

What is the most efficient and easiest way to run raster calc functions on
extremely large files? I?ve been reading about how to get past memory and
storage limitations in R, but I would love advice on what the easiest and
fastest option might be based on your experience. Some possibilities based
on my reading are:

1)	Somehow use the ff package with the code I?ve written using the raster
package on the full 60 GB file
2)	Using a form of tiling where I break the 60 GB file into smaller
sub-files and run the raster code on each tile using parallels or possibly
multiple computers. I then will piece back together all of these sub-files
to form one large file when they are all done running.

Here is an example of the code that I need to run over the large file (this
is only 1 of the 15 total steps I will eventually run) and a small example
raster is downloadable using the dropbox link below. 

*Example code:*
library(raster)
library(sp)
library(rgdal)

saevi<-brick('D:/Meha_Files/SAFull/SAFull_0013_Final')

spl60fun<-function(x){
	x[x==255]<-NA
	if (sum(is.na(x))>20)
 	{spline<-rep(NA,302)
	return(spline)}
	else
	if (is.na(x[1]))
	{spline<-rep(NA,302)
	return(spline)}
	else
	if (is.na(x[302]))
	{spline<-rep(NA,302)
	return(spline)}
	else
	{x1<-c(1:length(x))
	y1<-x
	intx<-approx(x1,y1,xout=1:length(x1))$y
	spline<-smooth.spline(intx,df=60)$y
	return(spline)}
	}

sasp<-calc(saevi,spl60fun)
writeRaster(sasp,"sasp",format="GTiff")

*Example raster:*
https://www.dropbox.com/s/hh5cl4r02g7havo/Example_Raster.zip

Thanks!
Meha




--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Analyzing-Large-Raster-Files-in-R-tp7584531.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From reid.wodicka at townofwoodstockva.gov  Tue Sep  3 20:29:17 2013
From: reid.wodicka at townofwoodstockva.gov (Reid Wodicka)
Date: Tue, 3 Sep 2013 14:29:17 -0400
Subject: [R-sig-Geo] Creation of heatmaps with geocoded data
Message-ID: <000701cea8d3$80163d30$8042b790$@townofwoodstockva.gov>

Hello all,

 

I am working on mapping the density of calls for service for our police
department in my town. Please excuse me because I'm completely self-teaching
R, so I'm probably pretty inefficient in my programming. Also, this is
probably a simple answer, so I apologize for that, but I hope someone can
help. 

 

The data that I have indicates the address of the call for service and I am
interested in aggregating to regions of the town so that I can create a heat
map that shows where in the town there are higher demands for service for
police. My strategy thus far has been to geocode the address points, then to
create a grid structure over the town, and then overlay the points to assign
them to a grid. Then, I would like to calculate the frequency of which a
cell has calls for service within it and create a heat map of the high
density demand locations. Then, I'd like to map it with an overlay of the
town streets (which I can do). 

 

Can anyone help on  where to do next? I can calculate frequencies after I've
converted the overlay output into a data frame, but I'm not sure how to add
that in as like an attribute to the Spatial Polygon structure that I've
created. I think this is almost like a join when you're using ArcMap, but
I'm not sure how to have that third variable for each cell and then plot it
with appropriate color codes. Any ideas on how to get to the next point?

 

Here is some of the code I've done so far, which has gotten me to the point
that I've geocoded the addresses, created a grid-like spatial polygon, and
then overlayed the points to the polygon, then created the df for the
overlay. 

 

library(gdata)

library(ggmap)

library(dismo)

library(XML)

library(PBSmapping)

library(rgeos)

library(sp)

library(gstat)

cfs<-read.xls("cfs.xlsx", sheet="Sheet1")

 

##create grid

grid<-GridTopology(c(-78.55, 38.85), c(0.0012, 0.0010), c(50,50))

grid.points<-SpatialPoints(grid)

grid.pixels<-SpatialPixels(grid.points)

poly<-as(grid.pixels, "SpatialPolygons")

plot(poly, col="white", border="grey", axes=T)

 

## geocode addresses and plot

add<-geocode(cfs$location.address, oneRecord=FALSE)

coordinates(add)<-c("longitude", "latitude")

plot(add, col="red", axes=T, add=T, pch=21)

 

##overlay incidents to grid

over<-overlay(poly,add)

over.df<-data.frame(over)

 

 

Thanks,

Reid

 

 

 

 

 

 

Reid A. Wodicka | Town Manager

Town of Woodstock, Virginia

135 North Main Street | Woodstock, Virginia 22664

Phone: 540-459-3621 | Fax: 540-459-3085

 <mailto:reid.wodicka at townofwoodstockva.gov>
reid.wodicka at townofwoodstockva.gov |  <http://www.townofwoodstockva.gov>
http://www.townofwoodstockva.gov

 

 <http://www.facebook.com/pages/Town-of-Woodstock-Virginia/201011663375674>
To find out the latest information, LIKE US on Facebook!

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130903/df7a97e5/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 1082 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130903/df7a97e5/attachment.png>

From tech_dev at wildintellect.com  Tue Sep  3 21:40:50 2013
From: tech_dev at wildintellect.com (Alex Mandel)
Date: Tue, 3 Sep 2013 12:40:50 -0700
Subject: [R-sig-Geo] SP 1.0-12 install error
Message-ID: <52263B42.7090607@wildintellect.com>

I was getting an error today installing/upgrading sp.

Error in setClass("CRS", slots = c(projargs = "character"), prototype =
list(projargs = character(1)),  :
  unused argument(s) (slots = c(projargs = "character"))
Error : unable to load R code in package ?sp?
ERROR: lazy loading failed for package ?sp?

I tried uninstalling/reinstalling, using a different mirror, doing it
system-wide vs just for my user etc... Then I noticed that 1.0-12 was
released only a few days ago, so I downloaded the archived version of
1.0-11 and the install works.
http://cran.r-project.org/src/contrib/Archive/sp/

R is 2.15.3 on Ubuntu 12.04

Is there a bug in the package or does the new sp require R>3?

Thanks,
Alex


From Roger.Bivand at nhh.no  Tue Sep  3 21:54:01 2013
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 3 Sep 2013 21:54:01 +0200
Subject: [R-sig-Geo] Holdout Sampling Adaptive Bandwidth SPGWR
In-Reply-To: <alpine.LRH.2.03.1308301639050.550@reclus.nhh.no>
References: <CAD7wDOBoF0+srquZxKGE=mB9RgDZ8SHo0YC8kHV8GH_TQBhq-Q@mail.gmail.com>
	<CANSaWwXvSt1DzpT7nz1rAp21toGr9u88khx=LTFBpsrop=bjrQ@mail.gmail.com>
	<CAD7wDOC8Qo9_xnGr9ibL+wV84NqhBByvmr1zUAcYebLQ+6NbJw@mail.gmail.com>
	<CANSaWwUXNWMGhvkXeCduFxnC4snwwfn1iPsAcfmZaeOfA6XDHA@mail.gmail.com>
	<alpine.LRH.2.03.1308300931430.550@reclus.nhh.no>
	<CAD7wDOBeBRu5dPNuwo642qE_cbdCqBgOERq=SbCnV8E8XkD8LQ@mail.gmail.com>
	<alpine.LRH.2.03.1308301458330.550@reclus.nhh.no>
	<CAD7wDOAwTqR7CjzkzVZoUp8th6ZekmScf0_01njZVaaz7EtxVQ@mail.gmail.com>
	<alpine.LRH.2.03.1308301615320.550@reclus.nhh.no>
	<CAD7wDOA8OcC=9R_YOgJL9qU0tAJZRn+Fs7XvpDjzsUHewFseMQ@mail.gmail.com>
	<alpine.LRH.2.03.1308301639050.550@reclus.nhh.no>
Message-ID: <alpine.LRH.2.03.1309032147270.27644@reclus.nhh.no>

yOn Fri, 30 Aug 2013, Roger Bivand wrote:

> On Fri, 30 Aug 2013, Paul Bidanset wrote:
>
>> Thank you. I'd like to subset into a specific county. Should there be
>> further partitioning from that level?
>> 
>
> No idea. Please re-create your scenario by subsetting georgia and the 
> coordinates to suit.
>

library(spgwr)
example(georgia)
gSRDF1 <- gSRDF[1:100,]
gSRDF2 <- gSRDF[101:159,]
bwsel <- gwr.sel(PctBach ~ TotPop90 + PctRural + PctEld + PctFB + PctPov +
   PctBlack, data=gSRDF1, adapt=TRUE, method="aic")
model1 <- gwr(PctBach ~ TotPop90 + PctRural + PctEld + PctFB + PctPov +
   PctBlack, data=gSRDF1, adapt=bwsel, hatmatrix=TRUE)
PredictionsOfNewData  <- gwr(PctBach ~ TotPop90 + PctRural + PctEld + 
PctFB + PctPov + PctBlack, data=gSRDF1, fit.points=gSRDF2, adapt=bwsel,
   prediction=TRUE, fittedGWRobject=model1)
plot(gSRDF2$PctBach, PredictionsOfNewData$SDF$pred)

with the development version of spgwr on R-forge; with the released 
version the polygons of gSRDF2 cause an error. Note your confusion about 
adapt= in gwr(), if set as adapt=TRUE, this means adapt=1, so includes all 
the observations in the kernel, setting a very broad bandwidth. Never call 
gw.adapt(), it isn't a user-level function, but is exposed for exploring 
the inadequacies of GWR as a method. I would have appreciated an answer 
wrt. whether your held out test set is random or clustered, but here I've 
just subsetted the data in the simplest way.

Roger


> Roger
>
>> 
>> On Fri, Aug 30, 2013 at 10:19 AM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
>> 
>>> On Fri, 30 Aug 2013, Paul Bidanset wrote:
>>>
>>>  Alrighty then!
>>>> 
>>> 
>>> Thanks. Now make this your case by subsetting georgia in a way that
>>> matches your case (all counties west of x?, random set?), and we may be
>>> getting closer. In the geographical partition, the fit points are all a
>>> long way from the data points, in the random case, they aren't grouped in
>>> the same way. You may also need to run the model twice, passing the fitted
>>> model (fit.points == data.points) through to the next stage, but I'm 
>>> unsure
>>> about that.
>>> 
>>> Roger
>>> 
>>> 
>>>> Say I create this adaptive bandwidth model using the original dataset
>>>> "georgia"
>>>> 
>>>> coords = cbind(georgia$x, georgia$y)
>>>> bwsel <- gwr.sel(PctBach ~ TotPop90 + PctRural + PctEld + PctFB + PctPov 
>>>> +
>>>> PctBlack, data=georgia, adapt=TRUE, coords, gweight=gwr.Gauss, method =
>>>> "aic" )
>>>> bw1 <- gw.adapt(coords, coords, quant=bwsel)
>>>> model1 <- gwr(PctBach ~ TotPop90 + PctRural + PctEld + PctFB + PctPov +
>>>> PctBlack, data=georgia, bw=b1, coords, hatmatrix=T)
>>>> model 1
>>>> 
>>>> Suppose I receive an updated data set (same dependent and independent
>>>> variables) and I wish to test the above model1's ability to predict the
>>>> dependent variable of these new data points. If this were a basic lm
>>>> regression in R, I would use the "predict()" command. I wish to better
>>>> understand how I would do so using a GWR model. I found the below
>>>> procedure, but I would like to know first if it is capable accomplishing
>>>> this task, and secondly, if I am specifying it correctly. It seems to me
>>>> that this procedure, as it stands, doesn't take into account the
>>>> appropriate bandwidths for the new data, say, "georgiaNewData"
>>>> 
>>>> PredictionsOfNewData  <- gwr(PctBach ~ TotPop90 + PctRural + PctEld +
>>>> PctFB
>>>> + PctPov + PctBlack, data=gSRDF, adapt=TRUE, gweight=gwr.Gauss, method =
>>>> "aic",  bandwidth=bw1,
>>>> predictions=TRUE, fit.points=georgiaNewData)
>>>> PredictionsOfNewData
>>>> 
>>>> Thanks in advance for guidance and insight...
>>>> 
>>>> 
>>>> On Fri, Aug 30, 2013 at 9:01 AM, Roger Bivand <Roger.Bivand at nhh.no>
>>>> wrote:
>>>>
>>>>  Provide a reproducible code example of your problem using a built in 
>>>> data
>>>>> set. No reproducible example, no response, as I cannot guess (and likely
>>>>> nobody else can either) what your specific misunderstanding is. Code
>>>>> using
>>>>> for example the Georgia data set in the package. You seem to be assuming
>>>>> that you understand how GWR works, I don't think that you do, so you 
>>>>> have
>>>>> to show what you mean in code.
>>>>> 
>>>>> Roger
>>>>> 
>>>>> 
>>>>> On Fri, 30 Aug 2013, Paul Bidanset wrote:
>>>>>
>>>>>  Roger,
>>>>> 
>>>>>> 
>>>>>> I think all I would like to know is if it is possible to apply a
>>>>>> calibrated
>>>>>> GWR model to a hold-out sample, and if so, what the most accurate way 
>>>>>> to
>>>>>> do
>>>>>> so is. I understand the pitfalls of GWR but would like to learn as much
>>>>>> as
>>>>>> I can before progressing to the next spatial methodology I learn in R.
>>>>>> 
>>>>>> 
>>>>>> On Fri, Aug 30, 2013 at 3:37 AM, Roger Bivand <Roger.Bivand at nhh.no>
>>>>>> wrote:
>>>>>>
>>>>>>  Paul, Luis,
>>>>>> 
>>>>>>> 
>>>>>>> I suspect that your speculations are completely wrong-headed. Please
>>>>>>> provide a reproducible example with a built-in data set, so that there
>>>>>>> is
>>>>>>> at least minimal clarity in what you are guessing. Note in addition
>>>>>>> that
>>>>>>> GWR as a technique should not be used for anything other than
>>>>>>> exploration
>>>>>>> of possible mis-specification in the underlying model with the given
>>>>>>> data,
>>>>>>> as patterning in coefficients is induced by GWR for simulated
>>>>>>> covariates
>>>>>>> with no pattern.
>>>>>>> 
>>>>>>> Roger
>>>>>>> 
>>>>>>> 
>>>>>>> On Fri, 30 Aug 2013, Luis Guerra wrote:
>>>>>>>
>>>>>>>  Thank you Luis. When calibrating the adaptive model, using adapt=t in
>>>>>>> the
>>>>>>>
>>>>>>>  bandwidth selection created the proportion you speak of, which then
>>>>>>>> 
>>>>>>>>> allowed
>>>>>>>>> me to create a bandwidth matrix using gwr.adapt. However, this has
>>>>>>>>> not
>>>>>>>>> worked for me with holdout samples. Have you had success in this
>>>>>>>>> regard?
>>>>>>>>>
>>>>>>>>>  Now I get what you mean. Let's show an example:
>>>>>>>>> 
>>>>>>>>> 
>>>>>>>> bw <- gwr.sel(var ~ var1, data=yourdata, adapt=TRUE)
>>>>>>>> m <- gwr(var~var1, data=yourdata, adapt=bw, fit.points=newdata)
>>>>>>>> 
>>>>>>>> So an adaptative bandwidth (bw) is calculated based on"yourdata",
>>>>>>>> while
>>>>>>>> you
>>>>>>>> are fitting "newdata" later on using that previously found bw. I had
>>>>>>>> not
>>>>>>>> thought about it previously. Let's see whether someone else can help
>>>>>>>> you
>>>>>>>> (us).
>>>>>>>> 
>>>>>>>>
>>>>>>>>  I do not know the intended influence of these "fit.points". I would
>>>>>>>> think
>>>>>>>>
>>>>>>>>  that new localized regressions are not calculated, as we're testing
>>>>>>>>> the
>>>>>>>>> model and previous data points' ability to predict for these new
>>>>>>>>> ones,
>>>>>>>>> but
>>>>>>>>> I could be wrong. My current method, however, is producing much
>>>>>>>>> poorer
>>>>>>>>> results with the holdouts, which I am fairly sure is related to my
>>>>>>>>> inability to incorporate the new points necessary bandwidths.
>>>>>>>>>
>>>>>>>>>  Coming back to the previously created example, imagine that
>>>>>>>>> "newdata"
>>>>>>>>>
>>>>>>>>>  is a
>>>>>>>> single point that you want to fit. Imagine now that "yourdata" is a
>>>>>>>> sample
>>>>>>>> with 1000 cases. Then you are getting 1000 models with 1000 different
>>>>>>>> intercepts and 1000 different beta values to adjust var1, rigth? 
>>>>>>>> Which
>>>>>>>> of
>>>>>>>> all these parameters do you use for fitting "newdata"? And something
>>>>>>>> else,
>>>>>>>> what would happen with "newdata" if it is enough far away from
>>>>>>>> "yourdata"
>>>>>>>> and we would be using a fixed bandwidth?
>>>>>>>> 
>>>>>>>> 
>>>>>>>> 
>>>>>>>> 
>>>>>>>> 
>>>>>>>> 
>>>>>>>>
>>>>>>>>  On Aug 29, 2013 8:56 PM, "Luis Guerra" <luispelayo84 at gmail.com>
>>>>>>>> wrote:
>>>>>>>> 
>>>>>>>>
>>>>>>>>>  Dear Paul,
>>>>>>>>> 
>>>>>>>>> 
>>>>>>>>>> I am dealing with this kind of problems right now, and if I am not
>>>>>>>>>> wrong,
>>>>>>>>>> when you want to apply an adaptative bandwidth, you should
>>>>>>>>>> introduce a
>>>>>>>>>> value for the "adapt" parameter instead of for the "bandwidth"
>>>>>>>>>> parameter.
>>>>>>>>>> This value will be between 0 and 1 and indicates the proportion of
>>>>>>>>>> cases
>>>>>>>>>> around your regression point that should be included to estimate
>>>>>>>>>> each
>>>>>>>>>> local
>>>>>>>>>> model. So depending on the amount of points around each case, the
>>>>>>>>>> model
>>>>>>>>>> will use a different bandwidth for each point to be fitted.
>>>>>>>>>> 
>>>>>>>>>> Related to your question, do you know what is the influence of the
>>>>>>>>>> data
>>>>>>>>>> introduced in the "data" parameter to the data to be fitted
>>>>>>>>>> (introduced
>>>>>>>>>> in
>>>>>>>>>> the "fit.points" parameter)? I mean, you have to obtain new local
>>>>>>>>>> models
>>>>>>>>>> (one for each point to be fitted), so I do not understand whether
>>>>>>>>>> the
>>>>>>>>>> "data" parameter is used somehow...
>>>>>>>>>> 
>>>>>>>>>> Best regards,
>>>>>>>>>> 
>>>>>>>>>> Luis
>>>>>>>>>> 
>>>>>>>>>> 
>>>>>>>>>> On Fri, Aug 30, 2013 at 1:26 AM, Paul Bidanset <pbidanset at gmail.com
>>>>>>>>>>
>>>>>>>>>>  wrote:
>>>>>>>>>>> 
>>>>>>>>>>>
>>>>>>>>>>  Hi Folks,
>>>>>>>>>> 
>>>>>>>>>> 
>>>>>>>>>>> I was curious if anyone has had experience applying an SPGWR model
>>>>>>>>>>> with
>>>>>>>>>>> an
>>>>>>>>>>> adaptive bandwidth matrix to a holdout or validation sample. I am
>>>>>>>>>>> using
>>>>>>>>>>> the
>>>>>>>>>>> "fit.points" command, which does not seem to allow for a new
>>>>>>>>>>> bandwidth
>>>>>>>>>>> calibrated around the holdout samples XY coordinates. Any 
>>>>>>>>>>> direction
>>>>>>>>>>> would
>>>>>>>>>>> be greatly appreciated.  I am also open to other viable methods.
>>>>>>>>>>> 
>>>>>>>>>>> Cheers,
>>>>>>>>>>> 
>>>>>>>>>>> Paul
>>>>>>>>>>>
>>>>>>>>>>>         [[alternative HTML version deleted]]
>>>>>>>>>>> 
>>>>>>>>>>> ______________________________******_________________
>>>>>>>>>>> R-sig-Geo mailing list
>>>>>>>>>>> R-sig-Geo at r-project.org
>>>>>>>>>>> https://stat.ethz.ch/mailman/******listinfo/r-sig-geo<https://stat.ethz.ch/mailman/****listinfo/r-sig-geo>
>>>>>>>>>>> <https://**stat.ethz.ch/mailman/****listinfo/r-sig-geo<https://stat.ethz.ch/mailman/**listinfo/r-sig-geo>
>>>>>>>>>>>> 
>>>>>>>>>>> <https://**stat.ethz.ch/**mailman/listinfo/**r-sig-geo<http://stat.ethz.ch/mailman/listinfo/**r-sig-geo>
>>>>>>>>>>> <h**ttps://stat.ethz.ch/mailman/**listinfo/r-sig-geo<https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
>>>>>>>>>>>> 
>>>>>>>>>>> 
>>>>>>>>>>>> 
>>>>>>>>>>>> 
>>>>>>>>>>> 
>>>>>>>>>>> 
>>>>>>>>>>>
>>>>>>>>>>          [[alternative HTML version deleted]]
>>>>>>>>>> 
>>>>>>>>> 
>>>>>>>> ______________________________******_________________
>>>>>>>> R-sig-Geo mailing list
>>>>>>>> R-sig-Geo at r-project.org
>>>>>>>> https://stat.ethz.ch/mailman/******listinfo/r-sig-geo<https://stat.ethz.ch/mailman/****listinfo/r-sig-geo>
>>>>>>>> <https://**stat.ethz.ch/mailman/****listinfo/r-sig-geo<https://stat.ethz.ch/mailman/**listinfo/r-sig-geo>
>>>>>>>>> 
>>>>>>>> <https://**stat.ethz.ch/**mailman/listinfo/**r-sig-geo<http://stat.ethz.ch/mailman/listinfo/**r-sig-geo>
>>>>>>>> <h**ttps://stat.ethz.ch/mailman/**listinfo/r-sig-geo<https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
>>>>>>>>> 
>>>>>>>> 
>>>>>>>>> 
>>>>>>>>> 
>>>>>>>>
>>>>>>>>  --
>>>>>>>> 
>>>>>>> Roger Bivand
>>>>>>> Department of Economics, NHH Norwegian School of Economics,
>>>>>>> Helleveien 30, N-5045 Bergen, Norway.
>>>>>>> voice: +47 55 95 93 55; fax +47 55 95 95 43
>>>>>>> e-mail: Roger.Bivand at nhh.no
>>>>>>> 
>>>>>>> 
>>>>>>> 
>>>>>>> 
>>>>>> 
>>>>>>
>>>>>>  --
>>>>> Roger Bivand
>>>>> Department of Economics, NHH Norwegian School of Economics,
>>>>> Helleveien 30, N-5045 Bergen, Norway.
>>>>> voice: +47 55 95 93 55; fax +47 55 95 95 43
>>>>> e-mail: Roger.Bivand at nhh.no
>>>>> 
>>>>> 
>>>>> 
>>>> 
>>>> 
>>>> 
>>> --
>>> Roger Bivand
>>> Department of Economics, NHH Norwegian School of Economics,
>>> Helleveien 30, N-5045 Bergen, Norway.
>>> voice: +47 55 95 93 55; fax +47 55 95 95 43
>>> e-mail: Roger.Bivand at nhh.no
>>> 
>>> 
>> 
>> 
>> 
>
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From pbidanset at gmail.com  Tue Sep  3 22:46:54 2013
From: pbidanset at gmail.com (Paul Bidanset)
Date: Tue, 3 Sep 2013 16:46:54 -0400
Subject: [R-sig-Geo] Holdout Sampling Adaptive Bandwidth SPGWR
In-Reply-To: <alpine.LRH.2.03.1309032147270.27644@reclus.nhh.no>
References: <CAD7wDOBoF0+srquZxKGE=mB9RgDZ8SHo0YC8kHV8GH_TQBhq-Q@mail.gmail.com>
	<CANSaWwXvSt1DzpT7nz1rAp21toGr9u88khx=LTFBpsrop=bjrQ@mail.gmail.com>
	<CAD7wDOC8Qo9_xnGr9ibL+wV84NqhBByvmr1zUAcYebLQ+6NbJw@mail.gmail.com>
	<CANSaWwUXNWMGhvkXeCduFxnC4snwwfn1iPsAcfmZaeOfA6XDHA@mail.gmail.com>
	<alpine.LRH.2.03.1308300931430.550@reclus.nhh.no>
	<CAD7wDOBeBRu5dPNuwo642qE_cbdCqBgOERq=SbCnV8E8XkD8LQ@mail.gmail.com>
	<alpine.LRH.2.03.1308301458330.550@reclus.nhh.no>
	<CAD7wDOAwTqR7CjzkzVZoUp8th6ZekmScf0_01njZVaaz7EtxVQ@mail.gmail.com>
	<alpine.LRH.2.03.1308301615320.550@reclus.nhh.no>
	<CAD7wDOA8OcC=9R_YOgJL9qU0tAJZRn+Fs7XvpDjzsUHewFseMQ@mail.gmail.com>
	<alpine.LRH.2.03.1308301639050.550@reclus.nhh.no>
	<alpine.LRH.2.03.1309032147270.27644@reclus.nhh.no>
Message-ID: <CAD7wDOC=M1kYsf+R63k+mP2LvcZdx8c1NCYRzyjHNz_Wc8nG8A@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130903/b47ecad4/attachment.pl>

From bakare at ualberta.ca  Wed Sep  4 02:00:58 2013
From: bakare at ualberta.ca (Moshood Agba Bakare)
Date: Tue, 3 Sep 2013 18:00:58 -0600
Subject: [R-sig-Geo] Fitting variogram model using NLS function in R
Message-ID: <CAJRR3XPy8o5shw=hjfdHFHLURpiFBQwaVfrhDBUKec15_Y1-Hw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130903/1db35800/attachment.pl>

From arnold_salvacion at yahoo.com  Wed Sep  4 06:05:06 2013
From: arnold_salvacion at yahoo.com (Arnold Salvacion)
Date: Wed, 4 Sep 2013 12:05:06 +0800 (SGT)
Subject: [R-sig-Geo] Merge maps and data.frames using loop
Message-ID: <1378267506.75706.YahooMailNeo@web192703.mail.sg3.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130904/25ee47fd/attachment.pl>

From lucia.lopezlopez at st.ieo.es  Wed Sep  4 09:39:42 2013
From: lucia.lopezlopez at st.ieo.es (=?ISO-8859-1?Q?Luc=EDa_L=F3pez_L=F3pez?=)
Date: Wed, 04 Sep 2013 09:39:42 +0200
Subject: [R-sig-Geo] structural correlation coefficients for cross
	variography
Message-ID: <5226E3BE.5090006@st.ieo.es>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130904/b45e58cd/attachment.pl>

From Roger.Bivand at nhh.no  Wed Sep  4 11:08:07 2013
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 4 Sep 2013 11:08:07 +0200
Subject: [R-sig-Geo] Holdout Sampling Adaptive Bandwidth SPGWR
In-Reply-To: <CAD7wDOC=M1kYsf+R63k+mP2LvcZdx8c1NCYRzyjHNz_Wc8nG8A@mail.gmail.com>
References: <CAD7wDOBoF0+srquZxKGE=mB9RgDZ8SHo0YC8kHV8GH_TQBhq-Q@mail.gmail.com>
	<CANSaWwXvSt1DzpT7nz1rAp21toGr9u88khx=LTFBpsrop=bjrQ@mail.gmail.com>
	<CAD7wDOC8Qo9_xnGr9ibL+wV84NqhBByvmr1zUAcYebLQ+6NbJw@mail.gmail.com>
	<CANSaWwUXNWMGhvkXeCduFxnC4snwwfn1iPsAcfmZaeOfA6XDHA@mail.gmail.com>
	<alpine.LRH.2.03.1308300931430.550@reclus.nhh.no>
	<CAD7wDOBeBRu5dPNuwo642qE_cbdCqBgOERq=SbCnV8E8XkD8LQ@mail.gmail.com>
	<alpine.LRH.2.03.1308301458330.550@reclus.nhh.no>
	<CAD7wDOAwTqR7CjzkzVZoUp8th6ZekmScf0_01njZVaaz7EtxVQ@mail.gmail.com>
	<alpine.LRH.2.03.1308301615320.550@reclus.nhh.no>
	<CAD7wDOA8OcC=9R_YOgJL9qU0tAJZRn+Fs7XvpDjzsUHewFseMQ@mail.gmail.com>
	<alpine.LRH.2.03.1308301639050.550@reclus.nhh.no>
	<alpine.LRH.2.03.1309032147270.27644@reclus.nhh.no>
	<CAD7wDOC=M1kYsf+R63k+mP2LvcZdx8c1NCYRzyjHNz_Wc8nG8A@mail.gmail.com>
Message-ID: <alpine.LRH.2.03.1309041046100.30155@reclus.nhh.no>

On Tue, 3 Sep 2013, Paul Bidanset wrote:

> Thank you very much for the example and the clarification. My hold out test
> is random. The vector provided by gw.adapt() allows me to see the bandwidth
> size for each point. Is there a way to see each regression point's
> bandwidth size with the correct format you just showed me?

I wouldn't say "correct", rather feasible. Note that the local 
coefficients used for prediction use gSRDF1 data and positions relative to 
gSRDF2 postitions to calculate the coefficients, then the gSRDF2 
covariates data to predict. Try:

library(spgwr)
example(georgia)
par("ask"=FALSE)
set.seed(1)
s <- sample(nrow(gSRDF), 100)
gSRDF1 <- gSRDF[s,]
plot(gSRDF1, col="orange")
gSRDF2 <- gSRDF[!(1:nrow(gSRDF) %in% s),]
plot(gSRDF2, col="brown", add=TRUE)
bwsel <- gwr.sel(PctBach ~ TotPop90 + PctRural + PctEld + PctFB + PctPov +
   PctBlack, data=gSRDF1, adapt=TRUE, method="aic", longlat=TRUE)
# adding longlat=TRUE to be sure, here the geographical coordinates are
# known from the input data object, distances here in km
bws <- gw.adapt(coordinates(gSRDF1), coordinates(gSRDF2), quant=bwsel,
   longlat=TRUE)
bws
# shows the adaptive bandwidths, which cannot be passed through the 
# bandwidth= argument, which is only for a single fixed value
model1 <- gwr(PctBach ~ TotPop90 + PctRural + PctEld + PctFB + PctPov +
   PctBlack, data=gSRDF1, adapt=bwsel, hatmatrix=TRUE, longlat=TRUE)
model1
PredictionsOfNewData  <- gwr(PctBach ~ TotPop90 + PctRural + PctEld +
   PctFB + PctPov + PctBlack, data=gSRDF1, fit.points=gSRDF2, adapt=bwsel,
   prediction=TRUE, fittedGWRobject=model1, se.fit=TRUE, longlat=TRUE)
PredictionsOfNewData
plot(gSRDF2$PctBach, PredictionsOfNewData$SDF$pred)
library(plotrix)
plotCI(1:nrow(PredictionsOfNewData$SDF), PredictionsOfNewData$SDF$pred,
   uiw=2*PredictionsOfNewData$SDF$pred.se, xlab="test counties")
points(1:nrow(PredictionsOfNewData$SDF), gSRDF2$PctBach, pch=16)
summary(gSRDF2$PctBach - PredictionsOfNewData$SDF$pred)

Hope this helps,

Roger

PS.

# the lm case
lm1 <- lm(PctBach ~ TotPop90 + PctRural + PctEld + PctFB + PctPov +
   PctBlack, data=gSRDF1)
lmpred <- predict(lm1, gSRDF2, se.fit=TRUE)
plot(gSRDF2$PctBach, lmpred$fit)
summary(gSRDF2$PctBach - lmpred$fit)
plotCI(1:nrow(gSRDF2), lmpred$fit, uiw=2*lmpred$se.fit, xlab="test counties")
points(1:nrow(gSRDF2), gSRDF2$PctBach, pch=16)
# maybe also see errorest in ipred


>
>
> On Tue, Sep 3, 2013 at 3:54 PM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
>
>> yOn Fri, 30 Aug 2013, Roger Bivand wrote:
>>
>>  On Fri, 30 Aug 2013, Paul Bidanset wrote:
>>>
>>>  Thank you. I'd like to subset into a specific county. Should there be
>>>> further partitioning from that level?
>>>>
>>>>
>>> No idea. Please re-create your scenario by subsetting georgia and the
>>> coordinates to suit.
>>>
>>>
>> library(spgwr)
>> example(georgia)
>> gSRDF1 <- gSRDF[1:100,]
>> gSRDF2 <- gSRDF[101:159,]
>>
>> bwsel <- gwr.sel(PctBach ~ TotPop90 + PctRural + PctEld + PctFB + PctPov +
>>   PctBlack, data=gSRDF1, adapt=TRUE, method="aic")
>>
>> model1 <- gwr(PctBach ~ TotPop90 + PctRural + PctEld + PctFB + PctPov +
>>   PctBlack, data=gSRDF1, adapt=bwsel, hatmatrix=TRUE)
>> PredictionsOfNewData  <- gwr(PctBach ~ TotPop90 + PctRural + PctEld +
>> PctFB + PctPov + PctBlack, data=gSRDF1, fit.points=gSRDF2, adapt=bwsel,
>>   prediction=TRUE, fittedGWRobject=model1)
>> plot(gSRDF2$PctBach, PredictionsOfNewData$SDF$pred)
>>
>> with the development version of spgwr on R-forge; with the released
>> version the polygons of gSRDF2 cause an error. Note your confusion about
>> adapt= in gwr(), if set as adapt=TRUE, this means adapt=1, so includes all
>> the observations in the kernel, setting a very broad bandwidth. Never call
>> gw.adapt(), it isn't a user-level function, but is exposed for exploring
>> the inadequacies of GWR as a method. I would have appreciated an answer
>> wrt. whether your held out test set is random or clustered, but here I've
>> just subsetted the data in the simplest way.
>>
>> Roger
>>
>>
>>
>>  Roger
>>>
>>>
>>>> On Fri, Aug 30, 2013 at 10:19 AM, Roger Bivand <Roger.Bivand at nhh.no>
>>>> wrote:
>>>>
>>>>  On Fri, 30 Aug 2013, Paul Bidanset wrote:
>>>>>
>>>>>  Alrighty then!
>>>>>
>>>>>>
>>>>>>
>>>>> Thanks. Now make this your case by subsetting georgia in a way that
>>>>> matches your case (all counties west of x?, random set?), and we may be
>>>>> getting closer. In the geographical partition, the fit points are all a
>>>>> long way from the data points, in the random case, they aren't grouped
>>>>> in
>>>>> the same way. You may also need to run the model twice, passing the
>>>>> fitted
>>>>> model (fit.points == data.points) through to the next stage, but I'm
>>>>> unsure
>>>>> about that.
>>>>>
>>>>> Roger
>>>>>
>>>>>
>>>>>  Say I create this adaptive bandwidth model using the original dataset
>>>>>> "georgia"
>>>>>>
>>>>>> coords = cbind(georgia$x, georgia$y)
>>>>>> bwsel <- gwr.sel(PctBach ~ TotPop90 + PctRural + PctEld + PctFB +
>>>>>> PctPov +
>>>>>> PctBlack, data=georgia, adapt=TRUE, coords, gweight=gwr.Gauss, method =
>>>>>> "aic" )
>>>>>> bw1 <- gw.adapt(coords, coords, quant=bwsel)
>>>>>> model1 <- gwr(PctBach ~ TotPop90 + PctRural + PctEld + PctFB + PctPov +
>>>>>> PctBlack, data=georgia, bw=b1, coords, hatmatrix=T)
>>>>>> model 1
>>>>>>
>>>>>> Suppose I receive an updated data set (same dependent and independent
>>>>>> variables) and I wish to test the above model1's ability to predict the
>>>>>> dependent variable of these new data points. If this were a basic lm
>>>>>> regression in R, I would use the "predict()" command. I wish to better
>>>>>> understand how I would do so using a GWR model. I found the below
>>>>>> procedure, but I would like to know first if it is capable
>>>>>> accomplishing
>>>>>> this task, and secondly, if I am specifying it correctly. It seems to
>>>>>> me
>>>>>> that this procedure, as it stands, doesn't take into account the
>>>>>> appropriate bandwidths for the new data, say, "georgiaNewData"
>>>>>>
>>>>>> PredictionsOfNewData  <- gwr(PctBach ~ TotPop90 + PctRural + PctEld +
>>>>>> PctFB
>>>>>> + PctPov + PctBlack, data=gSRDF, adapt=TRUE, gweight=gwr.Gauss, method
>>>>>> =
>>>>>> "aic",  bandwidth=bw1,
>>>>>> predictions=TRUE, fit.points=georgiaNewData)
>>>>>> PredictionsOfNewData
>>>>>>
>>>>>> Thanks in advance for guidance and insight...
>>>>>>
>>>>>>
>>>>>> On Fri, Aug 30, 2013 at 9:01 AM, Roger Bivand <Roger.Bivand at nhh.no>
>>>>>> wrote:
>>>>>>
>>>>>>  Provide a reproducible code example of your problem using a built in
>>>>>> data
>>>>>>
>>>>>>> set. No reproducible example, no response, as I cannot guess (and
>>>>>>> likely
>>>>>>> nobody else can either) what your specific misunderstanding is. Code
>>>>>>> using
>>>>>>> for example the Georgia data set in the package. You seem to be
>>>>>>> assuming
>>>>>>> that you understand how GWR works, I don't think that you do, so you
>>>>>>> have
>>>>>>> to show what you mean in code.
>>>>>>>
>>>>>>> Roger
>>>>>>>
>>>>>>>
>>>>>>> On Fri, 30 Aug 2013, Paul Bidanset wrote:
>>>>>>>
>>>>>>>  Roger,
>>>>>>>
>>>>>>>
>>>>>>>> I think all I would like to know is if it is possible to apply a
>>>>>>>> calibrated
>>>>>>>> GWR model to a hold-out sample, and if so, what the most accurate
>>>>>>>> way to
>>>>>>>> do
>>>>>>>> so is. I understand the pitfalls of GWR but would like to learn as
>>>>>>>> much
>>>>>>>> as
>>>>>>>> I can before progressing to the next spatial methodology I learn in
>>>>>>>> R.
>>>>>>>>
>>>>>>>>
>>>>>>>> On Fri, Aug 30, 2013 at 3:37 AM, Roger Bivand <Roger.Bivand at nhh.no>
>>>>>>>> wrote:
>>>>>>>>
>>>>>>>>  Paul, Luis,
>>>>>>>>
>>>>>>>>
>>>>>>>>> I suspect that your speculations are completely wrong-headed. Please
>>>>>>>>> provide a reproducible example with a built-in data set, so that
>>>>>>>>> there
>>>>>>>>> is
>>>>>>>>> at least minimal clarity in what you are guessing. Note in addition
>>>>>>>>> that
>>>>>>>>> GWR as a technique should not be used for anything other than
>>>>>>>>> exploration
>>>>>>>>> of possible mis-specification in the underlying model with the given
>>>>>>>>> data,
>>>>>>>>> as patterning in coefficients is induced by GWR for simulated
>>>>>>>>> covariates
>>>>>>>>> with no pattern.
>>>>>>>>>
>>>>>>>>> Roger
>>>>>>>>>
>>>>>>>>>
>>>>>>>>> On Fri, 30 Aug 2013, Luis Guerra wrote:
>>>>>>>>>
>>>>>>>>>  Thank you Luis. When calibrating the adaptive model, using adapt=t
>>>>>>>>> in
>>>>>>>>> the
>>>>>>>>>
>>>>>>>>>  bandwidth selection created the proportion you speak of, which then
>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>  allowed
>>>>>>>>>>> me to create a bandwidth matrix using gwr.adapt. However, this has
>>>>>>>>>>> not
>>>>>>>>>>> worked for me with holdout samples. Have you had success in this
>>>>>>>>>>> regard?
>>>>>>>>>>>
>>>>>>>>>>>  Now I get what you mean. Let's show an example:
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>  bw <- gwr.sel(var ~ var1, data=yourdata, adapt=TRUE)
>>>>>>>>>> m <- gwr(var~var1, data=yourdata, adapt=bw, fit.points=newdata)
>>>>>>>>>>
>>>>>>>>>> So an adaptative bandwidth (bw) is calculated based on"yourdata",
>>>>>>>>>> while
>>>>>>>>>> you
>>>>>>>>>> are fitting "newdata" later on using that previously found bw. I
>>>>>>>>>> had
>>>>>>>>>> not
>>>>>>>>>> thought about it previously. Let's see whether someone else can
>>>>>>>>>> help
>>>>>>>>>> you
>>>>>>>>>> (us).
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>  I do not know the intended influence of these "fit.points". I
>>>>>>>>>> would
>>>>>>>>>> think
>>>>>>>>>>
>>>>>>>>>>  that new localized regressions are not calculated, as we're
>>>>>>>>>> testing
>>>>>>>>>>
>>>>>>>>>>> the
>>>>>>>>>>> model and previous data points' ability to predict for these new
>>>>>>>>>>> ones,
>>>>>>>>>>> but
>>>>>>>>>>> I could be wrong. My current method, however, is producing much
>>>>>>>>>>> poorer
>>>>>>>>>>> results with the holdouts, which I am fairly sure is related to my
>>>>>>>>>>> inability to incorporate the new points necessary bandwidths.
>>>>>>>>>>>
>>>>>>>>>>>  Coming back to the previously created example, imagine that
>>>>>>>>>>> "newdata"
>>>>>>>>>>>
>>>>>>>>>>>  is a
>>>>>>>>>>>
>>>>>>>>>> single point that you want to fit. Imagine now that "yourdata" is a
>>>>>>>>>> sample
>>>>>>>>>> with 1000 cases. Then you are getting 1000 models with 1000
>>>>>>>>>> different
>>>>>>>>>> intercepts and 1000 different beta values to adjust var1, rigth?
>>>>>>>>>> Which
>>>>>>>>>> of
>>>>>>>>>> all these parameters do you use for fitting "newdata"? And
>>>>>>>>>> something
>>>>>>>>>> else,
>>>>>>>>>> what would happen with "newdata" if it is enough far away from
>>>>>>>>>> "yourdata"
>>>>>>>>>> and we would be using a fixed bandwidth?
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>  On Aug 29, 2013 8:56 PM, "Luis Guerra" <luispelayo84 at gmail.com>
>>>>>>>>>> wrote:
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>   Dear Paul,
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>  I am dealing with this kind of problems right now, and if I am
>>>>>>>>>>>> not
>>>>>>>>>>>> wrong,
>>>>>>>>>>>> when you want to apply an adaptative bandwidth, you should
>>>>>>>>>>>> introduce a
>>>>>>>>>>>> value for the "adapt" parameter instead of for the "bandwidth"
>>>>>>>>>>>> parameter.
>>>>>>>>>>>> This value will be between 0 and 1 and indicates the proportion
>>>>>>>>>>>> of
>>>>>>>>>>>> cases
>>>>>>>>>>>> around your regression point that should be included to estimate
>>>>>>>>>>>> each
>>>>>>>>>>>> local
>>>>>>>>>>>> model. So depending on the amount of points around each case, the
>>>>>>>>>>>> model
>>>>>>>>>>>> will use a different bandwidth for each point to be fitted.
>>>>>>>>>>>>
>>>>>>>>>>>> Related to your question, do you know what is the influence of
>>>>>>>>>>>> the
>>>>>>>>>>>> data
>>>>>>>>>>>> introduced in the "data" parameter to the data to be fitted
>>>>>>>>>>>> (introduced
>>>>>>>>>>>> in
>>>>>>>>>>>> the "fit.points" parameter)? I mean, you have to obtain new local
>>>>>>>>>>>> models
>>>>>>>>>>>> (one for each point to be fitted), so I do not understand whether
>>>>>>>>>>>> the
>>>>>>>>>>>> "data" parameter is used somehow...
>>>>>>>>>>>>
>>>>>>>>>>>> Best regards,
>>>>>>>>>>>>
>>>>>>>>>>>> Luis
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>> On Fri, Aug 30, 2013 at 1:26 AM, Paul Bidanset <
>>>>>>>>>>>> pbidanset at gmail.com
>>>>>>>>>>>>
>>>>>>>>>>>>  wrote:
>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>   Hi Folks,
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>  I was curious if anyone has had experience applying an SPGWR
>>>>>>>>>>>>> model
>>>>>>>>>>>>> with
>>>>>>>>>>>>> an
>>>>>>>>>>>>> adaptive bandwidth matrix to a holdout or validation sample. I
>>>>>>>>>>>>> am
>>>>>>>>>>>>> using
>>>>>>>>>>>>> the
>>>>>>>>>>>>> "fit.points" command, which does not seem to allow for a new
>>>>>>>>>>>>> bandwidth
>>>>>>>>>>>>> calibrated around the holdout samples XY coordinates. Any
>>>>>>>>>>>>> direction
>>>>>>>>>>>>> would
>>>>>>>>>>>>> be greatly appreciated.  I am also open to other viable methods.
>>>>>>>>>>>>>
>>>>>>>>>>>>> Cheers,
>>>>>>>>>>>>>
>>>>>>>>>>>>> Paul
>>>>>>>>>>>>>
>>>>>>>>>>>>>         [[alternative HTML version deleted]]
>>>>>>>>>>>>>
>>>>>>>>>>>>> ______________________________********_________________
>>>>>>>>>>>>> R-sig-Geo mailing list
>>>>>>>>>>>>> R-sig-Geo at r-project.org
>>>>>>>>>>>>> https://stat.ethz.ch/mailman/********listinfo/r-sig-geo<https://stat.ethz.ch/mailman/******listinfo/r-sig-geo>
>>>>>>>>>>>>> <https:**//stat.ethz.ch/mailman/******listinfo/r-sig-geo<https://stat.ethz.ch/mailman/****listinfo/r-sig-geo>
>>>>>>>>>>>>>>
>>>>>>>>>>>>> <https://**stat.ethz.ch/**mailman/****listinfo/r-sig-geo<http://stat.ethz.ch/mailman/****listinfo/r-sig-geo>
>>>>>>>>>>>>> **<https://stat.ethz.ch/mailman/****listinfo/r-sig-geo<https://stat.ethz.ch/mailman/**listinfo/r-sig-geo>
>>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>  <https://**stat.ethz.ch/****mailman/listinfo/**r-sig-geo<http://stat.ethz.ch/**mailman/listinfo/**r-sig-geo>
>>>>>>>>>>>>> <h**ttp://stat.ethz.ch/mailman/**listinfo/**r-sig-geo<http://stat.ethz.ch/mailman/listinfo/**r-sig-geo>
>>>>>>>>>>>>>>
>>>>>>>>>>>>> <h**ttps://stat.ethz.ch/**mailman/**listinfo/r-sig-geo<http://stat.ethz.ch/mailman/**listinfo/r-sig-geo>
>>>>>>>>>>>>> <h**ttps://stat.ethz.ch/mailman/**listinfo/r-sig-geo<https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
>>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>           [[alternative HTML version deleted]]
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>  ______________________________********_________________
>>>>>>>>>> R-sig-Geo mailing list
>>>>>>>>>> R-sig-Geo at r-project.org
>>>>>>>>>> https://stat.ethz.ch/mailman/********listinfo/r-sig-geo<https://stat.ethz.ch/mailman/******listinfo/r-sig-geo>
>>>>>>>>>> <https:**//stat.ethz.ch/mailman/******listinfo/r-sig-geo<https://stat.ethz.ch/mailman/****listinfo/r-sig-geo>
>>>>>>>>>>>
>>>>>>>>>> <https://**stat.ethz.ch/**mailman/****listinfo/r-sig-geo<http://stat.ethz.ch/mailman/****listinfo/r-sig-geo>
>>>>>>>>>> **<https://stat.ethz.ch/mailman/****listinfo/r-sig-geo<https://stat.ethz.ch/mailman/**listinfo/r-sig-geo>
>>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>  <https://**stat.ethz.ch/****mailman/listinfo/**r-sig-geo<http://stat.ethz.ch/**mailman/listinfo/**r-sig-geo>
>>>>>>>>>> <h**ttp://stat.ethz.ch/mailman/**listinfo/**r-sig-geo<http://stat.ethz.ch/mailman/listinfo/**r-sig-geo>
>>>>>>>>>>>
>>>>>>>>>> <h**ttps://stat.ethz.ch/**mailman/**listinfo/r-sig-geo<http://stat.ethz.ch/mailman/**listinfo/r-sig-geo>
>>>>>>>>>> <h**ttps://stat.ethz.ch/mailman/**listinfo/r-sig-geo<https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
>>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>  --
>>>>>>>>>>
>>>>>>>>>>  Roger Bivand
>>>>>>>>> Department of Economics, NHH Norwegian School of Economics,
>>>>>>>>> Helleveien 30, N-5045 Bergen, Norway.
>>>>>>>>> voice: +47 55 95 93 55; fax +47 55 95 95 43
>>>>>>>>> e-mail: Roger.Bivand at nhh.no
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>
>>>>>>>>  --
>>>>>>>>
>>>>>>> Roger Bivand
>>>>>>> Department of Economics, NHH Norwegian School of Economics,
>>>>>>> Helleveien 30, N-5045 Bergen, Norway.
>>>>>>> voice: +47 55 95 93 55; fax +47 55 95 95 43
>>>>>>> e-mail: Roger.Bivand at nhh.no
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>
>>>>>>
>>>>>>  --
>>>>> Roger Bivand
>>>>> Department of Economics, NHH Norwegian School of Economics,
>>>>> Helleveien 30, N-5045 Bergen, Norway.
>>>>> voice: +47 55 95 93 55; fax +47 55 95 95 43
>>>>> e-mail: Roger.Bivand at nhh.no
>>>>>
>>>>>
>>>>>
>>>>
>>>>
>>>>
>>>
>>>
>> --
>> Roger Bivand
>> Department of Economics, NHH Norwegian School of Economics,
>> Helleveien 30, N-5045 Bergen, Norway.
>> voice: +47 55 95 93 55; fax +47 55 95 95 43
>> e-mail: Roger.Bivand at nhh.no
>>
>>
>
>
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From pierluigi.derosa at gmail.com  Wed Sep  4 11:09:45 2013
From: pierluigi.derosa at gmail.com (pierluigi de rosa)
Date: Wed, 4 Sep 2013 11:09:45 +0200
Subject: [R-sig-Geo] extract point values from contour lines
In-Reply-To: <CAAgsrZjL+iBj3meDGdHUwhbVJhEDXA02X0H+2JuXHJng6NG2mQ@mail.gmail.com>
References: <CAAgsrZjL+iBj3meDGdHUwhbVJhEDXA02X0H+2JuXHJng6NG2mQ@mail.gmail.com>
Message-ID: <CAAgsrZgB490TLevH-g6MPS6kPHUCfdq=D9QG_ZJdQJ+gKjKY-w@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130904/1e5bff3d/attachment.pl>

From b.rowlingson at lancaster.ac.uk  Wed Sep  4 12:12:09 2013
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Wed, 4 Sep 2013 11:12:09 +0100
Subject: [R-sig-Geo] extract point values from contour lines
In-Reply-To: <e3b1aa92a23147ed9511cdd1ec307ee8@EX-0-HT0.lancs.local>
References: <CAAgsrZjL+iBj3meDGdHUwhbVJhEDXA02X0H+2JuXHJng6NG2mQ@mail.gmail.com>
	<e3b1aa92a23147ed9511cdd1ec307ee8@EX-0-HT0.lancs.local>
Message-ID: <CANVKczO1jtXE5Fq8M=scXwCD+cWJ3sowdvKxrZMWWFu9TjZbaQ@mail.gmail.com>

On Wed, Sep 4, 2013 at 10:09 AM, pierluigi de rosa
<pierluigi.derosa at gmail.com> wrote:
> Hi all
> nobody have an Idea about my question?
> thanks again

 If you can lower the bar to helping people answer your question, you
will get more answers!

For example, giving some test data and code to generate it, and some
idea of what you expect to get out. We don't care too much about your
specifics (ie the 1:10000 and 1:25000 contours).

 What format is your contour data? Is it the output from the
'contourLines' function? Or is it a SpatialLinesDataFrame with a
height attribute? Or something else?

A good question would be something like:

"""
I have contour data in the same form as from contourLines, for example:

    x <- 10*1:nrow(volcano)
     y <- 10*1:ncol(volcano)
     image(x,y,volcano)
     lines = contourLines(x, y, volcano)

and I want to be able to get the height at any point in the area from
the contour line data (yes, I could just sample the underlying grid
but I don't have that data, I only have the contours).

"""

One approach might be to consider the points of the contour line as
samples from the underlying data and do a smoothing such as kriging or
inverse distance weighting, but I suspect that having a lot of samples
with the same height at a range of distances is going to mess up the
variogram somewhat...

If all your contour lines are complete rings then you can do
point-in-polygon tests to see which rings the point is inside and
hence know its height is between that and the next ring, and then
maybe interpolate linearly by distance to ring, but there's some edge
cases when a point is inside a summit ring when you only know it is
bigger than X and less than X+10 (if 10 is your contour interval).

Searching for 'interpolation from contour lines' might be useful.

Barry


From edzer.pebesma at uni-muenster.de  Wed Sep  4 12:35:23 2013
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Wed, 04 Sep 2013 12:35:23 +0200
Subject: [R-sig-Geo] SP 1.0-12 install error
In-Reply-To: <52263B42.7090607@wildintellect.com>
References: <52263B42.7090607@wildintellect.com>
Message-ID: <52270CEB.4060005@uni-muenster.de>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Thanks, you are right, sp 1.0-12 depends on R 3.0.0 but claims it
doesn't.

Ubuntu users are very well served by binary updates of R releases, see
for instance http://cran.at.r-project.org/bin/linux/ubuntu/

If the list considers this as an annoyance, let me know, it's not a
big deal to convert back to pre 3.0.0 syntax (for some time).

On 09/03/2013 09:40 PM, Alex Mandel wrote:
> I was getting an error today installing/upgrading sp.
> 
> Error in setClass("CRS", slots = c(projargs = "character"),
> prototype = list(projargs = character(1)),  : unused argument(s)
> (slots = c(projargs = "character")) Error : unable to load R code
> in package ?sp? ERROR: lazy loading failed for package ?sp?
> 
> I tried uninstalling/reinstalling, using a different mirror, doing
> it system-wide vs just for my user etc... Then I noticed that
> 1.0-12 was released only a few days ago, so I downloaded the
> archived version of 1.0-11 and the install works. 
> http://cran.r-project.org/src/contrib/Archive/sp/
> 
> R is 2.15.3 on Ubuntu 12.04
> 
> Is there a bug in the package or does the new sp require R>3?
> 
> Thanks, Alex
> 
> _______________________________________________ R-sig-Geo mailing
> list R-sig-Geo at r-project.org 
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

- -- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
83 33081, Fax: +49 251 8339763 http://ifgi.uni-muenster.de
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.11 (GNU/Linux)
Comment: Using GnuPG with Thunderbird - http://www.enigmail.net/

iQEcBAEBAgAGBQJSJwzrAAoJEM1OCHCtOnfxMgwIAIeJHUmZ3bz1ohNA4ys8poMd
kAxLHohEbsXvHAVBRSUg2MJf5wLarHTouPA8SVM6LS48u7S/fTPeHs70C2kPPmHN
Pw6jQIzGwb7z3XdauF5VD9fZYEKApvbJVCfQoEPp8JoqXPvB1zXudxRRU9lQ5yMU
MmrREzhhFKvd/21hhgBSho1KxLszYyVRwEtG60xEfVXhHVHdnCSrEF1eYnF1iiWU
w/wk/zBp57rhGvLBaS0kCmduZICjVgxK/ZUhmm6yfR8MbtOcGjpr+uAEYZ03te7U
dDiganJW1lEEvwj0toU1OnOs+elutk3K4GBXh96oHoXgqyPt58NMlA8qhGa5VBg=
=SFJP
-----END PGP SIGNATURE-----


From edzer.pebesma at uni-muenster.de  Wed Sep  4 12:40:32 2013
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Wed, 04 Sep 2013 12:40:32 +0200
Subject: [R-sig-Geo] Fitting variogram model using NLS function in R
In-Reply-To: <CAJRR3XPy8o5shw=hjfdHFHLURpiFBQwaVfrhDBUKec15_Y1-Hw@mail.gmail.com>
References: <CAJRR3XPy8o5shw=hjfdHFHLURpiFBQwaVfrhDBUKec15_Y1-Hw@mail.gmail.com>
Message-ID: <52270E20.4090705@uni-muenster.de>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

did you read the documentation of argument fit.method in function
gstat::fit.variogram?


On 09/04/2013 02:00 AM, Moshood Agba Bakare wrote:
> Dear All, I tried to compare the result obtained by fitting the
> spherical variogram model using fit.variogram and nls functions.
> The large difference in the results is a great concern for me
> knowing that the two functions use Weighted Least Squares (WLS)
> approach for estimating parameters. The steps taken are as
> follows:
> 
> ## Fit empirical semivariogram using gstat empvar<-variogram(yield
> ~ 1,canmod.sp,cutoff= 400,width = 25, Cressie=TRUE)
> 
> # Fitting Spherical variogram model to sample variogram
> 
> sph.var<- vgm(psill =130, model = "Sph", range = 65, nugget = 180) 
> sph.mod<-fit.variogram(empvar, model = sph.var) print(sph.mod)
> 
> The result obtain from fitting the spherical model to sample
> variogram is sph.mod model         psill         range 1   Nug
> 230.917736411  0.0000000000 2   Sph 108.323055319 87.6889385431
> 
> The non-linear least squares (NLS) approach use by default s
> Gauss-newton algorithm in an iterative search process. I used the
> initial values obtained from the empirical variogram above
> (psill=130, range=65, and nugget=180) as starting values for the
> iterative procedure.
> 
> ## Define Spherical Variogram functions for NLS
> 
> sph.vgram <- function(dist, range, psill, nugget){ dist <-
> dist/range nugget + psill*ifelse(dist < 1, (1.5 * dist - 0.5 *
> dist^3),1) }
> 
> ## Fitting spherical with NLS
> 
> fit.var <- nls(gamma~sph.vgram(dist,range,psill,nugget),data =
> empvar, start=list(psill=130, range=65, nugget=180),trace=T)
> 
> The result obtained from the nls fitting is
> 
> Nonlinear regression model model:  gamma ~ sph.vgram(dist, range,
> psill, nugget) data:  empvar psill       range      nugget 
> 90.7071423 342.1025007 278.9542178 residual sum-of-squares:
> 1140.67875
> 
> Number of iterations to convergence: 18 Achieved convergence
> tolerance: 9.79837651e-06
> 
> Could anyone explain why large difference in the two result? Is the
> R script for fitting the NLS right? I am worried for having such
> disparity. Thanks while looking forward to reading your suggestion,
> comments and advice. Moshood.
> 
> [[alternative HTML version deleted]]
> 
> _______________________________________________ R-sig-Geo mailing
> list R-sig-Geo at r-project.org 
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

- -- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
83 33081, Fax: +49 251 8339763 http://ifgi.uni-muenster.de
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.11 (GNU/Linux)
Comment: Using GnuPG with Thunderbird - http://www.enigmail.net/

iQEcBAEBAgAGBQJSJw4gAAoJEM1OCHCtOnfxjeMH/0CmRhzIYBhS44vTS4617G7G
h8E/owvIS9wWMBEDe85qRhnnDSHOu8NRpcsO0QFNIYjzGtzf6Crporf9RAvAbdkO
0m+3ZDQgqIOmwmDp+svQ41f9HvxDcszJWv/ijuSjIrFG5cRG6PzgYKwamwTw5miR
iVTUV2Syhxzpb72Or3TuadcBLF2JFEMMt/r3CMGZ2CszdIKSddMZDPf5ki0co3V3
nyR0pYNfq4dJdKzvTH8u0R9C6pCnTlYRoUFHfss3SSQfgbVEwZinVt2nBoUE4m41
ZSrYWLFkUVBOEHHbfGWb+WOc9Moz1ApCygmX5GYnPR9HZuPKHHcSgU2ErLRD30w=
=Bd64
-----END PGP SIGNATURE-----


From b.rowlingson at lancaster.ac.uk  Wed Sep  4 13:06:39 2013
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Wed, 4 Sep 2013 12:06:39 +0100
Subject: [R-sig-Geo] extract point values from contour lines
In-Reply-To: <CANVKczO1jtXE5Fq8M=scXwCD+cWJ3sowdvKxrZMWWFu9TjZbaQ@mail.gmail.com>
References: <CAAgsrZjL+iBj3meDGdHUwhbVJhEDXA02X0H+2JuXHJng6NG2mQ@mail.gmail.com>
	<e3b1aa92a23147ed9511cdd1ec307ee8@EX-0-HT0.lancs.local>
	<CANVKczO1jtXE5Fq8M=scXwCD+cWJ3sowdvKxrZMWWFu9TjZbaQ@mail.gmail.com>
Message-ID: <CANVKczP2HmJhDQnpHM5B--j398Qq7EQY1P_Fb9AhWjpWHBxsrg@mail.gmail.com>

On Wed, Sep 4, 2013 at 11:12 AM, Barry Rowlingson
<b.rowlingson at lancaster.ac.uk> wrote:

> One approach might be to consider the points of the contour line as
> samples from the underlying data and do a smoothing such as kriging or
> inverse distance weighting, but I suspect that having a lot of samples
> with the same height at a range of distances is going to mess up the
> variogram somewhat...

    x <- 10*1:nrow(volcano)
     y <- 10*1:ncol(volcano)
     image(x,y,volcano)
     lines = contourLines(x, y, volcano)

Following on from that, the Kriging approach doesn't look so bad:

require(plyr)
# convert output of contourLines to a spatial points data frame with
height in 'h':
xyhd=ldply(l,function(e){data.frame(x=e$x,y=e$y,h=e$level)})
coordinates(xyhd)=~x+y
require(automap)
a = autoKrige(h~1,xyhd)
plot(a)

 that shows you how the points of the contours have been interpolated
over the space. If we want to just get predictions at locations we
construct a new points data set and feed that in:

 pnew = data.frame(x=runif(100,100,800),y=runif(100,50,500))
 coordinates(pnew)=~x+y
 anew = autoKrige(h~1,xyhd,pnew)
 plot(anew)

and you get point estimates and kriging standard errors - these are in
anew$krige_output as a spatial points data frame.

Now I suppose I should compare those estimates with direct samples
from the original volcano DEM to see how well we've done.... Left as
an exercise...

There seems to be a bit of literature on interpolating from contour
lines via various other methods too.

Barry


From pbidanset at gmail.com  Wed Sep  4 17:44:31 2013
From: pbidanset at gmail.com (Paul Bidanset)
Date: Wed, 4 Sep 2013 11:44:31 -0400
Subject: [R-sig-Geo] Holdout Sampling Adaptive Bandwidth SPGWR
In-Reply-To: <alpine.LRH.2.03.1309041046100.30155@reclus.nhh.no>
References: <CAD7wDOBoF0+srquZxKGE=mB9RgDZ8SHo0YC8kHV8GH_TQBhq-Q@mail.gmail.com>
	<CANSaWwXvSt1DzpT7nz1rAp21toGr9u88khx=LTFBpsrop=bjrQ@mail.gmail.com>
	<CAD7wDOC8Qo9_xnGr9ibL+wV84NqhBByvmr1zUAcYebLQ+6NbJw@mail.gmail.com>
	<CANSaWwUXNWMGhvkXeCduFxnC4snwwfn1iPsAcfmZaeOfA6XDHA@mail.gmail.com>
	<alpine.LRH.2.03.1308300931430.550@reclus.nhh.no>
	<CAD7wDOBeBRu5dPNuwo642qE_cbdCqBgOERq=SbCnV8E8XkD8LQ@mail.gmail.com>
	<alpine.LRH.2.03.1308301458330.550@reclus.nhh.no>
	<CAD7wDOAwTqR7CjzkzVZoUp8th6ZekmScf0_01njZVaaz7EtxVQ@mail.gmail.com>
	<alpine.LRH.2.03.1308301615320.550@reclus.nhh.no>
	<CAD7wDOA8OcC=9R_YOgJL9qU0tAJZRn+Fs7XvpDjzsUHewFseMQ@mail.gmail.com>
	<alpine.LRH.2.03.1308301639050.550@reclus.nhh.no>
	<alpine.LRH.2.03.1309032147270.27644@reclus.nhh.no>
	<CAD7wDOC=M1kYsf+R63k+mP2LvcZdx8c1NCYRzyjHNz_Wc8nG8A@mail.gmail.com>
	<alpine.LRH.2.03.1309041046100.30155@reclus.nhh.no>
Message-ID: <CAD7wDOCLU9d10r1UoAMUoV4iCfGHe6CFpU72btJXARKphxvCSA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130904/fdd2618a/attachment.pl>

From bakare at ualberta.ca  Wed Sep  4 17:50:06 2013
From: bakare at ualberta.ca (Moshood Agba Bakare)
Date: Wed, 4 Sep 2013 09:50:06 -0600
Subject: [R-sig-Geo] Fitting variogram model using NLS function in R
In-Reply-To: <52270E20.4090705@uni-muenster.de>
References: <CAJRR3XPy8o5shw=hjfdHFHLURpiFBQwaVfrhDBUKec15_Y1-Hw@mail.gmail.com>
	<52270E20.4090705@uni-muenster.de>
Message-ID: <CAJRR3XNtbNmC73MQxT0A6jCssGFXKJfRaU7x-cu0y6yjeUOs4A@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130904/52450eaf/attachment.pl>

From jfprieur at gmail.com  Wed Sep  4 18:02:36 2013
From: jfprieur at gmail.com (jfprieur)
Date: Wed, 4 Sep 2013 09:02:36 -0700 (PDT)
Subject: [R-sig-Geo] Multiple variables and Raster predict function
Message-ID: <1378310556174-7584547.post@n2.nabble.com>

Hello, new to R, have been spending the summer learning how to use the e1071
SVM functions. I am working on classification of multispectral (IR,R,G,B)
aerial imagery using SVM. I have been getting good preliminary results
working with e1071 and using small subsets of these images that I
transformed into data frames (eg, not working on the actual raster but
rather numerical representations) to get the hang of things. 

I use multiple band ratios to build my SVM models so, for example, when I am
training for WATER or GROUND classification, I use 4 ratios from my training
area (these are just for example): Green/IR, NDVI, GNDVI,
Blue/Sum(IR+R+G+B). The data frame I send to the model is:

V1         V2   V3    V4     V5
Water     x     x      x       x
....
Ground    x     x      x       x

I then run 

svm.model.<-svm(V1 ~ .,data=trainset,cost=100,gamma=1), I ran the tuning
function to get some idea of the proper parameters to use.

My small test image is loaded into a data frame (using values function from
raster package). I calculate the same ratios for the test image so that the
data frame looks like:

V2    V3      V4     V5
x       x        x       x
.....

I then use 

svm.pred<-predict(svm.model,<small image data frame>,decision.values=TRUE)

and output a raster manually (convert the data frame using setvalues) with
the results. This works well and gives us some interesting results.

In order to be able to process entire images (1.2Gb, 12500*12500)at once, I
have started using the predict function in the raster package (along with
ClusterR) and working directly on raster objects. I have made an initial
classification using the raster predict function and got a raster (r1) with
two values (1,2) output which matched very well with the above method. The
command used was:

r1<-predict(<test image with proper ratios
calculated>,svm.model,progress='text')

The process was very fast (5 minutes) so I am very interested in using this
method. Just wanted to doublecheck my understanding.

My basic questions:

a) Instead of the classified result (1,2) is there any way to get the
decision values with raster predict. I saw some discussion with
'fun=predprob' but not quite sure.

b)I believe it works this way: my input raster contains 4 layers
(V2,V3,V4,V5) that are the ratios calculated from the original test image.
Is the raster predict method sending them to the SVM model in the same way
as my initial method above, eg. are all my variables being used by the
raster predict function? I think that it is clever enough to figure out that
each layer in the stack is a variable but want to be sure. If not, how would
I duplicate my initial method (using the vanilla predict function) with
raster predict?

I hope this is clear enough, thanks for any help!
JF Prieur




--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Multiple-variables-and-Raster-predict-function-tp7584547.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From jfprieur at gmail.com  Wed Sep  4 18:14:09 2013
From: jfprieur at gmail.com (jfprieur)
Date: Wed, 4 Sep 2013 09:14:09 -0700 (PDT)
Subject: [R-sig-Geo] Analyzing Large Raster Files in R
In-Reply-To: <1378229306917-7584531.post@n2.nabble.com>
References: <1378229306917-7584531.post@n2.nabble.com>
Message-ID: <1378311249769-7584548.post@n2.nabble.com>

I am relatively new at this but you should have a look at the clusterR
function in the raster package which will utilize your CPU cores more
effectively.

http://www.inside-r.org/packages/cran/raster/docs/Cluster



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Analyzing-Large-Raster-Files-in-R-tp7584531p7584548.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From mtreglia at gmail.com  Wed Sep  4 18:37:08 2013
From: mtreglia at gmail.com (Michael Treglia)
Date: Wed, 4 Sep 2013 11:37:08 -0500
Subject: [R-sig-Geo] Extract function - too much data for R?
In-Reply-To: <1377924150709-7584521.post@n2.nabble.com>
References: <CAPKp32tJ1kAMiTxK7N_irLj0p7Akv9Kxmn_REz-cOEHypGG3vQ@mail.gmail.com>
	<CALyPt8yG6qrxD_NaU+eLgqRf-xu-HO43xLiTAFB5d00MaEH02g@mail.gmail.com>
	<CAPKp32tnUujXoKJf3YmmM0SKxV+qsKaTcembw6Hpb+R0WQHWYQ@mail.gmail.com>
	<CALyPt8z8NRewV9-JrWaNEasuxTYp5uvPX7sTDLHhY3vY0aFOjg@mail.gmail.com>
	<CAPKp32vgHtU0ZYVKJKMd3kgYP6nFU-HTUZ8B4bztj5uX0v6c-Q@mail.gmail.com>
	<1377924150709-7584521.post@n2.nabble.com>
Message-ID: <CAPKp32sPC==HzPfxY0bt=HgvCyR1Msn2r_hqFKm5xhRKdFGMiw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130904/8e92ae6b/attachment.pl>

From edzer.pebesma at uni-muenster.de  Wed Sep  4 19:39:51 2013
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Wed, 04 Sep 2013 19:39:51 +0200
Subject: [R-sig-Geo] Fitting variogram model using NLS function in R
In-Reply-To: <CAJRR3XNtbNmC73MQxT0A6jCssGFXKJfRaU7x-cu0y6yjeUOs4A@mail.gmail.com>
References: <CAJRR3XPy8o5shw=hjfdHFHLURpiFBQwaVfrhDBUKec15_Y1-Hw@mail.gmail.com>
	<52270E20.4090705@uni-muenster.de>
	<CAJRR3XNtbNmC73MQxT0A6jCssGFXKJfRaU7x-cu0y6yjeUOs4A@mail.gmail.com>
Message-ID: <52277067.40707@uni-muenster.de>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1



On 09/04/2013 05:50 PM, Moshood Agba Bakare wrote:
> Dear Dr. Edzer, Yes, I read about the various options of fit.method
> in gstat manual. The default value of fit.method for fitting
> variogram model to empirical variogram is 7. That is, the number of
> pair of points divided by squares of the distance, h. I refitted
> the model by setting fit.method =1 which is weighted least squares
> so that it would be the same with default estimation method of nls
> function. The comparison of the results differ greatly despite
> using the same inital starting value. I am worried! Is there wrong 
> in my R script? Please help.

Instead of sharing emotions, you might as well share information.

You don't provide a reproducible example, and you haven't shown your R
script of the second attempt. In any case, I haven't seen you specify
weights for nls(), and hence don't share your worries.

> 
> Thank you Moshood
> 
> 
> On Wed, Sep 4, 2013 at 4:40 AM, Edzer Pebesma
> <edzer.pebesma at uni-muenster.de
>> wrote:
> 
> did you read the documentation of argument fit.method in function 
> gstat::fit.variogram?
> 
> 
> On 09/04/2013 02:00 AM, Moshood Agba Bakare wrote:
>>>> Dear All, I tried to compare the result obtained by fitting
>>>> the spherical variogram model using fit.variogram and nls
>>>> functions. The large difference in the results is a great
>>>> concern for me knowing that the two functions use Weighted
>>>> Least Squares (WLS) approach for estimating parameters. The
>>>> steps taken are as follows:
>>>> 
>>>> ## Fit empirical semivariogram using gstat
>>>> empvar<-variogram(yield ~ 1,canmod.sp,cutoff= 400,width = 25,
>>>> Cressie=TRUE)
>>>> 
>>>> # Fitting Spherical variogram model to sample variogram
>>>> 
>>>> sph.var<- vgm(psill =130, model = "Sph", range = 65, nugget =
>>>> 180) sph.mod<-fit.variogram(empvar, model = sph.var)
>>>> print(sph.mod)
>>>> 
>>>> The result obtain from fitting the spherical model to sample 
>>>> variogram is sph.mod model         psill         range 1
>>>> Nug 230.917736411  0.0000000000 2   Sph 108.323055319
>>>> 87.6889385431
>>>> 
>>>> The non-linear least squares (NLS) approach use by default s 
>>>> Gauss-newton algorithm in an iterative search process. I used
>>>> the initial values obtained from the empirical variogram
>>>> above (psill=130, range=65, and nugget=180) as starting
>>>> values for the iterative procedure.
>>>> 
>>>> ## Define Spherical Variogram functions for NLS
>>>> 
>>>> sph.vgram <- function(dist, range, psill, nugget){ dist <- 
>>>> dist/range nugget + psill*ifelse(dist < 1, (1.5 * dist - 0.5
>>>> * dist^3),1) }
>>>> 
>>>> ## Fitting spherical with NLS
>>>> 
>>>> fit.var <- nls(gamma~sph.vgram(dist,range,psill,nugget),data
>>>> = empvar, start=list(psill=130, range=65,
>>>> nugget=180),trace=T)
>>>> 
>>>> The result obtained from the nls fitting is
>>>> 
>>>> Nonlinear regression model model:  gamma ~ sph.vgram(dist,
>>>> range, psill, nugget) data:  empvar psill       range
>>>> nugget 90.7071423 342.1025007 278.9542178 residual
>>>> sum-of-squares: 1140.67875
>>>> 
>>>> Number of iterations to convergence: 18 Achieved convergence 
>>>> tolerance: 9.79837651e-06
>>>> 
>>>> Could anyone explain why large difference in the two result?
>>>> Is the R script for fitting the NLS right? I am worried for
>>>> having such disparity. Thanks while looking forward to
>>>> reading your suggestion, comments and advice. Moshood.
>>>> 
>>>> [[alternative HTML version deleted]]
>>>> 
>>>> _______________________________________________ R-sig-Geo
>>>> mailing list R-sig-Geo at r-project.org 
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>> 
> 
>> 
>> _______________________________________________ R-sig-Geo mailing
>> list R-sig-Geo at r-project.org 
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> 
>> 
> 

- -- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
83 33081, Fax: +49 251 8339763 http://ifgi.uni-muenster.de
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.11 (GNU/Linux)
Comment: Using GnuPG with Thunderbird - http://www.enigmail.net/

iQEcBAEBAgAGBQJSJ3BnAAoJEM1OCHCtOnfxMHUH/RQIPHQLzcEg3i1KF/WDJc2b
26rJ3JCvua27M5XB7HBfQBwkr9gdsI1BfSpVJwGSQKgy5zdX0KOl6Dk7jSqWJRH5
SCD7YLBBHvH+DeTC24NBo+1sdu4XaCAWxK3olp1oQ2v/q+KHQiIJ8Yv20wO0paFT
vWsthZeEOKfMd1x0JDXuN+KDPGz91QP5p33TQMDfKMdxOP2c0J7dhuNqgq7Tq8th
+tId+X5B3xyXvVLLM7s8OC+6L0BpAQM1YtjwmIhSEMdKM7ljRoN4JHgfZ9KKqOuX
20mVCBG0DQPZLVC0A6jUOPPPB9Zx4cqlicwnRdu9bdGLiBq7+oXctjv3QmeAOC8=
=Bg1J
-----END PGP SIGNATURE-----


From tech_dev at wildintellect.com  Wed Sep  4 20:38:52 2013
From: tech_dev at wildintellect.com (Alex Mandel)
Date: Wed, 04 Sep 2013 11:38:52 -0700
Subject: [R-sig-Geo] SP 1.0-12 install error
In-Reply-To: <52270CEB.4060005@uni-muenster.de>
References: <52263B42.7090607@wildintellect.com>
	<52270CEB.4060005@uni-muenster.de>
Message-ID: <52277E3C.8090504@wildintellect.com>

I ran into trouble because I needed to add Rgdal (someone had forgotten
to install it) to an existing 2.15 server and it wanted sp newer than
1.0 but I had 0.9.x. Upgrading this particular machine to 3 was too
risky and would involve verifying all the other running packages could
be upgraded.

For many of my machines I do track the CRAN debs for R updates but not
on deployed servers where an accidental upgrade could break R web
services that are running or long standing analysis code being used by
researchers.

So yes it would be good if I had gotten the warning in R or saw it in
some news or changelog somewhere. I don't think there's any particular
need to revert as long as people are aware of the issue and the way to
work around it.


Thanks,
Alex

On 09/04/2013 03:35 AM, Edzer Pebesma wrote:
> Thanks, you are right, sp 1.0-12 depends on R 3.0.0 but claims it
> doesn't.
> 
> Ubuntu users are very well served by binary updates of R releases, see
> for instance http://cran.at.r-project.org/bin/linux/ubuntu/
> 
> If the list considers this as an annoyance, let me know, it's not a
> big deal to convert back to pre 3.0.0 syntax (for some time).
> 
> On 09/03/2013 09:40 PM, Alex Mandel wrote:
>> I was getting an error today installing/upgrading sp.
> 
>> Error in setClass("CRS", slots = c(projargs = "character"),
>> prototype = list(projargs = character(1)),  : unused argument(s)
>> (slots = c(projargs = "character")) Error : unable to load R code
>> in package ?sp? ERROR: lazy loading failed for package ?sp?
> 
>> I tried uninstalling/reinstalling, using a different mirror, doing
>> it system-wide vs just for my user etc... Then I noticed that
>> 1.0-12 was released only a few days ago, so I downloaded the
>> archived version of 1.0-11 and the install works. 
>> http://cran.r-project.org/src/contrib/Archive/sp/
> 
>> R is 2.15.3 on Ubuntu 12.04
> 
>> Is there a bug in the package or does the new sp require R>3?
> 
>> Thanks, Alex
> 
>> _______________________________________________ R-sig-Geo mailing
>> list R-sig-Geo at r-project.org 
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 
> 
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From bakare at ualberta.ca  Wed Sep  4 21:35:17 2013
From: bakare at ualberta.ca (Moshood Agba Bakare)
Date: Wed, 4 Sep 2013 13:35:17 -0600
Subject: [R-sig-Geo] Fitting variogram model using NLS function in R
In-Reply-To: <52277067.40707@uni-muenster.de>
References: <CAJRR3XPy8o5shw=hjfdHFHLURpiFBQwaVfrhDBUKec15_Y1-Hw@mail.gmail.com>
	<52270E20.4090705@uni-muenster.de>
	<CAJRR3XNtbNmC73MQxT0A6jCssGFXKJfRaU7x-cu0y6yjeUOs4A@mail.gmail.com>
	<52277067.40707@uni-muenster.de>
Message-ID: <CAJRR3XOWnJsO6zD+jsuA=VkANR8=GcZ_rK4_PGM5-8a=LPyehg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130904/ff26856b/attachment.pl>

From mdsumner at gmail.com  Thu Sep  5 00:48:30 2013
From: mdsumner at gmail.com (Michael Sumner)
Date: Thu, 5 Sep 2013 08:48:30 +1000
Subject: [R-sig-Geo] SP 1.0-12 install error
In-Reply-To: <52277E3C.8090504@wildintellect.com>
References: <52263B42.7090607@wildintellect.com>
	<52270CEB.4060005@uni-muenster.de>
	<52277E3C.8090504@wildintellect.com>
Message-ID: <CAAcGz99up+anoE90xbX9FEj7hGyFRGnEr1xxkFZW25a1gi-zPg@mail.gmail.com>

I noticed this in an RStudio server instance, which was running R
2.15.3, I had to download each package .tar.gz and install
individually to avoid the 'unused argument(s) (slots = c(projargs =
"character"))' problem.

I seemed to need older versions of maptools, rgdal, rgeos, sp and
raster to get everything working there. It might be worth getting a
formal listing of this if many people are affected. This is what I
used, I just went back a few months in the archive, I was not careful
to check when the change was made:

 "maptools_0.8-24.tar.gz"
"raster_2.1-12.tar.gz"
"rgdal_0.8-7.tar.gz"
"rgeos_0.2-16.tar.gz"
"sp_1.0-8.tar.gz"

On Thu, Sep 5, 2013 at 4:38 AM, Alex Mandel <tech_dev at wildintellect.com> wrote:
> I ran into trouble because I needed to add Rgdal (someone had forgotten
> to install it) to an existing 2.15 server and it wanted sp newer than
> 1.0 but I had 0.9.x. Upgrading this particular machine to 3 was too
> risky and would involve verifying all the other running packages could
> be upgraded.
>
> For many of my machines I do track the CRAN debs for R updates but not
> on deployed servers where an accidental upgrade could break R web
> services that are running or long standing analysis code being used by
> researchers.
>
> So yes it would be good if I had gotten the warning in R or saw it in
> some news or changelog somewhere. I don't think there's any particular
> need to revert as long as people are aware of the issue and the way to
> work around it.
>
>
> Thanks,
> Alex
>
> On 09/04/2013 03:35 AM, Edzer Pebesma wrote:
>> Thanks, you are right, sp 1.0-12 depends on R 3.0.0 but claims it
>> doesn't.
>>
>> Ubuntu users are very well served by binary updates of R releases, see
>> for instance http://cran.at.r-project.org/bin/linux/ubuntu/
>>
>> If the list considers this as an annoyance, let me know, it's not a
>> big deal to convert back to pre 3.0.0 syntax (for some time).
>>
>> On 09/03/2013 09:40 PM, Alex Mandel wrote:
>>> I was getting an error today installing/upgrading sp.
>>
>>> Error in setClass("CRS", slots = c(projargs = "character"),
>>> prototype = list(projargs = character(1)),  : unused argument(s)
>>> (slots = c(projargs = "character")) Error : unable to load R code
>>> in package ?sp? ERROR: lazy loading failed for package ?sp?
>>
>>> I tried uninstalling/reinstalling, using a different mirror, doing
>>> it system-wide vs just for my user etc... Then I noticed that
>>> 1.0-12 was released only a few days ago, so I downloaded the
>>> archived version of 1.0-11 and the install works.
>>> http://cran.r-project.org/src/contrib/Archive/sp/
>>
>>> R is 2.15.3 on Ubuntu 12.04
>>
>>> Is there a bug in the package or does the new sp require R>3?
>>
>>> Thanks, Alex
>>
>>> _______________________________________________ R-sig-Geo mailing
>>> list R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



-- 
Michael Sumner
Hobart, Australia
e-mail: mdsumner at gmail.com


From tech_dev at wildintellect.com  Thu Sep  5 01:28:22 2013
From: tech_dev at wildintellect.com (Alex Mandel)
Date: Wed, 04 Sep 2013 16:28:22 -0700
Subject: [R-sig-Geo] SP 1.0-12 install error
In-Reply-To: <CAAcGz99up+anoE90xbX9FEj7hGyFRGnEr1xxkFZW25a1gi-zPg@mail.gmail.com>
References: <52263B42.7090607@wildintellect.com>
	<52270CEB.4060005@uni-muenster.de>
	<52277E3C.8090504@wildintellect.com>
	<CAAcGz99up+anoE90xbX9FEj7hGyFRGnEr1xxkFZW25a1gi-zPg@mail.gmail.com>
Message-ID: <5227C216.9030008@wildintellect.com>

I only had to manually install sp_1.0-11.tar.gz
After that install.packages worked fine using web sources for rgdal and
raster. I did not try rgeos or maptools.

Wonder why you had to manually do all of those.

Thanks,
Alex

On 09/04/2013 03:48 PM, Michael Sumner wrote:
> I noticed this in an RStudio server instance, which was running R
> 2.15.3, I had to download each package .tar.gz and install
> individually to avoid the 'unused argument(s) (slots = c(projargs =
> "character"))' problem.
> 
> I seemed to need older versions of maptools, rgdal, rgeos, sp and
> raster to get everything working there. It might be worth getting a
> formal listing of this if many people are affected. This is what I
> used, I just went back a few months in the archive, I was not careful
> to check when the change was made:
> 
>  "maptools_0.8-24.tar.gz"
> "raster_2.1-12.tar.gz"
> "rgdal_0.8-7.tar.gz"
> "rgeos_0.2-16.tar.gz"
> "sp_1.0-8.tar.gz"
> 
> On Thu, Sep 5, 2013 at 4:38 AM, Alex Mandel <tech_dev at wildintellect.com> wrote:
>> I ran into trouble because I needed to add Rgdal (someone had forgotten
>> to install it) to an existing 2.15 server and it wanted sp newer than
>> 1.0 but I had 0.9.x. Upgrading this particular machine to 3 was too
>> risky and would involve verifying all the other running packages could
>> be upgraded.
>>
>> For many of my machines I do track the CRAN debs for R updates but not
>> on deployed servers where an accidental upgrade could break R web
>> services that are running or long standing analysis code being used by
>> researchers.
>>
>> So yes it would be good if I had gotten the warning in R or saw it in
>> some news or changelog somewhere. I don't think there's any particular
>> need to revert as long as people are aware of the issue and the way to
>> work around it.
>>
>>
>> Thanks,
>> Alex
>>
>> On 09/04/2013 03:35 AM, Edzer Pebesma wrote:
>>> Thanks, you are right, sp 1.0-12 depends on R 3.0.0 but claims it
>>> doesn't.
>>>
>>> Ubuntu users are very well served by binary updates of R releases, see
>>> for instance http://cran.at.r-project.org/bin/linux/ubuntu/
>>>
>>> If the list considers this as an annoyance, let me know, it's not a
>>> big deal to convert back to pre 3.0.0 syntax (for some time).
>>>
>>> On 09/03/2013 09:40 PM, Alex Mandel wrote:
>>>> I was getting an error today installing/upgrading sp.
>>>
>>>> Error in setClass("CRS", slots = c(projargs = "character"),
>>>> prototype = list(projargs = character(1)),  : unused argument(s)
>>>> (slots = c(projargs = "character")) Error : unable to load R code
>>>> in package ?sp? ERROR: lazy loading failed for package ?sp?
>>>
>>>> I tried uninstalling/reinstalling, using a different mirror, doing
>>>> it system-wide vs just for my user etc... Then I noticed that
>>>> 1.0-12 was released only a few days ago, so I downloaded the
>>>> archived version of 1.0-11 and the install works.
>>>> http://cran.r-project.org/src/contrib/Archive/sp/
>>>
>>>> R is 2.15.3 on Ubuntu 12.04
>>>
>>>> Is there a bug in the package or does the new sp require R>3?
>>>
>>>> Thanks, Alex
>>>
>>>> _______________________________________________ R-sig-Geo mailing
>>>> list R-sig-Geo at r-project.org
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>>
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 
> 
>


From Scott.Waichler at pnnl.gov  Thu Sep  5 02:19:36 2013
From: Scott.Waichler at pnnl.gov (Waichler, Scott R)
Date: Wed, 4 Sep 2013 17:19:36 -0700
Subject: [R-sig-Geo] how to use levelplot() with a geographic projection
In-Reply-To: <CAMLL7b=+5j-tJWdeNcHnEs025vcBBthprUWj0km-evBt9=zhnw@mail.gmail.com>
References: <A632B3F93D861843A3C966F3962C3F840148AE939952@EMAIL05.pnl.gov>
	<CALyPt8ytCF=uaNi=0CWjMoWEjNDDJf1-WKFLCTx5UrD_WOcQ8g@mail.gmail.com>
	<CAMLL7b=+5j-tJWdeNcHnEs025vcBBthprUWj0km-evBt9=zhnw@mail.gmail.com>
Message-ID: <A632B3F93D861843A3C966F3962C3F840148AE93A009@EMAIL05.pnl.gov>

Hi again,

In working on this some more I discovered that I need to transpose a data matrix, then flip the raster object created from the matrix to get the proper rendering in a plot.  Can someone explain why that is?

My example has to do with the state of California, with 2918 1/8-degree cells.  I regret I can't provide a small working example--I don't know to make one up that would clearly show correct vs. incorrect geographic rendering.

library(maps)
library(maptools)
library(raster)
library(rasterVis)
data(stateMapEnv)
state.map <- map("state", plot=F)

# longitude and latitude are vectors giving the respective coordinates 
# for cells that are non-NA (n=2918)

xmn <- min(longitude); xmx <- max(longitude)
ymn <- min(latitude);  ymx <- max(latitude)
x.bounds <- seq(xmn - 1/16, xmx + 1/16, by = 1/8)  # grid spacing is 1/8 degree
y.bounds <- seq(ymn - 1/16, ymx + 1/16, by = 1/8)
ii <- findInterval(longitude, x.bounds)  # indices
jj <- findInterval(latitude, y.bounds)   # indices
index.matrix <- cbind(ii,jj)
num.long <- length(x.bounds) - 1
num.lat <- length(y.bounds) - 1
mat <- array(NA, dim=c(num.long, num.lat)) # full, enclosing array with rows=long and columns=lat
mat[index.matrix] <- runif(n=length(longitude))  # insert non-NA values in the right cells

# Why do I need to transpose the matrix then flip the raster for proper rendering in levelplot?
myrast <- flip(raster(t(mat), xmn=xmn, xmx=xmx, ymn=ymn, ymx=ymx, 
                      crs="+proj=longlat +datum=WGS84"), 
               direction="y")

ext <- as.vector(extent(myrast))
boundaries <- map('state', fill=TRUE, xlim=ext[1:2], ylim=ext[3:4], plot=FALSE)
IDs <- sapply(strsplit(boundaries$names, ":"), function(x) x[1])
bPols <- map2SpatialPolygons(boundaries, IDs=IDs, proj4string=CRS(projection(myrast)))

levelplot(myrast,
          panel = function(...) {
              panel.levelplot(...)
              sp.polygons(bPols)
          },
          margin=F)

--Scott Waichler


From edzer.pebesma at uni-muenster.de  Thu Sep  5 08:16:27 2013
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Thu, 05 Sep 2013 08:16:27 +0200
Subject: [R-sig-Geo] Fitting variogram model using NLS function in R
In-Reply-To: <CAJRR3XOWnJsO6zD+jsuA=VkANR8=GcZ_rK4_PGM5-8a=LPyehg@mail.gmail.com>
References: <CAJRR3XPy8o5shw=hjfdHFHLURpiFBQwaVfrhDBUKec15_Y1-Hw@mail.gmail.com>
	<52270E20.4090705@uni-muenster.de>
	<CAJRR3XNtbNmC73MQxT0A6jCssGFXKJfRaU7x-cu0y6yjeUOs4A@mail.gmail.com>
	<52277067.40707@uni-muenster.de>
	<CAJRR3XOWnJsO6zD+jsuA=VkANR8=GcZ_rK4_PGM5-8a=LPyehg@mail.gmail.com>
Message-ID: <522821BB.40509@uni-muenster.de>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

fit.variogram uses a weighted fit, nls() in the way you specify it
uses a non-weighted fit. In order to get comparable results, I would
try to use the same weights in nls() as fit.variogram() uses.

On 09/04/2013 09:35 PM, Moshood Agba Bakare wrote:
> Dear Dr. Edzer, My R script is not different from the previous
> mail. The only change I made is to specify the fit.method = 1 which
> is weight least squares method going by the gstat manual. The
> script is as follows
> 
> ## Fit empirical semivariogram using gstat empvar<-variogram(yield
> ~ 1,canmod.sp,cutoff= 400,width = 25)
> 
> ## Spherical variogram model sph.var<-vgm(psill=130, model="Sph",
> range=65, nugget=180) 
> sph.mod<-fit.variogram(empvar,model=sph.var,fit.method=1) 
> print(sph.mod)
> 
> The result obtain is
> 
> 
> print(sph.mod)  model          psill         range 1   Nug
> 292.7856258929   0.000000000 2   Sph  81.4905260953 417.759633211
> 
> 
> 
> 
> # Define Spherical Variogram functions for NLS
> 
> sph.vgram <- function(dist, range, psill, nugget){ dist <-
> dist/range nugget + psill*ifelse(dist < 1, (1.5 * dist - 0.5 *
> dist^3),1) }
> 
> ## Fitting spherical with NLS
> 
> fit.var <- nls(gamma~sph.vgram(dist,range,psill,nugget),data =
> empvar, start=list(psill=130, range=65, nugget=180),trace=T) The
> result obtained from nls is
> 
> 
> Formula: gamma ~ sph.vgram(dist, range, psill, nugget)
> 
> Parameters: Estimate   Std. Error  t value   Pr(>|t|) psill
> 90.70714234   7.54388401 12.02393 2.0404e-08 *** range
> 342.10250070  42.62964315  8.02499 2.1611e-06 *** nugget
> 278.95421782   6.70590124 41.59832 3.2326e-15 *** --- Signif.
> codes:  0 ?***? 0.001 ?**? 0.01 ?*? 0.05 ?.? 0.1 ? ? 1
> 
> Residual standard error: 9.36720447 on 13 degrees of freedom
> 
> Number of iterations to convergence: 18 Achieved convergence
> tolerance: 9.79837651e-06
> 
> 
> 
> 
> On Wed, Sep 4, 2013 at 11:39 AM, Edzer Pebesma < 
> edzer.pebesma at uni-muenster.de> wrote:
> 
> 
> 
> On 09/04/2013 05:50 PM, Moshood Agba Bakare wrote:
>>>> Dear Dr. Edzer, Yes, I read about the various options of
>>>> fit.method in gstat manual. The default value of fit.method
>>>> for fitting variogram model to empirical variogram is 7. That
>>>> is, the number of pair of points divided by squares of the
>>>> distance, h. I refitted the model by setting fit.method =1
>>>> which is weighted least squares so that it would be the same
>>>> with default estimation method of nls function. The
>>>> comparison of the results differ greatly despite using the
>>>> same inital starting value. I am worried! Is there wrong in
>>>> my R script? Please help.
> 
> Instead of sharing emotions, you might as well share information.
> 
> You don't provide a reproducible example, and you haven't shown
> your R script of the second attempt. In any case, I haven't seen
> you specify weights for nls(), and hence don't share your worries.
> 
>>>> 
>>>> Thank you Moshood
>>>> 
>>>> 
>>>> On Wed, Sep 4, 2013 at 4:40 AM, Edzer Pebesma 
>>>> <edzer.pebesma at uni-muenster.de
>>>>> wrote:
>>>> 
>>>> did you read the documentation of argument fit.method in
>>>> function gstat::fit.variogram?
>>>> 
>>>> 
>>>> On 09/04/2013 02:00 AM, Moshood Agba Bakare wrote:
>>>>>>> Dear All, I tried to compare the result obtained by
>>>>>>> fitting the spherical variogram model using
>>>>>>> fit.variogram and nls functions. The large difference
>>>>>>> in the results is a great concern for me knowing that
>>>>>>> the two functions use Weighted Least Squares (WLS)
>>>>>>> approach for estimating parameters. The steps taken are
>>>>>>> as follows:
>>>>>>> 
>>>>>>> ## Fit empirical semivariogram using gstat 
>>>>>>> empvar<-variogram(yield ~ 1,canmod.sp,cutoff= 400,width
>>>>>>> = 25, Cressie=TRUE)
>>>>>>> 
>>>>>>> # Fitting Spherical variogram model to sample
>>>>>>> variogram
>>>>>>> 
>>>>>>> sph.var<- vgm(psill =130, model = "Sph", range = 65,
>>>>>>> nugget = 180) sph.mod<-fit.variogram(empvar, model =
>>>>>>> sph.var) print(sph.mod)
>>>>>>> 
>>>>>>> The result obtain from fitting the spherical model to
>>>>>>> sample variogram is sph.mod model         psill
>>>>>>> range 1 Nug 230.917736411  0.0000000000 2   Sph
>>>>>>> 108.323055319 87.6889385431
>>>>>>> 
>>>>>>> The non-linear least squares (NLS) approach use by
>>>>>>> default s Gauss-newton algorithm in an iterative search
>>>>>>> process. I used the initial values obtained from the
>>>>>>> empirical variogram above (psill=130, range=65, and
>>>>>>> nugget=180) as starting values for the iterative
>>>>>>> procedure.
>>>>>>> 
>>>>>>> ## Define Spherical Variogram functions for NLS
>>>>>>> 
>>>>>>> sph.vgram <- function(dist, range, psill, nugget){ dist
>>>>>>> <- dist/range nugget + psill*ifelse(dist < 1, (1.5 *
>>>>>>> dist - 0.5 * dist^3),1) }
>>>>>>> 
>>>>>>> ## Fitting spherical with NLS
>>>>>>> 
>>>>>>> fit.var <-
>>>>>>> nls(gamma~sph.vgram(dist,range,psill,nugget),data =
>>>>>>> empvar, start=list(psill=130, range=65, 
>>>>>>> nugget=180),trace=T)
>>>>>>> 
>>>>>>> The result obtained from the nls fitting is
>>>>>>> 
>>>>>>> Nonlinear regression model model:  gamma ~
>>>>>>> sph.vgram(dist, range, psill, nugget) data:  empvar
>>>>>>> psill       range nugget 90.7071423 342.1025007
>>>>>>> 278.9542178 residual sum-of-squares: 1140.67875
>>>>>>> 
>>>>>>> Number of iterations to convergence: 18 Achieved
>>>>>>> convergence tolerance: 9.79837651e-06
>>>>>>> 
>>>>>>> Could anyone explain why large difference in the two
>>>>>>> result? Is the R script for fitting the NLS right? I am
>>>>>>> worried for having such disparity. Thanks while looking
>>>>>>> forward to reading your suggestion, comments and
>>>>>>> advice. Moshood.
>>>>>>> 
>>>>>>> [[alternative HTML version deleted]]
>>>>>>> 
>>>>>>> _______________________________________________
>>>>>>> R-sig-Geo mailing list R-sig-Geo at r-project.org 
>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>>> 
>>>> 
>>>>> 
>>>>> _______________________________________________ R-sig-Geo
>>>>> mailing list R-sig-Geo at r-project.org 
>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>> 
>>>>> 
>>>> 
> 
>> 
>> _______________________________________________ R-sig-Geo mailing
>> list R-sig-Geo at r-project.org 
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> 
>> 
> 

- -- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
83 33081, Fax: +49 251 8339763 http://ifgi.uni-muenster.de
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.11 (GNU/Linux)
Comment: Using GnuPG with Thunderbird - http://www.enigmail.net/

iQEcBAEBAgAGBQJSKCG7AAoJEM1OCHCtOnfxVeAH/2CV6xOVfX/4dB97IMd8FGad
PrL/rPzgETRQuleTFrqWPI968r9TCOpDHF66AuCC+XVahs1I8b3vBc320YcwTGj3
+RLtWOUzztt6PzmGlNGldQza6fqv3IVZl32eLdD0g1iEgjyndXzD414weoyRSJYv
rjvNcVjYkT234AudFyiu+yLq1+0ytC4FL9sGGOMQ8P67Cn0kq7PDFPjW8ODyBzwD
2nnh08ekbHG2zbAw9wbWfVnGH+G7i0o8hIwAxaYYMDIzf6h5SEXWwQ3rwy1W9aOc
lPcc3wpPtbYSdfrMivX9dmRdNXdgGfQDKtY6J9aIAiSRnStLSC2RM6B10sHX/CQ=
=h54I
-----END PGP SIGNATURE-----


From edzer.pebesma at uni-muenster.de  Thu Sep  5 08:42:44 2013
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Thu, 05 Sep 2013 08:42:44 +0200
Subject: [R-sig-Geo] SP 1.0-12 install error
In-Reply-To: <5227C216.9030008@wildintellect.com>
References: <52263B42.7090607@wildintellect.com>
	<52270CEB.4060005@uni-muenster.de>
	<52277E3C.8090504@wildintellect.com>
	<CAAcGz99up+anoE90xbX9FEj7hGyFRGnEr1xxkFZW25a1gi-zPg@mail.gmail.com>
	<5227C216.9030008@wildintellect.com>
Message-ID: <522827E4.1050508@uni-muenster.de>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

sp_1.0-13, now on CRAN, should work with R >= 2.14 again.

On 09/05/2013 01:28 AM, Alex Mandel wrote:
> I only had to manually install sp_1.0-11.tar.gz After that
> install.packages worked fine using web sources for rgdal and 
> raster. I did not try rgeos or maptools.
> 
> Wonder why you had to manually do all of those.
> 
> Thanks, Alex
> 
> On 09/04/2013 03:48 PM, Michael Sumner wrote:
>> I noticed this in an RStudio server instance, which was running
>> R 2.15.3, I had to download each package .tar.gz and install 
>> individually to avoid the 'unused argument(s) (slots = c(projargs
>> = "character"))' problem.
>> 
>> I seemed to need older versions of maptools, rgdal, rgeos, sp
>> and raster to get everything working there. It might be worth
>> getting a formal listing of this if many people are affected.
>> This is what I used, I just went back a few months in the
>> archive, I was not careful to check when the change was made:
>> 
>> "maptools_0.8-24.tar.gz" "raster_2.1-12.tar.gz" 
>> "rgdal_0.8-7.tar.gz" "rgeos_0.2-16.tar.gz" "sp_1.0-8.tar.gz"
>> 
>> On Thu, Sep 5, 2013 at 4:38 AM, Alex Mandel
>> <tech_dev at wildintellect.com> wrote:
>>> I ran into trouble because I needed to add Rgdal (someone had
>>> forgotten to install it) to an existing 2.15 server and it
>>> wanted sp newer than 1.0 but I had 0.9.x. Upgrading this
>>> particular machine to 3 was too risky and would involve
>>> verifying all the other running packages could be upgraded.
>>> 
>>> For many of my machines I do track the CRAN debs for R updates
>>> but not on deployed servers where an accidental upgrade could
>>> break R web services that are running or long standing analysis
>>> code being used by researchers.
>>> 
>>> So yes it would be good if I had gotten the warning in R or saw
>>> it in some news or changelog somewhere. I don't think there's
>>> any particular need to revert as long as people are aware of
>>> the issue and the way to work around it.
>>> 
>>> 
>>> Thanks, Alex
>>> 
>>> On 09/04/2013 03:35 AM, Edzer Pebesma wrote:
>>>> Thanks, you are right, sp 1.0-12 depends on R 3.0.0 but
>>>> claims it doesn't.
>>>> 
>>>> Ubuntu users are very well served by binary updates of R
>>>> releases, see for instance
>>>> http://cran.at.r-project.org/bin/linux/ubuntu/
>>>> 
>>>> If the list considers this as an annoyance, let me know, it's
>>>> not a big deal to convert back to pre 3.0.0 syntax (for some
>>>> time).
>>>> 
>>>> On 09/03/2013 09:40 PM, Alex Mandel wrote:
>>>>> I was getting an error today installing/upgrading sp.
>>>> 
>>>>> Error in setClass("CRS", slots = c(projargs =
>>>>> "character"), prototype = list(projargs = character(1)),  :
>>>>> unused argument(s) (slots = c(projargs = "character"))
>>>>> Error : unable to load R code in package ?sp? ERROR: lazy
>>>>> loading failed for package ?sp?
>>>> 
>>>>> I tried uninstalling/reinstalling, using a different
>>>>> mirror, doing it system-wide vs just for my user etc...
>>>>> Then I noticed that 1.0-12 was released only a few days
>>>>> ago, so I downloaded the archived version of 1.0-11 and the
>>>>> install works. 
>>>>> http://cran.r-project.org/src/contrib/Archive/sp/
>>>> 
>>>>> R is 2.15.3 on Ubuntu 12.04
>>>> 
>>>>> Is there a bug in the package or does the new sp require
>>>>> R>3?
>>>> 
>>>>> Thanks, Alex
>>>> 
>>>>> _______________________________________________ R-sig-Geo
>>>>> mailing list R-sig-Geo at r-project.org 
>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>> 
>>>> 
>>>> 
>>>> _______________________________________________ R-sig-Geo
>>>> mailing list R-sig-Geo at r-project.org 
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>> 
>>> 
>>> _______________________________________________ R-sig-Geo
>>> mailing list R-sig-Geo at r-project.org 
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> 
>> 
>> 
> 
> _______________________________________________ R-sig-Geo mailing
> list R-sig-Geo at r-project.org 
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

- -- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
83 33081, Fax: +49 251 8339763 http://ifgi.uni-muenster.de
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.11 (GNU/Linux)
Comment: Using GnuPG with Thunderbird - http://www.enigmail.net/

iQEcBAEBAgAGBQJSKCfkAAoJEM1OCHCtOnfxH+AH+QE/DDfZIECVw1ACIljWYlrJ
5I+Wgj3FqfYYLWaXuRCNZDvsCU1+8SddD+cEWoz6Len2YI1GXBOhtNj0eBL3Ns85
WuhPI/Ahg0DuEwG6Fl+j3ER89/G9Rt5d/PfT4iszVRV8YVCr3Ra4JzStCuc03B3B
1i4gq7E1teDSzEVGtT+FEEHMmnMAmtCNnvNMEY2kjpWkg7jnRQ6UE7M0JpdeyQCP
xS6dhWzu37UxWBufCqkeMq2zF9mlUvvT9SwT01tkIPCtfn9/P7U8oChqUhTUj76v
jSoQMLEWhzTgbJE4eXDIv0BJjSW5QDbsTaN5l2PdviP+0vm3un4nMYKOJEhfZ84=
=Wdj8
-----END PGP SIGNATURE-----


From zuzulaz at gmail.com  Thu Sep  5 09:53:06 2013
From: zuzulaz at gmail.com (zuzana zajkova)
Date: Thu, 5 Sep 2013 09:53:06 +0200
Subject: [R-sig-Geo] Google maps/ Blue Marble in R
Message-ID: <CADQCJLDrxgOWnGyx_W2QGWTH3OZ1njr7iWQRHYgVhhh92rDO_w@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130905/332cdeb4/attachment.pl>

From alobolistas at gmail.com  Thu Sep  5 10:47:27 2013
From: alobolistas at gmail.com (Agustin Lobo)
Date: Thu, 5 Sep 2013 10:47:27 +0200
Subject: [R-sig-Geo] Wrong layer names written with writeRaster() (package
	raster)
Message-ID: <CAG4NRe+84tPRKDK-7y-NV88=UO=4uNNvB-P8NPaDVdUFk7p9+g@mail.gmail.com>

Envi and GTiff files (at least) do not keep the names of the brick object:

> require(rgdal)
Loading required package: rgdal
rgdal: version: 0.8-10, (SVN revision 478)
Geospatial Data Abstraction Library extensions to R successfully loaded
Loaded GDAL runtime: GDAL 1.10.0, released 2013/04/24
Path to GDAL shared files: /usr/share/gdal/1.10
Loaded PROJ.4 runtime: Rel. 4.8.0, 6 March 2012, [PJ_VERSION: 480]
Path to PROJ.4 shared files: (autodetected)

require(raster)
m <- raster(matrix(10,ncol=10,nrow=10))
bm <- brick(m,m,m)
names(bm) <- paste("Pepa",1:3,sep="")
names(bm)
writeRaster(bm,"delme",format="ENVI",bandorder="BSQ",datatype="INT2S",overwrite=TRUE)

in the hdr file:
  band names = {
    Band 1,
    Band 2,
    Band 3}

Is this a bug?
Thanks,
Agus


> sessionInfo()
R version 2.15.2 (2012-10-26)
Platform: x86_64-pc-linux-gnu (64-bit)

locale:
 [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
LC_TIME=es_ES.UTF-8        LC_COLLATE=en_US.UTF-8
LC_MONETARY=es_ES.UTF-8    LC_MESSAGES=en_US.UTF-8
 [7] LC_PAPER=C                 LC_NAME=C
LC_ADDRESS=C               LC_TELEPHONE=C
LC_MEASUREMENT=es_ES.UTF-8 LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] rgdal_0.8-10  raster_2.1-37 sp_1.0-9

loaded via a namespace (and not attached):
 [1] colorspace_1.2-2   dichromat_2.0-0    digest_0.6.3
ggplot2_0.9.3.1    grid_2.15.2        gtable_0.1.2       labeling_0.2
     lattice_0.20-13    MASS_7.3-23
[10] munsell_0.4        plyr_1.8           proto_0.3-10
RColorBrewer_1.0-5 reshape2_1.2.2     scales_0.2.3       stringr_0.6.2
     tools_2.15.2


From alfios17 at hotmail.com  Thu Sep  5 15:43:31 2013
From: alfios17 at hotmail.com (Lorenzo Alfieri)
Date: Thu, 5 Sep 2013 15:43:31 +0200
Subject: [R-sig-Geo] calculate CRPS on rasters
In-Reply-To: <DUB107-W46A7961B703A9341505350D7430@phx.gbl>
References: <DUB107-W547430534E219882EBB13AD75F0@phx.gbl>,
	<CALjAYt6L_0pkvaRFbZNTGdE4zyNZdR9yBdrP3vqP6d7BByYgmg@mail.gmail.com>,
	<DUB107-W15DBDD3807924285ABD430D75E0@phx.gbl>,
	<CANtt_hzGYYEk38TgYws+npfLwAg2Z6VG1fv0GW9YHjQiCvhbVw@mail.gmail.com>,
	<DUB107-W649F6E7FC94975EE3E9E28D75C0@phx.gbl>,
	<CANtt_hx-yw9ngJZ3LxHRy=KpN8V6dtMy3R=LsQojf0f-XMeOSw@mail.gmail.com>,
	<DUB107-W46A7961B703A9341505350D7430@phx.gbl>
Message-ID: <DUB124-W25316AB62F89586BD20A62D7330@phx.gbl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130905/eeb5cab8/attachment.pl>

From vitale232 at gmail.com  Thu Sep  5 17:50:15 2013
From: vitale232 at gmail.com (Andrew Vitale)
Date: Thu, 5 Sep 2013 08:50:15 -0700
Subject: [R-sig-Geo] calculate CRPS on rasters
In-Reply-To: <DUB124-W25316AB62F89586BD20A62D7330@phx.gbl>
References: <DUB107-W547430534E219882EBB13AD75F0@phx.gbl>
	<CALjAYt6L_0pkvaRFbZNTGdE4zyNZdR9yBdrP3vqP6d7BByYgmg@mail.gmail.com>
	<DUB107-W15DBDD3807924285ABD430D75E0@phx.gbl>
	<CANtt_hzGYYEk38TgYws+npfLwAg2Z6VG1fv0GW9YHjQiCvhbVw@mail.gmail.com>
	<DUB107-W649F6E7FC94975EE3E9E28D75C0@phx.gbl>
	<CANtt_hx-yw9ngJZ3LxHRy=KpN8V6dtMy3R=LsQojf0f-XMeOSw@mail.gmail.com>
	<DUB107-W46A7961B703A9341505350D7430@phx.gbl>
	<DUB124-W25316AB62F89586BD20A62D7330@phx.gbl>
Message-ID: <CAFTcope_ZRG28d2d7BtU08MVRXV-ibSxBARfb35C8hzbbZun-g@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130905/dea8d771/attachment.pl>

From alfios17 at hotmail.com  Thu Sep  5 18:33:32 2013
From: alfios17 at hotmail.com (Lorenzo Alfieri)
Date: Thu, 5 Sep 2013 18:33:32 +0200
Subject: [R-sig-Geo] calculate CRPS on rasters
In-Reply-To: <CAFTcope_ZRG28d2d7BtU08MVRXV-ibSxBARfb35C8hzbbZun-g@mail.gmail.com>
References: <DUB107-W547430534E219882EBB13AD75F0@phx.gbl>,
	<CALjAYt6L_0pkvaRFbZNTGdE4zyNZdR9yBdrP3vqP6d7BByYgmg@mail.gmail.com>,
	<DUB107-W15DBDD3807924285ABD430D75E0@phx.gbl>,
	<CANtt_hzGYYEk38TgYws+npfLwAg2Z6VG1fv0GW9YHjQiCvhbVw@mail.gmail.com>,
	<DUB107-W649F6E7FC94975EE3E9E28D75C0@phx.gbl>,
	<CANtt_hx-yw9ngJZ3LxHRy=KpN8V6dtMy3R=LsQojf0f-XMeOSw@mail.gmail.com>,
	<DUB107-W46A7961B703A9341505350D7430@phx.gbl>,
	<DUB124-W25316AB62F89586BD20A62D7330@phx.gbl>,
	<CAFTcope_ZRG28d2d7BtU08MVRXV-ibSxBARfb35C8hzbbZun-g@mail.gmail.com>
Message-ID: <DUB124-W126DE52BDC45A154F6C3D9D7330@phx.gbl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130905/6ddb71f3/attachment.pl>

From vitale232 at gmail.com  Thu Sep  5 18:43:48 2013
From: vitale232 at gmail.com (Andrew Vitale)
Date: Thu, 5 Sep 2013 09:43:48 -0700
Subject: [R-sig-Geo] calculate CRPS on rasters
In-Reply-To: <DUB124-W126DE52BDC45A154F6C3D9D7330@phx.gbl>
References: <DUB107-W547430534E219882EBB13AD75F0@phx.gbl>
	<CALjAYt6L_0pkvaRFbZNTGdE4zyNZdR9yBdrP3vqP6d7BByYgmg@mail.gmail.com>
	<DUB107-W15DBDD3807924285ABD430D75E0@phx.gbl>
	<CANtt_hzGYYEk38TgYws+npfLwAg2Z6VG1fv0GW9YHjQiCvhbVw@mail.gmail.com>
	<DUB107-W649F6E7FC94975EE3E9E28D75C0@phx.gbl>
	<CANtt_hx-yw9ngJZ3LxHRy=KpN8V6dtMy3R=LsQojf0f-XMeOSw@mail.gmail.com>
	<DUB107-W46A7961B703A9341505350D7430@phx.gbl>
	<DUB124-W25316AB62F89586BD20A62D7330@phx.gbl>
	<CAFTcope_ZRG28d2d7BtU08MVRXV-ibSxBARfb35C8hzbbZun-g@mail.gmail.com>
	<DUB124-W126DE52BDC45A154F6C3D9D7330@phx.gbl>
Message-ID: <CAFTcopc8t5yT+zVv9iJD5jZW579oFSFH8g=yb6qV4Gey5+q6Gw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130905/40cc3b5a/attachment.pl>

From alfios17 at hotmail.com  Thu Sep  5 18:49:49 2013
From: alfios17 at hotmail.com (Lorenzo Alfieri)
Date: Thu, 5 Sep 2013 18:49:49 +0200
Subject: [R-sig-Geo] calculate CRPS on rasters
In-Reply-To: <CAFTcopc8t5yT+zVv9iJD5jZW579oFSFH8g=yb6qV4Gey5+q6Gw@mail.gmail.com>
References: <DUB107-W547430534E219882EBB13AD75F0@phx.gbl>,
	<CALjAYt6L_0pkvaRFbZNTGdE4zyNZdR9yBdrP3vqP6d7BByYgmg@mail.gmail.com>,
	<DUB107-W15DBDD3807924285ABD430D75E0@phx.gbl>,
	<CANtt_hzGYYEk38TgYws+npfLwAg2Z6VG1fv0GW9YHjQiCvhbVw@mail.gmail.com>,
	<DUB107-W649F6E7FC94975EE3E9E28D75C0@phx.gbl>,
	<CANtt_hx-yw9ngJZ3LxHRy=KpN8V6dtMy3R=LsQojf0f-XMeOSw@mail.gmail.com>,
	<DUB107-W46A7961B703A9341505350D7430@phx.gbl>,
	<DUB124-W25316AB62F89586BD20A62D7330@phx.gbl>,
	<CAFTcope_ZRG28d2d7BtU08MVRXV-ibSxBARfb35C8hzbbZun-g@mail.gmail.com>,
	<DUB124-W126DE52BDC45A154F6C3D9D7330@phx.gbl>,
	<CAFTcopc8t5yT+zVv9iJD5jZW579oFSFH8g=yb6qV4Gey5+q6Gw@mail.gmail.com>
Message-ID: <DUB124-W5193E0C9FAA2FBCF7AC3E0D7330@phx.gbl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130905/24000498/attachment.pl>

From vitale232 at gmail.com  Thu Sep  5 19:19:22 2013
From: vitale232 at gmail.com (Andrew Vitale)
Date: Thu, 5 Sep 2013 10:19:22 -0700
Subject: [R-sig-Geo] calculate CRPS on rasters
In-Reply-To: <DUB124-W5193E0C9FAA2FBCF7AC3E0D7330@phx.gbl>
References: <DUB107-W547430534E219882EBB13AD75F0@phx.gbl>
	<CALjAYt6L_0pkvaRFbZNTGdE4zyNZdR9yBdrP3vqP6d7BByYgmg@mail.gmail.com>
	<DUB107-W15DBDD3807924285ABD430D75E0@phx.gbl>
	<CANtt_hzGYYEk38TgYws+npfLwAg2Z6VG1fv0GW9YHjQiCvhbVw@mail.gmail.com>
	<DUB107-W649F6E7FC94975EE3E9E28D75C0@phx.gbl>
	<CANtt_hx-yw9ngJZ3LxHRy=KpN8V6dtMy3R=LsQojf0f-XMeOSw@mail.gmail.com>
	<DUB107-W46A7961B703A9341505350D7430@phx.gbl>
	<DUB124-W25316AB62F89586BD20A62D7330@phx.gbl>
	<CAFTcope_ZRG28d2d7BtU08MVRXV-ibSxBARfb35C8hzbbZun-g@mail.gmail.com>
	<DUB124-W126DE52BDC45A154F6C3D9D7330@phx.gbl>
	<CAFTcopc8t5yT+zVv9iJD5jZW579oFSFH8g=yb6qV4Gey5+q6Gw@mail.gmail.com>
	<DUB124-W5193E0C9FAA2FBCF7AC3E0D7330@phx.gbl>
Message-ID: <CAFTcopcjkUDpKWgEjDj=xsa94Wax1zF59=_w93XhtEjL0hBuAA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130905/b6770694/attachment.pl>

From galuardi at mit.edu  Thu Sep  5 19:24:38 2013
From: galuardi at mit.edu (Ben)
Date: Thu, 05 Sep 2013 13:24:38 -0400
Subject: [R-sig-Geo] Google maps/ Blue Marble in R
In-Reply-To: <CADQCJLDrxgOWnGyx_W2QGWTH3OZ1njr7iWQRHYgVhhh92rDO_w@mail.gmail.com>
References: <CADQCJLDrxgOWnGyx_W2QGWTH3OZ1njr7iWQRHYgVhhh92rDO_w@mail.gmail.com>
Message-ID: <5228BE56.9020108@mit.edu>

try ggmap. http://cran.r-project.org/web/packages/ggmap/index.html

and

http://stat405.had.co.nz/ggmap.pdf

should get you going!

Ben

On 9/5/2013 3:53 AM, zuzana zajkova wrote:
> Hi,
>
> I would like to ask some questions... My aim is produce nice maps of
> distribution (kernels) of my studied species. So far I have been using
> "rworldmap" to get general view, but for presentation I would like to make
> the maps more beautiful :)
> I was able to get the Google maps (using "dismo" package) and create a map,
> but I am not able to add axes and legend to this map, what makes it quite
> useless as a map... Any suggestions?
>
> library(dismo)
> e <- extent( -60 , -10 , 0 , 40 )  ## extent (long, long, lat, lat)
> r <- gmap(e, type="satellite", scale=2)
> plot(r, interpolate=TRUE)
>
>
> Other thing is that I am open to use any other map as a background
> (preferably with topografhy and bathymetry), for example does anyone know
> if it is possible to use "Blue Marble" map for this?
>
> Thank you in advance for your suggestions.
>
> Zuzana
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


-- 
==================================================
Benjamin Galuardi
-
PhD Student
NMFS-Seagrant Population Dynamics Fellow
SMAST, UMass Dartmouth
-
T: 978 283 0368


From bakare at ualberta.ca  Fri Sep  6 00:12:54 2013
From: bakare at ualberta.ca (Moshood Agba Bakare)
Date: Thu, 5 Sep 2013 16:12:54 -0600
Subject: [R-sig-Geo] Fitting variogram model using NLS function in R
In-Reply-To: <522821BB.40509@uni-muenster.de>
References: <CAJRR3XPy8o5shw=hjfdHFHLURpiFBQwaVfrhDBUKec15_Y1-Hw@mail.gmail.com>
	<52270E20.4090705@uni-muenster.de>
	<CAJRR3XNtbNmC73MQxT0A6jCssGFXKJfRaU7x-cu0y6yjeUOs4A@mail.gmail.com>
	<52277067.40707@uni-muenster.de>
	<CAJRR3XOWnJsO6zD+jsuA=VkANR8=GcZ_rK4_PGM5-8a=LPyehg@mail.gmail.com>
	<522821BB.40509@uni-muenster.de>
Message-ID: <CAJRR3XNEzv6uwWbNdpfy0p044etAi=_YYuzgpDA4nOvr6shTVw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130905/b8cf10f9/attachment.pl>

From oscar.perpinan at gmail.com  Fri Sep  6 08:58:56 2013
From: oscar.perpinan at gmail.com (Oscar =?utf-8?B?UGVycGnDscOhbg==?= Lamigueiro)
Date: Fri, 06 Sep 2013 08:58:56 +0200
Subject: [R-sig-Geo] Google maps/ Blue Marble in R
In-Reply-To: <CADQCJLDrxgOWnGyx_W2QGWTH3OZ1njr7iWQRHYgVhhh92rDO_w@mail.gmail.com>
References: <CADQCJLDrxgOWnGyx_W2QGWTH3OZ1njr7iWQRHYgVhhh92rDO_w@mail.gmail.com>
Message-ID: <86fvtimo5r.fsf@Triskela.Home>

Hello,

I am not sure if it fits your problem, but perhaps this example I posted
some months ago is useful for you:
http://procomun.wordpress.com/2013/04/24/stamen-maps-with-spplot/.
It combines a Stamen map (retrieved with the ggmap or OpenStreetMap
packages) with an SpatialPointsDataFrame displayed with spplot.

Could you send a sample of your data to give you a better answer?

Best,

Oscar.

-- 
Oscar Perpi??n Lamigueiro
Grupo de Sistemas Fotovoltaicos (IES-UPM)
Dpto. Ingenier?a El?ctrica (EUITI-UPM)
URL: http://http://oscarperpinan.github.io
Twitter: @oscarperpinan

zuzana zajkova writes:

> Hi,
>
> I would like to ask some questions... My aim is produce nice maps of
> distribution (kernels) of my studied species. So far I have been using
> "rworldmap" to get general view, but for presentation I would like to make
> the maps more beautiful :)
> I was able to get the Google maps (using "dismo" package) and create a map,
> but I am not able to add axes and legend to this map, what makes it quite
> useless as a map... Any suggestions?
>
> library(dismo)
> e <- extent( -60 , -10 , 0 , 40 )  ## extent (long, long, lat, lat)
> r <- gmap(e, type="satellite", scale=2)
> plot(r, interpolate=TRUE)
>
>
> Other thing is that I am open to use any other map as a background
> (preferably with topografhy and bathymetry), for example does anyone know
> if it is possible to use "Blue Marble" map for this?
>
> Thank you in advance for your suggestions.
>
> Zuzana
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From oscar.perpinan at gmail.com  Fri Sep  6 09:48:09 2013
From: oscar.perpinan at gmail.com (Oscar =?utf-8?B?UGVycGnDscOhbg==?= Lamigueiro)
Date: Fri, 06 Sep 2013 09:48:09 +0200
Subject: [R-sig-Geo] how to use levelplot() with a geographic projection
In-Reply-To: <A632B3F93D861843A3C966F3962C3F840148AE93A009@EMAIL05.pnl.gov>
References: <A632B3F93D861843A3C966F3962C3F840148AE939952@EMAIL05.pnl.gov>,
	<CALyPt8ytCF=uaNi=0CWjMoWEjNDDJf1-WKFLCTx5UrD_WOcQ8g@mail.gmail.com>,
	<CAMLL7b=+5j-tJWdeNcHnEs025vcBBthprUWj0km-evBt9=zhnw@mail.gmail.com>,
	<A632B3F93D861843A3C966F3962C3F840148AE93A009@EMAIL05.pnl.gov>
Message-ID: <86eh92mlvq.fsf@Triskela.Home>

Hi,

I think your problem is related with the way you define the
RasterLayer. You should use cellFromXY instead.  

Try the example below.

Best,

Oscar. 

## vectors of latitude and longitude with non-NA values
longitude <- sample(seq(-130, -65, .1), 2000, replace=TRUE)
latitude <- sample(seq(25, 50, .1), 2000, replace=TRUE)
xmn <- min(longitude);
xmx <- max(longitude)
ymn <- min(latitude);
ymx <- max(latitude)

## Build a raster fill with NA
myrast <- raster(xmn=xmn, xmx=xmx, ymn=ymn, ymx=ymx, ncols=162, nrows=162)
## Extract the cell numbers corresponding to non-NA values
mycells <- cellFromXY(myrast, cbind(longitude, latitude))
## and fill them with the appropiate values
myrast[mycells] <- runif(length(longitude))

## Ready to plot...
ext <- as.vector(extent(myrast))
boundaries <- map('state', fill=TRUE, xlim=ext[1:2], ylim=ext[3:4], plot=FALSE)
IDs <- sapply(strsplit(boundaries$names, ":"), function(x) x[1])
bPols <- map2SpatialPolygons(boundaries, IDs=IDs, proj4string=CRS(projection(myrast)))

levelplot(myrast,
          panel = function(...) {
              panel.levelplot(...)
              sp.polygons(bPols)
          },
          margin=F)
Waichler, Scott R writes:

> Hi again,
>
> In working on this some more I discovered that I need to transpose a data matrix, then flip the raster object created from the matrix to get the proper rendering in a plot.  Can someone explain why that is?
>
> My example has to do with the state of California, with 2918 1/8-degree cells.  I regret I can't provide a small working example--I don't know to make one up that would clearly show correct vs. incorrect geographic rendering.
>
> library(maps)
> library(maptools)
> library(raster)
> library(rasterVis)
> data(stateMapEnv)
> state.map <- map("state", plot=F)
>
> # longitude and latitude are vectors giving the respective coordinates 
> # for cells that are non-NA (n=2918)
>
> xmn <- min(longitude); xmx <- max(longitude)
> ymn <- min(latitude);  ymx <- max(latitude)
> x.bounds <- seq(xmn - 1/16, xmx + 1/16, by = 1/8)  # grid spacing is 1/8 degree
> y.bounds <- seq(ymn - 1/16, ymx + 1/16, by = 1/8)
> ii <- findInterval(longitude, x.bounds)  # indices
> jj <- findInterval(latitude, y.bounds)   # indices
> index.matrix <- cbind(ii,jj)
> num.long <- length(x.bounds) - 1
> num.lat <- length(y.bounds) - 1
> mat <- array(NA, dim=c(num.long, num.lat)) # full, enclosing array with rows=long and columns=lat
> mat[index.matrix] <- runif(n=length(longitude))  # insert non-NA values in the right cells
>
> # Why do I need to transpose the matrix then flip the raster for proper rendering in levelplot?
> myrast <- flip(raster(t(mat), xmn=xmn, xmx=xmx, ymn=ymn, ymx=ymx, 
>                       crs="+proj=longlat +datum=WGS84"), 
>                direction="y")
>
> ext <- as.vector(extent(myrast))
> boundaries <- map('state', fill=TRUE, xlim=ext[1:2], ylim=ext[3:4], plot=FALSE)
> IDs <- sapply(strsplit(boundaries$names, ":"), function(x) x[1])
> bPols <- map2SpatialPolygons(boundaries, IDs=IDs, proj4string=CRS(projection(myrast)))
>
> levelplot(myrast,
>           panel = function(...) {
>               panel.levelplot(...)
>               sp.polygons(bPols)
>           },
>           margin=F)
>
> --Scott Waichler


-- 
Oscar Perpi??n Lamigueiro
Grupo de Sistemas Fotovoltaicos (IES-UPM)
Dpto. Ingenier?a El?ctrica (EUITI-UPM)
URL: http://http://oscarperpinan.github.io
Twitter: @oscarperpinan


From r_sig_geo at libero.it  Fri Sep  6 14:17:51 2013
From: r_sig_geo at libero.it (r_sig_geo at libero.it)
Date: Fri, 6 Sep 2013 14:17:51 +0200 (CEST)
Subject: [R-sig-Geo] Intamap and "honoring" original data
Message-ID: <28274253.28211011378469871911.JavaMail.defaultUser@defaultHost>

Hi to all.
My problem is to force a Kriging prediction to "honour" original data. This is 
because I need to interpolate values that represent the Bayesian probability 
that a particular event occurs. For Instance, If for a locality I computed a 
probability = 1, or p=0.6, I need to possibly keep unchanged these values after 
the interpolation. I  know this is a stretch  according to what Kriging really 
does. As I need to perform interpolation automatically, I'm using package 
"intamap" that is great! I found the function "unbiasedKrige" that should 
perform , if I understood well, exactly what  I need. Unfortunately, I find out 
that even by using this function (both using MOK and IWQSEL, tested many times 
with different parameters) the predicted values are still too far from original 
data at the same locations. What can you suggest me? Thanks.


From ROONEYJ4 at tcd.ie  Fri Sep  6 17:15:32 2013
From: ROONEYJ4 at tcd.ie (James Rooney)
Date: Fri, 6 Sep 2013 16:15:32 +0100
Subject: [R-sig-Geo] DCluster questions
Message-ID: <75C8D19A1470D344A8AF5312F01160A602B96C5CB907@GOMAIL.college.tcd.ie>

Hi all,

I'm wondering if I can get a little advice on using DCluster.
I have produced a map of areal incidence rates and I'd like to try and detect clusters.
I have also implemented Bayesian smoothing and have therefore pre and post smoothing maps.

I have some code as follow for detecting clusters using the Kuldorff-Nagarwalla analysis (code based on Fig11.18 in the ASDAR book and this useful question and answer: http://r-sig-geo.2731867.n2.nabble.com/Strange-results-in-DCluster-package-td7326832.html )


# get centroids of polygons
Areas$x<-coordinates(Areas)[,1]
Areas$y<-coordinates(Areas)[,2]

#Create the data frame demanded by DCluster
sa<-data.frame(Observed=Areas$obs)
sa<-cbind(sa, Expected=mean(Areas$exp))
sa<-cbind(sa, x=Areas$x, y=Areas$y)
sa$Observed<-as.numeric(sa$Observed)


#Kuldorff-Nagarwalla analysis
mle<-calculate.mle(sa, model="poisson") 
knres<-opgam(data=sa, thegrid=sa[,c("x", "y")], alpha=.1, R=20,
             iscluster=kn.iscluster, fractpop=.10, model="poisson", mle=mle, log.v=TRUE)


This seems to work ok however there are a few things I'm confused on:
1) Should I be using this algorithm on my incidence rates pre or post Bayesian smoothing ? I'm thinking that the mle expression above includes a smooth (do I understand that correctly ?) - but I' prefer to utilise my hard-won Bayesian smooth if possible.

2) Will opgam/kn.iscluster only detect "hotspots" or will they also detect "coldspots" i.e. areas of statistically unlikely lower incidence rates ?

3) I'm not familiar with bootstrapping - how many bootstraps should I be running and why (i.e. - what should I set R to) ?

4) How do I decide what the correct value for fractpop is ? I initially had it set to .25 and I was getting cluster of 50% of my cases which made no sense.

5) Is there any correction for multiple testing in the opgam() command ? I have over 3000 areas - do I need to set a very low alpha ?

I would be grateful for any enlightenment anyone may have to pass on :)

Many thanks,
James


From Virgilio.Gomez at uclm.es  Fri Sep  6 23:05:42 2013
From: Virgilio.Gomez at uclm.es (Virgilio Gomez Rubio)
Date: Fri, 06 Sep 2013 23:05:42 +0200
Subject: [R-sig-Geo] DCluster questions
In-Reply-To: <75C8D19A1470D344A8AF5312F01160A602B96C5CB907@GOMAIL.college.tcd.ie>
References: <75C8D19A1470D344A8AF5312F01160A602B96C5CB907@GOMAIL.college.tcd.ie>
Message-ID: <1378501542.3727.23.camel@Virgilio-Gomez>

Dear James,

> I'm wondering if I can get a little advice on using DCluster.
> I have produced a map of areal incidence rates and I'd like to try and detect clusters.
> I have also implemented Bayesian smoothing and have therefore pre and post smoothing maps.

> This seems to work ok however there are a few things I'm confused on:
> 1) Should I be using this algorithm on my incidence rates pre or post Bayesian smoothing ? 
> I'm thinking that the mle expression above includes a smooth (do I understand that correctly ?) - 
> but I' prefer to utilise my hard-won Bayesian smooth if possible.

In principle, you should use the observed and expected (from rate
standardisation) cases. calculate.mle() just groups the data in a
suitable list to be used when resampling from the desired distribution
to compute p-values, i.e., this function computes the summary statistics
and parameters to be used in the bootstrapping.


> 2) Will opgam/kn.iscluster only detect "hotspots" or will they also detect 
> "coldspots" i.e. areas of statistically unlikely lower incidence rates ?

You get a p-value, so you could take the areas with very large p-values
as cold-spots. But detection of cold-spots is not of interest, is it?


> 3) I'm not familiar with bootstrapping - how many bootstraps should I be running and why 
> (i.e. - what should I set R to) ?

I believe that 99 should be fine, but you may increase it a bit. With 99
replicates you can find clusters up to a significance level of 0.01.
Higher number of replicates will heklp you to detect clusters which are
significant below this 0.01 level (which may be useful if you correct
for multiple testing, see below).

> 
> 4) How do I decide what the correct value for fractpop is ? I initially had it set to .25 and I 
> was getting cluster of 50% of my cases which made no sense.

You may try different values of fractpop if you want to detect smaller
clusters. 


> 5) Is there any correction for multiple testing in the opgam() command ? I have over 3000 areas - 
> do I need to set a very low alpha ?

For the Spatial Scan Statistic you should only pay attention to the
significance of the most likely cluster, as this is what Kulldorff's
test is testing for. But you can use the p-value reported for the other
secondary  clusters as a guidance.

For GAM, you probably want to make a multiple test correction. Another
good option is to plot the centres of the clusters detected as this will
give you and idea of the areas with significant high risk.

Hope this helps.

Virgilio


From Scott.Waichler at pnnl.gov  Sat Sep  7 00:12:36 2013
From: Scott.Waichler at pnnl.gov (Waichler, Scott R)
Date: Fri, 6 Sep 2013 15:12:36 -0700
Subject: [R-sig-Geo] how to use levelplot() with a geographic projection
In-Reply-To: <86eh92mlvq.fsf@Triskela.Home>
References: <A632B3F93D861843A3C966F3962C3F840148AE939952@EMAIL05.pnl.gov>,
	<CALyPt8ytCF=uaNi=0CWjMoWEjNDDJf1-WKFLCTx5UrD_WOcQ8g@mail.gmail.com>,
	<CAMLL7b=+5j-tJWdeNcHnEs025vcBBthprUWj0km-evBt9=zhnw@mail.gmail.com>,
	<A632B3F93D861843A3C966F3962C3F840148AE93A009@EMAIL05.pnl.gov>
	<86eh92mlvq.fsf@Triskela.Home>
Message-ID: <A632B3F93D861843A3C966F3962C3F840148AE93A1FC@EMAIL05.pnl.gov>

For the archive, here is a complete example of using rasterVis to do the following:

-- use levelplot() to draw multiple panels with maps being geographically correct
-- create raster objects and supply values for some of the cells, selected from
   a matrix of longitude, latitude coordinates
-- overlay polygons (state boundaries) for reference

Thanks to Oscar Perpi??n Lamigueiro and Tom Philippi for their help.

library(maps)
library(maptools)
library(raster)
library(rasterVis)

data(stateMapEnv)  # for U.S. state boundaries
state.map <- map("state", plot=F)
set_Polypath(FALSE)  # per Roger Bivand, allows overprinting with sp.polygons()

# generate geographic cell boundaries that cover the northwest U.S.
lon.cell.bounds <- seq(-125, -109, by=1)
lat.cell.bounds <- seq(41, 49, by=1)
# save min and max for raster later
xmn <- min(lon.cell.bounds); xmx <- max(lon.cell.bounds)
ymn <- min(lat.cell.bounds); ymx <- max(lat.cell.bounds)
# get the centers of the cells
lon <- (lon.cell.bounds[1:(length(lon.cell.bounds)-1)] + lon.cell.bounds[2:length(lon.cell.bounds)]) / 2
lat <- (lat.cell.bounds[1:(length(lat.cell.bounds)-1)] + lat.cell.bounds[2:length(lat.cell.bounds)]) / 2
num.lon <- length(lon)  # number of cells in longitude (x)
num.lat <- length(lat)  # number of cells in latitude (y)

# Create a matrix of selected cell coordinates, roughly corresponding to the state of Washington.
select.lon <- seq(-123.5, -117.5, by=1)
select.lat <- seq(46.5, 48.5, by=1)
select.coords <- expand.grid(select.lon, select.lat)
num.sel.cells <- nrow(select.coords)

raster.layers <- list()
for(i in 1:4) {
  # make the raster object
  myrast <- raster(xmn=xmn, xmx=xmx, ymn=ymn, ymx=ymx, ncols=num.lon, nrows=num.lat)
  # use cellFromXY() to select the target cells in the raster
  select.cell.numbers <- cellFromXY(myrast, select.coords)
  # give the selected cells some values
  myrast[select.cell.numbers] <- seq(i, i+1, length=num.sel.cells)
  # save the raster to the list
  raster.layers[[i]] <- myrast  
}
raster.stack <- stack(raster.layers)  # stack is a collection of RasterLayer objects

# polygon shapefile for the state boundaries
ext <- as.vector(extent(raster.stack[[1]]))
boundaries <- map('state', fill=TRUE, xlim=ext[1:2], ylim=ext[3:4], plot=FALSE)
IDs <- sapply(strsplit(boundaries$names, ":"), function(x) x[1])
bPols <- map2SpatialPolygons(boundaries, IDs=IDs, proj4string=CRS(projection(raster.stack[[1]])))

# plot it!
levelplot(raster.stack,
          names.attr=c("Panel 1, 1-2", "Panel 2, 2-3", "Panel 3, 3-4", "Panel 4, 4-5"), 
          panel = function(...) {
              panel.levelplot(...)
              sp.polygons(bPols)
          }, main=paste(sep="\n", "Washington should be mostly covered with a rectangle",
               "and color should be darkest in lower left corner,",
               "lightest in upper right"),
          margin=F)

> -----Original Message-----
> From: Oscar Perpi??n Lamigueiro [mailto:oscar.perpinan at gmail.com]
> Subject: Re: [R-sig-Geo] how to use levelplot() with a geographic
> projection
> 
> Hi,
> 
> I think your problem is related with the way you define the RasterLayer.
> You should use cellFromXY instead.

From oscar.perpinan at gmail.com  Sat Sep  7 09:31:34 2013
From: oscar.perpinan at gmail.com (Oscar =?utf-8?B?UGVycGnDscOhbg==?= Lamigueiro)
Date: Sat, 07 Sep 2013 09:31:34 +0200
Subject: [R-sig-Geo] how to use levelplot() with a geographic projection
In-Reply-To: <A632B3F93D861843A3C966F3962C3F840148AE93A1FC@EMAIL05.pnl.gov>
References: <A632B3F93D861843A3C966F3962C3F840148AE939952@EMAIL05.pnl.gov>,
	<86eh92mlvq.fsf@Triskela.Home>,
	<A632B3F93D861843A3C966F3962C3F840148AE93A1FC@EMAIL05.pnl.gov>
Message-ID: <86hadx3x61.fsf@Triskela.Home>

Hello,

Scott, here I propose a different way to build and fill the RasterStack
object:

## make the stack object
myrast <- raster(xmn=xmn, xmx=xmx, ymn=ymn, ymx=ymx, ncols=num.lon, nrows=num.lat)
myrast[] <- NA
raster.stack <- stack(lapply(1:4, function(i)myrast))

## use cellFromXY() to select the target cells in the raster
select.cell.numbers <- cellFromXY(raster.stack, select.coords)

## give the selected cells some values
vals <- sapply(1:4, function(i)seq(i, i+1, length=num.sel.cells))
raster.stack[select.cell.numbers] <- vals

Best,

Oscar

Waichler, Scott R writes:

> For the archive, here is a complete example of using rasterVis to do the following:
>
> -- use levelplot() to draw multiple panels with maps being geographically correct
> -- create raster objects and supply values for some of the cells, selected from
>    a matrix of longitude, latitude coordinates
> -- overlay polygons (state boundaries) for reference
>
> Thanks to Oscar Perpi??n Lamigueiro and Tom Philippi for their help.
>
> library(maps)
> library(maptools)
> library(raster)
> library(rasterVis)
>
> data(stateMapEnv)  # for U.S. state boundaries
> state.map <- map("state", plot=F)
> set_Polypath(FALSE)  # per Roger Bivand, allows overprinting with sp.polygons()
>
> # generate geographic cell boundaries that cover the northwest U.S.
> lon.cell.bounds <- seq(-125, -109, by=1)
> lat.cell.bounds <- seq(41, 49, by=1)
> # save min and max for raster later
> xmn <- min(lon.cell.bounds); xmx <- max(lon.cell.bounds)
> ymn <- min(lat.cell.bounds); ymx <- max(lat.cell.bounds)
> # get the centers of the cells
> lon <- (lon.cell.bounds[1:(length(lon.cell.bounds)-1)] + lon.cell.bounds[2:length(lon.cell.bounds)]) / 2
> lat <- (lat.cell.bounds[1:(length(lat.cell.bounds)-1)] + lat.cell.bounds[2:length(lat.cell.bounds)]) / 2
> num.lon <- length(lon)  # number of cells in longitude (x)
> num.lat <- length(lat)  # number of cells in latitude (y)
>
> # Create a matrix of selected cell coordinates, roughly corresponding to the state of Washington.
> select.lon <- seq(-123.5, -117.5, by=1)
> select.lat <- seq(46.5, 48.5, by=1)
> select.coords <- expand.grid(select.lon, select.lat)
> num.sel.cells <- nrow(select.coords)
>
> raster.layers <- list()
> for(i in 1:4) {
>   # make the raster object
>   myrast <- raster(xmn=xmn, xmx=xmx, ymn=ymn, ymx=ymx, ncols=num.lon, nrows=num.lat)
>   # use cellFromXY() to select the target cells in the raster
>   select.cell.numbers <- cellFromXY(myrast, select.coords)
>   # give the selected cells some values
>   myrast[select.cell.numbers] <- seq(i, i+1, length=num.sel.cells)
>   # save the raster to the list
>   raster.layers[[i]] <- myrast  
> }
> raster.stack <- stack(raster.layers)  # stack is a collection of RasterLayer objects
>
> # polygon shapefile for the state boundaries
> ext <- as.vector(extent(raster.stack[[1]]))
> boundaries <- map('state', fill=TRUE, xlim=ext[1:2], ylim=ext[3:4], plot=FALSE)
> IDs <- sapply(strsplit(boundaries$names, ":"), function(x) x[1])
> bPols <- map2SpatialPolygons(boundaries, IDs=IDs, proj4string=CRS(projection(raster.stack[[1]])))
>
> # plot it!
> levelplot(raster.stack,
>           names.attr=c("Panel 1, 1-2", "Panel 2, 2-3", "Panel 3, 3-4", "Panel 4, 4-5"), 
>           panel = function(...) {
>               panel.levelplot(...)
>               sp.polygons(bPols)
>           }, main=paste(sep="\n", "Washington should be mostly covered with a rectangle",
>                "and color should be darkest in lower left corner,",
>                "lightest in upper right"),
>           margin=F)
>
>> -----Original Message-----
>> From: Oscar Perpi??n Lamigueiro [mailto:oscar.perpinan at gmail.com]
>> Subject: Re: [R-sig-Geo] how to use levelplot() with a geographic
>> projection
>> 
>> Hi,
>> 
>> I think your problem is related with the way you define the RasterLayer.
>> You should use cellFromXY instead.


-- 
Oscar Perpi??n Lamigueiro
Grupo de Sistemas Fotovoltaicos (IES-UPM)
Dpto. Ingenier?a El?ctrica (EUITI-UPM)
URL: http://http://oscarperpinan.github.io
Twitter: @oscarperpinan


From r_sig_geo at libero.it  Sat Sep  7 14:14:55 2013
From: r_sig_geo at libero.it (r_sig_geo at libero.it)
Date: Sat, 7 Sep 2013 14:14:55 +0200 (CEST)
Subject: [R-sig-Geo] R:  Intamap and "honoring" original data
Message-ID: <26374661.34106911378556095617.JavaMail.defaultUser@defaultHost>

Any suggestions?


>Hi to all.
>My problem is to force a Kriging prediction to "honour" original data. This 
is 
>because I need to interpolate values that represent the Bayesian probability 
>that a particular event occurs. For Instance, If for a locality I computed a 
>probability = 1, or p=0.6, I need to possibly keep unchanged these values 
after 
>the interpolation. I  know this is a stretch  according to what Kriging 
really 
>does. As I need to perform interpolation automatically, I'm using package 
>"intamap" that is great! I found the function "unbiasedKrige" that should 
>perform , if I understood well, exactly what  I need. Unfortunately, I find 
out 
>that even by using this function (both using MOK and IWQSEL, tested many 
times 
>with different parameters) the predicted values are still too far from 
original 
>data at the same locations. What can you suggest me? Thanks.
>
>_______________________________________________
>R-sig-Geo mailing list
>R-sig-Geo at r-project.org
>https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From edzer.pebesma at uni-muenster.de  Sat Sep  7 15:22:41 2013
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Sat, 07 Sep 2013 15:22:41 +0200
Subject: [R-sig-Geo] R:  Intamap and "honoring" original data
In-Reply-To: <26374661.34106911378556095617.JavaMail.defaultUser@defaultHost>
References: <26374661.34106911378556095617.JavaMail.defaultUser@defaultHost>
Message-ID: <522B28A1.1070805@uni-muenster.de>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1



On 09/07/2013 02:14 PM, r_sig_geo at libero.it wrote:
> Any suggestions?

Several:

1. don't ask questions on this mailing list without revealing your
identity and affiliation,

2. don't expect people to answer within 24 hours and/or in weekends,

3. don't simply repost your questions to the nearly 3000 list members,
but rather try to improve your question in case of no response after,
say, a week without response. See also
https://stat.ethz.ch/pipermail/r-sig-geo/2013-September/019254.html .

> 
> 
>> Hi to all. My problem is to force a Kriging prediction to
>> "honour" original data. This
> is
>> because I need to interpolate values that represent the Bayesian
>> probability that a particular event occurs. For Instance, If for
>> a locality I computed a probability = 1, or p=0.6, I need to
>> possibly keep unchanged these values
> after
>> the interpolation. I  know this is a stretch  according to what
>> Kriging
> really
>> does. As I need to perform interpolation automatically, I'm using
>> package "intamap" that is great! I found the function
>> "unbiasedKrige" that should perform , if I understood well,
>> exactly what  I need. Unfortunately, I find
> out
>> that even by using this function (both using MOK and IWQSEL,
>> tested many
> times
>> with different parameters) the predicted values are still too far
>> from
> original
>> data at the same locations. What can you suggest me? Thanks.
>> 
>> _______________________________________________ R-sig-Geo mailing
>> list R-sig-Geo at r-project.org 
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> 
> 
> _______________________________________________ R-sig-Geo mailing
> list R-sig-Geo at r-project.org 
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

- -- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
83 33081, Fax: +49 251 8339763 http://ifgi.uni-muenster.de
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.11 (GNU/Linux)
Comment: Using GnuPG with Thunderbird - http://www.enigmail.net/

iQEcBAEBAgAGBQJSKyihAAoJEM1OCHCtOnfx+wEH/1f3bFjvtAiI1SlJxYEpR1zL
tgcERFOSRsB20w6GQuVeWrfKp0EaIM7hDIV3Z4LQNJdx9QrfMU/03JGJgX1daikK
05VbE+SQPpbCnT6tJBsye+Bo0wz4LKGyKkHsABAiFJJ13xNK8PXRtrlKsAfP3pGc
T3XOGVhnAsMAWxdNdX+Esk+k06B2KTAKpJVtogE+KFkKvlZcLS9nyXN+nE7joZgu
KLdTUxjYeY7D9RBdUe4u3QC2MFL9RDCztTaVl2KOPkw/VVLTb+6TfSlJaJN69xLv
4rzcP4zTnLFsJCx03hcYnhpSVHHgk4NY6SgN+21CdFKdQidMXNX0gca1ZzSeCsM=
=P3jO
-----END PGP SIGNATURE-----


From r_sig_geo at libero.it  Sat Sep  7 20:50:44 2013
From: r_sig_geo at libero.it (r_sig_geo at libero.it)
Date: Sat, 7 Sep 2013 20:50:44 +0200 (CEST)
Subject: [R-sig-Geo] R: Re:  R:  Intamap and "honoring" original data
Message-ID: <23493852.6997941378579844971.JavaMail.defaultUser@defaultHost>

Sorry, it is my fault. I'm new to this mailing list. Thanks for all the helpful 
suggestions said in a very elegant way.
Regards.

>----Messaggio originale----
>Da: edzer.pebesma at uni-muenster.de
>Data: 7-set-2013 15.22
>A: <r-sig-geo at r-project.org>
>Ogg: Re: [R-sig-Geo] R:  Intamap and &quot;honoring&quot; original data
>
>-----BEGIN PGP SIGNED MESSAGE-----
>Hash: SHA1
>
>
>
>On 09/07/2013 02:14 PM, r_sig_geo at libero.it wrote:
>> Any suggestions?
>
>Several:
>
>1. don't ask questions on this mailing list without revealing your
>identity and affiliation,
>
>2. don't expect people to answer within 24 hours and/or in weekends,
>
>3. don't simply repost your questions to the nearly 3000 list members,
>but rather try to improve your question in case of no response after,
>say, a week without response. See also
>https://stat.ethz.ch/pipermail/r-sig-geo/2013-September/019254.html .
>
>> 
>> 
>>> Hi to all. My problem is to force a Kriging prediction to
>>> "honour" original data. This
>> is
>>> because I need to interpolate values that represent the Bayesian
>>> probability that a particular event occurs. For Instance, If for
>>> a locality I computed a probability = 1, or p=0.6, I need to
>>> possibly keep unchanged these values
>> after
>>> the interpolation. I  know this is a stretch  according to what
>>> Kriging
>> really
>>> does. As I need to perform interpolation automatically, I'm using
>>> package "intamap" that is great! I found the function
>>> "unbiasedKrige" that should perform , if I understood well,
>>> exactly what  I need. Unfortunately, I find
>> out
>>> that even by using this function (both using MOK and IWQSEL,
>>> tested many
>> times
>>> with different parameters) the predicted values are still too far
>>> from
>> original
>>> data at the same locations. What can you suggest me? Thanks.
>>> 
>>> _______________________________________________ R-sig-Geo mailing
>>> list R-sig-Geo at r-project.org 
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>> 
>> 
>> _______________________________________________ R-sig-Geo mailing
>> list R-sig-Geo at r-project.org 
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> 
>
>- -- 
>Edzer Pebesma
>Institute for Geoinformatics (ifgi), University of M?nster
>Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
>83 33081, Fax: +49 251 8339763 http://ifgi.uni-muenster.de
>-----BEGIN PGP SIGNATURE-----
>Version: GnuPG v1.4.11 (GNU/Linux)
>Comment: Using GnuPG with Thunderbird - http://www.enigmail.net/
>
>iQEcBAEBAgAGBQJSKyihAAoJEM1OCHCtOnfx+wEH/1f3bFjvtAiI1SlJxYEpR1zL
>tgcERFOSRsB20w6GQuVeWrfKp0EaIM7hDIV3Z4LQNJdx9QrfMU/03JGJgX1daikK
>05VbE+SQPpbCnT6tJBsye+Bo0wz4LKGyKkHsABAiFJJ13xNK8PXRtrlKsAfP3pGc
>T3XOGVhnAsMAWxdNdX+Esk+k06B2KTAKpJVtogE+KFkKvlZcLS9nyXN+nE7joZgu
>KLdTUxjYeY7D9RBdUe4u3QC2MFL9RDCztTaVl2KOPkw/VVLTb+6TfSlJaJN69xLv
>4rzcP4zTnLFsJCx03hcYnhpSVHHgk4NY6SgN+21CdFKdQidMXNX0gca1ZzSeCsM=
>=P3jO
>-----END PGP SIGNATURE-----
>
>_______________________________________________
>R-sig-Geo mailing list
>R-sig-Geo at r-project.org
>https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From grothered at gmail.com  Sun Sep  8 09:23:54 2013
From: grothered at gmail.com (Gareth Davies)
Date: Sun, 08 Sep 2013 17:23:54 +1000
Subject: [R-sig-Geo] Extract function - too much data for R?
In-Reply-To: <CAPKp32sPC==HzPfxY0bt=HgvCyR1Msn2r_hqFKm5xhRKdFGMiw@mail.gmail.com>
References: <CAPKp32tJ1kAMiTxK7N_irLj0p7Akv9Kxmn_REz-cOEHypGG3vQ@mail.gmail.com>
	<CALyPt8yG6qrxD_NaU+eLgqRf-xu-HO43xLiTAFB5d00MaEH02g@mail.gmail.com>
	<CAPKp32tnUujXoKJf3YmmM0SKxV+qsKaTcembw6Hpb+R0WQHWYQ@mail.gmail.com>
	<CALyPt8z8NRewV9-JrWaNEasuxTYp5uvPX7sTDLHhY3vY0aFOjg@mail.gmail.com>
	<CAPKp32vgHtU0ZYVKJKMd3kgYP6nFU-HTUZ8B4bztj5uX0v6c-Q@mail.gmail.com>
	<1377924150709-7584521.post@n2.nabble.com>
	<CAPKp32sPC==HzPfxY0bt=HgvCyR1Msn2r_hqFKm5xhRKdFGMiw@mail.gmail.com>
Message-ID: <522C260A.6050900@gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130908/e07ed8dd/attachment.pl>

From grothered at gmail.com  Sun Sep  8 09:41:24 2013
From: grothered at gmail.com (Gareth Davies)
Date: Sun, 08 Sep 2013 17:41:24 +1000
Subject: [R-sig-Geo] Extract function - too much data for R?
In-Reply-To: <522C260A.6050900@gmail.com>
References: <CAPKp32tJ1kAMiTxK7N_irLj0p7Akv9Kxmn_REz-cOEHypGG3vQ@mail.gmail.com>
	<CALyPt8yG6qrxD_NaU+eLgqRf-xu-HO43xLiTAFB5d00MaEH02g@mail.gmail.com>
	<CAPKp32tnUujXoKJf3YmmM0SKxV+qsKaTcembw6Hpb+R0WQHWYQ@mail.gmail.com>
	<CALyPt8z8NRewV9-JrWaNEasuxTYp5uvPX7sTDLHhY3vY0aFOjg@mail.gmail.com>
	<CAPKp32vgHtU0ZYVKJKMd3kgYP6nFU-HTUZ8B4bztj5uX0v6c-Q@mail.gmail.com>
	<1377924150709-7584521.post@n2.nabble.com>
	<CAPKp32sPC==HzPfxY0bt=HgvCyR1Msn2r_hqFKm5xhRKdFGMiw@mail.gmail.com>
	<522C260A.6050900@gmail.com>
Message-ID: <522C2A24.1030702@gmail.com>

Oops -- regarding my last reply, I see now that the approach with 
'extract' using 'weights' was actually your original method at the start 
of this thread -- so, apparently it is slow. I don't know if the 
spsample+extract approach would be faster or not.


From ROONEYJ4 at tcd.ie  Sun Sep  8 12:53:39 2013
From: ROONEYJ4 at tcd.ie (James Rooney)
Date: Sun, 8 Sep 2013 11:53:39 +0100
Subject: [R-sig-Geo] DCluster questions
In-Reply-To: <1378501542.3727.23.camel@Virgilio-Gomez>
References: <75C8D19A1470D344A8AF5312F01160A602B96C5CB907@GOMAIL.college.tcd.ie>,
	<1378501542.3727.23.camel@Virgilio-Gomez>
Message-ID: <75C8D19A1470D344A8AF5312F01160A602B96C5CB908@GOMAIL.college.tcd.ie>

Thanks for the reply Virgilio,

>> 2) Will opgam/kn.iscluster only detect "hotspots" or will they also detect
>> "coldspots" i.e. areas of statistically unlikely lower incidence rates ?

>You get a p-value, so you could take the areas with very large p-values
>as cold-spots. But detection of cold-spots is not of interest, is it?

Um I'm new to this field so I'm probably missing something but - why wouldn't it be interesting? It might tell me about local protective factors, or localized case ascertainment holes I would imagine ? Anyhow I have something in mind to do it - although its low down on my todo list for now.


>> 4) How do I decide what the correct value for fractpop is ? I initially had it set to .25 and I
>>was getting cluster of 50% of my cases which made no sense.

>You may try different values of fractpop if you want to detect smaller
>clusters.

Ok...but that feels kind of arbitrary to me. Is there a logic by which to select a size ?

>> 5) Is there any correction for multiple testing in the opgam() command ? I have over 3000 areas -
>> do I need to set a very low alpha ?

>For the Spatial Scan Statistic you should only pay attention to the
>significance of the most likely cluster, as this is what Kulldorff's
>test is testing for. But you can use the p-value reported for the other
>secondary  clusters as a guidance.

>For GAM, you probably want to make a multiple test correction. Another
>good option is to plot the centres of the clusters detected as this will
>give you and idea of the areas with significant high risk.

This reply confuses me - if I['m using the Kuldorff's scan stat inside the GAM - then I don't need to worry about multiple comparison or I do ?


>Hope this helps.

>Virgilio

Yes - quite helpful and much appreciated. Thank you!

James


From onos2god at yahoo.com  Mon Sep  9 12:22:15 2013
From: onos2god at yahoo.com (Israel Ikoyi)
Date: Mon, 9 Sep 2013 03:22:15 -0700 (PDT)
Subject: [R-sig-Geo] Autoregression with state-space models
Message-ID: <1378722135.2574.YahooMailNeo@web160606.mail.bf1.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130909/161b9b6d/attachment.pl>

From mtreglia at gmail.com  Mon Sep  9 18:53:23 2013
From: mtreglia at gmail.com (Michael Treglia)
Date: Mon, 9 Sep 2013 11:53:23 -0500
Subject: [R-sig-Geo] Extract function - too much data for R?
In-Reply-To: <522C2A24.1030702@gmail.com>
References: <CAPKp32tJ1kAMiTxK7N_irLj0p7Akv9Kxmn_REz-cOEHypGG3vQ@mail.gmail.com>
	<CALyPt8yG6qrxD_NaU+eLgqRf-xu-HO43xLiTAFB5d00MaEH02g@mail.gmail.com>
	<CAPKp32tnUujXoKJf3YmmM0SKxV+qsKaTcembw6Hpb+R0WQHWYQ@mail.gmail.com>
	<CALyPt8z8NRewV9-JrWaNEasuxTYp5uvPX7sTDLHhY3vY0aFOjg@mail.gmail.com>
	<CAPKp32vgHtU0ZYVKJKMd3kgYP6nFU-HTUZ8B4bztj5uX0v6c-Q@mail.gmail.com>
	<1377924150709-7584521.post@n2.nabble.com>
	<CAPKp32sPC==HzPfxY0bt=HgvCyR1Msn2r_hqFKm5xhRKdFGMiw@mail.gmail.com>
	<522C260A.6050900@gmail.com> <522C2A24.1030702@gmail.com>
Message-ID: <CAPKp32t=rCzJM1pgE6eYdCACGNJ+JCF=i1TPb7PxQBmxnHg+qA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130909/87366b2d/attachment.pl>

From zuzulaz at gmail.com  Tue Sep 10 01:46:20 2013
From: zuzulaz at gmail.com (zuzana zajkova)
Date: Tue, 10 Sep 2013 01:46:20 +0200
Subject: [R-sig-Geo] Google maps/ Blue Marble in R
In-Reply-To: <86fvtimo5r.fsf@Triskela.Home>
References: <CADQCJLDrxgOWnGyx_W2QGWTH3OZ1njr7iWQRHYgVhhh92rDO_w@mail.gmail.com>
	<86fvtimo5r.fsf@Triskela.Home>
Message-ID: <CADQCJLCZBgjCAD8TiAVXkjUoOc6X3As17GriMmpNSAdTCC3QtA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130910/2fa257b8/attachment.pl>

From oscar.perpinan at gmail.com  Tue Sep 10 15:25:05 2013
From: oscar.perpinan at gmail.com (Oscar =?utf-8?B?UGVycGnDscOhbg==?= Lamigueiro)
Date: Tue, 10 Sep 2013 15:25:05 +0200
Subject: [R-sig-Geo] Google maps/ Blue Marble in R
In-Reply-To: <CADQCJLCZBgjCAD8TiAVXkjUoOc6X3As17GriMmpNSAdTCC3QtA@mail.gmail.com>
References: <CADQCJLDrxgOWnGyx_W2QGWTH3OZ1njr7iWQRHYgVhhh92rDO_w@mail.gmail.com>,
	<86fvtimo5r.fsf@Triskela.Home>,
	<CADQCJLCZBgjCAD8TiAVXkjUoOc6X3As17GriMmpNSAdTCC3QtA@mail.gmail.com>
Message-ID: <86fvtc6c7i.fsf@Triskela.Home>

Hello,

The next code combines three different objects using spplot. I have not
found the NBcontour10 data.frame in your last email. Therefore, I have
defined some points instead.

Best,

Oscar.

##################################################################
library(sp)
library(ggmap) 
##You could also try library(OpenStreetMaps)

## Read limit data and define an SpatialLines object
limit <- SpatialLines(list(Lines(Line(limit_NBver10[,-1]), ID='1')),
                      proj4string=CRS("+proj=longlat +datum=WGS84"))
## A component of sp.layout in the final spplot call
sp.limit <- list('sp.lines', limit, lwd=.5, col='white')

## Choose some points inside your region and define an
## SpatialPointsDataFrame object with some noise.
## Replace this chunk code with the definition of your data
bbLimit <- bbox(limit)
nPoints <- 20
coords <- cbind(sample(seq(bbLimit[1,1], bbLimit[1,2], .1), nPoints),
                sample(seq(bbLimit[2,1], bbLimit[2,2], .1), nPoints))
myPoints <- SpatialPointsDataFrame(coords,
                                   data=data.frame(rnorm(nPoints)),
                                   proj=CRS("+proj=longlat +datum=WGS84"))

## Retrieve tiles from Google Maps
map4ao <- get_map(location = c(lon = -30, lat = 15),
                  maptype = "satellite", scale=2, zoom=4)
## Read the attributes to pass them to grid.raster
bbMap <- attr(map4ao, 'bb')
latCenter <- with(bbMap, ll.lat + ur.lat)/2
lonCenter <- with(bbMap, ll.lon + ur.lon)/2
height <- with(bbMap, ur.lat - ll.lat)
width <- with(bbMap, ur.lon - ll.lon)
## Another component of the sp.layout in spplot
sp.raster <- list('grid.raster', map4ao,
                  x=lonCenter, y=latCenter,
                  width=width, height=height,
                  default.units='native')

## Finally, the spplot call: the main object to be displayed is the
## SpatialPointsDataFrame. The region limits and the map layers are
## printed with sp.layout.
spplot(myPoints,
       scales=list(draw=TRUE), key.space='right',
       sp.layout=list(sp.raster, sp.limit))

##################################################################
zuzana zajkova writes:

> Hi Oscar and Ben,
>
> thank you, I tried get_map & ggmap from {ggmpap}, it works quite good, I
> got the axes with lat/long what I wanted. The problem is that when I want
> to save the map bigger (width=2000), the axes get too small and are almost
> invisible... and I am not very familiar with ggmap to change it somehow (so
> far... :)
>
> Oscar, I like a lot the map in your post (
> http://procomun.wordpress.com/2013/04/24/stamen-maps-with-spplot/), the
> axes are as I would like to have them. Unfortunately, I was not able to
> addapt your code to my needs. Could you help me with it, please?
> I would like to plot a map using sattelite Google map as a base, in big
> resolution (scale =2). And on that plot few kernel contours and their
> centroides.
> (By the way, don't you know if it is possible to fill the contours of
> kernels?)
>
> I woul like to get an area aprox. from longitude -50 to -10 and latitude
> from -10 til 40.
> I attach data for a kernel and its centroide.
>
> ## EXAMPLE
> # this data are as dput at the end
> limit_NBver10<-read.table( "limit_NBver10.txt", header=T, sep="\t")
>
> # calculate centroide
> NBcentr10<- c(mean(NBcontour10$Long), mean(NBcontour10$Lat))
> NBcentr10m<- Mercator(NBcentr10)
>
> # plot Google map
> e <- extent( -60 , -10 , 0 , 40 )  ## extent (long, long, lat, lat)
> r <- gmap(e, type="satellite", scale=2)
> plot(r, interpolate=TRUE)
>
> ### I would prefer to use this or the spplot...
> # map4ao<-get_map(location = c(lon = -30, lat = 15), maptype = "satellite",
> scale=2, zoom=4)
> # ggmap(map4ao)
>
> #  convert to Mercator to be able to plot it on Google Maps
> NB10<- cbind(limit_NBver10$Long, limit_NBver10$Lat)
> NB10m<- Mercator(NB10)
> lines(NBm, lwd=2,  col="brown")
> points(NBcentr10m, pch=18, col="brown")
>
> I want to plot two different kernels (50 and 95) for two different
> localities, so adding a legend might be useful aswell.
>
> I would appreciate any hints, thank you!
>
> Zuzana
>
>> dput(limit_NBver10)structure(list(ID = c(1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L,
> 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L,
> 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L,
> 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L,
> 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L,
> 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L,
> 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L,
> 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L,
> 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L,
> 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L,
> 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L,
> 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L,
> 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L,
> 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L,
> 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L,
> 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L,
> 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L,
> 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L,
> 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L,
> 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L,
> 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L,
> 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L,
> 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L), Long = c(-35.76132,
> -35.764120449255, -35.768824388905, -35.7719686454691, -35.7757680708915,
> -35.7785437803288, -35.7805257086988, -35.7824125195278, -35.7837508021974,
> -35.7840633705864, -35.7833608340727, -35.7820936177787, -35.7800250824356,
> -35.7775624167126, -35.7744526624865, -35.7709437423894, -35.7665367970046,
> -35.7616226656884, -35.76132, -35.7568039536541, -35.7488041248386,
> -35.7417367184295, -35.7334540742505, -35.73168, -35.7256451878587,
> -35.7143121934187, -35.7041841252115, -35.70204, -35.6927510753647,
> -35.6804396152642, -35.6724, -35.6677073422709, -35.6523052179148,
> -35.64276, -35.6376241974088, -35.6195621922728, -35.61312, -35.6017260802916,
> -35.58348, -35.5826670599887, -35.5620999843372, -35.55384, -35.5389295835598,
> -35.5242, -35.5170406473499, -35.49456, -35.4910968267571, -35.46492,
> -35.4631971048108, -35.43528, -35.4336153397102, -35.40564, -35.4024270676739,
> -35.376, -35.3683641663942, -35.34636, -35.3304392819369, -35.31672,
> -35.2889372897805, -35.28708, -35.25744, -35.2456741928817, -35.2278,
> -35.19816, -35.1944915971781, -35.16852, -35.13888, -35.1385549593096,
> -35.10924, -35.0796, -35.0747904983599, -35.04996, -35.02032,
> -34.9994625370281, -34.99068, -34.96104, -34.9314, -34.9025164121559,
> -34.90176, -34.87212, -34.84248, -34.81284, -34.7832, -34.7630178746876,
> -34.75356, -34.72392, -34.69428, -34.66464, -34.635, -34.60536,
> -34.57572, -34.54608, -34.51644, -34.4868, -34.45716, -34.42752,
> -34.39788, -34.36824, -34.3386, -34.3229081590724, -34.30896,
> -34.27932, -34.24968, -34.22004, -34.1904, -34.1833398204767,
> -34.16076, -34.13112, -34.10148, -34.0840608741637, -34.07184,
> -34.0422, -34.01256, -34.0062808859247, -33.98292, -33.95328,
> -33.9385102787257, -33.92364, -33.894, -33.880277734286, -33.86436,
> -33.83472, -33.827347612401, -33.80508, -33.7796594326867, -33.77544,
> -33.7458, -33.7361891314615, -33.71616, -33.694484349375, -33.68652,
> -33.6575769642992, -33.65688, -33.62724, -33.6221516529997, -33.5976,
> -33.5892583802976, -33.56796, -33.5578165415032, -33.53832, -33.528820118836,
> -33.50868, -33.5015590210146, -33.47904, -33.4751799038959, -33.4504413091046,
> -33.4494, -33.426306458131, -33.41976, -33.4054056142496, -33.39012,
> -33.3844045258165, -33.3635961017649, -33.36048, -33.3455473492392,
> -33.33084, -33.3271396204109, -33.3106618988982, -33.3012, -33.2941852476727,
> -33.2781605228234, -33.27156, -33.264705819104, -33.2513991432137,
> -33.24192, -33.238800798226, -33.227270068641, -33.215349396401,
> -33.21228, -33.2051919732298, -33.1959278297877, -33.1860106844991,
> -33.18264, -33.1784650580848, -33.1715035446386, -33.1640273139746,
> -33.1568538785492, -33.153, -33.1521877863785, -33.147020318298,
> -33.1432993363034, -33.139559306962, -33.1366906641853, -33.1341692689418,
> -33.1323814515189, -33.1311608943111, -33.1306733938088, -33.1314681316263,
> -33.1325819830105, -33.1346501704358, -33.13721035272, -33.1400704025971,
> -33.1439444924953, -33.1484296611689, -33.153, -33.1532499229485,
> -33.1580637496955, -33.1662932362206, -33.173646667577, -33.1816649203705,
> -33.18264, -33.1899750149979, -33.2009147351574, -33.2115073405822,
> -33.21228, -33.2233892824875, -33.2356153568674, -33.24192, -33.2480137447903,
> -33.2630863399439, -33.27156, -33.2780095781416, -33.295829022396,
> -33.3012, -33.313455253761, -33.33084, -33.3319832022492, -33.3518240927414,
> -33.36048, -33.374091292595, -33.39012, -33.3956290868364, -33.41976,
> -33.4204910766419, -33.4468518038561, -33.4494, -33.4742242915532,
> -33.47904, -33.5040200529036, -33.50868, -33.5364525254934, -33.53832,
> -33.56796, -33.5704387195682, -33.5976, -33.6061915213228, -33.62724,
> -33.6473983972767, -33.65688, -33.68652, -33.6901652456419, -33.71616,
> -33.7380282545386, -33.7458, -33.77544, -33.7908991328054, -33.80508,
> -33.83472, -33.8511831363073, -33.86436, -33.894, -33.9219966999333,
> -33.92364, -33.95328, -33.98292, -34.0035253731934, -34.01256,
> -34.0422, -34.07184, -34.10148, -34.1136530559176, -34.13112,
> -34.16076, -34.1904, -34.22004, -34.24968, -34.27932, -34.30896,
> -34.3316347601224, -34.3386, -34.36824, -34.39788, -34.42752,
> -34.45716, -34.4689166977478, -34.4868, -34.51644, -34.54608,
> -34.57572, -34.60536, -34.635, -34.66464, -34.6875167969269,
> -34.69428, -34.72392, -34.75356, -34.7832, -34.7992810632476,
> -34.81284, -34.84248, -34.87212, -34.882727179189, -34.90176,
> -34.9314, -34.9523285254729, -34.96104, -34.99068, -35.0123641694232,
> -35.02032, -35.04996, -35.0661456656777, -35.0796, -35.10924,
> -35.1131902567721, -35.13888, -35.1584008642754, -35.16852, -35.1981171043314,
> -35.19816, -35.2278, -35.2360511593816, -35.25744, -35.2714490107246,
> -35.28708, -35.3045772317784, -35.31672, -35.3367740716699, -35.34636,
> -35.3657477183956, -35.376, -35.3927354154775, -35.40564, -35.4190313708612,
> -35.43528, -35.4444541324849, -35.46492, -35.4676591581021, -35.4906713829709,
> -35.49456, -35.5107391912776, -35.5242, -35.5315056927973, -35.5510690641519,
> -35.55384, -35.5682272848858, -35.58348, -35.5857470934045, -35.6017746761061,
> -35.61312, -35.6177419467398, -35.6320260505406, -35.64276, -35.6467320400089,
> -35.6593093967563, -35.6720315641026, -35.6724, -35.683151614379,
> -35.6956377030949, -35.70204, -35.7050075805178, -35.7140655762887,
> -35.7240504442932, -35.73168, -35.7317594920335, -35.7397005637197,
> -35.7465500670664, -35.7532583327874, -35.759236627859, -35.76132
> ), Lat = c(8.08043387144557, 8.09768, 8.12732, 8.15696, 8.1866,
> 8.21624, 8.24588, 8.27552, 8.30516, 8.3348, 8.36444, 8.39408,
> 8.42372, 8.45336, 8.483, 8.51264, 8.54228, 8.57192, 8.57377979511483,
> 8.60156, 8.6312, 8.66084, 8.69048, 8.69735379500348, 8.72012,
> 8.74976, 8.7794, 8.78519741826762, 8.80904, 8.83868, 8.85773510801789,
> 8.86832, 8.89796, 8.91775185850685, 8.9276, 8.95724, 8.96823259299761,
> 8.98688, 9.01523738440848, 9.01652, 9.04616, 9.05726692469371,
> 9.0758, 9.09632840474305, 9.10544, 9.13106663320714, 9.13508,
> 9.16286208184106, 9.16472, 9.19278220396127, 9.19436, 9.2211597736667,
> 9.224, 9.24737294443929, 9.25364, 9.27039378128219, 9.28328,
> 9.29349850391879, 9.31292, 9.31419728857203, 9.33509437807802,
> 9.34256, 9.35276282893715, 9.37038298084766, 9.3722, 9.38581027591707,
> 9.40169210436488, 9.40184, 9.41549137459375, 9.4296117151511,
> 9.43148, 9.4411204879236, 9.45393231831201, 9.46112, 9.46393441172051,
> 9.47303685870308, 9.48325580198858, 9.49076, 9.49095227452636,
> 9.49871209676193, 9.50508729376379, 9.51180566511919, 9.51749291069681,
> 9.5204, 9.52175454666723, 9.52613292127168, 9.52931720127422,
> 9.53185261838295, 9.53438273000332, 9.53590291885375, 9.53705028505951,
> 9.53748476039723, 9.53715498606973, 9.53621258767864, 9.53470379780641,
> 9.53229443830216, 9.5297340327994, 9.52697876696969, 9.52274088148886,
> 9.5204, 9.5182322231653, 9.5131363094554, 9.50621649988915, 9.49963575167232,
> 9.49233807626853, 9.49076, 9.48580741920927, 9.47572164021867,
> 9.46635011366293, 9.46112, 9.45741198601691, 9.44524008421767,
> 9.43414609610616, 9.43148, 9.42126011475836, 9.40821089262206,
> 9.40184, 9.39488719114209, 9.37932469183404, 9.3722, 9.36347199806197,
> 9.34687475914923, 9.34256, 9.32858750627055, 9.31292, 9.31039774939372,
> 9.28982378339654, 9.28328, 9.26864288757179, 9.25364, 9.2479080674308,
> 9.224, 9.22346871038981, 9.19873873385822, 9.19436, 9.17238054127573,
> 9.16472, 9.14489695991995, 9.13508, 9.11539558249129, 9.10544,
> 9.08359258376715, 9.0758, 9.05064566217321, 9.04616, 9.01652,
> 9.01515032231369, 8.98688, 8.97789845710278, 8.95724, 8.93601062515183,
> 8.9276, 8.89796, 8.89271179631726, 8.86832, 8.84488136910915,
> 8.83868, 8.80904, 8.79244529979455, 8.7794, 8.74976, 8.73576197549069,
> 8.72012, 8.69048, 8.66832487838227, 8.66084, 8.6312, 8.60156,
> 8.59284714772742, 8.57192, 8.54228, 8.51264, 8.49960393982654,
> 8.483, 8.45336, 8.42372, 8.39408, 8.36966939063064, 8.36444,
> 8.3348, 8.30516, 8.27552, 8.24588, 8.21624, 8.1866, 8.15696,
> 8.12732, 8.09768, 8.06804, 8.0384, 8.00876, 7.97912, 7.94948,
> 7.91984, 7.89167518757741, 7.8902, 7.86056, 7.83092, 7.80128,
> 7.77164, 7.7680311659886, 7.742, 7.71236, 7.68272, 7.68073415574699,
> 7.65308, 7.62344, 7.60782464966612, 7.5938, 7.56416, 7.54675806399753,
> 7.53452, 7.50488, 7.49553887370153, 7.47524, 7.44749926243359,
> 7.4456, 7.41596, 7.40409807229935, 7.38632, 7.36379203901634,
> 7.35668, 7.32796296508197, 7.32704, 7.2974, 7.29457983831339,
> 7.26776, 7.26284720560734, 7.23812, 7.23368581395931, 7.20848,
> 7.20680873133046, 7.18078990873599, 7.17884, 7.15562923958771,
> 7.1492, 7.13466995868126, 7.11956, 7.11287698290142, 7.09209875797376,
> 7.08992, 7.07421759573464, 7.06028, 7.0556926420228, 7.03895935912814,
> 7.03064, 7.02365199428843, 7.00799627559596, 7.001, 6.99571065155614,
> 6.98289529233856, 6.97136, 6.97070164584002, 6.9598352191266,
> 6.94788931512401, 6.94172, 6.93913351612368, 6.9309494477673,
> 6.92281419400638, 6.91474401489769, 6.91208, 6.90841695153588,
> 6.90314181581088, 6.8978612966742, 6.89328053024696, 6.88837951169988,
> 6.88558334082918, 6.88377514061031, 6.88244, 6.88204785172503,
> 6.88128125292644, 6.88064811689433, 6.88095820050657, 6.88192925023196,
> 6.88244, 6.88322681012764, 6.88514338870819, 6.88714488113039,
> 6.89211296274698, 6.89666287906126, 6.90195489326937, 6.90727875711154,
> 6.91208, 6.91354044611272, 6.92074136095577, 6.9290394598828,
> 6.93715832073218, 6.94172, 6.94556457131539, 6.95722489866731,
> 6.96746773905942, 6.97136, 6.978870137199, 6.9920276332904, 7.001,
> 7.00485446418268, 7.02029966682933, 7.03064, 7.03448426462747,
> 7.05153942092025, 7.06028, 7.06839180015739, 7.08736078281851,
> 7.08992, 7.10718007994466, 7.11956, 7.12644127848716, 7.1492,
> 7.14922989749416, 7.1723016416664, 7.17884, 7.19639511559498,
> 7.20848, 7.22274226335147, 7.23812, 7.24910681944113, 7.26776,
> 7.27719345688089, 7.2974, 7.30831876417049, 7.32704, 7.34148284282932,
> 7.35668, 7.37502997050363, 7.38632, 7.41237069298967, 7.41596,
> 7.4456, 7.45119407599648, 7.47524, 7.49421100853822, 7.50488,
> 7.53452, 7.53936477586162, 7.56416, 7.58978285878249, 7.5938,
> 7.62344, 7.64425216040911, 7.65308, 7.68272, 7.70396998505454,
> 7.71236, 7.742, 7.77164, 7.77259003951664, 7.80128, 7.83092,
> 7.85098591317257, 7.86056, 7.8902, 7.91984, 7.94917139701681,
> 7.94948, 7.97912, 8.00876, 8.0384, 8.06804, 8.08043387144557)), .Names
> = c("ID",
> "Long", "Lat"), class = "data.frame", row.names = c(NA, -359L
> ))
>
>
>
>
>
>
> On 6 September 2013 08:58, Oscar Perpi??n Lamigueiro <
> oscar.perpinan at gmail.com> wrote:
>
>> Hello,
>>
>> I am not sure if it fits your problem, but perhaps this example I posted
>> some months ago is useful for you:
>> http://procomun.wordpress.com/2013/04/24/stamen-maps-with-spplot/.
>> It combines a Stamen map (retrieved with the ggmap or OpenStreetMap
>> packages) with an SpatialPointsDataFrame displayed with spplot.
>>
>> Could you send a sample of your data to give you a better answer?
>>
>> Best,
>>
>> Oscar.
>>
>> --
>> Oscar Perpi??n Lamigueiro
>> Grupo de Sistemas Fotovoltaicos (IES-UPM)
>> Dpto. Ingenier?a El?ctrica (EUITI-UPM)
>> URL: http://http://oscarperpinan.github.io
>> Twitter: @oscarperpinan
>>
>> zuzana zajkova writes:
>>
>> > Hi,
>> >
>> > I would like to ask some questions... My aim is produce nice maps of
>> > distribution (kernels) of my studied species. So far I have been using
>> > "rworldmap" to get general view, but for presentation I would like to
>> make
>> > the maps more beautiful :)
>> > I was able to get the Google maps (using "dismo" package) and create a
>> map,
>> > but I am not able to add axes and legend to this map, what makes it quite
>> > useless as a map... Any suggestions?
>> >
>> > library(dismo)
>> > e <- extent( -60 , -10 , 0 , 40 )  ## extent (long, long, lat, lat)
>> > r <- gmap(e, type="satellite", scale=2)
>> > plot(r, interpolate=TRUE)
>> >
>> >
>> > Other thing is that I am open to use any other map as a background
>> > (preferably with topografhy and bathymetry), for example does anyone know
>> > if it is possible to use "Blue Marble" map for this?
>> >
>> > Thank you in advance for your suggestions.
>> >
>> > Zuzana
>> >
>> >       [[alternative HTML version deleted]]
>> >
>> > _______________________________________________
>> > R-sig-Geo mailing list
>> > R-sig-Geo at r-project.org
>> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>


-- 
Oscar Perpi??n Lamigueiro
Grupo de Sistemas Fotovoltaicos (IES-UPM)
Dpto. Ingenier?a El?ctrica (EUITI-UPM)
URL: http://http://oscarperpinan.github.io
Twitter: @oscarperpinan


From Scott.Waichler at pnnl.gov  Tue Sep 10 18:00:59 2013
From: Scott.Waichler at pnnl.gov (Waichler, Scott R)
Date: Tue, 10 Sep 2013 09:00:59 -0700
Subject: [R-sig-Geo] making an inset in a map figure
Message-ID: <A632B3F93D861843A3C966F3962C3F840148AE93A37E@EMAIL05.pnl.gov>

Hi, Does anyone have an example of making a map figure with an inset, where a portion of the map in the large figure is shown at a larger scale in the inset?

Scott Waichler
Hydrology Group
Pacific Northwest National Laboratory
Richland, WA, USA


From f.rodriguez.sanc at gmail.com  Tue Sep 10 18:14:11 2013
From: f.rodriguez.sanc at gmail.com (Francisco Rodriguez Sanchez)
Date: Tue, 10 Sep 2013 17:14:11 +0100
Subject: [R-sig-Geo] making an inset in a map figure
In-Reply-To: <A632B3F93D861843A3C966F3962C3F840148AE93A37E@EMAIL05.pnl.gov>
References: <A632B3F93D861843A3C966F3962C3F840148AE93A37E@EMAIL05.pnl.gov>
Message-ID: <522F4553.8070103@gmail.com>

What a coincidence! I was just having a look at this older message from 
the list that should solve the problem: 
https://stat.ethz.ch/pipermail/r-sig-geo/2012-June/015340.html

Cheers,

Paco


El 10/09/2013 17:00, Waichler, Scott R escribi?:
> Hi, Does anyone have an example of making a map figure with an inset, where a portion of the map in the large figure is shown at a larger scale in the inset?
>
> Scott Waichler
> Hydrology Group
> Pacific Northwest National Laboratory
> Richland, WA, USA
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Dr Francisco Rodriguez-Sanchez
Forest Ecology and Conservation Group
Department of Plant Sciences
University of Cambridge
Downing Street
Cambridge CB2 3EA
United Kingdom
http://sites.google.com/site/rodriguezsanchezf


From r.hijmans at gmail.com  Tue Sep 10 21:38:30 2013
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Tue, 10 Sep 2013 12:38:30 -0700
Subject: [R-sig-Geo] Wrong layer names written with writeRaster()
	(package raster)
In-Reply-To: <CAG4NRe+84tPRKDK-7y-NV88=UO=4uNNvB-P8NPaDVdUFk7p9+g@mail.gmail.com>
References: <CAG4NRe+84tPRKDK-7y-NV88=UO=4uNNvB-P8NPaDVdUFk7p9+g@mail.gmail.com>
Message-ID: <CANtt_hwoNVBNTTnfzXXdoaQq5fxtvFLrYWJZ7sSoEMHEOMP8Xw@mail.gmail.com>

Correct me if I am wrong, but it is my impression that GDAL does not
support names for bands; so there would be to directly write these via
(r)gdal. I am not sure if GeoTiff supports the concept. In the case of
ENVI, I suppose it would be possible to add the band names to the hdr
file; but the raster package currently does not do that.
Robert

On Thu, Sep 5, 2013 at 1:47 AM, Agustin Lobo <alobolistas at gmail.com> wrote:
> Envi and GTiff files (at least) do not keep the names of the brick object:
>
>> require(rgdal)
> Loading required package: rgdal
> rgdal: version: 0.8-10, (SVN revision 478)
> Geospatial Data Abstraction Library extensions to R successfully loaded
> Loaded GDAL runtime: GDAL 1.10.0, released 2013/04/24
> Path to GDAL shared files: /usr/share/gdal/1.10
> Loaded PROJ.4 runtime: Rel. 4.8.0, 6 March 2012, [PJ_VERSION: 480]
> Path to PROJ.4 shared files: (autodetected)
>
> require(raster)
> m <- raster(matrix(10,ncol=10,nrow=10))
> bm <- brick(m,m,m)
> names(bm) <- paste("Pepa",1:3,sep="")
> names(bm)
> writeRaster(bm,"delme",format="ENVI",bandorder="BSQ",datatype="INT2S",overwrite=TRUE)
>
> in the hdr file:
>   band names = {
>     Band 1,
>     Band 2,
>     Band 3}
>
> Is this a bug?
> Thanks,
> Agus
>
>
>> sessionInfo()
> R version 2.15.2 (2012-10-26)
> Platform: x86_64-pc-linux-gnu (64-bit)
>
> locale:
>  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
> LC_TIME=es_ES.UTF-8        LC_COLLATE=en_US.UTF-8
> LC_MONETARY=es_ES.UTF-8    LC_MESSAGES=en_US.UTF-8
>  [7] LC_PAPER=C                 LC_NAME=C
> LC_ADDRESS=C               LC_TELEPHONE=C
> LC_MEASUREMENT=es_ES.UTF-8 LC_IDENTIFICATION=C
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> other attached packages:
> [1] rgdal_0.8-10  raster_2.1-37 sp_1.0-9
>
> loaded via a namespace (and not attached):
>  [1] colorspace_1.2-2   dichromat_2.0-0    digest_0.6.3
> ggplot2_0.9.3.1    grid_2.15.2        gtable_0.1.2       labeling_0.2
>      lattice_0.20-13    MASS_7.3-23
> [10] munsell_0.4        plyr_1.8           proto_0.3-10
> RColorBrewer_1.0-5 reshape2_1.2.2     scales_0.2.3       stringr_0.6.2
>      tools_2.15.2
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From macqueen1 at llnl.gov  Wed Sep 11 17:02:01 2013
From: macqueen1 at llnl.gov (MacQueen, Don)
Date: Wed, 11 Sep 2013 15:02:01 +0000
Subject: [R-sig-Geo] making an inset in a map figure
In-Reply-To: <A632B3F93D861843A3C966F3962C3F840148AE93A37E@EMAIL05.pnl.gov>
Message-ID: <5E1B812FAC2C4A49B3D99593B5A521910D437134@PRDEXMBX-08.the-lab.llnl.gov>

Perhaps use subplot() from the Hmisc package

-Don

-- 
Don MacQueen

Lawrence Livermore National Laboratory
7000 East Ave., L-627
Livermore, CA 94550
925-423-1062





On 9/10/13 9:00 AM, "Waichler, Scott R" <Scott.Waichler at pnnl.gov> wrote:

>Hi, Does anyone have an example of making a map figure with an inset,
>where a portion of the map in the large figure is shown at a larger scale
>in the inset?
>
>Scott Waichler
>Hydrology Group
>Pacific Northwest National Laboratory
>Richland, WA, USA
>
>_______________________________________________
>R-sig-Geo mailing list
>R-sig-Geo at r-project.org
>https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From mspinola10 at gmail.com  Wed Sep 11 22:59:59 2013
From: mspinola10 at gmail.com (=?ISO-8859-1?Q?Manuel_Sp=EDnola?=)
Date: Wed, 11 Sep 2013 14:59:59 -0600
Subject: [R-sig-Geo] kernel results with stat_density2d and ggmap
Message-ID: <CABkCotQEsKLAbYMry=DEuOuy8TTm2=zFG_psQdyDd9a59Z3dww@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130911/44170715/attachment.pl>

From james.miraflor at gmail.com  Thu Sep 12 08:30:12 2013
From: james.miraflor at gmail.com (James Matthew Miraflor)
Date: Thu, 12 Sep 2013 14:30:12 +0800
Subject: [R-sig-Geo] How to do Zonal Statistics after Kriging in R given
 Shapefile of Polygon
In-Reply-To: <1375480318827-7584332.post@n2.nabble.com>
References: <CAPim8ZJggJScncT-h=bYY6CthnqUue4veKf3Z75Zh5GAj_c2xw@mail.gmail.com>
	<1375480318827-7584332.post@n2.nabble.com>
Message-ID: <CAPim8ZKNYE1UvVmjjLi5VKstx3SUwhODsP8kC6QvnPcrE_1WAQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130912/0a89a6b1/attachment.pl>

From mccallum at IIASA.AC.AT  Thu Sep 12 11:28:54 2013
From: mccallum at IIASA.AC.AT (I. McCallum)
Date: Thu, 12 Sep 2013 02:28:54 -0700 (PDT)
Subject: [R-sig-Geo] Frequency Slow on Large Raster Layer
Message-ID: <1378978134753-7584591.post@n2.nabble.com>

Dear All,
I have a large global raster, with 300m resolution, 10 classes.
I would need a sum of the cell count in each class.
Frequency(raster) would be perfect, but its slow for such large datasets.
I am wondering if there is a faster way to obtain the same results?

Many thanks
Ian



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Frequency-Slow-on-Large-Raster-Layer-tp7584591.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From gab.cozzi at gmail.com  Thu Sep 12 12:59:59 2013
From: gab.cozzi at gmail.com (Gabriele Cozzi)
Date: Thu, 12 Sep 2013 12:59:59 +0200
Subject: [R-sig-Geo] problems to stack() rasters due to different pixel
 resolution and raster extent
Message-ID: <CADr8yXDfcqXyOqgY_FAxFjLA8=uVgkpq5gYwzc6cHXtCCMzYBg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130912/b627737b/attachment.pl>

From s6lihert at uni-bonn.de  Thu Sep 12 13:27:22 2013
From: s6lihert at uni-bonn.de (Lionel Hertzog)
Date: Thu, 12 Sep 2013 13:27:22 +0200
Subject: [R-sig-Geo] problems to stack() rasters due to different pixel
 resolution and raster extent
In-Reply-To: <CADr8yXDfcqXyOqgY_FAxFjLA8=uVgkpq5gYwzc6cHXtCCMzYBg@mail.gmail.com>
References: <CADr8yXDfcqXyOqgY_FAxFjLA8=uVgkpq5gYwzc6cHXtCCMzYBg@mail.gmail.com>
Message-ID: <5231A51A.7080401@uni-bonn.de>

Dear Gabriele,

You should not use the 'res' function to set the raster resolution once 
it has values in it, to achieve this you need to use whether the 
'aggregate' or 'disaggregate' function to change the resolution since 
the cell values need to be re-computed.

In your case it appears that the difference in extent and resolution 
comes from one row (9813 vs 9812). I would recreate a new raster 
removing this extra row, below are some sample code:


#create two raster with one row difference leading to small variation in 
resolution and extent
e1<-extent(c(0,10,0,10))
r1<-raster(nrows=10,ncols=10,ext=e1)
values(r1)<-rnorm(100,0,1)
e2<-extent(c(0,10,0,11))
r2<-raster(nrows=11,ncols=10,ext=e2)
values(r2)<-rnorm(110,0,1)

#create a third raster having the dimension of r1 and taking the data 
from the first 10 rows of r2
r3<-r1
values(r3)<-r2[1:100]
stack(r1,r3)

There might be other more elegant ways to achieve this but this is how I 
would do it.

Yours,
Lionel


On 12/09/2013 12:59, Gabriele Cozzi wrote:
> Dear list,
>
> I was given three raster files with 'slope', 'aspect' and 'altitude' of my
> study site. I realised that one of the three rasters (namely 'altitude')
> has a slightly different raster cell resolution, which results in a
> slightly different raster extent and does not allow me to raster::stack()
> the three layers to create a single stack object.
> I tried to change the raster resolution using raster::res() for the raster
> 'altitude' but, when I subsequently cropped the three rasters with an
> object of class extent, I still got different extents between "slope and
> aspect" vs. "altitude".
>
> Any advice on how to solve this cell resolution incongruence is very
> welcome.
> Here below I report the output to make things more understandable.
>
> Thanks in advance,
> Gabriele
>
>
>
> #----------------
> #----------------
>
> aspect   <- raster("~/Envir/aspect/prj.adf")
> slope     <- raster("~/Envir/slope/prj.adf")
> altitude  <- raster("~/Envir/20130508094222_992463356.tif")
>
> aspect ( N.B. 'slope' returns exactly the same attributes!)
>     #class       : RasterLayer
>     #dimensions  : 9813, 8428, 82703964  (nrow, ncol, ncell)
>     #resolution  : 27.28532, 27.28532  (x, y)
>     #extent      : 135446.9, 365407.6, 4345919, 4613669  (xmin, xmax, ymin,
> ymax)
>     #coord. ref. : +proj=utm +zone=38 +ellps=WGS84 +towgs84=0,0,0,0,0,0,0
> +units=m    +no_defs
>
> altitude
>     #class       : RasterLayer
>     #dimensions  : 9812, 8428, 82695536  (nrow, ncol, ncell)
>     #resolution  : 27.28532, 27.28677  (x, y)
>     #extent      : 135446.9, 365407.6, 4345919, 4613656  (xmin, xmax, ymin,
> ymax)
>     #coord. ref. : +proj=utm +zone=38 +datum=WGS84 +units=m +no_defs
> +ellps=WGS84 +towgs84=0,0,0
>
> ex <- extent(animal_locations)
> ex
>     #class       : Extent
>     #xmin        : 257473.1
>     #xmax        : 312499.1
>     #ymin        : 4452821
>     #ymax        : 4570717
>
> Before using the function  raster.crop <- crop('raster_file', ex) to crop
> all rasters to the same extent, I tried to change the resolution of
> 'altitude' using
>
> res(altitude) <- 27.28532
>
> altitude
>     #class       : RasterLayer
>     #dimensions  : 9813, 8428, 82703964  (nrow, ncol, ncell)
>     #resolution  : 27.28532, 27.28532  (x, y)
>     #extent      : 135446.9, 365407.6, 4345905, 4613656  (xmin, xmax, ymin,
> ymax)
>     #coord. ref. : +proj=utm +zone=38 +datum=WGS84 +units=m +no_defs
> +ellps=WGS84 +towgs84=0,0,0
>
> When I then run crop() for aspect and the new defined altitude I however
> become different extents (i.e. ymin and ymax) despite now the dimensions
> and resolutions are the same
>
> crop(aspect, ex)
>     #class       : RasterLayer
>     #dimensions  : 5054, 2749, 13893446  (nrow, ncol, ncell)
>     #resolution  : 27.28532, 27.28532  (x, y)
>     #extent      : 247480.5, 322487.8, 4442809, 4580709  (xmin, xmax, ymin,
> ymax)
>     #coord. ref. : +proj=utm +zone=38 +ellps=WGS84 +towgs84=0,0,0,0,0,0,0
> +units=m +no_defs
>     #names       : prj
>     #values      : -1, 359.8158  (min, max)
>
> crop(altitude, ex)
>     #class       : RasterLayer
>     #dimensions  : 5054, 2749, 13893446  (nrow, ncol, ncell)
>     #resolution  : 27.28532, 27.28532  (x, y)
>     #extent      : 247480.5, 322487.8, 4442823, 4580723  (xmin, xmax, ymin,
> ymax)
>     #coord. ref. : +proj=utm +zone=38 +datum=WGS84 +units=m +no_defs
> +ellps=WGS84 +towgs84=0,0,0
>
> It also appears to me that by redefining res(altitude) I loose the actual
> values assigned to each pixel. Is there an argument to assign to the new
> pixels the value of the centre of the pixel?
>
>
>


From f.rodriguez.sanc at gmail.com  Thu Sep 12 13:33:28 2013
From: f.rodriguez.sanc at gmail.com (Francisco Rodriguez Sanchez)
Date: Thu, 12 Sep 2013 12:33:28 +0100
Subject: [R-sig-Geo] problems to stack() rasters due to different pixel
 resolution and raster extent
In-Reply-To: <CADr8yXDfcqXyOqgY_FAxFjLA8=uVgkpq5gYwzc6cHXtCCMzYBg@mail.gmail.com>
References: <CADr8yXDfcqXyOqgY_FAxFjLA8=uVgkpq5gYwzc6cHXtCCMzYBg@mail.gmail.com>
Message-ID: <5231A688.8000309@gmail.com>

Hi Gabriele,

Try the spatial_sync_raster function in package climstats: 
https://r-forge.r-project.org/projects/climstats/. It will align the 
projection, extent and resolution of your rasters all at once

Hope it helps,

Paco


El 12/09/2013 11:59, Gabriele Cozzi escribi?:
> Dear list,
>
> I was given three raster files with 'slope', 'aspect' and 'altitude' of my
> study site. I realised that one of the three rasters (namely 'altitude')
> has a slightly different raster cell resolution, which results in a
> slightly different raster extent and does not allow me to raster::stack()
> the three layers to create a single stack object.
> I tried to change the raster resolution using raster::res() for the raster
> 'altitude' but, when I subsequently cropped the three rasters with an
> object of class extent, I still got different extents between "slope and
> aspect" vs. "altitude".
>
> Any advice on how to solve this cell resolution incongruence is very
> welcome.
> Here below I report the output to make things more understandable.
>
> Thanks in advance,
> Gabriele
>
>
>
> #----------------
> #----------------
>
> aspect   <- raster("~/Envir/aspect/prj.adf")
> slope     <- raster("~/Envir/slope/prj.adf")
> altitude  <- raster("~/Envir/20130508094222_992463356.tif")
>
> aspect ( N.B. 'slope' returns exactly the same attributes!)
>     #class       : RasterLayer
>     #dimensions  : 9813, 8428, 82703964  (nrow, ncol, ncell)
>     #resolution  : 27.28532, 27.28532  (x, y)
>     #extent      : 135446.9, 365407.6, 4345919, 4613669  (xmin, xmax, ymin,
> ymax)
>     #coord. ref. : +proj=utm +zone=38 +ellps=WGS84 +towgs84=0,0,0,0,0,0,0
> +units=m    +no_defs
>
> altitude
>     #class       : RasterLayer
>     #dimensions  : 9812, 8428, 82695536  (nrow, ncol, ncell)
>     #resolution  : 27.28532, 27.28677  (x, y)
>     #extent      : 135446.9, 365407.6, 4345919, 4613656  (xmin, xmax, ymin,
> ymax)
>     #coord. ref. : +proj=utm +zone=38 +datum=WGS84 +units=m +no_defs
> +ellps=WGS84 +towgs84=0,0,0
>
> ex <- extent(animal_locations)
> ex
>     #class       : Extent
>     #xmin        : 257473.1
>     #xmax        : 312499.1
>     #ymin        : 4452821
>     #ymax        : 4570717
>
> Before using the function  raster.crop <- crop('raster_file', ex) to crop
> all rasters to the same extent, I tried to change the resolution of
> 'altitude' using
>
> res(altitude) <- 27.28532
>
> altitude
>     #class       : RasterLayer
>     #dimensions  : 9813, 8428, 82703964  (nrow, ncol, ncell)
>     #resolution  : 27.28532, 27.28532  (x, y)
>     #extent      : 135446.9, 365407.6, 4345905, 4613656  (xmin, xmax, ymin,
> ymax)
>     #coord. ref. : +proj=utm +zone=38 +datum=WGS84 +units=m +no_defs
> +ellps=WGS84 +towgs84=0,0,0
>
> When I then run crop() for aspect and the new defined altitude I however
> become different extents (i.e. ymin and ymax) despite now the dimensions
> and resolutions are the same
>
> crop(aspect, ex)
>     #class       : RasterLayer
>     #dimensions  : 5054, 2749, 13893446  (nrow, ncol, ncell)
>     #resolution  : 27.28532, 27.28532  (x, y)
>     #extent      : 247480.5, 322487.8, 4442809, 4580709  (xmin, xmax, ymin,
> ymax)
>     #coord. ref. : +proj=utm +zone=38 +ellps=WGS84 +towgs84=0,0,0,0,0,0,0
> +units=m +no_defs
>     #names       : prj
>     #values      : -1, 359.8158  (min, max)
>
> crop(altitude, ex)
>     #class       : RasterLayer
>     #dimensions  : 5054, 2749, 13893446  (nrow, ncol, ncell)
>     #resolution  : 27.28532, 27.28532  (x, y)
>     #extent      : 247480.5, 322487.8, 4442823, 4580723  (xmin, xmax, ymin,
> ymax)
>     #coord. ref. : +proj=utm +zone=38 +datum=WGS84 +units=m +no_defs
> +ellps=WGS84 +towgs84=0,0,0
>
> It also appears to me that by redefining res(altitude) I loose the actual
> values assigned to each pixel. Is there an argument to assign to the new
> pixels the value of the centre of the pixel?
>
>
>

-- 
Dr Francisco Rodriguez-Sanchez
Forest Ecology and Conservation Group
Department of Plant Sciences
University of Cambridge
Downing Street
Cambridge CB2 3EA
United Kingdom
http://sites.google.com/site/rodriguezsanchezf


From berman.jesse at gmail.com  Thu Sep 12 14:50:29 2013
From: berman.jesse at gmail.com (Jesse Berman)
Date: Thu, 12 Sep 2013 05:50:29 -0700 (PDT)
Subject: [R-sig-Geo] How to do Zonal Statistics after Kriging in R given
 Shapefile of Polygon
In-Reply-To: <CAPim8ZJggJScncT-h=bYY6CthnqUue4veKf3Z75Zh5GAj_c2xw@mail.gmail.com>
References: <CAPim8ZJggJScncT-h=bYY6CthnqUue4veKf3Z75Zh5GAj_c2xw@mail.gmail.com>
Message-ID: <1378990229754-7584595.post@n2.nabble.com>

James, it seems like your projections for 'town' and 'muni.sp' are different
with one being lat/long and the other being a UTM Zonal.  Try setting them
the same and see if that solves your problem.

Jesse



-----
--------------------------------------------------------
Jesse D Berman, PhD
Yale University
School of Forestry and Environmental Studies
Post-Doc Fellow
--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/How-to-do-Zonal-Statistics-after-Kriging-in-R-given-Shapefile-of-Polygon-tp7584330p7584595.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From edzer.pebesma at uni-muenster.de  Thu Sep 12 17:02:52 2013
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Thu, 12 Sep 2013 17:02:52 +0200
Subject: [R-sig-Geo] How to do Zonal Statistics after Kriging in R given
 Shapefile of Polygon
In-Reply-To: <CAPim8ZKNYE1UvVmjjLi5VKstx3SUwhODsP8kC6QvnPcrE_1WAQ@mail.gmail.com>
References: <CAPim8ZJggJScncT-h=bYY6CthnqUue4veKf3Z75Zh5GAj_c2xw@mail.gmail.com>
	<1375480318827-7584332.post@n2.nabble.com>
	<CAPim8ZKNYE1UvVmjjLi5VKstx3SUwhODsP8kC6QvnPcrE_1WAQ@mail.gmail.com>
Message-ID: <5231D79C.7040600@uni-muenster.de>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

After receiving a reproducible script & data from James (off-list), I
found the problem was generated by newdata (town) being a
SpatialPolygons object. In that case, as the Details: section of
?predict.gstat explains, gstat will try to make block kriging
estimates for each of the polygons. It will then complain about doing
block kriging in longlat (observations and newdata are longlat). I'm
not sure whether this complaint is fully justified in this case, but
you could spTransform both to a projected coordinate reference system
to avoid this, I think.

On 09/12/2013 08:30 AM, James Matthew Miraflor wrote:
> Thanks Jesse!
> 
> I tried out your suggestion (after making sure that the projection
> is the same), and I got this error message.
> 
>> kr <- krige(POVERTY_INCIDENCE~1, muni.sp, newdata=town,
>> model=v.fin)[using ordinary kriging]Error in predict.gstat(g,
>> newdata = newdata, block = block, nsim = nsim,  :
> gstat: value not allowed for: block kriging for long-lat data
> undefined
> 
> 
> Do you know how to fix this?
> 
> James
> 
> 
> 
> On Sat, Aug 3, 2013 at 5:51 AM, Jesse Berman
> <berman.jesse at gmail.com> wrote:
> 
>> James,
>> 
>> Have you considered block kriging with gstat?  This will allow a
>> smoothed estimate of an area average (e.g. a county or town
>> boundary) as opposed to over a fine grid.
>> 
>> It's relatively simple, as you merely set the town boundary as
>> your 'newdata,' although you will have to make sure it's in the
>> same projection as your points.
>> 
>> kr <- krige(POVERTY_INCIDENCE~1, muni.sp, newdata=town,
>> model=v.fin) spplot(kr, "var1.pred", col.regions =
>> rev(topo.colors(20)))
>> 
>> Jesse
>> 
>> 
>> 
>> 
>> ----- -------------------------------------------------------- 
>> Jesse D Berman, PhD Johns Hopkins Bloomberg School of Public
>> Health Department of Environmental Health Sciences Post-Doc -- 
>> View this message in context: 
>> http://r-sig-geo.2731867.n2.nabble.com/How-to-do-Zonal-Statistics-after-Kriging-in-R-given-Shapefile-of-Polygon-tp7584330p7584332.html
>>
>> 
Sent from the R-sig-geo mailing list archive at Nabble.com.
>> 
>> _______________________________________________ R-sig-Geo mailing
>> list R-sig-Geo at r-project.org 
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> 
> 
> 
> 

- -- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
83 33081, Fax: +49 251 8339763 http://ifgi.uni-muenster.de
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.11 (GNU/Linux)
Comment: Using GnuPG with Thunderbird - http://www.enigmail.net/

iQEcBAEBAgAGBQJSMdecAAoJEM1OCHCtOnfxD0oH/3TV7tLxJ6ljrBJ07RjPfIB0
bbKz+UvuMTUFFMt1XySkKIxX1DKg/337a7LmVxQk1mhFM3ufRJ0ROPL1rGEwfr+z
jzcB4nN6XSKtPuisMTBA10dksSeu0qVV27kyGQ5+mAw8Ilcjj/uTTHj4uRw1NiNP
43F2Kh1HcPNK4VWVPOLkznXV+YfOuBZFhPg2WzgSIHWVY4FFo7Bz5iCox2FjPoi1
2EA3u5Fq67o6j3skxNF8lk+CoOeNJl8jew7YYQGCWNsm3AgTkOQe0VXPE7hxfCn3
zBxkUn6gBJQNSGiZXyczFUCB8JW9gpNsiW18P7uJLttpN5x3TjQtJzIEWaFnN9Y=
=xF9G
-----END PGP SIGNATURE-----


From berman.jesse at gmail.com  Thu Sep 12 17:44:15 2013
From: berman.jesse at gmail.com (Jesse Berman)
Date: Thu, 12 Sep 2013 08:44:15 -0700 (PDT)
Subject: [R-sig-Geo] How to do Zonal Statistics after Kriging in R given
 Shapefile of Polygon
In-Reply-To: <5231D79C.7040600@uni-muenster.de>
References: <CAPim8ZJggJScncT-h=bYY6CthnqUue4veKf3Z75Zh5GAj_c2xw@mail.gmail.com>
	<1375480318827-7584332.post@n2.nabble.com>
	<CAPim8ZKNYE1UvVmjjLi5VKstx3SUwhODsP8kC6QvnPcrE_1WAQ@mail.gmail.com>
	<5231D79C.7040600@uni-muenster.de>
Message-ID: <1379000655649-7584597.post@n2.nabble.com>

Edzer is correct about this.  I was just looking at spTransform and adjusted
the data into a Robinson global projection.  If you set muni.sp and
brgy_poly to this projection the block kriging now works.  

You'll have to adjust your variogram, as it becomes a singular model, but
for demonstration purposes it works.  As an aside, you may want to consider
numbers of point pairs when setting your variogram.  

robin<-"+proj=robin +lon_0=0 +x_0=0 +y_0=0 +ellps=WGS84 +datum=WGS84
+units=m +no_defs"
muni.sp2<-spTransform(muni.sp, CRS(robin))
brgy_poly2<-spTransform(brgy_poly, CRS(robin))

## Variogram plot
v.obj<-variogram(POVERTY_INCIDENCE~1, locations=coordinates(sp_point),
data=muni.sp2, cloud=F)

## Assuming exponential model
v.exp <- fit.variogram(v.obj,vgm(psill=1, model='Exp', range=1))

## Krige and Plot
kr <- krige(POVERTY_INCIDENCE~1, muni.sp2, newdata=brgy_poly2, model=v.exp)
spplot(kr, "var1.pred", col.regions = rev(topo.colors(20)))





-----
--------------------------------------------------------
Jesse D Berman, PhD
Yale University
School of Forestry and Environmental Studies
Post-Doc Fellow
--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/How-to-do-Zonal-Statistics-after-Kriging-in-R-given-Shapefile-of-Polygon-tp7584330p7584597.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From gab.cozzi at gmail.com  Thu Sep 12 17:45:12 2013
From: gab.cozzi at gmail.com (Gabriele Cozzi)
Date: Thu, 12 Sep 2013 17:45:12 +0200
Subject: [R-sig-Geo] problems to stack() rasters due to different pixel
 resolution and raster extent
In-Reply-To: <5231A688.8000309@gmail.com>
References: <CADr8yXDfcqXyOqgY_FAxFjLA8=uVgkpq5gYwzc6cHXtCCMzYBg@mail.gmail.com>
	<5231A688.8000309@gmail.com>
Message-ID: <CADr8yXA7eDF+Sdg-pxxd+KB=4nWc9LB+p1pV+D_7rPpz_siokw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130912/62a31f21/attachment.pl>

From james.miraflor at gmail.com  Thu Sep 12 18:26:50 2013
From: james.miraflor at gmail.com (James Matthew Miraflor)
Date: Fri, 13 Sep 2013 00:26:50 +0800
Subject: [R-sig-Geo] How to do Zonal Statistics after Kriging in R given
 Shapefile of Polygon
In-Reply-To: <1379000655649-7584597.post@n2.nabble.com>
References: <CAPim8ZJggJScncT-h=bYY6CthnqUue4veKf3Z75Zh5GAj_c2xw@mail.gmail.com>
	<1375480318827-7584332.post@n2.nabble.com>
	<CAPim8ZKNYE1UvVmjjLi5VKstx3SUwhODsP8kC6QvnPcrE_1WAQ@mail.gmail.com>
	<5231D79C.7040600@uni-muenster.de>
	<1379000655649-7584597.post@n2.nabble.com>
Message-ID: <CAPim8ZKYpKEDRDShfM95DJgjEgMWGRsKqK+zmP_Yk_fmvkaxLA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130913/7f8ec291/attachment.pl>

From subbu_843 at yahoo.co.in  Thu Sep 12 19:28:27 2013
From: subbu_843 at yahoo.co.in (subash)
Date: Thu, 12 Sep 2013 10:28:27 -0700 (PDT)
Subject: [R-sig-Geo] Inteference of high nugget for dense data
Message-ID: <1379006907280-7584600.post@n2.nabble.com>

Dear Group,

I am fitting a variogram for rainfall data at 2 location.

Location 1) Less dense data 
Location 2) High density data

I get a high nugget for Location 2). Can this be expected? Should high
density of data lead to smaller/ zero nugget.


Thanks for your help

Regards,
Subash






--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Inteference-of-high-nugget-for-dense-data-tp7584600.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From edzer.pebesma at uni-muenster.de  Thu Sep 12 19:59:11 2013
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Thu, 12 Sep 2013 19:59:11 +0200
Subject: [R-sig-Geo] Inteference of high nugget for dense data
In-Reply-To: <1379006907280-7584600.post@n2.nabble.com>
References: <1379006907280-7584600.post@n2.nabble.com>
Message-ID: <523200EF.6040604@uni-muenster.de>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1



On 09/12/2013 07:28 PM, subash wrote:
> Dear Group,
> 
> I am fitting a variogram for rainfall data at 2 location.
> 
> Location 1) Less dense data Location 2) High density data
> 
> I get a high nugget for Location 2). Can this be expected? Should
> high density of data lead to smaller/ zero nugget.
> 

(I'm assuming 1 and 2 refer to sampling the same field)

not expected as of changing the expected value, but it may happen by
chance.

> 
> Thanks for your help
> 
> Regards, Subash
> 
> 
> 
> 
> 
> 
> -- View this message in context:
> http://r-sig-geo.2731867.n2.nabble.com/Inteference-of-high-nugget-for-dense-data-tp7584600.html
>
> 
Sent from the R-sig-geo mailing list archive at Nabble.com.
> 
> _______________________________________________ R-sig-Geo mailing
> list R-sig-Geo at r-project.org 
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

- -- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
83 33081, Fax: +49 251 8339763 http://ifgi.uni-muenster.de
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.11 (GNU/Linux)
Comment: Using GnuPG with Thunderbird - http://www.enigmail.net/

iQEcBAEBAgAGBQJSMgDvAAoJEM1OCHCtOnfx5K0H/1VZyhgdhkDsA8ZazI4SWm0i
GiDyKxarFEa5zVEbDkwO+dYutx7mZCX4DEGg5hqHHbtaFj1Qsabkg1WvD4cz6TxB
z41XLICQyCPCfPq2tF3LlYDyN69eKAagHTb/qhkMWLA2yHxW1wFB3p1q5SkcoHhQ
9JDBHI5NSNF9aEiV6YS2KFM4Z4iuGZvH7GXGR8y4Shrhqj6x+QoauNnmUsBOAYNh
1sWFGzDUIByFXeiAbzIL4RvLfP8wHiO22I4hC22nQFC4xxWgibO0AZfSXDAxZp/U
BAWPJDpZ+Vcdoc+GKRsX96B4EObp2z6MW2HFU/7BYEH0kFGBrqJt8cMsmwrR0yM=
=bb7n
-----END PGP SIGNATURE-----


From eddieatr at gmail.com  Thu Sep 12 21:12:37 2013
From: eddieatr at gmail.com (Eddie Smith)
Date: Thu, 12 Sep 2013 20:12:37 +0100
Subject: [R-sig-Geo] Plotting trend of a pixel
Message-ID: <CABaJH7-g6ck+Q7gdKTJ_hxiThX-bFXjE+f4XwR2F4vMr2urXUA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130912/a4c9db7b/attachment.pl>

From mtreglia at gmail.com  Thu Sep 12 22:28:04 2013
From: mtreglia at gmail.com (Michael Treglia)
Date: Thu, 12 Sep 2013 15:28:04 -0500
Subject: [R-sig-Geo] Plotting trend of a pixel
In-Reply-To: <CABaJH7-g6ck+Q7gdKTJ_hxiThX-bFXjE+f4XwR2F4vMr2urXUA@mail.gmail.com>
References: <CABaJH7-g6ck+Q7gdKTJ_hxiThX-bFXjE+f4XwR2F4vMr2urXUA@mail.gmail.com>
Message-ID: <CAPKp32v=n_GEwbZkxGaXCH=iFdQa1Pb9kp9Jqusr5OpLk7FwvQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130912/2f53b952/attachment.pl>

From milansharma2012 at yahoo.com  Fri Sep 13 05:27:25 2013
From: milansharma2012 at yahoo.com (Milan Sharma)
Date: Thu, 12 Sep 2013 20:27:25 -0700 (PDT)
Subject: [R-sig-Geo] HI
Message-ID: <1379042845.72605.YahooMailNeo@web162105.mail.bf1.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130912/ba88b2fb/attachment.pl>

From james.miraflor at gmail.com  Fri Sep 13 06:12:21 2013
From: james.miraflor at gmail.com (James Matthew Miraflor)
Date: Fri, 13 Sep 2013 12:12:21 +0800
Subject: [R-sig-Geo] How to do Zonal Statistics after Kriging in R given
 Shapefile of Polygon
In-Reply-To: <CAPim8ZKYpKEDRDShfM95DJgjEgMWGRsKqK+zmP_Yk_fmvkaxLA@mail.gmail.com>
References: <CAPim8ZJggJScncT-h=bYY6CthnqUue4veKf3Z75Zh5GAj_c2xw@mail.gmail.com>
	<1375480318827-7584332.post@n2.nabble.com>
	<CAPim8ZKNYE1UvVmjjLi5VKstx3SUwhODsP8kC6QvnPcrE_1WAQ@mail.gmail.com>
	<5231D79C.7040600@uni-muenster.de>
	<1379000655649-7584597.post@n2.nabble.com>
	<CAPim8ZKYpKEDRDShfM95DJgjEgMWGRsKqK+zmP_Yk_fmvkaxLA@mail.gmail.com>
Message-ID: <CAPim8ZLj_zSZuGq53rEGJ+6W0yNSzH6ZB_e9ZsnsScML=GKEgg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130913/96e9c66c/attachment.pl>

From grothered at gmail.com  Fri Sep 13 07:58:29 2013
From: grothered at gmail.com (GD)
Date: Thu, 12 Sep 2013 22:58:29 -0700 (PDT)
Subject: [R-sig-Geo] making an inset in a map figure
In-Reply-To: <5E1B812FAC2C4A49B3D99593B5A521910D437134@PRDEXMBX-08.the-lab.llnl.gov>
References: <A632B3F93D861843A3C966F3962C3F840148AE93A37E@EMAIL05.pnl.gov>
	<5E1B812FAC2C4A49B3D99593B5A521910D437134@PRDEXMBX-08.the-lab.llnl.gov>
Message-ID: <1379051909635-7584607.post@n2.nabble.com>

# Something like

library(maptools)
data(wrld_simpl)

plot(wrld_simpl,border=NA,col='blue',axes=T, xlim=c(100,130),
ylim=c(-40,30))
par(plt = c(0.2, 0.5, 0.6, 0.8), new = TRUE)
plot(wrld_simpl,border=NA,col='green',bg='white',axes=F)

# If you put axes on the inset, they will fall over the background map --
but, you could fix that by drawing a white rectangle there first (e.g. using
rect). 



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/making-an-inset-in-a-map-figure-tp7584585p7584607.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From nevil.amos at gmail.com  Fri Sep 13 08:36:02 2013
From: nevil.amos at gmail.com (nevil amos)
Date: Fri, 13 Sep 2013 16:36:02 +1000
Subject: [R-sig-Geo] Fastest method to reclassify large raster.
Message-ID: <CAN9eD7kPS2=Tep6rjLK=-STwSFzHej-PZH_R+j=faqBah6NWsg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130913/8c35437d/attachment.pl>

From s6lihert at uni-bonn.de  Fri Sep 13 09:06:21 2013
From: s6lihert at uni-bonn.de (Lionel Hertzog)
Date: Fri, 13 Sep 2013 09:06:21 +0200
Subject: [R-sig-Geo] Fastest method to reclassify large raster.
In-Reply-To: <CAN9eD7kPS2=Tep6rjLK=-STwSFzHej-PZH_R+j=faqBah6NWsg@mail.gmail.com>
References: <CAN9eD7kPS2=Tep6rjLK=-STwSFzHej-PZH_R+j=faqBah6NWsg@mail.gmail.com>
Message-ID: <5232B96D.8040700@uni-bonn.de>

Dear Nevil Amos,

Maybe the function 'reclassify' in the raster package is what you are 
looking for.

Yours,
Lionel

On 13/09/2013 08:36, nevil amos wrote:
> I have a large raster (4gb as a .asc file) with 197000 values, that I need
> to reclassify by values in  an large lookup table, 197,000rowsx80reclass
> value columns.
>
> I have tried using sub in a loop to replace the values, however the process
> is taking hours, without even completing the first of the
>   reclassifications.
>
> I would be grateful for any suggestions of processes that I can use to
> speed the reclass process ( I need files that can be read back into ARCGIS
> at the end of the process.
>
> My current script is
>
> library(raster)
> r<-raster("Raster.asc")
>
> COLS<-names(mydataOut[,5:88])
>
> for (i in COLS){
>
>    subs(r,mydataOut,by="Value",which=i,filename=paste(i,".asc",sep=""))
>    print(paste ("done", i))
> }
>
>
> Many thanks
>
> Nevil Amos
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From edzer.pebesma at uni-muenster.de  Fri Sep 13 10:29:00 2013
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Fri, 13 Sep 2013 10:29:00 +0200
Subject: [R-sig-Geo] How to do Zonal Statistics after Kriging in R given
 Shapefile of Polygon
In-Reply-To: <CAPim8ZLj_zSZuGq53rEGJ+6W0yNSzH6ZB_e9ZsnsScML=GKEgg@mail.gmail.com>
References: <CAPim8ZJggJScncT-h=bYY6CthnqUue4veKf3Z75Zh5GAj_c2xw@mail.gmail.com>
	<1375480318827-7584332.post@n2.nabble.com>
	<CAPim8ZKNYE1UvVmjjLi5VKstx3SUwhODsP8kC6QvnPcrE_1WAQ@mail.gmail.com>
	<5231D79C.7040600@uni-muenster.de>
	<1379000655649-7584597.post@n2.nabble.com>
	<CAPim8ZKYpKEDRDShfM95DJgjEgMWGRsKqK+zmP_Yk_fmvkaxLA@mail.gmail.com>
	<CAPim8ZLj_zSZuGq53rEGJ+6W0yNSzH6ZB_e9ZsnsScML=GKEgg@mail.gmail.com>
Message-ID: <5232CCCC.2060807@uni-muenster.de>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

In the script, you set the wrong CRS to the long/lat points. Set the
right CRS, then spTransform to the new one. Check that they match
after reprojection by plotting with axes, eg.

plot(muni.sp,axes=T)
points(muni.sp, col = 'red')

Second, when you work in projected coordinates having large numbers,
using 1 as an initial value for a variogram range fit will not work;
choose sth else, e.g. 100000 or so.

On 09/13/2013 06:12 AM, James Matthew Miraflor wrote:
> Hi Jesse, Edzer, and R-SIG-GEO!
> 
> I was able to make Kriging work, following the suggestions of Jesse
> and Edzer. However, the results don't turn out to be right - the
> Kriging and IDW done on a grid is not the same (in fact, it seems
> to be a mirror image) of the block kriging using a separate map.
> The grid kriging is in fact closer to the small area estimates
> (which is the actual sample).
> 
> You may take a look at the images here: 
> https://www.dropbox.com/sh/q5sev7n2pi6tq8f/tiqiFMjJS5
> 
> The R Code is here: 
> https://www.dropbox.com/sh/q5sev7n2pi6tq8f/oM87f6axv5/kriging_pov.r
>
>  The R Data is here: 
> https://www.dropbox.com/sh/q5sev7n2pi6tq8f/8jC9qmlBZB/POVKRIGE.RData
>
>  Would you know why block Kriging and block IDW have such a weird
> results? Thank you for your time and patience.
> 
> James
> 
> 
> On Fri, Sep 13, 2013 at 12:26 AM, James Matthew Miraflor < 
> james.miraflor at gmail.com> wrote:
> 
>> Thanks Jesse and Edzer! It finally worked.
>> 
>> 
>> On Thu, Sep 12, 2013 at 11:44 PM, Jesse Berman
>> <berman.jesse at gmail.com>wrote:
>> 
>>> robin<-"+proj=robin +lon_0=0 +x_0=0 +y_0=0 +ellps=WGS84
>>> +datum=WGS84 +units=m +no_defs" muni.sp2<-spTransform(muni.sp,
>>> CRS(robin)) brgy_poly2<-spTransform(brgy_poly, CRS(robin))
>>> 
>> 
>> 
>> 
>> 
>> -- *
>> 
>> * *James Matthew B. Miraflor* MS Computer Science College of
>> Engineering University of the Philippines
>> 
>> http://politicsforbreakfast.blogspot.com ________
>> 
>> "No problem can withstand the assault of sustained thinking." -
>> Voltaire ________
>> 
> 
> 
> 

- -- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
83 33081, Fax: +49 251 8339763 http://ifgi.uni-muenster.de
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.11 (GNU/Linux)
Comment: Using GnuPG with Thunderbird - http://www.enigmail.net/

iQEcBAEBAgAGBQJSMszMAAoJEM1OCHCtOnfxFfEIAIOSncLp+X8cPfhxD3+uZm1g
QU+FL2EKrDippniw0i8fGv9+QYIpUf0qxQzMXsDtQj3nqitGSU8J2Hqqlytgj6z2
0gwdlP2Wrv2PWzotH7BJEZVJbl24kchIAXocPwa+FFYBEO+mY8t+iDaGR3sZTHK1
/Nt7kFWN2dRxaCg4Iagv38V3kV5sY/G3X6GREv05DUQ8vdzAzyUzL6byi8rr4E4H
dsSo8GegsD7SlqwqSofLAp+MmWlgcgC1l5I+npKF4XG8lUaai3ttVKT0Ulw+4YvU
7qAzlC/8xCOFnlI/Mhp7uVrtx72sl+4NHouS6FSSbF45ZoFtZnPQknLQWUUVklQ=
=iAjf
-----END PGP SIGNATURE-----


From b.rowlingson at lancaster.ac.uk  Fri Sep 13 10:37:54 2013
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Fri, 13 Sep 2013 09:37:54 +0100
Subject: [R-sig-Geo] Fastest method to reclassify large raster.
In-Reply-To: <e2a999dfd21945069ee473559b36a0e4@EX-1-HT0.lancs.local>
References: <CAN9eD7kPS2=Tep6rjLK=-STwSFzHej-PZH_R+j=faqBah6NWsg@mail.gmail.com>
	<e2a999dfd21945069ee473559b36a0e4@EX-1-HT0.lancs.local>
Message-ID: <CANVKczPnCdQ90gfuV7ufu4DK_Uq8_A-Zfzq1nKTS8d9x1pz-xw@mail.gmail.com>

On Fri, Sep 13, 2013 at 8:06 AM, Lionel Hertzog <s6lihert at uni-bonn.de> wrote:
> Dear Nevil Amos,
>
> Maybe the function 'reclassify' in the raster package is what you are
> looking for.

This should be trivially parallelizable, so if you have a cluster
handy there should be a way to split the raster and farm out the task
amongst the cluster.

Don't have a cluster? Rent one from Amazon.

Barry


From carotenuto_francesco at yahoo.it  Fri Sep 13 11:48:21 2013
From: carotenuto_francesco at yahoo.it (Francesco Carotenuto)
Date: Fri, 13 Sep 2013 10:48:21 +0100 (BST)
Subject: [R-sig-Geo] Indicator Kriging in automap
Message-ID: <1379065701.61813.YahooMailNeo@web133003.mail.ir2.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130913/3ed9aeed/attachment.pl>

From Xochitl.Cormon at ifremer.fr  Fri Sep 13 14:02:33 2013
From: Xochitl.Cormon at ifremer.fr (Xochitl CORMON)
Date: Fri, 13 Sep 2013 14:02:33 +0200
Subject: [R-sig-Geo] Specifying neighbourhood structure for Spatial
 Eigenvector Mapping (SEVM) using ME() in spdep
In-Reply-To: <mailman.364.1378998253.4612.r-sig-geo@r-project.org>
References: <mailman.364.1378998253.4612.r-sig-geo@r-project.org>
Message-ID: <5232FED9.1070909@ifremer.fr>

Dear list,

I found a message asking same kind of things I am wondering. 
Unfortunately I dont find proper answers and thus would like to update 
the topic. Maybe Xingli could you share what your learn from the authors 
with us to the questions below?

Regarding the weights, is it imperative for me to use (1-((x/4t)^2)? Can 
we just do an inverse weighting system like (1/x)? Can I also use 
weighted (C or W) instead of binary (B) weighting? Lastly, can I specify 
  the threshold distance instead of using a spanning tree algorithm?

Regards,

Xo

###### Original message
(SEVM) using ME() in spdep
Xingli Giam    Xingli Giam
Jan 27, 2009 at 9:38 am
Dear people of the R-sig-Geo list,

I am very interested in the Spatial Eigenvector Mapping (SEVM) method in
analysing my spatial data as described in your papers (Griffith and 
Peres-Neto
2006, Dormann et al. 2007).

However I am rather new to spatial analysis and therefore have some 
questions
regarding the script provided in the appendix of Dormann et al. 2007.

Code
nb1.0 <- dnearneigh(coordinates(snouter_sp), 0, 1.0)

nb1.0_dists <- nbdists(nb1.0, coordinates(snouter_sp))

nb1.0_sims <- lapply(nb1.0_dists, function(x) (1-((x/4)^2)) )

ME.listw <- nb2listw(nb1.0, glist=nb1.0_sims, style="B")

sevm1 <- ME(snouter1.1 ~ rain + djungle, data=snouter.df, family=gaussian,

listw=ME.listw)

# modify the arguments "family" according to your error distribution

I hope someone who has experience in suing SEVM can give me a hand with 
some of
the questions I have.

Regarding the weights, is it imperative for me to use (1-((x/4t)^2)? Can we
just do an inverse weighting system like (1/x)? Can I also use weighted 
(C or
W) instead of binary (B) weighting in this line -ME.listw <- nb2listw(nb1.0,
glist=nb1.0_sims, style="B")? Lastly, can I specify t, the threshold 
distance
instead of using a spanning tree algorithm?

Some background information about my data - it is in long-lat 
coordinates, and
I have calculated great circle distances.

And the code I was trying to use:

nb <- dnearneigh(as.matrix(dat$x_long, dat$y_lat), 0, 4000, longlat=T)
nb_dists <- nbdists(nb, as.matrix(dat$x_long, dat$y_lat))
nb_sims <- lapply(nb_dists, function(x) (1/x))
ME.listw <- nb2listw(nb, glist=nb_sims, style="W", zero.policy=T)

sevm1 <- ME(lg.sp1 ~ lg.area, data=dat, family=gaussian, listw=ME.listw)
lmlag1 <- lm(lg.sp1 ~ lg.area + fitted(sevm1), data=dat)
moran<- moran.test(residuals(lmlag1), listw=ME.listw, na.action=na.omit,
zero.policy=T)
moran


Thank you in advance for your help! Hope to hear from you soon!

Many thanks,
Xingli
######

-- 

<>< <>< <>< <><

Xochitl CORMON
+33 (0)3 21 99 56 84

Doctorante en sciences halieutiques
PhD student in fishery sciences

<>< <>< <>< <><

IFREMER
Centre Manche Mer du Nord
150 quai Gambetta
62200 Boulogne-sur-Mer

<>< <>< <>< <><


From Roger.Bivand at nhh.no  Fri Sep 13 14:25:16 2013
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 13 Sep 2013 14:25:16 +0200
Subject: [R-sig-Geo] Specifying neighbourhood structure for Spatial
 Eigenvector Mapping (SEVM) using ME() in spdep
In-Reply-To: <5232FED9.1070909@ifremer.fr>
References: <mailman.364.1378998253.4612.r-sig-geo@r-project.org>
	<5232FED9.1070909@ifremer.fr>
Message-ID: <alpine.LRH.2.03.1309131407390.13470@reclus.nhh.no>

You asked the same question yesterday (but simply added it to the original 
thread from 2009). Do read the instructions for posting and the posting 
guide. This is not a question concerned with the use of software, indeed, 
had you used the software, you could have examined the questions you ask 
empirically. Usually, no response to a posting results from a question 
with little relevance, so repeating it is not a good idea at all.

You do not indicate having read anything, the original thread mentioned 
Dormann et al. (2007) - are you aware of subsequent publications on using 
PCNM/Moran eigenvectors/Spatial filtering, and if not, why not? There are 
of course no theoretical reasons for not using different weighting 
schemes; the schemes used are user choices, as you would realise if you 
had taken time to study the literature. Have you read Borcard et al. 
(2011):

http://www.springer.com/statistics/life+sciences,+medicine+%26+health/book/978-1-4419-7975-9

Section 7.4?

With regard to your questions, of course you can, but it is your judgement 
as a researcher that should guide your choices, never advice from list 
members - it is your responsibility entirely.

Roger

On Fri, 13 Sep 2013, Xochitl CORMON wrote:

> Dear list,
>
> I found a message asking same kind of things I am wondering. Unfortunately I 
> dont find proper answers and thus would like to update the topic. Maybe 
> Xingli could you share what your learn from the authors with us to the 
> questions below?
>
> Regarding the weights, is it imperative for me to use (1-((x/4t)^2)? Can we 
> just do an inverse weighting system like (1/x)? Can I also use weighted (C or 
> W) instead of binary (B) weighting? Lastly, can I specify  the threshold 
> distance instead of using a spanning tree algorithm?
>
> Regards,
>
> Xo
>
> ###### Original message
> (SEVM) using ME() in spdep
> Xingli Giam    Xingli Giam
> Jan 27, 2009 at 9:38 am
> Dear people of the R-sig-Geo list,
>
> I am very interested in the Spatial Eigenvector Mapping (SEVM) method in
> analysing my spatial data as described in your papers (Griffith and 
> Peres-Neto
> 2006, Dormann et al. 2007).
>
> However I am rather new to spatial analysis and therefore have some questions
> regarding the script provided in the appendix of Dormann et al. 2007.
>
> Code
> nb1.0 <- dnearneigh(coordinates(snouter_sp), 0, 1.0)
>
> nb1.0_dists <- nbdists(nb1.0, coordinates(snouter_sp))
>
> nb1.0_sims <- lapply(nb1.0_dists, function(x) (1-((x/4)^2)) )
>
> ME.listw <- nb2listw(nb1.0, glist=nb1.0_sims, style="B")
>
> sevm1 <- ME(snouter1.1 ~ rain + djungle, data=snouter.df, family=gaussian,
>
> listw=ME.listw)
>
> # modify the arguments "family" according to your error distribution
>
> I hope someone who has experience in suing SEVM can give me a hand with some 
> of
> the questions I have.
>
> Regarding the weights, is it imperative for me to use (1-((x/4t)^2)? Can we
> just do an inverse weighting system like (1/x)? Can I also use weighted (C or
> W) instead of binary (B) weighting in this line -ME.listw <- nb2listw(nb1.0,
> glist=nb1.0_sims, style="B")? Lastly, can I specify t, the threshold distance
> instead of using a spanning tree algorithm?
>
> Some background information about my data - it is in long-lat coordinates, 
> and
> I have calculated great circle distances.
>
> And the code I was trying to use:
>
> nb <- dnearneigh(as.matrix(dat$x_long, dat$y_lat), 0, 4000, longlat=T)
> nb_dists <- nbdists(nb, as.matrix(dat$x_long, dat$y_lat))
> nb_sims <- lapply(nb_dists, function(x) (1/x))
> ME.listw <- nb2listw(nb, glist=nb_sims, style="W", zero.policy=T)
>
> sevm1 <- ME(lg.sp1 ~ lg.area, data=dat, family=gaussian, listw=ME.listw)
> lmlag1 <- lm(lg.sp1 ~ lg.area + fitted(sevm1), data=dat)
> moran<- moran.test(residuals(lmlag1), listw=ME.listw, na.action=na.omit,
> zero.policy=T)
> moran
>
>
> Thank you in advance for your help! Hope to hear from you soon!
>
> Many thanks,
> Xingli
> ######
>
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From Xochitl.Cormon at ifremer.fr  Fri Sep 13 15:37:58 2013
From: Xochitl.Cormon at ifremer.fr (Xochitl CORMON)
Date: Fri, 13 Sep 2013 15:37:58 +0200
Subject: [R-sig-Geo] Spatial Eigenvector Mapping (SEVM) using ME() in
 spdep + spacemakeR documentation
In-Reply-To: <alpine.LRH.2.03.1309131407390.13470@reclus.nhh.no>
References: <mailman.364.1378998253.4612.r-sig-geo@r-project.org>
	<5232FED9.1070909@ifremer.fr>
	<alpine.LRH.2.03.1309131407390.13470@reclus.nhh.no>
Message-ID: <52331536.2070400@ifremer.fr>

Dear Roger Bivand,

thank you for your answer. Indeed yesterday I tried to post the question 
however I received a warning telling me that I was not allowed to post 
(I did not register yet to the mailing list), so I assumed the post did 
not go through. I apologize for the double post.

I am actually working with Dormann et al, 2007 review and their appendix 
with the R script. In addition I am also using the Borcard et al., 2011, 
mainly pages 275 - 277. I just do not understand the differences between 
the two scripts and of course I am aware this come mainly from a lack of 
theoretic knowledge in GIS. However Xingli said in the precedent thread 
that he go info directly from the author.. Unfortunately he do not share 
them (quite frustrating I would say), I tried to send an email to Xingli 
directly but the address he used for the post is not working anymore 
that's why I asked the same questions.

To go further with my analysis I tried the script of Dormann et al 2007 
and the ME function from spdep package you developed. After running the 
code below I plotted a new autocorrelogram but the first 6 lags where 
still significant on Moran test on residuals error with values really 
similar to first model (modelQ1). I do not understand why (I could see a 
really strong effect using the autocovariate method (Moran Index dropped 
from 0.20 to 0.006). I am not sure if there is some theoretic concept I 
do not get or if I do something wrong in the code.

Finally, Borcard and al. advise to consult the documentation of 
spacemakeR package. Unfortunately I could not find it online.

Thank you again for your answer and sorry if I am out of the range of 
this mailing list but I cannot really disentangle what comes from my 
lack of knowledge in GIS and what comes from my lack of knowledge in R.

Xochitl C.

##### R code #####

modelQ1 <- glm(data = datafit, family = binomial, formula = OverlapSH ~ 
Presence.HG.Juv + Presence.HG.Adu + Presence.C.Adu + TempMean + 
DepthMean + DepthMean2 + Latitude + Longitude3)

coords <- as.matrix(cbind(dataframe$LongitudeCor, dataframe$LatitudeCor))

#Dormann et al., 2007 Appendix
data_sp <- SpatialPixelsDataFrame(as.matrix(datafit[,5:4]), datafit)
nb1.0 <- dnearneigh(coordinates(data_sp), 0, nbtresh)
nb1.0_dists <- nbdists(nb1.0, coordinates(data_sp))
nb1.0_sims <- lapply(nb1.0_dists, function(x) (1-((x/4)^2)) )
ME.listw <- nb2listw(nb1.0, glist=nb1.0_sims, style="B", zero.policy = TRUE)

Q1sevm <- ME(data = datafit, family = binomial, formula = OverlapSH ~ 
Presence.HG.Juv + Presence.HG.Adu + Presence.C.Adu + TempMean + 
DepthMean + DepthMean2 + Latitude + Longitude3, listw=ME.listw, alpha = 
0.05)

modelQ1sevm <- update(modelQ1, .~. + fitted(Q1sevm))
summary(modelQ1sevm)
anova(modelQ1sevm, test = "Chi")

modeltest <- modelQ1sevm
modeltestN <- "modelQ1sevm"

nb1 <- dnearneigh( as.matrix( cbind(datafit$LongitudeCor, 
datafit$LatitudeCor)), 0, nbtresh)
corelog <- sp.correlogram( nb1, rstandard(modeltest), order=10, 
method="I", zero.policy=TRUE)
plot(corelog, main = paste("Spatial auto correlation", modeltestN, sep= 
" "))

###############

<>< <>< <>< <><

Xochitl CORMON
+33 (0)3 21 99 56 84

Doctorante en sciences halieutiques
PhD student in fishery sciences

<>< <>< <>< <><

IFREMER
Centre Manche Mer du Nord
150 quai Gambetta
62200 Boulogne-sur-Mer

<>< <>< <>< <><



Le 13/09/2013 14:25, Roger Bivand a ?crit :
> You asked the same question yesterday (but simply added it to the
> original thread from 2009). Do read the instructions for posting and the
> posting guide. This is not a question concerned with the use of
> software, indeed, had you used the software, you could have examined the
> questions you ask empirically. Usually, no response to a posting results
> from a question with little relevance, so repeating it is not a good
> idea at all.
>
> You do not indicate having read anything, the original thread mentioned
> Dormann et al. (2007) - are you aware of subsequent publications on
> using PCNM/Moran eigenvectors/Spatial filtering, and if not, why not?
> There are of course no theoretical reasons for not using different
> weighting schemes; the schemes used are user choices, as you would
> realise if you had taken time to study the literature. Have you read
> Borcard et al. (2011):
>
> http://www.springer.com/statistics/life+sciences,+medicine+%26+health/book/978-1-4419-7975-9
>
>
> Section 7.4?
>
> With regard to your questions, of course you can, but it is your
> judgement as a researcher that should guide your choices, never advice
> from list members - it is your responsibility entirely.
>
> Roger
>
> On Fri, 13 Sep 2013, Xochitl CORMON wrote:
>
>> Dear list,
>>
>> I found a message asking same kind of things I am wondering.
>> Unfortunately I dont find proper answers and thus would like to update
>> the topic. Maybe Xingli could you share what your learn from the
>> authors with us to the questions below?
>>
>> Regarding the weights, is it imperative for me to use (1-((x/4t)^2)?
>> Can we just do an inverse weighting system like (1/x)? Can I also use
>> weighted (C or W) instead of binary (B) weighting? Lastly, can I
>> specify the threshold distance instead of using a spanning tree
>> algorithm?
>>
>> Regards,
>>
>> Xo
>>
>> ###### Original message
>> (SEVM) using ME() in spdep
>> Xingli Giam Xingli Giam
>> Jan 27, 2009 at 9:38 am
>> Dear people of the R-sig-Geo list,
>>
>> I am very interested in the Spatial Eigenvector Mapping (SEVM) method in
>> analysing my spatial data as described in your papers (Griffith and
>> Peres-Neto
>> 2006, Dormann et al. 2007).
>>
>> However I am rather new to spatial analysis and therefore have some
>> questions
>> regarding the script provided in the appendix of Dormann et al. 2007.
>>
>> Code
>> nb1.0 <- dnearneigh(coordinates(snouter_sp), 0, 1.0)
>>
>> nb1.0_dists <- nbdists(nb1.0, coordinates(snouter_sp))
>>
>> nb1.0_sims <- lapply(nb1.0_dists, function(x) (1-((x/4)^2)) )
>>
>> ME.listw <- nb2listw(nb1.0, glist=nb1.0_sims, style="B")
>>
>> sevm1 <- ME(snouter1.1 ~ rain + djungle, data=snouter.df,
>> family=gaussian,
>>
>> listw=ME.listw)
>>
>> # modify the arguments "family" according to your error distribution
>>
>> I hope someone who has experience in suing SEVM can give me a hand
>> with some of
>> the questions I have.
>>
>> Regarding the weights, is it imperative for me to use (1-((x/4t)^2)?
>> Can we
>> just do an inverse weighting system like (1/x)? Can I also use
>> weighted (C or
>> W) instead of binary (B) weighting in this line -ME.listw <-
>> nb2listw(nb1.0,
>> glist=nb1.0_sims, style="B")? Lastly, can I specify t, the threshold
>> distance
>> instead of using a spanning tree algorithm?
>>
>> Some background information about my data - it is in long-lat
>> coordinates, and
>> I have calculated great circle distances.
>>
>> And the code I was trying to use:
>>
>> nb <- dnearneigh(as.matrix(dat$x_long, dat$y_lat), 0, 4000, longlat=T)
>> nb_dists <- nbdists(nb, as.matrix(dat$x_long, dat$y_lat))
>> nb_sims <- lapply(nb_dists, function(x) (1/x))
>> ME.listw <- nb2listw(nb, glist=nb_sims, style="W", zero.policy=T)
>>
>> sevm1 <- ME(lg.sp1 ~ lg.area, data=dat, family=gaussian, listw=ME.listw)
>> lmlag1 <- lm(lg.sp1 ~ lg.area + fitted(sevm1), data=dat)
>> moran<- moran.test(residuals(lmlag1), listw=ME.listw, na.action=na.omit,
>> zero.policy=T)
>> moran
>>
>>
>> Thank you in advance for your help! Hope to hear from you soon!
>>
>> Many thanks,
>> Xingli
>> ######
>>
>>
>


From zuzulaz at gmail.com  Fri Sep 13 15:44:26 2013
From: zuzulaz at gmail.com (zuzana zajkova)
Date: Fri, 13 Sep 2013 15:44:26 +0200
Subject: [R-sig-Geo] Google maps/ Blue Marble in R
In-Reply-To: <86fvtc6c7i.fsf@Triskela.Home>
References: <CADQCJLDrxgOWnGyx_W2QGWTH3OZ1njr7iWQRHYgVhhh92rDO_w@mail.gmail.com>
	<86fvtimo5r.fsf@Triskela.Home>
	<CADQCJLCZBgjCAD8TiAVXkjUoOc6X3As17GriMmpNSAdTCC3QtA@mail.gmail.com>
	<86fvtc6c7i.fsf@Triskela.Home>
Message-ID: <CADQCJLB6HLEScXirz2kHF8duAP8gZtXF3TX+6MQMfCr9nqy4Cw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130913/914e7315/attachment.pl>

From zuzulaz at gmail.com  Fri Sep 13 16:58:45 2013
From: zuzulaz at gmail.com (zuzana zajkova)
Date: Fri, 13 Sep 2013 16:58:45 +0200
Subject: [R-sig-Geo] KernelUD calculation - coordinates type /
	transformation from lat/long
Message-ID: <CADQCJLBi-ZmqcZER=T=4yyvsb2vZYRpuxz0N1e0rvvG67NfZmQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130913/dfa89ab4/attachment.pl>

From 538280 at gmail.com  Fri Sep 13 22:18:09 2013
From: 538280 at gmail.com (Greg Snow)
Date: Fri, 13 Sep 2013 14:18:09 -0600
Subject: [R-sig-Geo] making an inset in a map figure
In-Reply-To: <A632B3F93D861843A3C966F3962C3F840148AE93A37E@EMAIL05.pnl.gov>
References: <A632B3F93D861843A3C966F3962C3F840148AE93A37E@EMAIL05.pnl.gov>
Message-ID: <CAFEqCdwsLMgTNYFQ-oZEg1=HUioTLPYx9hMKNcXRt=TbMjPwAA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130913/3864e057/attachment.pl>

From Scott.Waichler at pnnl.gov  Fri Sep 13 23:32:31 2013
From: Scott.Waichler at pnnl.gov (Waichler, Scott R)
Date: Fri, 13 Sep 2013 14:32:31 -0700
Subject: [R-sig-Geo] making an inset in a map figure
In-Reply-To: <CAFEqCdwsLMgTNYFQ-oZEg1=HUioTLPYx9hMKNcXRt=TbMjPwAA@mail.gmail.com>
References: <A632B3F93D861843A3C966F3962C3F840148AE93A37E@EMAIL05.pnl.gov>
	<CAFEqCdwsLMgTNYFQ-oZEg1=HUioTLPYx9hMKNcXRt=TbMjPwAA@mail.gmail.com>
Message-ID: <A632B3F93D861843A3C966F3962C3F840148AED3B73C@EMAIL05.pnl.gov>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130913/a34a2364/attachment.pl>

From tephilippi at gmail.com  Sat Sep 14 05:00:40 2013
From: tephilippi at gmail.com (Tom Philippi)
Date: Fri, 13 Sep 2013 20:00:40 -0700
Subject: [R-sig-Geo] Fastest method to reclassify large raster.
In-Reply-To: <CANVKczPnCdQ90gfuV7ufu4DK_Uq8_A-Zfzq1nKTS8d9x1pz-xw@mail.gmail.com>
References: <CAN9eD7kPS2=Tep6rjLK=-STwSFzHej-PZH_R+j=faqBah6NWsg@mail.gmail.com>
	<e2a999dfd21945069ee473559b36a0e4@EX-1-HT0.lancs.local>
	<CANVKczPnCdQ90gfuV7ufu4DK_Uq8_A-Zfzq1nKTS8d9x1pz-xw@mail.gmail.com>
Message-ID: <CALyPt8xBkh81my2eRam9ED2Xp6OriZr9BbHmFFCSY-XiAnB=hA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130913/95e3524f/attachment.pl>

From pricet at uchicago.edu  Sat Sep 14 14:39:37 2013
From: pricet at uchicago.edu (Trevor Price)
Date: Sat, 14 Sep 2013 07:39:37 -0500
Subject: [R-sig-Geo] intersections, PBSmapping 2.66.53 vs 2.63.37
Message-ID: <8F7125E1-AE97-4127-B1B4-A4FF272354F4@uchicago.edu>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130914/95a3dca4/attachment.pl>

From 538280 at gmail.com  Sat Sep 14 18:30:14 2013
From: 538280 at gmail.com (Greg Snow)
Date: Sat, 14 Sep 2013 10:30:14 -0600
Subject: [R-sig-Geo] making an inset in a map figure
In-Reply-To: <A632B3F93D861843A3C966F3962C3F840148AED3B73C@EMAIL05.pnl.gov>
References: <A632B3F93D861843A3C966F3962C3F840148AE93A37E@EMAIL05.pnl.gov>
	<CAFEqCdwsLMgTNYFQ-oZEg1=HUioTLPYx9hMKNcXRt=TbMjPwAA@mail.gmail.com>
	<A632B3F93D861843A3C966F3962C3F840148AED3B73C@EMAIL05.pnl.gov>
Message-ID: <CAFEqCdzr3-+4fXq5XBBzNoJxz25-s1CKTDSF7r4-yFHEbt-AmQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130914/c6c67565/attachment.pl>

From james.miraflor at gmail.com  Sat Sep 14 19:41:31 2013
From: james.miraflor at gmail.com (James Matthew Miraflor)
Date: Sun, 15 Sep 2013 01:41:31 +0800
Subject: [R-sig-Geo] IDW & Kriging on Spatial Grid not Consistent with IDW &
 Kriging on Polygon (CRS are the same)
Message-ID: <CAPim8ZKoh_VB5c=K-Sjy8sy4izGcp4xisWL=DcbuigZiUZ5kiA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130915/9a4222c4/attachment.pl>

From oscar.perpinan at gmail.com  Sun Sep 15 10:06:50 2013
From: oscar.perpinan at gmail.com (=?ISO-8859-1?Q?Oscar_Perpi=F1an?=)
Date: Sun, 15 Sep 2013 10:06:50 +0200
Subject: [R-sig-Geo] Google maps/ Blue Marble in R
In-Reply-To: <CADQCJLB6HLEScXirz2kHF8duAP8gZtXF3TX+6MQMfCr9nqy4Cw@mail.gmail.com>
References: <CADQCJLDrxgOWnGyx_W2QGWTH3OZ1njr7iWQRHYgVhhh92rDO_w@mail.gmail.com>
	<86fvtimo5r.fsf@Triskela.Home>
	<CADQCJLCZBgjCAD8TiAVXkjUoOc6X3As17GriMmpNSAdTCC3QtA@mail.gmail.com>
	<86fvtc6c7i.fsf@Triskela.Home>
	<CADQCJLB6HLEScXirz2kHF8duAP8gZtXF3TX+6MQMfCr9nqy4Cw@mail.gmail.com>
Message-ID: <CAMLL7bmC5ANT9J8x5eYYaM0mjG8i+mL4+cX-YeZDi81NaWQ7Ug@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130915/9265ede8/attachment.pl>

From koen.hufkens at gmail.com  Sun Sep 15 12:33:36 2013
From: koen.hufkens at gmail.com (Koen Hufkens)
Date: Sun, 15 Sep 2013 12:33:36 +0200
Subject: [R-sig-Geo] Frequency Slow on Large Raster Layer
In-Reply-To: <1378978134753-7584591.post@n2.nabble.com>
References: <1378978134753-7584591.post@n2.nabble.com>
Message-ID: <CAHDtqqnTXshABTNC2+E4-PVYYP5UTP04rBZBnEOaKc4NEAZ3bQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130915/32d2ef11/attachment.pl>

From r.hijmans at gmail.com  Mon Sep 16 07:57:06 2013
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Sun, 15 Sep 2013 22:57:06 -0700
Subject: [R-sig-Geo] Fastest method to reclassify large raster.
In-Reply-To: <CALyPt8xBkh81my2eRam9ED2Xp6OriZr9BbHmFFCSY-XiAnB=hA@mail.gmail.com>
References: <CAN9eD7kPS2=Tep6rjLK=-STwSFzHej-PZH_R+j=faqBah6NWsg@mail.gmail.com>
	<e2a999dfd21945069ee473559b36a0e4@EX-1-HT0.lancs.local>
	<CANVKczPnCdQ90gfuV7ufu4DK_Uq8_A-Zfzq1nKTS8d9x1pz-xw@mail.gmail.com>
	<CALyPt8xBkh81my2eRam9ED2Xp6OriZr9BbHmFFCSY-XiAnB=hA@mail.gmail.com>
Message-ID: <CANtt_hxtkgB1LRGzguvZ_irTjrbRE8gCWWWkfOBgwT8H_6JuAw@mail.gmail.com>

Nevil,

It seems to me that replacing numbers using a  lookup table of 197000
rows x 80 reclass values for a (not very large) raster of 197000
values can be solved more easily. Unfortunately, you did not provide
code that generates example data; please do so in the future, now you
leave us guessing. Presumably the lookup table column 'Value' is a
cell number. Is so, and if they are sorted, perhaps you can simply do:

b <- brick(r, nl=83)
b <- setValues(b,  mydataOut[,5:88])

Robert



On Fri, Sep 13, 2013 at 8:00 PM, Tom Philippi <tephilippi at gmail.com> wrote:
> A couple of hints:
> asc files are very slow to process in R.  I would write it back to the disk
> as either a native grd, or even geoTiff, before reclassifying (in my
> experience, perhaps a 100x increase in throughput).
> If you have enough memory and are running 64-bit R, load the raster into
> memory rather than run it from the disk.
> If you have a quad (or more) core cpu, look at using clusterR() in raster
> for simple (snow) parallel processing.  ?clusterR even has an example with
> reclassify.  That can get you another 2x or 3x speedup.
>
> If all that fails, what Barry said, although for me, the upload/download
> time for a cloud solution would take longer than computing on my circa 2007
> desktop (slow quad core with 20GB RAM).
>
> Tom
>
>
>
> On Fri, Sep 13, 2013 at 1:37 AM, Barry Rowlingson <
> b.rowlingson at lancaster.ac.uk> wrote:
>
>> On Fri, Sep 13, 2013 at 8:06 AM, Lionel Hertzog <s6lihert at uni-bonn.de>
>> wrote:
>> > Dear Nevil Amos,
>> >
>> > Maybe the function 'reclassify' in the raster package is what you are
>> > looking for.
>>
>> This should be trivially parallelizable, so if you have a cluster
>> handy there should be a way to split the raster and farm out the task
>> amongst the cluster.
>>
>> Don't have a cluster? Rent one from Amazon.
>>
>> Barry
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From r.hijmans at gmail.com  Mon Sep 16 08:07:56 2013
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Sun, 15 Sep 2013 23:07:56 -0700
Subject: [R-sig-Geo] problems to stack() rasters due to different pixel
 resolution and raster extent
In-Reply-To: <CADr8yXA7eDF+Sdg-pxxd+KB=4nWc9LB+p1pV+D_7rPpz_siokw@mail.gmail.com>
References: <CADr8yXDfcqXyOqgY_FAxFjLA8=uVgkpq5gYwzc6cHXtCCMzYBg@mail.gmail.com>
	<5231A688.8000309@gmail.com>
	<CADr8yXA7eDF+Sdg-pxxd+KB=4nWc9LB+p1pV+D_7rPpz_siokw@mail.gmail.com>
Message-ID: <CANtt_hxst=8rmKpSoaMQj7w0d_TBMKyh2wwpb+640e1oCruUyw@mail.gmail.com>

Gabriele,

That is not the best solution in this case; resampling should be a
function of last resort. As Lionel pointed out, aspect has one more
column than altitude, but has otherwise the same parameters.
Therefore, the approach should be using the crop function (which you
used, but after first making a mistake with res).

asp = crop(aspect, altitude)
slp = crop(slope, altitude)

OR the opposite route; add the row to the altitude raster:

alt = extend(altitude, aspect)

Robert

On Thu, Sep 12, 2013 at 8:45 AM, Gabriele Cozzi <gab.cozzi at gmail.com> wrote:
> Lionel, Paco,
>
> thanks for the quick answers.
>
> Going through your suggestions I found that the function *resample {raster}
> *that transfers values between non matching Raster* objects (in terms of
> origin and resolution) does exactly what I need.
>
> *resample* is actually embedded in the function *spatial_sync_raster* that
> I had problems to run. When I tried to run it I got the following error
> message:
>
> Error in spatial_sync_raster(alt, slo, method = "ngb", verbose = FALSE) :
>   could not find function "expand"
>
> *expand* is not part of the package climstats and I am not quite sure where
> to find it...
>
> But as said, *resample()* solved my problem.
>
> Thanks!
>
>
> Gabriele
>
>
>
> On Thu, Sep 12, 2013 at 1:33 PM, Francisco Rodriguez Sanchez <
> f.rodriguez.sanc at gmail.com> wrote:
>
>> Hi Gabriele,
>>
>> Try the spatial_sync_raster function in package climstats:
>> https://r-forge.r-project.org/**projects/climstats/<https://r-forge.r-project.org/projects/climstats/>.
>> It will align the projection, extent and resolution of your rasters all at
>> once
>>
>> Hope it helps,
>>
>> Paco
>>
>>
>> El 12/09/2013 11:59, Gabriele Cozzi escribi?:
>>
>>  Dear list,
>>>
>>> I was given three raster files with 'slope', 'aspect' and 'altitude' of my
>>> study site. I realised that one of the three rasters (namely 'altitude')
>>> has a slightly different raster cell resolution, which results in a
>>> slightly different raster extent and does not allow me to raster::stack()
>>> the three layers to create a single stack object.
>>> I tried to change the raster resolution using raster::res() for the raster
>>> 'altitude' but, when I subsequently cropped the three rasters with an
>>> object of class extent, I still got different extents between "slope and
>>> aspect" vs. "altitude".
>>>
>>> Any advice on how to solve this cell resolution incongruence is very
>>> welcome.
>>> Here below I report the output to make things more understandable.
>>>
>>> Thanks in advance,
>>> Gabriele
>>>
>>>
>>>
>>> #----------------
>>> #----------------
>>>
>>> aspect   <- raster("~/Envir/aspect/prj.**adf")
>>> slope     <- raster("~/Envir/slope/prj.adf"**)
>>> altitude  <- raster("~/Envir/**20130508094222_992463356.tif")
>>>
>>> aspect ( N.B. 'slope' returns exactly the same attributes!)
>>>     #class       : RasterLayer
>>>     #dimensions  : 9813, 8428, 82703964  (nrow, ncol, ncell)
>>>     #resolution  : 27.28532, 27.28532  (x, y)
>>>     #extent      : 135446.9, 365407.6, 4345919, 4613669  (xmin, xmax,
>>> ymin,
>>> ymax)
>>>     #coord. ref. : +proj=utm +zone=38 +ellps=WGS84 +towgs84=0,0,0,0,0,0,0
>>> +units=m    +no_defs
>>>
>>> altitude
>>>     #class       : RasterLayer
>>>     #dimensions  : 9812, 8428, 82695536  (nrow, ncol, ncell)
>>>     #resolution  : 27.28532, 27.28677  (x, y)
>>>     #extent      : 135446.9, 365407.6, 4345919, 4613656  (xmin, xmax,
>>> ymin,
>>> ymax)
>>>     #coord. ref. : +proj=utm +zone=38 +datum=WGS84 +units=m +no_defs
>>> +ellps=WGS84 +towgs84=0,0,0
>>>
>>> ex <- extent(animal_locations)
>>> ex
>>>     #class       : Extent
>>>     #xmin        : 257473.1
>>>     #xmax        : 312499.1
>>>     #ymin        : 4452821
>>>     #ymax        : 4570717
>>>
>>> Before using the function  raster.crop <- crop('raster_file', ex) to crop
>>> all rasters to the same extent, I tried to change the resolution of
>>> 'altitude' using
>>>
>>> res(altitude) <- 27.28532
>>>
>>> altitude
>>>     #class       : RasterLayer
>>>     #dimensions  : 9813, 8428, 82703964  (nrow, ncol, ncell)
>>>     #resolution  : 27.28532, 27.28532  (x, y)
>>>     #extent      : 135446.9, 365407.6, 4345905, 4613656  (xmin, xmax,
>>> ymin,
>>> ymax)
>>>     #coord. ref. : +proj=utm +zone=38 +datum=WGS84 +units=m +no_defs
>>> +ellps=WGS84 +towgs84=0,0,0
>>>
>>> When I then run crop() for aspect and the new defined altitude I however
>>> become different extents (i.e. ymin and ymax) despite now the dimensions
>>> and resolutions are the same
>>>
>>> crop(aspect, ex)
>>>     #class       : RasterLayer
>>>     #dimensions  : 5054, 2749, 13893446  (nrow, ncol, ncell)
>>>     #resolution  : 27.28532, 27.28532  (x, y)
>>>     #extent      : 247480.5, 322487.8, 4442809, 4580709  (xmin, xmax,
>>> ymin,
>>> ymax)
>>>     #coord. ref. : +proj=utm +zone=38 +ellps=WGS84 +towgs84=0,0,0,0,0,0,0
>>> +units=m +no_defs
>>>     #names       : prj
>>>     #values      : -1, 359.8158  (min, max)
>>>
>>> crop(altitude, ex)
>>>     #class       : RasterLayer
>>>     #dimensions  : 5054, 2749, 13893446  (nrow, ncol, ncell)
>>>     #resolution  : 27.28532, 27.28532  (x, y)
>>>     #extent      : 247480.5, 322487.8, 4442823, 4580723  (xmin, xmax,
>>> ymin,
>>> ymax)
>>>     #coord. ref. : +proj=utm +zone=38 +datum=WGS84 +units=m +no_defs
>>> +ellps=WGS84 +towgs84=0,0,0
>>>
>>> It also appears to me that by redefining res(altitude) I loose the actual
>>> values assigned to each pixel. Is there an argument to assign to the new
>>> pixels the value of the centre of the pixel?
>>>
>>>
>>>
>>>
>> --
>> Dr Francisco Rodriguez-Sanchez
>> Forest Ecology and Conservation Group
>> Department of Plant Sciences
>> University of Cambridge
>> Downing Street
>> Cambridge CB2 3EA
>> United Kingdom
>> http://sites.google.com/site/**rodriguezsanchezf<http://sites.google.com/site/rodriguezsanchezf>
>>
>>
>> ______________________________**_________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/**listinfo/r-sig-geo<https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
>>
>
>
>
> --
> Gabriele Cozzi
> Postdoctoral Research Associate
> Population Ecology Research Group
> http://www.popecol.org
>
> Zurich University
> Institute of Evolutionary Biology and Environmental Studies
> Winterthurerstr. 190
> 8057 Zurich - Switzerland
> E-mail: gabriele.cozzi at uzh.ch
> Phone: +41(0)44 635 49 12
> Fax: +41(0)16355711
> http://www.ieu.uzh.ch
>
>         [[alternative HTML version deleted]]
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From r.hijmans at gmail.com  Mon Sep 16 08:13:36 2013
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Sun, 15 Sep 2013 23:13:36 -0700
Subject: [R-sig-Geo] generating coordinates at equal geographical
	distances
In-Reply-To: <52224C77.7080408@uni-muenster.de>
References: <b25b8665be7141ecb4210ad9f319a24c@EX-0-HT0.lancs.local>
	<CANVKczPuYvX_pdZULAjA_i0wPqPH+AK8ASKuhV-gJNtK_iCf_Q@mail.gmail.com>
	<CAMLNaBbX4jQqzqMhiyRpMFejuj9hmOdbP08ObPbKjoWVjsDP7Q@mail.gmail.com>
	<52224C77.7080408@uni-muenster.de>
Message-ID: <CANtt_hyPb3RQj5NnXCQs3d_FHBvFbxJ43ZbU=NbZkH_wBbiZ0g@mail.gmail.com>

And you can compare the results with those of the
'regularCoordinates' function in geosphere.  Robert

On Sat, Aug 31, 2013 at 1:05 PM, Edzer Pebesma
<edzer.pebesma at uni-muenster.de> wrote:
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> John, as an alternative you may want to look into sp::spsample, using
> type "Fibonacci"; the paper describing this is
>
> Alvaro Gonzalez, 2010. Measurement of Areas on a Sphere Using
> Fibonacci and Latitude-Longitude Lattices. Mathematical Geosciences
> 42(1), p. 49-64
>
>
> On 08/28/2013 07:27 PM, john d wrote:
>> Ok, I'll be more explicit :)
>>
>> If I want to generate random coordinates across North America by
>> uniformly sampling latitudes and longitudes, the geographical
>> distance between these coordinates would decrease towards higher
>> latitudes. I'd like to be able to generate coordinates (e.g. a
>> grid) such that the geographical distances between coordinates
>> would be constant regardless of latitude.
>>
>>
>>
>> On Wed, Aug 28, 2013 at 12:04 PM, Barry Rowlingson <
>> b.rowlingson at lancaster.ac.uk> wrote:
>>
>>> You will find that any two coordinates are equidistant from each
>>> other...
>>>
>>> So my suggestion is you need to expand you question a bit more!
>>> :)
>>>
>>> On Wed, Aug 28, 2013 at 3:49 PM, john d <dobzhanski at gmail.com>
>>> wrote:
>>>> Dear all,
>>>>
>>>> I need to generate coordinates that are equidistant, regardless
>>>> of latitude. Any suggestions?
>>>>
>>>> Thanks!
>>>>
>>>> John
>>>>
>>>> [[alternative HTML version deleted]]
>>>>
>>>> _______________________________________________ R-sig-Geo
>>>> mailing list R-sig-Geo at r-project.org
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>> [[alternative HTML version deleted]]
>>
>> _______________________________________________ R-sig-Geo mailing
>> list R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> - --
> Edzer Pebesma
> Institute for Geoinformatics (ifgi), University of M?nster
> Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
> 83 33081, Fax: +49 251 8339763 http://ifgi.uni-muenster.de
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v1.4.11 (GNU/Linux)
> Comment: Using GnuPG with Thunderbird - http://www.enigmail.net/
>
> iQEcBAEBAgAGBQJSIkx3AAoJEM1OCHCtOnfx2X0IAIPFc/Ut4cxqNcdFfXn2bFgQ
> ++HgCVm2EXHp6gqGNnGT4vD+Wn8DnXXd483alUFLD6SLxIqtI51DSTSEGy1p6ZkI
> 1bbKFdGKHmrOgXXf98nmBUBxHJGVrCU4M+aDVmHA2c5QhmEeqM/JnoGijL2pPHpH
> SuK6HcBEqhL36jgtKF/uJKnMf4nEEFtP6lQ7UAVuhzADZ3nMR36zl+o/EsoHtwbt
> uFcjDpP+qPh2S1wXd/y90lj8d1Pj3tQXNONvbOTgVthealPGBZxCTSSPbedhIV4w
> jSfk2ded7QICCR0AoGRFcxV21SR0a5FrXpWjIfgWyWRg+RWq+5Dxdoxnu7ozOIs=
> =hPBa
> -----END PGP SIGNATURE-----
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From gab.cozzi at gmail.com  Mon Sep 16 08:50:54 2013
From: gab.cozzi at gmail.com (Gabriele Cozzi)
Date: Mon, 16 Sep 2013 08:50:54 +0200
Subject: [R-sig-Geo] problems to stack() rasters due to different pixel
 resolution and raster extent
In-Reply-To: <CANtt_hxst=8rmKpSoaMQj7w0d_TBMKyh2wwpb+640e1oCruUyw@mail.gmail.com>
References: <CADr8yXDfcqXyOqgY_FAxFjLA8=uVgkpq5gYwzc6cHXtCCMzYBg@mail.gmail.com>
	<5231A688.8000309@gmail.com>
	<CADr8yXA7eDF+Sdg-pxxd+KB=4nWc9LB+p1pV+D_7rPpz_siokw@mail.gmail.com>
	<CANtt_hxst=8rmKpSoaMQj7w0d_TBMKyh2wwpb+640e1oCruUyw@mail.gmail.com>
Message-ID: <CADr8yXDkd-6dL8iRM02JTArwkUp2KkPOygORih8Ta0YcBcwGxw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130916/8395e39c/attachment.pl>

From Guillaume.Drolet at mrn.gouv.qc.ca  Mon Sep 16 17:10:53 2013
From: Guillaume.Drolet at mrn.gouv.qc.ca (Guillaume.Drolet at mrn.gouv.qc.ca)
Date: Mon, 16 Sep 2013 11:10:53 -0400
Subject: [R-sig-Geo] writeRaster to TIF  changes raster maximum value
Message-ID: <52371F7D.3060606@mrn.gouv.qc.ca>

Dear list members,

I need your help trying to figure out why my raster's maximum value gets
changed in the resulting TIF file from a call to the writeRaster function.

I read here
(http://r-sig-geo.2731867.n2.nabble.com/writeRaster-to-ascii-file-asc-td7584093.html#none) 

that this problem could be due to my version of GDAL (1.11dev released
2013/04/13). This is the GDAL version that is in my system's path. Don't
know if this can help but when I load rgdal, I can read this:

Loaded GDAL runtime: GDAL 1.9.2, released 2012/10/08

Here are the details of my raster (myRaster) before calling writeRaster:

  > raster(myRaster)

class       : RasterLayer
dimensions  : 7261, 7961, 57804821  (nrow, ncol, ncell)
resolution  : 30, 30  (x, y)
extent      : 457785, 696615, 5147085, 5364915  (xmin, xmax, ymin, ymax)
coord. ref. : +proj=utm +zone=18 +datum=WGS84 +units=m +no_defs
+ellps=WGS84 +towgs84=0,0,0
data source : E:\temp\Fmask\Image\L71015027_02720000730_B10.tif
names       : L71015027_02720000730_B10
values      : 0, 255  (min, max)


I crop "myRaster" using the crop function with a bounding box and then I 
save the cropped raster as a TIF with:

  > writeRaster(rc, "myCroppedRaster.tif", datatype = "INT2S")
rgdal: version: 0.8-11, (SVN revision 479M)
Geospatial Data Abstraction Library extensions to R successfully loaded
Loaded GDAL runtime: GDAL 1.9.2, released 2012/10/08
Path to GDAL shared files:
C:/Users/Utilisateur/Documents/R/win-library/3.0/rgdal/gdal
GDAL does not use iconv for recoding strings.
Loaded PROJ.4 runtime: Rel. 4.7.1, 23 September 2009, [PJ_VERSION: 470]
Path to PROJ.4 shared files:
C:/Users/Utilisateur/Documents/R/win-library/3.0/rgdal/proj

class       : RasterLayer
dimensions  : 3628, 3994, 14490232  (nrow, ncol, ncell)
resolution  : 30, 30  (x, y)
extent      : 457785, 577605, 5147085, 5255925  (xmin, xmax, ymin, ymax)
coord. ref. : +proj=utm +zone=18 +datum=WGS84 +units=m +no_defs
+ellps=WGS84 +towgs84=0,0,0
data source : E:temp\myRaster.tif
names       : myRaster
values      : 0, 254  (min, max)


As shown in the output from writeRaster, the maximum value in the output 
TIF file is now 254. I double-checked and
there are pixels with value 255 in the cropped area of the original
raster so the maximum value shouldn't be 254 but 255.

Here's the output of my sessionInfo():

R version 3.0.1 (2013-05-16)
Platform: x86_64-w64-mingw32/x64 (64-bit)

locale:
[1] LC_COLLATE=French_Canada.1252  LC_CTYPE=French_Canada.1252
LC_MONETARY=French_Canada.1252
[4] LC_NUMERIC=C                   LC_TIME=French_Canada.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] rgdal_0.8-11  raster_2.1-49 sp_1.0-13

loaded via a namespace (and not attached):
[1] grid_3.0.1      lattice_0.20-15 tools_3.0.1

I thank you in advance for any hint that could help me solve this
problem.

Guillaume
-- 
Guillaume Drolet ing.f M.Sc.
Chercheur en t?l?d?tection et dynamique foresti?re
Direction de la recherche foresti?re
Minist?re des ressources naturelles du Qu?bec
2700, rue Einstein, C.RC.335
Qu?bec (Qu?bec), Canada G1P 3W8
T : +1 418 643 7994 # 6727
F : +1 418 643 2165
guillaume.drolet at mrn.gouv.qc.ca
http://www.mrn.gouv.qc.ca/forets


From r.hijmans at gmail.com  Mon Sep 16 17:38:17 2013
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Mon, 16 Sep 2013 08:38:17 -0700
Subject: [R-sig-Geo] problems to stack() rasters due to different pixel
 resolution and raster extent
In-Reply-To: <CADr8yXDkd-6dL8iRM02JTArwkUp2KkPOygORih8Ta0YcBcwGxw@mail.gmail.com>
References: <CADr8yXDfcqXyOqgY_FAxFjLA8=uVgkpq5gYwzc6cHXtCCMzYBg@mail.gmail.com>
	<5231A688.8000309@gmail.com>
	<CADr8yXA7eDF+Sdg-pxxd+KB=4nWc9LB+p1pV+D_7rPpz_siokw@mail.gmail.com>
	<CANtt_hxst=8rmKpSoaMQj7w0d_TBMKyh2wwpb+640e1oCruUyw@mail.gmail.com>
	<CADr8yXDkd-6dL8iRM02JTArwkUp2KkPOygORih8Ta0YcBcwGxw@mail.gmail.com>
Message-ID: <CANtt_hyd9LGmiqftUtXu_rrB=XOdSKDmn0y58ta9MEC-jyrRPQ@mail.gmail.com>

Gabrielle you are right, if the resolution is in fact different -- I
did not look carefully enough at the decimals -- then crop/extend
won't work and you will need resample.
Another approach would be to use the "terrain" function in raster and
compute slope and aspect from the elevation data.
Robert

On Sun, Sep 15, 2013 at 11:50 PM, Gabriele Cozzi <gab.cozzi at gmail.com> wrote:
> Dear Robert,
>
> thank you for going through my post again. Really appreciated
>
> I just tried what you suggested but neither crop() nor extend() do fix my
> problem; the extent and the resolution of forest remains different from
> slope and aspect
>
> Indeed aspect and slope have one more column than altitude, but I believe
> this is the result of the resolution being different in the original rasters
>
> res(aspect)
> res(slope)
> # 27.28532 27.28532
>
> res(altitude)
> # 27.28532 27.28677
>
> I believe this is the reason why cropping (or extending) does not work
> because a raster cannot be cropped using an extent that does not allow for a
> finite number of rows?
> I think that cropping aspect with altitude would result in a decimal number
> nrow(aspect) = xxx.y   and a raster row can not take decimals?
>
> Does this make sense?
>
> Any further suggestion is appreciated
>
> I think I will also try to find out why, to begin with, the 3 raster layers
> that I was given have different resolution. They all come from the same
> satellite imagery so they should have the same resolution.
>
> Thanks in advance,
>
> Gabriele
>
>
>
> On Mon, Sep 16, 2013 at 8:07 AM, Robert J. Hijmans <r.hijmans at gmail.com>
> wrote:
>>
>> Gabriele,
>>
>> That is not the best solution in this case; resampling should be a
>> function of last resort. As Lionel pointed out, aspect has one more
>> column than altitude, but has otherwise the same parameters.
>> Therefore, the approach should be using the crop function (which you
>> used, but after first making a mistake with res).
>>
>> asp = crop(aspect, altitude)
>> slp = crop(slope, altitude)
>>
>> OR the opposite route; add the row to the altitude raster:
>>
>> alt = extend(altitude, aspect)
>>
>> Robert
>>
>> On Thu, Sep 12, 2013 at 8:45 AM, Gabriele Cozzi <gab.cozzi at gmail.com>
>> wrote:
>> > Lionel, Paco,
>> >
>> > thanks for the quick answers.
>> >
>> > Going through your suggestions I found that the function *resample
>> > {raster}
>> > *that transfers values between non matching Raster* objects (in terms of
>> > origin and resolution) does exactly what I need.
>> >
>> > *resample* is actually embedded in the function *spatial_sync_raster*
>> > that
>> > I had problems to run. When I tried to run it I got the following error
>> > message:
>> >
>> > Error in spatial_sync_raster(alt, slo, method = "ngb", verbose = FALSE)
>> > :
>> >   could not find function "expand"
>> >
>> > *expand* is not part of the package climstats and I am not quite sure
>> > where
>> > to find it...
>> >
>> > But as said, *resample()* solved my problem.
>> >
>> > Thanks!
>> >
>> >
>> > Gabriele
>> >
>> >
>> >
>> > On Thu, Sep 12, 2013 at 1:33 PM, Francisco Rodriguez Sanchez <
>> > f.rodriguez.sanc at gmail.com> wrote:
>> >
>> >> Hi Gabriele,
>> >>
>> >> Try the spatial_sync_raster function in package climstats:
>> >>
>> >> https://r-forge.r-project.org/**projects/climstats/<https://r-forge.r-project.org/projects/climstats/>.
>> >> It will align the projection, extent and resolution of your rasters all
>> >> at
>> >> once
>> >>
>> >> Hope it helps,
>> >>
>> >> Paco
>> >>
>> >>
>> >> El 12/09/2013 11:59, Gabriele Cozzi escribi?:
>> >>
>> >>  Dear list,
>> >>>
>> >>> I was given three raster files with 'slope', 'aspect' and 'altitude'
>> >>> of my
>> >>> study site. I realised that one of the three rasters (namely
>> >>> 'altitude')
>> >>> has a slightly different raster cell resolution, which results in a
>> >>> slightly different raster extent and does not allow me to
>> >>> raster::stack()
>> >>> the three layers to create a single stack object.
>> >>> I tried to change the raster resolution using raster::res() for the
>> >>> raster
>> >>> 'altitude' but, when I subsequently cropped the three rasters with an
>> >>> object of class extent, I still got different extents between "slope
>> >>> and
>> >>> aspect" vs. "altitude".
>> >>>
>> >>> Any advice on how to solve this cell resolution incongruence is very
>> >>> welcome.
>> >>> Here below I report the output to make things more understandable.
>> >>>
>> >>> Thanks in advance,
>> >>> Gabriele
>> >>>
>> >>>
>> >>>
>> >>> #----------------
>> >>> #----------------
>> >>>
>> >>> aspect   <- raster("~/Envir/aspect/prj.**adf")
>> >>> slope     <- raster("~/Envir/slope/prj.adf"**)
>> >>> altitude  <- raster("~/Envir/**20130508094222_992463356.tif")
>> >>>
>> >>> aspect ( N.B. 'slope' returns exactly the same attributes!)
>> >>>     #class       : RasterLayer
>> >>>     #dimensions  : 9813, 8428, 82703964  (nrow, ncol, ncell)
>> >>>     #resolution  : 27.28532, 27.28532  (x, y)
>> >>>     #extent      : 135446.9, 365407.6, 4345919, 4613669  (xmin, xmax,
>> >>> ymin,
>> >>> ymax)
>> >>>     #coord. ref. : +proj=utm +zone=38 +ellps=WGS84
>> >>> +towgs84=0,0,0,0,0,0,0
>> >>> +units=m    +no_defs
>> >>>
>> >>> altitude
>> >>>     #class       : RasterLayer
>> >>>     #dimensions  : 9812, 8428, 82695536  (nrow, ncol, ncell)
>> >>>     #resolution  : 27.28532, 27.28677  (x, y)
>> >>>     #extent      : 135446.9, 365407.6, 4345919, 4613656  (xmin, xmax,
>> >>> ymin,
>> >>> ymax)
>> >>>     #coord. ref. : +proj=utm +zone=38 +datum=WGS84 +units=m +no_defs
>> >>> +ellps=WGS84 +towgs84=0,0,0
>> >>>
>> >>> ex <- extent(animal_locations)
>> >>> ex
>> >>>     #class       : Extent
>> >>>     #xmin        : 257473.1
>> >>>     #xmax        : 312499.1
>> >>>     #ymin        : 4452821
>> >>>     #ymax        : 4570717
>> >>>
>> >>> Before using the function  raster.crop <- crop('raster_file', ex) to
>> >>> crop
>> >>> all rasters to the same extent, I tried to change the resolution of
>> >>> 'altitude' using
>> >>>
>> >>> res(altitude) <- 27.28532
>> >>>
>> >>> altitude
>> >>>     #class       : RasterLayer
>> >>>     #dimensions  : 9813, 8428, 82703964  (nrow, ncol, ncell)
>> >>>     #resolution  : 27.28532, 27.28532  (x, y)
>> >>>     #extent      : 135446.9, 365407.6, 4345905, 4613656  (xmin, xmax,
>> >>> ymin,
>> >>> ymax)
>> >>>     #coord. ref. : +proj=utm +zone=38 +datum=WGS84 +units=m +no_defs
>> >>> +ellps=WGS84 +towgs84=0,0,0
>> >>>
>> >>> When I then run crop() for aspect and the new defined altitude I
>> >>> however
>> >>> become different extents (i.e. ymin and ymax) despite now the
>> >>> dimensions
>> >>> and resolutions are the same
>> >>>
>> >>> crop(aspect, ex)
>> >>>     #class       : RasterLayer
>> >>>     #dimensions  : 5054, 2749, 13893446  (nrow, ncol, ncell)
>> >>>     #resolution  : 27.28532, 27.28532  (x, y)
>> >>>     #extent      : 247480.5, 322487.8, 4442809, 4580709  (xmin, xmax,
>> >>> ymin,
>> >>> ymax)
>> >>>     #coord. ref. : +proj=utm +zone=38 +ellps=WGS84
>> >>> +towgs84=0,0,0,0,0,0,0
>> >>> +units=m +no_defs
>> >>>     #names       : prj
>> >>>     #values      : -1, 359.8158  (min, max)
>> >>>
>> >>> crop(altitude, ex)
>> >>>     #class       : RasterLayer
>> >>>     #dimensions  : 5054, 2749, 13893446  (nrow, ncol, ncell)
>> >>>     #resolution  : 27.28532, 27.28532  (x, y)
>> >>>     #extent      : 247480.5, 322487.8, 4442823, 4580723  (xmin, xmax,
>> >>> ymin,
>> >>> ymax)
>> >>>     #coord. ref. : +proj=utm +zone=38 +datum=WGS84 +units=m +no_defs
>> >>> +ellps=WGS84 +towgs84=0,0,0
>> >>>
>> >>> It also appears to me that by redefining res(altitude) I loose the
>> >>> actual
>> >>> values assigned to each pixel. Is there an argument to assign to the
>> >>> new
>> >>> pixels the value of the centre of the pixel?
>> >>>
>> >>>
>> >>>
>> >>>
>> >> --
>> >> Dr Francisco Rodriguez-Sanchez
>> >> Forest Ecology and Conservation Group
>> >> Department of Plant Sciences
>> >> University of Cambridge
>> >> Downing Street
>> >> Cambridge CB2 3EA
>> >> United Kingdom
>> >>
>> >> http://sites.google.com/site/**rodriguezsanchezf<http://sites.google.com/site/rodriguezsanchezf>
>> >>
>> >>
>> >> ______________________________**_________________
>> >> R-sig-Geo mailing list
>> >> R-sig-Geo at r-project.org
>> >>
>> >> https://stat.ethz.ch/mailman/**listinfo/r-sig-geo<https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
>> >>
>> >
>> >
>> >
>> > --
>> > Gabriele Cozzi
>> > Postdoctoral Research Associate
>> > Population Ecology Research Group
>> > http://www.popecol.org
>> >
>> > Zurich University
>> > Institute of Evolutionary Biology and Environmental Studies
>> > Winterthurerstr. 190
>> > 8057 Zurich - Switzerland
>> > E-mail: gabriele.cozzi at uzh.ch
>> > Phone: +41(0)44 635 49 12
>> > Fax: +41(0)16355711
>> > http://www.ieu.uzh.ch
>> >
>> >         [[alternative HTML version deleted]]
>> >
>> >
>> > _______________________________________________
>> > R-sig-Geo mailing list
>> > R-sig-Geo at r-project.org
>> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> >
>
>
>
>
> --
> Gabriele Cozzi
> Postdoctoral Research Associate
> Population Ecology Research Group
> http://www.popecol.org
>
> Zurich University
> Institute of Evolutionary Biology and Environmental Studies
> Winterthurerstr. 190
> 8057 Zurich - Switzerland
> E-mail: gabriele.cozzi at uzh.ch
> Phone: +41(0)44 635 49 12
> Fax: +41(0)16355711
> http://www.ieu.uzh.ch
>


From r.hijmans at gmail.com  Mon Sep 16 17:41:39 2013
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Mon, 16 Sep 2013 08:41:39 -0700
Subject: [R-sig-Geo] writeRaster to TIF changes raster maximum value
In-Reply-To: <52371F7D.3060606@mrn.gouv.qc.ca>
References: <52371F7D.3060606@mrn.gouv.qc.ca>
Message-ID: <CANtt_hyQE5Lyast2bGh7rrVYke-3q74Co-UrOsQfJ8K_fBD74Q@mail.gmail.com>

I suspect that the original file has Byte values and that 255 is used,
perhaps erroneously, as NA. Can you give me access to the file?
Thanks, Robert

On Mon, Sep 16, 2013 at 8:10 AM,  <Guillaume.Drolet at mrn.gouv.qc.ca> wrote:
> Dear list members,
>
> I need your help trying to figure out why my raster's maximum value gets
> changed in the resulting TIF file from a call to the writeRaster function.
>
> I read here
> (http://r-sig-geo.2731867.n2.nabble.com/writeRaster-to-ascii-file-asc-td7584093.html#none)
>
> that this problem could be due to my version of GDAL (1.11dev released
> 2013/04/13). This is the GDAL version that is in my system's path. Don't
> know if this can help but when I load rgdal, I can read this:
>
> Loaded GDAL runtime: GDAL 1.9.2, released 2012/10/08
>
> Here are the details of my raster (myRaster) before calling writeRaster:
>
>   > raster(myRaster)
>
> class       : RasterLayer
> dimensions  : 7261, 7961, 57804821  (nrow, ncol, ncell)
> resolution  : 30, 30  (x, y)
> extent      : 457785, 696615, 5147085, 5364915  (xmin, xmax, ymin, ymax)
> coord. ref. : +proj=utm +zone=18 +datum=WGS84 +units=m +no_defs
> +ellps=WGS84 +towgs84=0,0,0
> data source : E:\temp\Fmask\Image\L71015027_02720000730_B10.tif
> names       : L71015027_02720000730_B10
> values      : 0, 255  (min, max)
>
>
> I crop "myRaster" using the crop function with a bounding box and then I
> save the cropped raster as a TIF with:
>
>   > writeRaster(rc, "myCroppedRaster.tif", datatype = "INT2S")
> rgdal: version: 0.8-11, (SVN revision 479M)
> Geospatial Data Abstraction Library extensions to R successfully loaded
> Loaded GDAL runtime: GDAL 1.9.2, released 2012/10/08
> Path to GDAL shared files:
> C:/Users/Utilisateur/Documents/R/win-library/3.0/rgdal/gdal
> GDAL does not use iconv for recoding strings.
> Loaded PROJ.4 runtime: Rel. 4.7.1, 23 September 2009, [PJ_VERSION: 470]
> Path to PROJ.4 shared files:
> C:/Users/Utilisateur/Documents/R/win-library/3.0/rgdal/proj
>
> class       : RasterLayer
> dimensions  : 3628, 3994, 14490232  (nrow, ncol, ncell)
> resolution  : 30, 30  (x, y)
> extent      : 457785, 577605, 5147085, 5255925  (xmin, xmax, ymin, ymax)
> coord. ref. : +proj=utm +zone=18 +datum=WGS84 +units=m +no_defs
> +ellps=WGS84 +towgs84=0,0,0
> data source : E:temp\myRaster.tif
> names       : myRaster
> values      : 0, 254  (min, max)
>
>
> As shown in the output from writeRaster, the maximum value in the output
> TIF file is now 254. I double-checked and
> there are pixels with value 255 in the cropped area of the original
> raster so the maximum value shouldn't be 254 but 255.
>
> Here's the output of my sessionInfo():
>
> R version 3.0.1 (2013-05-16)
> Platform: x86_64-w64-mingw32/x64 (64-bit)
>
> locale:
> [1] LC_COLLATE=French_Canada.1252  LC_CTYPE=French_Canada.1252
> LC_MONETARY=French_Canada.1252
> [4] LC_NUMERIC=C                   LC_TIME=French_Canada.1252
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> other attached packages:
> [1] rgdal_0.8-11  raster_2.1-49 sp_1.0-13
>
> loaded via a namespace (and not attached):
> [1] grid_3.0.1      lattice_0.20-15 tools_3.0.1
>
> I thank you in advance for any hint that could help me solve this
> problem.
>
> Guillaume
> --
> Guillaume Drolet ing.f M.Sc.
> Chercheur en t?l?d?tection et dynamique foresti?re
> Direction de la recherche foresti?re
> Minist?re des ressources naturelles du Qu?bec
> 2700, rue Einstein, C.RC.335
> Qu?bec (Qu?bec), Canada G1P 3W8
> T : +1 418 643 7994 # 6727
> F : +1 418 643 2165
> guillaume.drolet at mrn.gouv.qc.ca
> http://www.mrn.gouv.qc.ca/forets
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From eddieatr at gmail.com  Mon Sep 16 19:06:25 2013
From: eddieatr at gmail.com (Eddie Smith)
Date: Mon, 16 Sep 2013 18:06:25 +0100
Subject: [R-sig-Geo] Batch conver from img to rst
Message-ID: <CABaJH7838Gv9D7t3S+rd+WFkjtpWvA__TN2GbWUDXK5eDTJZ5w@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130916/c8395a4d/attachment.pl>

From 538280 at gmail.com  Mon Sep 16 19:09:38 2013
From: 538280 at gmail.com (Greg Snow)
Date: Mon, 16 Sep 2013 11:09:38 -0600
Subject: [R-sig-Geo] Batch conver from img to rst
In-Reply-To: <CABaJH7838Gv9D7t3S+rd+WFkjtpWvA__TN2GbWUDXK5eDTJZ5w@mail.gmail.com>
References: <CABaJH7838Gv9D7t3S+rd+WFkjtpWvA__TN2GbWUDXK5eDTJZ5w@mail.gmail.com>
Message-ID: <CAFEqCdw=3++GycKPP9FKRx0M0V4zP_M_5tjAgtGsMXDS6z8VhA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130916/0ea78d2f/attachment.pl>

From eddieatr at gmail.com  Mon Sep 16 19:15:11 2013
From: eddieatr at gmail.com (Eddie Smith)
Date: Mon, 16 Sep 2013 18:15:11 +0100
Subject: [R-sig-Geo] Batch conver from img to rst
In-Reply-To: <CAFEqCdw=3++GycKPP9FKRx0M0V4zP_M_5tjAgtGsMXDS6z8VhA@mail.gmail.com>
References: <CABaJH7838Gv9D7t3S+rd+WFkjtpWvA__TN2GbWUDXK5eDTJZ5w@mail.gmail.com>
	<CAFEqCdw=3++GycKPP9FKRx0M0V4zP_M_5tjAgtGsMXDS6z8VhA@mail.gmail.com>
Message-ID: <CABaJH7_mDiCePmGDGKGVDuzi7ffp_hMGyZdmyPOmm9h+=Q6YmQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130916/bba9655b/attachment.pl>

From 538280 at gmail.com  Mon Sep 16 19:28:38 2013
From: 538280 at gmail.com (Greg Snow)
Date: Mon, 16 Sep 2013 11:28:38 -0600
Subject: [R-sig-Geo] Batch conver from img to rst
In-Reply-To: <CABaJH7_mDiCePmGDGKGVDuzi7ffp_hMGyZdmyPOmm9h+=Q6YmQ@mail.gmail.com>
References: <CABaJH7838Gv9D7t3S+rd+WFkjtpWvA__TN2GbWUDXK5eDTJZ5w@mail.gmail.com>
	<CAFEqCdw=3++GycKPP9FKRx0M0V4zP_M_5tjAgtGsMXDS6z8VhA@mail.gmail.com>
	<CABaJH7_mDiCePmGDGKGVDuzi7ffp_hMGyZdmyPOmm9h+=Q6YmQ@mail.gmail.com>
Message-ID: <CAFEqCdze1o0_A3FmTzzOj_v8o=pTmCfgcgsJqrRgAvRXTq87DQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130916/c23313d5/attachment.pl>

From pharriso at uwaterloo.ca  Mon Sep 16 20:53:04 2013
From: pharriso at uwaterloo.ca (Phil H)
Date: Mon, 16 Sep 2013 11:53:04 -0700 (PDT)
Subject: [R-sig-Geo] adehabitatHR kernalBB batch processing
In-Reply-To: <CAAupi12eveef5tXG3_HCy-DPeFPEqjRptNHuAE3twX49S4Z9Xg@mail.gmail.com>
References: <20130321154559.10262297vrmgbatc@www.nexusmail.uwaterloo.ca>
	<1374280106183-7584205.post@n2.nabble.com>
	<CAHT1vpi+iZ_T9UU6zTeuUM+4=ELVU5r3hVyUAjoP_pNrU9NdTA@mail.gmail.com>
	<CAAupi12eveef5tXG3_HCy-DPeFPEqjRptNHuAE3twX49S4Z9Xg@mail.gmail.com>
Message-ID: <1379357584258-7584640.post@n2.nabble.com>

Hi,

#I find that the code above does work ok to pull out individual liker
values...

sig255 <- liker(ltraj, sig2 = 255, rangesig1 = c(0, 1000))
tataall <- lapply(seq_along(ltraj), function(x) kernelbb(ltraj[x],
sig1=sig255[[x]]$sig1, sig2=sig255[[x]]$sig2, grid=100, byburst=T)) 

#however you do need to recast is back to the estUDm format with

class(tataall) <- "estUDm"


#plus you need to rename the stuff again I believe before you can run the
getverticesHR function
names(tataall)<-id(ltraj)




--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/adehabitatHR-kernalBB-batch-processing-tp7583119p7584640.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From galuardi at mit.edu  Mon Sep 16 22:21:24 2013
From: galuardi at mit.edu (Ben)
Date: Mon, 16 Sep 2013 16:21:24 -0400
Subject: [R-sig-Geo] KernelUD calculation - coordinates type /
 transformation from lat/long
In-Reply-To: <CADQCJLBi-ZmqcZER=T=4yyvsb2vZYRpuxz0N1e0rvvG67NfZmQ@mail.gmail.com>
References: <CADQCJLBi-ZmqcZER=T=4yyvsb2vZYRpuxz0N1e0rvvG67NfZmQ@mail.gmail.com>
Message-ID: <52376844.2030108@mit.edu>

Hi Zuzana,

try this:
read in your data as 'dat'

Karea_xyUTM<- kernel.area(dat, id=rep('1', nrow(dat)))

20 0.001132550
25 0.001470329
30 0.001847845
35 0.002265101
40 0.002722095
45 0.003238697
50 0.003834776
55 0.004510333
60 0.005285235
65 0.006139616
70 0.007073473
75 0.008146416
80 0.009358443
85 0.010769164
90 0.012656748
95 0.015617275


# then
npoints = nrow(dat)
# convert to SpatialPoints
dat = SpatialPoints(dat, proj4string=CRS("+proj=longlat +datum=WGS84"))

#convert to UTM, be sure to include the zone. very important. This may 
be worng for several of your points since the area is so large.
datUTM<- spTransform(dat, CRS("+proj=utm +zone=24 +ellps=WGS84 
+datum=WGS84 +units=m +no_defs"))

# do the area calculation using the new coordinates only. Be sure to 
include names as a character. Leave out the 'h=' argument. That is where 
your error was occurring.
Karea_xyUTM<- kernel.area(as.data.frame(datUTM), id=rep('1', npoints), 
grid=500, unin ="m", unout = "km2")

20  135351.2
25  175756.6
30  219788.8
35  268222.6
40  322081.0
45  382727.9
50  452100.7
55  532989.0
60  625501.5
65  727065.3
70  840175.7
75  967684.5
80 1111777.1
85 1282512.1
90 1506315.1
95 1861067.6

This website is helpful

http://r.789695.n4.nabble.com/Converiting-longitude-latitude-to-utm-td4632377.html

Cheers,

Ben



On 9/13/2013 10:58 AM, zuzana zajkova wrote:
> Hi,
>
> I would like to calculate kernel areas using kernel.area  function from
> adehabitat package.
>
> My original coordintes are in latidude/longitude. I suppose that as an
> input for the function the coordinates should be in other fomat - I assume
> it is UTM coordinates (seeing the example in help, I haven't found more
> information about it...). Therefore I converted the lat/long coordinates
> and calculated the area for various kernels. The problem is that it gives
> me the same area for all levels...
>
> ## sample of my data
>
>> dput(xy)structure(list(long = c(-32.73, -32.12, -31.39, -31.02, -32.16,
> -32.17, -32.06, -32.32, -32.58, -33.22, -32.85, -33.36, -33.37,
> -33.5, -34.76, -35.51, -34.39, -33.27, -32.65, -32.66, -34.41,
> -35.79, -34.29, -35.04, -34.67, -33.92, -34.54, -35.79, -34.66,
> -34.66, -35.91, -35.78, -38.15, -38.15, -36.89, -35.76, -35.75,
> -35.75, -35.62, -37.73, -36.72, -35.84, -36.71, -37.82, -37.06,
> -36.05, -36.91, -37.65, -37.51, -37.87, -37.36, -36.97, -38.08,
> -38.07, -37.05, -35.91, -35.14, -36.5, -36.48, -36.59, -36.82,
> -37.55, -36.16, -36.39, -37.49, -35.35, -35.83, -36.93, -36.66,
> -36.64, -36.49, -36.47, -36.45, -36.42, -36.27, -34.75, -34.85,
> -35.08, -33.8, -35.28, -35.25, -33.73, -33.7, -34.93, -35.28,
> -34, -33.6, -33.57, -33.55, -35.89, -35.99, -36.09, -36.56, -36.54,
> -37.13, -38.11, -39.2, -38.93, -38.53, -37.62, -37.35, -37.07,
> -36.54, -36.89, -36.74, -37.43, -37.78, -36, -36.1, -35.7, -35.93,
> -37.9, -37.5, -35.85, -37.07, -38.8, -38.77, -38.62, -37.72,
> -38.82, -38.67, -36.65, -36.37, -35.6, -35.7, -35.43, -35.66,
> -36.38, -36.86, -36.84, -34.95, -34.92, -36.65, -36.63, -36.24,
> -36.34, -34.95, -35.06, -36.16, -36.52, -36.01, -35.86, -35.47,
> -35.21, -34.94, -35.8, -34.54, -34.78, -36.26, -35, -34.74, -35.1,
> -34.72, -35.33, -35.32, -35.44, -35.05, -34.67, -35.16, -35.03,
> -32.77, -33.02, -31.76, -32.01, -34.38, -34.5, -33.25, -32.37,
> -31.37, -31.24, -32.12, -33.12, -33.12, -33.12, -33.62, -32.13,
> -31.5, -31.88, -31.01, -30.89, -30.4, -30.53, -31.54, -28.66,
> -29.01, -28.87, -29.35, -29.33, -29.31, -30.16, -30.64, -29.74,
> -29.47, -29.95, -29.92, -29.53, -29.88, -30.98, -30.58, -31.18
> ), complat = c(23.04, 20.44, 20.95, 21.12, 18.51, 16.92, 17.13,
> 16.98, 16.83, 17.73, 18.6, 19.77, 20.26, 20.43, 18.35, 17.56,
> 20.29, 20.45, 19.38, 19.86, 17.24, 16.8, 20.36, 22.54, 23.78,
> 23.64, 21.56, 21.99, 24.82, 25.71, 24.02, 22.57, 19.42, 17.01,
> 18.64, 18.82, 17.01, 16.92, 17.11, 18.97, 22.57, 22.72, 20.29,
> 20.46, 22.91, 22.31, 19.92, 19.84, 21.03, 21.19, 22.1, 22.26,
> 20.44, 19.35, 20.29, 20.46, 19.89, 21.54, 22.89, 23.05, 22.51,
> 22.9, 25.31, 26.11, 25.39, 22.87, 19.99, 20.18, 22, 21.95, 22.13,
> 22.07, 22.02, 21.98, 22.16, 21.2, 19.04, 19.01, 20.85, 23.06,
> 24.33, 23.43, 21.62, 22.48, 23.55, 22.21, 21.06, 21.48, 21.46,
> 22.99, 25.3, 25.48, 25.05, 24.62, 23.98, 24.39, 24.16, 23.31,
> 23.08, 22.86, 22.42, 22.42, 22.42, 23.08, 23.72, 17.87, 16.19,
> 18.6, 20.23, 20.48, 20.94, 19.12, 17.47, 18.68, 21.02, 20.59,
> 19.22, 19.48, 18.8, 16.65, 15.43, 17.92, 19.39, 19.89, 20.63,
> 21.13, 21.17, 20.75, 20.79, 21.3, 19.7, 17.8, 19.32, 21.27, 21.09,
> 20.43, 19.28, 17.59, 18.4, 19.7, 18.77, 18.58, 18.38, 18.45,
> 18.51, 16.76, 15.22, 13.08, 14.8, 18.08, 19.19, 18.49, 17.77,
> 16.5, 16.02, 15.82, 15.61, 15.41, 16.61, 17.52, 15.35, 11.89,
> 10.73, 8.28, 11.17, 13.99, 12.85, 12, 12.07, 11.2, 12.23, 12.31,
> 11.1, 11.18, 11.91, 14.56, 15.61, 14.76, 13.24, 12.34, 11.75,
> 10.81, 12.28, 13, 13.23, 13.99, 14.48, 14.96, 14.91, 13.55, 13.51,
> 14.79, 15.78, 14.71, 14.16, 14.38, 15.12, 14.32, 12.99, 11.64
> )), .Names = c("long", "complat"), row.names = c("48", "49",
> "50", "51", "52", "53", "54", "55", "56", "57", "58", "59", "60",
> "61", "62", "63", "64", "65", "66", "67", "68", "69", "70", "71",
> "72", "73", "74", "75", "76", "77", "78", "79", "80", "81", "82",
> "83", "84", "85", "86", "87", "88", "89", "90", "91", "92", "93",
> "94", "95", "96", "97", "98", "99", "100", "101", "102", "103",
> "104", "105", "106", "107", "108", "109", "110", "111", "112",
> "113", "114", "115", "116", "117", "118", "119", "120", "121",
> "122", "123", "124", "125", "126", "127", "128", "129", "130",
> "131", "132", "133", "134", "135", "136", "137", "138", "139",
> "140", "141", "142", "143", "144", "145", "146", "147", "148",
> "149", "150", "151", "152", "153", "154", "155", "156", "157",
> "158", "159", "160", "161", "162", "163", "164", "165", "166",
> "167", "168", "169", "170", "171", "172", "173", "174", "175",
> "176", "177", "178", "179", "180", "181", "182", "183", "184",
> "185", "186", "187", "188", "189", "190", "191", "192", "193",
> "194", "195", "196", "197", "198", "199", "200", "201", "202",
> "203", "204", "205", "206", "207", "208", "209", "210", "211",
> "212", "213", "214", "215", "216", "217", "218", "219", "220",
> "221", "222", "223", "224", "225", "226", "227", "228", "229",
> "230", "11310", "11410", "1154", "1161", "1171", "1181", "1191",
> "1201", "1211", "1221", "1231", "1241", "1251", "1261", "1271",
> "1281", "1291"), class = "data.frame")
>
>
>> head(xy)     long complat
> 48 -32.73   23.04
> 49 -32.12   20.44
> 50 -31.39   20.95
> 51 -31.02   21.12
> 52 -32.16   18.51
> 53 -32.17   16.92
>
>
> ## create a matrix
>
>
> xy<- cbind(xy$long, xy$complat)
>
>
> ## convert to UTM coordinates
>
>
> ## my data are widely spread over the central Atlantic
> ## Ocean, so I think it is not possible to define the "zone"
>
>
> ## needs to be as dataframe for kernelarea
>
>
> xyUTM<-as.data.frame(project(xy, "+proj=utm ellps=WGS84"))
>
>
> ## calculate kernelarea
> kernLevels <- seq(5,95, by = 5)
>
>
> Karea_xyUTM<- kernel.area(xyUTM,id=NULL, h=1.8, grid=500,
>                                  levels = kernLevels,
>                                  unin ="m",
>                                  unout = "km2")
>
>
> ## the results...
>
> Karea_xyUTM            1
> 5  4990969904
> 10 4990969904
> 15 4990969904
> 20 4990969904
> 25 4990969904
> 30 4990969904
> 35 4990969904
> 40 4990969904
> 45 4990969904
> 50 4990969904
> 55 4990969904
> 60 4990969904
> 65 4990969904
> 70 4990969904
> 75 4990969904
> 80 4990969904
> 85 4990969904
> 90 4990969904
> 95 4990969904
>
>
>
> I wuld appreciate a lot if anyone could check where the error is coming
> from.
> Thank you,
>
> Zuzana
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


-- 
==================================================
Benjamin Galuardi
-
PhD Student
NMFS-Seagrant Population Dynamics Fellow
SMAST, UMass Dartmouth
-
T: 978 283 0368


From Guillaume.Drolet at mrn.gouv.qc.ca  Mon Sep 16 22:58:38 2013
From: Guillaume.Drolet at mrn.gouv.qc.ca (Guillaume.Drolet at mrn.gouv.qc.ca)
Date: Mon, 16 Sep 2013 16:58:38 -0400
Subject: [R-sig-Geo] writeRaster to TIF changes raster maximum value
In-Reply-To: <CANtt_hyQE5Lyast2bGh7rrVYke-3q74Co-UrOsQfJ8K_fBD74Q@mail.gmail.com>
References: <52371F7D.3060606@mrn.gouv.qc.ca>
	<CANtt_hyQE5Lyast2bGh7rrVYke-3q74Co-UrOsQfJ8K_fBD74Q@mail.gmail.com>
Message-ID: <523770FE.3080704@mrn.gouv.qc.ca>

Dear Robert,

Here's a link to 2 images: the original raster (full) and the cropped
one (sub):

https://www.dropbox.com/sh/8zo8fo964kr6ttk/pH1JIpTZ1C

The original raster has Byte values, as you suspected. But I don't know
how to handle that so that it's not used as NA value. From what I read, 
NA values in the original raster should be 0, and minimum and maximum 
values should be 1 and 255, respectively.

Thanks for helping,

Guillaume

Le 2013-09-16 11:41, Robert J. Hijmans a ?crit :
> I suspect that the original file has Byte values and that 255 is used,
> perhaps erroneously, as NA. Can you give me access to the file?
> Thanks, Robert
>
> On Mon, Sep 16, 2013 at 8:10 AM,  <Guillaume.Drolet at mrn.gouv.qc.ca> wrote:
>  > Dear list members,
>  >
>  > I need your help trying to figure out why my raster's maximum value gets
>  > changed in the resulting TIF file from a call to the writeRaster
> function.
>  >
>  > I read here
>  >
> (http://r-sig-geo.2731867.n2.nabble.com/writeRaster-to-ascii-file-asc-td7584093.html#none)
>  >
>  > that this problem could be due to my version of GDAL (1.11dev released
>  > 2013/04/13). This is the GDAL version that is in my system's path. Don't
>  > know if this can help but when I load rgdal, I can read this:
>  >
>  > Loaded GDAL runtime: GDAL 1.9.2, released 2012/10/08
>  >
>  > Here are the details of my raster (myRaster) before calling writeRaster:
>  >
>  >   > raster(myRaster)
>  >
>  > class       : RasterLayer
>  > dimensions  : 7261, 7961, 57804821  (nrow, ncol, ncell)
>  > resolution  : 30, 30  (x, y)
>  > extent      : 457785, 696615, 5147085, 5364915  (xmin, xmax, ymin, ymax)
>  > coord. ref. : +proj=utm +zone=18 +datum=WGS84 +units=m +no_defs
>  > +ellps=WGS84 +towgs84=0,0,0
>  > data source : E:\temp\Fmask\Image\L71015027_02720000730_B10.tif
>  > names       : L71015027_02720000730_B10
>  > values      : 0, 255  (min, max)
>  >
>  >
>  > I crop "myRaster" using the crop function with a bounding box and then I
>  > save the cropped raster as a TIF with:
>  >
>  >   > writeRaster(rc, "myCroppedRaster.tif", datatype = "INT2S")
>  > rgdal: version: 0.8-11, (SVN revision 479M)
>  > Geospatial Data Abstraction Library extensions to R successfully loaded
>  > Loaded GDAL runtime: GDAL 1.9.2, released 2012/10/08
>  > Path to GDAL shared files:
>  > C:/Users/Utilisateur/Documents/R/win-library/3.0/rgdal/gdal
>  > GDAL does not use iconv for recoding strings.
>  > Loaded PROJ.4 runtime: Rel. 4.7.1, 23 September 2009, [PJ_VERSION: 470]
>  > Path to PROJ.4 shared files:
>  > C:/Users/Utilisateur/Documents/R/win-library/3.0/rgdal/proj
>  >
>  > class       : RasterLayer
>  > dimensions  : 3628, 3994, 14490232  (nrow, ncol, ncell)
>  > resolution  : 30, 30  (x, y)
>  > extent      : 457785, 577605, 5147085, 5255925  (xmin, xmax, ymin, ymax)
>  > coord. ref. : +proj=utm +zone=18 +datum=WGS84 +units=m +no_defs
>  > +ellps=WGS84 +towgs84=0,0,0
>  > data source : E:temp\myRaster.tif
>  > names       : myRaster
>  > values      : 0, 254  (min, max)
>  >
>  >
>  > As shown in the output from writeRaster, the maximum value in the output
>  > TIF file is now 254. I double-checked and
>  > there are pixels with value 255 in the cropped area of the original
>  > raster so the maximum value shouldn't be 254 but 255.
>  >
>  > Here's the output of my sessionInfo():
>  >
>  > R version 3.0.1 (2013-05-16)
>  > Platform: x86_64-w64-mingw32/x64 (64-bit)
>  >
>  > locale:
>  > [1] LC_COLLATE=French_Canada.1252  LC_CTYPE=French_Canada.1252
>  > LC_MONETARY=French_Canada.1252
>  > [4] LC_NUMERIC=C                   LC_TIME=French_Canada.1252
>  >
>  > attached base packages:
>  > [1] stats     graphics  grDevices utils     datasets  methods   base
>  >
>  > other attached packages:
>  > [1] rgdal_0.8-11  raster_2.1-49 sp_1.0-13
>  >
>  > loaded via a namespace (and not attached):
>  > [1] grid_3.0.1      lattice_0.20-15 tools_3.0.1
>  >
>  > I thank you in advance for any hint that could help me solve this
>  > problem.
>  >
>  > Guillaume
>  > --
>  > Guillaume Drolet ing.f M.Sc.
>  > Chercheur en t?l?d?tection et dynamique foresti?re
>  > Direction de la recherche foresti?re
>  > Minist?re des ressources naturelles du Qu?bec
>  > 2700, rue Einstein, C.RC.335
>  > Qu?bec (Qu?bec), Canada G1P 3W8
>  > T : +1 418 643 7994 # 6727
>  > F : +1 418 643 2165
>  > guillaume.drolet at mrn.gouv.qc.ca
>  > http://www.mrn.gouv.qc.ca/forets
>  >
>  > _______________________________________________
>  > R-sig-Geo mailing list
>  > R-sig-Geo at r-project.org
>  > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Guillaume Drolet ing.f M.Sc.
Chercheur en t?l?d?tection et dynamique foresti?re
Direction de la recherche foresti?re
Minist?re des ressources naturelles du Qu?bec
2700, rue Einstein, C.RC.335
Qu?bec (Qu?bec), Canada G1P 3W8
T : +1 418 643 7994 # 6727
F : +1 418 643 2165
guillaume.drolet at mrn.gouv.qc.ca
http://www.mrn.gouv.qc.ca/forets


From Scott.Waichler at pnnl.gov  Mon Sep 16 23:33:42 2013
From: Scott.Waichler at pnnl.gov (Waichler, Scott R)
Date: Mon, 16 Sep 2013 14:33:42 -0700
Subject: [R-sig-Geo] function to convert to/from U.S. State Plane
	Coordinates?
Message-ID: <A632B3F93D861843A3C966F3962C3F840148B1010A08@EMAIL05.pnl.gov>

Hi,  Does an R function exist to convert to and from the State Plane Coordinates system used in the U.S.?  My search with Rseek was fruitless.

Scott Waichler
Hydrology Group, Energy & Environment Directorate
Pacific Northwest National Laboratory
Richland, WA, USA
scott.waichler at pnnl.gov


From HodgessE at uhd.edu  Mon Sep 16 23:49:31 2013
From: HodgessE at uhd.edu (Hodgess, Erin)
Date: Mon, 16 Sep 2013 21:49:31 +0000
Subject: [R-sig-Geo] function to convert to/from U.S. State
	Plane	Coordinates?
In-Reply-To: <A632B3F93D861843A3C966F3962C3F840148B1010A08@EMAIL05.pnl.gov>
References: <A632B3F93D861843A3C966F3962C3F840148B1010A08@EMAIL05.pnl.gov>
Message-ID: <FF9DB805FC41CC4E95825A50F680630217A7C0C0@columbia.uhd.campus>

Could you mean spTransform from rgdal, please?

________________________________________
From: r-sig-geo-bounces at r-project.org [r-sig-geo-bounces at r-project.org] on behalf of Waichler, Scott R [Scott.Waichler at pnnl.gov]
Sent: Monday, September 16, 2013 4:33 PM
To: r-sig-geo at r-project.org
Subject: [R-sig-Geo] function to convert to/from U.S. State Plane       Coordinates?

Hi,  Does an R function exist to convert to and from the State Plane Coordinates system used in the U.S.?  My search with Rseek was fruitless.

Scott Waichler
Hydrology Group, Energy & Environment Directorate
Pacific Northwest National Laboratory
Richland, WA, USA
scott.waichler at pnnl.gov

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From Scott.Waichler at pnnl.gov  Tue Sep 17 01:09:21 2013
From: Scott.Waichler at pnnl.gov (Waichler, Scott R)
Date: Mon, 16 Sep 2013 16:09:21 -0700
Subject: [R-sig-Geo] function to convert to/from U.S. State
	Plane	Coordinates?
In-Reply-To: <FF9DB805FC41CC4E95825A50F680630217A7C0C0@columbia.uhd.campus>
References: <A632B3F93D861843A3C966F3962C3F840148B1010A08@EMAIL05.pnl.gov>
	<FF9DB805FC41CC4E95825A50F680630217A7C0C0@columbia.uhd.campus>
Message-ID: <A632B3F93D861843A3C966F3962C3F840148B1010A4C@EMAIL05.pnl.gov>

Erin, thanks, I'm getting closer.  Rgdal's projInfo() lists UTM, which I believe is closely related to the State Plane Coordinate system, but I still don't see a direct transformation to SPC in R.  --Scott Waichler


> Could you mean spTransform from rgdal, please?
> 
> ________________________________________
> From: r-sig-geo-bounces at r-project.org [r-sig-geo-bounces at r-project.org] on
> behalf of Waichler, Scott R [Scott.Waichler at pnnl.gov]
> Sent: Monday, September 16, 2013 4:33 PM
> To: r-sig-geo at r-project.org
> Subject: [R-sig-Geo] function to convert to/from U.S. State Plane
> Coordinates?
> 
> Hi,  Does an R function exist to convert to and from the State Plane
> Coordinates system used in the U.S.?  My search with Rseek was fruitless.


From rob.robinson at bto.org  Tue Sep 17 01:23:40 2013
From: rob.robinson at bto.org (Rob Robinson)
Date: Tue, 17 Sep 2013 00:23:40 +0100
Subject: [R-sig-Geo] function to convert to/from U.S. State Plane
	Coordinates?
In-Reply-To: <A632B3F93D861843A3C966F3962C3F840148B1010A4C@EMAIL05.pnl.gov>
References: <A632B3F93D861843A3C966F3962C3F840148B1010A08@EMAIL05.pnl.gov>
	<FF9DB805FC41CC4E95825A50F680630217A7C0C0@columbia.uhd.campus>
	<A632B3F93D861843A3C966F3962C3F840148B1010A4C@EMAIL05.pnl.gov>
Message-ID: <CAGcXcEbs-k=naoLrHb43-N59Y1uRwUfBaeJNL3v2+M1Qoit=0Q@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130917/ebaaee5e/attachment.pl>

From mdsumner at gmail.com  Tue Sep 17 01:25:44 2013
From: mdsumner at gmail.com (Michael Sumner)
Date: Tue, 17 Sep 2013 09:25:44 +1000
Subject: [R-sig-Geo] function to convert to/from U.S. State Plane
	Coordinates?
In-Reply-To: <A632B3F93D861843A3C966F3962C3F840148B1010A4C@EMAIL05.pnl.gov>
References: <A632B3F93D861843A3C966F3962C3F840148B1010A08@EMAIL05.pnl.gov>
	<FF9DB805FC41CC4E95825A50F680630217A7C0C0@columbia.uhd.campus>
	<A632B3F93D861843A3C966F3962C3F840148B1010A4C@EMAIL05.pnl.gov>
Message-ID: <CAAcGz9_nB0KmSsys53m8L5Bodna6fjLfdJN32wkKVEYX7GybBQ@mail.gmail.com>

State plane is either UTM or Lambert Conformal Conic ("+proj=lcc"),
but this is a *family* (of families) of projections, not a specific
coordinate system. You'll need to be more specific by finding from an
authority which actual "State Plane" projection you need.

http://en.wikipedia.org/wiki/State_Plane_Coordinate_System

spatialreference.org is a good place to look if you are lacking detail:

http://spatialreference.org/ref/?search=state+plane

Often there is metadata present in data files so if you have those it
might be worth describing them, and trying tools in rgdal to find this
out. An EPSG code likely to be the most concise identifier, but it
could be PROJ.4 or WKT or something else that your colleagues might
know.

Cheers, Mike.


On Tue, Sep 17, 2013 at 9:09 AM, Waichler, Scott R
<Scott.Waichler at pnnl.gov> wrote:
> Erin, thanks, I'm getting closer.  Rgdal's projInfo() lists UTM, which I believe is closely related to the State Plane Coordinate system, but I still don't see a direct transformation to SPC in R.  --Scott Waichler
>
>
>> Could you mean spTransform from rgdal, please?
>>
>> ________________________________________
>> From: r-sig-geo-bounces at r-project.org [r-sig-geo-bounces at r-project.org] on
>> behalf of Waichler, Scott R [Scott.Waichler at pnnl.gov]
>> Sent: Monday, September 16, 2013 4:33 PM
>> To: r-sig-geo at r-project.org
>> Subject: [R-sig-Geo] function to convert to/from U.S. State Plane
>> Coordinates?
>>
>> Hi,  Does an R function exist to convert to and from the State Plane
>> Coordinates system used in the U.S.?  My search with Rseek was fruitless.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



-- 
Michael Sumner
Hobart, Australia
e-mail: mdsumner at gmail.com


From Scott.Waichler at pnnl.gov  Tue Sep 17 01:48:55 2013
From: Scott.Waichler at pnnl.gov (Waichler, Scott R)
Date: Mon, 16 Sep 2013 16:48:55 -0700
Subject: [R-sig-Geo] function to convert to/from U.S. State Plane
 Coordinates?
In-Reply-To: <CAGcXcEbs-k=naoLrHb43-N59Y1uRwUfBaeJNL3v2+M1Qoit=0Q@mail.gmail.com>
References: <A632B3F93D861843A3C966F3962C3F840148B1010A08@EMAIL05.pnl.gov>
	<FF9DB805FC41CC4E95825A50F680630217A7C0C0@columbia.uhd.campus>
	<A632B3F93D861843A3C966F3962C3F840148B1010A4C@EMAIL05.pnl.gov>
	<CAGcXcEbs-k=naoLrHb43-N59Y1uRwUfBaeJNL3v2+M1Qoit=0Q@mail.gmail.com>
Message-ID: <A632B3F93D861843A3C966F3962C3F840148B1010A5B@EMAIL05.pnl.gov>

Ok, now I know about the existence of EPSG codes, but apparently my rgdal installation can't find the list of them?  Do I need to find a certain file in my system's PROJ4 installation, then tell that to rgdal?

> library(maps)
> library(rgdal)
> pnw <- map('state', region = c('washington', 'oregon', 'idaho'), plot=F)
> epsg <- make_EPSG()
Error in make_EPSG() : Error opening epsg file
> pnw.spc <- spTransform(pnw, CRS=CRS("+init=epsg:102749"))
Error in spTransform(pnw, CRS = CRS("+init=epsg:102749")) :
  error in evaluating the argument 'CRSobj' in selecting a method for function 'spTransform': Error in CRS("+init=epsg:102749") : no system list, errno: 13

--Scott

> try following the instructions
> here?http://www.gpsmeter.com/index.php?page=faq14?to find an epsg code
> then something along the lines of
> spTransform(data, CRS=CRS("+init=epsg:xxx"))
> should work?
> 
> On 17 September 2013 00:09, Waichler, Scott R <Scott.Waichler at pnnl.gov>
> wrote:
> Erin, thanks, I'm getting closer. ?Rgdal's projInfo() lists UTM, which I
> believe is closely related to the State Plane Coordinate system, but I
> still don't see a direct transformation to SPC in R. ?--Scott Waichler
> 
> 
> > Could you mean spTransform from rgdal, please?
> >
> > Hi, ?Does an R function exist to convert to and from the State Plane
> > Coordinates system used in the U.S.? ?My search with Rseek was
> fruitless.


From HodgessE at uhd.edu  Tue Sep 17 02:02:39 2013
From: HodgessE at uhd.edu (Hodgess, Erin)
Date: Tue, 17 Sep 2013 00:02:39 +0000
Subject: [R-sig-Geo] function to convert to/from U.S. State Plane
 Coordinates?
In-Reply-To: <A632B3F93D861843A3C966F3962C3F840148B1010A5B@EMAIL05.pnl.gov>
References: <A632B3F93D861843A3C966F3962C3F840148B1010A08@EMAIL05.pnl.gov>
	<FF9DB805FC41CC4E95825A50F680630217A7C0C0@columbia.uhd.campus>
	<A632B3F93D861843A3C966F3962C3F840148B1010A4C@EMAIL05.pnl.gov>
	<CAGcXcEbs-k=naoLrHb43-N59Y1uRwUfBaeJNL3v2+M1Qoit=0Q@mail.gmail.com>
	<A632B3F93D861843A3C966F3962C3F840148B1010A5B@EMAIL05.pnl.gov>
Message-ID: <FF9DB805FC41CC4E95825A50F680630217A7C15D@columbia.uhd.campus>

Hi Scott:

Are you in Windows or a Linux type computer, please?



-----Original Message-----
From: r-sig-geo-bounces at r-project.org [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of Waichler, Scott R
Sent: Monday, September 16, 2013 6:49 PM
To: Rob Robinson
Cc: r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] function to convert to/from U.S. State Plane Coordinates?

Ok, now I know about the existence of EPSG codes, but apparently my rgdal installation can't find the list of them?  Do I need to find a certain file in my system's PROJ4 installation, then tell that to rgdal?

> library(maps)
> library(rgdal)
> pnw <- map('state', region = c('washington', 'oregon', 'idaho'), 
> plot=F) epsg <- make_EPSG()
Error in make_EPSG() : Error opening epsg file
> pnw.spc <- spTransform(pnw, CRS=CRS("+init=epsg:102749"))
Error in spTransform(pnw, CRS = CRS("+init=epsg:102749")) :
  error in evaluating the argument 'CRSobj' in selecting a method for function 'spTransform': Error in CRS("+init=epsg:102749") : no system list, errno: 13

--Scott

> try following the instructions
> here?http://www.gpsmeter.com/index.php?page=faq14?to find an epsg code 
> then something along the lines of spTransform(data, 
> CRS=CRS("+init=epsg:xxx")) should work?
> 
> On 17 September 2013 00:09, Waichler, Scott R 
> <Scott.Waichler at pnnl.gov>
> wrote:
> Erin, thanks, I'm getting closer. ?Rgdal's projInfo() lists UTM, which 
> I believe is closely related to the State Plane Coordinate system, but 
> I still don't see a direct transformation to SPC in R. ?--Scott 
> Waichler
> 
> 
> > Could you mean spTransform from rgdal, please?
> >
> > Hi, ?Does an R function exist to convert to and from the State Plane 
> > Coordinates system used in the U.S.? ?My search with Rseek was
> fruitless.

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From Scott.Waichler at pnnl.gov  Tue Sep 17 02:09:30 2013
From: Scott.Waichler at pnnl.gov (Waichler, Scott R)
Date: Mon, 16 Sep 2013 17:09:30 -0700
Subject: [R-sig-Geo] function to convert to/from U.S. State Plane
 Coordinates?
In-Reply-To: <FF9DB805FC41CC4E95825A50F680630217A7C15D@columbia.uhd.campus>
References: <A632B3F93D861843A3C966F3962C3F840148B1010A08@EMAIL05.pnl.gov>
	<FF9DB805FC41CC4E95825A50F680630217A7C0C0@columbia.uhd.campus>
	<A632B3F93D861843A3C966F3962C3F840148B1010A4C@EMAIL05.pnl.gov>
	<CAGcXcEbs-k=naoLrHb43-N59Y1uRwUfBaeJNL3v2+M1Qoit=0Q@mail.gmail.com>
	<A632B3F93D861843A3C966F3962C3F840148B1010A5B@EMAIL05.pnl.gov>
	<FF9DB805FC41CC4E95825A50F680630217A7C15D@columbia.uhd.campus>
Message-ID: <A632B3F93D861843A3C966F3962C3F840148B1010A5D@EMAIL05.pnl.gov>

I am working in Linux.  

I clicked on the ESRI:102749 option on the spatialreference.org website that Rob referred to, and got a spec that looks like it should work inside CRS(), but something seems to be amiss.

> library(rgdal)
> pnw.spc <- spTransform(pnw, CRS = CRS("+proj=lcc +lat_1=45.83333333333334 +lat_2=47.33333333333334 +lat_0=45.33333333333334 +lon_0=-120.5 +x_0=500000.0000000002 +y_0=0 +ellps=GRS80 +datum=NAD83 +to_meter=0.3048006096012192 +no_defs"))
Error in spTransform(pnw, CRS = CRS("+proj=lcc +lat_1=45.83333333333334 +lat_2=47.33333333333334 +lat_0=45.33333333333334 +lon_0=-120.5 +x_0=500000.0000000002 +y_0=0 +ellps=GRS80 +datum=NAD83 +to_meter=0.3048006096012192 +no_defs")) :
  load package rgdal for spTransform methods

> 
> Are you in Windows or a Linux type computer, please?
> 
> 
> 
> -----Original Message-----
> From: r-sig-geo-bounces at r-project.org [mailto:r-sig-geo-bounces at r-
> project.org] On Behalf Of Waichler, Scott R
> Sent: Monday, September 16, 2013 6:49 PM
> To: Rob Robinson
> Cc: r-sig-geo at r-project.org
> Subject: Re: [R-sig-Geo] function to convert to/from U.S. State Plane
> Coordinates?
> 
> Ok, now I know about the existence of EPSG codes, but apparently my rgdal
> installation can't find the list of them?  Do I need to find a certain
> file in my system's PROJ4 installation, then tell that to rgdal?
> 
> > library(maps)
> > library(rgdal)
> > pnw <- map('state', region = c('washington', 'oregon', 'idaho'),
> > plot=F) epsg <- make_EPSG()
> Error in make_EPSG() : Error opening epsg file
> > pnw.spc <- spTransform(pnw, CRS=CRS("+init=epsg:102749"))
> Error in spTransform(pnw, CRS = CRS("+init=epsg:102749")) :
>   error in evaluating the argument 'CRSobj' in selecting a method for
> function 'spTransform': Error in CRS("+init=epsg:102749") : no system
> list, errno: 13
> 
> --Scott
> 
> > try following the instructions
> > here?http://www.gpsmeter.com/index.php?page=faq14?to find an epsg code
> > then something along the lines of spTransform(data,
> > CRS=CRS("+init=epsg:xxx")) should work?
> >
> > On 17 September 2013 00:09, Waichler, Scott R
> > <Scott.Waichler at pnnl.gov>
> > wrote:
> > Erin, thanks, I'm getting closer. ?Rgdal's projInfo() lists UTM, which
> > I believe is closely related to the State Plane Coordinate system, but
> > I still don't see a direct transformation to SPC in R. ?--Scott
> > Waichler
> >
> >
> > > Could you mean spTransform from rgdal, please?
> > >
> > > Hi, ?Does an R function exist to convert to and from the State Plane
> > > Coordinates system used in the U.S.? ?My search with Rseek was
> > fruitless.
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From HodgessE at uhd.edu  Tue Sep 17 02:11:36 2013
From: HodgessE at uhd.edu (Hodgess, Erin)
Date: Tue, 17 Sep 2013 00:11:36 +0000
Subject: [R-sig-Geo] function to convert to/from U.S. State Plane
 Coordinates?
In-Reply-To: <A632B3F93D861843A3C966F3962C3F840148B1010A5D@EMAIL05.pnl.gov>
References: <A632B3F93D861843A3C966F3962C3F840148B1010A08@EMAIL05.pnl.gov>
	<FF9DB805FC41CC4E95825A50F680630217A7C0C0@columbia.uhd.campus>
	<A632B3F93D861843A3C966F3962C3F840148B1010A4C@EMAIL05.pnl.gov>
	<CAGcXcEbs-k=naoLrHb43-N59Y1uRwUfBaeJNL3v2+M1Qoit=0Q@mail.gmail.com>
	<A632B3F93D861843A3C966F3962C3F840148B1010A5B@EMAIL05.pnl.gov>
	<FF9DB805FC41CC4E95825A50F680630217A7C15D@columbia.uhd.campus>
	<A632B3F93D861843A3C966F3962C3F840148B1010A5D@EMAIL05.pnl.gov>
Message-ID: <FF9DB805FC41CC4E95825A50F680630217A7D186@columbia.uhd.campus>

I think that you need to download some proj4 stuff.  If you're on Ubuntu, go to the Ubuntu package search page and you'll find it.

Also, what is the str(pnw.spc) please?

Thanks,
Erin


-----Original Message-----
From: Waichler, Scott R [mailto:Scott.Waichler at pnnl.gov] 
Sent: Monday, September 16, 2013 7:10 PM
To: Hodgess, Erin; Rob Robinson
Cc: r-sig-geo at r-project.org
Subject: RE: [R-sig-Geo] function to convert to/from U.S. State Plane Coordinates?

I am working in Linux.  

I clicked on the ESRI:102749 option on the spatialreference.org website that Rob referred to, and got a spec that looks like it should work inside CRS(), but something seems to be amiss.

> library(rgdal)
> pnw.spc <- spTransform(pnw, CRS = CRS("+proj=lcc 
> +lat_1=45.83333333333334 +lat_2=47.33333333333334 
> +lat_0=45.33333333333334 +lon_0=-120.5 +x_0=500000.0000000002 +y_0=0 
> +ellps=GRS80 +datum=NAD83 +to_meter=0.3048006096012192 +no_defs"))
Error in spTransform(pnw, CRS = CRS("+proj=lcc +lat_1=45.83333333333334 +lat_2=47.33333333333334 +lat_0=45.33333333333334 +lon_0=-120.5 +x_0=500000.0000000002 +y_0=0 +ellps=GRS80 +datum=NAD83 +to_meter=0.3048006096012192 +no_defs")) :
  load package rgdal for spTransform methods

> 
> Are you in Windows or a Linux type computer, please?
> 
> 
> 
> -----Original Message-----
> From: r-sig-geo-bounces at r-project.org [mailto:r-sig-geo-bounces at r- 
> project.org] On Behalf Of Waichler, Scott R
> Sent: Monday, September 16, 2013 6:49 PM
> To: Rob Robinson
> Cc: r-sig-geo at r-project.org
> Subject: Re: [R-sig-Geo] function to convert to/from U.S. State Plane 
> Coordinates?
> 
> Ok, now I know about the existence of EPSG codes, but apparently my 
> rgdal installation can't find the list of them?  Do I need to find a 
> certain file in my system's PROJ4 installation, then tell that to rgdal?
> 
> > library(maps)
> > library(rgdal)
> > pnw <- map('state', region = c('washington', 'oregon', 'idaho'),
> > plot=F) epsg <- make_EPSG()
> Error in make_EPSG() : Error opening epsg file
> > pnw.spc <- spTransform(pnw, CRS=CRS("+init=epsg:102749"))
> Error in spTransform(pnw, CRS = CRS("+init=epsg:102749")) :
>   error in evaluating the argument 'CRSobj' in selecting a method for 
> function 'spTransform': Error in CRS("+init=epsg:102749") : no system 
> list, errno: 13
> 
> --Scott
> 
> > try following the instructions
> > here?http://www.gpsmeter.com/index.php?page=faq14?to find an epsg 
> > code then something along the lines of spTransform(data,
> > CRS=CRS("+init=epsg:xxx")) should work?
> >
> > On 17 September 2013 00:09, Waichler, Scott R 
> > <Scott.Waichler at pnnl.gov>
> > wrote:
> > Erin, thanks, I'm getting closer. ?Rgdal's projInfo() lists UTM, 
> > which I believe is closely related to the State Plane Coordinate 
> > system, but I still don't see a direct transformation to SPC in R. ?
> > --Scott Waichler
> >
> >
> > > Could you mean spTransform from rgdal, please?
> > >
> > > Hi, ?Does an R function exist to convert to and from the State 
> > > Plane Coordinates system used in the U.S.? ?My search with Rseek 
> > > was
> > fruitless.
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From HodgessE at uhd.edu  Tue Sep 17 02:12:58 2013
From: HodgessE at uhd.edu (Hodgess, Erin)
Date: Tue, 17 Sep 2013 00:12:58 +0000
Subject: [R-sig-Geo] function to convert to/from U.S. State Plane
 Coordinates?
In-Reply-To: <FF9DB805FC41CC4E95825A50F680630217A7D186@columbia.uhd.campus>
References: <A632B3F93D861843A3C966F3962C3F840148B1010A08@EMAIL05.pnl.gov>
	<FF9DB805FC41CC4E95825A50F680630217A7C0C0@columbia.uhd.campus>
	<A632B3F93D861843A3C966F3962C3F840148B1010A4C@EMAIL05.pnl.gov>
	<CAGcXcEbs-k=naoLrHb43-N59Y1uRwUfBaeJNL3v2+M1Qoit=0Q@mail.gmail.com>
	<A632B3F93D861843A3C966F3962C3F840148B1010A5B@EMAIL05.pnl.gov>
	<FF9DB805FC41CC4E95825A50F680630217A7C15D@columbia.uhd.campus>
	<A632B3F93D861843A3C966F3962C3F840148B1010A5D@EMAIL05.pnl.gov>
	<FF9DB805FC41CC4E95825A50F680630217A7D186@columbia.uhd.campus>
Message-ID: <FF9DB805FC41CC4E95825A50F680630217A7D198@columbia.uhd.campus>

Whoops...I meant pnw


-----Original Message-----
From: r-sig-geo-bounces at r-project.org [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of Hodgess, Erin
Sent: Monday, September 16, 2013 7:12 PM
To: Waichler, Scott R; Rob Robinson
Cc: r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] function to convert to/from U.S. State Plane Coordinates?

I think that you need to download some proj4 stuff.  If you're on Ubuntu, go to the Ubuntu package search page and you'll find it.

Also, what is the str(pnw.spc) please?

Thanks,
Erin


-----Original Message-----
From: Waichler, Scott R [mailto:Scott.Waichler at pnnl.gov]
Sent: Monday, September 16, 2013 7:10 PM
To: Hodgess, Erin; Rob Robinson
Cc: r-sig-geo at r-project.org
Subject: RE: [R-sig-Geo] function to convert to/from U.S. State Plane Coordinates?

I am working in Linux.  

I clicked on the ESRI:102749 option on the spatialreference.org website that Rob referred to, and got a spec that looks like it should work inside CRS(), but something seems to be amiss.

> library(rgdal)
> pnw.spc <- spTransform(pnw, CRS = CRS("+proj=lcc
> +lat_1=45.83333333333334 +lat_2=47.33333333333334
> +lat_0=45.33333333333334 +lon_0=-120.5 +x_0=500000.0000000002 +y_0=0
> +ellps=GRS80 +datum=NAD83 +to_meter=0.3048006096012192 +no_defs"))
Error in spTransform(pnw, CRS = CRS("+proj=lcc +lat_1=45.83333333333334 +lat_2=47.33333333333334 +lat_0=45.33333333333334 +lon_0=-120.5 +x_0=500000.0000000002 +y_0=0 +ellps=GRS80 +datum=NAD83 +to_meter=0.3048006096012192 +no_defs")) :
  load package rgdal for spTransform methods

> 
> Are you in Windows or a Linux type computer, please?
> 
> 
> 
> -----Original Message-----
> From: r-sig-geo-bounces at r-project.org [mailto:r-sig-geo-bounces at r- 
> project.org] On Behalf Of Waichler, Scott R
> Sent: Monday, September 16, 2013 6:49 PM
> To: Rob Robinson
> Cc: r-sig-geo at r-project.org
> Subject: Re: [R-sig-Geo] function to convert to/from U.S. State Plane 
> Coordinates?
> 
> Ok, now I know about the existence of EPSG codes, but apparently my 
> rgdal installation can't find the list of them?  Do I need to find a 
> certain file in my system's PROJ4 installation, then tell that to rgdal?
> 
> > library(maps)
> > library(rgdal)
> > pnw <- map('state', region = c('washington', 'oregon', 'idaho'),
> > plot=F) epsg <- make_EPSG()
> Error in make_EPSG() : Error opening epsg file
> > pnw.spc <- spTransform(pnw, CRS=CRS("+init=epsg:102749"))
> Error in spTransform(pnw, CRS = CRS("+init=epsg:102749")) :
>   error in evaluating the argument 'CRSobj' in selecting a method for 
> function 'spTransform': Error in CRS("+init=epsg:102749") : no system 
> list, errno: 13
> 
> --Scott
> 
> > try following the instructions
> > here?http://www.gpsmeter.com/index.php?page=faq14?to find an epsg 
> > code then something along the lines of spTransform(data,
> > CRS=CRS("+init=epsg:xxx")) should work?
> >
> > On 17 September 2013 00:09, Waichler, Scott R 
> > <Scott.Waichler at pnnl.gov>
> > wrote:
> > Erin, thanks, I'm getting closer. ?Rgdal's projInfo() lists UTM, 
> > which I believe is closely related to the State Plane Coordinate 
> > system, but I still don't see a direct transformation to SPC in R.
> > --Scott Waichler
> >
> >
> > > Could you mean spTransform from rgdal, please?
> > >
> > > Hi, ?Does an R function exist to convert to and from the State 
> > > Plane Coordinates system used in the U.S.? ?My search with Rseek 
> > > was
> > fruitless.
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From Scott.Waichler at pnnl.gov  Tue Sep 17 02:18:40 2013
From: Scott.Waichler at pnnl.gov (Waichler, Scott R)
Date: Mon, 16 Sep 2013 17:18:40 -0700
Subject: [R-sig-Geo] function to convert to/from U.S. State Plane
 Coordinates?
In-Reply-To: <FF9DB805FC41CC4E95825A50F680630217A7D186@columbia.uhd.campus>
References: <A632B3F93D861843A3C966F3962C3F840148B1010A08@EMAIL05.pnl.gov>
	<FF9DB805FC41CC4E95825A50F680630217A7C0C0@columbia.uhd.campus>
	<A632B3F93D861843A3C966F3962C3F840148B1010A4C@EMAIL05.pnl.gov>
	<CAGcXcEbs-k=naoLrHb43-N59Y1uRwUfBaeJNL3v2+M1Qoit=0Q@mail.gmail.com>
	<A632B3F93D861843A3C966F3962C3F840148B1010A5B@EMAIL05.pnl.gov>
	<FF9DB805FC41CC4E95825A50F680630217A7C15D@columbia.uhd.campus>
	<A632B3F93D861843A3C966F3962C3F840148B1010A5D@EMAIL05.pnl.gov>
	<FF9DB805FC41CC4E95825A50F680630217A7D186@columbia.uhd.campus>
Message-ID: <A632B3F93D861843A3C966F3962C3F840148B1010A5F@EMAIL05.pnl.gov>

My system is Redhat, RHEL5.  

> str(pnw)
List of 4
 $ x    : num [1:893] -117 -117 -117 -117 -117 ...
 $ y    : num [1:893] 46 46 45.9 45.9 45.9 ...
 $ range: num [1:4] -125 -111 42 49
 $ names: chr [1:7] "idaho" "oregon" "washington:san juan island" "washington:lopez island" ...
 - attr(*, "class")= chr "map"

So, it sounds like there is extra proj4 stuff that I need to install beyond the base installation I already did, which also enabled installation of rgdal? 

Scott

> -----Original Message-----
> From: Hodgess, Erin [mailto:HodgessE at uhd.edu]
> Sent: Monday, September 16, 2013 5:12 PM
> To: Waichler, Scott R; Rob Robinson
> Cc: r-sig-geo at r-project.org
> Subject: RE: [R-sig-Geo] function to convert to/from U.S. State Plane
> Coordinates?
> 
> I think that you need to download some proj4 stuff.  If you're on Ubuntu,
> go to the Ubuntu package search page and you'll find it.
> 
> Also, what is the str(pnw.spc) please?
> 
> Thanks,
> Erin
> 
> 
> -----Original Message-----
> From: Waichler, Scott R [mailto:Scott.Waichler at pnnl.gov]
> Sent: Monday, September 16, 2013 7:10 PM
> To: Hodgess, Erin; Rob Robinson
> Cc: r-sig-geo at r-project.org
> Subject: RE: [R-sig-Geo] function to convert to/from U.S. State Plane
> Coordinates?
> 
> I am working in Linux.
> 
> I clicked on the ESRI:102749 option on the spatialreference.org website
> that Rob referred to, and got a spec that looks like it should work inside
> CRS(), but something seems to be amiss.
> 
> > library(rgdal)
> > pnw.spc <- spTransform(pnw, CRS = CRS("+proj=lcc
> > +lat_1=45.83333333333334 +lat_2=47.33333333333334
> > +lat_0=45.33333333333334 +lon_0=-120.5 +x_0=500000.0000000002 +y_0=0
> > +ellps=GRS80 +datum=NAD83 +to_meter=0.3048006096012192 +no_defs"))
> Error in spTransform(pnw, CRS = CRS("+proj=lcc +lat_1=45.83333333333334
> +lat_2=47.33333333333334 +lat_0=45.33333333333334 +lon_0=-120.5
> +x_0=500000.0000000002 +y_0=0 +ellps=GRS80 +datum=NAD83
> +to_meter=0.3048006096012192 +no_defs")) :
>   load package rgdal for spTransform methods
> 
> >
> > Are you in Windows or a Linux type computer, please?
> >
> >
> >
> > -----Original Message-----
> > From: r-sig-geo-bounces at r-project.org [mailto:r-sig-geo-bounces at r-
> > project.org] On Behalf Of Waichler, Scott R
> > Sent: Monday, September 16, 2013 6:49 PM
> > To: Rob Robinson
> > Cc: r-sig-geo at r-project.org
> > Subject: Re: [R-sig-Geo] function to convert to/from U.S. State Plane
> > Coordinates?
> >
> > Ok, now I know about the existence of EPSG codes, but apparently my
> > rgdal installation can't find the list of them?  Do I need to find a
> > certain file in my system's PROJ4 installation, then tell that to rgdal?
> >
> > > library(maps)
> > > library(rgdal)
> > > pnw <- map('state', region = c('washington', 'oregon', 'idaho'),
> > > plot=F) epsg <- make_EPSG()
> > Error in make_EPSG() : Error opening epsg file
> > > pnw.spc <- spTransform(pnw, CRS=CRS("+init=epsg:102749"))
> > Error in spTransform(pnw, CRS = CRS("+init=epsg:102749")) :
> >   error in evaluating the argument 'CRSobj' in selecting a method for
> > function 'spTransform': Error in CRS("+init=epsg:102749") : no system
> > list, errno: 13
> >
> > --Scott
> >
> > > try following the instructions
> > > here?http://www.gpsmeter.com/index.php?page=faq14?to find an epsg
> > > code then something along the lines of spTransform(data,
> > > CRS=CRS("+init=epsg:xxx")) should work?
> > >
> > > On 17 September 2013 00:09, Waichler, Scott R
> > > <Scott.Waichler at pnnl.gov>
> > > wrote:
> > > Erin, thanks, I'm getting closer. ?Rgdal's projInfo() lists UTM,
> > > which I believe is closely related to the State Plane Coordinate
> > > system, but I still don't see a direct transformation to SPC in R.
> > > --Scott Waichler
> > >
> > >
> > > > Could you mean spTransform from rgdal, please?
> > > >
> > > > Hi, ?Does an R function exist to convert to and from the State
> > > > Plane Coordinates system used in the U.S.? ?My search with Rseek
> > > > was
> > > fruitless.
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From HodgessE at uhd.edu  Tue Sep 17 02:26:49 2013
From: HodgessE at uhd.edu (Hodgess, Erin)
Date: Tue, 17 Sep 2013 00:26:49 +0000
Subject: [R-sig-Geo] function to convert to/from U.S. State Plane
 Coordinates?
In-Reply-To: <A632B3F93D861843A3C966F3962C3F840148B1010A5F@EMAIL05.pnl.gov>
References: <A632B3F93D861843A3C966F3962C3F840148B1010A08@EMAIL05.pnl.gov>
	<FF9DB805FC41CC4E95825A50F680630217A7C0C0@columbia.uhd.campus>
	<A632B3F93D861843A3C966F3962C3F840148B1010A4C@EMAIL05.pnl.gov>
	<CAGcXcEbs-k=naoLrHb43-N59Y1uRwUfBaeJNL3v2+M1Qoit=0Q@mail.gmail.com>
	<A632B3F93D861843A3C966F3962C3F840148B1010A5B@EMAIL05.pnl.gov>
	<FF9DB805FC41CC4E95825A50F680630217A7C15D@columbia.uhd.campus>
	<A632B3F93D861843A3C966F3962C3F840148B1010A5D@EMAIL05.pnl.gov>
	<FF9DB805FC41CC4E95825A50F680630217A7D186@columbia.uhd.campus>
	<A632B3F93D861843A3C966F3962C3F840148B1010A5F@EMAIL05.pnl.gov>
Message-ID: <FF9DB805FC41CC4E95825A50F680630217A7D1C0@columbia.uhd.campus>

Ok.  I think I see it now.

You need to have a spatial object rather than a list.  

So you might set up 

	pnw1 <- data.frame(x=pnw$x,y=pnw$y)
	coordinates(pwn1) <- ~x+y
Then you'll have a spatial object.  After that, put in your projection:
	proj4string(pnw1) <- CRS(xxxxx)
	pnw2 <- spTransform(pnw1,CRS(yyyy))




-----Original Message-----
From: Waichler, Scott R [mailto:Scott.Waichler at pnnl.gov] 
Sent: Monday, September 16, 2013 7:19 PM
To: Hodgess, Erin; Rob Robinson
Cc: r-sig-geo at r-project.org
Subject: RE: [R-sig-Geo] function to convert to/from U.S. State Plane Coordinates?

My system is Redhat, RHEL5.  

> str(pnw)
List of 4
 $ x    : num [1:893] -117 -117 -117 -117 -117 ...
 $ y    : num [1:893] 46 46 45.9 45.9 45.9 ...
 $ range: num [1:4] -125 -111 42 49
 $ names: chr [1:7] "idaho" "oregon" "washington:san juan island" "washington:lopez island" ...
 - attr(*, "class")= chr "map"

So, it sounds like there is extra proj4 stuff that I need to install beyond the base installation I already did, which also enabled installation of rgdal? 

Scott

> -----Original Message-----
> From: Hodgess, Erin [mailto:HodgessE at uhd.edu]
> Sent: Monday, September 16, 2013 5:12 PM
> To: Waichler, Scott R; Rob Robinson
> Cc: r-sig-geo at r-project.org
> Subject: RE: [R-sig-Geo] function to convert to/from U.S. State Plane 
> Coordinates?
> 
> I think that you need to download some proj4 stuff.  If you're on 
> Ubuntu, go to the Ubuntu package search page and you'll find it.
> 
> Also, what is the str(pnw.spc) please?
> 
> Thanks,
> Erin
> 
> 
> -----Original Message-----
> From: Waichler, Scott R [mailto:Scott.Waichler at pnnl.gov]
> Sent: Monday, September 16, 2013 7:10 PM
> To: Hodgess, Erin; Rob Robinson
> Cc: r-sig-geo at r-project.org
> Subject: RE: [R-sig-Geo] function to convert to/from U.S. State Plane 
> Coordinates?
> 
> I am working in Linux.
> 
> I clicked on the ESRI:102749 option on the spatialreference.org 
> website that Rob referred to, and got a spec that looks like it should 
> work inside CRS(), but something seems to be amiss.
> 
> > library(rgdal)
> > pnw.spc <- spTransform(pnw, CRS = CRS("+proj=lcc
> > +lat_1=45.83333333333334 +lat_2=47.33333333333334
> > +lat_0=45.33333333333334 +lon_0=-120.5 +x_0=500000.0000000002 +y_0=0
> > +ellps=GRS80 +datum=NAD83 +to_meter=0.3048006096012192 +no_defs"))
> Error in spTransform(pnw, CRS = CRS("+proj=lcc 
> +lat_1=45.83333333333334
> +lat_2=47.33333333333334 +lat_0=45.33333333333334 +lon_0=-120.5
> +x_0=500000.0000000002 +y_0=0 +ellps=GRS80 +datum=NAD83
> +to_meter=0.3048006096012192 +no_defs")) :
>   load package rgdal for spTransform methods
> 
> >
> > Are you in Windows or a Linux type computer, please?
> >
> >
> >
> > -----Original Message-----
> > From: r-sig-geo-bounces at r-project.org [mailto:r-sig-geo-bounces at r- 
> > project.org] On Behalf Of Waichler, Scott R
> > Sent: Monday, September 16, 2013 6:49 PM
> > To: Rob Robinson
> > Cc: r-sig-geo at r-project.org
> > Subject: Re: [R-sig-Geo] function to convert to/from U.S. State 
> > Plane Coordinates?
> >
> > Ok, now I know about the existence of EPSG codes, but apparently my 
> > rgdal installation can't find the list of them?  Do I need to find a 
> > certain file in my system's PROJ4 installation, then tell that to rgdal?
> >
> > > library(maps)
> > > library(rgdal)
> > > pnw <- map('state', region = c('washington', 'oregon', 'idaho'),
> > > plot=F) epsg <- make_EPSG()
> > Error in make_EPSG() : Error opening epsg file
> > > pnw.spc <- spTransform(pnw, CRS=CRS("+init=epsg:102749"))
> > Error in spTransform(pnw, CRS = CRS("+init=epsg:102749")) :
> >   error in evaluating the argument 'CRSobj' in selecting a method 
> > for function 'spTransform': Error in CRS("+init=epsg:102749") : no 
> > system list, errno: 13
> >
> > --Scott
> >
> > > try following the instructions
> > > here?http://www.gpsmeter.com/index.php?page=faq14?to find an epsg 
> > > code then something along the lines of spTransform(data,
> > > CRS=CRS("+init=epsg:xxx")) should work?
> > >
> > > On 17 September 2013 00:09, Waichler, Scott R 
> > > <Scott.Waichler at pnnl.gov>
> > > wrote:
> > > Erin, thanks, I'm getting closer. ?Rgdal's projInfo() lists UTM, 
> > > which I believe is closely related to the State Plane Coordinate 
> > > system, but I still don't see a direct transformation to SPC in R.
> > > --Scott Waichler
> > >
> > >
> > > > Could you mean spTransform from rgdal, please?
> > > >
> > > > Hi, ?Does an R function exist to convert to and from the State 
> > > > Plane Coordinates system used in the U.S.? ?My search with Rseek 
> > > > was
> > > fruitless.
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From vikasbhutani_in at yahoo.com  Tue Sep 17 06:49:37 2013
From: vikasbhutani_in at yahoo.com (vikas Bhutani)
Date: Mon, 16 Sep 2013 21:49:37 -0700 (PDT)
Subject: [R-sig-Geo] unsubscirbe me plz
Message-ID: <1379393377.53715.YahooMailNeo@web125804.mail.ne1.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130916/fab61d4f/attachment.pl>

From mdsumner at gmail.com  Tue Sep 17 07:20:33 2013
From: mdsumner at gmail.com (Michael Sumner)
Date: Tue, 17 Sep 2013 15:20:33 +1000
Subject: [R-sig-Geo] unsubscirbe me plz
In-Reply-To: <1379393377.53715.YahooMailNeo@web125804.mail.ne1.yahoo.com>
References: <1379393377.53715.YahooMailNeo@web125804.mail.ne1.yahoo.com>
Message-ID: <CAAcGz98=P5tNydsDkJiveinuz6Qbu-gOtOkpFyBjaFjUawiFUA@mail.gmail.com>

Unsubscirbe yrself plz:   https://stat.ethz.ch/mailman/listinfo/r-sig-geo

(This information is in every message to the list.)

Cheers, Mike.



On Tue, Sep 17, 2013 at 2:49 PM, vikas Bhutani
<vikasbhutani_in at yahoo.com> wrote:
>
>
> Thanks & Regards
> Vikas Bhutani
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



-- 
Michael Sumner
Hobart, Australia
e-mail: mdsumner at gmail.com


From r.hijmans at gmail.com  Tue Sep 17 07:25:53 2013
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Mon, 16 Sep 2013 22:25:53 -0700
Subject: [R-sig-Geo] writeRaster to TIF changes raster maximum value
In-Reply-To: <523770FE.3080704@mrn.gouv.qc.ca>
References: <52371F7D.3060606@mrn.gouv.qc.ca>
	<CANtt_hyQE5Lyast2bGh7rrVYke-3q74Co-UrOsQfJ8K_fBD74Q@mail.gmail.com>
	<523770FE.3080704@mrn.gouv.qc.ca>
Message-ID: <CANtt_hznMtBDLzky_qQfqxniAKdkvrbcOCFSanbs3LT4aJ=TcQ@mail.gmail.com>

Guillaume,

This indeed happens because of NA value handling problems.  The native
raster format uses 255 as the NA value for Byte files. That probably
needs to change. You write such a file because you crop a large area
and a temporary file is written. There are work arounds, see below,
but i will ponder changes to the package that will makes these
unnecessary.

The most direct way to avoid this is to do
library(raster)
r = raster('L71015027_02720000730_B10_full.tif')
e =extent( 457785, 577605, 5147085, 5255925)
x = crop(r, e, 'abc.tif', datatype='INT2S', overwrite=TRUE)


Alternatively,

y = crop(r, e)
NAvalue(x) = 0
y <- writeRaster(y, 'abcd.tif', datatype='INT2S', overwrite=TRUE)

Robert


On Mon, Sep 16, 2013 at 1:58 PM,  <Guillaume.Drolet at mrn.gouv.qc.ca> wrote:
> Dear Robert,
>
> Here's a link to 2 images: the original raster (full) and the cropped
> one (sub):
>
> https://www.dropbox.com/sh/8zo8fo964kr6ttk/pH1JIpTZ1C
>
> The original raster has Byte values, as you suspected. But I don't know
> how to handle that so that it's not used as NA value. From what I read,
> NA values in the original raster should be 0, and minimum and maximum
> values should be 1 and 255, respectively.
>
> Thanks for helping,
>
> Guillaume
>
> Le 2013-09-16 11:41, Robert J. Hijmans a ?crit :
>> I suspect that the original file has Byte values and that 255 is used,
>> perhaps erroneously, as NA. Can you give me access to the file?
>> Thanks, Robert
>>
>> On Mon, Sep 16, 2013 at 8:10 AM,  <Guillaume.Drolet at mrn.gouv.qc.ca> wrote:
>>  > Dear list members,
>>  >
>>  > I need your help trying to figure out why my raster's maximum value gets
>>  > changed in the resulting TIF file from a call to the writeRaster
>> function.
>>  >
>>  > I read here
>>  >
>> (http://r-sig-geo.2731867.n2.nabble.com/writeRaster-to-ascii-file-asc-td7584093.html#none)
>>  >
>>  > that this problem could be due to my version of GDAL (1.11dev released
>>  > 2013/04/13). This is the GDAL version that is in my system's path. Don't
>>  > know if this can help but when I load rgdal, I can read this:
>>  >
>>  > Loaded GDAL runtime: GDAL 1.9.2, released 2012/10/08
>>  >
>>  > Here are the details of my raster (myRaster) before calling writeRaster:
>>  >
>>  >   > raster(myRaster)
>>  >
>>  > class       : RasterLayer
>>  > dimensions  : 7261, 7961, 57804821  (nrow, ncol, ncell)
>>  > resolution  : 30, 30  (x, y)
>>  > extent      : 457785, 696615, 5147085, 5364915  (xmin, xmax, ymin, ymax)
>>  > coord. ref. : +proj=utm +zone=18 +datum=WGS84 +units=m +no_defs
>>  > +ellps=WGS84 +towgs84=0,0,0
>>  > data source : E:\temp\Fmask\Image\L71015027_02720000730_B10.tif
>>  > names       : L71015027_02720000730_B10
>>  > values      : 0, 255  (min, max)
>>  >
>>  >
>>  > I crop "myRaster" using the crop function with a bounding box and then I
>>  > save the cropped raster as a TIF with:
>>  >
>>  >   > writeRaster(rc, "myCroppedRaster.tif", datatype = "INT2S")
>>  > rgdal: version: 0.8-11, (SVN revision 479M)
>>  > Geospatial Data Abstraction Library extensions to R successfully loaded
>>  > Loaded GDAL runtime: GDAL 1.9.2, released 2012/10/08
>>  > Path to GDAL shared files:
>>  > C:/Users/Utilisateur/Documents/R/win-library/3.0/rgdal/gdal
>>  > GDAL does not use iconv for recoding strings.
>>  > Loaded PROJ.4 runtime: Rel. 4.7.1, 23 September 2009, [PJ_VERSION: 470]
>>  > Path to PROJ.4 shared files:
>>  > C:/Users/Utilisateur/Documents/R/win-library/3.0/rgdal/proj
>>  >
>>  > class       : RasterLayer
>>  > dimensions  : 3628, 3994, 14490232  (nrow, ncol, ncell)
>>  > resolution  : 30, 30  (x, y)
>>  > extent      : 457785, 577605, 5147085, 5255925  (xmin, xmax, ymin, ymax)
>>  > coord. ref. : +proj=utm +zone=18 +datum=WGS84 +units=m +no_defs
>>  > +ellps=WGS84 +towgs84=0,0,0
>>  > data source : E:temp\myRaster.tif
>>  > names       : myRaster
>>  > values      : 0, 254  (min, max)
>>  >
>>  >
>>  > As shown in the output from writeRaster, the maximum value in the output
>>  > TIF file is now 254. I double-checked and
>>  > there are pixels with value 255 in the cropped area of the original
>>  > raster so the maximum value shouldn't be 254 but 255.
>>  >
>>  > Here's the output of my sessionInfo():
>>  >
>>  > R version 3.0.1 (2013-05-16)
>>  > Platform: x86_64-w64-mingw32/x64 (64-bit)
>>  >
>>  > locale:
>>  > [1] LC_COLLATE=French_Canada.1252  LC_CTYPE=French_Canada.1252
>>  > LC_MONETARY=French_Canada.1252
>>  > [4] LC_NUMERIC=C                   LC_TIME=French_Canada.1252
>>  >
>>  > attached base packages:
>>  > [1] stats     graphics  grDevices utils     datasets  methods   base
>>  >
>>  > other attached packages:
>>  > [1] rgdal_0.8-11  raster_2.1-49 sp_1.0-13
>>  >
>>  > loaded via a namespace (and not attached):
>>  > [1] grid_3.0.1      lattice_0.20-15 tools_3.0.1
>>  >
>>  > I thank you in advance for any hint that could help me solve this
>>  > problem.
>>  >
>>  > Guillaume
>>  > --
>>  > Guillaume Drolet ing.f M.Sc.
>>  > Chercheur en t?l?d?tection et dynamique foresti?re
>>  > Direction de la recherche foresti?re
>>  > Minist?re des ressources naturelles du Qu?bec
>>  > 2700, rue Einstein, C.RC.335
>>  > Qu?bec (Qu?bec), Canada G1P 3W8
>>  > T : +1 418 643 7994 # 6727
>>  > F : +1 418 643 2165
>>  > guillaume.drolet at mrn.gouv.qc.ca
>>  > http://www.mrn.gouv.qc.ca/forets
>>  >
>>  > _______________________________________________
>>  > R-sig-Geo mailing list
>>  > R-sig-Geo at r-project.org
>>  > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> --
> Guillaume Drolet ing.f M.Sc.
> Chercheur en t?l?d?tection et dynamique foresti?re
> Direction de la recherche foresti?re
> Minist?re des ressources naturelles du Qu?bec
> 2700, rue Einstein, C.RC.335
> Qu?bec (Qu?bec), Canada G1P 3W8
> T : +1 418 643 7994 # 6727
> F : +1 418 643 2165
> guillaume.drolet at mrn.gouv.qc.ca
> http://www.mrn.gouv.qc.ca/forets


From gab.cozzi at gmail.com  Tue Sep 17 08:02:13 2013
From: gab.cozzi at gmail.com (Gabriele Cozzi)
Date: Tue, 17 Sep 2013 08:02:13 +0200
Subject: [R-sig-Geo] problems to stack() rasters due to different pixel
 resolution and raster extent
In-Reply-To: <CANtt_hyd9LGmiqftUtXu_rrB=XOdSKDmn0y58ta9MEC-jyrRPQ@mail.gmail.com>
References: <CADr8yXDfcqXyOqgY_FAxFjLA8=uVgkpq5gYwzc6cHXtCCMzYBg@mail.gmail.com>
	<5231A688.8000309@gmail.com>
	<CADr8yXA7eDF+Sdg-pxxd+KB=4nWc9LB+p1pV+D_7rPpz_siokw@mail.gmail.com>
	<CANtt_hxst=8rmKpSoaMQj7w0d_TBMKyh2wwpb+640e1oCruUyw@mail.gmail.com>
	<CADr8yXDkd-6dL8iRM02JTArwkUp2KkPOygORih8Ta0YcBcwGxw@mail.gmail.com>
	<CANtt_hyd9LGmiqftUtXu_rrB=XOdSKDmn0y58ta9MEC-jyrRPQ@mail.gmail.com>
Message-ID: <CADr8yXDzRbqQFWvjXCsHQh-b+hPCqdg1XRexfeHui_JfkQg8bA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130917/eed2eb9c/attachment.pl>

From Roger.Bivand at nhh.no  Tue Sep 17 08:56:40 2013
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 17 Sep 2013 08:56:40 +0200
Subject: [R-sig-Geo] function to convert to/from U.S. State Plane
 Coordinates?
In-Reply-To: <A632B3F93D861843A3C966F3962C3F840148B1010A5F@EMAIL05.pnl.gov>
References: <A632B3F93D861843A3C966F3962C3F840148B1010A08@EMAIL05.pnl.gov>
	<FF9DB805FC41CC4E95825A50F680630217A7C0C0@columbia.uhd.campus>
	<A632B3F93D861843A3C966F3962C3F840148B1010A4C@EMAIL05.pnl.gov>
	<CAGcXcEbs-k=naoLrHb43-N59Y1uRwUfBaeJNL3v2+M1Qoit=0Q@mail.gmail.com>
	<A632B3F93D861843A3C966F3962C3F840148B1010A5B@EMAIL05.pnl.gov>
	<FF9DB805FC41CC4E95825A50F680630217A7C15D@columbia.uhd.campus>
	<A632B3F93D861843A3C966F3962C3F840148B1010A5D@EMAIL05.pnl.gov>
	<FF9DB805FC41CC4E95825A50F680630217A7D186@columbia.uhd.campus>
	<A632B3F93D861843A3C966F3962C3F840148B1010A5F@EMAIL05.pnl.gov>
Message-ID: <alpine.LRH.2.03.1309170839490.15494@reclus.nhh.no>

On Tue, 17 Sep 2013, Waichler, Scott R wrote:

> My system is Redhat, RHEL5.

The package does document all of these requirements:

file.show(system.file("README", package="rgdal"))

or:

https://r-forge.r-project.org/scm/viewvc.php/pkg/inst/README?view=markup&root=rgdal

or read the inst/README file from the source package tarball. Note that 
the Fedora/RHEL case is covered specifically.

Nothing about projections is ever simple, nobody should assume that it is. 
The assumption is very anachronistic, as clear standards have only been 
available recently (say < 20 years, even < 10 years for GNSS/GPS), and 
most maps are older; mapping agencies value continuity, and use their 
legacy definitions, which vary greatly from place to place, and are often 
not well defined.

Note also the link on the Spatial Task View to:

http://spatialreference.org/

as a resource for investigating which incantation may match your data. As 
has been mentioned, State Plane contains hundreds of candidate 
definitions, depending among other things on the part of the state 
concerned and the datum in use at the time the data were created. 
Searching this website for "Washington" - your location state - gives 18 
hits in EPSG, and only you can know which is appropriate.

Hope this clarifies,

Roger


>
>> str(pnw)
> List of 4
> $ x    : num [1:893] -117 -117 -117 -117 -117 ...
> $ y    : num [1:893] 46 46 45.9 45.9 45.9 ...
> $ range: num [1:4] -125 -111 42 49
> $ names: chr [1:7] "idaho" "oregon" "washington:san juan island" "washington:lopez island" ...
> - attr(*, "class")= chr "map"
>
> So, it sounds like there is extra proj4 stuff that I need to install beyond the base installation I already did, which also enabled installation of rgdal?
>
> Scott
>
>> -----Original Message-----
>> From: Hodgess, Erin [mailto:HodgessE at uhd.edu]
>> Sent: Monday, September 16, 2013 5:12 PM
>> To: Waichler, Scott R; Rob Robinson
>> Cc: r-sig-geo at r-project.org
>> Subject: RE: [R-sig-Geo] function to convert to/from U.S. State Plane
>> Coordinates?
>>
>> I think that you need to download some proj4 stuff.  If you're on Ubuntu,
>> go to the Ubuntu package search page and you'll find it.
>>
>> Also, what is the str(pnw.spc) please?
>>
>> Thanks,
>> Erin
>>
>>
>> -----Original Message-----
>> From: Waichler, Scott R [mailto:Scott.Waichler at pnnl.gov]
>> Sent: Monday, September 16, 2013 7:10 PM
>> To: Hodgess, Erin; Rob Robinson
>> Cc: r-sig-geo at r-project.org
>> Subject: RE: [R-sig-Geo] function to convert to/from U.S. State Plane
>> Coordinates?
>>
>> I am working in Linux.
>>
>> I clicked on the ESRI:102749 option on the spatialreference.org website
>> that Rob referred to, and got a spec that looks like it should work inside
>> CRS(), but something seems to be amiss.
>>
>>> library(rgdal)
>>> pnw.spc <- spTransform(pnw, CRS = CRS("+proj=lcc
>>> +lat_1=45.83333333333334 +lat_2=47.33333333333334
>>> +lat_0=45.33333333333334 +lon_0=-120.5 +x_0=500000.0000000002 +y_0=0
>>> +ellps=GRS80 +datum=NAD83 +to_meter=0.3048006096012192 +no_defs"))
>> Error in spTransform(pnw, CRS = CRS("+proj=lcc +lat_1=45.83333333333334
>> +lat_2=47.33333333333334 +lat_0=45.33333333333334 +lon_0=-120.5
>> +x_0=500000.0000000002 +y_0=0 +ellps=GRS80 +datum=NAD83
>> +to_meter=0.3048006096012192 +no_defs")) :
>>   load package rgdal for spTransform methods
>>
>>>
>>> Are you in Windows or a Linux type computer, please?
>>>
>>>
>>>
>>> -----Original Message-----
>>> From: r-sig-geo-bounces at r-project.org [mailto:r-sig-geo-bounces at r-
>>> project.org] On Behalf Of Waichler, Scott R
>>> Sent: Monday, September 16, 2013 6:49 PM
>>> To: Rob Robinson
>>> Cc: r-sig-geo at r-project.org
>>> Subject: Re: [R-sig-Geo] function to convert to/from U.S. State Plane
>>> Coordinates?
>>>
>>> Ok, now I know about the existence of EPSG codes, but apparently my
>>> rgdal installation can't find the list of them?  Do I need to find a
>>> certain file in my system's PROJ4 installation, then tell that to rgdal?
>>>
>>>> library(maps)
>>>> library(rgdal)
>>>> pnw <- map('state', region = c('washington', 'oregon', 'idaho'),
>>>> plot=F) epsg <- make_EPSG()
>>> Error in make_EPSG() : Error opening epsg file
>>>> pnw.spc <- spTransform(pnw, CRS=CRS("+init=epsg:102749"))
>>> Error in spTransform(pnw, CRS = CRS("+init=epsg:102749")) :
>>>   error in evaluating the argument 'CRSobj' in selecting a method for
>>> function 'spTransform': Error in CRS("+init=epsg:102749") : no system
>>> list, errno: 13
>>>
>>> --Scott
>>>
>>>> try following the instructions
>>>> here?http://www.gpsmeter.com/index.php?page=faq14?to find an epsg
>>>> code then something along the lines of spTransform(data,
>>>> CRS=CRS("+init=epsg:xxx")) should work?
>>>>
>>>> On 17 September 2013 00:09, Waichler, Scott R
>>>> <Scott.Waichler at pnnl.gov>
>>>> wrote:
>>>> Erin, thanks, I'm getting closer. ?Rgdal's projInfo() lists UTM,
>>>> which I believe is closely related to the State Plane Coordinate
>>>> system, but I still don't see a direct transformation to SPC in R.
>>>> --Scott Waichler
>>>>
>>>>
>>>>> Could you mean spTransform from rgdal, please?
>>>>>
>>>>> Hi, ?Does an R function exist to convert to and from the State
>>>>> Plane Coordinates system used in the U.S.? ?My search with Rseek
>>>>> was
>>>> fruitless.
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From caspar.hallmann at gmail.com  Tue Sep 17 11:36:13 2013
From: caspar.hallmann at gmail.com (Caspar Hallmann)
Date: Tue, 17 Sep 2013 11:36:13 +0200
Subject: [R-sig-Geo] Note on variogram fitting with polynomial degree
Message-ID: <CAFZw66HVNzbJZUVYwwGLpBbHzvd4a4J=JbB7wVDpkzqNL0B9nQ@mail.gmail.com>

Dear all,

I read in ASDAR: "Residual variograms are calculated by default when a
more complex model for the trend is used..."

However, I noticed that when using fit.variogram in gstat with an
additional option: degree=2, but keeping the formula as an intercept
only, does not account for the higher degree of complexity in the
model. I suspect this is not the intended behavior. To honour a
dependence structure (polyn degree) in my observations I need to state
the dependence explicitly in the formula.

Best regards,

Caspar

data(meuse)
coordinates(meuse) <- c("x", "y")
v<-variogram(log(zinc)~1,meuse)
print(v)
vs<-variogram(log(zinc)~1,meuse,degree=2)
print(vs)
vt<-variogram(log(zinc)~x*y+I(x^2)+I(y^2),meuse)
print(vt)

PS:
x86_64-w64-mingw32/x64 (64-bit)
R version 3.0.1 (2013-05-16)
gstat_1.0-16


From Rainer at krugs.de  Tue Sep 17 12:10:17 2013
From: Rainer at krugs.de (Rainer M Krug)
Date: Tue, 17 Sep 2013 12:10:17 +0200
Subject: [R-sig-Geo] Cryptic warning when reading raster which consists only
	of NULL
Message-ID: <m2ioxzn4hi.fsf@krugs.de>

Hi

When reading a raster from GRASS which consists only of NULL, a cryptic
warning is received:

,----
| Warning in lapply(lres, as.numeric) : NAs introduced by coercion
`----

This is caused by the line

,----
| lres <- lapply(lres, as.numeric)
`----

in the debug session below:

,----
| debug: con <- textConnection(tx)
| Browse[2]> 
| debug: res <- read.dcf(con)
| Browse[2]> 
| debug: close(con)
| Browse[2]> 
| debug: lres <- as.list(res)
| Browse[2]> 
| debug: names(lres) <- colnames(res)
| Browse[2]> 
| debug: lres <- lapply(lres, as.numeric)
| Browse[2]> 
| Warning in lapply(lres, as.numeric) : NAs introduced by coercion
| Warning in lapply(lres, as.numeric) : NAs introduced by coercion
| debug: if (!is.numeric(lres$min) || !is.finite(as.double(lres$min))) NODATA <- as.integer(999) else {
|     lres$min <- floor(as.double(lres$min))
|     NODATA <- floor(lres$min) - 1
| }
| Browse[2]> lres
| $min
| [1] NA
| 
| $max
| [1] NA
| 
| Browse[2]> tx
| [1] "min:NULL" "max:NULL"
| Browse[2]> 
`----

I would suggest to add thwe statements

,----
| if (lres[[1]]=="NULL") lrews[[1]] <- NA
| if (lres[[2]]=="NULL") lrews[[2]] <- NA
`----

before the line

,----
| lres <- lapply(lres, as.numeric)
`----

as this would replace the "NULL" with NA and not cause the error.

,----
| > sessionInfo()
| R version 3.0.1 (2013-05-16)
| Platform: x86_64-apple-darwin10.8.0 (64-bit)
| 
| locale:
| [1] C
| 
| attached base packages:
| [1] stats     graphics  grDevices utils     datasets  methods   base     
| 
| other attached packages:
|  [1] asmDrak_0.0-1        maptools_0.8-27      simecol_0.8-2       
|  [4] lattice_0.20-23      deSolve_1.10-7       prioritization_0.0-1
|  [7] seedGerm_0.0-1       seedDisp_0.4-13      Rcpp_0.10.4         
| [10] seedProd_0.0-1       fireSim_0.0-1        RSQLite_0.11.4      
| [13] DBI_0.2-7            spgrass6_0.8-3       XML_3.95-0.2        
| [16] sp_1.0-13            logger_0.0-1         devtools_1.3.99     
| 
| loaded via a namespace (and not attached):
|  [1] RCurl_1.95-4.1 compiler_3.0.1 digest_0.6.3   evaluate_0.4.7 foreign_0.8-53
|  [6] grid_3.0.1     httr_0.2       memoise_0.1    parallel_3.0.1 stringr_0.6.2 
| [11] tools_3.0.1    whisker_0.3-2 
| 
| > version
|                _                           
| platform       x86_64-apple-darwin10.8.0   
| arch           x86_64                      
| os             darwin10.8.0                
| system         x86_64, darwin10.8.0        
| status                                     
| major          3                           
| minor          0.1                         
| year           2013                        
| month          05                          
| day            16                          
| svn rev        62743                       
| language       R                           
| version.string R version 3.0.1 (2013-05-16)
| nickname       Good Sport      
`----

Thanks,

Rainer


-- 
Rainer M. Krug

email: RMKrug<at>gmail<dot>com
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 486 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130917/19ed9641/attachment.bin>

From edzer.pebesma at uni-muenster.de  Tue Sep 17 12:27:22 2013
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Tue, 17 Sep 2013 12:27:22 +0200
Subject: [R-sig-Geo] Note on variogram fitting with polynomial degree
In-Reply-To: <CAFZw66HVNzbJZUVYwwGLpBbHzvd4a4J=JbB7wVDpkzqNL0B9nQ@mail.gmail.com>
References: <CAFZw66HVNzbJZUVYwwGLpBbHzvd4a4J=JbB7wVDpkzqNL0B9nQ@mail.gmail.com>
Message-ID: <52382E8A.7050703@uni-muenster.de>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

degree is not listed as a parameter in ?variogram, and is ignored,
regrettably silently, but this is how R often works when there's a ...
in the argument list.

The function that accepts degree is ?gstat, and I tried:

variogram(gstat(NULL, "lzinc", log(zinc)~1, meuse, degree=2))

and that gives a nice error message that degree is not supported by
variogram().

I understand this is somewhat confusing. Do you think we should modify
the book or the documentation of some function?

On 09/17/2013 11:36 AM, Caspar Hallmann wrote:
> Dear all,
> 
> I read in ASDAR: "Residual variograms are calculated by default
> when a more complex model for the trend is used..."
> 
> However, I noticed that when using fit.variogram in gstat with an 
> additional option: degree=2, but keeping the formula as an
> intercept only, does not account for the higher degree of
> complexity in the model. I suspect this is not the intended
> behavior. To honour a dependence structure (polyn degree) in my
> observations I need to state the dependence explicitly in the
> formula.
> 
> Best regards,
> 
> Caspar
> 
> data(meuse) coordinates(meuse) <- c("x", "y") 
> v<-variogram(log(zinc)~1,meuse) print(v) 
> vs<-variogram(log(zinc)~1,meuse,degree=2) print(vs) 
> vt<-variogram(log(zinc)~x*y+I(x^2)+I(y^2),meuse) print(vt)
> 
> PS: x86_64-w64-mingw32/x64 (64-bit) R version 3.0.1 (2013-05-16) 
> gstat_1.0-16
> 
> _______________________________________________ R-sig-Geo mailing
> list R-sig-Geo at r-project.org 
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

- -- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
83 33081, Fax: +49 251 8339763 http://ifgi.uni-muenster.de
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.11 (GNU/Linux)
Comment: Using GnuPG with Thunderbird - http://www.enigmail.net/

iQEcBAEBAgAGBQJSOC6KAAoJEM1OCHCtOnfx6dkH/iIluvBI83ghDMoNIb+/rTDz
LOtVwu8oZp90vGIAVltBbqPVIu4SZH4jj6jif0HrEJU3wshE4k51EkGwq77jvP13
+pnCrwApeBHpJ2iUgYgqYCJAkwj+F25HxX1IxjcmQVIe8LC6O3fl/Rr8WAdnqbAL
M3J8nzEf23yWba683BCBxQwDBHbaTSHYlrKjAbEyQWsnVY40lBV0Vl7SdooseyWK
jPdEFPhp3kQIpPKhbmoAo9PwocwfUympZZ0KbM3xosZrI2cfI1dXXzrOwJtsCBrW
7/pK9fOxDYfGZICEnSr3xkf3FQCaoFQZY5uVEIrOo67/GkNxt5ewBkIdsQCi+vc=
=m5bR
-----END PGP SIGNATURE-----


From edzer.pebesma at uni-muenster.de  Tue Sep 17 12:50:22 2013
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Tue, 17 Sep 2013 12:50:22 +0200
Subject: [R-sig-Geo] IDW & Kriging on Spatial Grid not Consistent with
 IDW & Kriging on Polygon (CRS are the same)
In-Reply-To: <CAPim8ZKoh_VB5c=K-Sjy8sy4izGcp4xisWL=DcbuigZiUZ5kiA@mail.gmail.com>
References: <CAPim8ZKoh_VB5c=K-Sjy8sy4izGcp4xisWL=DcbuigZiUZ5kiA@mail.gmail.com>
Message-ID: <523833EE.9040903@uni-muenster.de>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

James, it seems you still didn't get the projections right:

> bbox(muni.sp)
         min       max
LON 120.7167 121.01800
LAT  14.1000  14.48034
> bbox(brgy_poly)
       min      max
x 11285704 11334871
y  1503882  1550830
> bbox(grd)
       min       max
x 120.7167 121.02097
y  14.1000  14.48034

I found this by adding argument scales=list(draw=TRUE) to spplot().
Usually when kriging gives a constant and the variogram is not pure
nugget, there is a problem with coordinates (scale or shift).

In the lines

> ## Create spatial object muni.sp <- 
> SpatialPointsDataFrame(coords=sp_point,muni,proj4string=CRS(new_crs))
>
> 
muni.sp <- spTransform(muni.sp, CRS(new_crs))

you think that you reproject, but you don't, because you tell R the
long/lat data are in new_crs, which seems not the case.

I remember writing a warning for this case long ago, but have to look
into it why we don't see it here.

On 09/14/2013 07:41 PM, James Matthew Miraflor wrote:
> Hi everyone!
> 
> I was doing some IDW and Kriging interpolation of poverty incidence
> of municipal level (using the centroids of the municipal polygons)
> to the town level and it seems that it was not consistent with the
> original distribution of values. Moreover, the result when the IDW
> and Kriging is done on a Spatial Grid and when it is done on a
> shape is not consistent (the one on the Spatial Grid is much closer
> to reality).
> 
> This occurs even if they already have the same CRS.
> 
> You may want to check out the images here: 
> https://www.dropbox.com/sh/q5sev7n2pi6tq8f/tiqiFMjJS5
> 
> See the code below:
> 
> #-------------------------------------------------------------------------
>
>  # Clear the workspace rm(list=ls())
> 
> ## Load spatial packages library(maps)         # Projections 
> library(maptools)     # muni management library(sp)           #
> muni management library(spdep)        # Spatial autocorrelation 
> library(gstat)        # Geostatistics library(splancs)      #
> Kernel Density library(spatstat)     # Geostatistics 
> library(pgirmess)     # Spatial autocorrelation 
> library(RColorBrewer) # Visualization library(classInt)     # Class
> intervals library(spgwr)        # GWR library(spgrass6) 
> library(raster)
> 
> town_poly <- readShapePoly("town.shp",IDvar="TOWN_CODE", 
> proj4string=CRS("+proj=longlat +ellps=clrk66")) muni_poly <-
> readShapePoly("muni.shp",IDvar="MUNICODE", 
> proj4string=CRS("+proj=longlat +ellps=clrk66"))
> 
> # New CRS new_crs <- "+proj=robin +lon_0=0 +x_0=0 +y_0=0
> +ellps=WGS84 +datum=WGS84 +units=m +no_defs"
> 
> # Transform CRS town_poly <- spTransform(town_poly, CRS(new_crs)) 
> muni_poly <- spTransform(muni_poly, CRS(new_crs))
> 
> muni = muni_poly at data
> 
> ## Create matrix of coordinates sp_point <- coordinates(muni_poly) 
> colnames(sp_point) <- c("LON","LAT")
> 
> ## Create spatial object muni.sp <- 
> SpatialPointsDataFrame(coords=sp_point,muni,proj4string=CRS(new_crs))
>
> 
muni.sp <- spTransform(muni.sp, CRS(new_crs))
> 
> ## Variogram plot v.obj<-variogram(POVERTY_INCIDENCE~1,
> locations=coordinates(sp_point), data=muni.sp, cloud=F) 
> plot(v.obj,type='b',pch=16)
> 
> ## Assuming spherical model v.sph <-
> fit.variogram(v.obj,vgm(psill=1, model='Sph', range=100000)) 
> plot(v.obj, v.sph, pch = 16,cex=.5,col="green")
> 
> ## Assuming exponential model v.exp <-
> fit.variogram(v.obj,vgm(psill=1, model='Exp', range=100000)) 
> plot(v.obj, v.exp, pch = 16,cex=.5,col="red")
> 
> # Choose exponential v.fin = v.exp
> 
> grd <- Sobj_SpatialGrid(muni.sp)$SG
> 
> ## Ordinary kriging
> 
> kr <- krige(POVERTY_INCIDENCE~1, muni.sp, newdata=town_poly,
> model=v.fin) spplot(kr, "var1.pred", col.regions =
> rev(heat.colors(100)), main=' - Kriging'), pch=2,cex=2)
> 
> kr <- krige(POVERTY_INCIDENCE~1, muni.sp, grd, model=v.fin) 
> spplot(kr, "var1.pred", col.regions = rev(heat.colors(100)), main='
> - Kriging'), pch=2,cex=2)
> 
> detach(package:gstat) library(gstat)
> 
> ## IDW
> 
> idw.out <-
> idw(POVERTY_INCIDENCE~1,muni.sp,newdata=town_poly,idp=.2) 
> spplot(idw.out[1],col.regions=rev(heat.colors(100)), main=' - IDW 
> Interpolation'),sub="k = 1/5")
> 
> idw.out <- idw(POVERTY_INCIDENCE~1,muni.sp,grd,idp=.2) 
> spplot(idw.out[1],col.regions=rev(heat.colors(100)), main=' - IDW 
> Interpolation'),sub="k = 1/5")
> 
> #-------------------------------------------------------------------------
>
>  I hope someone can help me on this. Thanks!
> 
> James
> 
> 

- -- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
83 33081, Fax: +49 251 8339763 http://ifgi.uni-muenster.de
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.11 (GNU/Linux)
Comment: Using GnuPG with Thunderbird - http://www.enigmail.net/

iQEcBAEBAgAGBQJSODPuAAoJEM1OCHCtOnfxj+UH/2bbTvFz912tv1w0xKcAN6Yq
58MPMWwIFDH7ZpgPKjANTNQidbUeKryP8Z+w5R0/qZQfPHLPq+/9UpKJjwVm3eG4
bfRpf4fA+YYD474tqLvtfCQkChDn4QU0W+6ysL/EFg+IYqKzS3OijJty7GeD6P62
nHhGnwsN23QXL+PVRV7cq4vrOMskVRxCym9GchL6OksYfLRX/dmiksDx5FMd8+qh
2utipyAvLdk30AyOiLH4y9L9dg33Y77arBFLcN5oHd5UWfKCRbokVHJvLHp0PmVQ
BNVSTaSezoRDeejNzHbGi5X+hpGsoZyG1YWDq59DdhHb8NzzrGHVClQTknfJX0s=
=zYBQ
-----END PGP SIGNATURE-----


From caspar.hallmann at gmail.com  Tue Sep 17 13:02:25 2013
From: caspar.hallmann at gmail.com (Caspar Hallmann)
Date: Tue, 17 Sep 2013 13:02:25 +0200
Subject: [R-sig-Geo] Note on variogram fitting with polynomial degree
In-Reply-To: <52382E8A.7050703@uni-muenster.de>
References: <CAFZw66HVNzbJZUVYwwGLpBbHzvd4a4J=JbB7wVDpkzqNL0B9nQ@mail.gmail.com>
	<52382E8A.7050703@uni-muenster.de>
Message-ID: <CAFZw66F_1CJ5ArjaWuuC4RUXEiTpgYL1W+Lyv1eS8iz+z+6cLw@mail.gmail.com>

Hi Edzer,
Thanks for the clarification. Well, ideally, I think variogram()
should be made possible to account for "degree". Alternatively a
simple note in the help file for variogram along the lines "NOTE:
degree is not used in variogram(), Use formula to specify a trend
surface instead", might suffice.
Thanks again
Caspar


On Tue, Sep 17, 2013 at 12:27 PM, Edzer Pebesma
<edzer.pebesma at uni-muenster.de> wrote:
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> degree is not listed as a parameter in ?variogram, and is ignored,
> regrettably silently, but this is how R often works when there's a ...
> in the argument list.
>
> The function that accepts degree is ?gstat, and I tried:
>
> variogram(gstat(NULL, "lzinc", log(zinc)~1, meuse, degree=2))
>
> and that gives a nice error message that degree is not supported by
> variogram().
>
> I understand this is somewhat confusing. Do you think we should modify
> the book or the documentation of some function?
>
> On 09/17/2013 11:36 AM, Caspar Hallmann wrote:
>> Dear all,
>>
>> I read in ASDAR: "Residual variograms are calculated by default
>> when a more complex model for the trend is used..."
>>
>> However, I noticed that when using fit.variogram in gstat with an
>> additional option: degree=2, but keeping the formula as an
>> intercept only, does not account for the higher degree of
>> complexity in the model. I suspect this is not the intended
>> behavior. To honour a dependence structure (polyn degree) in my
>> observations I need to state the dependence explicitly in the
>> formula.
>>
>> Best regards,
>>
>> Caspar
>>
>> data(meuse) coordinates(meuse) <- c("x", "y")
>> v<-variogram(log(zinc)~1,meuse) print(v)
>> vs<-variogram(log(zinc)~1,meuse,degree=2) print(vs)
>> vt<-variogram(log(zinc)~x*y+I(x^2)+I(y^2),meuse) print(vt)
>>
>> PS: x86_64-w64-mingw32/x64 (64-bit) R version 3.0.1 (2013-05-16)
>> gstat_1.0-16
>>
>> _______________________________________________ R-sig-Geo mailing
>> list R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> - --
> Edzer Pebesma
> Institute for Geoinformatics (ifgi), University of M?nster
> Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
> 83 33081, Fax: +49 251 8339763 http://ifgi.uni-muenster.de
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v1.4.11 (GNU/Linux)
> Comment: Using GnuPG with Thunderbird - http://www.enigmail.net/
>
> iQEcBAEBAgAGBQJSOC6KAAoJEM1OCHCtOnfx6dkH/iIluvBI83ghDMoNIb+/rTDz
> LOtVwu8oZp90vGIAVltBbqPVIu4SZH4jj6jif0HrEJU3wshE4k51EkGwq77jvP13
> +pnCrwApeBHpJ2iUgYgqYCJAkwj+F25HxX1IxjcmQVIe8LC6O3fl/Rr8WAdnqbAL
> M3J8nzEf23yWba683BCBxQwDBHbaTSHYlrKjAbEyQWsnVY40lBV0Vl7SdooseyWK
> jPdEFPhp3kQIpPKhbmoAo9PwocwfUympZZ0KbM3xosZrI2cfI1dXXzrOwJtsCBrW
> 7/pK9fOxDYfGZICEnSr3xkf3FQCaoFQZY5uVEIrOo67/GkNxt5ewBkIdsQCi+vc=
> =m5bR
> -----END PGP SIGNATURE-----
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From u.p at operamail.com  Tue Sep 17 14:10:34 2013
From: u.p at operamail.com (up)
Date: Tue, 17 Sep 2013 05:10:34 -0700 (PDT)
Subject: [R-sig-Geo] problem with extract() raster package using weight=TRUE
Message-ID: <1379419834336-7584665.post@n2.nabble.com>

Hi everybody! I'm a new user, sorry for any kind of errors in posting :-).

I'm trying to use* extract()* from raster library to get data values from
netcdf file that are inside a shapefile.
I'm using rgdal library to manage shapefiles, and raster library to read
netcdf file (a very simple file).
This is the simple code:

> t500 <-raster("t500.nc")
> projection(t500)
[1] "+proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0"

> regioni <- readOGR(".", "ITA_adm1")
#ITA_adm1 from GADM database of Global Administrative Areas, shapefile
format

> summary(regioni)
Object of class SpatialPolygonsDataFrame
Coordinates:
        min      max
x  6.630879 18.52069
y 35.492917 47.09096
Is projected: FALSE 
proj4string :
[+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0]
(...)

> lombardia <-regioni[regioni$NAME_1=="Lombardia",]
> liguria <-regioni[regioni$NAME_1=="Liguria",]

Now, I extract values from netcdf file that fall into lombardia:

>extract(t500,lombardia)
[[1]]
  [1] 249.3597 249.3362 249.3284 249.9573 249.5706 249.5081 249.4065
250.2269
  [9] 250.2581 250.2151 250.1058 249.9964 249.9261 249.8831 249.8245
249.7347
(...)

Now into liguria:

> extract(t500,liguria)
[[1]]
 [1] 249.9729 250.3440 250.2269 250.1800 250.1331 250.0823 250.0198 249.9729
 [9] 249.9573 249.9651 250.4026 250.3128 250.2425 250.1956 250.0862 250.0550
[17] 250.0628 250.1019 250.1487 250.4808 250.4222 250.3753 250.2737 250.2972
[25] 250.3284 250.7972 250.4495 250.4456 250.4495 250.4808 250.8362 250.6800
[33] 250.5940 250.5862 251.1409 251.0003 250.8753 250.8011 250.7894

Now I try to extract with weight enabled.

> extract(t500,lombardia,weight=T)
[[1]]
          value weight
  [1,] 249.4651   0.23
  [2,] 249.3948   0.27
  [3,] 249.8323   0.15
  [4,] 249.8206   0.42
  [5,] 249.8206   0.10
  [6,] 249.4183   0.06
  [7,] 249.3597   0.99
  [8,] 249.3362   0.99
  [9,] 249.3284   0.90
(...)

Nice one!
Now I do the same thing on the second shapefile:

> extract(t500,liguria,weight=T)
Error: identicalCRS(x, y) is not TRUE

That's the problem! I can extract from liguria netcdf values, but I cannot
extract them with weight.

Any suggestion?

Manymany thanks in advance!

Umberto



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/problem-with-extract-raster-package-using-weight-TRUE-tp7584665.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From zuzulaz at gmail.com  Tue Sep 17 15:53:08 2013
From: zuzulaz at gmail.com (zuzana zajkova)
Date: Tue, 17 Sep 2013 15:53:08 +0200
Subject: [R-sig-Geo] KernelUD calculation - coordinates type /
 transformation from lat/long
In-Reply-To: <52376844.2030108@mit.edu>
References: <CADQCJLBi-ZmqcZER=T=4yyvsb2vZYRpuxz0N1e0rvvG67NfZmQ@mail.gmail.com>
	<52376844.2030108@mit.edu>
Message-ID: <CADQCJLBYqgSq0pWX7rWcVXUqEf3Kc=YkbJbgbUy01KrzFMCEug@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130917/f24c069f/attachment.pl>

From Scott.Waichler at pnnl.gov  Tue Sep 17 18:52:41 2013
From: Scott.Waichler at pnnl.gov (Waichler, Scott R)
Date: Tue, 17 Sep 2013 09:52:41 -0700
Subject: [R-sig-Geo] function to convert to/from U.S. State Plane
 Coordinates?
In-Reply-To: <FF9DB805FC41CC4E95825A50F680630217A7D1C0@columbia.uhd.campus>
References: <A632B3F93D861843A3C966F3962C3F840148B1010A08@EMAIL05.pnl.gov>
	<FF9DB805FC41CC4E95825A50F680630217A7C0C0@columbia.uhd.campus>
	<A632B3F93D861843A3C966F3962C3F840148B1010A4C@EMAIL05.pnl.gov>
	<CAGcXcEbs-k=naoLrHb43-N59Y1uRwUfBaeJNL3v2+M1Qoit=0Q@mail.gmail.com>
	<A632B3F93D861843A3C966F3962C3F840148B1010A5B@EMAIL05.pnl.gov>
	<FF9DB805FC41CC4E95825A50F680630217A7C15D@columbia.uhd.campus>
	<A632B3F93D861843A3C966F3962C3F840148B1010A5D@EMAIL05.pnl.gov>
	<FF9DB805FC41CC4E95825A50F680630217A7D186@columbia.uhd.campus>
	<A632B3F93D861843A3C966F3962C3F840148B1010A5F@EMAIL05.pnl.gov>
	<FF9DB805FC41CC4E95825A50F680630217A7D1C0@columbia.uhd.campus>
Message-ID: <A632B3F93D861843A3C966F3962C3F840148B1010AA6@EMAIL05.pnl.gov>

Erin,

Thanks, now I see that I was trying to use spTransform() on a map object instead of a Spatial one.  I followed your logic and came up with the following to plot the state of Washington using state plane coordinates instead of the original geographic values.  But I get an extraneous triangular polygon.  I am guessing it has to do with not repeating the initial x,y at the end of a polygon, or a missing row of NA.  What am I missing? 

library(maps)
library(rgdal)
wa <- map('state', region = 'washington', plot=F, type="n")
ind.not.na <- which(!is.na(wa$x))  # note which rows are not NA
wa1 <- data.frame(x=wa$x,y=wa$y)  # make a Spatial object from the map object
coordinates(wa1) <- ~x+y
proj4string(wa1) <- CRS("+proj=longlat +datum=WGS84")
# I got the CRS spec from http://spatialreference.org/ref/esri/102749/proj4/
wa.spc <- spTransform(wa1, CRS("+proj=lcc +lat_1=45.83333333333334 +lat_2=47.33333333333334 +lat_0=45.33333333333334 +lon_0=-120.5 +x_0=500000.0000000002 +y_0=0 +ellps=GRS80 +datum=NAD83 +to_meter=0.3048006096012192 +no_defs"))

# make another data frame with the same number of rows as the map() original
wa2 <- data.frame(x=wa$x,y=wa$y)
# repace the geographic values with the state plane coordinate values
wa2$x[ind.not.na] <- wa.spc$x  
wa2$y[ind.not.na] <- wa.spc$y
plot(wa2, type="n")
polygon(wa2)  # gives a spurious triangular polygon--why?

> Ok.  I think I see it now.
> 
> You need to have a spatial object rather than a list.
> 
> So you might set up
> 
> 	pnw1 <- data.frame(x=pnw$x,y=pnw$y)
> 	coordinates(pwn1) <- ~x+y
> Then you'll have a spatial object.  After that, put in your projection:
> 	proj4string(pnw1) <- CRS(xxxxx)
> 	pnw2 <- spTransform(pnw1,CRS(yyyy))

--Scott


From Roger.Bivand at nhh.no  Tue Sep 17 19:24:36 2013
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 17 Sep 2013 19:24:36 +0200
Subject: [R-sig-Geo] function to convert to/from U.S. State Plane
 Coordinates?
In-Reply-To: <A632B3F93D861843A3C966F3962C3F840148B1010AA6@EMAIL05.pnl.gov>
References: <A632B3F93D861843A3C966F3962C3F840148B1010A08@EMAIL05.pnl.gov>
	<FF9DB805FC41CC4E95825A50F680630217A7C0C0@columbia.uhd.campus>
	<A632B3F93D861843A3C966F3962C3F840148B1010A4C@EMAIL05.pnl.gov>
	<CAGcXcEbs-k=naoLrHb43-N59Y1uRwUfBaeJNL3v2+M1Qoit=0Q@mail.gmail.com>
	<A632B3F93D861843A3C966F3962C3F840148B1010A5B@EMAIL05.pnl.gov>
	<FF9DB805FC41CC4E95825A50F680630217A7C15D@columbia.uhd.campus>
	<A632B3F93D861843A3C966F3962C3F840148B1010A5D@EMAIL05.pnl.gov>
	<FF9DB805FC41CC4E95825A50F680630217A7D186@columbia.uhd.campus>
	<A632B3F93D861843A3C966F3962C3F840148B1010A5F@EMAIL05.pnl.gov>
	<FF9DB805FC41CC4E95825A50F680630217A7D1C0@columbia.uhd.campus>
	<A632B3F93D861843A3C966F3962C3F840148B1010AA6@EMAIL05.pnl.gov>
Message-ID: <alpine.LRH.2.03.1309171922160.17307@reclus.nhh.no>

On Tue, 17 Sep 2013, Waichler, Scott R wrote:

> Erin,
>
> Thanks, now I see that I was trying to use spTransform() on a map object 
> instead of a Spatial one.  I followed your logic and came up with the 
> following to plot the state of Washington using state plane coordinates 
> instead of the original geographic values.  But I get an extraneous 
> triangular polygon.  I am guessing it has to do with not repeating the 
> initial x,y at the end of a polygon, or a missing row of NA.  What am I 
> missing?

You have not looked for information on converting legacy map objects to sp 
classes. Look for ?map2SpatialPolygons in the maptools package. Better 
still, find a better representation of the state boundary as a shapefile 
and use that instead.

Roger

>
> library(maps)
> library(rgdal)
> wa <- map('state', region = 'washington', plot=F, type="n")
> ind.not.na <- which(!is.na(wa$x))  # note which rows are not NA
> wa1 <- data.frame(x=wa$x,y=wa$y)  # make a Spatial object from the map object
> coordinates(wa1) <- ~x+y
> proj4string(wa1) <- CRS("+proj=longlat +datum=WGS84")
> # I got the CRS spec from http://spatialreference.org/ref/esri/102749/proj4/
> wa.spc <- spTransform(wa1, CRS("+proj=lcc +lat_1=45.83333333333334 +lat_2=47.33333333333334 +lat_0=45.33333333333334 +lon_0=-120.5 +x_0=500000.0000000002 +y_0=0 +ellps=GRS80 +datum=NAD83 +to_meter=0.3048006096012192 +no_defs"))
>
> # make another data frame with the same number of rows as the map() original
> wa2 <- data.frame(x=wa$x,y=wa$y)
> # repace the geographic values with the state plane coordinate values
> wa2$x[ind.not.na] <- wa.spc$x
> wa2$y[ind.not.na] <- wa.spc$y
> plot(wa2, type="n")
> polygon(wa2)  # gives a spurious triangular polygon--why?
>
>> Ok.  I think I see it now.
>>
>> You need to have a spatial object rather than a list.
>>
>> So you might set up
>>
>> 	pnw1 <- data.frame(x=pnw$x,y=pnw$y)
>> 	coordinates(pwn1) <- ~x+y
>> Then you'll have a spatial object.  After that, put in your projection:
>> 	proj4string(pnw1) <- CRS(xxxxx)
>> 	pnw2 <- spTransform(pnw1,CRS(yyyy))
>
> --Scott
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From droletguillaume at gmail.com  Tue Sep 17 20:13:01 2013
From: droletguillaume at gmail.com (Guillaume Drolet)
Date: Tue, 17 Sep 2013 14:13:01 -0400
Subject: [R-sig-Geo] writeRaster to TIF changes raster maximum value
In-Reply-To: <523891EE.4010903@mrn.gouv.qc.ca>
References: <CANtt_hznMtBDLzky_qQfqxniAKdkvrbcOCFSanbs3LT4aJ=TcQ@mail.gmail.com>
	<523891EE.4010903@mrn.gouv.qc.ca>
Message-ID: <CAOkiyv4zayqvegDk+iSYjL9eU7hoqwxCbm2X4mK4g8zVdG76=A@mail.gmail.com>

Hi Robert,

Following my previous post, I tried with a smaller extent than the one
that was used previously:

e <- extent(457785, 516302, 5147085, 5217408)

For the rest, I ran the same code as before:

> rc <- crop(r, e)
> NAvalue(rc) <- 0
> t <- writeRaster(rc, y, overwrite = TRUE, datatype = "INT1U", NAflag = 0)
> t
class       : RasterLayer
dimensions  : 2344, 1951, 4573144  (nrow, ncol, ncell)
resolution  : 30, 30  (x, y)
extent      : 457785, 516315, 5147085, 5217405  (xmin, xmax, ymin, ymax)
coord. ref. : +proj=utm +zone=18 +datum=WGS84 +units=m +no_defs
+ellps=WGS84 +towgs84=0,0,0
data source : E:\temp\Fmask\Image_sub\L71015027_02720000730_B10.tif
names       : L71015027_02720000730_B10
values      : 0, 255  (min, max)

Don't know why but the minimum is now 0, while for the extent we used
before (which was larger) the minimum value was 1...

There are definitely some behaviour I don't quite get in all this...

Thanks,

Guillaume



2013/9/17  <Guillaume.Drolet at mrn.gouv.qc.ca>:
>
>
>
> -------- Message original --------
> Sujet:  Re: [R-sig-Geo] writeRaster to TIF changes raster maximum value
> Date :  Tue, 17 Sep 2013 01:25:53 -0400
> De :    Robert J. Hijmans <r.hijmans at gmail.com>
> Pour :  Drolet, Guillaume (DRF) <Guillaume.Drolet at mrn.gouv.qc.ca>
> Copie ? :       r-sig-geo <r-sig-geo at r-project.org>
>
>
>
> Re: [R-sig-Geo] writeRaster to TIF changes raster maximum value
>
> Guillaume,
>
> This indeed happens because of NA value handling problems.  The native
> raster format uses 255 as the NA value for Byte files. That probably
> needs to change. You write such a file because you crop a large area
> and a temporary file is written. There are work arounds, see below,
> but i will ponder changes to the package that will makes these
> unnecessary.
>
> The most direct way to avoid this is to do
> library(raster)
> r = raster('L71015027_02720000730_B10_full.tif')
> e =extent( 457785, 577605, 5147085, 5255925)
> x = crop(r, e, 'abc.tif', datatype='INT2S', overwrite=TRUE)
>
>
> Alternatively,
>
> y = crop(r, e)
> NAvalue(x) = 0
> y <- writeRaster(y, 'abcd.tif', datatype='INT2S', overwrite=TRUE)
>
> Robert
>
>
> On Mon, Sep 16, 2013 at 1:58 PM,  <Guillaume.Drolet at mrn.gouv.qc.ca> wrote:
>   > Dear Robert,
>   >
>   > Here's a link to 2 images: the original raster (full) and the cropped
>   > one (sub):
>   >
>   > https://www.dropbox.com/sh/8zo8fo964kr6ttk/pH1JIpTZ1C
>   >
>   > The original raster has Byte values, as you suspected. But I don't know
>   > how to handle that so that it's not used as NA value. From what I read,
>   > NA values in the original raster should be 0, and minimum and maximum
>   > values should be 1 and 255, respectively.
>   >
>   > Thanks for helping,
>   >
>   > Guillaume
>   >
>   > Le 2013-09-16 11:41, Robert J. Hijmans a ?crit :
>   >> I suspect that the original file has Byte values and that 255 is used,
>   >> perhaps erroneously, as NA. Can you give me access to the file?
>   >> Thanks, Robert
>   >>
>   >> On Mon, Sep 16, 2013 at 8:10 AM,  <Guillaume.Drolet at mrn.gouv.qc.ca>
> wrote:
>   >>  > Dear list members,
>   >>  >
>   >>  > I need your help trying to figure out why my raster's maximum
> value gets
>   >>  > changed in the resulting TIF file from a call to the writeRaster
>   >> function.
>   >>  >
>   >>  > I read here
>   >>  >
>   >>
> (http://r-sig-geo.2731867.n2.nabble.com/writeRaster-to-ascii-file-asc-td7584093.html#none)
>   >>  >
>   >>  > that this problem could be due to my version of GDAL (1.11dev
> released
>   >>  > 2013/04/13). This is the GDAL version that is in my system's
> path. Don't
>   >>  > know if this can help but when I load rgdal, I can read this:
>   >>  >
>   >>  > Loaded GDAL runtime: GDAL 1.9.2, released 2012/10/08
>   >>  >
>   >>  > Here are the details of my raster (myRaster) before calling
> writeRaster:
>   >>  >
>   >>  >   > raster(myRaster)
>   >>  >
>   >>  > class       : RasterLayer
>   >>  > dimensions  : 7261, 7961, 57804821  (nrow, ncol, ncell)
>   >>  > resolution  : 30, 30  (x, y)
>   >>  > extent      : 457785, 696615, 5147085, 5364915  (xmin, xmax,
> ymin, ymax)
>   >>  > coord. ref. : +proj=utm +zone=18 +datum=WGS84 +units=m +no_defs
>   >>  > +ellps=WGS84 +towgs84=0,0,0
>   >>  > data source : E:\temp\Fmask\Image\L71015027_02720000730_B10.tif
>   >>  > names       : L71015027_02720000730_B10
>   >>  > values      : 0, 255  (min, max)
>   >>  >
>   >>  >
>   >>  > I crop "myRaster" using the crop function with a bounding box and
> then I
>   >>  > save the cropped raster as a TIF with:
>   >>  >
>   >>  >   > writeRaster(rc, "myCroppedRaster.tif", datatype = "INT2S")
>   >>  > rgdal: version: 0.8-11, (SVN revision 479M)
>   >>  > Geospatial Data Abstraction Library extensions to R successfully
> loaded
>   >>  > Loaded GDAL runtime: GDAL 1.9.2, released 2012/10/08
>   >>  > Path to GDAL shared files:
>   >>  > C:/Users/Utilisateur/Documents/R/win-library/3.0/rgdal/gdal
>   >>  > GDAL does not use iconv for recoding strings.
>   >>  > Loaded PROJ.4 runtime: Rel. 4.7.1, 23 September 2009,
> [PJ_VERSION: 470]
>   >>  > Path to PROJ.4 shared files:
>   >>  > C:/Users/Utilisateur/Documents/R/win-library/3.0/rgdal/proj
>   >>  >
>   >>  > class       : RasterLayer
>   >>  > dimensions  : 3628, 3994, 14490232  (nrow, ncol, ncell)
>   >>  > resolution  : 30, 30  (x, y)
>   >>  > extent      : 457785, 577605, 5147085, 5255925  (xmin, xmax,
> ymin, ymax)
>   >>  > coord. ref. : +proj=utm +zone=18 +datum=WGS84 +units=m +no_defs
>   >>  > +ellps=WGS84 +towgs84=0,0,0
>   >>  > data source : E:temp\myRaster.tif
>   >>  > names       : myRaster
>   >>  > values      : 0, 254  (min, max)
>   >>  >
>   >>  >
>   >>  > As shown in the output from writeRaster, the maximum value in the
> output
>   >>  > TIF file is now 254. I double-checked and
>   >>  > there are pixels with value 255 in the cropped area of the original
>   >>  > raster so the maximum value shouldn't be 254 but 255.
>   >>  >
>   >>  > Here's the output of my sessionInfo():
>   >>  >
>   >>  > R version 3.0.1 (2013-05-16)
>   >>  > Platform: x86_64-w64-mingw32/x64 (64-bit)
>   >>  >
>   >>  > locale:
>   >>  > [1] LC_COLLATE=French_Canada.1252  LC_CTYPE=French_Canada.1252
>   >>  > LC_MONETARY=French_Canada.1252
>   >>  > [4] LC_NUMERIC=C                   LC_TIME=French_Canada.1252
>   >>  >
>   >>  > attached base packages:
>   >>  > [1] stats     graphics  grDevices utils     datasets  methods   base
>   >>  >
>   >>  > other attached packages:
>   >>  > [1] rgdal_0.8-11  raster_2.1-49 sp_1.0-13
>   >>  >
>   >>  > loaded via a namespace (and not attached):
>   >>  > [1] grid_3.0.1      lattice_0.20-15 tools_3.0.1
>   >>  >
>   >>  > I thank you in advance for any hint that could help me solve this
>   >>  > problem.
>   >>  >
>   >>  > Guillaume
>   >>  > --
>   >>  > Guillaume Drolet ing.f M.Sc.
>   >>  > Chercheur en t?l?d?tection et dynamique foresti?re
>   >>  > Direction de la recherche foresti?re
>   >>  > Minist?re des ressources naturelles du Qu?bec
>   >>  > 2700, rue Einstein, C.RC.335
>   >>  > Qu?bec (Qu?bec), Canada G1P 3W8
>   >>  > T : +1 418 643 7994 # 6727
>   >>  > F : +1 418 643 2165
>   >>  > guillaume.drolet at mrn.gouv.qc.ca
>   >>  > http://www.mrn.gouv.qc.ca/forets
>   >>  >
>   >>  > _______________________________________________
>   >>  > R-sig-Geo mailing list
>   >>  > R-sig-Geo at r-project.org
>   >>  > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>   >>
>   >
>   > --
>   > Guillaume Drolet ing.f M.Sc.
>   > Chercheur en t?l?d?tection et dynamique foresti?re
>   > Direction de la recherche foresti?re
>   > Minist?re des ressources naturelles du Qu?bec
>   > 2700, rue Einstein, C.RC.335
>   > Qu?bec (Qu?bec), Canada G1P 3W8
>   > T : +1 418 643 7994 # 6727
>   > F : +1 418 643 2165
>   > guillaume.drolet at mrn.gouv.qc.ca
>   > http://www.mrn.gouv.qc.ca/forets
>
>


From r.hijmans at gmail.com  Tue Sep 17 20:18:08 2013
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Tue, 17 Sep 2013 11:18:08 -0700
Subject: [R-sig-Geo] problem with extract() raster package using
	weight=TRUE
In-Reply-To: <1379419834336-7584665.post@n2.nabble.com>
References: <1379419834336-7584665.post@n2.nabble.com>
Message-ID: <CANtt_hz_m+z0WfXKcHcyuBLcokEA-E9iZNpSJbCYcn3EPW7KdA@mail.gmail.com>

Umberto,

The work-around is to assure that the CRS are the same:

projection(regioni) <- projection(t500)

You should of course only do that when the projections are in fact the
same, as in this case. The problem is caused by sp::identicalCRS that
compares the verbatim, but not the semantic representation of the CRS
(and, therefore, perhaps should give a warning rather than an error?).

Robert

On Tue, Sep 17, 2013 at 5:10 AM, up <u.p at operamail.com> wrote:
> Hi everybody! I'm a new user, sorry for any kind of errors in posting :-).
>
> I'm trying to use* extract()* from raster library to get data values from
> netcdf file that are inside a shapefile.
> I'm using rgdal library to manage shapefiles, and raster library to read
> netcdf file (a very simple file).
> This is the simple code:
>
>> t500 <-raster("t500.nc")
>> projection(t500)
> [1] "+proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0"
>
>> regioni <- readOGR(".", "ITA_adm1")
> #ITA_adm1 from GADM database of Global Administrative Areas, shapefile
> format
>
>> summary(regioni)
> Object of class SpatialPolygonsDataFrame
> Coordinates:
>         min      max
> x  6.630879 18.52069
> y 35.492917 47.09096
> Is projected: FALSE
> proj4string :
> [+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0]
> (...)
>
>> lombardia <-regioni[regioni$NAME_1=="Lombardia",]
>> liguria <-regioni[regioni$NAME_1=="Liguria",]
>
> Now, I extract values from netcdf file that fall into lombardia:
>
>>extract(t500,lombardia)
> [[1]]
>   [1] 249.3597 249.3362 249.3284 249.9573 249.5706 249.5081 249.4065
> 250.2269
>   [9] 250.2581 250.2151 250.1058 249.9964 249.9261 249.8831 249.8245
> 249.7347
> (...)
>
> Now into liguria:
>
>> extract(t500,liguria)
> [[1]]
>  [1] 249.9729 250.3440 250.2269 250.1800 250.1331 250.0823 250.0198 249.9729
>  [9] 249.9573 249.9651 250.4026 250.3128 250.2425 250.1956 250.0862 250.0550
> [17] 250.0628 250.1019 250.1487 250.4808 250.4222 250.3753 250.2737 250.2972
> [25] 250.3284 250.7972 250.4495 250.4456 250.4495 250.4808 250.8362 250.6800
> [33] 250.5940 250.5862 251.1409 251.0003 250.8753 250.8011 250.7894
>
> Now I try to extract with weight enabled.
>
>> extract(t500,lombardia,weight=T)
> [[1]]
>           value weight
>   [1,] 249.4651   0.23
>   [2,] 249.3948   0.27
>   [3,] 249.8323   0.15
>   [4,] 249.8206   0.42
>   [5,] 249.8206   0.10
>   [6,] 249.4183   0.06
>   [7,] 249.3597   0.99
>   [8,] 249.3362   0.99
>   [9,] 249.3284   0.90
> (...)
>
> Nice one!
> Now I do the same thing on the second shapefile:
>
>> extract(t500,liguria,weight=T)
> Error: identicalCRS(x, y) is not TRUE
>
> That's the problem! I can extract from liguria netcdf values, but I cannot
> extract them with weight.
>
> Any suggestion?
>
> Manymany thanks in advance!
>
> Umberto
>
>
>
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/problem-with-extract-raster-package-using-weight-TRUE-tp7584665.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From carotenuto_francesco at yahoo.it  Wed Sep 18 08:38:23 2013
From: carotenuto_francesco at yahoo.it (Francesco Carotenuto)
Date: Wed, 18 Sep 2013 07:38:23 +0100 (BST)
Subject: [R-sig-Geo] Indicator Kriging in automap
In-Reply-To: <1379065701.61813.YahooMailNeo@web133003.mail.ir2.yahoo.com>
References: <1379065701.61813.YahooMailNeo@web133003.mail.ir2.yahoo.com>
Message-ID: <1379486303.81545.YahooMailNeo@web133001.mail.ir2.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130918/4c1a1ba7/attachment.pl>

From tkeitt at gmail.com  Wed Sep 18 23:56:07 2013
From: tkeitt at gmail.com (Tim Keitt)
Date: Wed, 18 Sep 2013 16:56:07 -0500
Subject: [R-sig-Geo] Fixed effects format for Krig in fields package
Message-ID: <CANnL8goMgfP25BhNrps1nEYFMXXvt5mYjFuSaKKwBEHXHF5DVg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130918/c84714ba/attachment.pl>

From u.p at operamail.com  Thu Sep 19 10:15:37 2013
From: u.p at operamail.com (up)
Date: Thu, 19 Sep 2013 01:15:37 -0700 (PDT)
Subject: [R-sig-Geo] problem with extract() raster package using
	weight=TRUE
In-Reply-To: <CANtt_hz_m+z0WfXKcHcyuBLcokEA-E9iZNpSJbCYcn3EPW7KdA@mail.gmail.com>
References: <1379419834336-7584665.post@n2.nabble.com>
	<CANtt_hz_m+z0WfXKcHcyuBLcokEA-E9iZNpSJbCYcn3EPW7KdA@mail.gmail.com>
Message-ID: <1379578537035-7584673.post@n2.nabble.com>

Robert Hijmans wrote
> Umberto,
> 
> The work-around is to assure that the CRS are the same:
> 
> projection(regioni) <- projection(t500)
> 
> You should of course only do that when the projections are in fact the
> same, as in this case. The problem is caused by sp::identicalCRS that
> compares the verbatim, but not the semantic representation of the CRS
> (and, therefore, perhaps should give a warning rather than an error?).
> 
> Robert

Many thanks Robert for your suggestion! :-)

But I've already tried that, and did not work.
Yestarday I tried to use another shapefile, because I suspected something
wrong in my WGS84 shapefile.
And with another shapefile things gone well!

I've downloaded a shapefile of my country but in a different projection
("+proj=utm +zone=32 +ellps=intl +units=m +no_defs"), and then reprojected
in "+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0" with:

liguria<-spTransform(ligu_utm, CRS("+proj=longlat +datum=WGS84 +no_defs
+ellps=WGS84 +towgs84=0,0,0"))

Then I've extracted values with the same function:
estra_liguria<-extract(prec,liguria,weights=T,cellnumbers=T,df=T)

and that's the result:

   ID cell totprec weight
1   1   10       0   0.12
2   1   18       0   0.34
3   1   19       0   0.33
4   1   20       0   0.42
5   1   25       1   0.57
6   1   26       0   0.60
7   1   27       0   0.84
8   1   28       0   0.96
9   1   29       0   0.91
10  1   30       0   1.00
11  1   34      10   0.06
12  1   35       5   0.84
13  1   36       0   1.00
14  1   37       0   1.00

I don't know why the first shapefile doesn't work (I've downloaded it from
http://www.gadm.org, lonlat WGS84), but the new one does the job! :-)

In any case, thanks very much!

Umberto




--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/problem-with-extract-raster-package-using-weight-TRUE-tp7584665p7584673.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From pan.sapiens.it at gmail.com  Thu Sep 19 15:57:12 2013
From: pan.sapiens.it at gmail.com (Pan)
Date: Thu, 19 Sep 2013 15:57:12 +0200
Subject: [R-sig-Geo] kernelUD {adehabitatHR} - Bug in the function or human
	error?
Message-ID: <523B02B8.2070101@gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130919/c1552fc7/attachment.pl>

From tony.gray at utoronto.ca  Thu Sep 19 21:08:28 2013
From: tony.gray at utoronto.ca (Tony Gray)
Date: Thu, 19 Sep 2013 19:08:28 +0000
Subject: [R-sig-Geo] How to plot great circles on a Robinson projection map
	in ggplot2?
Message-ID: <03851F23-3E66-46A2-BA1C-1838F39BE74F@utoronto.ca>

Hi! 

I want to plot great circles on a map in ggplot2 similar to the way it is done in this post: http://www.stanford.edu/~cengel/cgi-bin/anthrospace/great-circles-on-a-recentered-worldmap-in-ggplot -- though I am not so interested in re-centring. 

The wrinkle is that I want to do it on a Robinson projected map. I can use gcIntermediate on a Mercator map, but I can't figure it out when the coordinates have been translated using project().

The base code follows. Does anyone know how I can get great circles to connect the B locations to the A location? Any advice would be hugely appreciated.

Thank you! 

-- Tony

Here is the code:

library(rgdal)
library(ggplot2)
library(geosphere)

# B locations
lat <- c(36.0834857,40.96342,59.32893)
lng <- c(140.0766423,-76.6127329,18.06491)
lnglat <- cbind(lng,lat)
lnglat_df <- as.data.frame(lnglat)
names(lnglat_df) <- c('longitude','latitude')
lnglat_robin_df  <- project(cbind(lnglat_df$longitude, lnglat_df$latitude), proj="+init=ESRI:54030")
lnglat_robin_df <- as.data.frame(lnglat_robin_df)
names(lnglat_robin_df) <- c('longitude','latitude')

# A location
ALatitude <- 43.661102
ALongitude <- -79.395929
ACoords <- project(cbind(ALongitude, ALatitude), proj="+init=ESRI:54030")
ACoords_df <- as.data.frame(ACoords)
names(ACoords_df) <- c("longitude", "latitude")

# read shapefile
wmap <- readOGR(dsn="ne_110m_land", layer="ne_110m_land")
# project
wmap_robin <- spTransform(wmap, CRS("+init=ESRI:54030"))
# convert 
wmap_robin_df <- fortify(wmap_robin)

# create a blank ggplot theme -- thanks rpsychologist!

theme_opts <- list(theme(panel.grid.minor = element_blank(),
                    panel.grid.major = element_blank(),
                    panel.background = element_blank(),
                    plot.background = element_rect(fill="gray0"),
                    panel.border = element_blank(),
                    axis.line = element_blank(),
                    axis.text.x = element_blank(),
                    axis.text.y = element_blank(),
                    axis.ticks = element_blank(),
                    axis.title.x = element_blank(),
                    axis.title.y = element_blank(),
                    plot.title = element_text(size=22)))

# OK Plot dots
ggplot (wmap_robin_df, aes(long,lat, group=group)) +
geom_polygon(fill="gray10") +
geom_point(data=lnglat_robin_df, aes(longitude, latitude, group=NULL, fill=NULL), color="#32caf6", alpha=0.5, size=4) +
coord_equal() +
theme_opts +
scale_fill_manual(values=c("black", "black"), guide="none")

#save
ggsave
("map.png", width=12.5, height=8.25, dpi=72)

From jeff.n.marcus at gmail.com  Thu Sep 19 22:45:52 2013
From: jeff.n.marcus at gmail.com (Jeff Marcus)
Date: Thu, 19 Sep 2013 16:45:52 -0400
Subject: [R-sig-Geo] =?windows-1252?q?How_do_I_ensure_that_the_polygon_in_?=
	=?windows-1252?q?spatstat=3A=3Aowin=28poly=3D=3Cpolygon=3E=29_does?=
	=?windows-1252?q?_not_have_=93negative_area=94?=
Message-ID: <CAHAP1TC=jqmhvdRYDKCtCkXv30jk2H5Q51cuksizqi9cj8kG2A@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130919/86ac9e4a/attachment.pl>

From aortizbobea at arec.umd.edu  Fri Sep 20 02:53:40 2013
From: aortizbobea at arec.umd.edu (Ariel Ortiz-Bobea)
Date: Thu, 19 Sep 2013 17:53:40 -0700 (PDT)
Subject: [R-sig-Geo] problem with extract() raster package using
	weight=TRUE
In-Reply-To: <1379578537035-7584673.post@n2.nabble.com>
References: <1379419834336-7584665.post@n2.nabble.com>
	<CANtt_hz_m+z0WfXKcHcyuBLcokEA-E9iZNpSJbCYcn3EPW7KdA@mail.gmail.com>
	<1379578537035-7584673.post@n2.nabble.com>
Message-ID: <1379638419997-7584678.post@n2.nabble.com>

Hello Umberto and Robert,

I'm actually encountering the same problem.

- when I set weights=F, the extract function works
- when I set weights=T, I get the "Error: identicalCRS(x, y) is not TRUE"
- I've used this code before with the same shapefile and raster file (with
an older version of raster) and everything worked fine. I presume the newer
versions of extract() are more sensitive
- Following the solution by Umberto, I tried several US shape files
(including the latest one from the census
http://www.census.gov/geo/maps-data/data/tiger-line.html, which should be of
good quality)... without success. I get the same error.

Any suggestions?

Thanks

Ariel

/======================
My code looks like:

# Import shape file
poly <- readOGR("tl_2013_us_county.shp", "tl_2013_us_county")
projection(poly) # I get: "+proj=longlat +datum=NAD83 +no_defs +ellps=GRS80
+towgs84=0,0,0"

# Import raster file
r   <- raster("2012010100.NOAH.grb", nl=1)
projection(r) # I get: "+proj=longlat +a=6371200 +b=6371200 +no_defs"

# change projection of polygon
poly2 <- spTransform(poly, CRS(proj4string( r )) )
projection(poly2) # As espected, I get: ""+proj=longlat +a=6371200
+b=6371200 +no_defs"

# Extract without weights (works)
 v1 <- extract( r, poly2, cellnumbers=TRUE, progress="text")

# Extract with weights (does not work)
 v2 <- extract( r, poly2, cellnumbers=TRUE, weights=T, progress="text") 
# I get: the bar advances to 1-6% depending on the shape file and then I get
"Error: identicalCRS(x, y) is not TRUE"
/







-----
Ariel Ortiz-Bobea
Fellow at Resources for the Future
--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/problem-with-extract-raster-package-using-weight-TRUE-tp7584665p7584678.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From clement.calenge at oncfs.gouv.fr  Fri Sep 20 10:08:38 2013
From: clement.calenge at oncfs.gouv.fr (Clement Calenge)
Date: Fri, 20 Sep 2013 10:08:38 +0200
Subject: [R-sig-Geo] kernelUD {adehabitatHR} - Bug in the function or
 human error?
In-Reply-To: <523B02B8.2070101@gmail.com>
References: <523B02B8.2070101@gmail.com>
Message-ID: <523C0286.4040206@oncfs.gouv.fr>

Dear Ivan,


On 09/19/2013 03:57 PM, Pan wrote:
> Dear all,
>
> does anybody knows whether the functions kernelUD or kernel.area
> {adehabitatHR} have some kind of bug in the calculation of the kde100?
>
> I run the following script:
>
> ### Calculate KDE95 by animal and Export Polygons to shapefile
>
> library(adehabitatHR)
>
> all.xy.proj<-all.locs.proj[,c("X.CRP","Y.CRP")]
> ind.id<-as.data.frame(all.locs.proj[,"individual.local.identifier"])
> all.xy.df<-SpatialPointsDataFrame(all.xy.proj,data=ind.id,proj4string=CRS(CRP.PROJ.4))
>
> all.kde.proj<-kernelUD(all.xy.df,h="href",grid=40,same4all=F,kern="bivnorm",extent=0.5)
> all.kde.pol<-getverticeshr(all.kde.proj,percent=95,unin="m",unout="km2")
> writeOGR(obj=all.kde.pol,dsn=paste(outputdir,"KDE95",sep=""),layer="all_kde95",driver="ESRI
> Shapefile")
>
>    # Calculate Individual KDE Areas
>
> all.kde.areas<-kernel.area(all.kde.proj,percent=seq(50,100,by=5),unin="m",unout="km2")
> write.table(all.kde.areas, paste(outputdir, "all_kdelist.txt", sep=""),
> sep="\t")
>
> The result is 95% fine. The values are plausible till the kde95 then
> they increase dramatically up to factor 11.3 (e.g. kde95=350 sqKm,
> kde100=3968 sqKm).
> First I thought to outliers (e.g. sporadic exploration out of the
> territory, etc.) that might increase the kde100 value so I checked the
> mcp100. This latter is much smaller than the kde100 (mcp100=527 sqKm).
> These values are extreme but the average increase between kde95 and
> kde100 across my dataset is anyway factor 7.6!
>
> Does anybody have an explanation of this fact?

It's not a bug, it's a feature!
The kernel approach relies on the estimation of the utilization 
distribution (UD), i.e. the function giving the probability density of 
presence of an animal at a given place. The home-range, estimated at a 
given level is derived from the UD, and corresponds to the smallest area 
on which the probability of presence of the animal is equal to this 
level. In other words, to the isopleth such that the volume under the UD 
and within the limits of the isopleth is equal to this level. Thus, the 
95\% home-range corresponds to the smallest area on which the 
probability of presence of the animal is equal to 0.95. Therefore, the 
100\% home range, derived from the UD, corresponds to the whole plane, 
so that its area is, in theory, infinity. In practice, it is not because 
the UD is estimated over a restricted grid.
HTH,

Cl?ment Calenge

-- 
Cl?ment CALENGE
Cellule d'appui ? l'analyse de donn?es
Direction des Etudes et de la Recherche
Office national de la chasse et de la faune sauvage
Saint Benoist - 78610 Auffargis
tel. (33) 01.30.46.54.14


From grothered at gmail.com  Fri Sep 20 11:39:15 2013
From: grothered at gmail.com (GD)
Date: Fri, 20 Sep 2013 02:39:15 -0700 (PDT)
Subject: [R-sig-Geo] How to plot great circles on a Robinson projection
 map in ggplot2?
In-Reply-To: <03851F23-3E66-46A2-BA1C-1838F39BE74F@utoronto.ca>
References: <03851F23-3E66-46A2-BA1C-1838F39BE74F@utoronto.ca>
Message-ID: <1379669955414-7584680.post@n2.nabble.com>

I think that is covered in this question (?):
http://gis.stackexchange.com/questions/44387/use-proj4-to-specify-robinson-projection-with-r-ggmap-and-ggplot2-packages



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/How-to-plot-great-circles-on-a-Robinson-projection-map-in-ggplot2-tp7584676p7584680.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From carotenuto_francesco at yahoo.it  Fri Sep 20 12:45:10 2013
From: carotenuto_francesco at yahoo.it (Francesco Carotenuto)
Date: Fri, 20 Sep 2013 11:45:10 +0100 (BST)
Subject: [R-sig-Geo]
 =?utf-8?q?=EF=BB=BFHow_do_I_ensure_that_the_polygon_i?=
 =?utf-8?q?n_spatstat=3A=3Aowin=28poly=3D=3Cpolygon=3E=29_does_not_have_?=
 =?utf-8?b?4oCcbmVnYXRpdmUgYXJlYeKAnQ==?=
In-Reply-To: <CAHAP1TC=jqmhvdRYDKCtCkXv30jk2H5Q51cuksizqi9cj8kG2A@mail.gmail.com>
References: <CAHAP1TC=jqmhvdRYDKCtCkXv30jk2H5Q51cuksizqi9cj8kG2A@mail.gmail.com>
Message-ID: <1379673910.34693.YahooMailNeo@web133001.mail.ir2.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130920/6e50d3ca/attachment.pl>

From Roger.Bivand at nhh.no  Fri Sep 20 13:35:02 2013
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 20 Sep 2013 13:35:02 +0200
Subject: [R-sig-Geo]
	=?utf-8?q?=EF=BB=BFHow_do_I_ensure_that_the_polygon_i?=
	=?utf-8?q?n_spatstat=3A=3Aowin=28poly=3D=3Cpolygon=3E=29_does_not_?=
	=?utf-8?b?aGF2ZSDigJxuZWdhdGl2ZSBhcmVh4oCd?=
In-Reply-To: <1379673910.34693.YahooMailNeo@web133001.mail.ir2.yahoo.com>
References: <CAHAP1TC=jqmhvdRYDKCtCkXv30jk2H5Q51cuksizqi9cj8kG2A@mail.gmail.com>
	<1379673910.34693.YahooMailNeo@web133001.mail.ir2.yahoo.com>
Message-ID: <alpine.LRH.2.03.1309201325490.30022@reclus.nhh.no>

On Fri, 20 Sep 2013, Francesco Carotenuto wrote:

> Hi Jeff
> Try to type these lines:
>
> mass.map <- map("state", "massachusetts:main", fill=T)
>
> mass.win <- owin(xrange=mass.map$range[1:2],yrange=mass.map$range[3:4] )
>

This will use the bounding box as a window - there was a response on 
R-help giving one resolution:

https://stat.ethz.ch/pipermail/r-help/2013-September/360384.html

Alternatively:

library(maptools)
mass.win <- as(map2SpatialPolygons(mass.map, ID=mass.map$names), "owin")

converting the S3 map class object to an S4 SpatialPolygons object, then 
coercing to owin.

Do note that your state boundary is in geographical coordinates rather 
than planar, projected coordinates, so you may need to tread carefully if 
your subsequent analysis assumes the latter.

Roger

>
> Indeed, using this command:
> names(mass.map)
>
> you can see that your object mass.map has different columns. Columns x and y are the coordinates of all points describing the contour lines of mass.map object.
> You need to use instead the column "range" that contains the bounding box coordinates.
> In details :
>
> mass.map$range[1:2] # from 1 to 2 for the x range
>
> mass.map$range[3:4] # from 3 to 4 for the x range
>
>
> Cheers
>
>
>
> ??
> Dr. Francesco Carotenuto (Ph.D.)
> Department of Earth Sciences
> Federico II University
> Largo S. Marcellino 10,
> 80138 NAPLES (ITALY)
> http://francesco-carotenuto.blogspot.it/
> http://3dpaleontology.blogspot.it/??
> 	[[alternative HTML version deleted]]
>
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From giuseppe.amatulli at gmail.com  Fri Sep 20 18:52:16 2013
From: giuseppe.amatulli at gmail.com (Giuseppe Amatulli)
Date: Fri, 20 Sep 2013 12:52:16 -0400
Subject: [R-sig-Geo] SPATIO-TEMPORAL ANALYSIS AND BIG DATA PROCESSING USING
 FREE AND OPEN SOURCE SW
Message-ID: <CAKoiDH+24duNGjFDiDZiyUGbbEnH011Emk28ciu3PmXFEpFz0g@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130920/da469c8d/attachment.pl>

From adrian.baddeley at uwa.edu.au  Sat Sep 21 02:51:07 2013
From: adrian.baddeley at uwa.edu.au (Adrian Baddeley)
Date: Sat, 21 Sep 2013 08:51:07 +0800
Subject: [R-sig-Geo] [R-sig-geo] How do I ensure that the polygon in
 spatstat::owin(poly=<polygon>) does not have ?negative area?
In-Reply-To: <mailman.7.1379671202.32698.r-sig-geo@r-project.org>
References: <mailman.7.1379671202.32698.r-sig-geo@r-project.org>
Message-ID: <1CEF56CFF7118748AE0FA6C0186D3A3129A5B606@IS-WIN-172.staffad.uwa.edu.au>

Jeff Marcus <jeff.n.marcus at gmail.com> writes:

> I am a new user of the R spatstat package and am having problems creating a
> polygonal observation window with owin(). 

   [ ...]

>  Error in if (w.area < 0) stop(paste("Area of polygon is negative -",
> "maybe traversed in >wrong direction?")) : missing value where TRUE/FALSE
> needed

If you look carefully at this report, it does not say that the area of the polygon was negative.
It says:
    Error in <<<some code I was trying to execute>>>:  missing value where TRUE/FALSE needed

The only variable in the <<code>> is 'w.area', so this report means that the value of w.area was NA or NULL.

That's not very informative unless you go drilling into the spatstat code, but I can tell you what it means: 
when spatstat tried to calculate the polygon area to check whether it was positive or negative, 
the calculated area 'w.area' was NA or NULL.

So ... Are there any NA's in your polygon coordinates? 

(Spatstat does not currently check for NA's - I will fix that!)

Can you plot the coordinates using polygon()? 

If everything seems ok, please send me the data and I'll try to figure out what is happening.

regards
Adrian Baddeley - spatstat coauthor

Prof Adrian Baddeley FAA
University of Western Australia  /and/ CSIRO Mathematics, Informatics & Statistics
Mail: <cet.uwa.edu.au>             Skype: adrian.baddeley

------------------------------

Message: 3
Date: Thu, 19 Sep 2013 16:45:52 -0400
From: 
To: r-sig-geo at r-project.org
Subject: [R-sig-Geo] How do I ensure that the polygon in
        spatstat::owin(poly=<polygon>) does not have ?negative area?
Message-ID:
        <CAHAP1TC=jqmhvdRYDKCtCkXv30jk2H5Q51cuksizqi9cj8kG2A at mail.gmail.com>
Content-Type: text/plain

I am a new user of the R spatstat package and am having problems creating a
polygonal observation window with owin(). Code follows:

library("maps")
library ("sp")`
library("spatstat")
mass.map <- map("state", "massachusetts:main", fill=T) # This returns
a data frame includding x and y components that form a polygon of
massachusetts mainland`

mass.win <- owin(poly=data.frame(x=mass.map$x, y=mass.map$y)

 Error in if (w.area < 0) stop(paste("Area of polygon is negative -",
"maybe traversed in >wrong direction?")) : missing value where TRUE/FALSE
needed

I tried things like reversing the order of the polygon and got same error.

 mass.win <- owin(poly=data.frame(x=rev(mass.map$x), y=rev(mass.map$y)))

 Polygon contains duplicated vertices

 Polygon is self-intersecting Error in owin(poly = data.frame(x =
rev(mass.map$x), y = rev(mass.map$y))) : Polygon data contain duplicated
vertices and self-intersection

Then I figured that maybe the polygon returned by map() is not meant to be
fed to owin(). So I tried loading a massachusetts shape file (I am totally
taking guesses at this point).:

x <- readShapePoly("../Geog/OUTLINE25K_POLY") ## The shape file for
MASS, loaded from MassGIS website
mass.poly <- x <- readShapePoly("../Geog/OUTLINE25K_POLY",
force_ring=T, delete_null_obj=T) ## I got following error whether or
not I used force_ring

 mass.owin <- as(mass.poly, "owin") Checking 1006 polygons...1, Polygon 1
contains duplicated vertices [Checking polygon with 91844 edges...] 2, 3,
.. [etd 1:21:52] ....10 [etd 36:12] ..... [etd 23:10] ....20 [etd 16:59]
..... [etd 13:22] ....30 [etd 11:01] ..... [etd 9:21] ....40 [etd 8:06]
..... [etd 7:09] ....50 [etd 6:23] ..... [etd 5:46] ....60 [etd 5:15]
...[Checking polygon with 2449 edges...] .. [etd 4:49] ....70 [etd 4:27]
..... [etd 4:07] ....80 [etd 3:50] ..... [etd 3:36] ....90 [etd 3:22] .....
[etd 3:11] ....100 [ etc.

I got messages complaining about intersecting vertices, etc. and it failed
to build the polygon.

Some context on problem: I am trying to use functions in spatstat for
spatial relative risk calculations, i.e, the spatial ratio of denstity of
cases vs. controls. For that I need an observation window and point plot
within that window. I could cheat and make the observation window a
rectangle around massachusetts but that would presumably distort values
near the coast. In any case, I'd like to learn how to do this right for any
future work I do with this package. Thanks for any help you can provide.

Note: I cross-posted this to STack Overflow and then realized that r-help
is probably a better forum.


 Jeff

        [[alternative HTML version deleted]]


From adrian.baddeley at uwa.edu.au  Sat Sep 21 03:48:54 2013
From: adrian.baddeley at uwa.edu.au (Adrian Baddeley)
Date: Sat, 21 Sep 2013 09:48:54 +0800
Subject: [R-sig-Geo] relative risk (was: negative area of polygon in
	spatstat::owin)
In-Reply-To: <mailman.7.1379671202.32698.r-sig-geo@r-project.org>
References: <mailman.7.1379671202.32698.r-sig-geo@r-project.org>
Message-ID: <1CEF56CFF7118748AE0FA6C0186D3A3129A5B608@IS-WIN-172.staffad.uwa.edu.au>

PS. 

Jeff Marcus <jeff.n.marcus at gmail.com> hath writ:

  > Some context on problem: I am trying to use functions in spatstat for
 > spatial relative risk calculations, i.e, the spatial ratio of denstity of
 > cases vs. controls. For that I need an observation window and point plot
 > within that window. 
 > I could cheat and make the observation window a rectangle around massachusetts 
 > but that would presumably distort values near the coast.

In general, this is the correct approach, and this is why spatstat insists that every point pattern
must have a window.

However, for the special case of relative risk, cheating would be OK for some purposes.

The estimate of relative risk is the ratio of two density estimates, which are both subjected to the
same edge effects. So, for a given value of the smoothing bandwidth 'sigma'. the relative risk estimate
 will be the *same* if you use a larger window. This is one of the arguments made by Diggle and Rowlingson (1994).

However, automatic methods for selecting the smoothing bandwidth (such as 'bw.relrisk' or 'bw.diggle') 
will give a different answer in a larger window.

A

Prof Adrian Baddeley FAA
University of Western Australia  /and/ CSIRO Mathematics, Informatics & Statistics
Mail: <cet.uwa.edu.au>             Skype: adrian.baddeley


From r.hijmans at gmail.com  Sat Sep 21 21:58:04 2013
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Sat, 21 Sep 2013 12:58:04 -0700
Subject: [R-sig-Geo] problem with extract() raster package using
	weight=TRUE
In-Reply-To: <1379638419997-7584678.post@n2.nabble.com>
References: <1379419834336-7584665.post@n2.nabble.com>
	<CANtt_hz_m+z0WfXKcHcyuBLcokEA-E9iZNpSJbCYcn3EPW7KdA@mail.gmail.com>
	<1379578537035-7584673.post@n2.nabble.com>
	<1379638419997-7584678.post@n2.nabble.com>
Message-ID: <CANtt_hxJ5A71=9oCbhfB-CeGp092BPPDTqMDk8HYqxQmemXLbA@mail.gmail.com>

The error occurs if "over" is called; whether this happens depends on
the polygons and the raster used. In earlier versions overlay was used
and there was less checking of CRS in that case. This problem has been
fixed in the next version of raster (2.1-56). For now, I think the
work around -- unlike what I said before -- is to set the CRS of both
datasets to NA.
Robert

On Thu, Sep 19, 2013 at 5:53 PM, Ariel Ortiz-Bobea
<aortizbobea at arec.umd.edu> wrote:
> Hello Umberto and Robert,
>
> I'm actually encountering the same problem.
>
> - when I set weights=F, the extract function works
> - when I set weights=T, I get the "Error: identicalCRS(x, y) is not TRUE"
> - I've used this code before with the same shapefile and raster file (with
> an older version of raster) and everything worked fine. I presume the newer
> versions of extract() are more sensitive
> - Following the solution by Umberto, I tried several US shape files
> (including the latest one from the census
> http://www.census.gov/geo/maps-data/data/tiger-line.html, which should be of
> good quality)... without success. I get the same error.
>
> Any suggestions?
>
> Thanks
>
> Ariel
>
> /======================
> My code looks like:
>
> # Import shape file
> poly <- readOGR("tl_2013_us_county.shp", "tl_2013_us_county")
> projection(poly) # I get: "+proj=longlat +datum=NAD83 +no_defs +ellps=GRS80
> +towgs84=0,0,0"
>
> # Import raster file
> r   <- raster("2012010100.NOAH.grb", nl=1)
> projection(r) # I get: "+proj=longlat +a=6371200 +b=6371200 +no_defs"
>
> # change projection of polygon
> poly2 <- spTransform(poly, CRS(proj4string( r )) )
> projection(poly2) # As espected, I get: ""+proj=longlat +a=6371200
> +b=6371200 +no_defs"
>
> # Extract without weights (works)
>  v1 <- extract( r, poly2, cellnumbers=TRUE, progress="text")
>
> # Extract with weights (does not work)
>  v2 <- extract( r, poly2, cellnumbers=TRUE, weights=T, progress="text")
> # I get: the bar advances to 1-6% depending on the shape file and then I get
> "Error: identicalCRS(x, y) is not TRUE"
> /
>
>
>
>
>
>
>
> -----
> Ariel Ortiz-Bobea
> Fellow at Resources for the Future
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/problem-with-extract-raster-package-using-weight-TRUE-tp7584665p7584678.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From jeff.n.marcus at gmail.com  Sun Sep 22 19:07:08 2013
From: jeff.n.marcus at gmail.com (Jeff Marcus)
Date: Sun, 22 Sep 2013 13:07:08 -0400
Subject: [R-sig-Geo] [R-sig-geo] How do I ensure that the polygon in
 spatstat::owin(poly=<polygon>) does not have ?negative area?
In-Reply-To: <1CEF56CFF7118748AE0FA6C0186D3A3129A5B606@IS-WIN-172.staffad.uwa.edu.au>
References: <mailman.7.1379671202.32698.r-sig-geo@r-project.org>
	<1CEF56CFF7118748AE0FA6C0186D3A3129A5B606@IS-WIN-172.staffad.uwa.edu.au>
Message-ID: <CAHAP1TCkAFsCMsA_ZgP0FZ-uR7QZkueGqOpPAHrE_GgQcdcG1Q@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130922/847783b1/attachment.pl>

From gerardommc at gmail.com  Mon Sep 23 09:38:23 2013
From: gerardommc at gmail.com (Gerardo Martin)
Date: Mon, 23 Sep 2013 17:38:23 +1000
Subject: [R-sig-Geo] Disable MaxEnt clamping through dismo
Message-ID: <523FEFEF.5070903@gmail.com>

Hi all, I'm trying to project a series of MaxEnt models with dismo's 
implementation, does any one know how to disable the clamping through R? 
Is there such an option?

Regards

Gerardo


From u.p at operamail.com  Mon Sep 23 14:39:05 2013
From: u.p at operamail.com (up)
Date: Mon, 23 Sep 2013 05:39:05 -0700 (PDT)
Subject: [R-sig-Geo] problem with extract() raster package using
	weight=TRUE
In-Reply-To: <CANtt_hxJ5A71=9oCbhfB-CeGp092BPPDTqMDk8HYqxQmemXLbA@mail.gmail.com>
References: <1379419834336-7584665.post@n2.nabble.com>
	<CANtt_hz_m+z0WfXKcHcyuBLcokEA-E9iZNpSJbCYcn3EPW7KdA@mail.gmail.com>
	<1379578537035-7584673.post@n2.nabble.com>
	<1379638419997-7584678.post@n2.nabble.com>
	<CANtt_hxJ5A71=9oCbhfB-CeGp092BPPDTqMDk8HYqxQmemXLbA@mail.gmail.com>
Message-ID: <1379939945033-7584691.post@n2.nabble.com>

Many thanks Robert for your work, really! :-)

Another question.
With weights parameter I see the approximate fraction on of the cell is
rounded to 0.01.
Is it possible to have much resolution on that fraction, like 0.001 or more?
Perhaps is it already possible (and I've not read carefully the *man*
page...)?

Good afternoon and ciao!

Umberto



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/problem-with-extract-raster-package-using-weight-TRUE-tp7584665p7584691.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From ortiz-bobea at rff.org  Mon Sep 23 17:52:43 2013
From: ortiz-bobea at rff.org (Ariel Ortiz-Bobea)
Date: Mon, 23 Sep 2013 08:52:43 -0700 (PDT)
Subject: [R-sig-Geo] problem with extract() raster package using
	weight=TRUE
In-Reply-To: <CANtt_hxJ5A71=9oCbhfB-CeGp092BPPDTqMDk8HYqxQmemXLbA@mail.gmail.com>
References: <1379419834336-7584665.post@n2.nabble.com>
	<CANtt_hz_m+z0WfXKcHcyuBLcokEA-E9iZNpSJbCYcn3EPW7KdA@mail.gmail.com>
	<1379578537035-7584673.post@n2.nabble.com>
	<1379638419997-7584678.post@n2.nabble.com>
	<CANtt_hxJ5A71=9oCbhfB-CeGp092BPPDTqMDk8HYqxQmemXLbA@mail.gmail.com>
Message-ID: <1379951563583-7584693.post@n2.nabble.com>

That's much clever than my longer workaround using rasterize and zonal.

By the way, Umberto, my workaround could help you get more precision on the
extract weights. Hope this help others looking to do the same. See code
below:

---------------

# Create raster
   library(raster)
   r <- raster(ncol=36, nrow=18)
   r[] <- 1:ncell(r)
   cds1 <- rbind(c(-180,-20), c(-160,5), c(-60, 0), c(-160,-60),
c(-180,-20))
   cds2 <- rbind(c(80,0), c(100,60), c(120,0), c(120,-55), c(80,0))
   polys <- SpatialPolygons(list(Polygons(list(Polygon(cds1)), 1),
         
# visualize
   plot(r)
   plot(polys, add=T)
     
# Extract the cellnumbers and weights using extract()
   v <- extract(r, polys, weights=TRUE, cellnumbers=TRUE, small=TRUE)

# Extract the cellnumbers and weights using rasterize() and zonal()
   r.mod <- r
   values(r.mod) <- 1:ncell(r)
   fac <- sqrt(1000) # this is where you set the resolution factor
   r.mod <- disaggregate(r.mod, fact=c(fac, fac)) # increases raster
resolution by a factor of "fac"
   r.polys <- rasterize(x=polys, y=r.mod) # rasterize county polygons

   # Compute weights
   w <- lapply(unique(r.polys), function(x) {
      m <- r.polys
      m[getValues(m)!=x]  <- NA
      m[getValues(m)==x]  <- 1
      out <- zonal(x=m, z=r.mod, fun="sum")
      colnames(out) <- c("cell", "weight")
      out[,"weight"] <- out[,"weight"]/(fac^2)
      out[out[,"weight"]!=0,]
     })
   names(w) <- unique(r.polys)

# See weigths
 head(v[[1]])
 head(w[[1]]) 



-----
Ariel Ortiz-Bobea
Fellow at Resources for the Future
--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/problem-with-extract-raster-package-using-weight-TRUE-tp7584665p7584693.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From rpaolo1967 at gmail.com  Mon Sep 23 22:31:03 2013
From: rpaolo1967 at gmail.com (Paolo Ramoni Perazzi)
Date: Mon, 23 Sep 2013 16:01:03 -0430
Subject: [R-sig-Geo] nndist {spatstat} distance unit output
Message-ID: <CANvsoOuqNiOWfDKXEvQGKGzHnGMmewgV5CjiGFibYkm22aaYyg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130923/35930974/attachment.pl>

From r.turner at auckland.ac.nz  Tue Sep 24 01:34:55 2013
From: r.turner at auckland.ac.nz (Rolf Turner)
Date: Tue, 24 Sep 2013 11:34:55 +1200
Subject: [R-sig-Geo] nndist {spatstat} distance unit output
In-Reply-To: <CANvsoOuqNiOWfDKXEvQGKGzHnGMmewgV5CjiGFibYkm22aaYyg@mail.gmail.com>
References: <CANvsoOuqNiOWfDKXEvQGKGzHnGMmewgV5CjiGFibYkm22aaYyg@mail.gmail.com>
Message-ID: <5240D01F.8070804@auckland.ac.nz>

On 09/24/13 08:31, Paolo Ramoni Perazzi wrote:
> Hi everybody,
>
> A quite stupid question: does anybody know how to set the distance units
> (km, m, etc) when using nndist (spatstat library)?

The distance units are determined by the pattern "X" to which you are 
applying
nndist.  You can change those units by applying the rescale() function to X.

E.g.

     X <- rescale(bei,1000)
     unitname(X) <- "kilometre"

     cheers,

     Rolf Turner

P. S.  It is the spatstat ***package*** not "library"!!!  (A library is 
a *collection*
of packages.)  Repeat after me, 50 times: "spatstat ***package***, spatstat
***package***, ...."!!! :-)

     R. T.


From adrian.baddeley at uwa.edu.au  Tue Sep 24 03:03:10 2013
From: adrian.baddeley at uwa.edu.au (Adrian Baddeley)
Date: Tue, 24 Sep 2013 09:03:10 +0800
Subject: [R-sig-Geo]  nndist {spatstat} distance unit output
In-Reply-To: <5240D01F.8070804@auckland.ac.nz>
References: <CANvsoOuqNiOWfDKXEvQGKGzHnGMmewgV5CjiGFibYkm22aaYyg@mail.gmail.com>,
	<5240D01F.8070804@auckland.ac.nz>
Message-ID: <1CEF56CFF7118748AE0FA6C0186D3A3129A5B60A@IS-WIN-172.staffad.uwa.edu.au>

Just to clarify - 
    
   To set the **name** of the unit of length 
    in an object in the spatstat package,
    use  'unitname<-'
    For example
                  unitname(X) <- "km"
                  unitname(X) <- c("foot", "feet")
                  unitname(X) <- list("yard", "yards", 22)
    (The last example means that one unit is equal to 22 yards).

   To **convert the coordinates** from one unit to another, use 'rescale'
   For example if the coordinates in X are recorded in metres, then
                 X <- rescale(X, 1000)
    will convert the coordinates to kilometres (i.e. it will divide the coordinate values by 1000)
    and will also adjust the name of the unit of length accordingly. 
 
Adrian    

Prof Adrian Baddeley FAA
University of Western Australia  /and/ CSIRO Mathematics, Informatics & Statistics
Mail: <cet.uwa.edu.au>             Skype: adrian.baddeley
________________________________________
From: Rolf Turner [r.turner at auckland.ac.nz]
Sent: Tuesday, 24 September 2013 7:34 AM
To: Paolo Ramoni Perazzi
Cc: r-sig-geo at r-project.org; Adrian Baddeley
Subject: Re: [R-sig-Geo] nndist {spatstat} distance unit output

On 09/24/13 08:31, Paolo Ramoni Perazzi wrote:
> Hi everybody,
>
> A quite stupid question: does anybody know how to set the distance units
> (km, m, etc) when using nndist (spatstat library)?

The distance units are determined by the pattern "X" to which you are
applying
nndist.  You can change those units by applying the rescale() function to X.

E.g.

     X <- rescale(bei,1000)
     unitname(X) <- "kilometre"

     cheers,

     Rolf Turner

P. S.  It is the spatstat ***package*** not "library"!!!  (A library is
a *collection*
of packages.)  Repeat after me, 50 times: "spatstat ***package***, spatstat
***package***, ...."!!! :-)

     R. T.


From u.p at operamail.com  Tue Sep 24 11:43:56 2013
From: u.p at operamail.com (up)
Date: Tue, 24 Sep 2013 02:43:56 -0700 (PDT)
Subject: [R-sig-Geo] problem with extract() raster package using
	weight=TRUE
In-Reply-To: <1379951563583-7584693.post@n2.nabble.com>
References: <1379419834336-7584665.post@n2.nabble.com>
	<CANtt_hz_m+z0WfXKcHcyuBLcokEA-E9iZNpSJbCYcn3EPW7KdA@mail.gmail.com>
	<1379578537035-7584673.post@n2.nabble.com>
	<1379638419997-7584678.post@n2.nabble.com>
	<CANtt_hxJ5A71=9oCbhfB-CeGp092BPPDTqMDk8HYqxQmemXLbA@mail.gmail.com>
	<1379951563583-7584693.post@n2.nabble.com>
Message-ID: <1380015836546-7584697.post@n2.nabble.com>

Ariel Ortiz-Bobea wrote
> That's much clever than my longer workaround using rasterize and zonal.
> 
> By the way, Umberto, my workaround could help you get more precision on
> the extract weights. Hope this helps others looking to do the same. See
> code below:
> (...)

Many thanks Ariel for your suggestion! :-)
I'm going to use your piece of code to my purposes.
Buona giornata!
Umberto



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/problem-with-extract-raster-package-using-weight-TRUE-tp7584665p7584697.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From gerardommc at gmail.com  Tue Sep 24 12:47:23 2013
From: gerardommc at gmail.com (Gerardo Martin)
Date: Tue, 24 Sep 2013 20:47:23 +1000
Subject: [R-sig-Geo] Disable Maxent clamping
Message-ID: <CAAO0BLdC4eW92fFP-u4TZCRTHuNW6p0HVF-JcKCrc3dYiHp_Pw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130924/6e015f01/attachment.pl>

From huw.jones at niab.com  Tue Sep 24 17:08:54 2013
From: huw.jones at niab.com (Huw Jones)
Date: Tue, 24 Sep 2013 15:08:54 +0000
Subject: [R-sig-Geo] Testing whether sub population distributions differ
Message-ID: <5A71CBD81845BC4FB44E52CFCDA6904104BF07B9@Mailserver.niab.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130924/aef10664/attachment.pl>

From benweinstein2010 at gmail.com  Tue Sep 24 18:51:01 2013
From: benweinstein2010 at gmail.com (Ben Weinstein)
Date: Tue, 24 Sep 2013 12:51:01 -0400
Subject: [R-sig-Geo] rgdal installation error libgal.so
Message-ID: <CAC28k7TTBtGL_UAHArfCxF85HJPML19dkxwQNZzgn41joYeWjQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130924/15343bda/attachment.pl>

From alepietrek at yahoo.com.ar  Wed Sep 25 01:05:54 2013
From: alepietrek at yahoo.com.ar (Alejandro Pietrek)
Date: Tue, 24 Sep 2013 16:05:54 -0700 (PDT)
Subject: [R-sig-Geo] Merging raster does not work properly
Message-ID: <1380063954.28030.YahooMailNeo@web160606.mail.bf1.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130924/51763b98/attachment.pl>

From mdsumner at gmail.com  Wed Sep 25 01:28:54 2013
From: mdsumner at gmail.com (Michael Sumner)
Date: Wed, 25 Sep 2013 09:28:54 +1000
Subject: [R-sig-Geo] Merging raster does not work properly
In-Reply-To: <1380063954.28030.YahooMailNeo@web160606.mail.bf1.yahoo.com>
References: <1380063954.28030.YahooMailNeo@web160606.mail.bf1.yahoo.com>
Message-ID: <CAAcGz9-26tPKKJHf7POJTDzXk+-OLYn-dqnYXG2K6vEm0rDvSw@mail.gmail.com>

It seems you have divided the maximum x value by two, rather than the
x extent?  See the source for rotate which shows how to do this, but
it will probably work straight out anyway, (albeit with a warning for
data that's not in the lonlat range):

rotate(r)

Source, this uses internal structures but you could recreate with
functions xmin()/xmax()/ymin()/ymax():
findMethods("rotate")[["Raster"]]



On Wed, Sep 25, 2013 at 9:05 AM, Alejandro Pietrek
<alepietrek at yahoo.com.ar> wrote:
> Hi all,
>           I have a raster r I want to cut  in two, then place the right side to the left, and the left side to the right, and finally merge these two rasters again with the orginal raster x.
> I wrote the following piece of code to perform this task:
>
>
> r=raster(r)
> extent(r)<-extent(xmin,xmax,ymin, ymax)
> e1=extent(xmin,xmax/2,ymin,ymax)
> e2=extent(xmax/2,xmax,ymin,ymax)
> r1=crop(r,e1)
> r1=shift(r1,(-xmax/2))
> r2=crop(r,e2)
> r2=shift(r2,xmax)
> newr=merge(r,r1)
>
> When I try to merge these two rasters first I get the following message:
>
> "Error in compareRaster(x, extent = FALSE, rowcol = FALSE, orig = TRUE,  :
>   different origin"
> Looking at the extent it seems that the crop function is cropping 45 more meters than xmax/2 and that causes the differences in the origin. Actually when I shift r1, the origin is at 45 m, confirming the differences in cropping.  Any idea of how to solve this?
>
>
> Thanks!
>         [[alternative HTML version deleted]]
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



-- 
Michael Sumner
Hobart, Australia
e-mail: mdsumner at gmail.com


From p.gaffron at tuhh.de  Wed Sep 25 03:12:56 2013
From: p.gaffron at tuhh.de (Philine Gaffron)
Date: Wed, 25 Sep 2013 03:12:56 +0200
Subject: [R-sig-Geo] R encounters fatal error in errorsarlm - sdpep package
Message-ID: <20130925031256.Horde.qsxGeD1l-NpSQjiYJzG2u4A@webmail.tu-harburg.de>

Hello,

I am trying to run a spatial regression analysis using the errorsarlm  
function in the sdpep package. I first ran into memory problems (on a  
larger dataset than the one described below) but have adjusted the  
memory size limit:

> memory.limit(size = 800000)
[1] 8e+05
?
However, when I try to execute the following code in R Studio, I  
receive the message "R Session aborted - R encountered a fatal error -  
The session was terminated"

> ElDU.slm.PM25.white <- errorsarlm(PM_PM25 ~ race_white, data =  
> ElDorado_urban, listw=ElDoU_listw)

The data was imported from an ArcGIS shape file:
> Parcels2008_inc_POP <- readOGR(".", "Parcels_2008_inc_pop")
> ElDorado_urban <- subset(Parcels2008_inc_POP, COUNTYFP10 == "017")

The subset contains data from 2081 polygons

The listw object was created as follows:

> Eld_U_coords <- coordinates(ElDorado_urban)
> Eld_U_IDs <- row.names(ElDorado_urban)
> ElDoU_nb <- dnearneigh(Eld_U_coords, d1 = 0, d2 = 492, row.names = Eld_U_IDs)
> ElDoU_listw <- nb2listw(ElDoU_nb, glist=NULL, style="S", zero.policy=NULL)

Is there anything inherent in my approach that could cause this  
problem or would one need to look at the data? I include the session  
info below.

Thanks for any help,

Philine

> sessionInfo()
R version 3.0.1 (2013-05-16)
Platform: x86_64-w64-mingw32/x64 (64-bit)

locale:
[1] LC_COLLATE=English_United States.1252  LC_CTYPE=English_United  
States.1252    LC_MONETARY=English_United States.1252 LC_NUMERIC=C
[5] LC_TIME=English_United States.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] spdep_0.5-65    Matrix_1.0-12   lattice_0.20-15 rgdal_0.8-11    sp_1.0-13

loaded via a namespace (and not attached):
[1] boot_1.3-9      coda_0.16-1     deldir_0.0-22   grid_3.0.1       
LearnBayes_2.12 MASS_7.3-26     nlme_3.1-109    splines_3.0.1    
tools_3.0.1

> library(help=spdep)
Information on package ?spdep?

Description:

Package:            spdep
Version:            0.5-65
Date:               2013-09-04

-- 
Philine Gaffron PhD MLA BSc
Fellow of the German Research Foundation (DFG)
Project 'Urban Transport and Environmental Justice'
Visiting Researcher
Institute of Transportation Studies
University of California Davis

p.gaffron at tuhh.de
pgaffron at ucdavis.edu

p.gaffron at tu-harburg.de
www.vsl.tu-harburg.de


From Roger.Bivand at nhh.no  Wed Sep 25 09:53:44 2013
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 25 Sep 2013 09:53:44 +0200
Subject: [R-sig-Geo] R encounters fatal error in errorsarlm - sdpep
 package
In-Reply-To: <20130925031256.Horde.qsxGeD1l-NpSQjiYJzG2u4A@webmail.tu-harburg.de>
References: <20130925031256.Horde.qsxGeD1l-NpSQjiYJzG2u4A@webmail.tu-harburg.de>
Message-ID: <alpine.LRH.2.03.1309250933070.15434@reclus.nhh.no>

On Wed, 25 Sep 2013, Philine Gaffron wrote:

> Hello,
>
> I am trying to run a spatial regression analysis using the errorsarlm 
> function in the sdpep package. I first ran into memory problems (on a larger 
> dataset than the one described below) but have adjusted the memory size 
> limit:
>
>> memory.limit(size = 800000)
> [1] 8e+05

Which sets your memory limit under Windows to 781 Gb (size is in Mb) - 
that probably explains the error exit unless you have a lot of memory. 
Best avoid making any changes from the default in a fresh session unless 
you know exactly what you are doing.

> ?
> However, when I try to execute the following code in R Studio, I receive the 
> message "R Session aborted - R encountered a fatal error - The session was 
> terminated"

Always rerun any code with problems outside R Studio, because it can 
interfere with the reporting of warnings and errors. Certainly 
errorsarlm() has no reason to cause R to crash - and this is what you are 
suggesting. If you can reproduce this outside R Studio, and without 
setting memory limits, I may need to see your data to try to reproduce any 
error exit from the R session.

>
>> ElDU.slm.PM25.white <- errorsarlm(PM_PM25 ~ race_white, data = 
>> ElDorado_urban, listw=ElDoU_listw)

Did you read the advice on ?errorsarlm about the use of alternative 
methods, such as "LU" or "Matrix" for larger data sets? You are using the 
default "eigen" method, but this should certainly have worked for the 
modest n=2081. Can you reproduce the problem with a built-in data set, 
such as elect80?

>
> The data was imported from an ArcGIS shape file:
>> Parcels2008_inc_POP <- readOGR(".", "Parcels_2008_inc_pop")
>> ElDorado_urban <- subset(Parcels2008_inc_POP, COUNTYFP10 == "017")
>
> The subset contains data from 2081 polygons
>
> The listw object was created as follows:
>
>> Eld_U_coords <- coordinates(ElDorado_urban)
>> Eld_U_IDs <- row.names(ElDorado_urban)
>> ElDoU_nb <- dnearneigh(Eld_U_coords, d1 = 0, d2 = 492, row.names = 
>> Eld_U_IDs)

Is 492 a well-chosen upper distance threshold? I assume that the input 
data are projected, so that these are measures in the units of the 
projection - metres? If Eld_U_coords are actually geographical 
coordinates, but longlat=NULL, d2 is taken as a planar measure, if 
you declare longlat=TRUE, it is in km. There is no easy way to trap 
undeclared geographical coordinates.

>> ElDoU_listw <- nb2listw(ElDoU_nb, glist=NULL, style="S", zero.policy=NULL)
>

Does choosing a different style make a difference ("S" is not often used)?

Roger

> Is there anything inherent in my approach that could cause this problem or 
> would one need to look at the data? I include the session info below.
>
> Thanks for any help,
>
> Philine
>
>> sessionInfo()
> R version 3.0.1 (2013-05-16)
> Platform: x86_64-w64-mingw32/x64 (64-bit)
>
> locale:
> [1] LC_COLLATE=English_United States.1252  LC_CTYPE=English_United 
> States.1252    LC_MONETARY=English_United States.1252 LC_NUMERIC=C
> [5] LC_TIME=English_United States.1252
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> other attached packages:
> [1] spdep_0.5-65    Matrix_1.0-12   lattice_0.20-15 rgdal_0.8-11    sp_1.0-13
>
> loaded via a namespace (and not attached):
> [1] boot_1.3-9      coda_0.16-1     deldir_0.0-22   grid_3.0.1 
> LearnBayes_2.12 MASS_7.3-26     nlme_3.1-109    splines_3.0.1   tools_3.0.1
>
>> library(help=spdep)
> Information on package ?spdep?
>
> Description:
>
> Package:            spdep
> Version:            0.5-65
> Date:               2013-09-04
>
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From jbechara at lri-lb.org  Wed Sep 25 15:13:45 2013
From: jbechara at lri-lb.org (Joseph Bechara)
Date: Wed, 25 Sep 2013 16:13:45 +0300
Subject: [R-sig-Geo] clip shape file
Message-ID: <000701ceb9f1$11b11d40$351357c0$@lri-lb.org>

Hello, 

 

I'm trying to clip a shapefile with an extent.

Unfortunately it is not working.

Can somebody give me a hint?

 

JOSEPH BECHARA

Wildfire Management Program Coordinator

Ashrafieh 1020 Building, 8th floor, Mathaf, Beirut, Lebanon

Tel.: +961 (1) 426630-1-2

Fax: +961 (1) 426631

Mail:  <mailto:jbejjani at lri-lb.org> jbechara at lri-lb.org

 <http://www.lri-lb.org/> www.lri-lb.org

Description: Description: LRI-logo-Email

 

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130925/ce345f5a/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/jpeg
Size: 16370 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130925/ce345f5a/attachment.jpe>

From helen at rams.colostate.edu  Wed Sep 25 20:23:24 2013
From: helen at rams.colostate.edu (Helen Sofaer)
Date: Wed, 25 Sep 2013 12:23:24 -0600
Subject: [R-sig-Geo] misalignment between data projected in R and ArcGIS
Message-ID: <CAOckJBNo0b4Nd45R9NPOzi_eegskZ8w4a7wp0EZZRNi10DOTxg@mail.gmail.com>

Dear list,

I?m having some trouble with projected ESRI shapefiles I imported into
R; they don?t align with files that I projected within R without going
through ArcGIS. I?ve tried to define the projection (Albers) as
precisely as I can using rgdal and the proj4string definitions, but
the problem persists. I don?t see this problem if I bring in the data
in NAD83, and then project in within R, so I can get a workaround that
way, but at this point I?m very curious to know what inane mistake I'm
making to mess this up.

Here?s an example: it uses data for future climate scenarios that can
be downloaded online and a state boundary shapefile from ESRI. (My
analysis actually uses shapefiles of data locations and survey area
boundaries, so I can?t just skip importing them and simply using map
data within R).

I apologize that it isn?t fully replicable for those of you that don?t
have ArcGIS (I?ve tried to include some output to compensate); I also
apologize for the length!

Can anyone tell me where I?ve gone wrong?

Thanks,

Helen



library(sqldf)

library(tcltk)

library(sp)



# website for Coulson et al. future climate data:

# http://www.fs.usda.gov/rds/archive/Product/RDS-2010-0017/

# select just one month of data from future A2 scenario, limiting to
bounding envelope of study area:

## Note that a smaller area could be imported to show the issue (but
bbox output below will differ)

CGCM.A2.May2047 = read.csv.sql("Cgcm31_a2_Dec09_2041_2050.csv",

sql = "select * from file where lati_dd > 42.4 and long_dd > -113.417
and long_dd < -96.4 and year = 2047 and month = 5",

                    dbname = tempfile())

# show where points are (just based on decimal degrees, before even
defining coordinate system):

library(ggplot2)

library(maps)

StateBorders = map_data('state', region = c('south dakota', 'north
dakota', 'montana'))

p = ggplot(CGCM.A2.May2047, aes(long_dd, lati_dd)) +
geom_point(aes(size = ppt_mm)) + scale_size(range = c(0,3)) +
theme_classic()

p + geom_polygon(data = StateBorders, aes(long, lat, group = group,
fill = NA, colour = "blue", alpha = 0)) + theme(legend.position =
"none")

# This plot is hideous (code to change polygon fill and border color
didn't work...) but not worrying about it b/c purpose is to show
general location of data



## Convert to SPDF and define coordinate system as NAD83 (NOTE THAT
COORDINATE SYSTEM ISN'T EXPLICIT IN METADATA, NAD83 is based on their
source data)

CGCM.A2.May2047.SPDF = SpatialPointsDataFrame(data = CGCM.A2.May2047,

                    coords = CGCM.A2.May2047[, c("long_dd", "lati_dd")],

                    proj4string = CRS(as.character("+proj=longlat
+datum=NAD83")))

is.projected(CGCM.A2.May2047.SPDF)

proj4string(CGCM.A2.May2047.SPDF)



## Project coordinates to Albers within R:

library(rgdal)

CGCM.A2.May2047.Albers = spTransform(CGCM.A2.May2047.SPDF,
CRS("+proj=aea +lat_1=20 +lat2=60 +lat0=40 +lon_0=-96 +x_0=0 +y_0=0
+datum=NAD83 +units=m +no_defs +ellps=GRS80 +towgs84=0,0,0"))

is.projected(CGCM.A2.May2047.Albers)

proj4string(CGCM.A2.May2047.Albers)

str(CGCM.A2.May2047.Albers)



#### Show the problem I'm having with the projections when I bring
shapefiles in from GIS:

# This was downloaded from ESRI:
http://www.arcgis.com/home/item.html?id=540003aa59b047d7a1f465f7b1df1950

# Took subset of 3 states of interest and projected to Albers within ArcGIS

MT.ND.SD.boundaries.Albers.viaGIS =
readOGR("C:/Helen_PPR_GIS/ForPondModel/SpatialExtent",
"StateBoundaries_MT_ND_SD_Albers")

print(proj4string(MT.ND.SD.boundaries.Albers.viaGIS))

# [1] "+proj=aea +lat_1=20 +lat_2=60 +lat_0=40 +lon_0=-96 +x_0=0
+y_0=0 +datum=NAD83 +units=m +no_defs +ellps=GRS80 +towgs84=0,0,0"



### THE ISSUE:

# These coordinates somehow appear to have different projections -
i.e. y coordinates aren't anywhere near each other, when they should
overlap:

bbox(MT.ND.SD.boundaries.Albers.viaGIS)

#         min       max

# x -1402104.5  -33543.5

# y   293949.4 1208872.9

bbox(CGCM.A2.May2047.Albers)

#             min        max

# long_dd -1700889  -39977.89

# lati_dd  4561044 5192583.31



## Show that ArcGIS data align ok with themselves

# I input climate data into ArcCatalog as XY table (defining
coordinate system as NAD83), projected to Albers within ArcCatalog,
and then input shapefile into R:

CGCM.A2.May2047.Albers.viaGIS =
readOGR("C:/Helen_PPR_GIS/ForPondModel/SpatialExtent",
"CGCM_A2_May2047_viaGIS_Albers")

print(proj4string(CGCM.A2.May2047.Albers.viaGIS))

# [1] "+proj=aea +lat_1=20 +lat_2=60 +lat_0=40 +lon_0=-96 +x_0=0
+y_0=0 +datum=NAD83 +units=m +no_defs +ellps=GRS80 +towgs84=0,0,0"

bbox(CGCM.A2.May2047.Albers.viaGIS)

#                 min        max

# coords.x1 -1339945.8  -28821.09

# coords.x2   285437.4 1172923.00



## The two files from ArcGIS do overlap, although there are some
points that extend farther north into Canada than I would have
expected:

plot(MT.ND.SD.boundaries.Albers.viaGIS)

points(spsample(CGCM.A2.May2047.Albers.viaGIS, n = 100, type =
"random")) # easier to see with fewer points



## What if I import from GIS with the data in NAD83, rather than
already projected to Albers?

CGCM.A2.May2047.NAD83.viaGIS =
readOGR("C:/Helen_PPR_GIS/ForPondModel/SpatialExtent",
"CGCM_A2_May2047_viaGIS")

print(proj4string(CGCM.A2.May2047.NAD83.viaGIS))

bbox(CGCM.A2.May2047.NAD83.viaGIS)

# Project to Albers within R:

CGCM.A2.May2047.Albers.viaGISinNAD83 =
spTransform(CGCM.A2.May2047.NAD83.viaGIS, CRS("+proj=aea +lat_1=20
+lat2=60 +lat0=40 +lon_0=-96 +x_0=0 +y_0=0 +datum=NAD83 +units=m
+no_defs +ellps=GRS80 +towgs84=0,0,0"))

bbox(CGCM.A2.May2047.Albers.viaGISinNAD83)

#               min        max

# coords.x1 -1700889  -39977.89

# coords.x2  4561044 5192583.31

# this does align with the other data projected within R; so bringing
in unprojected shapefiles doesn't seem to be a problem


--
Helen Sofaer
Postdoctoral Fellow
Fish Wildlife and Conservation Biology
Colorado State University


From mdsumner at gmail.com  Wed Sep 25 22:20:47 2013
From: mdsumner at gmail.com (Michael Sumner)
Date: Thu, 26 Sep 2013 06:20:47 +1000
Subject: [R-sig-Geo] clip shape file
In-Reply-To: <000701ceb9f1$11b11d40$351357c0$@lri-lb.org>
References: <000701ceb9f1$11b11d40$351357c0$@lri-lb.org>
Message-ID: <CAAcGz991bhUST=YRxvSx288=1GEmsA75OJGWBY2kqiDQ_QyTdQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130926/bb326b74/attachment.pl>

From milansharma2012 at yahoo.com  Thu Sep 26 00:55:45 2013
From: milansharma2012 at yahoo.com (Milan Sharma)
Date: Wed, 25 Sep 2013 15:55:45 -0700 (PDT)
Subject: [R-sig-Geo] DIC of SAR model
Message-ID: <1380149745.29684.YahooMailNeo@web162104.mail.bf1.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130925/66902573/attachment.pl>

From tirth38 at gmail.com  Thu Sep 26 03:58:58 2013
From: tirth38 at gmail.com (Tirth Bhatta)
Date: Wed, 25 Sep 2013 21:58:58 -0400
Subject: [R-sig-Geo] Spatiotemporal Analysis
Message-ID: <CAOxU+bViDA_vM_ojrUAs7u7evsmvBnfV8nGJEC+EdCHRZh66sw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130925/d29c367e/attachment.pl>

From kridox at ymail.com  Thu Sep 26 04:26:10 2013
From: kridox at ymail.com (Pascal Oettli)
Date: Thu, 26 Sep 2013 11:26:10 +0900
Subject: [R-sig-Geo] DIC of SAR model
In-Reply-To: <1380149745.29684.YahooMailNeo@web162104.mail.bf1.yahoo.com>
References: <1380149745.29684.YahooMailNeo@web162104.mail.bf1.yahoo.com>
Message-ID: <CAAcyNCxHqhbjKSHhdk--kPrj7EJeWo60QZRXEt3WnA0PsSpSMA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130926/bb120987/attachment.pl>

From harb at student.unimelb.edu.au  Thu Sep 26 06:49:09 2013
From: harb at student.unimelb.edu.au (ben harrison)
Date: Thu, 26 Sep 2013 14:49:09 +1000
Subject: [R-sig-Geo] Can I read only a portion of a raster?
Message-ID: <5243BCC5.8010101@student.unimelb.edu.au>

I thought I could do something like this:

library(raster)
my.ext <- extent(xmn, xmx, ymn, ymx)
my.r <- raster("raster.tif", ext=my.ext)

But it still reads in the entire file. How can I read in only the 
portion I need?


From harb at student.unimelb.edu.au  Thu Sep 26 08:35:13 2013
From: harb at student.unimelb.edu.au (Ben Harrison)
Date: Thu, 26 Sep 2013 16:35:13 +1000
Subject: [R-sig-Geo] Can I read only a portion of a raster? (With more code)
Message-ID: <l20kip$5ll$1@ger.gmane.org>

I thought I could use the extent of a raster to trim it, but it ignores 
the option. Is there another way to do it?

library(raster)

r <- raster(system.file("external/test.grd", package="raster"))
print(r)

# =-=-=-=- Results:
class       : RasterLayer
dimensions  : 115, 80, 9200  (nrow, ncol, ncell)
resolution  : 40, 40  (x, y)
extent      : 178400, 181600, 329400, 334000  (xmin, xmax, ymin, ymax)
coord. ref. : +init=epsg:28992 
+towgs84=565.237,50.0087,465.658,-0.406857,0.350733,-1.87035,4.0812 
+proj=sterea +lat_0=52.15616055555555 +lon_0=5.38763888888889 
+k=0.9999079 +x_0=155000 +y_0=463000 +ellps=bessel +units=m +no_defs
data source : 
/home/blah/R/x86_64-pc-linux-gnu-library/3.0/raster/external/test.grd
names       : test
values      : 128.434, 1805.78  (min, max)
# =-=-=-=-

plot(r)

my.ext <- extent(179000, 181000, 330000, 333000)
# note: extent in relation to r's extent is smaller.
q <- raster(system.file("external/test.grd", package="raster"),
	    ext=my.ext)
print(q)

# =-=-=-=- Results:
class       : RasterLayer
dimensions  : 115, 80, 9200  (nrow, ncol, ncell)
resolution  : 40, 40  (x, y)
extent      : 178400, 181600, 329400, 334000  (xmin, xmax, ymin, ymax)
coord. ref. : +init=epsg:28992 
+towgs84=565.237,50.0087,465.658,-0.406857,0.350733,-1.87035,4.0812 
+proj=sterea +lat_0=52.15616055555555 +lon_0=5.38763888888889 
+k=0.9999079 +x_0=155000 +y_0=463000 +ellps=bessel +units=m +no_defs
data source : 
/home/blah/R/x86_64-pc-linux-gnu-library/3.0/raster/external/test.grd
names       : test
values      : 128.434, 1805.78  (min, max)
# =-=-=-=-

plot(q)
all.equal(target=r, current=q)
[1] TRUE

It reads in the entire file. How can I read in only the portion I need?

Ben.


From mdsumner at gmail.com  Thu Sep 26 08:57:59 2013
From: mdsumner at gmail.com (Michael Sumner)
Date: Thu, 26 Sep 2013 16:57:59 +1000
Subject: [R-sig-Geo] Can I read only a portion of a raster? (With more
	code)
In-Reply-To: <l20kip$5ll$1@ger.gmane.org>
References: <l20kip$5ll$1@ger.gmane.org>
Message-ID: <CAAcGz9-9RQvsqfhV6mHqj+==evsh-U2MX8pobF5XbFAZXk_o7Q@mail.gmail.com>

Use crop() once it's been "read":

r <- raster(system.file("external/test.grd", package="raster"))
my.ext <- extent(179000, 181000, 330000, 333000)
r <- crop(r, my.ext)

There's no "ext" argument to raster() for reading from a file. There
is that argument when you create a raster from scratch with no data,
as an alternative to xmin/ymin/xmax/ymax.

You can read a grid partially with rgdal, by either
1) using the index arguments to readGDAL (offset, region.dim) - but
you have to determine those index values yourself
2) using GDAL.open to create a handle to the file that can be indexed
with [,], but again you need to figure out the indexes

But, raster is pretty good at opening a file and not attempting to
read the whole thing. I would just try doing it as above with crop.

Cheers, Mike.




On Thu, Sep 26, 2013 at 4:35 PM, Ben Harrison
<harb at student.unimelb.edu.au> wrote:
> I thought I could use the extent of a raster to trim it, but it ignores the
> option. Is there another way to do it?
>
> library(raster)
>
> r <- raster(system.file("external/test.grd", package="raster"))
> print(r)
>
> # =-=-=-=- Results:
> class       : RasterLayer
> dimensions  : 115, 80, 9200  (nrow, ncol, ncell)
> resolution  : 40, 40  (x, y)
> extent      : 178400, 181600, 329400, 334000  (xmin, xmax, ymin, ymax)
> coord. ref. : +init=epsg:28992
> +towgs84=565.237,50.0087,465.658,-0.406857,0.350733,-1.87035,4.0812
> +proj=sterea +lat_0=52.15616055555555 +lon_0=5.38763888888889 +k=0.9999079
> +x_0=155000 +y_0=463000 +ellps=bessel +units=m +no_defs
> data source :
> /home/blah/R/x86_64-pc-linux-gnu-library/3.0/raster/external/test.grd
> names       : test
> values      : 128.434, 1805.78  (min, max)
> # =-=-=-=-
>
> plot(r)
>
> my.ext <- extent(179000, 181000, 330000, 333000)
> # note: extent in relation to r's extent is smaller.
> q <- raster(system.file("external/test.grd", package="raster"),
>             ext=my.ext)
> print(q)
>
> # =-=-=-=- Results:
> class       : RasterLayer
> dimensions  : 115, 80, 9200  (nrow, ncol, ncell)
> resolution  : 40, 40  (x, y)
> extent      : 178400, 181600, 329400, 334000  (xmin, xmax, ymin, ymax)
> coord. ref. : +init=epsg:28992
> +towgs84=565.237,50.0087,465.658,-0.406857,0.350733,-1.87035,4.0812
> +proj=sterea +lat_0=52.15616055555555 +lon_0=5.38763888888889 +k=0.9999079
> +x_0=155000 +y_0=463000 +ellps=bessel +units=m +no_defs
> data source :
> /home/blah/R/x86_64-pc-linux-gnu-library/3.0/raster/external/test.grd
> names       : test
> values      : 128.434, 1805.78  (min, max)
> # =-=-=-=-
>
> plot(q)
> all.equal(target=r, current=q)
> [1] TRUE
>
> It reads in the entire file. How can I read in only the portion I need?
>
> Ben.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



-- 
Michael Sumner
Hobart, Australia
e-mail: mdsumner at gmail.com


From edzer.pebesma at uni-muenster.de  Thu Sep 26 09:06:40 2013
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Thu, 26 Sep 2013 09:06:40 +0200
Subject: [R-sig-Geo] Spatiotemporal Analysis
In-Reply-To: <CAOxU+bViDA_vM_ojrUAs7u7evsmvBnfV8nGJEC+EdCHRZh66sw@mail.gmail.com>
References: <CAOxU+bViDA_vM_ojrUAs7u7evsmvBnfV8nGJEC+EdCHRZh66sw@mail.gmail.com>
Message-ID: <5243DD00.3050102@uni-muenster.de>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

You might want to look at the spatiotemporal task view:

http://cran.r-project.org/web/views/SpatioTemporal.html

package spacetime has an exploratory function, stInteraction, which
subtracks spatial means and temporal means in order to retain
space-time interactions.

On 09/26/2013 03:58 AM, Tirth Bhatta wrote:
> Hi Everyone,
> 
> I am planning to conduct spatio-temporal analysis. I would greatly 
> appreciate, if you could direct me to frequently used R-packages
> (both Frequentist and Bayesian). Is there R-package available to
> perform exploratory factor analysis, by accounting for spatial
> structure of data? Thank you so much for your inputs.
> 

- -- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
83 33081, Fax: +49 251 8339763 http://ifgi.uni-muenster.de
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.11 (GNU/Linux)
Comment: Using GnuPG with Thunderbird - http://www.enigmail.net/

iQEcBAEBAgAGBQJSQ90AAAoJEM1OCHCtOnfx4OwH/2STGKQniGYtGzsHRxmYHOsP
NxPcWFkiDPtVLFCPX05q4YdhGNnhZiCe6e1einDW8rvzK/6eX6cAMaxsERbY50Dv
HHxHDnDx+ruMyCPfIl7JIH4f7TV3Gziw0FLV7V2z4fwumDtXqhDtyTv/W/uAnTe8
aKNOpIMOZEwUB9itByQtP6zKYassW+h9sVfJu52ZOc3QUDT+wQUs0Ns+yUOBkBuM
uA0kxpAukwn2q3To7XEBwYHbpKSlPww9TAUx4o/m+lYF2f9GRwKHqF+XMZqvRKtO
JVYcoa5QLNxwEf3GEE/n+MYksHd7GxqM7M7I9J3JETRU13WEXYThTbR/q4r6Wl4=
=Urbh
-----END PGP SIGNATURE-----


From Roger.Bivand at nhh.no  Thu Sep 26 09:16:25 2013
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 26 Sep 2013 09:16:25 +0200
Subject: [R-sig-Geo] DIC of SAR model
In-Reply-To: <CAAcyNCxHqhbjKSHhdk--kPrj7EJeWo60QZRXEt3WnA0PsSpSMA@mail.gmail.com>
References: <1380149745.29684.YahooMailNeo@web162104.mail.bf1.yahoo.com>
	<CAAcyNCxHqhbjKSHhdk--kPrj7EJeWo60QZRXEt3WnA0PsSpSMA@mail.gmail.com>
Message-ID: <alpine.LRH.2.03.1309260900070.5512@reclus.nhh.no>

On Thu, 26 Sep 2013, Pascal Oettli wrote:

> Hello,
>
>> require(sos)
>> findFn('deviance information criteria')
>
> But I don't know whether it is usable with "spautolm" output. You will have
> to give it a try.

The underlying question is whether the paper fitted the simultaneous 
autoregressive model (spatial error model, SEM), or the spatial lag model 
(a.k.a. SAR) using Bayesian methods. If it did, then reporting DIC seems 
possibly sensible, if it used ML, it doesn't make much sense anyway. All 
kinds of odd things appear in published work, it's worth thinking through 
whether they should be there.

Roger

>
> Regards,
> Pascal
>
>
>
> 2013/9/26 Milan Sharma <milansharma2012 at yahoo.com>
>
>> Hi all,
>> I read in a paper that has calculated the DIC (deviance information
>> criteria) value of SAR model.
>> Using spautolm (), I fitted SAR model, and DIC()  does give an error.
>>> sar<-spautolm(Y~X1+X2,data=data,listw=listw)
>>> DIC(sar)
>> Error: could not find function "DIC"
>>
>> How do I calculate DIC value of SAR model?
>> I would appreciate any suggestions.
>> Milan
>>         [[alternative HTML version deleted]]
>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>
>
>
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From jbechara at lri-lb.org  Thu Sep 26 09:54:26 2013
From: jbechara at lri-lb.org (Joseph Bechara)
Date: Thu, 26 Sep 2013 10:54:26 +0300
Subject: [R-sig-Geo] gUnion
Message-ID: <002a01ceba8d$a0c938e0$e25baaa0$@lri-lb.org>

Thanks Mike this was very useful.

In fact I want to clip the raster to try the gUnion function to dissolve some  features.

The gUnion is working but it is giving me a SpatialPolygons and not a SpatialPolygonsDataframe .

Which make me loose the attribute table when I?m exporting the output shapefile. 

Any hints?

 

 

Thermo <- readOGR("//MAPPING-SERVER/Data/JosephVegMap/RS/Exported_New/thermo_n", layer="Thermo_n")

library(rgeos)

#Thermo

#call the head of the Thermo attribute table

VV<-Thermo at data

TT<-gUnaryUnion(Thermo,VV$Class_name)

 

JOSEPH BECHARA

Wildfire Management Program Coordinator

Ashrafieh 1020 Building, 8th floor, Mathaf, Beirut, Lebanon

Tel.: +961 (1) 426630-1-2

Fax: +961 (1) 426631

Mail:  <mailto:jbejjani at lri-lb.org> jbechara at lri-lb.org

 <http://www.lri-lb.org/> www.lri-lb.org

Description: Description: LRI-logo-Email

 

 

From: Michael Sumner [mailto:mdsumner at gmail.com] 
Sent: Wednesday, September 25, 2013 11:21 PM
To: Joseph Bechara
Cc: RsigGeo
Subject: Re: [R-sig-Geo] clip shape file

 

I use code like this: 

 

## UNTESTED

library(rgdal)

d <- readOGR("/path/to/file", "shpfile")

 

## use raster for an easy shortcut to build a clipping def

library(raster)

## dummy values, 

ext <- extent(0, 100, 10, 90)

clipe <- as(ext, "SpatialPolygons")

proj4string(clipe) <- CRS(proj4string(d))

cropd <- SpatialPolygonsDataFrame(clipe, data.frame(x = 1), match.ID = FALSE)

 

## Now do the clip

library(rgeos)

res <- gIntersection(d, cropd)

 

 

Now, for questions like this you should provide the code you are trying with even if it doesn't work so we don't have to make it up. 

 

Cheers, Mike. 

 

On Wed, Sep 25, 2013 at 11:13 PM, Joseph Bechara <jbechara at lri-lb.org> wrote:

Hello, 

 

I?m trying to clip a shapefile with an extent.

Unfortunately it is not working.

Can somebody give me a hint?

 

JOSEPH BECHARA

Wildfire Management Program Coordinator

Ashrafieh 1020 Building, 8th floor, Mathaf, Beirut, Lebanon

Tel.: +961 (1) 426630-1-2

Fax: +961 (1) 426631 <tel:%2B961%20%281%29%20426631> 

Mail:  <mailto:jbejjani at lri-lb.org> jbechara at lri-lb.org

 <http://www.lri-lb.org/> www.lri-lb.org

 

 


_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo







-- 
Michael Sumner
Hobart, Australia
e-mail: mdsumner at gmail.com 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130926/545f2e17/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/jpeg
Size: 16370 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130926/545f2e17/attachment.jpe>

From Roger.Bivand at nhh.no  Thu Sep 26 09:59:47 2013
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 26 Sep 2013 09:59:47 +0200
Subject: [R-sig-Geo] gUnion
In-Reply-To: <002a01ceba8d$a0c938e0$e25baaa0$@lri-lb.org>
References: <002a01ceba8d$a0c938e0$e25baaa0$@lri-lb.org>
Message-ID: <alpine.LRH.2.03.1309260957371.5512@reclus.nhh.no>

On Thu, 26 Sep 2013, Joseph Bechara wrote:

> Thanks Mike this was very useful.
>
> In fact I want to clip the raster to try the gUnion function to dissolve 
> some features.
>
> The gUnion is working but it is giving me a SpatialPolygons and not a 
> SpatialPolygonsDataframe .

Obviously - how is the function to know which new features correspond to 
the dissolved ones? The row.names() of the input and output objects should 
provide some guidance about what has ended up where.

Roger

>
> Which make me loose the attribute table when I?m exporting the output 
> shapefile.
>
> Any hints?
>
>
>
>
>
> Thermo <- readOGR("//MAPPING-SERVER/Data/JosephVegMap/RS/Exported_New/thermo_n", layer="Thermo_n")
>
> library(rgeos)
>
> #Thermo
>
> #call the head of the Thermo attribute table
>
> VV<-Thermo at data
>
> TT<-gUnaryUnion(Thermo,VV$Class_name)
>
>
>
> JOSEPH BECHARA
>
> Wildfire Management Program Coordinator
>
> Ashrafieh 1020 Building, 8th floor, Mathaf, Beirut, Lebanon
>
> Tel.: +961 (1) 426630-1-2
>
> Fax: +961 (1) 426631
>
> Mail:  <mailto:jbejjani at lri-lb.org> jbechara at lri-lb.org
>
> <http://www.lri-lb.org/> www.lri-lb.org
>
> Description: Description: LRI-logo-Email
>
>
>
>
>
> From: Michael Sumner [mailto:mdsumner at gmail.com]
> Sent: Wednesday, September 25, 2013 11:21 PM
> To: Joseph Bechara
> Cc: RsigGeo
> Subject: Re: [R-sig-Geo] clip shape file
>
>
>
> I use code like this:
>
>
>
> ## UNTESTED
>
> library(rgdal)
>
> d <- readOGR("/path/to/file", "shpfile")
>
>
>
> ## use raster for an easy shortcut to build a clipping def
>
> library(raster)
>
> ## dummy values,
>
> ext <- extent(0, 100, 10, 90)
>
> clipe <- as(ext, "SpatialPolygons")
>
> proj4string(clipe) <- CRS(proj4string(d))
>
> cropd <- SpatialPolygonsDataFrame(clipe, data.frame(x = 1), match.ID = FALSE)
>
>
>
> ## Now do the clip
>
> library(rgeos)
>
> res <- gIntersection(d, cropd)
>
>
>
>
>
> Now, for questions like this you should provide the code you are trying with even if it doesn't work so we don't have to make it up.
>
>
>
> Cheers, Mike.
>
>
>
> On Wed, Sep 25, 2013 at 11:13 PM, Joseph Bechara <jbechara at lri-lb.org> wrote:
>
> Hello,
>
>
>
> I?m trying to clip a shapefile with an extent.
>
> Unfortunately it is not working.
>
> Can somebody give me a hint?
>
>
>
> JOSEPH BECHARA
>
> Wildfire Management Program Coordinator
>
> Ashrafieh 1020 Building, 8th floor, Mathaf, Beirut, Lebanon
>
> Tel.: +961 (1) 426630-1-2
>
> Fax: +961 (1) 426631 <tel:%2B961%20%281%29%20426631>
>
> Mail:  <mailto:jbejjani at lri-lb.org> jbechara at lri-lb.org
>
> <http://www.lri-lb.org/> www.lri-lb.org
>
>
>
>
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
>
>
>
>
>
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From senator at ecotoxicology.de  Thu Sep 26 12:34:41 2013
From: senator at ecotoxicology.de (=?iso-8859-1?Q?Ralf_Sch=E4fer?=)
Date: Thu, 26 Sep 2013 12:34:41 +0200
Subject: [R-sig-Geo] misalignment between data projected in R and ArcGIS
	(Helen Sofaer)
Message-ID: <D2995F9A-9841-4F9A-B902-D24AB0271B68@ecotoxicology.de>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130926/461e9292/attachment.pl>

From cyndyh at nmsu.edu  Thu Sep 26 18:04:09 2013
From: cyndyh at nmsu.edu (cyndy-jer)
Date: Thu, 26 Sep 2013 09:04:09 -0700 (PDT)
Subject: [R-sig-Geo] plotting polygons of one shapefile in different colors?
Message-ID: <1380211448978-7584720.post@n2.nabble.com>

Hi folks -

Pardon some real rank newbie questions; I am very well versed in using
ArcGIS but something of a newbie to R, and just starting out doing GIS in R.  

I've installed sp, rgdal, and maptools, and now I'm trying to get some
mapping done!  

I've been able to load a type of shapefile I am currently in need of working
with.  It is a set of polygons, that are grouped into different strata that
may or may not be contiguous.  There is a field in the shapefile that
denotes which polygons are grouped together.  I hope it is clear what I
have?  

I can readily plot the entire polygon shapefile; what I have not been able
to work out is, how to access the field in the shapefile that groups them,
and plot each polygon group in a different color.   In ArcGIS, my shapefile
has a field named 'n' that represents the grouping.  How would I go about
making a map that shows my polygons grouped by 'n' in different colors? 

Thanks in advance for any pointers!





--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/plotting-polygons-of-one-shapefile-in-different-colors-tp7584720.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From helen at rams.colostate.edu  Thu Sep 26 18:05:50 2013
From: helen at rams.colostate.edu (Helen Sofaer)
Date: Thu, 26 Sep 2013 10:05:50 -0600
Subject: [R-sig-Geo] misalignment between data projected in R and ArcGIS
	(Helen Sofaer)
In-Reply-To: <D2995F9A-9841-4F9A-B902-D24AB0271B68@ecotoxicology.de>
References: <D2995F9A-9841-4F9A-B902-D24AB0271B68@ecotoxicology.de>
Message-ID: <CAOckJBPMzLf+nanG_xGNd5=b5W1Cr_Q1SerRsEKMp6oMWKCTow@mail.gmail.com>

Thanks for taking the time to look at it Ralf.
I wish that was the problem (I had transformed from WGS 84). Here's a
simpler example that just relies on the future climate data, since I
realized there's no reason to bring in that state boundary data beyond
to show that both programs were consistent with themselves for
different data.
What I find is that if I project the data in R I get very different
results than if I project the data in ArcCatalog. The reason this is
so surprising to me is that I'm defining my proj4 string to match what
is coming from GIS.

I may very well be messing this up somehow within ArcGIS, rather than
within R; it does seem like I've made a simple but major mistake
somewhere along the way (and I admit I'm more comfortable in R, which
is why I'm going through this to begin with). Can anyone else with GIS
(I have 10.1) replicate this issue? The decimal degrees used in my
example are at the end of the code, but I'd guess that one would see
the same thing with any other point locations.

Thanks again,
Helen


# Simple version:
library(sp)
library(rgdal)

# just take 10 rows (see earlier code for importing data, or copy
long/lat from end)
set.seed(123)
CGCM.Sample10 = CGCM.A2.May2047[sample(nrow(CGCM.A2.May2047), 10), ]
write.csv(CGCM.Sample10, "CGCM.Sample10.csv") # for bringing into ArcGIS

# convert to SPDF, assuming NAD83
CGCM.Sample10 = SpatialPointsDataFrame(data = CGCM.Sample10,
            coords = CGCM.Sample10[, c("long_dd", "lati_dd")],
            proj4string = CRS(as.character("+proj=longlat +datum=NAD83")))
# project to Albers
CGCM.Sample10.Albers = spTransform(CGCM.Sample10, CRS("+proj=aea
+lat_1=20 +lat2=60 +lat0=40 +lon_0=-96 +x_0=0 +y_0=0 +datum=NAD83
+units=m +no_defs +ellps=GRS80 +towgs84=0,0,0"))
bbox(CGCM.Sample10.Albers)
#             min       max
# long_dd -1617766 -136530.6
# lati_dd  4702653 5158505.5

# Import same points from ArcGIS; CGCM.Sample10.csv was brought into
ArcCatalog as XY table in NAD83 and converted to shapefile (i.e.
without projected to Albers within GIS):
CGCM.Sample10.viaGIS.NAD83 =
readOGR("C:/Helen_PPR_GIS/ForPondModel/SpatialExtent",
"CGCM_Sample10_viaGIS_NAD83")
print(proj4string(CGCM.Sample10.viaGIS.NAD83))
# [1] "+proj=longlat +datum=NAD83 +no_defs +ellps=GRS80 +towgs84=0,0,0"

# if I project these data in R, I get the same results as before:
CGCM.Sample10.Albers.NotProjectedinGIS =
spTransform(CGCM.Sample10.viaGIS.NAD83, CRS("+proj=aea +lat_1=20
+lat2=60 +lat0=40 +lon_0=-96 +x_0=0 +y_0=0 +datum=NAD83 +units=m
+no_defs +ellps=GRS80 +towgs84=0,0,0"))
bbox(CGCM.Sample10.Albers.NotProjectedinGIS)
#               min       max
# coords.x1 -1617766 -136530.6
# coords.x2  4702653 5158505.5

## The problem arises when I import data that have already been
projected within ArcGIS
# Using 'North America Albers Equal Area Conic' projection in GIS
CGCM.Sample10.viaGIS.Albers =
readOGR("C:/Helen_PPR_GIS/ForPondModel/SpatialExtent",
"CGCM_Sample10_viaGIS_Albers")
print(proj4string(CGCM.Sample10.viaGIS.Albers))
# [1] "+proj=aea +lat_1=20 +lat_2=60 +lat_0=40 +lon_0=-96 +x_0=0
+y_0=0 +datum=NAD83 +units=m +no_defs +ellps=GRS80 +towgs84=0,0,0"
bbox(CGCM.Sample10.viaGIS.Albers)
#                 min       max
# coords.x1 -1238062.2 -100922.4
# coords.x2   481037.2 1091090.2

# Full coordinates projected in R:
cbind(CGCM.Sample10.Albers at coords, CGCM.Sample10.Albers at data$long_dd,
CGCM.Sample10.Albers at data$lati_dd)
# Output (Albers X, Y, Decimal degrees X, Y):
                                            long_dd       lati_dd
 [1,] -1207845.6   5150590     -108.58333   48.75000
 [2,]  -386539.6    4920224     -100.00000   46.33333
 [3,] -1010183.5   5072255     -106.50000   47.91667
 [4,]  -231920.7    5142912     -98.41667    48.91667
 [5,]  -136530.6    5006086     -97.41667    47.33333
 [6,] -1617766.1   4801139     -112.66667   44.58333
 [7,]  -818944.6    4702653     -104.41667  43.83333
 [8,]  -216357.0    5078695     -98.25000    48.16667
 [9,]  -775495.3    5158506     -104.08333  49.00000
[10,]  -934670.2   4909220     -105.66667  46.08333

# Full coordinates projected in GIS:
cbind(CGCM.Sample10.viaGIS.Albers at coords,
CGCM.Sample10.viaGIS.Albers at data$long_dd,
CGCM.Sample10.viaGIS.Albers at data$lati_dd)
# Output (Albers X, Y, Decimal degrees X, Y):
[1,]  -871738.7   1091090.2    -108.58333 48.75000
 [2,]  -289861.4  754322.3     -100.00000 46.33333
 [3,]  -738909.7  975962.3     -106.50000 47.91667
 [4,]  -167394.6 1054895.9     -98.41667 48.91667
 [5,]  -100922.4  866975.6     -97.41667 47.33333
 [6,] -1238062.2  650570.7    -112.66667 44.58333
 [7,]  -635489.0  481037.2     -104.41667 43.83333
 [8,]  -157948.0  966332.5     -98.25000 48.16667
 [9,]  -558453.2 1086390.0    -104.08333 49.00000
[10,]  -702497.8  754532.6    -105.66667 46.08333

On Thu, Sep 26, 2013 at 4:34 AM, Ralf Sch?fer <senator at ecotoxicology.de> wrote:
> Dear Helen,
>
> I do not have access to ArcGIS - so I can not even open the file (I can
> unzip the .lpk but not open the .sdc file). However, the package information
> says that the data is in WGS 84 - so if you imported into R you need to
> assign WGS 84 first and then convert and this should work.
> From memory, ArcGIS or QGIS always assign a CRS on opening so make sure it
> is the correct one before projection.
> From my experience, in 99% of cases where students struggled with the CRS it
> was an issue with QGIS and ArcGIS.
>
> Best regards,
>
> Ralf Sch?fer
>
> ------------------------------------------------------------
>
> Prof. Dr. habil. Ralf Bernhard Sch?fer
> Juniorprofessor for Quantitative Landscape Ecology
> Environmental Scientist (M.Sc.)
> Institute for Environmental Sciences
> University Koblenz-Landau
> Fortstrasse 7
> 76829 Landau
> Germany
> Mail: schaefer-ralf at uni-landau.de
> Phone: ++49 (0) 6341 280-31536
> Web: www.landscapecology.uni-landau.de
>
>
>
>
>
>
>
>
>
>
>



-- 
Helen Sofaer
Postdoctoral Fellow
Fish Wildlife and Conservation Biology
Colorado State University


From M.Huck at derby.ac.uk  Thu Sep 26 18:28:31 2013
From: M.Huck at derby.ac.uk (Maren Huck)
Date: Thu, 26 Sep 2013 17:28:31 +0100
Subject: [R-sig-Geo] plotting polygons of one shapefile in different
 colors?
In-Reply-To: <1380211448978-7584720.post@n2.nabble.com>
References: <1380211448978-7584720.post@n2.nabble.com>
Message-ID: <0E1E893FE7447F4F883C415B21D0E5E901246E1BB3CF@MKT-MBX01.university.ds.derby.ac.uk>

Hi Cyndy (?),
I am right now in a similar process, and I came up with this code for my dataset:
If you use the shapefile directly (not via spplot):
"habit" in this case is the name of the shapefile.
"GRIDCODE" is the column which identifies the different habitat types (polygons)
I then create a new attribute for the shapefile with the third code line. You would obviously have to change the word "habit", but everything else stays as it is.
The following lines then assign a colour to each "GRIDCODE" (the GRIDCODE is a number from 0 to 10).
And the final line plots the map.

habit$GRIDCODE<-as.factor(habit$GRIDCODE)
habit at data$COLOUR <- "#FFFFFF"
habit at data$COLOUR[(as.numeric(as.character(habit at data$GRIDCODE)) %% 10) == 0] <- "grey"
habit at data$COLOUR[(as.numeric(as.character(habit at data$GRIDCODE)) %% 10) == 1] <- "green2"
habit at data$COLOUR[(as.numeric(as.character(habit at data$GRIDCODE)) %% 10) == 1] <- "green2"
habit at data$COLOUR[(as.numeric(as.character(habit at data$GRIDCODE)) %% 10) == 2] <- "darkseagreen"
habit at data$COLOUR[(as.numeric(as.character(habit at data$GRIDCODE)) %% 10) == 4] <- "pink"
habit at data$COLOUR[(as.numeric(as.character(habit at data$GRIDCODE)) %% 10) == 5] <- "darkgreen"
habit at data$COLOUR[(as.numeric(as.character(habit at data$GRIDCODE)) %% 10) == 6] <- "lightblue"
habit at data$COLOUR[(as.numeric(as.character(habit at data$GRIDCODE)) %% 10) == 7] <- "green"
habit at data$COLOUR[(as.numeric(as.character(habit at data$GRIDCODE)) %% 10) == 8] <- "blue"
habit at data$COLOUR[(as.numeric(as.character(habit at data$GRIDCODE)) %% 10) == 9] <- "navy"
habit at data$COLOUR[(as.numeric(as.character(habit at data$GRIDCODE)) %% 10) == 10] <- "orange"
plot(habit, col=habit$COLOUR, add=T)


If you want to use spplot, its slightly different:
I first create a vector with colour names. The "Helen_trans" bit in the second line is are spatial points (radiolocations of a badger)
code<-c("grey", "green2", "darkseagreen", "pink", "darkgreen", "lightblue", "green", "blue", "navy", "orange")
spplot(habit, zcol="GRIDCODE", col.regions=code, sp.layout=list("sp.points", Helen_trans, pch=16, col="blue"))

I hope this helps.
Maren

Maren Huck
Dep. of Biological and Forensic Sciences
University of Derby
Kedleston Road
Derby DE22 1GB
U.K.
Tel: +44-(0)1332-59 2354


-----Original Message-----
From: r-sig-geo-bounces at r-project.org [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of cyndy-jer
Sent: 26 September 2013 17:04
To: r-sig-geo at r-project.org
Subject: [R-sig-Geo] plotting polygons of one shapefile in different colors?

Hi folks -

Pardon some real rank newbie questions; I am very well versed in using ArcGIS but something of a newbie to R, and just starting out doing GIS in R.  

I've installed sp, rgdal, and maptools, and now I'm trying to get some mapping done!  

I've been able to load a type of shapefile I am currently in need of working with.  It is a set of polygons, that are grouped into different strata that may or may not be contiguous.  There is a field in the shapefile that denotes which polygons are grouped together.  I hope it is clear what I have?  

I can readily plot the entire polygon shapefile; what I have not been able to work out is, how to access the field in the shapefile that groups them,
and plot each polygon group in a different color.   In ArcGIS, my shapefile
has a field named 'n' that represents the grouping.  How would I go about making a map that shows my polygons grouped by 'n' in different colors? 

Thanks in advance for any pointers!





--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/plotting-polygons-of-one-shapefile-in-different-colors-tp7584720.html
Sent from the R-sig-geo mailing list archive at Nabble.com.

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo

_____________________________________________________________________
The University of Derby has a published policy regarding email and reserves the right to monitor email traffic. If you believe this email was sent to you in error, please notify the sender and delete this email. Please direct any concerns to Infosec at derby.ac.uk.


From senator at ecotoxicology.de  Thu Sep 26 18:59:14 2013
From: senator at ecotoxicology.de (=?iso-8859-1?Q?Ralf_Sch=E4fer?=)
Date: Thu, 26 Sep 2013 18:59:14 +0200
Subject: [R-sig-Geo] misalignment between data projected in R and ArcGIS
	(Helen Sofaer)
In-Reply-To: <CAOckJBPMzLf+nanG_xGNd5=b5W1Cr_Q1SerRsEKMp6oMWKCTow@mail.gmail.com>
References: <D2995F9A-9841-4F9A-B902-D24AB0271B68@ecotoxicology.de>
	<CAOckJBPMzLf+nanG_xGNd5=b5W1Cr_Q1SerRsEKMp6oMWKCTow@mail.gmail.com>
Message-ID: <44D5B8AC-9D76-411F-96D1-CA4BE186D85E@ecotoxicology.de>

Dear Helen, dear all,

it seems that indeed R is the source of the error.

For the points in Decimal Degrees
> -108.58333   48.75000


I checked with GDAL tools in Shell:

gdaltransform -s_srs EPSG:4326 -t_srs '+proj=aea +lat_1=20 +lat_2=60 +lat_0=40 +lon_0=-96 +x_0=0 +y_0=0 +datum=NAD83 +units=m +no_defs +ellps=GRS80 +towgs84=0,0,0'
-108.58333 48.75000

and obtain
-871738.467677399 1091090.13492387

System information:
gdaltransform --version
GDAL 1.10.0, released 2013/04/24
uname
Darwin
(OS X 10.8.5)


whereas in R I obtain with:
library(sp)
dat <- SpatialPoints(matrix(data = c(-108.58333, 48.75000), ncol=2))
dat at proj4string  <- CRS("+proj=longlat +datum=WGS84")
library(rgdal)
spTransform(dat, CRS("+proj=aea +lat_1=20 +lat2=60 +lat0=40 +lon_0=-96 +x_0=0 +y_0=0 +datum=NAD83 +units=m +no_defs +ellps=GRS80 +towgs84=0,0,0"))

 -1207845   5150590
as Helen already has pointed out.

So something seems to go wrong in spTransform - but others are probably better in checking this - or whether we are somehow confusing sth.

I post my system information 
R version 3.0.2 (2013-09-25)
Platform: x86_64-apple-darwin10.8.0 (64-bit)
locale:
[1] de_DE.UTF-8/de_DE.UTF-8/de_DE.UTF-8/C/de_DE.UTF-8/de_DE.UTF-8

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
[1] rgdal_0.8-11 sp_1.0-13   

loaded via a namespace (and not attached):
[1] grid_3.0.2      lattice_0.20-23 tools_3.0.2 

and rgdal gives:
rgdal: version: 0.8-11, (SVN revision 479M)
Geospatial Data Abstraction Library extensions to R successfully loaded
Loaded GDAL runtime: GDAL 1.9.2, released 2012/10/08
Path to GDAL shared files: /Users/ralfs/Library/R/3.0/library/rgdal/gdal
Loaded PROJ.4 runtime: Rel. 4.8.0, 6 March 2012, [PJ_VERSION: 480]
Path to PROJ.4 shared files: /Users/ralfs/Library/R/3.0/library/rgdal/proj

Best regards
Ralf


Am 26.09.2013 um 18:05 schrieb Helen Sofaer <helen at rams.colostate.edu>:

> Thanks for taking the time to look at it Ralf.
> I wish that was the problem (I had transformed from WGS 84). Here's a
> simpler example that just relies on the future climate data, since I
> realized there's no reason to bring in that state boundary data beyond
> to show that both programs were consistent with themselves for
> different data.
> What I find is that if I project the data in R I get very different
> results than if I project the data in ArcCatalog. The reason this is
> so surprising to me is that I'm defining my proj4 string to match what
> is coming from GIS.
> 
> I may very well be messing this up somehow within ArcGIS, rather than
> within R; it does seem like I've made a simple but major mistake
> somewhere along the way (and I admit I'm more comfortable in R, which
> is why I'm going through this to begin with). Can anyone else with GIS
> (I have 10.1) replicate this issue? The decimal degrees used in my
> example are at the end of the code, but I'd guess that one would see
> the same thing with any other point locations.
> 
> Thanks again,
> Helen
> 
> 
> # Simple version:
> library(sp)
> library(rgdal)
> 
> # just take 10 rows (see earlier code for importing data, or copy
> long/lat from end)
> set.seed(123)
> CGCM.Sample10 = CGCM.A2.May2047[sample(nrow(CGCM.A2.May2047), 10), ]
> write.csv(CGCM.Sample10, "CGCM.Sample10.csv") # for bringing into ArcGIS
> 
> # convert to SPDF, assuming NAD83
> CGCM.Sample10 = SpatialPointsDataFrame(data = CGCM.Sample10,
>            coords = CGCM.Sample10[, c("long_dd", "lati_dd")],
>            proj4string = CRS(as.character("+proj=longlat +datum=NAD83")))
> # project to Albers
> CGCM.Sample10.Albers = spTransform(CGCM.Sample10, CRS("+proj=aea
> +lat_1=20 +lat2=60 +lat0=40 +lon_0=-96 +x_0=0 +y_0=0 +datum=NAD83
> +units=m +no_defs +ellps=GRS80 +towgs84=0,0,0"))
> bbox(CGCM.Sample10.Albers)
> #             min       max
> # long_dd -1617766 -136530.6
> # lati_dd  4702653 5158505.5
> 
> # Import same points from ArcGIS; CGCM.Sample10.csv was brought into
> ArcCatalog as XY table in NAD83 and converted to shapefile (i.e.
> without projected to Albers within GIS):
> CGCM.Sample10.viaGIS.NAD83 =
> readOGR("C:/Helen_PPR_GIS/ForPondModel/SpatialExtent",
> "CGCM_Sample10_viaGIS_NAD83")
> print(proj4string(CGCM.Sample10.viaGIS.NAD83))
> # [1] "+proj=longlat +datum=NAD83 +no_defs +ellps=GRS80 +towgs84=0,0,0"
> 
> # if I project these data in R, I get the same results as before:
> CGCM.Sample10.Albers.NotProjectedinGIS =
> spTransform(CGCM.Sample10.viaGIS.NAD83, CRS("+proj=aea +lat_1=20
> +lat2=60 +lat0=40 +lon_0=-96 +x_0=0 +y_0=0 +datum=NAD83 +units=m
> +no_defs +ellps=GRS80 +towgs84=0,0,0"))
> bbox(CGCM.Sample10.Albers.NotProjectedinGIS)
> #               min       max
> # coords.x1 -1617766 -136530.6
> # coords.x2  4702653 5158505.5
> 
> ## The problem arises when I import data that have already been
> projected within ArcGIS
> # Using 'North America Albers Equal Area Conic' projection in GIS
> CGCM.Sample10.viaGIS.Albers =
> readOGR("C:/Helen_PPR_GIS/ForPondModel/SpatialExtent",
> "CGCM_Sample10_viaGIS_Albers")
> print(proj4string(CGCM.Sample10.viaGIS.Albers))
> # [1] "+proj=aea +lat_1=20 +lat_2=60 +lat_0=40 +lon_0=-96 +x_0=0
> +y_0=0 +datum=NAD83 +units=m +no_defs +ellps=GRS80 +towgs84=0,0,0"
> bbox(CGCM.Sample10.viaGIS.Albers)
> #                 min       max
> # coords.x1 -1238062.2 -100922.4
> # coords.x2   481037.2 1091090.2
> 
> # Full coordinates projected in R:
> cbind(CGCM.Sample10.Albers at coords, CGCM.Sample10.Albers at data$long_dd,
> CGCM.Sample10.Albers at data$lati_dd)
> # Output (Albers X, Y, Decimal degrees X, Y):
>                                            long_dd       lati_dd
> [1,] -1207845.6   5150590     -108.58333   48.75000
> [2,]  -386539.6    4920224     -100.00000   46.33333
> [3,] -1010183.5   5072255     -106.50000   47.91667
> [4,]  -231920.7    5142912     -98.41667    48.91667
> [5,]  -136530.6    5006086     -97.41667    47.33333
> [6,] -1617766.1   4801139     -112.66667   44.58333
> [7,]  -818944.6    4702653     -104.41667  43.83333
> [8,]  -216357.0    5078695     -98.25000    48.16667
> [9,]  -775495.3    5158506     -104.08333  49.00000
> [10,]  -934670.2   4909220     -105.66667  46.08333
> 
> # Full coordinates projected in GIS:
> cbind(CGCM.Sample10.viaGIS.Albers at coords,
> CGCM.Sample10.viaGIS.Albers at data$long_dd,
> CGCM.Sample10.viaGIS.Albers at data$lati_dd)
> # Output (Albers X, Y, Decimal degrees X, Y):
> [1,]  -871738.7   1091090.2    -108.58333 48.75000
> [2,]  -289861.4  754322.3     -100.00000 46.33333
> [3,]  -738909.7  975962.3     -106.50000 47.91667
> [4,]  -167394.6 1054895.9     -98.41667 48.91667
> [5,]  -100922.4  866975.6     -97.41667 47.33333
> [6,] -1238062.2  650570.7    -112.66667 44.58333
> [7,]  -635489.0  481037.2     -104.41667 43.83333
> [8,]  -157948.0  966332.5     -98.25000 48.16667
> [9,]  -558453.2 1086390.0    -104.08333 49.00000
> [10,]  -702497.8  754532.6    -105.66667 46.08333
> 
> On Thu, Sep 26, 2013 at 4:34 AM, Ralf Sch?fer <senator at ecotoxicology.de> wrote:
>> Dear Helen,
>> 
>> I do not have access to ArcGIS - so I can not even open the file (I can
>> unzip the .lpk but not open the .sdc file). However, the package information
>> says that the data is in WGS 84 - so if you imported into R you need to
>> assign WGS 84 first and then convert and this should work.
>> From memory, ArcGIS or QGIS always assign a CRS on opening so make sure it
>> is the correct one before projection.
>> From my experience, in 99% of cases where students struggled with the CRS it
>> was an issue with QGIS and ArcGIS.
>> 
>> Best regards,
>> 
>> Ralf Sch?fer
>> 
>> ------------------------------------------------------------
>> 
>> Prof. Dr. habil. Ralf Bernhard Sch?fer
>> Juniorprofessor for Quantitative Landscape Ecology
>> Environmental Scientist (M.Sc.)
>> Institute for Environmental Sciences
>> University Koblenz-Landau
>> Fortstrasse 7
>> 76829 Landau
>> Germany
>> Mail: schaefer-ralf at uni-landau.de
>> Phone: ++49 (0) 6341 280-31536
>> Web: www.landscapecology.uni-landau.de
>> 
>> 
>> 
>> 
>> 
>> 
>> 
>> 
>> 
>> 
>> 
> 
> 
> 
> -- 
> Helen Sofaer
> Postdoctoral Fellow
> Fish Wildlife and Conservation Biology
> Colorado State University


From helen at rams.colostate.edu  Thu Sep 26 19:55:48 2013
From: helen at rams.colostate.edu (Helen Sofaer)
Date: Thu, 26 Sep 2013 11:55:48 -0600
Subject: [R-sig-Geo] misalignment between data projected in R and ArcGIS
	(Helen Sofaer)
In-Reply-To: <44D5B8AC-9D76-411F-96D1-CA4BE186D85E@ecotoxicology.de>
References: <D2995F9A-9841-4F9A-B902-D24AB0271B68@ecotoxicology.de>
	<CAOckJBPMzLf+nanG_xGNd5=b5W1Cr_Q1SerRsEKMp6oMWKCTow@mail.gmail.com>
	<44D5B8AC-9D76-411F-96D1-CA4BE186D85E@ecotoxicology.de>
Message-ID: <CAOckJBM7ptE0V1=WGuA6C4A+bCfOfyPmJ+q4xPNn-+GVTqjNtA@mail.gmail.com>

Thanks Ralf!
This is definitely getting interesting. Someone pointed out to me off
list that it looked like these were decimal degrees in WGS84, rather
than NAD83. (It's not clear from the metadata, and after emailing the
person and not getting a straight answer about the coordinate system,
I had assumed it was the same as their source data, which are in
NAD83.)
When I run it again (all in R) assuming WGS84 for the initial data, I
get the same results as I was getting from GIS (i.e. -871738.7,
1091090.2 for the point Ralf focused on). So from my perspective it
looks like the problem was in my assumption that these were in NAD83.
But, it looks like Ralf didn't go wrong there - his code is already
all for WGS84 - so I'm not sure what's going on.

I had always understood that NAD83 and WGS84 were almost the same, so
I'm surprised that the results I was getting before (and that Ralf is
still getting) are very different when it is done through R, but not
when it is done through GIS.

Helen

On Thu, Sep 26, 2013 at 10:59 AM, Ralf Sch?fer <senator at ecotoxicology.de> wrote:
> Dear Helen, dear all,
>
> it seems that indeed R is the source of the error.
>
> For the points in Decimal Degrees
>> -108.58333   48.75000
>
>
> I checked with GDAL tools in Shell:
>
> gdaltransform -s_srs EPSG:4326 -t_srs '+proj=aea +lat_1=20 +lat_2=60 +lat_0=40 +lon_0=-96 +x_0=0 +y_0=0 +datum=NAD83 +units=m +no_defs +ellps=GRS80 +towgs84=0,0,0'
> -108.58333 48.75000
>
> and obtain
> -871738.467677399 1091090.13492387
>
> System information:
> gdaltransform --version
> GDAL 1.10.0, released 2013/04/24
> uname
> Darwin
> (OS X 10.8.5)
>
>
> whereas in R I obtain with:
> library(sp)
> dat <- SpatialPoints(matrix(data = c(-108.58333, 48.75000), ncol=2))
> dat at proj4string  <- CRS("+proj=longlat +datum=WGS84")
> library(rgdal)
> spTransform(dat, CRS("+proj=aea +lat_1=20 +lat2=60 +lat0=40 +lon_0=-96 +x_0=0 +y_0=0 +datum=NAD83 +units=m +no_defs +ellps=GRS80 +towgs84=0,0,0"))
>
>  -1207845   5150590
> as Helen already has pointed out.
>
> So something seems to go wrong in spTransform - but others are probably better in checking this - or whether we are somehow confusing sth.
>
> I post my system information
> R version 3.0.2 (2013-09-25)
> Platform: x86_64-apple-darwin10.8.0 (64-bit)
> locale:
> [1] de_DE.UTF-8/de_DE.UTF-8/de_DE.UTF-8/C/de_DE.UTF-8/de_DE.UTF-8
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> other attached packages:
> [1] rgdal_0.8-11 sp_1.0-13
>
> loaded via a namespace (and not attached):
> [1] grid_3.0.2      lattice_0.20-23 tools_3.0.2
>
> and rgdal gives:
> rgdal: version: 0.8-11, (SVN revision 479M)
> Geospatial Data Abstraction Library extensions to R successfully loaded
> Loaded GDAL runtime: GDAL 1.9.2, released 2012/10/08
> Path to GDAL shared files: /Users/ralfs/Library/R/3.0/library/rgdal/gdal
> Loaded PROJ.4 runtime: Rel. 4.8.0, 6 March 2012, [PJ_VERSION: 480]
> Path to PROJ.4 shared files: /Users/ralfs/Library/R/3.0/library/rgdal/proj
>
> Best regards
> Ralf
>
>
> Am 26.09.2013 um 18:05 schrieb Helen Sofaer <helen at rams.colostate.edu>:
>
>> Thanks for taking the time to look at it Ralf.
>> I wish that was the problem (I had transformed from WGS 84). Here's a
>> simpler example that just relies on the future climate data, since I
>> realized there's no reason to bring in that state boundary data beyond
>> to show that both programs were consistent with themselves for
>> different data.
>> What I find is that if I project the data in R I get very different
>> results than if I project the data in ArcCatalog. The reason this is
>> so surprising to me is that I'm defining my proj4 string to match what
>> is coming from GIS.
>>
>> I may very well be messing this up somehow within ArcGIS, rather than
>> within R; it does seem like I've made a simple but major mistake
>> somewhere along the way (and I admit I'm more comfortable in R, which
>> is why I'm going through this to begin with). Can anyone else with GIS
>> (I have 10.1) replicate this issue? The decimal degrees used in my
>> example are at the end of the code, but I'd guess that one would see
>> the same thing with any other point locations.
>>
>> Thanks again,
>> Helen
>>
>>
>> # Simple version:
>> library(sp)
>> library(rgdal)
>>
>> # just take 10 rows (see earlier code for importing data, or copy
>> long/lat from end)
>> set.seed(123)
>> CGCM.Sample10 = CGCM.A2.May2047[sample(nrow(CGCM.A2.May2047), 10), ]
>> write.csv(CGCM.Sample10, "CGCM.Sample10.csv") # for bringing into ArcGIS
>>
>> # convert to SPDF, assuming NAD83
>> CGCM.Sample10 = SpatialPointsDataFrame(data = CGCM.Sample10,
>>            coords = CGCM.Sample10[, c("long_dd", "lati_dd")],
>>            proj4string = CRS(as.character("+proj=longlat +datum=NAD83")))
>> # project to Albers
>> CGCM.Sample10.Albers = spTransform(CGCM.Sample10, CRS("+proj=aea
>> +lat_1=20 +lat2=60 +lat0=40 +lon_0=-96 +x_0=0 +y_0=0 +datum=NAD83
>> +units=m +no_defs +ellps=GRS80 +towgs84=0,0,0"))
>> bbox(CGCM.Sample10.Albers)
>> #             min       max
>> # long_dd -1617766 -136530.6
>> # lati_dd  4702653 5158505.5
>>
>> # Import same points from ArcGIS; CGCM.Sample10.csv was brought into
>> ArcCatalog as XY table in NAD83 and converted to shapefile (i.e.
>> without projected to Albers within GIS):
>> CGCM.Sample10.viaGIS.NAD83 =
>> readOGR("C:/Helen_PPR_GIS/ForPondModel/SpatialExtent",
>> "CGCM_Sample10_viaGIS_NAD83")
>> print(proj4string(CGCM.Sample10.viaGIS.NAD83))
>> # [1] "+proj=longlat +datum=NAD83 +no_defs +ellps=GRS80 +towgs84=0,0,0"
>>
>> # if I project these data in R, I get the same results as before:
>> CGCM.Sample10.Albers.NotProjectedinGIS =
>> spTransform(CGCM.Sample10.viaGIS.NAD83, CRS("+proj=aea +lat_1=20
>> +lat2=60 +lat0=40 +lon_0=-96 +x_0=0 +y_0=0 +datum=NAD83 +units=m
>> +no_defs +ellps=GRS80 +towgs84=0,0,0"))
>> bbox(CGCM.Sample10.Albers.NotProjectedinGIS)
>> #               min       max
>> # coords.x1 -1617766 -136530.6
>> # coords.x2  4702653 5158505.5
>>
>> ## The problem arises when I import data that have already been
>> projected within ArcGIS
>> # Using 'North America Albers Equal Area Conic' projection in GIS
>> CGCM.Sample10.viaGIS.Albers =
>> readOGR("C:/Helen_PPR_GIS/ForPondModel/SpatialExtent",
>> "CGCM_Sample10_viaGIS_Albers")
>> print(proj4string(CGCM.Sample10.viaGIS.Albers))
>> # [1] "+proj=aea +lat_1=20 +lat_2=60 +lat_0=40 +lon_0=-96 +x_0=0
>> +y_0=0 +datum=NAD83 +units=m +no_defs +ellps=GRS80 +towgs84=0,0,0"
>> bbox(CGCM.Sample10.viaGIS.Albers)
>> #                 min       max
>> # coords.x1 -1238062.2 -100922.4
>> # coords.x2   481037.2 1091090.2
>>
>> # Full coordinates projected in R:
>> cbind(CGCM.Sample10.Albers at coords, CGCM.Sample10.Albers at data$long_dd,
>> CGCM.Sample10.Albers at data$lati_dd)
>> # Output (Albers X, Y, Decimal degrees X, Y):
>>                                            long_dd       lati_dd
>> [1,] -1207845.6   5150590     -108.58333   48.75000
>> [2,]  -386539.6    4920224     -100.00000   46.33333
>> [3,] -1010183.5   5072255     -106.50000   47.91667
>> [4,]  -231920.7    5142912     -98.41667    48.91667
>> [5,]  -136530.6    5006086     -97.41667    47.33333
>> [6,] -1617766.1   4801139     -112.66667   44.58333
>> [7,]  -818944.6    4702653     -104.41667  43.83333
>> [8,]  -216357.0    5078695     -98.25000    48.16667
>> [9,]  -775495.3    5158506     -104.08333  49.00000
>> [10,]  -934670.2   4909220     -105.66667  46.08333
>>
>> # Full coordinates projected in GIS:
>> cbind(CGCM.Sample10.viaGIS.Albers at coords,
>> CGCM.Sample10.viaGIS.Albers at data$long_dd,
>> CGCM.Sample10.viaGIS.Albers at data$lati_dd)
>> # Output (Albers X, Y, Decimal degrees X, Y):
>> [1,]  -871738.7   1091090.2    -108.58333 48.75000
>> [2,]  -289861.4  754322.3     -100.00000 46.33333
>> [3,]  -738909.7  975962.3     -106.50000 47.91667
>> [4,]  -167394.6 1054895.9     -98.41667 48.91667
>> [5,]  -100922.4  866975.6     -97.41667 47.33333
>> [6,] -1238062.2  650570.7    -112.66667 44.58333
>> [7,]  -635489.0  481037.2     -104.41667 43.83333
>> [8,]  -157948.0  966332.5     -98.25000 48.16667
>> [9,]  -558453.2 1086390.0    -104.08333 49.00000
>> [10,]  -702497.8  754532.6    -105.66667 46.08333
>>
>> On Thu, Sep 26, 2013 at 4:34 AM, Ralf Sch?fer <senator at ecotoxicology.de> wrote:
>>> Dear Helen,
>>>
>>> I do not have access to ArcGIS - so I can not even open the file (I can
>>> unzip the .lpk but not open the .sdc file). However, the package information
>>> says that the data is in WGS 84 - so if you imported into R you need to
>>> assign WGS 84 first and then convert and this should work.
>>> From memory, ArcGIS or QGIS always assign a CRS on opening so make sure it
>>> is the correct one before projection.
>>> From my experience, in 99% of cases where students struggled with the CRS it
>>> was an issue with QGIS and ArcGIS.
>>>
>>> Best regards,
>>>
>>> Ralf Sch?fer
>>>
>>> ------------------------------------------------------------
>>>
>>> Prof. Dr. habil. Ralf Bernhard Sch?fer
>>> Juniorprofessor for Quantitative Landscape Ecology
>>> Environmental Scientist (M.Sc.)
>>> Institute for Environmental Sciences
>>> University Koblenz-Landau
>>> Fortstrasse 7
>>> 76829 Landau
>>> Germany
>>> Mail: schaefer-ralf at uni-landau.de
>>> Phone: ++49 (0) 6341 280-31536
>>> Web: www.landscapecology.uni-landau.de
>>>
>>>
>>>
>>>
>>>
>>>
>>>
>>>
>>>
>>>
>>>
>>
>>
>>
>> --
>> Helen Sofaer
>> Postdoctoral Fellow
>> Fish Wildlife and Conservation Biology
>> Colorado State University
>



-- 
Helen Sofaer
Postdoctoral Fellow
Fish Wildlife and Conservation Biology
Colorado State University


From Roger.Bivand at nhh.no  Thu Sep 26 20:01:25 2013
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 26 Sep 2013 20:01:25 +0200
Subject: [R-sig-Geo] misalignment between data projected in R and ArcGIS
 (Helen Sofaer)
In-Reply-To: <44D5B8AC-9D76-411F-96D1-CA4BE186D85E@ecotoxicology.de>
References: <D2995F9A-9841-4F9A-B902-D24AB0271B68@ecotoxicology.de>
	<CAOckJBPMzLf+nanG_xGNd5=b5W1Cr_Q1SerRsEKMp6oMWKCTow@mail.gmail.com>
	<44D5B8AC-9D76-411F-96D1-CA4BE186D85E@ecotoxicology.de>
Message-ID: <alpine.LRH.2.03.1309261931360.9527@reclus.nhh.no>

On Thu, 26 Sep 2013, Ralf Sch?fer wrote:

> Dear Helen, dear all,
>
> it seems that indeed R is the source of the error.
>
> For the points in Decimal Degrees
>> -108.58333   48.75000
>
>
> I checked with GDAL tools in Shell:
>
> gdaltransform -s_srs EPSG:4326 -t_srs '+proj=aea +lat_1=20 +lat_2=60 +lat_0=40 +lon_0=-96 +x_0=0 +y_0=0 +datum=NAD83 +units=m +no_defs +ellps=GRS80 +towgs84=0,0,0'
> -108.58333 48.75000
>
> and obtain
> -871738.467677399 1091090.13492387
>
> System information:
> gdaltransform --version
> GDAL 1.10.0, released 2013/04/24
> uname
> Darwin
> (OS X 10.8.5)
>
>
> whereas in R I obtain with:
> library(sp)
> dat <- SpatialPoints(matrix(data = c(-108.58333, 48.75000), ncol=2))
> dat at proj4string  <- CRS("+proj=longlat +datum=WGS84")
> library(rgdal)
> spTransform(dat, CRS("+proj=aea +lat_1=20 +lat2=60 +lat0=40 +lon_0=-96 +x_0=0 +y_0=0 +datum=NAD83 +units=m +no_defs +ellps=GRS80 +towgs84=0,0,0"))
>
> -1207845   5150590
> as Helen already has pointed out.
>
> So something seems to go wrong in spTransform - but others are probably 
> better in checking this - or whether we are somehow confusing sth.

The missing information is about the way in which rgdal was installed. For 
my rgdal, installed from source and dynamically linked to the PROJ library 
(GDAL also links to the PROJ library, so PROJ is the crucial component), I 
see:

$ proj +proj=aea +lat_1=20 +lat_2=60 +lat_0=40 +lon_0=-96 +x_0=0 +y_0=0 \ 
+datum=NAD83 +units=m +no_defs +ellps=GRS80 +towgs84=0,0,0
-108.58333 48.75000
-871738.47	1091090.13

So OK, and:

> library(rgdal)
Loading required package: sp
rgdal: version: 0.8-11, (SVN revision 479M)
Geospatial Data Abstraction Library extensions to R successfully loaded
Loaded GDAL runtime: GDAL 1.10.1, released 2013/08/26
Path to GDAL shared files: /usr/local/share/gdal
Loaded PROJ.4 runtime: Rel. 4.8.0, 6 March 2012, [PJ_VERSION: 480]
Path to PROJ.4 shared files: (autodetected)
> pt <- matrix(c(-108.58333, 48.75000), nrow=1)
> project(pt, "+proj=aea +lat_1=20 +lat_2=60 +lat_0=40 +lon_0=-96 +x_0=0 
+y_0=0 +datum=NAD83 +units=m +no_defs +ellps=GRS80 +towgs84=0,0,0")
           [,1]    [,2]
[1,] -871738.5 1091090
> a <- project(pt, "+proj=aea +lat_1=20 +lat_2=60 +lat_0=40 +lon_0=-96 
+x_0=0 +y_0=0 +datum=NAD83 +units=m +no_defs +ellps=GRS80 +towgs84=0,0,0")
> b <- spTransform(SpatialPoints(pt, proj4string=CRS("+init=epsg:4326")), 
CRS("+proj=aea +lat_1=20 +lat_2=60 +lat_0=40 +lon_0=-96 +x_0=0 +y_0=0 
+datum=NAD83 +units=m +no_defs +ellps=GRS80 +towgs84=0,0,0"))
> all.equal(a, coordinates(b), check.attributes=FALSE)
[1] TRUE

the same in R. The failing component is then the underlying PROJ library. 
Ralf is using OSX, and if both Ralf and Helen are using the CRAN OSX rgdal 
binary, this may be the explanation, but of course will not be if rgdal 
and PROJ were installed in a different way.

I have checked that the CRAN Windows rgdal binary works correctly, using 
PROJ 4.7.1, linked statically, on 64-bit and 32-bit.

Please describe how you installed rgdal, and if it turns out to be the OSX 
CRAN binary, we'll address that - if however you installed PROJ in some 
other way then rgdal from source, we'll need to check those routes 
instead.

This also suggests that (part of) the PROJ.4 test suite should be added to 
rgdal to check the integrity of the projection and datum transformation 
functions.

Thanks for clear examples,

Roger


>
> I post my system information
> R version 3.0.2 (2013-09-25)
> Platform: x86_64-apple-darwin10.8.0 (64-bit)
> locale:
> [1] de_DE.UTF-8/de_DE.UTF-8/de_DE.UTF-8/C/de_DE.UTF-8/de_DE.UTF-8
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> other attached packages:
> [1] rgdal_0.8-11 sp_1.0-13
>
> loaded via a namespace (and not attached):
> [1] grid_3.0.2      lattice_0.20-23 tools_3.0.2
>
> and rgdal gives:
> rgdal: version: 0.8-11, (SVN revision 479M)
> Geospatial Data Abstraction Library extensions to R successfully loaded
> Loaded GDAL runtime: GDAL 1.9.2, released 2012/10/08
> Path to GDAL shared files: /Users/ralfs/Library/R/3.0/library/rgdal/gdal
> Loaded PROJ.4 runtime: Rel. 4.8.0, 6 March 2012, [PJ_VERSION: 480]
> Path to PROJ.4 shared files: /Users/ralfs/Library/R/3.0/library/rgdal/proj
>
> Best regards
> Ralf
>
>
> Am 26.09.2013 um 18:05 schrieb Helen Sofaer <helen at rams.colostate.edu>:
>
>> Thanks for taking the time to look at it Ralf.
>> I wish that was the problem (I had transformed from WGS 84). Here's a
>> simpler example that just relies on the future climate data, since I
>> realized there's no reason to bring in that state boundary data beyond
>> to show that both programs were consistent with themselves for
>> different data.
>> What I find is that if I project the data in R I get very different
>> results than if I project the data in ArcCatalog. The reason this is
>> so surprising to me is that I'm defining my proj4 string to match what
>> is coming from GIS.
>>
>> I may very well be messing this up somehow within ArcGIS, rather than
>> within R; it does seem like I've made a simple but major mistake
>> somewhere along the way (and I admit I'm more comfortable in R, which
>> is why I'm going through this to begin with). Can anyone else with GIS
>> (I have 10.1) replicate this issue? The decimal degrees used in my
>> example are at the end of the code, but I'd guess that one would see
>> the same thing with any other point locations.
>>
>> Thanks again,
>> Helen
>>
>>
>> # Simple version:
>> library(sp)
>> library(rgdal)
>>
>> # just take 10 rows (see earlier code for importing data, or copy
>> long/lat from end)
>> set.seed(123)
>> CGCM.Sample10 = CGCM.A2.May2047[sample(nrow(CGCM.A2.May2047), 10), ]
>> write.csv(CGCM.Sample10, "CGCM.Sample10.csv") # for bringing into ArcGIS
>>
>> # convert to SPDF, assuming NAD83
>> CGCM.Sample10 = SpatialPointsDataFrame(data = CGCM.Sample10,
>>            coords = CGCM.Sample10[, c("long_dd", "lati_dd")],
>>            proj4string = CRS(as.character("+proj=longlat +datum=NAD83")))
>> # project to Albers
>> CGCM.Sample10.Albers = spTransform(CGCM.Sample10, CRS("+proj=aea
>> +lat_1=20 +lat2=60 +lat0=40 +lon_0=-96 +x_0=0 +y_0=0 +datum=NAD83
>> +units=m +no_defs +ellps=GRS80 +towgs84=0,0,0"))
>> bbox(CGCM.Sample10.Albers)
>> #             min       max
>> # long_dd -1617766 -136530.6
>> # lati_dd  4702653 5158505.5
>>
>> # Import same points from ArcGIS; CGCM.Sample10.csv was brought into
>> ArcCatalog as XY table in NAD83 and converted to shapefile (i.e.
>> without projected to Albers within GIS):
>> CGCM.Sample10.viaGIS.NAD83 =
>> readOGR("C:/Helen_PPR_GIS/ForPondModel/SpatialExtent",
>> "CGCM_Sample10_viaGIS_NAD83")
>> print(proj4string(CGCM.Sample10.viaGIS.NAD83))
>> # [1] "+proj=longlat +datum=NAD83 +no_defs +ellps=GRS80 +towgs84=0,0,0"
>>
>> # if I project these data in R, I get the same results as before:
>> CGCM.Sample10.Albers.NotProjectedinGIS =
>> spTransform(CGCM.Sample10.viaGIS.NAD83, CRS("+proj=aea +lat_1=20
>> +lat2=60 +lat0=40 +lon_0=-96 +x_0=0 +y_0=0 +datum=NAD83 +units=m
>> +no_defs +ellps=GRS80 +towgs84=0,0,0"))
>> bbox(CGCM.Sample10.Albers.NotProjectedinGIS)
>> #               min       max
>> # coords.x1 -1617766 -136530.6
>> # coords.x2  4702653 5158505.5
>>
>> ## The problem arises when I import data that have already been
>> projected within ArcGIS
>> # Using 'North America Albers Equal Area Conic' projection in GIS
>> CGCM.Sample10.viaGIS.Albers =
>> readOGR("C:/Helen_PPR_GIS/ForPondModel/SpatialExtent",
>> "CGCM_Sample10_viaGIS_Albers")
>> print(proj4string(CGCM.Sample10.viaGIS.Albers))
>> # [1] "+proj=aea +lat_1=20 +lat_2=60 +lat_0=40 +lon_0=-96 +x_0=0
>> +y_0=0 +datum=NAD83 +units=m +no_defs +ellps=GRS80 +towgs84=0,0,0"
>> bbox(CGCM.Sample10.viaGIS.Albers)
>> #                 min       max
>> # coords.x1 -1238062.2 -100922.4
>> # coords.x2   481037.2 1091090.2
>>
>> # Full coordinates projected in R:
>> cbind(CGCM.Sample10.Albers at coords, CGCM.Sample10.Albers at data$long_dd,
>> CGCM.Sample10.Albers at data$lati_dd)
>> # Output (Albers X, Y, Decimal degrees X, Y):
>>                                            long_dd       lati_dd
>> [1,] -1207845.6   5150590     -108.58333   48.75000
>> [2,]  -386539.6    4920224     -100.00000   46.33333
>> [3,] -1010183.5   5072255     -106.50000   47.91667
>> [4,]  -231920.7    5142912     -98.41667    48.91667
>> [5,]  -136530.6    5006086     -97.41667    47.33333
>> [6,] -1617766.1   4801139     -112.66667   44.58333
>> [7,]  -818944.6    4702653     -104.41667  43.83333
>> [8,]  -216357.0    5078695     -98.25000    48.16667
>> [9,]  -775495.3    5158506     -104.08333  49.00000
>> [10,]  -934670.2   4909220     -105.66667  46.08333
>>
>> # Full coordinates projected in GIS:
>> cbind(CGCM.Sample10.viaGIS.Albers at coords,
>> CGCM.Sample10.viaGIS.Albers at data$long_dd,
>> CGCM.Sample10.viaGIS.Albers at data$lati_dd)
>> # Output (Albers X, Y, Decimal degrees X, Y):
>> [1,]  -871738.7   1091090.2    -108.58333 48.75000
>> [2,]  -289861.4  754322.3     -100.00000 46.33333
>> [3,]  -738909.7  975962.3     -106.50000 47.91667
>> [4,]  -167394.6 1054895.9     -98.41667 48.91667
>> [5,]  -100922.4  866975.6     -97.41667 47.33333
>> [6,] -1238062.2  650570.7    -112.66667 44.58333
>> [7,]  -635489.0  481037.2     -104.41667 43.83333
>> [8,]  -157948.0  966332.5     -98.25000 48.16667
>> [9,]  -558453.2 1086390.0    -104.08333 49.00000
>> [10,]  -702497.8  754532.6    -105.66667 46.08333
>>
>> On Thu, Sep 26, 2013 at 4:34 AM, Ralf Sch?fer <senator at ecotoxicology.de> wrote:
>>> Dear Helen,
>>>
>>> I do not have access to ArcGIS - so I can not even open the file (I can
>>> unzip the .lpk but not open the .sdc file). However, the package information
>>> says that the data is in WGS 84 - so if you imported into R you need to
>>> assign WGS 84 first and then convert and this should work.
>>> From memory, ArcGIS or QGIS always assign a CRS on opening so make sure it
>>> is the correct one before projection.
>>> From my experience, in 99% of cases where students struggled with the CRS it
>>> was an issue with QGIS and ArcGIS.
>>>
>>> Best regards,
>>>
>>> Ralf Sch?fer
>>>
>>> ------------------------------------------------------------
>>>
>>> Prof. Dr. habil. Ralf Bernhard Sch?fer
>>> Juniorprofessor for Quantitative Landscape Ecology
>>> Environmental Scientist (M.Sc.)
>>> Institute for Environmental Sciences
>>> University Koblenz-Landau
>>> Fortstrasse 7
>>> 76829 Landau
>>> Germany
>>> Mail: schaefer-ralf at uni-landau.de
>>> Phone: ++49 (0) 6341 280-31536
>>> Web: www.landscapecology.uni-landau.de
>>>
>>>
>>>
>>>
>>>
>>>
>>>
>>>
>>>
>>>
>>>
>>
>>
>>
>> --
>> Helen Sofaer
>> Postdoctoral Fellow
>> Fish Wildlife and Conservation Biology
>> Colorado State University
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From Roger.Bivand at nhh.no  Thu Sep 26 20:25:49 2013
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 26 Sep 2013 20:25:49 +0200
Subject: [R-sig-Geo] misalignment between data projected in R and ArcGIS
 (Helen Sofaer)
In-Reply-To: <alpine.LRH.2.03.1309261931360.9527@reclus.nhh.no>
References: <D2995F9A-9841-4F9A-B902-D24AB0271B68@ecotoxicology.de>
	<CAOckJBPMzLf+nanG_xGNd5=b5W1Cr_Q1SerRsEKMp6oMWKCTow@mail.gmail.com>
	<44D5B8AC-9D76-411F-96D1-CA4BE186D85E@ecotoxicology.de>
	<alpine.LRH.2.03.1309261931360.9527@reclus.nhh.no>
Message-ID: <alpine.LRH.2.03.1309262016010.9795@reclus.nhh.no>

Summary: typo not error in OSX binary. Detail below:

On Thu, 26 Sep 2013, Roger Bivand wrote:

> On Thu, 26 Sep 2013, Ralf Sch?fer wrote:
>
>> Dear Helen, dear all,
>> 
>> it seems that indeed R is the source of the error.
>> 
>> For the points in Decimal Degrees
>>> -108.58333   48.75000
>> 
>> 
>> I checked with GDAL tools in Shell:
>> 
>> gdaltransform -s_srs EPSG:4326 -t_srs '+proj=aea +lat_1=20 +lat_2=60 
>> +lat_0=40 +lon_0=-96 +x_0=0 +y_0=0 +datum=NAD83 +units=m +no_defs 
>> +ellps=GRS80 +towgs84=0,0,0'
>> -108.58333 48.75000
>> 
>> and obtain
>> -871738.467677399 1091090.13492387
>> 
>> System information:
>> gdaltransform --version
>> GDAL 1.10.0, released 2013/04/24
>> uname
>> Darwin
>> (OS X 10.8.5)
>> 
>> 
>> whereas in R I obtain with:
>> library(sp)
>> dat <- SpatialPoints(matrix(data = c(-108.58333, 48.75000), ncol=2))
>> dat at proj4string  <- CRS("+proj=longlat +datum=WGS84")
>> library(rgdal)
>> spTransform(dat, CRS("+proj=aea +lat_1=20 +lat2=60 +lat0=40 +lon_0=-96

Sorry, no, this is a simple typo, +lat0=40 for +lat_0=40. With the latter, 
OK, no issue with PROJ versions. If you set +lat_0=0 - what the typo gives 
- you get the erroneous value. Please check on OSX (Helen is on Windows, I 
think, from a file path).

> aea1 <- "+proj=aea +lat_1=20 +lat2=60 +lat_0=0 +lon_0=-96 +x_0=0 +y_0=0 
+datum=NAD83 +units=m +no_defs +ellps=GRS80 +towgs84=0,0,0"
> project(pt, aea1)
          [,1]    [,2]
[1,] -1207845 5150590



>> +x_0=0 +y_0=0 +datum=NAD83 +units=m +no_defs +ellps=GRS80 +towgs84=0,0,0"))
>> 
>> -1207845   5150590
>> as Helen already has pointed out.
>> 
>> So something seems to go wrong in spTransform - but others are probably 
>> better in checking this - or whether we are somehow confusing sth.
>
> The missing information is about the way in which rgdal was installed. For my 
> rgdal, installed from source and dynamically linked to the PROJ library (GDAL 
> also links to the PROJ library, so PROJ is the crucial component), I see:
>
> $ proj +proj=aea +lat_1=20 +lat_2=60 +lat_0=40 +lon_0=-96 +x_0=0 +y_0=0 \ 
> +datum=NAD83 +units=m +no_defs +ellps=GRS80 +towgs84=0,0,0
> -108.58333 48.75000
> -871738.47	1091090.13
>
> So OK, and:
>
>> library(rgdal)
> Loading required package: sp
> rgdal: version: 0.8-11, (SVN revision 479M)
> Geospatial Data Abstraction Library extensions to R successfully loaded
> Loaded GDAL runtime: GDAL 1.10.1, released 2013/08/26
> Path to GDAL shared files: /usr/local/share/gdal
> Loaded PROJ.4 runtime: Rel. 4.8.0, 6 March 2012, [PJ_VERSION: 480]
> Path to PROJ.4 shared files: (autodetected)
>> pt <- matrix(c(-108.58333, 48.75000), nrow=1)
>> project(pt, "+proj=aea +lat_1=20 +lat_2=60 +lat_0=40 +lon_0=-96 +x_0=0 
> +y_0=0 +datum=NAD83 +units=m +no_defs +ellps=GRS80 +towgs84=0,0,0")
>          [,1]    [,2]
> [1,] -871738.5 1091090
>> a <- project(pt, "+proj=aea +lat_1=20 +lat_2=60 +lat_0=40 +lon_0=-96 
> +x_0=0 +y_0=0 +datum=NAD83 +units=m +no_defs +ellps=GRS80 +towgs84=0,0,0")
>> b <- spTransform(SpatialPoints(pt, proj4string=CRS("+init=epsg:4326")), 
> CRS("+proj=aea +lat_1=20 +lat_2=60 +lat_0=40 +lon_0=-96 +x_0=0 +y_0=0 
> +datum=NAD83 +units=m +no_defs +ellps=GRS80 +towgs84=0,0,0"))
>> all.equal(a, coordinates(b), check.attributes=FALSE)
> [1] TRUE
>
> the same in R. The failing component is then the underlying PROJ library. 
> Ralf is using OSX, and if both Ralf and Helen are using the CRAN OSX rgdal 
> binary, this may be the explanation, but of course will not be if rgdal and 
> PROJ were installed in a different way.

There is no reason to suspect the CRAN OSX binary of error!

>
> I have checked that the CRAN Windows rgdal binary works correctly, using PROJ 
> 4.7.1, linked statically, on 64-bit and 32-bit.
>
> Please describe how you installed rgdal, and if it turns out to be the OSX 
> CRAN binary, we'll address that - if however you installed PROJ in some other 
> way then rgdal from source, we'll need to check those routes instead.

There is no reason to suspect the CRAN OSX binary of error!

>
> This also suggests that (part of) the PROJ.4 test suite should be added to 
> rgdal to check the integrity of the projection and datum transformation 
> functions.

This may make sense anyway ...

Roger

>
> Thanks for clear examples,
>
> Roger
>
>
>> 
>> I post my system information
>> R version 3.0.2 (2013-09-25)
>> Platform: x86_64-apple-darwin10.8.0 (64-bit)
>> locale:
>> [1] de_DE.UTF-8/de_DE.UTF-8/de_DE.UTF-8/C/de_DE.UTF-8/de_DE.UTF-8
>> 
>> attached base packages:
>> [1] stats     graphics  grDevices utils     datasets  methods   base
>> 
>> other attached packages:
>> [1] rgdal_0.8-11 sp_1.0-13
>> 
>> loaded via a namespace (and not attached):
>> [1] grid_3.0.2      lattice_0.20-23 tools_3.0.2
>> 
>> and rgdal gives:
>> rgdal: version: 0.8-11, (SVN revision 479M)
>> Geospatial Data Abstraction Library extensions to R successfully loaded
>> Loaded GDAL runtime: GDAL 1.9.2, released 2012/10/08
>> Path to GDAL shared files: /Users/ralfs/Library/R/3.0/library/rgdal/gdal
>> Loaded PROJ.4 runtime: Rel. 4.8.0, 6 March 2012, [PJ_VERSION: 480]
>> Path to PROJ.4 shared files: /Users/ralfs/Library/R/3.0/library/rgdal/proj
>> 
>> Best regards
>> Ralf
>> 
>> 
>> Am 26.09.2013 um 18:05 schrieb Helen Sofaer <helen at rams.colostate.edu>:
>> 
>>> Thanks for taking the time to look at it Ralf.
>>> I wish that was the problem (I had transformed from WGS 84). Here's a
>>> simpler example that just relies on the future climate data, since I
>>> realized there's no reason to bring in that state boundary data beyond
>>> to show that both programs were consistent with themselves for
>>> different data.
>>> What I find is that if I project the data in R I get very different
>>> results than if I project the data in ArcCatalog. The reason this is
>>> so surprising to me is that I'm defining my proj4 string to match what
>>> is coming from GIS.
>>> 
>>> I may very well be messing this up somehow within ArcGIS, rather than
>>> within R; it does seem like I've made a simple but major mistake
>>> somewhere along the way (and I admit I'm more comfortable in R, which
>>> is why I'm going through this to begin with). Can anyone else with GIS
>>> (I have 10.1) replicate this issue? The decimal degrees used in my
>>> example are at the end of the code, but I'd guess that one would see
>>> the same thing with any other point locations.
>>> 
>>> Thanks again,
>>> Helen
>>> 
>>> 
>>> # Simple version:
>>> library(sp)
>>> library(rgdal)
>>> 
>>> # just take 10 rows (see earlier code for importing data, or copy
>>> long/lat from end)
>>> set.seed(123)
>>> CGCM.Sample10 = CGCM.A2.May2047[sample(nrow(CGCM.A2.May2047), 10), ]
>>> write.csv(CGCM.Sample10, "CGCM.Sample10.csv") # for bringing into ArcGIS
>>> 
>>> # convert to SPDF, assuming NAD83
>>> CGCM.Sample10 = SpatialPointsDataFrame(data = CGCM.Sample10,
>>>            coords = CGCM.Sample10[, c("long_dd", "lati_dd")],
>>>            proj4string = CRS(as.character("+proj=longlat +datum=NAD83")))
>>> # project to Albers
>>> CGCM.Sample10.Albers = spTransform(CGCM.Sample10, CRS("+proj=aea
>>> +lat_1=20 +lat2=60 +lat0=40 +lon_0=-96 +x_0=0 +y_0=0 +datum=NAD83

                        ^^^^^^^^

>>> +units=m +no_defs +ellps=GRS80 +towgs84=0,0,0"))
>>> bbox(CGCM.Sample10.Albers)
>>> #             min       max
>>> # long_dd -1617766 -136530.6
>>> # lati_dd  4702653 5158505.5
>>> 
>>> # Import same points from ArcGIS; CGCM.Sample10.csv was brought into
>>> ArcCatalog as XY table in NAD83 and converted to shapefile (i.e.
>>> without projected to Albers within GIS):
>>> CGCM.Sample10.viaGIS.NAD83 =
>>> readOGR("C:/Helen_PPR_GIS/ForPondModel/SpatialExtent",
>>> "CGCM_Sample10_viaGIS_NAD83")
>>> print(proj4string(CGCM.Sample10.viaGIS.NAD83))
>>> # [1] "+proj=longlat +datum=NAD83 +no_defs +ellps=GRS80 +towgs84=0,0,0"
>>> 
>>> # if I project these data in R, I get the same results as before:
>>> CGCM.Sample10.Albers.NotProjectedinGIS =
>>> spTransform(CGCM.Sample10.viaGIS.NAD83, CRS("+proj=aea +lat_1=20
>>> +lat2=60 +lat0=40 +lon_0=-96 +x_0=0 +y_0=0 +datum=NAD83 +units=m

     ^^^^^^^^ ^^^^^^^^ more issues

>>> +no_defs +ellps=GRS80 +towgs84=0,0,0"))
>>> bbox(CGCM.Sample10.Albers.NotProjectedinGIS)
>>> #               min       max
>>> # coords.x1 -1617766 -136530.6
>>> # coords.x2  4702653 5158505.5
>>> 
>>> ## The problem arises when I import data that have already been
>>> projected within ArcGIS
>>> # Using 'North America Albers Equal Area Conic' projection in GIS
>>> CGCM.Sample10.viaGIS.Albers =
>>> readOGR("C:/Helen_PPR_GIS/ForPondModel/SpatialExtent",
>>> "CGCM_Sample10_viaGIS_Albers")
>>> print(proj4string(CGCM.Sample10.viaGIS.Albers))
>>> # [1] "+proj=aea +lat_1=20 +lat_2=60 +lat_0=40 +lon_0=-96 +x_0=0
>>> +y_0=0 +datum=NAD83 +units=m +no_defs +ellps=GRS80 +towgs84=0,0,0"
>>> bbox(CGCM.Sample10.viaGIS.Albers)
>>> #                 min       max
>>> # coords.x1 -1238062.2 -100922.4
>>> # coords.x2   481037.2 1091090.2
>>> 
>>> # Full coordinates projected in R:
>>> cbind(CGCM.Sample10.Albers at coords, CGCM.Sample10.Albers at data$long_dd,
>>> CGCM.Sample10.Albers at data$lati_dd)
>>> # Output (Albers X, Y, Decimal degrees X, Y):
>>>                                            long_dd       lati_dd
>>> [1,] -1207845.6   5150590     -108.58333   48.75000
>>> [2,]  -386539.6    4920224     -100.00000   46.33333
>>> [3,] -1010183.5   5072255     -106.50000   47.91667
>>> [4,]  -231920.7    5142912     -98.41667    48.91667
>>> [5,]  -136530.6    5006086     -97.41667    47.33333
>>> [6,] -1617766.1   4801139     -112.66667   44.58333
>>> [7,]  -818944.6    4702653     -104.41667  43.83333
>>> [8,]  -216357.0    5078695     -98.25000    48.16667
>>> [9,]  -775495.3    5158506     -104.08333  49.00000
>>> [10,]  -934670.2   4909220     -105.66667  46.08333
>>> 
>>> # Full coordinates projected in GIS:
>>> cbind(CGCM.Sample10.viaGIS.Albers at coords,
>>> CGCM.Sample10.viaGIS.Albers at data$long_dd,
>>> CGCM.Sample10.viaGIS.Albers at data$lati_dd)
>>> # Output (Albers X, Y, Decimal degrees X, Y):
>>> [1,]  -871738.7   1091090.2    -108.58333 48.75000
>>> [2,]  -289861.4  754322.3     -100.00000 46.33333
>>> [3,]  -738909.7  975962.3     -106.50000 47.91667
>>> [4,]  -167394.6 1054895.9     -98.41667 48.91667
>>> [5,]  -100922.4  866975.6     -97.41667 47.33333
>>> [6,] -1238062.2  650570.7    -112.66667 44.58333
>>> [7,]  -635489.0  481037.2     -104.41667 43.83333
>>> [8,]  -157948.0  966332.5     -98.25000 48.16667
>>> [9,]  -558453.2 1086390.0    -104.08333 49.00000
>>> [10,]  -702497.8  754532.6    -105.66667 46.08333
>>> 
>>> On Thu, Sep 26, 2013 at 4:34 AM, Ralf Sch?fer <senator at ecotoxicology.de> 
>>> wrote:
>>>> Dear Helen,
>>>> 
>>>> I do not have access to ArcGIS - so I can not even open the file (I can
>>>> unzip the .lpk but not open the .sdc file). However, the package 
>>>> information
>>>> says that the data is in WGS 84 - so if you imported into R you need to
>>>> assign WGS 84 first and then convert and this should work.
>>>> From memory, ArcGIS or QGIS always assign a CRS on opening so make sure 
>>>> it
>>>> is the correct one before projection.
>>>> From my experience, in 99% of cases where students struggled with the CRS 
>>>> it
>>>> was an issue with QGIS and ArcGIS.
>>>> 
>>>> Best regards,
>>>> 
>>>> Ralf Sch?fer
>>>> 
>>>> ------------------------------------------------------------
>>>> 
>>>> Prof. Dr. habil. Ralf Bernhard Sch?fer
>>>> Juniorprofessor for Quantitative Landscape Ecology
>>>> Environmental Scientist (M.Sc.)
>>>> Institute for Environmental Sciences
>>>> University Koblenz-Landau
>>>> Fortstrasse 7
>>>> 76829 Landau
>>>> Germany
>>>> Mail: schaefer-ralf at uni-landau.de
>>>> Phone: ++49 (0) 6341 280-31536
>>>> Web: www.landscapecology.uni-landau.de
>>>> 
>>>> 
>>>> 
>>>> 
>>>> 
>>>> 
>>>> 
>>>> 
>>>> 
>>>> 
>>>> 
>>> 
>>> 
>>> 
>>> --
>>> Helen Sofaer
>>> Postdoctoral Fellow
>>> Fish Wildlife and Conservation Biology
>>> Colorado State University
>> 
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> 
>
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From cyndyh at nmsu.edu  Thu Sep 26 20:44:01 2013
From: cyndyh at nmsu.edu (cyndy-jer)
Date: Thu, 26 Sep 2013 11:44:01 -0700 (PDT)
Subject: [R-sig-Geo] plotting polygons of one shapefile in different
	colors?
In-Reply-To: <0E1E893FE7447F4F883C415B21D0E5E901246E1BB3CF@MKT-MBX01.university.ds.derby.ac.uk>
References: <1380211448978-7584720.post@n2.nabble.com>
	<0E1E893FE7447F4F883C415B21D0E5E901246E1BB3CF@MKT-MBX01.university.ds.derby.ac.uk>
Message-ID: <1380221041404-7584727.post@n2.nabble.com>

Hi Maren - 

(yes I'm Cyndy :) 

Well, thanks, but yikes!  Surely there is an easier way?  I've gotten pretty
close by trying to use spplot and rColorBrewer, but I'm not quite there.  I
have 3 'n' values as part of my SpatialPolygonDataFrame, and somehow the
below only plots 2 of them, 

(my dataframe is named 'gimmie')

numpoly=length(unique(gimmie$n))

# the below yields a plot of three colors
display.brewer.pal(numpoly, "Accent")

#the below yields my map but with only two of the three above colors, yet
the scale bar shows
#three colors with the three values I KNOW are in my 'n' values in the
shapefile
spplot(gimmie, c("n"), xlim=c(minx,maxx), ylim=c(miny,maxy),
col.regions=brewer.pal(numpoly, "Accent"))

? I don't see why this doesn't work as I expect.  Any ideas, anyone?



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/plotting-polygons-of-one-shapefile-in-different-colors-tp7584720p7584727.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From Roger.Bivand at nhh.no  Thu Sep 26 20:57:52 2013
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 26 Sep 2013 20:57:52 +0200
Subject: [R-sig-Geo] plotting polygons of one shapefile in different
 colors?
In-Reply-To: <1380221041404-7584727.post@n2.nabble.com>
References: <1380211448978-7584720.post@n2.nabble.com>
	<0E1E893FE7447F4F883C415B21D0E5E901246E1BB3CF@MKT-MBX01.university.ds.derby.ac.uk>
	<1380221041404-7584727.post@n2.nabble.com>
Message-ID: <alpine.LRH.2.03.1309262052310.9948@reclus.nhh.no>

On Thu, 26 Sep 2013, cyndy-jer wrote:

> Hi Maren -
>
> (yes I'm Cyndy :)
>
> Well, thanks, but yikes!  Surely there is an easier way?  I've gotten pretty
> close by trying to use spplot and rColorBrewer, but I'm not quite there.  I
> have 3 'n' values as part of my SpatialPolygonDataFrame, and somehow the
> below only plots 2 of them,

The easier way is to get to know and like factors, categorical variables 
typically with few levels:

library(sp)
data(meuse.grid)
coordinates(meuse.grid) <- c("x", "y")
gridded(meuse.grid) <- TRUE
class(meuse.grid$ffreq)
library(RColorBrewer)
spplot(meuse.grid, "ffreq1",
  col.regions=brewer.pal(nlevels(meuse.grid$ffreq), "Accent"))

but if the plotted variable is numeric (or integer):

meuse.grid$ffreq1 <- as.integer(meuse.grid$ffreq)
spplot(meuse.grid, "ffreq1", 
col.regions=brewer.pal(nlevels(meuse.grid$ffreq), "Accent"))

you get trouble because at= by default splits the range of the variable 
into 20, cycling the colours. You can fix at=

spplot(meuse.grid, "ffreq1", at=seq(0.5, 3.5, 1),
  col.regions=brewer.pal(nlevels(meuse.grid$ffreq), "Accent"))


but if your variable is really categorical, convert it to factor 
representation, and live gets easier.

Roger

>
> (my dataframe is named 'gimmie')
>
> numpoly=length(unique(gimmie$n))
>
> # the below yields a plot of three colors
> display.brewer.pal(numpoly, "Accent")
>
> #the below yields my map but with only two of the three above colors, yet
> the scale bar shows
> #three colors with the three values I KNOW are in my 'n' values in the
> shapefile
> spplot(gimmie, c("n"), xlim=c(minx,maxx), ylim=c(miny,maxy),
> col.regions=brewer.pal(numpoly, "Accent"))
>
> ? I don't see why this doesn't work as I expect.  Any ideas, anyone?
>
>
>
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/plotting-polygons-of-one-shapefile-in-different-colors-tp7584720p7584727.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From vitale232 at gmail.com  Thu Sep 26 21:10:42 2013
From: vitale232 at gmail.com (Andrew Vitale)
Date: Thu, 26 Sep 2013 12:10:42 -0700
Subject: [R-sig-Geo] raster:::plot - Change legend tick label size
Message-ID: <CAFTcopdk0Ck1=H5rhQSx19vks=E6y0J-LLbaufrgkUPbqLK9=A@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130926/b792eb74/attachment.pl>

From cyndyh at nmsu.edu  Thu Sep 26 22:04:18 2013
From: cyndyh at nmsu.edu (cyndy-jer)
Date: Thu, 26 Sep 2013 13:04:18 -0700 (PDT)
Subject: [R-sig-Geo] plotting polygons of one shapefile in different
	colors?
In-Reply-To: <alpine.LRH.2.03.1309262052310.9948@reclus.nhh.no>
References: <1380211448978-7584720.post@n2.nabble.com>
	<0E1E893FE7447F4F883C415B21D0E5E901246E1BB3CF@MKT-MBX01.university.ds.derby.ac.uk>
	<1380221041404-7584727.post@n2.nabble.com>
	<alpine.LRH.2.03.1309262052310.9948@reclus.nhh.no>
Message-ID: <1380225858977-7584730.post@n2.nabble.com>

Hi, Roger -

Thank you for your reply!  I now have the map I needed.

By the way, I've been finding your 2007 course materials most helpful to
learning spatial data manipulation in R. 

 

Cyndy




--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/plotting-polygons-of-one-shapefile-in-different-colors-tp7584720p7584730.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From senator at ecotoxicology.de  Fri Sep 27 00:40:15 2013
From: senator at ecotoxicology.de (=?iso-8859-1?Q?Ralf_Sch=E4fer?=)
Date: Fri, 27 Sep 2013 00:40:15 +0200
Subject: [R-sig-Geo] misalignment between data projected in R and ArcGIS
	(Helen Sofaer)
In-Reply-To: <alpine.LRH.2.03.1309262016010.9795@reclus.nhh.no>
References: <D2995F9A-9841-4F9A-B902-D24AB0271B68@ecotoxicology.de>
	<CAOckJBPMzLf+nanG_xGNd5=b5W1Cr_Q1SerRsEKMp6oMWKCTow@mail.gmail.com>
	<44D5B8AC-9D76-411F-96D1-CA4BE186D85E@ecotoxicology.de>
	<alpine.LRH.2.03.1309261931360.9527@reclus.nhh.no>
	<alpine.LRH.2.03.1309262016010.9795@reclus.nhh.no>
Message-ID: <D568D694-7B92-4B5C-9106-E8DAD19AB845@ecotoxicology.de>

Thanks, heaps Roger!!!

Have no idea how this happened - as I obviously just copy and pasted into the shell window and into R...
Anyway, now works as suggested!
I obtain the same results in R and rgdal
-871738.5   1091090

So, any difficulties seem due to what is done in ArcGIS...
Cheers
Ralf


Am 26.09.2013 um 20:25 schrieb Roger Bivand <Roger.Bivand at nhh.no>:

> Summary: typo not error in OSX binary. Detail below:
> 
> On Thu, 26 Sep 2013, Roger Bivand wrote:
> 
>> On Thu, 26 Sep 2013, Ralf Sch?fer wrote:
>> 
>>> Dear Helen, dear all,
>>> it seems that indeed R is the source of the error.
>>> For the points in Decimal Degrees
>>>> -108.58333   48.75000
>>> I checked with GDAL tools in Shell:
>>> gdaltransform -s_srs EPSG:4326 -t_srs '+proj=aea +lat_1=20 +lat_2=60 +lat_0=40 +lon_0=-96 +x_0=0 +y_0=0 +datum=NAD83 +units=m +no_defs +ellps=GRS80 +towgs84=0,0,0'
>>> -108.58333 48.75000
>>> and obtain
>>> -871738.467677399 1091090.13492387
>>> System information:
>>> gdaltransform --version
>>> GDAL 1.10.0, released 2013/04/24
>>> uname
>>> Darwin
>>> (OS X 10.8.5)
>>> whereas in R I obtain with:
>>> library(sp)
>>> dat <- SpatialPoints(matrix(data = c(-108.58333, 48.75000), ncol=2))
>>> dat at proj4string  <- CRS("+proj=longlat +datum=WGS84")
>>> library(rgdal)
>>> spTransform(dat, CRS("+proj=aea +lat_1=20 +lat2=60 +lat0=40 +lon_0=-96
> 
> Sorry, no, this is a simple typo, +lat0=40 for +lat_0=40. With the latter, OK, no issue with PROJ versions. If you set +lat_0=0 - what the typo gives - you get the erroneous value. Please check on OSX (Helen is on Windows, I think, from a file path).
> 
>> aea1 <- "+proj=aea +lat_1=20 +lat2=60 +lat_0=0 +lon_0=-96 +x_0=0 +y_0=0 
> +datum=NAD83 +units=m +no_defs +ellps=GRS80 +towgs84=0,0,0"
>> project(pt, aea1)
>         [,1]    [,2]
> [1,] -1207845 5150590
> 
> 
> 
>>> +x_0=0 +y_0=0 +datum=NAD83 +units=m +no_defs +ellps=GRS80 +towgs84=0,0,0"))
>>> -1207845   5150590
>>> as Helen already has pointed out.
>>> So something seems to go wrong in spTransform - but others are probably better in checking this - or whether we are somehow confusing sth.
>> 
>> The missing information is about the way in which rgdal was installed. For my rgdal, installed from source and dynamically linked to the PROJ library (GDAL also links to the PROJ library, so PROJ is the crucial component), I see:
>> 
>> $ proj +proj=aea +lat_1=20 +lat_2=60 +lat_0=40 +lon_0=-96 +x_0=0 +y_0=0 \ +datum=NAD83 +units=m +no_defs +ellps=GRS80 +towgs84=0,0,0
>> -108.58333 48.75000
>> -871738.47	1091090.13
>> 
>> So OK, and:
>> 
>>> library(rgdal)
>> Loading required package: sp
>> rgdal: version: 0.8-11, (SVN revision 479M)
>> Geospatial Data Abstraction Library extensions to R successfully loaded
>> Loaded GDAL runtime: GDAL 1.10.1, released 2013/08/26
>> Path to GDAL shared files: /usr/local/share/gdal
>> Loaded PROJ.4 runtime: Rel. 4.8.0, 6 March 2012, [PJ_VERSION: 480]
>> Path to PROJ.4 shared files: (autodetected)
>>> pt <- matrix(c(-108.58333, 48.75000), nrow=1)
>>> project(pt, "+proj=aea +lat_1=20 +lat_2=60 +lat_0=40 +lon_0=-96 +x_0=0 
>> +y_0=0 +datum=NAD83 +units=m +no_defs +ellps=GRS80 +towgs84=0,0,0")
>>         [,1]    [,2]
>> [1,] -871738.5 1091090
>>> a <- project(pt, "+proj=aea +lat_1=20 +lat_2=60 +lat_0=40 +lon_0=-96 
>> +x_0=0 +y_0=0 +datum=NAD83 +units=m +no_defs +ellps=GRS80 +towgs84=0,0,0")
>>> b <- spTransform(SpatialPoints(pt, proj4string=CRS("+init=epsg:4326")), 
>> CRS("+proj=aea +lat_1=20 +lat_2=60 +lat_0=40 +lon_0=-96 +x_0=0 +y_0=0 +datum=NAD83 +units=m +no_defs +ellps=GRS80 +towgs84=0,0,0"))
>>> all.equal(a, coordinates(b), check.attributes=FALSE)
>> [1] TRUE
>> 
>> the same in R. The failing component is then the underlying PROJ library. Ralf is using OSX, and if both Ralf and Helen are using the CRAN OSX rgdal binary, this may be the explanation, but of course will not be if rgdal and PROJ were installed in a different way.
> 
> There is no reason to suspect the CRAN OSX binary of error!
> 
>> 
>> I have checked that the CRAN Windows rgdal binary works correctly, using PROJ 4.7.1, linked statically, on 64-bit and 32-bit.
>> 
>> Please describe how you installed rgdal, and if it turns out to be the OSX CRAN binary, we'll address that - if however you installed PROJ in some other way then rgdal from source, we'll need to check those routes instead.
> 
> There is no reason to suspect the CRAN OSX binary of error!
> 
>> 
>> This also suggests that (part of) the PROJ.4 test suite should be added to rgdal to check the integrity of the projection and datum transformation functions.
> 
> This may make sense anyway ...
> 
> Roger
> 
>> 
>> Thanks for clear examples,
>> 
>> Roger
>> 
>> 
>>> I post my system information
>>> R version 3.0.2 (2013-09-25)
>>> Platform: x86_64-apple-darwin10.8.0 (64-bit)
>>> locale:
>>> [1] de_DE.UTF-8/de_DE.UTF-8/de_DE.UTF-8/C/de_DE.UTF-8/de_DE.UTF-8
>>> attached base packages:
>>> [1] stats     graphics  grDevices utils     datasets  methods   base
>>> other attached packages:
>>> [1] rgdal_0.8-11 sp_1.0-13
>>> loaded via a namespace (and not attached):
>>> [1] grid_3.0.2      lattice_0.20-23 tools_3.0.2
>>> and rgdal gives:
>>> rgdal: version: 0.8-11, (SVN revision 479M)
>>> Geospatial Data Abstraction Library extensions to R successfully loaded
>>> Loaded GDAL runtime: GDAL 1.9.2, released 2012/10/08
>>> Path to GDAL shared files: /Users/ralfs/Library/R/3.0/library/rgdal/gdal
>>> Loaded PROJ.4 runtime: Rel. 4.8.0, 6 March 2012, [PJ_VERSION: 480]
>>> Path to PROJ.4 shared files: /Users/ralfs/Library/R/3.0/library/rgdal/proj
>>> Best regards
>>> Ralf
>>> Am 26.09.2013 um 18:05 schrieb Helen Sofaer <helen at rams.colostate.edu>:
>>>> Thanks for taking the time to look at it Ralf.
>>>> I wish that was the problem (I had transformed from WGS 84). Here's a
>>>> simpler example that just relies on the future climate data, since I
>>>> realized there's no reason to bring in that state boundary data beyond
>>>> to show that both programs were consistent with themselves for
>>>> different data.
>>>> What I find is that if I project the data in R I get very different
>>>> results than if I project the data in ArcCatalog. The reason this is
>>>> so surprising to me is that I'm defining my proj4 string to match what
>>>> is coming from GIS.
>>>> I may very well be messing this up somehow within ArcGIS, rather than
>>>> within R; it does seem like I've made a simple but major mistake
>>>> somewhere along the way (and I admit I'm more comfortable in R, which
>>>> is why I'm going through this to begin with). Can anyone else with GIS
>>>> (I have 10.1) replicate this issue? The decimal degrees used in my
>>>> example are at the end of the code, but I'd guess that one would see
>>>> the same thing with any other point locations.
>>>> Thanks again,
>>>> Helen
>>>> # Simple version:
>>>> library(sp)
>>>> library(rgdal)
>>>> # just take 10 rows (see earlier code for importing data, or copy
>>>> long/lat from end)
>>>> set.seed(123)
>>>> CGCM.Sample10 = CGCM.A2.May2047[sample(nrow(CGCM.A2.May2047), 10), ]
>>>> write.csv(CGCM.Sample10, "CGCM.Sample10.csv") # for bringing into ArcGIS
>>>> # convert to SPDF, assuming NAD83
>>>> CGCM.Sample10 = SpatialPointsDataFrame(data = CGCM.Sample10,
>>>>           coords = CGCM.Sample10[, c("long_dd", "lati_dd")],
>>>>           proj4string = CRS(as.character("+proj=longlat +datum=NAD83")))
>>>> # project to Albers
>>>> CGCM.Sample10.Albers = spTransform(CGCM.Sample10, CRS("+proj=aea
>>>> +lat_1=20 +lat2=60 +lat0=40 +lon_0=-96 +x_0=0 +y_0=0 +datum=NAD83
> 
>                       ^^^^^^^^
> 
>>>> +units=m +no_defs +ellps=GRS80 +towgs84=0,0,0"))
>>>> bbox(CGCM.Sample10.Albers)
>>>> #             min       max
>>>> # long_dd -1617766 -136530.6
>>>> # lati_dd  4702653 5158505.5
>>>> # Import same points from ArcGIS; CGCM.Sample10.csv was brought into
>>>> ArcCatalog as XY table in NAD83 and converted to shapefile (i.e.
>>>> without projected to Albers within GIS):
>>>> CGCM.Sample10.viaGIS.NAD83 =
>>>> readOGR("C:/Helen_PPR_GIS/ForPondModel/SpatialExtent",
>>>> "CGCM_Sample10_viaGIS_NAD83")
>>>> print(proj4string(CGCM.Sample10.viaGIS.NAD83))
>>>> # [1] "+proj=longlat +datum=NAD83 +no_defs +ellps=GRS80 +towgs84=0,0,0"
>>>> # if I project these data in R, I get the same results as before:
>>>> CGCM.Sample10.Albers.NotProjectedinGIS =
>>>> spTransform(CGCM.Sample10.viaGIS.NAD83, CRS("+proj=aea +lat_1=20
>>>> +lat2=60 +lat0=40 +lon_0=-96 +x_0=0 +y_0=0 +datum=NAD83 +units=m
> 
>    ^^^^^^^^ ^^^^^^^^ more issues
> 
>>>> +no_defs +ellps=GRS80 +towgs84=0,0,0"))
>>>> bbox(CGCM.Sample10.Albers.NotProjectedinGIS)
>>>> #               min       max
>>>> # coords.x1 -1617766 -136530.6
>>>> # coords.x2  4702653 5158505.5
>>>> ## The problem arises when I import data that have already been
>>>> projected within ArcGIS
>>>> # Using 'North America Albers Equal Area Conic' projection in GIS
>>>> CGCM.Sample10.viaGIS.Albers =
>>>> readOGR("C:/Helen_PPR_GIS/ForPondModel/SpatialExtent",
>>>> "CGCM_Sample10_viaGIS_Albers")
>>>> print(proj4string(CGCM.Sample10.viaGIS.Albers))
>>>> # [1] "+proj=aea +lat_1=20 +lat_2=60 +lat_0=40 +lon_0=-96 +x_0=0
>>>> +y_0=0 +datum=NAD83 +units=m +no_defs +ellps=GRS80 +towgs84=0,0,0"
>>>> bbox(CGCM.Sample10.viaGIS.Albers)
>>>> #                 min       max
>>>> # coords.x1 -1238062.2 -100922.4
>>>> # coords.x2   481037.2 1091090.2
>>>> # Full coordinates projected in R:
>>>> cbind(CGCM.Sample10.Albers at coords, CGCM.Sample10.Albers at data$long_dd,
>>>> CGCM.Sample10.Albers at data$lati_dd)
>>>> # Output (Albers X, Y, Decimal degrees X, Y):
>>>>                                           long_dd       lati_dd
>>>> [1,] -1207845.6   5150590     -108.58333   48.75000
>>>> [2,]  -386539.6    4920224     -100.00000   46.33333
>>>> [3,] -1010183.5   5072255     -106.50000   47.91667
>>>> [4,]  -231920.7    5142912     -98.41667    48.91667
>>>> [5,]  -136530.6    5006086     -97.41667    47.33333
>>>> [6,] -1617766.1   4801139     -112.66667   44.58333
>>>> [7,]  -818944.6    4702653     -104.41667  43.83333
>>>> [8,]  -216357.0    5078695     -98.25000    48.16667
>>>> [9,]  -775495.3    5158506     -104.08333  49.00000
>>>> [10,]  -934670.2   4909220     -105.66667  46.08333
>>>> # Full coordinates projected in GIS:
>>>> cbind(CGCM.Sample10.viaGIS.Albers at coords,
>>>> CGCM.Sample10.viaGIS.Albers at data$long_dd,
>>>> CGCM.Sample10.viaGIS.Albers at data$lati_dd)
>>>> # Output (Albers X, Y, Decimal degrees X, Y):
>>>> [1,]  -871738.7   1091090.2    -108.58333 48.75000
>>>> [2,]  -289861.4  754322.3     -100.00000 46.33333
>>>> [3,]  -738909.7  975962.3     -106.50000 47.91667
>>>> [4,]  -167394.6 1054895.9     -98.41667 48.91667
>>>> [5,]  -100922.4  866975.6     -97.41667 47.33333
>>>> [6,] -1238062.2  650570.7    -112.66667 44.58333
>>>> [7,]  -635489.0  481037.2     -104.41667 43.83333
>>>> [8,]  -157948.0  966332.5     -98.25000 48.16667
>>>> [9,]  -558453.2 1086390.0    -104.08333 49.00000
>>>> [10,]  -702497.8  754532.6    -105.66667 46.08333
>>>> On Thu, Sep 26, 2013 at 4:34 AM, Ralf Sch?fer <senator at ecotoxicology.de> wrote:
>>>>> Dear Helen,
>>>>> I do not have access to ArcGIS - so I can not even open the file (I can
>>>>> unzip the .lpk but not open the .sdc file). However, the package information
>>>>> says that the data is in WGS 84 - so if you imported into R you need to
>>>>> assign WGS 84 first and then convert and this should work.
>>>>> From memory, ArcGIS or QGIS always assign a CRS on opening so make sure it
>>>>> is the correct one before projection.
>>>>> From my experience, in 99% of cases where students struggled with the CRS it
>>>>> was an issue with QGIS and ArcGIS.
>>>>> Best regards,
>>>>> Ralf Sch?fer
>>>>> ------------------------------------------------------------
>>>>> Prof. Dr. habil. Ralf Bernhard Sch?fer
>>>>> Juniorprofessor for Quantitative Landscape Ecology
>>>>> Environmental Scientist (M.Sc.)
>>>>> Institute for Environmental Sciences
>>>>> University Koblenz-Landau
>>>>> Fortstrasse 7
>>>>> 76829 Landau
>>>>> Germany
>>>>> Mail: schaefer-ralf at uni-landau.de
>>>>> Phone: ++49 (0) 6341 280-31536
>>>>> Web: www.landscapecology.uni-landau.de
>>>> --
>>>> Helen Sofaer
>>>> Postdoctoral Fellow
>>>> Fish Wildlife and Conservation Biology
>>>> Colorado State University
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> 
>> 
> 
> -- 
> Roger Bivand
> Department of Economics, NHH Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no


From harb at student.unimelb.edu.au  Fri Sep 27 08:13:40 2013
From: harb at student.unimelb.edu.au (Ben Harrison)
Date: Fri, 27 Sep 2013 16:13:40 +1000
Subject: [R-sig-Geo] Can I read only a portion of a raster? (With more
	code)
In-Reply-To: <CAAcGz9-9RQvsqfhV6mHqj+==evsh-U2MX8pobF5XbFAZXk_o7Q@mail.gmail.com>
References: <l20kip$5ll$1@ger.gmane.org>
	<CAAcGz9-9RQvsqfhV6mHqj+==evsh-U2MX8pobF5XbFAZXk_o7Q@mail.gmail.com>
Message-ID: <52452214.5020601@student.unimelb.edu.au>

On 26/09/13 16:57, Michael Sumner wrote:
> Use crop() once it's been "read":
>
> r <- raster(system.file("external/test.grd", package="raster"))
> my.ext <- extent(179000, 181000, 330000, 333000)
> r <- crop(r, my.ext)
>
> There's no "ext" argument to raster() for reading from a file. There
> is that argument when you create a raster from scratch with no data,
> as an alternative to xmin/ymin/xmax/ymax.
>
> You can read a grid partially with rgdal, by either
> 1) using the index arguments to readGDAL (offset, region.dim) - but
> you have to determine those index values yourself
> 2) using GDAL.open to create a handle to the file that can be indexed
> with [,], but again you need to figure out the indexes
>
> But, raster is pretty good at opening a file and not attempting to
> read the whole thing. I would just try doing it as above with crop.
>
> Cheers, Mike.

Thanks Mike. I was wrong thinking raster read the entire file. So my 
problem is baseless.
I read about crop() too just after I sent my message, so that's the way 
to do it!
Ben.


From harb at student.unimelb.edu.au  Fri Sep 27 08:13:40 2013
From: harb at student.unimelb.edu.au (Ben Harrison)
Date: Fri, 27 Sep 2013 16:13:40 +1000
Subject: [R-sig-Geo] Can I read only a portion of a raster? (With more
	code)
In-Reply-To: <CAAcGz9-9RQvsqfhV6mHqj+==evsh-U2MX8pobF5XbFAZXk_o7Q@mail.gmail.com>
References: <l20kip$5ll$1@ger.gmane.org>
	<CAAcGz9-9RQvsqfhV6mHqj+==evsh-U2MX8pobF5XbFAZXk_o7Q@mail.gmail.com>
Message-ID: <52452214.5020601@student.unimelb.edu.au>

On 26/09/13 16:57, Michael Sumner wrote:
> Use crop() once it's been "read":
>
> r <- raster(system.file("external/test.grd", package="raster"))
> my.ext <- extent(179000, 181000, 330000, 333000)
> r <- crop(r, my.ext)
>
> There's no "ext" argument to raster() for reading from a file. There
> is that argument when you create a raster from scratch with no data,
> as an alternative to xmin/ymin/xmax/ymax.
>
> You can read a grid partially with rgdal, by either
> 1) using the index arguments to readGDAL (offset, region.dim) - but
> you have to determine those index values yourself
> 2) using GDAL.open to create a handle to the file that can be indexed
> with [,], but again you need to figure out the indexes
>
> But, raster is pretty good at opening a file and not attempting to
> read the whole thing. I would just try doing it as above with crop.
>
> Cheers, Mike.

Thanks Mike. I was wrong thinking raster read the entire file. So my 
problem is baseless.
I read about crop() too just after I sent my message, so that's the way 
to do it!
Ben.


From Roger.Bivand at nhh.no  Fri Sep 27 09:19:49 2013
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 27 Sep 2013 09:19:49 +0200
Subject: [R-sig-Geo] plotting polygons of one shapefile in different
 colors?
In-Reply-To: <1380225858977-7584730.post@n2.nabble.com>
References: <1380211448978-7584720.post@n2.nabble.com>
	<0E1E893FE7447F4F883C415B21D0E5E901246E1BB3CF@MKT-MBX01.university.ds.derby.ac.uk>
	<1380221041404-7584727.post@n2.nabble.com>
	<alpine.LRH.2.03.1309262052310.9948@reclus.nhh.no>
	<1380225858977-7584730.post@n2.nabble.com>
Message-ID: <alpine.LRH.2.03.1309270917320.12465@reclus.nhh.no>

On Thu, 26 Sep 2013, cyndy-jer wrote:

> Hi, Roger -
>
> Thank you for your reply!  I now have the map I needed.
>
> By the way, I've been finding your 2007 course materials most helpful to
> learning spatial data manipulation in R.
>

Please also see:

http://www.edii.uclm.es/~useR-2013/Tutorials/Bivand.html
http://www.edii.uclm.es/~useR-2013/Tutorials/bivand/useR13_bivand_tut.zip

also linked from:

http://www.asdar-book.org/courses.php

Roger

>
>
> Cyndy
>
>
>
>
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/plotting-polygons-of-one-shapefile-in-different-colors-tp7584720p7584730.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From u.p at operamail.com  Fri Sep 27 10:37:19 2013
From: u.p at operamail.com (up)
Date: Fri, 27 Sep 2013 01:37:19 -0700 (PDT)
Subject: [R-sig-Geo] Can I read only a portion of a raster?
In-Reply-To: <5243BCC5.8010101@student.unimelb.edu.au>
References: <5243BCC5.8010101@student.unimelb.edu.au>
Message-ID: <1380271039823-7584734.post@n2.nabble.com>

ben harrison wrote
> I thought I could do something like this:
> 
> library(raster)
> my.ext <- extent(xmn, xmx, ymn, ymx)
> my.r <- raster("raster.tif", ext=my.ext)
> 
> But it still reads in the entire file. How can I read in only the 
> portion I need?

Hi Ben!

What about "crop"?
my.r<-crop("raster.tif",my.ext)

Ciao!
Umberto



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Can-I-read-only-a-portion-of-a-raster-tp7584712p7584734.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From shahab.mokari at gmail.com  Fri Sep 27 14:33:14 2013
From: shahab.mokari at gmail.com (shahab)
Date: Fri, 27 Sep 2013 14:33:14 +0200
Subject: [R-sig-Geo] Storing List data-types as Raster values
Message-ID: <CAMZxNF6aN23AyF0Lgs5D3TnOJSTaVyJo77y96vxhgWKWLMdESQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130927/65ff73e3/attachment.pl>

From s6lihert at uni-bonn.de  Fri Sep 27 14:57:48 2013
From: s6lihert at uni-bonn.de (Lionel)
Date: Fri, 27 Sep 2013 14:57:48 +0200
Subject: [R-sig-Geo] Storing List data-types as Raster values
In-Reply-To: <CAMZxNF6aN23AyF0Lgs5D3TnOJSTaVyJo77y96vxhgWKWLMdESQ@mail.gmail.com>
References: <CAMZxNF6aN23AyF0Lgs5D3TnOJSTaVyJo77y96vxhgWKWLMdESQ@mail.gmail.com>
Message-ID: <524580CC.8050501@uni-bonn.de>

Dear Shahab,

Indeed each raster cell should contain an unique value, I guess this is 
part of the definition of what a raster is. What you could do is put 
your different variable (id, direction) in different layer of a raster 
stack.
See ?stack for example.

Yours,
Lionel

On 09/27/2013 02:33 PM, shahab wrote:
> Hi,
>
> I am quite new to Raster library and a bit confused.
> Basically I would like to raster an area, and then place information
> (Identifuer, Direction) in each cell ,as follows:
>
>> myraster<-raster()
>>   myraster[1:3]<-list(id=c(1),direction=c(14,20))
> Error in min(vals) : invalid 'type' (list) of argument
> In addition: Warning message:
> In .replace(x, i = i, value = value, recycle = 1) :
>    number of items to replace is not a multiple of replacement length
>
>
> It seems to me that I can not put an object of type List,or vector,...in
> the cells??
>
> If this is the case, what would be the alternative solutions?
>
> /Shahab
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From shahab.mokari at gmail.com  Fri Sep 27 16:51:11 2013
From: shahab.mokari at gmail.com (shahab)
Date: Fri, 27 Sep 2013 16:51:11 +0200
Subject: [R-sig-Geo] Storing List data-types as Raster values
In-Reply-To: <524580CC.8050501@uni-bonn.de>
References: <CAMZxNF6aN23AyF0Lgs5D3TnOJSTaVyJo77y96vxhgWKWLMdESQ@mail.gmail.com>
	<524580CC.8050501@uni-bonn.de>
Message-ID: <CAMZxNF7YRvcp1f1A4BnQrR+DJqC0sdGfe0w+XWNwNRM1SJxhnw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130927/dabe101a/attachment.pl>

From rahmannorthampton at gmail.com  Fri Sep 27 23:44:29 2013
From: rahmannorthampton at gmail.com (Lutfor)
Date: Fri, 27 Sep 2013 14:44:29 -0700 (PDT)
Subject: [R-sig-Geo] KernelUD image scale bar
Message-ID: <1380318268984-7584738.post@n2.nabble.com>

Dear members,

I have been trying to give scale bar on kernel contour map using
adehabitatHR package. But I could not find any function to put scale bar
onto the image produce.

Any help would be much appreciated.

Regards
Lutfor
UK   



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/KernelUD-image-scale-bar-tp7584738.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From basille.web at ase-research.org  Sat Sep 28 00:28:14 2013
From: basille.web at ase-research.org (Mathieu Basille)
Date: Fri, 27 Sep 2013 18:28:14 -0400
Subject: [R-sig-Geo] KernelUD image scale bar
In-Reply-To: <1380318268984-7584738.post@n2.nabble.com>
References: <1380318268984-7584738.post@n2.nabble.com>
Message-ID: <5246067E.1000700@ase-research.org>

Dear Lutfor,

Following the example of ?kernelUD:

## Load the package
library(adehabitatHR)

## Load the data
data(puechabonsp)
loc <- puechabonsp$relocs

## Estimation of UD for the four animals
(ud <- kernelUD(loc[,1]))

## The UD of the four animals
image(ud)

## First one with a scale
spplot(ud[[1]])

Then you'd be able to adjust it using spplot options (I'm not a specialist 
of this, I just know it can be fairly complex). The reason it works is that 
kernelUD produces an object of class estUDm, which is a list with one estUD 
object per animal. An estUD object itself inherits from the class 
SpatialPixelsDataFrame. As a result, every function that works on a spdf 
would work on an estUD too.

Things will get a little bit trickier if you want all kernels on the same 
scale. That's where you need to use the argument 'same4all = TRUE':

## Recompute the UD with the same grid for all animals
(ud2 <- kernelUD(loc[,1], same4all = TRUE))

## Convert it to a regular spdf
ud2 <- estUDm2spixdf(ud2)

## And plot
spplot(ud2)

Voil? !

Hope this helps,
Mathieu.


Le 09/27/2013 05:44 PM, Lutfor a ?crit :
> Dear members,
>
> I have been trying to give scale bar on kernel contour map using
> adehabitatHR package. But I could not find any function to put scale bar
> onto the image produce.
>
> Any help would be much appreciated.
>
> Regards
> Lutfor
> UK
>
>
>
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/KernelUD-image-scale-bar-tp7584738.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 

~$ whoami
Mathieu Basille, PhD

~$ locate --details
University of Florida \\
Fort Lauderdale Research and Education Center
(+1) 954-577-6314
http://ase-research.org/basille

~$ fortune
? Le tout est de tout dire, et je manque de mots
Et je manque de temps, et je manque d'audace. ?
  -- Paul ?luard


From r.hijmans at gmail.com  Sat Sep 28 15:51:14 2013
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Sat, 28 Sep 2013 06:51:14 -0700
Subject: [R-sig-Geo] Storing List data-types as Raster values
In-Reply-To: <CAMZxNF7YRvcp1f1A4BnQrR+DJqC0sdGfe0w+XWNwNRM1SJxhnw@mail.gmail.com>
References: <CAMZxNF6aN23AyF0Lgs5D3TnOJSTaVyJo77y96vxhgWKWLMdESQ@mail.gmail.com>
	<524580CC.8050501@uni-bonn.de>
	<CAMZxNF7YRvcp1f1A4BnQrR+DJqC0sdGfe0w+XWNwNRM1SJxhnw@mail.gmail.com>
Message-ID: <CANtt_hw5GT6sVcHz5gB4Qmy3zyBnExD6CiYGp8GfFafAWLNh4Q@mail.gmail.com>

Lionel,

You can do:

library(raster)
b <- brick(nl=2, ncol=5, nrow=5)
b[1] <- cbind(14,20)
head(as.matrix(b))

cell numbers are implicit so you do not need to create a layer for these.

Robert


On Fri, Sep 27, 2013 at 7:51 AM, shahab <shahab.mokari at gmail.com> wrote:
> Thanks Lionel, Lets see what I can do. A amjor issue is that  I need toe
> keep pair of values (id, direction) and maintaining this pair relation
> while spreading them in different layers becomes problematic.
>
> Again thanks,
>
>
> On Fri, Sep 27, 2013 at 2:57 PM, Lionel <s6lihert at uni-bonn.de> wrote:
>
>> Dear Shahab,
>>
>> Indeed each raster cell should contain an unique value, I guess this is
>> part of the definition of what a raster is. What you could do is put your
>> different variable (id, direction) in different layer of a raster stack.
>> See ?stack for example.
>>
>> Yours,
>> Lionel
>>
>>
>> On 09/27/2013 02:33 PM, shahab wrote:
>>
>>> Hi,
>>>
>>> I am quite new to Raster library and a bit confused.
>>> Basically I would like to raster an area, and then place information
>>> (Identifuer, Direction) in each cell ,as follows:
>>>
>>>  myraster<-raster()
>>>>   myraster[1:3]<-list(id=c(1),**direction=c(14,20))
>>>>
>>> Error in min(vals) : invalid 'type' (list) of argument
>>> In addition: Warning message:
>>> In .replace(x, i = i, value = value, recycle = 1) :
>>>    number of items to replace is not a multiple of replacement length
>>>
>>>
>>> It seems to me that I can not put an object of type List,or vector,...in
>>> the cells??
>>>
>>> If this is the case, what would be the alternative solutions?
>>>
>>> /Shahab
>>>
>>>         [[alternative HTML version deleted]]
>>>
>>> ______________________________**_________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/**listinfo/r-sig-geo<https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
>>>
>>
>> ______________________________**_________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/**listinfo/r-sig-geo<https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
>>
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From r.hijmans at gmail.com  Sun Sep 29 16:39:04 2013
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Sun, 29 Sep 2013 07:39:04 -0700
Subject: [R-sig-Geo] Disable Maxent clamping
In-Reply-To: <CAAO0BLdC4eW92fFP-u4TZCRTHuNW6p0HVF-JcKCrc3dYiHp_Pw@mail.gmail.com>
References: <CAAO0BLdC4eW92fFP-u4TZCRTHuNW6p0HVF-JcKCrc3dYiHp_Pw@mail.gmail.com>
Message-ID: <CANtt_hwXs0tmM0EbSKrJ7P7q8mZMcBUR2sEC5z+WhSWrhYCGXA@mail.gmail.com>

Gerardo,

I assume you are using the maxent function in the dismo package
(please by clear about such things). You can specify maxent options
via the "args" argument. See ?maxent and the help file of maxent.jar
for the options that exist. In your case, you could do something like:

mx <- maxent(predictors, occtrain, args='dontdoclamp')

as clamping is part of the model fitting, not the prediction stage.

Robert



On Tue, Sep 24, 2013 at 3:47 AM, Gerardo Martin <gerardommc at gmail.com> wrote:
> Hi, does any one know the argument (if any) to disable the clamping of
> Maxent to do projections?
>
> Cheers
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From p.gaffron at tuhh.de  Mon Sep 30 20:56:16 2013
From: p.gaffron at tuhh.de (Philine Gaffron)
Date: Mon, 30 Sep 2013 11:56:16 -0700
Subject: [R-sig-Geo] R encounters fatal error in errorsarlm - sdpep
	package
In-Reply-To: <alpine.LRH.2.03.1309250933070.15434@reclus.nhh.no>
References: <20130925031256.Horde.qsxGeD1l-NpSQjiYJzG2u4A@webmail.tu-harburg.de>
	<alpine.LRH.2.03.1309250933070.15434@reclus.nhh.no>
Message-ID: <5249C950.5000303@tuhh.de>

Thank you for the response, Roger. My answers below. I have also added a 
question on a warning message I have received and would be glad to find 
out whether this means I need to change the analysis approach or just 
have to take it as additional information.

Am 25.09.2013 00:53, schrieb Roger Bivand:
> On Wed, 25 Sep 2013, Philine Gaffron wrote:
>
>> Hello,
>>
>> I am trying to run a spatial regression analysis using the errorsarlm
>> function in the sdpep package. I first ran into memory problems (on a
>> larger dataset than the one described below) but have adjusted the
>> memory size limit:
>>
>>> memory.limit(size = 800000)
>> [1] 8e+05
>
> Which sets your memory limit under Windows to 781 Gb (size is in Mb) -
> that probably explains the error exit unless you have a lot of memory.
> Best avoid making any changes from the default in a fresh session
> unless you know exactly what you are doing.

I did up the virtual memory of the machine to 800Gb first (it has 1Tb in 
total and there is currently nothing else running on it) so I hope that 
that was not the problem. Thanks for the hint, though.

>
>>
>> However, when I try to execute the following code in R Studio, I
>> receive the message "R Session aborted - R encountered a fatal error
>> - The session was terminated"
>
> Always rerun any code with problems outside R Studio, because it can
> interfere with the reporting of warnings and errors. Certainly
> errorsarlm() has no reason to cause R to crash - and this is what you
> are suggesting. If you can reproduce this outside R Studio, and
> without setting memory limits, I may need to see your data to try to
> reproduce any error exit from the R session.

I tried this and had no more crashes - especially after I made the 
changes suggested/outlined below

>
>>
>>> ElDU.slm.PM25.white <- errorsarlm(PM_PM25 ~ race_white, data =
>>> ElDorado_urban, listw=ElDoU_listw)
>
> Did you read the advice on ?errorsarlm about the use of alternative
> methods, such as "LU" or "Matrix" for larger data sets? You are using
> the default "eigen" method, but this should certainly have worked for
> the modest n=2081. Can you reproduce the problem with a built-in data
> set, such as elect80?

I opted for the "LU" method and changed the weights style (see below). 
Is there any documentation that tells me the implications of using 
method ="LU"? I only found the note in the spdep documentation "LU_order 
default FALSE; used in ?LU_prepermutate?, note warnings given for lu 
method" but nothing further. I did receive warnings in the output, 
though (for several but not all of my datasets) and I am not sure what 
they mean / what their implications are for the results. Do I need to 
choose another method? The warnings in every case were:

1: In powerWeights(W = W, rho = lambda, order = con$pWOrder, X = B,:
not converged within order iterations

2: In powerWeights(W = t(W), rho = lambda, order = con$pWOrder, X = C,:
not converged within order iterations


I have not tried reproducing the error with the built-in dataset but if 
that is of interest to you from the point of view of spdep development, 
I could give it a try.

>
>>
>> The data was imported from an ArcGIS shape file:
>>> Parcels2008_inc_POP <- readOGR(".", "Parcels_2008_inc_pop")
>>> ElDorado_urban <- subset(Parcels2008_inc_POP, COUNTYFP10 == "017")
>>
>> The subset contains data from 2081 polygons
>>
>> The listw object was created as follows:
>>
>>> Eld_U_coords <- coordinates(ElDorado_urban)
>>> Eld_U_IDs <- row.names(ElDorado_urban)
>>> ElDoU_nb <- dnearneigh(Eld_U_coords, d1 = 0, d2 = 492, row.names =
>>> Eld_U_IDs)
>
> Is 492 a well-chosen upper distance threshold? I assume that the input
> data are projected, so that these are measures in the units of the
> projection - metres? If Eld_U_coords are actually geographical
> coordinates, but longlat=NULL, d2 is taken as a planar measure, if you
> declare longlat=TRUE, it is in km. There is no easy way to trap
> undeclared geographical coordinates.

The distance thresholds are in feet 
(NAD_1983_StatePlane_California_II_FIPS_0402_Feet) and are related to 
dispersion distances for road traffic emissions. For explanation: my 
polygons are land use parcels for which I have calculated emission loads 
in grams/area from traffic loads on a road network. Since I am assuming 
a dispersion distance of 492 feet / 150 m of emissions away from the 
network in the example above, I am further assuming, that parcels which 
are within that distance of one another are affected by the same 
emission sources (i.e. traffic loads on the network).

>
>>> ElDoU_listw <- nb2listw(ElDoU_nb, glist=NULL, style="S",
>>> zero.policy=NULL)
>>
>
> Does choosing a different style make a difference ("S" is not often
> used)?

I chose "S" as a variance stabilising coding schemes following Bivand, 
Pebesma et al. (2008), p. 253 but have now switched back to "W". Apart 
from the warnings cited above I encountered no more issues.

Thank you for your help and for making this package available.

Philine

>
> Roger
>
>> Is there anything inherent in my approach that could cause this
>> problem or would one need to look at the data? I include the session
>> info below.
>>
>> Thanks for any help,
>>
>> Philine
>>
>>> sessionInfo()
>> R version 3.0.1 (2013-05-16)
>> Platform: x86_64-w64-mingw32/x64 (64-bit)
>>
>> locale:
>> [1] LC_COLLATE=English_United States.1252 LC_CTYPE=English_United
>> States.1252 LC_MONETARY=English_United States.1252 LC_NUMERIC=C
>> [5] LC_TIME=English_United States.1252
>>
>> attached base packages:
>> [1] stats graphics grDevices utils datasets methods base
>>
>> other attached packages:
>> [1] spdep_0.5-65 Matrix_1.0-12 lattice_0.20-15 rgdal_0.8-11 sp_1.0-13
>>
>> loaded via a namespace (and not attached):
>> [1] boot_1.3-9 coda_0.16-1 deldir_0.0-22 grid_3.0.1 LearnBayes_2.12
>> MASS_7.3-26 nlme_3.1-109 splines_3.0.1 tools_3.0.1
>>
>>> library(help=spdep)
>> Information on package ?spdep?
>>
>> Description:
>>
>> Package: spdep
>> Version: 0.5-65
>> Date: 2013-09-04
>>
>>
>

-- 

*Philine**Gaffron PhD MLA BSc*

Fellow of the German Research Foundation (DFG)

/Project 'Urban Transport and Environmental Justice' /

Visiting Researcher

Institute of Transportation Studies

University of California Davis

Davis, CA 95616


From Roger.Bivand at nhh.no  Mon Sep 30 21:31:09 2013
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 30 Sep 2013 21:31:09 +0200
Subject: [R-sig-Geo] R encounters fatal error in errorsarlm - sdpep
 package
In-Reply-To: <5249C850.9080604@tu-harburg.de>
References: <20130925031256.Horde.qsxGeD1l-NpSQjiYJzG2u4A@webmail.tu-harburg.de>
	<alpine.LRH.2.03.1309250933070.15434@reclus.nhh.no>
	<5249C850.9080604@tu-harburg.de>
Message-ID: <alpine.LRH.2.03.1309302058400.27490@reclus.nhh.no>

On Mon, 30 Sep 2013, Philine Gaffron wrote:

> Thank you for the response, Roger. My answers below. I have also added a 
> question on a warning message I have received and would be glad to find out 
> whether this means I need to change the analysis approach or just have to 
> take it as additional information.

Thanks for reporting back: some points for clarification inline.

>
> Am 25.09.2013 00:53, schrieb Roger Bivand:
>> On Wed, 25 Sep 2013, Philine Gaffron wrote:
>> 
>>> Hello,
>>> 
>>> I am trying to run a spatial regression analysis using the errorsarlm
>>> function in the sdpep package. I first ran into memory problems (on a
>>> larger dataset than the one described below) but have adjusted the
>>> memory size limit:
>>> 
>>>> memory.limit(size = 800000)
>>> [1] 8e+05
>> 
>> Which sets your memory limit under Windows to 781 Gb (size is in Mb) -
>> that probably explains the error exit unless you have a lot of memory.
>> Best avoid making any changes from the default in a fresh session
>> unless you know exactly what you are doing.
>
> I did up the virtual memory of the machine to 800Gb first (it has 1Tb in 
> total and there is currently nothing else running on it) so I hope that that 
> was not the problem. Thanks for the hint, though.
>
>> 
>>> 
>>> However, when I try to execute the following code in R Studio, I
>>> receive the message "R Session aborted - R encountered a fatal error
>>> - The session was terminated"
>> 
>> Always rerun any code with problems outside R Studio, because it can
>> interfere with the reporting of warnings and errors. Certainly
>> errorsarlm() has no reason to cause R to crash - and this is what you
>> are suggesting. If you can reproduce this outside R Studio, and
>> without setting memory limits, I may need to see your data to try to
>> reproduce any error exit from the R session.
>
> I tried this and had no more crashes - especially after I made the changes 
> suggested/outlined below

Does this mean that the R error exit occurred when you used R Studio, and 
did not occur when R was run directly, using exactly the same data and 
code? If so, please also let the R Studio people know, so that they can 
continue debugging.

>
>> 
>>> 
>>>> ElDU.slm.PM25.white <- errorsarlm(PM_PM25 ~ race_white, data =
>>>> ElDorado_urban, listw=ElDoU_listw)
>> 
>> Did you read the advice on ?errorsarlm about the use of alternative
>> methods, such as "LU" or "Matrix" for larger data sets? You are using
>> the default "eigen" method, but this should certainly have worked for
>> the modest n=2081. Can you reproduce the problem with a built-in data
>> set, such as elect80?
>
> I opted for the "LU" method and changed the weights style (see below). Is 
> there any documentation that tells me the implications of using method ="LU"? 
> I only found the note in the spdep documentation "LU_order default FALSE; 
> used in ?LU_prepermutate?, note warnings given for lu method" but nothing 
> further. I did receive warnings in the output, though (for several but not 
> all of my datasets) and I am not sure what they mean / what their 
> implications are for the results. Do I need to choose another method? The 
> warnings in every case were:
>

See Bivand, Hauke & Kossowski (2013) Geographical Analysis for some 
details; LU_prepermutate emulates the implementation by finding an initial 
fill-in re-ordering, but in R has little speed-up effect, hence it is 
turned off by default.

> 1: In powerWeights(W = W, rho = lambda, order = con$pWOrder, X = B,:
> not converged within order iterations
>
> 2: In powerWeights(W = t(W), rho = lambda, order = con$pWOrder, X = C,:
> not converged within order iterations

These are unusual, and may signal a mis-specified setting. The default 
number of powers is 250, and lambda^250 is a very small number unless 
lambda is close to its (probably upper) limit. The computation in fact 
only affects the accuracy of the Hausman test on the difference between 
OLS and spatial error coefficients, so may be adjusted if lambda is close 
to limits by setting control argument pWOrder to a larger value than 250, 
see ?powerWeights. As a symptom of lambda close to its limits, it suggests 
mis-specification, possibly in terms of observation support, with 
neighbouring properties sharing important drivers. This may be suggested 
by your data scenario described below; scrutinising the intermediate 
objects in your script may also put you on the track of things behaving in 
unexpected ways. I would expect many observations to have no neighbours 
with a 150m threshold, but you don't show no-neighbour control being 
turned off.

Hope the helps,

Roger

>
>
> I have not tried reproducing the error with the built-in dataset but if that 
> is of interest to you from the point of view of spdep development, I could 
> give it a try.
>
>> 
>>> 
>>> The data was imported from an ArcGIS shape file:
>>>> Parcels2008_inc_POP <- readOGR(".", "Parcels_2008_inc_pop")
>>>> ElDorado_urban <- subset(Parcels2008_inc_POP, COUNTYFP10 == "017")
>>> 
>>> The subset contains data from 2081 polygons
>>> 
>>> The listw object was created as follows:
>>> 
>>>> Eld_U_coords <- coordinates(ElDorado_urban)
>>>> Eld_U_IDs <- row.names(ElDorado_urban)
>>>> ElDoU_nb <- dnearneigh(Eld_U_coords, d1 = 0, d2 = 492, row.names =
>>>> Eld_U_IDs)
>> 
>> Is 492 a well-chosen upper distance threshold? I assume that the input
>> data are projected, so that these are measures in the units of the
>> projection - metres? If Eld_U_coords are actually geographical
>> coordinates, but longlat=NULL, d2 is taken as a planar measure, if you
>> declare longlat=TRUE, it is in km. There is no easy way to trap
>> undeclared geographical coordinates.
>
> The distance thresholds are in feet 
> (NAD_1983_StatePlane_California_II_FIPS_0402_Feet) and are related to 
> dispersion distances for road traffic emissions. For explanation: my polygons 
> are land use parcels for which I have calculated emission loads in grams/area 
> from traffic loads on a road network. Since I am assuming a dispersion 
> distance of 492 feet / 150 m of emissions away from the network in the 
> example above, I am further assuming, that parcels which are within that 
> distance of one another are affected by the same emission sources (i.e. 
> traffic loads on the network).
>
>> 
>>>> ElDoU_listw <- nb2listw(ElDoU_nb, glist=NULL, style="S",
>>>> zero.policy=NULL)
>>> 
>> 
>> Does choosing a different style make a difference ("S" is not often
>> used)?
>
> I chose "S" as a variance stabilising coding schemes following Bivand, 
> Pebesma et al. (2008), p. 253 but have now switched back to "W". Apart from 
> the warnings cited above I encountered no more issues.
>
> Thank you for your help and for making this package available.
>
> Philine
>
>> 
>> Roger
>> 
>>> Is there anything inherent in my approach that could cause this
>>> problem or would one need to look at the data? I include the session
>>> info below.
>>> 
>>> Thanks for any help,
>>> 
>>> Philine
>>> 
>>>> sessionInfo()
>>> R version 3.0.1 (2013-05-16)
>>> Platform: x86_64-w64-mingw32/x64 (64-bit)
>>> 
>>> locale:
>>> [1] LC_COLLATE=English_United States.1252 LC_CTYPE=English_United
>>> States.1252 LC_MONETARY=English_United States.1252 LC_NUMERIC=C
>>> [5] LC_TIME=English_United States.1252
>>> 
>>> attached base packages:
>>> [1] stats graphics grDevices utils datasets methods base
>>> 
>>> other attached packages:
>>> [1] spdep_0.5-65 Matrix_1.0-12 lattice_0.20-15 rgdal_0.8-11 sp_1.0-13
>>> 
>>> loaded via a namespace (and not attached):
>>> [1] boot_1.3-9 coda_0.16-1 deldir_0.0-22 grid_3.0.1 LearnBayes_2.12
>>> MASS_7.3-26 nlme_3.1-109 splines_3.0.1 tools_3.0.1
>>> 
>>>> library(help=spdep)
>>> Information on package ?spdep?
>>> 
>>> Description:
>>> 
>>> Package: spdep
>>> Version: 0.5-65
>>> Date: 2013-09-04
>>> 
>>> 
>> 
>
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

