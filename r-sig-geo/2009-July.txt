From Adrian.Baddeley at csiro.au  Wed Jul  1 08:03:33 2009
From: Adrian.Baddeley at csiro.au (Adrian.Baddeley at csiro.au)
Date: Wed, 1 Jul 2009 14:03:33 +0800
Subject: [R-sig-Geo] SPATSTAT: converting owin(mask) to owin (polygon)
	PART II
In-Reply-To: <4A4A1CD6.4030309@cebc.cnrs.fr>
References: <mailman.17.1246356004.21217.r-sig-geo@stat.math.ethz.ch>
	<57DC18C299094D4299F837570C5DF1C502AA3B9522@EXWA-MBX01.nexus.csiro.au>,
	<4A4A1CD6.4030309@cebc.cnrs.fr>
Message-ID: <57DC18C299094D4299F837570C5DF1C502AA3B4C2E@EXWA-MBX01.nexus.csiro.au>

Sorry, that should have been 'box=FALSE', not 'axes=FALSE'.

Apart from this problem, which I emphasise is a bug in the PLOTTING code for tessellations in spatstat 1.15-4, the tessellation has been computed correctly, and you can do all the analysis described below, using pixel-based tessellations.

Spatstat 1.16-0 is about to be released; it contains a bug fix for this problem.

At the moment there is no single piece of code in spatstat to convert a mask to a polygon. I will implement something in spatstat 1.16-1.

In the meantime, an alternative would be to draw circles of a given radius around each of the data points, and to take the union of these circles as the domain of interest. Example:

      X <- runifpoint(50)
      plot(X)
      rad <- 0.1
      region <- NULL
      for(i in seq(X$n)) {
          d <- disc(rad, c(X$x[i], X$y[i]))
          region <- union.owin(region, d)
      }
      plot(region, add=TRUE)

 Regards
Adrian Baddeley



________________________________
From: Alexandre VILLERS [alexandre.villers at cebc.cnrs.fr]
Sent: Tuesday, 30 June 2009 10:10 PM
To: Baddeley, Adrian (CMIS, Floreat)
Cc: r-sig-geo at stat.math.ethz.ch; r.turner at auckland.ac.nz
Subject: SPATSTAT: converting owin(mask) to owin (polygon) PART II

Thank you Adrian for your message (and the shortcut ! I haven't been through) but the add of axes=F didn't change anything to me (R 2.9.0 and spatstat_1.15-4).
So I'm still wondering if there is an existing implemented function in R that could convert a binary mask to a polygon (which would be more "handy" for me).

So here is the goal of the work. If anyone has an idea of how this can be done with an R package...

I have a dataset on Golden Eagle breeding in the Alps. Along with data on the breeding success of almost all territories each year, I have the location of those territories' nests (a point pattern). Since the population has increased (from 80 to 142 breeding pairs) and since I have no accurate idea of home range sizes, I would have been interested in getting an approximate territory size by a Dirichlet tesselation (one of the reason why I used spatstat)
.
But, I cannot simply draw an arbitrary line around the study area (my observation window) in order to "cut" the tesselation. Since the population has increased, the shape of such polygon would fit with the last years data but won't do it at the beginning of the survey. So I wanted, for each year, to determine a treshold for the intensity of the point pattern (with biologically relevant sigma values), retrieve all the datas below that treshold, create an observation window with the rest of it and calculate the tesselation on the point pattern.
Then, use this tesselation along with data on habitat (vegetation, temperatures, snow covers, etc.) under those polygons in order to understand the settlement pattern and its consequences on breeding pairs.


From hengl at spatial-analyst.net  Wed Jul  1 11:33:14 2009
From: hengl at spatial-analyst.net (Tomislav Hengl)
Date: Wed, 1 Jul 2009 11:33:14 +0200
Subject: [R-sig-Geo] FYI: GDEM is out! / Open Access Journals / CAPAWARE (3D
	GIS layer browser)
Message-ID: <BCF4EE2C891240E8BBA700665B2682A5@pcibed193>


Hi all,

Some exciting news that I felt like sharing over this mailing list...

---------------------------------------
GDEM GLOBAL DEM AT 30 m RESOLUTION

The first 30 m resolution global DEM has just been released (this is now the most detailed global
GIS layer with public access - I've read about it in the news). The GDEM was created by
stereo-correlating the 1.3 million-scene ASTER archive of optical images, covering almost 98% of
Earth's land surface (95% vertical ci: 20 meters, 95% horizontal ci: 30 meters). The one-by-one-
degree tiles can be downloaded from NASA's EOS data archive and/or Japan's Ground Data System. I
have just downloaded some tiles for the areas in the Netherlands and it does not look very
promising: (1) there is still a lot of filtering to be done (you can see tiles borders and similar
artifacts); (2) the DEM is rather noisy (see att.). Data can be downloaded from JAPAN/METI
[http://www.gdem.aster.ersdac.or.jp/] or LP DAAC [https://wist.echo.nasa.gov/~wist/api/imswelcome/].
Caution: the download is rather difficult because the Japanese server is always down; the NASA's
server requires that you register and fill out some questions. 

Read more: http://www.nasa.gov/topics/earth/features/20090629.html 

---------------------------------------
OPEN ACCESS JOURNALS

Why not publish in Open Access Journals?

There is an increasing number of open access journals (OAJs) that are worth promoting among your
colleagues. Some of the OAJ even have a fairly high Impact Factor. For example, we have decided to
publish the papers from our Geomorphometry conference in the HESS journal, which has an impact
factor of 2.2. Read more: http://2009.geomorphometry.org/special_issue.htm  

Here are some OAJs that might be of interest:
*Biogeosciences (BG): http://www.biogeosciences.net/  
*Hydrology and Earth System Sciences (HESS): http://www.hydrology-and-earth-system-sciences.net/ 
*(NEW) Remote Sensing: http://www.mdpi.com/journal/remotesensing/  

Note that the OAJs typically assign copyright to authors and allow access to the discussion and
revision process (this is often more interesting than the paper itself!!). Not to mention that
anybody can comment on a paper etc.

---------------------------------------
CAPAWARE.ORG - AN OPEN SOURCE 3D MULTILAYER FRAMEWORK

Are you aware of the Capaware (http://en.wikipedia.org/wiki/Capaware)? Finally, a decent alternative
for Google Earth? It is open source, so go ahead and test it (product of Instituto Tecnol?gico de
Canarias).

Some video demos: http://www.capaware.org/index.php?option=com_content&view=article&id=82&Itemid=101


---------------------------------------

cheers,

Tom Hengl
http://spatial-analyst.net 

-------------- next part --------------
A non-text attachment was scrubbed...
Name: GDEM_README.pdf
Type: application/pdf
Size: 58590 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090701/3f96364b/attachment.pdf>

From burney at stanford.edu  Thu Jul  2 02:30:00 2009
From: burney at stanford.edu (Jennifer Burney)
Date: Wed, 1 Jul 2009 17:30:00 -0700
Subject: [R-sig-Geo] Raster data (.adf) problem with rgdal
Message-ID: <93593c2b0907011730i3b3d4827ya64fecefab02a86a@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090701/cfae2b96/attachment.pl>

From Roger.Bivand at nhh.no  Thu Jul  2 11:51:10 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 2 Jul 2009 11:51:10 +0200 (CEST)
Subject: [R-sig-Geo] Raster data (.adf) problem with rgdal
In-Reply-To: <93593c2b0907011730i3b3d4827ya64fecefab02a86a@mail.gmail.com>
References: <93593c2b0907011730i3b3d4827ya64fecefab02a86a@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.0907021141560.3521@reclus.nhh.no>

On Wed, 1 Jul 2009, Jennifer Burney wrote:

> Hi all,
>
> I am trying to read some ArcView raster data into R (data located at:
> http://www.sage.wisc.edu/atlas/data.php?incdataset=Suitability%20for%20Agriculture
> ).
>
> I have had the experience mentioned by others in previous posts, where
> RArcInfo crashes and can't seem to handle this file (although it isn't very
> big), so I've been attempting to follow the advice posted here and use
> rgdal. Unfortunately, I don't get very far:

RArcInfo is only for vector coverages, not for grids - it would be the 
same as readOGR().

>
> p="/Users/jab/Desktop/suit/suit/hdr.adf"
> x=new("GDALReadOnlyDataset",p)
>
> returns: Error in .local(.Object, ...) :
>  GDAL Error 3: Attempt to read past EOF in
> /Users/jab/Desktop/suit/suit/../info/arc.dir.
>

Reproduced.

> Thoughts?

Broken file? The GDAL drivers can only handle some implementation 
oddities. After going to GTiff, the data can be retrieved. If you have 
gdal_transform on your PATH, this works:

system("gdal_translate -of 'GTiff' suit/hdr.adf suit.tif")

with error messages, and:

> zz <- readGDAL("suit.tif")
suit.tif has GDAL driver GTiff
and has 360 rows and 720 columns
> summary(zz)
Object of class SpatialGridDataFrame
Coordinates:
    min max
x -180 180
y  -90  90
Is projected: NA
proj4string : [NA]
Number of points: 2
Grid attributes:
   cellcentre.offset cellsize cells.dim
x           -179.75      0.5       720
y            -89.75      0.5       360
Data attributes:
  Min.  1st Qu.   Median     Mean  3rd Qu.     Max.       NA's
0.000    0.004    0.046    0.224    0.397    0.999 200280.000
> image(zz)

looks plausible.

Hope this helps,

Roger

PS. Maybe let the data provider know that GTiff is a more suitable 
format, and the zipped file is only one third of the size of the zipped 
AI binary grid.

>
> Thanks in advance,
> Jen
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From alexandre.villers at cebc.cnrs.fr  Thu Jul  2 14:18:28 2009
From: alexandre.villers at cebc.cnrs.fr (alexandre villers)
Date: Thu, 02 Jul 2009 14:18:28 +0200
Subject: [R-sig-Geo] many thanks
Message-ID: <1246537108.823c2d4alexandre.villers@cebc.cnrs.fr>

Many thanks Adrian for your help...
Let's run the analysis !


Alex
Alexandre Villers
PhD. Student
Team Biodiversity
CEBC CNRS
79360 Beauvoir sur Niort


__________ Information from ESET Mail Security, version of virus signature database 4209 (20090702) __________

The message was checked by ESET Mail Security.
http://www.eset.com


From a.ghisla at gmail.com  Fri Jul  3 14:51:56 2009
From: a.ghisla at gmail.com (Anne Ghisla)
Date: Fri, 03 Jul 2009 14:51:56 +0200
Subject: [R-sig-Geo] [Report #6] Kriging with GRASS and R: v.autokrige port
 to wxPython and more
Message-ID: <1246625516.7011.10.camel@galadriel.uagra.net>

Hello all, and sorry for cross-posting,

this week I worked on removing parameters hardwired in the code, binding
them to the interface instead.
Therefore, now it is possible use all widgets in gstat and automap
pages, i.e. pick up the model from a list, set sill, nugget and range;
set the output raster map name and eventually overwrite it.

I'm going to implement CLI in these next days, it will very likely need
to reorganise the code and clearly split interface from model.

Blocking issues - none.

best regards,

Anne

More info on the wiki page - updated daily:
http://grass.osgeo.org/wiki/V.autokrige_GSoC_2009

-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 197 bytes
Desc: Questa ? una parte del messaggio	firmata digitalmente
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090703/96696fb4/attachment.bin>

From alobolistas at gmail.com  Fri Jul  3 15:03:07 2009
From: alobolistas at gmail.com (Agustin Lobo)
Date: Fri, 03 Jul 2009 15:03:07 +0200
Subject: [R-sig-Geo] Distribute points along lines
Message-ID: <4A4E018B.6000602@gmail.com>

Hi!

Is there any way to distribute a set of random or regularly-spaced
points along a line imported from a shape file into a
SpatialLinesDataFrame? I've been searching, but could not find it.
Should I use coordinates() to get the vertex, then calculate the a&b
parameters for each line and distribute the points? Or is it there
something already done?

Thanks,

Agus

Dr. Agustin Lobo
Institut de Ciencies de la Terra "Jaume Almera" (CSIC)
LLuis Sole Sabaris s/n
08028 Barcelona
Spain
Tel. 34 934095410
Fax. 34 934110012
email: Agustin.Lobo at ija.csic.es
http://www.ija.csic.es/gt/obster


From ksafi at orn.mpg.de  Fri Jul  3 15:14:53 2009
From: ksafi at orn.mpg.de (Kamran Safi)
Date: Fri, 03 Jul 2009 15:14:53 +0200
Subject: [R-sig-Geo] Distribute points along lines
In-Reply-To: <4A4E018B.6000602@gmail.com>
References: <4A4E018B.6000602@gmail.com>
Message-ID: <4A4E044D.4070304@orn.mpg.de>

Hi,

I think you can use spsample() together with type=random and n=your 
sample size.

Kami



Agustin Lobo wrote:
> Hi!
>
> Is there any way to distribute a set of random or regularly-spaced
> points along a line imported from a shape file into a
> SpatialLinesDataFrame? I've been searching, but could not find it.
> Should I use coordinates() to get the vertex, then calculate the a&b
> parameters for each line and distribute the points? Or is it there
> something already done?
>
> Thanks,
>
> Agus
>
> Dr. Agustin Lobo
> Institut de Ciencies de la Terra "Jaume Almera" (CSIC)
> LLuis Sole Sabaris s/n
> 08028 Barcelona
> Spain
> Tel. 34 934095410
> Fax. 34 934110012
> email: Agustin.Lobo at ija.csic.es
> http://www.ija.csic.es/gt/obster
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
-- 

Kamran Safi

Max Planck Institute for Ornithology
Vogelwarte Radolfzell
Schlossallee 2
78315 Radolfzell
Germany

Phone +49-7732-150173
Fax +49-7732-150190

and

Institute of Zoology
Zoological Society of London
Regent's Park
NW1 4RY London
United Kingdom
-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/x-pkcs7-signature
Size: 3275 bytes
Desc: S/MIME Cryptographic Signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090703/92ebb318/attachment.bin>

From Roger.Bivand at nhh.no  Fri Jul  3 15:23:26 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 3 Jul 2009 15:23:26 +0200 (CEST)
Subject: [R-sig-Geo] Distribute points along lines
In-Reply-To: <4A4E044D.4070304@orn.mpg.de>
References: <4A4E018B.6000602@gmail.com> <4A4E044D.4070304@orn.mpg.de>
Message-ID: <alpine.LRH.2.00.0907031520230.6895@reclus.nhh.no>

On Fri, 3 Jul 2009, Kamran Safi wrote:

> Hi,
>
> I think you can use spsample() together with type=random and n=your sample 
> size.
>

Exactly:

library(sp)
data(meuse.riv)
SL <- SpatialLines(list(Lines(list(Line(meuse.riv[1:80,])), ID="1")))
plot(SL)
pts <- spsample(SL, n=50, type="random")
plot(pts, add=TRUE)

Here we only have one Line object in the single Lines object, but the 
principle is the same.

Roger

> Kami
>
>
>
> Agustin Lobo wrote:
>> Hi!
>> 
>> Is there any way to distribute a set of random or regularly-spaced
>> points along a line imported from a shape file into a
>> SpatialLinesDataFrame? I've been searching, but could not find it.
>> Should I use coordinates() to get the vertex, then calculate the a&b
>> parameters for each line and distribute the points? Or is it there
>> something already done?
>> 
>> Thanks,
>> 
>> Agus
>> 
>> Dr. Agustin Lobo
>> Institut de Ciencies de la Terra "Jaume Almera" (CSIC)
>> LLuis Sole Sabaris s/n
>> 08028 Barcelona
>> Spain
>> Tel. 34 934095410
>> Fax. 34 934110012
>> email: Agustin.Lobo at ija.csic.es
>> http://www.ija.csic.es/gt/obster
>> 
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> 
>> 
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From havyhidalgo at hotmail.com  Fri Jul  3 18:13:22 2009
From: havyhidalgo at hotmail.com (Javi Hidalgo)
Date: Fri, 3 Jul 2009 18:13:22 +0200
Subject: [R-sig-Geo]  The step before interfacing to GRASS
Message-ID: <SNT114-W28E424FCDA70093C5ECF45A92C0@phx.gbl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090703/f5177eb8/attachment.pl>

From Roger.Bivand at nhh.no  Fri Jul  3 18:55:10 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 3 Jul 2009 18:55:10 +0200 (CEST)
Subject: [R-sig-Geo] The step before interfacing to GRASS
In-Reply-To: <SNT114-W28E424FCDA70093C5ECF45A92C0@phx.gbl>
References: <SNT114-W28E424FCDA70093C5ECF45A92C0@phx.gbl>
Message-ID: <alpine.LRH.2.00.0907031850580.8293@reclus.nhh.no>

On Fri, 3 Jul 2009, Javi Hidalgo wrote:

>
> Dear R-experts,
>
> A very basic terrain calculated as a matrix from Spatial Points Patterns:
>
> #interpolate using the akima package
> library(akima)
> terrain=interp(ppoints$x,ppoints$y,ppoints$marks,xo=x0,yo=y0, linear=F)
>
>> class(terrain)
> [1] "list"
>> class(terrain$x) #these are the x-coord i.e: [1...1000]
> [1] "numeric"
>> class(terrain$y)#these are the y-coord i.e: [1...1000]
> [1] "numeric"
>> class(terrain$z)#these are the height of the points
> [1] "matrix"
>
> I would like to export this "terrain" (list object) to GRASS.
> Reading the documentation that I found for interfacing between GRASS 6 and R (library (spgrass6)). I understood the following (I already managed to configured properly the mapset and so on):
>
> 1. I have to create a SpatialGridDataFrame object before to write into a Raster file.
> 2. In order to create a SpatialGridDataFrame I need a GridTopology.
> 3. After doing it, I am allow to write the file into GRASS using the function writeRAST6, like: writeRAST6 (spterrain, "maps.dem").
>
> How to create the SpatialGridDataFrame and/or the GridTopology? I am 
> doing something wrong.

Use image2Grid() in sp in the output of interp(). You may need to take 
care in your choice of x0 and x1 to match the GRASS region.

For example:

library(sp)
data(meuse)
coordinates(meuse) <- c("x", "y")
library(akima)
terrain <- interp(coordinates(meuse)[,1], coordinates(meuse)[,2],
   meuse$elev, linear=FALSE)
terrain_SGDF <- image2Grid(terrain)
summary(terrain_SGDF)
image(terrain_SGDF, col=terrain.colors(10))
points(meuse)

Hope this helps,

Roger


>
> Thanks a lot,
>
> Javier Hidalgo.
> _________________________________________________________________
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From alobolistas at gmail.com  Fri Jul  3 19:01:29 2009
From: alobolistas at gmail.com (Agustin Lobo)
Date: Fri, 03 Jul 2009 19:01:29 +0200
Subject: [R-sig-Geo] Distribute points along lines
In-Reply-To: <alpine.LRH.2.00.0907031520230.6895@reclus.nhh.no>
References: <4A4E018B.6000602@gmail.com> <4A4E044D.4070304@orn.mpg.de>
	<alpine.LRH.2.00.0907031520230.6895@reclus.nhh.no>
Message-ID: <4A4E3969.8050103@gmail.com>

Thanks,

I'm actually doing:

plot(fl1)
points(spsample(fl1[4,],5,offset=0.001,type="regular"))

but why offset=0 does not work?
 > points(spsample(fl1[4,],5,offset=0.0,type="regular"))
Error in validObject(.Object) :
invalid class "SpatialPoints" object: bbox should never contain NA values

Also, which are the units for offset? I'm actually trying to set real
field sampling sites, so this matters. The best would be being able to 
set the first point in the
line and then the nb of points for random sites (as it is currently done)
and the length interval for regular sampling.

By now I can adjust the nb. of points for the interval I want if the 
length of
the line is known, but how can I calculate the length of the lines? 
calcLength
requires another type of spatial object.

Agus



Roger Bivand wrote:
> On Fri, 3 Jul 2009, Kamran Safi wrote:
>
>> Hi,
>>
>> I think you can use spsample() together with type=random and n=your 
>> sample size.
>>
>
> Exactly:
>
> library(sp)
> data(meuse.riv)
> SL <- SpatialLines(list(Lines(list(Line(meuse.riv[1:80,])), ID="1")))
> plot(SL)
> pts <- spsample(SL, n=50, type="random")
> plot(pts, add=TRUE)
>
> Here we only have one Line object in the single Lines object, but the 
> principle is the same.
>
> Roger
>
>> Kami
>>
>>
>>
>> Agustin Lobo wrote:
>>> Hi!
>>>
>>> Is there any way to distribute a set of random or regularly-spaced
>>> points along a line imported from a shape file into a
>>> SpatialLinesDataFrame? I've been searching, but could not find it.
>>> Should I use coordinates() to get the vertex, then calculate the a&b
>>> parameters for each line and distribute the points? Or is it there
>>> something already done?
>>>
>>> Thanks,
>>>
>>> Agus
>>>
>>> Dr. Agustin Lobo
>>> Institut de Ciencies de la Terra "Jaume Almera" (CSIC)
>>> LLuis Sole Sabaris s/n
>>> 08028 Barcelona
>>> Spain
>>> Tel. 34 934095410
>>> Fax. 34 934110012
>>> email: Agustin.Lobo at ija.csic.es
>>> http://www.ija.csic.es/gt/obster
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>>
>>
>

-------------- next part --------------
A non-text attachment was scrubbed...
Name: alobolistas.vcf
Type: text/x-vcard
Size: 251 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090703/48fbe622/attachment.vcf>

From alobolistas at gmail.com  Fri Jul  3 19:46:10 2009
From: alobolistas at gmail.com (Agustin Lobo)
Date: Fri, 03 Jul 2009 19:46:10 +0200
Subject: [R-sig-Geo] subsetting Spatial*DataFrame
Message-ID: <4A4E43E2.90204@gmail.com>

I apologize for raising the same topic from time to time,
but each time I have to subset  Spatial*DataFrame
objects (where * stands for polygons, lines or points) I
get some problems.

Last year Roger was kindly advising:
"Just think of Spatial*DataFrame objects as data.frame objects and things
will be much clearer"

Nevertheless, when I have to subset my lines now, I find that, given
 > str(fl1,max.level=2)
Formal class 'SpatialLinesDataFrame' [package "sp"] with 4 slots
  ..@ data       :'data.frame':    4 obs. of  2 variables:
  ..@ lines      :List of 4
  ..@ bbox       : num [1:2, 1:2] 448617 4630059 450088 4631874
  .. ..- attr(*, "dimnames")=List of 2
  ..@ proj4string:Formal class 'CRS' [package "sp"] with 1 slots

with
 > fl1 at data
  CodLin Comment
0      1    <NA>
1      2    <NA>
2      3    <NA>
3      4    <NA>

I can subset the data frame either as
 > fl1 at data[1,]
  CodLin Comment
0      1    <NA>

or as

 > fl1 at data["0",]
  CodLin Comment
0      1    <NA>

but for the  SLDF,  while  I  can use
 > plot(fl1[1,])
I cannot use:
 > plot(fl1["0",])
Error: trying to get slot "Lines" from an object of a basic class 
("NULL") with no slots

So what would be the way of subsetting by IDs?

Also, Roger advised to get the IDs through either
 > sapply(slot(fl1, "lines"), function(x) slot(x, "ID"))
[1] "0" "1" "2" "3"
or
 > rownames(as.data.frame(fl1))
[1] "0" "1" "2" "3"

Considering that getting the IDs is an important task, would not
be appropriate  having  an specific  function,  as  in the case of 
coordinates()?
For example,  ID(fl1) would be a lot easier to remember.

(I know I can do that function for my personal use, but then you end up 
not using standard R)

Thanks!

Agus



-------------- next part --------------
A non-text attachment was scrubbed...
Name: alobolistas.vcf
Type: text/x-vcard
Size: 251 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090703/b68342ef/attachment.vcf>

From edzer.pebesma at uni-muenster.de  Sat Jul  4 00:09:29 2009
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Sat, 04 Jul 2009 00:09:29 +0200
Subject: [R-sig-Geo] subsetting Spatial*DataFrame
In-Reply-To: <4A4E43E2.90204@gmail.com>
References: <4A4E43E2.90204@gmail.com>
Message-ID: <4A4E8199.2010702@uni-muenster.de>

Thanks, Augusting for pointing out a flaw in the [ methods for
Spatial*DataFrames. To be really honest, I didn't even know that you
could select rows by ID this way. After 16 years of using S!

I'll look into it when I get the chance; this may however take (quite) a
while.
--
Edzer

Agustin Lobo wrote:
> I apologize for raising the same topic from time to time,
> but each time I have to subset  Spatial*DataFrame
> objects (where * stands for polygons, lines or points) I
> get some problems.
>
> Last year Roger was kindly advising:
> "Just think of Spatial*DataFrame objects as data.frame objects and things
> will be much clearer"
>
> Nevertheless, when I have to subset my lines now, I find that, given
> > str(fl1,max.level=2)
> Formal class 'SpatialLinesDataFrame' [package "sp"] with 4 slots
>  ..@ data       :'data.frame':    4 obs. of  2 variables:
>  ..@ lines      :List of 4
>  ..@ bbox       : num [1:2, 1:2] 448617 4630059 450088 4631874
>  .. ..- attr(*, "dimnames")=List of 2
>  ..@ proj4string:Formal class 'CRS' [package "sp"] with 1 slots
>
> with
> > fl1 at data
>  CodLin Comment
> 0      1    <NA>
> 1      2    <NA>
> 2      3    <NA>
> 3      4    <NA>
>
> I can subset the data frame either as
> > fl1 at data[1,]
>  CodLin Comment
> 0      1    <NA>
>
> or as
>
> > fl1 at data["0",]
>  CodLin Comment
> 0      1    <NA>
>
> but for the  SLDF,  while  I  can use
> > plot(fl1[1,])
> I cannot use:
> > plot(fl1["0",])
> Error: trying to get slot "Lines" from an object of a basic class
> ("NULL") with no slots
>
> So what would be the way of subsetting by IDs?
>
> Also, Roger advised to get the IDs through either
> > sapply(slot(fl1, "lines"), function(x) slot(x, "ID"))
> [1] "0" "1" "2" "3"
> or
> > rownames(as.data.frame(fl1))
> [1] "0" "1" "2" "3"
>
> Considering that getting the IDs is an important task, would not
> be appropriate  having  an specific  function,  as  in the case of
> coordinates()?
> For example,  ID(fl1) would be a lot easier to remember.
>
> (I know I can do that function for my personal use, but then you end
> up not using standard R)
>
> Thanks!
>
> Agus
>
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>   

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763 http://ifgi.uni-muenster.de/
http://www.springer.com/978-0-387-78170-9 e.pebesma at wwu.de


From Roger.Bivand at nhh.no  Sat Jul  4 13:45:45 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sat, 4 Jul 2009 13:45:45 +0200 (CEST)
Subject: [R-sig-Geo] Distribute points along lines
In-Reply-To: <4A4E3969.8050103@gmail.com>
References: <4A4E018B.6000602@gmail.com> <4A4E044D.4070304@orn.mpg.de>
	<alpine.LRH.2.00.0907031520230.6895@reclus.nhh.no>
	<4A4E3969.8050103@gmail.com>
Message-ID: <alpine.LRH.2.00.0907041315290.10706@reclus.nhh.no>

On Fri, 3 Jul 2009, Agustin Lobo wrote:

> Thanks,
>
> I'm actually doing:
>
> plot(fl1)
> points(spsample(fl1[4,],5,offset=0.001,type="regular"))
>
> but why offset=0 does not work?
>> points(spsample(fl1[4,],5,offset=0.0,type="regular"))
> Error in validObject(.Object) :
> invalid class "SpatialPoints" object: bbox should never contain NA values

With the meuse.riv data set, this cannot be reproduced. Please provide a 
reproducible example.

The problem is occurring in the output from sp:::.bboxCoords(), with an NA 
bounding box value, but that means that sample.Line() is probably getting 
a Line with no length:

> sp:::sample.Line(Line(matrix(c(0,0,0,0), ncol=2)), 5, offset=0.001, 
+ type="regular")
Error in validObject(.Object) :
   invalid class "SpatialPoints" object: bbox should never contain NA values

which means that no sample points are found. This suggests that the user 
error ought to be caught earlier, and maybe that Line objects with no 
length and all identical coordinates should be made invalid (this 
requirement was removed two years ago), but the onus is on the user to 
provide sensible data.

>
> Also, which are the units for offset?

For samples from lines, it is used as:

# default is: ..., offset = runif(1), ...
((1:n) - offset)/n * maxl

> n <- 5
> maxl <- 10
> offset <- 0
> ((1:n) - offset)/n * maxl
[1]  2  4  6  8 10

so a proportion in [0,1], but it seems to work backwards at present, with 
an offset of 0 anchoring to the final, not the first, point.


> I'm actually trying to set real field sampling sites, so this matters. 
> The best would be being able to set the first point in the line and then 
> the nb of points for random sites (as it is currently done) and the 
> length interval for regular sampling.
>
> By now I can adjust the nb. of points for the interval I want if the 
> length of the line is known, but how can I calculate the length of the 
> lines? calcLength requires another type of spatial object.

calcLength() is in PBSmapping. Adding a length slot to Line objects is an 
option, or rather providing length methods which would be less invasive. 
I'll take a look.

Roger

PS. The answers to these relatively detailed questions are in the source, 
which can easily be browsed on:

http://r-spatial.cvs.sourceforge.net/viewvc/r-spatial/sp/

or from the source bundle. Suggestions with patches are appreciated.

>
> Agus
>
>
>
> Roger Bivand wrote:
>> On Fri, 3 Jul 2009, Kamran Safi wrote:
>> 
>>> Hi,
>>> 
>>> I think you can use spsample() together with type=random and n=your sample 
>>> size.
>>> 
>> 
>> Exactly:
>> 
>> library(sp)
>> data(meuse.riv)
>> SL <- SpatialLines(list(Lines(list(Line(meuse.riv[1:80,])), ID="1")))
>> plot(SL)
>> pts <- spsample(SL, n=50, type="random")
>> plot(pts, add=TRUE)
>> 
>> Here we only have one Line object in the single Lines object, but the 
>> principle is the same.
>> 
>> Roger
>> 
>>> Kami
>>> 
>>> 
>>> 
>>> Agustin Lobo wrote:
>>>> Hi!
>>>> 
>>>> Is there any way to distribute a set of random or regularly-spaced
>>>> points along a line imported from a shape file into a
>>>> SpatialLinesDataFrame? I've been searching, but could not find it.
>>>> Should I use coordinates() to get the vertex, then calculate the a&b
>>>> parameters for each line and distribute the points? Or is it there
>>>> something already done?
>>>> 
>>>> Thanks,
>>>> 
>>>> Agus
>>>> 
>>>> Dr. Agustin Lobo
>>>> Institut de Ciencies de la Terra "Jaume Almera" (CSIC)
>>>> LLuis Sole Sabaris s/n
>>>> 08028 Barcelona
>>>> Spain
>>>> Tel. 34 934095410
>>>> Fax. 34 934110012
>>>> email: Agustin.Lobo at ija.csic.es
>>>> http://www.ija.csic.es/gt/obster
>>>> 
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at stat.math.ethz.ch
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>> 
>>>> 
>>> 
>> 
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From Roger.Bivand at nhh.no  Sun Jul  5 15:56:20 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sun, 5 Jul 2009 15:56:20 +0200 (CEST)
Subject: [R-sig-Geo] Distribute points along lines
In-Reply-To: <4A4FD6B0.2000409@ija.csic.es>
References: <4A4E018B.6000602@gmail.com> <4A4E044D.4070304@orn.mpg.de>
	<alpine.LRH.2.00.0907031520230.6895@reclus.nhh.no>
	<4A4E3969.8050103@gmail.com>
	<alpine.LRH.2.00.0907041315290.10706@reclus.nhh.no>
	<4A4FD6B0.2000409@ija.csic.es>
Message-ID: <alpine.LRH.2.00.0907051544340.18652@reclus.nhh.no>

On Sun, 5 Jul 2009, Agustin Lobo wrote:

> Roger,
>
> Roger Bivand wrote:
>
>> so a proportion in [0,1], but it seems to work backwards at present, with 
>> an offset of 0 anchoring to the final, not the first, point.
>
> Would it be too hard adding the offset to the first point? And actually
> ordering the points starting from the initial point of the line?

The problem was that sp:::sample.Line() was not handling a zero-length 
line segment (two identical consecutive coordinates in a Line object) 
properly, provoking an error when offset was set to 0.

I've committed changes to sourceforge:

cvs -z3 \
-d:pserver:anonymous at r-spatial.cvs.sourceforge.net:/cvsroot/r-spatial \
co -P sp

(all one line), then

R CMD INSTALL sp

to try out. I have also reversed the meaning of offset for lines, 0 is now 
the start coordinate of the Line object. If possible, could you please 
check out the revision, install it from source, and try it - it resolves 
the problem for your case as far as I can tell.

>
>> 
>>> I'm actually trying to set real field sampling sites, so this matters. The 
>>> best would be being able to set the first point in the line and then the 
>>> nb of points for random sites (as it is currently done) and the length 
>>> interval for regular sampling.
>>> 
>>> By now I can adjust the nb. of points for the interval I want if the 
>>> length of the line is known, but how can I calculate the length of the 
>>> lines? calcLength requires another type of spatial object.
>> 
>> calcLength() is in PBSmapping. Adding a length slot to Line objects is an 
>> option, or rather providing length methods which would be less invasive. 
>> I'll take a look.
>
> Thanks, please let me know. By now I measure the actual length in qgis.

There are LineLength(), LinesLength(), and SpatialLinesLengths() 
functions in sp, more used internally than exposed, but should be OK. I've 
converted LineLength() to use C code, so they can now also measure lengths 
in km even if the data are in geographical coordinates (assuming WGS84), 
as in spDistsN1().

Roger

>
> Agus
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From plaxo at mx.plaxo.com  Sun Jul  5 17:56:00 2009
From: plaxo at mx.plaxo.com (Wesam ALbakri)
Date: Sun, 05 Jul 2009 08:56:00 -0700
Subject: [R-sig-Geo] Wesam ALbakri added you as a connection on Plaxo
Message-ID: <b48bd3ea29cd20b60a50892baf947395@xpertmailer.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090705/fc9a8100/attachment.pl>

From alobolistas at gmail.com  Sun Jul  5 19:55:26 2009
From: alobolistas at gmail.com (Agustin Lobo)
Date: Sun, 05 Jul 2009 19:55:26 +0200
Subject: [R-sig-Geo] Distribute points along lines
In-Reply-To: <alpine.LRH.2.00.0907051544340.18652@reclus.nhh.no>
References: <4A4E018B.6000602@gmail.com> <4A4E044D.4070304@orn.mpg.de>
	<alpine.LRH.2.00.0907031520230.6895@reclus.nhh.no>
	<4A4E3969.8050103@gmail.com>
	<alpine.LRH.2.00.0907041315290.10706@reclus.nhh.no>
	<4A4FD6B0.2000409@ija.csic.es>
	<alpine.LRH.2.00.0907051544340.18652@reclus.nhh.no>
Message-ID: <4A50E90E.8090907@gmail.com>

Roger,

your newer code works fine, thanks.
I'm doing:
 > fl1 <- 
readOGR(dsn="/media/Transcend/MONTSENY2008/MONTSENY_UAV2/Linies_CastVila1",layer="Linies_CastVila1")
 > plot(fl1)
 > points(spsample(fl1[4,],5,offset=0.0,type="regular"))

and points start at the starting point of the line.

Regarding the length, by now I'm using coordinates() to get
the length of each line, i.e.
 > max(dist(as.matrix(coordinates(fl1)[[1]][[1]])))

for the first line. Is there a simpler syntax? I found
the [[1]][[1]] by trial and error, don't actually understand
why the simpler command
 > as.matrix(coordinates(fl1)[[1]])
does not work

I think it would make sense
having a field length in the object as you mentioned, and perhaps also area for 
polygons. Or maybe just having
a function sparealen() to calculate length of lines
and length of each side, perimeter and area of polygons would be
more appropriate.

Thanks

Agus

Roger Bivand wrote:
> On Sun, 5 Jul 2009, Agustin Lobo wrote:
> 
>> Roger,
>>
>> Roger Bivand wrote:
>>
>>> so a proportion in [0,1], but it seems to work backwards at present, 
>>> with an offset of 0 anchoring to the final, not the first, point.
>>
>> Would it be too hard adding the offset to the first point? And actually
>> ordering the points starting from the initial point of the line?
> 
> The problem was that sp:::sample.Line() was not handling a zero-length 
> line segment (two identical consecutive coordinates in a Line object) 
> properly, provoking an error when offset was set to 0.
> 
> I've committed changes to sourceforge:
> 
> cvs -z3 \
> -d:pserver:anonymous at r-spatial.cvs.sourceforge.net:/cvsroot/r-spatial \
> co -P sp
> 
> (all one line), then
> 
> R CMD INSTALL sp
> 
> to try out. I have also reversed the meaning of offset for lines, 0 is 
> now the start coordinate of the Line object. If possible, could you 
> please check out the revision, install it from source, and try it - it 
> resolves the problem for your case as far as I can tell.
> 
>>
>>>
>>>> I'm actually trying to set real field sampling sites, so this 
>>>> matters. The best would be being able to set the first point in the 
>>>> line and then the nb of points for random sites (as it is currently 
>>>> done) and the length interval for regular sampling.
>>>>
>>>> By now I can adjust the nb. of points for the interval I want if the 
>>>> length of the line is known, but how can I calculate the length of 
>>>> the lines? calcLength requires another type of spatial object.
>>>
>>> calcLength() is in PBSmapping. Adding a length slot to Line objects 
>>> is an option, or rather providing length methods which would be less 
>>> invasive. I'll take a look.
>>
>> Thanks, please let me know. By now I measure the actual length in qgis.
> 
> There are LineLength(), LinesLength(), and SpatialLinesLengths() 
> functions in sp, more used internally than exposed, but should be OK. 
> I've converted LineLength() to use C code, so they can now also measure 
> lengths in km even if the data are in geographical coordinates (assuming 
> WGS84), as in spDistsN1().
> 
> Roger
> 
>>
>> Agus
>>
>>
> 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: alobolistas.vcf
Type: text/x-vcard
Size: 251 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090705/016a29cd/attachment.vcf>

From Roger.Bivand at nhh.no  Sun Jul  5 21:07:34 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sun, 5 Jul 2009 21:07:34 +0200 (CEST)
Subject: [R-sig-Geo] Distribute points along lines
In-Reply-To: <4A50E90E.8090907@gmail.com>
References: <4A4E018B.6000602@gmail.com> <4A4E044D.4070304@orn.mpg.de>
	<alpine.LRH.2.00.0907031520230.6895@reclus.nhh.no>
	<4A4E3969.8050103@gmail.com>
	<alpine.LRH.2.00.0907041315290.10706@reclus.nhh.no>
	<4A4FD6B0.2000409@ija.csic.es>
	<alpine.LRH.2.00.0907051544340.18652@reclus.nhh.no>
	<4A50E90E.8090907@gmail.com>
Message-ID: <alpine.LRH.2.00.0907052104550.19298@reclus.nhh.no>

On Sun, 5 Jul 2009, Agustin Lobo wrote:

> Roger,
>
> your newer code works fine, thanks.
> I'm doing:
>> fl1 <- 
> readOGR(dsn="/media/Transcend/MONTSENY2008/MONTSENY_UAV2/Linies_CastVila1",layer="Linies_CastVila1")
>> plot(fl1)
>> points(spsample(fl1[4,],5,offset=0.0,type="regular"))
>
> and points start at the starting point of the line.

Good, thanks, I'll release soon.

>
> Regarding the length, by now I'm using coordinates() to get
> the length of each line, i.e.
>> max(dist(as.matrix(coordinates(fl1)[[1]][[1]])))
>
> for the first line. Is there a simpler syntax? I found
> the [[1]][[1]] by trial and error, don't actually understand
> why the simpler command
>> as.matrix(coordinates(fl1)[[1]])
> does not work
>
> I think it would make sense
> having a field length in the object as you mentioned, and perhaps also area 
> for polygons. Or maybe just having
> a function sparealen() to calculate length of lines
> and length of each side, perimeter and area of polygons would be
> more appropriate.

Maybe try SpatialLinesLengths() in sp for the lines case. The polygon case 
is much harder, because the topology has to be built. It can be done using 
the topology built in GRASS. Perimiter is OK, but anything more requires a 
GIS.

Roger

>
> Thanks
>
> Agus
>
> Roger Bivand wrote:
>> On Sun, 5 Jul 2009, Agustin Lobo wrote:
>> 
>>> Roger,
>>> 
>>> Roger Bivand wrote:
>>> 
>>>> so a proportion in [0,1], but it seems to work backwards at present, with 
>>>> an offset of 0 anchoring to the final, not the first, point.
>>> 
>>> Would it be too hard adding the offset to the first point? And actually
>>> ordering the points starting from the initial point of the line?
>> 
>> The problem was that sp:::sample.Line() was not handling a zero-length line 
>> segment (two identical consecutive coordinates in a Line object) properly, 
>> provoking an error when offset was set to 0.
>> 
>> I've committed changes to sourceforge:
>> 
>> cvs -z3 \
>> -d:pserver:anonymous at r-spatial.cvs.sourceforge.net:/cvsroot/r-spatial \
>> co -P sp
>> 
>> (all one line), then
>> 
>> R CMD INSTALL sp
>> 
>> to try out. I have also reversed the meaning of offset for lines, 0 is now 
>> the start coordinate of the Line object. If possible, could you please 
>> check out the revision, install it from source, and try it - it resolves 
>> the problem for your case as far as I can tell.
>> 
>>> 
>>>> 
>>>>> I'm actually trying to set real field sampling sites, so this matters. 
>>>>> The best would be being able to set the first point in the line and then 
>>>>> the nb of points for random sites (as it is currently done) and the 
>>>>> length interval for regular sampling.
>>>>> 
>>>>> By now I can adjust the nb. of points for the interval I want if the 
>>>>> length of the line is known, but how can I calculate the length of the 
>>>>> lines? calcLength requires another type of spatial object.
>>>> 
>>>> calcLength() is in PBSmapping. Adding a length slot to Line objects is an 
>>>> option, or rather providing length methods which would be less invasive. 
>>>> I'll take a look.
>>> 
>>> Thanks, please let me know. By now I measure the actual length in qgis.
>> 
>> There are LineLength(), LinesLength(), and SpatialLinesLengths() functions 
>> in sp, more used internally than exposed, but should be OK. I've converted 
>> LineLength() to use C code, so they can now also measure lengths in km even 
>> if the data are in geographical coordinates (assuming WGS84), as in 
>> spDistsN1().
>> 
>> Roger
>> 
>>> 
>>> Agus
>>> 
>>> 
>> 
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From pierre.roudier at gmail.com  Mon Jul  6 07:23:09 2009
From: pierre.roudier at gmail.com (Pierre Roudier)
Date: Mon, 6 Jul 2009 15:23:09 +1000
Subject: [R-sig-Geo] Wavelet analysis on non-squared / non dyadic matrix
Message-ID: <e4178da60907052223g60a5dba4nb7a0c87b347eb3cf@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090706/81931ad2/attachment.pl>

From alobolistas at gmail.com  Mon Jul  6 09:48:19 2009
From: alobolistas at gmail.com (Agustin Lobo)
Date: Mon, 06 Jul 2009 09:48:19 +0200
Subject: [R-sig-Geo] Problem with gdalOGR: GPX format
Message-ID: <4A51AC43.1070000@gmail.com>

I'm trying to write an SpatialPointsDataFrame object as
GPX. I do:
> 
writeOGR(wpcast1SPDF,dsn="/media/Transcend/MONTSENY2008/MONTSENY_UAV2/GPX",layer="wpcast1lonlat",driver="GPX")
Error in writeOGR(wpcast1SPDF, dsn =
"/media/Transcend/MONTSENY2008/MONTSENY_UAV2/GPX",  :

	GDAL Error 6: Field of name 'coords.x1' is not supported in GPX schema.
Use GPX_USE_EXTENSIONS creation option to allow use of the <extensions>
element.

Which would be valid Field of name 'coords.x1'? I've tried reading
http://www.topografix.com/GPX/1/1/
but it's really hard to understand.

I've also tried to add layer_options="GPX_USE_EXTENSIONS=YES" according to
http://www.gdal.org/ogr/drv_gpx.html
"GPX_USE_EXTENSIONS: By default, the GPX driver will discard attribute
fields that do not match the GPX XML definition (name, cmt, etc...).
If GPX_USE_EXTENSIONS=YES is specified, extra fields will be written
inside the<extensions> tag."

but still get the same error (and, ultimately, I'm not sure this would
actually solve the problem, the best would be using the "valid Field of
name coords.x1"):

writeOGR(wpcast1SPDF,dsn="/media/Transcend/MONTSENY2008/MONTSENY_UAV2/wpscastlonlat.gpx",layer="wpcast1lonlat",driver="GPX",layer_options="GPX_USE_EXTENSIONS=YES")
Error in writeOGR(wpcast1SPDF, dsn =
"/media/Transcend/MONTSENY2008/MONTSENY_UAV2/wpscastlonlat.gpx",  :

	GDAL Error 6: Field of name 'coords.x1' is not supported in GPX schema.
Use GPX_USE_EXTENSIONS creation option to allow use of the <extensions>
element.
>

Any help appreciated,
Agus


From Roger.Bivand at nhh.no  Mon Jul  6 11:05:04 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 6 Jul 2009 11:05:04 +0200 (CEST)
Subject: [R-sig-Geo] Problem with gdalOGR: GPX format
In-Reply-To: <4A51AC43.1070000@gmail.com>
References: <4A51AC43.1070000@gmail.com>
Message-ID: <alpine.LRH.2.00.0907061049300.24266@reclus.nhh.no>

On Mon, 6 Jul 2009, Agustin Lobo wrote:

> I'm trying to write an SpatialPointsDataFrame object as
> GPX. I do:
>> 
> writeOGR(wpcast1SPDF,dsn="/media/Transcend/MONTSENY2008/MONTSENY_UAV2/GPX",layer="wpcast1lonlat",driver="GPX")
> Error in writeOGR(wpcast1SPDF, dsn =
> "/media/Transcend/MONTSENY2008/MONTSENY_UAV2/GPX",  :
>
> 	GDAL Error 6: Field of name 'coords.x1' is not supported in GPX 
> schema.
> Use GPX_USE_EXTENSIONS creation option to allow use of the <extensions>
> element.
>
> Which would be valid Field of name 'coords.x1'? I've tried reading
> http://www.topografix.com/GPX/1/1/
> but it's really hard to understand.

Yes, hard to understand, but that's ontology in the GIScience sense, it's 
certainly clear to the people who wrote it (I hope!). Try this:

library(sp)
load("fl1.rda")
pts <- spsample(fl1, n=50, offset=0.0, type="regular")
crds <- coordinates(pts)
SPDF <- SpatialPointsDataFrame(pts, data=as.data.frame(crds))
names(SPDF)
library(rgdal)
writeOGR(spTransform(SPDF, CRS("+proj=longlat +datum=WGS84")),
   dsn="fl1sp_pts.gpx", layer="waypoints", driver="GPX",
   dataset_options="GPX_USE_EXTENSIONS=yes")
summary(readOGR(dsn="fl1sp_pts.gpx", layer="waypoints"))

so three things: the GPX driver in OGR only seems to accept geographical 
coordinates; you needed layer="waypoints" - it accepts any value for 
writing, but readOGR() only takes the five enumerated on the OGR GPX page; 
and it is dataset_options="GPX_USE_EXTENSIONS=yes" (or YES), not 
layer_options=.

The last was the key problem, but it then failed on coordinates outside 
the range of geographical coordinates. The layer name is not used, so 
maybe best to stay with the most appropriate of the five values accepted 
for reading.

Roger

>
> I've also tried to add layer_options="GPX_USE_EXTENSIONS=YES" according to
> http://www.gdal.org/ogr/drv_gpx.html
> "GPX_USE_EXTENSIONS: By default, the GPX driver will discard attribute
> fields that do not match the GPX XML definition (name, cmt, etc...).
> If GPX_USE_EXTENSIONS=YES is specified, extra fields will be written
> inside the<extensions> tag."
>
> but still get the same error (and, ultimately, I'm not sure this would
> actually solve the problem, the best would be using the "valid Field of
> name coords.x1"):
>
> writeOGR(wpcast1SPDF,dsn="/media/Transcend/MONTSENY2008/MONTSENY_UAV2/wpscastlonlat.gpx",layer="wpcast1lonlat",driver="GPX",layer_options="GPX_USE_EXTENSIONS=YES")
> Error in writeOGR(wpcast1SPDF, dsn =
> "/media/Transcend/MONTSENY2008/MONTSENY_UAV2/wpscastlonlat.gpx",  :
>
> 	GDAL Error 6: Field of name 'coords.x1' is not supported in GPX 
> schema.
> Use GPX_USE_EXTENSIONS creation option to allow use of the <extensions>
> element.
>> 
>
> Any help appreciated,
> Agus
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From alobolistas at gmail.com  Mon Jul  6 11:36:58 2009
From: alobolistas at gmail.com (Agustin Lobo)
Date: Mon, 06 Jul 2009 11:36:58 +0200
Subject: [R-sig-Geo] Problem with gdalOGR: GPX format
In-Reply-To: <alpine.LRH.2.00.0907061049300.24266@reclus.nhh.no>
References: <4A51AC43.1070000@gmail.com>
	<alpine.LRH.2.00.0907061049300.24266@reclus.nhh.no>
Message-ID: <4A51C5BA.2020008@gmail.com>

Thanks,

I've just circumvented the problem by writing a "universal csv" file (in 
gpsbabel jargon, see:
http://www.gpsbabel.org/htmldoc-development/fmt_unicsv.html

using write.table() and having converted to lon,lat and wgs84 with 
spTransform() first.

Then I convert to compegps format (the format used by the UAV navigation 
system) using gpsbabel,
GPX was an intermediate format between OGR and gpsbabel. unicsv seems 
easier to manage!

Agus

Roger Bivand wrote:
> On Mon, 6 Jul 2009, Agustin Lobo wrote:
>
>> I'm trying to write an SpatialPointsDataFrame object as
>> GPX. I do:
>>>
>> writeOGR(wpcast1SPDF,dsn="/media/Transcend/MONTSENY2008/MONTSENY_UAV2/GPX",layer="wpcast1lonlat",driver="GPX") 
>>
>> Error in writeOGR(wpcast1SPDF, dsn =
>> "/media/Transcend/MONTSENY2008/MONTSENY_UAV2/GPX", :
>>
>> GDAL Error 6: Field of name 'coords.x1' is not supported in GPX schema.
>> Use GPX_USE_EXTENSIONS creation option to allow use of the <extensions>
>> element.
>>
>> Which would be valid Field of name 'coords.x1'? I've tried reading
>> http://www.topografix.com/GPX/1/1/
>> but it's really hard to understand.
>
> Yes, hard to understand, but that's ontology in the GIScience sense, 
> it's certainly clear to the people who wrote it (I hope!). Try this:
>
> library(sp)
> load("fl1.rda")
> pts <- spsample(fl1, n=50, offset=0.0, type="regular")
> crds <- coordinates(pts)
> SPDF <- SpatialPointsDataFrame(pts, data=as.data.frame(crds))
> names(SPDF)
> library(rgdal)
> writeOGR(spTransform(SPDF, CRS("+proj=longlat +datum=WGS84")),
> dsn="fl1sp_pts.gpx", layer="waypoints", driver="GPX",
> dataset_options="GPX_USE_EXTENSIONS=yes")
> summary(readOGR(dsn="fl1sp_pts.gpx", layer="waypoints"))
>
> so three things: the GPX driver in OGR only seems to accept 
> geographical coordinates; you needed layer="waypoints" - it accepts 
> any value for writing, but readOGR() only takes the five enumerated on 
> the OGR GPX page; and it is dataset_options="GPX_USE_EXTENSIONS=yes" 
> (or YES), not layer_options=.
>
> The last was the key problem, but it then failed on coordinates 
> outside the range of geographical coordinates. The layer name is not 
> used, so maybe best to stay with the most appropriate of the five 
> values accepted for reading.
>
> Roger
>
>>
>> I've also tried to add layer_options="GPX_USE_EXTENSIONS=YES" 
>> according to
>> http://www.gdal.org/ogr/drv_gpx.html
>> "GPX_USE_EXTENSIONS: By default, the GPX driver will discard attribute
>> fields that do not match the GPX XML definition (name, cmt, etc...).
>> If GPX_USE_EXTENSIONS=YES is specified, extra fields will be written
>> inside the<extensions> tag."
>>
>> but still get the same error (and, ultimately, I'm not sure this would
>> actually solve the problem, the best would be using the "valid Field of
>> name coords.x1"):
>>
>> writeOGR(wpcast1SPDF,dsn="/media/Transcend/MONTSENY2008/MONTSENY_UAV2/wpscastlonlat.gpx",layer="wpcast1lonlat",driver="GPX",layer_options="GPX_USE_EXTENSIONS=YES") 
>>
>> Error in writeOGR(wpcast1SPDF, dsn =
>> "/media/Transcend/MONTSENY2008/MONTSENY_UAV2/wpscastlonlat.gpx", :
>>
>> GDAL Error 6: Field of name 'coords.x1' is not supported in GPX schema.
>> Use GPX_USE_EXTENSIONS creation option to allow use of the <extensions>
>> element.
>>>
>>
>> Any help appreciated,
>> Agus
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>


From alobolistas at gmail.com  Mon Jul  6 11:45:28 2009
From: alobolistas at gmail.com (Agustin Lobo)
Date: Mon, 06 Jul 2009 11:45:28 +0200
Subject: [R-sig-Geo] Extracting coordinates from SpatialLinesDataFrame object
Message-ID: <4A51C7B8.6050707@gmail.com>

I  want to extract the coordinates of each line
in a SpatialLinesDataFrame object as a 2D matrix (not as a list). I'm using
as.matrix(coordinates(fl1[1,])[[1]][[1]])
for the first line,
which works fine but it's really odd and difficult to remember.

Is there an easier way of doing it?
Also, perhaps we could have something like
coordinates(fl1[1,], matrix=T)
in the future ?

Thanks!

Agus


From Roger.Bivand at nhh.no  Mon Jul  6 14:46:54 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 6 Jul 2009 14:46:54 +0200 (CEST)
Subject: [R-sig-Geo] Extracting coordinates from SpatialLinesDataFrame
 object
In-Reply-To: <4A51C7B8.6050707@gmail.com>
References: <4A51C7B8.6050707@gmail.com>
Message-ID: <alpine.LRH.2.00.0907061436490.24719@reclus.nhh.no>

On Mon, 6 Jul 2009, Agustin Lobo wrote:

> I  want to extract the coordinates of each line
> in a SpatialLinesDataFrame object as a 2D matrix (not as a list). I'm using
> as.matrix(coordinates(fl1[1,])[[1]][[1]])
> for the first line,
> which works fine but it's really odd and difficult to remember.
>
> Is there an easier way of doing it?
> Also, perhaps we could have something like
> coordinates(fl1[1,], matrix=T)
> in the future ?

No, because a SpatialLines object contains one or more Lines objects, each 
of which contains one or more Line objects. You are choosing the first 
Lines object, which may consist of multiple Line objects. So lists are the 
best way to represent them, and:

res <- lapply(slot(fl1, "lines"), function(x) lapply(slot(x, "Lines"),
   function(y) slot(y, "coords")))

gets everything out tidily. Isn't reality "really odd and difficult to 
remember"? Other users have richer Lines objects, so doing what you 
request would be simplifying too far.

Roger

>
> Thanks!
>
> Agus
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From patrick.giraudoux at univ-fcomte.fr  Tue Jul  7 03:48:55 2009
From: patrick.giraudoux at univ-fcomte.fr (Patrick Giraudoux)
Date: Tue, 07 Jul 2009 03:48:55 +0200
Subject: [R-sig-Geo] can spplot add features ?
Message-ID: <4A52A987.2040406@univ-fcomte.fr>

Dear listers,

I would like to add the border of  a country (SpatialPolygons object 
called ChinaBorder) in a spplot built as following:

mypal<-colorRampPalette(c("white", "cyan", "blue","green","yellow","red"))
statSpat<-SpatialPointsDataFrame(chinagrid,data.frame(n=z))
gridded(statSpat)<-TRUE
spplot(statSpat,col.regions=mypal)

I cannot managed to overlap ChinaBorder to statSpat with the 'panel' 
argument of spplot.

Any idea about how to proceed ?

Patrick


From edzer.pebesma at uni-muenster.de  Tue Jul  7 08:27:50 2009
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Tue, 07 Jul 2009 08:27:50 +0200
Subject: [R-sig-Geo] can spplot add features ?
In-Reply-To: <4A52A987.2040406@univ-fcomte.fr>
References: <4A52A987.2040406@univ-fcomte.fr>
Message-ID: <4A52EAE6.3030103@uni-muenster.de>



Patrick Giraudoux wrote:
> Dear listers,
>
> I would like to add the border of  a country (SpatialPolygons object
> called ChinaBorder) in a spplot built as following:
>
> mypal<-colorRampPalette(c("white", "cyan",
> "blue","green","yellow","red"))
> statSpat<-SpatialPointsDataFrame(chinagrid,data.frame(n=z))
> gridded(statSpat)<-TRUE
> spplot(statSpat,col.regions=mypal)
>
> I cannot managed to overlap ChinaBorder to statSpat with the 'panel'
> argument of spplot.
>
> Any idea about how to proceed ?
Patrick, you might want to try

spplot(statSpat, col.regions = mypal, sp.layout = list("sp.polygons",
ChinaBorder))
>
> Patrick
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763 http://ifgi.uni-muenster.de/
http://www.springer.com/978-0-387-78170-9 e.pebesma at wwu.de


From JuanManuel.Moreno at uclm.es  Tue Jul  7 08:53:16 2009
From: JuanManuel.Moreno at uclm.es (JUAN MANUEL MORENO RIVERA)
Date: Tue, 7 Jul 2009 08:53:16 +0200
Subject: [R-sig-Geo] Problems reading output file from HDF5 library
Message-ID: <482F3F344402014191699ECFF25179823D69AC@EVSAB02.uclm.es>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090707/316c3f7f/attachment.pl>

From p.hiemstra at geo.uu.nl  Tue Jul  7 09:26:00 2009
From: p.hiemstra at geo.uu.nl (Paul Hiemstra)
Date: Tue, 07 Jul 2009 09:26:00 +0200
Subject: [R-sig-Geo] can spplot add features ?
In-Reply-To: <4A52A987.2040406@univ-fcomte.fr>
References: <4A52A987.2040406@univ-fcomte.fr>
Message-ID: <4A52F888.9040800@geo.uu.nl>

Hi,

You could also have a look at the R wiki, there is a part on spatial 
data visualization using sp-classes:

http://wiki.r-project.org/rwiki/doku.php?id=tips:spatial-data:spatial_data_visualization

cheers,
Paul

Patrick Giraudoux wrote:
> Dear listers,
>
> I would like to add the border of  a country (SpatialPolygons object 
> called ChinaBorder) in a spplot built as following:
>
> mypal<-colorRampPalette(c("white", "cyan", 
> "blue","green","yellow","red"))
> statSpat<-SpatialPointsDataFrame(chinagrid,data.frame(n=z))
> gridded(statSpat)<-TRUE
> spplot(statSpat,col.regions=mypal)
>
> I cannot managed to overlap ChinaBorder to statSpat with the 'panel' 
> argument of spplot.
>
> Any idea about how to proceed ?
>
> Patrick
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


-- 
Drs. Paul Hiemstra
Department of Physical Geography
Faculty of Geosciences
University of Utrecht
Heidelberglaan 2
P.O. Box 80.115
3508 TC Utrecht
Phone:  +3130 274 3113 Mon-Tue
Phone:  +3130 253 5773 Wed-Fri
http://intamap.geo.uu.nl/~paul


From alobolistas at gmail.com  Tue Jul  7 09:47:21 2009
From: alobolistas at gmail.com (Agustin Lobo)
Date: Tue, 07 Jul 2009 09:47:21 +0200
Subject: [R-sig-Geo] spsample Error
Message-ID: <4A52FD89.3010407@gmail.com>

I'm using spsample() with a second SpatialLinesDataFrame
but now I'm geting an error. This is what I do:

fl2300 <-
readOGR(dsn="/media/Transcend/MONTSENY2008/MONTSENY_UAV2/flMatagalls300",layer="flMatagalls300")
> wpMata300 <- spsample(fl2300[1,],33,offset=0.0,type="regular")
Error in proj4string(x) :
   proj4string only works for class(es extending) Spatial

Nothing looks wrong with fl2300 (at least not different to other SPDFs for which
spsample() works fine):
> str(fl2)
Formal class 'SpatialLinesDataFrame' [package "sp"] with 4 slots
   ..@ data       :'data.frame':	2 obs. of  2 variables:
   .. ..$ Code   : int [1:2] 1 2
   .. ..$ Comment: Factor w/ 2 levels "CarrElBrull700",..: 2 1
   ..@ lines      :List of 2
   .. ..$ :Formal class 'Lines' [package "sp"] with 2 slots
   .. .. .. ..@ Lines:List of 1
   .. .. .. .. ..$ :Formal class 'Line' [package "sp"] with 1 slots
   .. .. .. .. .. .. ..@ coords: num [1:3, 1:2] 445816 449071 449071 4628083
4629045 ...
   .. .. .. ..@ ID   : chr "0"
   .. ..$ :Formal class 'Lines' [package "sp"] with 2 slots
   .. .. .. ..@ Lines:List of 1
   .. .. .. .. ..$ :Formal class 'Line' [package "sp"] with 1 slots
   .. .. .. .. .. .. ..@ coords: num [1:3, 1:2] 445983 444326 444326 4628196
4630060 ...
   .. .. .. ..@ ID   : chr "1"
   ..@ bbox       : num [1:2, 1:2] 444326 4628083 449071 4630060
   .. ..- attr(*, "dimnames")=List of 2
   .. .. ..$ : chr [1:2] "r1" "r2"
   .. .. ..$ : chr [1:2] "min" "max"
   ..@ proj4string:Formal class 'CRS' [package "sp"] with 1 slots
   .. .. ..@ projargs: chr " +proj=utm +zone=31 +ellps=intl +units=m +no_defs"

Is this a bug? Do I have anything wrong in this object?
Thanks

Agus
-------------- next part --------------
A non-text attachment was scrubbed...
Name: alobolistas.vcf
Type: text/x-vcard
Size: 251 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090707/fe072b37/attachment.vcf>

From patrick.giraudoux at univ-fcomte.fr  Tue Jul  7 10:41:54 2009
From: patrick.giraudoux at univ-fcomte.fr (Patrick Giraudoux)
Date: Tue, 07 Jul 2009 10:41:54 +0200
Subject: [R-sig-Geo] can spplot add features ?
In-Reply-To: <4A52EAE6.3030103@uni-muenster.de>
References: <4A52A987.2040406@univ-fcomte.fr>
	<4A52EAE6.3030103@uni-muenster.de>
Message-ID: <4A530A52.4040708@univ-fcomte.fr>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090707/b1683063/attachment.pl>

From patrick.giraudoux at univ-fcomte.fr  Tue Jul  7 10:56:05 2009
From: patrick.giraudoux at univ-fcomte.fr (Patrick Giraudoux)
Date: Tue, 07 Jul 2009 10:56:05 +0200
Subject: [R-sig-Geo] filled.contour and legend height control
Message-ID: <4A530DA5.5020203@univ-fcomte.fr>

Hello,

Filled contour is a really nice function, except when one use the 
argument asp=1. In this case the legend height can be too large compared 
to the image plot height.

Is there a way to control the legend height in filled.contour (eg fixing 
somewhere a ylim=c(min value, max value) to make it the same height as 
the image in the big plot) ?

Best,

Patrick


From edzer.pebesma at uni-muenster.de  Tue Jul  7 11:16:29 2009
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Tue, 07 Jul 2009 11:16:29 +0200
Subject: [R-sig-Geo] can spplot add features ?
In-Reply-To: <4A530A52.4040708@univ-fcomte.fr>
References: <4A52A987.2040406@univ-fcomte.fr>
	<4A52EAE6.3030103@uni-muenster.de>
	<4A530A52.4040708@univ-fcomte.fr>
Message-ID: <4A53126D.3010006@uni-muenster.de>



Patrick Giraudoux wrote:
> Edzer Pebesma a ?crit :
>> Patrick Giraudoux wrote:
>>  
>>> Dear listers,
>>>
>>> I would like to add the border of  a country (SpatialPolygons object
>>> called ChinaBorder) in a spplot built as following:
>>>
>>> mypal<-colorRampPalette(c("white", "cyan",
>>> "blue","green","yellow","red"))
>>> statSpat<-SpatialPointsDataFrame(chinagrid,data.frame(n=z))
>>> gridded(statSpat)<-TRUE
>>> spplot(statSpat,col.regions=mypal)
>>>
>>> I cannot managed to overlap ChinaBorder to statSpat with the 'panel'
>>> argument of spplot.
>>>
>>> Any idea about how to proceed ?
>>>     
>> Patrick, you might want to try
>>
>> spplot(statSpat, col.regions = mypal, sp.layout = list("sp.polygons",
>> ChinaBorder))
>>  
>>> P
>
>
> Exactly what I need (the way to state was unclear to me in the doc),
> except the image is overlapping the border when I would like to get
> the reverse (the contour over the image). Is there a way to make it ?
>
> Cheers,
>
> Patrick
>
Try

spplot(statSpat, col.regions = mypal, sp.layout = list("sp.polygons",
ChinaBorder, first = FALSE))

or maybe TRUE.
--
Edzer

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763 http://ifgi.uni-muenster.de/
http://www.springer.com/978-0-387-78170-9 e.pebesma at wwu.de


From alobolistas at gmail.com  Tue Jul  7 12:42:39 2009
From: alobolistas at gmail.com (Agustin Lobo)
Date: Tue, 07 Jul 2009 12:42:39 +0200
Subject: [R-sig-Geo] Error with readOGR and shape file
Message-ID: <4A53269F.9030905@gmail.com>

I've found the following error at importing a shp file
edited (deleting one line and creating another one) and saved with QGIS.
SHP files made (not edited) and saved with QGIS can be imported into R
with no problems.
I'm reporting to the QGIS list as well:

> fl2 <- readOGR(dsn="/media/Transcend/MONTSENY2008/MONTSENY_UAV2/",layer="flMata700v2")
Error in ogrInfo(dsn = dsn, layer = layer, input_field_name_encoding =
input_field_name_encoding) :
   Multiple incompatible geometries: 2:25706376

Note that ogrinfo does not report any problem:
$ ogrinfo flMata700v2.shp
INFO: Open of `flMata700v2.shp'
       using driver `ESRI Shapefile' successful.
1: flMata700v2 (Line String)

Let me know if I should upload the file.
Thanks

Agus
-------------- next part --------------
A non-text attachment was scrubbed...
Name: alobolistas.vcf
Type: text/x-vcard
Size: 251 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090707/d003d21c/attachment.vcf>

From alobolistas at gmail.com  Tue Jul  7 12:52:07 2009
From: alobolistas at gmail.com (Agustin Lobo)
Date: Tue, 7 Jul 2009 03:52:07 -0700 (PDT)
Subject: [R-sig-Geo] spsample Error
In-Reply-To: <4A52FD89.3010407@gmail.com>
References: <4A52FD89.3010407@gmail.com>
Message-ID: <1246963927342-3218531.post@n2.nabble.com>


Additional information: it seems the error occurs with any polyline imported
from shp files,
not with straight lines.
Agus
-- 
View this message in context: http://n2.nabble.com/spsample-Error-tp3217861p3218531.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From p.hiemstra at geo.uu.nl  Tue Jul  7 12:52:31 2009
From: p.hiemstra at geo.uu.nl (Paul Hiemstra)
Date: Tue, 07 Jul 2009 12:52:31 +0200
Subject: [R-sig-Geo] spsample Error
In-Reply-To: <4A52FD89.3010407@gmail.com>
References: <4A52FD89.3010407@gmail.com>
Message-ID: <4A5328EF.8030304@geo.uu.nl>

Agustin Lobo wrote:
> I'm using spsample() with a second SpatialLinesDataFrame
> but now I'm geting an error. This is what I do:
>
> fl2300 <-
> readOGR(dsn="/media/Transcend/MONTSENY2008/MONTSENY_UAV2/flMatagalls300",layer="flMatagalls300") 
>
>> wpMata300 <- spsample(fl2300[1,],33,offset=0.0,type="regular")
> Error in proj4string(x) :
>   proj4string only works for class(es extending) Spatial
Hi,

What is the information traceback() provides?

cheers,
Paul
>
> Nothing looks wrong with fl2300 (at least not different to other SPDFs 
> for which
> spsample() works fine):
>> str(fl2)
> Formal class 'SpatialLinesDataFrame' [package "sp"] with 4 slots
>   ..@ data       :'data.frame':    2 obs. of  2 variables:
>   .. ..$ Code   : int [1:2] 1 2
>   .. ..$ Comment: Factor w/ 2 levels "CarrElBrull700",..: 2 1
>   ..@ lines      :List of 2
>   .. ..$ :Formal class 'Lines' [package "sp"] with 2 slots
>   .. .. .. ..@ Lines:List of 1
>   .. .. .. .. ..$ :Formal class 'Line' [package "sp"] with 1 slots
>   .. .. .. .. .. .. ..@ coords: num [1:3, 1:2] 445816 449071 449071 
> 4628083
> 4629045 ...
>   .. .. .. ..@ ID   : chr "0"
>   .. ..$ :Formal class 'Lines' [package "sp"] with 2 slots
>   .. .. .. ..@ Lines:List of 1
>   .. .. .. .. ..$ :Formal class 'Line' [package "sp"] with 1 slots
>   .. .. .. .. .. .. ..@ coords: num [1:3, 1:2] 445983 444326 444326 
> 4628196
> 4630060 ...
>   .. .. .. ..@ ID   : chr "1"
>   ..@ bbox       : num [1:2, 1:2] 444326 4628083 449071 4630060
>   .. ..- attr(*, "dimnames")=List of 2
>   .. .. ..$ : chr [1:2] "r1" "r2"
>   .. .. ..$ : chr [1:2] "min" "max"
>   ..@ proj4string:Formal class 'CRS' [package "sp"] with 1 slots
>   .. .. ..@ projargs: chr " +proj=utm +zone=31 +ellps=intl +units=m 
> +no_defs"
>
> Is this a bug? Do I have anything wrong in this object?
> Thanks
>
> Agus
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>   


-- 
Drs. Paul Hiemstra
Department of Physical Geography
Faculty of Geosciences
University of Utrecht
Heidelberglaan 2
P.O. Box 80.115
3508 TC Utrecht
Phone:  +3130 274 3113 Mon-Tue
Phone:  +3130 253 5773 Wed-Fri
http://intamap.geo.uu.nl/~paul


From p.hiemstra at geo.uu.nl  Tue Jul  7 12:54:57 2009
From: p.hiemstra at geo.uu.nl (Paul Hiemstra)
Date: Tue, 07 Jul 2009 12:54:57 +0200
Subject: [R-sig-Geo] can spplot add features ?
In-Reply-To: <4A53126D.3010006@uni-muenster.de>
References: <4A52A987.2040406@univ-fcomte.fr>	<4A52EAE6.3030103@uni-muenster.de>	<4A530A52.4040708@univ-fcomte.fr>
	<4A53126D.3010006@uni-muenster.de>
Message-ID: <4A532981.9010402@geo.uu.nl>

Or you can define a panel function yourself along these lines:

spplot(grid_object, "layer_to_plot",
    panel = function(...) {
        panel.gridplot(...) # Standard panel function for grids
        sp.polygons(polygon_object)	# Extra stuff on top
        sp.points(point_object)
    }

cheers,
Paul

Edzer Pebesma wrote:
> Patrick Giraudoux wrote:
>   
>> Edzer Pebesma a ?crit :
>>     
>>> Patrick Giraudoux wrote:
>>>  
>>>       
>>>> Dear listers,
>>>>
>>>> I would like to add the border of  a country (SpatialPolygons object
>>>> called ChinaBorder) in a spplot built as following:
>>>>
>>>> mypal<-colorRampPalette(c("white", "cyan",
>>>> "blue","green","yellow","red"))
>>>> statSpat<-SpatialPointsDataFrame(chinagrid,data.frame(n=z))
>>>> gridded(statSpat)<-TRUE
>>>> spplot(statSpat,col.regions=mypal)
>>>>
>>>> I cannot managed to overlap ChinaBorder to statSpat with the 'panel'
>>>> argument of spplot.
>>>>
>>>> Any idea about how to proceed ?
>>>>     
>>>>         
>>> Patrick, you might want to try
>>>
>>> spplot(statSpat, col.regions = mypal, sp.layout = list("sp.polygons",
>>> ChinaBorder))
>>>  
>>>       
>>>> P
>>>>         
>> Exactly what I need (the way to state was unclear to me in the doc),
>> except the image is overlapping the border when I would like to get
>> the reverse (the contour over the image). Is there a way to make it ?
>>
>> Cheers,
>>
>> Patrick
>>
>>     
> Try
>
> spplot(statSpat, col.regions = mypal, sp.layout = list("sp.polygons",
> ChinaBorder, first = FALSE))
>
> or maybe TRUE.
> --
> Edzer
>
>   


-- 
Drs. Paul Hiemstra
Department of Physical Geography
Faculty of Geosciences
University of Utrecht
Heidelberglaan 2
P.O. Box 80.115
3508 TC Utrecht
Phone:  +3130 274 3113 Mon-Tue
Phone:  +3130 253 5773 Wed-Fri
http://intamap.geo.uu.nl/~paul


From Roger.Bivand at nhh.no  Tue Jul  7 13:05:59 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 7 Jul 2009 13:05:59 +0200 (CEST)
Subject: [R-sig-Geo] can spplot add features ?
In-Reply-To: <4A53126D.3010006@uni-muenster.de>
References: <4A52A987.2040406@univ-fcomte.fr>
	<4A52EAE6.3030103@uni-muenster.de>
	<4A530A52.4040708@univ-fcomte.fr>
	<4A53126D.3010006@uni-muenster.de>
Message-ID: <alpine.LRH.2.00.0907071301230.27814@reclus.nhh.no>

On Tue, 7 Jul 2009, Edzer Pebesma wrote:

>
>
> Patrick Giraudoux wrote:
>> Edzer Pebesma a ?crit :
>>> Patrick Giraudoux wrote:
>>>
>>>> Dear listers,
>>>>
>>>> I would like to add the border of  a country (SpatialPolygons object
>>>> called ChinaBorder) in a spplot built as following:
>>>>
>>>> mypal<-colorRampPalette(c("white", "cyan",
>>>> "blue","green","yellow","red"))
>>>> statSpat<-SpatialPointsDataFrame(chinagrid,data.frame(n=z))
>>>> gridded(statSpat)<-TRUE
>>>> spplot(statSpat,col.regions=mypal)
>>>>
>>>> I cannot managed to overlap ChinaBorder to statSpat with the 'panel'
>>>> argument of spplot.
>>>>
>>>> Any idea about how to proceed ?
>>>>
>>> Patrick, you might want to try
>>>
>>> spplot(statSpat, col.regions = mypal, sp.layout = list("sp.polygons",
>>> ChinaBorder))
>>>
>>>> P
>>
>>
>> Exactly what I need (the way to state was unclear to me in the doc),
>> except the image is overlapping the border when I would like to get
>> the reverse (the contour over the image). Is there a way to make it ?
>>
>> Cheers,
>>
>> Patrick
>>
> Try
>
> spplot(statSpat, col.regions = mypal, sp.layout = list("sp.polygons",
> ChinaBorder, first = FALSE))
>
> or maybe TRUE.

Or even Edzer's own trick (IIRC) of turning polygons into lines:

spplot(statSpat, col.regions = mypal, sp.layout = list("sp.lines",
  as(ChinaBorder, "SpatialLines")))

with possible line width, type and colour arguments.

Roger

> --
> Edzer
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From alobolistas at gmail.com  Tue Jul  7 13:15:29 2009
From: alobolistas at gmail.com (Agustin Lobo)
Date: Tue, 07 Jul 2009 13:15:29 +0200
Subject: [R-sig-Geo] spsample Error
In-Reply-To: <4A5328EF.8030304@geo.uu.nl>
References: <4A52FD89.3010407@gmail.com> <4A5328EF.8030304@geo.uu.nl>
Message-ID: <4A532E51.5070805@gmail.com>

Paul, this is it:

> wpMata300 <- spsample(fl2300[1,],33,offset=0.0,type="regular")
Error in proj4string(x) :
   proj4string only works for class(es extending) Spatial
> traceback()
16: stop("proj4string only works for class(es extending) Spatial")
15: proj4string(x)
14: identical(proj4string(x), p1)
13: FUN(X[[1L]], ...)
12: lapply(dots[-1], function(x) identical(proj4string(x), p1))
11: unlist(lapply(dots[-1], function(x) identical(proj4string(x),
         p1)))
10: checkCRSequal(dots)
9: rbind(deparse.level, ...)
8: rbind(<S4 object of class "SpatialPoints">, NULL, NULL, NULL,
        NULL, NULL, NULL, NULL, NULL)
7: do.call("rbind", ret)
6: .local(x, n, type, ...)
5: spsample(x at lines[[i]], nrs[i], type = type, offset = offset,
        ...)
4: spsample(x at lines[[i]], nrs[i], type = type, offset = offset,
        ...)
3: .local(x, n, type, ...)
2: spsample(fl2300[1, ], 33, offset = 0, type = "regular")
1: spsample(fl2300[1, ], 33, offset = 0, type = "regular")

Thanks for your interest,

Agus

Paul Hiemstra wrote:
> Agustin Lobo wrote:
>> I'm using spsample() with a second SpatialLinesDataFrame
>> but now I'm geting an error. This is what I do:
>>
>> fl2300 <-
>> readOGR(dsn="/media/Transcend/MONTSENY2008/MONTSENY_UAV2/flMatagalls300",layer="flMatagalls300") 
>>
>>> wpMata300 <- spsample(fl2300[1,],33,offset=0.0,type="regular")
>> Error in proj4string(x) :
>>   proj4string only works for class(es extending) Spatial
> Hi,
> 
> What is the information traceback() provides?
> 
> cheers,
> Paul
>>
>> Nothing looks wrong with fl2300 (at least not different to other SPDFs 
>> for which
>> spsample() works fine):
>>> str(fl2)
>> Formal class 'SpatialLinesDataFrame' [package "sp"] with 4 slots
>>   ..@ data       :'data.frame':    2 obs. of  2 variables:
>>   .. ..$ Code   : int [1:2] 1 2
>>   .. ..$ Comment: Factor w/ 2 levels "CarrElBrull700",..: 2 1
>>   ..@ lines      :List of 2
>>   .. ..$ :Formal class 'Lines' [package "sp"] with 2 slots
>>   .. .. .. ..@ Lines:List of 1
>>   .. .. .. .. ..$ :Formal class 'Line' [package "sp"] with 1 slots
>>   .. .. .. .. .. .. ..@ coords: num [1:3, 1:2] 445816 449071 449071 
>> 4628083
>> 4629045 ...
>>   .. .. .. ..@ ID   : chr "0"
>>   .. ..$ :Formal class 'Lines' [package "sp"] with 2 slots
>>   .. .. .. ..@ Lines:List of 1
>>   .. .. .. .. ..$ :Formal class 'Line' [package "sp"] with 1 slots
>>   .. .. .. .. .. .. ..@ coords: num [1:3, 1:2] 445983 444326 444326 
>> 4628196
>> 4630060 ...
>>   .. .. .. ..@ ID   : chr "1"
>>   ..@ bbox       : num [1:2, 1:2] 444326 4628083 449071 4630060
>>   .. ..- attr(*, "dimnames")=List of 2
>>   .. .. ..$ : chr [1:2] "r1" "r2"
>>   .. .. ..$ : chr [1:2] "min" "max"
>>   ..@ proj4string:Formal class 'CRS' [package "sp"] with 1 slots
>>   .. .. ..@ projargs: chr " +proj=utm +zone=31 +ellps=intl +units=m 
>> +no_defs"
>>
>> Is this a bug? Do I have anything wrong in this object?
>> Thanks
>>
>> Agus
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>   
> 
> 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: alobolistas.vcf
Type: text/x-vcard
Size: 251 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090707/cffa4348/attachment.vcf>

From p.hiemstra at geo.uu.nl  Tue Jul  7 13:19:21 2009
From: p.hiemstra at geo.uu.nl (Paul Hiemstra)
Date: Tue, 07 Jul 2009 13:19:21 +0200
Subject: [R-sig-Geo] filled.contour and legend height control
In-Reply-To: <4A530DA5.5020203@univ-fcomte.fr>
References: <4A530DA5.5020203@univ-fcomte.fr>
Message-ID: <4A532F39.2000502@geo.uu.nl>

Patrick Giraudoux wrote:
> Hello,
>
> Filled contour is a really nice function, except when one use the 
> argument asp=1. In this case the legend height can be too large 
> compared to the image plot height.
>
> Is there a way to control the legend height in filled.contour (eg 
> fixing somewhere a ylim=c(min value, max value) to make it the same 
> height as the image in the big plot) ?
>
> Best,
>
> Patrick
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
Hi,

Could you provide use with a piece of code that reproduces your problem. 
That would make it much easier to help you.

cheers,
Paul

-- 
Drs. Paul Hiemstra
Department of Physical Geography
Faculty of Geosciences
University of Utrecht
Heidelberglaan 2
P.O. Box 80.115
3508 TC Utrecht
Phone:  +3130 274 3113 Mon-Tue
Phone:  +3130 253 5773 Wed-Fri
http://intamap.geo.uu.nl/~paul


From Roger.Bivand at nhh.no  Tue Jul  7 13:24:50 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 7 Jul 2009 13:24:50 +0200 (CEST)
Subject: [R-sig-Geo] spsample Error
In-Reply-To: <4A52FD89.3010407@gmail.com>
References: <4A52FD89.3010407@gmail.com>
Message-ID: <alpine.LRH.2.00.0907071308360.27814@reclus.nhh.no>

On Tue, 7 Jul 2009, Agustin Lobo wrote:

> I'm using spsample() with a second SpatialLinesDataFrame
> but now I'm geting an error. This is what I do:
>
> fl2300 <-
> readOGR(dsn="/media/Transcend/MONTSENY2008/MONTSENY_UAV2/flMatagalls300",layer="flMatagalls300")
>> wpMata300 <- spsample(fl2300[1,],33,offset=0.0,type="regular")
> Error in proj4string(x) :
>  proj4string only works for class(es extending) Spatial

With the actual data, this cannot be reproduced in current CVS sp. The 
version you are using is probably 0.9-38 (also CVS, unreleased). I've been 
trying to test edge conditions so that solutions to your problems don't 
break things for others. If you need immediate turnaround (as your many 
messages suggest), please take this off-list, and wait for replies. 
Consider using the developer mailing list on sourceforge.

Roger

>
> Nothing looks wrong with fl2300 (at least not different to other SPDFs for 
> which
> spsample() works fine):
>> str(fl2)
> Formal class 'SpatialLinesDataFrame' [package "sp"] with 4 slots
>  ..@ data       :'data.frame':	2 obs. of  2 variables:
>  .. ..$ Code   : int [1:2] 1 2
>  .. ..$ Comment: Factor w/ 2 levels "CarrElBrull700",..: 2 1
>  ..@ lines      :List of 2
>  .. ..$ :Formal class 'Lines' [package "sp"] with 2 slots
>  .. .. .. ..@ Lines:List of 1
>  .. .. .. .. ..$ :Formal class 'Line' [package "sp"] with 1 slots
>  .. .. .. .. .. .. ..@ coords: num [1:3, 1:2] 445816 449071 449071 4628083
> 4629045 ...
>  .. .. .. ..@ ID   : chr "0"
>  .. ..$ :Formal class 'Lines' [package "sp"] with 2 slots
>  .. .. .. ..@ Lines:List of 1
>  .. .. .. .. ..$ :Formal class 'Line' [package "sp"] with 1 slots
>  .. .. .. .. .. .. ..@ coords: num [1:3, 1:2] 445983 444326 444326 4628196
> 4630060 ...
>  .. .. .. ..@ ID   : chr "1"
>  ..@ bbox       : num [1:2, 1:2] 444326 4628083 449071 4630060
>  .. ..- attr(*, "dimnames")=List of 2
>  .. .. ..$ : chr [1:2] "r1" "r2"
>  .. .. ..$ : chr [1:2] "min" "max"
>  ..@ proj4string:Formal class 'CRS' [package "sp"] with 1 slots
>  .. .. ..@ projargs: chr " +proj=utm +zone=31 +ellps=intl +units=m +no_defs"
>
> Is this a bug? Do I have anything wrong in this object?
> Thanks
>
> Agus
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From Roger.Bivand at nhh.no  Tue Jul  7 13:28:28 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 7 Jul 2009 13:28:28 +0200 (CEST)
Subject: [R-sig-Geo] Error with readOGR and shape file
In-Reply-To: <4A53269F.9030905@gmail.com>
References: <4A53269F.9030905@gmail.com>
Message-ID: <alpine.LRH.2.00.0907071326080.27814@reclus.nhh.no>

On Tue, 7 Jul 2009, Agustin Lobo wrote:

> I've found the following error at importing a shp file
> edited (deleting one line and creating another one) and saved with QGIS.
> SHP files made (not edited) and saved with QGIS can be imported into R
> with no problems.
> I'm reporting to the QGIS list as well:
>
>> fl2 <- 
>> readOGR(dsn="/media/Transcend/MONTSENY2008/MONTSENY_UAV2/",layer="flMata700v2")
> Error in ogrInfo(dsn = dsn, layer = layer, input_field_name_encoding =
> input_field_name_encoding) :
>  Multiple incompatible geometries: 2:25706376
>
> Note that ogrinfo does not report any problem:
> $ ogrinfo flMata700v2.shp
> INFO: Open of `flMata700v2.shp'
>      using driver `ESRI Shapefile' successful.
> 1: flMata700v2 (Line String)
>
> Let me know if I should upload the file.

Of course, without the offending file, no diagnosis is possible. More 
information is needed - this isn't a list question. It looks as though 
QGIS editing is not setting a geometry type correctly.

Roger

> Thanks
>
> Agus
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From patrick.giraudoux at univ-fcomte.fr  Tue Jul  7 14:28:49 2009
From: patrick.giraudoux at univ-fcomte.fr (Patrick Giraudoux)
Date: Tue, 07 Jul 2009 14:28:49 +0200
Subject: [R-sig-Geo] filled.contour and legend height control
In-Reply-To: <4A532F39.2000502@geo.uu.nl>
References: <4A530DA5.5020203@univ-fcomte.fr> <4A532F39.2000502@geo.uu.nl>
Message-ID: <4A533F81.3020306@univ-fcomte.fr>

Paul Hiemstra a ?crit :
> Patrick Giraudoux wrote:
>> Hello,
>>
>> Filled contour is a really nice function, except when one use the 
>> argument asp=1. In this case the legend height can be too large 
>> compared to the image plot height.
>>
>> Is there a way to control the legend height in filled.contour (eg 
>> fixing somewhere a ylim=c(min value, max value) to make it the same 
>> height as the image in the big plot) ?
>>
>> Best,
>>
>> Patrick
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> Hi,
>
> Could you provide use with a piece of code that reproduces your 
> problem. That would make it much easier to help you.
>
> cheers,
> Paul
>

Yes indeed. Here we are:

# example without asp

x<-seq(1,10,l=20)
y<-seq(1,5,l=20)
z<-rnorm(400)
zmat<-matrix(z,ncol=20)
filled.contour(x,y,zmat,frame.plot = FALSE)

# example with asp (eg: a geographic map projected where x and y display 
ratio must be 1

x<-seq(1,10,l=20)
y<-seq(1,5,l=20)
z<-rnorm(400)
zmat<-matrix(z,ncol=20)
filled.contour(x,y,zmat,frame.plot = FALSE,asp=1)

I wonder if there is a way to resize the legend in such a way it as the 
same height as the image displayed...

Best,

Patrick


From p.hiemstra at geo.uu.nl  Tue Jul  7 14:57:10 2009
From: p.hiemstra at geo.uu.nl (Paul Hiemstra)
Date: Tue, 07 Jul 2009 14:57:10 +0200
Subject: [R-sig-Geo] filled.contour and legend height control
In-Reply-To: <4A533F81.3020306@univ-fcomte.fr>
References: <4A530DA5.5020203@univ-fcomte.fr> <4A532F39.2000502@geo.uu.nl>
	<4A533F81.3020306@univ-fcomte.fr>
Message-ID: <4A534626.10005@geo.uu.nl>

Hi Patrick,

Thanks for the code! My suggestion would be to use spplot instead of 
filled.contour, this function is really made to display spatial data. It 
works for grids, points and polygons and makes it really easy to combine 
those in one plot. You need to put your data into the spatial R classes 
provided by the sp-package. See:

http://wiki.r-project.org/rwiki/doku.php?id=tips:spatial-data:spatial_data_visualization

some tips on how to visualize data using spplot.

cheers,
Paul

Patrick Giraudoux wrote:
> Paul Hiemstra a ?crit :
>> Patrick Giraudoux wrote:
>>> Hello,
>>>
>>> Filled contour is a really nice function, except when one use the 
>>> argument asp=1. In this case the legend height can be too large 
>>> compared to the image plot height.
>>>
>>> Is there a way to control the legend height in filled.contour (eg 
>>> fixing somewhere a ylim=c(min value, max value) to make it the same 
>>> height as the image in the big plot) ?
>>>
>>> Best,
>>>
>>> Patrick
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> Hi,
>>
>> Could you provide use with a piece of code that reproduces your 
>> problem. That would make it much easier to help you.
>>
>> cheers,
>> Paul
>>
>
> Yes indeed. Here we are:
>
> # example without asp
>
> x<-seq(1,10,l=20)
> y<-seq(1,5,l=20)
> z<-rnorm(400)
> zmat<-matrix(z,ncol=20)
> filled.contour(x,y,zmat,frame.plot = FALSE)
>
> # example with asp (eg: a geographic map projected where x and y 
> display ratio must be 1
>
> x<-seq(1,10,l=20)
> y<-seq(1,5,l=20)
> z<-rnorm(400)
> zmat<-matrix(z,ncol=20)
> filled.contour(x,y,zmat,frame.plot = FALSE,asp=1)
>
> I wonder if there is a way to resize the legend in such a way it as 
> the same height as the image displayed...
>
> Best,
>
> Patrick


-- 
Drs. Paul Hiemstra
Department of Physical Geography
Faculty of Geosciences
University of Utrecht
Heidelberglaan 2
P.O. Box 80.115
3508 TC Utrecht
Phone:  +3130 274 3113 Mon-Tue
Phone:  +3130 253 5773 Wed-Fri
http://intamap.geo.uu.nl/~paul


From patrick.giraudoux at univ-fcomte.fr  Tue Jul  7 18:44:37 2009
From: patrick.giraudoux at univ-fcomte.fr (Patrick Giraudoux)
Date: Tue, 07 Jul 2009 18:44:37 +0200
Subject: [R-sig-Geo] filled.contour and legend height control
In-Reply-To: <4A534626.10005@geo.uu.nl>
References: <4A530DA5.5020203@univ-fcomte.fr> <4A532F39.2000502@geo.uu.nl>
	<4A533F81.3020306@univ-fcomte.fr> <4A534626.10005@geo.uu.nl>
Message-ID: <4A537B75.9080907@univ-fcomte.fr>

Paul Hiemstra a ?crit :
> Hi Patrick,
>
> Thanks for the code! My suggestion would be to use spplot instead of 
> filled.contour, this function is really made to display spatial data. 
> It works for grids, points and polygons and makes it really easy to 
> combine those in one plot. You need to put your data into the spatial 
> R classes provided by the sp-package. See:
>
> http://wiki.r-project.org/rwiki/doku.php?id=tips:spatial-data:spatial_data_visualization 
>
>
> some tips on how to visualize data using spplot.
>
> cheers,
> Paul
>
> P


Yes, I am quite used with sp objects now, and using them almost on a 
daily basis... I am currently comparing levelplot, image.*, 
filled.contour, etc... and indeed spplot is excellent. What I liked in 
filled.contour is the smoothness of the display (really following 
contour lines). The others functions have many other advantages, but the 
pixels are represented as they are, which makes the display a bit rough 
compared to filled.contour for coarse resolutions (would be nice to have 
something as a smoother embedded to improve the display).

Thanks anyway for the hints,

Patrick


From ssefick at gmail.com  Thu Jul  9 18:23:20 2009
From: ssefick at gmail.com (stephen sefick)
Date: Thu, 9 Jul 2009 11:23:20 -0500
Subject: [R-sig-Geo] DEM patching
Message-ID: <c502a9e10907090923o3d2e0883o37421c6f7f0d5b1a@mail.gmail.com>

I am trying to cobble together 1/3 arc second DEMs from the USGS
seamless server (.adf).  I am using grass 6.4 and have spgrass6 up and
running.  when I patch the images together in grass they show up as a
three color relief map, but individually they are fine.  Is there a
way in R to make this easier or am I missing something?
thanks in advance,

-- 
Stephen Sefick

Let's not spend our time and resources thinking about things that are
so little or so large that all they really do for us is puff us up and
make us feel like gods.  We are mammals, and have not exhausted the
annoying little problems of being mammals.

								-K. Mullis


From josh.london at noaa.gov  Thu Jul  9 19:20:42 2009
From: josh.london at noaa.gov (Josh London)
Date: Thu, 09 Jul 2009 10:20:42 -0700
Subject: [R-sig-Geo] Slope and Aspect calculations in R
Message-ID: <4A5626EA.4080306@noaa.gov>

Hello

We are looking to mimic, in R, the slope (max magnitude difference 
between a cell and its neighbors) and aspect (direction of maximum 
magnitude difference) functions found in ESRI's Spatial Analyst package. 
We were just about to code up the slope function but thought I would 
make sure we weren't re-inventing any wheels already out there.

Thanks
Josh

-- 
Josh M. London, PhD

Wildlife Biologist
Polar Ecosystem Program
National Marine Mammal Lab
Alaska Fisheries Science Center, NOAA Fisheries
Seattle, WA

The contents of this message are mine personally and do not
necessarily reflect any position of the Government or the
National Oceanic and Atmospheric Administration.


From Thomas.Adams at noaa.gov  Thu Jul  9 19:57:01 2009
From: Thomas.Adams at noaa.gov (Thomas Adams)
Date: Thu, 09 Jul 2009 13:57:01 -0400
Subject: [R-sig-Geo] Slope and Aspect calculations in R
In-Reply-To: <4A5626EA.4080306@noaa.gov>
References: <4A5626EA.4080306@noaa.gov>
Message-ID: <4A562F6D.403@noaa.gov>

Josh,

I can not answer your specific question WRT R, but before you embark on 
this, you may consider R with GRASS GIS ? they play together pretty 
nicely and the slope and aspect capabilities are part of GRASS.

Regards,
Tom

Josh London wrote:
> Hello
>
> We are looking to mimic, in R, the slope (max magnitude difference 
> between a cell and its neighbors) and aspect (direction of maximum 
> magnitude difference) functions found in ESRI's Spatial Analyst 
> package. We were just about to code up the slope function but thought 
> I would make sure we weren't re-inventing any wheels already out there.
>
> Thanks
> Josh
>


-- 
Thomas E Adams
National Weather Service
Ohio River Forecast Center
1901 South State Route 134
Wilmington, OH 45177

EMAIL:	thomas.adams at noaa.gov

VOICE:	937-383-0528
FAX:	937-383-0033


From milton.ruser at gmail.com  Thu Jul  9 19:55:22 2009
From: milton.ruser at gmail.com (milton ruser)
Date: Thu, 9 Jul 2009 13:55:22 -0400
Subject: [R-sig-Geo] Slope and Aspect calculations in R
In-Reply-To: <4A5626EA.4080306@noaa.gov>
References: <4A5626EA.4080306@noaa.gov>
Message-ID: <3aaf1a030907091055h63bfecfai21b83699967874ca@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090709/b6b8bf9d/attachment.pl>

From seunghong at wisc.edu  Thu Jul  9 20:02:03 2009
From: seunghong at wisc.edu (Steve Hong)
Date: Thu, 09 Jul 2009 13:02:03 -0500
Subject: [R-sig-Geo] convert long/lati to UTM
Message-ID: <7060cafd2397b.4a55ea4b@wiscmail.wisc.edu>

Hi R-sig-geo list,

I am very new to spatial stat using R. I have a basic (pretty much to most of you) question. I have data set with "Longitude" and "Latitude" columns and want to convert to them "UTM" Although I found example of it from the previous questions and answers, I am still struggling to handle the task. Can anyone give me step by step guide as detailed as possible? I copied and pasted partial data below.

> df
   Latitude Longitude     V1          V2           V3          V4           V5
1  44.93342 -91.26773 5.633098 5.768218 5.455419 0.000000 3.797475
2  45.26847 -91.00759 5.571924 5.236741 0.000000 3.797475 4.450634
3  45.42214 -91.09543 5.994687 5.517567 0.000000 4.775137 5.589799
4  45.41381 -91.68441 6.066919 5.460165 0.000000 3.496515 5.793042
5  45.39483 -91.96903 6.089662 5.663694 4.726833 4.496390 5.553282
6  45.30666 -92.33407 5.252253 5.087444 3.496515 4.098471 4.838805
7  45.81549 -92.08828 5.967668 5.309292 0.000000 0.000000 4.098471
8  45.42060 -92.25039 5.645596 5.309292 0.000000 0.000000 4.700505
9  45.13453 -91.51800 5.838799 5.464860 0.000000 4.838805 5.613648
10 43.94975 -88.07627 5.812347 5.703203 4.672477 3.797475 4.450634

Thank you very much in advance!!!

Steve


From milton.ruser at gmail.com  Thu Jul  9 21:58:26 2009
From: milton.ruser at gmail.com (milton ruser)
Date: Thu, 9 Jul 2009 15:58:26 -0400
Subject: [R-sig-Geo] convert long/lati to UTM
In-Reply-To: <7060cafd2397b.4a55ea4b@wiscmail.wisc.edu>
References: <7060cafd2397b.4a55ea4b@wiscmail.wisc.edu>
Message-ID: <3aaf1a030907091258t7d230f73na213f3b3f82d494c@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090709/3915155e/attachment.pl>

From milton.ruser at gmail.com  Thu Jul  9 21:59:32 2009
From: milton.ruser at gmail.com (milton ruser)
Date: Thu, 9 Jul 2009 15:59:32 -0400
Subject: [R-sig-Geo] convert long/lati to UTM
In-Reply-To: <7060cafd2397b.4a55ea4b@wiscmail.wisc.edu>
References: <7060cafd2397b.4a55ea4b@wiscmail.wisc.edu>
Message-ID: <3aaf1a030907091259k72dbf84dq50ab50791ac41c5a@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090709/b3c3df9c/attachment.pl>

From p.hiemstra at geo.uu.nl  Thu Jul  9 22:23:37 2009
From: p.hiemstra at geo.uu.nl (Paul Hiemstra)
Date: Thu, 09 Jul 2009 22:23:37 +0200
Subject: [R-sig-Geo] convert long/lati to UTM
In-Reply-To: <7060cafd2397b.4a55ea4b@wiscmail.wisc.edu>
References: <7060cafd2397b.4a55ea4b@wiscmail.wisc.edu>
Message-ID: <4A5651C9.9070507@geo.uu.nl>

Hi,

More in general you need to take a look at the sp-pacakge for Spatial 
classes in R. Once your data is in these classes you can use spTransform 
from the rgdal pacakge to perform the projection. spTransform uses the 
proj4 library. You need to find the so called proj4 strings describing 
both the source and target projection.

cheers,
Paul

Steve Hong schreef:
> Hi R-sig-geo list,
>
> I am very new to spatial stat using R. I have a basic (pretty much to most of you) question. I have data set with "Longitude" and "Latitude" columns and want to convert to them "UTM" Although I found example of it from the previous questions and answers, I am still struggling to handle the task. Can anyone give me step by step guide as detailed as possible? I copied and pasted partial data below.
>
>   
>> df
>>     
>    Latitude Longitude     V1          V2           V3          V4           V5
> 1  44.93342 -91.26773 5.633098 5.768218 5.455419 0.000000 3.797475
> 2  45.26847 -91.00759 5.571924 5.236741 0.000000 3.797475 4.450634
> 3  45.42214 -91.09543 5.994687 5.517567 0.000000 4.775137 5.589799
> 4  45.41381 -91.68441 6.066919 5.460165 0.000000 3.496515 5.793042
> 5  45.39483 -91.96903 6.089662 5.663694 4.726833 4.496390 5.553282
> 6  45.30666 -92.33407 5.252253 5.087444 3.496515 4.098471 4.838805
> 7  45.81549 -92.08828 5.967668 5.309292 0.000000 0.000000 4.098471
> 8  45.42060 -92.25039 5.645596 5.309292 0.000000 0.000000 4.700505
> 9  45.13453 -91.51800 5.838799 5.464860 0.000000 4.838805 5.613648
> 10 43.94975 -88.07627 5.812347 5.703203 4.672477 3.797475 4.450634
>
> Thank you very much in advance!!!
>
> Steve
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From josh.london at noaa.gov  Thu Jul  9 22:44:56 2009
From: josh.london at noaa.gov (Josh London)
Date: Thu, 09 Jul 2009 13:44:56 -0700
Subject: [R-sig-Geo] Slope and Aspect calculations in R
In-Reply-To: <4A5626EA.4080306@noaa.gov>
References: <4A5626EA.4080306@noaa.gov>
Message-ID: <4A5656C8.8040501@noaa.gov>

Thanks for the suggestions so far regarding the use of GRASS or SAGA.

We have considered those options but SAGA doesn't appear available for 
MacOS. My understanding is that spgrass6 is more for accessing R 
code/functions from within GRASS vs accessing GRASS functions from 
within R. We have all our other analysis coded up in R, and just need 
these functions to do one part of a bigger process. Maybe I'm 
misunderstanding how to use R and GRASS together. I'll do some further 
research.

Thanks again
Josh

Josh London wrote:
> Hello
> 
> We are looking to mimic, in R, the slope (max magnitude difference 
> between a cell and its neighbors) and aspect (direction of maximum 
> magnitude difference) functions found in ESRI's Spatial Analyst package. 
> We were just about to code up the slope function but thought I would 
> make sure we weren't re-inventing any wheels already out there.
> 
> Thanks
> Josh
> 

-- 
Josh M. London, PhD

Wildlife Biologist
Polar Ecosystem Program
National Marine Mammal Lab
Alaska Fisheries Science Center, NOAA Fisheries
Seattle, WA

The contents of this message are mine personally and do not
necessarily reflect any position of the Government or the
National Oceanic and Atmospheric Administration.


From b.rowlingson at lancaster.ac.uk  Thu Jul  9 22:50:24 2009
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Thu, 9 Jul 2009 21:50:24 +0100
Subject: [R-sig-Geo] convert long/lati to UTM
In-Reply-To: <4A5651C9.9070507@geo.uu.nl>
References: <7060cafd2397b.4a55ea4b@wiscmail.wisc.edu>
	<4A5651C9.9070507@geo.uu.nl>
Message-ID: <d8ad40b50907091350s3c8e6737s41c755a9a7fa1d4b@mail.gmail.com>

On Thu, Jul 9, 2009 at 9:23 PM, Paul Hiemstra<p.hiemstra at geo.uu.nl> wrote:
> Hi,
>
> More in general you need to take a look at the sp-pacakge for Spatial
> classes in R. Once your data is in these classes you can use spTransform
> from the rgdal pacakge to perform the projection. spTransform uses the proj4
> library. You need to find the so called proj4 strings describing both the
> source and target projection.
>

 There seems to be several ways of reprojecting/coordinate transforming in R...

 package:sp, in ?is.projected, mentions an spproj package which I
can't find. Is that just a documentation error?...

 package:rgdal has spTransform as mentioned...

 package:proj4 seems to be an independent interface to the PROJ4 library.

Barry


From Roger.Bivand at nhh.no  Thu Jul  9 22:59:15 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 9 Jul 2009 22:59:15 +0200 (CEST)
Subject: [R-sig-Geo] Slope and Aspect calculations in R
In-Reply-To: <4A5656C8.8040501@noaa.gov>
References: <4A5626EA.4080306@noaa.gov> <4A5656C8.8040501@noaa.gov>
Message-ID: <alpine.LRH.2.00.0907092251540.7406@reclus.nhh.no>

On Thu, 9 Jul 2009, Josh London wrote:

> Thanks for the suggestions so far regarding the use of GRASS or SAGA.
>
> We have considered those options but SAGA doesn't appear available for MacOS. 
> My understanding is that spgrass6 is more for accessing R code/functions from 
> within GRASS vs accessing GRASS functions from within R. We have all our 
> other analysis coded up in R, and just need these functions to do one part of 
> a bigger process. Maybe I'm misunderstanding how to use R and GRASS together. 
> I'll do some further research.

>From 0.6-* on CRAN, you can create an anonymous GRASS location on the fly 
with initGRASS() and run GRASS commands like r.slope.aspect with 
execGRASS() from the R side. See http://www.geomorphometry.org/R.asp for 
some examples - foot of page. You may also want to look at the underlying 
literature, and some of the functionality being provided in the raster 
package on R-Forge.

Roger

>
> Thanks again
> Josh
>
> Josh London wrote:
>> Hello
>> 
>> We are looking to mimic, in R, the slope (max magnitude difference between 
>> a cell and its neighbors) and aspect (direction of maximum magnitude 
>> difference) functions found in ESRI's Spatial Analyst package. We were just 
>> about to code up the slope function but thought I would make sure we 
>> weren't re-inventing any wheels already out there.
>> 
>> Thanks
>> Josh
>> 
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From milton.ruser at gmail.com  Thu Jul  9 23:02:05 2009
From: milton.ruser at gmail.com (milton ruser)
Date: Thu, 9 Jul 2009 17:02:05 -0400
Subject: [R-sig-Geo] Slope and Aspect calculations in R
In-Reply-To: <4A5656C8.8040501@noaa.gov>
References: <4A5626EA.4080306@noaa.gov> <4A5656C8.8040501@noaa.gov>
Message-ID: <3aaf1a030907091402l6b728aa1ie997378c435a33a6@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090709/bfbd6c98/attachment.pl>

From Roger.Bivand at nhh.no  Thu Jul  9 23:03:57 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 9 Jul 2009 23:03:57 +0200 (CEST)
Subject: [R-sig-Geo] convert long/lati to UTM
In-Reply-To: <d8ad40b50907091350s3c8e6737s41c755a9a7fa1d4b@mail.gmail.com>
References: <7060cafd2397b.4a55ea4b@wiscmail.wisc.edu>
	<4A5651C9.9070507@geo.uu.nl>
	<d8ad40b50907091350s3c8e6737s41c755a9a7fa1d4b@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.0907092259300.7406@reclus.nhh.no>

On Thu, 9 Jul 2009, Barry Rowlingson wrote:

> On Thu, Jul 9, 2009 at 9:23 PM, Paul Hiemstra<p.hiemstra at geo.uu.nl> wrote:
>> Hi,
>>
>> More in general you need to take a look at the sp-pacakge for Spatial
>> classes in R. Once your data is in these classes you can use spTransform
>> from the rgdal pacakge to perform the projection. spTransform uses the proj4
>> library. You need to find the so called proj4 strings describing both the
>> source and target projection.
>>
>
> There seems to be several ways of reprojecting/coordinate transforming in R...
>
> package:sp, in ?is.projected, mentions an spproj package which I
> can't find. Is that just a documentation error?...

Documentation error, will be corrected.

>
> package:rgdal has spTransform as mentioned...
>

Correct, a good deal based on your work for vector data and projection.

> package:proj4 seems to be an independent interface to the PROJ4 library.
>

Odd and unhelpful, a one-off attempt to replace mapproj, which works 
together with the maps package, but has unclear license conditions. This 
package doesn't interface with any other spatial packages, and the author 
has never replied to questions about coordinating to get rgdal on CRAN as 
an OSX binary package. Use proj4 or maptools is you must, rgdal for 
preference - spproj was a development vehicle for methods that are now in 
rgdal.

Roger

> Barry
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From seunghong at wisc.edu  Thu Jul  9 23:25:59 2009
From: seunghong at wisc.edu (Steve Hong)
Date: Thu, 09 Jul 2009 16:25:59 -0500
Subject: [R-sig-Geo] convert long/lati to UTM
In-Reply-To: <alpine.LRH.2.00.0907092259300.7406@reclus.nhh.no>
References: <7060cafd2397b.4a55ea4b@wiscmail.wisc.edu>
	<4A5651C9.9070507@geo.uu.nl>
	<d8ad40b50907091350s3c8e6737s41c755a9a7fa1d4b@mail.gmail.com>
	<alpine.LRH.2.00.0907092259300.7406@reclus.nhh.no>
Message-ID: <6f609d2c27032.4a561a17@wiscmail.wisc.edu>

Thank all of you for responding! I will take a look at rgdal.

Cheer!

Steve

----- Original Message -----
From: Roger Bivand <Roger.Bivand at nhh.no>
Date: Thursday, July 9, 2009 4:04 pm
Subject: Re: [R-sig-Geo] convert long/lati to UTM
To: Barry Rowlingson <b.rowlingson at lancaster.ac.uk>
Cc: Paul Hiemstra <p.hiemstra at geo.uu.nl>, sch at entomology.wisc.edu, r-sig-geo at stat.math.ethz.ch


> On Thu, 9 Jul 2009, Barry Rowlingson wrote:
> 
> >On Thu, Jul 9, 2009 at 9:23 PM, Paul Hiemstra<p.hiemstra at geo.uu.nl> wrote:
> >>Hi,
> >>
> >>More in general you need to take a look at the sp-pacakge for Spatial
> >>classes in R. Once your data is in these classes you can use spTransform
> >>from the rgdal pacakge to perform the projection. spTransform uses 
> the proj4
> >>library. You need to find the so called proj4 strings describing 
> both the
> >>source and target projection.
> >>
> >
> >There seems to be several ways of reprojecting/coordinate 
> transforming in R...
> >
> >package:sp, in ?is.projected, mentions an spproj package which I
> >can't find. Is that just a documentation error?...
> 
> Documentation error, will be corrected.
> 
> >
> >package:rgdal has spTransform as mentioned...
> >
> 
> Correct, a good deal based on your work for vector data and projection.
> 
> >package:proj4 seems to be an independent interface to the PROJ4 library.
> >
> 
> Odd and unhelpful, a one-off attempt to replace mapproj, which works 
> together with the maps package, but has unclear license conditions. 
> This package doesn't interface with any other spatial packages, and 
> the author has never replied to questions about coordinating to get 
> rgdal on CRAN as an OSX binary package. Use proj4 or maptools is you 
> must, rgdal for preference - spproj was a development vehicle for 
> methods that are now in rgdal.
> 
> Roger
> 
> >Barry
> >
> >_______________________________________________
> >R-sig-Geo mailing list
> >R-sig-Geo at stat.math.ethz.ch
> >https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
> 
> -- 
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School 
> of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>


From stuart.wagenius at gmail.com  Thu Jul  9 23:37:13 2009
From: stuart.wagenius at gmail.com (Stuart Wagenius)
Date: Thu, 9 Jul 2009 16:37:13 -0500
Subject: [R-sig-Geo] convert long/lati to UTM
In-Reply-To: <6f609d2c27032.4a561a17@wiscmail.wisc.edu>
References: <7060cafd2397b.4a55ea4b@wiscmail.wisc.edu>
	<4A5651C9.9070507@geo.uu.nl>
	<d8ad40b50907091350s3c8e6737s41c755a9a7fa1d4b@mail.gmail.com>
	<alpine.LRH.2.00.0907092259300.7406@reclus.nhh.no>
	<6f609d2c27032.4a561a17@wiscmail.wisc.edu>
Message-ID: <206a64110907091437x5f7b67eta9ff3d3abdbafb9f@mail.gmail.com>

Steve,

I've used package PBSmaping to convert from UTM  to Lat/Long and back.
I posted a dataset, a snippet of R code, and the resulting file as a
recent blog entry:

http://blog.lib.umn.edu/wage0005/echinacea/2009/07/spp_coordinates.html

You may find it helpful.

Stuart

On Thu, Jul 9, 2009 at 4:25 PM, Steve Hong<seunghong at wisc.edu> wrote:
> Thank all of you for responding! I will take a look at rgdal.
>
> Cheer!
>
> Steve
>
> ----- Original Message -----
> From: Roger Bivand <Roger.Bivand at nhh.no>
> Date: Thursday, July 9, 2009 4:04 pm
> Subject: Re: [R-sig-Geo] convert long/lati to UTM
> To: Barry Rowlingson <b.rowlingson at lancaster.ac.uk>
> Cc: Paul Hiemstra <p.hiemstra at geo.uu.nl>, sch at entomology.wisc.edu, r-sig-geo at stat.math.ethz.ch
>
>
>> On Thu, 9 Jul 2009, Barry Rowlingson wrote:
>>
>> >On Thu, Jul 9, 2009 at 9:23 PM, Paul Hiemstra<p.hiemstra at geo.uu.nl> wrote:
>> >>Hi,
>> >>
>> >>More in general you need to take a look at the sp-pacakge for Spatial
>> >>classes in R. Once your data is in these classes you can use spTransform
>> >>from the rgdal pacakge to perform the projection. spTransform uses
>> the proj4
>> >>library. You need to find the so called proj4 strings describing
>> both the
>> >>source and target projection.
>> >>
>> >
>> >There seems to be several ways of reprojecting/coordinate
>> transforming in R...
>> >
>> >package:sp, in ?is.projected, mentions an spproj package which I
>> >can't find. Is that just a documentation error?...
>>
>> Documentation error, will be corrected.
>>
>> >
>> >package:rgdal has spTransform as mentioned...
>> >
>>
>> Correct, a good deal based on your work for vector data and projection.
>>
>> >package:proj4 seems to be an independent interface to the PROJ4 library.
>> >
>>
>> Odd and unhelpful, a one-off attempt to replace mapproj, which works
>> together with the maps package, but has unclear license conditions.
>> This package doesn't interface with any other spatial packages, and
>> the author has never replied to questions about coordinating to get
>> rgdal on CRAN as an OSX binary package. Use proj4 or maptools is you
>> must, rgdal for preference - spproj was a development vehicle for
>> methods that are now in rgdal.
>>
>> Roger
>>
>> >Barry
>> >
>> >_______________________________________________
>> >R-sig-Geo mailing list
>> >R-sig-Geo at stat.math.ethz.ch
>> >https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> >
>>
>> --
>> Roger Bivand
>> Economic Geography Section, Department of Economics, Norwegian School
>> of
>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>> e-mail: Roger.Bivand at nhh.no
>>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From greenberg at ucdavis.edu  Fri Jul 10 03:33:40 2009
From: greenberg at ucdavis.edu (Jonathan Greenberg)
Date: Thu, 09 Jul 2009 18:33:40 -0700
Subject: [R-sig-Geo] How do I set ENVI file interleave when using
	GDALTransientDataset?
Message-ID: <4A569A74.8020202@ucdavis.edu>

I'm writing a function to mimic ENVI/IDL's "ENVI_SETUP_HEAD" using 
rgdal, and I was wondering how I set the interleave (BIP vs BSQ vs 
BIL)?  The subsection of my code that I assume this belongs in is below:

    driver="ENVI"
    d.drv <- new("GDALDriver", driver)
    tds.out <- new("GDALTransientDataset", driver = d.drv, rows = 
dims[2],cols = dims[1], bands = bands, type = type)
    gt <- c(offset[1] - 0.5 * cellsize[1], cellsize[1], 0.0,offset[2] + 
(dims[2] -0.5) * cellsize[2], 0.0, -cellsize[2])
    .Call("RGDAL_SetGeoTransform", tds.out, gt, PACKAGE = "rgdal")
    .Call("RGDAL_SetProject", tds.out, file_projection, PACKAGE = "rgdal")
    fn <- tempfile()
    saveDataset(tds.out, fn)

Thanks!

--j


-- 

Jonathan A. Greenberg, PhD
Postdoctoral Scholar
Center for Spatial Technologies and Remote Sensing (CSTARS)
University of California, Davis
One Shields Avenue
The Barn, Room 250N
Davis, CA 95616
Cell: 415-794-5043
AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307


From greenberg at ucdavis.edu  Fri Jul 10 05:46:56 2009
From: greenberg at ucdavis.edu (Jonathan Greenberg)
Date: Thu, 09 Jul 2009 20:46:56 -0700
Subject: [R-sig-Geo] More questions on setting up ENVI headers...
Message-ID: <4A56B9B0.8080808@ucdavis.edu>

R-sig-geo'ers:

I am using the following code to create an ENVI header:

    driver="ENVI"
    d.drv <- new("GDALDriver", driver)
    tds.out <- new("GDALTransientDataset", driver = d.drv, rows = 
dims[2],cols = dims[1], bands = bands, type = type)
    gt <- c(offset[1] - 0.5 * cellsize[1], cellsize[1], 0.0,offset[2] + 
(dims[2] -0.5) * cellsize[2], 0.0, -cellsize[2])
    print(gt)
    .Call("RGDAL_SetGeoTransform", tds.out, gt, PACKAGE = "rgdal")
    .Call("RGDAL_SetProject", tds.out, file_projection, PACKAGE = "rgdal")
    fn <- tempfile()
    saveDataset(tds.out, fn)
    GDAL.close(tds.out)

gt prints out to be:
[1]  736801.7      30.0       0.0 4447309.0       0.0     -30.0

    The issue I'm having is that the output header, while containing the 
correct projection, is not saving out the pixel sizes, an upper left 
coordinates (e.g. I'm not getting RGDAL_SetGeoTransform to work 
correctly).  Here's the text of the output header:

ENVI
description = {
/var/folders/-Y/-Yv+caBK2RaJhU+8ZQAOk++++TQ/-Tmp-//RtmpX7PvqQ/file4431b782}
samples = 1172
lines   = 2810
bands   = 7
header offset = 0
file type = ENVI Standard
data type = 4
interleave = bsq
byte order = 0
map info = {UTM, 1, 1, 0, 0, 1, 1, 10, North,North America 1983}
band names = {
Band 1,
Band 2,
Band 3,
Band 4,
Band 5,
Band 6,
Band 7}

    Thoughts?

--j

-- 

Jonathan A. Greenberg, PhD
Postdoctoral Scholar
Center for Spatial Technologies and Remote Sensing (CSTARS)
University of California, Davis
One Shields Avenue
The Barn, Room 250N
Davis, CA 95616
Cell: 415-794-5043
AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307


From Roger.Bivand at nhh.no  Fri Jul 10 09:53:27 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 10 Jul 2009 09:53:27 +0200 (CEST)
Subject: [R-sig-Geo] How do I set ENVI file interleave when using
 GDALTransientDataset?
In-Reply-To: <4A569A74.8020202@ucdavis.edu>
References: <4A569A74.8020202@ucdavis.edu>
Message-ID: <alpine.LRH.2.00.0907100949310.12262@reclus.nhh.no>

On Thu, 9 Jul 2009, Jonathan Greenberg wrote:

> I'm writing a function to mimic ENVI/IDL's "ENVI_SETUP_HEAD" using 
> rgdal, and I was wondering how I set the interleave (BIP vs BSQ vs BIL)?

You'll need to use the options= argument to pass through these values when 
you instantiate the transient dataset. There is an example of its use in 
?writeOGR.

Roger

> The subsection of my code that I assume this belongs in is below:
>
>   driver="ENVI"
>   d.drv <- new("GDALDriver", driver)
>   tds.out <- new("GDALTransientDataset", driver = d.drv, rows = dims[2],cols 
> = dims[1], bands = bands, type = type)
>   gt <- c(offset[1] - 0.5 * cellsize[1], cellsize[1], 0.0,offset[2] + 
> (dims[2] -0.5) * cellsize[2], 0.0, -cellsize[2])
>   .Call("RGDAL_SetGeoTransform", tds.out, gt, PACKAGE = "rgdal")
>   .Call("RGDAL_SetProject", tds.out, file_projection, PACKAGE = "rgdal")
>   fn <- tempfile()
>   saveDataset(tds.out, fn)
>
> Thanks!
>
> --j
>
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From Roger.Bivand at nhh.no  Fri Jul 10 09:57:34 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 10 Jul 2009 09:57:34 +0200 (CEST)
Subject: [R-sig-Geo] More questions on setting up ENVI headers...
In-Reply-To: <4A56B9B0.8080808@ucdavis.edu>
References: <4A56B9B0.8080808@ucdavis.edu>
Message-ID: <alpine.LRH.2.00.0907100953360.12262@reclus.nhh.no>

On Thu, 9 Jul 2009, Jonathan Greenberg wrote:

> R-sig-geo'ers:
>
> I am using the following code to create an ENVI header:
>
>   driver="ENVI"
>   d.drv <- new("GDALDriver", driver)
>   tds.out <- new("GDALTransientDataset", driver = d.drv, rows = dims[2],cols 
> = dims[1], bands = bands, type = type)
>   gt <- c(offset[1] - 0.5 * cellsize[1], cellsize[1], 0.0,offset[2] + 
> (dims[2] -0.5) * cellsize[2], 0.0, -cellsize[2])
>   print(gt)
>   .Call("RGDAL_SetGeoTransform", tds.out, gt, PACKAGE = "rgdal")
>   .Call("RGDAL_SetProject", tds.out, file_projection, PACKAGE = "rgdal")
>   fn <- tempfile()
>   saveDataset(tds.out, fn)
>   GDAL.close(tds.out)
>
> gt prints out to be:
> [1]  736801.7      30.0       0.0 4447309.0       0.0     -30.0
>
>   The issue I'm having is that the output header, while containing the 
> correct projection, is not saving out the pixel sizes, an upper left 
> coordinates (e.g. I'm not getting RGDAL_SetGeoTransform to work correctly).

It is tricky, partly because in places the order of the coordinates is 
reversed - sometimes (columns, rows) for R-facing functions, often (rows, 
columns) for GDAL-facing code). I suspect that this is what is confusing 
here. Try to follow the code in writeGDAL() through called functions for 
examples.

Roger

> Here's the text of the output header:
>
> ENVI
> description = {
> /var/folders/-Y/-Yv+caBK2RaJhU+8ZQAOk++++TQ/-Tmp-//RtmpX7PvqQ/file4431b782}
> samples = 1172
> lines   = 2810
> bands   = 7
> header offset = 0
> file type = ENVI Standard
> data type = 4
> interleave = bsq
> byte order = 0
> map info = {UTM, 1, 1, 0, 0, 1, 1, 10, North,North America 1983}
> band names = {
> Band 1,
> Band 2,
> Band 3,
> Band 4,
> Band 5,
> Band 6,
> Band 7}
>
>   Thoughts?
>
> --j
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From Roger.Bivand at nhh.no  Fri Jul 10 09:59:14 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 10 Jul 2009 09:59:14 +0200 (CEST)
Subject: [R-sig-Geo] How do I set ENVI file interleave when using
 GDALTransientDataset?
In-Reply-To: <alpine.LRH.2.00.0907100949310.12262@reclus.nhh.no>
References: <4A569A74.8020202@ucdavis.edu>
	<alpine.LRH.2.00.0907100949310.12262@reclus.nhh.no>
Message-ID: <alpine.LRH.2.00.0907100957520.12262@reclus.nhh.no>

On Fri, 10 Jul 2009, Roger Bivand wrote:

> On Thu, 9 Jul 2009, Jonathan Greenberg wrote:
>
>> I'm writing a function to mimic ENVI/IDL's "ENVI_SETUP_HEAD" using rgdal, 
>> and I was wondering how I set the interleave (BIP vs BSQ vs BIL)?
>
> You'll need to use the options= argument to pass through these values when 
> you instantiate the transient dataset. There is an example of its use in 
> ?writeOGR.

Sorry, ?writeGDAL, of course. The valid options are given on the GDAL 
supported formats pages for creation and/or copying - not (naturally) the 
reading options.

>
> Roger
>
>> The subsection of my code that I assume this belongs in is below:
>>
>>   driver="ENVI"
>>   d.drv <- new("GDALDriver", driver)
>>   tds.out <- new("GDALTransientDataset", driver = d.drv, rows = 
>> dims[2],cols = dims[1], bands = bands, type = type)
>>   gt <- c(offset[1] - 0.5 * cellsize[1], cellsize[1], 0.0,offset[2] + 
>> (dims[2] -0.5) * cellsize[2], 0.0, -cellsize[2])
>>   .Call("RGDAL_SetGeoTransform", tds.out, gt, PACKAGE = "rgdal")
>>   .Call("RGDAL_SetProject", tds.out, file_projection, PACKAGE = "rgdal")
>>   fn <- tempfile()
>>   saveDataset(tds.out, fn)
>> 
>> Thanks!
>> 
>> --j
>> 
>> 
>> 
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From alobolistas at gmail.com  Fri Jul 10 10:17:28 2009
From: alobolistas at gmail.com (Agustin Lobo)
Date: Fri, 10 Jul 2009 10:17:28 +0200
Subject: [R-sig-Geo] spTransform: wrong results??
Message-ID: <4A56F918.4040903@gmail.com>

I'm finding conflicting results at comparing
results of converting UTM ED50 coordinates
to lon,lat WGS84 using spTransform() (thus, proj4)
and other programs such as GlobalMapper and Compegps.

My main surprise is that spTransform() yields the same result
whatever the ellps field for the inverse transform. This is
what I'm doing with the meuse dataset as an example, you can
see that the results of the inverse transform to lon,lat WGS84 are identical to
those to lon,lat ED50, both starting from UTM50 or from UTMWGS84

At the end
I include results with GlobalMapper for the first point. Results
with GlobalMapper do differ for lon,lat WGS84 and lon,lat ED50

Any help would be appreciated, as I'm doing all my work
in UTM ED50 but have to pass the coordinates as lon,lat WGS84
for the flight.

data(meuse)
coordinates(meuse) <- c("x", "y")
proj4string(meuse) <- CRS("+proj=stere +lat_0=52.15616055555555 
+lon_0=5.38763888888889 +k=0.999908 +x_0=155000 +y_0=463000 +ellps=bessel 
+units=m")
meuse.utm <- spTransform(meuse, CRS("+proj=utm +zone=32 +ellps=WGS84"))
coordinates(meuse.utm)[1:3,]
             x       y
[1,] 272571.9 5653978
[2,] 272522.4 5653927
[3,] 272661.2 5653899

meuse.utmintl <- spTransform(meuse, CRS("+proj=utm +zone=32 +ellps=intl"))
coordinates(meuse.utmintl)[1:3,]
             x       y
[1,] 272561.0 5654094
[2,] 272511.5 5654043
[3,] 272650.3 5654015

meuse.lonlatWGS84WGS84 <- spTransform(meuse.utm, CRS("+proj=lonlat +ellps=WGS84"))
meuse.lonlatWGS84intl  <- spTransform(meuse.utm, CRS("+proj=lonlat +ellps=intl"))
coordinates(meuse.lonlatWGS84WGS84)[1:3,]
             x        y
[1,] 5.759053 50.99238
[2,] 5.758380 50.99190
[3,] 5.760373 50.99171

coordinates(meuse.lonlatWGS84intl)[1:3,]
             x        y
[1,] 5.759053 50.99238
[2,] 5.758380 50.99190
[3,] 5.760373 50.99171

meuse.lonlatintlWGS84 <- spTransform(meuse.utmintl, CRS("+proj=lonlat 
+ellps=WGS84"))
meuse.lonlatintlintl  <- spTransform(meuse.utmintl, CRS("+proj=lonlat +ellps=intl"))
coordinates(meuse.lonlatintlWGS84)[1:3,]
             x        y
[1,] 5.759053 50.99238
[2,] 5.758380 50.99190
[3,] 5.760373 50.99171

coordinates(meuse.lonlatintlintl)[1:3,]
             x        y
[1,] 5.759053 50.99238
[2,] 5.758380 50.99190
[3,] 5.760373 50.99171

Test with Global Mapper

UTM ED50 272561.0 5654094 to lon,lat:
WGS84   5? 45' 27.5632" E	50? 59' 29.5996" N
ED50    5? 45' 32.5898" E	50? 59' 32.5665" N

UTM WGS84 272571.9 5653978 to lon,lat:
WGS84   5? 45' 32.5900" E	50? 59' 32.5621" N
ED50    5? 45' 37.6165" E	50? 59' 35.5289" N

Also, utmWGS84 to utmED50 is different in GlobalMapper

UTM WGS84  272571.9     5653978
UTM ED50   272662.989	5654181.171


Thanks,

Agus
-------------- next part --------------
A non-text attachment was scrubbed...
Name: alobolistas.vcf
Type: text/x-vcard
Size: 251 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090710/ed963ffa/attachment.vcf>

From Roger.Bivand at nhh.no  Fri Jul 10 10:37:08 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 10 Jul 2009 10:37:08 +0200 (CEST)
Subject: [R-sig-Geo] spTransform: wrong results??
In-Reply-To: <4A56F918.4040903@gmail.com>
References: <4A56F918.4040903@gmail.com>
Message-ID: <alpine.LRH.2.00.0907101024460.12262@reclus.nhh.no>

On Fri, 10 Jul 2009, Agustin Lobo wrote:

> I'm finding conflicting results at comparing
> results of converting UTM ED50 coordinates
> to lon,lat WGS84 using spTransform() (thus, proj4)
> and other programs such as GlobalMapper and Compegps.
>
> My main surprise is that spTransform() yields the same result
> whatever the ellps field for the inverse transform.

Wrong tree to bark up, I'm afraid. The tags you need and are missing are 
+datum= and +towgs84= (from memory, you'll see from the EPSG tags). The 
+ellps= tag sets the ellipsoid, but doesn't change the default +datum= 
from WGS84. Note that ED50 is a collection of datum values, and in general 
EPSG does not give 3 or 7 parameter datum transformation values unless 
they are known with certainty. On the Proj.4 side, you'll find some 
documentation on:

http://svn.osgeo.org/metacrs/proj/trunk/proj/html/gen_parms.html

otherwise use makeEPSG() in rgdal to search the bundled EPSG database, and 
do check the "Grids & Datums" essays on:

http://www.asprs.org/resources/grids/

for further help in tracking down possible +towgs84= parameter values.

Repeating, unless you give a +datum=, it will be assumed to be WGS84, so 
you shouldn't be surprised when you get similar results.

Sorry to disappoint, but surveying and cartography have their own 
traditions, some of which are localised as well.

Hope this helps,

Roger

> This is
> what I'm doing with the meuse dataset as an example, you can
> see that the results of the inverse transform to lon,lat WGS84 are identical 
> to
> those to lon,lat ED50, both starting from UTM50 or from UTMWGS84
>
> At the end
> I include results with GlobalMapper for the first point. Results
> with GlobalMapper do differ for lon,lat WGS84 and lon,lat ED50
>
> Any help would be appreciated, as I'm doing all my work
> in UTM ED50 but have to pass the coordinates as lon,lat WGS84
> for the flight.
>
> data(meuse)
> coordinates(meuse) <- c("x", "y")
> proj4string(meuse) <- CRS("+proj=stere +lat_0=52.15616055555555 
> +lon_0=5.38763888888889 +k=0.999908 +x_0=155000 +y_0=463000 +ellps=bessel 
> +units=m")
> meuse.utm <- spTransform(meuse, CRS("+proj=utm +zone=32 +ellps=WGS84"))
> coordinates(meuse.utm)[1:3,]
>            x       y
> [1,] 272571.9 5653978
> [2,] 272522.4 5653927
> [3,] 272661.2 5653899
>
> meuse.utmintl <- spTransform(meuse, CRS("+proj=utm +zone=32 +ellps=intl"))
> coordinates(meuse.utmintl)[1:3,]
>            x       y
> [1,] 272561.0 5654094
> [2,] 272511.5 5654043
> [3,] 272650.3 5654015
>
> meuse.lonlatWGS84WGS84 <- spTransform(meuse.utm, CRS("+proj=lonlat 
> +ellps=WGS84"))
> meuse.lonlatWGS84intl  <- spTransform(meuse.utm, CRS("+proj=lonlat 
> +ellps=intl"))
> coordinates(meuse.lonlatWGS84WGS84)[1:3,]
>            x        y
> [1,] 5.759053 50.99238
> [2,] 5.758380 50.99190
> [3,] 5.760373 50.99171
>
> coordinates(meuse.lonlatWGS84intl)[1:3,]
>            x        y
> [1,] 5.759053 50.99238
> [2,] 5.758380 50.99190
> [3,] 5.760373 50.99171
>
> meuse.lonlatintlWGS84 <- spTransform(meuse.utmintl, CRS("+proj=lonlat 
> +ellps=WGS84"))
> meuse.lonlatintlintl  <- spTransform(meuse.utmintl, CRS("+proj=lonlat 
> +ellps=intl"))
> coordinates(meuse.lonlatintlWGS84)[1:3,]
>            x        y
> [1,] 5.759053 50.99238
> [2,] 5.758380 50.99190
> [3,] 5.760373 50.99171
>
> coordinates(meuse.lonlatintlintl)[1:3,]
>            x        y
> [1,] 5.759053 50.99238
> [2,] 5.758380 50.99190
> [3,] 5.760373 50.99171
>
> Test with Global Mapper
>
> UTM ED50 272561.0 5654094 to lon,lat:
> WGS84   5? 45' 27.5632" E	50? 59' 29.5996" N
> ED50    5? 45' 32.5898" E	50? 59' 32.5665" N
>
> UTM WGS84 272571.9 5653978 to lon,lat:
> WGS84   5? 45' 32.5900" E	50? 59' 32.5621" N
> ED50    5? 45' 37.6165" E	50? 59' 35.5289" N
>
> Also, utmWGS84 to utmED50 is different in GlobalMapper
>
> UTM WGS84  272571.9     5653978
> UTM ED50   272662.989	5654181.171
>
>
> Thanks,
>
> Agus
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From alobolistas at gmail.com  Fri Jul 10 12:18:26 2009
From: alobolistas at gmail.com (Agustin Lobo)
Date: Fri, 10 Jul 2009 12:18:26 +0200
Subject: [R-sig-Geo] spTransform: wrong results??
In-Reply-To: <alpine.LRH.2.00.0907101024460.12262@reclus.nhh.no>
References: <4A56F918.4040903@gmail.com>
	<alpine.LRH.2.00.0907101024460.12262@reclus.nhh.no>
Message-ID: <27de757d0907100318s7f7100b1x72d44555e9b52430@mail.gmail.com>

But if I use:
meuse.lonlatintlWGS84  <- spTransform(meuse.utm, CRS("+proj=lonlat
+datum=WGS84"))

get the same result. Also, don't know where I should put the towgs84=
field, have searched the R doc for
towgs and do not find anything. I've looked in the doc you mention,
and towgs84= must include a set of
parameters that cannot find. The doc states
"For instance, the following demonstrates converting from the Greek GGRS87
datum to WGS84.<p>

<pre>
% cs2cs +proj=latlong +ellps=GRS80 +towgs84=-199.87,74.79,246.62 \
    +to +proj=latlong +datum=WGS84
"
but where can I find those 3 parameters for my case? Also, why is not
spTransform() taking care
of that? The spTransform() doc does not mention that towgs84 is
required, actually there are several
examples using the meuse dataset and trasforming to different datums:

proj4string(meuse) <- CRS("+proj=stere +lat_0=52.15616055555555
+lon_0=5.38763888888889 +k=0.999908 +x_0=155000 +y_0=463000
+ellps=bessel +units=m")
meuse.utm <- spTransform(meuse, CRS("+proj=utm +zone=32 +ellps=WGS84"))

and the towgs84 is not there. Does this mean that coordinates in
meuse.utm remain in ellpsoid Bessel instead of WGS84
as specified in spTransform() ?

On the other hand, I've made:
EPSG <- make_EPSG()
and found
SG[27,3]
[1] "+proj=longlat +ellps=WGS84 +no_defs"
> EPSG[2446,]
      code                  note
2446 23031 # ED50 / UTM zone 31N
                                                 prj4
2446 +proj=utm +zone=31 +ellps=intl +units=m +no_defs
and
> EPSG[27,3]
[1] "+proj=longlat +ellps=WGS84 +no_defs"

no +datum field.

This is so confusing...

Agus

2009/7/10 Roger Bivand <Roger.Bivand at nhh.no>:
> On Fri, 10 Jul 2009, Agustin Lobo wrote:
>
>> I'm finding conflicting results at comparing
>> results of converting UTM ED50 coordinates
>> to lon,lat WGS84 using spTransform() (thus, proj4)
>> and other programs such as GlobalMapper and Compegps.
>>
>> My main surprise is that spTransform() yields the same result
>> whatever the ellps field for the inverse transform.
>
> Wrong tree to bark up, I'm afraid. The tags you need and are missing are
> +datum= and +towgs84= (from memory, you'll see from the EPSG tags). The
> +ellps= tag sets the ellipsoid, but doesn't change the default +datum= from
> WGS84. Note that ED50 is a collection of datum values, and in general EPSG
> does not give 3 or 7 parameter datum transformation values unless they are
> known with certainty. On the Proj.4 side, you'll find some documentation on:
>
> http://svn.osgeo.org/metacrs/proj/trunk/proj/html/gen_parms.html
>
> otherwise use makeEPSG() in rgdal to search the bundled EPSG database, and
> do check the "Grids & Datums" essays on:
>
> http://www.asprs.org/resources/grids/
>
> for further help in tracking down possible +towgs84= parameter values.
>
> Repeating, unless you give a +datum=, it will be assumed to be WGS84, so you
> shouldn't be surprised when you get similar results.
>
> Sorry to disappoint, but surveying and cartography have their own
> traditions, some of which are localised as well.
>
> Hope this helps,
>
> Roger
>
>> This is
>> what I'm doing with the meuse dataset as an example, you can
>> see that the results of the inverse transform to lon,lat WGS84 are
>> identical to
>> those to lon,lat ED50, both starting from UTM50 or from UTMWGS84
>>
>> At the end
>> I include results with GlobalMapper for the first point. Results
>> with GlobalMapper do differ for lon,lat WGS84 and lon,lat ED50
>>
>> Any help would be appreciated, as I'm doing all my work
>> in UTM ED50 but have to pass the coordinates as lon,lat WGS84
>> for the flight.
>>
>> data(meuse)
>> coordinates(meuse) <- c("x", "y")
>> proj4string(meuse) <- CRS("+proj=stere +lat_0=52.15616055555555
>> +lon_0=5.38763888888889 +k=0.999908 +x_0=155000 +y_0=463000 +ellps=bessel
>> +units=m")
>> meuse.utm <- spTransform(meuse, CRS("+proj=utm +zone=32 +ellps=WGS84"))
>> coordinates(meuse.utm)[1:3,]
>> ? ? ? ? ? x ? ? ? y
>> [1,] 272571.9 5653978
>> [2,] 272522.4 5653927
>> [3,] 272661.2 5653899
>>
>> meuse.utmintl <- spTransform(meuse, CRS("+proj=utm +zone=32 +ellps=intl"))
>> coordinates(meuse.utmintl)[1:3,]
>> ? ? ? ? ? x ? ? ? y
>> [1,] 272561.0 5654094
>> [2,] 272511.5 5654043
>> [3,] 272650.3 5654015
>>
>> meuse.lonlatWGS84WGS84 <- spTransform(meuse.utm, CRS("+proj=lonlat
>> +ellps=WGS84"))
>> meuse.lonlatWGS84intl ?<- spTransform(meuse.utm, CRS("+proj=lonlat
>> +ellps=intl"))
>> coordinates(meuse.lonlatWGS84WGS84)[1:3,]
>> ? ? ? ? ? x ? ? ? ?y
>> [1,] 5.759053 50.99238
>> [2,] 5.758380 50.99190
>> [3,] 5.760373 50.99171
>>
>> coordinates(meuse.lonlatWGS84intl)[1:3,]
>> ? ? ? ? ? x ? ? ? ?y
>> [1,] 5.759053 50.99238
>> [2,] 5.758380 50.99190
>> [3,] 5.760373 50.99171
>>
>> meuse.lonlatintlWGS84 <- spTransform(meuse.utmintl, CRS("+proj=lonlat
>> +ellps=WGS84"))
>> meuse.lonlatintlintl ?<- spTransform(meuse.utmintl, CRS("+proj=lonlat
>> +ellps=intl"))
>> coordinates(meuse.lonlatintlWGS84)[1:3,]
>> ? ? ? ? ? x ? ? ? ?y
>> [1,] 5.759053 50.99238
>> [2,] 5.758380 50.99190
>> [3,] 5.760373 50.99171
>>
>> coordinates(meuse.lonlatintlintl)[1:3,]
>> ? ? ? ? ? x ? ? ? ?y
>> [1,] 5.759053 50.99238
>> [2,] 5.758380 50.99190
>> [3,] 5.760373 50.99171
>>
>> Test with Global Mapper
>>
>> UTM ED50 272561.0 5654094 to lon,lat:
>> WGS84 ? 5? 45' 27.5632" E ? ? ? 50? 59' 29.5996" N
>> ED50 ? ?5? 45' 32.5898" E ? ? ? 50? 59' 32.5665" N
>>
>> UTM WGS84 272571.9 5653978 to lon,lat:
>> WGS84 ? 5? 45' 32.5900" E ? ? ? 50? 59' 32.5621" N
>> ED50 ? ?5? 45' 37.6165" E ? ? ? 50? 59' 35.5289" N
>>
>> Also, utmWGS84 to utmED50 is different in GlobalMapper
>>
>> UTM WGS84 ?272571.9 ? ? 5653978
>> UTM ED50 ? 272662.989 ? 5654181.171
>>
>>
>> Thanks,
>>
>> Agus
>>
>
> --
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>



-- 
Dr. Agustin Lobo
Institut de Ciencies de la Terra "Jaume Almera" (CSIC)
Lluis Sole Sabaris s/n
08028 Barcelona
Spain
Tel. 34 934095410
Fax. 34 934110012
e-mail Agustin.Lobo at ija.csic.es
http://www.ija.csic.es/gt/obster


From Roger.Bivand at nhh.no  Fri Jul 10 13:27:50 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 10 Jul 2009 13:27:50 +0200 (CEST)
Subject: [R-sig-Geo] spTransform: wrong results??
In-Reply-To: <alpine.LRH.2.00.0907101024460.12262@reclus.nhh.no>
References: <4A56F918.4040903@gmail.com>
	<alpine.LRH.2.00.0907101024460.12262@reclus.nhh.no>
Message-ID: <alpine.LRH.2.00.0907101212490.12616@reclus.nhh.no>

On Fri, 10 Jul 2009, Roger Bivand wrote:

> On Fri, 10 Jul 2009, Agustin Lobo wrote:
>
>> I'm finding conflicting results at comparing
>> results of converting UTM ED50 coordinates
>> to lon,lat WGS84 using spTransform() (thus, proj4)
>> and other programs such as GlobalMapper and Compegps.
>> 
>> My main surprise is that spTransform() yields the same result
>> whatever the ellps field for the inverse transform.
>
> Wrong tree to bark up, I'm afraid. The tags you need and are missing are 
> +datum= and +towgs84= (from memory, you'll see from the EPSG tags). The 
> +ellps= tag sets the ellipsoid, but doesn't change the default +datum= from 
> WGS84. Note that ED50 is a collection of datum values, and in general EPSG 
> does not give 3 or 7 parameter datum transformation values unless they are 
> known with certainty. On the Proj.4 side, you'll find some documentation on:
>
> http://svn.osgeo.org/metacrs/proj/trunk/proj/html/gen_parms.html
>
> otherwise use makeEPSG() in rgdal to search the bundled EPSG database, and do 
> check the "Grids & Datums" essays on:
>
> http://www.asprs.org/resources/grids/
>
> for further help in tracking down possible +towgs84= parameter values.
>
> Repeating, unless you give a +datum=, it will be assumed to be WGS84, so you 
> shouldn't be surprised when you get similar results.
>
> Sorry to disappoint, but surveying and cartography have their own traditions, 
> some of which are localised as well.

To give this more meat, see below for the development:

>
> Hope this helps,
>
> Roger
>
>> This is
>> what I'm doing with the meuse dataset as an example, you can
>> see that the results of the inverse transform to lon,lat WGS84 are 
>> identical to
>> those to lon,lat ED50, both starting from UTM50 or from UTMWGS84
>> 
>> At the end
>> I include results with GlobalMapper for the first point. Results
>> with GlobalMapper do differ for lon,lat WGS84 and lon,lat ED50
>> 
>> Any help would be appreciated, as I'm doing all my work
>> in UTM ED50 but have to pass the coordinates as lon,lat WGS84
>> for the flight.
>> 
>> data(meuse)
>> coordinates(meuse) <- c("x", "y")
>> proj4string(meuse) <- CRS("+proj=stere +lat_0=52.15616055555555 
>> +lon_0=5.38763888888889 +k=0.999908 +x_0=155000 +y_0=463000 +ellps=bessel 
>> +units=m")
>> meuse.utm <- spTransform(meuse, CRS("+proj=utm +zone=32 +ellps=WGS84"))
>> coordinates(meuse.utm)[1:3,]
>>            x       y
>> [1,] 272571.9 5653978
>> [2,] 272522.4 5653927
>> [3,] 272661.2 5653899

library(rgdal)
data(meuse)
meuse_no_towgs84 <- meuse
meuse_towgs84 <- meuse
coordinates(meuse_no_towgs84) <- c("x", "y")
coordinates(meuse_towgs84) <- c("x", "y")
EPSG <- make_EPSG()
EPSG[grep("28992", EPSG$code),]
proj4string(meuse_no_towgs84) <- CRS("+init=epsg:28992")
proj4string(meuse_towgs84) <- CRS(paste("+init=epsg:28992",
  "+towgs84=565.237,50.0087,465.658,-0.406857,0.350733,-1.87035,4.0812"))
# chunk 36, http://www.asdar-book.org/book/die_mod.R
# see ASDAR p. 96 for authority
# and G&D February 2003, for similar, alternative 7-parameters in right, 
# not left-hand rotation
proj4string(meuse_no_towgs84)
proj4string(meuse_towgs84)
utm_crs_ellps <- CRS("+proj=utm +zone=32 +ellps=WGS84")
utm_crs_datum <- CRS("+proj=utm +zone=32 +datum=WGS84")
coordinates(spTransform(meuse_no_towgs84, utm_crs_ellps))[1:3,]
coordinates(spTransform(meuse_towgs84, utm_crs_ellps))[1:3,]
coordinates(spTransform(meuse_no_towgs84, utm_crs_datum))[1:3,]
coordinates(spTransform(meuse_towgs84, utm_crs_datum))[1:3,]

Only the final version works. As expected, when +towgs84= is not set, no 
datum shift occurs, and the same happens when the target datum is not 
specified. In general +datum= is to be prefered to +ellps=, because the 
datum always fixes the ellipsoid, but the ellipsoid never fixes the datum.

Note that your choice of projection is not correct, there are two:

projs <- projInfo()
projs[grep("stere", projs$name),]

and yours is "stere", not the correct "sterea" for this data. This is why

>> 
>> meuse.utmintl <- spTransform(meuse, CRS("+proj=utm +zone=32 +ellps=intl"))
>> coordinates(meuse.utmintl)[1:3,]
>>            x       y
>> [1,] 272561.0 5654094
>> [2,] 272511.5 5654043
>> [3,] 272650.3 5654015
>> 
>> meuse.lonlatWGS84WGS84 <- spTransform(meuse.utm, CRS("+proj=lonlat 
>> +ellps=WGS84"))
>> meuse.lonlatWGS84intl  <- spTransform(meuse.utm, CRS("+proj=lonlat 
>> +ellps=intl"))

Please always use +proj=longlat, not the abbreviation, as a lot of code 
assumes only longlat and will misinterpret the other.

meuse_utm_towgs84 <- spTransform(meuse_towgs84, utm_crs_datum)
ll_datum <- CRS("+proj=longlat +datum=WGS84")
ll_ellps <- CRS("+proj=longlat +ellps=WGS84")
coordinates(spTransform(meuse_utm_towgs84, ll_datum))[1:3,]
coordinates(spTransform(meuse_utm_towgs84, ll_ellps))[1:3,]

Both are OK, but both were starting from WGS84 as datum. But if we try 
other datum values:

projInfo("datum")[5,]
ll_potsdam_datum <- CRS("+proj=longlat +datum=potsdam")
coordinates(spTransform(meuse_utm_towgs84, ll_potsdam_datum))[1:3,]

we get other coordinate values. This is discussed in ASDAR on pp. 82-87.

>> coordinates(meuse.lonlatWGS84WGS84)[1:3,]
>>            x        y
>> [1,] 5.759053 50.99238
>> [2,] 5.758380 50.99190
>> [3,] 5.760373 50.99171
>> 
>> coordinates(meuse.lonlatWGS84intl)[1:3,]
>>            x        y
>> [1,] 5.759053 50.99238
>> [2,] 5.758380 50.99190
>> [3,] 5.760373 50.99171
>> 
>> meuse.lonlatintlWGS84 <- spTransform(meuse.utmintl, CRS("+proj=lonlat 
>> +ellps=WGS84"))
>> meuse.lonlatintlintl  <- spTransform(meuse.utmintl, CRS("+proj=lonlat 
>> +ellps=intl"))
>> coordinates(meuse.lonlatintlWGS84)[1:3,]
>>            x        y
>> [1,] 5.759053 50.99238
>> [2,] 5.758380 50.99190
>> [3,] 5.760373 50.99171
>> 
>> coordinates(meuse.lonlatintlintl)[1:3,]
>>            x        y
>> [1,] 5.759053 50.99238
>> [2,] 5.758380 50.99190
>> [3,] 5.760373 50.99171
>> 
>> Test with Global Mapper
>> 
>> UTM ED50 272561.0 5654094 to lon,lat:
>> WGS84   5? 45' 27.5632" E	50? 59' 29.5996" N
>> ED50    5? 45' 32.5898" E	50? 59' 32.5665" N
>> 
>> UTM WGS84 272571.9 5653978 to lon,lat:
>> WGS84   5? 45' 32.5900" E	50? 59' 32.5621" N
>> ED50    5? 45' 37.6165" E	50? 59' 35.5289" N
>> 
>> Also, utmWGS84 to utmED50 is different in GlobalMapper
>> 
>> UTM WGS84  272571.9     5653978
>> UTM ED50   272662.989	5654181.171

Since the data you are giving to GlobalMapper (I don't have it) are 
arbitrary, I cannot reproduce this. I said earlier that ED50 is not a 
standard, so it may well be that you are using one of the Spanish ED50 
datum values (or rather some +towgs84 parameter values), rather than the 
ED50 values for the Netherlands (which are given with an interval in G&D). 
ED50 is typically very arbitrary, and conversions to WGS84 may depend on 
local and unpublished decisions taken in mapping agencies, not 
infrequently military mapping agencies. This is what is described in G&D 
by Cliff Mugnier in his excellent forensic archeology. Reading the 
November 2006 G&D on Denmark is like a detective story, and most countries 
have well-kept secrets!

The actual WGS84 geographical coordinates for the first three points in 
meuse in dd:mm:ss are:

res <- spTransform(meuse_towgs84, ll_datum)
x <- as(dd2dms(coordinates(res)[1:3, 1]), "character")
y <- as(dd2dms(coordinates(res)[1:3, 2], TRUE), "character")
cbind(x, y)

Try:

res$long <- coordinates(res)[, 1]
res$lat <- coordinates(res)[, 2]

writeOGR(res, "meuse.kml", "meuse", driver="KML")

and check in GE (assuming that their coordinates are OK).

Hope this helps,

Roger

>> 
>> 
>> Thanks,
>> 
>> Agus
>> 
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From Roger.Bivand at nhh.no  Fri Jul 10 13:40:34 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 10 Jul 2009 13:40:34 +0200 (CEST)
Subject: [R-sig-Geo] spTransform: wrong results??
In-Reply-To: <27de757d0907100318s7f7100b1x72d44555e9b52430@mail.gmail.com>
References: <4A56F918.4040903@gmail.com>
	<alpine.LRH.2.00.0907101024460.12262@reclus.nhh.no>
	<27de757d0907100318s7f7100b1x72d44555e9b52430@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.0907101334070.12616@reclus.nhh.no>

On Fri, 10 Jul 2009, Agustin Lobo wrote:

> But if I use:
> meuse.lonlatintlWGS84  <- spTransform(meuse.utm, CRS("+proj=lonlat
> +datum=WGS84"))
>
> get the same result. Also, don't know where I should put the towgs84=
> field, have searched the R doc for
> towgs and do not find anything. I've looked in the doc you mention,
> and towgs84= must include a set of
> parameters that cannot find. The doc states
> "For instance, the following demonstrates converting from the Greek GGRS87
> datum to WGS84.<p>
>
> <pre>
> % cs2cs +proj=latlong +ellps=GRS80 +towgs84=-199.87,74.79,246.62 \
>    +to +proj=latlong +datum=WGS84
> "
> but where can I find those 3 parameters for my case? Also, why is not
> spTransform() taking care
> of that? The spTransform() doc does not mention that towgs84 is
> required, actually there are several
> examples using the meuse dataset and trasforming to different datums:
>
> proj4string(meuse) <- CRS("+proj=stere +lat_0=52.15616055555555
> +lon_0=5.38763888888889 +k=0.999908 +x_0=155000 +y_0=463000
> +ellps=bessel +units=m")
> meuse.utm <- spTransform(meuse, CRS("+proj=utm +zone=32 +ellps=WGS84"))
>
> and the towgs84 is not there. Does this mean that coordinates in
> meuse.utm remain in ellpsoid Bessel instead of WGS84
> as specified in spTransform() ?
>
> On the other hand, I've made:
> EPSG <- make_EPSG()
> and found
> SG[27,3]
> [1] "+proj=longlat +ellps=WGS84 +no_defs"
>> EPSG[2446,]
>      code                  note
> 2446 23031 # ED50 / UTM zone 31N
>                                                 prj4
> 2446 +proj=utm +zone=31 +ellps=intl +units=m +no_defs
> and
>> EPSG[27,3]
> [1] "+proj=longlat +ellps=WGS84 +no_defs"
>
> no +datum field.
>
> This is so confusing...

Nobody can sort it out for anyone. EPSG don't give +towgs84 unless the 
authority is unquestioned. Until we had satellites, most surveying was 
done to local or national datum values, and ED50 pre-dates satellites. 
WGS84 is the first authoritative world geodetic system, hence its name, 
and is the same one that GPS satellites use. Because cartography is much 
older, and often military (secret), the conversion parameters are not well 
established or tabulated.

The way of doing things at the moment is to try to find an unequivocal 
authority (Grids & Datums is as good as they come), and use that to 
supplement EPSG - oil companies need to know where their oilfields and 
wells are. Once you think you are there, match with GPS or GE in 
geographical coordinates.

Roger

>
> Agus
>
> 2009/7/10 Roger Bivand <Roger.Bivand at nhh.no>:
>> On Fri, 10 Jul 2009, Agustin Lobo wrote:
>>
>>> I'm finding conflicting results at comparing
>>> results of converting UTM ED50 coordinates
>>> to lon,lat WGS84 using spTransform() (thus, proj4)
>>> and other programs such as GlobalMapper and Compegps.
>>>
>>> My main surprise is that spTransform() yields the same result
>>> whatever the ellps field for the inverse transform.
>>
>> Wrong tree to bark up, I'm afraid. The tags you need and are missing are
>> +datum= and +towgs84= (from memory, you'll see from the EPSG tags). The
>> +ellps= tag sets the ellipsoid, but doesn't change the default +datum= from
>> WGS84. Note that ED50 is a collection of datum values, and in general EPSG
>> does not give 3 or 7 parameter datum transformation values unless they are
>> known with certainty. On the Proj.4 side, you'll find some documentation on:
>>
>> http://svn.osgeo.org/metacrs/proj/trunk/proj/html/gen_parms.html
>>
>> otherwise use makeEPSG() in rgdal to search the bundled EPSG database, and
>> do check the "Grids & Datums" essays on:
>>
>> http://www.asprs.org/resources/grids/
>>
>> for further help in tracking down possible +towgs84= parameter values.
>>
>> Repeating, unless you give a +datum=, it will be assumed to be WGS84, so you
>> shouldn't be surprised when you get similar results.
>>
>> Sorry to disappoint, but surveying and cartography have their own
>> traditions, some of which are localised as well.
>>
>> Hope this helps,
>>
>> Roger
>>
>>> This is
>>> what I'm doing with the meuse dataset as an example, you can
>>> see that the results of the inverse transform to lon,lat WGS84 are
>>> identical to
>>> those to lon,lat ED50, both starting from UTM50 or from UTMWGS84
>>>
>>> At the end
>>> I include results with GlobalMapper for the first point. Results
>>> with GlobalMapper do differ for lon,lat WGS84 and lon,lat ED50
>>>
>>> Any help would be appreciated, as I'm doing all my work
>>> in UTM ED50 but have to pass the coordinates as lon,lat WGS84
>>> for the flight.
>>>
>>> data(meuse)
>>> coordinates(meuse) <- c("x", "y")
>>> proj4string(meuse) <- CRS("+proj=stere +lat_0=52.15616055555555
>>> +lon_0=5.38763888888889 +k=0.999908 +x_0=155000 +y_0=463000 +ellps=bessel
>>> +units=m")
>>> meuse.utm <- spTransform(meuse, CRS("+proj=utm +zone=32 +ellps=WGS84"))
>>> coordinates(meuse.utm)[1:3,]
>>> ? ? ? ? ? x ? ? ? y
>>> [1,] 272571.9 5653978
>>> [2,] 272522.4 5653927
>>> [3,] 272661.2 5653899
>>>
>>> meuse.utmintl <- spTransform(meuse, CRS("+proj=utm +zone=32 +ellps=intl"))
>>> coordinates(meuse.utmintl)[1:3,]
>>> ? ? ? ? ? x ? ? ? y
>>> [1,] 272561.0 5654094
>>> [2,] 272511.5 5654043
>>> [3,] 272650.3 5654015
>>>
>>> meuse.lonlatWGS84WGS84 <- spTransform(meuse.utm, CRS("+proj=lonlat
>>> +ellps=WGS84"))
>>> meuse.lonlatWGS84intl ?<- spTransform(meuse.utm, CRS("+proj=lonlat
>>> +ellps=intl"))
>>> coordinates(meuse.lonlatWGS84WGS84)[1:3,]
>>> ? ? ? ? ? x ? ? ? ?y
>>> [1,] 5.759053 50.99238
>>> [2,] 5.758380 50.99190
>>> [3,] 5.760373 50.99171
>>>
>>> coordinates(meuse.lonlatWGS84intl)[1:3,]
>>> ? ? ? ? ? x ? ? ? ?y
>>> [1,] 5.759053 50.99238
>>> [2,] 5.758380 50.99190
>>> [3,] 5.760373 50.99171
>>>
>>> meuse.lonlatintlWGS84 <- spTransform(meuse.utmintl, CRS("+proj=lonlat
>>> +ellps=WGS84"))
>>> meuse.lonlatintlintl ?<- spTransform(meuse.utmintl, CRS("+proj=lonlat
>>> +ellps=intl"))
>>> coordinates(meuse.lonlatintlWGS84)[1:3,]
>>> ? ? ? ? ? x ? ? ? ?y
>>> [1,] 5.759053 50.99238
>>> [2,] 5.758380 50.99190
>>> [3,] 5.760373 50.99171
>>>
>>> coordinates(meuse.lonlatintlintl)[1:3,]
>>> ? ? ? ? ? x ? ? ? ?y
>>> [1,] 5.759053 50.99238
>>> [2,] 5.758380 50.99190
>>> [3,] 5.760373 50.99171
>>>
>>> Test with Global Mapper
>>>
>>> UTM ED50 272561.0 5654094 to lon,lat:
>>> WGS84 ? 5? 45' 27.5632" E ? ? ? 50? 59' 29.5996" N
>>> ED50 ? ?5? 45' 32.5898" E ? ? ? 50? 59' 32.5665" N
>>>
>>> UTM WGS84 272571.9 5653978 to lon,lat:
>>> WGS84 ? 5? 45' 32.5900" E ? ? ? 50? 59' 32.5621" N
>>> ED50 ? ?5? 45' 37.6165" E ? ? ? 50? 59' 35.5289" N
>>>
>>> Also, utmWGS84 to utmED50 is different in GlobalMapper
>>>
>>> UTM WGS84 ?272571.9 ? ? 5653978
>>> UTM ED50 ? 272662.989 ? 5654181.171
>>>
>>>
>>> Thanks,
>>>
>>> Agus
>>>
>>
>> --
>> Roger Bivand
>> Economic Geography Section, Department of Economics, Norwegian School of
>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>> e-mail: Roger.Bivand at nhh.no
>>
>
>
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From Thomas.Adams at noaa.gov  Fri Jul 10 15:11:35 2009
From: Thomas.Adams at noaa.gov (Thomas Adams)
Date: Fri, 10 Jul 2009 09:11:35 -0400
Subject: [R-sig-Geo] Slope and Aspect calculations in R
In-Reply-To: <4A5656C8.8040501@noaa.gov>
References: <4A5626EA.4080306@noaa.gov> <4A5656C8.8040501@noaa.gov>
Message-ID: <4A573E07.5080609@noaa.gov>

Josh,

I use R & GRASS together on both MacOS X and Linux without problems. 
It's very direct to write a shell script that calls both R & GRASS 
within a single script. Writing a R script that calls GRASS may be more 
tedious to do what you want. Writing a shell script that calls both may 
be the wat to go.

Tom

Josh London wrote:
> Thanks for the suggestions so far regarding the use of GRASS or SAGA.
>
> We have considered those options but SAGA doesn't appear available for 
> MacOS. My understanding is that spgrass6 is more for accessing R 
> code/functions from within GRASS vs accessing GRASS functions from 
> within R. We have all our other analysis coded up in R, and just need 
> these functions to do one part of a bigger process. Maybe I'm 
> misunderstanding how to use R and GRASS together. I'll do some further 
> research.
>
> Thanks again
> Josh
>
> Josh London wrote:
>> Hello
>>
>> We are looking to mimic, in R, the slope (max magnitude difference 
>> between a cell and its neighbors) and aspect (direction of maximum 
>> magnitude difference) functions found in ESRI's Spatial Analyst 
>> package. We were just about to code up the slope function but thought 
>> I would make sure we weren't re-inventing any wheels already out there.
>>
>> Thanks
>> Josh
>>
>


-- 
Thomas E Adams
National Weather Service
Ohio River Forecast Center
1901 South State Route 134
Wilmington, OH 45177

EMAIL:	thomas.adams at noaa.gov

VOICE:	937-383-0528
FAX:	937-383-0033


From alobolistas at gmail.com  Fri Jul 10 15:17:11 2009
From: alobolistas at gmail.com (Agustin Lobo)
Date: Fri, 10 Jul 2009 15:17:11 +0200
Subject: [R-sig-Geo] Fwd:  spTransform: wrong results??
In-Reply-To: <27de757d0907100605o12bb6611g5babd8a570e1f786@mail.gmail.com>
References: <4A56F918.4040903@gmail.com>
	<alpine.LRH.2.00.0907101024460.12262@reclus.nhh.no>
	<alpine.LRH.2.00.0907101212490.12616@reclus.nhh.no>
	<27de757d0907100605o12bb6611g5babd8a570e1f786@mail.gmail.com>
Message-ID: <27de757d0907100617r3db5198en32872d3ec97f360@mail.gmail.com>

Roger,

This part of your message:
"As expected, when +towgs84= is not set, no datum shift occurs, and
the same happens when the target datum is not specified. In general
+datum= is to be prefered to +ellps=, because the datum always fixes
the ellipsoid, but the ellipsoid never fixes the datum."

is critical, could not be included in the spTransform() help page?
Actually a whole paragraph regarding changes of datum
would be very helpful, including the example.

Also, I understand that I must search the magic towgs84 parameters in
the "Grids & Datums" essays
?http://www.asprs.org/resources/grids/

I'll try and let you know. For the future, no way to compile the
towgs84 parameter so that could be automatically used
by spTransform? This must be what programs like GlobalMapper do, as
you just define input and output datum.

Thanks for your help!

Agus

2009/7/10 Roger Bivand <Roger.Bivand at nhh.no>:

> To give this more meat, see below for the development:
>
>
> library(rgdal)
> data(meuse)
> meuse_no_towgs84 <- meuse
> meuse_towgs84 <- meuse
> coordinates(meuse_no_towgs84) <- c("x", "y")
> coordinates(meuse_towgs84) <- c("x", "y")
> EPSG <- make_EPSG()
> EPSG[grep("28992", EPSG$code),]
> proj4string(meuse_no_towgs84) <- CRS("+init=epsg:28992")
> proj4string(meuse_towgs84) <- CRS(paste("+init=epsg:28992",
> ?"+towgs84=565.237,50.0087,465.658,-0.406857,0.350733,-1.87035,4.0812"))
> # chunk 36, http://www.asdar-book.org/book/die_mod.R
> # see ASDAR p. 96 for authority
> # and G&D February 2003, for similar, alternative 7-parameters in right, #
> not left-hand rotation
> proj4string(meuse_no_towgs84)
> proj4string(meuse_towgs84)
> utm_crs_ellps <- CRS("+proj=utm +zone=32 +ellps=WGS84")
> utm_crs_datum <- CRS("+proj=utm +zone=32 +datum=WGS84")
> coordinates(spTransform(meuse_no_towgs84, utm_crs_ellps))[1:3,]
> coordinates(spTransform(meuse_towgs84, utm_crs_ellps))[1:3,]
> coordinates(spTransform(meuse_no_towgs84, utm_crs_datum))[1:3,]
> coordinates(spTransform(meuse_towgs84, utm_crs_datum))[1:3,]
>
> Only the final version works. As expected, when +towgs84= is not set, no
> datum shift occurs, and the same happens when the target datum is not
> specified. In general +datum= is to be prefered to +ellps=, because the
> datum always fixes the ellipsoid, but the ellipsoid never fixes the datum.
>
> Note that your choice of projection is not correct, there are two:
>
> projs <- projInfo()
> projs[grep("stere", projs$name),]
>
> and yours is "stere", not the correct "sterea" for this data. This is why
>
>
> Please always use +proj=longlat, not the abbreviation, as a lot of code
> assumes only longlat and will misinterpret the other.
>
> meuse_utm_towgs84 <- spTransform(meuse_towgs84, utm_crs_datum)
> ll_datum <- CRS("+proj=longlat +datum=WGS84")
> ll_ellps <- CRS("+proj=longlat +ellps=WGS84")
> coordinates(spTransform(meuse_utm_towgs84, ll_datum))[1:3,]
> coordinates(spTransform(meuse_utm_towgs84, ll_ellps))[1:3,]
>
> Both are OK, but both were starting from WGS84 as datum. But if we try other
> datum values:
>
> projInfo("datum")[5,]
> ll_potsdam_datum <- CRS("+proj=longlat +datum=potsdam")
> coordinates(spTransform(meuse_utm_towgs84, ll_potsdam_datum))[1:3,]
>
> we get other coordinate values. This is discussed in ASDAR on pp. 82-87.
>
>
> Since the data you are giving to GlobalMapper (I don't have it) are
> arbitrary, I cannot reproduce this. I said earlier that ED50 is not a
> standard, so it may well be that you are using one of the Spanish ED50 datum
> values (or rather some +towgs84 parameter values), rather than the ED50
> values for the Netherlands (which are given with an interval in G&D). ED50
> is typically very arbitrary, and conversions to WGS84 may depend on local
> and unpublished decisions taken in mapping agencies, not infrequently
> military mapping agencies. This is what is described in G&D by Cliff Mugnier
> in his excellent forensic archeology. Reading the November 2006 G&D on
> Denmark is like a detective story, and most countries have well-kept
> secrets!
>
> The actual WGS84 geographical coordinates for the first three points in
> meuse in dd:mm:ss are:
>
> res <- spTransform(meuse_towgs84, ll_datum)
> x <- as(dd2dms(coordinates(res)[1:3, 1]), "character")
> y <- as(dd2dms(coordinates(res)[1:3, 2], TRUE), "character")
> cbind(x, y)
>
> Try:
>
> res$long <- coordinates(res)[, 1]
> res$lat <- coordinates(res)[, 2]
>
> writeOGR(res, "meuse.kml", "meuse", driver="KML")
>
> and check in GE (assuming that their coordinates are OK).
>
> Hope this helps,
>
> Roger
>
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>


--
Dr. Agustin Lobo
Institut de Ciencies de la Terra "Jaume Almera" (CSIC)
Lluis Sole Sabaris s/n
08028 Barcelona
Spain
Tel. 34 934095410
Fax. 34 934110012
e-mail Agustin.Lobo at ija.csic.es
http://www.ija.csic.es/gt/obster



-- 
Dr. Agustin Lobo
Institut de Ciencies de la Terra "Jaume Almera" (CSIC)
Lluis Sole Sabaris s/n
08028 Barcelona
Spain
Tel. 34 934095410
Fax. 34 934110012
e-mail Agustin.Lobo at ija.csic.es
http://www.ija.csic.es/gt/obster


From Roger.Bivand at nhh.no  Fri Jul 10 15:27:30 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 10 Jul 2009 15:27:30 +0200 (CEST)
Subject: [R-sig-Geo] spTransform: wrong results??
In-Reply-To: <27de757d0907100605o12bb6611g5babd8a570e1f786@mail.gmail.com>
References: <4A56F918.4040903@gmail.com>
	<alpine.LRH.2.00.0907101024460.12262@reclus.nhh.no>
	<alpine.LRH.2.00.0907101212490.12616@reclus.nhh.no>
	<27de757d0907100605o12bb6611g5babd8a570e1f786@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.0907101513180.3914@reclus.nhh.no>

On Fri, 10 Jul 2009, Agustin Lobo wrote:

> Roger,
>
> This part of your message:
> "As expected, when +towgs84= is not set, no datum shift occurs, and
> the same happens when the target datum is not specified. In general
> +datum= is to be prefered to +ellps=, because the datum always fixes
> the ellipsoid, but the ellipsoid never fixes the datum."
>
> is critical, could not be included in the spTransform() help page?
> Actually a whole paragraph regarding changes of datum
> would be very helpful, including the example.

I'll try to do as you ask and add details and links. The definitions of 
the CRS class also could refer to this. In addition, the website at

http://spatialreference.org/

also provides som information based on EPSG.

>
> Also, I understand that I must search the magic towgs84 parameters in
> the "Grids & Datums" essays
> http://www.asprs.org/resources/grids/
>
> I'll try and let you know. For the future, no way to compile the
> towgs84 parameter so that could be automatically used
> by spTransform? This must be what programs like GlobalMapper do, as
> you just define input and output datum.

No way. Choosing the 3 or 7 parameter datum transforms has to be the 
responsibility of the user when there is no unequivocal authority. Having 
a known ground control point (a GPS reading from a known point that has a 
known CRS) can be used to see which CRS settings let you reproduce it. But 
with legacy maps, this isn't so easy. GlobalMapper must I suppose be 
making choices and using authorities that it acknowledges, but reading G&D 
does not make me optimistic.

Roger

>
> Thanks for your help!
>
> Agus
>
> 2009/7/10 Roger Bivand <Roger.Bivand at nhh.no>:
>
>> To give this more meat, see below for the development:
>>
>>
>> library(rgdal)
>> data(meuse)
>> meuse_no_towgs84 <- meuse
>> meuse_towgs84 <- meuse
>> coordinates(meuse_no_towgs84) <- c("x", "y")
>> coordinates(meuse_towgs84) <- c("x", "y")
>> EPSG <- make_EPSG()
>> EPSG[grep("28992", EPSG$code),]
>> proj4string(meuse_no_towgs84) <- CRS("+init=epsg:28992")
>> proj4string(meuse_towgs84) <- CRS(paste("+init=epsg:28992",
>> ?"+towgs84=565.237,50.0087,465.658,-0.406857,0.350733,-1.87035,4.0812"))
>> # chunk 36, http://www.asdar-book.org/book/die_mod.R
>> # see ASDAR p. 96 for authority
>> # and G&D February 2003, for similar, alternative 7-parameters in right, #
>> not left-hand rotation
>> proj4string(meuse_no_towgs84)
>> proj4string(meuse_towgs84)
>> utm_crs_ellps <- CRS("+proj=utm +zone=32 +ellps=WGS84")
>> utm_crs_datum <- CRS("+proj=utm +zone=32 +datum=WGS84")
>> coordinates(spTransform(meuse_no_towgs84, utm_crs_ellps))[1:3,]
>> coordinates(spTransform(meuse_towgs84, utm_crs_ellps))[1:3,]
>> coordinates(spTransform(meuse_no_towgs84, utm_crs_datum))[1:3,]
>> coordinates(spTransform(meuse_towgs84, utm_crs_datum))[1:3,]
>>
>> Only the final version works. As expected, when +towgs84= is not set, no
>> datum shift occurs, and the same happens when the target datum is not
>> specified. In general +datum= is to be prefered to +ellps=, because the
>> datum always fixes the ellipsoid, but the ellipsoid never fixes the datum.
>>
>> Note that your choice of projection is not correct, there are two:
>>
>> projs <- projInfo()
>> projs[grep("stere", projs$name),]
>>
>> and yours is "stere", not the correct "sterea" for this data. This is why
>>
>>
>> Please always use +proj=longlat, not the abbreviation, as a lot of code
>> assumes only longlat and will misinterpret the other.
>>
>> meuse_utm_towgs84 <- spTransform(meuse_towgs84, utm_crs_datum)
>> ll_datum <- CRS("+proj=longlat +datum=WGS84")
>> ll_ellps <- CRS("+proj=longlat +ellps=WGS84")
>> coordinates(spTransform(meuse_utm_towgs84, ll_datum))[1:3,]
>> coordinates(spTransform(meuse_utm_towgs84, ll_ellps))[1:3,]
>>
>> Both are OK, but both were starting from WGS84 as datum. But if we try other
>> datum values:
>>
>> projInfo("datum")[5,]
>> ll_potsdam_datum <- CRS("+proj=longlat +datum=potsdam")
>> coordinates(spTransform(meuse_utm_towgs84, ll_potsdam_datum))[1:3,]
>>
>> we get other coordinate values. This is discussed in ASDAR on pp. 82-87.
>>
>>
>> Since the data you are giving to GlobalMapper (I don't have it) are
>> arbitrary, I cannot reproduce this. I said earlier that ED50 is not a
>> standard, so it may well be that you are using one of the Spanish ED50 datum
>> values (or rather some +towgs84 parameter values), rather than the ED50
>> values for the Netherlands (which are given with an interval in G&D). ED50
>> is typically very arbitrary, and conversions to WGS84 may depend on local
>> and unpublished decisions taken in mapping agencies, not infrequently
>> military mapping agencies. This is what is described in G&D by Cliff Mugnier
>> in his excellent forensic archeology. Reading the November 2006 G&D on
>> Denmark is like a detective story, and most countries have well-kept
>> secrets!
>>
>> The actual WGS84 geographical coordinates for the first three points in
>> meuse in dd:mm:ss are:
>>
>> res <- spTransform(meuse_towgs84, ll_datum)
>> x <- as(dd2dms(coordinates(res)[1:3, 1]), "character")
>> y <- as(dd2dms(coordinates(res)[1:3, 2], TRUE), "character")
>> cbind(x, y)
>>
>> Try:
>>
>> res$long <- coordinates(res)[, 1]
>> res$lat <- coordinates(res)[, 2]
>>
>> writeOGR(res, "meuse.kml", "meuse", driver="KML")
>>
>> and check in GE (assuming that their coordinates are OK).
>>
>> Hope this helps,
>>
>> Roger
>>
>> Roger Bivand
>> Economic Geography Section, Department of Economics, Norwegian School of
>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>> e-mail: Roger.Bivand at nhh.no
>>
>
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From alobolistas at gmail.com  Fri Jul 10 15:37:17 2009
From: alobolistas at gmail.com (Agustin Lobo)
Date: Fri, 10 Jul 2009 15:37:17 +0200
Subject: [R-sig-Geo] spTransform: wrong results??
In-Reply-To: <alpine.LRH.2.00.0907101513180.3914@reclus.nhh.no>
References: <4A56F918.4040903@gmail.com>
	<alpine.LRH.2.00.0907101024460.12262@reclus.nhh.no>
	<alpine.LRH.2.00.0907101212490.12616@reclus.nhh.no>
	<27de757d0907100605o12bb6611g5babd8a570e1f786@mail.gmail.com>
	<alpine.LRH.2.00.0907101513180.3914@reclus.nhh.no>
Message-ID: <27de757d0907100637mdfbe2e7u26eea41b42711e2f@mail.gmail.com>

Regarding the towgs84 parameters, I've found
http://www.mail-archive.com/gdal-dev at lists.osgeo.org/msg02921.html
and from there
http://earth-info.nga.mil/GandG/coordsys/onlinedatum/CountryEuropeTable.html

I'll test these values for my ED50, compare to GlobalMapper results
and let the list know.

Where you say:

2009/7/10 Roger Bivand <Roger.Bivand at nhh.no>:
> On Fri, 10 Jul 2009, Agustin Lobo wrote:
>
>> I'll try and let you know. For the future, no way to compile the
>> towgs84 parameter so that could be automatically used
>> by spTransform? This must be what programs like GlobalMapper do, as
>> you just define input and output datum.
>
> No way. Choosing the 3 or 7 parameter datum transforms has to be the
> responsibility of the user when there is no unequivocal authority. Having a
> known ground control point (a GPS reading from a known point that has a
> known CRS) can be used to see which CRS settings let you reproduce it. But
> with legacy maps, this isn't so easy. GlobalMapper must I suppose be making
> choices and using authorities that it acknowledges, but reading G&D does not
> make me optimistic.

I disagree, you could just use a default table of values letting the
user enter his/her own
in case he/she considers that those of the table are not appropriate
(or do not exist). That's
why default values exist in R.  Let me know if can help.

Agus

Dr. Agustin Lobo
Institut de Ciencies de la Terra "Jaume Almera" (CSIC)
Lluis Sole Sabaris s/n
08028 Barcelona
Spain
Tel. 34 934095410
Fax. 34 934110012
e-mail Agustin.Lobo at ija.csic.es
http://www.ija.csic.es/gt/obster


From a.ghisla at gmail.com  Fri Jul 10 16:06:55 2009
From: a.ghisla at gmail.com (Anne Ghisla)
Date: Fri, 10 Jul 2009 16:06:55 +0200
Subject: [R-sig-Geo] [Report #7 - midterm] Kriging with GRASS and R:
 v.autokrige port to wxPython and more
Message-ID: <1247234815.4282.21.camel@galadriel.uagra.net>

Hello all, and sorry for cross-posting,

this week has been full of improvements:
- CLI with optional arguments is up and running
- interface creation is no more delayed by vector map filtering
- dependencies are checked all at the beginning - no risk of mid-process
crashes if something is missing
- automap page merged with gstat: they share the same algorithms
- geoR page hidden, no implementation yet
- deep refactoring of the rpy code, moved into a separate controller
class
- interface fills up all options except input data map - minimum
interaction required (2 clicks)

next week I plan to implement the splashscreen and add further
functionalities, hopefully different kriging techniques.

Blocking issues - none.

best regards,

Anne

More info on the wiki page - updated daily:
http://grass.osgeo.org/wiki/V.krige_GSoC_2009

-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 197 bytes
Desc: Questa ? una parte del messaggio	firmata digitalmente
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090710/90222b94/attachment.bin>

From hengl at spatial-analyst.net  Fri Jul 10 16:06:30 2009
From: hengl at spatial-analyst.net (Tomislav Hengl)
Date: Fri, 10 Jul 2009 16:06:30 +0200
Subject: [R-sig-Geo] Slope and Aspect calculations in R
In-Reply-To: <4A573E07.5080609@noaa.gov>
References: <4A5626EA.4080306@noaa.gov> <4A5656C8.8040501@noaa.gov>
	<4A573E07.5080609@noaa.gov>
Message-ID: <22A2AD660CDA4959A441DAF79A3B8D27@pcibed193>


Dear Josh, Thomas,

I typically use R+SAGA (R on top!) for such type of analysis (and I do have access to all operating
system/software). There must be some good reasons that I am using SAGA (speed, stability, rich
geomorphometry module etc.)! So do not give up so easy on SAGA.

I especially like that SAGA is fairly efficient in processing big grids, and the commands are rather
compact. For example to reproject grids from one to another proj4string, you only need to set e.g.:

> rsaga.geoprocessor(lib="pj_proj4", 2, param=list(SOURCE_PROJ=paste('"', proj4string(dem25m), '"',
sep=""), TARGET_PROJ="\"+proj=longlat +datum=WGS84\"", SOURCE="TWI.sgrd", TARGET="TWI_ll.sgrd",
TARGET_TYPE=0, INTERPOLATION=0))

*see http://www.geomorphometry.org/R.asp 

I remember that somebody did manage to set-up SAGA also under Mac OS
(http://www.saga-gis.uni-goettingen.de/html/index.php?module=pnForum&func=viewtopic&topic=458), but
I also remember that most of students on our GEOSTAT course used Windows under Mac OS to run SAGA. I
am sure that it should be possible to compile SAGA under Mac OS, but somebody needs to put some
effort to bridge this gap (check also with Olaf Conrad).

Here is more discussion about the same topic from few months ago:
https://stat.ethz.ch/pipermail/r-sig-geo/2009-April/005418.html 

cheers,

Tom Hengl


> -----Original Message-----
> From: r-sig-geo-bounces at stat.math.ethz.ch [mailto:r-sig-geo-bounces at stat.math.ethz.ch] On Behalf
> Of Thomas Adams
> Sent: Friday, July 10, 2009 3:12 PM
> To: Josh London
> Cc: r-sig-geo at stat.math.ethz.ch
> Subject: Re: [R-sig-Geo] Slope and Aspect calculations in R
> 
> Josh,
> 
> I use R & GRASS together on both MacOS X and Linux without problems.
> It's very direct to write a shell script that calls both R & GRASS
> within a single script. Writing a R script that calls GRASS may be more
> tedious to do what you want. Writing a shell script that calls both may
> be the wat to go.
> 
> Tom
> 
> Josh London wrote:
> > Thanks for the suggestions so far regarding the use of GRASS or SAGA.
> >
> > We have considered those options but SAGA doesn't appear available for
> > MacOS. My understanding is that spgrass6 is more for accessing R
> > code/functions from within GRASS vs accessing GRASS functions from
> > within R. We have all our other analysis coded up in R, and just need
> > these functions to do one part of a bigger process. Maybe I'm
> > misunderstanding how to use R and GRASS together. I'll do some further
> > research.
> >
> > Thanks again
> > Josh
> >
> > Josh London wrote:
> >> Hello
> >>
> >> We are looking to mimic, in R, the slope (max magnitude difference
> >> between a cell and its neighbors) and aspect (direction of maximum
> >> magnitude difference) functions found in ESRI's Spatial Analyst
> >> package. We were just about to code up the slope function but thought
> >> I would make sure we weren't re-inventing any wheels already out there.
> >>
> >> Thanks
> >> Josh
> >>
> >
> 
> 
> --
> Thomas E Adams
> National Weather Service
> Ohio River Forecast Center
> 1901 South State Route 134
> Wilmington, OH 45177
> 
> EMAIL:	thomas.adams at noaa.gov
> 
> VOICE:	937-383-0528
> FAX:	937-383-0033
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From Thomas.Adams at noaa.gov  Fri Jul 10 16:19:31 2009
From: Thomas.Adams at noaa.gov (Thomas Adams)
Date: Fri, 10 Jul 2009 10:19:31 -0400
Subject: [R-sig-Geo] Slope and Aspect calculations in R
In-Reply-To: <22A2AD660CDA4959A441DAF79A3B8D27@pcibed193>
References: <4A5626EA.4080306@noaa.gov> <4A5656C8.8040501@noaa.gov>
	<4A573E07.5080609@noaa.gov>
	<22A2AD660CDA4959A441DAF79A3B8D27@pcibed193>
Message-ID: <4A574DF3.5020401@noaa.gov>

Tom,

Thanks! I have seen your posts and results of some of your work with 
SAGA and I am very interested. But, I have been to lazy to this point to 
try compiling SAGA for either MacOS X or Linux (is a Linux distribution 
available?).

Regards,
Tom

Tomislav Hengl wrote:
> Dear Josh, Thomas,
>
> I typically use R+SAGA (R on top!) for such type of analysis (and I do have access to all operating
> system/software). There must be some good reasons that I am using SAGA (speed, stability, rich
> geomorphometry module etc.)! So do not give up so easy on SAGA.
>
> I especially like that SAGA is fairly efficient in processing big grids, and the commands are rather
> compact. For example to reproject grids from one to another proj4string, you only need to set e.g.:
>
>   
>> rsaga.geoprocessor(lib="pj_proj4", 2, param=list(SOURCE_PROJ=paste('"', proj4string(dem25m), '"',
>>     
> sep=""), TARGET_PROJ="\"+proj=longlat +datum=WGS84\"", SOURCE="TWI.sgrd", TARGET="TWI_ll.sgrd",
> TARGET_TYPE=0, INTERPOLATION=0))
>
> *see http://www.geomorphometry.org/R.asp 
>
> I remember that somebody did manage to set-up SAGA also under Mac OS
> (http://www.saga-gis.uni-goettingen.de/html/index.php?module=pnForum&func=viewtopic&topic=458), but
> I also remember that most of students on our GEOSTAT course used Windows under Mac OS to run SAGA. I
> am sure that it should be possible to compile SAGA under Mac OS, but somebody needs to put some
> effort to bridge this gap (check also with Olaf Conrad).
>
> Here is more discussion about the same topic from few months ago:
> https://stat.ethz.ch/pipermail/r-sig-geo/2009-April/005418.html 
>
> cheers,
>
> Tom Hengl
>
>
>   
>> -----Original Message-----
>> From: r-sig-geo-bounces at stat.math.ethz.ch [mailto:r-sig-geo-bounces at stat.math.ethz.ch] On Behalf
>> Of Thomas Adams
>> Sent: Friday, July 10, 2009 3:12 PM
>> To: Josh London
>> Cc: r-sig-geo at stat.math.ethz.ch
>> Subject: Re: [R-sig-Geo] Slope and Aspect calculations in R
>>
>> Josh,
>>
>> I use R & GRASS together on both MacOS X and Linux without problems.
>> It's very direct to write a shell script that calls both R & GRASS
>> within a single script. Writing a R script that calls GRASS may be more
>> tedious to do what you want. Writing a shell script that calls both may
>> be the wat to go.
>>
>> Tom
>>
>> Josh London wrote:
>>     
>>> Thanks for the suggestions so far regarding the use of GRASS or SAGA.
>>>
>>> We have considered those options but SAGA doesn't appear available for
>>> MacOS. My understanding is that spgrass6 is more for accessing R
>>> code/functions from within GRASS vs accessing GRASS functions from
>>> within R. We have all our other analysis coded up in R, and just need
>>> these functions to do one part of a bigger process. Maybe I'm
>>> misunderstanding how to use R and GRASS together. I'll do some further
>>> research.
>>>
>>> Thanks again
>>> Josh
>>>
>>> Josh London wrote:
>>>       
>>>> Hello
>>>>
>>>> We are looking to mimic, in R, the slope (max magnitude difference
>>>> between a cell and its neighbors) and aspect (direction of maximum
>>>> magnitude difference) functions found in ESRI's Spatial Analyst
>>>> package. We were just about to code up the slope function but thought
>>>> I would make sure we weren't re-inventing any wheels already out there.
>>>>
>>>> Thanks
>>>> Josh
>>>>
>>>>         
>> --
>> Thomas E Adams
>> National Weather Service
>> Ohio River Forecast Center
>> 1901 South State Route 134
>> Wilmington, OH 45177
>>
>> EMAIL:	thomas.adams at noaa.gov
>>
>> VOICE:	937-383-0528
>> FAX:	937-383-0033
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>     
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>   


-- 
Thomas E Adams
National Weather Service
Ohio River Forecast Center
1901 South State Route 134
Wilmington, OH 45177

EMAIL:	thomas.adams at noaa.gov

VOICE:	937-383-0528
FAX:	937-383-0033


From p.hiemstra at geo.uu.nl  Fri Jul 10 16:33:09 2009
From: p.hiemstra at geo.uu.nl (Paul Hiemstra)
Date: Fri, 10 Jul 2009 16:33:09 +0200
Subject: [R-sig-Geo] [SoC v.autokrige2.py] autoKrige() and projected data
In-Reply-To: <4A326E1F.8090309@uni-muenster.de>
References: <4A326C28.20108@gmail.com> <4A326E1F.8090309@uni-muenster.de>
Message-ID: <4A575125.7090502@geo.uu.nl>

Hi Edzer, Anne and r-sig-geo,

I adapted the code of automap in reaction to this problem and included 
it in the new version of automap taht should be released somewhere next 
week.

from the documentation of autoKrige():

'autoKrige' performs some checks on the coordinate systems of
     'input_data' and 'new_data'. If one of both is 'NA', it is
     assigned the projection of the other. If they have different
     projections, an error is raised. If one of both has a
     non-projected system (i.e. latitude-longitude), an error is
     raised. This error is raised because 'gstat does use spherical
     distances when data are in geographical coordinates, however the
     usual variogram models are typically not non-negative definite on
     the sphere, and no appropriate models are available' (Edzer
     Pebesma on r-sig-geo).

This code illustrates the new functionality:

library(automap)
library(rgdal)
data(meuse)
coordinates(meuse) = ~x+y
data(meuse.grid)
gridded(meuse.grid) = ~x+y
proj4string(meuse) = CRS("+init=epsg:28992")

# new_data gets projection of input_data
autoKrige(log(zinc)~1, meuse, meuse.grid)

proj4string(meuse.grid) = CRS("+init=epsg:28992")
# Reproject to latlong
meuse_ll = spTransform(meuse, CRS("+init=epsg:4238"))
# Reproject to another projected system (LAEA)
meuse2 = spTransform(meuse, CRS("+init=epsg:3034"))
# Reproject to latlong
meuse.grid_ll = spTransform(meuse.grid, CRS("+init=epsg:4238"))

autoKrige(log(zinc)~1, meuse, meuse.grid)    # Should work
autoKrige(log(zinc)~1, meuse_ll, meuse.grid) # Should fail
autoKrige(log(zinc)~1, meuse, meuse.grid_ll) # Should fail
autoKrige(log(zinc)~1, meuse2, meuse.grid)   # Should fail

cheers,
Paul

Edzer Pebesma wrote:
> If newdata is created automatically (and this makes sense), it should
> recieve the projection information of data.
>
> On another issue: what happens if both are provided but have different
> projection attributes?
>
> And what happens if data has long/lat coordinates (is.projected(data) ==
> FALSE)? In that case I would prefer an error -- the current
> interpolation methods (covariances) used are not appropriate.
>
> Best regards,
> --
> Edzer
>
> Anne Ghisla wrote:
>   
>> Hello Paul, Edzer,
>>
>> the integration of automap package in v.autokrige2 is quite completed
>> [0], thanks Paul for this clean interface to gstat!
>> Sadly, I'm getting an error when autoKrige() receives no new_data
>> argument. Examples in documentation all involve meuse dataset, that has
>> no projection information. I browsed the Web for this situation with
>> little success. I don't know precisely where the error occurs, so I send
>> this report to Edzer too.
>>
>> Here is the code and a traceback of the error:
>>
>> ---code---
>> require(spgrass6)
>> require(automap)
>>
>> # rs in a vector map containing locations with relative elevation value,
>> in GRASS spearfish60 dataset. Obtained following this tutorial [1]
>>     
>>> rsmap <- readVECT6('rs', type='point')
>>>       
>> Exporting 300 points/lines...
>>  100%
>> 300 features written
>> OGR data source with driver: ESRI Shapefile
>> Source: "/home/anne/gis/spearfish60/PERMANENT/.tmp/galadriel", layer: "rs"
>> with  300  rows and  2  columns
>> Feature type: wkbPoint with 2 dimensions
>>
>>     
>>> str(rsmap)
>>>       
>> Formal class 'SpatialPointsDataFrame' [package "sp"] with 5 slots
>> [cut]
>>   ..@ proj4string:Formal class 'CRS' [package "sp"] with 1 slots
>>   .. .. ..@ projargs: chr " +proj=utm +zone=13 +ellps=clrk66
>> +datum=NAD27 +units=m +no_defs
>> +nadgrids=@conus, at alaska, at ntv2_0.gsb, at ntv1_can.dat"
>>
>> # not shown: meuse object has the same structure and contents but
>> projargs==NA.
>>
>>     
>>> autoKrige(elev~1, rsmap)
>>>       
>> Errore in predict.gstat(g, newdata = newdata, block = block, nsim =
>> nsim,  :
>>   var1 : data item in gstat object and newdata have different coordinate
>> reference systems
>>
>> Then I had a look into autoKrige code and found these lines:
>>
>>     if (missing(new_data))
>>         new_data = create_new_data(input_data)
>>     krige_result = krige(formula, input_data, new_data,
>> variogram_object$var_model,
>>         block = block, ...)
>>
>> My guess is that create_new_data() creates non-projected grid, and
>> krige() calls predict.gstat() with input_ and new_data, checks if they
>> have the same projection and in this case fails.
>>
>> In v.autokrige.py code, Mathieu Grelier workarounded this autogeneration
>> of new_data creating a correctly projected grid and passing it as
>> parameter.
>>
>> Shall I do the same or is it possible to get create_new_data() to keep
>> input_data's projection?
>>
>> many thanks in advance,
>> Anne
>>
>> [0] http://grass.osgeo.org/wiki/V.autokrige_GSoC_2009
>> [1] http://casoilresource.lawr.ucdavis.edu/drupal/node/438
>>     
>
>   


-- 
Drs. Paul Hiemstra
Department of Physical Geography
Faculty of Geosciences
University of Utrecht
Heidelberglaan 2
P.O. Box 80.115
3508 TC Utrecht
Phone:  +3130 274 3113 Mon-Tue
Phone:  +3130 253 5773 Wed-Fri
http://intamap.geo.uu.nl/~paul


From hengl at spatial-analyst.net  Fri Jul 10 16:48:08 2009
From: hengl at spatial-analyst.net (Tomislav Hengl)
Date: Fri, 10 Jul 2009 16:48:08 +0200
Subject: [R-sig-Geo] Slope and Aspect calculations in R
In-Reply-To: <4A574DF3.5020401@noaa.gov>
References: <4A5626EA.4080306@noaa.gov> <4A5656C8.8040501@noaa.gov>
	<4A573E07.5080609@noaa.gov>
	<22A2AD660CDA4959A441DAF79A3B8D27@pcibed193>
	<4A574DF3.5020401@noaa.gov>
Message-ID: <7892DFE8F10046A19934132A846A145C@pcibed193>


Yes: SAGA runs normally on Linux (I use it also), but you can not use the command line from R (i.e.
RSAGA) to pass command to SAGA  :(

But you can use R to pass command lines to SAGA without RSAGA (i.e. the batch files):

http://saga-gis.wiki.sourceforge.net/Executing+Modules+with+SAGA+CMD 

Tom Hengl
http://spatial-analyst.net 


> -----Original Message-----
> From: Thomas Adams [mailto:Thomas.Adams at noaa.gov]
> Sent: Friday, July 10, 2009 4:20 PM
> To: Tomislav Hengl
> Cc: r-sig-geo at stat.math.ethz.ch
> Subject: Re: [R-sig-Geo] Slope and Aspect calculations in R
> 
> Tom,
> 
> Thanks! I have seen your posts and results of some of your work with
> SAGA and I am very interested. But, I have been to lazy to this point to
> try compiling SAGA for either MacOS X or Linux (is a Linux distribution
> available?).
> 
> Regards,
> Tom
> 
> Tomislav Hengl wrote:
> > Dear Josh, Thomas,
> >
> > I typically use R+SAGA (R on top!) for such type of analysis (and I do have access to all
> operating
> > system/software). There must be some good reasons that I am using SAGA (speed, stability, rich
> > geomorphometry module etc.)! So do not give up so easy on SAGA.
> >
> > I especially like that SAGA is fairly efficient in processing big grids, and the commands are
> rather
> > compact. For example to reproject grids from one to another proj4string, you only need to set
> e.g.:
> >
> >
> >> rsaga.geoprocessor(lib="pj_proj4", 2, param=list(SOURCE_PROJ=paste('"', proj4string(dem25m),
> '"',
> >>
> > sep=""), TARGET_PROJ="\"+proj=longlat +datum=WGS84\"", SOURCE="TWI.sgrd", TARGET="TWI_ll.sgrd",
> > TARGET_TYPE=0, INTERPOLATION=0))
> >
> > *see http://www.geomorphometry.org/R.asp
> >
> > I remember that somebody did manage to set-up SAGA also under Mac OS
> > (http://www.saga-gis.uni-goettingen.de/html/index.php?module=pnForum&func=viewtopic&topic=458),
> but
> > I also remember that most of students on our GEOSTAT course used Windows under Mac OS to run
> SAGA. I
> > am sure that it should be possible to compile SAGA under Mac OS, but somebody needs to put some
> > effort to bridge this gap (check also with Olaf Conrad).
> >
> > Here is more discussion about the same topic from few months ago:
> > https://stat.ethz.ch/pipermail/r-sig-geo/2009-April/005418.html
> >
> > cheers,
> >
> > Tom Hengl
> >
> >
> >
> >> -----Original Message-----
> >> From: r-sig-geo-bounces at stat.math.ethz.ch [mailto:r-sig-geo-bounces at stat.math.ethz.ch] On
> Behalf
> >> Of Thomas Adams
> >> Sent: Friday, July 10, 2009 3:12 PM
> >> To: Josh London
> >> Cc: r-sig-geo at stat.math.ethz.ch
> >> Subject: Re: [R-sig-Geo] Slope and Aspect calculations in R
> >>
> >> Josh,
> >>
> >> I use R & GRASS together on both MacOS X and Linux without problems.
> >> It's very direct to write a shell script that calls both R & GRASS
> >> within a single script. Writing a R script that calls GRASS may be more
> >> tedious to do what you want. Writing a shell script that calls both may
> >> be the wat to go.
> >>
> >> Tom
> >>
> >> Josh London wrote:
> >>
> >>> Thanks for the suggestions so far regarding the use of GRASS or SAGA.
> >>>
> >>> We have considered those options but SAGA doesn't appear available for
> >>> MacOS. My understanding is that spgrass6 is more for accessing R
> >>> code/functions from within GRASS vs accessing GRASS functions from
> >>> within R. We have all our other analysis coded up in R, and just need
> >>> these functions to do one part of a bigger process. Maybe I'm
> >>> misunderstanding how to use R and GRASS together. I'll do some further
> >>> research.
> >>>
> >>> Thanks again
> >>> Josh
> >>>
> >>> Josh London wrote:
> >>>
> >>>> Hello
> >>>>
> >>>> We are looking to mimic, in R, the slope (max magnitude difference
> >>>> between a cell and its neighbors) and aspect (direction of maximum
> >>>> magnitude difference) functions found in ESRI's Spatial Analyst
> >>>> package. We were just about to code up the slope function but thought
> >>>> I would make sure we weren't re-inventing any wheels already out there.
> >>>>
> >>>> Thanks
> >>>> Josh
> >>>>
> >>>>
> >> --
> >> Thomas E Adams
> >> National Weather Service
> >> Ohio River Forecast Center
> >> 1901 South State Route 134
> >> Wilmington, OH 45177
> >>
> >> EMAIL:	thomas.adams at noaa.gov
> >>
> >> VOICE:	937-383-0528
> >> FAX:	937-383-0033
> >>
> >> _______________________________________________
> >> R-sig-Geo mailing list
> >> R-sig-Geo at stat.math.ethz.ch
> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >>
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at stat.math.ethz.ch
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
> 
> 
> --
> Thomas E Adams
> National Weather Service
> Ohio River Forecast Center
> 1901 South State Route 134
> Wilmington, OH 45177
> 
> EMAIL:	thomas.adams at noaa.gov
> 
> VOICE:	937-383-0528
> FAX:	937-383-0033


From greenberg at ucdavis.edu  Fri Jul 10 18:54:16 2009
From: greenberg at ucdavis.edu (Jonathan Greenberg)
Date: Fri, 10 Jul 2009 09:54:16 -0700
Subject: [R-sig-Geo] How do I set ENVI file interleave when using
	GDALTransientDataset?
In-Reply-To: <alpine.LRH.2.00.0907100949310.12262@reclus.nhh.no>
References: <4A569A74.8020202@ucdavis.edu>
	<alpine.LRH.2.00.0907100949310.12262@reclus.nhh.no>
Message-ID: <4A577238.1040109@ucdavis.edu>

Roger, thanks, but I've modded the call to say:

    tds.out <- new("GDALTransientDataset", driver = d.drv, rows = 
dims[2],cols = dims[1], bands = bands, type = type, 
options="INTERLEAVE=BIL")

I THINK this is right, because if I change the interleave to something 
weird, say:

    tds.out <- new("GDALTransientDataset", driver = d.drv, rows = 
dims[2],cols = dims[1], bands = bands, type = type, 
options="INTERLEAVE=MOO")

I get the error:
Warning message:
In .local(.Object, ...) :
    GDAL Error 6: 'MOO' is an unexpected value for INTERLEAVE creation 
option of type string-select.

However, the output header is still not containing the modified 
interleave, its still defaulting to BSQ in the output header.

I noticed in the documentation of the GDALTransientDataset-class, the 
options appear to be disabled:

"options
Driver specific options (currently ignored)"

Could this be what's going on?  Is there a plan to enable these in the 
future?  The reason I'm going through all this is so I can make an ENVI 
header ONLY (not the image file associated with it -- I'm doing that via 
line-by-line writeBin statements to realize tiled processing).

--j

Roger Bivand wrote:
> On Thu, 9 Jul 2009, Jonathan Greenberg wrote:
>
>> I'm writing a function to mimic ENVI/IDL's "ENVI_SETUP_HEAD" using 
>> rgdal, and I was wondering how I set the interleave (BIP vs BSQ vs BIL)?
>
> You'll need to use the options= argument to pass through these values 
> when you instantiate the transient dataset. There is an example of its 
> use in ?writeOGR.
>
> Roger
>
>> The subsection of my code that I assume this belongs in is below:
>>
>>   driver="ENVI"
>>   d.drv <- new("GDALDriver", driver)
>>   tds.out <- new("GDALTransientDataset", driver = d.drv, rows = 
>> dims[2],cols = dims[1], bands = bands, type = type)
>>   gt <- c(offset[1] - 0.5 * cellsize[1], cellsize[1], 0.0,offset[2] + 
>> (dims[2] -0.5) * cellsize[2], 0.0, -cellsize[2])
>>   .Call("RGDAL_SetGeoTransform", tds.out, gt, PACKAGE = "rgdal")
>>   .Call("RGDAL_SetProject", tds.out, file_projection, PACKAGE = "rgdal")
>>   fn <- tempfile()
>>   saveDataset(tds.out, fn)
>>
>> Thanks!
>>
>> --j
>>
>>
>>
>

-- 

Jonathan A. Greenberg, PhD
Postdoctoral Scholar
Center for Spatial Technologies and Remote Sensing (CSTARS)
University of California, Davis
One Shields Avenue
The Barn, Room 250N
Davis, CA 95616
Cell: 415-794-5043
AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307


From seunghong at wisc.edu  Fri Jul 10 18:55:34 2009
From: seunghong at wisc.edu (Steve Hong)
Date: Fri, 10 Jul 2009 11:55:34 -0500
Subject: [R-sig-Geo] rgdal pckg: Convert LL to UTM
Message-ID: <6e50d1e922d88.4a572c36@wiscmail.wisc.edu>

Dear List,

Thanks again for answering my question. I was able to convert LL to UTM using 'rgdal' package. Below is the code I used.

library(rgdal) 

my.data2 <- read.delim("clipboard", header=T)
my.data <- SpatialPoints(my.data, proj4string=CRS("+proj=longlat +ellps=WGS84"))
my.data.utm <- spTransform(my.data, CRS("+proj=utm +zone=15 +ellps=WGS84"))

My second questions are:

1. How can I see the list of projections available in R beside WGS84?
2. If I want to add/import a projection not available in R, what am I supposed to do?

I would appreciate any suggestion with example.

Thank you!!

Steve


From Roger.Bivand at nhh.no  Fri Jul 10 19:19:26 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 10 Jul 2009 19:19:26 +0200 (CEST)
Subject: [R-sig-Geo] spTransform: wrong results??
In-Reply-To: <27de757d0907100637mdfbe2e7u26eea41b42711e2f@mail.gmail.com>
References: <4A56F918.4040903@gmail.com>
	<alpine.LRH.2.00.0907101024460.12262@reclus.nhh.no>
	<alpine.LRH.2.00.0907101212490.12616@reclus.nhh.no>
	<27de757d0907100605o12bb6611g5babd8a570e1f786@mail.gmail.com>
	<alpine.LRH.2.00.0907101513180.3914@reclus.nhh.no>
	<27de757d0907100637mdfbe2e7u26eea41b42711e2f@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.0907101907200.6708@reclus.nhh.no>

On Fri, 10 Jul 2009, Agustin Lobo wrote:

> Regarding the towgs84 parameters, I've found
> http://www.mail-archive.com/gdal-dev at lists.osgeo.org/msg02921.html
> and from there
> http://earth-info.nga.mil/GandG/coordsys/onlinedatum/CountryEuropeTable.html
>
> I'll test these values for my ED50, compare to GlobalMapper results
> and let the list know.

Fine, thanks.

>
> Where you say:
>
> 2009/7/10 Roger Bivand <Roger.Bivand at nhh.no>:
>> On Fri, 10 Jul 2009, Agustin Lobo wrote:
>>
>>> I'll try and let you know. For the future, no way to compile the
>>> towgs84 parameter so that could be automatically used
>>> by spTransform? This must be what programs like GlobalMapper do, as
>>> you just define input and output datum.
>>
>> No way. Choosing the 3 or 7 parameter datum transforms has to be the
>> responsibility of the user when there is no unequivocal authority. Having a
>> known ground control point (a GPS reading from a known point that has a
>> known CRS) can be used to see which CRS settings let you reproduce it. But
>> with legacy maps, this isn't so easy. GlobalMapper must I suppose be making
>> choices and using authorities that it acknowledges, but reading G&D does not
>> make me optimistic.
>
> I disagree, you could just use a default table of values letting the 
> user enter his/her own in case he/she considers that those of the table 
> are not appropriate (or do not exist). That's why default values exist 
> in R.  Let me know if can help.

It seems to me that the "right" place is the EPSG database. When there is 
an unequivocal +towgs84, it gets retrieved when the CRS is given as 
"+init=epsg:<#>" where <#> is the EPSG code. Since lots of software uses 
EPSG (and GDAL and PROJ.4), maintaining a separate database will risk 
getting out of date very soon - there are strong advantages in following 
the lead of people who really know about these things, unlike me, for 
example. This is about how to encapsulate expert knowledge, really. The 
EPSG and PROJ.4 route is only to set what is known to be right, and to 
leave it up to the user to choose.

It may be costly to have to survey a local ground control point (by DGPS 
or GPS if that is close enough, for example), but if that is what is 
required to integrate legacy maps, maybe there isn't an alternative. It is 
obvious from the sources you cite that ED50 +towgs84 parameters lie in 
intervals of +/-3m at best and +/-8m at worst, which isn't great, really - 
those are differences that you can see easily.

So I'll go for adding some attention-grabbing documentation in sensible 
places, maybe "ignoring datum declarations can seriously damage your 
health" near cliffs?

Roger

>
> Agus
>
> Dr. Agustin Lobo
> Institut de Ciencies de la Terra "Jaume Almera" (CSIC)
> Lluis Sole Sabaris s/n
> 08028 Barcelona
> Spain
> Tel. 34 934095410
> Fax. 34 934110012
> e-mail Agustin.Lobo at ija.csic.es
> http://www.ija.csic.es/gt/obster
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From brenning at uwaterloo.ca  Fri Jul 10 20:19:21 2009
From: brenning at uwaterloo.ca (Alexander Brenning)
Date: Fri, 10 Jul 2009 14:19:21 -0400
Subject: [R-sig-Geo] RSAGA under Linux (was: Slope and Aspect calculations
	in R)
In-Reply-To: <7892DFE8F10046A19934132A846A145C@pcibed193>
References: <4A5626EA.4080306@noaa.gov>
	<4A5656C8.8040501@noaa.gov>	<4A573E07.5080609@noaa.gov>	<22A2AD660CDA4959A441DAF79A3B8D27@pcibed193>	<4A574DF3.5020401@noaa.gov>
	<7892DFE8F10046A19934132A846A145C@pcibed193>
Message-ID: <4A578629.30804@uwaterloo.ca>

Hi,

I have recently made some adjustments to RSAGA that will allow it to 
work under Linux too. I haven't uploaded it to CRAN yet, please try out 
this temporary build if you wish:

http://www.environment.uwaterloo.ca/u/brenning/RSAGA_0.9-6.tar.gz

I appreciate your feedback - unfortunately I am not a Unix/Linux user so 
I depend on your error reports.

Thanks to Carlos Grohmann for his support with the above adaptation to 
Linux.

Cheers
  Alex


Tomislav Hengl wrote:
> Yes: SAGA runs normally on Linux (I use it also), but you can not use the command line from R (i.e.
> RSAGA) to pass command to SAGA  :(
> 
> But you can use R to pass command lines to SAGA without RSAGA (i.e. the batch files):
> 
> http://saga-gis.wiki.sourceforge.net/Executing+Modules+with+SAGA+CMD 
> 
> Tom Hengl
> http://spatial-analyst.net 
> 
> 
>> -----Original Message-----
>> From: Thomas Adams [mailto:Thomas.Adams at noaa.gov]
>> Sent: Friday, July 10, 2009 4:20 PM
>> To: Tomislav Hengl
>> Cc: r-sig-geo at stat.math.ethz.ch
>> Subject: Re: [R-sig-Geo] Slope and Aspect calculations in R
>>
>> Tom,
>>
>> Thanks! I have seen your posts and results of some of your work with
>> SAGA and I am very interested. But, I have been to lazy to this point to
>> try compiling SAGA for either MacOS X or Linux (is a Linux distribution
>> available?).
>>
>> Regards,
>> Tom
>>
>> Tomislav Hengl wrote:
>>> Dear Josh, Thomas,
>>>
>>> I typically use R+SAGA (R on top!) for such type of analysis (and I do have access to all
>> operating
>>> system/software). There must be some good reasons that I am using SAGA (speed, stability, rich
>>> geomorphometry module etc.)! So do not give up so easy on SAGA.
>>>
>>> I especially like that SAGA is fairly efficient in processing big grids, and the commands are
>> rather
>>> compact. For example to reproject grids from one to another proj4string, you only need to set
>> e.g.:
>>>
>>>> rsaga.geoprocessor(lib="pj_proj4", 2, param=list(SOURCE_PROJ=paste('"', proj4string(dem25m),
>> '"',
>>> sep=""), TARGET_PROJ="\"+proj=longlat +datum=WGS84\"", SOURCE="TWI.sgrd", TARGET="TWI_ll.sgrd",
>>> TARGET_TYPE=0, INTERPOLATION=0))
>>>
>>> *see http://www.geomorphometry.org/R.asp
>>>
>>> I remember that somebody did manage to set-up SAGA also under Mac OS
>>> (http://www.saga-gis.uni-goettingen.de/html/index.php?module=pnForum&func=viewtopic&topic=458),
>> but
>>> I also remember that most of students on our GEOSTAT course used Windows under Mac OS to run
>> SAGA. I
>>> am sure that it should be possible to compile SAGA under Mac OS, but somebody needs to put some
>>> effort to bridge this gap (check also with Olaf Conrad).
>>>
>>> Here is more discussion about the same topic from few months ago:
>>> https://stat.ethz.ch/pipermail/r-sig-geo/2009-April/005418.html
>>>
>>> cheers,
>>>
>>> Tom Hengl
>>>
>>>
>>>
>>>> -----Original Message-----
>>>> From: r-sig-geo-bounces at stat.math.ethz.ch [mailto:r-sig-geo-bounces at stat.math.ethz.ch] On
>> Behalf
>>>> Of Thomas Adams
>>>> Sent: Friday, July 10, 2009 3:12 PM
>>>> To: Josh London
>>>> Cc: r-sig-geo at stat.math.ethz.ch
>>>> Subject: Re: [R-sig-Geo] Slope and Aspect calculations in R
>>>>
>>>> Josh,
>>>>
>>>> I use R & GRASS together on both MacOS X and Linux without problems.
>>>> It's very direct to write a shell script that calls both R & GRASS
>>>> within a single script. Writing a R script that calls GRASS may be more
>>>> tedious to do what you want. Writing a shell script that calls both may
>>>> be the wat to go.
>>>>
>>>> Tom
>>>>
>>>> Josh London wrote:
>>>>
>>>>> Thanks for the suggestions so far regarding the use of GRASS or SAGA.
>>>>>
>>>>> We have considered those options but SAGA doesn't appear available for
>>>>> MacOS. My understanding is that spgrass6 is more for accessing R
>>>>> code/functions from within GRASS vs accessing GRASS functions from
>>>>> within R. We have all our other analysis coded up in R, and just need
>>>>> these functions to do one part of a bigger process. Maybe I'm
>>>>> misunderstanding how to use R and GRASS together. I'll do some further
>>>>> research.
>>>>>
>>>>> Thanks again
>>>>> Josh
>>>>>
>>>>> Josh London wrote:
>>>>>
>>>>>> Hello
>>>>>>
>>>>>> We are looking to mimic, in R, the slope (max magnitude difference
>>>>>> between a cell and its neighbors) and aspect (direction of maximum
>>>>>> magnitude difference) functions found in ESRI's Spatial Analyst
>>>>>> package. We were just about to code up the slope function but thought
>>>>>> I would make sure we weren't re-inventing any wheels already out there.
>>>>>>
>>>>>> Thanks
>>>>>> Josh
>>>>>>
>>>>>>
>>>> --
>>>> Thomas E Adams
>>>> National Weather Service
>>>> Ohio River Forecast Center
>>>> 1901 South State Route 134
>>>> Wilmington, OH 45177
>>>>
>>>> EMAIL:	thomas.adams at noaa.gov
>>>>
>>>> VOICE:	937-383-0528
>>>> FAX:	937-383-0033
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at stat.math.ethz.ch
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>> --
>> Thomas E Adams
>> National Weather Service
>> Ohio River Forecast Center
>> 1901 South State Route 134
>> Wilmington, OH 45177
>>
>> EMAIL:	thomas.adams at noaa.gov
>>
>> VOICE:	937-383-0528
>> FAX:	937-383-0033
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 
> 

-- 
Alexander Brenning
brenning at uwaterloo.ca - T +1-519-888-4567 ext 35783
Department of Geography and Environmental Management
University of Waterloo
200 University Ave. W - Waterloo, ON - Canada N2L 3G1
http://www.fes.uwaterloo.ca/geography/faculty/brenning/


From josh.london at noaa.gov  Fri Jul 10 20:42:29 2009
From: josh.london at noaa.gov (Josh London)
Date: Fri, 10 Jul 2009 11:42:29 -0700
Subject: [R-sig-Geo] Slope and Aspect calculations in R
In-Reply-To: <7892DFE8F10046A19934132A846A145C@pcibed193>
References: <4A5626EA.4080306@noaa.gov> <4A5656C8.8040501@noaa.gov>
	<4A573E07.5080609@noaa.gov>
	<22A2AD660CDA4959A441DAF79A3B8D27@pcibed193>
	<4A574DF3.5020401@noaa.gov>
	<7892DFE8F10046A19934132A846A145C@pcibed193>
Message-ID: <4A578B95.9060108@noaa.gov>

Thanks to everyone for the feedback. I may dabble around with SAGA/RSAGA 
on a linux box we have and also continue to watch for any MacOS builds.

Roger, I am especially excited that spgrass6 has the initGRASS() 
function. by providing access to r.slope.aspect, I think that will be 
the simplest/quickest route to a solution. I look forward to tapping 
into other GRASS commands in the future. You may want to consider 
changing the description of spgrass6 on CRAN. I have interpreted the 
phrase 'based on starting R from within the GRASS environment' to mean 
the package is for those who use GRASS and want to access functions 
within R.

cheers, and thanks again for the feedback and help

Josh

Tomislav Hengl wrote:
> Yes: SAGA runs normally on Linux (I use it also), but you can not use the command line from R (i.e.
> RSAGA) to pass command to SAGA  :(
> 
> But you can use R to pass command lines to SAGA without RSAGA (i.e. the batch files):
> 
> http://saga-gis.wiki.sourceforge.net/Executing+Modules+with+SAGA+CMD 
> 
> Tom Hengl
> http://spatial-analyst.net 
> 
> 
>> -----Original Message-----
>> From: Thomas Adams [mailto:Thomas.Adams at noaa.gov]
>> Sent: Friday, July 10, 2009 4:20 PM
>> To: Tomislav Hengl
>> Cc: r-sig-geo at stat.math.ethz.ch
>> Subject: Re: [R-sig-Geo] Slope and Aspect calculations in R
>>
>> Tom,
>>
>> Thanks! I have seen your posts and results of some of your work with
>> SAGA and I am very interested. But, I have been to lazy to this point to
>> try compiling SAGA for either MacOS X or Linux (is a Linux distribution
>> available?).
>>
>> Regards,
>> Tom
>>
>> Tomislav Hengl wrote:
>>> Dear Josh, Thomas,
>>>
>>> I typically use R+SAGA (R on top!) for such type of analysis (and I do have access to all
>> operating
>>> system/software). There must be some good reasons that I am using SAGA (speed, stability, rich
>>> geomorphometry module etc.)! So do not give up so easy on SAGA.
>>>
>>> I especially like that SAGA is fairly efficient in processing big grids, and the commands are
>> rather
>>> compact. For example to reproject grids from one to another proj4string, you only need to set
>> e.g.:
>>>
>>>> rsaga.geoprocessor(lib="pj_proj4", 2, param=list(SOURCE_PROJ=paste('"', proj4string(dem25m),
>> '"',
>>> sep=""), TARGET_PROJ="\"+proj=longlat +datum=WGS84\"", SOURCE="TWI.sgrd", TARGET="TWI_ll.sgrd",
>>> TARGET_TYPE=0, INTERPOLATION=0))
>>>
>>> *see http://www.geomorphometry.org/R.asp
>>>
>>> I remember that somebody did manage to set-up SAGA also under Mac OS
>>> (http://www.saga-gis.uni-goettingen.de/html/index.php?module=pnForum&func=viewtopic&topic=458),
>> but
>>> I also remember that most of students on our GEOSTAT course used Windows under Mac OS to run
>> SAGA. I
>>> am sure that it should be possible to compile SAGA under Mac OS, but somebody needs to put some
>>> effort to bridge this gap (check also with Olaf Conrad).
>>>
>>> Here is more discussion about the same topic from few months ago:
>>> https://stat.ethz.ch/pipermail/r-sig-geo/2009-April/005418.html
>>>
>>> cheers,
>>>
>>> Tom Hengl
>>>
>>>
>>>
>>>> -----Original Message-----
>>>> From: r-sig-geo-bounces at stat.math.ethz.ch [mailto:r-sig-geo-bounces at stat.math.ethz.ch] On
>> Behalf
>>>> Of Thomas Adams
>>>> Sent: Friday, July 10, 2009 3:12 PM
>>>> To: Josh London
>>>> Cc: r-sig-geo at stat.math.ethz.ch
>>>> Subject: Re: [R-sig-Geo] Slope and Aspect calculations in R
>>>>
>>>> Josh,
>>>>
>>>> I use R & GRASS together on both MacOS X and Linux without problems.
>>>> It's very direct to write a shell script that calls both R & GRASS
>>>> within a single script. Writing a R script that calls GRASS may be more
>>>> tedious to do what you want. Writing a shell script that calls both may
>>>> be the wat to go.
>>>>
>>>> Tom
>>>>
>>>> Josh London wrote:
>>>>
>>>>> Thanks for the suggestions so far regarding the use of GRASS or SAGA.
>>>>>
>>>>> We have considered those options but SAGA doesn't appear available for
>>>>> MacOS. My understanding is that spgrass6 is more for accessing R
>>>>> code/functions from within GRASS vs accessing GRASS functions from
>>>>> within R. We have all our other analysis coded up in R, and just need
>>>>> these functions to do one part of a bigger process. Maybe I'm
>>>>> misunderstanding how to use R and GRASS together. I'll do some further
>>>>> research.
>>>>>
>>>>> Thanks again
>>>>> Josh
>>>>>
>>>>> Josh London wrote:
>>>>>
>>>>>> Hello
>>>>>>
>>>>>> We are looking to mimic, in R, the slope (max magnitude difference
>>>>>> between a cell and its neighbors) and aspect (direction of maximum
>>>>>> magnitude difference) functions found in ESRI's Spatial Analyst
>>>>>> package. We were just about to code up the slope function but thought
>>>>>> I would make sure we weren't re-inventing any wheels already out there.
>>>>>>
>>>>>> Thanks
>>>>>> Josh
>>>>>>
>>>>>>
>>>> --
>>>> Thomas E Adams
>>>> National Weather Service
>>>> Ohio River Forecast Center
>>>> 1901 South State Route 134
>>>> Wilmington, OH 45177
>>>>
>>>> EMAIL:	thomas.adams at noaa.gov
>>>>
>>>> VOICE:	937-383-0528
>>>> FAX:	937-383-0033
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at stat.math.ethz.ch
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>> --
>> Thomas E Adams
>> National Weather Service
>> Ohio River Forecast Center
>> 1901 South State Route 134
>> Wilmington, OH 45177
>>
>> EMAIL:	thomas.adams at noaa.gov
>>
>> VOICE:	937-383-0528
>> FAX:	937-383-0033
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Josh M. London, PhD

Wildlife Biologist
Polar Ecosystem Program
National Marine Mammal Lab
Alaska Fisheries Science Center, NOAA Fisheries
Seattle, WA

The contents of this message are mine personally and do not
necessarily reflect any position of the Government or the
National Oceanic and Atmospheric Administration.


From Roger.Bivand at nhh.no  Fri Jul 10 21:16:46 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 10 Jul 2009 21:16:46 +0200 (CEST)
Subject: [R-sig-Geo] rgdal pckg: Convert LL to UTM
In-Reply-To: <6e50d1e922d88.4a572c36@wiscmail.wisc.edu>
References: <6e50d1e922d88.4a572c36@wiscmail.wisc.edu>
Message-ID: <alpine.LRH.2.00.0907102106250.6708@reclus.nhh.no>

On Fri, 10 Jul 2009, Steve Hong wrote:

> Dear List,
>
> Thanks again for answering my question. I was able to convert LL to UTM using 'rgdal' package. Below is the code I used.
>
> library(rgdal)
>
> my.data2 <- read.delim("clipboard", header=T)
> my.data <- SpatialPoints(my.data, proj4string=CRS("+proj=longlat +ellps=WGS84"))
> my.data.utm <- spTransform(my.data, CRS("+proj=utm +zone=15 +ellps=WGS84"))

Good. I'd advise in general to say +datum=WGS84 rather than +ellps=WGS84, 
but since both the object to be transformed and the target CRS share the 
same datum and it is WGS84, no harm is done.

>
> My second questions are:
>
> 1. How can I see the list of projections available in R beside WGS84?

The CRS are provided from the PROJ.4 external library, so either use its 
website, or a website giving proj4 representations of the EPSG database, 
or use EPSG internally ("+init=epsg:#", for # the code for the values 
needed). The websites are:

http://trac.osgeo.org/proj/wiki/GenParms
http://www.remotesensing.org/geotiff/proj_list/
http://spatialreference.org/

You can look at ?make_EPSG (in rgdal) to see how you might access EPSG 
within R. See ?projInfo (in rgdal) for listings of available projections, 
ellipsoids, and datums in the PROJ.4 library running with rgdal.

> 2. If I want to add/import a projection not available in R, what am I 
> supposed to do?

Find the appropriate representation of your projection as understood by 
PROJ.4.

Roger

>
> I would appreciate any suggestion with example.
>
> Thank you!!
>
> Steve
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From a.ghisla at gmail.com  Sat Jul 11 14:40:22 2009
From: a.ghisla at gmail.com (Anne Ghisla)
Date: Sat, 11 Jul 2009 14:40:22 +0200
Subject: [R-sig-Geo] [SoC v.autokrige2.py] autoKrige() and projected data
In-Reply-To: <4A575125.7090502@geo.uu.nl>
References: <4A326C28.20108@gmail.com> <4A326E1F.8090309@uni-muenster.de>
	<4A575125.7090502@geo.uu.nl>
Message-ID: <4A588836.9090500@gmail.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Paul Hiemstra ha scritto:
> Hi Edzer, Anne and r-sig-geo,
> 
> I adapted the code of automap in reaction to this problem and included
> it in the new version of automap taht should be released somewhere next
> week.

Hi Paul, Edzer, list,

great news, thanks Paul for this improvement. autoKrige() use is now
more straightforward, I look forward to upgrade the package.
In the specific case of v.krige, anyway, I'll keep using a
self-generated grid from GRASS region and resolution.

> from the documentation of autoKrige():
> 
> 'autoKrige' performs some checks on the coordinate systems of
>     'input_data' and 'new_data'. If one of both is 'NA', it is
>     assigned the projection of the other. If they have different
>     projections, an error is raised. If one of both has a
>     non-projected system (i.e. latitude-longitude), an error is
>     raised. This error is raised because 'gstat does use spherical
>     distances when data are in geographical coordinates, however the
>     usual variogram models are typically not non-negative definite on
>     the sphere, and no appropriate models are available' (Edzer
>     Pebesma on r-sig-geo).

Useful information, I've missed it in previous threads.

best regards,
Anne

> 
> This code illustrates the new functionality:
> 
> library(automap)
> library(rgdal)
> data(meuse)
> coordinates(meuse) = ~x+y
> data(meuse.grid)
> gridded(meuse.grid) = ~x+y
> proj4string(meuse) = CRS("+init=epsg:28992")
> 
> # new_data gets projection of input_data
> autoKrige(log(zinc)~1, meuse, meuse.grid)
> 
> proj4string(meuse.grid) = CRS("+init=epsg:28992")
> # Reproject to latlong
> meuse_ll = spTransform(meuse, CRS("+init=epsg:4238"))
> # Reproject to another projected system (LAEA)
> meuse2 = spTransform(meuse, CRS("+init=epsg:3034"))
> # Reproject to latlong
> meuse.grid_ll = spTransform(meuse.grid, CRS("+init=epsg:4238"))
> 
> autoKrige(log(zinc)~1, meuse, meuse.grid)    # Should work
> autoKrige(log(zinc)~1, meuse_ll, meuse.grid) # Should fail
> autoKrige(log(zinc)~1, meuse, meuse.grid_ll) # Should fail
> autoKrige(log(zinc)~1, meuse2, meuse.grid)   # Should fail
> 
> cheers,
> Paul
> 
> Edzer Pebesma wrote:
>> If newdata is created automatically (and this makes sense), it should
>> recieve the projection information of data.
>>
>> On another issue: what happens if both are provided but have different
>> projection attributes?
>>
>> And what happens if data has long/lat coordinates (is.projected(data) ==
>> FALSE)? In that case I would prefer an error -- the current
>> interpolation methods (covariances) used are not appropriate.
>>
>> Best regards,
>> -- 
>> Edzer
>>
>> Anne Ghisla wrote:
>>  
>>> Hello Paul, Edzer,
>>>
>>> the integration of automap package in v.autokrige2 is quite completed
>>> [0], thanks Paul for this clean interface to gstat!
>>> Sadly, I'm getting an error when autoKrige() receives no new_data
>>> argument. Examples in documentation all involve meuse dataset, that has
>>> no projection information. I browsed the Web for this situation with
>>> little success. I don't know precisely where the error occurs, so I send
>>> this report to Edzer too.
>>>
>>> Here is the code and a traceback of the error:
>>>
>>> ---code---
>>> require(spgrass6)
>>> require(automap)
>>>
>>> # rs in a vector map containing locations with relative elevation value,
>>> in GRASS spearfish60 dataset. Obtained following this tutorial [1]
>>>    
>>>> rsmap <- readVECT6('rs', type='point')
>>>>       
>>> Exporting 300 points/lines...
>>>  100%
>>> 300 features written
>>> OGR data source with driver: ESRI Shapefile
>>> Source: "/home/anne/gis/spearfish60/PERMANENT/.tmp/galadriel", layer:
>>> "rs"
>>> with  300  rows and  2  columns
>>> Feature type: wkbPoint with 2 dimensions
>>>
>>>    
>>>> str(rsmap)
>>>>       
>>> Formal class 'SpatialPointsDataFrame' [package "sp"] with 5 slots
>>> [cut]
>>>   ..@ proj4string:Formal class 'CRS' [package "sp"] with 1 slots
>>>   .. .. ..@ projargs: chr " +proj=utm +zone=13 +ellps=clrk66
>>> +datum=NAD27 +units=m +no_defs
>>> +nadgrids=@conus, at alaska, at ntv2_0.gsb, at ntv1_can.dat"
>>>
>>> # not shown: meuse object has the same structure and contents but
>>> projargs==NA.
>>>
>>>    
>>>> autoKrige(elev~1, rsmap)
>>>>       
>>> Errore in predict.gstat(g, newdata = newdata, block = block, nsim =
>>> nsim,  :
>>>   var1 : data item in gstat object and newdata have different coordinate
>>> reference systems
>>>
>>> Then I had a look into autoKrige code and found these lines:
>>>
>>>     if (missing(new_data))
>>>         new_data = create_new_data(input_data)
>>>     krige_result = krige(formula, input_data, new_data,
>>> variogram_object$var_model,
>>>         block = block, ...)
>>>
>>> My guess is that create_new_data() creates non-projected grid, and
>>> krige() calls predict.gstat() with input_ and new_data, checks if they
>>> have the same projection and in this case fails.
>>>
>>> In v.autokrige.py code, Mathieu Grelier workarounded this autogeneration
>>> of new_data creating a correctly projected grid and passing it as
>>> parameter.
>>>
>>> Shall I do the same or is it possible to get create_new_data() to keep
>>> input_data's projection?
>>>
>>> many thanks in advance,
>>> Anne
>>>
>>> [0] http://grass.osgeo.org/wiki/V.autokrige_GSoC_2009
>>> [1] http://casoilresource.lawr.ucdavis.edu/drupal/node/438
>>>     
>>
>>   
> 
> 

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.9 (MingW32)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org

iEYEARECAAYFAkpYiDYACgkQzZ3g4YwFFgY5rQCeKPqSz0T5VPCbeVEpPwbP0T48
TOYAn1v2cjFrnUHKOi6QlvhnXw3vOr93
=hVIx
-----END PGP SIGNATURE-----


From alobolistas at gmail.com  Sun Jul 12 13:11:48 2009
From: alobolistas at gmail.com (Agustin Lobo)
Date: Sun, 12 Jul 2009 13:11:48 +0200
Subject: [R-sig-Geo] spTransform: wrong results??
In-Reply-To: <27de757d0907100637mdfbe2e7u26eea41b42711e2f@mail.gmail.com>
References: <4A56F918.4040903@gmail.com>	
	<alpine.LRH.2.00.0907101024460.12262@reclus.nhh.no>	
	<alpine.LRH.2.00.0907101212490.12616@reclus.nhh.no>	
	<27de757d0907100605o12bb6611g5babd8a570e1f786@mail.gmail.com>	
	<alpine.LRH.2.00.0907101513180.3914@reclus.nhh.no>
	<27de757d0907100637mdfbe2e7u26eea41b42711e2f@mail.gmail.com>
Message-ID: <4A59C4F4.2050507@gmail.com>

Here you have some results with
different software for the transformation
of one single  UTM 31N ED50 coordinate to
lon,lat ED50 and lon,lat WGS84.
My understanding of this problem seems to
be decreasing as I do more testing.

QGIS UTM 31N ED50

POINT(449919.586269 4631874.109627)

TRANSFORMS TO LONGITUDE,LATITUDE:

QGIS ED50
POINT(2.396864 41.836439)
QGIS WGS84
POINT(2.396864 41.836439)

GlobalMapper  ED50  2.39686371? E	41.83643863? N
GlobalMapper  WGS84 2.39572870? E	41.83535625? N

TNT WGS84
POINT(2.396864 41.836439)
TNT ED50
POINT(2.396864 41.836439)

rgdal ED50 no towgs84 field specified
WP1	2.39686370617169	41.8364386271064

rgdal WGS84 no towgs84 field specified
WP1	2.39686370617169	41.8364386271064

rgdal WGS84 with towgs84=-87, -98,-121
WP1	2.39690750837097	41.8361433350555



Agus


-------------- next part --------------
A non-text attachment was scrubbed...
Name: alobolistas.vcf
Type: text/x-vcard
Size: 251 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090712/03198ecf/attachment.vcf>

From Roger.Bivand at nhh.no  Sun Jul 12 13:32:20 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sun, 12 Jul 2009 13:32:20 +0200 (CEST)
Subject: [R-sig-Geo] spTransform: wrong results??
In-Reply-To: <4A59C4F4.2050507@gmail.com>
References: <4A56F918.4040903@gmail.com>
	<alpine.LRH.2.00.0907101024460.12262@reclus.nhh.no>
	<alpine.LRH.2.00.0907101212490.12616@reclus.nhh.no>
	<27de757d0907100605o12bb6611g5babd8a570e1f786@mail.gmail.com>
	<alpine.LRH.2.00.0907101513180.3914@reclus.nhh.no>
	<27de757d0907100637mdfbe2e7u26eea41b42711e2f@mail.gmail.com>
	<4A59C4F4.2050507@gmail.com>
Message-ID: <alpine.LRH.2.00.0907121327050.18457@reclus.nhh.no>

On Sun, 12 Jul 2009, Agustin Lobo wrote:

> Here you have some results with
> different software for the transformation
> of one single  UTM 31N ED50 coordinate to
> lon,lat ED50 and lon,lat WGS84.
> My understanding of this problem seems to
> be decreasing as I do more testing.
>
> QGIS UTM 31N ED50

This isn't helpful, I'm afraid. You are starting from an unknown, not a 
known. It isn't imposible that QGIS doesn't give a +towgs84 for so-called 
ED50, because ED50 is *not* one datum but many.

Start with an unequivocally known point in a known datum, such as a GPS 
reading in geographical coordinates and WGS84. Work from there, and it 
should get clearer.

Datum definitions are not easy at all, because organisations typically 
always worked within a single datum, and never needed to transform (until 
oil was found across two different jurisdictions using different datum 
standards, hence EPSG).

Roger

>
> POINT(449919.586269 4631874.109627)
>
> TRANSFORMS TO LONGITUDE,LATITUDE:
>
> QGIS ED50
> POINT(2.396864 41.836439)
> QGIS WGS84
> POINT(2.396864 41.836439)
>
> GlobalMapper  ED50  2.39686371? E	41.83643863? N
> GlobalMapper  WGS84 2.39572870? E	41.83535625? N
>
> TNT WGS84
> POINT(2.396864 41.836439)
> TNT ED50
> POINT(2.396864 41.836439)
>
> rgdal ED50 no towgs84 field specified
> WP1	2.39686370617169	41.8364386271064
>
> rgdal WGS84 no towgs84 field specified
> WP1	2.39686370617169	41.8364386271064
>
> rgdal WGS84 with towgs84=-87, -98,-121
> WP1	2.39690750837097	41.8361433350555
>
>
>
> Agus
>
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From ssefick at gmail.com  Sun Jul 12 14:57:40 2009
From: ssefick at gmail.com (stephen sefick)
Date: Sun, 12 Jul 2009 07:57:40 -0500
Subject: [R-sig-Geo] merging data with a dataframe based on a common
	identifier
Message-ID: <c502a9e10907120557y65627f74nb0a2546115021fe6@mail.gmail.com>

I have used v.strahler in GRASS to calculate the stream order.  This
module writes its results to a text file.  The line column of the
output data is the common name between the two data sets.  I would
like to attach the stream order to the streams vector.  I have looked
at the data once in R with

pseudocode:
streams <- readVECT6("streams")
str(streams)

and it is a huge list.  I am not sure the best way to tackle this problem.
thanks for any help,

-- 
Stephen Sefick

Let's not spend our time and resources thinking about things that are
so little or so large that all they really do for us is puff us up and
make us feel like gods.  We are mammals, and have not exhausted the
annoying little problems of being mammals.

								-K. Mullis


From Roger.Bivand at nhh.no  Mon Jul 13 00:32:21 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 13 Jul 2009 00:32:21 +0200 (CEST)
Subject: [R-sig-Geo] merging data with a dataframe based on a common
 identifier
In-Reply-To: <c502a9e10907120557y65627f74nb0a2546115021fe6@mail.gmail.com>
References: <c502a9e10907120557y65627f74nb0a2546115021fe6@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.0907130015380.21380@reclus.nhh.no>

On Sun, 12 Jul 2009, stephen sefick wrote:

> I have used v.strahler in GRASS to calculate the stream order.  This
> module writes its results to a text file.  The line column of the
> output data is the common name between the two data sets.  I would
> like to attach the stream order to the streams vector.  I have looked
> at the data once in R with
>
> pseudocode:
> streams <- readVECT6("streams")
> str(streams)

Well, v.strahler is a very fresh GRASS addon, not a regular part of GRASS, 
and does require a clean topology. Running it on streams in spearfish, 
with the elevation.dem DEM, gives an output vector map, say st_o0:

v.strahler --verbose --overwrite input=streams output=st_o0 \
   dem=elevation.dem txout=st_o0.txt sloppy=0 layer=1


st_o0 <- readVECT6("st_o0", type="line,boundary", with_c=TRUE,
   remove.duplicates=FALSE, plugin=FALSE)

gets 116 lines. They agree with the first 116 of 119 lines in st_o0.txt:

tbl <- read.table("st_o0.txt", skip=1, header=TRUE)

by plotting. For example:

plot(st_o0, col=rainbow(27)[tbl[1:116,]$Basin.])

looks plausible. However, where the streams are not fully connected, 
basins get split, with obvious consequences for the order. The cat in the 
vector layer seems to be the order too, as stated on the help page - I 
think that this is where the graphics on the help page are coming from. I 
think that this agrees with advice that your got on the grass-users list. 
It may be that you need to check the cleanness of the topology of the 
stream lines carefully - this is repeated on the help page. You may also 
need to read the v.strahler code to check what it is assigning, as:

plot(st_o0, col=tbl[1:116,]$Order.)

or equivalently:

plot(st_o0, col=st_o0$cat)

don't match my view of drainage in spearfish.

Hope this helps

Roger

>
> and it is a huge list.  I am not sure the best way to tackle this problem.
> thanks for any help,
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From greenberg at ucdavis.edu  Mon Jul 13 04:04:52 2009
From: greenberg at ucdavis.edu (Jonathan Greenberg)
Date: Sun, 12 Jul 2009 19:04:52 -0700
Subject: [R-sig-Geo] [R] strata -- really slow performance
In-Reply-To: <F96EB190-CE74-48C5-BB80-5A91BA399E51@me.com>
References: <4A593FA3.2070801@ucdavis.edu>
	<F96EB190-CE74-48C5-BB80-5A91BA399E51@me.com>
Message-ID: <4A5A9644.1050609@ucdavis.edu>

Marc:

    Thanks!  I wrote a semi-similar function (not as elegant as the one 
you have below) to do the stratified sampling via the sample function 
vs. the strata (from sampling) function and, yes, it is WAY faster.  
Seconds instead of hours.  I'll send a note to the sampling maintainer 
to see if they can take a look at whats going on with that function.  
The dataframe does have a lot of columns, but I'm confused why that 
should matter since strata is supposed to return an index (so, at least 
in theory, it should just be looking at the stratification columns, no?) 

    Again, thanks for looking into this -- verification that I'm not 
crazy and that function is behaving oddly was very helpful.

--j

P.S. "Also, the construct:

  uniqueids_stratasize <- c(1:length(uniqueids))*0+1

is rather strange. You are essentially creating a vector of 661 0's, 
then adding 1 to each element to get 661 1's. Why not use:

  rep(1, length(uniqueids)) "

--> Learn something new every day!  Wasn't familiar with the rep() 
function, so I got my vector of 1s the only way I currently knew how!

Marc Schwartz wrote:
>
> On Jul 11, 2009, at 8:42 PM, Jonathan Greenberg wrote:
>
>> I'm a bit confused why the following command is taking an 
>> extrodinarily long time (> 2-3 hours) to run on an 3.06ghz iMac 
>> (brand new).  I'm trying to do a stratified random sample, drawing 
>> only a single value per UniqueID from the patch_summary data frame:
>>
>> uniqueids <- unique(patch_summary$UniqueID)
>> uniqueids_stratasize <- c(1:length(uniqueids))*0+1
>> temp_species_patch_random_strata <- 
>> strata(patch_summary,c("UniqueID"),size=uniqueids_stratasize)
>>
>> The patch_summary data frame is too big to include in this email, but 
>> I'll give some summary results for the inputs.  patch_summary has 
>> 48253 rows, UniqueID has 661 levels, and uniqueid_stratasize is a 
>> vector if 661 "1"s (corresponding to the 661 levels from UniqueID -- 
>> as I said I only want one per UniqueID).
>>
>> Am I doing something silly here?  Am I using the wrong stratified 
>> sampling algorithm?  Any help would be appreciated -- thanks -- I 
>> don't see why a stratified sampling would take hours to run -- I am 
>> about to recode this as a series of subset statements which I'm sure 
>> will take only minutes...
>>
>> --j
>
>
> I presume that this is the strata() function from the sampling 
> package? That was unstated, but seems to be the only strata() function 
> that makes sense here.
>
> Also, the construct:
>
>   uniqueids_stratasize <- c(1:length(uniqueids))*0+1
>
> is rather strange. You are essentially creating a vector of 661 0's, 
> then adding 1 to each element to get 661 1's. Why not use:
>
>   rep(1, length(uniqueids))
>
> ?
>
>
> I installed the sampling package and ran the strata() function first 
> on the examples and then on some test data. The examples ran fine and 
> reasonably fast.
>
> The test data that I created (see below) had a basic structure of a 
> certain number of unique IDs and then just a record counter per ID. 
> There are 75 records per ID, just to pick the number that I used in 
> the sample data below. So the record counter runs from 1:75 for each ID.
>
> When I ran the strata() function on 10 unique IDs (750 records), it 
> took about 1 second to execute. However, when I ran the function with 
> 50 unique IDs (3750 records), it took about 25 seconds. For 100 unique 
> IDs (7500 records), it took around 90 seconds.
>
> This suggests to me that the problem that you are having is that the 
> strata() function does not scale well at all to large datasets, 
> perhaps being more sensitive to the number of unique strata. You might 
> want to contact the package maintainer to see if they intended the 
> function and/or package to be used with large datasets or not. I am 
> going to reasonably guess that they did not or at least, did not test 
> it on large datasets to optimize their algorithms.
>
>
> I am not clear how large your data frame is in terms of columns, but 
> if we create one to at least have the same number of unique IDs and 
> approximately the same number of records and create some specific code 
> to get one randomly selected record from each unique ID, it runs very 
> quickly.
>
>
> # Create a data frame with 661 unique IDs, 75 records per ID.
> # Include a second column with a counter of 1:75 for each ID
> DF <- data.frame(ID = rep(1:661, each = 75), RecNum = rep(1:75, 661))
>
>
> # Randomize the rows, so that the unique IDs are not sorted together
> DF <- DF[sample(661 * 75), ]
>
>
> > str(DF)
> 'data.frame':    49575 obs. of  2 variables:
>  $ ID    : int  512 587 640 602 148 250 31 487 336 145 ...
>  $ RecNum: int  14 23 72 49 39 56 58 17 37 8 ...
>
>
> # There are 661 unique IDs
> > length(unique(DF$ID))
> [1] 661
>
>
> # There are 75 of each
> > all(table(DF$ID) == 75)
> [1] TRUE
>
>
> # Now, get one randomly selected record per unique ID
> > system.time(DF.new <- do.call(rbind,
>                                 lapply(split(DF, DF$ID),
>                                        function(x) x[sample(nrow(x), 
> 1), ])))
>    user  system elapsed
>   0.361   0.110   0.478
>
>
> # We have 661 records now
> > str(DF.new)
> 'data.frame':    661 obs. of  2 variables:
>  $ ID    : int  1 2 3 4 5 6 7 8 9 10 ...
>  $ RecNum: int  54 3 73 5 6 19 51 7 18 8 ...
>
>
> # We have 661 unique IDs
> > length(unique(DF.new$ID))
> [1] 661
>
>
> # 1 record per ID
> > all(table(DF.new$ID) == 1)
> [1] TRUE
>
>
>
> In this simple example, it took less than half a second to generate 
> the result. That is on a 2.93 Ghz MacBook Pro.
>
>
> So, for your data, the code would look something like this:
>
>
> system.time(DF.new <- do.call(rbind,
>                               lapply(split(patch_summary, 
> patch_summary$UniqueID),
>                                      function(x) x[sample(nrow(x), 1), 
> ])))
>
>
> DF.new will contain your subset of data and you will get output 
> similar to mine above, with the time it took for the function to 
> execute. See ?system.time for more information.
>
> Try that and see if that works and how fast it executes on your actual 
> data.
>
> HTH,
>
> Marc Schwartz
>

-- 

Jonathan A. Greenberg, PhD
Postdoctoral Scholar
Center for Spatial Technologies and Remote Sensing (CSTARS)
University of California, Davis
One Shields Avenue
The Barn, Room 250N
Davis, CA 95616
Cell: 415-794-5043
AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307


From alobolistas at gmail.com  Mon Jul 13 11:02:17 2009
From: alobolistas at gmail.com (Agustin Lobo)
Date: Mon, 13 Jul 2009 11:02:17 +0200
Subject: [R-sig-Geo] spTransform: wrong results??
In-Reply-To: <alpine.LRH.2.00.0907121327050.18457@reclus.nhh.no>
References: <4A56F918.4040903@gmail.com>
	<alpine.LRH.2.00.0907101024460.12262@reclus.nhh.no>
	<alpine.LRH.2.00.0907101212490.12616@reclus.nhh.no>
	<27de757d0907100605o12bb6611g5babd8a570e1f786@mail.gmail.com>
	<alpine.LRH.2.00.0907101513180.3914@reclus.nhh.no>
	<27de757d0907100637mdfbe2e7u26eea41b42711e2f@mail.gmail.com>
	<4A59C4F4.2050507@gmail.com>
	<alpine.LRH.2.00.0907121327050.18457@reclus.nhh.no>
Message-ID: <4A5AF819.3020205@gmail.com>

Roger,

First at all, I think that the problem is solved.
Note that I was setting the CRS in QGIS, thus it is unequivocally
specified as EPSG 23031, then read into R through readOGR()

Anyway, the problem is that I was setting the towgs84 field as:
proj4string(wpcast300SPDF) <- CRS(paste(" +proj=utm +zone=31 +ellps=intl 
+units=m +towgs84=-84 -107 -120 +no_defs"))

while it must be:
proj4string(wpcast300SPDF) <- CRS(paste(" +proj=utm +zone=31 +ellps=intl 
+units=m +towgs84=-84,-107,-120 +no_defs"))

Note the "," !!!

With this I get:

Origianl point set in QGIS UTM 31N ED50
POINT(449919.586269 4631874.109627)	

TRANSFORMS TO LONGITUDE,LATITUDE:

Official reference (on-line tool of the Catalan Institute of Cartography)
ICC WGS84 2.395717586,41.835328397

GlobalMapper  ED50  2.39686371? E	41.83643863? N
GlobalMapper  WGS84 2.39572870? E	41.83535625? N

R (spTransform() in rgdal)
ED50 no towgs84 field specified
WP1	2.39686370617169	41.8364386271064

WGS84 no towgs84 field specified
WP1	2.39686370617169	41.8364386271064

WGS84 with towgs84=-87, -98,-121
(http://earth-info.nga.mil/GandG/coordsys/onlinedatum/CountryEuropeTable.html)
WP1  2.395729  41.83536

WGS84 with towgs84=-84,-107,-120
(http://www.asprs.org/resources/grids/)
WP1  2.395619  41.83535

The equivalent syntax in cs2cs:
cs2cs -v -f "%.9f" +init=epsg:23031 +towgs84=-87,-98,-121 +to 
+init=epsg:4326

provides identical output

Also note that the parameters found in http://earth-info.nga.mil
are closer to ICC output and identical to GlobalMapper output

I think that without the "," spTransform() was probably using just
the first parameter.

Thanks for your help!

Agus


Roger Bivand wrote:
> On Sun, 12 Jul 2009, Agustin Lobo wrote:
> 
>> Here you have some results with
>> different software for the transformation
>> of one single  UTM 31N ED50 coordinate to
>> lon,lat ED50 and lon,lat WGS84.
>> My understanding of this problem seems to
>> be decreasing as I do more testing.
>>
>> QGIS UTM 31N ED50
> 
> This isn't helpful, I'm afraid. You are starting from an unknown, not a 
> known. It isn't imposible that QGIS doesn't give a +towgs84 for 
> so-called ED50, because ED50 is *not* one datum but many.
> 
> Start with an unequivocally known point in a known datum, such as a GPS 
> reading in geographical coordinates and WGS84. Work from there, and it 
> should get clearer.
> 
> Datum definitions are not easy at all, because organisations typically 
> always worked within a single datum, and never needed to transform 
> (until oil was found across two different jurisdictions using different 
> datum standards, hence EPSG).
> 
> Roger
> 
>>
>> POINT(449919.586269 4631874.109627)
>>
>> TRANSFORMS TO LONGITUDE,LATITUDE:
>>
>> QGIS ED50
>> POINT(2.396864 41.836439)
>> QGIS WGS84
>> POINT(2.396864 41.836439)
>>
>> GlobalMapper  ED50  2.39686371? E    41.83643863? N
>> GlobalMapper  WGS84 2.39572870? E    41.83535625? N
>>
>> TNT WGS84
>> POINT(2.396864 41.836439)
>> TNT ED50
>> POINT(2.396864 41.836439)
>>
>> rgdal ED50 no towgs84 field specified
>> WP1    2.39686370617169    41.8364386271064
>>
>> rgdal WGS84 no towgs84 field specified
>> WP1    2.39686370617169    41.8364386271064
>>
>> rgdal WGS84 with towgs84=-87, -98,-121
>> WP1    2.39690750837097    41.8361433350555
>>
>>
>>
>> Agus
>>
>>
>>
>


From moliver at udel.edu  Mon Jul 13 16:26:23 2009
From: moliver at udel.edu (Matt Oliver)
Date: Mon, 13 Jul 2009 10:26:23 -0400
Subject: [R-sig-Geo] kml generation question
Message-ID: <6d4aad460907130726g7c4afa09y5aa4ef067c14b23f@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090713/0cec872c/attachment.pl>

From b.rowlingson at lancaster.ac.uk  Mon Jul 13 17:09:07 2009
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Mon, 13 Jul 2009 16:09:07 +0100
Subject: [R-sig-Geo] kml generation question
In-Reply-To: <6d4aad460907130726g7c4afa09y5aa4ef067c14b23f@mail.gmail.com>
References: <6d4aad460907130726g7c4afa09y5aa4ef067c14b23f@mail.gmail.com>
Message-ID: <d8ad40b50907130809m505c1ba0j7cdf30927d2c3e0c@mail.gmail.com>

On Mon, Jul 13, 2009 at 3:26 PM, Matt Oliver<moliver at udel.edu> wrote:
> Dear r-sig-geo,
>
> I am trying to generate a kml for an image I am producing using image().
> After reading about kml generation, I'm unsure if I sould be using
> kmlOverlay() or writeOGR, or some other function.
>
> This is the data
>
> http://www.ceoe.udel.edu/cms/moliver/20071003.276.0237.n17.nc
>
> require(ncdf)
> require(fields)
> f <- open.ncdf("20071003.276.0237.n17.nc")
>
> lon <- get.var.ncdf(f, "lon")
> lat <- get.var.ncdf(f, "lat")
> mcsst <- get.var.ncdf(f, "mcsst")
> plot(diff(lon)) #####notice decreasing
> par(mar=c(0, 0, 0, 0))
> par(bty="n")
>
> image(lon, lat, mcsst, col = tim.colors(64)) #####image I want to make kml
> for
>
> I don't seem to be able to make a proper "Spatial" object because of the
> unequally spaced geographic coordinates.This seems to be necessary to to
> proceed with a kml generation.
>
> I'm probably missing something simple so any help or example code would be
> wonderful
>

 KML does this kind of image overlay by taking an image file (PNG,
jpeg etc) and it's bounding box in lat-long. It can't cope with
irregular grids.

 My first thought as a workaround was to turn every pixel into a
rectangular polygon. But then I got the data and saw we were dealing
with 1445626 pixels and that google earth would probably crawl...

 So I think you'll need to resample your data onto a regular lat-long
grid, then save it as an image, and then write the relevant KML with
the bounds. The KML is quite simple:

 http://code.google.com/apis/kml/documentation/kml_tut.html#ground_overlays

 but the resampling might not be. I think I've written some resampling
code somewhere, it just works out where in the old array a bunch of
regularly spaced points are that will make the new array are, and
samples. There may be R code for doing interpolation - maybe the
rimage or RImageJ packages...

 But no, I don't think anything existing can do it [waits for Roger to
prove him wrong again...].

Barry


From moliver at udel.edu  Mon Jul 13 17:32:11 2009
From: moliver at udel.edu (Matt Oliver)
Date: Mon, 13 Jul 2009 11:32:11 -0400
Subject: [R-sig-Geo] kml generation question
In-Reply-To: <d8ad40b50907130809m505c1ba0j7cdf30927d2c3e0c@mail.gmail.com>
References: <6d4aad460907130726g7c4afa09y5aa4ef067c14b23f@mail.gmail.com>
	<d8ad40b50907130809m505c1ba0j7cdf30927d2c3e0c@mail.gmail.com>
Message-ID: <6d4aad460907130832t218c0ee7ne6f9af0492e76ce0@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090713/b76c3b78/attachment.pl>

From ashton at msu.edu  Mon Jul 13 17:35:38 2009
From: ashton at msu.edu (Ashton Shortridge)
Date: Mon, 13 Jul 2009 11:35:38 -0400
Subject: [R-sig-Geo] Slope and Aspect calculations in R
In-Reply-To: <4A578B95.9060108@noaa.gov>
References: <4A5626EA.4080306@noaa.gov>
	<7892DFE8F10046A19934132A846A145C@pcibed193>
	<4A578B95.9060108@noaa.gov>
Message-ID: <200907131135.38571.ashton@msu.edu>

Hello Josh, and list,

Figuring out how to link R with GIS may be extremely useful to you, not just 
for calculating slope and aspect, but also for other analyses in the future. 
There are also reasons you might not want to; I am one of those people who 
likes to write his own code. Consequently I implemented the Horne algorithm a 
while back - this is used in ESRI software for calculating slope. The code, a 
pretty simple function, is here:
https://www.msu.edu/~ashton/classes/866/notes/lab12/slope.R

Three caveats:
1. ESRI's version changes the neighborhood shape on the raster edges. The 
result is a slope grid with slopes calculated for every cell in the input 
elevation grid. The linked function only calculates slope on the interior 
cells. It returns a raster of the same dimension as the input, but there are 
no valid slope values around the edges.

2. Many developers on this list might agree with me that often the hardest 
part of coding spatial algorithms is dealing with the data structures. Over 
the years we've seen the development of increasingly sophisticated spatial 
data structures in R. My implementation dates from the Pleistocene of R, and 
is simply implemented on a matrix. Your data may have to be restructured to 
work seamlessly with this script, or you may wish to change the script to fit 
your structure.

3. While this function works perfectly adequately on smaller grids, it has not 
been tested on large matrices. It was not developed with speed in mind - the 
script was for a classroom exercise, and I wanted my students to be able to 
read the code and relate it to the published algorithm before executing it on 
fairly small datasets. If I wanted to calculate slope on huge grids, I'd 
personally do it in GRASS or Arc/Info, or in home-rolled C code. 

Hope this may be useful!

Ashton


On Friday 10 July 2009 14:42:29 Josh London wrote:
> Thanks to everyone for the feedback. I may dabble around with SAGA/RSAGA
> on a linux box we have and also continue to watch for any MacOS builds.
>
> Roger, I am especially excited that spgrass6 has the initGRASS()
> function. by providing access to r.slope.aspect, I think that will be
> the simplest/quickest route to a solution. I look forward to tapping
> into other GRASS commands in the future. You may want to consider
> changing the description of spgrass6 on CRAN. I have interpreted the
> phrase 'based on starting R from within the GRASS environment' to mean
> the package is for those who use GRASS and want to access functions
> within R.
>
> cheers, and thanks again for the feedback and help
>
> Josh
>

-- 
Ashton Shortridge
Associate Professor			ashton at msu.edu
Dept of Geography			http://www.msu.edu/~ashton
235 Geography Building		ph (517) 432-3561
Michigan State University		fx (517) 432-1671


From b.rowlingson at lancaster.ac.uk  Mon Jul 13 18:04:40 2009
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Mon, 13 Jul 2009 17:04:40 +0100
Subject: [R-sig-Geo] kml generation question
In-Reply-To: <6d4aad460907130832t218c0ee7ne6f9af0492e76ce0@mail.gmail.com>
References: <6d4aad460907130726g7c4afa09y5aa4ef067c14b23f@mail.gmail.com>
	<d8ad40b50907130809m505c1ba0j7cdf30927d2c3e0c@mail.gmail.com>
	<6d4aad460907130832t218c0ee7ne6f9af0492e76ce0@mail.gmail.com>
Message-ID: <d8ad40b50907130904w51d71338me80fa97f09aa0cc1@mail.gmail.com>

On Mon, Jul 13, 2009 at 4:32 PM, Matt Oliver<moliver at udel.edu> wrote:
> I tried to polygon.....you are right...too? slow
>
> I'm not sure how to resample to get a regular grid...using interp or interpp
> would not be wise because of the size of the grid...

 A quick bodge would be to ignore the slight change in lat long
spacing and create some new lat-long coords that are regularly spaced:

 > lonr=seq(min(lon),max(lon),len=length(lon))
 > latr=seq(min(lat),max(lat),len=length(lat))

 can you tell the difference between:

 > image(lonr,latr,mcsst)

and:

 > image(lon,lat,mcsst)

?

I'm sure the difference in longitude isn't worth worrying about:

 > range(diff(lon))
 [1] 0.01184845 0.01185608

 but the lat difference is possibly significant:

 > range(diff(lat))
 [1] 0.008270264 0.009750366

I'll see if I can dig up my resampling code - basically it created new
coordinates for lat and lon (as above) and then mapped those into
indexes in the array.

Barry


From Roger.Bivand at nhh.no  Mon Jul 13 18:12:07 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 13 Jul 2009 18:12:07 +0200 (CEST)
Subject: [R-sig-Geo] kml generation question
In-Reply-To: <d8ad40b50907130809m505c1ba0j7cdf30927d2c3e0c@mail.gmail.com>
References: <6d4aad460907130726g7c4afa09y5aa4ef067c14b23f@mail.gmail.com>
	<d8ad40b50907130809m505c1ba0j7cdf30927d2c3e0c@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.0907131803270.24271@reclus.nhh.no>

On Mon, 13 Jul 2009, Barry Rowlingson wrote:

> On Mon, Jul 13, 2009 at 3:26 PM, Matt Oliver<moliver at udel.edu> wrote:
>> Dear r-sig-geo,
>>
>> I am trying to generate a kml for an image I am producing using image().
>> After reading about kml generation, I'm unsure if I sould be using
>> kmlOverlay() or writeOGR, or some other function.
>>
>> This is the data
>>
>> http://www.ceoe.udel.edu/cms/moliver/20071003.276.0237.n17.nc
>>
>> require(ncdf)
>> require(fields)
>> f <- open.ncdf("20071003.276.0237.n17.nc")
>>
>> lon <- get.var.ncdf(f, "lon")
>> lat <- get.var.ncdf(f, "lat")
>> mcsst <- get.var.ncdf(f, "mcsst")
>> plot(diff(lon)) #####notice decreasing
>> par(mar=c(0, 0, 0, 0))
>> par(bty="n")
>>
>> image(lon, lat, mcsst, col = tim.colors(64)) #####image I want to make kml
>> for
>>
>> I don't seem to be able to make a proper "Spatial" object because of the
>> unequally spaced geographic coordinates.This seems to be necessary to to
>> proceed with a kml generation.
>>
>> I'm probably missing something simple so any help or example code would be
>> wonderful
>>
>
> KML does this kind of image overlay by taking an image file (PNG,
> jpeg etc) and it's bounding box in lat-long. It can't cope with
> irregular grids.
>
> My first thought as a workaround was to turn every pixel into a
> rectangular polygon. But then I got the data and saw we were dealing
> with 1445626 pixels and that google earth would probably crawl...
>
> So I think you'll need to resample your data onto a regular lat-long
> grid, then save it as an image, and then write the relevant KML with
> the bounds. The KML is quite simple:
>
> http://code.google.com/apis/kml/documentation/kml_tut.html#ground_overlays
>
> but the resampling might not be. I think I've written some resampling
> code somewhere, it just works out where in the old array a bunch of
> regularly spaced points are that will make the new array are, and
> samples. There may be R code for doing interpolation - maybe the
> rimage or RImageJ packages...
>
> But no, I don't think anything existing can do it [waits for Roger to
> prove him wrong again...].

Maybe ... ?

Something like (not yet ideal, some stripey artefacts caused by the cell 
steppings interfering with each other):

require(ncdf)
f <- open.ncdf("20071003.276.0237.n17.nc")
lon <- get.var.ncdf(f, "lon")
lat <- get.var.ncdf(f, "lat")
mcsst <- get.var.ncdf(f, "mcsst")
require(fields)
image(lon, lat, mcsst, col = tim.colors(64))
obj <- list(x=lon, y=lat, z=mcsst)
library(sp)
crds <- expand.grid(lon, lat)
SPDF <- SpatialPointsDataFrame(SpatialPoints(crds, 
proj4string=CRS("+proj=longlat +datum=WGS84")), 
data=data.frame(mcsst=c(mcsst)))
summary(SPDF)
bb <- bbox(SPDF)
grd <- GridTopology(bb[,1], c(diff(bb[1,])/1200, diff(bb[2,])/1200),
   c(1200,1200))
SG <- SpatialGrid(grd, CRS("+proj=longlat +datum=WGS84"))
o <- overlay(SG, SPDF)
oo <- tapply(SPDF$mcsst, o, mean, na.rm=TRUE)
df <- data.frame(mcsst=rep(NA, 1200*1200))
df$mcsst[as.integer(names(oo))] <- oo
summary(df)
SGDF <- SpatialGridDataFrame(grd, CRS("+proj=longlat +datum=WGS84"),
   data=df)
x11()
image(SGDF, col = tim.colors(64), axes=TRUE)


from there follow ?kmlOverlay, using the example as a template, with 
image() instead of plot(). At least it's something.

Roger


>
> Barry
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From moliver at udel.edu  Mon Jul 13 18:25:21 2009
From: moliver at udel.edu (Matt Oliver)
Date: Mon, 13 Jul 2009 12:25:21 -0400
Subject: [R-sig-Geo] kml generation question
In-Reply-To: <d8ad40b50907130904w51d71338me80fa97f09aa0cc1@mail.gmail.com>
References: <6d4aad460907130726g7c4afa09y5aa4ef067c14b23f@mail.gmail.com>
	<d8ad40b50907130809m505c1ba0j7cdf30927d2c3e0c@mail.gmail.com>
	<6d4aad460907130832t218c0ee7ne6f9af0492e76ce0@mail.gmail.com>
	<d8ad40b50907130904w51d71338me80fa97f09aa0cc1@mail.gmail.com>
Message-ID: <6d4aad460907130925q2e5cf3ebi7dbb0d15b92def96@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090713/dbb22ec5/attachment.pl>

From j.burke at earthlink.net  Tue Jul 14 00:55:19 2009
From: j.burke at earthlink.net (Jim Burke)
Date: Mon, 13 Jul 2009 17:55:19 -0500
Subject: [R-sig-Geo] Problem with %IN% ==FALSE when data frames are equal
Message-ID: <4A5BBB57.2050207@earthlink.net>

Hi everyone

I have a issue with %IN% using FALSE deep within my
R code processing. It errors if the comparison data
frames are equal.

DESIRED WORK AROUND: I would like examine my %IN% data
frame fields before submitting then to the erroring
block of code. Then appropriately trap this error.
Any suggestions?

OVERVIEW: seems [sp$block %IN% df$ID==FALSE] chokes when
sp and df contain equal variables. My normal processing is
to take the larger sp and get all larger sp blocks that
are not in the smaller sp. As I process the list, it
goes well until the last item when both sets of data
frame variables are equal.


PROBLEM:

###############################################
## remove blocks that we just found in pct_blk_df
###############################################
tmp_hd_census_blk_sp <- hd_census_blk_sp [ (hd_census_blk_sp$BLKIDFP00 
%in% pct_blk_df$ID==FALSE),]

Error in lst[[i]] : subscript out of bounds
 > traceback()
2: .bboxCalcR(x at polygons)
1: hd_census_blk_sp[(hd_census_blk_sp$BLKIDFP00 %in% pct_blk_df$ID ==
       FALSE), ]

INPUTS:
 > hd_census_blk_sp$BLKIDFP00
 [1] 481130089001000 481130086032001 481130034002043 481130086032002
 [5] 481130034002046 481130086032004 481130034002047 481130086032000
 [9] 481130086032009 481130034002044 481130086032005 481130034002048
[13] 481130089001013 481130086032007 481130086032010 481130089001014
[17] 481130086032003
28480 Levels: 481130001001000 481130001001001 481130001001002 ... 
481130199004013
 > pct_blk_df$ID
 [1] 481130089001000 481130086032001 481130034002043 481130086032002
 [5] 481130034002046 481130086032004 481130034002047 481130086032000
 [9] 481130086032009 481130034002044 481130086032005 481130034002048
[13] 481130089001013 481130086032007 481130086032010 481130089001014
[17] 481130086032003
28480 Levels: 481130001001000 481130001001001 481130001001002 ... 
481130199004013

Thanks,
Jim Burke

PS My thanks to Gledson Luiz Picharski for his help initially with this 
"outside of %IN%" logic.


From Roger.Bivand at nhh.no  Tue Jul 14 07:21:37 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 14 Jul 2009 07:21:37 +0200 (CEST)
Subject: [R-sig-Geo] Problem with %IN% ==FALSE when data frames are equal
In-Reply-To: <4A5BBB57.2050207@earthlink.net>
References: <4A5BBB57.2050207@earthlink.net>
Message-ID: <alpine.LRH.2.00.0907140706590.26855@reclus.nhh.no>

On Mon, 13 Jul 2009, Jim Burke wrote:

> Hi everyone
>
> I have a issue with %IN% using FALSE deep within my
> R code processing. It errors if the comparison data
> frames are equal.
>
> DESIRED WORK AROUND: I would like examine my %IN% data
> frame fields before submitting then to the erroring
> block of code. Then appropriately trap this error.
> Any suggestions?

Exactly. Just calculate the condition vector first, then condition with 
for example if(any()), only subsetting with "[" if the condition is met. 
You'll have to decide what to do if it isn't.

Always try small examples interactively before writing complicated and (in 
this case) logically flawed scripts - you were assuming that at least one 
logical vector value would be true.

Note that %in% and match() do the same thing, so you can also do match() - 
check the ordering of arguments first! - and check for NAs in the returned 
index vector - or use which() on the condition, checking on the length of 
the output; this is what "[" does internally.

match(c("a", "c", "e"), letters)
match(c("A"), letters)
which(letters %in% c("a", "c", "e"))
which(letters %in% c("A"))
length(which(letters %in% c("A")))

Hope this helps,

Roger

>
> OVERVIEW: seems [sp$block %IN% df$ID==FALSE] chokes when
> sp and df contain equal variables. My normal processing is
> to take the larger sp and get all larger sp blocks that
> are not in the smaller sp. As I process the list, it
> goes well until the last item when both sets of data
> frame variables are equal.
>
>
> PROBLEM:
>
> ###############################################
> ## remove blocks that we just found in pct_blk_df
> ###############################################
> tmp_hd_census_blk_sp <- hd_census_blk_sp [ (hd_census_blk_sp$BLKIDFP00 %in% 
> pct_blk_df$ID==FALSE),]
>
> Error in lst[[i]] : subscript out of bounds
>> traceback()
> 2: .bboxCalcR(x at polygons)
> 1: hd_census_blk_sp[(hd_census_blk_sp$BLKIDFP00 %in% pct_blk_df$ID ==
>      FALSE), ]
>
> INPUTS:
>> hd_census_blk_sp$BLKIDFP00
> [1] 481130089001000 481130086032001 481130034002043 481130086032002
> [5] 481130034002046 481130086032004 481130034002047 481130086032000
> [9] 481130086032009 481130034002044 481130086032005 481130034002048
> [13] 481130089001013 481130086032007 481130086032010 481130089001014
> [17] 481130086032003
> 28480 Levels: 481130001001000 481130001001001 481130001001002 ... 
> 481130199004013
>> pct_blk_df$ID
> [1] 481130089001000 481130086032001 481130034002043 481130086032002
> [5] 481130034002046 481130086032004 481130034002047 481130086032000
> [9] 481130086032009 481130034002044 481130086032005 481130034002048
> [13] 481130089001013 481130086032007 481130086032010 481130089001014
> [17] 481130086032003
> 28480 Levels: 481130001001000 481130001001001 481130001001002 ... 
> 481130199004013
>
> Thanks,
> Jim Burke
>
> PS My thanks to Gledson Luiz Picharski for his help initially with this 
> "outside of %IN%" logic.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From alobolistas at gmail.com  Tue Jul 14 09:42:54 2009
From: alobolistas at gmail.com (Agustin Lobo)
Date: Tue, 14 Jul 2009 09:42:54 +0200
Subject: [R-sig-Geo] more doubts with spTransform()
Message-ID: <4A5C36FE.5010905@gmail.com>

Inverse transform now:
 > anyellaWGS84 <- readOGR(dsn=".", layer="parcellesAnyellaWGS84")
OGR data source with driver: ESRI Shapefile
Source: ".", layer: "parcellesAnyellaWGS84"
with  6  rows and  7  columns
Feature type: wkbPoint with 2 dimensions
 > proj4string(anyellaWGS84)
[1] " +proj=utm +zone=31 +ellps=WGS84 +datum=WGS84 +units=m +no_defs 
+towgs84=0,0,0"
 > anyellaED50notowgs84 <- spTransform(anyellaWGS84,CRS("+proj=utm 
+zone=31 +ellps=intl +units=m +no_defs"))
 > anyellaED50towgs84 <- spTransform(anyellaWGS84,CRS("+proj=utm 
+zone=31 +ellps=intl +units=m +no_defs +towgs84=-87,-98,-121"))
 > coordinates(anyellaWGS84)[1,]
coords.x1 coords.x2
   421005   4683849
 > coordinates(anyellaED50notowgs84)[1,]
coords.x1 coords.x2
 421001.4 4683932.4
 > coordinates(anyellaED50towgs84)[1,]
coords.x1 coords.x2
 421097.5 4684050.9

which is correct? anyellaED50notowgs84 or anyellaED50towgs84 ?

I guess anyellaED50towgs84, but would like to confirm,

Thanks

Agus
-------------- next part --------------
A non-text attachment was scrubbed...
Name: alobolistas.vcf
Type: text/x-vcard
Size: 251 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090714/e5f6f165/attachment.vcf>

From Roger.Bivand at nhh.no  Tue Jul 14 10:06:07 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 14 Jul 2009 10:06:07 +0200 (CEST)
Subject: [R-sig-Geo] more doubts with spTransform()
In-Reply-To: <4A5C36FE.5010905@gmail.com>
References: <4A5C36FE.5010905@gmail.com>
Message-ID: <alpine.LRH.2.00.0907140954390.27266@reclus.nhh.no>

On Tue, 14 Jul 2009, Agustin Lobo wrote:

> Inverse transform now:
>> anyellaWGS84 <- readOGR(dsn=".", layer="parcellesAnyellaWGS84")
> OGR data source with driver: ESRI Shapefile
> Source: ".", layer: "parcellesAnyellaWGS84"
> with  6  rows and  7  columns
> Feature type: wkbPoint with 2 dimensions
>> proj4string(anyellaWGS84)
> [1] " +proj=utm +zone=31 +ellps=WGS84 +datum=WGS84 +units=m +no_defs 
> +towgs84=0,0,0"
>> anyellaED50notowgs84 <- spTransform(anyellaWGS84,CRS("+proj=utm +zone=31 
> +ellps=intl +units=m +no_defs"))
>> anyellaED50towgs84 <- spTransform(anyellaWGS84,CRS("+proj=utm +zone=31 
> +ellps=intl +units=m +no_defs +towgs84=-87,-98,-121"))
>> coordinates(anyellaWGS84)[1,]
> coords.x1 coords.x2
>  421005   4683849
>> coordinates(anyellaED50notowgs84)[1,]
> coords.x1 coords.x2
> 421001.4 4683932.4
>> coordinates(anyellaED50towgs84)[1,]
> coords.x1 coords.x2
> 421097.5 4684050.9
>
> which is correct? anyellaED50notowgs84 or anyellaED50towgs84 ?
>
> I guess anyellaED50towgs84, but would like to confirm,

Good guess! In the no +towgs84 case, the ellipsoid is being used but not 
datum transformation, which leaves a contradiction between a declared 
ellipsoid and the one inherent in the default datum (WGS84). Providing the 
+towgs84 transforms to the datum expressed in the given parameters, which 
is one of the ED50 family.

The difference is anout 100m in each direction. Maybe try this on an 
easily identifiable known ground control point where you have positional 
data from several maps, like the corner of a building or a bridge pier.

Roger

>
> Thanks
>
> Agus
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From hengl at spatial-analyst.net  Tue Jul 14 10:17:15 2009
From: hengl at spatial-analyst.net (Tomislav Hengl)
Date: Tue, 14 Jul 2009 10:17:15 +0200
Subject: [R-sig-Geo] more doubts with spTransform()
In-Reply-To: <4A5C36FE.5010905@gmail.com>
References: <4A5C36FE.5010905@gmail.com>
Message-ID: <148257B52A2641D09A31141B76AB200B@pcibed193>


Hi Agustin,

You should really work with some referent point for which you know both local and geographic (WGS84)
coordinates.

Here is an illustration:

http://spatial-analyst.net/wiki/index.php?title=MGI_/_Balkans_coordinate_systems#Validation_of_CRS_p
arameters 

Note that I use Google Earth imagery to validate that everything is fine.

I agree - setting up the right CRS can be a headache, but there are many 'hard' (historic,
technology connected etc) reasons for this. The good thing is that: once you got it right, you soon
forget about all these problems.


HTH,

T. Hengl



> -----Original Message-----
> From: r-sig-geo-bounces at stat.math.ethz.ch [mailto:r-sig-geo-bounces at stat.math.ethz.ch] On Behalf
> Of Agustin Lobo
> Sent: Tuesday, July 14, 2009 9:43 AM
> To: sig-geo
> Subject: [R-sig-Geo] more doubts with spTransform()
> 
> Inverse transform now:
>  > anyellaWGS84 <- readOGR(dsn=".", layer="parcellesAnyellaWGS84")
> OGR data source with driver: ESRI Shapefile
> Source: ".", layer: "parcellesAnyellaWGS84"
> with  6  rows and  7  columns
> Feature type: wkbPoint with 2 dimensions
>  > proj4string(anyellaWGS84)
> [1] " +proj=utm +zone=31 +ellps=WGS84 +datum=WGS84 +units=m +no_defs
> +towgs84=0,0,0"
>  > anyellaED50notowgs84 <- spTransform(anyellaWGS84,CRS("+proj=utm
> +zone=31 +ellps=intl +units=m +no_defs"))
>  > anyellaED50towgs84 <- spTransform(anyellaWGS84,CRS("+proj=utm
> +zone=31 +ellps=intl +units=m +no_defs +towgs84=-87,-98,-121"))
>  > coordinates(anyellaWGS84)[1,]
> coords.x1 coords.x2
>    421005   4683849
>  > coordinates(anyellaED50notowgs84)[1,]
> coords.x1 coords.x2
>  421001.4 4683932.4
>  > coordinates(anyellaED50towgs84)[1,]
> coords.x1 coords.x2
>  421097.5 4684050.9
> 
> which is correct? anyellaED50notowgs84 or anyellaED50towgs84 ?
> 
> I guess anyellaED50towgs84, but would like to confirm,
> 
> Thanks
> 
> Agus


From alobolistas at gmail.com  Tue Jul 14 10:29:00 2009
From: alobolistas at gmail.com (Agustin Lobo)
Date: Tue, 14 Jul 2009 10:29:00 +0200
Subject: [R-sig-Geo] more doubts with spTransform()
In-Reply-To: <alpine.LRH.2.00.0907140954390.27266@reclus.nhh.no>
References: <4A5C36FE.5010905@gmail.com>
	<alpine.LRH.2.00.0907140954390.27266@reclus.nhh.no>
Message-ID: <4A5C41CC.8020009@gmail.com>

Confirmed using Global Mapper, one of the
few packages performing correct on-the-fly reprojection.
(The demo is free of charge, although you cannot save your work
it's very useful to check things out. And I'm
using it on linux through wine). In Global Mapper,
both shapes exported from anyellaWGS84 and
anyellaED50towgs84 are coincident.
This is not the case in QGIS, which seems to ignore the towgs84 field.
(Although I have to try writing that field on my own in QGIS).

Just to note that this is not a paranoid obsession.
People using non-WGS84 datums and saving to
kml to visualize (or let others visualize) spatial
features in google maps will get significant errors,
as google maps is on WGS84. In this particular case,
field plots on grassland were in the forest according
to the previous kml & google maps. Perhaps
an explicit mention of the kml problem would be
worth in the spTransform help page.

Thanks a lot for your help.

Agus



Roger Bivand wrote:
> On Tue, 14 Jul 2009, Agustin Lobo wrote:
> 
>> Inverse transform now:
>>> anyellaWGS84 <- readOGR(dsn=".", layer="parcellesAnyellaWGS84")
>> OGR data source with driver: ESRI Shapefile
>> Source: ".", layer: "parcellesAnyellaWGS84"
>> with  6  rows and  7  columns
>> Feature type: wkbPoint with 2 dimensions
>>> proj4string(anyellaWGS84)
>> [1] " +proj=utm +zone=31 +ellps=WGS84 +datum=WGS84 +units=m +no_defs 
>> +towgs84=0,0,0"
>>> anyellaED50notowgs84 <- spTransform(anyellaWGS84,CRS("+proj=utm +zone=31 
>> +ellps=intl +units=m +no_defs"))
>>> anyellaED50towgs84 <- spTransform(anyellaWGS84,CRS("+proj=utm +zone=31 
>> +ellps=intl +units=m +no_defs +towgs84=-87,-98,-121"))
>>> coordinates(anyellaWGS84)[1,]
>> coords.x1 coords.x2
>>  421005   4683849
>>> coordinates(anyellaED50notowgs84)[1,]
>> coords.x1 coords.x2
>> 421001.4 4683932.4
>>> coordinates(anyellaED50towgs84)[1,]
>> coords.x1 coords.x2
>> 421097.5 4684050.9
>>
>> which is correct? anyellaED50notowgs84 or anyellaED50towgs84 ?
>>
>> I guess anyellaED50towgs84, but would like to confirm,
> 
> Good guess! In the no +towgs84 case, the ellipsoid is being used but not 
> datum transformation, which leaves a contradiction between a declared 
> ellipsoid and the one inherent in the default datum (WGS84). Providing 
> the +towgs84 transforms to the datum expressed in the given parameters, 
> which is one of the ED50 family.
> 
> The difference is anout 100m in each direction. Maybe try this on an 
> easily identifiable known ground control point where you have positional 
> data from several maps, like the corner of a building or a bridge pier.
> 
> Roger
> 
>>
>> Thanks
>>
>> Agus
>>
> 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: alobolistas.vcf
Type: text/x-vcard
Size: 251 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090714/1128e598/attachment.vcf>

From alexandre.villers at cebc.cnrs.fr  Tue Jul 14 10:46:34 2009
From: alexandre.villers at cebc.cnrs.fr (alexandre villers)
Date: Tue, 14 Jul 2009 10:46:34 +0200
Subject: [R-sig-Geo] getting subfolders in a directory on FTP (MODIS)
Message-ID: <1247561194.823c2d4alexandre.villers@cebc.cnrs.fr>

Good morning,

I know this is not exactly a question for R SIG GEO, but as it may interest beginners like me who work with MODIS data... (and I'm hoping I'm not the only beginner on the list !)
I adapted the script of Tomislav Hengl (again thank you for your wiki page! http://spatial-analyst.net/wiki/index.php?title=Main_Page) to download snow cover MODIS data form NSIDC (http://nsidc.org/) from their ftp site (the data I'm interested in lie in ftp://n4ftl01u.ecs.nasa.gov/SAN/MOST/MOD10CM.005/ <-- monthly snow cover). MODIS data are stored in subfolders named by their dates and I already had the same troubles with other MODIS data. How do I get the list of subfolders name directly from R and thus the dates of satellite pictures ?
For the moment, what I've been doing is going on the ftp via my browser, copy and paste the whole page in a .txt file and manage that with excel to get the dates... But I don't really like doing it that way.

So if anyone could guide me to a R function that would do that (or to the different functions if it's not straigthforward)...

Best regards


Alex
Alexandre Villers
PhD. Student
Team Biodiversity
CEBC CNRS
79360 Beauvoir sur Niort


__________ Information from ESET Mail Security, version of virus signature database 4240 (20090713) __________

The message was checked by ESET Mail Security.
http://www.eset.com


From pecardoso at netcabo.pt  Tue Jul 14 12:57:29 2009
From: pecardoso at netcabo.pt (Paulo E. Cardoso)
Date: Tue, 14 Jul 2009 11:57:29 +0100
Subject: [R-sig-Geo] get coordinates of centroids in a SpatialGridDataFrame
	object.
Message-ID: <!&!AAAAAAAAAAAYAAAAAAAAAK2N38q7o51Ejb8q0JfvLrBiggAAEAAAAPQ5MxHWHSNDiv3NzyOKNAEBAAAAAA==@netcabo.pt>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090714/6801ee02/attachment.pl>

From moliver at udel.edu  Tue Jul 14 15:05:23 2009
From: moliver at udel.edu (Matt Oliver)
Date: Tue, 14 Jul 2009 09:05:23 -0400
Subject: [R-sig-Geo] kml generation question
In-Reply-To: <alpine.LRH.2.00.0907131803270.24271@reclus.nhh.no>
References: <6d4aad460907130726g7c4afa09y5aa4ef067c14b23f@mail.gmail.com>
	<d8ad40b50907130809m505c1ba0j7cdf30927d2c3e0c@mail.gmail.com>
	<alpine.LRH.2.00.0907131803270.24271@reclus.nhh.no>
Message-ID: <6d4aad460907140605l52ce9e3dm1c5e8f41f2aeba60@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090714/9188ed35/attachment.pl>

From hengl at spatial-analyst.net  Tue Jul 14 15:12:07 2009
From: hengl at spatial-analyst.net (Tomislav Hengl)
Date: Tue, 14 Jul 2009 15:12:07 +0200
Subject: [R-sig-Geo] getting subfolders in a directory on FTP (MODIS)
In-Reply-To: <1247561194.823c2d4alexandre.villers@cebc.cnrs.fr>
References: <1247561194.823c2d4alexandre.villers@cebc.cnrs.fr>
Message-ID: <6170B2AD270D4FC0AD37AA5890841C09@pcibed193>


> -----Original Message-----
> From: r-sig-geo-bounces at stat.math.ethz.ch [mailto:r-sig-geo-bounces at stat.math.ethz.ch] On Behalf
> Of alexandre villers
> Sent: Tuesday, July 14, 2009 10:47 AM
> To: r-sig-geo at stat.math.ethz.ch
> Subject: [R-sig-Geo] getting subfolders in a directory on FTP (MODIS)
> 
> Good morning,
> 
> I know this is not exactly a question for R SIG GEO, but as it may interest beginners like me who
> work with MODIS data... (and I'm hoping I'm not the only beginner on the list !)
> I adapted the script of Tomislav Hengl (again thank you for your wiki page! http://spatial-
> analyst.net/wiki/index.php?title=Main_Page) to download snow cover MODIS data form NSIDC
> (http://nsidc.org/) from their ftp site (the data I'm interested in lie in
> ftp://n4ftl01u.ecs.nasa.gov/SAN/MOST/MOD10CM.005/ <-- monthly snow cover). MODIS data are stored
> in subfolders named by their dates and I already had the same troubles with other MODIS data. How
> do I get the list of subfolders name directly from R and thus the dates of satellite pictures ?

If the directories were on you machine, you would list them using:

> library(R.utils)
> ld <- listDirectory(R.home(), recursive=TRUE, fullNames=TRUE)

To tell you honestly, I could not figure out how to fetch names of sub-folders from an ftp (maybe it
is simply not possible?), but to list all files is not a problem:

> tmp <- strsplit(getURL("ftp://n4ftl01u.ecs.nasa.gov/SAN/MOST/MOD10CM.005/2000.04.01/",
.opts=curlOptions(ftplistonly=TRUE)), "\r\n")[[1]]
> tmp[1:2]
[1] "MOD10CM.A2000092.005.2007180145722.hdf"    
[2] "MOD10CM.A2000092.005.2007180145722.hdf.xml"

Maybe you should take a better look at the "RCurl" library (maybe wget is the solution?
http://users.ugent.be/~bpuype/wget/).

It's not really such a big problem because you only need to get the names of the subfolders (dates)
once, which are in principle unique for most of the MODIS products. You can also write them by hand
e.g.:

dates <- data.frame(dirname=c("2001.08.13", "2002.08.13", "2003.08.13", "2004.08.12", "2005.08.13",
"2006.08.13", "2007.08.13", "2008.08.12"))

> For the moment, what I've been doing is going on the ftp via my browser, copy and paste the whole
> page in a .txt file and manage that with excel to get the dates... But I don't really like doing
> it that way.
> So if anyone could guide me to a R function that would do that (or to the different functions if
> it's not straigthforward)...
> 
> Best regards
> 
> 
> Alex
> Alexandre Villers
> PhD. Student
> Team Biodiversity
> CEBC CNRS
> 79360 Beauvoir sur Niort
> 
> 
> __________ Information from ESET Mail Security, version of virus signature database 4240
> (20090713) __________
> 
> The message was checked by ESET Mail Security.
> http://www.eset.com
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

T. Hengl
http://spatial-analyst.net/wiki/index.php?title=Download_and_resampling_of_MODIS_images


From pecardoso at netcabo.pt  Tue Jul 14 15:32:23 2009
From: pecardoso at netcabo.pt (Paulo E. Cardoso)
Date: Tue, 14 Jul 2009 14:32:23 +0100
Subject: [R-sig-Geo] Convert SpatialGridDataFrame to gridTopology object
Message-ID: <!&!AAAAAAAAAAAYAAAAAAAAAK2N38q7o51Ejb8q0JfvLrBiggAAEAAAAIwf1h88TRxDpkWHzAGEXbkBAAAAAA==@netcabo.pt>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090714/c86fb891/attachment.pl>

From Roger.Bivand at nhh.no  Tue Jul 14 16:30:59 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 14 Jul 2009 16:30:59 +0200 (CEST)
Subject: [R-sig-Geo] get coordinates of centroids in a
 SpatialGridDataFrame object.
In-Reply-To: <!&!AAAAAAAAAAAYAAAAAAAAAK2N38q7o51Ejb8q0JfvLrBiggAAEAAAAPQ5MxHWHSNDiv3NzyOKNAEBAAAAAA==@netcabo.pt>
References: <!&!AAAAAAAAAAAYAAAAAAAAAK2N38q7o51Ejb8q0JfvLrBiggAAEAAAAPQ5MxHWHSNDiv3NzyOKNAEBAAAAAA==@netcabo.pt>
Message-ID: <alpine.LRH.2.00.0907141628550.28237@reclus.nhh.no>

On Tue, 14 Jul 2009, Paulo E. Cardoso wrote:

> I have a classified images imported as SpatialGridDataFrame. I'd like to get
> centroid coordinates of regions of cells with common values, considering the
> "islands" that represents objects in space.

If you are thinking of "connected components", try labcon() in adehabitat:

library(adehabitat)
data(puechabon)
hr <- getsahrlocs(puechabon$sahr, "hr")
u <- getkasc(hr, "Jean")
p <- labcon(u)
c2a <- kasc2spixdf(as.kasc(list(p)))
names(c2a) <- "patches"
image(c2a)
c2b <- as.SpatialPolygons.SpatialPixels(c2a)
library(maptools)
c2c <- unionSpatialPolygons(c2b, c2a$patches)
plot(c2c, axes=TRUE)
points(coordinates(c2c), pch=3)

How this scales for your data is another matter.

Roger

>
> Any idea?
>
> ____________
>
> Paulo E. Cardoso
>
>
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From Roger.Bivand at nhh.no  Tue Jul 14 16:34:53 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 14 Jul 2009 16:34:53 +0200 (CEST)
Subject: [R-sig-Geo] Convert SpatialGridDataFrame to gridTopology object
In-Reply-To: <!&!AAAAAAAAAAAYAAAAAAAAAK2N38q7o51Ejb8q0JfvLrBiggAAEAAAAIwf1h88TRxDpkWHzAGEXbkBAAAAAA==@netcabo.pt>
References: <!&!AAAAAAAAAAAYAAAAAAAAAK2N38q7o51Ejb8q0JfvLrBiggAAEAAAAIwf1h88TRxDpkWHzAGEXbkBAAAAAA==@netcabo.pt>
Message-ID: <alpine.LRH.2.00.0907141634320.28237@reclus.nhh.no>

On Tue, 14 Jul 2009, Paulo E. Cardoso wrote:

> How can I convert one to another?
>
library(sp)
data(meuse.grid)
coordinates(meuse.grid) <- c("x", "y")
gridded(meuse.grid) <- TRUE
fullgrid(meuse.grid) <- TRUE
class(meuse.grid)
grd <- slot(meuse.grid, "grid")
class(grd)

> ____________
>
> Paulo E. Cardoso
>
>
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From b.rowlingson at lancaster.ac.uk  Tue Jul 14 16:53:18 2009
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Tue, 14 Jul 2009 15:53:18 +0100
Subject: [R-sig-Geo] getting subfolders in a directory on FTP (MODIS)
In-Reply-To: <6170B2AD270D4FC0AD37AA5890841C09@pcibed193>
References: <1247561194.823c2d4alexandre.villers@cebc.cnrs.fr>
	<6170B2AD270D4FC0AD37AA5890841C09@pcibed193>
Message-ID: <d8ad40b50907140753p17c29041u3146e4cda3477ec6@mail.gmail.com>

On Tue, Jul 14, 2009 at 2:12 PM, Tomislav
Hengl<hengl at spatial-analyst.net> wrote:

> To tell you honestly, I could not figure out how to fetch names of sub-folders from an ftp (maybe it
> is simply not possible?),

 Apparently the FTP spec doesn't specify how to return a list of
directories, which, I read, "is a source of headaches to FTP client
developers".

 If you do:

 resp = getURL("ftp://n4ftl01u.ecs.nasa.gov/SAN/MOST/MOD10CM.005/")
 items = strsplit(resp,"\n")[[1]]

you get the folders (and files) but the folder names are in the form
of a unix directory listing. So you then want the last word of any
lines that start with 'd'. Lets get the lines first:

 folderLines = items[substr(items,1,1)=='d']

that gets you all the lines. There's probably a neater way of getting
the last word than this:

 lastBit <- function(x){x[length(x)]}

 dirs = unlist(lapply(strsplit(folderLines," "),lastBit))

Note this only works on the FTP server specified, other FTP servers
are at liberty to send back any dir format they want (I think I was
surprised the first time I connected to a DOS-based FTP server and saw
a DOS DIR listing!).

Barry


From hengl at spatial-analyst.net  Tue Jul 14 17:58:42 2009
From: hengl at spatial-analyst.net (Tomislav Hengl)
Date: Tue, 14 Jul 2009 17:58:42 +0200
Subject: [R-sig-Geo] getting subfolders in a directory on FTP (MODIS)
In-Reply-To: <d8ad40b50907140753p17c29041u3146e4cda3477ec6@mail.gmail.com>
References: <1247561194.823c2d4alexandre.villers@cebc.cnrs.fr>
	<6170B2AD270D4FC0AD37AA5890841C09@pcibed193>
	<d8ad40b50907140753p17c29041u3146e4cda3477ec6@mail.gmail.com>
Message-ID: <78A3E56F4553456B97A2A0E68593C5F4@pcibed193>


Hey Barry,

Your code works fine (at least with the NASA ftps). Thanks!

I knew it - everything is possible in R  :) 

T. Hengl
http://spatial-analyst.net 


> -----Original Message-----
> From: b.rowlingson at googlemail.com [mailto:b.rowlingson at googlemail.com] On Behalf Of Barry
> Rowlingson
> Sent: Tuesday, July 14, 2009 4:53 PM
> To: Tomislav Hengl
> Cc: alexandre villers; r-sig-geo at stat.math.ethz.ch
> Subject: Re: [R-sig-Geo] getting subfolders in a directory on FTP (MODIS)
> 
> On Tue, Jul 14, 2009 at 2:12 PM, Tomislav
> Hengl<hengl at spatial-analyst.net> wrote:
> 
> > To tell you honestly, I could not figure out how to fetch names of sub-folders from an ftp
> (maybe it
> > is simply not possible?),
> 
>  Apparently the FTP spec doesn't specify how to return a list of
> directories, which, I read, "is a source of headaches to FTP client
> developers".
> 
>  If you do:
> 
>  resp = getURL("ftp://n4ftl01u.ecs.nasa.gov/SAN/MOST/MOD10CM.005/")
>  items = strsplit(resp,"\n")[[1]]
> 
> you get the folders (and files) but the folder names are in the form
> of a unix directory listing. So you then want the last word of any
> lines that start with 'd'. Lets get the lines first:
> 
>  folderLines = items[substr(items,1,1)=='d']
> 
> that gets you all the lines. There's probably a neater way of getting
> the last word than this:
> 
>  lastBit <- function(x){x[length(x)]}
> 
>  dirs = unlist(lapply(strsplit(folderLines," "),lastBit))
> 
> Note this only works on the FTP server specified, other FTP servers
> are at liberty to send back any dir format they want (I think I was
> surprised the first time I connected to a DOS-based FTP server and saw
> a DOS DIR listing!).
> 
> Barry


From alexandre.villers at cebc.cnrs.fr  Tue Jul 14 18:11:37 2009
From: alexandre.villers at cebc.cnrs.fr (alexandre villers)
Date: Tue, 14 Jul 2009 18:11:37 +0200
Subject: [R-sig-Geo] getting subfolders in a directory on FTP (MODIS)
Message-ID: <1247587897.82f6c84alexandre.villers@cebc.cnrs.fr>

Dear Barry,

Thank you very much for this ! This will really help !
Best regards

Alex

Alexandre Villers
PhD. Student
Team Biodiversity
CEBC CNRS
79360 Beauvoir sur Niort


__________ Information from ESET Mail Security, version of virus signature database 4242 (20090714) __________

The message was checked by ESET Mail Security.
http://www.eset.com


From seunghong at wisc.edu  Tue Jul 14 20:15:39 2009
From: seunghong at wisc.edu (Steve Hong)
Date: Tue, 14 Jul 2009 13:15:39 -0500
Subject: [R-sig-Geo] extract values from errorsarlm/lagsarlm
Message-ID: <6e30ab022926d.4a5c84fb@wiscmail.wisc.edu>

Dear List,

I would like to extract values from outputs of errorsarlm and lagsarlm. For example (below), I need coefficient estimate, Std.Error, z value, p-value of coefficients, LL, and AIC etc. I tried "summary(ra7.eslm1)$coeff", it gives only coefficient estimates (not Std.Error, z-value, and p-value). Is there any easy way to extract those values and AIC and LL?

Thank you!

Steve Hong

> summary(ra7.eslm1)

Call:errorsarlm(formula = as.formula(p.table[1, 2]), data = dat.reg.s2[dat.reg.s2$Ring ==     j, ], listw = dist60sw)

Residuals:
      Min        1Q    Median        3Q       Max 
-1.341833 -0.325492  0.016638  0.324515  1.655912 

Type: error 
Coefficients: (asymptotic standard errors) 
               Estimate  Std. Error z value  Pr(>|z|)
(Intercept)  3.49216824  1.13367481  3.0804 0.0020672
Longitude   -0.00207240  0.00078979 -2.6240 0.0086902
oats        -0.59867535  0.15865798 -3.7734 0.0001611
nlcd.shrb    0.48767704  0.14537933  3.3545 0.0007950
grains      -0.13791687  0.03850805 -3.5815 0.0003416

Lambda: 0.029291 LR test value: 3.1375 p-value: 0.076512 
Asymptotic standard error: 0.0077779 z-value: 3.766 p-value: 0.00016591 
Wald statistic: 14.182 p-value: 0.00016591 

Log likelihood: -83.3854 for error model
ML residual variance (sigma squared): 0.28551, (sigma: 0.53433)
Number of observations: 104 
Number of parameters estimated: 7 
AIC: 180.77, (AIC for lm: 181.91)


From pecardoso at netcabo.pt  Wed Jul 15 00:15:50 2009
From: pecardoso at netcabo.pt (pecardoso)
Date: Tue, 14 Jul 2009 23:15:50 +0100
Subject: [R-sig-Geo] split SpatialPolygon after unionSpatialPolygons()
Message-ID: <7773E6668B45764CACB253B46C09EFD89ABD9C@VS53.hdi.tvcabo>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090714/1cde8295/attachment.pl>

From alexandre.villers at cebc.cnrs.fr  Wed Jul 15 10:02:33 2009
From: alexandre.villers at cebc.cnrs.fr (Alexandre VILLERS)
Date: Wed, 15 Jul 2009 10:02:33 +0200
Subject: [R-sig-Geo] still struggling with FTP download on MODIS
Message-ID: <4A5D8D19.8090605@cebc.cnrs.fr>

Dear all,

I'm still not sure that this list is the right place for that. So if 
those questions bother you, please give me the name of the list I should 
contact.

Here a version of the script I'm using to download MODIS data from NSIDC 
(weekly snow cover)

Tsnow <- 
"ftp://anonymous:test at n4ftl01u.ecs.nasa.gov/SAN/MOST/MOD10A2.005/"  
###server of NSIDC with directories / id and password
myfolder<-paste(tempdir(),"\\" , sep="") #the folder to download data

#####-getting the list of the folders in Tsnow (thanks to Barry Rowlingson)
resp <-getURL(Tsnow)
  items <- strsplit(resp,"\r\n")[[1]]
  folderLines <- items[substr(items,1,1)=='d']
  lastBit <- function(x){x[length(x)]}
  dates <- unlist(lapply(strsplit(folderLines," "),lastBit))
  datesK<-data.frame(dates=dates, keep=rep(NA,length(dates)))
  
##### select months for which I want the data
months<-c("01","02","03","04","05","06","10", "11", "12") #months for 
which I want the data
        for (i in months){ #loop to keep only the dates I'm interested in
              garde<-grep(datesK$dates, pattern=paste(".",i,".", sep=""))
              datesK$keep[garde]<-1
              }
datesK<-subset(datesK, datesK$keep==1) # keep the dates of interest

for (i in 1:length(datesK[,1])){    ## loop to download the tiles of 
interest
        getlist1 <- strsplit(getURL(paste(Tsnow, datesK[i,][[1]], "/", 
sep=""),.opts=curlOptions(ftplistonly=TRUE)), "\r\n")[[1]] #get the 
files in the folder i
        BLOCKtemp <- getlist1[grep(getlist1, 
pattern="MOD10A2.********.h18v04.005.*************.hdf")[1]] #select the 
tile of interest (in my case h18v04.005)
        download.file(paste(Tsnow, datesK[i,][[1]], "/", 
BLOCKtemp,sep=""), destfile=paste(myfolder, BLOCKtemp, sep=""), 
mode='wb', method='wget') #download the tile
        }

So here is my problem. I can't get into some specifc folders and receive 
the error message.
Error in curlPerform(curl = curl, .opts = opts, .encoding = .encoding) :
  server did not report OK, got 550
For example, i=4 (folder "2000.03.13"). And this is always true, 
suggesting it's not a problem of connection. The error appears as soon 
as getURL is called in the loop.
I succeed in downloading for some values of i (manually) but when 
looping, it stops on those "black" folders. I've checked directly from 
filezilla or my web browser: I can get into those folder and download 
the tiles.

The tiles are pretty small (150 to 450 Ko). So if someone could try from 
his place to see if he gets the same error message for the same value of 
i (4, 28,31, etc.).
Since I have 550 tiles to download and process, I would prefer not to do 
that manually (and I can't get to use the tool proposed by the NSIDC for 
the moment).

Thanks for the help

Alex

P.S.: my next question will deal with some projection problem !!!

-- 
Alexandre Villers
PhD Student
Team "Biodiversity"
Centre d'Etudes Biologiques de Chiz?-CNRS UPR1934
79360 Beauvoir sur Niort

Phone +33 (0)5 49 09 96 13
Fax   +33 (0)5 49 09 65 26




__________ Information from ESET Mail Security, version of virus signature database 4244 (20090715) __________

The message was checked by ESET Mail Security.
http://www.eset.com


From pecardoso at netcabo.pt  Wed Jul 15 13:15:32 2009
From: pecardoso at netcabo.pt (Paulo E. Cardoso)
Date: Wed, 15 Jul 2009 12:15:32 +0100
Subject: [R-sig-Geo] how to work with useFancyQuotes( ) to avoid \" quotes
Message-ID: <!&!AAAAAAAAAAAYAAAAAAAAAK2N38q7o51Ejb8q0JfvLrBiggAAEAAAAHM7W/p9IWtLiOTfHWSM3nIBAAAAAA==@netcabo.pt>

I need to get the exact sentence, with the quotes:

OPTIONS COORDSYS("Surface1"  AS COMPONENT);

but this:

options(useFancyQuotes = F)
paste("OPTIONS COORDSYS(", dQuote("Surface 1"),  "AS COMPONENT);" )

give me this:

[1] "OPTIONS COORDSYS( \"Surface 1\" AS COMPONENT);"

And it's not readable as SpatialSQL code by GIS

How to deal with this problem?
____________
Paulo E. Cardoso


From jaime.garcia at uni-bonn.de  Wed Jul 15 13:31:33 2009
From: jaime.garcia at uni-bonn.de (Jaime R. Garcia Marquez)
Date: Wed, 15 Jul 2009 13:31:33 +0200
Subject: [R-sig-Geo] how to work with useFancyQuotes( ) to avoid \"
	quotes
In-Reply-To: <!&!AAAAAAAAAAAYAAAAAAAAAK2N38q7o51Ejb8q0JfvLrBiggAAEAAAAHM7W/p9IWtLiOTfHWSM3nIBAAAAAA==@netcabo.pt>
References: <!&!AAAAAAAAAAAYAAAAAAAAAK2N38q7o51Ejb8q0JfvLrBiggAAEAAAAHM7W/p9IWtLiOTfHWSM3nIBAAAAAA==@netcabo.pt>
Message-ID: <op.uw3wyvo35hcodf@jaimer>

Try this:

options(useFancyQuotes = F)
print(paste("OPTIONS COORDSYS(", dQuote("Surface 1"),  "AS COMPONENT);"  
),quote=F)

HTH,

Jaime -R

On Wed, 15 Jul 2009 13:15:32 +0200, Paulo E. Cardoso  
<pecardoso at netcabo.pt> wrote:

> I need to get the exact sentence, with the quotes:
>
> OPTIONS COORDSYS("Surface1"  AS COMPONENT);
>
> but this:
>
> options(useFancyQuotes = F)
> paste("OPTIONS COORDSYS(", dQuote("Surface 1"),  "AS COMPONENT);" )
>
> give me this:
>
> [1] "OPTIONS COORDSYS( \"Surface 1\" AS COMPONENT);"
>
> And it's not readable as SpatialSQL code by GIS
>
> How to deal with this problem?
> ____________
> Paulo E. Cardoso
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From hengl at spatial-analyst.net  Wed Jul 15 14:00:04 2009
From: hengl at spatial-analyst.net (Tomislav Hengl)
Date: Wed, 15 Jul 2009 14:00:04 +0200
Subject: [R-sig-Geo] still struggling with FTP download on MODIS
In-Reply-To: <4A5D8D19.8090605@cebc.cnrs.fr>
References: <4A5D8D19.8090605@cebc.cnrs.fr>
Message-ID: <5FC98D1078734E77969CAEF75ACB257A@pcibed193>


> -----Original Message-----
> From: r-sig-geo-bounces at stat.math.ethz.ch [mailto:r-sig-geo-bounces at stat.math.ethz.ch] On Behalf
> Of Alexandre VILLERS
> Sent: Wednesday, July 15, 2009 10:03 AM
> To: Aide R SIG GEO
> Subject: [R-sig-Geo] still struggling with FTP download on MODIS
> 
> Dear all,
> 
> I'm still not sure that this list is the right place for that. So if
> those questions bother you, please give me the name of the list I should
> contact.
> 
> Here a version of the script I'm using to download MODIS data from NSIDC
> (weekly snow cover)
> 
> Tsnow <-
> "ftp://anonymous:test at n4ftl01u.ecs.nasa.gov/SAN/MOST/MOD10A2.005/"
> ###server of NSIDC with directories / id and password
> myfolder<-paste(tempdir(),"\\" , sep="") #the folder to download data
> 
> #####-getting the list of the folders in Tsnow (thanks to Barry Rowlingson)
> resp <-getURL(Tsnow)
>   items <- strsplit(resp,"\r\n")[[1]]
>   folderLines <- items[substr(items,1,1)=='d']
>   lastBit <- function(x){x[length(x)]}
>   dates <- unlist(lapply(strsplit(folderLines," "),lastBit))
>   datesK<-data.frame(dates=dates, keep=rep(NA,length(dates)))
> 
> ##### select months for which I want the data
> months<-c("01","02","03","04","05","06","10", "11", "12") #months for
> which I want the data
>         for (i in months){ #loop to keep only the dates I'm interested in
>               garde<-grep(datesK$dates, pattern=paste(".",i,".", sep=""))
>               datesK$keep[garde]<-1
>               }
> datesK<-subset(datesK, datesK$keep==1) # keep the dates of interest
> 
> for (i in 1:length(datesK[,1])){    ## loop to download the tiles of
> interest
>         getlist1 <- strsplit(getURL(paste(Tsnow, datesK[i,][[1]], "/",
> sep=""),.opts=curlOptions(ftplistonly=TRUE)), "\r\n")[[1]] #get the
> files in the folder i
>         BLOCKtemp <- getlist1[grep(getlist1,
> pattern="MOD10A2.********.h18v04.005.*************.hdf")[1]] #select the
> tile of interest (in my case h18v04.005)
>         download.file(paste(Tsnow, datesK[i,][[1]], "/",
> BLOCKtemp,sep=""), destfile=paste(myfolder, BLOCKtemp, sep=""),
> mode='wb', method='wget') #download the tile
>         }
> 
> So here is my problem. I can't get into some specifc folders and receive
> the error message.
> Error in curlPerform(curl = curl, .opts = opts, .encoding = .encoding) :
>   server did not report OK, got 550

The ftp error code "550" means: "Requested action not taken. File unavailable (e.g., file not found,
no access).", which means that the ftp server is not allowing you access.

Did you try checking your wget tool? I remember I had headaches before I manage to get the wget
running without problems. Make sure you set:

> options(download.file.method="auto")

wget.exe you need to put in your Windows directory folder (Note: make sure you disable your
antivirus tools such as Norton or McAfee otherwise it might block wget from running);


> For example, i=4 (folder "2000.03.13"). And this is always true,
> suggesting it's not a problem of connection. The error appears as soon
> as getURL is called in the loop.
> I succeed in downloading for some values of i (manually) but when
> looping, it stops on those "black" folders. I've checked directly from
> filezilla or my web browser: I can get into those folder and download
> the tiles.
> 
> The tiles are pretty small (150 to 450 Ko). So if someone could try from
> his place to see if he gets the same error message for the same value of
> i (4, 28,31, etc.).
> Since I have 550 tiles to download and process, I would prefer not to do
> that manually (and I can't get to use the tool proposed by the NSIDC for
> the moment).
> 
> Thanks for the help
> 
> Alex
> 
> P.S.: my next question will deal with some projection problem !!!
> 
> --
> Alexandre Villers
> PhD Student
> Team "Biodiversity"
> Centre d'Etudes Biologiques de Chiz?-CNRS UPR1934
> 79360 Beauvoir sur Niort
> 
> Phone +33 (0)5 49 09 96 13
> Fax   +33 (0)5 49 09 65 26
> 
> 
> 
> 
> __________ Information from ESET Mail Security, version of virus signature database 4244
> (20090715) __________
> 
> The message was checked by ESET Mail Security.
> http://www.eset.com
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

T. Hengl
http://spatial-analyst.net 


From pecardoso at netcabo.pt  Wed Jul 15 14:01:00 2009
From: pecardoso at netcabo.pt (Paulo E. Cardoso)
Date: Wed, 15 Jul 2009 13:01:00 +0100
Subject: [R-sig-Geo] how to work with useFancyQuotes( ) to avoid \"
	quotes
In-Reply-To: <op.uw3wyvo35hcodf@jaimer>
References: <!&!AAAAAAAAAAAYAAAAAAAAAK2N38q7o51Ejb8q0JfvLrBiggAAEAAAAHM7W/p9IWtLiOTfHWSM3nIBAAAAAA==@netcabo.pt>
	<op.uw3wyvo35hcodf@jaimer>
Message-ID: <!&!AAAAAAAAAAAYAAAAAAAAAK2N38q7o51Ejb8q0JfvLrBiggAAEAAAADoP0f3m5chIuSXPeL85tgMBAAAAAA==@netcabo.pt>

It seems to works fine!
Thanks
____________
Paulo E. Cardoso


> -----Mensagem original-----
> De: Jaime R. Garcia Marquez [mailto:jaime.garcia at uni-bonn.de]
> Enviada: quarta-feira, 15 de Julho de 2009 12:32
> Para: Paulo E. Cardoso; r-sig-geo at stat.math.ethz.ch
> Cc: r-help at r-project.org
> Assunto: Re: [R-sig-Geo] how to work with useFancyQuotes( ) to avoid \"
> quotes
> 
> Try this:
> 
> options(useFancyQuotes = F)
> print(paste("OPTIONS COORDSYS(", dQuote("Surface 1"),  "AS COMPONENT);"
> ),quote=F)
> 
> HTH,
> 
> Jaime -R
> 
> On Wed, 15 Jul 2009 13:15:32 +0200, Paulo E. Cardoso
> <pecardoso at netcabo.pt> wrote:
> 
> > I need to get the exact sentence, with the quotes:
> >
> > OPTIONS COORDSYS("Surface1"  AS COMPONENT);
> >
> > but this:
> >
> > options(useFancyQuotes = F)
> > paste("OPTIONS COORDSYS(", dQuote("Surface 1"),  "AS COMPONENT);" )
> >
> > give me this:
> >
> > [1] "OPTIONS COORDSYS( \"Surface 1\" AS COMPONENT);"
> >
> > And it's not readable as SpatialSQL code by GIS
> >
> > How to deal with this problem?
> > ____________
> > Paulo E. Cardoso
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at stat.math.ethz.ch
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 
> 
> Checked by AVG - www.avg.com
> Version: 8.5.375 / Virus Database: 270.13.14/2238 - Release Date:
> 07/14/09 18:03:00


From Roger.Bivand at nhh.no  Wed Jul 15 19:03:33 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 15 Jul 2009 19:03:33 +0200 (CEST)
Subject: [R-sig-Geo] split SpatialPolygon after unionSpatialPolygons()
In-Reply-To: <7773E6668B45764CACB253B46C09EFD89ABD9C@VS53.hdi.tvcabo>
References: <7773E6668B45764CACB253B46C09EFD89ABD9C@VS53.hdi.tvcabo>
Message-ID: <alpine.LRH.2.00.0907151853520.31001@reclus.nhh.no>

On Tue, 14 Jul 2009, pecardoso wrote:

> I've used unionSpatialPolygons to dissolve polygons and get a grid as a 
> spatialpolygon.
>
> A simple example:
> grelha<-readGDAL(paste("C:/...","teste.bmp",sep=""))

Please only use examples that refer to a publically available data set.

> grd <- slot(grelha, "grid")
> pol <- as.SpatialPolygons.GridTopology(grd)
> pol <- unionSpatialPolygons(pol, SGDF2PCT(grelha)$idx)
>

Exactly. This creates a rectangular polygon for each raster cell specified 
by grd, then removes all internal boundaries between those raster cells 
with the same value of the index, additionally placing all the separate 
Polygon objects with the same value of the index in a Polygons object. 
No-one has given them IDs, all the function has to work on are the index 
values.

I think that this is the same question that you asked recently, to which I 
replied indicating that you should use labcon() in adehabitat to give a 
separate index to each disconnected cluster with the same index values.

The alternative is to re-format the output SpatialPolygons object to find 
out how many Polygon objects there are in each Polygons object, and then 
to flatten those with more than one - that is make each such Polygon 
object into a singleton Polygons object with a unique ID slot value. It is 
possible, but you will need some knowledge of the way these objects are 
constructed. If you can post a sample image, it may not be too hard, 
either using labcon() or by re-formatting the representation.

Roger

> When the original image have more than one region or 'islands' of a 
> single color (imagine a small logo), the unionSpatialPolygons() will 
> dissolve polygons based on the ID's provided, in such a way that 
> coordinates(pol) will return N lines, as much as different ID's or 
> colors retrieved with SGDF2PCT(grelha)$idx.
>
> It means that one cannot get centroids of each individual regions. 
> Beside this, if the original image have this pattern, each number is a 
> pixel of a single color:
>
> 00100
> 02000
> 00020
> 10000
>
> coordinates() will give only 3 centroids and only for three of the 
> polygons (not even a common centroid for 1 and 2 ID's).
>
> I'd like to split the spatialpolygon object obtained with 
> unionSpatialPolygons(pol, SGDF2PCT(grelha)$idx) but retaining the ID's 
> in order to get individual centroids for each region, in this simple 
> case, two centroids for 1, two for 2 and two for 0.
>
> Any idea will be welcome
>
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From emptican at gmail.com  Wed Jul 15 22:33:26 2009
From: emptican at gmail.com (Steve Hong)
Date: Wed, 15 Jul 2009 15:33:26 -0500
Subject: [R-sig-Geo] Error in simulation R-code
Message-ID: <cb8d4fa40907151333n76ef7ac8q224144df9fdd7129@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090715/8e0005c9/attachment.pl>

From emptican at gmail.com  Wed Jul 15 22:48:58 2009
From: emptican at gmail.com (Steve Hong)
Date: Wed, 15 Jul 2009 15:48:58 -0500
Subject: [R-sig-Geo] Error in simulation R-code
Message-ID: <cb8d4fa40907151348pd8a5290y27ae5b10a0fd0705@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090715/3c860581/attachment.pl>

From emptican at gmail.com  Wed Jul 15 23:04:02 2009
From: emptican at gmail.com (Steve Hong)
Date: Wed, 15 Jul 2009 16:04:02 -0500
Subject: [R-sig-Geo] Error in simulation R-code
Message-ID: <cb8d4fa40907151404u13a297eeyb7ad31e802528336@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090715/0c51ce76/attachment.pl>

From emptican at gmail.com  Wed Jul 15 23:13:39 2009
From: emptican at gmail.com (Steve Hong)
Date: Wed, 15 Jul 2009 16:13:39 -0500
Subject: [R-sig-Geo] Error in simulation R-code
Message-ID: <cb8d4fa40907151413q568217e2pec0c1bea0ae9fbcf@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090715/5eef5bfc/attachment.pl>

From Roger.Bivand at nhh.no  Thu Jul 16 00:13:46 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 16 Jul 2009 00:13:46 +0200 (CEST)
Subject: [R-sig-Geo] Error in simulation R-code
In-Reply-To: <cb8d4fa40907151413q568217e2pec0c1bea0ae9fbcf@mail.gmail.com>
References: <cb8d4fa40907151413q568217e2pec0c1bea0ae9fbcf@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.0907152351230.31001@reclus.nhh.no>

On Wed, 15 Jul 2009, Steve Hong wrote:

> Dear List,
>
> I have a question about simulation code. Here are the code and error
> message.
>
>> sim.sp <- function(data,CM,n,N)
> + {
> +   C <- matrix(rep(NA,N),ncol=1)
> + for(i in 1:N)
> + {
> + j <- n
> + xx <- which(colSums(CM[j,])==1)
> + V <- names(xx)
> + V <- paste(V, collapse="+")
> + V <- paste("SBA~", V)
> + rd <- round(nrow(data)*(2/3))
> + d <- sample(seq(1:nrow(data)),rd)
> + dat1 <- data[d,]
> + dat2 <- data[-d,]
> + crd <- cbind(dat1$Longitude,dat1$Latitude)
> + dist80 <- dnearneigh(crd,0,100,longlat=F)
> + dist80sw <- nb2listw(dist80, style="B")
> + fm <- errorsarlm(as.formula(V), data=dat1, listw=dist60sw)
> + pred <- predict(fm,dat2)
> + C[i,1] <- cor(dat2$SBA,pred)
> + out <- cbind(C)
> + }
> + colMeans(out)
> + }
>>
>> sim.sp(df2007.5k.s2,CM,1,1000)
> Error in nb2listw(dist80, style = "B") : Empty neighbour sets found
>
> I guess it means that there are some observations without neighborhoods from
> random selection process. Is there any way to proceed simulation like using
> only ones with neighborhood sets?
>
> Any suggestion will be appreciated!!

This is the fourth separate posting of this message, in addition 
cross-posted to R-help. Please do consider the bandwidth costs and the 
negative consequences of cross-posting. If you can't wait for someone else 
to use their time to solve your (simple) problem, perhaps a little 
reflection is called for?

Have you read ?dnearneigh and ?nb2listw? The examples in ?dnearneigh show 
how to use the maximum 1st nearest neighbour distances to set the d2= 
argument to a value ensuring that each observation has at least one 
neighbour. Given your use of Longitude and Latitude as coordinate names, 
are you sure that longlat= should be FALSE, or are the names simply 
careless? This could affect what you think 100 units is - if coordinates 
in m, it is 100m, if in US surveyors feet, then 100ft, if degrees, 100 
degrees ... which affects the d2= value. dist80 looks an odd name for 
d2=100 as well, doesn't it? You check for zero neighbour counts by:

any(card(nb) == 0)

In ?nb2listw, you find the zero.policy= argument, which has a 
default value of FALSE, but which you can set to TRUE, so avoiding the 
error in your simulation if used consistently in subsequent function calls 
to functions taking that argument, like errorsarlm(). So:

zp <- !any(card(nb) == 0)
..., zero.policy=zp, ...

might be OK, unless you also need to check that there are any neighbours 
at all.

I'm not at all sure that this simulation is going to get you anywhere 
sensible - why are you trying to do it? I do hope you are setting the seed 
before running it, otherwise you won't know what is going wrong in the 
situations you choose. You are posting from a gmail address, and so not 
give any affiliation in your signature. Is this a homework problem?

Again, you only took 40 minutes in sending 4 copies of the same message to 
two lists. Replying has taken about the same time. Reading two help pages 
would have taken you much less.

Roger Bivand

>
> Thank you!
>
> Steve Hong
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From emptican at gmail.com  Thu Jul 16 05:28:14 2009
From: emptican at gmail.com (Steve Hong)
Date: Wed, 15 Jul 2009 22:28:14 -0500
Subject: [R-sig-Geo] Error in simulation R-code
In-Reply-To: <alpine.LRH.2.00.0907152351230.31001@reclus.nhh.no>
References: <cb8d4fa40907151413q568217e2pec0c1bea0ae9fbcf@mail.gmail.com>
	<alpine.LRH.2.00.0907152351230.31001@reclus.nhh.no>
Message-ID: <cb8d4fa40907152028g6bf2c979ub25cfe894d2a76fd@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090715/006ba471/attachment.pl>

From emmanuel.poizot at cnam.fr  Thu Jul 16 09:54:38 2009
From: emmanuel.poizot at cnam.fr (Poizot Emmanuel)
Date: Thu, 16 Jul 2009 09:54:38 +0200
Subject: [R-sig-Geo] Problem with size of dataset
Message-ID: <4A5EDCBE.2030507@cnam.fr>

Dear all,

I would like to perform a geostatistical analysis using R.
To do so, I'm classicaly use geoR ou GSTAT packages.
In the present case, I have a dataset of around 157000 locations where I 
have a value (depth).
I've been not able to create both geodata or gstat valid R object 
because apparently of the size of the dataset.
DOes anybody have an idear of how to conduct such study with such 
dataset size ?
Regards

-- 
Cordialement

------------------------------------------------
Emmanuel Poizot
Cnam/Intechmer
B.P. 324
50103 Cherbourg Cedex

Phone (Direct) : (00 33)(0)233887342
Fax : (00 33)(0)233887339
------------------------------------------------

-------------- next part --------------
A non-text attachment was scrubbed...
Name: emmanuel_poizot.vcf
Type: text/x-vcard
Size: 316 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090716/545a35b0/attachment.vcf>

From pierre.roudier at gmail.com  Thu Jul 16 10:25:48 2009
From: pierre.roudier at gmail.com (Pierre Roudier)
Date: Thu, 16 Jul 2009 18:25:48 +1000
Subject: [R-sig-Geo] Problem with size of dataset
In-Reply-To: <4A5EDCBE.2030507@cnam.fr>
References: <4A5EDCBE.2030507@cnam.fr>
Message-ID: <e4178da60907160125k1b8d2cb0j95922516b3dc42fa@mail.gmail.com>

Hi Emmanuel,

This is surprising has I am currently working on a dataset with 215
000+ locations. I managed to create a sp object
(SpatialPointsDataFrame) seamlessly. I also can use it in gstat (while
time-consumming) for analysis like variograms.

Do you have any error message?

Pierre

-- 
Dr. Pierre Roudier
PostDoctoral Fellow

Australian Centre for Precision Agriculture
Rm 307 McMillan Building A05
The University of Sydney, NSW, 2006

Ph: +61 (0)2 9351 2947
Fax: +61 (0)2 9351 3706
Mob: +61 (0)427 252313

2009/7/16 Poizot Emmanuel <emmanuel.poizot at cnam.fr>
>
> Dear all,
>
> I would like to perform a geostatistical analysis using R.
> To do so, I'm classicaly use geoR ou GSTAT packages.
> In the present case, I have a dataset of around 157000 locations where I have a value (depth).
> I've been not able to create both geodata or gstat valid R object because apparently of the size of the dataset.
> DOes anybody have an idear of how to conduct such study with such dataset size ?
> Regards
>
> --
> Cordialement
>
> ------------------------------------------------
> Emmanuel Poizot
> Cnam/Intechmer
> B.P. 324
> 50103 Cherbourg Cedex
>
> Phone (Direct) : (00 33)(0)233887342
> Fax : (00 33)(0)233887339
> ------------------------------------------------
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From emmanuel.poizot at cnam.fr  Thu Jul 16 10:39:22 2009
From: emmanuel.poizot at cnam.fr (Poizot Emmanuel)
Date: Thu, 16 Jul 2009 10:39:22 +0200
Subject: [R-sig-Geo] Problem with size of dataset
In-Reply-To: <e4178da60907160125k1b8d2cb0j95922516b3dc42fa@mail.gmail.com>
References: <4A5EDCBE.2030507@cnam.fr>
	<e4178da60907160125k1b8d2cb0j95922516b3dc42fa@mail.gmail.com>
Message-ID: <4A5EE73A.5010102@cnam.fr>

Pierre Roudier a ?crit :
> Hi Emmanuel,
>
> This is surprising has I am currently working on a dataset with 215
> 000+ locations. I managed to create a sp object
> (SpatialPointsDataFrame) seamlessly. I also can use it in gstat (while
> time-consumming) for analysis like variograms.
>
> Do you have any error message?
>
> Pierre
>
>   
Hi Pierre,

when I try to load the dataset with the following command:

g.fond<-as.geodata(nav.reflector.corrected[,1:3])
with "nav.reflector.corrected" a dataframe with respectively x, y, and 
depth columns, it gives the following message:

as.geodata: 215 points removed due to NA in the data
as.geodata: 4 redundant locations found
Erreur dans vector("double", length) :
  la longueur choisie pour le vecteur est trop grande

(Sorry for the french)

-- 
Cordialement

------------------------------------------------
Emmanuel Poizot
Cnam/Intechmer
B.P. 324
50103 Cherbourg Cedex

Phone (Direct) : (00 33)(0)233887342
Fax : (00 33)(0)233887339
------------------------------------------------

-------------- next part --------------
A non-text attachment was scrubbed...
Name: emmanuel_poizot.vcf
Type: text/x-vcard
Size: 316 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090716/33bc8073/attachment.vcf>

From hengl at spatial-analyst.net  Thu Jul 16 10:45:59 2009
From: hengl at spatial-analyst.net (Tomislav Hengl)
Date: Thu, 16 Jul 2009 10:45:59 +0200
Subject: [R-sig-Geo] Problem with size of dataset
In-Reply-To: <4A5EDCBE.2030507@cnam.fr>
References: <4A5EDCBE.2030507@cnam.fr>
Message-ID: <A01E60DAE913457F89DCDC6C21CC0F4C@pcibed193>


Dear Emmanuel,

I have the same problem. I either can not run processing with large data set in R or I can not even
load such data to R. Then, if I want to do any geostatistics, it takes forever. R (gstat/geoR) is
simply not that efficient with large spatial data as e.g. GIS software.

What you can definitively try is to subset your point data randomly by using e.g.:

> points.sub <- points[runif(length(points at data[[1]]))<0.1]  # 10% sample!

This will allow you to fit variograms etc.

Then, if you really want to interpolate all of your 157k points, you might consider using SAGA. For
example, you can also sub-set randomly points from a shape file:

# too many points; subset to 5% ("Split Shapes Layer Randomly" in SAGA):
> rsaga.geoprocessor(lib="shapes_tools", module=17, param=list(SHAPES="complete.shp",
A="part_A.shp", B="part_B.shp", PERCENT=5))
> ground.sample <- readOGR("part_B.shp","part_B")

# Learn more about geostatistics in SAGA:
> rsaga.get.modules(lib="geostatistics_kriging")
$geostatistics_kriging
   code                           name
1     0          Ordinary Kriging (VF)
2     1  Ordinary Kriging (VF, Global)
3     2         Universal Kriging (VF)
4     3 Universal Kriging (VF, Global)
5     4        Semivariogram (Dialog))
6     5               Ordinary Kriging
7     6      Ordinary Kriging (Global)
8     7              Universal Kriging
9     8     Universal Kriging (Global)
10   NA                           <NA>
11   NA                           <NA>

# Read the mask map:
> gridmaps <- readGDAL("maskmap.asc")
> cell.size <- gridmaps at grid@cellsize[[1]]
# Ordinary kriging in SAGA:
> rsaga.geoprocessor(lib="geostatistics_kriging", module=5, param=list(GRID="var_OK.sgrd",
SHAPES="var.shp", BVARIANCE=F, BLOCK=F, FIELD=1, BLOG=F, MODEL=1, TARGET=0, NPOINTS_MIN=10,
NPOINTS_MAX=60, NUGGET=rvgm.Pb$psill[1], SILL=1.65, RANGE=1238, MAXRADIUS=50000,
USER_CELL_SIZE=cell.size, USER_X_EXTENT_MIN=gridmaps at bbox[1,1]+cell.size/2,
USER_X_EXTENT_MAX=gridmaps at bbox[1,2]-cell.size/2, USER_Y_EXTENT_MIN=gridmaps at bbox[2,1]+cell.size/2,
USER_Y_EXTENT_MAX=gridmaps at bbox[2,2]-cell.size/2))
# the same way you can run regression-kriging/universal kriging;

You will soon find out that there is a big difference in the efficiency between SAGA and R - SAGA
will interpolate your 157k points within few minutes or less. On the other hand, SAGA has very very
limited geostatistical functionality (for example it can not fit variograms etc.), so what you
really need is a combination of SAGA and R!

Here are more examples:
http://geomorphometry.org/view_scripts.asp?id=24 

HTH,

T. Hengl
http://spatial-analyst.net 

> -----Original Message-----
> From: r-sig-geo-bounces at stat.math.ethz.ch [mailto:r-sig-geo-bounces at stat.math.ethz.ch] On Behalf
> Of Poizot Emmanuel
> Sent: Thursday, July 16, 2009 9:55 AM
> To: r-sig-geo at stat.math.ethz.ch
> Subject: [R-sig-Geo] Problem with size of dataset
> 
> Dear all,
> 
> I would like to perform a geostatistical analysis using R.
> To do so, I'm classicaly use geoR ou GSTAT packages.
> In the present case, I have a dataset of around 157000 locations where I
> have a value (depth).
> I've been not able to create both geodata or gstat valid R object
> because apparently of the size of the dataset.
> DOes anybody have an idear of how to conduct such study with such
> dataset size ?
> Regards
> 
> --
> Cordialement
> 
> ------------------------------------------------
> Emmanuel Poizot
> Cnam/Intechmer
> B.P. 324
> 50103 Cherbourg Cedex
> 
> Phone (Direct) : (00 33)(0)233887342
> Fax : (00 33)(0)233887339
> ------------------------------------------------


From pierre.roudier at gmail.com  Thu Jul 16 10:55:27 2009
From: pierre.roudier at gmail.com (Pierre Roudier)
Date: Thu, 16 Jul 2009 18:55:27 +1000
Subject: [R-sig-Geo] Problem with size of dataset
In-Reply-To: <A01E60DAE913457F89DCDC6C21CC0F4C@pcibed193>
References: <4A5EDCBE.2030507@cnam.fr>
	<A01E60DAE913457F89DCDC6C21CC0F4C@pcibed193>
Message-ID: <e4178da60907160155h6811479ak2966657c5a6e1ec9@mail.gmail.com>

I can not reproduce Emmanuel's bug with my configuration: I loaded a
216 149 observations matrix into a geodata object (using geoR) and
also in a gstat object.

But as Tomislav notice, this is pretty unusable and a simple variogram
pmlotting takes a long time. I do subsample this dataset.

For the record, here are the different versions of my configuration
(on a x86_64 linux box):
R : 2.9.1
geoR: 1.6-25

Hope it helps,

Pierre

2009/7/16 Tomislav Hengl <hengl at spatial-analyst.net>:
>
> Dear Emmanuel,
>
> I have the same problem. I either can not run processing with large data set in R or I can not even
> load such data to R. Then, if I want to do any geostatistics, it takes forever. R (gstat/geoR) is
> simply not that efficient with large spatial data as e.g. GIS software.
>
> What you can definitively try is to subset your point data randomly by using e.g.:
>
>> points.sub <- points[runif(length(points at data[[1]]))<0.1] ?# 10% sample!
>
> This will allow you to fit variograms etc.
>
> Then, if you really want to interpolate all of your 157k points, you might consider using SAGA. For
> example, you can also sub-set randomly points from a shape file:
>
> # too many points; subset to 5% ("Split Shapes Layer Randomly" in SAGA):
>> rsaga.geoprocessor(lib="shapes_tools", module=17, param=list(SHAPES="complete.shp",
> A="part_A.shp", B="part_B.shp", PERCENT=5))
>> ground.sample <- readOGR("part_B.shp","part_B")
>
> # Learn more about geostatistics in SAGA:
>> rsaga.get.modules(lib="geostatistics_kriging")
> $geostatistics_kriging
> ? code ? ? ? ? ? ? ? ? ? ? ? ? ? name
> 1 ? ? 0 ? ? ? ? ?Ordinary Kriging (VF)
> 2 ? ? 1 ?Ordinary Kriging (VF, Global)
> 3 ? ? 2 ? ? ? ? Universal Kriging (VF)
> 4 ? ? 3 Universal Kriging (VF, Global)
> 5 ? ? 4 ? ? ? ?Semivariogram (Dialog))
> 6 ? ? 5 ? ? ? ? ? ? ? Ordinary Kriging
> 7 ? ? 6 ? ? ?Ordinary Kriging (Global)
> 8 ? ? 7 ? ? ? ? ? ? ?Universal Kriging
> 9 ? ? 8 ? ? Universal Kriging (Global)
> 10 ? NA ? ? ? ? ? ? ? ? ? ? ? ? ? <NA>
> 11 ? NA ? ? ? ? ? ? ? ? ? ? ? ? ? <NA>
>
> # Read the mask map:
>> gridmaps <- readGDAL("maskmap.asc")
>> cell.size <- gridmaps at grid@cellsize[[1]]
> # Ordinary kriging in SAGA:
>> rsaga.geoprocessor(lib="geostatistics_kriging", module=5, param=list(GRID="var_OK.sgrd",
> SHAPES="var.shp", BVARIANCE=F, BLOCK=F, FIELD=1, BLOG=F, MODEL=1, TARGET=0, NPOINTS_MIN=10,
> NPOINTS_MAX=60, NUGGET=rvgm.Pb$psill[1], SILL=1.65, RANGE=1238, MAXRADIUS=50000,
> USER_CELL_SIZE=cell.size, USER_X_EXTENT_MIN=gridmaps at bbox[1,1]+cell.size/2,
> USER_X_EXTENT_MAX=gridmaps at bbox[1,2]-cell.size/2, USER_Y_EXTENT_MIN=gridmaps at bbox[2,1]+cell.size/2,
> USER_Y_EXTENT_MAX=gridmaps at bbox[2,2]-cell.size/2))
> # the same way you can run regression-kriging/universal kriging;
>
> You will soon find out that there is a big difference in the efficiency between SAGA and R - SAGA
> will interpolate your 157k points within few minutes or less. On the other hand, SAGA has very very
> limited geostatistical functionality (for example it can not fit variograms etc.), so what you
> really need is a combination of SAGA and R!
>
> Here are more examples:
> http://geomorphometry.org/view_scripts.asp?id=24
>
> HTH,
>
> T. Hengl
> http://spatial-analyst.net
>
>> -----Original Message-----
>> From: r-sig-geo-bounces at stat.math.ethz.ch [mailto:r-sig-geo-bounces at stat.math.ethz.ch] On Behalf
>> Of Poizot Emmanuel
>> Sent: Thursday, July 16, 2009 9:55 AM
>> To: r-sig-geo at stat.math.ethz.ch
>> Subject: [R-sig-Geo] Problem with size of dataset
>>
>> Dear all,
>>
>> I would like to perform a geostatistical analysis using R.
>> To do so, I'm classicaly use geoR ou GSTAT packages.
>> In the present case, I have a dataset of around 157000 locations where I
>> have a value (depth).
>> I've been not able to create both geodata or gstat valid R object
>> because apparently of the size of the dataset.
>> DOes anybody have an idear of how to conduct such study with such
>> dataset size ?
>> Regards
>>
>> --
>> Cordialement
>>
>> ------------------------------------------------
>> Emmanuel Poizot
>> Cnam/Intechmer
>> B.P. 324
>> 50103 Cherbourg Cedex
>>
>> Phone (Direct) : (00 33)(0)233887342
>> Fax : (00 33)(0)233887339
>> ------------------------------------------------
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From Roger.Bivand at nhh.no  Thu Jul 16 12:44:13 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 16 Jul 2009 12:44:13 +0200 (CEST)
Subject: [R-sig-Geo] Error in simulation R-code
In-Reply-To: <cb8d4fa40907152028g6bf2c979ub25cfe894d2a76fd@mail.gmail.com>
References: <cb8d4fa40907151413q568217e2pec0c1bea0ae9fbcf@mail.gmail.com>
	<alpine.LRH.2.00.0907152351230.31001@reclus.nhh.no>
	<cb8d4fa40907152028g6bf2c979ub25cfe894d2a76fd@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.0907161228190.3069@reclus.nhh.no>

On Wed, 15 Jul 2009, Steve Hong wrote:

> First I apologize all of you for annoying messages. Since I did not receive
> the mail I sent, I thought there might be some errors.

OK. Note that there may be latency issues - occasionally, it takes much 
longer for the mail servers to process submitted postings. You can also 
check in gmane, nabble, or the list archives to see whether postings have 
got through, for this list on:

http://n2.nabble.com/R-sig-geo-f2731867.html

http://news.gmane.org/gmane.comp.lang.r.geo

https://stat.ethz.ch/pipermail/r-sig-geo/

>
> On Wed, Jul 15, 2009 at 5:13 PM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
>
>> On Wed, 15 Jul 2009, Steve Hong wrote:
>>
>>  Dear List,
>>>
>>> I have a question about simulation code. Here are the code and error
>>> message.
>>>
>>>  sim.sp <- function(data,CM,n,N)
>>>>
>>> + {
>>> +   C <- matrix(rep(NA,N),ncol=1)
>>> + for(i in 1:N)
>>> + {
>>> + j <- n
>>> + xx <- which(colSums(CM[j,])==1)
>>> + V <- names(xx)
>>> + V <- paste(V, collapse="+")
>>> + V <- paste("SBA~", V)
>>> + rd <- round(nrow(data)*(2/3))
>>> + d <- sample(seq(1:nrow(data)),rd)
>>> + dat1 <- data[d,]
>>> + dat2 <- data[-d,]
>>> + crd <- cbind(dat1$Longitude,dat1$Latitude)
>>> + dist80 <- dnearneigh(crd,0,100,longlat=F)
>>> + dist80sw <- nb2listw(dist80, style="B")
>>> + fm <- errorsarlm(as.formula(V), data=dat1, listw=dist60sw)
>>> + pred <- predict(fm,dat2)
>>> + C[i,1] <- cor(dat2$SBA,pred)
>>> + out <- cbind(C)
>>> + }
>>> + colMeans(out)
>>> + }
>>>
>>>>
>>>> sim.sp(df2007.5k.s2,CM,1,1000)
>>>>
>>> Error in nb2listw(dist80, style = "B") : Empty neighbour sets found
>>>
>>> I guess it means that there are some observations without neighborhoods
>>> from
>>> random selection process. Is there any way to proceed simulation like
>>> using
>>> only ones with neighborhood sets?
>>>
>>> Any suggestion will be appreciated!!
>>>
>>
>> This is the fourth separate posting of this message, in addition
>> cross-posted to R-help. Please do consider the bandwidth costs and the
>> negative consequences of cross-posting. If you can't wait for someone else
>> to use their time to solve your (simple) problem, perhaps a little
>> reflection is called for?
>>
>> Have you read ?dnearneigh and ?nb2listw? The examples in ?dnearneigh show
>> how to use the maximum 1st nearest neighbour distances to set the d2=
>> argument to a value ensuring that each observation has at least one
>> neighbour. Given your use of Longitude and Latitude as coordinate names, are
>> you sure that longlat= should be FALSE, or are the names simply careless?
>> This could affect what you think 100 units is - if coordinates in m, it is
>> 100m, if in US surveyors feet, then 100ft, if degrees, 100 degrees ... which
>> affects the d2= value. dist80 looks an odd name for d2=100 as well, doesn't
>> it? You check for zero neighbour counts by:
>>
> Dist80, Longitude, and Latitude are careless. Please ignore that. Actually,
> Longitude and Latitude are UTM values (In that case longlat=F, right?). I
> think '100' is 100 km. It was OK when I try to get predicted value without
> simulation.

OK. Please check the ranges of your coordinate vectors; if the y vector is 
roughly in the single digit thousands, you are that number of km from the 
Equator, if in single digit millions, they are metres.

>
>
>>
>> any(card(nb) == 0)
>>
>> In ?nb2listw, you find the zero.policy= argument, which has a default value
>> of FALSE, but which you can set to TRUE, so avoiding the error in your
>> simulation if used consistently in subsequent function calls to functions
>> taking that argument, like errorsarlm(). So:
>>
>> zp <- !any(card(nb) == 0)
>> ..., zero.policy=zp, ...
>>
> Where should I add these codes? Can I add the first code (zp <-!...) in
> front of nb2listw? The second one should be in nb2listw(....,
> zero.policy=zp). Is that correct?

Yes, that's right. Add the ..., zero.policy=zp, ... to all the subsequent 
commands using the listw object too - the object does not record the fact 
that it's zero.policy was set to TRUE.

>
>>
>> might be OK, unless you also need to check that there are any neighbours at
>> all.
>>
>> I'm not at all sure that this simulation is going to get you anywhere
>> sensible - why are you trying to do it? I do hope you are setting the seed
>> before running it, otherwise you won't know what is going wrong in the
>> situations you choose. You are posting from a gmail address, and so not give
>> any affiliation in your signature. Is this a homework problem?
>>
> Fortunately, this is NOT a homework problem. I am post-graduated. I changed
> my email address to a gamil address from the work address (educational
> institute). I did that since I wanted to separate R-related emails from my
> work email address. I am in the lists of R-help, R-sig-geo, R-mixed, and
> R-ecology.

OK. When there are no indications of why work is being done, it has 
sometimes turned out to be a graduate (or undergraduate) who has been 
tasked by a clueless supervisor, who has then abandoned the unfortunate 
person with a tight deadline and no helpful advice.

I'm still not sure that just reporting the correlations between the 
out-of-sample predictions and observed values gets you anywhere useful, 
without knowing how the repeated 2/3 samples affect the autoregressive 
coefficient, which in turn affects the model coefficients. That was more 
what I was lacking for understanding. In addition, we don't know whether 
the observations are very clustered in space, which may lead to very dense 
weights, and poorer performance by the spatial model, especially if those 
weights were not those that generated the data.

Roger

>
>>
>> Again, you only took 40 minutes in sending 4 copies of the same message to
>> two lists. Replying has taken about the same time. Reading two help pages
>> would have taken you much less.
>>
> Again, I sincerely apologize for sending same messages. It is totally my
> misstake. I thought it did not get there since I could not see it in my
> gmail account. If I use gmail address, can't I see that?
>
> Thank you!!
>
>>
>> Roger Bivand
>>
>>
>>> Thank you!
>>>
>>> Steve Hong
>>>
>>>        [[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>>
>> --
>> Roger Bivand
>> Economic Geography Section, Department of Economics, Norwegian School of
>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>> e-mail: Roger.Bivand at nhh.no
>>
>>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From pecardoso at netcabo.pt  Thu Jul 16 14:50:56 2009
From: pecardoso at netcabo.pt (Paulo E. Cardoso)
Date: Thu, 16 Jul 2009 13:50:56 +0100
Subject: [R-sig-Geo] split SpatialPolygon after unionSpatialPolygons()
In-Reply-To: <alpine.LRH.2.00.0907151853520.31001@reclus.nhh.no>
References: <7773E6668B45764CACB253B46C09EFD89ABD9C@VS53.hdi.tvcabo>
	<alpine.LRH.2.00.0907151853520.31001@reclus.nhh.no>
Message-ID: <!&!AAAAAAAAAAAYAAAAAAAAAK2N38q7o51Ejb8q0JfvLrBiggAAEAAAAH/JfIZSrO1Mp88kL0dXa6UBAAAAAA==@netcabo.pt>

Roger,
I'm not being able, even with a very simple image.
Attached file is a bmp image; the type of data I'll need to work with.
labcon is returning a single level when it should return 3.

____________
Paulo E. Cardoso

> -----Mensagem original-----
> De: Roger Bivand [mailto:Roger.Bivand at nhh.no]
> Enviada: quarta-feira, 15 de Julho de 2009 18:04
> Para: pecardoso
> Cc: R-sig-Geo
> Assunto: Re: [R-sig-Geo] split SpatialPolygon after
> unionSpatialPolygons()
> 
> On Tue, 14 Jul 2009, pecardoso wrote:
> 
> > I've used unionSpatialPolygons to dissolve polygons and get a grid as
> a
> > spatialpolygon.
> >
> > A simple example:
> > grelha<-readGDAL(paste("C:/...","teste.bmp",sep=""))
> 
> Please only use examples that refer to a publically available data set.
> 
> > grd <- slot(grelha, "grid")
> > pol <- as.SpatialPolygons.GridTopology(grd)
> > pol <- unionSpatialPolygons(pol, SGDF2PCT(grelha)$idx)
> >
> 
> Exactly. This creates a rectangular polygon for each raster cell
> specified
> by grd, then removes all internal boundaries between those raster cells
> with the same value of the index, additionally placing all the separate
> Polygon objects with the same value of the index in a Polygons object.
> No-one has given them IDs, all the function has to work on are the
> index
> values.
> 
> I think that this is the same question that you asked recently, to
> which I
> replied indicating that you should use labcon() in adehabitat to give a
> separate index to each disconnected cluster with the same index values.
> 
> The alternative is to re-format the output SpatialPolygons object to
> find
> out how many Polygon objects there are in each Polygons object, and
> then
> to flatten those with more than one - that is make each such Polygon
> object into a singleton Polygons object with a unique ID slot value. It
> is
> possible, but you will need some knowledge of the way these objects are
> constructed. If you can post a sample image, it may not be too hard,
> either using labcon() or by re-formatting the representation.
> 
> Roger
> 
> > When the original image have more than one region or 'islands' of a
> > single color (imagine a small logo), the unionSpatialPolygons() will
> > dissolve polygons based on the ID's provided, in such a way that
> > coordinates(pol) will return N lines, as much as different ID's or
> > colors retrieved with SGDF2PCT(grelha)$idx.
> >
> > It means that one cannot get centroids of each individual regions.
> > Beside this, if the original image have this pattern, each number is
> a
> > pixel of a single color:
> >
> > 00100
> > 02000
> > 00020
> > 10000
> >
> > coordinates() will give only 3 centroids and only for three of the
> > polygons (not even a common centroid for 1 and 2 ID's).
> >
> > I'd like to split the spatialpolygon object obtained with
> > unionSpatialPolygons(pol, SGDF2PCT(grelha)$idx) but retaining the
> ID's
> > in order to get individual centroids for each region, in this simple
> > case, two centroids for 1, two for 2 and two for 0.
> >
> > Any idea will be welcome
> >
> >
> >
> > 	[[alternative HTML version deleted]]
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at stat.math.ethz.ch
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
> 
> --
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School
> of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
> 
> Checked by AVG - www.avg.com
> Version: 8.5.375 / Virus Database: 270.13.16/2241 - Release Date:
> 07/16/09 05:58:00
-------------- next part --------------
A non-text attachment was scrubbed...
Name: teste.bmp
Type: image/bmp
Size: 2782 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090716/0e510bb9/attachment.bmp>

From emptican at gmail.com  Thu Jul 16 15:26:19 2009
From: emptican at gmail.com (Steve Hong)
Date: Thu, 16 Jul 2009 08:26:19 -0500
Subject: [R-sig-Geo] Error in simulation R-code
In-Reply-To: <alpine.LRH.2.00.0907161228190.3069@reclus.nhh.no>
References: <cb8d4fa40907151413q568217e2pec0c1bea0ae9fbcf@mail.gmail.com>
	<alpine.LRH.2.00.0907152351230.31001@reclus.nhh.no>
	<cb8d4fa40907152028g6bf2c979ub25cfe894d2a76fd@mail.gmail.com>
	<alpine.LRH.2.00.0907161228190.3069@reclus.nhh.no>
Message-ID: <cb8d4fa40907160626tf5e8c5dme27c51f183ac276@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090716/592f7c18/attachment.pl>

From pecardoso at netcabo.pt  Thu Jul 16 16:35:26 2009
From: pecardoso at netcabo.pt (Paulo E. Cardoso)
Date: Thu, 16 Jul 2009 15:35:26 +0100
Subject: [R-sig-Geo] split SpatialPolygon after unionSpatialPolygons()
In-Reply-To: <alpine.LRH.2.00.0907151853520.31001@reclus.nhh.no>
References: <7773E6668B45764CACB253B46C09EFD89ABD9C@VS53.hdi.tvcabo>
	<alpine.LRH.2.00.0907151853520.31001@reclus.nhh.no>
Message-ID: <!&!AAAAAAAAAAAYAAAAAAAAAK2N38q7o51Ejb8q0JfvLrBiggAAEAAAAHms5igSpCBAox6e8g/vKzgBAAAAAA==@netcabo.pt>

I think I got it working although without truly understand why some aspects
seems to be mandatory, such as assigning NA's into the SGDF to get labcon()
working.

  grelha<-readGDAL(paste("A:\\",i,sep=""))
  gr.topo <- slot(grelha, "grid")
#! GridTopology
  
  
  codcores <- SGDF2PCT(grelha)$idx                            #! Convert RGB
into a single code ID for each color
  codcores[codcores==1] <- NA                                 #! Assign NA's
for ID =1
  sgdf.gr<-SpatialGridDataFrame(gr.topo,data.frame(codcores)) #! Rebuild
SGDF with NA's
  #image(sgdf.gr)
  asc.gr = as.asc(as.matrix(sgdf.gr),xll = 0.5, yll = 0.5,)   #! Build
object "asc"
  grelhaID = labcon(asc.gr)                                   #! Split
culsters (regions) with same ID's
  class(grelhaID)                                             #! classe
"asc" 
  #image(grelhaID)
  grelhaID[is.na(grelhaID)] <- 0
  #win.graph()
  #image(grelhaID)
  pixID = asc2spixdf(grelhaID)                                #! Build
SpatialPixelDataFrame from asc object
  class(pixID)
  names(pixID) <- "ID"
  image(pixID)
  
____________
Paulo E. Cardoso


> -----Mensagem original-----
> De: Roger Bivand [mailto:Roger.Bivand at nhh.no]
> Enviada: quarta-feira, 15 de Julho de 2009 18:04
> Para: pecardoso
> Cc: R-sig-Geo
> Assunto: Re: [R-sig-Geo] split SpatialPolygon after
> unionSpatialPolygons()
> 
> On Tue, 14 Jul 2009, pecardoso wrote:
> 
> > I've used unionSpatialPolygons to dissolve polygons and get a grid as
> a
> > spatialpolygon.
> >
> > A simple example:
> > grelha<-readGDAL(paste("C:/...","teste.bmp",sep=""))
> 
> Please only use examples that refer to a publically available data set.
> 
> > grd <- slot(grelha, "grid")
> > pol <- as.SpatialPolygons.GridTopology(grd)
> > pol <- unionSpatialPolygons(pol, SGDF2PCT(grelha)$idx)
> >
> 
> Exactly. This creates a rectangular polygon for each raster cell
> specified
> by grd, then removes all internal boundaries between those raster cells
> with the same value of the index, additionally placing all the separate
> Polygon objects with the same value of the index in a Polygons object.
> No-one has given them IDs, all the function has to work on are the
> index
> values.
> 
> I think that this is the same question that you asked recently, to
> which I
> replied indicating that you should use labcon() in adehabitat to give a
> separate index to each disconnected cluster with the same index values.
> 
> The alternative is to re-format the output SpatialPolygons object to
> find
> out how many Polygon objects there are in each Polygons object, and
> then
> to flatten those with more than one - that is make each such Polygon
> object into a singleton Polygons object with a unique ID slot value. It
> is
> possible, but you will need some knowledge of the way these objects are
> constructed. If you can post a sample image, it may not be too hard,
> either using labcon() or by re-formatting the representation.
> 
> Roger
> 
> > When the original image have more than one region or 'islands' of a
> > single color (imagine a small logo), the unionSpatialPolygons() will
> > dissolve polygons based on the ID's provided, in such a way that
> > coordinates(pol) will return N lines, as much as different ID's or
> > colors retrieved with SGDF2PCT(grelha)$idx.
> >
> > It means that one cannot get centroids of each individual regions.
> > Beside this, if the original image have this pattern, each number is
> a
> > pixel of a single color:
> >
> > 00100
> > 02000
> > 00020
> > 10000
> >
> > coordinates() will give only 3 centroids and only for three of the
> > polygons (not even a common centroid for 1 and 2 ID's).
> >
> > I'd like to split the spatialpolygon object obtained with
> > unionSpatialPolygons(pol, SGDF2PCT(grelha)$idx) but retaining the
> ID's
> > in order to get individual centroids for each region, in this simple
> > case, two centroids for 1, two for 2 and two for 0.
> >
> > Any idea will be welcome
> >
> >
> >
> > 	[[alternative HTML version deleted]]
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at stat.math.ethz.ch
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
> 
> --
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School
> of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
> 
> Checked by AVG - www.avg.com
> Version: 8.5.375 / Virus Database: 270.13.16/2241 - Release Date:
> 07/16/09 05:58:00


From Roger.Bivand at nhh.no  Thu Jul 16 17:24:15 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 16 Jul 2009 17:24:15 +0200 (CEST)
Subject: [R-sig-Geo] split SpatialPolygon after unionSpatialPolygons()
In-Reply-To: <!&!AAAAAAAAAAAYAAAAAAAAAK2N38q7o51Ejb8q0JfvLrBiggAAEAAAAHms5igSpCBAox6e8g/vKzgBAAAAAA==@netcabo.pt>
References: <7773E6668B45764CACB253B46C09EFD89ABD9C@VS53.hdi.tvcabo>
	<alpine.LRH.2.00.0907151853520.31001@reclus.nhh.no>
	<!&!AAAAAAAAAAAYAAAAAAAAAK2N38q7o51Ejb8q0JfvLrBiggAAEAAAAHms5igSpCBAox6e8g/vKzgBAAAAAA==@netcabo.pt>
Message-ID: <alpine.LRH.2.00.0907161722260.3677@reclus.nhh.no>

On Thu, 16 Jul 2009, Paulo E. Cardoso wrote:

> I think I got it working although without truly understand why some aspects
> seems to be mandatory, such as assigning NA's into the SGDF to get labcon()
> working.

In labcon, you see the lines:

     x[!is.na(x)] <- 1
     x[is.na(x)] <- 0

which will just make one connected component if all the cells are non-NA. 
Otherwise, yes, it looks as though it will work.

Roger

>
>  grelha<-readGDAL(paste("A:\\",i,sep=""))
>  gr.topo <- slot(grelha, "grid")
> #! GridTopology
>
>
>  codcores <- SGDF2PCT(grelha)$idx                            #! Convert RGB
> into a single code ID for each color
>  codcores[codcores==1] <- NA                                 #! Assign NA's
> for ID =1
>  sgdf.gr<-SpatialGridDataFrame(gr.topo,data.frame(codcores)) #! Rebuild
> SGDF with NA's
>  #image(sgdf.gr)
>  asc.gr = as.asc(as.matrix(sgdf.gr),xll = 0.5, yll = 0.5,)   #! Build
> object "asc"
>  grelhaID = labcon(asc.gr)                                   #! Split
> culsters (regions) with same ID's
>  class(grelhaID)                                             #! classe
> "asc"
>  #image(grelhaID)
>  grelhaID[is.na(grelhaID)] <- 0
>  #win.graph()
>  #image(grelhaID)
>  pixID = asc2spixdf(grelhaID)                                #! Build
> SpatialPixelDataFrame from asc object
>  class(pixID)
>  names(pixID) <- "ID"
>  image(pixID)
>
> ____________
> Paulo E. Cardoso
>
>
>> -----Mensagem original-----
>> De: Roger Bivand [mailto:Roger.Bivand at nhh.no]
>> Enviada: quarta-feira, 15 de Julho de 2009 18:04
>> Para: pecardoso
>> Cc: R-sig-Geo
>> Assunto: Re: [R-sig-Geo] split SpatialPolygon after
>> unionSpatialPolygons()
>>
>> On Tue, 14 Jul 2009, pecardoso wrote:
>>
>>> I've used unionSpatialPolygons to dissolve polygons and get a grid as
>> a
>>> spatialpolygon.
>>>
>>> A simple example:
>>> grelha<-readGDAL(paste("C:/...","teste.bmp",sep=""))
>>
>> Please only use examples that refer to a publically available data set.
>>
>>> grd <- slot(grelha, "grid")
>>> pol <- as.SpatialPolygons.GridTopology(grd)
>>> pol <- unionSpatialPolygons(pol, SGDF2PCT(grelha)$idx)
>>>
>>
>> Exactly. This creates a rectangular polygon for each raster cell
>> specified
>> by grd, then removes all internal boundaries between those raster cells
>> with the same value of the index, additionally placing all the separate
>> Polygon objects with the same value of the index in a Polygons object.
>> No-one has given them IDs, all the function has to work on are the
>> index
>> values.
>>
>> I think that this is the same question that you asked recently, to
>> which I
>> replied indicating that you should use labcon() in adehabitat to give a
>> separate index to each disconnected cluster with the same index values.
>>
>> The alternative is to re-format the output SpatialPolygons object to
>> find
>> out how many Polygon objects there are in each Polygons object, and
>> then
>> to flatten those with more than one - that is make each such Polygon
>> object into a singleton Polygons object with a unique ID slot value. It
>> is
>> possible, but you will need some knowledge of the way these objects are
>> constructed. If you can post a sample image, it may not be too hard,
>> either using labcon() or by re-formatting the representation.
>>
>> Roger
>>
>>> When the original image have more than one region or 'islands' of a
>>> single color (imagine a small logo), the unionSpatialPolygons() will
>>> dissolve polygons based on the ID's provided, in such a way that
>>> coordinates(pol) will return N lines, as much as different ID's or
>>> colors retrieved with SGDF2PCT(grelha)$idx.
>>>
>>> It means that one cannot get centroids of each individual regions.
>>> Beside this, if the original image have this pattern, each number is
>> a
>>> pixel of a single color:
>>>
>>> 00100
>>> 02000
>>> 00020
>>> 10000
>>>
>>> coordinates() will give only 3 centroids and only for three of the
>>> polygons (not even a common centroid for 1 and 2 ID's).
>>>
>>> I'd like to split the spatialpolygon object obtained with
>>> unionSpatialPolygons(pol, SGDF2PCT(grelha)$idx) but retaining the
>> ID's
>>> in order to get individual centroids for each region, in this simple
>>> case, two centroids for 1, two for 2 and two for 0.
>>>
>>> Any idea will be welcome
>>>
>>>
>>>
>>> 	[[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>> --
>> Roger Bivand
>> Economic Geography Section, Department of Economics, Norwegian School
>> of
>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>> e-mail: Roger.Bivand at nhh.no
>>
>> Checked by AVG - www.avg.com
>> Version: 8.5.375 / Virus Database: 270.13.16/2241 - Release Date:
>> 07/16/09 05:58:00
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From ajung at sedgeo.uni-tuebingen.de  Thu Jul 16 18:29:04 2009
From: ajung at sedgeo.uni-tuebingen.de (Andre Jung)
Date: Thu, 16 Jul 2009 18:29:04 +0200
Subject: [R-sig-Geo] RandomFields: Randomness in realisations of sequential
	simulation?
Message-ID: <4A5F5550.10708@sedgeo.uni-tuebingen.de>

Dear all,

I've some general question regarding the implementation of
randomness in RandomFields and sequential simulation.

(1) Is there a difference between running
    krige(nsim = 5, ....)
     and running
    krige(nsim = 1, ....)
     for 5 times?

(2) Does repeating of the simulation with the same random number seed
     (how to keep the seed?) lead to the same realisations? And: how
     random is the path?

(3) Can I fix the parameters (which ones?) to reproduce the same
     realisations a later time?


Another question is: How can I generate an 'e-type' of, let's say 10, 
realisations, and do some post-simulation analysis like defining 
probability to be above or below a certain threshold?


Many thanks in advance!

best,
Andre


From a.ghisla at gmail.com  Fri Jul 17 17:01:49 2009
From: a.ghisla at gmail.com (Anne Ghisla)
Date: Fri, 17 Jul 2009 17:01:49 +0200
Subject: [R-sig-Geo] [Report #8 - midterm] Kriging with GRASS and R:
 v.autokrige port to wxPython and more
Message-ID: <4A60925D.6020907@gmail.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hello all, and sorry for cross-posting,

this week I added Command output tab and the option for block kriging,
and updated documentation with more precise information on dependencies.
I'll add splashscreen only as dependency check and command output will
be fixed: next week I plan to work on these latter issues.

Nothing in particular is blocking progress, just some hardest stone
sometimes.

best regards,

Anne
- --
http://grass.osgeo.org/wiki/V.krige_GSoC_2009


-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.9 (MingW32)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org

iEYEARECAAYFAkpgkl0ACgkQzZ3g4YwFFgagkwCfWZIfdxXjZPk6Eo/896Bl+c5+
NJMAn1Ytsu/smc8WPxHchaGryyyHQOe7
=rffE
-----END PGP SIGNATURE-----


From marcarmu at gmail.com  Fri Jul 17 18:43:13 2009
From: marcarmu at gmail.com (=?UTF-8?Q?Marcia_Mu=C3=B1oz?=)
Date: Fri, 17 Jul 2009 12:43:13 -0400
Subject: [R-sig-Geo] help with semivariograms
Message-ID: <4d0b5e4f0907170943j83b96dr8b13d5003ee9b0cd@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090717/f44aa534/attachment.pl>

From ssefick at gmail.com  Fri Jul 17 20:18:58 2009
From: ssefick at gmail.com (stephen sefick)
Date: Fri, 17 Jul 2009 13:18:58 -0500
Subject: [R-sig-Geo] merging data with a dataframe based on a common
	identifier
In-Reply-To: <alpine.LRH.2.00.0907130015380.21380@reclus.nhh.no>
References: <c502a9e10907120557y65627f74nb0a2546115021fe6@mail.gmail.com>
	<alpine.LRH.2.00.0907130015380.21380@reclus.nhh.no>
Message-ID: <c502a9e10907171118v379481acw5d819b48546b1665@mail.gmail.com>

Do you have advice on how to order streams?
regards

Stephen Sefick

On Sun, Jul 12, 2009 at 5:32 PM, Roger Bivand<Roger.Bivand at nhh.no> wrote:
> On Sun, 12 Jul 2009, stephen sefick wrote:
>
>> I have used v.strahler in GRASS to calculate the stream order. ?This
>> module writes its results to a text file. ?The line column of the
>> output data is the common name between the two data sets. ?I would
>> like to attach the stream order to the streams vector. ?I have looked
>> at the data once in R with
>>
>> pseudocode:
>> streams <- readVECT6("streams")
>> str(streams)
>
> Well, v.strahler is a very fresh GRASS addon, not a regular part of GRASS,
> and does require a clean topology. Running it on streams in spearfish, with
> the elevation.dem DEM, gives an output vector map, say st_o0:
>
> v.strahler --verbose --overwrite input=streams output=st_o0 \
> ?dem=elevation.dem txout=st_o0.txt sloppy=0 layer=1
>
>
> st_o0 <- readVECT6("st_o0", type="line,boundary", with_c=TRUE,
> ?remove.duplicates=FALSE, plugin=FALSE)
>
> gets 116 lines. They agree with the first 116 of 119 lines in st_o0.txt:
>
> tbl <- read.table("st_o0.txt", skip=1, header=TRUE)
>
> by plotting. For example:
>
> plot(st_o0, col=rainbow(27)[tbl[1:116,]$Basin.])
>
> looks plausible. However, where the streams are not fully connected, basins
> get split, with obvious consequences for the order. The cat in the vector
> layer seems to be the order too, as stated on the help page - I think that
> this is where the graphics on the help page are coming from. I think that
> this agrees with advice that your got on the grass-users list. It may be
> that you need to check the cleanness of the topology of the stream lines
> carefully - this is repeated on the help page. You may also need to read the
> v.strahler code to check what it is assigning, as:
>
> plot(st_o0, col=tbl[1:116,]$Order.)
>
> or equivalently:
>
> plot(st_o0, col=st_o0$cat)
>
> don't match my view of drainage in spearfish.
>
> Hope this helps
>
> Roger
>
>>
>> and it is a huge list. ?I am not sure the best way to tackle this problem.
>> thanks for any help,
>>
>>
>
> --
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>
>



-- 
Stephen Sefick

Let's not spend our time and resources thinking about things that are
so little or so large that all they really do for us is puff us up and
make us feel like gods.  We are mammals, and have not exhausted the
annoying little problems of being mammals.

								-K. Mullis


From Roger.Bivand at nhh.no  Fri Jul 17 20:36:00 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 17 Jul 2009 20:36:00 +0200 (CEST)
Subject: [R-sig-Geo] merging data with a dataframe based on a common
 identifier
In-Reply-To: <c502a9e10907171118v379481acw5d819b48546b1665@mail.gmail.com>
References: <c502a9e10907120557y65627f74nb0a2546115021fe6@mail.gmail.com>
	<alpine.LRH.2.00.0907130015380.21380@reclus.nhh.no>
	<c502a9e10907171118v379481acw5d819b48546b1665@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.0907172024140.8265@reclus.nhh.no>

On Fri, 17 Jul 2009, stephen sefick wrote:

> Do you have advice on how to order streams?

My comments were with regard to the specific dataset. The documentation 
for v.strahler does say that it needs a topologically complete and correct 
stream network, so I guess you could see how it does on artificial, simple 
cases with a known outcome, where you also have a suitable DEM. Increasing 
the complexity would show where the problems start. In spearfish streams, 
there are water bodies like ponds, which (I think) break the network. The 
example on the v.strahler page:

https://svn.osgeo.org/grass/grass-addons/vector/v.strahler/description.html

looks OK, but no dataset is provided. It would probably be helpful to ask 
for advice on using v.strahler on the grass-users list

Roger

> regards
>
> Stephen Sefick
>
> On Sun, Jul 12, 2009 at 5:32 PM, Roger Bivand<Roger.Bivand at nhh.no> wrote:
>> On Sun, 12 Jul 2009, stephen sefick wrote:
>>
>>> I have used v.strahler in GRASS to calculate the stream order. ?This
>>> module writes its results to a text file. ?The line column of the
>>> output data is the common name between the two data sets. ?I would
>>> like to attach the stream order to the streams vector. ?I have looked
>>> at the data once in R with
>>>
>>> pseudocode:
>>> streams <- readVECT6("streams")
>>> str(streams)
>>
>> Well, v.strahler is a very fresh GRASS addon, not a regular part of GRASS,
>> and does require a clean topology. Running it on streams in spearfish, with
>> the elevation.dem DEM, gives an output vector map, say st_o0:
>>
>> v.strahler --verbose --overwrite input=streams output=st_o0 \
>> ?dem=elevation.dem txout=st_o0.txt sloppy=0 layer=1
>>
>>
>> st_o0 <- readVECT6("st_o0", type="line,boundary", with_c=TRUE,
>> ?remove.duplicates=FALSE, plugin=FALSE)
>>
>> gets 116 lines. They agree with the first 116 of 119 lines in st_o0.txt:
>>
>> tbl <- read.table("st_o0.txt", skip=1, header=TRUE)
>>
>> by plotting. For example:
>>
>> plot(st_o0, col=rainbow(27)[tbl[1:116,]$Basin.])
>>
>> looks plausible. However, where the streams are not fully connected, basins
>> get split, with obvious consequences for the order. The cat in the vector
>> layer seems to be the order too, as stated on the help page - I think that
>> this is where the graphics on the help page are coming from. I think that
>> this agrees with advice that your got on the grass-users list. It may be
>> that you need to check the cleanness of the topology of the stream lines
>> carefully - this is repeated on the help page. You may also need to read the
>> v.strahler code to check what it is assigning, as:
>>
>> plot(st_o0, col=tbl[1:116,]$Order.)
>>
>> or equivalently:
>>
>> plot(st_o0, col=st_o0$cat)
>>
>> don't match my view of drainage in spearfish.
>>
>> Hope this helps
>>
>> Roger
>>
>>>
>>> and it is a huge list. ?I am not sure the best way to tackle this problem.
>>> thanks for any help,
>>>
>>>
>>
>> --
>> Roger Bivand
>> Economic Geography Section, Department of Economics, Norwegian School of
>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>> e-mail: Roger.Bivand at nhh.no
>>
>>
>
>
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From pierre.roudier at gmail.com  Sat Jul 18 05:15:11 2009
From: pierre.roudier at gmail.com (Pierre Roudier)
Date: Sat, 18 Jul 2009 13:15:11 +1000
Subject: [R-sig-Geo] help with semivariograms
In-Reply-To: <4d0b5e4f0907170943j83b96dr8b13d5003ee9b0cd@mail.gmail.com>
References: <4d0b5e4f0907170943j83b96dr8b13d5003ee9b0cd@mail.gmail.com>
Message-ID: <e4178da60907172015w1c28fde3y4297d04d13822ce4@mail.gmail.com>

Hi Marcia,

You should have a look to ?fit.variogram and ?vgm from the gstat
package, and ?autofitVariogram from the automap package.

Pierre

2009/7/18 Marcia Mu?oz <marcarmu at gmail.com>:
> Dear all,
>
> I have done a semivariogram with R and now I want to fit my semivariogram
> with both models, Gaussian and Lineal to see which one is better to my data.
> I have no idea about how to do this "fit", so do they have any script that
> can help me with this?. Thanks a lot
>
> sincerely,
>
> Marcia
>
> --
> Marcia C. Mu?oz
> Universidad de Puerto Rico
> Departamento de Biologia - FB246
> POBOX 23360
> San Juan, PR 00931-3360
> tel: 787-7640000, 2900
>
> ? ? ? ?[[alternative HTML version deleted]]
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>


From marcarmu at gmail.com  Sat Jul 18 07:08:04 2009
From: marcarmu at gmail.com (=?UTF-8?Q?Marcia_Mu=C3=B1oz?=)
Date: Sat, 18 Jul 2009 01:08:04 -0400
Subject: [R-sig-Geo] more about semivariogram
Message-ID: <4d0b5e4f0907172208t4bf47290h76b30b25357c4796@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090718/07208aa7/attachment.pl>

From hengl at spatial-analyst.net  Sat Jul 18 15:52:37 2009
From: hengl at spatial-analyst.net (Tomislav Hengl)
Date: Sat, 18 Jul 2009 15:52:37 +0200
Subject: [R-sig-Geo] more about semivariogram
In-Reply-To: <4d0b5e4f0907172208t4bf47290h76b30b25357c4796@mail.gmail.com>
References: <4d0b5e4f0907172208t4bf47290h76b30b25357c4796@mail.gmail.com>
Message-ID: <18857D7F5D504F10AF58E00935AB845A@pcibed193>


Dear Marcia,

Why would you mask "0"? This is hard data and throwing it out would lead to complete different
results. This reminds of Alex McBratney's quote "You should aim at developing tools that can fit
your data, and not the other way around."

If the purpose of your analysis is spatial prediction of counts, then you should use some link
function (the best candidate is probably Zero Inflated Poisson model) to fit the regression model,
then model variogram for residuals (transformed scale) and interpolate them using ordinary kriging.

This is all well explained in:

E.J. Pebesma, R.N.M. Duin, P.A. Burrough, 2005. Mapping Sea Bird Densities over the North Sea:
Spatially Aggregated Estimates and Temporal Changes. Environmetrics 16, (6), p 573-587 
http://dx.doi.org/10.1002/env.723 

See also the demo script: 

> library(gstat)
> demo(fulmar) # Fulmaris glacialis

T. Hengl
http://spatial-analyst.net/wiki/index.php?title=Species_Distribution_Modelling 



> -----Original Message-----
> From: r-sig-geo-bounces at stat.math.ethz.ch [mailto:r-sig-geo-bounces at stat.math.ethz.ch] On Behalf
> Of Marcia Mu?oz
> Sent: Saturday, July 18, 2009 7:08 AM
> To: r-sig-geo at stat.math.ethz.ch
> Subject: [R-sig-Geo] more about semivariogram
> 
> Dear all,
> 
> I want to do a variogram with 520 points, in each point I have abundance of
> a species. My problem or doubt is this, many of these points are empty, they
> have zero (0). My question is, can I do my variogram with all the 520 points
> or just with points that have abundance greater than zero?
> 
> Thanks a lot!
> 
> Mar
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From mwkhan at ucdavis.edu  Mon Jul 20 04:59:05 2009
From: mwkhan at ucdavis.edu (Mehdi Khan)
Date: Sun, 19 Jul 2009 19:59:05 -0700
Subject: [R-sig-Geo] Fwd: Creating an attribute table from 3 different files
In-Reply-To: <60b3892e0907191955n1c971647mc15c92d492b51190@mail.gmail.com>
References: <60b3892e0907191955n1c971647mc15c92d492b51190@mail.gmail.com>
Message-ID: <60b3892e0907191959y3c14900bk4b92b7852e157171@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090719/975948ff/attachment.pl>

From craig.scanlan at agric.wa.gov.au  Mon Jul 20 09:55:14 2009
From: craig.scanlan at agric.wa.gov.au (Scanlan, Craig)
Date: Mon, 20 Jul 2009 15:55:14 +0800
Subject: [R-sig-Geo] creating irregularly-shaped grids for kriging
Message-ID: <F545B7EA76A6034D8ED56B5DC59AED8E0209D0AE@agspsrmx03.agric.wa.gov.au>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090720/46b6d67c/attachment.pl>

From p.hiemstra at geo.uu.nl  Mon Jul 20 10:40:19 2009
From: p.hiemstra at geo.uu.nl (Paul Hiemstra)
Date: Mon, 20 Jul 2009 10:40:19 +0200
Subject: [R-sig-Geo] creating irregularly-shaped grids for kriging
In-Reply-To: <F545B7EA76A6034D8ED56B5DC59AED8E0209D0AE@agspsrmx03.agric.wa.gov.au>
References: <F545B7EA76A6034D8ED56B5DC59AED8E0209D0AE@agspsrmx03.agric.wa.gov.au>
Message-ID: <4A642D73.1020805@geo.uu.nl>

Hi Craig,

The easiest way is to get a polygon of you study area and than use 
spsample() to create a grid. You could also make a convex hull using the 
chull command and spsample from that. Depending on your configuration of 
points this might be an option. You could try autoKrige from the automap 
pacakge to get an idea of how this last option looks, it uses a convex 
hull to create a new_data object if it is not given.

library(automap)
data(meuse)
coordinates(meuse) = ~x+y

kr = autoKrige(meuse)
plot(kr)

cheers,
Paul

Scanlan, Craig wrote:
> Hi all,
>  
> I need to krige data that is irregularly spaced within irregularly
> shaped areas (agricultural fields).   
>  
> At present, I am creating a regular grid for newdata in
> krige(data,newdata....) by
>  
> x.range <- as.integer(range(a2 at coords[,1]))
> y.range <- as.integer(range(a2 at coords[,2]))
> grd <- expand.grid(x=seq(from=x.range[1], to=x.range[2], by=10),
> y=seq(from=y.range[1], to=y.range[2], by=10) )
>
> I have not been able to find a method to trim the newdata grid to the
> same shape as the original data - is this possible?
>  
> The task I am trying to achieve is the same as creating meuse.grid from
> meuse data.
>  
> Can anyone help?
>  
> Regards,
>  
> Craig.
>  
>
>
> This e-mail and files transmitted with it are privileged and confidential information 
> intended for the use of the addressee. The confidentiality and/or privilege in this e-mail is 
> not waived, lost or destroyed if it has been transmitted to you in error. If you received this 
> e-mail in error you must 
> (a) not disseminate, copy or take any action in reliance on it; 
> (b) please notify the Department of Agriculture and Food, WA immediately by return e-mail to the sender; 
> (c) please delete the original e-mail.
>
> This email has been successfully scanned by
> McAfee Anti-Virus software.
> Department of Agriculture and Food WA
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>   


-- 
Drs. Paul Hiemstra
Department of Physical Geography
Faculty of Geosciences
University of Utrecht
Heidelberglaan 2
P.O. Box 80.115
3508 TC Utrecht
Phone:  +3130 274 3113 Mon-Tue
Phone:  +3130 253 5773 Wed-Fri
http://intamap.geo.uu.nl/~paul


From pierre.roudier at gmail.com  Mon Jul 20 10:53:08 2009
From: pierre.roudier at gmail.com (Pierre Roudier)
Date: Mon, 20 Jul 2009 18:53:08 +1000
Subject: [R-sig-Geo] creating irregularly-shaped grids for kriging
In-Reply-To: <F545B7EA76A6034D8ED56B5DC59AED8E0209D0AE@agspsrmx03.agric.wa.gov.au>
References: <F545B7EA76A6034D8ED56B5DC59AED8E0209D0AE@agspsrmx03.agric.wa.gov.au>
Message-ID: <e4178da60907200153m194b894cm935d0373078b8653@mail.gmail.com>

Hi Craig,

I have a workaround for this using the getpoly() inout()

2009/7/20, Scanlan, Craig <craig.scanlan at agric.wa.gov.au>:
> Hi all,
>
> I need to krige data that is irregularly spaced within irregularly
> shaped areas (agricultural fields).
>
> At present, I am creating a regular grid for newdata in
> krige(data,newdata....) by
>
> x.range <- as.integer(range(a2 at coords[,1]))
> y.range <- as.integer(range(a2 at coords[,2]))
> grd <- expand.grid(x=seq(from=x.range[1], to=x.range[2], by=10),
> y=seq(from=y.range[1], to=y.range[2], by=10) )
>
> I have not been able to find a method to trim the newdata grid to the
> same shape as the original data - is this possible?
>
> The task I am trying to achieve is the same as creating meuse.grid from
> meuse data.
>
> Can anyone help?
>
> Regards,
>
> Craig.
>
>
>
> This e-mail and files transmitted with it are privileged and confidential
> information
> intended for the use of the addressee. The confidentiality and/or privilege
> in this e-mail is
> not waived, lost or destroyed if it has been transmitted to you in error. If
> you received this
> e-mail in error you must
> (a) not disseminate, copy or take any action in reliance on it;
> (b) please notify the Department of Agriculture and Food, WA immediately by
> return e-mail to the sender;
> (c) please delete the original e-mail.
>
> This email has been successfully scanned by
> McAfee Anti-Virus software.
> Department of Agriculture and Food WA
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From pierre.roudier at gmail.com  Mon Jul 20 11:17:29 2009
From: pierre.roudier at gmail.com (Pierre Roudier)
Date: Mon, 20 Jul 2009 19:17:29 +1000
Subject: [R-sig-Geo] creating irregularly-shaped grids for kriging
In-Reply-To: <e4178da60907200153m194b894cm935d0373078b8653@mail.gmail.com>
References: <F545B7EA76A6034D8ED56B5DC59AED8E0209D0AE@agspsrmx03.agric.wa.gov.au>
	<e4178da60907200153m194b894cm935d0373078b8653@mail.gmail.com>
Message-ID: <e4178da60907200217t2a289d72v44ae7d1e5ee4a129@mail.gmail.com>

Hi again, and apologises to the list for the posting problem,

I am using a workaround for this using inout() and getpoly() (or
locator()) on agricultural fields that have irregular boundaries:

1- Make your regular grid using expand.grid. Then you got your
rectangular grid under a variable called grd.

2a- If you already have the coordinates of the boundaries of the
polygon, have a look to ?inout from the splancs package to sort the
coordinates of your grid.

bound <- read.csv('myboundary.txt',header=TRUE)
grd <- grd[inout(grd,bound),]

2b- If you want to enter manually those boundaries, plot the
coordinates of your grid and enter the polygon using getpoly() from
the same package :

plot(grd,pch='+')
bound <- getpoly()
grd <- grd[inout(grd,bound),]

Here is a simple example that works on my box:

require(splancs)
x <- seq(0,100,by=2)
y <- seq(0,100,by=5)
grd <- expand.grid(x=x,y=y)
plot(grd,pch='+')
bound <- getpoly()
grd.irregular <- grd[inout(grd,bound),]
plot(grd,pch='+')
points(grd.irregular,pch=16,col='red')

Then you can convert it to a sp object:
names(grd.irregular)[1] <- 'x'
names(grd.irregular)[2] <- 'y'
coordinates(grd.irregular) <- c('x','y')
gridded(grd.irregular) <- TRUE

All the best,

Pierre

2009/7/20, Pierre Roudier <pierre.roudier at gmail.com>:
> Hi Craig,
>
> I have a workaround for this using the getpoly() inout()
>
> 2009/7/20, Scanlan, Craig <craig.scanlan at agric.wa.gov.au>:
>> Hi all,
>>
>> I need to krige data that is irregularly spaced within irregularly
>> shaped areas (agricultural fields).
>>
>> At present, I am creating a regular grid for newdata in
>> krige(data,newdata....) by
>>
>> x.range <- as.integer(range(a2 at coords[,1]))
>> y.range <- as.integer(range(a2 at coords[,2]))
>> grd <- expand.grid(x=seq(from=x.range[1], to=x.range[2], by=10),
>> y=seq(from=y.range[1], to=y.range[2], by=10) )
>>
>> I have not been able to find a method to trim the newdata grid to the
>> same shape as the original data - is this possible?
>>
>> The task I am trying to achieve is the same as creating meuse.grid from
>> meuse data.
>>
>> Can anyone help?
>>
>> Regards,
>>
>> Craig.
>>
>>
>>
>> This e-mail and files transmitted with it are privileged and confidential
>> information
>> intended for the use of the addressee. The confidentiality and/or
>> privilege
>> in this e-mail is
>> not waived, lost or destroyed if it has been transmitted to you in error.
>> If
>> you received this
>> e-mail in error you must
>> (a) not disseminate, copy or take any action in reliance on it;
>> (b) please notify the Department of Agriculture and Food, WA immediately
>> by
>> return e-mail to the sender;
>> (c) please delete the original e-mail.
>>
>> This email has been successfully scanned by
>> McAfee Anti-Virus software.
>> Department of Agriculture and Food WA
>>
>> 	[[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>


From hzambran.newsgroups at gmail.com  Mon Jul 20 16:24:46 2009
From: hzambran.newsgroups at gmail.com (Mauricio Zambrano)
Date: Mon, 20 Jul 2009 16:24:46 +0200
Subject: [R-sig-Geo] creating irregularly-shaped grids for kriging
In-Reply-To: <4A642D73.1020805@geo.uu.nl>
References: <F545B7EA76A6034D8ED56B5DC59AED8E0209D0AE@agspsrmx03.agric.wa.gov.au>
	<4A642D73.1020805@geo.uu.nl>
Message-ID: <63d616b0907200724i2837ed74wa0bb174128ae2fb6@mail.gmail.com>

Hi Craig,

If you have a shapefile of your agricultural fields, you can use the
function "readShapePoly" (maptools package) for getting the polygons
of your agricultural fields, and then use the "spsample" command to
create the grid within the polygons, as Paul mentioned. Finally, you
can use the grid generated by spsample as the object with prediction
locations.

Something like:

1) require(maptools)

2) shp <- readShapePoly(yourshapefilename, proj4string=yourp4s)

3) agr.grid <- spsample(shp, type="regular", cellsize=yourcell.size,
offset = c(0.5, 0.5))

4) gridded(agr.grid) <- TRUE

5) x <- krige(yourvalue~1, locations=yourlocations, newdata=agr.grid,
model=yourmodel) (or the autoKrige version of this)


I hope this helps.

Kinds,

Mauricio

-- 
?=============================================
Linux user #454569 -- Ubuntu user #17469
=============================================?
"It is not enough to have knowledge;
one must also apply it"
(Goethe)

> Hi Craig,
>
> The easiest way is to get a polygon of you study area and than use
> spsample() to create a grid. You could also make a convex hull using the
> chull command and spsample from that. Depending on your configuration of
> points this might be an option. You could try autoKrige from the automap
> pacakge to get an idea of how this last option looks, it uses a convex hull
> to create a new_data object if it is not given.
>
> library(automap)
> data(meuse)
> coordinates(meuse) = ~x+y
>
> kr = autoKrige(meuse)
> plot(kr)
>
> cheers,
> Paul
>
> Scanlan, Craig wrote:
>>
>> Hi all,
>> ?I need to krige data that is irregularly spaced within irregularly
>> shaped areas (agricultural fields). ? ?At present, I am creating a regular
>> grid for newdata in
>> krige(data,newdata....) by
>> ?x.range <- as.integer(range(a2 at coords[,1]))
>> y.range <- as.integer(range(a2 at coords[,2]))
>> grd <- expand.grid(x=seq(from=x.range[1], to=x.range[2], by=10),
>> y=seq(from=y.range[1], to=y.range[2], by=10) )
>>
>> I have not been able to find a method to trim the newdata grid to the
>> same shape as the original data - is this possible?
>> ?The task I am trying to achieve is the same as creating meuse.grid from
>> meuse data.
>> ?Can anyone help?
>> ?Regards,
>> ?Craig.
>>
>>
>> This e-mail and files transmitted with it are privileged and confidential
>> information intended for the use of the addressee. The confidentiality
>> and/or privilege in this e-mail is not waived, lost or destroyed if it has
>> been transmitted to you in error. If you received this e-mail in error you
>> must (a) not disseminate, copy or take any action in reliance on it; (b)
>> please notify the Department of Agriculture and Food, WA immediately by
>> return e-mail to the sender; (c) please delete the original e-mail.
>>
>> This email has been successfully scanned by
>> McAfee Anti-Virus software.
>> Department of Agriculture and Food WA
>>
>> ? ? ? ?[[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>
> --
> Drs. Paul Hiemstra
> Department of Physical Geography
> Faculty of Geosciences
> University of Utrecht
> Heidelberglaan 2
> P.O. Box 80.115
> 3508 TC Utrecht
> Phone: ?+3130 274 3113 Mon-Tue
> Phone: ?+3130 253 5773 Wed-Fri
> http://intamap.geo.uu.nl/~paul
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From mwkhan at ucdavis.edu  Mon Jul 20 19:39:04 2009
From: mwkhan at ucdavis.edu (Mehdi Khan)
Date: Mon, 20 Jul 2009 10:39:04 -0700
Subject: [R-sig-Geo] Creating an attribute table from 3 different files
In-Reply-To: <60b3892e0907191959y3c14900bk4b92b7852e157171@mail.gmail.com>
References: <60b3892e0907191955n1c971647mc15c92d492b51190@mail.gmail.com> 
	<60b3892e0907191959y3c14900bk4b92b7852e157171@mail.gmail.com>
Message-ID: <60b3892e0907201039n7c335b3bxc7feaec5c7fc3820@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090720/db674be3/attachment.pl>

From pecardoso at netcabo.pt  Tue Jul 21 11:53:41 2009
From: pecardoso at netcabo.pt (Paulo E. Cardoso)
Date: Tue, 21 Jul 2009 10:53:41 +0100
Subject: [R-sig-Geo] SpatialGridDataFrame and asc - Matrix inversion with
	as.asc(as.matrix(x))
Message-ID: <!&!AAAAAAAAAAAYAAAAAAAAAK2N38q7o51Ejb8q0JfvLrBiggAAEAAAAKaZ6KZOpGdBtNam/nsolzMBAAAAAA==@netcabo.pt>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090721/b1f57246/attachment.pl>

From milton.ruser at gmail.com  Tue Jul 21 12:17:02 2009
From: milton.ruser at gmail.com (milton ruser)
Date: Tue, 21 Jul 2009 06:17:02 -0400
Subject: [R-sig-Geo] SpatialGridDataFrame and asc - Matrix inversion
	with as.asc(as.matrix(x))
In-Reply-To: <!&!AAAAAAAAAAAYAAAAAAAAAK2N38q7o51Ejb8q0JfvLrBiggAAEAAAAKaZ6KZOpGdBtNam/nsolzMBAAAAAA==@netcabo.pt>
References: <!&!AAAAAAAAAAAYAAAAAAAAAK2N38q7o51Ejb8q0JfvLrBiggAAEAAAAKaZ6KZOpGdBtNam/nsolzMBAAAAAA==@netcabo.pt>
Message-ID: <3aaf1a030907210317n233abdd2m11dbb6a399c301e2@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090721/53a0acac/attachment.pl>

From pecardoso at netcabo.pt  Tue Jul 21 12:30:17 2009
From: pecardoso at netcabo.pt (Paulo E. Cardoso)
Date: Tue, 21 Jul 2009 11:30:17 +0100
Subject: [R-sig-Geo] SpatialGridDataFrame and asc - Matrix inversion
	with as.asc(as.matrix(x))
In-Reply-To: <3aaf1a030907210317n233abdd2m11dbb6a399c301e2@mail.gmail.com>
References: <!&!AAAAAAAAAAAYAAAAAAAAAK2N38q7o51Ejb8q0JfvLrBiggAAEAAAAKaZ6KZOpGdBtNam/nsolzMBAAAAAA==@netcabo.pt>
	<3aaf1a030907210317n233abdd2m11dbb6a399c301e2@mail.gmail.com>
Message-ID: <!&!AAAAAAAAAAAYAAAAAAAAAK2N38q7o51Ejb8q0JfvLrBiggAAEAAAACV0hoBd9p1PrPpDspxMickBAAAAAA==@netcabo.pt>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090721/5724df14/attachment.pl>

From pecardoso at netcabo.pt  Tue Jul 21 12:43:05 2009
From: pecardoso at netcabo.pt (Paulo E. Cardoso)
Date: Tue, 21 Jul 2009 11:43:05 +0100
Subject: [R-sig-Geo] SpatialGridDataFrame and asc - Matrix
	inversion	with as.asc(as.matrix(x))
In-Reply-To: <!&!AAAAAAAAAAAYAAAAAAAAAK2N38q7o51Ejb8q0JfvLrBiggAAEAAAACV0hoBd9p1PrPpDspxMickBAAAAAA==@netcabo.pt>
References: <!&!AAAAAAAAAAAYAAAAAAAAAK2N38q7o51Ejb8q0JfvLrBiggAAEAAAAKaZ6KZOpGdBtNam/nsolzMBAAAAAA==@netcabo.pt>	<3aaf1a030907210317n233abdd2m11dbb6a399c301e2@mail.gmail.com>
	<!&!AAAAAAAAAAAYAAAAAAAAAK2N38q7o51Ejb8q0JfvLrBiggAAEAAAACV0hoBd9p1PrPpDspxMickBAAAAAA==@netcabo.pt>
Message-ID: <!&!AAAAAAAAAAAYAAAAAAAAAK2N38q7o51Ejb8q0JfvLrBiggAAEAAAAOyJLIP4oXRAvUyTXmOG1rUBAAAAAA==@netcabo.pt>

Milton, It works just like you proposed. Solved
Thanks.

____________
Paulo E. Cardoso

> -----Mensagem original-----
> De: r-sig-geo-bounces at stat.math.ethz.ch [mailto:r-sig-geo-
> bounces at stat.math.ethz.ch] Em nome de Paulo E. Cardoso
> Enviada: ter?a-feira, 21 de Julho de 2009 11:30
> Para: 'milton ruser'
> Cc: 'R-sig-Geo'
> Assunto: Re: [R-sig-Geo] SpatialGridDataFrame and asc - Matrix
> inversion with as.asc(as.matrix(x))
> 
> Hi Milton,
> 
> 
> 
> This is flipping columns and I'd like to flip rows instead.
> 
> 
> 
> x <- 1:12 ; dim(x) <- c(4,3)
> 
> x
> 
> x<-x[,dim(x)[2]:1]
> 
> x
> 
> 
> 
> Beside this, I'd like to know if this could be done with the
> SpatialGridDataFrame.
> 
> 
> 
> Any idea?
> 
> ____________
> 
> Paulo E. Cardoso
> 
> 
> 
> De: milton ruser [mailto:milton.ruser at gmail.com]
> Enviada: terga-feira, 21 de Julho de 2009 11:17
> Para: Paulo E. Cardoso
> Cc: R-sig-Geo
> Assunto: Re: [R-sig-Geo] SpatialGridDataFrame and asc - Matrix
> inversion with as.asc(as.matrix(x))
> 
> 
> 
> Hi Paulo,
> 
> 
> 
> try this:
> 
> 
> 
> x<-x[,dim(x)[2]:1]
> 
> cheers
> 
> 
> 
> milton
> 
> On Tue, Jul 21, 2009 at 5:53 AM, Paulo E. Cardoso
> <pecardoso at netcabo.pt>
> wrote:
> 
> By converting a SpatialGridDataFrame into a asc object with
> 
> 
> 
> asc.obj <- as.asc(as.matrix(x),xll = 0.5, yll = 0.5)
> 
> 
> 
> the object created have inverted rows. It apparently starts reading
> from bellow, inverting row reading but keeping columns unchanged.
> 
> 
> 
> The result is a flipped image.
> 
> 
> 
> Can this be corrected and how?
> 
> ____________
> 
> Paulo E. Cardoso
> 
> 
> 
> 
>        [[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 
> 
> 
> Checked by AVG - www.avg.com
> 
> 06:16:00
> 
> 
> 	[[alternative HTML version deleted]]
> 
> 
> Checked by AVG - www.avg.com
> Version: 8.5.375 / Virus Database: 270.13.16/2241 - Release Date:
> 07/20/09 06:16:00


From pecardoso at netcabo.pt  Tue Jul 21 15:37:54 2009
From: pecardoso at netcabo.pt (Paulo E. Cardoso)
Date: Tue, 21 Jul 2009 14:37:54 +0100
Subject: [R-sig-Geo] Count points by grid cell overlay?
Message-ID: <!&!AAAAAAAAAAAYAAAAAAAAAK2N38q7o51Ejb8q0JfvLrBiggAAEAAAAPRyV9A3Rd1Lv9umvjvjM8wBAAAAAA==@netcabo.pt>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090721/ec30fbb7/attachment.pl>

From jean-paul.kibambe at uclouvain.be  Tue Jul 21 18:20:08 2009
From: jean-paul.kibambe at uclouvain.be (Jean-Paul Kibambe Lubamba)
Date: Tue, 21 Jul 2009 18:20:08 +0200
Subject: [R-sig-Geo] Remove duplicates objects
Message-ID: <e31e3449f7392668c54d1b3176ac0e17.squirrel@mmp.sipr-dc.ucl.ac.be>

Hi All,

I have a huge polyline file (slightly less than 2.10^6 objects) containing
some geographically duplicated objects. I tried to post some topological
rules using a GIS but due to the large number of objects, topology
validation and correction take a very long time.

So, I was thinking that may be there is a way to remove duplicate objects
using R and even for a huge file, it could take less time than using a
GIS.

Does anyone know how I could handle this ?

Any help is welcome ! Thanks in advance.


Jean-Paul


From craig.scanlan at agric.wa.gov.au  Wed Jul 22 02:27:25 2009
From: craig.scanlan at agric.wa.gov.au (Scanlan, Craig)
Date: Wed, 22 Jul 2009 08:27:25 +0800
Subject: [R-sig-Geo] DEM in R
Message-ID: <F545B7EA76A6034D8ED56B5DC59AED8E0209D1E0@agspsrmx03.agric.wa.gov.au>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090722/3ae292cf/attachment.pl>

From milton.ruser at gmail.com  Wed Jul 22 06:56:54 2009
From: milton.ruser at gmail.com (milton ruser)
Date: Wed, 22 Jul 2009 00:56:54 -0400
Subject: [R-sig-Geo] DEM in R
In-Reply-To: <F545B7EA76A6034D8ED56B5DC59AED8E0209D1E0@agspsrmx03.agric.wa.gov.au>
References: <F545B7EA76A6034D8ED56B5DC59AED8E0209D1E0@agspsrmx03.agric.wa.gov.au>
Message-ID: <3aaf1a030907212156i983b15bqb176aed34f8ed852@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090722/fb6ab52e/attachment.pl>

From hengl at spatial-analyst.net  Wed Jul 22 09:58:05 2009
From: hengl at spatial-analyst.net (Tomislav Hengl)
Date: Wed, 22 Jul 2009 09:58:05 +0200
Subject: [R-sig-Geo] DEM in R
In-Reply-To: <3aaf1a030907212156i983b15bqb176aed34f8ed852@mail.gmail.com>
References: <F545B7EA76A6034D8ED56B5DC59AED8E0209D1E0@agspsrmx03.agric.wa.gov.au>
	<3aaf1a030907212156i983b15bqb176aed34f8ed852@mail.gmail.com>
Message-ID: <75E5017B0A854041B862F4AF368F0704@pcibed193>


Dear Craig,

Plotting of DEMs and geomorphometric analysis is possible in R. For example, to derive slope/aspect,
you could use this script:

https://www.msu.edu/~ashton/classes/866/notes/lab12/slope.R
(https://stat.ethz.ch/pipermail/r-sig-geo/2009-July/006088.html)

Here is an example of a perspective plot:
http://addictedtor.free.fr/graphiques/RGraphGallery.php?graph=27

But you will soon find out that R can not really work well with large maps (and you do not want to
re-implement all algorithms for DEM analysis for scratch), so you should also consider using some
open source GIS (that can be used in combination with R):

"Analysis of DEMs in R+ILWIS/SAGA"
http://spatial-analyst.net/wiki/index.php?title=Analysis_of_DEMs_in_R%2BILWIS/SAGA 

"Geomorphometry in R+SAGA+ILWIS+GRASS"
http://geomorphometry.org/R.asp 

Welcome to R-sig-geo!

T. Hengl

PS: Your e-mail footer says that you are sending "confidential information", that we should "not
disseminate, copy or take any action in reliance on it" and that if this is true we should "notify
the Department of Agriculture and Food, WA immediately". Funny.


> -----Original Message-----
> From: r-sig-geo-bounces at stat.math.ethz.ch [mailto:r-sig-geo-bounces at stat.math.ethz.ch] On Behalf
> Of milton ruser
> Sent: Wednesday, July 22, 2009 6:57 AM
> To: Scanlan, Craig
> Cc: r-sig-geo at stat.math.ethz.ch
> Subject: Re: [R-sig-Geo] DEM in R
> 
> Hi Craig,
> 
> I think you can use several ways of generate your DEM from xyz points.
> One is you use interp function on akima package.
> 
> For derive slope and aspect, may be you can use R with GRASS (package
> spgrass6) or R with SAGA (package RSAGA).
> 
> How about you give a look at:
> http://spatial-analyst.net/wiki/index.php?title=Main_Page or
> http://www.geomorphometry.org/
> 
> bests
> 
> milton
> brazil=toronto
> 
> On Tue, Jul 21, 2009 at 8:27 PM, Scanlan, Craig <
> craig.scanlan at agric.wa.gov.au> wrote:
> 
> > Hi,
> >
> > I need to create a matrix of elevation data to plot with persp(). I have
> > data in the form of vectors x,y and z. Also, I need to be able to derive
> > attributes like slope and aspect from the DEM. I have not been able to
> > find any examples of these problems. Are there any available? Any
> > suggestions?
> >
> > Thanks
> >
> > Craig.
> >
> >
> >
> >
> > This e-mail and files transmitted with it are privileged and confidential
> > information
> > intended for the use of the addressee. The confidentiality and/or privilege
> > in this e-mail is
> > not waived, lost or destroyed if it has been transmitted to you in error.
> > If you received this
> > e-mail in error you must
> > (a) not disseminate, copy or take any action in reliance on it;
> > (b) please notify the Department of Agriculture and Food, WA immediately by
> > return e-mail to the sender;
> > (c) please delete the original e-mail.
> >
> > This email has been successfully scanned by
> > McAfee Anti-Virus software.
> > Department of Agriculture and Food WA
> >
> >        [[alternative HTML version deleted]]
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at stat.math.ethz.ch
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From Roger.Bivand at nhh.no  Wed Jul 22 15:03:35 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 22 Jul 2009 15:03:35 +0200 (CEST)
Subject: [R-sig-Geo] Creating an attribute table from 3 different files
In-Reply-To: <60b3892e0907201039n7c335b3bxc7feaec5c7fc3820@mail.gmail.com>
References: <60b3892e0907191955n1c971647mc15c92d492b51190@mail.gmail.com>
	<60b3892e0907191959y3c14900bk4b92b7852e157171@mail.gmail.com>
	<60b3892e0907201039n7c335b3bxc7feaec5c7fc3820@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.0907221502070.9266@reclus.nhh.no>

On Mon, 20 Jul 2009, Mehdi Khan wrote:

> I figured out the first problem by first coercing the attribute vector into
> a data frame and then using the spatialpointsdataframe command to merge it
> with the coordinate matrix.

If you haven't yet tried the overlay() methods in the sp package, you may 
find that they let you find the placings of different geometric 
representations when in sp classes.

Roger

>
> On Sun, Jul 19, 2009 at 7:59 PM, Mehdi Khan <mwkhan at ucdavis.edu> wrote:
>
>>
>> Greetings,
>>
>> I have a shape file, a tiff file, and an excel table.  Each of these files
>> is a different length, and contain a coordinate table (in UTM units) as well
>> as an attribute table along with other superfluous columns.  What I would
>> like to do is combine all three into one table so that I can compare the
>> attributes that each file has.  The caveat is that I need to match up the
>> attribute with the coordinates.  Naturally there will be empty values in
>> this table/matrix since the lengths are all different.  The attribute
>> columns from each table are either numbers or letters.
>>
>> For the shape file, I am able to isolate the coordinates thusly:
>>
>> calirobincoords <- coordinates(calirobin)
>>
>> and the soil type thusly:
>>
>> calirobindata <-as(calirobin, "data.frame")
>> soiltype<-calirobindata[ , 8]
>>
>> When I try to merge the two, i get an error: Error: cannot allocate vector
>> of size 297.6 Mb
>>
>> The coordinate matrix from the excel file and the attributes I am able to
>> easily extract (the matrix i have called ptsrobin)
>>
>> Now for the tif file, I am also able to successfully isolate the
>> coordinates and attribute table, no problem there..
>>
>> CRS11<- readGDAL("california1.tif")
>> proj4string(CRS11)
>>
>> tifdataframe<-as(CRS11,"data.frame")
>> coordinates(tifdataframe)<-c("x", "y")
>>
>> So the problem I face now is this:
>>
>> 1) How can I combine the coordinates within the shape file and the
>> attribute column?
>>
>> 2) How would I combine all three matrices into one once (1) is resolved, in
>> which the combination takes in to account placing values within the correct
>> coordinate row?
>>
>> Help is much appreciated, and due apologies for the lengthy email!  Thank
>> you all!
>>
>> Mehdi Khan
>>
>>
>>
>>
>>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From Roger.Bivand at nhh.no  Wed Jul 22 15:11:55 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 22 Jul 2009 15:11:55 +0200 (CEST)
Subject: [R-sig-Geo] Remove duplicates objects
In-Reply-To: <e31e3449f7392668c54d1b3176ac0e17.squirrel@mmp.sipr-dc.ucl.ac.be>
References: <e31e3449f7392668c54d1b3176ac0e17.squirrel@mmp.sipr-dc.ucl.ac.be>
Message-ID: <alpine.LRH.2.00.0907221504071.9266@reclus.nhh.no>

On Tue, 21 Jul 2009, Jean-Paul Kibambe Lubamba wrote:

> Hi All,
>
> I have a huge polyline file (slightly less than 2.10^6 objects) containing
> some geographically duplicated objects. I tried to post some topological
> rules using a GIS but due to the large number of objects, topology
> validation and correction take a very long time.
>
> So, I was thinking that may be there is a way to remove duplicate objects
> using R and even for a huge file, it could take less time than using a
> GIS.

GIS are designed to do these kinds of things - especially the database GIS 
like PostGIS, but R would find the comparison of these (2M by 2M 
comparisons) hard. Of course, it could be done, but GIS are the 
appropriate tools. The PostGIS ~= operator returns TRUE if the geometry A 
is the same as B, so looks very much what you need, provided the 
coordinates are numerically identical.

If your data include both polylines and attributes, and the attributes are 
also duplicated, then maybe you could do something in R by only retaining 
"rows" with unique() values of the identifying attribute, but you'll need 
a good deal of memory to read in the initial object.

Hope this helps,

Roger

>
> Does anyone know how I could handle this ?
>
> Any help is welcome ! Thanks in advance.
>
>
> Jean-Paul
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From laura.poggio at gmail.com  Wed Jul 22 18:10:33 2009
From: laura.poggio at gmail.com (Laura Poggio)
Date: Wed, 22 Jul 2009 17:10:33 +0100
Subject: [R-sig-Geo] krige.bayes and data export
Message-ID: <e027b8750907220910t2c106ff7t8b21372cf2aa6857@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090722/fa3b0faf/attachment.pl>

From Dominik.Cullmann at Forst.bwl.de  Thu Jul 23 09:21:47 2009
From: Dominik.Cullmann at Forst.bwl.de (Dominik.Cullmann at Forst.bwl.de)
Date: Thu, 23 Jul 2009 09:21:47 +0200
Subject: [R-sig-Geo] spgrass causes segfault
Message-ID: <8FA0743C10E9C44EB03433DBC2767B592B9721@FVAFR-SE2.FORST.BWL.DE>

Dear all,
when I call readRAST6 or readVECT6, it causes a segfault and gives
Traceback Info I
don't understand:
=======
> tmp<-readRAST6("geology")

 *** caught segfault ***
address (nil), cause 'memory not mapped'

Traceback:
 1: .Call("RGDAL_OpenDataset", as.character(filename), TRUE, PACKAGE =
"rgdal")
 2: .local(.Object, ...)
 3: initialize(value, ...)
 4: initialize(value, ...)
 5: new("GDALReadOnlyDataset", filename)
 6: GDAL.open(fname)
 7: GDALinfo(fname)
 8: readRAST6("geology")

Possible actions:
1: abort (with core dump, if enabled)
2: normal R exit
3: exit R without saving workspace
4: exit R saving workspace
=======
Can anybody 'round here give me a hint on how I might get this working?

I'm using R version 2.9.1 (2009-06-26) from backports on Debian stable:
=======
======= some system info
=======
104:~/$ cat /etc/debian_version
5.0.2
105:~/$ uname -a
Linux f060 2.6.26-2-686 #1 SMP Sun Jun 21 04:57:38 UTC 2009 i686
GNU/Linux
106:~/$ dpkg -l |grep gdal
ii  gdal-bin                             1.5.4-2    Geospatial Data
Abstraction Library - Utility programs
ii  libgdal1-1.5.0                       1.5.4-2    Geospatial Data
Abstraction Library
ii  libgdal1-1.5.0-grass                 1.5.2-1    GRASS extension for
the Geospatial Data Abstraction Library
ii  libgdal1-dev                         1.5.4-2    Geospatial Data
Abstraction Library - Development files
115:~/$ dpkg -l |grep "Cartographic projection"
ii  proj                                 4.6.0-2    Cartographic
projection filter and library

=======
======= Now after I started R form within grass
=======
> library(spgrass6)
Loading required package: sp
Loading required package: rgdal
Geospatial Data Abstraction Library extensions to R successfully loaded
Loaded GDAL runtime: GDAL 1.5.4, released 2009/01/07
Path to GDAL shared files: /usr/share/gdal15
Loaded PROJ.4 runtime: Rel. 4.6.0, 21 Dec 2007
Path to PROJ.4 shared files: (autodetected)
Loading required package: XML
GRASS GIS interface loaded with GRASS version: 6.4.0RC5
and location: spearfish60
> sessionInfo()
R version 2.9.1 (2009-06-26)
i486-pc-linux-gnu

locale:
LC_CTYPE=en_US.UTF-8;LC_NUMERIC=C;LC_TIME=en_US.UTF-8;LC_COLLATE=en_US.U
TF-8;LC_MONETARY=C;LC_MESSAGES=en_US.UTF-8;LC_PAPER=en_US.UTF-8;LC_NAME=
C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US.UTF-8;LC_IDENTIFICATI
ON=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] spgrass6_0.6-6 XML_2.5-3      rgdal_0.6-9    sp_0.9-43

loaded via a namespace (and not attached):
[1] grid_2.9.1      lattice_0.17-25
> tmp<-readRAST6("geology")

 *** caught segfault ***
address (nil), cause 'memory not mapped'

Traceback:
 1: .Call("RGDAL_OpenDataset", as.character(filename), TRUE, PACKAGE =
"rgdal")
 2: .local(.Object, ...)
 3: initialize(value, ...)
 4: initialize(value, ...)
 5: new("GDALReadOnlyDataset", filename)
 6: GDAL.open(fname)
 7: GDALinfo(fname)
 8: readRAST6("geology")

Possible actions:
1: abort (with core dump, if enabled)
2: normal R exit
3: exit R without saving workspace
4: exit R saving workspace
=======
=======
=======
oh, and I'm using grass version 6.4.0RC5 which I compiled after
configuring via
CFLAGS="-g -Wall" ./configure   --with-opengl=no
--with-tcltk-libs=/usr.lib --with-tcltk-includes='/usr/include/tcl8.4/
/usr/include/tk/' --with-tcltk-libs='/usr/lib/tcl8.4/' --with-odbc=yes
--with-fftw-libs='/usr/include' -with-gdal='/usr/bin/gdal-config'
--with-postgres=yes  --with-postgres-includes='/usr/include/postgresql/'
--enable-largefile --with-lapack=yes --with-blas=yes


Thanks and regards, Dominik
----------------------------------------------
Andreas Dominik Cullmann
Forstliche Versuchs- und Forschungsanstalt 
Wonnhalde 4 
79100 Freiburg 
Tel. +49 761 4018 204 
Email: dominik.cullmann at forst.bwl.de
<mailto:dominik.cullmann at forst.bwl.de> 
Homepage: www.fva-bw.de <http://www.fva-bw.de> 


From Roger.Bivand at nhh.no  Thu Jul 23 12:53:24 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 23 Jul 2009 12:53:24 +0200 (CEST)
Subject: [R-sig-Geo] spgrass causes segfault
In-Reply-To: <8FA0743C10E9C44EB03433DBC2767B592B9721@FVAFR-SE2.FORST.BWL.DE>
References: <8FA0743C10E9C44EB03433DBC2767B592B9721@FVAFR-SE2.FORST.BWL.DE>
Message-ID: <alpine.LRH.2.00.0907231236390.17617@reclus.nhh.no>

On Thu, 23 Jul 2009, Dominik.Cullmann at Forst.bwl.de wrote:

> Dear all,
> when I call readRAST6 or readVECT6, it causes a segfault and gives
> Traceback Info I
> don't understand:

Thanks for the traceback information, and for including the verbatim 
command that caused the problem. Next time, please include sessionInfo() 
output too, and in this case, also the loading messages from rgdal and 
spgrass6. Here, it would also have helped to see what gdalDrivers() said.

I suspect that you are in "dependency hell", and that your system has a 
wrongly installed GDAL plugin for GRASS rasters and vectors. Please read 
the manual pages for readVECT6() and readRAST6() - you will see that if 
the plugin= argument is not given (NULL), the documentation says that the 
presence (or not) of the plugin is autodetected (by looking at 
ogrDrivers() and gdalDrivers()).

Unless you know definitely that the plugin does work (and it is the most 
frequent cause of dependency problems), please try setting plugin=FALSE in 
readRAST6() and readVECT6(). If that resolves the problem, please then try 
to see what happens when gdalinfo used outside R tries to access the GRASS 
raster using the plugin, see http://www.gdal.org/frmt_grass.html for the 
incantation. If that fails, then you will know that the problem is with 
the GDAL GRASS plugin.

If this isn't the cause, I'd like an example using spearfish and with 
complete details of your GRASS and GDAL installations.

The stats-grass list would also have been a good place to ask - its 
archives show that happy plugin users are most often those who build 
everything from source, and unhappy ones those who install binary 
versions. It is extremely hard to make sure that all the binary 
versions of the dependent software are correctly alligned (and there is a 
possible circular dependency here too in older versions of GRASS and 
GDAL).

Hope this helps,

Roger

> =======
>> tmp<-readRAST6("geology")
>
> *** caught segfault ***
> address (nil), cause 'memory not mapped'
>
> Traceback:
> 1: .Call("RGDAL_OpenDataset", as.character(filename), TRUE, PACKAGE =
> "rgdal")
> 2: .local(.Object, ...)
> 3: initialize(value, ...)
> 4: initialize(value, ...)
> 5: new("GDALReadOnlyDataset", filename)
> 6: GDAL.open(fname)
> 7: GDALinfo(fname)
> 8: readRAST6("geology")
>
> Possible actions:
> 1: abort (with core dump, if enabled)
> 2: normal R exit
> 3: exit R without saving workspace
> 4: exit R saving workspace
> =======
> Can anybody 'round here give me a hint on how I might get this working?
>
> I'm using R version 2.9.1 (2009-06-26) from backports on Debian stable:
> =======
> ======= some system info
> =======
> 104:~/$ cat /etc/debian_version
> 5.0.2
> 105:~/$ uname -a
> Linux f060 2.6.26-2-686 #1 SMP Sun Jun 21 04:57:38 UTC 2009 i686
> GNU/Linux
> 106:~/$ dpkg -l |grep gdal
> ii  gdal-bin                             1.5.4-2    Geospatial Data
> Abstraction Library - Utility programs
> ii  libgdal1-1.5.0                       1.5.4-2    Geospatial Data
> Abstraction Library
> ii  libgdal1-1.5.0-grass                 1.5.2-1    GRASS extension for
> the Geospatial Data Abstraction Library
> ii  libgdal1-dev                         1.5.4-2    Geospatial Data
> Abstraction Library - Development files
> 115:~/$ dpkg -l |grep "Cartographic projection"
> ii  proj                                 4.6.0-2    Cartographic
> projection filter and library
>
> =======
> ======= Now after I started R form within grass
> =======
>> library(spgrass6)
> Loading required package: sp
> Loading required package: rgdal
> Geospatial Data Abstraction Library extensions to R successfully loaded
> Loaded GDAL runtime: GDAL 1.5.4, released 2009/01/07
> Path to GDAL shared files: /usr/share/gdal15
> Loaded PROJ.4 runtime: Rel. 4.6.0, 21 Dec 2007
> Path to PROJ.4 shared files: (autodetected)
> Loading required package: XML
> GRASS GIS interface loaded with GRASS version: 6.4.0RC5
> and location: spearfish60
>> sessionInfo()
> R version 2.9.1 (2009-06-26)
> i486-pc-linux-gnu
>
> locale:
> LC_CTYPE=en_US.UTF-8;LC_NUMERIC=C;LC_TIME=en_US.UTF-8;LC_COLLATE=en_US.U
> TF-8;LC_MONETARY=C;LC_MESSAGES=en_US.UTF-8;LC_PAPER=en_US.UTF-8;LC_NAME=
> C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US.UTF-8;LC_IDENTIFICATI
> ON=C
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> other attached packages:
> [1] spgrass6_0.6-6 XML_2.5-3      rgdal_0.6-9    sp_0.9-43
>
> loaded via a namespace (and not attached):
> [1] grid_2.9.1      lattice_0.17-25
>> tmp<-readRAST6("geology")
>
> *** caught segfault ***
> address (nil), cause 'memory not mapped'
>
> Traceback:
> 1: .Call("RGDAL_OpenDataset", as.character(filename), TRUE, PACKAGE =
> "rgdal")
> 2: .local(.Object, ...)
> 3: initialize(value, ...)
> 4: initialize(value, ...)
> 5: new("GDALReadOnlyDataset", filename)
> 6: GDAL.open(fname)
> 7: GDALinfo(fname)
> 8: readRAST6("geology")
>
> Possible actions:
> 1: abort (with core dump, if enabled)
> 2: normal R exit
> 3: exit R without saving workspace
> 4: exit R saving workspace
> =======
> =======
> =======
> oh, and I'm using grass version 6.4.0RC5 which I compiled after
> configuring via
> CFLAGS="-g -Wall" ./configure   --with-opengl=no
> --with-tcltk-libs=/usr.lib --with-tcltk-includes='/usr/include/tcl8.4/
> /usr/include/tk/' --with-tcltk-libs='/usr/lib/tcl8.4/' --with-odbc=yes
> --with-fftw-libs='/usr/include' -with-gdal='/usr/bin/gdal-config'
> --with-postgres=yes  --with-postgres-includes='/usr/include/postgresql/'
> --enable-largefile --with-lapack=yes --with-blas=yes
>
>
> Thanks and regards, Dominik
> ----------------------------------------------
> Andreas Dominik Cullmann
> Forstliche Versuchs- und Forschungsanstalt
> Wonnhalde 4
> 79100 Freiburg
> Tel. +49 761 4018 204
> Email: dominik.cullmann at forst.bwl.de
> <mailto:dominik.cullmann at forst.bwl.de>
> Homepage: www.fva-bw.de <http://www.fva-bw.de>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From Dominik.Cullmann at Forst.bwl.de  Thu Jul 23 14:19:34 2009
From: Dominik.Cullmann at Forst.bwl.de (Dominik.Cullmann at Forst.bwl.de)
Date: Thu, 23 Jul 2009 14:19:34 +0200
Subject: [R-sig-Geo] spgrass causes segfault
Message-ID: <8FA0743C10E9C44EB03433DBC2767B592B9722@FVAFR-SE2.FORST.BWL.DE>

Dear Roger,
thanks a lot for your immedate help!
> -----Urspr?ngliche Nachricht-----
> Von: Roger Bivand [mailto:Roger.Bivand at nhh.no] 
> Gesendet: Donnerstag, 23. Juli 2009 12:53
> An: Cullmann, Dominik (FORST)
> Cc: r-sig-geo at stat.math.ethz.ch
> Betreff: Re: [R-sig-Geo] spgrass causes segfault
> 
> On Thu, 23 Jul 2009, Dominik.Cullmann at Forst.bwl.de wrote:
> 
> > Dear all,
> > when I call readRAST6 or readVECT6, it causes a segfault and gives
> > Traceback Info I
> > don't understand:
> 
> Thanks for the traceback information, and for including the verbatim 
> command that caused the problem. Next time, please include 
> sessionInfo() 
> output too, and in this case, also the loading messages from 
> rgdal and 
> spgrass6. Here, it would also have helped to see what 
> gdalDrivers() said.
I had given that information at the end of the original mail but I'll repeat it, see below.

> 
> I suspect that you are in "dependency hell", and that your 
> system has a 
> wrongly installed GDAL plugin for GRASS rasters and vectors. 
> Please read 
> the manual pages for readVECT6() and readRAST6() - you will 
> see that if 
> the plugin= argument is not given (NULL), the documentation 
> says that the 
> presence (or not) of the plugin is autodetected (by looking at 
> ogrDrivers() and gdalDrivers()).
> 
> Unless you know definitely that the plugin does work (and it 
> is the most 
> frequent cause of dependency problems), please try setting 
> plugin=FALSE in 
> readRAST6() and readVECT6(). 
This works:
>   require(spgrass6)
Loading required package: spgrass6
Loading required package: sp
Loading required package: rgdal
Geospatial Data Abstraction Library extensions to R successfully loaded
Loaded GDAL runtime: GDAL 1.5.4, released 2009/01/07
Path to GDAL shared files: /usr/share/gdal15
Loaded PROJ.4 runtime: Rel. 4.6.0, 21 Dec 2007
Path to PROJ.4 shared files: (autodetected)
Loading required package: XML
GRASS GIS interface loaded with GRASS version: 6.4.0RC5
and location: spearfish60
>   sessionInfo()
R version 2.9.1 (2009-06-26)
i486-pc-linux-gnu

locale:
LC_CTYPE=en_US.UTF-8;LC_NUMERIC=C;LC_TIME=en_US.UTF-8;LC_COLLATE=en_US.UTF-8;LC_MONETARY=C;LC_MESSAGES=en_US.UTF-8;LC_PAPER=en_US.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US.UTF-8;LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] spgrass6_0.6-6 XML_2.5-3      rgdal_0.6-9    sp_0.9-43

loaded via a namespace (and not attached):
[1] grid_2.9.1      lattice_0.17-25
>   tmp <- readRAST6("geology", plugin=FALSE)
/home/data/grass/spearfish60/PERMANENT/.tmp/f060/geology has GDAL driver GTiff
and has 140 rows and 190 columns


> If that resolves the problem, 
> please then try 
> to see what happens when gdalinfo used outside R tries to 
> access the GRASS 
> raster using the plugin, see 
> http://www.gdal.org/frmt_grass.html for the 
> incantation. If that fails, then you will know that the 
> problem is with 
> the GDAL GRASS plugin.
Well, gdalinfo seems to work fine: 

101:~/$ gdalinfo /home/data/grass/spearfish60/PERMANENT/cellhd/geology
Driver: GRASS/GRASS Database Rasters (5.7+)
Files: /home/data/grass/spearfish60/PERMANENT/cellhd/geology
Size is 190, 140
Coordinate System is `'
Origin = (590000.000000000000000,4928000.000000000000000)
Pixel Size = (100.000000000000000,-100.000000000000000)
Corner Coordinates:
Upper Left  (  590000.000, 4928000.000)
Lower Left  (  590000.000, 4914000.000)
Upper Right (  609000.000, 4928000.000)
Lower Right (  609000.000, 4914000.000)
Center      (  599500.000, 4921000.000)
Band 1 Block=190x1 Type=Byte, ColorInterp=Palette
  Min=1.000 Max=9.000
  NoData Value=0
  Metadata:
    COLOR_TABLE_RULES_COUNT=0
  Color Table (RGB with 10 entries)
    0: 197,129,125,255
    1: 107,250,75,255
    2: 226,83,250,255
    3: 246,222,188,255
    4: 123,225,27,255
    5: 134,190,1,255
    6: 48,86,221,255
    7: 113,70,15,255
    8: 102,134,101,255
    9: 89,135,169,255

> 
> If this isn't the cause, I'd like an example using spearfish and with 
> complete details of your GRASS and GDAL installations.
> 
The example I gave was on the 'geology' raster from the spearfish60 data set.
I had given installation details at the end of the original mail: 

104:~/$ cat /etc/debian_version
5.0.2
105:~/$ uname -a
Linux f060 2.6.26-2-686 #1 SMP Sun Jun 21 04:57:38 UTC 2009 i686 GNU/Linux
106:~/$ dpkg -l |grep gdal
ii  gdal-bin                             1.5.4-2    Geospatial Data Abstraction Library - Utility programs
ii  libgdal1-1.5.0                       1.5.4-2    Geospatial Data Abstraction Library
ii  libgdal1-1.5.0-grass                 1.5.2-1    GRASS extension for the Geospatial Data Abstraction Library
ii  libgdal1-dev                         1.5.4-2    Geospatial Data Abstraction Library - Development files
115:~/$ dpkg -l |grep "Cartographic projection"
ii  proj                                 4.6.0-2    Cartographic projection filter and library
...
oh, and I'm using grass version 6.4.0RC5 which I compiled after
configuring via
CFLAGS="-g -Wall" ./configure   --with-opengl=no --with-tcltk-libs=/usr.lib --with-tcltk-includes='/usr/include/tcl8.4/ /usr/include/tk/' --with-tcltk-libs='/usr/lib/tcl8.4/' --with-odbc=yes --with-fftw-libs='/usr/include' -with-gdal='/usr/bin/gdal-config' --with-postgres=yes  --with-postgres-includes='/usr/include/postgresql/' --enable-largefile --with-lapack=yes --with-blas=yes



> The stats-grass list would also have been a good place to ask - its 
> archives show that happy plugin users are most often those who build 
> everything from source, and unhappy ones those who install binary 
> versions. It is extremely hard to make sure that all the binary 
> versions of the dependent software are correctly alligned 
> (and there is a 
> possible circular dependency here too in older versions of GRASS and 
> GDAL).
> 
> Hope this helps,
Yes, it does. Thanks again,
Dominik

> 
> Roger
> 
> > =======
> >> tmp<-readRAST6("geology")
> >
> > *** caught segfault ***
> > address (nil), cause 'memory not mapped'
> >
> > Traceback:
> > 1: .Call("RGDAL_OpenDataset", as.character(filename), TRUE, 
> PACKAGE =
> > "rgdal")
> > 2: .local(.Object, ...)
> > 3: initialize(value, ...)
> > 4: initialize(value, ...)
> > 5: new("GDALReadOnlyDataset", filename)
> > 6: GDAL.open(fname)
> > 7: GDALinfo(fname)
> > 8: readRAST6("geology")
> >
> > Possible actions:
> > 1: abort (with core dump, if enabled)
> > 2: normal R exit
> > 3: exit R without saving workspace
> > 4: exit R saving workspace
> > =======
> > Can anybody 'round here give me a hint on how I might get 
> this working?
> >
> > I'm using R version 2.9.1 (2009-06-26) from backports on 
> Debian stable:
> > =======
> > ======= some system info
> > =======
> > 104:~/$ cat /etc/debian_version
> > 5.0.2
> > 105:~/$ uname -a
> > Linux f060 2.6.26-2-686 #1 SMP Sun Jun 21 04:57:38 UTC 2009 i686
> > GNU/Linux
> > 106:~/$ dpkg -l |grep gdal
> > ii  gdal-bin                             1.5.4-2    Geospatial Data
> > Abstraction Library - Utility programs
> > ii  libgdal1-1.5.0                       1.5.4-2    Geospatial Data
> > Abstraction Library
> > ii  libgdal1-1.5.0-grass                 1.5.2-1    GRASS 
> extension for
> > the Geospatial Data Abstraction Library
> > ii  libgdal1-dev                         1.5.4-2    Geospatial Data
> > Abstraction Library - Development files
> > 115:~/$ dpkg -l |grep "Cartographic projection"
> > ii  proj                                 4.6.0-2    Cartographic
> > projection filter and library
> >
> > =======
> > ======= Now after I started R form within grass
> > =======
> >> library(spgrass6)
> > Loading required package: sp
> > Loading required package: rgdal
> > Geospatial Data Abstraction Library extensions to R 
> successfully loaded
> > Loaded GDAL runtime: GDAL 1.5.4, released 2009/01/07
> > Path to GDAL shared files: /usr/share/gdal15
> > Loaded PROJ.4 runtime: Rel. 4.6.0, 21 Dec 2007
> > Path to PROJ.4 shared files: (autodetected)
> > Loading required package: XML
> > GRASS GIS interface loaded with GRASS version: 6.4.0RC5
> > and location: spearfish60
> >> sessionInfo()
> > R version 2.9.1 (2009-06-26)
> > i486-pc-linux-gnu
> >
> > locale:
> > 
> LC_CTYPE=en_US.UTF-8;LC_NUMERIC=C;LC_TIME=en_US.UTF-8;LC_COLLA
> TE=en_US.U
> > 
> TF-8;LC_MONETARY=C;LC_MESSAGES=en_US.UTF-8;LC_PAPER=en_US.UTF-
> 8;LC_NAME=
> > 
> C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US.UTF-8;LC_ID
> ENTIFICATI
> > ON=C
> >
> > attached base packages:
> > [1] stats     graphics  grDevices utils     datasets  methods   base
> >
> > other attached packages:
> > [1] spgrass6_0.6-6 XML_2.5-3      rgdal_0.6-9    sp_0.9-43
> >
> > loaded via a namespace (and not attached):
> > [1] grid_2.9.1      lattice_0.17-25
> >> tmp<-readRAST6("geology")
> >
> > *** caught segfault ***
> > address (nil), cause 'memory not mapped'
> >
> > Traceback:
> > 1: .Call("RGDAL_OpenDataset", as.character(filename), TRUE, 
> PACKAGE =
> > "rgdal")
> > 2: .local(.Object, ...)
> > 3: initialize(value, ...)
> > 4: initialize(value, ...)
> > 5: new("GDALReadOnlyDataset", filename)
> > 6: GDAL.open(fname)
> > 7: GDALinfo(fname)
> > 8: readRAST6("geology")
> >
> > Possible actions:
> > 1: abort (with core dump, if enabled)
> > 2: normal R exit
> > 3: exit R without saving workspace
> > 4: exit R saving workspace
> > =======
> > =======
> > =======
> > oh, and I'm using grass version 6.4.0RC5 which I compiled after
> > configuring via
> > CFLAGS="-g -Wall" ./configure   --with-opengl=no
> > --with-tcltk-libs=/usr.lib 
> --with-tcltk-includes='/usr/include/tcl8.4/
> > /usr/include/tk/' --with-tcltk-libs='/usr/lib/tcl8.4/' 
> --with-odbc=yes
> > --with-fftw-libs='/usr/include' -with-gdal='/usr/bin/gdal-config'
> > --with-postgres=yes  
> --with-postgres-includes='/usr/include/postgresql/'
> > --enable-largefile --with-lapack=yes --with-blas=yes
> >
> >
> > Thanks and regards, Dominik
> > ----------------------------------------------
> > Andreas Dominik Cullmann
> > Forstliche Versuchs- und Forschungsanstalt
> > Wonnhalde 4
> > 79100 Freiburg
> > Tel. +49 761 4018 204
> > Email: dominik.cullmann at forst.bwl.de
> > <mailto:dominik.cullmann at forst.bwl.de>
> > Homepage: www.fva-bw.de <http://www.fva-bw.de>
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at stat.math.ethz.ch
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
> 
> -- 
> Roger Bivand
> Economic Geography Section, Department of Economics, 
> Norwegian School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
> 
> 


----------------------------------------------
Andreas Dominik Cullmann
Forstliche Versuchs- und Forschungsanstalt 
Wonnhalde 4 
79100 Freiburg 
Tel. +49 761 4018 204 
Email: dominik.cullmann at forst.bwl.de <mailto:dominik.cullmann at forst.bwl.de> 
Homepage: www.fva-bw.de <http://www.fva-bw.de> 


From educheyne at avia-gis.be  Thu Jul 23 14:31:41 2009
From: educheyne at avia-gis.be (Els Ducheyne)
Date: Thu, 23 Jul 2009 14:31:41 +0200
Subject: [R-sig-Geo] ASCII grids as spatialgridframe
Message-ID: <73F08220-4948-41F1-A1B0-CEF719BA1A78@avia-gis.be>

Dear all
sorry to post this question, but I have been looking across multiple  
fora and haven't found the answer

I am trying to read ascii-grids in R using the shapefile -  
read.asciigrid
I have found that this is of class SpatialGridDataFrame
I would like to combine this with a set of grids that are already in  
the workspace but when i use the [[<-option I always get the following  
error
What am I doing wrong? I am not using rgdal, because of a linking  
error that I cannot seem to overcome - even though the installation of  
rgdal and all its dependencies didn't yield an erro

Thanks for any help!

  achandata<-read.asciigrid("achan.asc")
 > summary(achandata)
Object of class SpatialGridDataFrame
Coordinates:
            min    max
coords.x1 -2.5 1002.5
coords.x2 -2.5  502.5
Is projected: NA
proj4string : [NA]
Number of points: 2
Grid attributes:
   cellcentre.offset cellsize cells.dim
1                 0        5       201
2                 0        5       101
Data attributes:
    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.
  0.0000  0.0000  0.3000  0.7088  0.9000  6.2000
 > grids[["achan"]]<-achandata
Error: object is not subsettable
 > summary(grids)
Object of class SpatialGridDataFrame
Coordinates:
            min    max
coords.x1 -2.5 1002.5
coords.x2 -2.5  502.5
Is projected: NA
proj4string : [NA]
Number of points: 2
Grid attributes:
   cellcentre.offset cellsize cells.dim
1                 0        5       201
2                 0        5       101
Data attributes:
       elev            grad
  Min.   :119.8   Min.   :0.0008663
  1st Qu.:140.0   1st Qu.:0.0399718
  Median :144.0   Median :0.0620299
  Mean   :144.3   Mean   :0.0821328
  3rd Qu.:150.1   3rd Qu.:0.1129532
  Max.   :159.5   Max.   :0.3284767


From Roger.Bivand at nhh.no  Thu Jul 23 14:56:38 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 23 Jul 2009 14:56:38 +0200 (CEST)
Subject: [R-sig-Geo] spgrass causes segfault
In-Reply-To: <8FA0743C10E9C44EB03433DBC2767B592B9722@FVAFR-SE2.FORST.BWL.DE>
References: <8FA0743C10E9C44EB03433DBC2767B592B9722@FVAFR-SE2.FORST.BWL.DE>
Message-ID: <alpine.LRH.2.00.0907231435590.17617@reclus.nhh.no>

On Thu, 23 Jul 2009, Dominik.Cullmann at Forst.bwl.de wrote:

> Dear Roger,
> thanks a lot for your immedate help!
>> -----Urspr?ngliche Nachricht-----
>> Von: Roger Bivand [mailto:Roger.Bivand at nhh.no]
>> Gesendet: Donnerstag, 23. Juli 2009 12:53
>> An: Cullmann, Dominik (FORST)
>> Cc: r-sig-geo at stat.math.ethz.ch
>> Betreff: Re: [R-sig-Geo] spgrass causes segfault
>>
>> On Thu, 23 Jul 2009, Dominik.Cullmann at Forst.bwl.de wrote:
>>
>>> Dear all, when I call readRAST6 or readVECT6, it causes a segfault and 
>>> gives Traceback Info I don't understand:
>>
>> Thanks for the traceback information, and for including the verbatim 
>> command that caused the problem. Next time, please include 
>> sessionInfo() output too, and in this case, also the loading messages 
>> from rgdal and spgrass6. Here, it would also have helped to see what 
>> gdalDrivers() said.
> I had given that information at the end of the original mail but I'll
> repeat it, see below.
>
>>
>> I suspect that you are in "dependency hell", and that your system has a 
>> wrongly installed GDAL plugin for GRASS rasters and vectors. Please 
>> read the manual pages for readVECT6() and readRAST6() - you will see 
>> that if the plugin= argument is not given (NULL), the documentation 
>> says that the presence (or not) of the plugin is autodetected (by 
>> looking at ogrDrivers() and gdalDrivers()).
>>
>> Unless you know definitely that the plugin does work (and it is the 
>> most frequent cause of dependency problems), please try setting 
>> plugin=FALSE in readRAST6() and readVECT6().
> This works:

Good, some progress.

>>   require(spgrass6)
> Loading required package: spgrass6
> Loading required package: sp
> Loading required package: rgdal
> Geospatial Data Abstraction Library extensions to R successfully loaded
> Loaded GDAL runtime: GDAL 1.5.4, released 2009/01/07
> Path to GDAL shared files: /usr/share/gdal15
> Loaded PROJ.4 runtime: Rel. 4.6.0, 21 Dec 2007
> Path to PROJ.4 shared files: (autodetected)
> Loading required package: XML
> GRASS GIS interface loaded with GRASS version: 6.4.0RC5
> and location: spearfish60
>>   sessionInfo()
> R version 2.9.1 (2009-06-26)
> i486-pc-linux-gnu
>
> locale:
> LC_CTYPE=en_US.UTF-8;LC_NUMERIC=C;LC_TIME=en_US.UTF-8;LC_COLLATE=en_US.UTF-8;LC_MONETARY=C;LC_MESSAGES=en_US.UTF-8;LC_PAPER=en_US.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US.UTF-8;LC_IDENTIFICATION=C
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> other attached packages:
> [1] spgrass6_0.6-6 XML_2.5-3      rgdal_0.6-9    sp_0.9-43
>

There is a newer rgdal, but I don't think that it will affect the raster 
interface.

> loaded via a namespace (and not attached):
> [1] grid_2.9.1      lattice_0.17-25
>>   tmp <- readRAST6("geology", plugin=FALSE)
> /home/data/grass/spearfish60/PERMANENT/.tmp/f060/geology has GDAL driver GTiff
> and has 140 rows and 190 columns
>
>
>> If that resolves the problem, please then try to see what happens when 
>> gdalinfo used outside R tries to access the GRASS raster using the 
>> plugin, see http://www.gdal.org/frmt_grass.html for the incantation. If 
>> that fails, then you will know that the problem is with the GDAL GRASS 
>> plugin.
> Well, gdalinfo seems to work fine:

So it does read the metadata, so the problem must be in the data itself. 
Is it possible that you have binary GDAL 1.5.4, the binary GDAL GRASS 
plugin from GDAL 1.5.2 (so built against an oldish Debian GRASS), and 
GRASS not binary, but built from source, as you detail below, with 
--enable-largefile (which may or may not make a difference). This means 
that the plugin looks for GRASS, and finds some ABI compoments that work, 
but others that fail? The GDAL plugin were not build against your local 
GRASS, and are trying to use its shared objects (*.so files).

To straighten things out, you'd need either to install the binary GRASS 
that matches the plugin exactly, or install GDAL twice from source, first 
configuring without GRASS, then building GRASS, finally rebuilding GDAL 
pointing at the new GRASS to build the plugin. It could be simpler, 
really. Using plugin=FALSE saves the pain, although the raster plugin does 
move data faster in some settings, and the vector one does when there are 
few attributes.

Roger

>
> 101:~/$ gdalinfo /home/data/grass/spearfish60/PERMANENT/cellhd/geology
> Driver: GRASS/GRASS Database Rasters (5.7+)
> Files: /home/data/grass/spearfish60/PERMANENT/cellhd/geology
> Size is 190, 140
> Coordinate System is `'
> Origin = (590000.000000000000000,4928000.000000000000000)
> Pixel Size = (100.000000000000000,-100.000000000000000)
> Corner Coordinates:
> Upper Left  (  590000.000, 4928000.000)
> Lower Left  (  590000.000, 4914000.000)
> Upper Right (  609000.000, 4928000.000)
> Lower Right (  609000.000, 4914000.000)
> Center      (  599500.000, 4921000.000)
> Band 1 Block=190x1 Type=Byte, ColorInterp=Palette
>  Min=1.000 Max=9.000
>  NoData Value=0
>  Metadata:
>    COLOR_TABLE_RULES_COUNT=0
>  Color Table (RGB with 10 entries)
>    0: 197,129,125,255
>    1: 107,250,75,255
>    2: 226,83,250,255
>    3: 246,222,188,255
>    4: 123,225,27,255
>    5: 134,190,1,255
>    6: 48,86,221,255
>    7: 113,70,15,255
>    8: 102,134,101,255
>    9: 89,135,169,255
>
>>
>> If this isn't the cause, I'd like an example using spearfish and with
>> complete details of your GRASS and GDAL installations.
>>
> The example I gave was on the 'geology' raster from the spearfish60 data set.
> I had given installation details at the end of the original mail:
>
> 104:~/$ cat /etc/debian_version 5.0.2 105:~/$ uname -a Linux f060 
> 2.6.26-2-686 #1 SMP Sun Jun 21 04:57:38 UTC 2009 i686 GNU/Linux 106:~/$ 
> dpkg -l |grep gdal ii gdal-bin 1.5.4-2 Geospatial Data Abstraction 
> Library - Utility programs ii libgdal1-1.5.0 1.5.4-2 Geospatial Data 
> Abstraction Library ii libgdal1-1.5.0-grass 1.5.2-1 GRASS extension for 
> the Geospatial Data Abstraction Library ii libgdal1-dev 1.5.4-2 
> Geospatial Data Abstraction Library - Development files 115:~/$ dpkg -l 
> |grep "Cartographic projection" ii proj 4.6.0-2 Cartographic projection 
> filter and library ... oh, and I'm using grass version 6.4.0RC5 which I 
> compiled after configuring via CFLAGS="-g -Wall" ./configure 
> --with-opengl=no --with-tcltk-libs=/usr.lib 
> --with-tcltk-includes='/usr/include/tcl8.4/ /usr/include/tk/' 
> --with-tcltk-libs='/usr/lib/tcl8.4/' --with-odbc=yes 
> --with-fftw-libs='/usr/include' -with-gdal='/usr/bin/gdal-config' 
> --with-postgres=yes --with-postgres-includes='/usr/include/postgresql/' 
> --enable-largefile --with-lapack=yes --with-blas=yes
>
>
>
>> The stats-grass list would also have been a good place to ask - its
>> archives show that happy plugin users are most often those who build
>> everything from source, and unhappy ones those who install binary
>> versions. It is extremely hard to make sure that all the binary
>> versions of the dependent software are correctly alligned
>> (and there is a
>> possible circular dependency here too in older versions of GRASS and
>> GDAL).
>>
>> Hope this helps,
> Yes, it does. Thanks again,
> Dominik
>
>>
>> Roger
>>
>>> =======
>>>> tmp<-readRAST6("geology")
>>>
>>> *** caught segfault ***
>>> address (nil), cause 'memory not mapped'
>>>
>>> Traceback:
>>> 1: .Call("RGDAL_OpenDataset", as.character(filename), TRUE,
>> PACKAGE =
>>> "rgdal")
>>> 2: .local(.Object, ...)
>>> 3: initialize(value, ...)
>>> 4: initialize(value, ...)
>>> 5: new("GDALReadOnlyDataset", filename)
>>> 6: GDAL.open(fname)
>>> 7: GDALinfo(fname)
>>> 8: readRAST6("geology")
>>>
>>> Possible actions:
>>> 1: abort (with core dump, if enabled)
>>> 2: normal R exit
>>> 3: exit R without saving workspace
>>> 4: exit R saving workspace
>>> =======
>>> Can anybody 'round here give me a hint on how I might get
>> this working?
>>>
>>> I'm using R version 2.9.1 (2009-06-26) from backports on
>> Debian stable:
>>> =======
>>> ======= some system info
>>> =======
>>> 104:~/$ cat /etc/debian_version
>>> 5.0.2
>>> 105:~/$ uname -a
>>> Linux f060 2.6.26-2-686 #1 SMP Sun Jun 21 04:57:38 UTC 2009 i686
>>> GNU/Linux
>>> 106:~/$ dpkg -l |grep gdal
>>> ii  gdal-bin                             1.5.4-2    Geospatial Data
>>> Abstraction Library - Utility programs
>>> ii  libgdal1-1.5.0                       1.5.4-2    Geospatial Data
>>> Abstraction Library
>>> ii  libgdal1-1.5.0-grass                 1.5.2-1    GRASS
>> extension for
>>> the Geospatial Data Abstraction Library
>>> ii  libgdal1-dev                         1.5.4-2    Geospatial Data
>>> Abstraction Library - Development files
>>> 115:~/$ dpkg -l |grep "Cartographic projection"
>>> ii  proj                                 4.6.0-2    Cartographic
>>> projection filter and library
>>>
>>> =======
>>> ======= Now after I started R form within grass
>>> =======
>>>> library(spgrass6)
>>> Loading required package: sp
>>> Loading required package: rgdal
>>> Geospatial Data Abstraction Library extensions to R
>> successfully loaded
>>> Loaded GDAL runtime: GDAL 1.5.4, released 2009/01/07
>>> Path to GDAL shared files: /usr/share/gdal15
>>> Loaded PROJ.4 runtime: Rel. 4.6.0, 21 Dec 2007
>>> Path to PROJ.4 shared files: (autodetected)
>>> Loading required package: XML
>>> GRASS GIS interface loaded with GRASS version: 6.4.0RC5
>>> and location: spearfish60
>>>> sessionInfo()
>>> R version 2.9.1 (2009-06-26)
>>> i486-pc-linux-gnu
>>>
>>> locale:
>>>
>> LC_CTYPE=en_US.UTF-8;LC_NUMERIC=C;LC_TIME=en_US.UTF-8;LC_COLLA
>> TE=en_US.U
>>>
>> TF-8;LC_MONETARY=C;LC_MESSAGES=en_US.UTF-8;LC_PAPER=en_US.UTF-
>> 8;LC_NAME=
>>>
>> C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US.UTF-8;LC_ID
>> ENTIFICATI
>>> ON=C
>>>
>>> attached base packages:
>>> [1] stats     graphics  grDevices utils     datasets  methods   base
>>>
>>> other attached packages:
>>> [1] spgrass6_0.6-6 XML_2.5-3      rgdal_0.6-9    sp_0.9-43
>>>
>>> loaded via a namespace (and not attached):
>>> [1] grid_2.9.1      lattice_0.17-25
>>>> tmp<-readRAST6("geology")
>>>
>>> *** caught segfault ***
>>> address (nil), cause 'memory not mapped'
>>>
>>> Traceback:
>>> 1: .Call("RGDAL_OpenDataset", as.character(filename), TRUE,
>> PACKAGE =
>>> "rgdal")
>>> 2: .local(.Object, ...)
>>> 3: initialize(value, ...)
>>> 4: initialize(value, ...)
>>> 5: new("GDALReadOnlyDataset", filename)
>>> 6: GDAL.open(fname)
>>> 7: GDALinfo(fname)
>>> 8: readRAST6("geology")
>>>
>>> Possible actions:
>>> 1: abort (with core dump, if enabled)
>>> 2: normal R exit
>>> 3: exit R without saving workspace
>>> 4: exit R saving workspace
>>> =======
>>> =======
>>> =======
>>> oh, and I'm using grass version 6.4.0RC5 which I compiled after
>>> configuring via
>>> CFLAGS="-g -Wall" ./configure   --with-opengl=no
>>> --with-tcltk-libs=/usr.lib
>> --with-tcltk-includes='/usr/include/tcl8.4/
>>> /usr/include/tk/' --with-tcltk-libs='/usr/lib/tcl8.4/'
>> --with-odbc=yes
>>> --with-fftw-libs='/usr/include' -with-gdal='/usr/bin/gdal-config'
>>> --with-postgres=yes
>> --with-postgres-includes='/usr/include/postgresql/'
>>> --enable-largefile --with-lapack=yes --with-blas=yes
>>>
>>>
>>> Thanks and regards, Dominik
>>> ----------------------------------------------
>>> Andreas Dominik Cullmann
>>> Forstliche Versuchs- und Forschungsanstalt
>>> Wonnhalde 4
>>> 79100 Freiburg
>>> Tel. +49 761 4018 204
>>> Email: dominik.cullmann at forst.bwl.de
>>> <mailto:dominik.cullmann at forst.bwl.de>
>>> Homepage: www.fva-bw.de <http://www.fva-bw.de>
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>> --
>> Roger Bivand
>> Economic Geography Section, Department of Economics,
>> Norwegian School of
>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>> e-mail: Roger.Bivand at nhh.no
>>
>>
>
>
> ----------------------------------------------
> Andreas Dominik Cullmann
> Forstliche Versuchs- und Forschungsanstalt
> Wonnhalde 4
> 79100 Freiburg
> Tel. +49 761 4018 204
> Email: dominik.cullmann at forst.bwl.de <mailto:dominik.cullmann at forst.bwl.de>
> Homepage: www.fva-bw.de <http://www.fva-bw.de>
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From Roger.Bivand at nhh.no  Thu Jul 23 15:06:04 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 23 Jul 2009 15:06:04 +0200 (CEST)
Subject: [R-sig-Geo] ASCII grids as spatialgridframe
In-Reply-To: <73F08220-4948-41F1-A1B0-CEF719BA1A78@avia-gis.be>
References: <73F08220-4948-41F1-A1B0-CEF719BA1A78@avia-gis.be>
Message-ID: <alpine.LRH.2.00.0907231458190.17617@reclus.nhh.no>

On Thu, 23 Jul 2009, Els Ducheyne wrote:

> Dear all
> sorry to post this question, but I have been looking across multiple fora and 
> haven't found the answer
>
> I am trying to read ascii-grids in R using the shapefile - read.asciigrid

This is not a shapefile at all.

> I have found that this is of class SpatialGridDataFrame
> I would like to combine this with a set of grids that are already in the 
> workspace but when i use the [[<-option I always get the following error
> What am I doing wrong? I am not using rgdal, because of a linking error that 
> I cannot seem to overcome - even though the installation of rgdal and all its 
> dependencies didn't yield an erro
>
> Thanks for any help!
>
> achandata<-read.asciigrid("achan.asc")

Preferably use readGDAL() in rgdal, and note that the equivalent 
readAsciiGrid() in maptools allows for ESRI's locale oddities while the 
version in sp does not. But in general just use readGDAL().

>> summary(achandata)
> Object of class SpatialGridDataFrame
> Coordinates:
>          min    max
> coords.x1 -2.5 1002.5
> coords.x2 -2.5  502.5
> Is projected: NA
> proj4string : [NA]
> Number of points: 2
> Grid attributes:
> cellcentre.offset cellsize cells.dim
> 1                 0        5       201
> 2                 0        5       101
> Data attributes:
>  Min. 1st Qu.  Median    Mean 3rd Qu.    Max.
> 0.0000  0.0000  0.3000  0.7088  0.9000  6.2000
>> grids[["achan"]]<-achandata

You are trying to assign a SpatialGridDataFrame object to a column in 
grids, another SpatialGridDataFrame. Why not use the cbind() method for 
these objects, for example:

grids1 <- cbind(grids, achandata)
names(grids) <- c("elev", "grad", "achan")

Alternatively, but more error-prone is:

an <- names(achandata)
grids$achan <- achandata[[an[1]]]

- the name is most likely "band1", but we don't know.

Hope this helps,

Roger

> Error: object is not subsettable
>> summary(grids)
> Object of class SpatialGridDataFrame
> Coordinates:
>          min    max
> coords.x1 -2.5 1002.5
> coords.x2 -2.5  502.5
> Is projected: NA
> proj4string : [NA]
> Number of points: 2
> Grid attributes:
> cellcentre.offset cellsize cells.dim
> 1                 0        5       201
> 2                 0        5       101
> Data attributes:
>     elev            grad
> Min.   :119.8   Min.   :0.0008663
> 1st Qu.:140.0   1st Qu.:0.0399718
> Median :144.0   Median :0.0620299
> Mean   :144.3   Mean   :0.0821328
> 3rd Qu.:150.1   3rd Qu.:0.1129532
> Max.   :159.5   Max.   :0.3284767
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From Thierry.ONKELINX at inbo.be  Thu Jul 23 15:06:28 2009
From: Thierry.ONKELINX at inbo.be (ONKELINX, Thierry)
Date: Thu, 23 Jul 2009 15:06:28 +0200
Subject: [R-sig-Geo] ASCII grids as spatialgridframe
In-Reply-To: <73F08220-4948-41F1-A1B0-CEF719BA1A78@avia-gis.be>
References: <73F08220-4948-41F1-A1B0-CEF719BA1A78@avia-gis.be>
Message-ID: <2E9C414912813E4EB981326983E0A104069D9C4C@inboexch.inbo.be>

Hi Els,

You need to append only the data from the grid and not the grid itself.

Here is an example with the meuse dataset (available in sp).

data(meuse.grid)
m <- SpatialPixelsDataFrame(points = meuse.grid[c("x", "y")], data =
meuse.grid)
m2 <- SpatialPixelsDataFrame(points = meuse.grid[c("x", "y")], data =
data.frame(extra = sqrt(meuse.grid$dist)))

#this is what you tried.
m[["extra"]] <- m2 

#this is what you should do.
m$extra <- m2$extra

Best regards,

Thierry

------------------------------------------------------------------------
----
ir. Thierry Onkelinx
Instituut voor natuur- en bosonderzoek / Research Institute for Nature
and Forest
Cel biometrie, methodologie en kwaliteitszorg / Section biometrics,
methodology and quality assurance
Gaverstraat 4
9500 Geraardsbergen
Belgium
tel. + 32 54/436 185
Thierry.Onkelinx at inbo.be
www.inbo.be

To call in the statistician after the experiment is done may be no more
than asking him to perform a post-mortem examination: he may be able to
say what the experiment died of.
~ Sir Ronald Aylmer Fisher

The plural of anecdote is not data.
~ Roger Brinner

The combination of some data and an aching desire for an answer does not
ensure that a reasonable answer can be extracted from a given body of
data.
~ John Tukey

-----Oorspronkelijk bericht-----
Van: r-sig-geo-bounces at stat.math.ethz.ch
[mailto:r-sig-geo-bounces at stat.math.ethz.ch] Namens Els Ducheyne
Verzonden: donderdag 23 juli 2009 14:32
Aan: r-sig-geo at stat.math.ethz.ch
Onderwerp: [R-sig-Geo] ASCII grids as spatialgridframe

Dear all
sorry to post this question, but I have been looking across multiple
fora and haven't found the answer

I am trying to read ascii-grids in R using the shapefile -
read.asciigrid I have found that this is of class SpatialGridDataFrame I
would like to combine this with a set of grids that are already in the
workspace but when i use the [[<-option I always get the following error
What am I doing wrong? I am not using rgdal, because of a linking error
that I cannot seem to overcome - even though the installation of rgdal
and all its dependencies didn't yield an erro

Thanks for any help!

  achandata<-read.asciigrid("achan.asc")
 > summary(achandata)
Object of class SpatialGridDataFrame
Coordinates:
            min    max
coords.x1 -2.5 1002.5
coords.x2 -2.5  502.5
Is projected: NA
proj4string : [NA]
Number of points: 2
Grid attributes:
   cellcentre.offset cellsize cells.dim
1                 0        5       201
2                 0        5       101
Data attributes:
    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.
  0.0000  0.0000  0.3000  0.7088  0.9000  6.2000  >
grids[["achan"]]<-achandata
Error: object is not subsettable
 > summary(grids)
Object of class SpatialGridDataFrame
Coordinates:
            min    max
coords.x1 -2.5 1002.5
coords.x2 -2.5  502.5
Is projected: NA
proj4string : [NA]
Number of points: 2
Grid attributes:
   cellcentre.offset cellsize cells.dim
1                 0        5       201
2                 0        5       101
Data attributes:
       elev            grad
  Min.   :119.8   Min.   :0.0008663
  1st Qu.:140.0   1st Qu.:0.0399718
  Median :144.0   Median :0.0620299
  Mean   :144.3   Mean   :0.0821328
  3rd Qu.:150.1   3rd Qu.:0.1129532
  Max.   :159.5   Max.   :0.3284767

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at stat.math.ethz.ch
https://stat.ethz.ch/mailman/listinfo/r-sig-geo

Dit bericht en eventuele bijlagen geven enkel de visie van de schrijver weer 
en binden het INBO onder geen enkel beding, zolang dit bericht niet bevestigd is
door een geldig ondertekend document. The views expressed in  this message 
and any annex are purely those of the writer and may not be regarded as stating 
an official position of INBO, as long as the message is not confirmed by a duly 
signed document.


From educheyne at avia-gis.be  Thu Jul 23 15:12:19 2009
From: educheyne at avia-gis.be (Els Ducheyne)
Date: Thu, 23 Jul 2009 15:12:19 +0200
Subject: [R-sig-Geo] ASCII grids as spatialgridframe
In-Reply-To: <fb57c397ff05.4a68ecf9@utas.edu.au>
References: <73F08220-4948-41F1-A1B0-CEF719BA1A78@avia-gis.be>
	<fb57c397ff05.4a68ecf9@utas.edu.au>
Message-ID: <2BC06417-E98E-439E-B76D-9079ED06FE66@avia-gis.be>

Thanks all for a speedy replies!

On 23 Jul 2009, at 15:06, mdsumner wrote:

> This should work:
>
> grids[["achan"]]<-achandata[[1]]
> You need to extract the first column from achandata to assign just  
> the data values as a new attribute on grids (which is fine since  
> your two SGDFs share topology). .
>
> Regards, Mike.
>
> ----- Original Message -----
> From: Els Ducheyne <educheyne at avia-gis.be>
> Date: Thursday, July 23, 2009 22:38
> Subject: [R-sig-Geo] ASCII grids as spatialgridframe
> To: r-sig-geo at stat.math.ethz.ch
>
> > Dear all
> > sorry to post this question, but I have been looking across
> > multiple fora and haven't found the answer
> >
> > I am trying to read ascii-grids in R using the shapefile -
> > read.asciigridI have found that this is of class  
> SpatialGridDataFrame
> > I would like to combine this with a set of grids that are
> > already in the workspace but when i use the [[<-option I
> > always get the following error
> > What am I doing wrong? I am not using rgdal, because of a
> > linking error that I cannot seem to overcome - even though the
> > installation of rgdal and all its dependencies didn't yield an erro
> >
> > Thanks for any help!
> >
> >  achandata<-read.asciigrid("achan.asc")
> > > summary(achandata)
> > Object of class SpatialGridDataFrame
> > Coordinates:
> >
> > min    max
> > coords.x1 -2.5 1002.5
> > coords.x2 -2.5  502.5
> > Is projected: NA
> > proj4string : [NA]
> > Number of points: 2
> > Grid attributes:
> >   cellcentre.offset cellsize cells.dim
> > 1                 0        5       201
> > 2                 0        5       101
> > Data attributes:
> >    Min. 1st Qu.  Median    Mean
> > 3rd Qu.    Max.
> >  0.0000  0.0000  0.3000  0.7088
> > 0.9000  6.2000
> > > grids[["achan"]]<-achandata
> > Error: object is not subsettable
> > > summary(grids)
> > Object of class SpatialGridDataFrame
> > Coordinates:
> >
> > min    max
> > coords.x1 -2.5 1002.5
> > coords.x2 -2.5  502.5
> > Is projected: NA
> > proj4string : [NA]
> > Number of points: 2
> > Grid attributes:
> >   cellcentre.offset cellsize cells.dim
> > 1                 0        5       201
> > 2                 0        5       101
> > Data attributes:
> >
> > elev            grad
> >  Min.   :119.8   Min.   :0.0008663
> >  1st Qu.:140.0   1st Qu.:0.0399718
> >  Median :144.0   Median :0.0620299
> >  Mean   :144.3   Mean   :0.0821328
> >  3rd Qu.:150.1   3rd Qu.:0.1129532
> >  Max.   :159.5   Max.   :0.3284767
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at stat.math.ethz.ch
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From hengl at spatial-analyst.net  Fri Jul 24 12:01:13 2009
From: hengl at spatial-analyst.net (Tomislav Hengl)
Date: Fri, 24 Jul 2009 12:01:13 +0200
Subject: [R-sig-Geo] krige.bayes and data export
In-Reply-To: <e027b8750907220910t2c106ff7t8b21372cf2aa6857@mail.gmail.com>
References: <e027b8750907220910t2c106ff7t8b21372cf2aa6857@mail.gmail.com>
Message-ID: <2DE54117FE2242E3991720DFD03A301F@pcibed193>


Hi Laura,

Sorry for a bit delay in reply. I hope you did not give up on geoR. The truth is: transforming
result of prediction using geoR to e.g. sp classes is not trivial (it looks like as creators of geoR
did not really consider this option). Once you get it into sp class, then it is easy to export it
using rgdal or to a "database format" (?). I had difficulties myself to get it running - but it is
doable. There are certainly many benefits of using geoR (actually, I am starting to like it more and
more).

> data(meuse)
> coordinates(meuse) <- ~x+y
> zinc.geo <- as.geodata(meuse.ov["zinc"])
> zinc.svar2 <- variog(zinc.geo, lambda=0, max.dist=1500, messages=FALSE)
> zinc.vgm2 <- likfit(zinc.geo, lambda=0, messages=FALSE, ini=c(var(log1p(zinc.geo$data)),500),
cov.model="exponential")
# prepare prediction locations:
> locs <- pred_grid(c(pc.comps at bbox[1,1]+gridcell/2, pc.comps at bbox[1,2]-gridcell/2),
c(pc.comps at bbox[2,1]+gridcell/2, pc.comps at bbox[2,2]-gridcell/2), by=gridcell)
...
> mask.bor <- mask at polygons[[1]]@Polygons[[1]]@coords
...
> zinc.ok2 <- krige.conv(zinc.geo, locations=locs, krige=krige.control(obj.m=zinc.vgm2),
borders=mask.bor)
...
> mask.ov <- overlay(mask, locs.sp)
> mask.sel <- !is.na(mask.ov$MASK.SGRD)
> locs.geo <- data.frame(X=locs.sp at coords[mask.sel,1], Y=locs.sp at coords[mask.sel,2],
zinc.ok2=zinc.ok2[[1]], zinc.rkvar2=zinc.ok2[[2]])
> coordinates(locs.geo) <-~X+Y
> gridded(locs.geo) <- TRUE
> write.asciigrid(locs.geo[1], "zinc_ok2.asc", na.value=-1)


Here are more examples (see section "Geostatistics in geoR"):
http://spatial-analyst.net/scripts/meuse.R 


T. Hengl


> -----Original Message-----
> From: r-sig-geo-bounces at stat.math.ethz.ch [mailto:r-sig-geo-bounces at stat.math.ethz.ch] On Behalf
> Of Laura Poggio
> Sent: Wednesday, July 22, 2009 6:11 PM
> To: r-sig-geo at stat.math.ethz.ch
> Subject: [R-sig-Geo] krige.bayes and data export
> 
> Dear list,
> I got some simulations with krige.bayes of geoR packages. I can plot them
> with the code provided in the example. However I also would like to export
> the results of the simulations as database. This in order to access them
> later for further analysis.
> 
> To plot them I access the simulations as following:
> image(awc.res.bayes, val= "simulation", number.col=1)
> image(awc.res.bayes, val= "simulation", number.col=2)
> image(awc.res.bayes, val= "simulation", number.col=3)
> image(awc.res.bayes, val= "simulation", number.col=...)
> image(awc.res.bayes, val= "simulation", number.col=30)
> 
> I did not find a way to store the simulation values in a dataframe. And I
> did not find any example around.
> I hope I manage to explain my problem.
> 
> Thank you very much in advance
> 
> Laura Poggio
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From laura.poggio at gmail.com  Fri Jul 24 16:55:10 2009
From: laura.poggio at gmail.com (Laura Poggio)
Date: Fri, 24 Jul 2009 15:55:10 +0100
Subject: [R-sig-Geo] krige.bayes and data export
In-Reply-To: <2DE54117FE2242E3991720DFD03A301F@pcibed193>
References: <e027b8750907220910t2c106ff7t8b21372cf2aa6857@mail.gmail.com>
	<2DE54117FE2242E3991720DFD03A301F@pcibed193>
Message-ID: <e027b8750907240755m4f76c001k6e965300f3e65563@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090724/42c6e3bc/attachment.pl>

From raphael.viscarra-rossel at csiro.au  Tue Jul 28 09:20:42 2009
From: raphael.viscarra-rossel at csiro.au (Viscarra Rossel, Raphael (CLW, Black Mountain))
Date: Tue, 28 Jul 2009 17:20:42 +1000
Subject: [R-sig-Geo] Factorial kriging in R
Message-ID: <FD598454-B778-465B-9FD7-CE83382F7CEF@csiro.au>

Hello,
has anyone come across factorial kriging in R?
Raph.


From Thierry.ONKELINX at inbo.be  Tue Jul 28 10:40:55 2009
From: Thierry.ONKELINX at inbo.be (ONKELINX, Thierry)
Date: Tue, 28 Jul 2009 10:40:55 +0200
Subject: [R-sig-Geo] Factorial kriging in R
In-Reply-To: <FD598454-B778-465B-9FD7-CE83382F7CEF@csiro.au>
References: <FD598454-B778-465B-9FD7-CE83382F7CEF@csiro.au>
Message-ID: <2E9C414912813E4EB981326983E0A104069D9F4D@inboexch.inbo.be>

Dear Raphael,

Using RSiteSearch("factorial kriging") I found this post from Edzer:
http://finzi.psych.upenn.edu/R/Rhelp02/archive/117970.html

HTH,

Thierry

------------------------------------------------------------------------
----
ir. Thierry Onkelinx
Instituut voor natuur- en bosonderzoek / Research Institute for Nature
and Forest
Cel biometrie, methodologie en kwaliteitszorg / Section biometrics,
methodology and quality assurance
Gaverstraat 4
9500 Geraardsbergen
Belgium
tel. + 32 54/436 185
Thierry.Onkelinx at inbo.be
www.inbo.be

To call in the statistician after the experiment is done may be no more
than asking him to perform a post-mortem examination: he may be able to
say what the experiment died of.
~ Sir Ronald Aylmer Fisher

The plural of anecdote is not data.
~ Roger Brinner

The combination of some data and an aching desire for an answer does not
ensure that a reasonable answer can be extracted from a given body of
data.
~ John Tukey

-----Oorspronkelijk bericht-----
Van: r-sig-geo-bounces at stat.math.ethz.ch
[mailto:r-sig-geo-bounces at stat.math.ethz.ch] Namens Viscarra Rossel,
Raphael (CLW, Black Mountain)
Verzonden: dinsdag 28 juli 2009 9:21
Aan: r-sig-geo at stat.math.ethz.ch
Onderwerp: [R-sig-Geo] Factorial kriging in R

Hello,
has anyone come across factorial kriging in R?
Raph.

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at stat.math.ethz.ch
https://stat.ethz.ch/mailman/listinfo/r-sig-geo

Dit bericht en eventuele bijlagen geven enkel de visie van de schrijver weer 
en binden het INBO onder geen enkel beding, zolang dit bericht niet bevestigd is
door een geldig ondertekend document. The views expressed in  this message 
and any annex are purely those of the writer and may not be regarded as stating 
an official position of INBO, as long as the message is not confirmed by a duly 
signed document.


From seancarmody at gmail.com  Tue Jul 28 11:10:52 2009
From: seancarmody at gmail.com (Sean Carmody)
Date: Tue, 28 Jul 2009 19:10:52 +1000
Subject: [R-sig-Geo] Using Shapes file to update the "world" map
In-Reply-To: <ce6bbb9d0907280118s15172754p512d120e158b69af@mail.gmail.com>
References: <ce6bbb9d0907280118s15172754p512d120e158b69af@mail.gmail.com>
Message-ID: <ce6bbb9d0907280210na924488gd458c4eaadf77d1e@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090728/a03c27ed/attachment.pl>

From educheyne at avia-gis.be  Tue Jul 28 17:14:00 2009
From: educheyne at avia-gis.be (Els Ducheyne)
Date: Tue, 28 Jul 2009 17:14:00 +0200
Subject: [R-sig-Geo]  Optimal bandwidth selection using mse2d
In-Reply-To: <2E9C414912813E4EB981326983E0A104069D9F4D@inboexch.inbo.be>
References: <FD598454-B778-465B-9FD7-CE83382F7CEF@csiro.au>
	<2E9C414912813E4EB981326983E0A104069D9F4D@inboexch.inbo.be>
Message-ID: <1AF9BEE7-0473-4493-A76E-F45144E3665A@avia-gis.be>

>
Dear all
does anyone know how the MSE is calculated using the mse2d function  
from spatstat. I have the reference paper with me, but I cannot grasp  
the exact meaning.
I assume it determines the difference between the estimated kernel  
smoothed and the density (count?) of the original point pattern, is  
this correct?

Many thanks for your reply
Els


From Roger.Bivand at nhh.no  Tue Jul 28 17:58:57 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 28 Jul 2009 17:58:57 +0200 (CEST)
Subject: [R-sig-Geo] Using Shapes file to update the "world" map
In-Reply-To: <ce6bbb9d0907280210na924488gd458c4eaadf77d1e@mail.gmail.com>
References: <ce6bbb9d0907280118s15172754p512d120e158b69af@mail.gmail.com>
	<ce6bbb9d0907280210na924488gd458c4eaadf77d1e@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.0907281756160.7444@reclus.nhh.no>

On Tue, 28 Jul 2009, Sean Carmody wrote:

> I recently began playing around with the maps package, but am definitely a
> novice when it comes to geographic data. While the map function is very easy
> to use, the map data is out of date, particularly when it comes to former
> Soviet Union countries. I have tried to search the archives to work out how
> to update the file, but have become rather stuck. I found these
> instructions: http://spatial.nhh.no/R/etc/world_map_intro.html but could not
> quite follow them.

Please use the wrld_simpl data set bundled with the maptools package, and 
use your choice of its attributes (see names(wrld_simpl) - probably ISO3) 
to key to your data. See spCbind() methods in maptools for control in 
assigning, and review the sp SpatialPolygonDataFrame class used.

Roger

> They did, however, point me to this site
> http://thematicmapping.org/downloads/world_borders.php which has a more up
> to date file of country borders. After downloading this file, I managed to
> read in the shape file using read.shape and then plotted the result using
> Map2poly and this confirmed that the data was good. However, the read.shape
> gave me various error messages about extra data in the file and, although I
> could plot the whole world, I don't know how to identify individual
> countries. Ideally, I would like to take the downloaded border file data and
> convert into file formats that the map function can understand. Any
> suggestions as to how to do this or any alternative approaches would be
> greatly appreciated. To get an idea of what I am trying to do, this post has
> examples using the old map data:
> http://www.stubbornmule.net/2009/07/arms-trade/
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From seancarmody at gmail.com  Tue Jul 28 23:52:33 2009
From: seancarmody at gmail.com (Sean Carmody)
Date: Wed, 29 Jul 2009 07:52:33 +1000
Subject: [R-sig-Geo] Using Shapes file to update the "world" map
In-Reply-To: <alpine.LRH.2.00.0907281756160.7444@reclus.nhh.no>
References: <ce6bbb9d0907280118s15172754p512d120e158b69af@mail.gmail.com>
	<ce6bbb9d0907280210na924488gd458c4eaadf77d1e@mail.gmail.com>
	<alpine.LRH.2.00.0907281756160.7444@reclus.nhh.no>
Message-ID: <ce6bbb9d0907281452t2bb5103bp4c036bd564bee42@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090729/08c56cda/attachment.pl>

From N.A.Batchelor at sms.ed.ac.uk  Wed Jul 29 11:26:13 2009
From: N.A.Batchelor at sms.ed.ac.uk (Nicola Batchelor)
Date: Wed, 29 Jul 2009 10:26:13 +0100
Subject: [R-sig-Geo] Binom.krige.bayes sim.predict question
Message-ID: <E284E03A1E364B879C02830CAA9A10F7@soton.ac.uk>

Dear list,

I've been using geoRglm  for parameter estimation and spatial predictions
for a disease dataset along with 3 predictor variables.  

I just have a quick question about the option sim.predict in
output.glm.control - am I correct in thinking that when this is set to TRUE,
you end up with a sample from the predictive distribution at each prediction
location, and from this sample the predictive median, 95%CrI and uncertainty
is calculated for each prediction location?

If that is correct, then how are predictive medians calculated when this
option is set to FALSE?  I have run my model like this and ended up with a
sensible looking prediction, but if I am correct in the above understanding
of sim.predict, then how are the medians calculated without the sample from
the predictive distributions?  

If Im not correct, can someone please point me in the right direction as to
how the predictive output is produced when this is TRUE and FALSE?

Many thanks (and I hope this question makes sense!)


Nicola


-- 
The University of Edinburgh is a charitable body, registered in
Scotland, with registration number SC005336.


From Raphael.Viscarra-Rossel at csiro.au  Wed Jul 29 12:41:44 2009
From: Raphael.Viscarra-Rossel at csiro.au (Viscarra Rossel, Raphael (CLW, Black Mountain))
Date: Wed, 29 Jul 2009 20:41:44 +1000
Subject: [R-sig-Geo] Factorial kriging in R
In-Reply-To: <2E9C414912813E4EB981326983E0A104069D9F4D@inboexch.inbo.be>
References: <FD598454-B778-465B-9FD7-CE83382F7CEF@csiro.au>
	<2E9C414912813E4EB981326983E0A104069D9F4D@inboexch.inbo.be>
Message-ID: <3911704A-C994-4F93-AA96-F30C6A8365F4@csiro.au>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090729/eab84577/attachment.pl>

From mwkhan at ucdavis.edu  Wed Jul 29 23:33:27 2009
From: mwkhan at ucdavis.edu (Mehdi Khan)
Date: Wed, 29 Jul 2009 14:33:27 -0700
Subject: [R-sig-Geo] Points in Polygon question
Message-ID: <60b3892e0907291433qd880197t8e7a912016c785d9@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090729/0b01c202/attachment.pl>

From edzer.pebesma at uni-muenster.de  Thu Jul 30 19:21:49 2009
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Thu, 30 Jul 2009 10:21:49 -0700
Subject: [R-sig-Geo] RandomFields: Randomness in realisations of
 sequential simulation?
In-Reply-To: <4A5F5550.10708@sedgeo.uni-tuebingen.de>
References: <4A5F5550.10708@sedgeo.uni-tuebingen.de>
Message-ID: <4A71D6AD.1040308@uni-muenster.de>



Andre Jung wrote:
> Dear all,
>
> I've some general question regarding the implementation of
> randomness in RandomFields and sequential simulation.
My answers only apply to krige in package gstat; I believe this is what
you refer to with "sequential simulation".
>
> (1) Is there a difference between running
>    krige(nsim = 5, ....)
>     and running
>    krige(nsim = 1, ....)
>     for 5 times?
in the second case, 5 different random paths are followed.
>
> (2) Does repeating of the simulation with the same random number seed
>     (how to keep the seed?) lead to the same realisations? And: how
>     random is the path?
?set.seed
>
> (3) Can I fix the parameters (which ones?) to reproduce the same
>     realisations a later time?
?set.seed
>
>
> Another question is: How can I generate an 'e-type' of, let's say 10,
> realisations, and do some post-simulation analysis like defining
> probability to be above or below a certain threshold?
?apply ; I believe the asdar book has examples (see www.asdar-book.org)

>
>
> Many thanks in advance!
>
> best,
> Andre
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763 http://ifgi.uni-muenster.de/
http://www.springer.com/978-0-387-78170-9 e.pebesma at wwu.de


From a.ghisla at gmail.com  Fri Jul 31 17:42:24 2009
From: a.ghisla at gmail.com (Anne Ghisla)
Date: Fri, 31 Jul 2009 17:42:24 +0200
Subject: [R-sig-Geo] [Report #10] Kriging with GRASS and R: v.autokrige port
 to wxPython and more
Message-ID: <1249054944.4606.34.camel@galadriel.uagra.net>

Hello all, and sorry for cross-posting,

good news from v.krige:
* fixed optional parameters also in interface - activated by a checkbox,
otherwise R's NA value is correctly set
* interactive variogram fit is on its way - stay tuned!

Next week I plan to set up interactive variogram using matplotlib
functions and get the stabler code possible for feature freeze.

best regards,

Anne
- --
http://grass.osgeo.org/wiki/V.krige_GSoC_2009

-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 197 bytes
Desc: Questa ? una parte del messaggio	firmata digitalmente
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090731/1382f03a/attachment.bin>

From litobrancha at yahoo.com  Fri Jul 31 20:21:34 2009
From: litobrancha at yahoo.com (Jason Robinson)
Date: Fri, 31 Jul 2009 11:21:34 -0700 (PDT)
Subject: [R-sig-Geo] raster algebra in R
Message-ID: <451739.74883.qm@web63107.mail.re1.yahoo.com>


I need to do some raster algebra on some large rasters.  right now they are ascii files.  I'm a complete R novice.  Can anyone point me towards a good source for figuring out how to get my data into R and how to do very simple raster manipulations?  no advice is too simple for this guy.  appreciate any help that is out there

Jason Robinson


From Hollister.Jeff at epamail.epa.gov  Fri Jul 31 21:39:11 2009
From: Hollister.Jeff at epamail.epa.gov (Hollister.Jeff at epamail.epa.gov)
Date: Fri, 31 Jul 2009 15:39:11 -0400
Subject: [R-sig-Geo] RPyGeo Problem
Message-ID: <OF04652FF0.5F5DAA2B-ON85257604.006B419A-85257604.006BF668@epamail.epa.gov>


All,

I am having a problem running the rpygeo.geoprocessor() function.  For
instance:

rpygeo.geoprocessor("PolygonToLine",
args=list("temp.shp","templ.shp"))

results in the following error:

Error in as.vector(x, "character") :
  cannot coerce type 'S4' to vector of type 'character'

I have been banging my head against this error for some time and cannot
figure out what is going on.

FYI, I am running R 2.8.1, Python 2.5.1, and ArcGIS 9.3

Thanks in advance for any help.

Cheers,
Jeff

***************************
Dr. Jeffrey W. Hollister
US EPA
Atlantic Ecology Division
27 Tarzwell Drive
Narragansett, RI 02882
(401) 782-9655


From ssefick at gmail.com  Fri Jul 31 22:15:20 2009
From: ssefick at gmail.com (stephen sefick)
Date: Fri, 31 Jul 2009 15:15:20 -0500
Subject: [R-sig-Geo] raster algebra in R
In-Reply-To: <451739.74883.qm@web63107.mail.re1.yahoo.com>
References: <451739.74883.qm@web63107.mail.re1.yahoo.com>
Message-ID: <c502a9e10907311315h5e9f51adi436f3d9c211c12fd@mail.gmail.com>

Have a look at the spatial task view.  I use GRASS GIS for raster
processing, and maybe this would be helpful-http://grass.osgeo.org/.
hth,

Stephen Sefick

On Fri, Jul 31, 2009 at 1:21 PM, Jason Robinson<litobrancha at yahoo.com> wrote:
>
> I need to do some raster algebra on some large rasters. ?right now they are ascii files. ?I'm a complete R novice. ?Can anyone point me towards a good source for figuring out how to get my data into R and how to do very simple raster manipulations? ?no advice is too simple for this guy. ?appreciate any help that is out there
>
> Jason Robinson
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



-- 
Stephen Sefick

Let's not spend our time and resources thinking about things that are
so little or so large that all they really do for us is puff us up and
make us feel like gods.  We are mammals, and have not exhausted the
annoying little problems of being mammals.

								-K. Mullis


From milton.ruser at gmail.com  Fri Jul 31 22:58:45 2009
From: milton.ruser at gmail.com (milton ruser)
Date: Fri, 31 Jul 2009 16:58:45 -0400
Subject: [R-sig-Geo] raster algebra in R
In-Reply-To: <451739.74883.qm@web63107.mail.re1.yahoo.com>
References: <451739.74883.qm@web63107.mail.re1.yahoo.com>
Message-ID: <3aaf1a030907311358k44fe8c7dx772027f263dcf942@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090731/b01c2813/attachment.pl>

From milton.ruser at gmail.com  Fri Jul 31 23:01:11 2009
From: milton.ruser at gmail.com (milton ruser)
Date: Fri, 31 Jul 2009 17:01:11 -0400
Subject: [R-sig-Geo] raster algebra in R
In-Reply-To: <c502a9e10907311315h5e9f51adi436f3d9c211c12fd@mail.gmail.com>
References: <451739.74883.qm@web63107.mail.re1.yahoo.com>
	<c502a9e10907311315h5e9f51adi436f3d9c211c12fd@mail.gmail.com>
Message-ID: <3aaf1a030907311401w5d8361d5l5ed9e82f6125b0e3@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090731/e2360eb7/attachment.pl>

From r.hijmans at gmail.com  Fri Jul 31 23:20:23 2009
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Fri, 31 Jul 2009 14:20:23 -0700
Subject: [R-sig-Geo] raster algebra in R
In-Reply-To: <451739.74883.qm@web63107.mail.re1.yahoo.com>
References: <451739.74883.qm@web63107.mail.re1.yahoo.com>
Message-ID: <dc22b2570907311420j325d35eft30d3563a30a5f266@mail.gmail.com>

You can try the raster package, available from R-forge:

install.packages("raster", repos="http://R-Forge.R-project.org")

It has very simple raster algebra

r1 <- raster('myfile1.asc')
r2 <- raster('myfile2.asc')
r3 <- r1 + sqrt(r2) + 1

etc.

Robert

On Fri, Jul 31, 2009 at 11:21 AM, Jason Robinson<litobrancha at yahoo.com> wrote:
>
> I need to do some raster algebra on some large rasters. ?right now they are ascii files. ?I'm a complete R novice. ?Can anyone point me towards a good source for figuring out how to get my data into R and how to do very simple raster manipulations? ?no advice is too simple for this guy. ?appreciate any help that is out there
>
> Jason Robinson
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From milton.ruser at gmail.com  Fri Jul 31 23:24:35 2009
From: milton.ruser at gmail.com (milton ruser)
Date: Fri, 31 Jul 2009 17:24:35 -0400
Subject: [R-sig-Geo] raster algebra in R
In-Reply-To: <dc22b2570907311420j325d35eft30d3563a30a5f266@mail.gmail.com>
References: <451739.74883.qm@web63107.mail.re1.yahoo.com>
	<dc22b2570907311420j325d35eft30d3563a30a5f266@mail.gmail.com>
Message-ID: <3aaf1a030907311424o61df1a65id757db256103dc25@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090731/20b57430/attachment.pl>

