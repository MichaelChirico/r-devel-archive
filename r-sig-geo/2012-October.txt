From leila.brook at my.jcu.edu.au  Mon Oct  1 06:56:11 2012
From: leila.brook at my.jcu.edu.au (Leila Brook)
Date: Mon, 1 Oct 2012 04:56:11 +0000
Subject: [R-sig-Geo] Plug-in bandwidth kernel estimation in adehabitat
Message-ID: <9BEE83C6BF59174DBD2CB4A06EB6CBEB2FE0523F@SINPRD0111MB368.apcprd01.prod.exchangelabs.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121001/443c07b8/attachment.pl>

From leila.brook at my.jcu.edu.au  Mon Oct  1 07:03:02 2012
From: leila.brook at my.jcu.edu.au (Leila Brook)
Date: Mon, 1 Oct 2012 05:03:02 +0000
Subject: [R-sig-Geo] Calculating spatial overlap using kerneloverlap() in
	adehabitat
Message-ID: <9BEE83C6BF59174DBD2CB4A06EB6CBEB2FE05207@SINPRD0111MB368.apcprd01.prod.exchangelabs.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121001/2530df0e/attachment.pl>

From ruocco at idi.ntnu.no  Mon Oct  1 09:09:42 2012
From: ruocco at idi.ntnu.no (Massimiliano Ruocco)
Date: Mon, 01 Oct 2012 09:09:42 +0200
Subject: [R-sig-Geo] Dividing World Map
Message-ID: <506941B6.1070906@idi.ntnu.no>

Dear all,
i would like to divide the world map in grid of equal dimension (example 
quad of 10kmx10km). Is it correct to use the UTM coord instead of 
lat/lon ones? Is there any drawback on doing that?

IS there any existing routine doing it?

Thanks in advance

-- 
Massimiliano Ruocco
PhD Student
Department of Computer and Information Science (IDI), NTNU
Office: 260  IT-bygget
Phone:(+47) 735 94168
Email:ruocco at idi.ntnu.no
Website: http://www.idi.ntnu.no/~ruocco/


From b.rowlingson at lancaster.ac.uk  Mon Oct  1 10:05:54 2012
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Mon, 1 Oct 2012 09:05:54 +0100
Subject: [R-sig-Geo] Dividing World Map
In-Reply-To: <07ad2fbd7ae1470fa2da4084ee58204b@EX-1-HT0.lancs.local>
References: <07ad2fbd7ae1470fa2da4084ee58204b@EX-1-HT0.lancs.local>
Message-ID: <CANVKczM6Bms3K6N_3Kn2MEvU=b+0GyroczTY4GhH4p1xf1N-Rw@mail.gmail.com>

On Mon, Oct 1, 2012 at 8:09 AM, Massimiliano Ruocco <ruocco at idi.ntnu.no> wrote:
> Dear all,
> i would like to divide the world map in grid of equal dimension (example
> quad of 10kmx10km). Is it correct to use the UTM coord instead of
> lat/lon ones? Is there any drawback on doing that?
>
> IS there any existing routine doing it?

 Since we figured out that the earth isn't flat we've known its
impossible. You can't divide a sphere into a grid like that - what are
you going to do at the poles?

 You can project small parts to coordinates such as UTM and divide
into a regular square grid in those coordinates, but even those aren't
perfect, and get less perfect nearer the poles, at which point they
are completely wrong...

I think UTM zones typically have a max latitude they should be used
at, so as long as you don't care about polar bears and penguins you
should be okay...

Barry


From ruocco at idi.ntnu.no  Mon Oct  1 10:11:22 2012
From: ruocco at idi.ntnu.no (Massimiliano Ruocco)
Date: Mon, 01 Oct 2012 10:11:22 +0200
Subject: [R-sig-Geo] Dividing World Map
In-Reply-To: <CANVKczM6Bms3K6N_3Kn2MEvU=b+0GyroczTY4GhH4p1xf1N-Rw@mail.gmail.com>
References: <07ad2fbd7ae1470fa2da4084ee58204b@EX-1-HT0.lancs.local>
	<CANVKczM6Bms3K6N_3Kn2MEvU=b+0GyroczTY4GhH4p1xf1N-Rw@mail.gmail.com>
Message-ID: <5069502A.4@idi.ntnu.no>

Thanks for the answer
Yes, should be fine for me. I don't need polar areas. So shoud be fine 
to go from -80 to 80 for lat.
So an approximative idea to proceed could be the following:

1) scan all the UTM zone
2) divide the utm zone in quad of 10kmX10km

Just a question...i am not sure i really understand the UTM coord. Is 
each zone a 500kmX500km quad?

THanks again



On 10/01/2012 10:05 AM, Barry Rowlingson wrote:
> On Mon, Oct 1, 2012 at 8:09 AM, Massimiliano Ruocco <ruocco at idi.ntnu.no> wrote:
>> Dear all,
>> i would like to divide the world map in grid of equal dimension (example
>> quad of 10kmx10km). Is it correct to use the UTM coord instead of
>> lat/lon ones? Is there any drawback on doing that?
>>
>> IS there any existing routine doing it?
>   Since we figured out that the earth isn't flat we've known its
> impossible. You can't divide a sphere into a grid like that - what are
> you going to do at the poles?
>
>   You can project small parts to coordinates such as UTM and divide
> into a regular square grid in those coordinates, but even those aren't
> perfect, and get less perfect nearer the poles, at which point they
> are completely wrong...
>
> I think UTM zones typically have a max latitude they should be used
> at, so as long as you don't care about polar bears and penguins you
> should be okay...
>
> Barry


-- 
Massimiliano Ruocco
PhD Student
Department of Computer and Information Science (IDI), NTNU
Office: 260  IT-bygget
Phone:(+47) 735 94168
Email:ruocco at idi.ntnu.no
Website: http://www.idi.ntnu.no/~ruocco/


From clement.calenge at oncfs.gouv.fr  Mon Oct  1 10:20:03 2012
From: clement.calenge at oncfs.gouv.fr (Clement Calenge)
Date: Mon, 1 Oct 2012 10:20:03 +0200
Subject: [R-sig-Geo] [AniMov] Plug-in bandwidth kernel estimation in
	adehabitat
In-Reply-To: <9BEE83C6BF59174DBD2CB4A06EB6CBEB2FE0523F@SINPRD0111MB368.apcprd01.prod.exchangelabs.com>
References: <9BEE83C6BF59174DBD2CB4A06EB6CBEB2FE0523F@SINPRD0111MB368.apcprd01.prod.exchangelabs.com>
Message-ID: <50695233.5070604@oncfs.gouv.fr>

Dear Leila

I already replied to your question on Animov [1]. Please avoid 
cross-posting and continue there if any additional help is required. You 
may want to read the R posting guide [2], too.

Cl?ment.

[1] http://lists.faunalia.it/pipermail/animov/2012-October/000867.html

[2] http://www.r-project.org/posting-guide.html


On 10/01/2012 06:56 AM, Leila Brook wrote:
>
> Hi all,
>
> Sorry for cross-postings, I'm not sure which group is most appropriate.
>
> I am trying to use adehabitat to calculate home ranges for a couple of 
> sympatric species, using both classical kernel and Biased Random 
> Bridge techniques. I want to use the plug-in method to calculate the 
> bandwidth, as href is not suitable, and LSCV won't work with my 
> high-frequency data.
>
> My question is:
>
> Is there a way to use a bandwidth matrix to calculate a kernel in 
> adehabitat?
>
> So far I've been calculating kernels using GME. However, I want to 
> calculate kernel overlap in adehabitat so I'd like to find a way to 
> include a plug-in bandwidth kernel in adehabitat if possible.
>
> If anyone has any suggestions for either importing a GME-calculated 
> kernel file into adehabitat in a way that allows its conversion into 
> an estud class file, or using a bandwidth matrix for kernel 
> calculation in adehabitat, I would really appreciate it.
>
> Thanks for your help,
>
> Leila Brook
>


-- 
Cl?ment CALENGE
Cellule d'appui ? l'analyse de donn?es
Direction des Etudes et de la Recherche
Office national de la chasse et de la faune sauvage
Saint Benoist - 78610 Auffargis
tel. (33) 01.30.46.54.14


From clement.calenge at oncfs.gouv.fr  Mon Oct  1 10:21:32 2012
From: clement.calenge at oncfs.gouv.fr (Clement Calenge)
Date: Mon, 1 Oct 2012 10:21:32 +0200
Subject: [R-sig-Geo] [AniMov] Calculating spatial overlap using
 kerneloverlap() in adehabitat
In-Reply-To: <9BEE83C6BF59174DBD2CB4A06EB6CBEB2FE05207@SINPRD0111MB368.apcprd01.prod.exchangelabs.com>
References: <9BEE83C6BF59174DBD2CB4A06EB6CBEB2FE05207@SINPRD0111MB368.apcprd01.prod.exchangelabs.com>
Message-ID: <5069528C.4060807@oncfs.gouv.fr>

Dear Leila

I already replied to your question on Animov [1]. Please avoid 
cross-posting and continue there if any additional help is required. You 
may want to read the R posting guide [2], too.

Cl?ment.

[1] http://lists.faunalia.it/pipermail/animov/2012-October/000868.html

[2] http://www.r-project.org/posting-guide.html


On 10/01/2012 07:03 AM, Leila Brook wrote:
>
> Hi,
>
> Sorry again for cross-postings...
>
> I have a couple of further questions on calculating spatial overlap in 
> adehabitat. I apologise if these questions are pretty evident - I'm 
> still learning the ropes. I want to calculate home range overlap for 
> both classical kernel density home ranges, and also for biased random 
> bridge home range estimates.
>
> I am trying to use the kerneloverlap() function, but have a couple of 
> issues:
>
> Does anyone know of a way to combine different estUD files into an 
> estUDm for this function?
>
> I've calculated the BRB kernels with different parameters (for 
> different species), so I'd like to calculate individual-specific 
> kernels prior to calculating overlap.
>
> Secondly, when I do get estimates of UDOI overlap, they appear a bit 
> strange, given the home range contours. I am getting some huge 
> estimates (>10 for some animals with 95% contours that don't touch) 
> and quite low estimates (~0.1) for situations where a HR is completely 
> inside another. Does anyone have any suggestions or references that 
> can point me in the right direction on this one?
>
> Thanks,
> Leila Brook
>


-- 
Cl?ment CALENGE
Cellule d'appui ? l'analyse de donn?es
Direction des Etudes et de la Recherche
Office national de la chasse et de la faune sauvage
Saint Benoist - 78610 Auffargis
tel. (33) 01.30.46.54.14


From annafreni at yahoo.it  Mon Oct  1 11:22:02 2012
From: annafreni at yahoo.it (anna freni sterrantino)
Date: Mon, 1 Oct 2012 10:22:02 +0100 (BST)
Subject: [R-sig-Geo] 3d boxplot for spatial coordinates points
Message-ID: <1349083322.90645.YahooMailNeo@web29304.mail.ird.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121001/06aed116/attachment.pl>

From Roger.Bivand at nhh.no  Mon Oct  1 11:27:08 2012
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 1 Oct 2012 11:27:08 +0200 (CEST)
Subject: [R-sig-Geo] Dividing World Map
In-Reply-To: <5069502A.4@idi.ntnu.no>
References: <07ad2fbd7ae1470fa2da4084ee58204b@EX-1-HT0.lancs.local>
	<CANVKczM6Bms3K6N_3Kn2MEvU=b+0GyroczTY4GhH4p1xf1N-Rw@mail.gmail.com>
	<5069502A.4@idi.ntnu.no>
Message-ID: <alpine.LRH.2.02.1210011123510.9139@reclus.nhh.no>

On Mon, 1 Oct 2012, Massimiliano Ruocco wrote:

> Thanks for the answer
> Yes, should be fine for me. I don't need polar areas. So shoud be fine to go 
> from -80 to 80 for lat.
> So an approximative idea to proceed could be the following:
>
> 1) scan all the UTM zone
> 2) divide the utm zone in quad of 10kmX10km
>
> Just a question...i am not sure i really understand the UTM coord. Is each 
> zone a 500kmX500km quad?

Maybe drop in on Jan Ketil R?d:

http://www.svt.ntnu.no/geo/jan.rod/

as you seem to need local help. He also wrote a good introductory book to 
these subjects:

Verkt?y for ? beskrive verden. Statistikk, kart og bilder.

if you read Norwegian.

Roger

>
> THanks again
>
>
>
> On 10/01/2012 10:05 AM, Barry Rowlingson wrote:
>> On Mon, Oct 1, 2012 at 8:09 AM, Massimiliano Ruocco <ruocco at idi.ntnu.no> 
>> wrote:
>>> Dear all,
>>> i would like to divide the world map in grid of equal dimension (example
>>> quad of 10kmx10km). Is it correct to use the UTM coord instead of
>>> lat/lon ones? Is there any drawback on doing that?
>>> 
>>> IS there any existing routine doing it?
>>   Since we figured out that the earth isn't flat we've known its
>> impossible. You can't divide a sphere into a grid like that - what are
>> you going to do at the poles?
>>
>>   You can project small parts to coordinates such as UTM and divide
>> into a regular square grid in those coordinates, but even those aren't
>> perfect, and get less perfect nearer the poles, at which point they
>> are completely wrong...
>> 
>> I think UTM zones typically have a max latitude they should be used
>> at, so as long as you don't care about polar bears and penguins you
>> should be okay...
>> 
>> Barry
>
>
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From lukaslehnert at googlemail.com  Mon Oct  1 11:58:48 2012
From: lukaslehnert at googlemail.com (Lukas Lehnert)
Date: Mon, 01 Oct 2012 11:58:48 +0200
Subject: [R-sig-Geo] Dividing World Map
In-Reply-To: <5069502A.4@idi.ntnu.no>
References: <07ad2fbd7ae1470fa2da4084ee58204b@EX-1-HT0.lancs.local>
	<CANVKczM6Bms3K6N_3Kn2MEvU=b+0GyroczTY4GhH4p1xf1N-Rw@mail.gmail.com>
	<5069502A.4@idi.ntnu.no>
Message-ID: <1649029.PrY46mZHtr@kobold>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121001/7d679f7f/attachment.pl>

From mathieu.rajerison at gmail.com  Mon Oct  1 14:00:41 2012
From: mathieu.rajerison at gmail.com (Mathieu Rajerison)
Date: Mon, 1 Oct 2012 14:00:41 +0200
Subject: [R-sig-Geo] Problem aggregating municipalities
In-Reply-To: <CAKMbqgBa1A1Qumc+p3R-Uxcvw4h+VdMfEcXS+6T7OE1qwZGuFQ@mail.gmail.com>
References: <CAKMbqgBa1A1Qumc+p3R-Uxcvw4h+VdMfEcXS+6T7OE1qwZGuFQ@mail.gmail.com>
Message-ID: <CAGfc75=H2N8GkCSdY6y6+Xff6eCy8RzdjOOQH+dQw1wA03RWzw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121001/0db47f18/attachment.pl>

From Roger.Bivand at nhh.no  Mon Oct  1 14:16:01 2012
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 1 Oct 2012 14:16:01 +0200 (CEST)
Subject: [R-sig-Geo] Problem aggregating municipalities
In-Reply-To: <CAGfc75=H2N8GkCSdY6y6+Xff6eCy8RzdjOOQH+dQw1wA03RWzw@mail.gmail.com>
References: <CAKMbqgBa1A1Qumc+p3R-Uxcvw4h+VdMfEcXS+6T7OE1qwZGuFQ@mail.gmail.com>
	<CAGfc75=H2N8GkCSdY6y6+Xff6eCy8RzdjOOQH+dQw1wA03RWzw@mail.gmail.com>
Message-ID: <alpine.LRH.2.02.1210011406050.9139@reclus.nhh.no>

On Mon, 1 Oct 2012, Mathieu Rajerison wrote:

> Hi,
>
> Maybe you could ckeck, first, which geometries are not valid, using
> gIsValid and using par. byid=TRUE
> v <- gIsValid(vM.spdf, byid=TRUE)
>
> Then, you could fix the topology problems.
>

I'm afraid that this is a case in which the individual geometries may be 
valid, but that they overlap - see the recent thread:

https://stat.ethz.ch/pipermail/r-sig-geo/2012-September/016134.html

In that case Mao-Gui Hu attached a small data excerpt which helped in 
analysis of the problem, perhaps you could do the same? If the excerpt is 
larger than 20Kb, please put it on a website, to avoid distributing it to 
all of the list's subscribers needlessly. Downloading the full 40Mb you 
reference is too large anyway. You could try to identify offending 
geometries using gOverlaps().

Roger

>
> 2012/9/30 Brigitte Hogan <brigittehogan at gmail.com>
>
>> I am having a problem with unionSpatialPolygons() in
>> library(maptools). I am working with a shapefile of Mexico
>> municipalities found here:
>> http://mapserver.inegi.org.mx/data/mgm/
>> under Marco Geoestad?stico Municipal 2009 Versi?n 4.1,  ?reas
>> Geoestad?sticas Municipales (38.8 Mb).
>>
>> I need to combine the "Federal District" municipalities into one
>> polygon. I am a new user of the sp and rgeos packages, running R
>> version 2.13 under Windows 7. When I try to combine the districts, I
>> get an error similar to one in the archive:
>> https://stat.ethz.ch/pipermail/r-sig-geo/2011-August/012445.html
>>
>> I tried to run checkPolygonsHoles() as suggested, but I cannot figure
>> out how to convert the SpatialPolygonsDataFrame or SpatialPolygons
>> object into a Polygons object.  The solution to the error in the
>> archive was to reset the significant digits. However, when I tried, I
>> still ended up with the same error message. An excerpt from my code is
>> below.
>>
>>
>> ## Original Code
>> library(maptools)
>> library(rgdal)
>> library(rgeos)
>> file3 <- "C:/Desktop/MUNICIPIOS"
>> vM.spdf <- readShapePoly(file3, IDvar=NULL)
>> class(vM.spdf)
>>                # SpatialPolygonsDataFrame
>> vM.spdf at data[which(vM.spdf at data$CVE_ENT=="09"),]
>> v.id <- vM.spdf at data$CVE_ENT=="09"                               # IDs
>> which rows to merge
>> newM <- unionSpatialPolygons(vM.sp, IDs=v.id)                  # merge
>>
>> # Returns the error:
>> # Error in TopologyFunc(groupID(spgeom[ids[[i]]], id[ids[[i]]]),
>> names(ids)[i],  :
>> # TopologyException: found non-noded intersection between LINESTRING
>> (3.47895e+006 551354,
>> # 3.479e+006 551323) and LINESTRING (3.479e+006 551323, 3.479e+006
>> 551364) at 3.479e+006 551323
>>
>> ## Trying checkPolygonsHoles()
>> checkPolygonsHoles(vM.spdf)                                        #
>> Error ... not a Polygons object
>> vM.sp <- SpatialPolygons(vM.spdf at polygons, vM.spdf at plotOrder,
>> proj4string=vM.spdf at proj4string)
>> vM.p   <- Polygons(vM.sp)
>> # Error in as.list.default(X) : no method for coercing this S4 class
>> to a vector
>> vM.p  <- Polygons(list(vM.sp))
>> vM.p <- Polygons(vM.sp at polygons)                             # Error
>> in Polygons(list(vM.sp)) : srl not a list of Polygon objects
>>
>> ## Trying to reset sig difs
>> getScale()
>>                   # returns '1e+08'
>> setScale(1e+09)
>> newM <- unionSpatialPolygons(vM.sp, IDs=v.id)                  # same
>> error
>>
>>
>>
>> Thanks for any help you can give me.
>>
>> Brigitte
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> 	[[alternative HTML version deleted]]
>
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From lars.dalby at gmail.com  Mon Oct  1 14:58:59 2012
From: lars.dalby at gmail.com (Lars Dalby)
Date: Mon, 1 Oct 2012 08:58:59 -0400
Subject: [R-sig-Geo] execGRASS and v.mkgrid gives "Parameter <coor> does not
	have float value"
Message-ID: <FDE0CA17-3278-42B9-A0AA-8B047761AE78@gmail.com>

Hi 

I have tried to post this via Nabble, but apparently that did not work. So I try here again. I apologise in case this leads to double posting.

I have been trying to expand a vector grid using the v.mkgrid command in GRASS via the execGRASS function in spgrass6. I have passed several other commands via execGRASS and it has worked perfectly. However when using the v.mkgrid function I get an error. 

I work in a location with a Behrman projection which is a cylindrical equal area projection with units in meters. 

I call: 
execGRASS('v.mkgrid', parameters = list(map = 'VectorGrid', position = 'coor', coor = '-6358820,-17367529', grid = '142,360', box = '96486.28169014, 96486.28055556')) 

and get this error message: 
Error in doGRASS(cmd, flags = flags, ..., parameters = parameters, echoCmd = echoCmd) : 
  Parameter <coor> does not have float value 

With great help from Micha at the GRASS-user list we tried to figure this out and found an old bug report, that seems to be somewhat related: http://trac.osgeo.org/grass/ticket/739
However the workaround suggested here does not really do the trick. 

The thread I started on the GRASS-user list is here: http://osgeo-org.1560.n6.nabble.com/Rasterize-polygons-multiple-polygons-per-grid-cell-td5005264.html

A reproducible example and my session info is below. 
Any hints to a workaround to this problem would be highly appreciated. 

Thanks 
-Lars 

require(spgrass6) 
# Replace the path with the path to the GRASS binaries on your system 
loc <- initGRASS('/Applications/GRASS/GRASS-7.0.app/Contents/MacOS', home=tempdir(), override = TRUE) 
execGRASS('v.mkgrid', parameters = list(map = 'VectorGrid', position = 'coor', coor = '-6358820,-17367529', grid = '142,360', box = '96486.28169014, 96486.28055556')) 
# Error in doGRASS(cmd, flags = flags, ..., parameters = parameters, echoCmd = echoCmd) : 
#   Parameter <coor> does not have float value 
unlink_.gislock() 

# sessionInfo(): 
#   R version 2.15.1 (2012-06-22) 
# Platform: x86_64-apple-darwin9.8.0/x86_64 (64-bit) 
# 
# locale: 
# [1] C/en_US.UTF-8/C/C/C/C 
# 
# attached base packages: 
# [1] stats     graphics  grDevices utils     datasets  methods   
# [7] base     
# 
# other attached packages: 
# [1] raster_2.0-12   spgrass6_0.7-10 XML_3.9-4       
# [4] sp_0.9-99       
# 
# loaded via a namespace (and not attached): 
# [1] grid_2.15.1     lattice_0.20-10 tools_2.15.1  



Lars Dalby, Msc., PhD student
E: lada at dmu.dk | T: +45 871 59013
Department of Bioscience, Aarhus University
Gren?vej 14, 8410 R?nde, Denmark

From Roger.Bivand at nhh.no  Mon Oct  1 15:29:47 2012
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 1 Oct 2012 15:29:47 +0200 (CEST)
Subject: [R-sig-Geo] execGRASS and v.mkgrid gives "Parameter <coor> does
 not	have float value"
In-Reply-To: <FDE0CA17-3278-42B9-A0AA-8B047761AE78@gmail.com>
References: <FDE0CA17-3278-42B9-A0AA-8B047761AE78@gmail.com>
Message-ID: <alpine.LRH.2.02.1210011520300.9139@reclus.nhh.no>

On Mon, 1 Oct 2012, Lars Dalby wrote:

> Hi
>
> I have tried to post this via Nabble, but apparently that did not work. 
> So I try here again. I apologise in case this leads to double posting.
>
> I have been trying to expand a vector grid using the v.mkgrid command in 
> GRASS via the execGRASS function in spgrass6. I have passed several 
> other commands via execGRASS and it has worked perfectly. However when 
> using the v.mkgrid function I get an error.
>
> I work in a location with a Behrman projection which is a cylindrical 
> equal area projection with units in meters.
>
> I call: execGRASS('v.mkgrid', parameters = list(map = 'VectorGrid', 
> position = 'coor', coor = '-6358820,-17367529', grid = '142,360', box = 
> '96486.28169014, 96486.28055556'))
>
> and get this error message:
> Error in doGRASS(cmd, flags = flags, ..., parameters = parameters, 
> echoCmd = echoCmd) :
>  Parameter <coor> does not have float value
>
> With great help from Micha at the GRASS-user list we tried to figure 
> this out and found an old bug report, that seems to be somewhat related: 
> http://trac.osgeo.org/grass/ticket/739 However the workaround suggested 
> here does not really do the trick.

No, it was three years ago.

>
> The thread I started on the GRASS-user list is here: 
> http://osgeo-org.1560.n6.nabble.com/Rasterize-polygons-multiple-polygons-per-grid-cell-td5005264.html
>
> A reproducible example and my session info is below.
> Any hints to a workaround to this problem would be highly appreciated.
>
> Thanks
> -Lars
>
> require(spgrass6)
> # Replace the path with the path to the GRASS binaries on your system
> loc <- initGRASS('/Applications/GRASS/GRASS-7.0.app/Contents/MacOS', home=tempdir(), override = TRUE)
> execGRASS('v.mkgrid', parameters = list(map = 'VectorGrid', position = 'coor', coor = '-6358820,-17367529', grid = '142,360', box = '96486.28169014, 96486.28055556'))
> # Error in doGRASS(cmd, flags = flags, ..., parameters = parameters, echoCmd = echoCmd) :
> #   Parameter <coor> does not have float value
> unlink_.gislock()
>

This works:

execGRASS('v.mkgrid', parameters = list(map = 'VectorGrid', position = 
'coor', coor = c(-6358820,-17367529), grid = c(142L,360L), box = 
c(96486.28169014, 96486.28055556)))

Note that all the parameters must be of required type, which can be 
checked with parseGRASS('v.mkgrid'), so a float vector needs c(), and 
integer values need appended L. The logic in doGRASS() now sorts out the 
oddities in the interface description of this module.

The grass-stats list may be the most appropriate for this.

Hope this clarifies,

Roger


> # sessionInfo():
> #   R version 2.15.1 (2012-06-22)
> # Platform: x86_64-apple-darwin9.8.0/x86_64 (64-bit)
> #
> # locale:
> # [1] C/en_US.UTF-8/C/C/C/C
> #
> # attached base packages:
> # [1] stats     graphics  grDevices utils     datasets  methods
> # [7] base
> #
> # other attached packages:
> # [1] raster_2.0-12   spgrass6_0.7-10 XML_3.9-4
> # [4] sp_0.9-99
> #
> # loaded via a namespace (and not attached):
> # [1] grid_2.15.1     lattice_0.20-10 tools_2.15.1
>
>
>
> Lars Dalby, Msc., PhD student
> E: lada at dmu.dk | T: +45 871 59013
> Department of Bioscience, Aarhus University
> Gren?vej 14, 8410 R?nde, Denmark
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From macqueen1 at llnl.gov  Mon Oct  1 18:14:05 2012
From: macqueen1 at llnl.gov (MacQueen, Don)
Date: Mon, 1 Oct 2012 16:14:05 +0000
Subject: [R-sig-Geo] Apparent rotation when plotting a SpatialGridDataFrame?
Message-ID: <CC8F0F5B.AD382%macqueen1@llnl.gov>


I have simple data coming to me from an outside source.
x,y are coordinates in a UTM projection, and z is a
measured value at each location.

I make a SpatialPointsDataFrame from it, plot it with spplot(),
and it appears as expected.

I convert to a SpatialGridDataFrame, plot using spplot(),
it appears to have been rotated 90 degrees.

See example code to illustrate below.

Am I doing something wrong?


I used the same sequence of conversions about 7 months ago on
a different set of data and did not see this problem. Inspecting
the two versions of the data does not suggest a problem with
the conversion process. The bounding box is consistent before
and after the conversion.

Here is a simple example to illustrate, followed by sessionInfo()
It should be possible to just source the example code into an
R session.

##
## simple example to illustrate the question
##
require(sp)

## example data
tstdf <- expand.grid(x=1:3, y=1:3)
tstdf$z <- 5
tstdf$z[tstdf$x==tstdf$y] <- 10

## move points to somewhere actually in the zone
tstdf$x <- tstdf$x +  608000
tstdf$y <- tstdf$y + 4167900

## convert to spatial points data frame; UTM projection
tstsp <- tstdf
coordinates(tstsp) <- c('x','y')
proj4string(tstsp) <- CRS('+init=epsg:32610')
print(bbox(tstsp))

## plot
tmppl1 <- spplot(tstsp)
print(tmppl1)


## convert to spatial grid
tstgr <- points2grid(tstsp)
tstsgr <- SpatialGrid(tstgr,
             proj4string=CRS('+init=epsg:32610'))
print(bbox(tstsgr))
tstsgrd <- SpatialGridDataFrame(tstgr,
                data=tstsp at data,
                proj4string=CRS('+init=epsg:32610'))
print(bbox(tstsgrd))

## plot -- compare with first plot
tmppl2 <- spplot(tstsgrd)
print(tmppl2)

##
## sessionInfo()
##
R version 2.15.1 (2012-06-22)
Platform: x86_64-apple-darwin9.8.0/x86_64 (64-bit)

locale:
[1] C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] sp_1.0-0

loaded via a namespace (and not attached):
[1] grid_2.15.1    lattice_0.20-6


-------------------------------
By the way, the reason for converting to a spatial grid is
so that I can then convert it to a SpatialPolygonsDataFrame,
spTransform() to long/lat and export to KML,
then display in GoogleEarth with a raster-like appearance.


There are no doubt other and likely better ways to accomplish
the same end goal, a raster-like display in GoogleEarth,
but this is a way I found.
--------------------------------

-- 
Don MacQueen

Lawrence Livermore National Laboratory
7000 East Ave., L-627
Livermore, CA 94550
925-423-1062


From r.hijmans at gmail.com  Mon Oct  1 19:18:53 2012
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Mon, 1 Oct 2012 10:18:53 -0700
Subject: [R-sig-Geo] Dividing World Map
In-Reply-To: <CANVKczM6Bms3K6N_3Kn2MEvU=b+0GyroczTY4GhH4p1xf1N-Rw@mail.gmail.com>
References: <07ad2fbd7ae1470fa2da4084ee58204b@EX-1-HT0.lancs.local>
	<CANVKczM6Bms3K6N_3Kn2MEvU=b+0GyroczTY4GhH4p1xf1N-Rw@mail.gmail.com>
Message-ID: <CANtt_hwoXYZE4GY_Rtt6YOSX7SRXqCnnt7=fCakwVpgpUe+KaA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121001/53a4aa8f/attachment.pl>

From r.hijmans at gmail.com  Mon Oct  1 19:20:23 2012
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Mon, 1 Oct 2012 10:20:23 -0700
Subject: [R-sig-Geo] Dividing World Map
In-Reply-To: <CANtt_hwoXYZE4GY_Rtt6YOSX7SRXqCnnt7=fCakwVpgpUe+KaA@mail.gmail.com>
References: <07ad2fbd7ae1470fa2da4084ee58204b@EX-1-HT0.lancs.local>
	<CANVKczM6Bms3K6N_3Kn2MEvU=b+0GyroczTY4GhH4p1xf1N-Rw@mail.gmail.com>
	<CANtt_hwoXYZE4GY_Rtt6YOSX7SRXqCnnt7=fCakwVpgpUe+KaA@mail.gmail.com>
Message-ID: <CANtt_hy+0jYXT_wBdBtwgEFNCbMvZ+QLJsM62B9XOvfTdJ664g@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121001/f4481f16/attachment.pl>

From ruocco at idi.ntnu.no  Mon Oct  1 20:33:45 2012
From: ruocco at idi.ntnu.no (Massimiliano)
Date: Mon, 1 Oct 2012 20:33:45 +0200
Subject: [R-sig-Geo] Dividing World Map
In-Reply-To: <CANtt_hy+0jYXT_wBdBtwgEFNCbMvZ+QLJsM62B9XOvfTdJ664g@mail.gmail.com>
References: <07ad2fbd7ae1470fa2da4084ee58204b@EX-1-HT0.lancs.local>
	<CANVKczM6Bms3K6N_3Kn2MEvU=b+0GyroczTY4GhH4p1xf1N-Rw@mail.gmail.com>
	<CANtt_hwoXYZE4GY_Rtt6YOSX7SRXqCnnt7=fCakwVpgpUe+KaA@mail.gmail.com>
	<CANtt_hy+0jYXT_wBdBtwgEFNCbMvZ+QLJsM62B9XOvfTdJ664g@mail.gmail.com>
Message-ID: <C908D12C-3D85-4BDA-B076-82D4C574F34E@idi.ntnu.no>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121001/2b929ce5/attachment.pl>

From Roger.Bivand at nhh.no  Mon Oct  1 20:45:17 2012
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 1 Oct 2012 20:45:17 +0200 (CEST)
Subject: [R-sig-Geo] Apparent rotation when plotting a
 SpatialGridDataFrame?
In-Reply-To: <CC8F0F5B.AD382%macqueen1@llnl.gov>
References: <CC8F0F5B.AD382%macqueen1@llnl.gov>
Message-ID: <alpine.LRH.2.02.1210012034520.16383@reclus.nhh.no>

On Mon, 1 Oct 2012, MacQueen, Don wrote:

>
> I have simple data coming to me from an outside source.
> x,y are coordinates in a UTM projection, and z is a
> measured value at each location.
>
> I make a SpatialPointsDataFrame from it, plot it with spplot(),
> and it appears as expected.
>
> I convert to a SpatialGridDataFrame, plot using spplot(),
> it appears to have been rotated 90 degrees.
>
> See example code to illustrate below.
>
> Am I doing something wrong?
>

No, this is a consequence of code cleanup, revision 1140 in R-forge SVN:

https://r-forge.r-project.org/scm/viewvc.php/pkg/sp/R/Class-SpatialGrid.R?root=rspatial&r1=1140&r2=1204

removing "coords" and "grid.index" slots from the definition of 
the SpatialGrid class. This split SpatialPixels and SpatialGrid cleanly, 
but meant that you can't smuggle the data slot across unpunished. This 
works:

slot(tstsp, "data")$z
tstpxdf <- as(tstsp, "SpatialPixelsDataFrame")
slot(tstpxdf, "data")$z
tstgrdf <- as(tstpxdf, "SpatialGridDataFrame")
slot(tstgrdf, "data")$z # showing the re-ordering
tmppl4 <- spplot(tstgrdf)
print(tmppl4)


Hope this helps,

Roger

>
> I used the same sequence of conversions about 7 months ago on
> a different set of data and did not see this problem. Inspecting
> the two versions of the data does not suggest a problem with
> the conversion process. The bounding box is consistent before
> and after the conversion.
>
> Here is a simple example to illustrate, followed by sessionInfo()
> It should be possible to just source the example code into an
> R session.
>
> ##
> ## simple example to illustrate the question
> ##
> require(sp)
>
> ## example data
> tstdf <- expand.grid(x=1:3, y=1:3)
> tstdf$z <- 5
> tstdf$z[tstdf$x==tstdf$y] <- 10
>
> ## move points to somewhere actually in the zone
> tstdf$x <- tstdf$x +  608000
> tstdf$y <- tstdf$y + 4167900
>
> ## convert to spatial points data frame; UTM projection
> tstsp <- tstdf
> coordinates(tstsp) <- c('x','y')
> proj4string(tstsp) <- CRS('+init=epsg:32610')
> print(bbox(tstsp))
>
> ## plot
> tmppl1 <- spplot(tstsp)
> print(tmppl1)
>
>
> ## convert to spatial grid
> tstgr <- points2grid(tstsp)
> tstsgr <- SpatialGrid(tstgr,
>             proj4string=CRS('+init=epsg:32610'))
> print(bbox(tstsgr))
> tstsgrd <- SpatialGridDataFrame(tstgr,
>                data=tstsp at data,
>                proj4string=CRS('+init=epsg:32610'))
> print(bbox(tstsgrd))
>
> ## plot -- compare with first plot
> tmppl2 <- spplot(tstsgrd)
> print(tmppl2)
>
> ##
> ## sessionInfo()
> ##
> R version 2.15.1 (2012-06-22)
> Platform: x86_64-apple-darwin9.8.0/x86_64 (64-bit)
>
> locale:
> [1] C
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> other attached packages:
> [1] sp_1.0-0
>
> loaded via a namespace (and not attached):
> [1] grid_2.15.1    lattice_0.20-6
>
>
> -------------------------------
> By the way, the reason for converting to a spatial grid is
> so that I can then convert it to a SpatialPolygonsDataFrame,
> spTransform() to long/lat and export to KML,
> then display in GoogleEarth with a raster-like appearance.
>
>
> There are no doubt other and likely better ways to accomplish
> the same end goal, a raster-like display in GoogleEarth,
> but this is a way I found.
> --------------------------------
>
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From r.hijmans at gmail.com  Mon Oct  1 21:19:31 2012
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Mon, 1 Oct 2012 12:19:31 -0700
Subject: [R-sig-Geo] Apparent rotation when plotting a
	SpatialGridDataFrame?
In-Reply-To: <CC8F0F5B.AD382%macqueen1@llnl.gov>
References: <CC8F0F5B.AD382%macqueen1@llnl.gov>
Message-ID: <CANtt_hz9hdun3+z+AYROs34cxu-r5Cz4vtsTrfN3rfMTvvdosg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121001/4790f615/attachment.pl>

From macqueen1 at llnl.gov  Mon Oct  1 21:22:31 2012
From: macqueen1 at llnl.gov (MacQueen, Don)
Date: Mon, 1 Oct 2012 19:22:31 +0000
Subject: [R-sig-Geo] Apparent rotation when plotting a
 SpatialGridDataFrame?
In-Reply-To: <alpine.LRH.2.02.1210012034520.16383@reclus.nhh.no>
Message-ID: <CC8F3A5E.AD3EA%macqueen1@llnl.gov>

Thank you, Roger.

I see that in essence I separated my coords from my data,
in effect re-ordered the coords by making a grid topology,
and then rejoined the coords with the data in the original
order.

-Don

-- 
Don MacQueen

Lawrence Livermore National Laboratory
7000 East Ave., L-627
Livermore, CA 94550
925-423-1062





On 10/1/12 11:45 AM, "Roger Bivand" <Roger.Bivand at nhh.no> wrote:

>On Mon, 1 Oct 2012, MacQueen, Don wrote:
>
>>
>> I have simple data coming to me from an outside source.
>> x,y are coordinates in a UTM projection, and z is a
>> measured value at each location.
>>
>> I make a SpatialPointsDataFrame from it, plot it with spplot(),
>> and it appears as expected.
>>
>> I convert to a SpatialGridDataFrame, plot using spplot(),
>> it appears to have been rotated 90 degrees.
>>
>> See example code to illustrate below.
>>
>> Am I doing something wrong?
>>
>
>No, this is a consequence of code cleanup, revision 1140 in R-forge SVN:
>
>https://r-forge.r-project.org/scm/viewvc.php/pkg/sp/R/Class-SpatialGrid.R?
>root=rspatial&r1=1140&r2=1204
>
>removing "coords" and "grid.index" slots from the definition of
>the SpatialGrid class. This split SpatialPixels and SpatialGrid cleanly,
>but meant that you can't smuggle the data slot across unpunished. This
>works:
>
>slot(tstsp, "data")$z
>tstpxdf <- as(tstsp, "SpatialPixelsDataFrame")
>slot(tstpxdf, "data")$z
>tstgrdf <- as(tstpxdf, "SpatialGridDataFrame")
>slot(tstgrdf, "data")$z # showing the re-ordering
>tmppl4 <- spplot(tstgrdf)
>print(tmppl4)
>
>
>Hope this helps,
>
>Roger
>
>>
>> I used the same sequence of conversions about 7 months ago on
>> a different set of data and did not see this problem. Inspecting
>> the two versions of the data does not suggest a problem with
>> the conversion process. The bounding box is consistent before
>> and after the conversion.
>>
>> Here is a simple example to illustrate, followed by sessionInfo()
>> It should be possible to just source the example code into an
>> R session.
>>
>> ##
>> ## simple example to illustrate the question
>> ##
>> require(sp)
>>
>> ## example data
>> tstdf <- expand.grid(x=1:3, y=1:3)
>> tstdf$z <- 5
>> tstdf$z[tstdf$x==tstdf$y] <- 10
>>
>> ## move points to somewhere actually in the zone
>> tstdf$x <- tstdf$x +  608000
>> tstdf$y <- tstdf$y + 4167900
>>
>> ## convert to spatial points data frame; UTM projection
>> tstsp <- tstdf
>> coordinates(tstsp) <- c('x','y')
>> proj4string(tstsp) <- CRS('+init=epsg:32610')
>> print(bbox(tstsp))
>>
>> ## plot
>> tmppl1 <- spplot(tstsp)
>> print(tmppl1)
>>
>>
>> ## convert to spatial grid
>> tstgr <- points2grid(tstsp)
>> tstsgr <- SpatialGrid(tstgr,
>>             proj4string=CRS('+init=epsg:32610'))
>> print(bbox(tstsgr))
>> tstsgrd <- SpatialGridDataFrame(tstgr,
>>                data=tstsp at data,
>>                proj4string=CRS('+init=epsg:32610'))
>> print(bbox(tstsgrd))
>>
>> ## plot -- compare with first plot
>> tmppl2 <- spplot(tstsgrd)
>> print(tmppl2)
>>
>> ##
>> ## sessionInfo()
>> ##
>> R version 2.15.1 (2012-06-22)
>> Platform: x86_64-apple-darwin9.8.0/x86_64 (64-bit)
>>
>> locale:
>> [1] C
>>
>> attached base packages:
>> [1] stats     graphics  grDevices utils     datasets  methods   base
>>
>> other attached packages:
>> [1] sp_1.0-0
>>
>> loaded via a namespace (and not attached):
>> [1] grid_2.15.1    lattice_0.20-6
>>
>>
>> -------------------------------
>> By the way, the reason for converting to a spatial grid is
>> so that I can then convert it to a SpatialPolygonsDataFrame,
>> spTransform() to long/lat and export to KML,
>> then display in GoogleEarth with a raster-like appearance.
>>
>>
>> There are no doubt other and likely better ways to accomplish
>> the same end goal, a raster-like display in GoogleEarth,
>> but this is a way I found.
>> --------------------------------
>>
>>
>
>-- 
>Roger Bivand
>Department of Economics, NHH Norwegian School of Economics,
>Helleveien 30, N-5045 Bergen, Norway.
>voice: +47 55 95 93 55; fax +47 55 95 95 43
>e-mail: Roger.Bivand at nhh.no
>


From kupdegra at d.umn.edu  Mon Oct  1 21:59:14 2012
From: kupdegra at d.umn.edu (Karen Updegraff)
Date: Mon, 1 Oct 2012 14:59:14 -0500
Subject: [R-sig-Geo] pois.binom error with count data (geoRglm)
Message-ID: <CAP=uX7aB0spbNyNzy_o-aC20SJC_dTg489NLjp7ABoCyLEgmOg@mail.gmail.com>

When attempting binom.krige() on a set of count data with the following call:

bktune<-binom.krige(geodata=must51_geo,
    mcmc.input=list(S.scale=0.34,n.iter=5000,thin=1),
    krige=plmodel)
#
#I get this output:
"
locations need to be specified for prediction; prediction not performed
Error in chol.default(solve(invcov + diag(fisher.l))) :
  the leading minor of order 53 is not positive definite
"

I have no clue where this error is coming from. Possibly related to
zero-loading?
pois.krige() on the same dataset, with the same model specs, runs
without errors.
Do the model parameters need to be different? Data need to be transformed?
.................
Some inputs:
-----------
plmodel (mostly default settings):
$type.krige [1] "ok"
$beta [1] 1
$cov.model [1] "matern"
$cov.pars [1] 1 1
$kappa [1] 0.5
$lambda [1] 0
attr(,"class") [1] "krige.geoRglm"

The count data:
--------------
must51_geo$data: #no overlapping points
  [1]  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
 [26]  0  0  0  0  0  1  0  0  0  1  0  1  0  0  0  0  0  0  0  0  1  0  0  0  0
 [51]  0  0  4  0  0  0  0  0  0  0  0  0  1  0  0  0  4  0  0  0  0  0  0  0  2
 [76]  1 14  2  0  0  0  0  0  0  0  0  0  0  0  0  4  0  0  0  0  0  0  0  0  0
[101]  0  0  0  0  0  2  1  2  1  0  0  1  0  0  0  0  0  0  0  0  1 32  4  0  1
[126]  1  0  1  0  0  0  0  0  0  0  0  0  0  0  2  3  2  0  0  0  0  0  0  0  0
[151]  0  0  0  1  2  0  1  0  0  0  0  0  0  0  0  0  0  1  0  0  0  5  0  0  0
[176]  0  0  0  0  0  0  0  0  0  0  0  0  0  1  0  0  0  0  0  0  0  0  0  0  0
[201]  0  0  2  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
[226]  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  1  0  0
[251]  0  0  0  0  0  0  0  0  0  0  0  0  0  1  0  0  0  0  0  0  0  0  0  0  0
[276]  0  0  0  0  0  0  0  0  1  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0


Would appreciate any suggestions.
-- 
Karen


From etiennebr at gmail.com  Mon Oct  1 22:03:40 2012
From: etiennebr at gmail.com (Etienne B. Racine)
Date: Mon, 1 Oct 2012 16:03:40 -0400
Subject: [R-sig-Geo] How to create a large raster and write it to disk
In-Reply-To: <CAEZcs9-NuxoZ29wXYeHiyvHXFYK0AAvBtPKVScFu9ApBJ33m+Q@mail.gmail.com>
References: <CALjAYt6NzxNcdPX=UYqVtfnGuLQgmBt656XKh7MtaAoKK1TYKw@mail.gmail.com>
	<CAEZcs9-NuxoZ29wXYeHiyvHXFYK0AAvBtPKVScFu9ApBJ33m+Q@mail.gmail.com>
Message-ID: <CALjAYt7z9ZDzO14-iNF5HbHpa3LgkUVhRSSjNg9ruLn-EU7u-g@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121001/3991c9bb/attachment.pl>

From etiennebr at gmail.com  Mon Oct  1 22:16:04 2012
From: etiennebr at gmail.com (Etienne B. Racine)
Date: Mon, 1 Oct 2012 16:16:04 -0400
Subject: [R-sig-Geo] Weird issue working while trying to process rasters
 in parallel
In-Reply-To: <CA+mSBw4FHYJ2MoWW0NEOFvEA8+KRJ9Y2P0d0WBxcwNwR+2TGLg@mail.gmail.com>
References: <CA+mSBw5UGdJvOX2ULDKuNsmUJ8QxayzcswdOBhrrAzdoY1AuJg@mail.gmail.com>
	<CA+mSBw4FHYJ2MoWW0NEOFvEA8+KRJ9Y2P0d0WBxcwNwR+2TGLg@mail.gmail.com>
Message-ID: <CALjAYt4TDxxWXFaCZfg_R5FPUEBxDD9WpQnBsAMWSnHi6QXT1w@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121001/ebcef715/attachment.pl>

From edzer.pebesma at uni-muenster.de  Mon Oct  1 22:55:01 2012
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Mon, 01 Oct 2012 22:55:01 +0200
Subject: [R-sig-Geo] plotKML and time stamp
In-Reply-To: <BFCE57D0BE7CBB42A581347DE375AF9A115588BE@UFEXCH-MBXN02.ad.ufl.edu>
References: <BFCE57D0BE7CBB42A581347DE375AF9A11558628@UFEXCH-MBXN02.ad.ufl.edu>
	<5068197D.90905@uni-muenster.de>
	<BFCE57D0BE7CBB42A581347DE375AF9A115588BE@UFEXCH-MBXN02.ad.ufl.edu>
Message-ID: <506A0325.2070101@uni-muenster.de>



On 10/01/2012 05:47 PM, Struve,Juliane wrote:
> Edzer,
> 
> Thank you for your help, this works nicely. When xy.sp are the points and tc is the date/time stamp, why is df needed  ? 
> 

You can create an STI object with just the space-time points, leaving
out the df, but plotKML does not (yet) have a method to display STI
objects -- it wants STIDF with attributes. To work around this, you
could try giving the attribute a constant value, if you don't have sth
that varies.

> Regards,
> 
> Juliane 
> 
> 
> -----Original Message-----
> From: r-sig-geo-bounces at r-project.org [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of Edzer Pebesma
> Sent: Sunday, September 30, 2012 6:06 AM
> To: r-sig-geo at r-project.org
> Subject: Re: [R-sig-Geo] plotKML and time stamp
> 
> Juliane, try
> 
> xc = round(runif(10,-1,1)+27.2, 2)
> yc = round(runif(10,-1,1)+-82.5, 2)
> xy = cbind(xc, yc)
> tc = Sys.time() + 3600 * (1:10)
> df = data.frame(z1 = round(5 + rnorm(10), 2), z2 = 20:29)
> 
> library(sp)
> xy.sp = SpatialPoints(xy)
> proj4string(xy.sp) = CRS("+proj=longlat +datum=WGS84")
> 
> library(spacetime)
> ST = STIDF(xy.sp, tc, df)
> 
> library(plotKML)
> plotKML(ST)
> 
> see also
> 
> vignette(spacetime)
> 
> 
> On 09/30/2012 03:39 AM, Struve,Juliane wrote:
>> Dear list,
>>
>> After plotting this toy example on Google Earth I would like to add a date/time stamp to it so that the locations will be shown in sequence using the time slider. I am not quite sure how to approach this, can I add a date/time to my spatial points and then submit it to plotKML ? What format does the date/time stamp have to be in to be plotted on Google Earth ?
>>
>> Many thanks for any suggestions.
>>
>> Regards,
>>
>> Juliane
>>
>>
>> xc = round(runif(10,-1,1)+27.2, 2)
>> yc = round(runif(10,-1,1)+-82.5, 2)
>> xy = cbind(xc, yc)
>> xy.sp = SpatialPoints(xy)
>> df = data.frame(z1 = round(5 + rnorm(10), 2), z2 = 20:29) SP.spdf = 
>> SpatialPointsDataFrame(xy.sp, df)
>> plot(SP.spdf)
>> #add a projection
>> proj4string(SP.spdf) = CRS("+proj=longlat +datum=WGS84") 
>> plotKML(SP.spdf,kmz = FALSE)
>>
>> 	[[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
> 
> --
> Edzer Pebesma
> Institute for Geoinformatics (ifgi), University of M?nster Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251 8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
> http://www.52north.org/geostatistics      e.pebesma at wwu.de
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From aortizbobea at arec.umd.edu  Tue Oct  2 02:25:00 2012
From: aortizbobea at arec.umd.edu (Ariel Ortiz-Bobea)
Date: Mon, 1 Oct 2012 17:25:00 -0700 (PDT)
Subject: [R-sig-Geo] spml, spfeml and tolerance level
Message-ID: <1349137500660-7581089.post@n2.nabble.com>

Hello,

I'm running various non-nested J-tests from various spatial error
fixed-effect models using the spml() function from the splm package. I'm
having trouble running some of these tests because there is collinearity
between regressors in the augmented test regression. I get the usual:

Error in solve.default(crossprod(xco), crossprod(xco, yco)) : 
  system is computationally singular: reciprocal condition number =
6.34679e-28

I'm wondering how can I decrease the tolerance so that I can override this
error. I looked inside the spml function and it calls the spfeml() function
as can be seen in R-forge:
https://r-forge.r-project.org/scm/viewvc.php/pkg/R/spfeml.R?view=markup&root=splm&pathrev=126

There I found that spfeml fixes tol.solve = 1e-10 and thus the tol.solve
parameter is not passed down by  spml() function.

I presume this is the source of singularity error I'm getting and that I
could circumvent this by setting a lower tol.solve.

Could someone suggest a way to do this, and if I'm totally wrong, offer a
clarification and some suggestions?

Thanks a lot in advance.

Ariel



-----
Ariel Ortiz-Bobea
PhD Candidate in Agricultural & Resource Economics
University of Maryland - College Park
--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/spml-spfeml-and-tolerance-level-tp7581089.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From jstruve at ufl.edu  Tue Oct  2 15:01:38 2012
From: jstruve at ufl.edu (Struve,Juliane)
Date: Tue, 2 Oct 2012 13:01:38 +0000
Subject: [R-sig-Geo] plotKML and time stamp
In-Reply-To: <506A0325.2070101@uni-muenster.de>
References: <BFCE57D0BE7CBB42A581347DE375AF9A11558628@UFEXCH-MBXN02.ad.ufl.edu>
	<5068197D.90905@uni-muenster.de>
	<BFCE57D0BE7CBB42A581347DE375AF9A115588BE@UFEXCH-MBXN02.ad.ufl.edu>
	<506A0325.2070101@uni-muenster.de>
Message-ID: <BFCE57D0BE7CBB42A581347DE375AF9A11558A7A@UFEXCH-MBXN02.ad.ufl.edu>

Hello,

The attribute I am interested in is a site number. When I use the site number as attribute data the size of the bubble is proportional to the number, which does not really make sense given that the data are just site numbers. But when I make it a constant I lose the site number information. How can I get a plot that shows all the locations with the same size bubble but displays also the site number information, say like a label ? It seems that the attribute data need to be numeric.

Thank you for your time,

Juliane

-----Original Message-----
From: Edzer Pebesma [mailto:edzer.pebesma at uni-muenster.de] 
Sent: Monday, October 01, 2012 4:55 PM
To: Struve,Juliane; r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] plotKML and time stamp



On 10/01/2012 05:47 PM, Struve,Juliane wrote:
> Edzer,
> 
> Thank you for your help, this works nicely. When xy.sp are the points and tc is the date/time stamp, why is df needed  ? 
> 

You can create an STI object with just the space-time points, leaving out the df, but plotKML does not (yet) have a method to display STI objects -- it wants STIDF with attributes. To work around this, you could try giving the attribute a constant value, if you don't have sth that varies.

> Regards,
> 
> Juliane
> 
> 
> -----Original Message-----
> From: r-sig-geo-bounces at r-project.org 
> [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of Edzer Pebesma
> Sent: Sunday, September 30, 2012 6:06 AM
> To: r-sig-geo at r-project.org
> Subject: Re: [R-sig-Geo] plotKML and time stamp
> 
> Juliane, try
> 
> xc = round(runif(10,-1,1)+27.2, 2)
> yc = round(runif(10,-1,1)+-82.5, 2)
> xy = cbind(xc, yc)
> tc = Sys.time() + 3600 * (1:10)
> df = data.frame(z1 = round(5 + rnorm(10), 2), z2 = 20:29)
> 
> library(sp)
> xy.sp = SpatialPoints(xy)
> proj4string(xy.sp) = CRS("+proj=longlat +datum=WGS84")
> 
> library(spacetime)
> ST = STIDF(xy.sp, tc, df)
> 
> library(plotKML)
> plotKML(ST)
> 
> see also
> 
> vignette(spacetime)
> 
> 
> On 09/30/2012 03:39 AM, Struve,Juliane wrote:
>> Dear list,
>>
>> After plotting this toy example on Google Earth I would like to add a date/time stamp to it so that the locations will be shown in sequence using the time slider. I am not quite sure how to approach this, can I add a date/time to my spatial points and then submit it to plotKML ? What format does the date/time stamp have to be in to be plotted on Google Earth ?
>>
>> Many thanks for any suggestions.
>>
>> Regards,
>>
>> Juliane
>>
>>
>> xc = round(runif(10,-1,1)+27.2, 2)
>> yc = round(runif(10,-1,1)+-82.5, 2)
>> xy = cbind(xc, yc)
>> xy.sp = SpatialPoints(xy)
>> df = data.frame(z1 = round(5 + rnorm(10), 2), z2 = 20:29) SP.spdf = 
>> SpatialPointsDataFrame(xy.sp, df)
>> plot(SP.spdf)
>> #add a projection
>> proj4string(SP.spdf) = CRS("+proj=longlat +datum=WGS84") 
>> plotKML(SP.spdf,kmz = FALSE)
>>
>> 	[[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
> 
> --
> Edzer Pebesma
> Institute for Geoinformatics (ifgi), University of M?nster Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251 8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
> http://www.52north.org/geostatistics      e.pebesma at wwu.de
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

--
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251 8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From hi181904665 at msn.com  Tue Oct  2 15:14:39 2012
From: hi181904665 at msn.com (chenliang wang)
Date: Tue, 2 Oct 2012 21:14:39 +0800
Subject: [R-sig-Geo] patch for pycno
In-Reply-To: <mailman.11.1349172003.26614.r-sig-geo@r-project.org>
References: <mailman.11.1349172003.26614.r-sig-geo@r-project.org>
Message-ID: <BLU0-SMTP14632749518311ECC20CB64F4860@phx.gbl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121002/9ffc4de1/attachment.pl>

From dave.gregovich at alaska.gov  Tue Oct  2 19:25:30 2012
From: dave.gregovich at alaska.gov (Gregovich, Dave P (DFG))
Date: Tue, 02 Oct 2012 17:25:30 +0000
Subject: [R-sig-Geo] projectRaster causes R front end to crash
Message-ID: <174524AB15B8E6478D6F927B2131B09B0856BBFA@SOAJNUEXMB4.soa.alaska.gov>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121002/2fb6eb42/attachment.pl>

From lars.dalby at gmail.com  Tue Oct  2 20:09:04 2012
From: lars.dalby at gmail.com (Lars Dalby)
Date: Tue, 2 Oct 2012 14:09:04 -0400
Subject: [R-sig-Geo] execGRASS and v.mkgrid gives "Parameter <coor> does
	not	have float value"
In-Reply-To: <alpine.LRH.2.02.1210011520300.9139@reclus.nhh.no>
References: <FDE0CA17-3278-42B9-A0AA-8B047761AE78@gmail.com>
	<alpine.LRH.2.02.1210011520300.9139@reclus.nhh.no>
Message-ID: <4BE63A4D-49CF-4B5E-BDF5-45634628EB2E@gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121002/79d605b1/attachment.pl>

From r.hijmans at gmail.com  Tue Oct  2 21:08:27 2012
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Tue, 2 Oct 2012 12:08:27 -0700
Subject: [R-sig-Geo] projectRaster causes R front end to crash
In-Reply-To: <174524AB15B8E6478D6F927B2131B09B0856BBFA@SOAJNUEXMB4.soa.alaska.gov>
References: <174524AB15B8E6478D6F927B2131B09B0856BBFA@SOAJNUEXMB4.soa.alaska.gov>
Message-ID: <CANtt_hxD6P=-S=RRTn+DJnxgo-OfpeanrGTsQ+K=G_atdSZueQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121002/4709b271/attachment.pl>

From vesnikos at gmail.com  Tue Oct  2 21:21:30 2012
From: vesnikos at gmail.com (nikos ves)
Date: Tue, 02 Oct 2012 22:21:30 +0300
Subject: [R-sig-Geo] plotKML tutorials for creating a times series from
	rasters?
Message-ID: <1349205690.7830.5.camel@nikos-desktop>

Hi list,


I was browsing the list and I found out about plotKML. It seems a nice
way to present your data, or do a visual inspection.


I tried to create a timeseries visualization from an environmental index
Im studying at the moment (55 geotiffs ~35 MB each) but I couldn't
figure out how. 

Anyone can give me some pointers on how to proceed? Maybe some notes,
articles that he/she found somewhere and want to share the knowledge? (A
google search didn't turn anything except from the manuals :/)


Thank you all in advance!

Nikos Ves


From Tom_Roche at pobox.com  Tue Oct  2 23:29:13 2012
From: Tom_Roche at pobox.com (Tom Roche)
Date: Tue, 02 Oct 2012 17:29:13 -0400
Subject: [R-sig-Geo] [raster newbie] projectRaster hangs regridding global
 latlong -> CONUS LCC
Message-ID: <87626s1s2e.fsf@pobox.com>


summary: I'm debugging an apparent hang of raster::projectRaster when
projecting the values from an input global lon-lat-gridded emissions
inventory (EI) to an output over the contiguous US (CONUS) gridded
Lambert conformal conic (LCC). I'm new to 'raster' and relatively new
to geomatics and geospatial transforms. I suspect the problem involves
failure to provide either argument='to' or argument='res', but that
raises other questions.

details:

I'm learning package=raster (more questions to follow!) by RTFM,
notably

http://cran.r-project.org/web/packages/raster/raster.pdf
http://cran.r-project.org/web/packages/raster/vignettes/Raster.pdf

and the CLI help, due to a truncation problem

https://stat.ethz.ch/pipermail/r-sig-geo/2012-September/016179.html

I'm working with netCDF. My current input

https://github.com/downloads/TomRoche/ioapi-hack-R/GEIA_N2O_oceanic.nc

is gridded lon-lat @ 1?x1? with global extents:

$ ncdump -h ./GEIA_N2O_oceanic.nc 
> netcdf GEIA_N2O_oceanic {
> dimensions:
>       lon = 360 ;
>       lat = 180 ;
>       time = UNLIMITED ; // (1 currently)
> variables:
>       double lon(lon) ;
>               lon:units = "degrees_east" ;
>               lon:long_name = "longitude" ;
>               lon:comment = "center_of_cell" ;
>       double lat(lat) ;
>               lat:units = "degrees_north" ;
>               lat:long_name = "latitude" ;
>               lat:comment = "center_of_cell" ;
>       double time(time) ;
>               time:units = "year" ;
>               time:long_name = "time" ;
>               time:calendar = "none: emissions attributed to no particular year" ;
>       double emi_n2o(time, lat, lon) ;
>               emi_n2o:units = "ton N2O-N/yr" ;
>               emi_n2o:missing_value = -999. ;
>               emi_n2o:long_name = "N2O emissions" ;
>               emi_n2o:_FillValue = -999.f ;

In order to combine this with other inputs, I need to regrid this to
the "AQMEII North American" domain

https://github.com/TomRoche/cornbeltN2O/wiki/AQMEII-North-American-domain#wiki-EPA 

for which I believe the PROJ.4 string is

+proj=lcc +lat_1=33 +lat_2=45 +lat_0=40 +lon_0=-97 +x_0=-2556 +y_0=-1728

(correct? I'm pretty sure about everything but the easting/northings,
which I'm not sure if I even need.) Note the extents of AQMEII-NA are
over CONUS, not global.

So I tried to do the following, on a cluster on which I don't have root
(i.e., I can't just upgrade stuff myself):

me at it:/project/inf14w/me/regrid_raster $ R
R version 2.14.1 (2011-12-22)
...
> library(raster)
Loading required package: sp
raster 2.0-05 (19-June-2012)
> library(ncdf4)
> in.fp <- './GEIA_N2O_oceanic.nc'
> system(sprintf("ls -alh %s", in.fp))
-rw-r--r-- 1 me mod3 512K Oct  2 15:28 ./GEIA_N2O_oceanic.nc
> in.raster <- raster(in.fp, varname='emi_n2o', band=3)
Loading required package: ncdf
> in.raster
class       : RasterLayer 
dimensions  : 180, 360, 64800  (nrow, ncol, ncell)
resolution  : 1, 1  (x, y)
extent      : -180, 180, -90, 90  (xmin, xmax, ymin, ymax)
coord. ref. : +proj=longlat +datum=WGS84 
values      : /project/inf14w/me/regrid_raster/GEIA_N2O_oceanic.nc 
layer name  : N2O.emissions 
z-value     : 0 
zvar        : emi_n2o 

> out.fp <- './GEIA_N2O_oceanic_regrid.nc'
> out.crs <- '+proj=lcc +lat_1=33 +lat_2=45 +lat_0=40 +lon_0=-97 +x_0=-2556 +y_0=-1728'
> out.raster <- 
+   projectRaster(
+     from=in.raster, crs=out.crs, method='bilinear', format='CDF', filename=out.fp)

This ran for a few minutes (with no stdout from projectRaster(...)),
at which point I observed something like

me at it:/project/inf14w/me/regrid_raster $ ls -alh
total 147M
drwxr-xr-x  2 me mod3   65 Oct  2 16:02 .
drwxr-xr-x 15 me mod3 4.0K Oct  2 15:25 ..
-rw-r--r--  1 me mod3 512K Oct  2 15:28 GEIA_N2O_oceanic.nc
-rw-r--r--  1 me mod3 146M Oct  2 16:08 GEIA_N2O_oceanic_regrid.nc

I let it run a few minutes more before killing (with ^C in R); folder
contents were unchanged. So I'm wondering, what would cause this hang?
and how to debug?

I tend to suspect either

1 the absence of argument=to, created by a call to 

projectExtent(object, crs)

2 the absence of argument=res, given the absence of argument=to

per the doc

?projectRaster
> Usage:

>   projectRaster(from, to, res, crs, method="bilinear", filename="", ...) 
>   projectExtent(object, crs)
     
> Arguments:

>   from: Raster* object

>     to: Raster* object with the parameters to which 'from' should be
>         projected

>    res: Single or (vector of) two numerics. To, optionally, set the
>         output resolution if 'to' is missing

I have files with the form of the outputs I need (i.e., netCDF gridded
for AQMEII-NA), but they all use IOAPI

http://www.baronams.com/products/ioapi/

(a netCDF wrapper format) which could be confusing to projectRaster.
I'll try that later, in the absence of alternatives, since I don't
know what to give as 'res', either: I know from

https://github.com/TomRoche/cornbeltN2O/wiki/AQMEII-North-American-domain#wiki-EPA

the output will have ncol=459 and nrow=299, but I don't know the
vertical and horizontal extents of the output (which is not global) in
degrees (which I'm guessing is the numerator of the resolution, with the
denominator being the counts above), and the domain is not rectangular
in lon-lat (see the image just above the previous link). Am I
misunderstanding how to define 'res'?

And what I should do to debug the hang?

Your assistance is appreciated, Tom Roche <Tom_Roche at pobox.com>


From vesnikos at gmail.com  Wed Oct  3 00:17:10 2012
From: vesnikos at gmail.com (nikos ves)
Date: Wed, 03 Oct 2012 01:17:10 +0300
Subject: [R-sig-Geo] plotKML tutorials for creating a times series from
	rasters?
In-Reply-To: <1349205690.7830.5.camel@nikos-desktop>
References: <1349205690.7830.5.camel@nikos-desktop>
Message-ID: <1349216230.8568.13.camel@nikos-desktop>

An update :

After some experiments, I have created a rasterbrick with 55 layers.
( By stitching 55 geotif's into a vrt using gdal [$gdalbuildvrt
-separate -o tmp.vrt *.tif])

mBrick = brick("/path/to/vrt")



Afterwards when I was trying to create the ts 
 the the following command

package(lubridate)

 dates_mBrink_end =  dates_mBrink + months(1)

mBrick_ts <- new("RasterBrickTimeSeries",variable = "mVariable",rasters
= mBrick,TimeSpan.begin = dates_mBrick, TimeSpan.end=(dates_mBrick_end
+months(1)))

it gives me this error: 

"Error in validObject(.Object) : 
  invalid class ?RasterBrickTimeSeries? object: Length of the
'TimeSpan.begin' and 'TimeSpan.end' slots and the total number of
rasters do not match"

Obviously because  of the error, I checked and the layers, dates_mBrink
and dates_mBrink_lenght are equal to (55).


Anyone who can give me any pointers on what I am missing here? Is it
because im using a vrt as input?



Kind Regards, 

Nick Ves

On Tue, 2012-10-02 at 22:21 +0300, nikos ves wrote:
> Hi list,
> 
> 
> I was browsing the list and I found out about plotKML. It seems a nice
> way to present your data, or do a visual inspection.
> 
> 
> I tried to create a timeseries visualization from an environmental index
> Im studying at the moment (55 geotiffs ~35 MB each) but I couldn't
> figure out how. 
> 
> Anyone can give me some pointers on how to proceed? Maybe some notes,
> articles that he/she found somewhere and want to share the knowledge? (A
> google search didn't turn anything except from the manuals :/)
> 
> 
> Thank you all in advance!
> 
> Nikos Ves
>


From r.hijmans at gmail.com  Wed Oct  3 05:08:27 2012
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Tue, 2 Oct 2012 20:08:27 -0700
Subject: [R-sig-Geo] [raster newbie] projectRaster hangs regridding
 global latlong -> CONUS LCC
In-Reply-To: <87626s1s2e.fsf@pobox.com>
References: <87626s1s2e.fsf@pobox.com>
Message-ID: <CANtt_hw_Q77PHa4Qq1O8SDUD=FEiGB+iX4jLeqjrdR9rU_eD4w@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121002/b9eab9cd/attachment.pl>

From hengl at spatial-analyst.net  Wed Oct  3 09:01:50 2012
From: hengl at spatial-analyst.net (Tomislav Hengl)
Date: Wed, 03 Oct 2012 09:01:50 +0200
Subject: [R-sig-Geo] plotKML tutorials for creating a times series from
 rasters?
In-Reply-To: <1349205690.7830.5.camel@nikos-desktop>
References: <1349205690.7830.5.camel@nikos-desktop>
Message-ID: <506BE2DE.80109@spatial-analyst.net>


On 02/10/2012 21:21, nikos ves wrote:
> Hi list,
>
>
> I was browsing the list and I found out about plotKML. It seems a nice
> way to present your data, or do a visual inspection.
>
>
> I tried to create a timeseries visualization from an environmental index
> Im studying at the moment (55 geotiffs ~35 MB each) but I couldn't
> figure out how.
>
> Anyone can give me some pointers on how to proceed? Maybe some notes,
> articles that he/she found somewhere and want to share the knowledge? (A
> google search didn't turn anything except from the manuals :/)
>

I am sorry but 55 x 35MB would be too much for R to handle at the 
moment. I'm still working on 'smarter ways' (I'll try to combine raster 
package functionality with ImageMagick etc) so that large images could 
be converted to PNGs without loading them to R memory. As you can see in 
my tutorial 
[http://plotkml.r-forge.r-project.org/tutorial.php#large_data], the 
section on exporting large data is still missing  :(

I think that by the end of 2012 the tutorial and functionality should be 
complete.

T. Hengl

>
> Thank you all in advance!
>
> Nikos Ves
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From hengl at spatial-analyst.net  Wed Oct  3 09:14:23 2012
From: hengl at spatial-analyst.net (Tomislav Hengl)
Date: Wed, 03 Oct 2012 09:14:23 +0200
Subject: [R-sig-Geo] plotKML tutorials for creating a times series from
 rasters?
In-Reply-To: <1349216230.8568.13.camel@nikos-desktop>
References: <1349205690.7830.5.camel@nikos-desktop>
	<1349216230.8568.13.camel@nikos-desktop>
Message-ID: <506BE5CF.4030307@spatial-analyst.net>


On 03/10/2012 00:17, nikos ves wrote:
> An update :
>
> After some experiments, I have created a rasterbrick with 55 layers.
> ( By stitching 55 geotif's into a vrt using gdal [$gdalbuildvrt
> -separate -o tmp.vrt *.tif])
>
> mBrick = brick("/path/to/vrt")
>
>
>
> Afterwards when I was trying to create the ts
>   the the following command
>
> package(lubridate)
>
>   dates_mBrink_end =  dates_mBrink + months(1)
>
> mBrick_ts <- new("RasterBrickTimeSeries",variable = "mVariable",rasters
> = mBrick,TimeSpan.begin = dates_mBrick, TimeSpan.end=(dates_mBrick_end
> +months(1)))
>
> it gives me this error:
>
> "Error in validObject(.Object) :
>    invalid class ?RasterBrickTimeSeries? object: Length of the
> 'TimeSpan.begin' and 'TimeSpan.end' slots and the total number of
> rasters do not match"

You are missing sample points (1 or more) and it seems that the 
'ncol(mBrick at rasters@data at values)' is NOT = 55. The validity check for 
the "RasterBrickTimeSeries" class is explained at: 
[https://r-forge.r-project.org/scm/viewvc.php/pkg/R/AAA-classes.R?view=markup&root=plotkml]

Please also compare your output with my outputs in this tutorial: 
[http://plotkml.r-forge.r-project.org/tutorial.php#RasterBrickTimeSeries]

Again, I am sorry to tell you this but I still do not (yet) have a 
solution for handling large data via plotKML. Maybe by the end of 2012 
this should be possible via FWTools and tiling scripts.

also note that plotKML is still experimental package with about 10% 
functionality missing and numerous bugs and sub-optimalities (working on 
it :)

HTH

T. Hengl

>
> Obviously because  of the error, I checked and the layers, dates_mBrink
> and dates_mBrink_lenght are equal to (55).
>
>
> Anyone who can give me any pointers on what I am missing here? Is it
> because im using a vrt as input?
>
>
>
> Kind Regards,
>
> Nick Ves
>
> On Tue, 2012-10-02 at 22:21 +0300, nikos ves wrote:
>> Hi list,
>>
>>
>> I was browsing the list and I found out about plotKML. It seems a nice
>> way to present your data, or do a visual inspection.
>>
>>
>> I tried to create a timeseries visualization from an environmental index
>> Im studying at the moment (55 geotiffs ~35 MB each) but I couldn't
>> figure out how.
>>
>> Anyone can give me some pointers on how to proceed? Maybe some notes,
>> articles that he/she found somewhere and want to share the knowledge? (A
>> google search didn't turn anything except from the manuals :/)
>>
>>
>> Thank you all in advance!
>>
>> Nikos Ves
>>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From hengl at spatial-analyst.net  Wed Oct  3 13:40:54 2012
From: hengl at spatial-analyst.net (Tomislav Hengl)
Date: Wed, 03 Oct 2012 13:40:54 +0200
Subject: [R-sig-Geo] plotKML and time stamp
In-Reply-To: <BFCE57D0BE7CBB42A581347DE375AF9A11558A7A@UFEXCH-MBXN02.ad.ufl.edu>
References: <BFCE57D0BE7CBB42A581347DE375AF9A11558628@UFEXCH-MBXN02.ad.ufl.edu>
	<5068197D.90905@uni-muenster.de>
	<BFCE57D0BE7CBB42A581347DE375AF9A115588BE@UFEXCH-MBXN02.ad.ufl.edu>
	<506A0325.2070101@uni-muenster.de>
	<BFCE57D0BE7CBB42A581347DE375AF9A11558A7A@UFEXCH-MBXN02.ad.ufl.edu>
Message-ID: <506C2446.9040308@spatial-analyst.net>


try:

 > library(plotKML)
 > data(HRtemp08)
# format the time column:
 > HRtemp08$ctime <- as.POSIXct(HRtemp08$DATE, format="%Y-%m-%dT%H:%M:%SZ")
## Not run: # create a STIDF object:
 > library(spacetime)
 > sp <- SpatialPoints(HRtemp08[,c("Lon","Lat")])
 > proj4string(sp) <- CRS("+proj=longlat +datum=WGS84")
 > HRtemp08.st <- STIDF(sp, time = HRtemp08$ctime, data = 
HRtemp08[,c("NAME","TEMP")])
# write to a KML file:
 > HRtemp08_jan <- HRtemp08.st[1:500]
 > shape = "http://maps.google.com/mapfiles/kml/pal2/icon18.png"
 > kml(HRtemp08_jan, dtime = 24*3600, labels = TEMP, shape = shape, 
colour = TEMP, colour_scale=rep("#FFFF00", 2), kmz = TRUE)

See also:

http://plotkml.r-forge.r-project.org/tutorial.php#sp_classes
http://plotkml.r-forge.r-project.org/layer.STIDF.html

Note that, when using 'kml' method, you need to open the KML file yourself.

T. Hengl

On 02/10/2012 15:01, Struve,Juliane wrote:
> Hello,
>
> The attribute I am interested in is a site number. When I use the
> site number as attribute data the size of the bubble is proportional
> to the number, which does not really make sense given that the data
> are just site numbers. But when I make it a constant I lose the site
> number information. How can I get a plot that shows all the locations
> with the same size bubble but displays also the site number
> information, say like a label ? It seems that the attribute data need
> to be numeric.
>
> Thank you for your time,
>
> Juliane
>
> -----Original Message----- From: Edzer Pebesma
> [mailto:edzer.pebesma at uni-muenster.de] Sent: Monday, October 01, 2012
> 4:55 PM To: Struve,Juliane; r-sig-geo at r-project.org Subject: Re:
> [R-sig-Geo] plotKML and time stamp
>
>
>
> On 10/01/2012 05:47 PM, Struve,Juliane wrote:
>> Edzer,
>>
>> Thank you for your help, this works nicely. When xy.sp are the
>> points and tc is the date/time stamp, why is df needed  ?
>>
>
> You can create an STI object with just the space-time points, leaving
> out the df, but plotKML does not (yet) have a method to display STI
> objects -- it wants STIDF with attributes. To work around this, you
> could try giving the attribute a constant value, if you don't have
> sth that varies.
>
>> Regards,
>>
>> Juliane
>>
>>
>> -----Original Message----- From: r-sig-geo-bounces at r-project.org
>> [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of Edzer
>> Pebesma Sent: Sunday, September 30, 2012 6:06 AM To:
>> r-sig-geo at r-project.org Subject: Re: [R-sig-Geo] plotKML and time
>> stamp
>>
>> Juliane, try
>>
>> xc = round(runif(10,-1,1)+27.2, 2) yc = round(runif(10,-1,1)+-82.5,
>> 2) xy = cbind(xc, yc) tc = Sys.time() + 3600 * (1:10) df =
>> data.frame(z1 = round(5 + rnorm(10), 2), z2 = 20:29)
>>
>> library(sp) xy.sp = SpatialPoints(xy) proj4string(xy.sp) =
>> CRS("+proj=longlat +datum=WGS84")
>>
>> library(spacetime) ST = STIDF(xy.sp, tc, df)
>>
>> library(plotKML) plotKML(ST)
>>
>> see also
>>
>> vignette(spacetime)
>>
>>
>> On 09/30/2012 03:39 AM, Struve,Juliane wrote:
>>> Dear list,
>>>
>>> After plotting this toy example on Google Earth I would like to
>>> add a date/time stamp to it so that the locations will be shown
>>> in sequence using the time slider. I am not quite sure how to
>>> approach this, can I add a date/time to my spatial points and
>>> then submit it to plotKML ? What format does the date/time stamp
>>> have to be in to be plotted on Google Earth ?
>>>
>>> Many thanks for any suggestions.
>>>
>>> Regards,
>>>
>>> Juliane
>>>
>>>
>>> xc = round(runif(10,-1,1)+27.2, 2) yc =
>>> round(runif(10,-1,1)+-82.5, 2) xy = cbind(xc, yc) xy.sp =
>>> SpatialPoints(xy) df = data.frame(z1 = round(5 + rnorm(10), 2),
>>> z2 = 20:29) SP.spdf = SpatialPointsDataFrame(xy.sp, df)
>>> plot(SP.spdf) #add a projection proj4string(SP.spdf) =
>>> CRS("+proj=longlat +datum=WGS84") plotKML(SP.spdf,kmz = FALSE)
>>>
>>> [[alternative HTML version deleted]]
>>>
>>> _______________________________________________ R-sig-Geo mailing
>>> list R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>> -- Edzer Pebesma Institute for Geoinformatics (ifgi), University of
>> M?nster Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
>> 8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
>> http://www.52north.org/geostatistics      e.pebesma at wwu.de
>>
>> _______________________________________________ R-sig-Geo mailing
>> list R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> -- Edzer Pebesma Institute for Geoinformatics (ifgi), University of
> M?nster Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
> 8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
> http://www.52north.org/geostatistics      e.pebesma at wwu.de
>
> _______________________________________________ R-sig-Geo mailing
> list R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From aniru123 at gmail.com  Wed Oct  3 16:23:15 2012
From: aniru123 at gmail.com (aniruddha ghosh)
Date: Wed, 3 Oct 2012 16:23:15 +0200
Subject: [R-sig-Geo] Error: NA/NaN/Inf in foreign function call (arg 7)
 while using Predict function with Raster
Message-ID: <CAAFmNkvF+DspKwRY2eeKOFKbw76Z2p-a3qximSHY5nMDcreYNw@mail.gmail.com>

Dear List,
I'm trying to classify a multiband raster with point shapefiles as
training data. I used the following:
vec<-readOGR(".","training")
raster<-stack("test.tif")   #it contains around 100000 pixels and 240 layers
outImage<-"classified.tif"
#then extract the training values
train<-extract(raster,vec)
#after that used "caret" package to train the model
rfFit <- train(as.data.frame(train),as.factor(vec$class),
 method = "rf", tuneLength = 5,
 trControl = trainControl(method = "repeatedcv",
 repeats = 5,
 verboseIter = FALSE),
 metric = "Kappa")
# then to classify the entire data
rfPred <- predict(raster,rfFit, filename=outImage,na.rm=TRUE,
progress='text', format='GTiff', datatype='INT1U', overwrite=TRUE)

after some progress (more than 20 %) I'm getting this error:
"NA/NaN/Inf in foreign function call (arg 7)"

I have checked the code for small test image (around 10000 pixels with
125 layers) and it worked fine. I suspect it is due to the "-Inf"
present in the large raster. How to deal with this?

Thanks,
-- 
Ani


From Tom_Roche at pobox.com  Wed Oct  3 17:34:58 2012
From: Tom_Roche at pobox.com (Tom Roche)
Date: Wed, 03 Oct 2012 11:34:58 -0400
Subject: [R-sig-Geo] [raster newbie] projectRaster hangs regridding
 global latlong -> CONUS LCC
In-Reply-To: <CANtt_hw_Q77PHa4Qq1O8SDUD=FEiGB+iX4jLeqjrdR9rU_eD4w@mail.gmail.com>
References: <CANtt_hw_Q77PHa4Qq1O8SDUD=FEiGB+iX4jLeqjrdR9rU_eD4w@mail.gmail.com>
	<87626s1s2e.fsf@pobox.com>
Message-ID: <87pq4zzhzx.fsf@pobox.com>


summary: Robert Hijmans' advice fixed my hang, but now I'm getting
very wrong output--i.e., input variables are not preserved. How to
get the appropriate output schema (e.g., data variables)?

details:

https://stat.ethz.ch/pipermail/r-sig-geo/2012-October/016215.html
>> My current [NetCDF] input

>> https://github.com/downloads/TomRoche/ioapi-hack-R/GEIA_N2O_oceanic.nc

>> is gridded lon-lat @ 1?x1? with global extents:

>> $ ncdump -h ./GEIA_N2O_oceanic.nc 

condensed from original (see link)
>> > dimensions:
>> >       lon = 360 ;
>> >       lat = 180 ;
>> >       time = UNLIMITED ; // (1 currently)
>> > variables:
>> >       double lon(lon) ;
>> >       double lat(lat) ;
>> >       double time(time) ;
>> >       double emi_n2o(time, lat, lon) ;

>> I need to regrid this to the "AQMEII North American" domain

>> https://github.com/TomRoche/cornbeltN2O/wiki/AQMEII-North-American-domain#wiki-EPA 

>> for which I believe the PROJ.4 string is

>> +proj=lcc +lat_1=33 +lat_2=45 +lat_0=40 +lon_0=-97 +x_0=-2556 +y_0=-1728

https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121002/b9eab9cd/attachment.pl
> If you do not have a template ['to' raster], you can create one like this:

> library(raster)
> library(maptools)
> library(rgdal)

> data(wrld_simpl)
> x <- wrld_simpl[wrld_simpl$ISO3 == 'USA', ]
> out.crs <- '+proj=lcc +lat_1=33 +lat_2=45 +lat_0=40 +lon_0=-97 +x=_0=-2556 +y_0=-1728'

> us <- spTransform(x, CRS(out.crs))
> r <- raster(us)
> res(r) <- 100000
> # or first further reduce to your area of interest by:
> # plot(us)
> # e <- drawExtent() # click on map twice to draw box
> # r <- raster(e, crs=out.crs)
> # res(r) <- 100000

> # [input] data similar to yours
> in.raster <- raster()
> in.raster[] <- runif(ncell(in.raster))

> out <- projectRaster(from=in.raster, to=r, method='bilinear', overwrite=TRUE, progress='window')

That fixed the hang problem (see previous links) but the output is
very wrong:

following wrapped for email, and comments added:
> library(raster)
Loading required package: sp
raster 2.0-05 (19-June-2012)
> library(maptools)
Loading required package: foreign
Loading required package: lattice
Checking rgeos availability: FALSE
  Note: when rgeos is not available, polygon geometry computations in
  maptools depend on gpclib, which has a restricted licence.
  It is disabled by default; to enable gpclib, type gpclibPermit()
> gpclibPermit()
[1] TRUE
> library(rgdal)
Geospatial Data Abstraction Library extensions to R successfully loaded
Loaded GDAL runtime: GDAL 1.6.2, released 2009/07/31
Path to GDAL shared files: /usr/local/share/gdal
Loaded PROJ.4 runtime: Rel. 4.6.0, 21 Dec 2007, [PJ_VERSION: 450]
Path to PROJ.4 shared files: (autodetected)

> in.fp <- './GEIA_N2O_oceanic.nc'
> out.fp <- './GEIA_N2O_oceanic_regrid.nc'
# note retry out.crs.2 below
> out.crs <- '+proj=lcc +lat_1=33 +lat_2=45 +lat_0=40 +lon_0=-97 +x=_0=-2556 +y_0=-1728'

# make template raster
data(wrld_simpl)
x <- wrld_simpl[wrld_simpl$ISO3 == 'USA', ]
us <- spTransform(x, CRS(out.crs))
out.raster.template <- raster(us)
res(out.raster.template) <- 100000

> in.raster <- raster(in.fp, varname='emi_n2o', band=3)
Loading required package: ncdf
> in.raster[] <- runif(ncell(in.raster))
> in.raster
class       : RasterLayer 
dimensions  : 180, 360, 64800  (nrow, ncol, ncell)
resolution  : 1, 1  (x, y)
extent      : -180, 180, -90, 90  (xmin, xmax, ymin, ymax)
coord. ref. : +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0 
values      : in memory
layer name  : N2O.emissions 
min value   : 7.335795e-06 
max value   : 0.9999727 
z-value     : 0 

# try writing output: fast but very wrong
> system(sprintf("date"))
Wed Oct  3 10:33:08 EDT 2012
> out.raster <- 
+   projectRaster(
+     from=in.raster, to=out.raster.template, method='bilinear',
+     overwrite=TRUE, progress='window', format='CDF', filename=out.fp)
> system(sprintf("date"))
Wed Oct  3 10:33:09 EDT 2012
> system(sprintf("ls -alh"))
total 544K
drwxr-xr-x  2 roche mod3   65 Oct  3 10:33 .
drwxr-xr-x 15 roche mod3 4.0K Oct  2 15:25 ..
-rw-r--r--  1 roche mod3 512K Oct  2 15:28 GEIA_N2O_oceanic.nc
-rw-r--r--  1 roche mod3  26K Oct  3 10:33 GEIA_N2O_oceanic_regrid.nc

# compare to input netCDF schema
> system(sprintf("ncdump -h %s", out.fp))
netcdf GEIA_N2O_oceanic_regrid {
dimensions:
        northing = 93 ;
        easting = 66 ;
variables:
        double northing(northing) ;
                northing:units = "meter" ;
        double easting(easting) ;
                easting:units = "meter" ;
        float variable(easting, northing) ;
                variable:units =  ;
                variable:missing_value = -3.4e+38f ;
                variable:_FillValue = -3.4e+38f ;
                variable:long_name = "variable" ;
                variable:projection = "+proj=lcc +lat_1=33 +lat_2=45 +lat_0=40 +lon_0=-97 +y_0=-1728 +ellps=WGS84" ;
                variable:projection_format = "PROJ.4" ;
                variable:min = -0.01560439f ;
                variable:max = 0.9809174f ;

// global attributes:
                :Conventions = "CF-1.4" ;
                :created_by = "R, packages ncdf and raster (version 2.0-05)" ;
                :date = "2012-10-03 10:33:09" ;
}

# retry with different PROJ.4 string, omitting eastings and northings
system(sprintf("rm %s", out.fp))
# compare to out.crs above
out.crs.2 <- '+proj=lcc +lat_1=33 +lat_2=45 +lat_0=40 +lon_0=-97'

# create new template raster
us.2 <- spTransform(x, CRS(out.crs.2))
out.raster.template.2 <- raster(us.2)
res(out.raster.template.2) <- 100000

# create new output: no change in output schema :-(
> system(sprintf("ls -alh"))
total 516K
drwxr-xr-x  2 roche mod3   32 Oct  3 10:42 .
drwxr-xr-x 15 roche mod3 4.0K Oct  2 15:25 ..
-rw-r--r--  1 roche mod3 512K Oct  2 15:28 GEIA_N2O_oceanic.nc
> system(sprintf("date"))
Wed Oct  3 10:43:29 EDT 2012
> out.raster.2 <- 
+   projectRaster(
+     from=in.raster, to=out.raster.template.2, method='bilinear',
+     overwrite=TRUE, progress='window', format='CDF', filename=out.fp)
> system(sprintf("date"))
Wed Oct  3 10:43:30 EDT 2012
> system(sprintf("ls -alh"))
total 544K
drwxr-xr-x  2 roche mod3   65 Oct  3 10:43 .
drwxr-xr-x 15 roche mod3 4.0K Oct  2 15:25 ..
-rw-r--r--  1 roche mod3 512K Oct  2 15:28 GEIA_N2O_oceanic.nc
-rw-r--r--  1 roche mod3  26K Oct  3 10:43 GEIA_N2O_oceanic_regrid.nc
> system(sprintf("ncdump -h %s", out.fp))
netcdf GEIA_N2O_oceanic_regrid {
dimensions:
        northing = 93 ;
        easting = 66 ;
variables:
        double northing(northing) ;
                northing:units = "meter" ;
        double easting(easting) ;
                easting:units = "meter" ;
        float variable(easting, northing) ;
                variable:units =  ;
                variable:missing_value = -3.4e+38f ;
                variable:_FillValue = -3.4e+38f ;
                variable:long_name = "variable" ;
                variable:projection = "+proj=lcc +lat_1=33 +lat_2=45 +lat_0=40 +lon_0=-97 +ellps=WGS84" ;
                variable:projection_format = "PROJ.4" ;
                variable:min = -0.01560439f ;
                variable:max = 0.9809174f ;

// global attributes:
                :Conventions = "CF-1.4" ;
                :created_by = "R, packages ncdf and raster (version 2.0-05)" ;
                :date = "2012-10-03 10:43:29" ;
}

By contrast, I expect output schema appropriate for the input, merely
regridded for the output domain

https://github.com/TomRoche/cornbeltN2O/wiki/AQMEII-North-American-domain#wiki-EPA

e.g.,

dimensions:
      lon = 459 ;        // I should probably rename, e.g. 'COL'
      lat = 299 ;        // I should probably rename, e.g. 'ROW'
      time = UNLIMITED ; // (1 currently)
variables:
      double lon(lon) ;
      double lat(lat) ;
      double time(time) ;
      double emi_n2o(time, lat, lon) ;

How to tell projectRaster() what I want? I'm guessing I need to create
a better output template (i.e. argument='to'); how to do that?

your assistance is appreciated, Tom Roche <Tom_Roche at pobox.com>


From smithtiffanyt at gmail.com  Wed Oct  3 22:33:20 2012
From: smithtiffanyt at gmail.com (Tiffany Smith)
Date: Wed, 3 Oct 2012 16:33:20 -0400
Subject: [R-sig-Geo] Writing Raster values to .txt file
Message-ID: <6E3FE0DB-7C94-4950-8188-1CF340F41996@gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121003/f1ae617e/attachment.pl>

From rr2box42 at gmail.com  Wed Oct  3 23:15:08 2012
From: rr2box42 at gmail.com (rr2box42)
Date: Wed, 3 Oct 2012 14:15:08 -0700 (PDT)
Subject: [R-sig-Geo] projectRaster() produces an object with no values
In-Reply-To: <CANtt_hxjcuGBAzuiyagmU_znco13LteqkqTD3=wX6u3MqceHbg@mail.gmail.com>
References: <11DC569BD7493645998AD27DA1F01E273B27881C@MBOX-B-6.du.deakin.edu.au>
	<CANtt_hxjcuGBAzuiyagmU_znco13LteqkqTD3=wX6u3MqceHbg@mail.gmail.com>
Message-ID: <1349298908668-7581107.post@n2.nabble.com>

I am having the same problem as the OP. I understand Robert's response, but I
don't think it applies to my situation. Any ideas?

Here are my rasters:
    > from.rast
    class       : RasterLayer 
    band        : 2 
    dimensions  : 96, 192, 18432  (nrow, ncol, ncell)
    resolution  : 1.875, 1.864677  (x, y)
    extent      : -0.9375, 359.0625, -89.50451, 89.50451  (xmin, xmax, ymin,
ymax)
    coord. ref. : +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0 
    data source :
/Volumes/Gonzo/mpi_sd/cmip5/mpi_esm_p/past1000/tas_Amon_MPI-ESM-P_past1000_r1i1p1_085001-184912.nc 
    names       : Near.Surface.Air.Temperature 
    z-value     : 0850-02-15 
    zvar        : tas 
    
    > to.rast
    class       : RasterLayer 
    dimensions  : 100, 100, 10000  (nrow, ncol, ncell)
    resolution  : 1000, 1000  (x, y)
    extent      : -56204.44, 43795.56, 1590440, 1690440  (xmin, xmax, ymin,
ymax)
    coord. ref. : +proj=aea +lat_1=55 +lat_2=65 +lat_0=50 +lon_0=-154 +x_0=0
+y_0=0 +ellps=GRS80 +datum=NAD83 +units=m +no_defs +towgs84=0,0,0 
    data source : in memory
    names       : X1kmt_1860_6 
    values      : 8.016666, 15.00667  (min, max)


And here's how I'm trying to project them, along with the result:

    > proj.rast = projectRaster(from=from.rast, to=to.rast)
    > 
    > proj.rast
    class       : RasterLayer 
    dimensions  : 100, 100, 10000  (nrow, ncol, ncell)
    resolution  : 1000, 1000  (x, y)
    extent      : -56204.44, 43795.56, 1590440, 1690440  (xmin, xmax, ymin,
ymax)
    coord. ref. : +proj=aea +lat_1=55 +lat_2=65 +lat_0=50 +lon_0=-154 +x_0=0
+y_0=0 +ellps=GRS80 +datum=NAD83 +units=m +no_defs +towgs84=0,0,0 
    data source : in memory
    names       : Near.Surface.Air.Temperature 
    values      : NA, NA  (min, max)



I note that printing my 'from.rast' gives no 'values' field like my
'to.rast' has. The former came from a netCDF file, the latter from a geotiff
[both input with 'raster()']. I can confirm that 'from.rast' really does
have the values in there though:

    > summary(from.rast)
                 
    Min.    223.8
    1st Qu. 258.0
    Median  280.8
    Mean    275.7
    3rd Qu. 295.4
    Max.    305.3


And now I'm stumped. Thanks for the help in advance...

Bagel




--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/projectRaster-produces-an-object-with-no-values-tp7580263p7581107.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From matteo.mattiuzzi at boku.ac.at  Thu Oct  4 01:05:33 2012
From: matteo.mattiuzzi at boku.ac.at (Matteo Mattiuzzi)
Date: Thu, 04 Oct 2012 01:05:33 +0200
Subject: [R-sig-Geo] Antw:  Writing Raster values to .txt file
Message-ID: <506CE0DD0200002700016028@gwia2.boku.ac.at>

Hi, 
the only way I can see is to use ?xyFromCell


r <- raster()
r[] <- 1:ncell(r)
r <- brick(r,r*2)


vals <- getValues(r) 

coords <- xyFromCell(r,1:ncell(r))
res <- cbind(coords,vals)
write.table(res,"file1.txt")



Matteo


>>> Tiffany Smith  03.10.12 22.34 Uhr >>>
Hello,

I'm trying to write out the values of a RasterBrick to a .txt file. Here's what I have:

b<-brick("file1.nc") 
vals<-getValues(b) 
write.table(vals,"file1.txt")

Where 'b' is a RasterBrick with dimensions [224,464,33] which corresponds to [lat,lon,time]. The output, 'vals' has dimensions [103936,33] which correspond to [cell#,time].

'b' has actual lat & lon associated with it's extent; I would like to write the .txt file so that it included 'vals' and the associated lat & lon. Right now, the output file has columns filled with cell# (lat*lon) and time, I would like for there to also be columns for lat and lon.

Any ideas?

Thanks,
Tiffany
    [[alternative HTML version deleted]]

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From rr2box42 at gmail.com  Thu Oct  4 01:39:47 2012
From: rr2box42 at gmail.com (rr2box42)
Date: Wed, 3 Oct 2012 16:39:47 -0700 (PDT)
Subject: [R-sig-Geo] projectRaster() produces an object with no values
In-Reply-To: <1349298908668-7581107.post@n2.nabble.com>
References: <11DC569BD7493645998AD27DA1F01E273B27881C@MBOX-B-6.du.deakin.edu.au>
	<CANtt_hxjcuGBAzuiyagmU_znco13LteqkqTD3=wX6u3MqceHbg@mail.gmail.com>
	<1349298908668-7581107.post@n2.nabble.com>
Message-ID: <1349307587112-7581109.post@n2.nabble.com>

Oh, I see. My 'from.rast' extent is given from (0,360) degrees longitude,
rather than (-180, 180). I "fixed" that per this thread:

https://stat.ethz.ch/pipermail/r-sig-geo/2011-March/011155.html


And then the projection works fine.



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/projectRaster-produces-an-object-with-no-values-tp7580263p7581109.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From Jin.Li at ga.gov.au  Thu Oct  4 02:38:13 2012
From: Jin.Li at ga.gov.au (Jin.Li at ga.gov.au)
Date: Thu, 4 Oct 2012 10:38:13 +1000
Subject: [R-sig-Geo] Extract location information from grid cells for sample
	points [SEC=UNCLASSIFIED]
Message-ID: <8D2A822B1C6C2A44ABEB777AA83FA0E370B1C82A12@EXCCR01.agso.gov.au>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121004/36d3d5b1/attachment.pl>

From thomas.adams at noaa.gov  Thu Oct  4 03:02:42 2012
From: thomas.adams at noaa.gov (Thomas Adams)
Date: Wed, 3 Oct 2012 21:02:42 -0400
Subject: [R-sig-Geo] Extract location information from grid cells for
 sample points [SEC=UNCLASSIFIED]
In-Reply-To: <8D2A822B1C6C2A44ABEB777AA83FA0E370B1C82A12@EXCCR01.agso.gov.au>
References: <8D2A822B1C6C2A44ABEB777AA83FA0E370B1C82A12@EXCCR01.agso.gov.au>
Message-ID: <CAEoga+QB0aaFb1Kr6Uw8e135kZyVTtkzXe=KsW+9sbfFavd=gQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121003/6e199462/attachment.pl>

From cmora at dal.ca  Thu Oct  4 04:12:51 2012
From: cmora at dal.ca (Camilo Mora)
Date: Wed, 03 Oct 2012 23:12:51 -0300
Subject: [R-sig-Geo] Geographical Interpolation functions
Message-ID: <20121003231251.13942tpj5391klwk@wm4.dal.ca>

Hi
I am comparing different interpolation methods on climate data. I have  
found quite a few functions (e.g. spline and kriging) but I wonder if  
Nearest-neighbor interpolation and Natural neighbor function are  
available in an R package?

Thanks,

Camilo

Camilo Mora, Ph.D.
Department of Geography, University of Hawaii
Currently available in Colombia
Phone:   Country code: 57
          Provider code: 313
          Phone 776 2282
          From the USA or Canada you have to dial 011 57 313 776 2282
http://www.soc.hawaii.edu/mora/


From r.hijmans at gmail.com  Thu Oct  4 05:13:09 2012
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Wed, 3 Oct 2012 20:13:09 -0700
Subject: [R-sig-Geo] Extract location information from grid cells for
 sample points [SEC=UNCLASSIFIED]
In-Reply-To: <8D2A822B1C6C2A44ABEB777AA83FA0E370B1C82A12@EXCCR01.agso.gov.au>
References: <8D2A822B1C6C2A44ABEB777AA83FA0E370B1C82A12@EXCCR01.agso.gov.au>
Message-ID: <CANtt_hx4KPv9VJCiQNsFL2W=japcOiyHTtfeCeAxyS_dh=2BqQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121003/8d9ac3cc/attachment.pl>

From r.hijmans at gmail.com  Thu Oct  4 05:17:40 2012
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Wed, 3 Oct 2012 20:17:40 -0700
Subject: [R-sig-Geo] Antw: Writing Raster values to .txt file
In-Reply-To: <506CE0DD0200002700016028@gwia2.boku.ac.at>
References: <506CE0DD0200002700016028@gwia2.boku.ac.at>
Message-ID: <CANtt_hwFZuC_3ARF1ktEdTss-MahVt-W3kE3GOopKwmuutrDEg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121003/1cfd2259/attachment.pl>

From r.hijmans at gmail.com  Thu Oct  4 05:27:07 2012
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Wed, 3 Oct 2012 20:27:07 -0700
Subject: [R-sig-Geo] [raster newbie] projectRaster hangs regridding
 global latlong -> CONUS LCC
In-Reply-To: <87pq4zzhzx.fsf@pobox.com>
References: <87626s1s2e.fsf@pobox.com>
	<CANtt_hw_Q77PHa4Qq1O8SDUD=FEiGB+iX4jLeqjrdR9rU_eD4w@mail.gmail.com>
	<87pq4zzhzx.fsf@pobox.com>
Message-ID: <CANtt_hysDu5y2Cb7xDCzt8Mtgfhad-jQOSkrOy8ZVmv1a90G3A@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121003/35e2df7c/attachment.pl>

From Jin.Li at ga.gov.au  Thu Oct  4 06:20:52 2012
From: Jin.Li at ga.gov.au (Jin.Li at ga.gov.au)
Date: Thu, 4 Oct 2012 14:20:52 +1000
Subject: [R-sig-Geo] Extract location information from grid cells for
 sample points [SEC=UNCLASSIFIED]
In-Reply-To: <CANtt_hx4KPv9VJCiQNsFL2W=japcOiyHTtfeCeAxyS_dh=2BqQ@mail.gmail.com>
References: <8D2A822B1C6C2A44ABEB777AA83FA0E370B1C82A12@EXCCR01.agso.gov.au>
	<CANtt_hx4KPv9VJCiQNsFL2W=japcOiyHTtfeCeAxyS_dh=2BqQ@mail.gmail.com>
Message-ID: <8D2A822B1C6C2A44ABEB777AA83FA0E370B1C82A14@EXCCR01.agso.gov.au>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121004/df550e79/attachment.pl>

From r.hijmans at gmail.com  Thu Oct  4 06:28:10 2012
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Wed, 3 Oct 2012 21:28:10 -0700
Subject: [R-sig-Geo] Error: NA/NaN/Inf in foreign function call (arg 7)
 while using Predict function with Raster
In-Reply-To: <CAAFmNkvF+DspKwRY2eeKOFKbw76Z2p-a3qximSHY5nMDcreYNw@mail.gmail.com>
References: <CAAFmNkvF+DspKwRY2eeKOFKbw76Z2p-a3qximSHY5nMDcreYNw@mail.gmail.com>
Message-ID: <CANtt_hzeRARZHaKtUsXBxnR=Cv4ZHD-kF3cxBiD20YjnPW8zLg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121003/094c4b80/attachment.pl>

From r.hijmans at gmail.com  Thu Oct  4 06:32:21 2012
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Wed, 3 Oct 2012 21:32:21 -0700
Subject: [R-sig-Geo] Extract location information from grid cells for
 sample points [SEC=UNCLASSIFIED]
In-Reply-To: <8D2A822B1C6C2A44ABEB777AA83FA0E370B1C82A14@EXCCR01.agso.gov.au>
References: <8D2A822B1C6C2A44ABEB777AA83FA0E370B1C82A12@EXCCR01.agso.gov.au>
	<CANtt_hx4KPv9VJCiQNsFL2W=japcOiyHTtfeCeAxyS_dh=2BqQ@mail.gmail.com>
	<8D2A822B1C6C2A44ABEB777AA83FA0E370B1C82A14@EXCCR01.agso.gov.au>
Message-ID: <CANtt_hyNRcF15e91AsxxHZTq7Hvh640iPa4ZFVE9fWFzvxBfHA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121003/0d835131/attachment.ksh>

From Jin.Li at ga.gov.au  Thu Oct  4 08:25:34 2012
From: Jin.Li at ga.gov.au (Jin.Li at ga.gov.au)
Date: Thu, 4 Oct 2012 16:25:34 +1000
Subject: [R-sig-Geo] Extract location information from grid cells for
 sample points [SEC=UNCLASSIFIED]
In-Reply-To: <CANtt_hyNRcF15e91AsxxHZTq7Hvh640iPa4ZFVE9fWFzvxBfHA@mail.gmail.com>
References: <8D2A822B1C6C2A44ABEB777AA83FA0E370B1C82A12@EXCCR01.agso.gov.au>
	<CANtt_hx4KPv9VJCiQNsFL2W=japcOiyHTtfeCeAxyS_dh=2BqQ@mail.gmail.com>
	<8D2A822B1C6C2A44ABEB777AA83FA0E370B1C82A14@EXCCR01.agso.gov.au>
	<CANtt_hyNRcF15e91AsxxHZTq7Hvh640iPa4ZFVE9fWFzvxBfHA@mail.gmail.com>
Message-ID: <8D2A822B1C6C2A44ABEB777AA83FA0E370B1C82A16@EXCCR01.agso.gov.au>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121004/057598c5/attachment.ksh>

From r.hijmans at gmail.com  Thu Oct  4 08:35:11 2012
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Wed, 3 Oct 2012 23:35:11 -0700
Subject: [R-sig-Geo] Extract location information from grid cells for
 sample points [SEC=UNCLASSIFIED]
In-Reply-To: <8D2A822B1C6C2A44ABEB777AA83FA0E370B1C82A16@EXCCR01.agso.gov.au>
References: <8D2A822B1C6C2A44ABEB777AA83FA0E370B1C82A12@EXCCR01.agso.gov.au>
	<CANtt_hx4KPv9VJCiQNsFL2W=japcOiyHTtfeCeAxyS_dh=2BqQ@mail.gmail.com>
	<8D2A822B1C6C2A44ABEB777AA83FA0E370B1C82A14@EXCCR01.agso.gov.au>
	<CANtt_hyNRcF15e91AsxxHZTq7Hvh640iPa4ZFVE9fWFzvxBfHA@mail.gmail.com>
	<8D2A822B1C6C2A44ABEB777AA83FA0E370B1C82A16@EXCCR01.agso.gov.au>
Message-ID: <CANtt_hyhMQu_qk9gm3r_CszQTd+or-QS3+PD_5yHHGONnwB+MA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121003/a4f90824/attachment.pl>

From Jin.Li at ga.gov.au  Thu Oct  4 08:39:34 2012
From: Jin.Li at ga.gov.au (Jin.Li at ga.gov.au)
Date: Thu, 4 Oct 2012 16:39:34 +1000
Subject: [R-sig-Geo] Extract location information from grid cells for
 sample points [SEC=UNCLASSIFIED]
In-Reply-To: <CANtt_hyhMQu_qk9gm3r_CszQTd+or-QS3+PD_5yHHGONnwB+MA@mail.gmail.com>
References: <8D2A822B1C6C2A44ABEB777AA83FA0E370B1C82A12@EXCCR01.agso.gov.au>
	<CANtt_hx4KPv9VJCiQNsFL2W=japcOiyHTtfeCeAxyS_dh=2BqQ@mail.gmail.com>
	<8D2A822B1C6C2A44ABEB777AA83FA0E370B1C82A14@EXCCR01.agso.gov.au>
	<CANtt_hyNRcF15e91AsxxHZTq7Hvh640iPa4ZFVE9fWFzvxBfHA@mail.gmail.com>
	<8D2A822B1C6C2A44ABEB777AA83FA0E370B1C82A16@EXCCR01.agso.gov.au>
	<CANtt_hyhMQu_qk9gm3r_CszQTd+or-QS3+PD_5yHHGONnwB+MA@mail.gmail.com>
Message-ID: <8D2A822B1C6C2A44ABEB777AA83FA0E370B1C82A17@EXCCR01.agso.gov.au>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121004/ea62e491/attachment.pl>

From saramartino at yahoo.com  Thu Oct  4 14:26:57 2012
From: saramartino at yahoo.com (sara martino)
Date: Thu, 4 Oct 2012 05:26:57 -0700 (PDT)
Subject: [R-sig-Geo] simplify a polygon window
Message-ID: <1349353617.55223.YahooMailNeo@web140903.mail.bf1.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121004/0ced36b4/attachment.pl>

From jstruve at ufl.edu  Thu Oct  4 15:00:38 2012
From: jstruve at ufl.edu (Struve,Juliane)
Date: Thu, 4 Oct 2012 13:00:38 +0000
Subject: [R-sig-Geo] plotKML and time stamp
In-Reply-To: <506C2446.9040308@spatial-analyst.net>
References: <BFCE57D0BE7CBB42A581347DE375AF9A11558628@UFEXCH-MBXN02.ad.ufl.edu>
	<5068197D.90905@uni-muenster.de>
	<BFCE57D0BE7CBB42A581347DE375AF9A115588BE@UFEXCH-MBXN02.ad.ufl.edu>
	<506A0325.2070101@uni-muenster.de>
	<BFCE57D0BE7CBB42A581347DE375AF9A11558A7A@UFEXCH-MBXN02.ad.ufl.edu>
	<506C2446.9040308@spatial-analyst.net>
Message-ID: <BFCE57D0BE7CBB42A581347DE375AF9A11559067@UFEXCH-MBXN02.ad.ufl.edu>

Hello,

Thanks a lot for replying. I can't run this script, the last line gives me an error:

KML file header opened for parsing...
Parsing to KML...
Closing  HRtemp08_jan.kml
Error in kml_compress(file.name = file.name) : 
  KMZ generation failed. Wrong command passed to 'zip = ... option'.

What do I need to change ?

Regards,

Juliane 

sessionInfo()

R version 2.15.0 (2012-03-30)
Platform: i386-pc-mingw32/i386 (32-bit)

locale:
[1] LC_COLLATE=English_United States.1252 
[2] LC_CTYPE=English_United States.1252   
[3] LC_MONETARY=English_United States.1252
[4] LC_NUMERIC=C                          
[5] LC_TIME=English_United States.1252    

attached base packages:
[1] splines   stats     graphics  grDevices utils     datasets  methods  
[8] base     

other attached packages:
 [1] plotKML_0.2-5      dismo_0.7-23       scales_0.2.2       aqp_1.2-7         
 [5] gstat_1.0-14       spacetime_0.8-0    xts_0.8-6          zoo_1.7-7         
 [9] Hmisc_3.9-3        survival_2.36-12   RColorBrewer_1.0-5 stringr_0.6.1     
[13] colorRamps_2.3     plotrix_3.4-5      colorspace_1.1-1   plyr_1.7.1        
[17] raster_2.0-12      pixmap_0.4-11      XML_3.9-4.1        rgdal_0.7-19      
[21] sp_0.9-99         

loaded via a namespace (and not attached):
[1] cluster_1.14.2  dichromat_1.2-4 grid_2.15.0     labeling_0.1   
[5] lattice_0.20-6  munsell_0.4     reshape_0.8.4   tools_2.15.0   


-----Original Message-----
From: Tomislav Hengl [mailto:hengl at spatial-analyst.net] 
Sent: Wednesday, October 03, 2012 7:41 AM
To: Struve,Juliane
Cc: Edzer Pebesma; r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] plotKML and time stamp


try:

 > library(plotKML)
 > data(HRtemp08)
# format the time column:
 > HRtemp08$ctime <- as.POSIXct(HRtemp08$DATE, format="%Y-%m-%dT%H:%M:%SZ")
## Not run: # create a STIDF object:
 > library(spacetime)
 > sp <- SpatialPoints(HRtemp08[,c("Lon","Lat")])
 > proj4string(sp) <- CRS("+proj=longlat +datum=WGS84")
 > HRtemp08.st <- STIDF(sp, time = HRtemp08$ctime, data = 
HRtemp08[,c("NAME","TEMP")])
# write to a KML file:
 > HRtemp08_jan <- HRtemp08.st[1:500]
 > shape = "http://maps.google.com/mapfiles/kml/pal2/icon18.png"
 > kml(HRtemp08_jan, dtime = 24*3600, labels = TEMP, shape = shape, 
colour = TEMP, colour_scale=rep("#FFFF00", 2), kmz = TRUE)

See also:

http://plotkml.r-forge.r-project.org/tutorial.php#sp_classes
http://plotkml.r-forge.r-project.org/layer.STIDF.html

Note that, when using 'kml' method, you need to open the KML file yourself.

T. Hengl

On 02/10/2012 15:01, Struve,Juliane wrote:
> Hello,
>
> The attribute I am interested in is a site number. When I use the
> site number as attribute data the size of the bubble is proportional
> to the number, which does not really make sense given that the data
> are just site numbers. But when I make it a constant I lose the site
> number information. How can I get a plot that shows all the locations
> with the same size bubble but displays also the site number
> information, say like a label ? It seems that the attribute data need
> to be numeric.
>
> Thank you for your time,
>
> Juliane
>
> -----Original Message----- From: Edzer Pebesma
> [mailto:edzer.pebesma at uni-muenster.de] Sent: Monday, October 01, 2012
> 4:55 PM To: Struve,Juliane; r-sig-geo at r-project.org Subject: Re:
> [R-sig-Geo] plotKML and time stamp
>
>
>
> On 10/01/2012 05:47 PM, Struve,Juliane wrote:
>> Edzer,
>>
>> Thank you for your help, this works nicely. When xy.sp are the
>> points and tc is the date/time stamp, why is df needed  ?
>>
>
> You can create an STI object with just the space-time points, leaving
> out the df, but plotKML does not (yet) have a method to display STI
> objects -- it wants STIDF with attributes. To work around this, you
> could try giving the attribute a constant value, if you don't have
> sth that varies.
>
>> Regards,
>>
>> Juliane
>>
>>
>> -----Original Message----- From: r-sig-geo-bounces at r-project.org
>> [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of Edzer
>> Pebesma Sent: Sunday, September 30, 2012 6:06 AM To:
>> r-sig-geo at r-project.org Subject: Re: [R-sig-Geo] plotKML and time
>> stamp
>>
>> Juliane, try
>>
>> xc = round(runif(10,-1,1)+27.2, 2) yc = round(runif(10,-1,1)+-82.5,
>> 2) xy = cbind(xc, yc) tc = Sys.time() + 3600 * (1:10) df =
>> data.frame(z1 = round(5 + rnorm(10), 2), z2 = 20:29)
>>
>> library(sp) xy.sp = SpatialPoints(xy) proj4string(xy.sp) =
>> CRS("+proj=longlat +datum=WGS84")
>>
>> library(spacetime) ST = STIDF(xy.sp, tc, df)
>>
>> library(plotKML) plotKML(ST)
>>
>> see also
>>
>> vignette(spacetime)
>>
>>
>> On 09/30/2012 03:39 AM, Struve,Juliane wrote:
>>> Dear list,
>>>
>>> After plotting this toy example on Google Earth I would like to
>>> add a date/time stamp to it so that the locations will be shown
>>> in sequence using the time slider. I am not quite sure how to
>>> approach this, can I add a date/time to my spatial points and
>>> then submit it to plotKML ? What format does the date/time stamp
>>> have to be in to be plotted on Google Earth ?
>>>
>>> Many thanks for any suggestions.
>>>
>>> Regards,
>>>
>>> Juliane
>>>
>>>
>>> xc = round(runif(10,-1,1)+27.2, 2) yc =
>>> round(runif(10,-1,1)+-82.5, 2) xy = cbind(xc, yc) xy.sp =
>>> SpatialPoints(xy) df = data.frame(z1 = round(5 + rnorm(10), 2),
>>> z2 = 20:29) SP.spdf = SpatialPointsDataFrame(xy.sp, df)
>>> plot(SP.spdf) #add a projection proj4string(SP.spdf) =
>>> CRS("+proj=longlat +datum=WGS84") plotKML(SP.spdf,kmz = FALSE)
>>>
>>> [[alternative HTML version deleted]]
>>>
>>> _______________________________________________ R-sig-Geo mailing
>>> list R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>> -- Edzer Pebesma Institute for Geoinformatics (ifgi), University of
>> M?nster Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
>> 8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
>> http://www.52north.org/geostatistics      e.pebesma at wwu.de
>>
>> _______________________________________________ R-sig-Geo mailing
>> list R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> -- Edzer Pebesma Institute for Geoinformatics (ifgi), University of
> M?nster Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
> 8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
> http://www.52north.org/geostatistics      e.pebesma at wwu.de
>
> _______________________________________________ R-sig-Geo mailing
> list R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

From mathieu.rajerison at gmail.com  Thu Oct  4 15:06:34 2012
From: mathieu.rajerison at gmail.com (Mathieu Rajerison)
Date: Thu, 4 Oct 2012 15:06:34 +0200
Subject: [R-sig-Geo] simplify a polygon window
In-Reply-To: <1349353617.55223.YahooMailNeo@web140903.mail.bf1.yahoo.com>
References: <1349353617.55223.YahooMailNeo@web140903.mail.bf1.yahoo.com>
Message-ID: <CAGfc75nNGCzbojXMh3tcvVn-otcT0YiOhBBzDsUkMwZdNCPmrQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121004/97a058b6/attachment.pl>

From aniru123 at gmail.com  Thu Oct  4 15:09:02 2012
From: aniru123 at gmail.com (aniruddha ghosh)
Date: Thu, 4 Oct 2012 15:09:02 +0200
Subject: [R-sig-Geo] Error: NA/NaN/Inf in foreign function call (arg 7)
 while using Predict function with Raster
In-Reply-To: <CANtt_hzeRARZHaKtUsXBxnR=Cv4ZHD-kF3cxBiD20YjnPW8zLg@mail.gmail.com>
References: <CAAFmNkvF+DspKwRY2eeKOFKbw76Z2p-a3qximSHY5nMDcreYNw@mail.gmail.com>
	<CANtt_hzeRARZHaKtUsXBxnR=Cv4ZHD-kF3cxBiD20YjnPW8zLg@mail.gmail.com>
Message-ID: <CAAFmNktkuZ4U3cuG4H52vg-Q9V_=OfOnzqtgADe60QmcFRWGpg@mail.gmail.com>

Hello Robert,
I used the development version of 'raster' (version 2.0-20) with
option "inf.rm". It solved the issue!
writeRaster was not able to remove Inf.
Sorry for not posting with self-contained example,

Thanks for the help!

On Thu, Oct 4, 2012 at 6:28 AM, Robert J. Hijmans <r.hijmans at gmail.com> wrote:
> Ani,
>
> The raster::predict function has na.rm=TRUE and removes the NA values, but
> not -Inf/Inf values and that indeed seems to be the problem here (see
> example below). I have added an option "inf.rm" to the predict function of
> the development version of 'raster' (version 2.0-20) you can try to install
> it from R-Forge in 12 hours: install.packages("raster",
> repos="http://R-Forge.R-project.org").
>
> With that version, your code will likely work if you do predict(      ,
> inf.rm=TRUE)
>
> Alternatively, you could write your rasters to a new file using writeRaster,
> because that will likely replace the -Inf/Inf values with NA, and then use a
> RasterBrick made from this new file in the predict version.
>
> When asking questions like this, please try to provide a self-contained
> example like I provide below (mostly copied from ?raster::predict).
>
> library(raster)
> library(caret)
>
> logo <- brick(system.file("external/rlogo.grd", package="raster"))
> #get presence and random-absence points
> p <- matrix(c(48, 48, 48, 53, 50, 46, 54, 70, 84, 85, 74, 84, 95, 85,
>    66, 42, 26, 4, 19, 17, 7, 14, 26, 29, 39, 45, 51, 56, 46, 38, 31,
>    22, 34, 60, 70, 73, 63, 46, 43, 28), ncol=2)
> a <- cbind(runif(250)*(xmax(logo)-xmin(logo))+xmin(logo),
>            runif(250)*(ymax(logo)-ymin(logo))+ymin(logo))
>
>
> #extract values for points
> xy <- rbind(cbind(1, p), cbind(0, a))
> train <- data.frame(extract(logo, xy[,2:3]))
> class <- as.factor(xy[,1])
>
> f <- class~red+green+blue
> rfFit <- train(as.data.frame(train), class, method = "rf", tuneLength = 5,
> trControl = trainControl(method = "repeatedcv", repeats = 5, verboseIter =
> FALSE), metric = "Kappa")
>
>
>>  logo[2:10,] <- NA
>> r1 <- predict(logo, rfFit)
>>
>> logo[2:10,] <- Inf
>> r2 <- predict(logo, rfFit)
> Error in predict.randomForest(modelFit, newdata) :
>   NA/NaN/Inf in foreign function call (arg 7)
>>
>
>
> Best, Robert
>
> On Wed, Oct 3, 2012 at 7:23 AM, aniruddha ghosh <aniru123 at gmail.com> wrote:
>>
>> Dear List,
>> I'm trying to classify a multiband raster with point shapefiles as
>> training data. I used the following:
>> vec<-readOGR(".","training")
>> raster<-stack("test.tif")   #it contains around 100000 pixels and 240
>> layers
>> outImage<-"classified.tif"
>> #then extract the training values
>> train<-extract(raster,vec)
>> #after that used "caret" package to train the model
>> rfFit <- train(as.data.frame(train),as.factor(vec$class),
>>  method = "rf", tuneLength = 5,
>>  trControl = trainControl(method = "repeatedcv",
>>  repeats = 5,
>>  verboseIter = FALSE),
>>  metric = "Kappa")
>> # then to classify the entire data
>> rfPred <- predict(raster,rfFit, filename=outImage,na.rm=TRUE,
>> progress='text', format='GTiff', datatype='INT1U', overwrite=TRUE)
>>
>> after some progress (more than 20 %) I'm getting this error:
>> "NA/NaN/Inf in foreign function call (arg 7)"
>>
>> I have checked the code for small test image (around 10000 pixels with
>> 125 layers) and it worked fine. I suspect it is due to the "-Inf"
>> present in the large raster. How to deal with this?
>>
>> Thanks,
>> --
>> Ani
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>



-- 
Aniruddha Ghosh
Graduate Student
Department of Natural Resources
TERI University,New Delhi


From b.rowlingson at lancaster.ac.uk  Thu Oct  4 15:16:29 2012
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Thu, 4 Oct 2012 14:16:29 +0100
Subject: [R-sig-Geo] simplify a polygon window
In-Reply-To: <1317a10f813f4a4bbcac24226c0c9f9b@EX-1-HT0.lancs.local>
References: <1317a10f813f4a4bbcac24226c0c9f9b@EX-1-HT0.lancs.local>
Message-ID: <CANVKczPN7h4hS=cBg4yrNwFUdHYFZh+73d-T7tCsAsuUCgm98Q@mail.gmail.com>

On Thu, Oct 4, 2012 at 1:26 PM, sara martino <saramartino at yahoo.com> wrote:
> Hi,
>
> I am working with a point pattern whose window is a spatial polygon which describe the cost of Norway.
>
> I need to get a smoother version of such polygon which wraps the original one.

You mean 'coast' of Norway? You want to undo all Slartibartfast's good
work? He won an award for that!

http://en.wikipedia.org/wiki/Slartibartfast

> I have tried to use the function
>
>> simplify.owin(my.owin,80000)
> but this does not work since some parts of the original polygon will lay outside the simplified one.
>
> Does anyone know how to do that?

 You could use the buffering functions in rgeos to expand the area
slightly - but that might end up making the polygon more complex
again.

 You could possibly also use an alpha-shape instead of whatever
polygon you have:

http://procomun.wordpress.com/2011/04/07/alpha-shapes-with-lattice/

 but at that point you are probably throwing away the concept that the
polygon is the window in which your process occurs. In which case your
analysis becomes problematic.

 Are you losing points after the simplification? You could just drop them.


From saramartino at yahoo.com  Thu Oct  4 15:17:40 2012
From: saramartino at yahoo.com (sara martino)
Date: Thu, 4 Oct 2012 06:17:40 -0700 (PDT)
Subject: [R-sig-Geo] simplify a polygon window
In-Reply-To: <CAGfc75nNGCzbojXMh3tcvVn-otcT0YiOhBBzDsUkMwZdNCPmrQ@mail.gmail.com>
References: <1349353617.55223.YahooMailNeo@web140903.mail.bf1.yahoo.com>
	<CAGfc75nNGCzbojXMh3tcvVn-otcT0YiOhBBzDsUkMwZdNCPmrQ@mail.gmail.com>
Message-ID: <1349356660.3060.YahooMailNeo@web140902.mail.bf1.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121004/ea6fd829/attachment.pl>

From saramartino at yahoo.com  Thu Oct  4 15:24:54 2012
From: saramartino at yahoo.com (sara martino)
Date: Thu, 4 Oct 2012 06:24:54 -0700 (PDT)
Subject: [R-sig-Geo] simplify a polygon window
In-Reply-To: <CANVKczPN7h4hS=cBg4yrNwFUdHYFZh+73d-T7tCsAsuUCgm98Q@mail.gmail.com>
References: <1317a10f813f4a4bbcac24226c0c9f9b@EX-1-HT0.lancs.local>
	<CANVKczPN7h4hS=cBg4yrNwFUdHYFZh+73d-T7tCsAsuUCgm98Q@mail.gmail.com>
Message-ID: <1349357094.12892.YahooMailNeo@web140903.mail.bf1.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121004/722b1c32/attachment.pl>

From kupdegra at d.umn.edu  Thu Oct  4 16:11:27 2012
From: kupdegra at d.umn.edu (Karen Updegraff)
Date: Thu, 4 Oct 2012 09:11:27 -0500
Subject: [R-sig-Geo] ZIP or Hurdle model in BRugs
Message-ID: <CAP=uX7ZuUgw0aHRDS9cA2oS1__=qY5qOyrayDrtOKDLRqGk7Rw@mail.gmail.com>

I have some zero-inflated count data that I would like to use for
small-area spatial interpolation (of plant population densities).  As
GeoR and GeoRglm don't appear to accommodate ZIP or hurdle models, I'm
thinking the R-OpenBugs binding (BRugs) might be a plausible route for
setting up and evaluating such a model. However, as a complete
OpenBUGS neophyte I am a bit overwhelmed by the coding requirements.
None of the examples provided with OpenBUGS or GeoBUGS have been
illuminating.   One problem is that the OpenBUGS documentation for
linux (cmd line system) is nonexistent.  I understand that JAGS is the
recommended alternative but don't believe it has a spatial module.

If anyone has some example code that approximates what I am trying to
do (fit a model to spatially-referenced count data, then run the krige
in GeoBUGS?) and would be willing to share it, it would be a huge
help.

thanks, Karen


From marcelino.delacruz at upm.es  Thu Oct  4 16:37:19 2012
From: marcelino.delacruz at upm.es (Marcelino de la Cruz)
Date: Thu, 04 Oct 2012 16:37:19 +0200
Subject: [R-sig-Geo] simplify a polygon window
In-Reply-To: <1349356660.3060.YahooMailNeo@web140902.mail.bf1.yahoo.com>
References: <1349353617.55223.YahooMailNeo@web140903.mail.bf1.yahoo.com>
	<CAGfc75nNGCzbojXMh3tcvVn-otcT0YiOhBBzDsUkMwZdNCPmrQ@mail.gmail.com>
	<1349356660.3060.YahooMailNeo@web140902.mail.bf1.yahoo.com>
Message-ID: <201210041437.q94EbeTR022015@smtp.upm.es>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121004/1202cdae/attachment.pl>

From Sytze.deBruin at wur.nl  Thu Oct  4 16:54:29 2012
From: Sytze.deBruin at wur.nl (Bruin, Sytze de)
Date: Thu, 4 Oct 2012 14:54:29 +0000
Subject: [R-sig-Geo] variogramST does not like STIDF
Message-ID: <51521FE329A36B40876F00ED90C7B8A301CC9129@SCOMP0937.wurnet.nl>

Dear all,



I intend to compute a space-time variogram from irregularly spaced data. I created a STIDF object for that (package stacetime), but gstat's function "variogram" only seems to only accept STSDF or STFDF objects as data. The following message was generated: Error: is(data, "STFDF") || is(data, "STSDF") is not TRUE. A solution would be to first coerce the STIDF to STSDF --which is wat I am doing-- but is there a reason why variogram does not accept STIDF?



Thanks,

Sytze


From edzer.pebesma at uni-muenster.de  Thu Oct  4 17:51:44 2012
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Thu, 04 Oct 2012 17:51:44 +0200
Subject: [R-sig-Geo] variogramST does not like STIDF
In-Reply-To: <51521FE329A36B40876F00ED90C7B8A301CC9129@SCOMP0937.wurnet.nl>
References: <51521FE329A36B40876F00ED90C7B8A301CC9129@SCOMP0937.wurnet.nl>
Message-ID: <506DB090.6010606@uni-muenster.de>



On 10/04/2012 04:54 PM, Bruin, Sytze de wrote:
> Dear all,
> 
> 
> 
> I intend to compute a space-time variogram from irregularly spaced data. I created a STIDF object for that (package stacetime), but gstat's function "variogram" only seems to only accept STSDF or STFDF objects as data. The following message was generated: Error: is(data, "STFDF") || is(data, "STSDF") is not TRUE. A solution would be to first coerce the STIDF to STSDF --which is wat I am doing-- but is there a reason why variogram does not accept STIDF?
> 
Sytze,

The reason is that nobody has implemented it, so far, and this is the
first time someone asks.

When you're done coercing, please let me know whether you still think
there is a need for computing variograms from STIDF data.
-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From j2kennel at gmail.com  Thu Oct  4 18:27:51 2012
From: j2kennel at gmail.com (Jonathan)
Date: Thu, 4 Oct 2012 09:27:51 -0700 (PDT)
Subject: [R-sig-Geo] rasterVis::levelplot key='top' error
Message-ID: <1349368071637-7581134.post@n2.nabble.com>

Hello all,

I'm using rasterVis to plot point and raster data together and am finding an
error when trying to put a manually defined key on the top of the plot.  It
works on the 'left' and 'bottom' axes but not on the top or right.  Can
others reproduce this error and what is a possible solution? 

I'm using:
raster_2.0-12 
rasterVis_0.11-01

Here is the example code.  Thank you!
Jonathan

# EXAMPLE CODE
library(raster)
library(rasterVis)

RST <- raster()
RST[] <- 1

# key on top-this doesn't works!
levelplot(RST,
          region = FALSE,
          key = list(space = 'top',
                     points = list(col = 'black',
                                   type = 'p',
                                   pch = 20),
                     text = list('test')))
 
#Error in fun(key = list(space = "top", points = list(col = "black", type =
"p",  : 
#  argument "p" is missing, with no default
                                                     
# key on bottom-this works!
levelplot(RST, 
          region = FALSE,
          key = list(space = 'bottom',
                     points = list(col = 'black',
                                   type = 'p',
                                   pch = 20),
                     text = list('test')))

# key on top with standard levelplot for matrix-this works!
levelplot(as.matrix(RST),
          region = FALSE, 
          key = list(space = 'top',
                     points = list(col = 'black',
                                   type = 'p',
                                   pch = 20),
                     text = list('test')))


sessionInfo()
#R version 2.15.1 (2012-06-22)
#Platform: x86_64-unknown-linux-gnu (64-bit)

#locale:
#  [1] LC_CTYPE=en_CA.UTF-8       LC_NUMERIC=C              
#[3] LC_TIME=en_CA.UTF-8        LC_COLLATE=en_CA.UTF-8    
# [5] LC_MONETARY=en_CA.UTF-8    LC_MESSAGES=en_CA.UTF-8   
# [7] LC_PAPER=C                 LC_NAME=C                 
# [9] LC_ADDRESS=C               LC_TELEPHONE=C            
# [11] LC_MEASUREMENT=en_CA.UTF-8 LC_IDENTIFICATION=C       
# 
# attached base packages:
#   [1] grid      stats     graphics  grDevices utils     datasets  methods  
# [8] base     
# 
# other attached packages:
#   [1] rasterVis_0.11-01   hexbin_1.26.0       latticeExtra_0.6-24
# [4] RColorBrewer_1.0-5  lattice_0.20-10     raster_2.0-12      
# [7] sp_0.9-99          
# 
# loaded via a namespace (and not attached):
#   [1] zoo_1.7-7




--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/rasterVis-levelplot-key-top-error-tp7581134.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From jfloeter at uni-hamburg.de  Thu Oct  4 18:29:03 2012
From: jfloeter at uni-hamburg.de (Jens Floeter)
Date: Thu, 04 Oct 2012 18:29:03 +0200
Subject: [R-sig-Geo] ZIP or Hurdle model in BRugs
In-Reply-To: <CAP=uX7ZuUgw0aHRDS9cA2oS1__=qY5qOyrayDrtOKDLRqGk7Rw@mail.gmail.com>
References: <CAP=uX7ZuUgw0aHRDS9cA2oS1__=qY5qOyrayDrtOKDLRqGk7Rw@mail.gmail.com>
Message-ID: <506DB94F.2080201@uni-hamburg.de>

Hi Karen,
without advertising it, the book #4  by Alain Zuur is quite helpful 
(with example code) in this context.
http://www.highstat.com/book4.htm
Cheers!
jens



Am 04.10.2012 16:11, schrieb Karen Updegraff:
> I have some zero-inflated count data that I would like to use for
> small-area spatial interpolation (of plant population densities).  As
> GeoR and GeoRglm don't appear to accommodate ZIP or hurdle models, I'm
> thinking the R-OpenBugs binding (BRugs) might be a plausible route for
> setting up and evaluating such a model. However, as a complete
> OpenBUGS neophyte I am a bit overwhelmed by the coding requirements.
> None of the examples provided with OpenBUGS or GeoBUGS have been
> illuminating.   One problem is that the OpenBUGS documentation for
> linux (cmd line system) is nonexistent.  I understand that JAGS is the
> recommended alternative but don't believe it has a spatial module.
>
> If anyone has some example code that approximates what I am trying to
> do (fit a model to spatially-referenced count data, then run the krige
> in GeoBUGS?) and would be willing to share it, it would be a huge
> help.
>
> thanks, Karen
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
*****************************************************
Jens Floeter
Institut f?r Hydrobiologie  & Fischereiwissenschaft
Universit?t Hamburg
Olbersweg 24
22767 Hamburg

Phone +49 (0)40 42838 6611
Fax   +49 (0)40 42838 6618


From j2kennel at gmail.com  Thu Oct  4 18:37:11 2012
From: j2kennel at gmail.com (Jonathan)
Date: Thu, 4 Oct 2012 09:37:11 -0700 (PDT)
Subject: [R-sig-Geo] rasterVis::levelplot key='top' error
In-Reply-To: <1349368071637-7581134.post@n2.nabble.com>
References: <1349368071637-7581134.post@n2.nabble.com>
Message-ID: <1349368631283-7581136.post@n2.nabble.com>

OK, sorry for the previous post.  I am able to achieve my desired result this
way by over-riding some defaults:

levelplot(RST, 
          region = FALSE,
          margin = FALSE,
          colorkey = FALSE,
          key = list(space = 'top',
                     points = list(col = 'black',
                                   type = 'p',
                                   pch = 20),
                     text = list('test')))

Thank you,
Jonathan





--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/rasterVis-levelplot-key-top-error-tp7581134p7581136.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From jstruve at ufl.edu  Thu Oct  4 19:04:53 2012
From: jstruve at ufl.edu (Struve,Juliane)
Date: Thu, 4 Oct 2012 17:04:53 +0000
Subject: [R-sig-Geo] plotKML and time stamp
In-Reply-To: <BFCE57D0BE7CBB42A581347DE375AF9A11559067@UFEXCH-MBXN02.ad.ufl.edu>
References: <BFCE57D0BE7CBB42A581347DE375AF9A11558628@UFEXCH-MBXN02.ad.ufl.edu>
	<5068197D.90905@uni-muenster.de>
	<BFCE57D0BE7CBB42A581347DE375AF9A115588BE@UFEXCH-MBXN02.ad.ufl.edu>
	<506A0325.2070101@uni-muenster.de>
	<BFCE57D0BE7CBB42A581347DE375AF9A11558A7A@UFEXCH-MBXN02.ad.ufl.edu>
	<506C2446.9040308@spatial-analyst.net>
	<BFCE57D0BE7CBB42A581347DE375AF9A11559067@UFEXCH-MBXN02.ad.ufl.edu>
Message-ID: <BFCE57D0BE7CBB42A581347DE375AF9A11559141@UFEXCH-MBXN02.ad.ufl.edu>

Apoplogies for the previous post. I had not seen your statement 
" Note that, when using 'kml' method, you need to open the KML file yourself".
The example shows exactly what I am looking for.

Thanks for help.

Juliane

-----Original Message-----
From: r-sig-geo-bounces at r-project.org [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of Struve,Juliane
Sent: Thursday, October 04, 2012 9:01 AM
To: Tomislav Hengl
Cc: r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] plotKML and time stamp

Hello,

Thanks a lot for replying. I can't run this script, the last line gives me an error:

KML file header opened for parsing...
Parsing to KML...
Closing  HRtemp08_jan.kml
Error in kml_compress(file.name = file.name) : 
  KMZ generation failed. Wrong command passed to 'zip = ... option'.

What do I need to change ?

Regards,

Juliane 

sessionInfo()

R version 2.15.0 (2012-03-30)
Platform: i386-pc-mingw32/i386 (32-bit)

locale:
[1] LC_COLLATE=English_United States.1252 
[2] LC_CTYPE=English_United States.1252   
[3] LC_MONETARY=English_United States.1252
[4] LC_NUMERIC=C                          
[5] LC_TIME=English_United States.1252    

attached base packages:
[1] splines   stats     graphics  grDevices utils     datasets  methods  
[8] base     

other attached packages:
 [1] plotKML_0.2-5      dismo_0.7-23       scales_0.2.2       aqp_1.2-7         
 [5] gstat_1.0-14       spacetime_0.8-0    xts_0.8-6          zoo_1.7-7         
 [9] Hmisc_3.9-3        survival_2.36-12   RColorBrewer_1.0-5 stringr_0.6.1     
[13] colorRamps_2.3     plotrix_3.4-5      colorspace_1.1-1   plyr_1.7.1        
[17] raster_2.0-12      pixmap_0.4-11      XML_3.9-4.1        rgdal_0.7-19      
[21] sp_0.9-99         

loaded via a namespace (and not attached):
[1] cluster_1.14.2  dichromat_1.2-4 grid_2.15.0     labeling_0.1   
[5] lattice_0.20-6  munsell_0.4     reshape_0.8.4   tools_2.15.0   


-----Original Message-----
From: Tomislav Hengl [mailto:hengl at spatial-analyst.net] 
Sent: Wednesday, October 03, 2012 7:41 AM
To: Struve,Juliane
Cc: Edzer Pebesma; r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] plotKML and time stamp


try:

 > library(plotKML)
 > data(HRtemp08)
# format the time column:
 > HRtemp08$ctime <- as.POSIXct(HRtemp08$DATE, format="%Y-%m-%dT%H:%M:%SZ")
## Not run: # create a STIDF object:
 > library(spacetime)
 > sp <- SpatialPoints(HRtemp08[,c("Lon","Lat")])
 > proj4string(sp) <- CRS("+proj=longlat +datum=WGS84")
 > HRtemp08.st <- STIDF(sp, time = HRtemp08$ctime, data = 
HRtemp08[,c("NAME","TEMP")])
# write to a KML file:
 > HRtemp08_jan <- HRtemp08.st[1:500]
 > shape = "http://maps.google.com/mapfiles/kml/pal2/icon18.png"
 > kml(HRtemp08_jan, dtime = 24*3600, labels = TEMP, shape = shape, 
colour = TEMP, colour_scale=rep("#FFFF00", 2), kmz = TRUE)

See also:

http://plotkml.r-forge.r-project.org/tutorial.php#sp_classes
http://plotkml.r-forge.r-project.org/layer.STIDF.html

Note that, when using 'kml' method, you need to open the KML file yourself.

T. Hengl

On 02/10/2012 15:01, Struve,Juliane wrote:
> Hello,
>
> The attribute I am interested in is a site number. When I use the
> site number as attribute data the size of the bubble is proportional
> to the number, which does not really make sense given that the data
> are just site numbers. But when I make it a constant I lose the site
> number information. How can I get a plot that shows all the locations
> with the same size bubble but displays also the site number
> information, say like a label ? It seems that the attribute data need
> to be numeric.
>
> Thank you for your time,
>
> Juliane
>
> -----Original Message----- From: Edzer Pebesma
> [mailto:edzer.pebesma at uni-muenster.de] Sent: Monday, October 01, 2012
> 4:55 PM To: Struve,Juliane; r-sig-geo at r-project.org Subject: Re:
> [R-sig-Geo] plotKML and time stamp
>
>
>
> On 10/01/2012 05:47 PM, Struve,Juliane wrote:
>> Edzer,
>>
>> Thank you for your help, this works nicely. When xy.sp are the
>> points and tc is the date/time stamp, why is df needed  ?
>>
>
> You can create an STI object with just the space-time points, leaving
> out the df, but plotKML does not (yet) have a method to display STI
> objects -- it wants STIDF with attributes. To work around this, you
> could try giving the attribute a constant value, if you don't have
> sth that varies.
>
>> Regards,
>>
>> Juliane
>>
>>
>> -----Original Message----- From: r-sig-geo-bounces at r-project.org
>> [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of Edzer
>> Pebesma Sent: Sunday, September 30, 2012 6:06 AM To:
>> r-sig-geo at r-project.org Subject: Re: [R-sig-Geo] plotKML and time
>> stamp
>>
>> Juliane, try
>>
>> xc = round(runif(10,-1,1)+27.2, 2) yc = round(runif(10,-1,1)+-82.5,
>> 2) xy = cbind(xc, yc) tc = Sys.time() + 3600 * (1:10) df =
>> data.frame(z1 = round(5 + rnorm(10), 2), z2 = 20:29)
>>
>> library(sp) xy.sp = SpatialPoints(xy) proj4string(xy.sp) =
>> CRS("+proj=longlat +datum=WGS84")
>>
>> library(spacetime) ST = STIDF(xy.sp, tc, df)
>>
>> library(plotKML) plotKML(ST)
>>
>> see also
>>
>> vignette(spacetime)
>>
>>
>> On 09/30/2012 03:39 AM, Struve,Juliane wrote:
>>> Dear list,
>>>
>>> After plotting this toy example on Google Earth I would like to
>>> add a date/time stamp to it so that the locations will be shown
>>> in sequence using the time slider. I am not quite sure how to
>>> approach this, can I add a date/time to my spatial points and
>>> then submit it to plotKML ? What format does the date/time stamp
>>> have to be in to be plotted on Google Earth ?
>>>
>>> Many thanks for any suggestions.
>>>
>>> Regards,
>>>
>>> Juliane
>>>
>>>
>>> xc = round(runif(10,-1,1)+27.2, 2) yc =
>>> round(runif(10,-1,1)+-82.5, 2) xy = cbind(xc, yc) xy.sp =
>>> SpatialPoints(xy) df = data.frame(z1 = round(5 + rnorm(10), 2),
>>> z2 = 20:29) SP.spdf = SpatialPointsDataFrame(xy.sp, df)
>>> plot(SP.spdf) #add a projection proj4string(SP.spdf) =
>>> CRS("+proj=longlat +datum=WGS84") plotKML(SP.spdf,kmz = FALSE)
>>>
>>> [[alternative HTML version deleted]]
>>>
>>> _______________________________________________ R-sig-Geo mailing
>>> list R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>> -- Edzer Pebesma Institute for Geoinformatics (ifgi), University of
>> M?nster Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
>> 8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
>> http://www.52north.org/geostatistics      e.pebesma at wwu.de
>>
>> _______________________________________________ R-sig-Geo mailing
>> list R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> -- Edzer Pebesma Institute for Geoinformatics (ifgi), University of
> M?nster Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
> 8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
> http://www.52north.org/geostatistics      e.pebesma at wwu.de
>
> _______________________________________________ R-sig-Geo mailing
> list R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo

From macqueen1 at llnl.gov  Thu Oct  4 20:31:40 2012
From: macqueen1 at llnl.gov (MacQueen, Don)
Date: Thu, 4 Oct 2012 18:31:40 +0000
Subject: [R-sig-Geo] as() and conversion from character to factor
Message-ID: <CC93241C.ADB6E%macqueen1@llnl.gov>

I just noticed that in the following sequence the final step to
SpatialGridDataFrame converts the character column to factor, whereas the
previous ones do not. Source the following little script, and it will
hopefully show what I'm seeing. Shouldn't this be consistent?

Thanks
-Don


require(sp)
require(maptools)

tstdf <- expand.grid(x=1:3, y=1:3)
tstdf$ch <- rep('a',nrow(tstdf))

tstsp <- tstdf
coordinates(tstsp) <- c('x','y')
proj4string(tstsp) <- CRS('+init=epsg:32610')

tstpx <- as(tstsp, "SpatialPixelsDataFrame")

tstgrd <- as(tstpx, "SpatialGridDataFrame")

print(class(tstdf$ch))
print(class(tstsp$ch))
print(class(tstpx$ch))
print(class(tstgrd$ch))


#########
I get:

> print(class(tstdf$ch))
[1] "character"
> print(class(tstsp$ch))
[1] "character"
> print(class(tstpx$ch))
[1] "character"
> print(class(tstgrd$ch))
[1] "factor"
#########







> sessionInfo()
R version 2.15.1 (2012-06-22)
Platform: x86_64-apple-darwin9.8.0/x86_64 (64-bit)

locale:
[1] C

attached base packages:
[1] stats     utils     datasets  grDevices graphics  methods   base

other attached packages:
[1] maptools_0.8-16 lattice_0.20-6  foreign_0.8-50  sp_1.0-0

loaded via a namespace (and not attached):
[1] grid_2.15.1 rmacq_1.1-8








-- 
Don MacQueen

Lawrence Livermore National Laboratory
7000 East Ave., L-627
Livermore, CA 94550
925-423-1062


From Matthew.Lay at riotinto.com  Thu Oct  4 23:37:03 2012
From: Matthew.Lay at riotinto.com (Lay, Matthew (RTA))
Date: Fri, 5 Oct 2012 07:37:03 +1000
Subject: [R-sig-Geo] plotKML with trajectories
In-Reply-To: <EEB8D9FFDEC470478852481841EB6342062681417C@RIOSYDEXMB6.corp.riotinto.org>
References: <EEB8D9FFDEC470478852481841EB6342062681417C@RIOSYDEXMB6.corp.riotinto.org>
Message-ID: <F8DB0E6E2DB19D42ACDBA4B987F8A57B05C10E415C@RIOSYDEXMB6.corp.riotinto.org>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121005/b8c944e5/attachment.pl>

From jstruve at ufl.edu  Fri Oct  5 00:31:46 2012
From: jstruve at ufl.edu (Struve,Juliane)
Date: Thu, 4 Oct 2012 22:31:46 +0000
Subject: [R-sig-Geo] Creating separate kmz files from several spatial
	datasets
Message-ID: <BFCE57D0BE7CBB42A581347DE375AF9A115591B8@UFEXCH-MBXN02.ad.ufl.edu>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121004/4d569c11/attachment.pl>

From r.turner at auckland.ac.nz  Fri Oct  5 00:42:28 2012
From: r.turner at auckland.ac.nz (Rolf Turner)
Date: Fri, 05 Oct 2012 11:42:28 +1300
Subject: [R-sig-Geo] simplify a polygon window
In-Reply-To: <1349353617.55223.YahooMailNeo@web140903.mail.bf1.yahoo.com>
References: <1349353617.55223.YahooMailNeo@web140903.mail.bf1.yahoo.com>
Message-ID: <506E10D4.8090702@auckland.ac.nz>

On 05/10/12 01:26, sara martino wrote:
> Hi,
>
> I am working with a point pattern whose window is a spatial polygon which describe the cost of Norway.
>
> I need to get a smoother version of such polygon which wraps the original one.
> I have tried to use the function
>
>> simplify.owin(my.owin,80000)
> but this does not work since some parts of the original polygon will lay outside the simplified one.
>
> Does anyone know how to do that?
> thanks a lot
This seems to me to be a hard problem; it is one with which I have struggled
off and on over the years with minimal success.  The simplify.owin() 
function
is a fairly blunt instrument with which to attack the problem. There 
exists a
somewhat sexier algorithm:

     Douglas, D. H. and Peucker, T. K., 1973. Algorithms for the Reduction
     of the Number of Points Required to Represent a Digitised Line
     or its Caricature, The Canadian Cartographer, 10(2): 112-122.

This is relatively easy to implement but for complicated boundaries it often
introduces self-intersections, which is no good at all.

A paper by Shin-Ting Wu and Mercedes Gonzales Marquez (2003) describes
a clever way of getting around the self-intersection.  They wrote C++ code
to implement their algorithm and kindly gave me permission to use their 
code and
incorporate it into an R function.  Sad to say I never got around to 
doing this.  Your
inquiry has reawakened my interest in this problem and I may shift it 
off the back-burner.
However it is very likely to take me quite a while to get the necessary 
work done,
even if the Wu-Marquez code is still available (which it may not be).  I 
am currently
making enquiries.

Overall there doesn't seem much that I can suggest to help you with your 
immediate
problem.  Sorry 'bout that.

     cheers,

         Rolf Turner

P. S. The complete citation for the Wu-Gonzales paper (in BibTeX form) is:
> @article{WuMarquez2003,
> author = {Shin-Ting Wu and Mercedes Roc\'{i}o Gonzales M\'{a}rquez},
> title = {A Non-Self-Intersection Douglas-Peucker Algorithm},
> journal ={Computer Graphics and Image Processing, Brazilian Symposium on},
> volume = {0},
> issn = {1530-1834},
> year = {2003},
> pages = {60},
> doi = {http://doi.ieeecomputersociety.org/10.1109/SIBGRA.2003.1240992},
> publisher = {IEEE Computer Society},
> address = {Los Alamitos, CA, USA},
> }
>


From Tom_Roche at pobox.com  Fri Oct  5 01:39:26 2012
From: Tom_Roche at pobox.com (Tom Roche)
Date: Thu, 04 Oct 2012 19:39:26 -0400
Subject: [R-sig-Geo] [raster newbie] regridding global latlong -> CONUS LCC
 with projectRaster
References: <CANtt_hysDu5y2Cb7xDCzt8Mtgfhad-jQOSkrOy8ZVmv1a90G3A@mail.gmail.com>
	<87626s1s2e.fsf@pobox.com>
	<CANtt_hw_Q77PHa4Qq1O8SDUD=FEiGB+iX4jLeqjrdR9rU_eD4w@mail.gmail.com>
	<87pq4zzhzx.fsf@pobox.com>
Message-ID: <87vcepyfgx.fsf@pobox.com>


summary: I present a (hopefully) replicable self-contained example of
practical projectRaster use, which

1 inputs from a netCDF file (gridded global lon-lat) with a single
  data variable (datavar)

2 creates an input raster from the input netCDF

3 creates a template raster from a second netCDF (gridded LCC over
  CONUS)

4 uses the input and template rasters to write an output netCDF.

I note results inline, about which I have 4 questions (the content of
which may be due to my lack of geospatial experience):

1 The data in the input NetCDF datavar and the input raster should be
  similar, no? Yet their respective mins and maxs differ by ~3
  magnitudes. Why?

2 In creating a template raster using projectExtent(), I get a
  "projected point(s) not finite" warning: is it important?

3 Why do the missing and fill values in the input and output netCDF
  differ?

4 Why are there negative values in the output netCDF, while there were
  none in either the input netCDF or the input raster?

details:

Tom Roche Wed, 03 Oct 2012 11:34:58 -0400
>> I'm getting very wrong output

Robert J. Hijmans Wed, 3 Oct 2012 20:27:07 -0700
> I do not know why you say the output is wrong. Why you would expect
> that input variables would have to be "preserved"

You're right, I should have worded that better. I also note that

* since the original problem (hang, due to user error) is fixed, this
  should be in a new thread.

* I should have used an extents template from the beginning (though
  projectExtent may still have a problem with my IOAPI file).

So I'll now present a (hopefully) replicable example, with results
inline, and raise specific concerns. The first part of the example is a
bash scriptlet that makes a test folder and populates it with some
downloadable files; the second part runs in an R console.

# begin example-------------------------------------------------------

# test folder, made/destroyed
export TEST_DIR='/tmp/projectRasterTest'
rm -fr ${TEST_DIR}
mkdir -p ${TEST_DIR}

# Input data is GEIA marine N2O emissions converted to netCDF:
# see code @ https://github.com/TomRoche/GEIA_to_netCDF

DATA_INPUT_URI='https://github.com/downloads/TomRoche/GEIA_to_netCDF/GEIA_N2O_oceanic.nc'
DATA_INPUT_FN="$(basename ${DATA_INPUT_URI})"
export DATA_INPUT_FP="${TEST_DIR}/${DATA_INPUT_FN}"
wget --no-check-certificate -c -O ${DATA_INPUT_FP} ${DATA_INPUT_URI}

export DATA_VAR_NAME='emi_n2o'  # see ncdump output
export DATA_INPUT_BAND='3'      # GEIA makes dim=TIME third

# output name is variant of input name

DATA_INPUT_FN_ROOT="${DATA_INPUT_FN%.*}"
DATA_INPUT_FN_EXT="${DATA_INPUT_FN#*.}"
DATA_OUTPUT_FN="${DATA_INPUT_FN_ROOT}_regrid.${DATA_INPUT_FN_EXT}"
export DATA_OUTPUT_FP="${TEST_DIR}/${DATA_OUTPUT_FN}"

# The template input is a copy of some meteorological data with 52
# "real" datavars. That data is in the IOAPI format, which is in this
# case basically a wrapper around netCDF. (IOAPI can be used with other
# data, and similar wrappers exist for various models.) I removed all
# but one of the datavars (with NCO 'ncks'), and renamed (with NCO
# 'ncrename') that datavar to have the same name as my input datavar
# (and hopefully my output datavar).

TEMPLATE_INPUT_URI='https://github.com/downloads/TomRoche/GEIA_to_netCDF/emis_mole_all_20080101_12US1_cmaq_cb05_soa_2008ab_08c.EXTENTS_INPUT.nc'
TEMPLATE_INPUT_FN="$(basename ${TEMPLATE_INPUT_URI})"
export TEMPLATE_INPUT_FP="${TEST_DIR}/${TEMPLATE_INPUT_FN}"
wget --no-check-certificate -c -O ${TEMPLATE_INPUT_FP} ${TEMPLATE_INPUT_URI}

export TEMPLATE_INPUT_BAND='1' # `ncks` makes dim=TSTEP first

# This script generates some basic statistics for a netCDF datavar.

STAT_SCRIPT_URI='https://github.com/TomRoche/GEIA_to_netCDF/raw/master/netCDF.stats.to.stdout.r'
STAT_SCRIPT_FN="$(basename ${STAT_SCRIPT_URI})"
export STAT_SCRIPT_FP="${TEST_DIR}/${STAT_SCRIPT_FN}"
wget --no-check-certificate -c -O ${STAT_SCRIPT_FP} ${STAT_SCRIPT_URI}

ls -alh ${TEST_DIR}/
R

# following done in R console-----------------------------------------

library(raster)
library(maptools)
# rgeos not available on my cluster, dunno if that's important
gpclibPermit()
library(rgdal)

test.dir <- Sys.getenv('TEST_DIR')
in.fp <- Sys.getenv('DATA_INPUT_FP')
in.band <- Sys.getenv('DATA_INPUT_BAND')
data.var.name <- Sys.getenv('DATA_VAR_NAME')
template.in.fp <- Sys.getenv('TEMPLATE_INPUT_FP')
template.band <- Sys.getenv('TEMPLATE_INPUT_BAND')
out.crs <- '+proj=lcc +lat_1=33 +lat_2=45 +lat_0=40 +lon_0=-97 +x=_0=-2556 +y_0=-1728'
out.fp <- Sys.getenv('DATA_OUTPUT_FP')
stat.script.fp <- Sys.getenv('STAT_SCRIPT_FP')
source(stat.script.fp)

system(sprintf('ncdump -h %s', in.fp))
# netcdf GEIA_N2O_oceanic {
# dimensions:
#         lon = 360 ;
#         lat = 180 ;
#         time = UNLIMITED ; // (1 currently)
# variables:
#         double lon(lon) ;
# ...
#         double lat(lat) ;
# ...
#         double time(time) ;
# ...
#         double emi_n2o(time, lat, lon) ;
#                 emi_n2o:units = "ton N2O-N/yr" ;
#                 emi_n2o:missing_value = -999. ;
#                 emi_n2o:long_name = "N2O emissions" ;
#                 emi_n2o:_FillValue = -999.f ;

# Note missing/fill values: more below.

netCDF.stats.to.stdout(netcdf.fp=in.fp, var.name=data.var.name)
# For /tmp/projectRasterTest/GEIA_N2O_oceanic.nc var=emi_n2o
#       cells=64800
#       obs=36143
#       min=5.96e-08
#       q1=30.4
#       med=67.7
#       mean=99.5
#       q3=140
#       max=1.17e+03

# Note min and max of the input, and that min > 0.

# make input raster
in.raster <- raster(in.fp, varname=data.var.name, band=in.band)
in.raster[] <- runif(ncell(in.raster))
in.raster
# class       : RasterLayer 
# dimensions  : 180, 360, 64800  (nrow, ncol, ncell)
# resolution  : 1, 1  (x, y)
# extent      : -180, 180, -90, 90  (xmin, xmax, ymin, ymax)
# coord. ref. : +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0 
# values      : in memory
# layer name  : N2O.emissions 
# min value   : 4.321872e-05 
# max value   : 0.9999898 
# z-value     : 0 

# Note min and max of the raster, and compare to
# min and max of the NetCDF (above) from which it's derived.

# My first question is, why is
# - min(raster) ~= 1000*min(netCDF)
# - max(netCDF) ~= 1000*min(raster)
# given that we have not yet regridded? Should not the values in the
# netCDF and the raster be the same at this point?

# make template raster
# truncate 'ncdump' to avoid IOAPI cruft
system(sprintf('ncdump -h %s | head -n 13', template.in.fp))
# netcdf emis_mole_all_20080101_12US1_cmaq_cb05_soa_2008ab_08c.EXTENTS_INPUT {
# dimensions:
#         TSTEP = UNLIMITED ; // (25 currently)
#         LAY = 1 ;
#         ROW = 299 ;
#         COL = 459 ;
# variables:
#         float emi_n2o(TSTEP, LAY, ROW, COL) ;
#                 emi_n2o:long_name = "XYL             " ;
#                 emi_n2o:units = "moles/s         " ;
#                 emi_n2o:var_desc = "Model species XYL                                                               " ;

# Hmm, template datavar lacks missing/fill values--
# might be cause of similar problems below.

template.in.raster <- raster(template.in.fp, varname=data.var.name, band=template.band)
template.raster <- projectExtent(template.in.raster, out.crs)
# Warning message:
# In projectExtent(template.in.raster, out.crs) :
#   158 projected point(s) not finite

# My second question is, is that "projected point(s) not finite" warning
# important? How should I interpret that? (I note 158/137241 is small.)

template.raster
# class       : RasterLayer 
# dimensions  : 299, 459, 137241  (nrow, ncol, ncell)
# resolution  : 53369.55, 56883.69  (x, y)
# extent      : -12246449, 12250173, -4532510, 12475715  (xmin, xmax, ymin, ymax)
# coord. ref. : +proj=lcc +lat_1=33 +lat_2=45 +lat_0=40 +lon_0=-97 +y_0=-1728 +ellps=WGS84 
# values      : none

# That looks good! Much more like the domain specification @
# https://github.com/TomRoche/cornbeltN2O/wiki/AQMEII-North-American-domain#wiki-EPA
# My only criticism is that, to me it seems odd to both
# report dimensions in nrow,ncol (which is basically y,x ... no?), but
# report resolution in x,y
# Am I missing something? (rhetorical question :-)

out.raster <-
  projectRaster(
    from=in.raster, to=template.raster, method='bilinear',
    overwrite=TRUE, progress='window', format='CDF', filename=out.fp)
system(sprintf('ls -alht %s', test.dir))
# it wrote the output netCDF: good!

system(sprintf('ncdump -h %s', out.fp))
# netcdf GEIA_N2O_oceanic_regrid {
# dimensions:
#       northing = 459 ;
#       easting = 299 ;
# variables:
#       double northing(northing) ;
#               northing:units = "meter" ;
#       double easting(easting) ;
#               easting:units = "meter" ;

# While changing the names of the dimension and coordinate variables
# is disconcerting, I can live with that. More important are the
# following points, in increasing order of concern:

#       float variable(easting, northing) ;
#               variable:units =  ;
#               variable:missing_value = -3.4e+38f ;
#               variable:_FillValue = -3.4e+38f ;
#               variable:long_name = "variable" ;
#               variable:projection = "+proj=lcc +lat_1=33 +lat_2=45 +lat_0=40 +lon_0=-97 +y_0=-1728 +ellps=WGS84" ;
#               variable:projection_format = "PROJ.4" ;
#               variable:min = -0.3366499f ;
#               variable:max = 1.313758f ;

# + the input datavar emi_n2o(time, lat, lon)
#   which ~=          emi_n2o(time, row, col), and
#   the output datavar variable(easting, northing)
#   which ~=           variable(row    , col     ) ;
#   this is good.

# - the output missing/fill values = -3.4e+38f while
#   the input  missing/fill values = -999.f ;
#   not a huge problem, but an annoyance.
#   So my third question is, why the change in missing/fill value?

netCDF.stats.to.stdout(netcdf.fp=out.fp, var.name='variable')
# For /tmp/projectRasterTest/GEIA_N2O_oceanic_regrid.nc var=variable
#       cells=137241
#       obs=137241
#       min=-0.337
#       q1=0.357
#       med=0.498
#       mean=0.499
#       q3=0.64
#       max=1.31

# My fourth question is my greatest concern: why are there negative
# values in the projectRaster output, while there were none in
# either the input netCDF (in.fp) or the input raster (in.raster)?

# end example---------------------------------------------------------

> 'raster' could also conceivably offer more functionality to specify
> the properties of the ncdf file you want (see the additional
> arguments for writing to a ncdf file in ?writeRaster), and
> suggestions are always welcome.

I will try to follow up on that in future. (I very much want an R
solution for regridding--fortran should not be necessary for data
assimilation!) But for now my main concern is this data; hence ...

Your assistance is appreciated, Tom Roche <Tom_Roche at pobox.com>


From Tom_Roche at pobox.com  Fri Oct  5 01:43:48 2012
From: Tom_Roche at pobox.com (Tom Roche)
Date: Thu, 04 Oct 2012 19:43:48 -0400
Subject: [R-sig-Geo] [raster newbie] projectRaster hangs regridding
 global latlong -> CONUS LCC
In-Reply-To: <CANtt_hysDu5y2Cb7xDCzt8Mtgfhad-jQOSkrOy8ZVmv1a90G3A@mail.gmail.com>
References: <CANtt_hysDu5y2Cb7xDCzt8Mtgfhad-jQOSkrOy8ZVmv1a90G3A@mail.gmail.com>
	<87626s1s2e.fsf@pobox.com>
	<CANtt_hw_Q77PHa4Qq1O8SDUD=FEiGB+iX4jLeqjrdR9rU_eD4w@mail.gmail.com>
	<87pq4zzhzx.fsf@pobox.com>
Message-ID: <87sj9tyf9n.fsf@pobox.com>


Tom Roche Wed, 03 Oct 2012 11:34:58 -0400
>> I'm getting very wrong output

Robert J. Hijmans Wed, 3 Oct 2012 20:27:07 -0700
> I do not know why you say the output is wrong. Why you would expect
> that input variables would have to be "preserved"

I should have worded that better. Moreover, since the original problem
(hang, due to user error) is fixed, I should continue in a new thread:
see

https://stat.ethz.ch/pipermail/r-sig-geo/2012-October/016258.html

thanks again, Tom Roche <Tom_Roche at pobox.com>


From rundel at gmail.com  Fri Oct  5 03:44:27 2012
From: rundel at gmail.com (Colin Rundel)
Date: Thu, 4 Oct 2012 21:44:27 -0400
Subject: [R-sig-Geo] simplify a polygon window
In-Reply-To: <506E10D4.8090702@auckland.ac.nz>
References: <1349353617.55223.YahooMailNeo@web140903.mail.bf1.yahoo.com>
	<506E10D4.8090702@auckland.ac.nz>
Message-ID: <63DB614A-D790-42D6-A81D-3B530220ED90@gmail.com>

The gSimplify function in rgeos wraps geos' implemention of the Douglas-Peucker algorithm so it should be easy to try it out for this particular problem, the topologyPreserve argument may also help (the geos documentation doesn't mention the specific implementation differences between the two algorithms but both are worth trying).

One additional option is to play with gBuffer to simplify the polygon by expanding the polygon by a small amount and then shrinking by a slightly smaller amount.

-Colin

On Oct 4, 2012, at 6:42 PM, Rolf Turner <r.turner at auckland.ac.nz> wrote:

> This seems to me to be a hard problem; it is one with which I have struggled
> off and on over the years with minimal success.  The simplify.owin() function
> is a fairly blunt instrument with which to attack the problem. There exists a
> somewhat sexier algorithm:
> 
>    Douglas, D. H. and Peucker, T. K., 1973. Algorithms for the Reduction
>    of the Number of Points Required to Represent a Digitised Line
>    or its Caricature, The Canadian Cartographer, 10(2): 112-122.
> 
> This is relatively easy to implement but for complicated boundaries it often
> introduces self-intersections, which is no good at all.
> 
> A paper by Shin-Ting Wu and Mercedes Gonzales Marquez (2003) describes
> a clever way of getting around the self-intersection.  They wrote C++ code
> to implement their algorithm and kindly gave me permission to use their code and
> incorporate it into an R function.  Sad to say I never got around to doing this.  Your
> inquiry has reawakened my interest in this problem and I may shift it off the back-burner.
> However it is very likely to take me quite a while to get the necessary work done,
> even if the Wu-Marquez code is still available (which it may not be).  I am currently
> making enquiries.
> 
> Overall there doesn't seem much that I can suggest to help you with your immediate
> problem.  Sorry 'bout that.
> 
>    cheers,
> 
>        Rolf Turner


From Ahmed.Hafi at daff.gov.au  Fri Oct  5 03:53:09 2012
From: Ahmed.Hafi at daff.gov.au (Hafi, Ahmed)
Date: Fri, 5 Oct 2012 11:53:09 +1000
Subject: [R-sig-Geo] flipVertical [SEC=UNCLASSIFIED]
Message-ID: <4F21D31A72ADA24583E934F68262EBCE05496BA2@ACT001CL03EX02.agdaff.gov.au>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121005/3437e4f5/attachment.pl>

From Roger.Bivand at nhh.no  Fri Oct  5 04:09:18 2012
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 5 Oct 2012 04:09:18 +0200 (CEST)
Subject: [R-sig-Geo] flipVertical [SEC=UNCLASSIFIED]
In-Reply-To: <4F21D31A72ADA24583E934F68262EBCE05496BA2@ACT001CL03EX02.agdaff.gov.au>
References: <4F21D31A72ADA24583E934F68262EBCE05496BA2@ACT001CL03EX02.agdaff.gov.au>
Message-ID: <alpine.LRH.2.02.1210050407230.11137@reclus.nhh.no>

On Fri, 5 Oct 2012, Hafi, Ahmed wrote:

> Hi ,
>
>
>
> I am trying to flip a SpatialPointDataFrame vertically. The SP help on
> flipVertical says that you can flip a SpatialPointDataFrame or
> SpatialGridDataFrame. But when I tried using a SpatialPointDataFrame as
> the argument, R comes up with an error message saying that it has to be
> a SpatialGridDataFrame. I am trying to overlay a SpatialPolygonDataFrame
> on SpatialPointDataFrame and counts the number of points falling into
> each polygon. Before I do that I need to flip the points data frame
> vertically. I would appreciate very much if you could help me out by
> telling me what I am doing wrong or is there a better a way of getting
> the overlay job done, given that I need to flip the points data frame.
>

?elide in maptools, possibly passing through the bounding box of the grid. 
To follow up, include a self-contained example (say using meuse and 
meuse.grid).

Roger

>
>
> Thanks
>
>
>
> Ahmed Hafi
>
> Australian Bureau of Agricultural and Resource Economics and Sciences
> (ABARES)
>
>
>
>
>
>
>
> ------
> ------
> IMPORTANT - This email and any attachments have been issued by the Australian Government Department of Agriculture, Fisheries and Forestry (DAFF). The material transmitted is for the use of the intended recipient only and may contain confidential, legally privileged, copyright or personal information. You should not copy, use or disclose it without authorisation from DAFF. It is your responsibility to check any attachments for viruses and defects before opening or forwarding them.
>
> If you are not an intended recipient, please contact the sender of this email at once by return email and then delete both messages. Unintended recipients must not copy, use, disclose, rely on or publish this email or attachments. DAFF is not liable for any loss or damage resulting from unauthorised use or dissemination of, or any reliance on, this email or attachments.
>
> If you have received this e-mail as part of a valid mailing list and no longer want to receive a message such as this one, advise the sender by return e-mail accordingly.
>
> This notice should not be deleted or altered.
>
> ------
>
>
> ------
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From r.hijmans at gmail.com  Fri Oct  5 04:27:24 2012
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Thu, 4 Oct 2012 19:27:24 -0700
Subject: [R-sig-Geo] [raster newbie] regridding global latlong -> CONUS
 LCC with projectRaster
In-Reply-To: <87vcepyfgx.fsf@pobox.com>
References: <CANtt_hysDu5y2Cb7xDCzt8Mtgfhad-jQOSkrOy8ZVmv1a90G3A@mail.gmail.com>
	<87626s1s2e.fsf@pobox.com>
	<CANtt_hw_Q77PHa4Qq1O8SDUD=FEiGB+iX4jLeqjrdR9rU_eD4w@mail.gmail.com>
	<87pq4zzhzx.fsf@pobox.com> <87vcepyfgx.fsf@pobox.com>
Message-ID: <CANtt_hwYr4ptU2Yh9uRcFNVboF-wZwpOLeYqZXXF4yYX3uck7Q@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121004/43807df7/attachment.pl>

From j2kennel at gmail.com  Fri Oct  5 04:58:46 2012
From: j2kennel at gmail.com (Jonathan)
Date: Thu, 4 Oct 2012 19:58:46 -0700 (PDT)
Subject: [R-sig-Geo] sp 1.0-0 package: sp.polygons in levelplot behaviour
Message-ID: <1349405926675-7581148.post@n2.nabble.com>

Hello all, 

I updated my version of sp to 1.0-0 today and am getting a different
behaviour when using levelplot and sp.polygons.  The polygons do not appear
to be terminating when I run the following code.  Anyone else have this
problem?  It does seem to work if I use spplot though.  I have previous code
that uses lattice::levelplot and rasterVis::levelplot which I can modify to
spplot but would rather not have to.

library(sp)
library(maptools)
library(lattice)
library(raster)
library(rasterVis)

nc <- readShapePoly(system.file("shapes/sids.shp", package="maptools")[1],
proj4string=CRS("+proj=longlat +datum=NAD27"))
r <- raster(nc)
r[] <- 1
levelplot(r,
              panel = function(x,y,z,col.regions,subscripts,region,...){
                 panel.levelplot.raster(x, y, z, subscripts=subscripts)
                 sp.polygons(nc)
               }
)


Thank you,
Jonathan

sessionInfo()
R version 2.15.1 (2012-06-22)
Platform: x86_64-unknown-linux-gnu (64-bit)

locale:
 [1] LC_CTYPE=en_CA.UTF-8       LC_NUMERIC=C              
LC_TIME=en_CA.UTF-8        LC_COLLATE=en_CA.UTF-8    
LC_MONETARY=en_CA.UTF-8   
 [6] LC_MESSAGES=en_CA.UTF-8    LC_PAPER=C                 LC_NAME=C                 
LC_ADDRESS=C               LC_TELEPHONE=C            
[11] LC_MEASUREMENT=en_CA.UTF-8 LC_IDENTIFICATION=C       

attached base packages:
[1] grid      stats     graphics  grDevices utils     datasets  methods  
base     

other attached packages:
[1] rasterVis_0.11-01   hexbin_1.26.0       latticeExtra_0.6-24
RColorBrewer_1.0-5  raster_2.0-12       maptools_0.8-16     lattice_0.20-10    
[8] foreign_0.8-50      sp_1.0-0           

loaded via a namespace (and not attached):
[1] tools_2.15.1 zoo_1.7-7   



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/sp-1-0-0-package-sp-polygons-in-levelplot-behaviour-tp7581148.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From hengl at spatial-analyst.net  Fri Oct  5 10:30:38 2012
From: hengl at spatial-analyst.net (Tomislav Hengl)
Date: Fri, 05 Oct 2012 10:30:38 +0200
Subject: [R-sig-Geo] plotKML and time stamp
In-Reply-To: <BFCE57D0BE7CBB42A581347DE375AF9A11559067@UFEXCH-MBXN02.ad.ufl.edu>
References: <BFCE57D0BE7CBB42A581347DE375AF9A11558628@UFEXCH-MBXN02.ad.ufl.edu>
	<5068197D.90905@uni-muenster.de>
	<BFCE57D0BE7CBB42A581347DE375AF9A115588BE@UFEXCH-MBXN02.ad.ufl.edu>
	<506A0325.2070101@uni-muenster.de>
	<BFCE57D0BE7CBB42A581347DE375AF9A11558A7A@UFEXCH-MBXN02.ad.ufl.edu>
	<506C2446.9040308@spatial-analyst.net>
	<BFCE57D0BE7CBB42A581347DE375AF9A11559067@UFEXCH-MBXN02.ad.ufl.edu>
Message-ID: <506E9AAE.7000005@spatial-analyst.net>


On 04/10/2012 15:00, Struve,Juliane wrote:
> Hello,
>
> Thanks a lot for replying. I can't run this script, the last line gives me an error:
>
> KML file header opened for parsing...
> Parsing to KML...
> Closing  HRtemp08_jan.kml
> Error in kml_compress(file.name = file.name) :
>    KMZ generation failed. Wrong command passed to 'zip = ... option'.
>
> What do I need to change ?

kmz = FALSE

Looks like your 'system' has no zip option. See:

 > Sys.getenv("R_ZIPCMD", "zip")

https://r-forge.r-project.org/scm/viewvc.php/pkg/R/kml_compress.R?view=markup&root=plotkml

>
> Regards,
>
> Juliane
>
> sessionInfo()
>
> R version 2.15.0 (2012-03-30)
> Platform: i386-pc-mingw32/i386 (32-bit)
>
> locale:
> [1] LC_COLLATE=English_United States.1252
> [2] LC_CTYPE=English_United States.1252
> [3] LC_MONETARY=English_United States.1252
> [4] LC_NUMERIC=C
> [5] LC_TIME=English_United States.1252
>
> attached base packages:
> [1] splines   stats     graphics  grDevices utils     datasets  methods
> [8] base
>
> other attached packages:
>   [1] plotKML_0.2-5      dismo_0.7-23       scales_0.2.2       aqp_1.2-7
>   [5] gstat_1.0-14       spacetime_0.8-0    xts_0.8-6          zoo_1.7-7
>   [9] Hmisc_3.9-3        survival_2.36-12   RColorBrewer_1.0-5 stringr_0.6.1
> [13] colorRamps_2.3     plotrix_3.4-5      colorspace_1.1-1   plyr_1.7.1
> [17] raster_2.0-12      pixmap_0.4-11      XML_3.9-4.1        rgdal_0.7-19
> [21] sp_0.9-99
>
> loaded via a namespace (and not attached):
> [1] cluster_1.14.2  dichromat_1.2-4 grid_2.15.0     labeling_0.1
> [5] lattice_0.20-6  munsell_0.4     reshape_0.8.4   tools_2.15.0
>
>
> -----Original Message-----
> From: Tomislav Hengl [mailto:hengl at spatial-analyst.net]
> Sent: Wednesday, October 03, 2012 7:41 AM
> To: Struve,Juliane
> Cc: Edzer Pebesma; r-sig-geo at r-project.org
> Subject: Re: [R-sig-Geo] plotKML and time stamp
>
>
> try:
>
>   > library(plotKML)
>   > data(HRtemp08)
> # format the time column:
>   > HRtemp08$ctime <- as.POSIXct(HRtemp08$DATE, format="%Y-%m-%dT%H:%M:%SZ")
> ## Not run: # create a STIDF object:
>   > library(spacetime)
>   > sp <- SpatialPoints(HRtemp08[,c("Lon","Lat")])
>   > proj4string(sp) <- CRS("+proj=longlat +datum=WGS84")
>   > HRtemp08.st <- STIDF(sp, time = HRtemp08$ctime, data =
> HRtemp08[,c("NAME","TEMP")])
> # write to a KML file:
>   > HRtemp08_jan <- HRtemp08.st[1:500]
>   > shape = "http://maps.google.com/mapfiles/kml/pal2/icon18.png"
>   > kml(HRtemp08_jan, dtime = 24*3600, labels = TEMP, shape = shape,
> colour = TEMP, colour_scale=rep("#FFFF00", 2), kmz = TRUE)
>
> See also:
>
> http://plotkml.r-forge.r-project.org/tutorial.php#sp_classes
> http://plotkml.r-forge.r-project.org/layer.STIDF.html
>
> Note that, when using 'kml' method, you need to open the KML file yourself.
>
> T. Hengl
>
> On 02/10/2012 15:01, Struve,Juliane wrote:
>> Hello,
>>
>> The attribute I am interested in is a site number. When I use the
>> site number as attribute data the size of the bubble is proportional
>> to the number, which does not really make sense given that the data
>> are just site numbers. But when I make it a constant I lose the site
>> number information. How can I get a plot that shows all the locations
>> with the same size bubble but displays also the site number
>> information, say like a label ? It seems that the attribute data need
>> to be numeric.
>>
>> Thank you for your time,
>>
>> Juliane
>>
>> -----Original Message----- From: Edzer Pebesma
>> [mailto:edzer.pebesma at uni-muenster.de] Sent: Monday, October 01, 2012
>> 4:55 PM To: Struve,Juliane; r-sig-geo at r-project.org Subject: Re:
>> [R-sig-Geo] plotKML and time stamp
>>
>>
>>
>> On 10/01/2012 05:47 PM, Struve,Juliane wrote:
>>> Edzer,
>>>
>>> Thank you for your help, this works nicely. When xy.sp are the
>>> points and tc is the date/time stamp, why is df needed  ?
>>>
>>
>> You can create an STI object with just the space-time points, leaving
>> out the df, but plotKML does not (yet) have a method to display STI
>> objects -- it wants STIDF with attributes. To work around this, you
>> could try giving the attribute a constant value, if you don't have
>> sth that varies.
>>
>>> Regards,
>>>
>>> Juliane
>>>
>>>
>>> -----Original Message----- From: r-sig-geo-bounces at r-project.org
>>> [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of Edzer
>>> Pebesma Sent: Sunday, September 30, 2012 6:06 AM To:
>>> r-sig-geo at r-project.org Subject: Re: [R-sig-Geo] plotKML and time
>>> stamp
>>>
>>> Juliane, try
>>>
>>> xc = round(runif(10,-1,1)+27.2, 2) yc = round(runif(10,-1,1)+-82.5,
>>> 2) xy = cbind(xc, yc) tc = Sys.time() + 3600 * (1:10) df =
>>> data.frame(z1 = round(5 + rnorm(10), 2), z2 = 20:29)
>>>
>>> library(sp) xy.sp = SpatialPoints(xy) proj4string(xy.sp) =
>>> CRS("+proj=longlat +datum=WGS84")
>>>
>>> library(spacetime) ST = STIDF(xy.sp, tc, df)
>>>
>>> library(plotKML) plotKML(ST)
>>>
>>> see also
>>>
>>> vignette(spacetime)
>>>
>>>
>>> On 09/30/2012 03:39 AM, Struve,Juliane wrote:
>>>> Dear list,
>>>>
>>>> After plotting this toy example on Google Earth I would like to
>>>> add a date/time stamp to it so that the locations will be shown
>>>> in sequence using the time slider. I am not quite sure how to
>>>> approach this, can I add a date/time to my spatial points and
>>>> then submit it to plotKML ? What format does the date/time stamp
>>>> have to be in to be plotted on Google Earth ?
>>>>
>>>> Many thanks for any suggestions.
>>>>
>>>> Regards,
>>>>
>>>> Juliane
>>>>
>>>>
>>>> xc = round(runif(10,-1,1)+27.2, 2) yc =
>>>> round(runif(10,-1,1)+-82.5, 2) xy = cbind(xc, yc) xy.sp =
>>>> SpatialPoints(xy) df = data.frame(z1 = round(5 + rnorm(10), 2),
>>>> z2 = 20:29) SP.spdf = SpatialPointsDataFrame(xy.sp, df)
>>>> plot(SP.spdf) #add a projection proj4string(SP.spdf) =
>>>> CRS("+proj=longlat +datum=WGS84") plotKML(SP.spdf,kmz = FALSE)
>>>>
>>>> [[alternative HTML version deleted]]
>>>>
>>>> _______________________________________________ R-sig-Geo mailing
>>>> list R-sig-Geo at r-project.org
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>
>>> -- Edzer Pebesma Institute for Geoinformatics (ifgi), University of
>>> M?nster Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
>>> 8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
>>> http://www.52north.org/geostatistics      e.pebesma at wwu.de
>>>
>>> _______________________________________________ R-sig-Geo mailing
>>> list R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>> -- Edzer Pebesma Institute for Geoinformatics (ifgi), University of
>> M?nster Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
>> 8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
>> http://www.52north.org/geostatistics      e.pebesma at wwu.de
>>
>> _______________________________________________ R-sig-Geo mailing
>> list R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>


From b.rowlingson at lancaster.ac.uk  Fri Oct  5 11:10:38 2012
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Fri, 5 Oct 2012 10:10:38 +0100
Subject: [R-sig-Geo] simplify a polygon window
In-Reply-To: <b4666c0f3a0a4d12b80f98b93397dff5@EX-0-HT0.lancs.local>
References: <1349353617.55223.YahooMailNeo@web140903.mail.bf1.yahoo.com>
	<506E10D4.8090702@auckland.ac.nz>
	<b4666c0f3a0a4d12b80f98b93397dff5@EX-0-HT0.lancs.local>
Message-ID: <CANVKczMHgRi2=8p5CexZwnA66tRs58FMjYikaZfOqg1UCpusxQ@mail.gmail.com>

On Fri, Oct 5, 2012 at 2:44 AM, Colin Rundel <rundel at gmail.com> wrote:
> The gSimplify function in rgeos wraps geos' implemention of the Douglas-Peucker algorithm so it should be easy to try it out for this particular problem, the topologyPreserve argument may also help (the geos documentation doesn't mention the specific implementation differences between the two algorithms but both are worth trying).
>
> One additional option is to play with gBuffer to simplify the polygon by expanding the polygon by a small amount and then shrinking by a slightly smaller amount.

 The Douglas-Peucker algorithm applied to polygon sections will still
create polygons that don't totally enclose the original polygon -
which was the original posters problem.

I wrote something on simplification using alpha-shapes and bunged it
up to RPubs:

http://rpubs.com/geospacedman/alphasimple

Barry


From marcelino.delacruz at upm.es  Fri Oct  5 13:13:44 2012
From: marcelino.delacruz at upm.es (Marcelino de la Cruz)
Date: Fri, 05 Oct 2012 13:13:44 +0200
Subject: [R-sig-Geo] simplify a polygon window
In-Reply-To: <1349357094.12892.YahooMailNeo@web140903.mail.bf1.yahoo.com
 >
References: <1317a10f813f4a4bbcac24226c0c9f9b@EX-1-HT0.lancs.local>
	<CANVKczPN7h4hS=cBg4yrNwFUdHYFZh+73d-T7tCsAsuUCgm98Q@mail.gmail.com>
	<1349357094.12892.YahooMailNeo@web140903.mail.bf1.yahoo.com>
Message-ID: <201210051114.q95BE4bs004256@smtp.upm.es>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121005/2ac576f1/attachment.pl>

From Sytze.deBruin at wur.nl  Fri Oct  5 14:13:16 2012
From: Sytze.deBruin at wur.nl (Bruin, Sytze de)
Date: Fri, 5 Oct 2012 12:13:16 +0000
Subject: [R-sig-Geo] variogramST does not like STIDF
Message-ID: <51521FE329A36B40876F00ED90C7B8A301CC91BD@SCOMP0937.wurnet.nl>

Hi Edzer,

Thanks for your answer!
After the lengthy computation of the variogram (> 65000 observations) on the data that were coerced from STIDF to STSDF, a warning was issued that fixed distances were assumed, which may indicate that I did something wrong. If so, a separate method for STIDF data would be welcome! 
In the meantime, I implemented a primitive R script computing an ST variogram for data irregularly spaced in space and time, allowing different lag boundaries for space and time (which is still running).

Best,
Sytze de Bruin

From mintibezabih at gmail.com  Fri Oct  5 14:34:06 2012
From: mintibezabih at gmail.com (alemante zd)
Date: Fri, 5 Oct 2012 13:34:06 +0100
Subject: [R-sig-Geo] excel to ascii
Message-ID: <CAJfxP+rzaWhKFDdAMaMxLrPprp_4GOLykq0Yw3c3iFOJX=pyjw@mail.gmail.com>

Dear all,

Is here anyway, (perhaps outside R) to convert an excel file into an
ascii one? I was trying to read one into R but I could not.
many thanks
minti

On 10/4/12, Bruin, Sytze de <Sytze.deBruin at wur.nl> wrote:
> Dear all,
>
>
>
> I intend to compute a space-time variogram from irregularly spaced data. I
> created a STIDF object for that (package stacetime), but gstat's function
> "variogram" only seems to only accept STSDF or STFDF objects as data. The
> following message was generated: Error: is(data, "STFDF") || is(data,
> "STSDF") is not TRUE. A solution would be to first coerce the STIDF to STSDF
> --which is wat I am doing-- but is there a reason why variogram does not
> accept STIDF?
>
>
>
> Thanks,
>
> Sytze
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From friedman.steve at gmail.com  Fri Oct  5 14:36:10 2012
From: friedman.steve at gmail.com (Steve Friedman)
Date: Fri, 5 Oct 2012 08:36:10 -0400
Subject: [R-sig-Geo] excel to ascii
In-Reply-To: <CAJfxP+rzaWhKFDdAMaMxLrPprp_4GOLykq0Yw3c3iFOJX=pyjw@mail.gmail.com>
References: <CAJfxP+rzaWhKFDdAMaMxLrPprp_4GOLykq0Yw3c3iFOJX=pyjw@mail.gmail.com>
Message-ID: <CADkZ+_WcSzg0ibH7SOhMyPAF7sGPHuhz-1jh9MxAX=CJWNWAmQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121005/770023d1/attachment.pl>

From hengl at spatial-analyst.net  Fri Oct  5 14:43:04 2012
From: hengl at spatial-analyst.net (Tomislav Hengl)
Date: Fri, 05 Oct 2012 14:43:04 +0200
Subject: [R-sig-Geo] Fwd: Re:  plotKML with trajectories
In-Reply-To: <506E95E8.8020400@spatial-analyst.net>
References: <506E95E8.8020400@spatial-analyst.net>
Message-ID: <506ED5D8.7030801@spatial-analyst.net>



On 04/10/2012 23:37, Lay, Matthew (RTA) wrote:
> Hi,
>
> I'm using code from http://plotkml.r-forge.r-project.org/tutorial.php
> :
>
> library(fossil);library(adehabitat);library(ade4);library(plotKML)
> data(gpxbtour) gpxbtour$ctime <- as.POSIXct(gpxbtour$time,
> format="%Y-%m-%dT%H:%M:%SZ") coordinates(gpxbtour) <- ~lon+lat
> proj4string(gpxbtour) <- CRS("+proj=longlat +datum=WGS84") xy <-
> as.list(data.frame(t(coordinates(gpxbtour)))) gpxbtour$dist.km <-
> sapply(xy, function(x) { deg.dist(long1=x[1], lat1=x[2],
> long2=xy[[1]][1], lat2=xy[[1]][2]) } )> library(spacetime) gpx.ltraj
> <- as.ltraj(coordinates(gpxbtour), gpxbtour$ctime, id = "th") gpx.st
> <- as(gpx.ltraj, "STTDF") gpx.st$speed <- gpxbtour$speed
> gpx.st at sp@proj4string<mailto:gpx.st at sp@proj4string> <-
> CRS("+proj=longlat +datum=WGS84") plotKML(gpx.st,
> colour="speed",kmz=FALSE)
>
> Which runs, but produces a different image than the one on the web
> page.
>
> The key difference is that the web image has a playback widget and
> mine does not.
>
> The reason the difference matters to me is that I want to use the
> play back feature to show how the system evolves with time.
>
> My question is "how do I get the play back facility to appear?"

Good question. Open the KML folder in Google Earth and select the
trajectory/path object as active layer. This will open the playback
widget on the Google Earth screen.

Google Earth sometimes 'hides' it's functionality, but it is there  ;)

>
> Also, I would like to show only the latest point in charts like this,
> rather than have the tails showing all previous positions. This is
> because I am working towards showing multiple vehicles, with
> crisscrossing paths, and the tails turn into a web. The example on
> the web page above the one I have shown has a good example of where
> the whole history of a trajectory is shown, not just the most recent
> point.
>
> (beginner by the way!)
>
>
> This email is confidential and may also be privileged.  If you are
> not the intended recipient, please notify us immediately and delete
> this message from your system without first printing or copying it.
> Any personal data in this email (including any attachments) must be
> handled in accordance with the Rio Tinto Group Data Protection Policy
> and all applicable data protection laws.
>

Interesting signature. Delete from R-sig-geo?

T. Hengl
http://www.wewur.wur.nl/popups/vcard.aspx?id=HENGL001

>
>
> [[alternative HTML version deleted]]
>
> _______________________________________________ R-sig-Geo mailing
> list R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From istazahn at gmail.com  Fri Oct  5 15:14:52 2012
From: istazahn at gmail.com (Ista Zahn)
Date: Fri, 5 Oct 2012 09:14:52 -0400
Subject: [R-sig-Geo] excel to ascii
In-Reply-To: <CADkZ+_WcSzg0ibH7SOhMyPAF7sGPHuhz-1jh9MxAX=CJWNWAmQ@mail.gmail.com>
References: <CAJfxP+rzaWhKFDdAMaMxLrPprp_4GOLykq0Yw3c3iFOJX=pyjw@mail.gmail.com>
	<CADkZ+_WcSzg0ibH7SOhMyPAF7sGPHuhz-1jh9MxAX=CJWNWAmQ@mail.gmail.com>
Message-ID: <CA+vqiLFpunanMgCvuW9Pr3B44KnX6fNmKSKCxb6Lz_-N6Ocm9w@mail.gmail.com>

On Fri, Oct 5, 2012 at 8:36 AM, Steve Friedman <friedman.steve at gmail.com> wrote:
> Save the file as a csv file in excellent.

What is excellent?

You could also use LibreOffice. Or, if you want to do it in R there
are several packages for this, including XLConnect, xlsReadWrite, and
xlsx

Best,
Ista

> On Oct 5, 2012 8:34 AM, "alemante zd" <mintibezabih at gmail.com> wrote:
>
>> Dear all,
>>
>> Is here anyway, (perhaps outside R) to convert an excel file into an
>> ascii one? I was trying to read one into R but I could not.
>> many thanks
>> minti
>>
>> On 10/4/12, Bruin, Sytze de <Sytze.deBruin at wur.nl> wrote:
>> > Dear all,
>> >
>> >
>> >
>> > I intend to compute a space-time variogram from irregularly spaced data.
>> I
>> > created a STIDF object for that (package stacetime), but gstat's function
>> > "variogram" only seems to only accept STSDF or STFDF objects as data. The
>> > following message was generated: Error: is(data, "STFDF") || is(data,
>> > "STSDF") is not TRUE. A solution would be to first coerce the STIDF to
>> STSDF
>> > --which is wat I am doing-- but is there a reason why variogram does not
>> > accept STIDF?
>> >
>> >
>> >
>> > Thanks,
>> >
>> > Sytze
>> >
>> > _______________________________________________
>> > R-sig-Geo mailing list
>> > R-sig-Geo at r-project.org
>> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> >
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From jefunes at gmail.com  Fri Oct  5 17:45:11 2012
From: jefunes at gmail.com (Jose Funes)
Date: Fri, 5 Oct 2012 11:45:11 -0400
Subject: [R-sig-Geo] as.3dpoints
Message-ID: <CAG1eJiEQ7jeZOPY7mMsfe2WmnwSYnZM2x5TmLiMfjd_q5dm-WQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121005/128ca5b3/attachment.pl>

From smithtiffanyt at gmail.com  Fri Oct  5 18:42:13 2012
From: smithtiffanyt at gmail.com (Tiffany Smith)
Date: Fri, 5 Oct 2012 12:42:13 -0400
Subject: [R-sig-Geo] Antw: Writing Raster values to .txt file
In-Reply-To: <CANtt_hwFZuC_3ARF1ktEdTss-MahVt-W3kE3GOopKwmuutrDEg@mail.gmail.com>
References: <506CE0DD0200002700016028@gwia2.boku.ac.at>
	<CANtt_hwFZuC_3ARF1ktEdTss-MahVt-W3kE3GOopKwmuutrDEg@mail.gmail.com>
Message-ID: <98F237BD-597E-42C2-A20D-A41DA7A4A11B@gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121005/bda90e0c/attachment.pl>

From jefunes at gmail.com  Fri Oct  5 20:44:23 2012
From: jefunes at gmail.com (Jose Funes)
Date: Fri, 5 Oct 2012 14:44:23 -0400
Subject: [R-sig-Geo] Points STIKhat
Message-ID: <CAG1eJiHK-QOPtiNFDUJYcoKyVfStBzkWRjZ4krAo3RjMWEkX=A@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121005/24ca9afd/attachment.pl>

From faranakfathi at gmail.com  Fri Oct  5 22:20:28 2012
From: faranakfathi at gmail.com (Faranak)
Date: Fri, 5 Oct 2012 13:20:28 -0700 (PDT)
Subject: [R-sig-Geo] How to interpret the pair correlation function?
Message-ID: <1349468428415-7581160.post@n2.nabble.com>

Hi all,

I plotted a "pair correlation function" for my data as followes:
<http://r-sig-geo.2731867.n2.nabble.com/file/n7581160/pair_correlation.jpeg> 
It shows for r between approximately 0.3 to 0.7 the value of g(r) is greater
than 1 which shows clustering. But what does that mean? How can I interpret
this diagram?



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/How-to-interpret-the-pair-correlation-function-tp7581160.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From Roger.Bivand at nhh.no  Sat Oct  6 05:39:33 2012
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sat, 6 Oct 2012 05:39:33 +0200 (CEST)
Subject: [R-sig-Geo] Points STIKhat
In-Reply-To: <CAG1eJiHK-QOPtiNFDUJYcoKyVfStBzkWRjZ4krAo3RjMWEkX=A@mail.gmail.com>
References: <CAG1eJiHK-QOPtiNFDUJYcoKyVfStBzkWRjZ4krAo3RjMWEkX=A@mail.gmail.com>
Message-ID: <alpine.LRH.2.02.1210060536510.15421@reclus.nhh.no>

On Fri, 5 Oct 2012, Jose Funes wrote:

> Dear all,
> While running the STIKhat function i got the following error.
>
> Traceback:
> 1: .Fortran("stikfunction", as.double(ptsx), as.double(ptsy),
> as.double(ptst),     as.integer(npt), as.double(polyx), as.double(polyy),
> as.integer(np),     as.double(dist), as.integer(ndist), as.double(times),
> as.integer(ntimes),     as.double(bsupt), as.double(binft),
> as.double(lambda), as.integer(infd),     as.integer(edg), (hkhat))
> 2: STIKhat(xyt = sdn3d5, s.region = sdn_borders, dist = u, times = v,
> infectious = TRUE)
> Error in STIKhat(xyt = sdn3d5, s.region = sdn_borders, dist = u, times =
> v,  :
>  caught access violation - continue with care
> #########################################################
> sud <-read.csv("sud.txt")
> sudbrdrs <-read.csv("sudborders.txt")
> sdn3d <- as.3dpoints(sud$Longitude,sud$Latitude,sud$EVENT_DATE)
> plot(sdn3d)
> sdn_borders <-cbind(sdnbrdrs$x,sdnbrdrs$y)
> u <- seq(0,10,by=1)
> v <- seq(0,15,by=1)
> sudanstik <-
> STIKhat(xyt=sdn3d,s.region=sudbrdrs,dist=u,times=v,infectious=TRUE)
> ########################################################
> Thanks,
> Jose

Please provide the output of sessionInfo() and your data set on a URL for 
download - or a reprodicible example with a built-in data set. You did not 
mention which package the function called belongs to. I suspect that this 
is in splancs, and that the polygon boundary is not a simple geometry.

Roger

>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From mintibezabih at gmail.com  Sat Oct  6 14:41:10 2012
From: mintibezabih at gmail.com (alemante zd)
Date: Sat, 6 Oct 2012 13:41:10 +0100
Subject: [R-sig-Geo] excel to ascii
In-Reply-To: <CA+vqiLFpunanMgCvuW9Pr3B44KnX6fNmKSKCxb6Lz_-N6Ocm9w@mail.gmail.com>
References: <CAJfxP+rzaWhKFDdAMaMxLrPprp_4GOLykq0Yw3c3iFOJX=pyjw@mail.gmail.com>
	<CADkZ+_WcSzg0ibH7SOhMyPAF7sGPHuhz-1jh9MxAX=CJWNWAmQ@mail.gmail.com>
	<CA+vqiLFpunanMgCvuW9Pr3B44KnX6fNmKSKCxb6Lz_-N6Ocm9w@mail.gmail.com>
Message-ID: <CAJfxP+qzP11=gempjyvrAFoMJEWjHCDDFAOry+w64cL8h3vYSw@mail.gmail.com>

thanks both
minti

On 10/5/12, Ista Zahn <istazahn at gmail.com> wrote:
> On Fri, Oct 5, 2012 at 8:36 AM, Steve Friedman <friedman.steve at gmail.com>
> wrote:
>> Save the file as a csv file in excellent.
>
> What is excellent?
>
> You could also use LibreOffice. Or, if you want to do it in R there
> are several packages for this, including XLConnect, xlsReadWrite, and
> xlsx
>
> Best,
> Ista
>
>> On Oct 5, 2012 8:34 AM, "alemante zd" <mintibezabih at gmail.com> wrote:
>>
>>> Dear all,
>>>
>>> Is here anyway, (perhaps outside R) to convert an excel file into an
>>> ascii one? I was trying to read one into R but I could not.
>>> many thanks
>>> minti
>>>
>>> On 10/4/12, Bruin, Sytze de <Sytze.deBruin at wur.nl> wrote:
>>> > Dear all,
>>> >
>>> >
>>> >
>>> > I intend to compute a space-time variogram from irregularly spaced
>>> > data.
>>> I
>>> > created a STIDF object for that (package stacetime), but gstat's
>>> > function
>>> > "variogram" only seems to only accept STSDF or STFDF objects as data.
>>> > The
>>> > following message was generated: Error: is(data, "STFDF") || is(data,
>>> > "STSDF") is not TRUE. A solution would be to first coerce the STIDF to
>>> STSDF
>>> > --which is wat I am doing-- but is there a reason why variogram does
>>> > not
>>> > accept STIDF?
>>> >
>>> >
>>> >
>>> > Thanks,
>>> >
>>> > Sytze
>>> >
>>> > _______________________________________________
>>> > R-sig-Geo mailing list
>>> > R-sig-Geo at r-project.org
>>> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>> >
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From mintibezabih at gmail.com  Sat Oct  6 14:48:32 2012
From: mintibezabih at gmail.com (alemante zd)
Date: Sat, 6 Oct 2012 13:48:32 +0100
Subject: [R-sig-Geo] finding CRS from latitude/longitude
Message-ID: <CAJfxP+pdbud=eVfJrfcB1qwRJ2KSGQevAZX40k0hK9AdQiLkMQ@mail.gmail.com>

Dear all,

I would like to sp transform my latitude/longitude vector to by first
telling it what CRS it is. This is what I did.

F1<-data.frame(x, y)
coordinates(F1)=~x+y
SP<-SpatialPoints(F1,proj4string=CRS("+proj=longlat"))
pts = SpatialPixels(SpatialPoints(F1))
gridded(F1) = TRUE

but I keep on getting the message that CRS is wrong.
Coordinate Reference System (CRS) arguments: NA

Could you please advice me on how I can get it right?

cheers
minti


From friedman.steve at gmail.com  Sat Oct  6 15:11:53 2012
From: friedman.steve at gmail.com (Steve Friedman)
Date: Sat, 6 Oct 2012 09:11:53 -0400
Subject: [R-sig-Geo] excel to ascii
In-Reply-To: <CA+vqiLFpunanMgCvuW9Pr3B44KnX6fNmKSKCxb6Lz_-N6Ocm9w@mail.gmail.com>
References: <CAJfxP+rzaWhKFDdAMaMxLrPprp_4GOLykq0Yw3c3iFOJX=pyjw@mail.gmail.com>
	<CADkZ+_WcSzg0ibH7SOhMyPAF7sGPHuhz-1jh9MxAX=CJWNWAmQ@mail.gmail.com>
	<CA+vqiLFpunanMgCvuW9Pr3B44KnX6fNmKSKCxb6Lz_-N6Ocm9w@mail.gmail.com>
Message-ID: <CADkZ+_XC-VrBsfk8cJvk=+Fjb=GsMt0sLzXgKY1L+AMQtTf-JQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121006/1030f92d/attachment.pl>

From tom.gottfried at o2mail.de  Sat Oct  6 15:51:27 2012
From: tom.gottfried at o2mail.de (Tom Gottfried)
Date: Sat, 06 Oct 2012 15:51:27 +0200
Subject: [R-sig-Geo] finding CRS from latitude/longitude
In-Reply-To: <CAJfxP+pdbud=eVfJrfcB1qwRJ2KSGQevAZX40k0hK9AdQiLkMQ@mail.gmail.com>
References: <CAJfxP+pdbud=eVfJrfcB1qwRJ2KSGQevAZX40k0hK9AdQiLkMQ@mail.gmail.com>
Message-ID: <5070375F.8030109@o2mail.de>

"+proj=longlat" can not be a valid CRS, as it only specifies that your 
coordinates are not projected. Probably you want to use the WGS84 
ellipsoid and datum:
http://www.spatialreference.org/ref/epsg/4326/

HTH,
Tom

Am 06.10.2012 14:48, schrieb alemante zd:
> Dear all,
>
> I would like to sp transform my latitude/longitude vector to by first
> telling it what CRS it is. This is what I did.
>
> F1<-data.frame(x, y)
> coordinates(F1)=~x+y
> SP<-SpatialPoints(F1,proj4string=CRS("+proj=longlat"))
> pts = SpatialPixels(SpatialPoints(F1))
> gridded(F1) = TRUE
>
> but I keep on getting the message that CRS is wrong.
> Coordinate Reference System (CRS) arguments: NA
>
> Could you please advice me on how I can get it right?
>
> cheers
> minti
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From edzer.pebesma at uni-muenster.de  Sat Oct  6 18:06:40 2012
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Sat, 06 Oct 2012 19:06:40 +0300
Subject: [R-sig-Geo] sp 1.0-0 package: sp.polygons in levelplot behaviour
In-Reply-To: <1349405926675-7581148.post@n2.nabble.com>
References: <1349405926675-7581148.post@n2.nabble.com>
Message-ID: <50705710.3090005@uni-muenster.de>

Jonathan, thanks for the clear bug report.

The old (correct) behaviour is obtained when you set

set_Polypath(FALSE)

right after loading sp.

The corrected sp.polygons is on r-forge, and will be in the next release
of sp.

On 10/05/2012 05:58 AM, Jonathan wrote:
> Hello all, 
> 
> I updated my version of sp to 1.0-0 today and am getting a different
> behaviour when using levelplot and sp.polygons.  The polygons do not appear
> to be terminating when I run the following code.  Anyone else have this
> problem?  It does seem to work if I use spplot though.  I have previous code
> that uses lattice::levelplot and rasterVis::levelplot which I can modify to
> spplot but would rather not have to.
> 
> library(sp)
> library(maptools)
> library(lattice)
> library(raster)
> library(rasterVis)
> 
> nc <- readShapePoly(system.file("shapes/sids.shp", package="maptools")[1],
> proj4string=CRS("+proj=longlat +datum=NAD27"))
> r <- raster(nc)
> r[] <- 1
> levelplot(r,
>               panel = function(x,y,z,col.regions,subscripts,region,...){
>                  panel.levelplot.raster(x, y, z, subscripts=subscripts)
>                  sp.polygons(nc)
>                }
> )
> 
> 
> Thank you,
> Jonathan
> 
> sessionInfo()
> R version 2.15.1 (2012-06-22)
> Platform: x86_64-unknown-linux-gnu (64-bit)
> 
> locale:
>  [1] LC_CTYPE=en_CA.UTF-8       LC_NUMERIC=C              
> LC_TIME=en_CA.UTF-8        LC_COLLATE=en_CA.UTF-8    
> LC_MONETARY=en_CA.UTF-8   
>  [6] LC_MESSAGES=en_CA.UTF-8    LC_PAPER=C                 LC_NAME=C                 
> LC_ADDRESS=C               LC_TELEPHONE=C            
> [11] LC_MEASUREMENT=en_CA.UTF-8 LC_IDENTIFICATION=C       
> 
> attached base packages:
> [1] grid      stats     graphics  grDevices utils     datasets  methods  
> base     
> 
> other attached packages:
> [1] rasterVis_0.11-01   hexbin_1.26.0       latticeExtra_0.6-24
> RColorBrewer_1.0-5  raster_2.0-12       maptools_0.8-16     lattice_0.20-10    
> [8] foreign_0.8-50      sp_1.0-0           
> 
> loaded via a namespace (and not attached):
> [1] tools_2.15.1 zoo_1.7-7   
> 
> 
> 
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/sp-1-0-0-package-sp-polygons-in-levelplot-behaviour-tp7581148.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From edzer.pebesma at uni-muenster.de  Sat Oct  6 18:07:08 2012
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Sat, 06 Oct 2012 19:07:08 +0300
Subject: [R-sig-Geo] variogramST does not like STIDF
In-Reply-To: <51521FE329A36B40876F00ED90C7B8A301CC91BD@SCOMP0937.wurnet.nl>
References: <51521FE329A36B40876F00ED90C7B8A301CC91BD@SCOMP0937.wurnet.nl>
Message-ID: <5070572C.6090404@uni-muenster.de>



On 10/05/2012 03:13 PM, Bruin, Sytze de wrote:
> Hi Edzer,
> 
> Thanks for your answer!
> After the lengthy computation of the variogram (> 65000 observations) on the data that were coerced from STIDF to STSDF, a warning was issued that fixed distances were assumed, which may indicate that I did something wrong. If so, a separate method for STIDF data would be welcome! 

It indicates that your time points are irregular, but are taken as
(coerced to) regular. If your time points are nearly regular, this is no
problem.

> In the meantime, I implemented a primitive R script computing an ST variogram for data irregularly spaced in space and time, allowing different lag boundaries for space and time (which is still running).

Great; if it works, please consider contributing it!
> 
> Best,
> Sytze de Bruin
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From r.hijmans at gmail.com  Sat Oct  6 19:19:27 2012
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Sat, 6 Oct 2012 10:19:27 -0700
Subject: [R-sig-Geo] finding CRS from latitude/longitude
In-Reply-To: <CAJfxP+pdbud=eVfJrfcB1qwRJ2KSGQevAZX40k0hK9AdQiLkMQ@mail.gmail.com>
References: <CAJfxP+pdbud=eVfJrfcB1qwRJ2KSGQevAZX40k0hK9AdQiLkMQ@mail.gmail.com>
Message-ID: <CANtt_hxOAQ0AsWP7kdSUJ_VH9P2T6LknvtYcDBWcdPjO=DBNgA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121006/7434273d/attachment.pl>

From tom.gottfried at o2mail.de  Sat Oct  6 19:54:34 2012
From: tom.gottfried at o2mail.de (Tom Gottfried)
Date: Sat, 06 Oct 2012 19:54:34 +0200
Subject: [R-sig-Geo] finding CRS from latitude/longitude
In-Reply-To: <CANtt_hxOAQ0AsWP7kdSUJ_VH9P2T6LknvtYcDBWcdPjO=DBNgA@mail.gmail.com>
References: <CAJfxP+pdbud=eVfJrfcB1qwRJ2KSGQevAZX40k0hK9AdQiLkMQ@mail.gmail.com>
	<CANtt_hxOAQ0AsWP7kdSUJ_VH9P2T6LknvtYcDBWcdPjO=DBNgA@mail.gmail.com>
Message-ID: <5070705A.7080708@o2mail.de>

... and you can forget about my previous answer: "+ellps=WGS84" is 
assumed if nothing else is given:

library(sp)
library(rgdal)
spTransform(SpatialPoints(data.frame(x=1:10, y=1:10),
	proj4string=CRS("+proj=latlong +datum=potsdam")),
	CRS("+proj=merc"))

Sorry for the spam!
Tom

Am 06.10.2012 19:19, schrieb Robert J. Hijmans:
> Alemante,
>
>> but I keep on getting the message that CRS is wrong.
>> Coordinate Reference System (CRS) arguments: NA
>
> Please show more complete code. Which object are you talking about? Some of
> the object you create have a CRS (SP) others do not.(pts, F1), which is
> pretty obvious from reading the sequence of events in your code. You set
> the CRS for SP, but then you use F1 again which does not have a CRS and
> therefore neither do the objects derived from it. You could do
> after, gridded(F1) = TRUE,  proj4string(F1)<- CRS("+proj=longlat")
>
>
>> Could you please advice me on how I can get it right?
>
> I need to guess, but I think you want to transform points, in that case, do
> this:
>
> # example data
> x<- 1:10
> y<- 1:10
>
> F1<-data.frame(x, y)
> library(sp)
> SP<- SpatialPoints(F1,proj4string=CRS("+proj=longlat"))
>
> library(rgdal)
> spt<- spTransform(SP, CRS("  fill in  the proj4 string you want  ") )
>
>
> Best, Robert
>
>
> On Sat, Oct 6, 2012 at 5:48 AM, alemante zd<mintibezabih at gmail.com>  wrote:
>
>> Dear all,
>>
>> I would like to sp transform my latitude/longitude vector to by first
>> telling it what CRS it is. This is what I did.
>>
>> F1<-data.frame(x, y)
>> coordinates(F1)=~x+y
>> SP<-SpatialPoints(F1,proj4string=CRS("+proj=longlat"))
>> pts = SpatialPixels(SpatialPoints(F1))
>> gridded(F1) = TRUE
>>
>> but I keep on getting the message that CRS is wrong.
>> Coordinate Reference System (CRS) arguments: NA
>>
>> Could you please advice me on how I can get it right?
>>
>> cheers
>> minti
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Indo-German Centre for Sustainability
Indian Institute of Technology Madras
600 036 Chennai, India
www.igcs-chennai.org


From mintibezabih at gmail.com  Sun Oct  7 00:08:24 2012
From: mintibezabih at gmail.com (alemante zd)
Date: Sat, 6 Oct 2012 23:08:24 +0100
Subject: [R-sig-Geo] finding CRS from latitude/longitude
In-Reply-To: <CANtt_hxOAQ0AsWP7kdSUJ_VH9P2T6LknvtYcDBWcdPjO=DBNgA@mail.gmail.com>
References: <CAJfxP+pdbud=eVfJrfcB1qwRJ2KSGQevAZX40k0hK9AdQiLkMQ@mail.gmail.com>
	<CANtt_hxOAQ0AsWP7kdSUJ_VH9P2T6LknvtYcDBWcdPjO=DBNgA@mail.gmail.com>
Message-ID: <CAJfxP+pxSrvdoHS0TcKNx0=TPE6KzaCjczgww9+M1eyDz2_qcA@mail.gmail.com>

Dear Robert, Tom and Caleb,

Thanks for your suggestions. I have now fixed my CRs. But I now face
further problems further down in my code as my ultimate objective is
to get a raster layer.

Here is the full code based on Robert's reproducable example:



x <- 1:10

y <- 1:10




F1<-data.frame(x, y)

library(sp)


#SP <- SpatialPoints(F1,proj4string=CRS("+proj=longlat"))

SP <- SpatialPoints(F1,proj4string=CRS("+proj=latlong +datum=potsdam")),
         CRS("+proj=merc"))





library(rgdal)

#spt <- spTransform(SP, CRS("  fill in  the proj4 string you want  ") )
spt<-spTransform(SpatialPoints(data.frame(x=1:10, y=1:10),
         proj4string=CRS("+proj=latlong +datum=potsdam")),
         CRS("+proj=merc"))


gridded(spt) = TRUE

library(raster)
r = raster(spt)
projection(r) = CRS("+proj=latlong +datum=potsdam")
plot(r)


I now get error messages like coordinate intervals not constant and no
vallues associated with the raster layer.

Thanks
minti

On Sat, Oct 6, 2012 at 6:19 PM, Robert J. Hijmans <r.hijmans at gmail.com> wrote:
>
> Alemante,
>
>> but I keep on getting the message that CRS is wrong.
>> Coordinate Reference System (CRS) arguments: NA
>
> Please show more complete code. Which object are you talking about? Some of
> the object you create have a CRS (SP) others do not.(pts, F1), which is
> pretty obvious from reading the sequence of events in your code. You set the
> CRS for SP, but then you use F1 again which does not have a CRS and
> therefore neither do the objects derived from it. You could do after,
> gridded(F1) = TRUE,  proj4string(F1) <- CRS("+proj=longlat")
>
>
>> Could you please advice me on how I can get it right?
>
> I need to guess, but I think you want to transform points, in that case, do
> this:
>
> # example data
> x <- 1:10
> y <- 1:10
>
> F1<-data.frame(x, y)
> library(sp)
> SP <- SpatialPoints(F1,proj4string=CRS("+proj=longlat"))
>
> library(rgdal)
> spt <- spTransform(SP, CRS("  fill in  the proj4 string you want  ") )
>
>
> Best, Robert
>
>
> On Sat, Oct 6, 2012 at 5:48 AM, alemante zd <mintibezabih at gmail.com> wrote:
>>
>> Dear all,
>>
>> I would like to sp transform my latitude/longitude vector to by first
>> telling it what CRS it is. This is what I did.
>>
>> F1<-data.frame(x, y)
>> coordinates(F1)=~x+y
>> SP<-SpatialPoints(F1,proj4string=CRS("+proj=longlat"))
>> pts = SpatialPixels(SpatialPoints(F1))
>> gridded(F1) = TRUE
>>
>> but I keep on getting the message that CRS is wrong.
>> Coordinate Reference System (CRS) arguments: NA
>>
>> Could you please advice me on how I can get it right?
>>
>> cheers
>> minti
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>


From Adrian.Baddeley at csiro.au  Sun Oct  7 05:39:09 2012
From: Adrian.Baddeley at csiro.au (Adrian.Baddeley at csiro.au)
Date: Sun, 7 Oct 2012 11:39:09 +0800
Subject: [R-sig-Geo]  How to interpret the pair correlation function?
Message-ID: <57DC18C299094D4299F837570C5DF1C50103EAC6D271@EXWA-MBX01.nexus.csiro.au>

Faranak <faranakfathi at gmail.com> writes:

> I plotted a "pair correlation function" for my data as follows:
      <http://r-sig-geo.2731867.n2.nabble.com/file/n7581160/pair_correlation.jpeg> 
> It shows for r between approximately 0.3 to 0.7 the value of g(r) is greater
> than 1 which shows clustering.
> But what does that mean? How can I interpret this diagram?

g(r) > 1 for a particular value of 'r' means literally that there are more pairs of points separated by distances of approximately 'r'
in the data than would be expected for a completely random pattern.

g(r) > 1 for *all* r would suggest clustering.

Your example is not an example of clustering. 

In your example you have g(0) = 0 and g(r)  < 1 for r < 0.2,  then g(r) > 1 for r between 0.3 and 0.7. 
This is the typical behaviour of a 'soft packing'.
There are very few points found closer than a certain threshold distance (a so-called 'soft core' or 'strong inhibition' effect)
but just beyond this distance there is a tendency to find another point (a 'packing' effect). 

You should also be aware that the estimate of g(r) is computed by kernel smoothing which may have smoothed-out certain features of the curve.

It would be wise to read one of the standard books e.g.Illian et al (2008) Statistical analysis of spatial point patterns.

Adrian Baddeley
====
Prof Adrian Baddeley FAA
CSIRO Mathematics, Informatics & Statistics
Leeuwin Centre, 65 Brockway Rd, Floreat WA 6014, Australia
tel +61 8 9333 6177 skype adrian.baddeley

From moshersteven at gmail.com  Sun Oct  7 08:16:34 2012
From: moshersteven at gmail.com (steven mosher)
Date: Sat, 6 Oct 2012 23:16:34 -0700
Subject: [R-sig-Geo] Creating a spatialPolygonsDataFrame from a data frame
Message-ID: <CAFFLneQpVN=2Fbh=_3ZOzK2qNZ3ZKPU36Sm1HC0o+kgCdR+g-A@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121006/7e4fad45/attachment.pl>

From cmora at dal.ca  Sun Oct  7 08:56:36 2012
From: cmora at dal.ca (Camilo Mora)
Date: Sun, 07 Oct 2012 03:56:36 -0300
Subject: [R-sig-Geo] extracting values from rasters
Message-ID: <20121007035636.18302j5szmtwj2kg@wm4.dal.ca>

Hi:
I wonder if anyone knows a function to extract values from one raster  
to another raster when the rasters differ in resolution and extent. In  
other words extracting values just in overlapping cells.

This is my specific problem: I have two rasters (one is for  
temperature worldwide and the other is for the presence of reefs also  
worldwide (the presence of reefs have values of 1 and all other cells  
as NA)). (the rasters differ in resolution and extent). I just need to  
put the values of the raster of temperature to each cell in the raster  
of reefs. Will you know a function that may do this?

thanks,

Camilo





Camilo Mora, Ph.D.
Department of Geography, University of Hawaii
Currently available in Colombia
Phone:   Country code: 57
          Provider code: 313
          Phone 776 2282
          From the USA or Canada you have to dial 011 57 313 776 2282
http://www.soc.hawaii.edu/mora/


From b.rowlingson at lancaster.ac.uk  Sun Oct  7 09:58:51 2012
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Sun, 7 Oct 2012 08:58:51 +0100
Subject: [R-sig-Geo] extracting values from rasters
In-Reply-To: <d3b2b7fb504845f6a8d413d49050519b@EX-0-HT0.lancs.local>
References: <d3b2b7fb504845f6a8d413d49050519b@EX-0-HT0.lancs.local>
Message-ID: <CANVKczNCTOTvnj5eV3tNAUt_jfbErSLjj8zspj6RhS5WOmyJnw@mail.gmail.com>

On Sun, Oct 7, 2012 at 7:56 AM, Camilo Mora <cmora at dal.ca> wrote:
> Hi:
> I wonder if anyone knows a function to extract values from one raster
> to another raster when the rasters differ in resolution and extent. In
> other words extracting values just in overlapping cells.
>
> This is my specific problem: I have two rasters (one is for
> temperature worldwide and the other is for the presence of reefs also
> worldwide (the presence of reefs have values of 1 and all other cells
> as NA)). (the rasters differ in resolution and extent). I just need to
> put the values of the raster of temperature to each cell in the raster
> of reefs. Will you know a function that may do this?

 You want to start off looking at the 'resample' function in the
raster package. Read the note at the start of that about other
possibilities. Since your cells don't line up, there's various ways of
deciding what the value for a target cell is, including just sampling
the centre points, or interpolating overlapping cells in various ways.

Barry


From hengl at spatial-analyst.net  Sun Oct  7 11:15:59 2012
From: hengl at spatial-analyst.net (Tomislav Hengl)
Date: Sun, 07 Oct 2012 11:15:59 +0200
Subject: [R-sig-Geo] excel to ascii
In-Reply-To: <CAJfxP+rzaWhKFDdAMaMxLrPprp_4GOLykq0Yw3c3iFOJX=pyjw@mail.gmail.com>
References: <CAJfxP+rzaWhKFDdAMaMxLrPprp_4GOLykq0Yw3c3iFOJX=pyjw@mail.gmail.com>
Message-ID: <5071484F.5060408@spatial-analyst.net>


I use the read.xls command from the gdata package 
[http://cran.r-project.org/web/packages/gdata/] to read XLS files to R. 
Works without a problem, but you need to get and locate Perl on your OS. 
Here is an example:

 > library(gdata)
## perl <- gdata:::findPerl("perl")
## Did not work :(
 > perl = "C:/Perl64/bin/perl.exe"
 > prof <- read.xls("prof.xls", perl=perl)


On 05/10/2012 14:34, alemante zd wrote:
> Dear all,
>
> Is here anyway, (perhaps outside R) to convert an excel file into an
> ascii one? I was trying to read one into R but I could not.
> many thanks
> minti
>


From edzer.pebesma at uni-muenster.de  Sun Oct  7 17:26:30 2012
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Sun, 07 Oct 2012 18:26:30 +0300
Subject: [R-sig-Geo] as() and conversion from character to factor
In-Reply-To: <CC93241C.ADB6E%macqueen1@llnl.gov>
References: <CC93241C.ADB6E%macqueen1@llnl.gov>
Message-ID: <50719F26.9030800@uni-muenster.de>

For now, you should be able to prevent this by starting your script with an

options(stringsAsFactors = FALSE)

but in future releases, sp will not do this conversion.

Thanks,

On 10/04/2012 09:31 PM, MacQueen, Don wrote:
> I just noticed that in the following sequence the final step to
> SpatialGridDataFrame converts the character column to factor, whereas the
> previous ones do not. Source the following little script, and it will
> hopefully show what I'm seeing. Shouldn't this be consistent?
> 
> Thanks
> -Don
> 
> 
> require(sp)
> require(maptools)
> 
> tstdf <- expand.grid(x=1:3, y=1:3)
> tstdf$ch <- rep('a',nrow(tstdf))
> 
> tstsp <- tstdf
> coordinates(tstsp) <- c('x','y')
> proj4string(tstsp) <- CRS('+init=epsg:32610')
> 
> tstpx <- as(tstsp, "SpatialPixelsDataFrame")
> 
> tstgrd <- as(tstpx, "SpatialGridDataFrame")
> 
> print(class(tstdf$ch))
> print(class(tstsp$ch))
> print(class(tstpx$ch))
> print(class(tstgrd$ch))
> 
> 
> #########
> I get:
> 
>> print(class(tstdf$ch))
> [1] "character"
>> print(class(tstsp$ch))
> [1] "character"
>> print(class(tstpx$ch))
> [1] "character"
>> print(class(tstgrd$ch))
> [1] "factor"
> #########
> 
> 
> 
> 
> 
> 
> 
>> sessionInfo()
> R version 2.15.1 (2012-06-22)
> Platform: x86_64-apple-darwin9.8.0/x86_64 (64-bit)
> 
> locale:
> [1] C
> 
> attached base packages:
> [1] stats     utils     datasets  grDevices graphics  methods   base
> 
> other attached packages:
> [1] maptools_0.8-16 lattice_0.20-6  foreign_0.8-50  sp_1.0-0
> 
> loaded via a namespace (and not attached):
> [1] grid_2.15.1 rmacq_1.1-8
> 
> 
> 
> 
> 
> 
> 
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From matteo.mattiuzzi at boku.ac.at  Sun Oct  7 18:51:42 2012
From: matteo.mattiuzzi at boku.ac.at (Matteo Mattiuzzi)
Date: Sun, 07 Oct 2012 18:51:42 +0200
Subject: [R-sig-Geo] Antw: Creating a spatialPolygonsDataFrame from a data
 frame
Message-ID: <5071CF3E0200002700016158@gwia2.boku.ac.at>

Hi Steve, what about this?


DF <- structure(list(v = c(4L, 4L, 4L, 4L, 4L, 4L, 4L), h = 8:14, ll_lon =
c(-131.0149,
-117.7464, -104.5202, -91.3388, -78.2083, -65.15, -52.1199),
   ll_lat = c(39.7081, 39.7342, 39.7557, 39.7728, 39.7858, 39.7937,
   39.7994), ul_lon = c(-156.8405, -140.7952, -124.8854, -109.0855,
   -93.3822, -77.7862, -62.229), ul_lat = c(49.8983, 49.9394,
   49.9677, 49.9863, 49.9972, 50, 50), ur_lon = c(-140.2398,
   -124.6153, -109.0021, -93.3968, -77.7506, -62.1191, -46.5357
   ), ur_lat = c(50.1258, 50.1159, 50.1047, 50.0921, 50.0754,
   50.0582, 50.0429), lr_lon = c(-117.2848, -104.2354, -91.191,
   -78.1497, -65.0781, -52.0094, -38.9707), lr_lat = c(39.8699,
   39.8624, 39.8554, 39.8489, 39.8411, 39.8337, 39.828)), .Names = c("v",
"h", "ll_lon", "ll_lat", "ul_lon", "ul_lat", "ur_lon", "ur_lat",
"lr_lon", "lr_lat"), row.names = 153:159, class = "data.frame")




SPDF <- list()
id <- matrix(NA,nrow(DF),ncol=2)
colnames(id)<- c("h","v")
      for (u in 1:nrow(DF)) 
{
SPDF[[u]] <- Polygons(list(Polygon(cbind(
c(DF$ll_lon[u], DF$ul_lon[u], DF$ur_lon[u], DF$lr_lon[u], DF$ll_lon[u]),
c(DF$ll_lat[u], DF$ul_lat[u], DF$ur_lat[u], DF$lr_lat[u], DF$ll_lat[u])), 
hole = FALSE)),u)
id[u,] <- c(DF$h[u], DF$v[u]) # probably h/v information can be taken direcly from DF
      }
SPDF <- SpatialPolygons(SPDF,1:length(SPDF),proj4string=CRS("+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs"))
      SPDF <- SpatialPolygonsDataFrame(SPDF, as.data.frame(id),match.ID=FALSE)
plot(SPDF,col="green")




>>> steven mosher  07.10.12 8.18 Uhr >>>
Hi,

  I have a dataframe that has a few hundred rows like this.

DF <- structure(list(v = c(4L, 4L, 4L, 4L, 4L, 4L, 4L), h = 8:14, ll_lon =
c(-131.0149,
-117.7464, -104.5202, -91.3388, -78.2083, -65.15, -52.1199),
    ll_lat = c(39.7081, 39.7342, 39.7557, 39.7728, 39.7858, 39.7937,
    39.7994), ul_lon = c(-156.8405, -140.7952, -124.8854, -109.0855,
    -93.3822, -77.7862, -62.229), ul_lat = c(49.8983, 49.9394,
    49.9677, 49.9863, 49.9972, 50, 50), ur_lon = c(-140.2398,
    -124.6153, -109.0021, -93.3968, -77.7506, -62.1191, -46.5357
    ), ur_lat = c(50.1258, 50.1159, 50.1047, 50.0921, 50.0754,
    50.0582, 50.0429), lr_lon = c(-117.2848, -104.2354, -91.191,
    -78.1497, -65.0781, -52.0094, -38.9707), lr_lat = c(39.8699,
    39.8624, 39.8554, 39.8489, 39.8411, 39.8337, 39.828)), .Names = c("v",
"h", "ll_lon", "ll_lat", "ul_lon", "ul_lat", "ur_lon", "ur_lat",
"lr_lon", "lr_lat"), row.names = 153:159, class = "data.frame")


The columns  are  v and h, two attributes,  and then  4 points in lat and
lon    ll_lon  is lower left lon, lr_lon is lower right,
ul_lon is upper left and ur_lon is upper right.

What I want to do is create a spatialPolygonsDataFrame from this data.
As best as I can figure I have to take the  lon/lat coordinates and put
them in to a matrix format, replicate the first point to close
the ring and create a Polygon, and then Create a Polygons() object with an
ID and then a SpatialPolygon, and then a
SpatialPolygonDataFrame  from a list of the spatial polygons.

What I'm struggling with is how to do this for the several hundred rows
that I have.

Steve

    [[alternative HTML version deleted]]

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From moshersteven at gmail.com  Sun Oct  7 19:10:58 2012
From: moshersteven at gmail.com (steven mosher)
Date: Sun, 7 Oct 2012 10:10:58 -0700
Subject: [R-sig-Geo] Creating a spatialPolygonsDataFrame from a data
	frame
In-Reply-To: <5071CF3E0200002700016158@gwia2.boku.ac.at>
References: <5071CF3E0200002700016158@gwia2.boku.ac.at>
Message-ID: <CAFFLneSRQ7FiudRS0Y8mSc_me_fuQd0UoShyZGenbd9OnJumCw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121007/fbce5176/attachment.pl>

From matteo.mattiuzzi at boku.ac.at  Sun Oct  7 19:23:31 2012
From: matteo.mattiuzzi at boku.ac.at (Matteo Mattiuzzi)
Date: Sun, 07 Oct 2012 19:23:31 +0200
Subject: [R-sig-Geo] Antw: Re: Creating a spatialPolygonsDataFrame from a
 data frame
Message-ID: <5071D6B30200002700016160@gwia2.boku.ac.at>

If MODIS tiles are your aim why don't you use?


MODIS:::getTile()



>>> steven mosher  07.10.12 19.11 Uhr >>>
Well I'm just puttering around and got kinda tired of pulling up Google
Earth everytime I wanted to locate a MODIS Tile from  lat/lon.   so I found
the the following

gring <-"
http://landweb.nascom.nasa.gov/developers/sn_tiles/sn_gring_10deg.txt"



GRING <- read.table(gring, skip = 7,   stringsAsFactors =FALSE, nrows=648,
                    na.strings=c("-999.0000","-99.0000"))

colnames(GRING)<-c("v","h","ll_lon","ll_lat",
                   "ul_lon","ul_lat","ur_lon","ur_lat",
                   "lr_lon","lr_lat")




On Sun, Oct 7, 2012 at 9:51 AM, Matteo Mattiuzzi <
matteo.mattiuzzi at boku.ac.at> wrote:

> Hi Steve, what about this?
>
>
> DF <- structure(list(v = c(4L, 4L, 4L, 4L, 4L, 4L, 4L), h = 8:14, ll_lon =
> c(-131.0149,
> -117.7464, -104.5202, -91.3388, -78.2083, -65.15, -52.1199),
>    ll_lat = c(39.7081, 39.7342, 39.7557, 39.7728, 39.7858, 39.7937,
>    39.7994), ul_lon = c(-156.8405, -140.7952, -124.8854, -109.0855,
>    -93.3822, -77.7862, -62.229), ul_lat = c(49.8983, 49.9394,
>    49.9677, 49.9863, 49.9972, 50, 50), ur_lon = c(-140.2398,
>    -124.6153, -109.0021, -93.3968, -77.7506, -62.1191, -46.5357
>    ), ur_lat = c(50.1258, 50.1159, 50.1047, 50.0921, 50.0754,
>    50.0582, 50.0429), lr_lon = c(-117.2848, -104.2354, -91.191,
>    -78.1497, -65.0781, -52.0094, -38.9707), lr_lat = c(39.8699,
>    39.8624, 39.8554, 39.8489, 39.8411, 39.8337, 39.828)), .Names = c("v",
> "h", "ll_lon", "ll_lat", "ul_lon", "ul_lat", "ur_lon", "ur_lat",
> "lr_lon", "lr_lat"), row.names = 153:159, class = "data.frame")
>
>
>
>
> SPDF <- list()
> id <- matrix(NA,nrow(DF),ncol=2)
> colnames(id)<- c("h","v")
>       for (u in 1:nrow(DF))
> {
> SPDF[[u]] <- Polygons(list(Polygon(cbind(
> c(DF$ll_lon[u], DF$ul_lon[u], DF$ur_lon[u], DF$lr_lon[u], DF$ll_lon[u]),
> c(DF$ll_lat[u], DF$ul_lat[u], DF$ur_lat[u], DF$lr_lat[u], DF$ll_lat[u])),
> hole = FALSE)),u)
> id[u,] <- c(DF$h[u], DF$v[u]) # probably h/v information can be taken
> direcly from DF
>       }
> SPDF <- SpatialPolygons(SPDF,1:length(SPDF),proj4string=CRS("+proj=longlat
> +ellps=WGS84 +datum=WGS84 +no_defs"))
>       SPDF <- SpatialPolygonsDataFrame(SPDF,
> as.data.frame(id),match.ID=FALSE)
> plot(SPDF,col="green")
>
>
>
>
> >>> steven mosher  07.10.12 8.18 Uhr >>>
> Hi,
>
>   I have a dataframe that has a few hundred rows like this.
>
> DF <- structure(list(v = c(4L, 4L, 4L, 4L, 4L, 4L, 4L), h = 8:14, ll_lon =
> c(-131.0149,
> -117.7464, -104.5202, -91.3388, -78.2083, -65.15, -52.1199),
>     ll_lat = c(39.7081, 39.7342, 39.7557, 39.7728, 39.7858, 39.7937,
>     39.7994), ul_lon = c(-156.8405, -140.7952, -124.8854, -109.0855,
>     -93.3822, -77.7862, -62.229), ul_lat = c(49.8983, 49.9394,
>     49.9677, 49.9863, 49.9972, 50, 50), ur_lon = c(-140.2398,
>     -124.6153, -109.0021, -93.3968, -77.7506, -62.1191, -46.5357
>     ), ur_lat = c(50.1258, 50.1159, 50.1047, 50.0921, 50.0754,
>     50.0582, 50.0429), lr_lon = c(-117.2848, -104.2354, -91.191,
>     -78.1497, -65.0781, -52.0094, -38.9707), lr_lat = c(39.8699,
>     39.8624, 39.8554, 39.8489, 39.8411, 39.8337, 39.828)), .Names = c("v",
> "h", "ll_lon", "ll_lat", "ul_lon", "ul_lat", "ur_lon", "ur_lat",
> "lr_lon", "lr_lat"), row.names = 153:159, class = "data.frame")
>
>
> The columns  are  v and h, two attributes,  and then  4 points in lat and
> lon    ll_lon  is lower left lon, lr_lon is lower right,
> ul_lon is upper left and ur_lon is upper right.
>
> What I want to do is create a spatialPolygonsDataFrame from this data.
> As best as I can figure I have to take the  lon/lat coordinates and put
> them in to a matrix format, replicate the first point to close
> the ring and create a Polygon, and then Create a Polygons() object with an
> ID and then a SpatialPolygon, and then a
> SpatialPolygonDataFrame  from a list of the spatial polygons.
>
> What I'm struggling with is how to do this for the several hundred rows
> that I have.
>
> Steve
>
>     [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
>


From moshersteven at gmail.com  Sun Oct  7 19:36:36 2012
From: moshersteven at gmail.com (steven mosher)
Date: Sun, 7 Oct 2012 10:36:36 -0700
Subject: [R-sig-Geo] Creating a spatialPolygonsDataFrame from a data
	frame
In-Reply-To: <5071D6B30200002700016160@gwia2.boku.ac.at>
References: <5071D6B30200002700016160@gwia2.boku.ac.at>
Message-ID: <CAFFLneQaRYNib_Ae_RJfcipuQNfwZHcgk+uef_r06aWkwbQ4ew@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121007/d9663f5f/attachment.pl>

From matteo.mattiuzzi at boku.ac.at  Sun Oct  7 19:53:12 2012
From: matteo.mattiuzzi at boku.ac.at (Matteo Mattiuzzi)
Date: Sun, 07 Oct 2012 19:53:12 +0200
Subject: [R-sig-Geo] Antw: Re: Re: Creating a spatialPolygonsDataFrame from
 a data frame
Message-ID: <5071DDA8020000270001616E@gwia2.boku.ac.at>

This is what I can serve:


getTile(extent="path/to/your/file.shp")$tile # poly
getTile(extent="path/to/your/raster.file")$tile # rasterfile
getTile(extent=extent("raster.file"))$tile # raster extent
getTile(extent="austria")$tile # charackter name
getTile(extent=list(xmin,xmax,ymin,ymax))$tile # 



interactive it is only if you don't give any arguments
I think the only thing what is missing is sp:::bbox (I use raster:::extent) but I coud add it very easily. And the point (I use list(xmin,xmax...))

>>> steven mosher  07.10.12 19.37 Uhr >>>


I looked at that code.  I didn't want to do this via interactive map. and I
just wanted a very simple super simple api.   getVH(lonlat)  or a case that
accepts poly or bbox as input.

On Sun, Oct 7, 2012 at 10:23 AM, Matteo Mattiuzzi <
matteo.mattiuzzi at boku.ac.at> wrote:

> If MODIS tiles are your aim why don't you use?
>
>
> MODIS:::getTile()
>
>
>
> >>> steven mosher  07.10.12 19.11 Uhr >>>
> Well I'm just puttering around and got kinda tired of pulling up Google
> Earth everytime I wanted to locate a MODIS Tile from  lat/lon.   so I found
> the the following
>
> gring <-"
> http://landweb.nascom.nasa.gov/developers/sn_tiles/sn_gring_10deg.txt"
>
>
>
> GRING <- read.table(gring, skip = 7,   stringsAsFactors =FALSE, nrows=648,
>                     na.strings=c("-999.0000","-99.0000"))
>
> colnames(GRING)<-c("v","h","ll_lon","ll_lat",
>                    "ul_lon","ul_lat","ur_lon","ur_lat",
>                    "lr_lon","lr_lat")
>
>
>
>
> On Sun, Oct 7, 2012 at 9:51 AM, Matteo Mattiuzzi <
> matteo.mattiuzzi at boku.ac.at> wrote:
>
> > Hi Steve, what about this?
> >
> >
> > DF <- structure(list(v = c(4L, 4L, 4L, 4L, 4L, 4L, 4L), h = 8:14, ll_lon
> =
> > c(-131.0149,
> > -117.7464, -104.5202, -91.3388, -78.2083, -65.15, -52.1199),
> >    ll_lat = c(39.7081, 39.7342, 39.7557, 39.7728, 39.7858, 39.7937,
> >    39.7994), ul_lon = c(-156.8405, -140.7952, -124.8854, -109.0855,
> >    -93.3822, -77.7862, -62.229), ul_lat = c(49.8983, 49.9394,
> >    49.9677, 49.9863, 49.9972, 50, 50), ur_lon = c(-140.2398,
> >    -124.6153, -109.0021, -93.3968, -77.7506, -62.1191, -46.5357
> >    ), ur_lat = c(50.1258, 50.1159, 50.1047, 50.0921, 50.0754,
> >    50.0582, 50.0429), lr_lon = c(-117.2848, -104.2354, -91.191,
> >    -78.1497, -65.0781, -52.0094, -38.9707), lr_lat = c(39.8699,
> >    39.8624, 39.8554, 39.8489, 39.8411, 39.8337, 39.828)), .Names = c("v",
> > "h", "ll_lon", "ll_lat", "ul_lon", "ul_lat", "ur_lon", "ur_lat",
> > "lr_lon", "lr_lat"), row.names = 153:159, class = "data.frame")
> >
> >
> >
> >
> > SPDF <- list()
> > id <- matrix(NA,nrow(DF),ncol=2)
> > colnames(id)<- c("h","v")
> >       for (u in 1:nrow(DF))
> > {
> > SPDF[[u]] <- Polygons(list(Polygon(cbind(
> > c(DF$ll_lon[u], DF$ul_lon[u], DF$ur_lon[u], DF$lr_lon[u], DF$ll_lon[u]),
> > c(DF$ll_lat[u], DF$ul_lat[u], DF$ur_lat[u], DF$lr_lat[u], DF$ll_lat[u])),
> > hole = FALSE)),u)
> > id[u,] <- c(DF$h[u], DF$v[u]) # probably h/v information can be taken
> > direcly from DF
> >       }
> > SPDF <-
> SpatialPolygons(SPDF,1:length(SPDF),proj4string=CRS("+proj=longlat
> > +ellps=WGS84 +datum=WGS84 +no_defs"))
> >       SPDF <- SpatialPolygonsDataFrame(SPDF,
> > as.data.frame(id),match.ID=FALSE)
> > plot(SPDF,col="green")
> >
> >
> >
> >
> > >>> steven mosher  07.10.12 8.18 Uhr >>>
> > Hi,
> >
> >   I have a dataframe that has a few hundred rows like this.
> >
> > DF <- structure(list(v = c(4L, 4L, 4L, 4L, 4L, 4L, 4L), h = 8:14, ll_lon
> =
> > c(-131.0149,
> > -117.7464, -104.5202, -91.3388, -78.2083, -65.15, -52.1199),
> >     ll_lat = c(39.7081, 39.7342, 39.7557, 39.7728, 39.7858, 39.7937,
> >     39.7994), ul_lon = c(-156.8405, -140.7952, -124.8854, -109.0855,
> >     -93.3822, -77.7862, -62.229), ul_lat = c(49.8983, 49.9394,
> >     49.9677, 49.9863, 49.9972, 50, 50), ur_lon = c(-140.2398,
> >     -124.6153, -109.0021, -93.3968, -77.7506, -62.1191, -46.5357
> >     ), ur_lat = c(50.1258, 50.1159, 50.1047, 50.0921, 50.0754,
> >     50.0582, 50.0429), lr_lon = c(-117.2848, -104.2354, -91.191,
> >     -78.1497, -65.0781, -52.0094, -38.9707), lr_lat = c(39.8699,
> >     39.8624, 39.8554, 39.8489, 39.8411, 39.8337, 39.828)), .Names =
> c("v",
> > "h", "ll_lon", "ll_lat", "ul_lon", "ul_lat", "ur_lon", "ur_lat",
> > "lr_lon", "lr_lat"), row.names = 153:159, class = "data.frame")
> >
> >
> > The columns  are  v and h, two attributes,  and then  4 points in lat and
> > lon    ll_lon  is lower left lon, lr_lon is lower right,
> > ul_lon is upper left and ur_lon is upper right.
> >
> > What I want to do is create a spatialPolygonsDataFrame from this data.
> > As best as I can figure I have to take the  lon/lat coordinates and put
> > them in to a matrix format, replicate the first point to close
> > the ring and create a Polygon, and then Create a Polygons() object with
> an
> > ID and then a SpatialPolygon, and then a
> > SpatialPolygonDataFrame  from a list of the spatial polygons.
> >
> > What I'm struggling with is how to do this for the several hundred rows
> > that I have.
> >
> > Steve
> >
> >     [[alternative HTML version deleted]]
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
> >
> >
>
>
>


From cmora at dal.ca  Sun Oct  7 19:58:18 2012
From: cmora at dal.ca (Camilo Mora)
Date: Sun, 07 Oct 2012 14:58:18 -0300
Subject: [R-sig-Geo] extracting values from rasters
In-Reply-To: <CANVKczNCTOTvnj5eV3tNAUt_jfbErSLjj8zspj6RhS5WOmyJnw@mail.gmail.com>
References: <d3b2b7fb504845f6a8d413d49050519b@EX-0-HT0.lancs.local>
	<CANVKczNCTOTvnj5eV3tNAUt_jfbErSLjj8zspj6RhS5WOmyJnw@mail.gmail.com>
Message-ID: <20121007145818.17584wkq78w5iiec@wm3.dal.ca>

Thanks Barry,

I did try resample. Unfortunately, it is taking about 15 minutes and  
after that it says that it failed returning the message "Reached total  
allocation of 5813Mb: see help(memory.size)".

I converted my habitat raster to points (about 500,000) and use the  
"extract" fucntion. it does the extraction in about two minutes, which  
makes me realize that the resample function is taking to long because  
of the interpolation method.

Do you know if there is an analogous function to resample that  
considers just the overlap of cells to assing values?.

Thanks,


Camilo
http://www.soc.hawaii.edu/mora/



Quoting Barry Rowlingson <b.rowlingson at lancaster.ac.uk>:

> On Sun, Oct 7, 2012 at 7:56 AM, Camilo Mora <cmora at dal.ca> wrote:
>> Hi:
>> I wonder if anyone knows a function to extract values from one raster
>> to another raster when the rasters differ in resolution and extent. In
>> other words extracting values just in overlapping cells.
>>
>> This is my specific problem: I have two rasters (one is for
>> temperature worldwide and the other is for the presence of reefs also
>> worldwide (the presence of reefs have values of 1 and all other cells
>> as NA)). (the rasters differ in resolution and extent). I just need to
>> put the values of the raster of temperature to each cell in the raster
>> of reefs. Will you know a function that may do this?
>
>  You want to start off looking at the 'resample' function in the
> raster package. Read the note at the start of that about other
> possibilities. Since your cells don't line up, there's various ways of
> deciding what the value for a target cell is, including just sampling
> the centre points, or interpolating overlapping cells in various ways.
>
> Barry
>
>


From moshersteven at gmail.com  Sun Oct  7 20:43:33 2012
From: moshersteven at gmail.com (steven mosher)
Date: Sun, 7 Oct 2012 11:43:33 -0700
Subject: [R-sig-Geo] Creating a spatialPolygonsDataFrame from a data
 frame
In-Reply-To: <5071DDA8020000270001616E@gwia2.boku.ac.at>
References: <5071DDA8020000270001616E@gwia2.boku.ac.at>
Message-ID: <CAFFLneTYrSggjdMqyu4M1fbQmz9=dzD1BTiWoncU8B7uOzpSeQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121007/c6a5b505/attachment.pl>

From matteo.mattiuzzi at boku.ac.at  Sun Oct  7 21:02:52 2012
From: matteo.mattiuzzi at boku.ac.at (Matteo Mattiuzzi)
Date: Sun, 07 Oct 2012 21:02:52 +0200
Subject: [R-sig-Geo] Antw: Re: Re: Re: Creating a spatialPolygonsDataFrame
 from a data frame
Message-ID: <5071EDFC0200002700016179@gwia2.boku.ac.at>

getTile uses this information. But If you are looking for a modification (ie a simpler way to define point location) I could add it.


>>> steven mosher  07.10.12 20.44 Uhr >>>
ok.  I should be able to work with that.

my approach with the  G-ring data was giving odd results anyways.

On Sun, Oct 7, 2012 at 10:53 AM, Matteo Mattiuzzi <
matteo.mattiuzzi at boku.ac.at> wrote:

> This is what I can serve:
>
>
> getTile(extent="path/to/your/file.shp")$tile # poly
> getTile(extent="path/to/your/raster.file")$tile # rasterfile
> getTile(extent=extent("raster.file"))$tile # raster extent
> getTile(extent="austria")$tile # charackter name
> getTile(extent=list(xmin,xmax,ymin,ymax))$tile #
>
>
>
> interactive it is only if you don't give any arguments
> I think the only thing what is missing is sp:::bbox (I use
> raster:::extent) but I coud add it very easily. And the point (I use
> list(xmin,xmax...))
>
> >>> steven mosher  07.10.12 19.37 Uhr >>>
>
>
> I looked at that code.  I didn't want to do this via interactive map. and I
> just wanted a very simple super simple api.   getVH(lonlat)  or a case that
> accepts poly or bbox as input.
>
> On Sun, Oct 7, 2012 at 10:23 AM, Matteo Mattiuzzi <
> matteo.mattiuzzi at boku.ac.at> wrote:
>
> > If MODIS tiles are your aim why don't you use?
> >
> >
> > MODIS:::getTile()
> >
> >
> >
> > >>> steven mosher  07.10.12 19.11 Uhr >>>
> > Well I'm just puttering around and got kinda tired of pulling up Google
> > Earth everytime I wanted to locate a MODIS Tile from  lat/lon.   so I
> found
> > the the following
> >
> > gring <-"
> > http://landweb.nascom.nasa.gov/developers/sn_tiles/sn_gring_10deg.txt"
> >
> >
> >
> > GRING <- read.table(gring, skip = 7,   stringsAsFactors =FALSE,
> nrows=648,
> >                     na.strings=c("-999.0000","-99.0000"))
> >
> > colnames(GRING)<-c("v","h","ll_lon","ll_lat",
> >                    "ul_lon","ul_lat","ur_lon","ur_lat",
> >                    "lr_lon","lr_lat")
> >
> >
> >
> >
> > On Sun, Oct 7, 2012 at 9:51 AM, Matteo Mattiuzzi <
> > matteo.mattiuzzi at boku.ac.at> wrote:
> >
> > > Hi Steve, what about this?
> > >
> > >
> > > DF <- structure(list(v = c(4L, 4L, 4L, 4L, 4L, 4L, 4L), h = 8:14,
> ll_lon
> > =
> > > c(-131.0149,
> > > -117.7464, -104.5202, -91.3388, -78.2083, -65.15, -52.1199),
> > >    ll_lat = c(39.7081, 39.7342, 39.7557, 39.7728, 39.7858, 39.7937,
> > >    39.7994), ul_lon = c(-156.8405, -140.7952, -124.8854, -109.0855,
> > >    -93.3822, -77.7862, -62.229), ul_lat = c(49.8983, 49.9394,
> > >    49.9677, 49.9863, 49.9972, 50, 50), ur_lon = c(-140.2398,
> > >    -124.6153, -109.0021, -93.3968, -77.7506, -62.1191, -46.5357
> > >    ), ur_lat = c(50.1258, 50.1159, 50.1047, 50.0921, 50.0754,
> > >    50.0582, 50.0429), lr_lon = c(-117.2848, -104.2354, -91.191,
> > >    -78.1497, -65.0781, -52.0094, -38.9707), lr_lat = c(39.8699,
> > >    39.8624, 39.8554, 39.8489, 39.8411, 39.8337, 39.828)), .Names =
> c("v",
> > > "h", "ll_lon", "ll_lat", "ul_lon", "ul_lat", "ur_lon", "ur_lat",
> > > "lr_lon", "lr_lat"), row.names = 153:159, class = "data.frame")
> > >
> > >
> > >
> > >
> > > SPDF <- list()
> > > id <- matrix(NA,nrow(DF),ncol=2)
> > > colnames(id)<- c("h","v")
> > >       for (u in 1:nrow(DF))
> > > {
> > > SPDF[[u]] <- Polygons(list(Polygon(cbind(
> > > c(DF$ll_lon[u], DF$ul_lon[u], DF$ur_lon[u], DF$lr_lon[u],
> DF$ll_lon[u]),
> > > c(DF$ll_lat[u], DF$ul_lat[u], DF$ur_lat[u], DF$lr_lat[u],
> DF$ll_lat[u])),
> > > hole = FALSE)),u)
> > > id[u,] <- c(DF$h[u], DF$v[u]) # probably h/v information can be taken
> > > direcly from DF
> > >       }
> > > SPDF <-
> > SpatialPolygons(SPDF,1:length(SPDF),proj4string=CRS("+proj=longlat
> > > +ellps=WGS84 +datum=WGS84 +no_defs"))
> > >       SPDF <- SpatialPolygonsDataFrame(SPDF,
> > > as.data.frame(id),match.ID=FALSE)
> > > plot(SPDF,col="green")
> > >
> > >
> > >
> > >
> > > >>> steven mosher  07.10.12 8.18 Uhr >>>
> > > Hi,
> > >
> > >   I have a dataframe that has a few hundred rows like this.
> > >
> > > DF <- structure(list(v = c(4L, 4L, 4L, 4L, 4L, 4L, 4L), h = 8:14,
> ll_lon
> > =
> > > c(-131.0149,
> > > -117.7464, -104.5202, -91.3388, -78.2083, -65.15, -52.1199),
> > >     ll_lat = c(39.7081, 39.7342, 39.7557, 39.7728, 39.7858, 39.7937,
> > >     39.7994), ul_lon = c(-156.8405, -140.7952, -124.8854, -109.0855,
> > >     -93.3822, -77.7862, -62.229), ul_lat = c(49.8983, 49.9394,
> > >     49.9677, 49.9863, 49.9972, 50, 50), ur_lon = c(-140.2398,
> > >     -124.6153, -109.0021, -93.3968, -77.7506, -62.1191, -46.5357
> > >     ), ur_lat = c(50.1258, 50.1159, 50.1047, 50.0921, 50.0754,
> > >     50.0582, 50.0429), lr_lon = c(-117.2848, -104.2354, -91.191,
> > >     -78.1497, -65.0781, -52.0094, -38.9707), lr_lat = c(39.8699,
> > >     39.8624, 39.8554, 39.8489, 39.8411, 39.8337, 39.828)), .Names =
> > c("v",
> > > "h", "ll_lon", "ll_lat", "ul_lon", "ul_lat", "ur_lon", "ur_lat",
> > > "lr_lon", "lr_lat"), row.names = 153:159, class = "data.frame")
> > >
> > >
> > > The columns  are  v and h, two attributes,  and then  4 points in lat
> and
> > > lon    ll_lon  is lower left lon, lr_lon is lower right,
> > > ul_lon is upper left and ur_lon is upper right.
> > >
> > > What I want to do is create a spatialPolygonsDataFrame from this data.
> > > As best as I can figure I have to take the  lon/lat coordinates and put
> > > them in to a matrix format, replicate the first point to close
> > > the ring and create a Polygon, and then Create a Polygons() object with
> > an
> > > ID and then a SpatialPolygon, and then a
> > > SpatialPolygonDataFrame  from a list of the spatial polygons.
> > >
> > > What I'm struggling with is how to do this for the several hundred rows
> > > that I have.
> > >
> > > Steve
> > >
> > >     [[alternative HTML version deleted]]
> > >
> > > _______________________________________________
> > > R-sig-Geo mailing list
> > > R-sig-Geo at r-project.org
> > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > >
> > >
> > >
> >
> >
> >
>
>
>


From r.hijmans at gmail.com  Sun Oct  7 21:30:16 2012
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Sun, 7 Oct 2012 12:30:16 -0700
Subject: [R-sig-Geo] Antw: Creating a spatialPolygonsDataFrame from a
	data frame
In-Reply-To: <5071CF3E0200002700016158@gwia2.boku.ac.at>
References: <5071CF3E0200002700016158@gwia2.boku.ac.at>
Message-ID: <CANtt_hx6JdegADESEQ=axC3P8D4_5+sKrLwm0S59HL1SPnWu8A@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121007/7a618fae/attachment.pl>

From moshersteven at gmail.com  Sun Oct  7 21:30:24 2012
From: moshersteven at gmail.com (steven mosher)
Date: Sun, 7 Oct 2012 12:30:24 -0700
Subject: [R-sig-Geo] Creating a spatialPolygonsDataFrame from a data
 frame
In-Reply-To: <5071EDFC0200002700016179@gwia2.boku.ac.at>
References: <5071EDFC0200002700016179@gwia2.boku.ac.at>
Message-ID: <CAFFLneTFAYACBFNQd9fgWnSBAZWB08aOhMDB-cjWMDP2rt3=UQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121007/0624a599/attachment.pl>

From moshersteven at gmail.com  Sun Oct  7 21:33:55 2012
From: moshersteven at gmail.com (steven mosher)
Date: Sun, 7 Oct 2012 12:33:55 -0700
Subject: [R-sig-Geo] Antw: Creating a spatialPolygonsDataFrame from a
	data frame
In-Reply-To: <CANtt_hx6JdegADESEQ=axC3P8D4_5+sKrLwm0S59HL1SPnWu8A@mail.gmail.com>
References: <5071CF3E0200002700016158@gwia2.boku.ac.at>
	<CANtt_hx6JdegADESEQ=axC3P8D4_5+sKrLwm0S59HL1SPnWu8A@mail.gmail.com>
Message-ID: <CAFFLneQ0tX=iQVfP55kmdzv00RuNJNA7NNPCwttn73gFhH+2SQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121007/e9ad54d3/attachment.pl>

From m.hewson at uq.edu.au  Sun Oct  7 23:31:53 2012
From: m.hewson at uq.edu.au (Michael Hewson)
Date: Sun, 7 Oct 2012 21:31:53 +0000
Subject: [R-sig-Geo] excel to ascii
In-Reply-To: <5071484F.5060408@spatial-analyst.net>
References: <CAJfxP+rzaWhKFDdAMaMxLrPprp_4GOLykq0Yw3c3iFOJX=pyjw@mail.gmail.com>
	<5071484F.5060408@spatial-analyst.net>
Message-ID: <4DFD7C68C50FE54A98C0D43A76E08E080572E6@uqexmdb6.soe.uq.edu.au>

At the risk of missing the big picture - wouldn't you just save from within excel as ascii txt?

-----Original Message-----
From: r-sig-geo-bounces at r-project.org [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of Tomislav Hengl
Sent: Sunday, 7 October 2012 7:16 PM
To: alemante zd
Cc: r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] excel to ascii


I use the read.xls command from the gdata package [http://cran.r-project.org/web/packages/gdata/] to read XLS files to R. 
Works without a problem, but you need to get and locate Perl on your OS. 
Here is an example:

 > library(gdata)
## perl <- gdata:::findPerl("perl")
## Did not work :(
 > perl = "C:/Perl64/bin/perl.exe"
 > prof <- read.xls("prof.xls", perl=perl)


On 05/10/2012 14:34, alemante zd wrote:
> Dear all,
>
> Is here anyway, (perhaps outside R) to convert an excel file into an 
> ascii one? I was trying to read one into R but I could not.
> many thanks
> minti
>

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From drf28 at cornell.edu  Sun Oct  7 23:47:45 2012
From: drf28 at cornell.edu (Daniel Fuka)
Date: Sun, 7 Oct 2012 17:47:45 -0400
Subject: [R-sig-Geo] excel to ascii
In-Reply-To: <4DFD7C68C50FE54A98C0D43A76E08E080572E6@uqexmdb6.soe.uq.edu.au>
References: <CAJfxP+rzaWhKFDdAMaMxLrPprp_4GOLykq0Yw3c3iFOJX=pyjw@mail.gmail.com>
	<5071484F.5060408@spatial-analyst.net>
	<4DFD7C68C50FE54A98C0D43A76E08E080572E6@uqexmdb6.soe.uq.edu.au>
Message-ID: <CAB9w6Xw6goiy_Zf_ynpOyEm2YYHb9USbNNXwXdfsRyp-tnSAmg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121007/27239e0e/attachment.pl>

From mintibezabih at gmail.com  Mon Oct  8 00:58:32 2012
From: mintibezabih at gmail.com (alemante zd)
Date: Sun, 7 Oct 2012 23:58:32 +0100
Subject: [R-sig-Geo] How to find project 4 string
Message-ID: <CAJfxP+qN7o2wUN8tYBkB4vHp9723HOjvnL5sehN-0qYpX_0_tw@mail.gmail.com>

Dear all,

This might be a very elementary question to most on here but I am
trying to construct a raster from my latitude/longtude data and while
I managed to get most codes right (with help from you guys), I could
not figure out what to put in place of "fill in the proj4 string you
want". Where do I get these figures from? I tried looking up the
location of Ethiopia where data for this exercise is from and came up
with this figure("+init=epsg:4326"). But when I insterted it , I was
not successful in fully running my code

Anyway, my full codes looks like below:


x <- 1:10

y <- 1:10

F1<-data.frame(x, y)

library(sp)

SP <- SpatialPoints(F1,proj4string=CRS("+proj=longlat"))


library(rgdal)

spt <- spTransform(SP, CRS("  fill in  the proj4 string you want  ") )


gridded(spt) = TRUE

library(raster)
r = raster(spt)
projection(r) = CRS("fill in  the proj4 string you want  ")
plot(r)

I would be most grateful for any help as usual.

Cheers
minti


From r.hijmans at gmail.com  Mon Oct  8 05:11:00 2012
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Sun, 7 Oct 2012 20:11:00 -0700
Subject: [R-sig-Geo] extracting values from rasters
In-Reply-To: <20121007145818.17584wkq78w5iiec@wm3.dal.ca>
References: <d3b2b7fb504845f6a8d413d49050519b@EX-0-HT0.lancs.local>
	<CANVKczNCTOTvnj5eV3tNAUt_jfbErSLjj8zspj6RhS5WOmyJnw@mail.gmail.com>
	<20121007145818.17584wkq78w5iiec@wm3.dal.ca>
Message-ID: <CANtt_hxt3B=xXBt8BPLzvU4gXXdwReR9C1Gn-8BJMHjH+zGv8Q@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121007/d996d134/attachment.pl>

From r.hijmans at gmail.com  Mon Oct  8 05:13:50 2012
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Sun, 7 Oct 2012 20:13:50 -0700
Subject: [R-sig-Geo] finding CRS from latitude/longitude
In-Reply-To: <CAJfxP+pxSrvdoHS0TcKNx0=TPE6KzaCjczgww9+M1eyDz2_qcA@mail.gmail.com>
References: <CAJfxP+pdbud=eVfJrfcB1qwRJ2KSGQevAZX40k0hK9AdQiLkMQ@mail.gmail.com>
	<CANtt_hxOAQ0AsWP7kdSUJ_VH9P2T6LknvtYcDBWcdPjO=DBNgA@mail.gmail.com>
	<CAJfxP+pxSrvdoHS0TcKNx0=TPE6KzaCjczgww9+M1eyDz2_qcA@mail.gmail.com>
Message-ID: <CANtt_hzbJKFN7KTHGwRfDTKfTJm3D+G3_OJdd6pF_Zw-cgSCFQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121007/88114317/attachment.pl>

From r.hijmans at gmail.com  Mon Oct  8 05:16:28 2012
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Sun, 7 Oct 2012 20:16:28 -0700
Subject: [R-sig-Geo] How to find project 4 string
In-Reply-To: <CAJfxP+qN7o2wUN8tYBkB4vHp9723HOjvnL5sehN-0qYpX_0_tw@mail.gmail.com>
References: <CAJfxP+qN7o2wUN8tYBkB4vHp9723HOjvnL5sehN-0qYpX_0_tw@mail.gmail.com>
Message-ID: <CANtt_hz8dxCmn3BcmP4gHPv37RhsoEoLBLeZWz1JAtk1KRr1GQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121007/6094dd6c/attachment.pl>

From mintibezabih at gmail.com  Mon Oct  8 05:46:14 2012
From: mintibezabih at gmail.com (alemante zd)
Date: Mon, 8 Oct 2012 04:46:14 +0100
Subject: [R-sig-Geo] How to find project 4 string
In-Reply-To: <CANtt_hz8dxCmn3BcmP4gHPv37RhsoEoLBLeZWz1JAtk1KRr1GQ@mail.gmail.com>
References: <CAJfxP+qN7o2wUN8tYBkB4vHp9723HOjvnL5sehN-0qYpX_0_tw@mail.gmail.com>
	<CANtt_hz8dxCmn3BcmP4gHPv37RhsoEoLBLeZWz1JAtk1KRr1GQ@mail.gmail.com>
Message-ID: <CAJfxP+o4f04bnRMtg7u-hisnDsfDsaF_GFmZU+EM+_Dd2j8jBA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121008/c4b4c7d8/attachment.pl>

From cmora at dal.ca  Mon Oct  8 05:55:08 2012
From: cmora at dal.ca (Camilo Mora)
Date: Mon, 08 Oct 2012 00:55:08 -0300
Subject: [R-sig-Geo] extracting values from rasters
In-Reply-To: <CANtt_hxt3B=xXBt8BPLzvU4gXXdwReR9C1Gn-8BJMHjH+zGv8Q@mail.gmail.com>
References: <d3b2b7fb504845f6a8d413d49050519b@EX-0-HT0.lancs.local>
	<CANVKczNCTOTvnj5eV3tNAUt_jfbErSLjj8zspj6RhS5WOmyJnw@mail.gmail.com>
	<20121007145818.17584wkq78w5iiec@wm3.dal.ca>
	<CANtt_hxt3B=xXBt8BPLzvU4gXXdwReR9C1Gn-8BJMHjH+zGv8Q@mail.gmail.com>
Message-ID: <20121008005508.12451l141ltnm8bo@wm2.dal.ca>

Thanks Robert,

I am exploring an option suggested by Barry and would like to explore  
yours to. A question I have though is how to use "extract" to a  
raster. According to the instructions extract takes the data from a  
raster on the areas overlapping polygons, lines, points and extents.  
But not info on other rasters. Is there a trick to extract to another  
raster?

Thanks,

Camilo


Camilo Mora, Ph.D.
Department of Geography, University of Hawaii
Currently available in Colombia
Phone:   Country code: 57
          Provider code: 313
          Phone 776 2282
          From the USA or Canada you have to dial 011 57 313 776 2282
http://www.soc.hawaii.edu/mora/



Quoting "Robert J. Hijmans" <r.hijmans at gmail.com>:

> On Sun, Oct 7, 2012 at 10:58 AM, Camilo Mora <cmora at dal.ca> wrote:
>
>> Thanks Barry,
>>
>> I did try resample. Unfortunately, it is taking about 15 minutes and after
>> that it says that it failed returning the message "Reached total allocation
>> of 5813Mb: see help(memory.size)".
>>
>>
> I have made some changes in resample to hopefully avoid this in the future.
> You can probably also avoid this lowering the default values for chunksize
> and maxmemory (see ?setOptions)
>
>
>> I converted my habitat raster to points (about 500,000) and use the
>> "extract" fucntion. it does the extraction in about two minutes, which
>> makes me realize that the resample function is taking to long because of
>> the interpolation method.
>>
>
>
> You could use
>
> extract(   , method='bilinear')
>
> assuming that you two rasters have more or less the same resolution (or at
> least that the resolution of the raster where you extract values from is
> not much higher than that of the other raster)
>
>
>
>>
>> Do you know if there is an analogous function to resample that considers
>> just the overlap of cells to assing values?.
>>
>> Thanks,
>>
>>
>> Camilo
>> http://www.soc.hawaii.edu/**mora/ <http://www.soc.hawaii.edu/mora/>
>>
>>
>>
>>
>> Quoting Barry Rowlingson <b.rowlingson at lancaster.ac.uk>**:
>>
>>  On Sun, Oct 7, 2012 at 7:56 AM, Camilo Mora <cmora at dal.ca> wrote:
>>>
>>>> Hi:
>>>> I wonder if anyone knows a function to extract values from one raster
>>>> to another raster when the rasters differ in resolution and extent. In
>>>> other words extracting values just in overlapping cells.
>>>>
>>>> This is my specific problem: I have two rasters (one is for
>>>> temperature worldwide and the other is for the presence of reefs also
>>>> worldwide (the presence of reefs have values of 1 and all other cells
>>>> as NA)). (the rasters differ in resolution and extent). I just need to
>>>> put the values of the raster of temperature to each cell in the raster
>>>> of reefs. Will you know a function that may do this?
>>>>
>>>
>>>  You want to start off looking at the 'resample' function in the
>>> raster package. Read the note at the start of that about other
>>> possibilities. Since your cells don't line up, there's various ways of
>>> deciding what the value for a target cell is, including just sampling
>>> the centre points, or interpolating overlapping cells in various ways.
>>>
>>> Barry
>>>
>>>
>>>
>> ______________________________**_________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/**listinfo/r-sig-geo<https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
>>
>


From patrick.meyfroidt at uclouvain.be  Mon Oct  8 12:20:35 2012
From: patrick.meyfroidt at uclouvain.be (Patrick Meyfroidt)
Date: Mon, 8 Oct 2012 12:20:35 +0200
Subject: [R-sig-Geo] Error object 'can.sim2' not found in spatianl panel
 data - splm with spdep
Message-ID: <1f3cf43ebed6c51b9474f0a7d30100cd.squirrel@mmp.sipr-dc.ucl.ac.be>

Dear list,

I have spatial panel data (regions over years), that I subsetted to make
sure that the panel is balanced.

Using spdep, I calculated weights using nearest neighbors on these
regions, with the following code:

--
RUSCRS <- CRS("+proj=lcc +lat_1=15 +lat_2=65 +lat_0=30 +lon_0=95 +x_0=0
+y_0=0 +units=m +datum=WGS84")
rus <- readShapeSpatial([filename], IDvar = "index", proj4string = RUSCRS)
coords <- coordinates(rus)
ruskn5 <- knearneigh(coords, k=5, longlat = NULL)
ruskn5.nb <- knn2nb(ruskn5, row.names=rus$index, sym = FALSE)
wrus.knb5 <- nb2listw(ruskn5.nb, glist=NULL, style="W", zero.policy=NULL)
--

Everything looks fine, i.e. I can print out the results at each step, and
each unit apparently has indeed 5 neighbors with 0.2 weight for each.

Then I use splm package to perform a spatial panel regression, using the
code:

--
fm <- rnabd ~ rlex + pbpl
spml(formula = fm, data = rusp9508.subsvars, index ="index", listw =
wrus.knb5, model = "within", lag = TRUE, spatial.error = "b")
--

But I end up with the following error message:

"Error in get("can.sim2", envir = env) : object 'can.sim2' not found"


Can someone explain what is this "can.sim2" object and possible reasons
for the error message?

Thank you very much for any input,

Patrick Meyfroidt
Universit? catholique de Louvain - Belgium


From mello at ieee.org  Mon Oct  8 12:44:01 2012
From: mello at ieee.org (Marcio Pupin Mello)
Date: Mon, 8 Oct 2012 12:44:01 +0200
Subject: [R-sig-Geo] how to extract the attribute table of shape files
	using R
In-Reply-To: <BANLkTikzCCaJDSr0jepHQiWUe8td8r5DFQ@mail.gmail.com>
References: <BANLkTimjqjkHqmP9rHEtCZmkcmsgohgghg@mail.gmail.com>
	<BANLkTikzCCaJDSr0jepHQiWUe8td8r5DFQ@mail.gmail.com>
Message-ID: <k4uapg$p3i$1@ger.gmane.org>

Hi Elaine and Daniela,
    perhaps it is too late to help you, but I decided to reply aiming to 
help another R users with the same problem.

    You can

#read the shapefile - for shape files, dsn is the folder path an layer 
is the shapefile name (without .shp)
shape<-readOGR(dsn="/folder.where.you.file.is/",layer="name.of.your.shapefile")

    then you can access the attribute table by

shape at data

    so you can export it using

write.table(shape at data,"file.name.you.want.to.export.CVS",quote=F,row.names=F,sep=";")


    Good luck!

Marcio
www.dsr.inpe.br/~mello




On 5/3/11 11:04 AM, Daniela Ballari wrote:
> Hi Elaine,
>
> Once you have your data in R, you can use write.table (check documentation
> with ?write.table)
>
> write.table(dataframe, file = "dataframe.csv")
>
> If you don't have your data in R yet, you can see this document:
> http://cran.r-project.org/web/packages/spatstat/vignettes/shapefiles.pdf
>
> Daniela
>
>
> On Tue, May 3, 2011 at 10:30 AM, elaine kuo <elaine.kuo.tw at gmail.com> wrote:
>
>> Dear List,
>>
>> I have a polygon file describing locations of my study region.
>> Now I want to have the attribute table exported as cvs using R.
>> Please kindly advise which package and references are proper for this work.
>>
>> Thank you.
>>
>> Elaine
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>
>


From Patrick.Meyfroidt at uclouvain.be  Mon Oct  8 13:47:20 2012
From: Patrick.Meyfroidt at uclouvain.be (Patrick Meyfroidt)
Date: Mon, 8 Oct 2012 13:47:20 +0200
Subject: [R-sig-Geo] Error object 'can.sim2' not found in spatianl panel
 data - splm with spdep
In-Reply-To: <1f3cf43ebed6c51b9474f0a7d30100cd.squirrel@mmp.sipr-dc.ucl.ac.be>
References: <1f3cf43ebed6c51b9474f0a7d30100cd.squirrel@mmp.sipr-dc.ucl.ac.be>
Message-ID: <68e8e9211e6ecb4823be405d7c122b0f.squirrel@mmp.sipr-dc.ucl.ac.be>

OK, I may have some update, sorry for the disturbance.

By explicitly indicating that listw2 is the same as listw, like that:

spml(formula = fm, data = rusp9508.subsvars, index ="index", listw =
wrus.knb5, listw2 = listw, model = "within", lag = TRUE, spatial.error =
"b")

I now get the following error message:

Error in match(x, table, nomatch = 0L) : object 'listw' not found

So apparently the listw object cannot be read.

Is it because the weights were calculated once for each country, but the
dataset is a panel one?

Does someone have a clue?

Thanks,

Patrick Meyfroidt


> Dear list,
>
> I have spatial panel data (regions over years), that I subsetted to make
> sure that the panel is balanced.
>
> Using spdep, I calculated weights using nearest neighbors on these
> regions, with the following code:
>
> --
> RUSCRS <- CRS("+proj=lcc +lat_1=15 +lat_2=65 +lat_0=30 +lon_0=95 +x_0=0
> +y_0=0 +units=m +datum=WGS84")
> rus <- readShapeSpatial([filename], IDvar = "index", proj4string = RUSCRS)
> coords <- coordinates(rus)
> ruskn5 <- knearneigh(coords, k=5, longlat = NULL)
> ruskn5.nb <- knn2nb(ruskn5, row.names=rus$index, sym = FALSE)
> wrus.knb5 <- nb2listw(ruskn5.nb, glist=NULL, style="W", zero.policy=NULL)
> --
>
> Everything looks fine, i.e. I can print out the results at each step, and
> each unit apparently has indeed 5 neighbors with 0.2 weight for each.
>
> Then I use splm package to perform a spatial panel regression, using the
> code:
>
> --
> fm <- rnabd ~ rlex + pbpl
> spml(formula = fm, data = rusp9508.subsvars, index ="index", listw =
> wrus.knb5, model = "within", lag = TRUE, spatial.error = "b")
> --
>
> But I end up with the following error message:
>
> "Error in get("can.sim2", envir = env) : object 'can.sim2' not found"
>
>
> Can someone explain what is this "can.sim2" object and possible reasons
> for the error message?
>
> Thank you very much for any input,
>
> Patrick Meyfroidt
> Universit? catholique de Louvain - Belgium
>


From rafael.wueest at wsl.ch  Mon Oct  8 14:06:47 2012
From: rafael.wueest at wsl.ch (=?iso-8859-1?Q?Rafael_W=FCest?=)
Date: Mon, 8 Oct 2012 14:06:47 +0200
Subject: [R-sig-Geo] Error object 'can.sim2' not found in spatianl panel
	data - splm with spdep
In-Reply-To: <68e8e9211e6ecb4823be405d7c122b0f.squirrel@mmp.sipr-dc.ucl.ac.be>
References: <1f3cf43ebed6c51b9474f0a7d30100cd.squirrel@mmp.sipr-dc.ucl.ac.be>
	<68e8e9211e6ecb4823be405d7c122b0f.squirrel@mmp.sipr-dc.ucl.ac.be>
Message-ID: <52CFE335-5192-4E81-BA14-38670BAC38FB@wsl.ch>

Hi Patrick

I can not judge whether it makes any sense, but if you want listw and listw2 to be the same, try:

spml(formula = fm, data = rusp9508.subsvars, index ="index", listw =
wrus.knb5, listw2 = wrus.knb5, model = "within", lag = TRUE, spatial.error =
"b")

Otherwise, I guess, R is looking for listw in the wrong place. Look at http://obeautifulcode.com/R/How-R-Searches-And-Finds-Stuff/
for explanations.

HTH,
Rafael

On 08.10.2012, at 13:47, Patrick Meyfroidt wrote:

> OK, I may have some update, sorry for the disturbance.
> 
> By explicitly indicating that listw2 is the same as listw, like that:
> 
> spml(formula = fm, data = rusp9508.subsvars, index ="index", listw =
> wrus.knb5, listw2 = listw, model = "within", lag = TRUE, spatial.error =
> "b")
> 
> I now get the following error message:
> 
> Error in match(x, table, nomatch = 0L) : object 'listw' not found
> 
> So apparently the listw object cannot be read.
> 
> Is it because the weights were calculated once for each country, but the
> dataset is a panel one?
> 
> Does someone have a clue?
> 
> Thanks,
> 
> Patrick Meyfroidt
> 
> 
>> Dear list,
>> 
>> I have spatial panel data (regions over years), that I subsetted to make
>> sure that the panel is balanced.
>> 
>> Using spdep, I calculated weights using nearest neighbors on these
>> regions, with the following code:
>> 
>> --
>> RUSCRS <- CRS("+proj=lcc +lat_1=15 +lat_2=65 +lat_0=30 +lon_0=95 +x_0=0
>> +y_0=0 +units=m +datum=WGS84")
>> rus <- readShapeSpatial([filename], IDvar = "index", proj4string = RUSCRS)
>> coords <- coordinates(rus)
>> ruskn5 <- knearneigh(coords, k=5, longlat = NULL)
>> ruskn5.nb <- knn2nb(ruskn5, row.names=rus$index, sym = FALSE)
>> wrus.knb5 <- nb2listw(ruskn5.nb, glist=NULL, style="W", zero.policy=NULL)
>> --
>> 
>> Everything looks fine, i.e. I can print out the results at each step, and
>> each unit apparently has indeed 5 neighbors with 0.2 weight for each.
>> 
>> Then I use splm package to perform a spatial panel regression, using the
>> code:
>> 
>> --
>> fm <- rnabd ~ rlex + pbpl
>> spml(formula = fm, data = rusp9508.subsvars, index ="index", listw =
>> wrus.knb5, model = "within", lag = TRUE, spatial.error = "b")
>> --
>> 
>> But I end up with the following error message:
>> 
>> "Error in get("can.sim2", envir = env) : object 'can.sim2' not found"
>> 
>> 
>> Can someone explain what is this "can.sim2" object and possible reasons
>> for the error message?
>> 
>> Thank you very much for any input,
>> 
>> Patrick Meyfroidt
>> Universit? catholique de Louvain - Belgium
>> 
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



--
Rafael W?est
Swiss Federal Research Institute WSL
Z?rcherstrasse 111
8903 Birmensdorf
Switzerland

+41 44 7392126
rafael.wueest at wsl.ch
http://www.wsl.ch/info/mitarbeitende/wueest/index_EN


From R.L.Zijdeman at uu.nl  Mon Oct  8 16:07:33 2012
From: R.L.Zijdeman at uu.nl (Zijdeman, R.L. (Richard))
Date: Mon, 8 Oct 2012 14:07:33 +0000
Subject: [R-sig-Geo] question on adding variable to .dbf file
Message-ID: <897CE20E-92FD-4637-9B1B-BE1C281160F9@uu.nl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121008/26a8dc61/attachment.pl>

From gallemore.1 at osu.edu  Mon Oct  8 16:35:38 2012
From: gallemore.1 at osu.edu (Caleb Gallemore)
Date: Mon, 8 Oct 2012 10:35:38 -0400
Subject: [R-sig-Geo] Syntax for Instrumental Variables in SPLM
Message-ID: <CACpZSb3e9TQ6td7TSnoAOO1duOCe+qAF8GgHzfQkqAWfCXYvjA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121008/04fa1223/attachment.pl>

From sas0025 at auburn.edu  Mon Oct  8 16:40:14 2012
From: sas0025 at auburn.edu (Stephen Sefick)
Date: Mon, 08 Oct 2012 09:40:14 -0500
Subject: [R-sig-Geo] question on adding variable to .dbf file
In-Reply-To: <897CE20E-92FD-4637-9B1B-BE1C281160F9@uu.nl>
References: <897CE20E-92FD-4637-9B1B-BE1C281160F9@uu.nl>
Message-ID: <5072E5CE.5000904@auburn.edu>

Look at the foreign package

?read.dbf

On Mon 08 Oct 2012 09:07:33 AM CDT, Zijdeman, R.L. (Richard) wrote:
> Dear all,
>
> I am trying to add and then display regional characteristics (e.g. population size) to an existing map. The map comes as a .shp file, including .sbn, .sbx, .shx and .dbf file and portrays municipality borders.  However, once I have added a new column to the .dbf file, I am unable to reread the .shp file and get the following error:
> Error in `row.names<-.data.frame`(`*tmp*`, value = value) :   invalid 'row.names' length.
>
> Here's what I do:
>
> # To read the map:
> munis<-readShapePoly("nl_1890.shp")
>
> # To merge the new column with the original data:
> munis2<-merge(munis,y, by.x="acode", by.y="hplts_adam_code", all.x)
> # acode is key in the original file, to be merged with "hplts_adam_code" from the file containing regional information
>
> head(munis2,3)
> # acode GM_1890      GM_NAAM cbscode   famprop
> # 1 10002    0136    Zuidlaren     136 1.0000000
> # 2 10005    0086   Opsterland      86 1.0000000
> # 3 10007    0981        Vaals     981 0.1250000
>
> # Since I thought it was important, I changed the order of the variables back to the original order, with the added column "famprop" as last one:
> munis2<- munis2[c(2,3,4,1,5)]
> # GM_1890    GM_NAAM cbscode acode famprop
> # 1    0136  Zuidlaren     136 10002   1.000
> # 2    0086 Opsterland      86 10005   1.000
> # 3    0981      Vaals     981 10007   0.125
>
> # next I write munis2 into the .dbf file (using the original name for the .dbf file)
> write.dbf(munis2,"nl_1890")
>
> # finally I try to read in the .shp file again
> munis2shp<-readShapePoly("nl_1890.shp")
>
> # but this result in the following error:
> Error in `row.names<-.data.frame`(`*tmp*`, value = value) :
>   invalid 'row.names' length
>
> I am quite novice to R and mapping data, so any advice on either code or my approach is very much appreciated.
>
> Best,
>
> Richard
>
>
>
>
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Stephen Sefick
**************************************************
Auburn University                                         
Biological Sciences                                      
331 Funchess Hall                                       
Auburn, Alabama                                        
36849                                                           
**************************************************
sas0025 at auburn.edu                                  
http://www.auburn.edu/~sas0025                 
**************************************************

Let's not spend our time and resources thinking about things that are 
so little or so large that all they really do for us is puff us up and 
make us feel like gods.  We are mammals, and have not exhausted the 
annoying little problems of being mammals.

                                -K. Mullis

"A big computer, a complex algorithm and a long time does not equal 
science."

                              -Robert Gentleman


From R.L.Zijdeman at uu.nl  Mon Oct  8 17:10:52 2012
From: R.L.Zijdeman at uu.nl (Zijdeman, R.L. (Richard))
Date: Mon, 8 Oct 2012 15:10:52 +0000
Subject: [R-sig-Geo] question on adding variable to .dbf file
In-Reply-To: <5072E5CE.5000904@auburn.edu>
References: <897CE20E-92FD-4637-9B1B-BE1C281160F9@uu.nl>
	<5072E5CE.5000904@auburn.edu>
Message-ID: <74598F11-AEE7-4DDF-9FCB-6588B91A6CB9@uu.nl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121008/7b899216/attachment.pl>

From jstruve at ufl.edu  Mon Oct  8 22:11:03 2012
From: jstruve at ufl.edu (Struve,Juliane)
Date: Mon, 8 Oct 2012 20:11:03 +0000
Subject: [R-sig-Geo] question about plotKML() - Google Earth
Message-ID: <BFCE57D0BE7CBB42A581347DE375AF9A1155E685@UFEXCH-MBXN01.ad.ufl.edu>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121008/77058aa2/attachment.pl>

From mintibezabih at gmail.com  Tue Oct  9 00:21:49 2012
From: mintibezabih at gmail.com (alemante zd)
Date: Mon, 8 Oct 2012 23:21:49 +0100
Subject: [R-sig-Geo] finding CRS from latitude/longitude
In-Reply-To: <CANtt_hzbJKFN7KTHGwRfDTKfTJm3D+G3_OJdd6pF_Zw-cgSCFQ@mail.gmail.com>
References: <CAJfxP+pdbud=eVfJrfcB1qwRJ2KSGQevAZX40k0hK9AdQiLkMQ@mail.gmail.com>
	<CANtt_hxOAQ0AsWP7kdSUJ_VH9P2T6LknvtYcDBWcdPjO=DBNgA@mail.gmail.com>
	<CAJfxP+pxSrvdoHS0TcKNx0=TPE6KzaCjczgww9+M1eyDz2_qcA@mail.gmail.com>
	<CANtt_hzbJKFN7KTHGwRfDTKfTJm3D+G3_OJdd6pF_Zw-cgSCFQ@mail.gmail.com>
Message-ID: <CAJfxP+qSEQM=+WPEmTHs4o+=1wMsWKQtL7RXcgbqXVqArjdAsg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121008/2988ed26/attachment.pl>

From mitradevkota at hotmail.com  Tue Oct  9 01:03:04 2012
From: mitradevkota at hotmail.com (Mitra Devkota)
Date: Mon, 8 Oct 2012 23:03:04 +0000
Subject: [R-sig-Geo] finding CRS from latitude/longitude
In-Reply-To: <CAJfxP+qSEQM=+WPEmTHs4o+=1wMsWKQtL7RXcgbqXVqArjdAsg@mail.gmail.com>
References: <CAJfxP+pdbud=eVfJrfcB1qwRJ2KSGQevAZX40k0hK9AdQiLkMQ@mail.gmail.com>,
	<CANtt_hxOAQ0AsWP7kdSUJ_VH9P2T6LknvtYcDBWcdPjO=DBNgA@mail.gmail.com>,
	<CAJfxP+pxSrvdoHS0TcKNx0=TPE6KzaCjczgww9+M1eyDz2_qcA@mail.gmail.com>,
	<CANtt_hzbJKFN7KTHGwRfDTKfTJm3D+G3_OJdd6pF_Zw-cgSCFQ@mail.gmail.com>,
	<CAJfxP+qSEQM=+WPEmTHs4o+=1wMsWKQtL7RXcgbqXVqArjdAsg@mail.gmail.com>
Message-ID: <SNT002-W161FA08B9FCE39F193186F5CA880@phx.gbl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121008/18c2b58a/attachment.pl>

From mitradevkota at hotmail.com  Tue Oct  9 01:05:26 2012
From: mitradevkota at hotmail.com (Mitra Devkota)
Date: Mon, 8 Oct 2012 23:05:26 +0000
Subject: [R-sig-Geo] SAR, CAR and autlogistic models
In-Reply-To: <SNT002-W161FA08B9FCE39F193186F5CA880@phx.gbl>
References: <CAJfxP+pdbud=eVfJrfcB1qwRJ2KSGQevAZX40k0hK9AdQiLkMQ@mail.gmail.com>,
	,
	<CANtt_hxOAQ0AsWP7kdSUJ_VH9P2T6LknvtYcDBWcdPjO=DBNgA@mail.gmail.com>,
	,
	<CAJfxP+pxSrvdoHS0TcKNx0=TPE6KzaCjczgww9+M1eyDz2_qcA@mail.gmail.com>,
	,
	<CANtt_hzbJKFN7KTHGwRfDTKfTJm3D+G3_OJdd6pF_Zw-cgSCFQ@mail.gmail.com>,
	,
	<CAJfxP+qSEQM=+WPEmTHs4o+=1wMsWKQtL7RXcgbqXVqArjdAsg@mail.gmail.com>,
	<SNT002-W161FA08B9FCE39F193186F5CA880@phx.gbl>
Message-ID: <SNT002-W1616C00C5299F8863F7B1EDCA880@phx.gbl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121008/92c1614a/attachment.pl>

From lyndon.estes at gmail.com  Tue Oct  9 05:03:32 2012
From: lyndon.estes at gmail.com (Lyndon Estes)
Date: Mon, 8 Oct 2012 23:03:32 -0400
Subject: [R-sig-Geo] Pointers for querying postGIS and bringing spatial
	geometries into R
Message-ID: <CALuVVaaQjyXvt+kFCsxoQLQn4UfFk0y7250+tJqOBG6Eu_L0iQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121008/0227bedc/attachment.pl>

From hengl at spatial-analyst.net  Tue Oct  9 10:13:06 2012
From: hengl at spatial-analyst.net (Tomislav Hengl)
Date: Tue, 09 Oct 2012 10:13:06 +0200
Subject: [R-sig-Geo] question about plotKML() - Google Earth
In-Reply-To: <BFCE57D0BE7CBB42A581347DE375AF9A1155E685@UFEXCH-MBXN01.ad.ufl.edu>
References: <BFCE57D0BE7CBB42A581347DE375AF9A1155E685@UFEXCH-MBXN01.ad.ufl.edu>
Message-ID: <5073DC92.4000905@spatial-analyst.net>


On 08/10/2012 22:11, Struve,Juliane wrote:
> Dear list members,
>
> I am using plotKML() to plot some animal tracks on Google Earth. The
> attribute data that I am using are individual IDs, which consist of 4
> figures, e.g. 1145. In the STDIF object that I create these data
> appear correct in the "data" slot. However, in the plot on Google
> Earth the numbers are rounded, 1145 e.g. becomes 1150.
>
> Does anyone know what causes this/how to prevent it ?
>
> Thanks a lot for your time,
>
> Juliane

I need to see your code and the KML file. Please send it outside the 
R-sig-geo and I will try to fix.

The original function is at:

https://r-forge.r-project.org/scm/viewvc.php/pkg/R/layer.STTDF.R?view=markup&root=plotkml

thanks for your e-mail,

T. Hengl
http://www.wewur.wur.nl/popups/vcard.aspx?id=HENGL001

>
> [[alternative HTML version deleted]]
>
> _______________________________________________ R-sig-Geo mailing
> list R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From b.rowlingson at lancaster.ac.uk  Tue Oct  9 11:04:55 2012
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Tue, 9 Oct 2012 10:04:55 +0100
Subject: [R-sig-Geo] Pointers for querying postGIS and bringing spatial
 geometries into R
In-Reply-To: <4241b212a0f2480aaf1c8a0f9dc77859@EX-0-HT0.lancs.local>
References: <4241b212a0f2480aaf1c8a0f9dc77859@EX-0-HT0.lancs.local>
Message-ID: <CANVKczOt6nXANCvc_3hipSw5Wy8+_+Jx54zJnwF_8zbQZhLJKA@mail.gmail.com>

On Tue, Oct 9, 2012 at 4:03 AM, Lyndon Estes <lyndon.estes at gmail.com> wrote:

> library(RPostgreSQL)
> drv <- dbDriver("PostgreSQL")
> con <- dbConnect(drv, dbname = "mydb", user = "me", password = "mypw")
> sql <- "SELECT geom from sa1kgrid where id=9"
> kmlGeom <- dbGetQuery(con, sql)
> (But now I am getting this error:
> In postgresqlExecStatement(conn, statement, ...) :
>   RS-DBI driver warning: (unrecognized PostgreSQL field type geometry
> (id:16504) in column 0))
>

Thats a warning, not an error - if you look at the returned value you
are probably getting an encoded version of the geometry.

If you put a little conversion salt on your SQL you can get something
in text that should be parsable:

 sql
[1] "SELECT ST_AsEWKT(the_geom) from ccsm_polygons limit 2"
> dbGetQuery(con,sql)

                           st_asewkt
1 MULTIPOLYGON(((-179.29688 88.23322,-179.29688 90,-177.89063
90,-177.89063 88.23322,-179.29688 88.23322)))
2       MULTIPOLYGON(((-177.89063 90,-176.48438 90,-176.48438
88.23322,-177.89063 88.23322,-177.89063 90)))

There must be an R WKT reader somewhere...

Or as GML, which you could fiddle about with the XML package in R:

> sql <- "SELECT ST_AsGML(the_geom) from ccsm_polygons limit 2"
> dbGetQuery(con,sql)





                    st_asgml
1 <gml:MultiPolygon><gml:polygonMember><gml:Polygon><gml:outerBoundaryIs><gml:LinearRing><gml:coordinates>-179.296879999999987,88.233220000000003
-179.296879999999987,90 -177.890629999999987,90
-177.890629999999987,88.233220000000003
-179.296879999999987,88.233220000000003</gml:coordinates></gml:LinearRing></gml:outerBoundaryIs></gml:Polygon></gml:polygonMember></gml:MultiPolygon>
2
<gml:MultiPolygon><gml:polygonMember><gml:Polygon><gml:outerBoundaryIs><gml:LinearRing><gml:coordinates>-177.890629999999987,90
-176.484379999999987,90 -176.484379999999987,88.233220000000003
-177.890629999999987,88.233220000000003
-177.890629999999987,90</gml:coordinates></gml:LinearRing></gml:outerBoundaryIs></gml:Polygon></gml:polygonMember></gml:MultiPolygon>

Or maybe GeoJSON is better:

> sql <- "SELECT ST_AsGeoJSON(the_geom) from ccsm_polygons limit 2"
> dbGetQuery(con,sql)



st_asgeojson
1 {"type":"MultiPolygon","coordinates":[[[[-179.296879999999987,88.233220000000003],[-179.296879999999987,90],[-177.890629999999987,90],[-177.890629999999987,88.233220000000003],[-179.296879999999987,88.233220000000003]]]]}
2
{"type":"MultiPolygon","coordinates":[[[[-177.890629999999987,90],[-176.484379999999987,90],[-176.484379999999987,88.233220000000003],[-177.890629999999987,88.233220000000003],[-177.890629999999987,90]]]]}
>

Either way, you can conceivably get the coordinates out that way. When
I tried the rgdal method:

> library(rgdal)
> mydf <- readOGR("PG:dbname='mydf' user='me' password='mypw'",
> layer="sa1kgrid")
> (I have also tried various permutations of the dbname, quotes, etc., but
> all get me this:
>
> Error in ogrInfo(dsn = dsn, layer = layer, input_field_name_encoding =
> input_field_name_encoding)

  - that worked perfectly for me

 > ogrInfo("PG:dbname='gis'", layer='ccsm_polygons')
Source: "PG:dbname='gis'", layer: "ccsm_polygons"
Driver: PostgreSQL number of rows 32768
Feature type: wkbMultiPolygon with 2 dimensions
NA
Number of fields: 4
        name type length typeName
1       area    0      2  Integer
2  perimeter    0      3  Integer
3 ccsm_polys    0      0  Integer
4 ccsm_pol_1    0      0  Integer

 - so I suspect there's something in your database that readOGR
doesn't like - possibly one of the columns is a type that ogr can't
map to something...


> Oh, one other thing that seems to be possibly relevant, when I try with
> straight up ogr2ogr to access the postGIS database, I get this result:
>
> This is simply from doing this:
>
>> ogr2ogr
> ogr2ogr: error while loading shared libraries: libjpeg.so.8: cannot open
> shared object file: No such file or directory

 From the shell command line? Well that's just broken!

Barry


From mdsumner at gmail.com  Tue Oct  9 11:09:10 2012
From: mdsumner at gmail.com (Michael Sumner)
Date: Tue, 9 Oct 2012 20:09:10 +1100
Subject: [R-sig-Geo] Pointers for querying postGIS and bringing spatial
 geometries into R
In-Reply-To: <CANVKczOt6nXANCvc_3hipSw5Wy8+_+Jx54zJnwF_8zbQZhLJKA@mail.gmail.com>
References: <4241b212a0f2480aaf1c8a0f9dc77859@EX-0-HT0.lancs.local>
	<CANVKczOt6nXANCvc_3hipSw5Wy8+_+Jx54zJnwF_8zbQZhLJKA@mail.gmail.com>
Message-ID: <CAAcGz993F6wPe9SDXsnvhCOhYsjJ9-C9CE5dAFCmNpuh-_7_fg@mail.gmail.com>

<snip>
>
> There must be an R WKT reader somewhere...
>


rgeos::readWKT


On Tue, Oct 9, 2012 at 8:04 PM, Barry Rowlingson
<b.rowlingson at lancaster.ac.uk> wrote:
> On Tue, Oct 9, 2012 at 4:03 AM, Lyndon Estes <lyndon.estes at gmail.com> wrote:
>
>> library(RPostgreSQL)
>> drv <- dbDriver("PostgreSQL")
>> con <- dbConnect(drv, dbname = "mydb", user = "me", password = "mypw")
>> sql <- "SELECT geom from sa1kgrid where id=9"
>> kmlGeom <- dbGetQuery(con, sql)
>> (But now I am getting this error:
>> In postgresqlExecStatement(conn, statement, ...) :
>>   RS-DBI driver warning: (unrecognized PostgreSQL field type geometry
>> (id:16504) in column 0))
>>
>
> Thats a warning, not an error - if you look at the returned value you
> are probably getting an encoded version of the geometry.
>
> If you put a little conversion salt on your SQL you can get something
> in text that should be parsable:
>
>  sql
> [1] "SELECT ST_AsEWKT(the_geom) from ccsm_polygons limit 2"
>> dbGetQuery(con,sql)
>
>                            st_asewkt
> 1 MULTIPOLYGON(((-179.29688 88.23322,-179.29688 90,-177.89063
> 90,-177.89063 88.23322,-179.29688 88.23322)))
> 2       MULTIPOLYGON(((-177.89063 90,-176.48438 90,-176.48438
> 88.23322,-177.89063 88.23322,-177.89063 90)))
>
> There must be an R WKT reader somewhere...
>
> Or as GML, which you could fiddle about with the XML package in R:
>
>> sql <- "SELECT ST_AsGML(the_geom) from ccsm_polygons limit 2"
>> dbGetQuery(con,sql)
>
>
>
>
>
>                     st_asgml
> 1 <gml:MultiPolygon><gml:polygonMember><gml:Polygon><gml:outerBoundaryIs><gml:LinearRing><gml:coordinates>-179.296879999999987,88.233220000000003
> -179.296879999999987,90 -177.890629999999987,90
> -177.890629999999987,88.233220000000003
> -179.296879999999987,88.233220000000003</gml:coordinates></gml:LinearRing></gml:outerBoundaryIs></gml:Polygon></gml:polygonMember></gml:MultiPolygon>
> 2
> <gml:MultiPolygon><gml:polygonMember><gml:Polygon><gml:outerBoundaryIs><gml:LinearRing><gml:coordinates>-177.890629999999987,90
> -176.484379999999987,90 -176.484379999999987,88.233220000000003
> -177.890629999999987,88.233220000000003
> -177.890629999999987,90</gml:coordinates></gml:LinearRing></gml:outerBoundaryIs></gml:Polygon></gml:polygonMember></gml:MultiPolygon>
>
> Or maybe GeoJSON is better:
>
>> sql <- "SELECT ST_AsGeoJSON(the_geom) from ccsm_polygons limit 2"
>> dbGetQuery(con,sql)
>
>
>
> st_asgeojson
> 1 {"type":"MultiPolygon","coordinates":[[[[-179.296879999999987,88.233220000000003],[-179.296879999999987,90],[-177.890629999999987,90],[-177.890629999999987,88.233220000000003],[-179.296879999999987,88.233220000000003]]]]}
> 2
> {"type":"MultiPolygon","coordinates":[[[[-177.890629999999987,90],[-176.484379999999987,90],[-176.484379999999987,88.233220000000003],[-177.890629999999987,88.233220000000003],[-177.890629999999987,90]]]]}
>>
>
> Either way, you can conceivably get the coordinates out that way. When
> I tried the rgdal method:
>
>> library(rgdal)
>> mydf <- readOGR("PG:dbname='mydf' user='me' password='mypw'",
>> layer="sa1kgrid")
>> (I have also tried various permutations of the dbname, quotes, etc., but
>> all get me this:
>>
>> Error in ogrInfo(dsn = dsn, layer = layer, input_field_name_encoding =
>> input_field_name_encoding)
>
>   - that worked perfectly for me
>
>  > ogrInfo("PG:dbname='gis'", layer='ccsm_polygons')
> Source: "PG:dbname='gis'", layer: "ccsm_polygons"
> Driver: PostgreSQL number of rows 32768
> Feature type: wkbMultiPolygon with 2 dimensions
> NA
> Number of fields: 4
>         name type length typeName
> 1       area    0      2  Integer
> 2  perimeter    0      3  Integer
> 3 ccsm_polys    0      0  Integer
> 4 ccsm_pol_1    0      0  Integer
>
>  - so I suspect there's something in your database that readOGR
> doesn't like - possibly one of the columns is a type that ogr can't
> map to something...
>
>
>> Oh, one other thing that seems to be possibly relevant, when I try with
>> straight up ogr2ogr to access the postGIS database, I get this result:
>>
>> This is simply from doing this:
>>
>>> ogr2ogr
>> ogr2ogr: error while loading shared libraries: libjpeg.so.8: cannot open
>> shared object file: No such file or directory
>
>  From the shell command line? Well that's just broken!
>
> Barry
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



-- 
Michael Sumner
Hobart, Australia
e-mail: mdsumner at gmail.com


From patrick.meyfroidt at uclouvain.be  Tue Oct  9 11:25:59 2012
From: patrick.meyfroidt at uclouvain.be (Patrick Meyfroidt)
Date: Tue, 9 Oct 2012 11:25:59 +0200
Subject: [R-sig-Geo] Error object 'can.sim2' not found in spatianl panel
 data - splm with spdep
In-Reply-To: <52CFE335-5192-4E81-BA14-38670BAC38FB@wsl.ch>
References: <1f3cf43ebed6c51b9474f0a7d30100cd.squirrel@mmp.sipr-dc.ucl.ac.be>
	<68e8e9211e6ecb4823be405d7c122b0f.squirrel@mmp.sipr-dc.ucl.ac.be>
	<52CFE335-5192-4E81-BA14-38670BAC38FB@wsl.ch>
Message-ID: <4116f454d469836dcaa8c0ea2f5a1e7f.squirrel@mmp.sipr-dc.ucl.ac.be>

Hi Rafael,

thank you very much for the answer.

I read the page you referred to, and it was indeed very interesting, but I
haven't yet figured out how to use that in my problem.

When I do:
  ls( envir = .GlobalEnv )
I see that the object I use for listw, which is "wrus.knb5", is indeed
located in .GlobalEnv

I tried - not sure it was necessary or useful - to force spml to be
enclosed in .GlobalEnv by doing:
  environment( spml ) = .GlobalEnv
But still the object listw is not found.

I also tried to specify where to look for wrus.knb5, by using:
  spml( ... listw = .GlobalEnv:::wrus.knb5 ...)
but, as can be expected, it does not work because .GlobalEnv is not a
package.

So, two questions:
- What is R looking in the wrong place? Is it the function listw, or the
object wrus.knb5 that I use as input for listw ?
- Based on that, how can I help R to look at the right place?

Thanks,

Patrick


> Hi Patrick
>
> I can not judge whether it makes any sense, but if you want listw and
> listw2 to be the same, try:
>
> spml(formula = fm, data = rusp9508.subsvars, index ="index", listw =
> wrus.knb5, listw2 = wrus.knb5, model = "within", lag = TRUE, spatial.error
> =
> "b")
>
> Otherwise, I guess, R is looking for listw in the wrong place. Look at
> http://obeautifulcode.com/R/How-R-Searches-And-Finds-Stuff/
> for explanations.
>
> HTH,
> Rafael
>
> On 08.10.2012, at 13:47, Patrick Meyfroidt wrote:
>
>> OK, I may have some update, sorry for the disturbance.
>>
>> By explicitly indicating that listw2 is the same as listw, like that:
>>
>> spml(formula = fm, data = rusp9508.subsvars, index ="index", listw =
>> wrus.knb5, listw2 = listw, model = "within", lag = TRUE, spatial.error =
>> "b")
>>
>> I now get the following error message:
>>
>> Error in match(x, table, nomatch = 0L) : object 'listw' not found
>>
>> So apparently the listw object cannot be read.
>>
>> Is it because the weights were calculated once for each country, but the
>> dataset is a panel one?
>>
>> Does someone have a clue?
>>
>> Thanks,
>>
>> Patrick Meyfroidt
>>
>>
>>> Dear list,
>>>
>>> I have spatial panel data (regions over years), that I subsetted to
>>> make
>>> sure that the panel is balanced.
>>>
>>> Using spdep, I calculated weights using nearest neighbors on these
>>> regions, with the following code:
>>>
>>> --
>>> RUSCRS <- CRS("+proj=lcc +lat_1=15 +lat_2=65 +lat_0=30 +lon_0=95 +x_0=0
>>> +y_0=0 +units=m +datum=WGS84")
>>> rus <- readShapeSpatial([filename], IDvar = "index", proj4string =
>>> RUSCRS)
>>> coords <- coordinates(rus)
>>> ruskn5 <- knearneigh(coords, k=5, longlat = NULL)
>>> ruskn5.nb <- knn2nb(ruskn5, row.names=rus$index, sym = FALSE)
>>> wrus.knb5 <- nb2listw(ruskn5.nb, glist=NULL, style="W",
>>> zero.policy=NULL)
>>> --
>>>
>>> Everything looks fine, i.e. I can print out the results at each step,
>>> and
>>> each unit apparently has indeed 5 neighbors with 0.2 weight for each.
>>>
>>> Then I use splm package to perform a spatial panel regression, using
>>> the
>>> code:
>>>
>>> --
>>> fm <- rnabd ~ rlex + pbpl
>>> spml(formula = fm, data = rusp9508.subsvars, index ="index", listw =
>>> wrus.knb5, model = "within", lag = TRUE, spatial.error = "b")
>>> --
>>>
>>> But I end up with the following error message:
>>>
>>> "Error in get("can.sim2", envir = env) : object 'can.sim2' not found"
>>>
>>>
>>> Can someone explain what is this "can.sim2" object and possible reasons
>>> for the error message?
>>>
>>> Thank you very much for any input,
>>>
>>> Patrick Meyfroidt
>>> Universit? catholique de Louvain - Belgium
>>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
>
> --
> Rafael W?est
> Swiss Federal Research Institute WSL
> Z?rcherstrasse 111
> 8903 Birmensdorf
> Switzerland
>
> +41 44 7392126
> rafael.wueest at wsl.ch
> http://www.wsl.ch/info/mitarbeitende/wueest/index_EN
>
>
>
>


From juliachacon at gmail.com  Tue Oct  9 12:16:40 2012
From: juliachacon at gmail.com (Julia Chacon Labella)
Date: Tue, 9 Oct 2012 12:16:40 +0200
Subject: [R-sig-Geo] doubts with density ppp function
Message-ID: <CAPsE2jzVx5vsUTMJAYTd=U8YgGv3m=3rn3xhQYdC_wS5Uwxv6A@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121009/f37a8d77/attachment.pl>

From roman.lustrik at gmail.com  Tue Oct  9 12:56:28 2012
From: roman.lustrik at gmail.com (=?UTF-8?Q?Roman_Lu=C5=A1trik?=)
Date: Tue, 9 Oct 2012 12:56:28 +0200
Subject: [R-sig-Geo] doubts with density ppp function
In-Reply-To: <CAPsE2jzVx5vsUTMJAYTd=U8YgGv3m=3rn3xhQYdC_wS5Uwxv6A@mail.gmail.com>
References: <CAPsE2jzVx5vsUTMJAYTd=U8YgGv3m=3rn3xhQYdC_wS5Uwxv6A@mail.gmail.com>
Message-ID: <CAHT1vpgFAZktQdDnKsEKi5UtSOCrqs6crkLUa+-buS08MarF8A@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121009/ea5b20c0/attachment.pl>

From patrick.meyfroidt at uclouvain.be  Tue Oct  9 13:57:09 2012
From: patrick.meyfroidt at uclouvain.be (Patrick Meyfroidt)
Date: Tue, 9 Oct 2012 13:57:09 +0200
Subject: [R-sig-Geo] Error object 'can.sim2' not found in spatianl panel
 data - splm with spdep
In-Reply-To: <BEA55682-2506-4531-8FD3-3BA6E993DDDF@wsl.ch>
References: <1f3cf43ebed6c51b9474f0a7d30100cd.squirrel@mmp.sipr-dc.ucl.ac.be>
	<68e8e9211e6ecb4823be405d7c122b0f.squirrel@mmp.sipr-dc.ucl.ac.be>
	<52CFE335-5192-4E81-BA14-38670BAC38FB@wsl.ch>
	<4116f454d469836dcaa8c0ea2f5a1e7f.squirrel@mmp.sipr-dc.ucl.ac.be>
	<BEA55682-2506-4531-8FD3-3BA6E993DDDF@wsl.ch>
Message-ID: <345c1c57896621c520317905a1838004.squirrel@mmp.sipr-dc.ucl.ac.be>

Yes,
in that case the error I get is:

Error in match(x, table, nomatch = 0L) : object 'wrus.knb5' not found

Thus, no matter I specify this for listw or listw2, in both cases R cannot
find the object.

Which I suppose answer my first question: it is not the "listw" function
which is not found, but the object I use as argument of that function,
right?

But now I'm still unclear about what to do.

Thanks anyway

> Hi Patrick
>
> Have you tried what I suggested?
>
> spml(formula = fm, data = rusp9508.subsvars, index ="index", listw =
> wrus.knb5,
> listw2 = wrus.knb5, model = "within", lag = TRUE, spatial.error="b")
>
> Rafael
>
> On 09.10.2012, at 11:25, Patrick Meyfroidt wrote:
>
>> Hi Rafael,
>>
>> thank you very much for the answer.
>>
>> I read the page you referred to, and it was indeed very interesting, but
>> I
>> haven't yet figured out how to use that in my problem.
>>
>> When I do:
>>  ls( envir = .GlobalEnv )
>> I see that the object I use for listw, which is "wrus.knb5", is indeed
>> located in .GlobalEnv
>>
>> I tried - not sure it was necessary or useful - to force spml to be
>> enclosed in .GlobalEnv by doing:
>>  environment( spml ) = .GlobalEnv
>> But still the object listw is not found.
>>
>> I also tried to specify where to look for wrus.knb5, by using:
>>  spml( ... listw = .GlobalEnv:::wrus.knb5 ...)
>> but, as can be expected, it does not work because .GlobalEnv is not a
>> package.
>>
>> So, two questions:
>> - What is R looking in the wrong place? Is it the function listw, or the
>> object wrus.knb5 that I use as input for listw ?
>> - Based on that, how can I help R to look at the right place?
>>
>> Thanks,
>>
>> Patrick
>>
>>
>>> Hi Patrick
>>>
>>> I can not judge whether it makes any sense, but if you want listw and
>>> listw2 to be the same, try:
>>>
>>> spml(formula = fm, data = rusp9508.subsvars, index ="index", listw =
>>> wrus.knb5, listw2 = wrus.knb5, model = "within", lag = TRUE,
>>> spatial.error
>>> =
>>> "b")
>>>
>>> Otherwise, I guess, R is looking for listw in the wrong place. Look at
>>> http://obeautifulcode.com/R/How-R-Searches-And-Finds-Stuff/
>>> for explanations.
>>>
>>> HTH,
>>> Rafael
>>>
>>> On 08.10.2012, at 13:47, Patrick Meyfroidt wrote:
>>>
>>>> OK, I may have some update, sorry for the disturbance.
>>>>
>>>> By explicitly indicating that listw2 is the same as listw, like that:
>>>>
>>>> spml(formula = fm, data = rusp9508.subsvars, index ="index", listw =
>>>> wrus.knb5, listw2 = listw, model = "within", lag = TRUE, spatial.error
>>>> =
>>>> "b")
>>>>
>>>> I now get the following error message:
>>>>
>>>> Error in match(x, table, nomatch = 0L) : object 'listw' not found
>>>>
>>>> So apparently the listw object cannot be read.
>>>>
>>>> Is it because the weights were calculated once for each country, but
>>>> the
>>>> dataset is a panel one?
>>>>
>>>> Does someone have a clue?
>>>>
>>>> Thanks,
>>>>
>>>> Patrick Meyfroidt
>>>>
>>>>
>>>>> Dear list,
>>>>>
>>>>> I have spatial panel data (regions over years), that I subsetted to
>>>>> make
>>>>> sure that the panel is balanced.
>>>>>
>>>>> Using spdep, I calculated weights using nearest neighbors on these
>>>>> regions, with the following code:
>>>>>
>>>>> --
>>>>> RUSCRS <- CRS("+proj=lcc +lat_1=15 +lat_2=65 +lat_0=30 +lon_0=95
>>>>> +x_0=0
>>>>> +y_0=0 +units=m +datum=WGS84")
>>>>> rus <- readShapeSpatial([filename], IDvar = "index", proj4string =
>>>>> RUSCRS)
>>>>> coords <- coordinates(rus)
>>>>> ruskn5 <- knearneigh(coords, k=5, longlat = NULL)
>>>>> ruskn5.nb <- knn2nb(ruskn5, row.names=rus$index, sym = FALSE)
>>>>> wrus.knb5 <- nb2listw(ruskn5.nb, glist=NULL, style="W",
>>>>> zero.policy=NULL)
>>>>> --
>>>>>
>>>>> Everything looks fine, i.e. I can print out the results at each step,
>>>>> and
>>>>> each unit apparently has indeed 5 neighbors with 0.2 weight for each.
>>>>>
>>>>> Then I use splm package to perform a spatial panel regression, using
>>>>> the
>>>>> code:
>>>>>
>>>>> --
>>>>> fm <- rnabd ~ rlex + pbpl
>>>>> spml(formula = fm, data = rusp9508.subsvars, index ="index", listw =
>>>>> wrus.knb5, model = "within", lag = TRUE, spatial.error = "b")
>>>>> --
>>>>>
>>>>> But I end up with the following error message:
>>>>>
>>>>> "Error in get("can.sim2", envir = env) : object 'can.sim2' not found"
>>>>>
>>>>>
>>>>> Can someone explain what is this "can.sim2" object and possible
>>>>> reasons
>>>>> for the error message?
>>>>>
>>>>> Thank you very much for any input,
>>>>>
>>>>> Patrick Meyfroidt
>>>>> Universit? catholique de Louvain - Belgium
>>>>>
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at r-project.org
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>>
>>>
>>> --
>>> Rafael W?est
>>> Swiss Federal Research Institute WSL
>>> Z?rcherstrasse 111
>>> 8903 Birmensdorf
>>> Switzerland
>>>
>>> +41 44 7392126
>>> rafael.wueest at wsl.ch
>>> http://www.wsl.ch/info/mitarbeitende/wueest/index_EN
>>>
>>>
>>>
>>>
>>
>>
>
>
>
> --
> Rafael W?est
> Swiss Federal Research Institute WSL
> Z?rcherstrasse 111
> 8903 Birmensdorf
> Switzerland
>
> +41 44 7392126
> rafael.wueest at wsl.ch
> http://www.wsl.ch/info/mitarbeitende/wueest/index_EN
>
>
>
>


From Patrick.Meyfroidt at uclouvain.be  Tue Oct  9 15:36:36 2012
From: Patrick.Meyfroidt at uclouvain.be (Patrick Meyfroidt)
Date: Tue, 9 Oct 2012 15:36:36 +0200
Subject: [R-sig-Geo] Error object 'can.sim2' not found in spatianl panel
 data - splm with spdep
In-Reply-To: <345c1c57896621c520317905a1838004.squirrel@mmp.sipr-dc.ucl.ac.be>
References: <1f3cf43ebed6c51b9474f0a7d30100cd.squirrel@mmp.sipr-dc.ucl.ac.be>
	<68e8e9211e6ecb4823be405d7c122b0f.squirrel@mmp.sipr-dc.ucl.ac.be>
	<52CFE335-5192-4E81-BA14-38670BAC38FB@wsl.ch>
	<4116f454d469836dcaa8c0ea2f5a1e7f.squirrel@mmp.sipr-dc.ucl.ac.be>
	<BEA55682-2506-4531-8FD3-3BA6E993DDDF@wsl.ch>
	<345c1c57896621c520317905a1838004.squirrel@mmp.sipr-dc.ucl.ac.be>
Message-ID: <c0876d14a13deae84172edbda85f22ce.squirrel@mmp.sipr-dc.ucl.ac.be>

OK, now it appears that probably my problem was due to poor understanding
of how I had to create the listw object with spdep.

Starting from the nearest neighbor identification, what I was doing was:
ruskn5 <- knearneigh(coords, k=5, longlat = NULL)
ruskn5.nb <- knn2nb(ruskn5, row.names=rus$index, sym = FALSE)
wrus.knb5 <- nb2listw(ruskn5.nb, glist=NULL, style="W", zero.policy=NULL)

which I used before to deal with simple cross-section data.

Re-reading the spdep manual, I changed to:
ruskn5 <- knearneigh(coords, k=5, longlat = NULL)
ruskn5.nb <- knn2nb(ruskn5, row.names=rus$index, sym = FALSE)
wrus.knb5.mat <- nb2mat(ruskn5.nb, glist=NULL, style="W", zero.policy=NULL)
wrus.knb5.lw <- mat2listw(wrus.knb5.mat, row.names =rus$index, style="M")

Using that "wrus.knb5.lw" object created with mat2listw, and indeed
explicitly indicating that object in both listw and listw2, I get a result
to the spml function.

Now I just have to figure out whether the result is meaningful.

Thank you very much Rafael,

best regards,

Patrick


> Yes,
> in that case the error I get is:
>
> Error in match(x, table, nomatch = 0L) : object 'wrus.knb5' not found
>
> Thus, no matter I specify this for listw or listw2, in both cases R cannot
> find the object.
>
> Which I suppose answer my first question: it is not the "listw" function
> which is not found, but the object I use as argument of that function,
> right?
>
> But now I'm still unclear about what to do.
>
> Thanks anyway
>
>> Hi Patrick
>>
>> Have you tried what I suggested?
>>
>> spml(formula = fm, data = rusp9508.subsvars, index ="index", listw =
>> wrus.knb5,
>> listw2 = wrus.knb5, model = "within", lag = TRUE, spatial.error="b")
>>
>> Rafael
>>
>> On 09.10.2012, at 11:25, Patrick Meyfroidt wrote:
>>
>>> Hi Rafael,
>>>
>>> thank you very much for the answer.
>>>
>>> I read the page you referred to, and it was indeed very interesting,
>>> but
>>> I
>>> haven't yet figured out how to use that in my problem.
>>>
>>> When I do:
>>>  ls( envir = .GlobalEnv )
>>> I see that the object I use for listw, which is "wrus.knb5", is indeed
>>> located in .GlobalEnv
>>>
>>> I tried - not sure it was necessary or useful - to force spml to be
>>> enclosed in .GlobalEnv by doing:
>>>  environment( spml ) = .GlobalEnv
>>> But still the object listw is not found.
>>>
>>> I also tried to specify where to look for wrus.knb5, by using:
>>>  spml( ... listw = .GlobalEnv:::wrus.knb5 ...)
>>> but, as can be expected, it does not work because .GlobalEnv is not a
>>> package.
>>>
>>> So, two questions:
>>> - What is R looking in the wrong place? Is it the function listw, or
>>> the
>>> object wrus.knb5 that I use as input for listw ?
>>> - Based on that, how can I help R to look at the right place?
>>>
>>> Thanks,
>>>
>>> Patrick
>>>
>>>
>>>> Hi Patrick
>>>>
>>>> I can not judge whether it makes any sense, but if you want listw and
>>>> listw2 to be the same, try:
>>>>
>>>> spml(formula = fm, data = rusp9508.subsvars, index ="index", listw =
>>>> wrus.knb5, listw2 = wrus.knb5, model = "within", lag = TRUE,
>>>> spatial.error
>>>> =
>>>> "b")
>>>>
>>>> Otherwise, I guess, R is looking for listw in the wrong place. Look at
>>>> http://obeautifulcode.com/R/How-R-Searches-And-Finds-Stuff/
>>>> for explanations.
>>>>
>>>> HTH,
>>>> Rafael
>>>>
>>>> On 08.10.2012, at 13:47, Patrick Meyfroidt wrote:
>>>>
>>>>> OK, I may have some update, sorry for the disturbance.
>>>>>
>>>>> By explicitly indicating that listw2 is the same as listw, like that:
>>>>>
>>>>> spml(formula = fm, data = rusp9508.subsvars, index ="index", listw =
>>>>> wrus.knb5, listw2 = listw, model = "within", lag = TRUE,
>>>>> spatial.error
>>>>> =
>>>>> "b")
>>>>>
>>>>> I now get the following error message:
>>>>>
>>>>> Error in match(x, table, nomatch = 0L) : object 'listw' not found
>>>>>
>>>>> So apparently the listw object cannot be read.
>>>>>
>>>>> Is it because the weights were calculated once for each country, but
>>>>> the
>>>>> dataset is a panel one?
>>>>>
>>>>> Does someone have a clue?
>>>>>
>>>>> Thanks,
>>>>>
>>>>> Patrick Meyfroidt
>>>>>
>>>>>
>>>>>> Dear list,
>>>>>>
>>>>>> I have spatial panel data (regions over years), that I subsetted to
>>>>>> make
>>>>>> sure that the panel is balanced.
>>>>>>
>>>>>> Using spdep, I calculated weights using nearest neighbors on these
>>>>>> regions, with the following code:
>>>>>>
>>>>>> --
>>>>>> RUSCRS <- CRS("+proj=lcc +lat_1=15 +lat_2=65 +lat_0=30 +lon_0=95
>>>>>> +x_0=0
>>>>>> +y_0=0 +units=m +datum=WGS84")
>>>>>> rus <- readShapeSpatial([filename], IDvar = "index", proj4string =
>>>>>> RUSCRS)
>>>>>> coords <- coordinates(rus)
>>>>>> ruskn5 <- knearneigh(coords, k=5, longlat = NULL)
>>>>>> ruskn5.nb <- knn2nb(ruskn5, row.names=rus$index, sym = FALSE)
>>>>>> wrus.knb5 <- nb2listw(ruskn5.nb, glist=NULL, style="W",
>>>>>> zero.policy=NULL)
>>>>>> --
>>>>>>
>>>>>> Everything looks fine, i.e. I can print out the results at each
>>>>>> step,
>>>>>> and
>>>>>> each unit apparently has indeed 5 neighbors with 0.2 weight for
>>>>>> each.
>>>>>>
>>>>>> Then I use splm package to perform a spatial panel regression, using
>>>>>> the
>>>>>> code:
>>>>>>
>>>>>> --
>>>>>> fm <- rnabd ~ rlex + pbpl
>>>>>> spml(formula = fm, data = rusp9508.subsvars, index ="index", listw =
>>>>>> wrus.knb5, model = "within", lag = TRUE, spatial.error = "b")
>>>>>> --
>>>>>>
>>>>>> But I end up with the following error message:
>>>>>>
>>>>>> "Error in get("can.sim2", envir = env) : object 'can.sim2' not
>>>>>> found"
>>>>>>
>>>>>>
>>>>>> Can someone explain what is this "can.sim2" object and possible
>>>>>> reasons
>>>>>> for the error message?
>>>>>>
>>>>>> Thank you very much for any input,
>>>>>>
>>>>>> Patrick Meyfroidt
>>>>>> Universit? catholique de Louvain - Belgium
>>>>>>
>>>>>
>>>>> _______________________________________________
>>>>> R-sig-Geo mailing list
>>>>> R-sig-Geo at r-project.org
>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>>
>>>>
>>>> --
>>>> Rafael W?est
>>>> Swiss Federal Research Institute WSL
>>>> Z?rcherstrasse 111
>>>> 8903 Birmensdorf
>>>> Switzerland
>>>>
>>>> +41 44 7392126
>>>> rafael.wueest at wsl.ch
>>>> http://www.wsl.ch/info/mitarbeitende/wueest/index_EN
>>>>
>>>>
>>>>
>>>>
>>>
>>>
>>
>>
>>
>> --
>> Rafael W?est
>> Swiss Federal Research Institute WSL
>> Z?rcherstrasse 111
>> 8903 Birmensdorf
>> Switzerland
>>
>> +41 44 7392126
>> rafael.wueest at wsl.ch
>> http://www.wsl.ch/info/mitarbeitende/wueest/index_EN
>>
>>
>>
>>
>
>


From Roger.Bivand at nhh.no  Tue Oct  9 17:18:34 2012
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 9 Oct 2012 17:18:34 +0200 (CEST)
Subject: [R-sig-Geo] Error object 'can.sim2' not found in spatianl panel
 data - splm with spdep
In-Reply-To: <c0876d14a13deae84172edbda85f22ce.squirrel@mmp.sipr-dc.ucl.ac.be>
References: <1f3cf43ebed6c51b9474f0a7d30100cd.squirrel@mmp.sipr-dc.ucl.ac.be>
	<68e8e9211e6ecb4823be405d7c122b0f.squirrel@mmp.sipr-dc.ucl.ac.be>
	<52CFE335-5192-4E81-BA14-38670BAC38FB@wsl.ch>
	<4116f454d469836dcaa8c0ea2f5a1e7f.squirrel@mmp.sipr-dc.ucl.ac.be>
	<BEA55682-2506-4531-8FD3-3BA6E993DDDF@wsl.ch>
	<345c1c57896621c520317905a1838004.squirrel@mmp.sipr-dc.ucl.ac.be>
	<c0876d14a13deae84172edbda85f22ce.squirrel@mmp.sipr-dc.ucl.ac.be>
Message-ID: <alpine.LRH.2.02.1210091704200.30642@reclus.nhh.no>

On Tue, 9 Oct 2012, Patrick Meyfroidt wrote:

> OK, now it appears that probably my problem was due to poor understanding
> of how I had to create the listw object with spdep.
>
> Starting from the nearest neighbor identification, what I was doing was:
> ruskn5 <- knearneigh(coords, k=5, longlat = NULL)
> ruskn5.nb <- knn2nb(ruskn5, row.names=rus$index, sym = FALSE)
> wrus.knb5 <- nb2listw(ruskn5.nb, glist=NULL, style="W", zero.policy=NULL)
>
> which I used before to deal with simple cross-section data.
>
> Re-reading the spdep manual, I changed to:
> ruskn5 <- knearneigh(coords, k=5, longlat = NULL)
> ruskn5.nb <- knn2nb(ruskn5, row.names=rus$index, sym = FALSE)
> wrus.knb5.mat <- nb2mat(ruskn5.nb, glist=NULL, style="W", zero.policy=NULL)
> wrus.knb5.lw <- mat2listw(wrus.knb5.mat, row.names =rus$index, style="M")
>
> Using that "wrus.knb5.lw" object created with mat2listw, and indeed
> explicitly indicating that object in both listw and listw2, I get a result
> to the spml function.
>
> Now I just have to figure out whether the result is meaningful.

The actual underlying problem may be a missing assignment in R/spfeml.R of 
can.sim2 to env. The local environment env is used in maximum likelihood 
methods in splm and spdep to find the log-det (Jacobian), and should be 
set in the calling function, see ?do_ldet in spdep. The first error 
message was probably the important one. I have added the splm maintainer 
to the CCs.

Because the log likelihood function is called often, it is much more 
efficient to put all the objects needed by the function in an environment, 
and only pass a pointer to the environment to the function, than to pass 
the objects separately at each call; this way of handling optimisation 
function efficiency was recommended among others by Doug Bates.

Roger

>
> Thank you very much Rafael,
>
> best regards,
>
> Patrick
>
>
>> Yes,
>> in that case the error I get is:
>>
>> Error in match(x, table, nomatch = 0L) : object 'wrus.knb5' not found
>>
>> Thus, no matter I specify this for listw or listw2, in both cases R cannot
>> find the object.
>>
>> Which I suppose answer my first question: it is not the "listw" function
>> which is not found, but the object I use as argument of that function,
>> right?
>>
>> But now I'm still unclear about what to do.
>>
>> Thanks anyway
>>
>>> Hi Patrick
>>>
>>> Have you tried what I suggested?
>>>
>>> spml(formula = fm, data = rusp9508.subsvars, index ="index", listw =
>>> wrus.knb5,
>>> listw2 = wrus.knb5, model = "within", lag = TRUE, spatial.error="b")
>>>
>>> Rafael
>>>
>>> On 09.10.2012, at 11:25, Patrick Meyfroidt wrote:
>>>
>>>> Hi Rafael,
>>>>
>>>> thank you very much for the answer.
>>>>
>>>> I read the page you referred to, and it was indeed very interesting,
>>>> but
>>>> I
>>>> haven't yet figured out how to use that in my problem.
>>>>
>>>> When I do:
>>>>  ls( envir = .GlobalEnv )
>>>> I see that the object I use for listw, which is "wrus.knb5", is indeed
>>>> located in .GlobalEnv
>>>>
>>>> I tried - not sure it was necessary or useful - to force spml to be
>>>> enclosed in .GlobalEnv by doing:
>>>>  environment( spml ) = .GlobalEnv
>>>> But still the object listw is not found.
>>>>
>>>> I also tried to specify where to look for wrus.knb5, by using:
>>>>  spml( ... listw = .GlobalEnv:::wrus.knb5 ...)
>>>> but, as can be expected, it does not work because .GlobalEnv is not a
>>>> package.
>>>>
>>>> So, two questions:
>>>> - What is R looking in the wrong place? Is it the function listw, or
>>>> the
>>>> object wrus.knb5 that I use as input for listw ?
>>>> - Based on that, how can I help R to look at the right place?
>>>>
>>>> Thanks,
>>>>
>>>> Patrick
>>>>
>>>>
>>>>> Hi Patrick
>>>>>
>>>>> I can not judge whether it makes any sense, but if you want listw and
>>>>> listw2 to be the same, try:
>>>>>
>>>>> spml(formula = fm, data = rusp9508.subsvars, index ="index", listw =
>>>>> wrus.knb5, listw2 = wrus.knb5, model = "within", lag = TRUE,
>>>>> spatial.error
>>>>> =
>>>>> "b")
>>>>>
>>>>> Otherwise, I guess, R is looking for listw in the wrong place. Look at
>>>>> http://obeautifulcode.com/R/How-R-Searches-And-Finds-Stuff/
>>>>> for explanations.
>>>>>
>>>>> HTH,
>>>>> Rafael
>>>>>
>>>>> On 08.10.2012, at 13:47, Patrick Meyfroidt wrote:
>>>>>
>>>>>> OK, I may have some update, sorry for the disturbance.
>>>>>>
>>>>>> By explicitly indicating that listw2 is the same as listw, like that:
>>>>>>
>>>>>> spml(formula = fm, data = rusp9508.subsvars, index ="index", listw =
>>>>>> wrus.knb5, listw2 = listw, model = "within", lag = TRUE,
>>>>>> spatial.error
>>>>>> =
>>>>>> "b")
>>>>>>
>>>>>> I now get the following error message:
>>>>>>
>>>>>> Error in match(x, table, nomatch = 0L) : object 'listw' not found
>>>>>>
>>>>>> So apparently the listw object cannot be read.
>>>>>>
>>>>>> Is it because the weights were calculated once for each country, but
>>>>>> the
>>>>>> dataset is a panel one?
>>>>>>
>>>>>> Does someone have a clue?
>>>>>>
>>>>>> Thanks,
>>>>>>
>>>>>> Patrick Meyfroidt
>>>>>>
>>>>>>
>>>>>>> Dear list,
>>>>>>>
>>>>>>> I have spatial panel data (regions over years), that I subsetted to
>>>>>>> make
>>>>>>> sure that the panel is balanced.
>>>>>>>
>>>>>>> Using spdep, I calculated weights using nearest neighbors on these
>>>>>>> regions, with the following code:
>>>>>>>
>>>>>>> --
>>>>>>> RUSCRS <- CRS("+proj=lcc +lat_1=15 +lat_2=65 +lat_0=30 +lon_0=95
>>>>>>> +x_0=0
>>>>>>> +y_0=0 +units=m +datum=WGS84")
>>>>>>> rus <- readShapeSpatial([filename], IDvar = "index", proj4string =
>>>>>>> RUSCRS)
>>>>>>> coords <- coordinates(rus)
>>>>>>> ruskn5 <- knearneigh(coords, k=5, longlat = NULL)
>>>>>>> ruskn5.nb <- knn2nb(ruskn5, row.names=rus$index, sym = FALSE)
>>>>>>> wrus.knb5 <- nb2listw(ruskn5.nb, glist=NULL, style="W",
>>>>>>> zero.policy=NULL)
>>>>>>> --
>>>>>>>
>>>>>>> Everything looks fine, i.e. I can print out the results at each
>>>>>>> step,
>>>>>>> and
>>>>>>> each unit apparently has indeed 5 neighbors with 0.2 weight for
>>>>>>> each.
>>>>>>>
>>>>>>> Then I use splm package to perform a spatial panel regression, using
>>>>>>> the
>>>>>>> code:
>>>>>>>
>>>>>>> --
>>>>>>> fm <- rnabd ~ rlex + pbpl
>>>>>>> spml(formula = fm, data = rusp9508.subsvars, index ="index", listw =
>>>>>>> wrus.knb5, model = "within", lag = TRUE, spatial.error = "b")
>>>>>>> --
>>>>>>>
>>>>>>> But I end up with the following error message:
>>>>>>>
>>>>>>> "Error in get("can.sim2", envir = env) : object 'can.sim2' not
>>>>>>> found"
>>>>>>>
>>>>>>>
>>>>>>> Can someone explain what is this "can.sim2" object and possible
>>>>>>> reasons
>>>>>>> for the error message?
>>>>>>>
>>>>>>> Thank you very much for any input,
>>>>>>>
>>>>>>> Patrick Meyfroidt
>>>>>>> Universit? catholique de Louvain - Belgium
>>>>>>>
>>>>>>
>>>>>> _______________________________________________
>>>>>> R-sig-Geo mailing list
>>>>>> R-sig-Geo at r-project.org
>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>
>>>>>
>>>>>
>>>>> --
>>>>> Rafael W?est
>>>>> Swiss Federal Research Institute WSL
>>>>> Z?rcherstrasse 111
>>>>> 8903 Birmensdorf
>>>>> Switzerland
>>>>>
>>>>> +41 44 7392126
>>>>> rafael.wueest at wsl.ch
>>>>> http://www.wsl.ch/info/mitarbeitende/wueest/index_EN
>>>>>
>>>>>
>>>>>
>>>>>
>>>>
>>>>
>>>
>>>
>>>
>>> --
>>> Rafael W?est
>>> Swiss Federal Research Institute WSL
>>> Z?rcherstrasse 111
>>> 8903 Birmensdorf
>>> Switzerland
>>>
>>> +41 44 7392126
>>> rafael.wueest at wsl.ch
>>> http://www.wsl.ch/info/mitarbeitende/wueest/index_EN
>>>
>>>
>>>
>>>
>>
>>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From patrick.meyfroidt at uclouvain.be  Tue Oct  9 21:39:17 2012
From: patrick.meyfroidt at uclouvain.be (Patrick Meyfroidt)
Date: Tue, 9 Oct 2012 21:39:17 +0200
Subject: [R-sig-Geo] Error object 'can.sim2' not found in spatianl panel
 data - splm with spdep
In-Reply-To: <alpine.LRH.2.02.1210091704200.30642@reclus.nhh.no>
References: <1f3cf43ebed6c51b9474f0a7d30100cd.squirrel@mmp.sipr-dc.ucl.ac.be>
	<68e8e9211e6ecb4823be405d7c122b0f.squirrel@mmp.sipr-dc.ucl.ac.be>
	<52CFE335-5192-4E81-BA14-38670BAC38FB@wsl.ch>
	<4116f454d469836dcaa8c0ea2f5a1e7f.squirrel@mmp.sipr-dc.ucl.ac.be>
	<BEA55682-2506-4531-8FD3-3BA6E993DDDF@wsl.ch>
	<345c1c57896621c520317905a1838004.squirrel@mmp.sipr-dc.ucl.ac.be>
	<c0876d14a13deae84172edbda85f22ce.squirrel@mmp.sipr-dc.ucl.ac.be>
	<alpine.LRH.2.02.1210091704200.30642@reclus.nhh.no>
Message-ID: <0411f8c5544a1b7cb94e198333591921.squirrel@mmp.sipr-dc.ucl.ac.be>

Thanks Roger,

I hope it can help,

Patrick


> On Tue, 9 Oct 2012, Patrick Meyfroidt wrote:
>
>> OK, now it appears that probably my problem was due to poor
>> understanding
>> of how I had to create the listw object with spdep.
>>
>> Starting from the nearest neighbor identification, what I was doing was:
>> ruskn5 <- knearneigh(coords, k=5, longlat = NULL)
>> ruskn5.nb <- knn2nb(ruskn5, row.names=rus$index, sym = FALSE)
>> wrus.knb5 <- nb2listw(ruskn5.nb, glist=NULL, style="W",
>> zero.policy=NULL)
>>
>> which I used before to deal with simple cross-section data.
>>
>> Re-reading the spdep manual, I changed to:
>> ruskn5 <- knearneigh(coords, k=5, longlat = NULL)
>> ruskn5.nb <- knn2nb(ruskn5, row.names=rus$index, sym = FALSE)
>> wrus.knb5.mat <- nb2mat(ruskn5.nb, glist=NULL, style="W",
>> zero.policy=NULL)
>> wrus.knb5.lw <- mat2listw(wrus.knb5.mat, row.names =rus$index,
>> style="M")
>>
>> Using that "wrus.knb5.lw" object created with mat2listw, and indeed
>> explicitly indicating that object in both listw and listw2, I get a
>> result
>> to the spml function.
>>
>> Now I just have to figure out whether the result is meaningful.
>
> The actual underlying problem may be a missing assignment in R/spfeml.R of
> can.sim2 to env. The local environment env is used in maximum likelihood
> methods in splm and spdep to find the log-det (Jacobian), and should be
> set in the calling function, see ?do_ldet in spdep. The first error
> message was probably the important one. I have added the splm maintainer
> to the CCs.
>
> Because the log likelihood function is called often, it is much more
> efficient to put all the objects needed by the function in an environment,
> and only pass a pointer to the environment to the function, than to pass
> the objects separately at each call; this way of handling optimisation
> function efficiency was recommended among others by Doug Bates.
>
> Roger
>
>>
>> Thank you very much Rafael,
>>
>> best regards,
>>
>> Patrick
>>
>>
>>> Yes,
>>> in that case the error I get is:
>>>
>>> Error in match(x, table, nomatch = 0L) : object 'wrus.knb5' not found
>>>
>>> Thus, no matter I specify this for listw or listw2, in both cases R
>>> cannot
>>> find the object.
>>>
>>> Which I suppose answer my first question: it is not the "listw"
>>> function
>>> which is not found, but the object I use as argument of that function,
>>> right?
>>>
>>> But now I'm still unclear about what to do.
>>>
>>> Thanks anyway
>>>
>>>> Hi Patrick
>>>>
>>>> Have you tried what I suggested?
>>>>
>>>> spml(formula = fm, data = rusp9508.subsvars, index ="index", listw =
>>>> wrus.knb5,
>>>> listw2 = wrus.knb5, model = "within", lag = TRUE, spatial.error="b")
>>>>
>>>> Rafael
>>>>
>>>> On 09.10.2012, at 11:25, Patrick Meyfroidt wrote:
>>>>
>>>>> Hi Rafael,
>>>>>
>>>>> thank you very much for the answer.
>>>>>
>>>>> I read the page you referred to, and it was indeed very interesting,
>>>>> but
>>>>> I
>>>>> haven't yet figured out how to use that in my problem.
>>>>>
>>>>> When I do:
>>>>>  ls( envir = .GlobalEnv )
>>>>> I see that the object I use for listw, which is "wrus.knb5", is
>>>>> indeed
>>>>> located in .GlobalEnv
>>>>>
>>>>> I tried - not sure it was necessary or useful - to force spml to be
>>>>> enclosed in .GlobalEnv by doing:
>>>>>  environment( spml ) = .GlobalEnv
>>>>> But still the object listw is not found.
>>>>>
>>>>> I also tried to specify where to look for wrus.knb5, by using:
>>>>>  spml( ... listw = .GlobalEnv:::wrus.knb5 ...)
>>>>> but, as can be expected, it does not work because .GlobalEnv is not a
>>>>> package.
>>>>>
>>>>> So, two questions:
>>>>> - What is R looking in the wrong place? Is it the function listw, or
>>>>> the
>>>>> object wrus.knb5 that I use as input for listw ?
>>>>> - Based on that, how can I help R to look at the right place?
>>>>>
>>>>> Thanks,
>>>>>
>>>>> Patrick
>>>>>
>>>>>
>>>>>> Hi Patrick
>>>>>>
>>>>>> I can not judge whether it makes any sense, but if you want listw
>>>>>> and
>>>>>> listw2 to be the same, try:
>>>>>>
>>>>>> spml(formula = fm, data = rusp9508.subsvars, index ="index", listw =
>>>>>> wrus.knb5, listw2 = wrus.knb5, model = "within", lag = TRUE,
>>>>>> spatial.error
>>>>>> =
>>>>>> "b")
>>>>>>
>>>>>> Otherwise, I guess, R is looking for listw in the wrong place. Look
>>>>>> at
>>>>>> http://obeautifulcode.com/R/How-R-Searches-And-Finds-Stuff/
>>>>>> for explanations.
>>>>>>
>>>>>> HTH,
>>>>>> Rafael
>>>>>>
>>>>>> On 08.10.2012, at 13:47, Patrick Meyfroidt wrote:
>>>>>>
>>>>>>> OK, I may have some update, sorry for the disturbance.
>>>>>>>
>>>>>>> By explicitly indicating that listw2 is the same as listw, like
>>>>>>> that:
>>>>>>>
>>>>>>> spml(formula = fm, data = rusp9508.subsvars, index ="index", listw
>>>>>>> =
>>>>>>> wrus.knb5, listw2 = listw, model = "within", lag = TRUE,
>>>>>>> spatial.error
>>>>>>> =
>>>>>>> "b")
>>>>>>>
>>>>>>> I now get the following error message:
>>>>>>>
>>>>>>> Error in match(x, table, nomatch = 0L) : object 'listw' not found
>>>>>>>
>>>>>>> So apparently the listw object cannot be read.
>>>>>>>
>>>>>>> Is it because the weights were calculated once for each country,
>>>>>>> but
>>>>>>> the
>>>>>>> dataset is a panel one?
>>>>>>>
>>>>>>> Does someone have a clue?
>>>>>>>
>>>>>>> Thanks,
>>>>>>>
>>>>>>> Patrick Meyfroidt
>>>>>>>
>>>>>>>
>>>>>>>> Dear list,
>>>>>>>>
>>>>>>>> I have spatial panel data (regions over years), that I subsetted
>>>>>>>> to
>>>>>>>> make
>>>>>>>> sure that the panel is balanced.
>>>>>>>>
>>>>>>>> Using spdep, I calculated weights using nearest neighbors on these
>>>>>>>> regions, with the following code:
>>>>>>>>
>>>>>>>> --
>>>>>>>> RUSCRS <- CRS("+proj=lcc +lat_1=15 +lat_2=65 +lat_0=30 +lon_0=95
>>>>>>>> +x_0=0
>>>>>>>> +y_0=0 +units=m +datum=WGS84")
>>>>>>>> rus <- readShapeSpatial([filename], IDvar = "index", proj4string =
>>>>>>>> RUSCRS)
>>>>>>>> coords <- coordinates(rus)
>>>>>>>> ruskn5 <- knearneigh(coords, k=5, longlat = NULL)
>>>>>>>> ruskn5.nb <- knn2nb(ruskn5, row.names=rus$index, sym = FALSE)
>>>>>>>> wrus.knb5 <- nb2listw(ruskn5.nb, glist=NULL, style="W",
>>>>>>>> zero.policy=NULL)
>>>>>>>> --
>>>>>>>>
>>>>>>>> Everything looks fine, i.e. I can print out the results at each
>>>>>>>> step,
>>>>>>>> and
>>>>>>>> each unit apparently has indeed 5 neighbors with 0.2 weight for
>>>>>>>> each.
>>>>>>>>
>>>>>>>> Then I use splm package to perform a spatial panel regression,
>>>>>>>> using
>>>>>>>> the
>>>>>>>> code:
>>>>>>>>
>>>>>>>> --
>>>>>>>> fm <- rnabd ~ rlex + pbpl
>>>>>>>> spml(formula = fm, data = rusp9508.subsvars, index ="index", listw
>>>>>>>> =
>>>>>>>> wrus.knb5, model = "within", lag = TRUE, spatial.error = "b")
>>>>>>>> --
>>>>>>>>
>>>>>>>> But I end up with the following error message:
>>>>>>>>
>>>>>>>> "Error in get("can.sim2", envir = env) : object 'can.sim2' not
>>>>>>>> found"
>>>>>>>>
>>>>>>>>
>>>>>>>> Can someone explain what is this "can.sim2" object and possible
>>>>>>>> reasons
>>>>>>>> for the error message?
>>>>>>>>
>>>>>>>> Thank you very much for any input,
>>>>>>>>
>>>>>>>> Patrick Meyfroidt
>>>>>>>> Universit? catholique de Louvain - Belgium
>>>>>>>>
>>>>>>>
>>>>>>> _______________________________________________
>>>>>>> R-sig-Geo mailing list
>>>>>>> R-sig-Geo at r-project.org
>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>>
>>>>>>
>>>>>>
>>>>>> --
>>>>>> Rafael W?est
>>>>>> Swiss Federal Research Institute WSL
>>>>>> Z?rcherstrasse 111
>>>>>> 8903 Birmensdorf
>>>>>> Switzerland
>>>>>>
>>>>>> +41 44 7392126
>>>>>> rafael.wueest at wsl.ch
>>>>>> http://www.wsl.ch/info/mitarbeitende/wueest/index_EN
>>>>>>
>>>>>>
>>>>>>
>>>>>>
>>>>>
>>>>>
>>>>
>>>>
>>>>
>>>> --
>>>> Rafael W?est
>>>> Swiss Federal Research Institute WSL
>>>> Z?rcherstrasse 111
>>>> 8903 Birmensdorf
>>>> Switzerland
>>>>
>>>> +41 44 7392126
>>>> rafael.wueest at wsl.ch
>>>> http://www.wsl.ch/info/mitarbeitende/wueest/index_EN
>>>>
>>>>
>>>>
>>>>
>>>
>>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> --
> Roger Bivand
> Department of Economics, NHH Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no


From Hollister.Jeff at epamail.epa.gov  Tue Oct  9 22:34:23 2012
From: Hollister.Jeff at epamail.epa.gov (Jeff Hollister)
Date: Tue, 9 Oct 2012 15:34:23 -0500
Subject: [R-sig-Geo] Reading a Shapefile from a website with readOGR?
Message-ID: <OF439B328B.DCCB84D9-ON86257A92.007102EF-86257A92.007102F7@epamail.epa.gov>

An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121009/1716d7d8/attachment.html>

From mdsumner at gmail.com  Tue Oct  9 22:49:36 2012
From: mdsumner at gmail.com (Michael Sumner)
Date: Wed, 10 Oct 2012 07:49:36 +1100
Subject: [R-sig-Geo] Reading a Shapefile from a website with readOGR?
In-Reply-To: <OF439B328B.DCCB84D9-ON86257A92.007102EF-86257A92.007102F7@epamail.epa.gov>
References: <OF439B328B.DCCB84D9-ON86257A92.007102EF-86257A92.007102F7@epamail.epa.gov>
Message-ID: <CAAcGz98Aa01geCqhHnJ9K27rx4eyY=uWHNcVOcU2qs9420vPuw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121010/b35aa50d/attachment.pl>

From edzer.pebesma at uni-muenster.de  Tue Oct  9 23:21:57 2012
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Wed, 10 Oct 2012 00:21:57 +0300
Subject: [R-sig-Geo] Pointers for querying postGIS and bringing spatial
 geometries into R
In-Reply-To: <CANVKczOt6nXANCvc_3hipSw5Wy8+_+Jx54zJnwF_8zbQZhLJKA@mail.gmail.com>
References: <4241b212a0f2480aaf1c8a0f9dc77859@EX-0-HT0.lancs.local>
	<CANVKczOt6nXANCvc_3hipSw5Wy8+_+Jx54zJnwF_8zbQZhLJKA@mail.gmail.com>
Message-ID: <50749575.3090700@uni-muenster.de>



On 10/09/2012 12:04 PM, Barry Rowlingson wrote:
> There must be an R WKT reader somewhere...

rgeos::readWKT
-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From b.rowlingson at lancaster.ac.uk  Tue Oct  9 23:23:15 2012
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Tue, 9 Oct 2012 22:23:15 +0100
Subject: [R-sig-Geo] Reading a Shapefile from a website with readOGR?
In-Reply-To: <8e620b819dca48b6b684eebfcddbd908@EX-0-HT0.lancs.local>
References: <OF439B328B.DCCB84D9-ON86257A92.007102EF-86257A92.007102F7@epamail.epa.gov>
	<8e620b819dca48b6b684eebfcddbd908@EX-0-HT0.lancs.local>
Message-ID: <CANVKczPgSnR9YYZPr2u60TMkVSxuHzAe+7KjzBJd2UL5q8KXzw@mail.gmail.com>

On Tue, Oct 9, 2012 at 9:49 PM, Michael Sumner <mdsumner at gmail.com> wrote:
> This can work with a combination of vsizip (or other) and vsicurl, but the
> multiple files will have to be in an archive (zip or other).
>
> http://trac.osgeo.org/gdal/wiki/UserDocs/ReadInZip
>
> See examples near the bottom of the page for OGR. Keep the zip file name
> the same as the shapefile/layer name and don't have subdirectories for the
> simplest case.
>
> I am pretty sure this cannot work otherwise for a multifile format.

 Neat, but I suspect in practice the underlying code is just
downloading the zip and extracting to a temp file, which is about four
lines of R code. If the shapefile components aren't zipped up, its
just as easy.

 I'd write a wrapper to do that.

Barry


From mdsumner at gmail.com  Tue Oct  9 23:37:37 2012
From: mdsumner at gmail.com (Michael Sumner)
Date: Wed, 10 Oct 2012 08:37:37 +1100
Subject: [R-sig-Geo] Reading a Shapefile from a website with readOGR?
In-Reply-To: <CANVKczPgSnR9YYZPr2u60TMkVSxuHzAe+7KjzBJd2UL5q8KXzw@mail.gmail.com>
References: <OF439B328B.DCCB84D9-ON86257A92.007102EF-86257A92.007102F7@epamail.epa.gov>
	<8e620b819dca48b6b684eebfcddbd908@EX-0-HT0.lancs.local>
	<CANVKczPgSnR9YYZPr2u60TMkVSxuHzAe+7KjzBJd2UL5q8KXzw@mail.gmail.com>
Message-ID: <CAAcGz99n=XSUy7H97GuuzZLEvk1kgHNcUT4VKLsL+25y+cx4MQ@mail.gmail.com>

Heh, good point!  There are so many options some times . . .

On Wed, Oct 10, 2012 at 8:23 AM, Barry Rowlingson
<b.rowlingson at lancaster.ac.uk> wrote:
> On Tue, Oct 9, 2012 at 9:49 PM, Michael Sumner <mdsumner at gmail.com> wrote:
>> This can work with a combination of vsizip (or other) and vsicurl, but the
>> multiple files will have to be in an archive (zip or other).
>>
>> http://trac.osgeo.org/gdal/wiki/UserDocs/ReadInZip
>>
>> See examples near the bottom of the page for OGR. Keep the zip file name
>> the same as the shapefile/layer name and don't have subdirectories for the
>> simplest case.
>>
>> I am pretty sure this cannot work otherwise for a multifile format.
>
>  Neat, but I suspect in practice the underlying code is just
> downloading the zip and extracting to a temp file, which is about four
> lines of R code. If the shapefile components aren't zipped up, its
> just as easy.
>
>  I'd write a wrapper to do that.
>
> Barry



-- 
Michael Sumner
Hobart, Australia
e-mail: mdsumner at gmail.com


From r.turner at auckland.ac.nz  Wed Oct 10 01:00:43 2012
From: r.turner at auckland.ac.nz (Rolf Turner)
Date: Wed, 10 Oct 2012 12:00:43 +1300
Subject: [R-sig-Geo] doubts with density ppp function
In-Reply-To: <CAPsE2jzVx5vsUTMJAYTd=U8YgGv3m=3rn3xhQYdC_wS5Uwxv6A@mail.gmail.com>
References: <CAPsE2jzVx5vsUTMJAYTd=U8YgGv3m=3rn3xhQYdC_wS5Uwxv6A@mail.gmail.com>
Message-ID: <5074AC9B.3030300@auckland.ac.nz>

On 09/10/12 23:16, Julia Chacon Labella wrote:
> Just a short and simple question,
>
> How can I extract the values of an image created with "density.ppp"
> function?

     See ?"[.im".

     Let your image be called "A".

     If you have coordinates x and y at which you wish to extract the
     image values you can use:

         A[i=data.frame(x=x,y=y)]

     If you have pairs of indices (of pixels) at which you want to extract
     the image values you can form an n x 2 matrix (say "M") each row
     of which is an index pair and use

         A[i=M]
>
> And...there is any way to rotate this images? I tried with rotate() but I
> guess this is only for the ppp object, not for an image.
>

     You can use the affine.im() method for affine().  Or write a wrapper,
     rotate.im() for affine.im(), something like:

     rotate.im <- function(X,theta=pi/2) {
         co <- cos(theta)
         si <- sin(theta)
         m <- matrix(c(co,si,,-si,co),2,2)
         affine(X,mat=m)
     }

HTH

     cheers,

         Rolf Turner


From Adrian.Baddeley at csiro.au  Wed Oct 10 03:01:43 2012
From: Adrian.Baddeley at csiro.au (Adrian.Baddeley at csiro.au)
Date: Wed, 10 Oct 2012 09:01:43 +0800
Subject: [R-sig-Geo] doubts with density ppp function
In-Reply-To: <CAPsE2jzVx5vsUTMJAYTd=U8YgGv3m=3rn3xhQYdC_wS5Uwxv6A@mail.gmail.com>
References: <CAPsE2jzVx5vsUTMJAYTd=U8YgGv3m=3rn3xhQYdC_wS5Uwxv6A@mail.gmail.com>
Message-ID: <57DC18C299094D4299F837570C5DF1C50103EAC6D288@EXWA-MBX01.nexus.csiro.au>

In addition to Rolf's reply:

you can also extract the pixel values as a matrix using as.matrix()

Adrian

Prof Adrian Baddeley FAA
CSIRO Mathematics, Informatics & Statistics
Leeuwin Centre, 65 Brockway Rd, Floreat WA 6014, Australia
tel +61 8 9333 6177 skype adrian.baddeley
________________________________________
From: Julia Chacon Labella [juliachacon at gmail.com]
Sent: Tuesday, 9 October 2012 6:16 PM
To: Baddeley, Adrian (CMIS, Floreat)
Cc: r-sig-geo at r-project.org
Subject: doubts with density ppp function

Just a short and simple question,

How can I extract the values of an image created with "density.ppp" function?

And...there is any way to rotate this images? I tried with rotate() but I guess this is only for the ppp object, not for an image.

Thank you!



Julia Chacon Labella [PhD student]

?rea de Biodiversidad y Conservaci?n

Escuela Superior de Ciencias Experimentales y Tecnolog?a

Universidad Rey Juan Carlos

c/ Tulip?n, s/n.

E-28933 M?stoles (Madrid)

Espa?a


From changdong at ouc.edu.cn  Wed Oct 10 03:49:06 2012
From: changdong at ouc.edu.cn (=?gb2312?B?wfWzpLar?=)
Date: Wed, 10 Oct 2012 09:49:06 +0800
Subject: [R-sig-Geo] STIDF Prection of STkrige?
Message-ID: <UUSCNCLOQQYPNMSUDAOTOMPFSEXL.changdong@ouc.edu.cn>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121010/26fad0dd/attachment.pl>

From irenealabia at gmail.com  Wed Oct 10 05:39:21 2012
From: irenealabia at gmail.com (satellite12)
Date: Tue, 9 Oct 2012 20:39:21 -0700 (PDT)
Subject: [R-sig-Geo] GWR bandwidth and performance metric
Message-ID: <1349840361483-7581228.post@n2.nabble.com>

Hi, I wanted to try GWR and I'm confused on the definition of bandwidth.
Which will be better to use fixed or the adaptive one?

Also, is there a way to compute for the deviance explained by the model just
like the one's we get when we do GAM? I want to compare the two based on
this metric. Or better yet, are there other metrics to evaluate performance
between these two model types?

Thank you very much for any insight on this.

Cheers,
Irene 



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/GWR-bandwidth-and-performance-metric-tp7581228.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From Roger.Bivand at nhh.no  Wed Oct 10 05:45:20 2012
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 10 Oct 2012 05:45:20 +0200 (CEST)
Subject: [R-sig-Geo] GWR bandwidth and performance metric
In-Reply-To: <1349840361483-7581228.post@n2.nabble.com>
References: <1349840361483-7581228.post@n2.nabble.com>
Message-ID: <alpine.LRH.2.02.1210100542380.32662@reclus.nhh.no>

On Wed, 10 Oct 2012, satellite12 wrote:

> Hi, I wanted to try GWR and I'm confused on the definition of bandwidth.
> Which will be better to use fixed or the adaptive one?

Please read the references carefully. This is explained by Fotheringham et 
al. in the GWR book (2002). However, never think of using GWR, especially 
for anything inferential, without first reading and grasping Paez et al. 
(2011).

Roger

>
> Also, is there a way to compute for the deviance explained by the model just
> like the one's we get when we do GAM? I want to compare the two based on
> this metric. Or better yet, are there other metrics to evaluate performance
> between these two model types?
>
> Thank you very much for any insight on this.
>
> Cheers,
> Irene
>
>
>
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/GWR-bandwidth-and-performance-metric-tp7581228.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From juliachacon at gmail.com  Wed Oct 10 10:08:55 2012
From: juliachacon at gmail.com (Julia Chacon Labella)
Date: Wed, 10 Oct 2012 10:08:55 +0200
Subject: [R-sig-Geo] doubts with density ppp function
In-Reply-To: <57DC18C299094D4299F837570C5DF1C50103EAC6D288@EXWA-MBX01.nexus.csiro.au>
References: <CAPsE2jzVx5vsUTMJAYTd=U8YgGv3m=3rn3xhQYdC_wS5Uwxv6A@mail.gmail.com>
	<57DC18C299094D4299F837570C5DF1C50103EAC6D288@EXWA-MBX01.nexus.csiro.au>
Message-ID: <CAPsE2jwj=pA0mzYZGw==053jmfi_G9mFT40Jb97DR1i9g787PA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121010/b4af78ee/attachment.pl>

From edzer.pebesma at uni-muenster.de  Wed Oct 10 10:45:53 2012
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Wed, 10 Oct 2012 11:45:53 +0300
Subject: [R-sig-Geo] sp 1.0-0 package: sp.polygons in levelplot behaviour
In-Reply-To: <50705710.3090005@uni-muenster.de>
References: <1349405926675-7581148.post@n2.nabble.com>
	<50705710.3090005@uni-muenster.de>
Message-ID: <507535C1.6010201@uni-muenster.de>

sp-1.0-1, which fixes this, is now on CRAN.

On 10/06/2012 07:06 PM, Edzer Pebesma wrote:
> Jonathan, thanks for the clear bug report.
> 
> The old (correct) behaviour is obtained when you set
> 
> set_Polypath(FALSE)
> 
> right after loading sp.
> 
> The corrected sp.polygons is on r-forge, and will be in the next release
> of sp.
> 
> On 10/05/2012 05:58 AM, Jonathan wrote:
>> Hello all, 
>>
>> I updated my version of sp to 1.0-0 today and am getting a different
>> behaviour when using levelplot and sp.polygons.  The polygons do not appear
>> to be terminating when I run the following code.  Anyone else have this
>> problem?  It does seem to work if I use spplot though.  I have previous code
>> that uses lattice::levelplot and rasterVis::levelplot which I can modify to
>> spplot but would rather not have to.
>>
>> library(sp)
>> library(maptools)
>> library(lattice)
>> library(raster)
>> library(rasterVis)
>>
>> nc <- readShapePoly(system.file("shapes/sids.shp", package="maptools")[1],
>> proj4string=CRS("+proj=longlat +datum=NAD27"))
>> r <- raster(nc)
>> r[] <- 1
>> levelplot(r,
>>               panel = function(x,y,z,col.regions,subscripts,region,...){
>>                  panel.levelplot.raster(x, y, z, subscripts=subscripts)
>>                  sp.polygons(nc)
>>                }
>> )
>>
>>
>> Thank you,
>> Jonathan
>>
>> sessionInfo()
>> R version 2.15.1 (2012-06-22)
>> Platform: x86_64-unknown-linux-gnu (64-bit)
>>
>> locale:
>>  [1] LC_CTYPE=en_CA.UTF-8       LC_NUMERIC=C              
>> LC_TIME=en_CA.UTF-8        LC_COLLATE=en_CA.UTF-8    
>> LC_MONETARY=en_CA.UTF-8   
>>  [6] LC_MESSAGES=en_CA.UTF-8    LC_PAPER=C                 LC_NAME=C                 
>> LC_ADDRESS=C               LC_TELEPHONE=C            
>> [11] LC_MEASUREMENT=en_CA.UTF-8 LC_IDENTIFICATION=C       
>>
>> attached base packages:
>> [1] grid      stats     graphics  grDevices utils     datasets  methods  
>> base     
>>
>> other attached packages:
>> [1] rasterVis_0.11-01   hexbin_1.26.0       latticeExtra_0.6-24
>> RColorBrewer_1.0-5  raster_2.0-12       maptools_0.8-16     lattice_0.20-10    
>> [8] foreign_0.8-50      sp_1.0-0           
>>
>> loaded via a namespace (and not attached):
>> [1] tools_2.15.1 zoo_1.7-7   
>>
>>
>>
>> --
>> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/sp-1-0-0-package-sp-polygons-in-levelplot-behaviour-tp7581148.html
>> Sent from the R-sig-geo mailing list archive at Nabble.com.
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From lyndon.estes at gmail.com  Wed Oct 10 13:01:07 2012
From: lyndon.estes at gmail.com (Lyndon Estes)
Date: Wed, 10 Oct 2012 07:01:07 -0400
Subject: [R-sig-Geo] Pointers for querying postGIS and bringing spatial
 geometries into R
In-Reply-To: <50749575.3090700@uni-muenster.de>
References: <4241b212a0f2480aaf1c8a0f9dc77859@EX-0-HT0.lancs.local>
	<CANVKczOt6nXANCvc_3hipSw5Wy8+_+Jx54zJnwF_8zbQZhLJKA@mail.gmail.com>
	<50749575.3090700@uni-muenster.de>
Message-ID: <CALuVVaZ_xroB0hHnLfTs_sXkMPBL_0yfvPhS2oEc-4Lvt1Efhg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121010/982faecd/attachment.pl>

From pazurrobert at gmail.com  Wed Oct 10 14:51:18 2012
From: pazurrobert at gmail.com (Robert Pazur)
Date: Wed, 10 Oct 2012 14:51:18 +0200
Subject: [R-sig-Geo] polygon to raster -"adjusted" method
Message-ID: <CAJP9LR7XuEd_jxE8g1f8fmaO6LicSYHXDtFWfhyxm57FVqkchg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121010/38118fb8/attachment.pl>

From edzer.pebesma at uni-muenster.de  Wed Oct 10 15:22:21 2012
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Wed, 10 Oct 2012 16:22:21 +0300
Subject: [R-sig-Geo] STIDF Prection of STkrige?
In-Reply-To: <UUSCNCLOQQYPNMSUDAOTOMPFSEXL.changdong@ouc.edu.cn>
References: <UUSCNCLOQQYPNMSUDAOTOMPFSEXL.changdong@ouc.edu.cn>
Message-ID: <5075768D.4030201@uni-muenster.de>



On 10/10/2012 04:49 AM, ??? wrote:
>         I have a question.I have wall-eye fish survey data of American Erie lake from 1989 to 2010.Every year,the survey sites were random selected and had different number.I want to predict wall-eye catch-weight using different Spatio-temporal models,but I find krigeST function of R program can only predict STFDF(Spatial-Temporal Full Data Frame).Is there other methods I can use to finish my work in R platform?
> 

this is because gstat::krigeST assumes at this moment that the
space-time variogram is separable, exploits the benefits when the data
form a full space-time lattice (STFDF).

We have developed some scripts for more generic ST variograms (or
separable for non STFDF data), e.g. metric and product-sum, but these
have not yet been integrated in gstat (or somewhere else in R).

> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From edzer.pebesma at uni-muenster.de  Wed Oct 10 15:30:44 2012
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Wed, 10 Oct 2012 16:30:44 +0300
Subject: [R-sig-Geo] Pointers for querying postGIS and bringing spatial
 geometries into R
In-Reply-To: <CALuVVaZ_xroB0hHnLfTs_sXkMPBL_0yfvPhS2oEc-4Lvt1Efhg@mail.gmail.com>
References: <4241b212a0f2480aaf1c8a0f9dc77859@EX-0-HT0.lancs.local>
	<CANVKczOt6nXANCvc_3hipSw5Wy8+_+Jx54zJnwF_8zbQZhLJKA@mail.gmail.com>
	<50749575.3090700@uni-muenster.de>
	<CALuVVaZ_xroB0hHnLfTs_sXkMPBL_0yfvPhS2oEc-4Lvt1Efhg@mail.gmail.com>
Message-ID: <50757884.8020104@uni-muenster.de>

Lyndon,

as a side note, readOGR with the postGIS driver does work nicely, as
shown e.g. here:

http://wiki.intamap.org/index.php/PostGIS

(where no username / passwd was set); more recent (but deeper hidden) I
reported attempts with username / passwd here:
http://cran.r-project.org/web/packages/spacetime/vignettes/stpg.pdf (in
this example, readOGR was not used because only the attribute tables
resulting from spatial and/or temporal selections in postGIS were retrieved)

On 10/10/2012 02:01 PM, Lyndon Estes wrote:
> Hi to everyone,
> 
> Thanks to all of you for the advice on this, which has solved my problem
> quite nicely now.  Based on your suggestions, I figured out the following:
> 
> ogr2ogr was broken for me because I had not completely removed a prior
> custom install of gdal that I had set up for hdf4 support, which required
> libjpeg. Once removed, I can use ogr2ogr fine from the linux shell.
> 
> Since I want to select a particular record from the postgis database, and
> want to keep the object in R without writing it to disk for the time being
> (which would rule out a system call to ogr2ogr as an option), I am using
> the RpostgreSQL option together with rgeos::readWKT.  I am basing this on
> the idea that it is not possible to use sql statements in readOGR, and thus
> can't select an individual geometry from a table (although I see there was
> some talk about this in 2010:
> http://r-sig-geo.2731867.n2.nabble.com/passing-SQL-through-readOGR-td3816889.html).
> 
> 
> library(RPostgreSQL)
> # CRS
> drv <- dbDriver("PostgreSQL")
> con <- dbConnect(drv, dbname = "mydb", user = "me", password = "mypw")
> sql <- "SELECT ST_AsEWKT(geom) from sa1kgrid where id=9"
> kmlGeom <- dbGetQuery(con, sql)
> kmlGeom
> 1 SRID=97490;MULTIPOLYGON(((570779.01553729
> -2401338.07340772,571779.01553729 -2401338.07340772,571779.01553729
> -2402338.07340772,570779.01553729 -2402338.07340772,570779.01553729
> -2401338.07340772)))
> # Comes back as data.frame with SRID, which needs to be stripped out for
> readWKT to work
> geomStr <- unlist(strsplit(kmlGeom[1, ], ";"))
> geomPoly <- readWKT(geomStr[-grep("SRID", geomStr)])
> 
> That seems to work nicely, so thanks for the solution!
> 
> Best, Lyndon
> 
> 
> 
> 
> 
> On Tue, Oct 9, 2012 at 5:21 PM, Edzer Pebesma <edzer.pebesma at uni-muenster.de
>> wrote:
> 
>>
>>
>> On 10/09/2012 12:04 PM, Barry Rowlingson wrote:
>>> There must be an R WKT reader somewhere...
>>
>> rgeos::readWKT
>> --
>> Edzer Pebesma
>> Institute for Geoinformatics (ifgi), University of M?nster
>> Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
>> 8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
>> http://www.52north.org/geostatistics      e.pebesma at wwu.de
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From frzambra at gmail.com  Wed Oct 10 15:32:24 2012
From: frzambra at gmail.com (Francisco Zambrano)
Date: Wed, 10 Oct 2012 09:32:24 -0400
Subject: [R-sig-Geo] Problems with getURL to obtain ftp directory list to
 download satellite imagery
Message-ID: <CANE=RDN+gvKMUfT07X2rFoe9b8chs4Qm5kFQeeD3AFT9eqVrmw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121010/3baa95e2/attachment.pl>

From Hollister.Jeff at epamail.epa.gov  Wed Oct 10 16:00:20 2012
From: Hollister.Jeff at epamail.epa.gov (Jeff Hollister)
Date: Wed, 10 Oct 2012 09:00:20 -0500
Subject: [R-sig-Geo] Reading a Shapefile from a website with readOGR?
In-Reply-To: <CAAcGz99n=XSUy7H97GuuzZLEvk1kgHNcUT4VKLsL+25y+cx4MQ@mail.gmail.com>
References: <CAAcGz99n=XSUy7H97GuuzZLEvk1kgHNcUT4VKLsL+25y+cx4MQ@mail.gmail.com>,
	<OF439B328B.DCCB84D9-ON86257A92.007102EF-86257A92.007102F7@epamail.epa.gov>
	<8e620b819dca48b6b684eebfcddbd908@EX-0-HT0.lancs.local>	<CANVKczPgSnR9YYZPr2u60TMkVSxuHzAe+7KjzBJd2UL5q8KXzw@mail.gmail.com>
Message-ID: <OF429CC83B.E086B014-ON86257A93.004CEF68-86257A93.004CEF6B@epamail.epa.gov>

An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121010/1419a3fc/attachment.html>

From milenafb at gmail.com  Wed Oct 10 16:29:44 2012
From: milenafb at gmail.com (Milena)
Date: Wed, 10 Oct 2012 11:29:44 -0300
Subject: [R-sig-Geo] Multiplication of images
Message-ID: <CAEO8SkmVruMsLMCT3_N2guUzwBTQPzvU2nOE_AsffQODaYQD2Q@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121010/fd6e9280/attachment.pl>

From roman.lustrik at gmail.com  Wed Oct 10 16:47:14 2012
From: roman.lustrik at gmail.com (=?UTF-8?Q?Roman_Lu=C5=A1trik?=)
Date: Wed, 10 Oct 2012 16:47:14 +0200
Subject: [R-sig-Geo] Multiplication of images
In-Reply-To: <CAEO8SkmVruMsLMCT3_N2guUzwBTQPzvU2nOE_AsffQODaYQD2Q@mail.gmail.com>
References: <CAEO8SkmVruMsLMCT3_N2guUzwBTQPzvU2nOE_AsffQODaYQD2Q@mail.gmail.com>
Message-ID: <CAHT1vpgqbH2zSdUv546dV4K8hXXBa6C0CAFQXvuGtjMstLS6mQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121010/3b134544/attachment.pl>

From Nathalie.M.Morin at Usherbrooke.ca  Wed Oct 10 17:00:12 2012
From: Nathalie.M.Morin at Usherbrooke.ca (Nathalie Morin)
Date: Wed, 10 Oct 2012 11:00:12 -0400
Subject: [R-sig-Geo] Substracting DTM from Terrestrial LiDAR point cloud
Message-ID: <001a01cda6f7$f2f7a020$d8e6e060$@Usherbrooke.ca>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121010/0506e320/attachment.pl>

From edzer.pebesma at uni-muenster.de  Wed Oct 10 17:31:43 2012
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Wed, 10 Oct 2012 18:31:43 +0300
Subject: [R-sig-Geo] Substracting DTM from Terrestrial LiDAR point cloud
In-Reply-To: <001a01cda6f7$f2f7a020$d8e6e060$@Usherbrooke.ca>
References: <001a01cda6f7$f2f7a020$d8e6e060$@Usherbrooke.ca>
Message-ID: <507594DF.7090404@uni-muenster.de>



On 10/10/2012 06:00 PM, Nathalie Morin wrote:
> Hello !
> 
>  
> 
> I am working with georeferenced LiDAR data with R and sp. I am trying to
> normalize height and remove the slope effect from a Terrestrial Laser
> Scanner (TLS) point cloud. 
> 
> The available data is :
> 
> -          a TLS point cloud in ASCII format converted to sp objet of class
> SpatialPoint (variable named "tls.z.sp")
> 
> -          a raster DTM in TIF format (1 m resolution) converted to sp
> object of class SpatialGridDataFrame (variable named "tls.dtm$z")
> 
>  
> 
> The method consists in subtracting the DTM z value from each TLS point z
> value. I proceeded to some tests with the "over()" function with :

Where is your TLS z value? If tls.z.sp is a 3D SpatialPoints object, I'd
suggest to make it a 2D object with z as the attribute value, meaning it
is a SpatialPointsDataFrame object.

> 
> x = "SpatialPoints"
> 
> y = "SpatialGridDataFrame"
> 
>  
> 
> nz <- over(tls.z.sp, tls.dtm$z, tls.z.sp-tls.dtm$z)

Hard to see, but maybe:

nz = over(tls.z.sp, tls.dtm)

then, if tls.z.sp is a SpatialPointsDataFrame with z as attribute:

tls.z.sp$z - nz$z

gives you the differences you want, and

tls.z.sp$difference = tls.z.sp$z - nz$z

adds them as a variable to the SpatialPointsDataFrame oject.

> 
>  
> 
> I am not sure to be on the right track. Any suggestion would be very much
> appreciated !
> 
>  
> 
> Cheers,
> 
> Nathalie
> 
>  
> 
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From jonsmitch2 at gmail.com  Wed Oct 10 18:02:22 2012
From: jonsmitch2 at gmail.com (jonmitchellchicago)
Date: Wed, 10 Oct 2012 09:02:22 -0700 (PDT)
Subject: [R-sig-Geo] SpatialPolygonsDataFrame and lm.morantest
Message-ID: <1349884942113-7581242.post@n2.nabble.com>

Hello all,

I have a SpatialPolygonsDataFrame object with 2550 polygons, representing 37
distinct regions (polygon region labels are stored in map at data$Labels). I
have two continuous variables for each of those 37 distinct regions. For the
life of me, I cannot figure out how to utilize lm.morantest to

LM <- lm(Y~X) #Where X & Y are  vectors of 37 data points
mapNB <- poly2nb(Map)
lm.morantest(LM,nb2listw(mapNB,style="W",zero.policy=TRUE)) 

Error in lm.morantest(LM, nb2listw(mapNB, style = "W", zero.policy = TRUE))
: 
  objects of different length

If I set zero.policy=FALSE, or exclude it, I get the empty neighbor sets
message.

As an experiment, I tried the following (which makes no statistical sense,
but fixes the uneven length problem so I thought I'd see what errors it
conjured):

LM <- lm(Y[Map at data$Labels]~X[Map at data$Labels])
lm.morantest(LM,nb2listw(mapNB,style="W",zero.policy=TRUE)) 


	Global Moran's I for regression residuals

data:  
model: lm(formula = Y[Map at data$Labels] ~ X[Map at data$Labels])
weights: nb2listw(mapNB, style = "W", zero.policy = TRUE)
 
Moran I statistic standard deviate = NA, p-value = NA
alternative hypothesis: greater 
sample estimates:
Observed Moran's I        Expectation           Variance 
                NA                 NA                 NA 

Warning messages:
1: In lag.listw(listw.U, u, zero.policy = zero.policy) :
  NAs in lagged values
2: In lag.listw(listw.U, X, zero.policy = zero.policy) :
  NAs in lagged values
3: In lm.morantest(LM, nb2listw(mapNB, style = "W", zero.policy = TRUE)) :
  Out-of-range p-value: reconsider test arguments


Any suggestions?



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/SpatialPolygonsDataFrame-and-lm-morantest-tp7581242.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From r.hijmans at gmail.com  Wed Oct 10 18:07:25 2012
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Wed, 10 Oct 2012 09:07:25 -0700
Subject: [R-sig-Geo] Multiplication of images
In-Reply-To: <CAHT1vpgqbH2zSdUv546dV4K8hXXBa6C0CAFQXvuGtjMstLS6mQ@mail.gmail.com>
References: <CAEO8SkmVruMsLMCT3_N2guUzwBTQPzvU2nOE_AsffQODaYQD2Q@mail.gmail.com>
	<CAHT1vpgqbH2zSdUv546dV4K8hXXBa6C0CAFQXvuGtjMstLS6mQ@mail.gmail.com>
Message-ID: <CANtt_hyi7cWjtiSZnNC=cVz16kbiQ8TH7vFU4d6EpPAXVoJOaw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121010/ec15e779/attachment.pl>

From r.hijmans at gmail.com  Wed Oct 10 18:12:26 2012
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Wed, 10 Oct 2012 09:12:26 -0700
Subject: [R-sig-Geo] finding CRS from latitude/longitude
In-Reply-To: <CAJfxP+qSEQM=+WPEmTHs4o+=1wMsWKQtL7RXcgbqXVqArjdAsg@mail.gmail.com>
References: <CAJfxP+pdbud=eVfJrfcB1qwRJ2KSGQevAZX40k0hK9AdQiLkMQ@mail.gmail.com>
	<CANtt_hxOAQ0AsWP7kdSUJ_VH9P2T6LknvtYcDBWcdPjO=DBNgA@mail.gmail.com>
	<CAJfxP+pxSrvdoHS0TcKNx0=TPE6KzaCjczgww9+M1eyDz2_qcA@mail.gmail.com>
	<CANtt_hzbJKFN7KTHGwRfDTKfTJm3D+G3_OJdd6pF_Zw-cgSCFQ@mail.gmail.com>
	<CAJfxP+qSEQM=+WPEmTHs4o+=1wMsWKQtL7RXcgbqXVqArjdAsg@mail.gmail.com>
Message-ID: <CANtt_hy-CET36J0ym77RUO7NRHfzvv8do2XR33yFcsdKNN895w@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121010/2bfdd3cd/attachment.pl>

From r.hijmans at gmail.com  Wed Oct 10 18:13:45 2012
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Wed, 10 Oct 2012 09:13:45 -0700
Subject: [R-sig-Geo] extracting values from rasters
In-Reply-To: <20121008005508.12451l141ltnm8bo@wm2.dal.ca>
References: <d3b2b7fb504845f6a8d413d49050519b@EX-0-HT0.lancs.local>
	<CANVKczNCTOTvnj5eV3tNAUt_jfbErSLjj8zspj6RhS5WOmyJnw@mail.gmail.com>
	<20121007145818.17584wkq78w5iiec@wm3.dal.ca>
	<CANtt_hxt3B=xXBt8BPLzvU4gXXdwReR9C1Gn-8BJMHjH+zGv8Q@mail.gmail.com>
	<20121008005508.12451l141ltnm8bo@wm2.dal.ca>
Message-ID: <CANtt_hwb9wjvJsHJ8D2UmPMpWLgAC65baCqEa3fB1ywkVw5CdA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121010/6fe89fcd/attachment.pl>

From r.hijmans at gmail.com  Wed Oct 10 18:16:07 2012
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Wed, 10 Oct 2012 09:16:07 -0700
Subject: [R-sig-Geo] polygon to raster -"adjusted" method
In-Reply-To: <CAJP9LR7XuEd_jxE8g1f8fmaO6LicSYHXDtFWfhyxm57FVqkchg@mail.gmail.com>
References: <CAJP9LR7XuEd_jxE8g1f8fmaO6LicSYHXDtFWfhyxm57FVqkchg@mail.gmail.com>
Message-ID: <CANtt_hwai6fcK3fp9H_ADKgq5Wd6rYnKCRk3Bx2_8xzvbvfAFA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121010/c6ed1143/attachment.pl>

From groo_jgroo at yahoo.com  Wed Oct 10 22:09:43 2012
From: groo_jgroo at yahoo.com (ROKHANA dwi bekti)
Date: Thu, 11 Oct 2012 04:09:43 +0800 (SGT)
Subject: [R-sig-Geo] tango.test
In-Reply-To: <mailman.17.1349863203.27329.r-sig-geo@r-project.org>
References: <mailman.17.1349863203.27329.r-sig-geo@r-project.org>
Message-ID: <1349899783.70499.YahooMailNeo@web190004.mail.sg3.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121011/af85d5df/attachment.pl>

From mintibezabih at gmail.com  Wed Oct 10 22:34:53 2012
From: mintibezabih at gmail.com (alemante zd)
Date: Wed, 10 Oct 2012 21:34:53 +0100
Subject: [R-sig-Geo] finding CRS from latitude/longitude
In-Reply-To: <CANtt_hy-CET36J0ym77RUO7NRHfzvv8do2XR33yFcsdKNN895w@mail.gmail.com>
References: <CAJfxP+pdbud=eVfJrfcB1qwRJ2KSGQevAZX40k0hK9AdQiLkMQ@mail.gmail.com>
	<CANtt_hxOAQ0AsWP7kdSUJ_VH9P2T6LknvtYcDBWcdPjO=DBNgA@mail.gmail.com>
	<CAJfxP+pxSrvdoHS0TcKNx0=TPE6KzaCjczgww9+M1eyDz2_qcA@mail.gmail.com>
	<CANtt_hzbJKFN7KTHGwRfDTKfTJm3D+G3_OJdd6pF_Zw-cgSCFQ@mail.gmail.com>
	<CAJfxP+qSEQM=+WPEmTHs4o+=1wMsWKQtL7RXcgbqXVqArjdAsg@mail.gmail.com>
	<CANtt_hy-CET36J0ym77RUO7NRHfzvv8do2XR33yFcsdKNN895w@mail.gmail.com>
Message-ID: <CAJfxP+oWEmy9=DZGsXebSnD04M01qpGmsnvnBmugKK=tGa-PPg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121010/1d1dc92e/attachment.pl>

From Nathalie.M.Morin at Usherbrooke.ca  Wed Oct 10 23:00:04 2012
From: Nathalie.M.Morin at Usherbrooke.ca (Nathalie Morin)
Date: Wed, 10 Oct 2012 17:00:04 -0400
Subject: [R-sig-Geo] Substracting DTM from Terrestrial LiDAR point cloud
In-Reply-To: <507594DF.7090404@uni-muenster.de>
References: <001a01cda6f7$f2f7a020$d8e6e060$@Usherbrooke.ca>
	<507594DF.7090404@uni-muenster.de>
Message-ID: <004f01cda72a$38c39820$aa4ac860$@Usherbrooke.ca>

Hello Edzer,

Yes ! Super ! It worked ! Thank you so much for your suggestion. I converted
the SpatialPoints object into object of class SpatiaPointsDataFrame. The
function over() worked and I was able to substract the 2 Spatial*DataFrame's
attributes, i.e., z from the TLS point cloud from the z of the DTM to obtain
TLS canopy height. Thanks also for making me discover the r-sig-geo mailing
list. Very efficient...!

Cheers,
Nathalie

-----Message d'origine-----
De?: r-sig-geo-bounces at r-project.org
[mailto:r-sig-geo-bounces at r-project.org] De la part de Edzer Pebesma
Envoy??: mercredi 10 octobre 2012 11:32
??: r-sig-geo at r-project.org
Objet?: Re: [R-sig-Geo] Substracting DTM from Terrestrial LiDAR point cloud



On 10/10/2012 06:00 PM, Nathalie Morin wrote:
> Hello !
> 
>  
> 
> I am working with georeferenced LiDAR data with R and sp. I am trying 
> to normalize height and remove the slope effect from a Terrestrial 
> Laser Scanner (TLS) point cloud.
> 
> The available data is :
> 
> -          a TLS point cloud in ASCII format converted to sp objet of
class
> SpatialPoint (variable named "tls.z.sp")
> 
> -          a raster DTM in TIF format (1 m resolution) converted to sp
> object of class SpatialGridDataFrame (variable named "tls.dtm$z")
> 
>  
> 
> The method consists in subtracting the DTM z value from each TLS point 
> z value. I proceeded to some tests with the "over()" function with :

Where is your TLS z value? If tls.z.sp is a 3D SpatialPoints object, I'd
suggest to make it a 2D object with z as the attribute value, meaning it is
a SpatialPointsDataFrame object.

> 
> x = "SpatialPoints"
> 
> y = "SpatialGridDataFrame"
> 
>  
> 
> nz <- over(tls.z.sp, tls.dtm$z, tls.z.sp-tls.dtm$z)

Hard to see, but maybe:

nz = over(tls.z.sp, tls.dtm)

then, if tls.z.sp is a SpatialPointsDataFrame with z as attribute:

tls.z.sp$z - nz$z

gives you the differences you want, and

tls.z.sp$difference = tls.z.sp$z - nz$z

adds them as a variable to the SpatialPointsDataFrame oject.

> 
>  
> 
> I am not sure to be on the right track. Any suggestion would be very 
> much appreciated !
> 
>  
> 
> Cheers,
> 
> Nathalie
> 
>  
> 
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

--
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster Weseler Stra?e
253, 48151 M?nster, Germany. Phone: +49 251 8333081, Fax: +49 251 8339763
http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From r.hijmans at gmail.com  Thu Oct 11 07:02:10 2012
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Wed, 10 Oct 2012 22:02:10 -0700
Subject: [R-sig-Geo] finding CRS from latitude/longitude
In-Reply-To: <CAJfxP+oWEmy9=DZGsXebSnD04M01qpGmsnvnBmugKK=tGa-PPg@mail.gmail.com>
References: <CAJfxP+pdbud=eVfJrfcB1qwRJ2KSGQevAZX40k0hK9AdQiLkMQ@mail.gmail.com>
	<CANtt_hxOAQ0AsWP7kdSUJ_VH9P2T6LknvtYcDBWcdPjO=DBNgA@mail.gmail.com>
	<CAJfxP+pxSrvdoHS0TcKNx0=TPE6KzaCjczgww9+M1eyDz2_qcA@mail.gmail.com>
	<CANtt_hzbJKFN7KTHGwRfDTKfTJm3D+G3_OJdd6pF_Zw-cgSCFQ@mail.gmail.com>
	<CAJfxP+qSEQM=+WPEmTHs4o+=1wMsWKQtL7RXcgbqXVqArjdAsg@mail.gmail.com>
	<CANtt_hy-CET36J0ym77RUO7NRHfzvv8do2XR33yFcsdKNN895w@mail.gmail.com>
	<CAJfxP+oWEmy9=DZGsXebSnD04M01qpGmsnvnBmugKK=tGa-PPg@mail.gmail.com>
Message-ID: <CANtt_hwdaM3DHM+mtjy88x_S0S9dOtEcUv2LDxDjEzq-sD3qmQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121010/9ee6387f/attachment.pl>

From virgilio.gomez at uclm.es  Thu Oct 11 12:14:41 2012
From: virgilio.gomez at uclm.es (Virgilio =?ISO-8859-1?Q?G=F3mez-Rubio?=)
Date: Thu, 11 Oct 2012 12:14:41 +0200
Subject: [R-sig-Geo] tango.test
In-Reply-To: <1349899783.70499.YahooMailNeo@web190004.mail.sg3.yahoo.com>
References: <mailman.17.1349863203.27329.r-sig-geo@r-project.org>
	<1349899783.70499.YahooMailNeo@web190004.mail.sg3.yahoo.com>
Message-ID: <1349950481.2595.14.camel@virgil-HP-Compaq-8000-Elite-USDT-PC>

Hi,

El jue, 11-10-2012 a las 04:09 +0800, ROKHANA dwi bekti escribi?:
> Dear All,
> I will testing of general spatial cluster by Tango (in package DCluster).
> But, I haven't find the script of tango.test.

What do you mean by the script? The source code for the function? The
example?

Cheers,

Virgilio


From pazurrobert at gmail.com  Thu Oct 11 12:23:25 2012
From: pazurrobert at gmail.com (Robert Pazur)
Date: Thu, 11 Oct 2012 12:23:25 +0200
Subject: [R-sig-Geo] polygon to raster -"adjusted" method
In-Reply-To: <CANtt_hwai6fcK3fp9H_ADKgq5Wd6rYnKCRk3Bx2_8xzvbvfAFA@mail.gmail.com>
References: <CAJP9LR7XuEd_jxE8g1f8fmaO6LicSYHXDtFWfhyxm57FVqkchg@mail.gmail.com>
	<CANtt_hwai6fcK3fp9H_ADKgq5Wd6rYnKCRk3Bx2_8xzvbvfAFA@mail.gmail.com>
Message-ID: <CAJP9LR49zWMMR_d0PmBXU2u3U3w3E_N4A4GcFGwpYiZe6E-h2g@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121011/041cf209/attachment.pl>

From groo_jgroo at yahoo.com  Thu Oct 11 12:28:34 2012
From: groo_jgroo at yahoo.com (ROKHANA dwi bekti)
Date: Thu, 11 Oct 2012 18:28:34 +0800 (SGT)
Subject: [R-sig-Geo] Bls:  tango.test
In-Reply-To: <1349950481.2595.14.camel@virgil-HP-Compaq-8000-Elite-USDT-PC>
References: <mailman.17.1349863203.27329.r-sig-geo@r-project.org>
	<1349899783.70499.YahooMailNeo@web190004.mail.sg3.yahoo.com>
	<1349950481.2595.14.camel@virgil-HP-Compaq-8000-Elite-USDT-PC>
Message-ID: <1349951314.38665.YahooMailNeo@web190005.mail.sg3.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121011/408cde80/attachment.pl>

From milenafb at gmail.com  Thu Oct 11 17:07:22 2012
From: milenafb at gmail.com (Milena)
Date: Thu, 11 Oct 2012 12:07:22 -0300
Subject: [R-sig-Geo] Multiplication of images
In-Reply-To: <CANtt_hyi7cWjtiSZnNC=cVz16kbiQ8TH7vFU4d6EpPAXVoJOaw@mail.gmail.com>
References: <CAEO8SkmVruMsLMCT3_N2guUzwBTQPzvU2nOE_AsffQODaYQD2Q@mail.gmail.com>
	<CAHT1vpgqbH2zSdUv546dV4K8hXXBa6C0CAFQXvuGtjMstLS6mQ@mail.gmail.com>
	<CANtt_hyi7cWjtiSZnNC=cVz16kbiQ8TH7vFU4d6EpPAXVoJOaw@mail.gmail.com>
Message-ID: <CAEO8SkmDk+LzBZp7vVZOcYh5cmG_1d7BMhKSfXEwwgB53BR5cg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121011/6b97db1d/attachment.pl>

From jstruve at ufl.edu  Thu Oct 11 17:23:12 2012
From: jstruve at ufl.edu (Struve,Juliane)
Date: Thu, 11 Oct 2012 15:23:12 +0000
Subject: [R-sig-Geo] plotKML and time stamp
In-Reply-To: <506E9AAE.7000005@spatial-analyst.net>
References: <BFCE57D0BE7CBB42A581347DE375AF9A11558628@UFEXCH-MBXN02.ad.ufl.edu>
	<5068197D.90905@uni-muenster.de>
	<BFCE57D0BE7CBB42A581347DE375AF9A115588BE@UFEXCH-MBXN02.ad.ufl.edu>
	<506A0325.2070101@uni-muenster.de>
	<BFCE57D0BE7CBB42A581347DE375AF9A11558A7A@UFEXCH-MBXN02.ad.ufl.edu>
	<506C2446.9040308@spatial-analyst.net>
	<BFCE57D0BE7CBB42A581347DE375AF9A11559067@UFEXCH-MBXN02.ad.ufl.edu>
	<506E9AAE.7000005@spatial-analyst.net>
Message-ID: <BFCE57D0BE7CBB42A581347DE375AF9A11560BF4@UFEXCH-MBXN01.ad.ufl.edu>

Good afternoon,

If kml() cannot find the zip utility on my system does this mean I need to "specify it manually using the 'zip = ...' argument.") ? 

What is it that kml() needs here ?

Sys.getenv("R_ZIPCMD", "zip") yields 
"zip"

Apologies, I am only just starting to use plotKML and do not  know how to interpret this output.
Regards,

Juliane 

Thanks a lot,

Juliane

-----Original Message-----
From: Tomislav Hengl [mailto:hengl at spatial-analyst.net] 
Sent: Friday, October 05, 2012 4:31 AM
To: Struve,Juliane
Cc: Edzer Pebesma; r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] plotKML and time stamp


On 04/10/2012 15:00, Struve,Juliane wrote:
> Hello,
>
> Thanks a lot for replying. I can't run this script, the last line gives me an error:
>
> KML file header opened for parsing...
> Parsing to KML...
> Closing  HRtemp08_jan.kml
> Error in kml_compress(file.name = file.name) :
>    KMZ generation failed. Wrong command passed to 'zip = ... option'.
>
> What do I need to change ?

kmz = FALSE

Looks like your 'system' has no zip option. See:

 > Sys.getenv("R_ZIPCMD", "zip")

https://r-forge.r-project.org/scm/viewvc.php/pkg/R/kml_compress.R?view=markup&root=plotkml

>
> Regards,
>
> Juliane
>
> sessionInfo()
>
> R version 2.15.0 (2012-03-30)
> Platform: i386-pc-mingw32/i386 (32-bit)
>
> locale:
> [1] LC_COLLATE=English_United States.1252
> [2] LC_CTYPE=English_United States.1252
> [3] LC_MONETARY=English_United States.1252
> [4] LC_NUMERIC=C
> [5] LC_TIME=English_United States.1252
>
> attached base packages:
> [1] splines   stats     graphics  grDevices utils     datasets  methods
> [8] base
>
> other attached packages:
>   [1] plotKML_0.2-5      dismo_0.7-23       scales_0.2.2       aqp_1.2-7
>   [5] gstat_1.0-14       spacetime_0.8-0    xts_0.8-6          zoo_1.7-7
>   [9] Hmisc_3.9-3        survival_2.36-12   RColorBrewer_1.0-5 stringr_0.6.1
> [13] colorRamps_2.3     plotrix_3.4-5      colorspace_1.1-1   plyr_1.7.1
> [17] raster_2.0-12      pixmap_0.4-11      XML_3.9-4.1        rgdal_0.7-19
> [21] sp_0.9-99
>
> loaded via a namespace (and not attached):
> [1] cluster_1.14.2  dichromat_1.2-4 grid_2.15.0     labeling_0.1
> [5] lattice_0.20-6  munsell_0.4     reshape_0.8.4   tools_2.15.0
>
>
> -----Original Message-----
> From: Tomislav Hengl [mailto:hengl at spatial-analyst.net]
> Sent: Wednesday, October 03, 2012 7:41 AM
> To: Struve,Juliane
> Cc: Edzer Pebesma; r-sig-geo at r-project.org
> Subject: Re: [R-sig-Geo] plotKML and time stamp
>
>
> try:
>
>   > library(plotKML)
>   > data(HRtemp08)
> # format the time column:
>   > HRtemp08$ctime <- as.POSIXct(HRtemp08$DATE, format="%Y-%m-%dT%H:%M:%SZ")
> ## Not run: # create a STIDF object:
>   > library(spacetime)
>   > sp <- SpatialPoints(HRtemp08[,c("Lon","Lat")])
>   > proj4string(sp) <- CRS("+proj=longlat +datum=WGS84")
>   > HRtemp08.st <- STIDF(sp, time = HRtemp08$ctime, data =
> HRtemp08[,c("NAME","TEMP")])
> # write to a KML file:
>   > HRtemp08_jan <- HRtemp08.st[1:500]
>   > shape = "http://maps.google.com/mapfiles/kml/pal2/icon18.png"
>   > kml(HRtemp08_jan, dtime = 24*3600, labels = TEMP, shape = shape,
> colour = TEMP, colour_scale=rep("#FFFF00", 2), kmz = TRUE)
>
> See also:
>
> http://plotkml.r-forge.r-project.org/tutorial.php#sp_classes
> http://plotkml.r-forge.r-project.org/layer.STIDF.html
>
> Note that, when using 'kml' method, you need to open the KML file yourself.
>
> T. Hengl
>
> On 02/10/2012 15:01, Struve,Juliane wrote:
>> Hello,
>>
>> The attribute I am interested in is a site number. When I use the
>> site number as attribute data the size of the bubble is proportional
>> to the number, which does not really make sense given that the data
>> are just site numbers. But when I make it a constant I lose the site
>> number information. How can I get a plot that shows all the locations
>> with the same size bubble but displays also the site number
>> information, say like a label ? It seems that the attribute data need
>> to be numeric.
>>
>> Thank you for your time,
>>
>> Juliane
>>
>> -----Original Message----- From: Edzer Pebesma
>> [mailto:edzer.pebesma at uni-muenster.de] Sent: Monday, October 01, 2012
>> 4:55 PM To: Struve,Juliane; r-sig-geo at r-project.org Subject: Re:
>> [R-sig-Geo] plotKML and time stamp
>>
>>
>>
>> On 10/01/2012 05:47 PM, Struve,Juliane wrote:
>>> Edzer,
>>>
>>> Thank you for your help, this works nicely. When xy.sp are the
>>> points and tc is the date/time stamp, why is df needed  ?
>>>
>>
>> You can create an STI object with just the space-time points, leaving
>> out the df, but plotKML does not (yet) have a method to display STI
>> objects -- it wants STIDF with attributes. To work around this, you
>> could try giving the attribute a constant value, if you don't have
>> sth that varies.
>>
>>> Regards,
>>>
>>> Juliane
>>>
>>>
>>> -----Original Message----- From: r-sig-geo-bounces at r-project.org
>>> [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of Edzer
>>> Pebesma Sent: Sunday, September 30, 2012 6:06 AM To:
>>> r-sig-geo at r-project.org Subject: Re: [R-sig-Geo] plotKML and time
>>> stamp
>>>
>>> Juliane, try
>>>
>>> xc = round(runif(10,-1,1)+27.2, 2) yc = round(runif(10,-1,1)+-82.5,
>>> 2) xy = cbind(xc, yc) tc = Sys.time() + 3600 * (1:10) df =
>>> data.frame(z1 = round(5 + rnorm(10), 2), z2 = 20:29)
>>>
>>> library(sp) xy.sp = SpatialPoints(xy) proj4string(xy.sp) =
>>> CRS("+proj=longlat +datum=WGS84")
>>>
>>> library(spacetime) ST = STIDF(xy.sp, tc, df)
>>>
>>> library(plotKML) plotKML(ST)
>>>
>>> see also
>>>
>>> vignette(spacetime)
>>>
>>>
>>> On 09/30/2012 03:39 AM, Struve,Juliane wrote:
>>>> Dear list,
>>>>
>>>> After plotting this toy example on Google Earth I would like to
>>>> add a date/time stamp to it so that the locations will be shown
>>>> in sequence using the time slider. I am not quite sure how to
>>>> approach this, can I add a date/time to my spatial points and
>>>> then submit it to plotKML ? What format does the date/time stamp
>>>> have to be in to be plotted on Google Earth ?
>>>>
>>>> Many thanks for any suggestions.
>>>>
>>>> Regards,
>>>>
>>>> Juliane
>>>>
>>>>
>>>> xc = round(runif(10,-1,1)+27.2, 2) yc =
>>>> round(runif(10,-1,1)+-82.5, 2) xy = cbind(xc, yc) xy.sp =
>>>> SpatialPoints(xy) df = data.frame(z1 = round(5 + rnorm(10), 2),
>>>> z2 = 20:29) SP.spdf = SpatialPointsDataFrame(xy.sp, df)
>>>> plot(SP.spdf) #add a projection proj4string(SP.spdf) =
>>>> CRS("+proj=longlat +datum=WGS84") plotKML(SP.spdf,kmz = FALSE)
>>>>
>>>> [[alternative HTML version deleted]]
>>>>
>>>> _______________________________________________ R-sig-Geo mailing
>>>> list R-sig-Geo at r-project.org
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>
>>> -- Edzer Pebesma Institute for Geoinformatics (ifgi), University of
>>> M?nster Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
>>> 8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
>>> http://www.52north.org/geostatistics      e.pebesma at wwu.de
>>>
>>> _______________________________________________ R-sig-Geo mailing
>>> list R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>> -- Edzer Pebesma Institute for Geoinformatics (ifgi), University of
>> M?nster Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
>> 8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
>> http://www.52north.org/geostatistics      e.pebesma at wwu.de
>>
>> _______________________________________________ R-sig-Geo mailing
>> list R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>

From riaarinda at gmail.com  Thu Oct 11 19:36:28 2012
From: riaarinda at gmail.com (ria arinda)
Date: Thu, 11 Oct 2012 10:36:28 -0700 (PDT)
Subject: [R-sig-Geo] How to save weight matrix created in R?
Message-ID: <1349976988653-7581256.post@n2.nabble.com>

I currently use this syntax. I intend to save object X as a weight matrix in
my computer directory so I could use it in Geoda, but I still don't know how
to do it. Anyone could help me? I'd really appreciate it.

>file_shp <- readShapePoly('indonesia.shp')
>X <- poly2nb(file_shp, queen=T)



-----
Ria Arinda
Jakarta Institute of Statistics, Indonesia
Tel:  +62 856 1675312
--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/How-to-save-weight-matrix-created-in-R-tp7581256.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From oscar.perpinan at gmail.com  Thu Oct 11 19:46:20 2012
From: oscar.perpinan at gmail.com (Oscar =?utf-8?B?UGVycGnDscOhbg==?= Lamigueiro)
Date: Thu, 11 Oct 2012 19:46:20 +0200
Subject: [R-sig-Geo] rasterVis::levelplot key='top' error
In-Reply-To: <1349368631283-7581136.post@n2.nabble.com> (Jonathan's message of
	"Thu, 4 Oct 2012 09:37:11 -0700 (PDT)")
References: <1349368071637-7581134.post@n2.nabble.com>
	<1349368631283-7581136.post@n2.nabble.com>
Message-ID: <87lifcoqab.fsf@gmail.com>

Hello Jonathan,

The problem is that key at top interferes with the margin
plot. Therefore, as you have already found, you have to set 
margin = FALSE.

Best,

Oscar.
> OK, sorry for the previous post.  I am able to achieve my desired result this
> way by over-riding some defaults:
>
> levelplot(RST, 
>           region = FALSE,
>           margin = FALSE,
>           colorkey = FALSE,
>           key = list(space = 'top',
>                      points = list(col = 'black',
>                                    type = 'p',
>                                    pch = 20),
>                      text = list('test')))
>
> Thank you,
> Jonathan
>
>
>
>
>
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/rasterVis-levelplot-key-top-error-tp7581134p7581136.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.

-- 
Oscar Perpi??n Lamigueiro
Dpto. Ingenier?a El?ctrica
EUITI-UPM
URL: http://procomun.wordpress.com
Twitter: @oscarperpinan


From r.hijmans at gmail.com  Fri Oct 12 03:26:12 2012
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Thu, 11 Oct 2012 18:26:12 -0700
Subject: [R-sig-Geo] polygon to raster -"adjusted" method
In-Reply-To: <CAJP9LR49zWMMR_d0PmBXU2u3U3w3E_N4A4GcFGwpYiZe6E-h2g@mail.gmail.com>
References: <CAJP9LR7XuEd_jxE8g1f8fmaO6LicSYHXDtFWfhyxm57FVqkchg@mail.gmail.com>
	<CANtt_hwai6fcK3fp9H_ADKgq5Wd6rYnKCRk3Bx2_8xzvbvfAFA@mail.gmail.com>
	<CAJP9LR49zWMMR_d0PmBXU2u3U3w3E_N4A4GcFGwpYiZe6E-h2g@mail.gmail.com>
Message-ID: <CANtt_hwpENYQ2q8Jadb-H-SYEPpqncd+WzBaN3EhQE2se-RNZg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121011/0e3005eb/attachment.pl>

From Roger.Bivand at nhh.no  Fri Oct 12 04:07:37 2012
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 12 Oct 2012 04:07:37 +0200 (CEST)
Subject: [R-sig-Geo] How to save weight matrix created in R?
In-Reply-To: <1349976988653-7581256.post@n2.nabble.com>
References: <1349976988653-7581256.post@n2.nabble.com>
Message-ID: <alpine.LRH.2.02.1210120404140.6265@reclus.nhh.no>

On Thu, 11 Oct 2012, ria arinda wrote:

> I currently use this syntax. I intend to save object X as a weight matrix in
> my computer directory so I could use it in Geoda, but I still don't know how
> to do it. Anyone could help me? I'd really appreciate it.
>
>> file_shp <- readShapePoly('indonesia.shp')
>> X <- poly2nb(file_shp, queen=T)
>

?write.nb.gal

The GAL format is the one used by many spatial statistics applications.

Roger

>
>
> -----
> Ria Arinda
> Jakarta Institute of Statistics, Indonesia
> Tel:  +62 856 1675312
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/How-to-save-weight-matrix-created-in-R-tp7581256.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From lubinbin220 at gmail.com  Fri Oct 12 12:47:11 2012
From: lubinbin220 at gmail.com (binbin lu)
Date: Fri, 12 Oct 2012 11:47:11 +0100
Subject: [R-sig-Geo] breaking lines at intersection but without GRASS
In-Reply-To: <CAGfc75m_D--NAyC=0mgGg5q1t6PzMPtKzyVoZ7Dxt6716FMWzQ@mail.gmail.com>
References: <CAGfc75m_D--NAyC=0mgGg5q1t6PzMPtKzyVoZ7Dxt6716FMWzQ@mail.gmail.com>
Message-ID: <CANuoaEHFr4iPNLXG_9MGrLFZS8eqB0ZZX=_bczjvQb42DbOr0w@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121012/2362baee/attachment.pl>

From juliachacon at gmail.com  Fri Oct 12 13:01:25 2012
From: juliachacon at gmail.com (Julia Chacon Labella)
Date: Fri, 12 Oct 2012 13:01:25 +0200
Subject: [R-sig-Geo] transform an image to a shapefile
Message-ID: <CAPsE2jyNiHuUjnQDsWex=Y9G42nvi3u5x8x1_dYFyn+Aj++vPA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121012/7660b8c0/attachment.pl>

From roman.lustrik at gmail.com  Fri Oct 12 13:15:48 2012
From: roman.lustrik at gmail.com (=?UTF-8?Q?Roman_Lu=C5=A1trik?=)
Date: Fri, 12 Oct 2012 13:15:48 +0200
Subject: [R-sig-Geo] transform an image to a shapefile
In-Reply-To: <CAPsE2jyNiHuUjnQDsWex=Y9G42nvi3u5x8x1_dYFyn+Aj++vPA@mail.gmail.com>
References: <CAPsE2jyNiHuUjnQDsWex=Y9G42nvi3u5x8x1_dYFyn+Aj++vPA@mail.gmail.com>
Message-ID: <CAHT1vphBL-ueyF6fBTrHXvFz0GZdPL_mojEb-3ZNY8axxx=ikQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121012/14d785e0/attachment.pl>

From jaimebg27 at gmail.com  Fri Oct 12 13:20:05 2012
From: jaimebg27 at gmail.com (=?ISO-8859-1?Q?Jaime_Burbano_Gir=F3n?=)
Date: Fri, 12 Oct 2012 06:20:05 -0500
Subject: [R-sig-Geo] Plot local moran index "spdep"
Message-ID: <CADiqS84vU0uV1LjkGdqTr-bfZ-8vyA7ssneVwgvK+F-29pD8Qg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121012/d5b2ab03/attachment.pl>

From jaimebg27 at gmail.com  Fri Oct 12 13:21:30 2012
From: jaimebg27 at gmail.com (=?ISO-8859-1?Q?Jaime_Burbano_Gir=F3n?=)
Date: Fri, 12 Oct 2012 06:21:30 -0500
Subject: [R-sig-Geo] Plot local moran index "spdep"
Message-ID: <CADiqS86qFMxs8MoN6a7Wj=K3PMrGYoQ3DoN0=mJD68Pxe5JQ7A@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121012/a04ddc65/attachment.pl>

From b.rowlingson at lancaster.ac.uk  Fri Oct 12 14:07:10 2012
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Fri, 12 Oct 2012 13:07:10 +0100
Subject: [R-sig-Geo] breaking lines at intersection but without GRASS
In-Reply-To: <267572cff3884e5d93e91cd1ac2b6835@EX-0-HT0.lancs.local>
References: <CAGfc75m_D--NAyC=0mgGg5q1t6PzMPtKzyVoZ7Dxt6716FMWzQ@mail.gmail.com>
	<267572cff3884e5d93e91cd1ac2b6835@EX-0-HT0.lancs.local>
Message-ID: <CANVKczMzyPV3_z+HgJWsHqdXejgC1BHgFcsv5OSOvvkUjyuXbA@mail.gmail.com>

I did all that from scratch:

http://www.rpubs.com/geospacedman/routing

not sure how it compares with shp2graph... I'll have to try sometime!

Barry


On Fri, Oct 12, 2012 at 11:47 AM, binbin lu <lubinbin220 at gmail.com> wrote:
> Hi,
>
> The package shp2graph has been repacked and the bug has been fixed. It will
> be fine to install for the latest version of R (2.15). Hope it's still
> useful for you.
>
> Cheers.
>
> Binbin
>
> 2012/6/27 Mathieu Rajerison <mathieu.rajerison at gmail.com>
>
>> Hi,
>>
>>
>> My final goal is to generate a graph from a road network. I didn't manage
>> to install shp2graph correctly, so I want to do it from scratch.
>>
>> Is there a way to break lines at intersection but without rgrass?
>>
>> Also, apart from shp2graph which seems a very good package, does one exist
>> that would turn my road network into a graph?
>>
>>
>> Thanks!
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From Roger.Bivand at nhh.no  Fri Oct 12 15:43:00 2012
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 12 Oct 2012 15:43:00 +0200
Subject: [R-sig-Geo] Plot local moran index "spdep"
In-Reply-To: <CADiqS86qFMxs8MoN6a7Wj=K3PMrGYoQ3DoN0=mJD68Pxe5JQ7A@mail.gmail.com>
References: <CADiqS86qFMxs8MoN6a7Wj=K3PMrGYoQ3DoN0=mJD68Pxe5JQ7A@mail.gmail.com>
Message-ID: <alpine.LRH.2.02.1210121540330.8305@reclus.nhh.no>

On Fri, 12 Oct 2012, Jaime Burbano Gir?n wrote:

> Dear members of list,
>
> I calculated a local moran index ("localmoran()") for my data (which come
> from a raster grid) with a queen spatial neighbor structure for construct
> the weights matrix.
>
> I would like to plot in a map the value of local moran index for each zone,
> however, I am not sure how to extract spatial information for each one of
> the values obtained of local moran index.
>
> My question is: if I am well in assume that the result of localmoran()
> function is in the same order that neighbor list, thus, I can assign
> coordinates of neighbors to each row of result matrix? something like:
>
> #Calculating neighbors
> kneig=knearneigh(cbind(data$x,data$y),k=8)
> neig=knn2nb(neig)
>
> #Calculating weights for neighbors
> neiglist=nb2listw(neig,style="W")
>
> #Spatial autocorrelation
> lmt=localmoran(data$z,neiglist)
>
> #Data for plot local moran index
> data_map=cbind(lmt,data$x,data$y)

Yes, in principle. It is possible to specify the region.id component in 
the nb object, and check this against the IDs of data (or data$z) for 
safety's sake, but here you should be OK. Note the structure of lmt.

Roger

>
> Thanks in advance and best regards to all.
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From julian at hafro.is  Fri Oct 12 16:10:19 2012
From: julian at hafro.is (Julian Burgos)
Date: Fri, 12 Oct 2012 14:10:19 +0000
Subject: [R-sig-Geo] transform an image to a shapefile
In-Reply-To: <CAPsE2jyNiHuUjnQDsWex=Y9G42nvi3u5x8x1_dYFyn+Aj++vPA@mail.gmail.com>
References: <CAPsE2jyNiHuUjnQDsWex=Y9G42nvi3u5x8x1_dYFyn+Aj++vPA@mail.gmail.com>
Message-ID: <507824CB.4040504@hafro.is>

Julia, what do you mean with "shapefile"?  Shapefiles are for vectorial 
data (points, lines, polygons).  Your data appears to be a raster.  What 
exactly do you want to do?

On 10/12/2012 11:01 AM, Julia Chacon Labella wrote:
> Hello to everybody,
>
> I have an image with the structure that is showed below, and I need to
> convert it to a shapefile, any idea?
>
> str(image)
>
> List of 10
>   $ v     : num [1:201, 1:240] NA NA NA NA NA NA NA NA NA NA ...
>   $ dim   : int [1:2] 201 240
>   $ xrange: num [1:2] -0.0114 11.8824
>   $ yrange: num [1:2] -0.0094 9.9346
>   $ xstep : num 0.0496
>   $ ystep : num 0.0495
>   $ xcol  : num [1:240] 0.0134 0.0629 0.1125 0.1621 0.2116 ...
>   $ yrow  : num [1:201] 0.0153 0.0648 0.1143 0.1637 0.2132 ...
>   $ type  : chr "real"
>   $ units :List of 3
>    ..$ singular  : chr "unit"
>    ..$ plural    : chr "units"
>    ..$ multiplier: num 1
>    ..- attr(*, "class")= chr "units"
>   - attr(*, "class")= chr "im"
>
> Thank you very much for your attention!!
>
> Julia
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>


-- 
Julian Mariano Burgos, PhD
Hafranns?knastofnunin/Marine Research Institute
Sk?lagata 4, 121 Reykjav?k, Iceland
S?mi/Telephone : +354-5752037
Br?fs?mi/Telefax:  +354-5752001
Netfang/Email: julian at hafro.is


From jaimebg27 at gmail.com  Fri Oct 12 16:41:37 2012
From: jaimebg27 at gmail.com (=?ISO-8859-1?Q?Jaime_Burbano_Gir=F3n?=)
Date: Fri, 12 Oct 2012 09:41:37 -0500
Subject: [R-sig-Geo] Plot local moran index "spdep"
In-Reply-To: <alpine.LRH.2.02.1210121540330.8305@reclus.nhh.no>
References: <CADiqS86qFMxs8MoN6a7Wj=K3PMrGYoQ3DoN0=mJD68Pxe5JQ7A@mail.gmail.com>
	<alpine.LRH.2.02.1210121540330.8305@reclus.nhh.no>
Message-ID: <CADiqS86Bfy5ZsVCpiNaYdLoBQ83RFgzHFzY_L0eaZMLaOmbafw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121012/1a1b38f6/attachment.pl>

From ebpeterson at usbr.gov  Fri Oct 12 18:07:25 2012
From: ebpeterson at usbr.gov (Peterson, Eric B)
Date: Fri, 12 Oct 2012 10:07:25 -0600
Subject: [R-sig-Geo] transforming arbitrary point clouds to real coordinates?
Message-ID: <469C3D002DBB944BBEAEC89CBE8D1DF73D3300728E@IBR5DENMXCMX01.bor.doi.net>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121012/1a5d01c5/attachment.pl>

From ahoerner at rprogress.org  Fri Oct 12 19:17:16 2012
From: ahoerner at rprogress.org (andrewH)
Date: Fri, 12 Oct 2012 10:17:16 -0700 (PDT)
Subject: [R-sig-Geo] Drawing boarders strictly within region boundaries
Message-ID: <1350062236872-7581270.post@n2.nabble.com>

Hi Folks--
This is my first posting to this list. Glad to be here!  I am working on a
choropleth map with a large number of regions, and I would like to
distinguish three subsets of the regions with borders of different colors.
To do this, I would need to draw two distinct non-overlapping borders for
contiguous regions. 

Has anyone written a border function that draws the boarder lines strictly
within the region it borders? Failing that, could I get some pointers on how
to go about it? I?ve used several of the map packages (rgdal, ggplot2,
maps), but only in a cookbook sort of way, guided by the code posted  The
Choropleth Challenge
<http://blog.revolutionanalytics.com/2009/11/choropleth-challenge-result.html> 
. I do not claim to be proficient with any of them, and have not previously
looked at the inner workings of any of the functions used to draw boarders.
(If there is no published package function that does this and it would be
easier for you to give me some code rather than telling me how to write it
myself, I would be quite content to accept it, though I might subsequently
pester you with questions about how it works).

Any help anyone could offer, either on the availability of functions in
existing packages or on the construction of a new one, would be most
appreciated.

Sincerely, andrewH




--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Drawing-boarders-strictly-within-region-boundaries-tp7581270.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From mintibezabih at gmail.com  Fri Oct 12 19:26:39 2012
From: mintibezabih at gmail.com (alemante zd)
Date: Fri, 12 Oct 2012 18:26:39 +0100
Subject: [R-sig-Geo] finding CRS from latitude/longitude
In-Reply-To: <CANtt_hwdaM3DHM+mtjy88x_S0S9dOtEcUv2LDxDjEzq-sD3qmQ@mail.gmail.com>
References: <CAJfxP+pdbud=eVfJrfcB1qwRJ2KSGQevAZX40k0hK9AdQiLkMQ@mail.gmail.com>
	<CANtt_hxOAQ0AsWP7kdSUJ_VH9P2T6LknvtYcDBWcdPjO=DBNgA@mail.gmail.com>
	<CAJfxP+pxSrvdoHS0TcKNx0=TPE6KzaCjczgww9+M1eyDz2_qcA@mail.gmail.com>
	<CANtt_hzbJKFN7KTHGwRfDTKfTJm3D+G3_OJdd6pF_Zw-cgSCFQ@mail.gmail.com>
	<CAJfxP+qSEQM=+WPEmTHs4o+=1wMsWKQtL7RXcgbqXVqArjdAsg@mail.gmail.com>
	<CANtt_hy-CET36J0ym77RUO7NRHfzvv8do2XR33yFcsdKNN895w@mail.gmail.com>
	<CAJfxP+oWEmy9=DZGsXebSnD04M01qpGmsnvnBmugKK=tGa-PPg@mail.gmail.com>
	<CANtt_hwdaM3DHM+mtjy88x_S0S9dOtEcUv2LDxDjEzq-sD3qmQ@mail.gmail.com>
Message-ID: <CAJfxP+rntO5dZpsv9W0kgLC2EwJ7JR6a=K94+ruk6ksSNjz0OQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121012/dcc780fc/attachment.pl>

From r.hijmans at gmail.com  Sat Oct 13 05:48:02 2012
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Fri, 12 Oct 2012 20:48:02 -0700
Subject: [R-sig-Geo] transform an image to a shapefile
In-Reply-To: <507824CB.4040504@hafro.is>
References: <CAPsE2jyNiHuUjnQDsWex=Y9G42nvi3u5x8x1_dYFyn+Aj++vPA@mail.gmail.com>
	<507824CB.4040504@hafro.is>
Message-ID: <CANtt_hwYQU4Hf9txmQhzrhLO-cv9LpF8-y8UcXigoLUtXfd2HQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121012/89c0ace0/attachment.pl>

From Roger.Bivand at nhh.no  Sat Oct 13 15:23:57 2012
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sat, 13 Oct 2012 15:23:57 +0200
Subject: [R-sig-Geo] Plot local moran index "spdep"
In-Reply-To: <CADiqS86Bfy5ZsVCpiNaYdLoBQ83RFgzHFzY_L0eaZMLaOmbafw@mail.gmail.com>
References: <CADiqS86qFMxs8MoN6a7Wj=K3PMrGYoQ3DoN0=mJD68Pxe5JQ7A@mail.gmail.com>
	<alpine.LRH.2.02.1210121540330.8305@reclus.nhh.no>
	<CADiqS86Bfy5ZsVCpiNaYdLoBQ83RFgzHFzY_L0eaZMLaOmbafw@mail.gmail.com>
Message-ID: <alpine.LRH.2.02.1210131513380.11897@reclus.nhh.no>

On Fri, 12 Oct 2012, Jaime Burbano Gir?n wrote:

> Roger thanks for your response.
>
> Also I am trying to plot my variable vs "spatial lag" ("moran.plot()") but
> I have some problems of memory.
>
> My data has 1 113 277 observations and R has not plotted the figure yet
> (since a couple of hours I ran the command line), do you think there is an
> error or it is possible to take all this time?

Yes, a scatterplot of 1M points will alway take a very long time to plot, 
and will almost certainly not be legible, the points will overplot one 
another. If you need to visualise a high N scatterplot, see the hexbin 
package - that is, simply lag the variable and plot the variable by its 
lag using hexbin. However, I'm also certain that localmoran and a Moran 
scatterplot will be meaningless unless you have demeaned the data first. 
You need to model the data carefully, and then see whether any residual 
spatial patterning remains. There must be lots of relevant covariates that 
you are omitting.

In addition, moran.plot() takes care to provide influence measures for the 
linear relationship between the variable and its lag, pointing up outliers 
that will also show up in the localmoran output. This necessarily takes 
time, but is also used in the plot - and will be illegible in your case.

We don't know your system resources, you didn't provide the output of 
sessionInfo(); the slowness may also be caused by using virtual memory.

Roger

>
> Again, thanks in advance.
>
> On Fri, Oct 12, 2012 at 8:43 AM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
>
>> On Fri, 12 Oct 2012, Jaime Burbano Gir?n wrote:
>>
>>  Dear members of list,
>>>
>>> I calculated a local moran index ("localmoran()") for my data (which come
>>> from a raster grid) with a queen spatial neighbor structure for construct
>>> the weights matrix.
>>>
>>> I would like to plot in a map the value of local moran index for each
>>> zone,
>>> however, I am not sure how to extract spatial information for each one of
>>> the values obtained of local moran index.
>>>
>>> My question is: if I am well in assume that the result of localmoran()
>>> function is in the same order that neighbor list, thus, I can assign
>>> coordinates of neighbors to each row of result matrix? something like:
>>>
>>> #Calculating neighbors
>>> kneig=knearneigh(cbind(data$x,**data$y),k=8)
>>> neig=knn2nb(neig)
>>>
>>> #Calculating weights for neighbors
>>> neiglist=nb2listw(neig,style="**W")
>>>
>>> #Spatial autocorrelation
>>> lmt=localmoran(data$z,**neiglist)
>>>
>>> #Data for plot local moran index
>>> data_map=cbind(lmt,data$x,**data$y)
>>>
>>
>> Yes, in principle. It is possible to specify the region.id component in
>> the nb object, and check this against the IDs of data (or data$z) for
>> safety's sake, but here you should be OK. Note the structure of lmt.
>>
>> Roger
>>
>>
>>> Thanks in advance and best regards to all.
>>>
>>>         [[alternative HTML version deleted]]
>>>
>>> ______________________________**_________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/**listinfo/r-sig-geo<https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
>>>
>>>
>> --
>> Roger Bivand
>> Department of Economics, NHH Norwegian School of Economics,
>> Helleveien 30, N-5045 Bergen, Norway.
>> voice: +47 55 95 93 55; fax +47 55 95 95 43
>> e-mail: Roger.Bivand at nhh.no
>>
>
>
>
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From jaimebg27 at gmail.com  Sat Oct 13 23:49:22 2012
From: jaimebg27 at gmail.com (=?ISO-8859-1?Q?Jaime_Burbano_Gir=F3n?=)
Date: Sat, 13 Oct 2012 16:49:22 -0500
Subject: [R-sig-Geo] Plot local moran index "spdep"
In-Reply-To: <alpine.LRH.2.02.1210131513380.11897@reclus.nhh.no>
References: <CADiqS86qFMxs8MoN6a7Wj=K3PMrGYoQ3DoN0=mJD68Pxe5JQ7A@mail.gmail.com>
	<alpine.LRH.2.02.1210121540330.8305@reclus.nhh.no>
	<CADiqS86Bfy5ZsVCpiNaYdLoBQ83RFgzHFzY_L0eaZMLaOmbafw@mail.gmail.com>
	<alpine.LRH.2.02.1210131513380.11897@reclus.nhh.no>
Message-ID: <CADiqS87+5LBL==7cPgubd0GnKSJGDaD4P1LN_44GU_k-5wic_Q@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121013/601e11ba/attachment.pl>

From Roger.Bivand at nhh.no  Sun Oct 14 14:37:50 2012
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sun, 14 Oct 2012 14:37:50 +0200
Subject: [R-sig-Geo] Plot local moran index "spdep"
In-Reply-To: <CADiqS87+5LBL==7cPgubd0GnKSJGDaD4P1LN_44GU_k-5wic_Q@mail.gmail.com>
References: <CADiqS86qFMxs8MoN6a7Wj=K3PMrGYoQ3DoN0=mJD68Pxe5JQ7A@mail.gmail.com>
	<alpine.LRH.2.02.1210121540330.8305@reclus.nhh.no>
	<CADiqS86Bfy5ZsVCpiNaYdLoBQ83RFgzHFzY_L0eaZMLaOmbafw@mail.gmail.com>
	<alpine.LRH.2.02.1210131513380.11897@reclus.nhh.no>
	<CADiqS87+5LBL==7cPgubd0GnKSJGDaD4P1LN_44GU_k-5wic_Q@mail.gmail.com>
Message-ID: <alpine.LRH.2.02.1210141429520.18128@reclus.nhh.no>

On Sat, 13 Oct 2012, Jaime Burbano Gir?n wrote:

> Roger, again thanks.
>
> Evidently, how you say, a cloud point was plotted, I will try with hexbin
> package or the reduction of my data. However, I have two more questions
> taking advantage of your cordiality and expertise, hope I do not abuse of
> your generosity.
>
> I am also concerned about my model due to my spatial data type (raster
> grid), since until now I just had worked with geostatistics and lattices
> using information from municipalities (polygons). I want to perform a model
> for explain Net Primary Production as a function of Land Cover (4
> categories) and 3 Climatic variables. My idea is to include an additional
> covariate for explaining spatial structure.
>
> I have opted for include an eigenvector filtering function in concordance
> with the proposal of Dray S, Legendre P and Peres-Neto PR (2006), but I am
> not sure if this is the right option since also exists the semi-parametric
> spatial filtering approach from Tiefelsdorf M and Griffith DA. (2007), or
> something simpler like take the residuals of the regression between the
> study variable and geographical coordinates.

I think that you will face major difficulties in getting the eigenvectors 
of your (doubly centred) weights matrix. In addition, because the raster 
cells are very likely not well fitted to the underlying ecological units 
of NPP (which could be of all kinds of scales), you may run straight into 
the red herring controversy (is the observed spatial patterning scale or 
autocorrelation?). There are analytical ways of getting eigenvectors in 
the literature, but with your data size, you'll face major problems 
anyway. The issues are discussed in the Numerical Ecology with R book and 
partly in a forthcoming paper (possibly Dray et al.) in Ecological 
Monographs, but not really for large data sets.

Hope this helps,

Roger

>
> In the case in which including each of theme in the model, the assumptions
> of: independence, homoscedasticity and normality of residuals could be
> tested favorably, which of these could you recommend me to include?
>
> Finally, I have always experimented memory problems with r in time and
> capacity storage of virtual memory. The speed of processes have been
> recently managed by parallelizing its execution, however, I'm not sure if
> the allocation of big objects can be fixed just giving to the virtual
> memory a larger capacity than my RAM memory. I have a Intel Core i7-2670QM
> procesor of 2.2GHz with 8gb of RAM. It is OK if I set in R the memory limit
> to 10gb or a larger value?
>
> Roger, thanks in advance and my best regards.
>
> On Sat, Oct 13, 2012 at 8:23 AM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
>
>> On Fri, 12 Oct 2012, Jaime Burbano Gir?n wrote:
>>
>>  Roger thanks for your response.
>>>
>>> Also I am trying to plot my variable vs "spatial lag" ("moran.plot()") but
>>> I have some problems of memory.
>>>
>>> My data has 1 113 277 observations and R has not plotted the figure yet
>>> (since a couple of hours I ran the command line), do you think there is an
>>> error or it is possible to take all this time?
>>>
>>
>> Yes, a scatterplot of 1M points will alway take a very long time to plot,
>> and will almost certainly not be legible, the points will overplot one
>> another. If you need to visualise a high N scatterplot, see the hexbin
>> package - that is, simply lag the variable and plot the variable by its lag
>> using hexbin. However, I'm also certain that localmoran and a Moran
>> scatterplot will be meaningless unless you have demeaned the data first.
>> You need to model the data carefully, and then see whether any residual
>> spatial patterning remains. There must be lots of relevant covariates that
>> you are omitting.
>>
>> In addition, moran.plot() takes care to provide influence measures for the
>> linear relationship between the variable and its lag, pointing up outliers
>> that will also show up in the localmoran output. This necessarily takes
>> time, but is also used in the plot - and will be illegible in your case.
>>
>> We don't know your system resources, you didn't provide the output of
>> sessionInfo(); the slowness may also be caused by using virtual memory.
>>
>> Roger
>>
>>
>>> Again, thanks in advance.
>>>
>>> On Fri, Oct 12, 2012 at 8:43 AM, Roger Bivand <Roger.Bivand at nhh.no>
>>> wrote:
>>>
>>>  On Fri, 12 Oct 2012, Jaime Burbano Gir?n wrote:
>>>>
>>>>  Dear members of list,
>>>>
>>>>>
>>>>> I calculated a local moran index ("localmoran()") for my data (which
>>>>> come
>>>>> from a raster grid) with a queen spatial neighbor structure for
>>>>> construct
>>>>> the weights matrix.
>>>>>
>>>>> I would like to plot in a map the value of local moran index for each
>>>>> zone,
>>>>> however, I am not sure how to extract spatial information for each one
>>>>> of
>>>>> the values obtained of local moran index.
>>>>>
>>>>> My question is: if I am well in assume that the result of localmoran()
>>>>> function is in the same order that neighbor list, thus, I can assign
>>>>> coordinates of neighbors to each row of result matrix? something like:
>>>>>
>>>>> #Calculating neighbors
>>>>> kneig=knearneigh(cbind(data$x,****data$y),k=8)
>>>>>
>>>>> neig=knn2nb(neig)
>>>>>
>>>>> #Calculating weights for neighbors
>>>>> neiglist=nb2listw(neig,style="****W")
>>>>>
>>>>> #Spatial autocorrelation
>>>>> lmt=localmoran(data$z,****neiglist)
>>>>>
>>>>>
>>>>> #Data for plot local moran index
>>>>> data_map=cbind(lmt,data$x,****data$y)
>>>>>
>>>>>
>>>> Yes, in principle. It is possible to specify the region.id component in
>>>> the nb object, and check this against the IDs of data (or data$z) for
>>>> safety's sake, but here you should be OK. Note the structure of lmt.
>>>>
>>>> Roger
>>>>
>>>>
>>>>  Thanks in advance and best regards to all.
>>>>>
>>>>>         [[alternative HTML version deleted]]
>>>>>
>>>>> ______________________________****_________________
>>>>> R-sig-Geo mailing list
>>>>> R-sig-Geo at r-project.org
>>>>> https://stat.ethz.ch/mailman/****listinfo/r-sig-geo<https://stat.ethz.ch/mailman/**listinfo/r-sig-geo>
>>>>> <https://**stat.ethz.ch/mailman/listinfo/**r-sig-geo<https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
>>>>>>
>>>>>
>>>>>
>>>>>  --
>>>> Roger Bivand
>>>> Department of Economics, NHH Norwegian School of Economics,
>>>> Helleveien 30, N-5045 Bergen, Norway.
>>>> voice: +47 55 95 93 55; fax +47 55 95 95 43
>>>> e-mail: Roger.Bivand at nhh.no
>>>>
>>>>
>>>
>>>
>>>
>>>
>> --
>> Roger Bivand
>> Department of Economics, NHH Norwegian School of Economics,
>> Helleveien 30, N-5045 Bergen, Norway.
>> voice: +47 55 95 93 55; fax +47 55 95 95 43
>> e-mail: Roger.Bivand at nhh.no
>>
>
>
>
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From mathieu.rajerison at gmail.com  Mon Oct 15 08:19:53 2012
From: mathieu.rajerison at gmail.com (Mathieu Rajerison)
Date: Mon, 15 Oct 2012 08:19:53 +0200
Subject: [R-sig-Geo] Finding the highest order of neighbors
Message-ID: <CAGfc75n_06JEUCRec8GPsm2Zsc-T3OzSHOKLuM+6wqupDYX2Ng@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121015/fcbc9a84/attachment.pl>

From raffaele.morelli at gmail.com  Mon Oct 15 10:53:12 2012
From: raffaele.morelli at gmail.com (Raffaele Morelli)
Date: Mon, 15 Oct 2012 10:53:12 +0200
Subject: [R-sig-Geo] kernel2d -> raster/grid
Message-ID: <CAD4guxMkj0TGwkbWSYqJGXvsahkT48W9xUQuPA4h1qg-bjUi0A@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121015/7aa28ef0/attachment.pl>

From zbynek.janoska at centrum.cz  Mon Oct 15 14:20:06 2012
From: zbynek.janoska at centrum.cz (zbynek.janoska at centrum.cz)
Date: Mon, 15 Oct 2012 05:20:06 -0700 (PDT)
Subject: [R-sig-Geo] rgeos: gOverlaps not working properly?
Message-ID: <1350303606955-7581278.post@n2.nabble.com>

Hello,
I have following problem with gOverlaps function:
I have two lines, A and B.
line A has 57 vertexes, all identical with vertexes of line B
yet, gOverlaps(A,B) gives FALSE

the code follows...

> CooA # coordinates of line A
           [,1]     [,2]
 [1,] -506157.4 -1122381
 [2,] -506046.4 -1122297
 [3,] -506021.4 -1122279
 [4,] -505984.9 -1122253
 [5,] -505953.7 -1122230
 [6,] -505910.2 -1122200
 [7,] -505883.4 -1122182
 [8,] -505840.1 -1122152
 [9,] -505800.2 -1122126
[10,] -505771.7 -1122107
[11,] -505735.4 -1122084
[12,] -505701.9 -1122062
[13,] -505651.2 -1122031
[14,] -505614.7 -1122009
[15,] -505545.8 -1121969
[16,] -505484.8 -1121934
[17,] -505430.2 -1121904
[18,] -505328.7 -1121850
[19,] -505275.9 -1121821
[20,] -505239.0 -1121803
[21,] -505194.5 -1121782
[22,] -505155.1 -1121763
[23,] -505111.1 -1121741
[24,] -505042.7 -1121710
[25,] -504996.2 -1121690
[26,] -504932.4 -1121662
[27,] -504898.4 -1121648
[28,] -504869.2 -1121636
[29,] -504825.2 -1121618
[30,] -504787.7 -1121603
[31,] -504719.1 -1121577
[32,] -504695.1 -1121568
[33,] -504616.5 -1121539
[34,] -504558.2 -1121519
[35,] -504523.9 -1121508
[36,] -504448.2 -1121482
[37,] -504299.8 -1121434
[38,] -504220.0 -1121409
[39,] -504128.7 -1121380
[40,] -503978.4 -1121333
[41,] -503909.8 -1121311
[42,] -503865.9 -1121297
[43,] -503774.8 -1121267
[44,] -503671.5 -1121231
[45,] -503524.9 -1121177
[46,] -503413.4 -1121133
[47,] -503314.5 -1121092
[48,] -503240.0 -1121059
[49,] -503162.6 -1121023
[50,] -503113.6 -1120999
[51,] -503045.5 -1120966
[52,] -502922.0 -1120903
[53,] -502782.1 -1120826
[54,] -502649.1 -1120748
[55,] -502509.2 -1120661
[56,] -502390.5 -1120584
[57,] -502364.9 -1120567

> CooB # coordinates of line B
           [,1]     [,2]
 [1,] -506157.4 -1122381
 [2,] -506046.4 -1122297
 [3,] -506021.4 -1122279
 [4,] -505984.9 -1122253
 [5,] -505953.7 -1122230
 [6,] -505910.2 -1122200
 [7,] -505883.4 -1122182
 [8,] -505840.1 -1122152
 [9,] -505800.2 -1122126
[10,] -505771.7 -1122107
[11,] -505735.4 -1122084
[12,] -505701.9 -1122062
[13,] -505651.2 -1122031
[14,] -505614.7 -1122009
[15,] -505545.8 -1121969
[16,] -505484.8 -1121934
[17,] -505430.2 -1121904
[18,] -505328.7 -1121850
[19,] -505275.9 -1121821
[20,] -505239.0 -1121803
[21,] -505194.5 -1121782
[22,] -505155.1 -1121763
[23,] -505111.1 -1121741
[24,] -505042.7 -1121710
[25,] -504996.2 -1121690
[26,] -504932.4 -1121662
[27,] -504898.4 -1121648
[28,] -504869.2 -1121636
[29,] -504825.2 -1121618
[30,] -504787.7 -1121603
[31,] -504719.1 -1121577
[32,] -504695.1 -1121568
[33,] -504616.5 -1121539
[34,] -504558.2 -1121519
[35,] -504523.9 -1121508
[36,] -504448.2 -1121482
[37,] -504299.8 -1121434
[38,] -504220.0 -1121409
[39,] -504128.7 -1121380
[40,] -503978.4 -1121333
[41,] -503909.8 -1121311
[42,] -503865.9 -1121297
[43,] -503774.8 -1121267
[44,] -503671.5 -1121231
[45,] -503524.9 -1121177
[46,] -503413.4 -1121133
[47,] -503314.5 -1121092
[48,] -503240.0 -1121059
[49,] -503162.6 -1121023
[50,] -503113.6 -1120999
[51,] -503045.5 -1120966
[52,] -502922.0 -1120903
[53,] -502782.1 -1120826
[54,] -502649.1 -1120748
[55,] -502509.2 -1120661
[56,] -502390.5 -1120584
[57,] -502364.9 -1120567
[58,] -502271.7 -1120505
[59,] -502251.2 -1120492

nrow(CooA)*ncol(CooA) # number of values in CooA
length(which(CooA %in% CooB)) # all values of CooA are also in CooB (and
ordering is the same)
A <- SpatialLines(list(Lines(list(Line(CooA)),ID=1)))
B <- SpatialLines(list(Lines(list(Line(CooB)),ID=2)))
gOverlaps(A,B) # gives FALSE

I can not see the reason why this returns FALSE (or does it on your
computer?)
Even if I specify the coordinate system, returned value is still FALSE.

Any help would be appreciated,
Thanks
Zbynek



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/rgeos-gOverlaps-not-working-properly-tp7581278.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From roman.lustrik at gmail.com  Mon Oct 15 14:24:13 2012
From: roman.lustrik at gmail.com (=?UTF-8?Q?Roman_Lu=C5=A1trik?=)
Date: Mon, 15 Oct 2012 14:24:13 +0200
Subject: [R-sig-Geo] rgeos: gOverlaps not working properly?
In-Reply-To: <1350303606955-7581278.post@n2.nabble.com>
References: <1350303606955-7581278.post@n2.nabble.com>
Message-ID: <CAHT1vpj8CL2hqty2wcnD9fYiPDDsxh1B9ZT+nXvx9ZEPYusuAQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121015/c4911711/attachment.pl>

From zbynek.janoska at centrum.cz  Mon Oct 15 14:35:32 2012
From: zbynek.janoska at centrum.cz (zbynek.janoska at centrum.cz)
Date: Mon, 15 Oct 2012 05:35:32 -0700 (PDT)
Subject: [R-sig-Geo] rgeos: gOverlaps not working properly?
In-Reply-To: <1350303606955-7581278.post@n2.nabble.com>
References: <1350303606955-7581278.post@n2.nabble.com>
Message-ID: <1350304532206-7581280.post@n2.nabble.com>

Absolutely, sorry for that

> dput(CooA)
structure(c(-506157.3827, -506046.357799999, -506021.426800001, 
-505984.871599998, -505953.701499999, -505910.162500001, -505883.4289, 
-505840.082400002, -505800.227600001, -505771.724100001, -505735.3649, 
-505701.889699999, -505651.2245, -505614.663199998, -505545.838100001, 
-505484.8244, -505430.202599999, -505328.650699999, -505275.854600001, 
-505238.9824, -505194.541900001, -505155.129000001, -505111.057399999, 
-505042.6708, -504996.186900001, -504932.434, -504898.394499999, 
-504869.155499998, -504825.249000002, -504787.711100001, -504719.058400001, 
-504695.123300001, -504616.548900001, -504558.199700002, -504523.852499999, 
-504448.199099999, -504299.849300001, -504219.996100001, -504128.726199999, 
-503978.413699999, -503909.833099999, -503865.870000001, -503774.7731, 
-503671.450100001, -503524.947700001, -503413.372499999, -503314.525199998, 
-503240.013500001, -503162.6184, -503113.6351, -503045.518199999, 
-502921.997499999, -502782.082800001, -502649.0647, -502509.1699, 
-502390.5407, -502364.870299999, -1122381.2702, -1122297.4208, 
-1122278.8389, -1122252.8248, -1122230.3717, -1122200.2902, -1122182.2913, 
-1122152.1603, -1122126.0303, -1122107.2919, -1122084.4322, -1122062.3233, 
-1122030.914, -1122009.476, -1121969.1182, -1121933.7249, -1121903.6434, 
-1121849.694, -1121821.4481, -1121803.2753, -1121781.8486, -1121762.539, 
-1121741.4268, -1121710.27, -1121689.9333, -1121662.4216, -1121647.6448, 
-1121635.7911, -1121618.3343, -1121603.2663, -1121576.5973, -1121567.8993, 
-1121539.3452, -1121519.0154, -1121507.6544, -1121482.2603, -1121433.8681, 
-1121408.7487, -1121380.1772, -1121333.3369, -1121311.3593, -1121297.0581, 
-1121266.869, -1121231.1033, -1121177.324, -1121133.065, -1121091.724, 
-1121058.8434, -1121022.7963, -1120999.1913, -1120966.3657, -1120903.015, 
-1120825.6379, -1120747.9998, -1120661.0955, -1120583.5099, -1120566.644
), .Dim = c(57L, 2L))

> dput(CooB)
structure(c(-506157.3827, -506046.357799999, -506021.426800001, 
-505984.871599998, -505953.701499999, -505910.162500001, -505883.4289, 
-505840.082400002, -505800.227600001, -505771.724100001, -505735.3649, 
-505701.889699999, -505651.2245, -505614.663199998, -505545.838100001, 
-505484.8244, -505430.202599999, -505328.650699999, -505275.854600001, 
-505238.9824, -505194.541900001, -505155.129000001, -505111.057399999, 
-505042.6708, -504996.186900001, -504932.434, -504898.394499999, 
-504869.155499998, -504825.249000002, -504787.711100001, -504719.058400001, 
-504695.123300001, -504616.548900001, -504558.199700002, -504523.852499999, 
-504448.199099999, -504299.849300001, -504219.996100001, -504128.726199999, 
-503978.413699999, -503909.833099999, -503865.870000001, -503774.7731, 
-503671.450100001, -503524.947700001, -503413.372499999, -503314.525199998, 
-503240.013500001, -503162.6184, -503113.6351, -503045.518199999, 
-502921.997499999, -502782.082800001, -502649.0647, -502509.1699, 
-502390.5407, -502364.870299999, -502271.690900002, -502251.208299998, 
-1122381.2702, -1122297.4208, -1122278.8389, -1122252.8248, -1122230.3717, 
-1122200.2902, -1122182.2913, -1122152.1603, -1122126.0303, -1122107.2919, 
-1122084.4322, -1122062.3233, -1122030.914, -1122009.476, -1121969.1182, 
-1121933.7249, -1121903.6434, -1121849.694, -1121821.4481, -1121803.2753, 
-1121781.8486, -1121762.539, -1121741.4268, -1121710.27, -1121689.9333, 
-1121662.4216, -1121647.6448, -1121635.7911, -1121618.3343, -1121603.2663, 
-1121576.5973, -1121567.8993, -1121539.3452, -1121519.0154, -1121507.6544, 
-1121482.2603, -1121433.8681, -1121408.7487, -1121380.1772, -1121333.3369, 
-1121311.3593, -1121297.0581, -1121266.869, -1121231.1033, -1121177.324, 
-1121133.065, -1121091.724, -1121058.8434, -1121022.7963, -1120999.1913, 
-1120966.3657, -1120903.015, -1120825.6379, -1120747.9998, -1120661.0955, 
-1120583.5099, -1120566.644, -1120505.4237, -1120491.6229), .Dim = c(59L, 
2L))

Zbynek



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/rgeos-gOverlaps-not-working-properly-tp7581278p7581280.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From b.rowlingson at lancaster.ac.uk  Mon Oct 15 15:18:12 2012
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Mon, 15 Oct 2012 14:18:12 +0100
Subject: [R-sig-Geo] rgeos: gOverlaps not working properly?
In-Reply-To: <3bc6e60fa59744daa744e8c20f5ab587@EX-1-HT0.lancs.local>
References: <1350303606955-7581278.post@n2.nabble.com>
	<3bc6e60fa59744daa744e8c20f5ab587@EX-1-HT0.lancs.local>
Message-ID: <CANVKczPMcovw3bmBG3sCn9OZ+rVPRkpmWLHh+VO7_OMXayc-=Q@mail.gmail.com>

     ?gOverlaps? returns TRUE when the geometries share some but not
     all interior points, and the intersection has the same dimension
     as the geometries themselves.

Hence gOverlaps(A,A) == FALSE due to that 'but not all' part of the
documentation.

Barry


From zbynek.janoska at centrum.cz  Mon Oct 15 15:29:40 2012
From: zbynek.janoska at centrum.cz (zbynek.janoska at centrum.cz)
Date: Mon, 15 Oct 2012 06:29:40 -0700 (PDT)
Subject: [R-sig-Geo] rgeos: gOverlaps not working properly?
In-Reply-To: <CANVKczPMcovw3bmBG3sCn9OZ+rVPRkpmWLHh+VO7_OMXayc-=Q@mail.gmail.com>
References: <1350303606955-7581278.post@n2.nabble.com>
	<CANVKczPMcovw3bmBG3sCn9OZ+rVPRkpmWLHh+VO7_OMXayc-=Q@mail.gmail.com>
Message-ID: <1350307780931-7581282.post@n2.nabble.com>

Thank you very much, problem solved.
Zbynek



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/rgeos-gOverlaps-not-working-properly-tp7581278p7581282.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From reeder4 at illinois.edu  Mon Oct 15 22:34:48 2012
From: reeder4 at illinois.edu (Reeder, Bryce Wesley)
Date: Mon, 15 Oct 2012 15:34:48 -0500
Subject: [R-sig-Geo] problem creating psp
Message-ID: <CAN8mTrY5mdAimKwiZEA8rgpUoKQwNyvNLZpvaiRnOFf7fr+yuA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121015/80cf3aa8/attachment.pl>

From mdsumner at gmail.com  Mon Oct 15 22:48:30 2012
From: mdsumner at gmail.com (Michael Sumner)
Date: Tue, 16 Oct 2012 07:48:30 +1100
Subject: [R-sig-Geo] problem creating psp
In-Reply-To: <CAN8mTrY5mdAimKwiZEA8rgpUoKQwNyvNLZpvaiRnOFf7fr+yuA@mail.gmail.com>
References: <CAN8mTrY5mdAimKwiZEA8rgpUoKQwNyvNLZpvaiRnOFf7fr+yuA@mail.gmail.com>
Message-ID: <CAAcGz9-xT+=EO3Rwng_K3xqrzGqZKBtMZjfxb+jpQXAasXbUCg@mail.gmail.com>

It works for this example, so either something is wrong with your data
or the packages are out of date. Can you provide
summary(SierraLeone.roads) and/or the data file, and sessionInfo()?

library(maptools)
xx <- readShapeLines(system.file("shapes/fylk-val.shp", package="maptools")[1],
       proj4string=CRS("+proj=utm +zone=33 +datum=WGS84"))

library(spatstat)
xx.p <- as.psp(xx)

summary(xx)
Object of class SpatialLinesDataFrame
Coordinates:
          min     max
x   -4867.832 1084722
y 6456207.000 7841997
Is projected: TRUE
proj4string : [+proj=utm +zone=33 +datum=WGS84]
Data attributes:
     FNODE_           TNODE_           LPOLY_         RPOLY_
 Min.   :  1.00   Min.   :  2.00   Min.   :1.00   Min.   :1.00
 1st Qu.: 40.00   1st Qu.: 39.00   1st Qu.:2.00   1st Qu.:2.00
 Median : 74.00   Median : 77.00   Median :2.00   Median :2.00
 Mean   : 77.62   Mean   : 77.55   Mean   :1.99   Mean   :1.99
 3rd Qu.:115.00   3rd Qu.:114.00   3rd Qu.:2.00   3rd Qu.:2.00
 Max.   :160.00   Max.   :159.00   Max.   :2.00   Max.   :2.00
     LENGTH            VALINJE_    VALINJE_ID         LTEMA          VANNBR
 Min.   :   106.4   Min.   : 1   Min.   : 55.00   Min.   :3211   Min.   :13
 1st Qu.: 11866.5   1st Qu.:25   1st Qu.: 74.00   1st Qu.:3211   1st Qu.:13
 Median : 31910.9   Median :49   Median : 95.00   Median :3211   Median :13
 Mean   : 41374.7   Mean   :49   Mean   : 94.32   Mean   :3211   Mean   :13
 3rd Qu.: 59311.8   3rd Qu.:73   3rd Qu.:114.00   3rd Qu.:3211   3rd Qu.:13
 Max.   :176540.1   Max.   :97   Max.   :135.00   Max.   :3211   Max.   :13
      DATO
 Min.   :19970630
 1st Qu.:19970630
 Median :19970630
 Mean   :19970630
 3rd Qu.:19970630
 Max.   :19970630

sessionInfo()
R version 2.15.1 Patched (2012-10-07 r60893)
Platform: x86_64-w64-mingw32/x64 (64-bit)

locale:
[1] LC_COLLATE=English_Australia.1252  LC_CTYPE=English_Australia.1252
[3] LC_MONETARY=English_Australia.1252 LC_NUMERIC=C
[5] LC_TIME=English_Australia.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  compiler  methods
[8] base

other attached packages:
[1] spatstat_1.28-2 deldir_0.0-20   mgcv_1.7-21     maptools_0.8-16
[5] lattice_0.20-10 sp_1.0-0        foreign_0.8-50

loaded via a namespace (and not attached):
[1] grid_2.15.1  Matrix_1.0-9 nlme_3.1-104


Cheers, Mike.

On Tue, Oct 16, 2012 at 7:34 AM, Reeder, Bryce Wesley
<reeder4 at illinois.edu> wrote:
> Hello Everyone,
>
> I am currently trying to complete the simple task of converting a
> SpatialLinesDataFrame to PSP so that I can do kernel density estimation on
> the line pattern (density.psp).  When I do this, however, I get an error
> that does not allow me to proceed.  Here is the code I am using (along with
> the error):
>
>> rm(list=ls(all=TRUE))
>> library(spatstat) # spatial tools
>> ## Read in road data
>>
> setwd("~/Dropbox/Spatial_Project/Hot_Spots_Civil_Conflict/Data/SierraLeone_roads/")
>> SierraLeone.roads <- readShapeLines("Sierra_Leone_highway", repair=T)
>> plot(SierraLeone.roads)
>> SierraLeone.psp <- as.psp(SierraLeone.roads)
> Error in as.data.frame.vector(x, ..., nm = nm) :
>   formal argument "nm" matched by multiple actual arguments
>
> I have not worked with line data much so any assistance would be greatly
> appreciated.
>
> --
> Bryce W. Reeder
> University of Illinois, Urbana-Champaign
> PhD Student - Department of Political Science
> Editorial Assistant, International Interactions
> Office: David Kinley Hall, Room 323
> Email: reeder4 at illinois.edu
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



-- 
Michael Sumner
Hobart, Australia
e-mail: mdsumner at gmail.com


From aortizbobea at arec.umd.edu  Tue Oct 16 02:35:13 2012
From: aortizbobea at arec.umd.edu (Ariel Ortiz-Bobea)
Date: Mon, 15 Oct 2012 17:35:13 -0700 (PDT)
Subject: [R-sig-Geo] spml, spfeml and tolerance level
In-Reply-To: <1349137500660-7581089.post@n2.nabble.com>
References: <1349137500660-7581089.post@n2.nabble.com>
Message-ID: <1350347713828-7581285.post@n2.nabble.com>

After some exploration and a hint from the package administrator, the
quickest way I found to avoid this problem (without having to customize
functions within the package) was setting:

.Machine$double.eps <- .Machine$double.eps^2

Just in case anyone faces this.

cheers.

AOB




-----
Ariel Ortiz-Bobea
PhD Candidate in Agricultural & Resource Economics
University of Maryland - College Park
--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/spml-spfeml-and-tolerance-level-tp7581089p7581285.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From Nathalie.M.Morin at Usherbrooke.ca  Tue Oct 16 02:54:48 2012
From: Nathalie.M.Morin at Usherbrooke.ca (Nathalie Morin)
Date: Mon, 15 Oct 2012 20:54:48 -0400
Subject: [R-sig-Geo] Subset SpatialGridDataFrame by retrieving xy
	coordinates from bounding box
Message-ID: <007301cdab38$d7cce4a0$8766ade0$@Usherbrooke.ca>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121015/b4a208a0/attachment.pl>

From r.turner at auckland.ac.nz  Tue Oct 16 03:00:58 2012
From: r.turner at auckland.ac.nz (Rolf Turner)
Date: Tue, 16 Oct 2012 14:00:58 +1300
Subject: [R-sig-Geo] Subset SpatialGridDataFrame by retrieving xy
 coordinates from bounding box
In-Reply-To: <007301cdab38$d7cce4a0$8766ade0$@Usherbrooke.ca>
References: <007301cdab38$d7cce4a0$8766ade0$@Usherbrooke.ca>
Message-ID: <507CB1CA.6020001@auckland.ac.nz>


This can be easily done in the "spatstat" package if you convert
the object of interest to a spatial point pattern (object of class "ppp").
See the vignette "shapefiles" for some guidance on how to do the
conversion.

     cheers,

         Rolf Turner

On 16/10/12 13:54, Nathalie Morin wrote:
> Hello !
>
>   
>
> I am trying to subset elements from a SpatialGridDataFrame not by attribute,
> nor by indexing of rows/columns such as X[rows, columns], but by retrieving
> the xy coordinates from the bounding box.
>
>   
>
> Example :
>
>> bbox(SGDF)
>        min     max
>
> x  457446  457512
>
> y 5384573 5384637
>
>   
>
> The x min and ymin are good but I want to select elements for which
>
> x max <= 457506
>
> y max <= 5384633
>
>   
>
> The question seems probably trivial but it does not come out very clearly on
> the forum. I would very much appreciate it if anyone could shed some light
> on it.
>
> Many thanks in advance for your help !
>
> Nathalie
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From r.hijmans at gmail.com  Tue Oct 16 04:41:35 2012
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Mon, 15 Oct 2012 19:41:35 -0700
Subject: [R-sig-Geo] Subset SpatialGridDataFrame by retrieving xy
 coordinates from bounding box
In-Reply-To: <007301cdab38$d7cce4a0$8766ade0$@Usherbrooke.ca>
References: <007301cdab38$d7cce4a0$8766ade0$@Usherbrooke.ca>
Message-ID: <CANtt_hzq3noft_vJ6BqJc6TkqYJpGWg2xoAC4CUZpPDRsQ4vjQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121015/8edaf926/attachment.pl>

From Tom_Roche at pobox.com  Tue Oct 16 08:00:16 2012
From: Tom_Roche at pobox.com (Tom Roche)
Date: Tue, 16 Oct 2012 02:00:16 -0400
Subject: [R-sig-Geo] [raster newbie] plot configuration problems
References: <CANtt_hwYr4ptU2Yh9uRcFNVboF-wZwpOLeYqZXXF4yYX3uck7Q@mail.gmail.com>
	<CANtt_hysDu5y2Cb7xDCzt8Mtgfhad-jQOSkrOy8ZVmv1a90G3A@mail.gmail.com>
	<87626s1s2e.fsf@pobox.com>
	<CANtt_hw_Q77PHa4Qq1O8SDUD=FEiGB+iX4jLeqjrdR9rU_eD4w@mail.gmail.com>
	<87pq4zzhzx.fsf@pobox.com> <87vcepyfgx.fsf@pobox.com> 
Message-ID: <87ehkz0xe7.fsf@pobox.com>


summary: thanks for your helpful reply

https://stat.ethz.ch/pipermail/r-sig-geo/2012-October/016263.html

to my previous post--it seems to have solved the previous problems.
However, when I try to plot the resulting data, I get

http://tinyurl.com/rasterPlotExample_20121016

What am I doing wrong?

details:

Apologies for my delay in responding to

https://stat.ethz.ch/pipermail/r-sig-geo/2012-October/016263.html

but untimely commitments intervened. After applying your advice, I now
wish to visualize the data for quality control. I'm attempting to use
raster::plot, and to give it the appropriate extents, but I'm not
getting what I want/expect. Instead,

http://tinyurl.com/rasterPlotExample_20121016

shows the desired view, but very compressed and distorted, plus much
additional material. I'd like to see something with a shape more like
this image

https://github.com/TomRoche/cornbeltN2O/wiki/images/CMAQ_AQMEII_MSFs.png

of the AQMEII-NA domain, which has the same projection (CONUS LCC) and
matrix layout (col=459, row=299) as the data I'm attempting to plot.
So what am I doing wrong?

The following example (quite similar to previous) starts in bash, then
goes to R. It contains some workarounds for another cluster on which
I'm working: please adjust to local requirements.

# begin example-------------------------------------------------------

# do what's required for your R to load ncdf4.so, libnetcdf.so.7
# on my cluster it's
module add netcdf-4.1.2

# and point to whatever displays PDFs there
export PDF_VIEWER='xpdf'
# since I must plot to PDF for visualization, due to X forwarding restrictions

# test folder, made/destroyed
export TEST_DIR='/tmp/projectRasterTest'
rm -fr ${TEST_DIR}
mkdir -p ${TEST_DIR}

# Input data is GEIA marine N2O emissions converted to netCDF:
# see code @ https://github.com/TomRoche/GEIA_to_netCDF

DATA_INPUT_URI='https://github.com/downloads/TomRoche/GEIA_to_netCDF/GEIA_N2O_oceanic.nc'
DATA_INPUT_FN="$(basename ${DATA_INPUT_URI})"
export DATA_INPUT_FP="${TEST_DIR}/${DATA_INPUT_FN}"
wget --no-check-certificate -c -O ${DATA_INPUT_FP} ${DATA_INPUT_URI}

export DATA_VAR_NAME='emi_n2o'  # see ncdump output
export DATA_INPUT_BAND='3'      # GEIA makes dim=TIME third

# output name is variant of input name

DATA_INPUT_FN_ROOT="${DATA_INPUT_FN%.*}"
DATA_INPUT_FN_EXT="${DATA_INPUT_FN#*.}"
DATA_OUTPUT_FN="${DATA_INPUT_FN_ROOT}_regrid.${DATA_INPUT_FN_EXT}"
export DATA_OUTPUT_FP="${TEST_DIR}/${DATA_OUTPUT_FN}"

# The template input is a copy of some meteorological data with 52
# "real" datavars. That data is in the IOAPI format, which is in this
# case basically a wrapper around netCDF. (IOAPI can be used with other
# data, and similar wrappers exist for various models.) I removed all
# but one of the datavars (with NCO 'ncks'), and renamed (with NCO
# 'ncrename') that datavar to have the same name as my input datavar
# (and hopefully my output datavar).

TEMPLATE_INPUT_URI='https://github.com/downloads/TomRoche/GEIA_to_netCDF/emis_mole_all_20080101_12US1_cmaq_cb05_soa_2008ab_08c.EXTENTS_INPUT.nc'
TEMPLATE_INPUT_FN="$(basename ${TEMPLATE_INPUT_URI})"
export TEMPLATE_INPUT_FP="${TEST_DIR}/${TEMPLATE_INPUT_FN}"
wget --no-check-certificate -c -O ${TEMPLATE_INPUT_FP} ${TEMPLATE_INPUT_URI}

export TEMPLATE_INPUT_BAND='1' # `ncks` makes dim=TSTEP first

# This script generates some basic statistics for a netCDF datavar.

STAT_SCRIPT_URI='https://github.com/TomRoche/GEIA_to_netCDF/raw/master/netCDF.stats.to.stdout.r'
STAT_SCRIPT_FN="$(basename ${STAT_SCRIPT_URI})"
export STAT_SCRIPT_FP="${TEST_DIR}/${STAT_SCRIPT_FN}"
wget --no-check-certificate -c -O ${STAT_SCRIPT_FP} ${STAT_SCRIPT_URI}

ls -alh ${TEST_DIR}/
R

# following done in R console-----------------------------------------

library(ncdf4)
library(raster)
library(maptools)
# run if rgeos not available
# gpclibPermit()
library(rgdal)
data(wrld_simpl) # from maptools

pdf.er <- Sys.getenv('PDF_VIEWER')
test.dir <- Sys.getenv('TEST_DIR')
in.fp <- Sys.getenv('DATA_INPUT_FP')
in.band <- Sys.getenv('DATA_INPUT_BAND')
data.var.name <- Sys.getenv('DATA_VAR_NAME')
template.in.fp <- Sys.getenv('TEMPLATE_INPUT_FP')
template.band <- Sys.getenv('TEMPLATE_INPUT_BAND')
out.crs <- '+proj=lcc +lat_1=33 +lat_2=45 +lat_0=40 +lon_0=-97 +x=_0=-2556 +y_0=-1728'
out.fp <- Sys.getenv('DATA_OUTPUT_FP')
stat.script.fp <- Sys.getenv('STAT_SCRIPT_FP')
source(stat.script.fp)

system(sprintf('ncdump -h %s', in.fp))
# netcdf GEIA_N2O_oceanic {
# dimensions:
#         lon = 360 ;
#         lat = 180 ;
#         time = UNLIMITED ; // (1 currently)
# variables:
#         double lon(lon) ;
# ...
#         double lat(lat) ;
# ...
#         double time(time) ;
# ...
#         double emi_n2o(time, lat, lon) ;
#                 emi_n2o:units = "ton N2O-N/yr" ;
#                 emi_n2o:missing_value = -999. ;
#                 emi_n2o:long_name = "N2O emissions" ;
#                 emi_n2o:_FillValue = -999.f ;

# Note missing/fill values: more below.

netCDF.stats.to.stdout(netcdf.fp=in.fp, var.name=data.var.name)
# For /tmp/projectRasterTest/GEIA_N2O_oceanic.nc var=emi_n2o
#       cells=64800
#       obs=36143
#       min=5.96e-08
#       q1=30.4
#       med=67.7
#       mean=99.5
#       q3=140
#       max=1.17e+03

# Note min and max of the input, and that min > 0.

# make input raster
in.raster <- raster(in.fp, varname=data.var.name, band=in.band)
in.raster
# class       : RasterLayer 
# dimensions  : 180, 360, 64800  (nrow, ncol, ncell)
# resolution  : 1, 1  (x, y)
# extent      : -180, 180, -90, 90  (xmin, xmax, ymin, ymax)
# coord. ref. : +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0 
# values      : /tmp/projectRasterTest/GEIA_N2O_oceanic.nc 
# layer name  : N2O.emissions 
# z-value     : 0 
# zvar        : emi_n2o 

# make template raster
# truncate 'ncdump' to avoid IOAPI cruft
system(sprintf('ncdump -h %s | head -n 13', template.in.fp))
# netcdf emis_mole_all_20080101_12US1_cmaq_cb05_soa_2008ab_08c.EXTENTS_INPUT {
# dimensions:
#         TSTEP = UNLIMITED ; // (25 currently)
#         LAY = 1 ;
#         ROW = 299 ;
#         COL = 459 ;
# variables:
#         float emi_n2o(TSTEP, LAY, ROW, COL) ;
#                 emi_n2o:long_name = "XYL             " ;
#                 emi_n2o:units = "moles/s         " ;
#                 emi_n2o:var_desc = "Model species XYL                                                               " ;

template.in.raster <- raster(template.in.fp, varname=data.var.name, band=template.band)
template.raster <- projectExtent(template.in.raster, out.crs)
# Warning message:
# In projectExtent(template.in.raster, out.crs) :
#   158 projected point(s) not finite

# is that "projected point(s) not finite" warning important? Probably not.

template.raster
# class       : RasterLayer
# dimensions  : 299, 459, 137241  (nrow, ncol, ncell)
# resolution  : 53369.55, 56883.69  (x, y)
# extent      : -12246449, 12250173, -4532510, 12475715  (xmin, xmax, ymin, ymax)
# coord. ref. : +proj=lcc +lat_1=33 +lat_2=45 +lat_0=40 +lon_0=-97 +y_0=-1728 +ellps=WGS84
# values      : none

# That looks good! Much more like the domain specification @
# https://github.com/TomRoche/cornbeltN2O/wiki/AQMEII-North-American-domain#wiki-EPA

out.raster <-
  projectRaster(
    from=in.raster, to=template.raster, method='bilinear',
    overwrite=TRUE, progress='window', format='CDF',
    # args from ?writeRaster
#    NAvalue=-999.0,  # match emi_n2o:missing_value,_FillValue (TODO: copy)
    NAflag=-999.0,  # match emi_n2o:missing_value,_FillValue (TODO: copy)
    varname=data.var.name, 
    varunit='ton N2O-N/yr',
    longname='N2O emissions',
    xname='COL',
    yname='ROW',
    filename=out.fp)

system(sprintf('ls -alht %s', test.dir))
system(sprintf('ncdump -h %s', out.fp))
# netcdf GEIA_N2O_oceanic_regrid {
# dimensions:
# 	COL = 459 ;
# 	ROW = 299 ;
# variables:
# 	double COL(COL) ;
# 		COL:units = "meter" ;
# 	double ROW(ROW) ;
# 		ROW:units = "meter" ;
# 	float emi_n2o(ROW, COL) ;
# 		emi_n2o:units = "ton N2O-N/yr" ;
# 		emi_n2o:missing_value = -3.4e+38f ;
# 		emi_n2o:_FillValue = -3.4e+38f ;
# 		emi_n2o:long_name = "N2O emissions" ;
# 		emi_n2o:projection = "+proj=lcc +lat_1=33 +lat_2=45 +lat_0=40 +lon_0=-97 +y_0=-1728 +ellps=WGS84" ;
# 		emi_n2o:projection_format = "PROJ.4" ;
# 		emi_n2o:min = 5.9605e-08f ;
# 		emi_n2o:max = 783.92f ;

netCDF.stats.to.stdout(netcdf.fp=out.fp, var.name=data.var.name)
# For /tmp/projectRasterTest/GEIA_N2O_oceanic_regrid.nc var=emi_n2o
# 	cells=137241
# 	obs=53873
# 	min=5.96e-08
# 	q1=25.1
# 	med=55.5
# 	mean=81.1
# 	q3=93.1
# 	max=784

# plot to PDF
# do these once
date.format <- '%Y%m%d_%H%M'
pdf.dir <- test.dir
system(sprintf('mkdir -p %s', pdf.dir))

# repeat for each plot file
pdf.fn <- sprintf('test_%s.pdf', system(sprintf('date +%s', date.format), intern=TRUE))
pdf.fp <- sprintf('%s/%s', pdf.dir, pdf.fn)
pdf(file=pdf.fp, width=5.5, height=4.25)

# plot(out.raster, data.var.name) # only if RasterBrick or RasterStack
plot(out.raster)
# add a CONUS map
x <- wrld_simpl[wrld_simpl$ISO3 == 'USA', ]
us <- spTransform(x, CRS(out.crs))
plot(us, add=TRUE)

# close the device before using plotfile!
dev.off()
system(sprintf('ls -alh %s', pdf.fp))
# show the plot PDF
system(sprintf('%s %s &', pdf.er, pdf.fp))

# output is unexpectedly distorted

# try setting plot extents
pdf.fn <- sprintf('test_%s.pdf', system(sprintf('date +%s', date.format), intern=TRUE))
pdf.fp <- sprintf('%s/%s', pdf.dir, pdf.fn)
pdf(file=pdf.fp, width=5.5, height=4.25)
plot(out.raster, ext=template.raster)
# add a CONUS map
x <- wrld_simpl[wrld_simpl$ISO3 == 'USA', ]
us <- spTransform(x, CRS(out.crs))
plot(us, add=TRUE)
dev.off()
system(sprintf('ls -alh %s', pdf.fp))
system(sprintf('%s %s &', pdf.er, pdf.fp))

# no change from previous

# end example---------------------------------------------------------

The output I get is

http://tinyurl.com/rasterPlotExample_20121016

which

+ shows the US map, as expected

+ shows data around, but not inside, the map extents. Since this is
  marine data, that's also good.

- shows a lot more than the expected map extents, i.e., a fringe
  around CONUS

- shows the CONUS map very compressed, in a very small portion of the
  plot extents

- has very unexpected legends, since the raster is col=459 x row=299.

How to get what I seek, i.e., with extents and shape more like

https://github.com/TomRoche/cornbeltN2O/wiki/images/CMAQ_AQMEII_MSFs.png

?

your assistance is appreciated, Tom Roche <Tom_Roche at pobox.com>


From Tom_Roche at pobox.com  Tue Oct 16 08:09:51 2012
From: Tom_Roche at pobox.com (Tom Roche)
Date: Tue, 16 Oct 2012 02:09:51 -0400
Subject: [R-sig-Geo] [raster newbie] plot configuration problems
In-Reply-To: <87ehkz0xe7.fsf@pobox.com>
References: <87ehkz0xe7.fsf@pobox.com>
Message-ID: <87bog30wy8.fsf@pobox.com>


In my previous post

https://stat.ethz.ch/pipermail/r-sig-geo/2012-October/016404.html

the URI for the current/unwanted plot

http://tinyurl.com/rasterPlotExample_20121016

should instead be

http://tinyurl.com/rasterPlotExample-20121016

with apologies, Tom "up waaay too late" Roche <Tom_Roche at pobox.com>


From mathieu.rajerison at gmail.com  Tue Oct 16 13:12:22 2012
From: mathieu.rajerison at gmail.com (Mathieu Rajerison)
Date: Tue, 16 Oct 2012 13:12:22 +0200
Subject: [R-sig-Geo] breaking lines at intersection but without GRASS
In-Reply-To: <CANVKczMzyPV3_z+HgJWsHqdXejgC1BHgFcsv5OSOvvkUjyuXbA@mail.gmail.com>
References: <CAGfc75m_D--NAyC=0mgGg5q1t6PzMPtKzyVoZ7Dxt6716FMWzQ@mail.gmail.com>
	<267572cff3884e5d93e91cd1ac2b6835@EX-0-HT0.lancs.local>
	<CANVKczMzyPV3_z+HgJWsHqdXejgC1BHgFcsv5OSOvvkUjyuXbA@mail.gmail.com>
Message-ID: <CAGfc75kHPr4-dg60LWExBc1J6ZYXhJ7=i_y2visR9FCi7r3jEg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121016/31d5ac49/attachment.pl>

From patrick.meyfroidt at uclouvain.be  Tue Oct 16 14:10:27 2012
From: patrick.meyfroidt at uclouvain.be (Patrick Meyfroidt)
Date: Tue, 16 Oct 2012 14:10:27 +0200
Subject: [R-sig-Geo] splm - bsktest CLMmu cannot find if panel is balanced
Message-ID: <1df4f1ede3820274bf284d1cc619c7c1.squirrel@mmp.sipr-dc.ucl.ac.be>

Dear list,

With a balanced spatial panel dataset, I'm trying to test for random and
spatial autocorrelation effects using bsktest in package splm.

I'm using different tests in this method, following Millo and Piras 2012.

The test CLMlambda, which tests for spatial autocorrelation under possible
random effects, works fine.
But the test CLMmu, which tests for the opposite - presence of random
effects under possible spatial autocorrelation - invariably returns:

Error in if (!balanced) stop("Estimation method unavailable for unbalanced
panels") : missing value where TRUE / FALSE needed

My code is:
bsktest.abd.9196 <- bsktest(model.abd.9196, data = rusp9196.subsvars,
index ="index", listw = wrus.knb5.lw, test="CLMmu")

Which runs fine for CLMlambda. And LM1, LM2, and LMH also work.

Looking into the code of bsktest here:
https://r-forge.r-project.org/scm/viewvc.php/pkg/R/bsktest.R?view=markup&root=splm
I don't even see where the test for balanced panel occurs, but what I
don't understand is that it works for CLMlambda.

If someone has an idea?

Thanks very much,

Patrick Meyfroidt


From pakcagun at gmail.com  Tue Oct 16 15:57:21 2012
From: pakcagun at gmail.com (=?ISO-8859-1?Q?Pelin_Ak=E7ag=FCn?=)
Date: Tue, 16 Oct 2012 16:57:21 +0300
Subject: [R-sig-Geo] =?windows-1252?q?Questions_about_=93spse=94_in_estima?=
	=?windows-1252?q?ting_spatial_SUR_models?=
Message-ID: <CAD=yThSpkEdGDVC_gqpRqMz-VCB+Je=KLwKTw7UNo-w2KNOdWA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121016/68160931/attachment.pl>

From danijon70 at gmail.com  Tue Oct 16 17:16:34 2012
From: danijon70 at gmail.com (dani jon)
Date: Tue, 16 Oct 2012 11:16:34 -0400
Subject: [R-sig-Geo] Generating a Spatial Surface
Message-ID: <CAFqirvaFuU87mrzFNfZDcEwr-V8SYRfKEjfYA33iSPGC2hMTew@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121016/6537535e/attachment.pl>

From danijon70 at gmail.com  Tue Oct 16 17:26:41 2012
From: danijon70 at gmail.com (dani jon)
Date: Tue, 16 Oct 2012 11:26:41 -0400
Subject: [R-sig-Geo] Generate Spatial Surface
Message-ID: <CAFqirvZ7aFT-9W2Ke+_+DGOS+YZXCgPu4mDTosvp__FArSK_pA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121016/912f5b0a/attachment.pl>

From edzer.pebesma at uni-muenster.de  Tue Oct 16 17:36:50 2012
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Tue, 16 Oct 2012 17:36:50 +0200
Subject: [R-sig-Geo] Generate Spatial Surface
In-Reply-To: <CAFqirvZ7aFT-9W2Ke+_+DGOS+YZXCgPu4mDTosvp__FArSK_pA@mail.gmail.com>
References: <CAFqirvZ7aFT-9W2Ke+_+DGOS+YZXCgPu4mDTosvp__FArSK_pA@mail.gmail.com>
Message-ID: <507D7F12.1000601@uni-muenster.de>



On 10/16/2012 05:26 PM, dani jon wrote:
> Hi All,
> 
> 
> I am trying to figure out how to simulate a continuous spatial surface with
> strong spatial autocorrelation. Then, I would like to divide this spatial
> surface into by 8 x 8 grids and take a sample of 15 locations within each
> grid and the corresponding values.
> For example, here is a sample code adopted from Santiago
> Beguer?a<http://santiago.begueria.es/>.
> 
> 
> library(gstat)
> 
> xy <- expand.grid(1:100, 1:100)
> 
> names(xy) <- c("x","y")
> 
> g.dummy <- gstat(formula=z~1, locations=~x+y, dummy=T, beta=1,
> model=vgm(psill=0.025,model="Exp",range=10), nmax=20)
> 
> # Make four simulations based on the gstat object
> 
> yy <- predict(g.dummy, newdata=xy, nsim=1)
> 
> # show one realization
> 
> gridded(yy) = ~x+y
> 
> spplot(yy[1])
> My questions is how to divide this spatial surface into 8x8 girds and then
> take a sample of 15 locations and their values? I would greatly appreciate
> if anybody can provide some ideas or pointers how to implement these
> scenarios in R. Thanks all for your help! Dani

does

x = spsample(yy, type = "stratified", cellsize = 12)[sample(64,15),]
spplot(yy[1], sp.layout = list("sp.points", x))

kind of do what you want?

> 
> 	[[alternative HTML version deleted]]
> 
> 
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From edzer.pebesma at uni-muenster.de  Tue Oct 16 18:51:10 2012
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Tue, 16 Oct 2012 18:51:10 +0200
Subject: [R-sig-Geo] Generate Spatial Surface
In-Reply-To: <CAFqirvYYQeCFdgoK_nBk7m_=dNVQT9FQ8qPGfxViBju=_qQcnQ@mail.gmail.com>
References: <CAFqirvZ7aFT-9W2Ke+_+DGOS+YZXCgPu4mDTosvp__FArSK_pA@mail.gmail.com>
	<507D7F12.1000601@uni-muenster.de>
	<CAFqirvYYQeCFdgoK_nBk7m_=dNVQT9FQ8qPGfxViBju=_qQcnQ@mail.gmail.com>
Message-ID: <507D907E.8090306@uni-muenster.de>

It would be nice if spsample did this in one pass, but it doesn't. You
can do it by calling it 15 times, and combining, as in:

x = do.call(rbind, lapply(1:15, function(x) spsample(yy, cellsize = 12,
type = "stratified")))
spplot(yy[1], sp.layout = list("sp.points", x))

note that the areas are 12 x 12 cells, where the full grid is 100 x 100
so there might be boundary effects.

On 10/16/2012 05:54 PM, dani jon wrote:
> * Dear Edzer,
> *
> 
> *
> *
> 
> * Thank you for your prompt response.  The code is helpful, not exactly
> what I want. Let me clarify my question. I want first to divide the spatial
> surface into 8x8 girds (a total of 64 grids). Each gird is considered as a
> neighborhood. Then, for each grid, I would like to take a sample of 15
> locations with the corresponding values. So in total I will have 960
> samples with x, y, gridID and value.  *
> 
> * *
> 
> *Thanks for your help.*
> 
> *Dani
> *
> 
> 
> 
> On Tue, Oct 16, 2012 at 11:36 AM, Edzer Pebesma <
> edzer.pebesma at uni-muenster.de> wrote:
> 
>>
>>
>> On 10/16/2012 05:26 PM, dani jon wrote:
>>> Hi All,
>>>
>>>
>>> I am trying to figure out how to simulate a continuous spatial surface
>> with
>>> strong spatial autocorrelation. Then, I would like to divide this spatial
>>> surface into by 8 x 8 grids and take a sample of 15 locations within each
>>> grid and the corresponding values.
>>> For example, here is a sample code adopted from Santiago
>>> Beguer?a<http://santiago.begueria.es/>.
>>>
>>>
>>> library(gstat)
>>>
>>> xy <- expand.grid(1:100, 1:100)
>>>
>>> names(xy) <- c("x","y")
>>>
>>> g.dummy <- gstat(formula=z~1, locations=~x+y, dummy=T, beta=1,
>>> model=vgm(psill=0.025,model="Exp",range=10), nmax=20)
>>>
>>> # Make four simulations based on the gstat object
>>>
>>> yy <- predict(g.dummy, newdata=xy, nsim=1)
>>>
>>> # show one realization
>>>
>>> gridded(yy) = ~x+y
>>>
>>> spplot(yy[1])
>>> My questions is how to divide this spatial surface into 8x8 girds and
>> then
>>> take a sample of 15 locations and their values? I would greatly
>> appreciate
>>> if anybody can provide some ideas or pointers how to implement these
>>> scenarios in R. Thanks all for your help! Dani
>>
>> does
>>
>> x = spsample(yy, type = "stratified", cellsize = 12)[sample(64,15),]
>> spplot(yy[1], sp.layout = list("sp.points", x))
>>
>> kind of do what you want?
>>
>>>
>>>       [[alternative HTML version deleted]]
>>>
>>>
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>> --
>> Edzer Pebesma
>> Institute for Geoinformatics (ifgi), University of M?nster
>> Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
>> 8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
>> http://www.52north.org/geostatistics      e.pebesma at wwu.de
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From HodgessE at uhd.edu  Tue Oct 16 20:20:32 2012
From: HodgessE at uhd.edu (Hodgess, Erin)
Date: Tue, 16 Oct 2012 18:20:32 +0000
Subject: [R-sig-Geo] Raster question (newbie to rasters)
Message-ID: <FF9DB805FC41CC4E95825A50F6806302018122@columbia.uhd.campus>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121016/ad985e50/attachment.pl>

From Nathalie.M.Morin at usherbrooke.ca  Tue Oct 16 20:23:14 2012
From: Nathalie.M.Morin at usherbrooke.ca (Nathalie Morin)
Date: Tue, 16 Oct 2012 11:23:14 -0700 (PDT)
Subject: [R-sig-Geo] Subset SpatialGridDataFrame by retrieving xy
 coordinates from bounding box
In-Reply-To: <CANtt_hzq3noft_vJ6BqJc6TkqYJpGWg2xoAC4CUZpPDRsQ4vjQ@mail.gmail.com>
References: <007301cdab38$d7cce4a0$8766ade0$@Usherbrooke.ca>
	<CANtt_hzq3noft_vJ6BqJc6TkqYJpGWg2xoAC4CUZpPDRsQ4vjQ@mail.gmail.com>
Message-ID: <1350411794746-7581302.post@n2.nabble.com>

For information, it worked with Robert's suggestions for 1 layer raster with
:

e  <- extent(457446, 457506, 5384573, 5384633)

b <- raster(tls.dtm)
bb <- crop(b, e)

# Or 

b <- brick(tls.dtm)
b <- raster(b, 1)
bb <- crop(b, e)

Cheers,
Nathalie



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Subset-SpatialGridDataFrame-by-retrieving-xy-coordinates-from-bounding-box-tp7581286p7581302.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From Nathalie.M.Morin at usherbrooke.ca  Tue Oct 16 20:27:25 2012
From: Nathalie.M.Morin at usherbrooke.ca (Nathalie Morin)
Date: Tue, 16 Oct 2012 11:27:25 -0700 (PDT)
Subject: [R-sig-Geo] Subset SpatialGridDataFrame by retrieving xy
 coordinates from bounding box
In-Reply-To: <507CB1CA.6020001@auckland.ac.nz>
References: <007301cdab38$d7cce4a0$8766ade0$@Usherbrooke.ca>
	<507CB1CA.6020001@auckland.ac.nz>
Message-ID: <1350412045350-7581303.post@n2.nabble.com>

Rolf,

I converted my raster from SpatialGridDataFrame to SpatialPointsDataFrame,
then to Spatial Point Pattern in spatstat :

tls.dtm.SPDF <- SpatialPointsDataFrame(xy.sp, z.df)
tls.dtm.spp <- as(tls.dtm.SPDF, "ppp")

But what method do you suggest next for subsetting the spp ?

Nathalie



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Subset-SpatialGridDataFrame-by-retrieving-xy-coordinates-from-bounding-box-tp7581286p7581303.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From matteo.mattiuzzi at boku.ac.at  Tue Oct 16 23:38:52 2012
From: matteo.mattiuzzi at boku.ac.at (Matteo Mattiuzzi)
Date: Tue, 16 Oct 2012 23:38:52 +0200
Subject: [R-sig-Geo] Antw:  Raster question (newbie to rasters)
Message-ID: <507DF00C02000027000164BE@gwia2.boku.ac.at>

Dear Erin, 
I'm not sure about what you meen with "for each square", but may have a look at the ?focal (moving window) function in the raster package.
Or maybe see the help file in ?GearyLocal, also in the raster package.


Matteo


>>> "Hodgess, Erin"  16.10.12 20.22 Uhr >>>
Hi   R Geo People:

I have a question about getting spatial autocorrelation with rasters, please.

Can you get a local autocorrelation for each square in the raster, please?

Thanks.
Sincerely,
Erin


Erin M. Hodgess, Ph.D.
Associate Professor
Department of Computer and Mathematical Sciences
University of Houston - Downtown
mailto: hodgesse at uhd.edu


    [[alternative HTML version deleted]]

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From lyndon.estes at gmail.com  Wed Oct 17 00:14:32 2012
From: lyndon.estes at gmail.com (Lyndon Estes)
Date: Tue, 16 Oct 2012 18:14:32 -0400
Subject: [R-sig-Geo] Spatial tradeoffs/optimization in R?
Message-ID: <CALuVVaasamn3c0Py7VsHeMksgPqf5e+ZJK3At=D+ZFM8=FzhKw@mail.gmail.com>

Dear List,

I am writing to ask for some pointers about whether a particular
method can be performed in R.  I have the following type of analysis I
would like to perform:

*Say I have three land uses X, Y, and Z.

*Each land use has a target amount of total production (P) that should
be achieved, which is found by summing the production across grid
cells devoted (or fractionally devoted) to the particular land use.
The production amount is heterogeneous in the raster.

*Given the three target values P (P_X, P_Y, P_Z), I want to explore:
a. The effect that meeting P_X has on P_Y and P_Z (etc.)
b. Find the most optimal solution (and the spatial pattern produced by
that solution), where either P_X, P_Y, and P_Z are satisfied or come
as close to being satisfied as possible.

I am imagining an approach in which a routine seeks the solution by
finding the fewest number of pixels required to meet each target,
starting with the most productive pixels and moving to the least
productive.

I could imagine the code that would allow the least number of pixels
to be converted while minimizing the land needed to reach the target.
e.g.

library(raster)
X <- raster(xmn = 0, xmx = 10, ymn = 0, ymx = 10)
res(X) <- 0.1
X[] <- sample(10:100, size = ncell(X), replace = T)
v <- getValues(X)
P <- round(sum(v) * 0.2)
vm <- data.frame(cbind("ID" = 1:length(v), v))
vmr <- vm[order(vm$v, decreasing = T), ]
vmr$csum <- cumsum(vmr$v)
cids <- vmr[1:which.min(abs(vmr$csum - rep(P, nrow(vmr)))), "ID"]  #
IDs of cells to convert

X.lu <- X * 0  # Empty raster to find land use area for X needed to hit target
X.lu[cids] <- 1  # Set to 1 to indicate areas converted to X

plot(X)
plot(X.lu)

I could then do a crude approach where the land uses are converted in
different order, with a constraint set for each successive one that it
cannot use pixels already converted to meet the previous use.

However, I imagine there is a better and established way to do it, and
see online that there are spatial optimization approaches.  However,
is there a way to do this in R?

Any advice/suggestions will be highly appreciated.

Thanks, Lyndon


From Giovanni_Millo at Generali.com  Wed Oct 17 16:11:33 2012
From: Giovanni_Millo at Generali.com (Millo Giovanni)
Date: Wed, 17 Oct 2012 16:11:33 +0200
Subject: [R-sig-Geo] R: Problem in splm : bsktest CLMmu cannot find if panel
	is balanced
Message-ID: <28643F754DDB094D8A875617EC4398B20DBCAABC@BEMAILEXTV03.corp.generali.net>

Dear list,
I had missed this; following personal communication from the original poster, here is my answer, with a quick way to get things done despite this small bug. Please see below.
Best,
Giovanni

-----Messaggio originale-----
Da: Millo Giovanni 
Inviato: mercoled? 17 ottobre 2012 16.08
A: 'Patrick Meyfroidt'
Cc: Gianfranco.Piras at mail.wvu.edu
Oggetto: R: Problem in splm : bsktest CLMmu cannot find if panel is balanced

Hello. Thanks, glad to help if we can, of course.

I have reproduced the problem. Looks like in the very first row of splm:::clmmtest the 'index' argument doesn't get passed on to spfeml(). We'll fix this ASAP, eiher adding the 'index' argumentr explicitly or through '...'.

For now, a quick solution for you is to circumvent the issue providing a dataset that doesn't need the 'index' argument, i.e. simply reordering your dataset with:

- individual index in the first column
- time index in the second one

then everything should work fine (as it does on my examples).
Please let me know if it works.

Best,
Giovanni

Giovanni Millo, PhD
Research Dept.,
Assicurazioni Generali SpA
Via Machiavelli 4,
34132 Trieste (Italy)
tel. +39 040 671184
fax  +39 040 671160

-----Messaggio originale-----
Da: Patrick Meyfroidt [mailto:Patrick.Meyfroidt at uclouvain.be]
Inviato: mercoled? 17 ottobre 2012 15.36
Oggetto: Problem in splm : bsktest CLMmu cannot find if panel is balanced

Dear list,

With a balanced spatial panel dataset, I'm trying to test for random and spatial autocorrelation effects using bsktest in package splm.

I'm using different tests in this method, following Millo and Piras 2012.

The test CLMlambda, which tests for spatial autocorrelation under possible random effects, works fine.
But the test CLMmu, which tests for the opposite - presence of random effects under possible spatial autocorrelation - invariably returns:

Error in if (!balanced) stop("Estimation method unavailable for unbalanced
panels") : missing value where TRUE / FALSE needed

My code is:
bsktest.abd.9196 <- bsktest(model.abd.9196, data = rusp9196.subsvars, index ="index", listw = wrus.knb5.lw, test="CLMmu")

Which runs fine for CLMlambda. And LM1, LM2, and LMH also work.

Looking into the code of bsktest here:
https://r-forge.r-project.org/scm/viewvc.php/pkg/R/bsktest.R?view=markup&root=splm
I don't even see where the test for balanced panel occurs, but what I don't understand is that it works for CLMlambda.

If someone has an idea?

Thanks very much,

Patrick Meyfroidt

------
F.R.S. - FNRS and
Universit? catholique de Louvain - UCLouvain Earth and Life Institute Georges Lema?tre Centre for Earth and Climate Research (TECLIM) Place Pasteur 3, bte L4.03.08
1348 Louvain-la-Neuve
Belgium
http://www.uclouvain.be/teclim
http://www.redd-alert.eu/


?
Ai sensi del D.Lgs. 196/2003 si precisa che le informazi...{{dropped:12}}


From pricci at kitsolutions.net  Wed Oct 17 18:14:16 2012
From: pricci at kitsolutions.net (Paul Ricci)
Date: Wed, 17 Oct 2012 12:14:16 -0400
Subject: [R-sig-Geo] R Geo interact with Web Browser?
Message-ID: <257A76BCE4120447919B3E9C1E0D771505CE043A@kit-mail.corporate.kitsolutions.net>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121017/e915e69d/attachment.pl>

From HodgessE at uhd.edu  Wed Oct 17 18:19:43 2012
From: HodgessE at uhd.edu (Hodgess, Erin)
Date: Wed, 17 Oct 2012 16:19:43 +0000
Subject: [R-sig-Geo] R Geo interact with Web Browser?
In-Reply-To: <257A76BCE4120447919B3E9C1E0D771505CE043A@kit-mail.corporate.kitsolutions.net>
References: <257A76BCE4120447919B3E9C1E0D771505CE043A@kit-mail.corporate.kitsolutions.net>
Message-ID: <FF9DB805FC41CC4E95825A50F6806302018984@columbia.uhd.campus>

Have you tried FastRWeb, please?

It works with Firefox.


________________________________________
From: r-sig-geo-bounces at r-project.org [r-sig-geo-bounces at r-project.org] on behalf of Paul Ricci [pricci at kitsolutions.net]
Sent: Wednesday, October 17, 2012 11:14 AM
To: r-sig-geo-owner at r-project.org; r-sig-geo at r-project.org
Subject: [R-sig-Geo] R Geo interact with Web Browser?

Can R be integrated into a web browser mapping application to generate
charts and graphs?  We are utilizing ASP.Net version 3.5 to build our
data visualization web application.  Could it interface using HTML and
javascripts?  If it can interface would there be any browser specific
limitations (eg. Firefox, Safari)?







Paul T. Ricci

KIT Solutions




        [[alternative HTML version deleted]]

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo

From pricci at kitsolutions.net  Wed Oct 17 18:24:21 2012
From: pricci at kitsolutions.net (Paul Ricci)
Date: Wed, 17 Oct 2012 12:24:21 -0400
Subject: [R-sig-Geo] R Geo interact with Web Browser?
In-Reply-To: <FF9DB805FC41CC4E95825A50F6806302018984@columbia.uhd.campus>
References: <257A76BCE4120447919B3E9C1E0D771505CE043A@kit-mail.corporate.kitsolutions.net>
	<FF9DB805FC41CC4E95825A50F6806302018984@columbia.uhd.campus>
Message-ID: <257A76BCE4120447919B3E9C1E0D771505CE0445@kit-mail.corporate.kitsolutions.net>

Thanks for the info.  No we haven't.  We are just starting the process.

-----Original Message-----
From: Hodgess, Erin [mailto:HodgessE at uhd.edu] 
Sent: Wednesday, October 17, 2012 12:20 PM
To: Paul Ricci; r-sig-geo-owner at r-project.org; r-sig-geo at r-project.org
Subject: RE: R Geo interact with Web Browser?

Have you tried FastRWeb, please?

It works with Firefox.


________________________________________
From: r-sig-geo-bounces at r-project.org [r-sig-geo-bounces at r-project.org]
on behalf of Paul Ricci [pricci at kitsolutions.net]
Sent: Wednesday, October 17, 2012 11:14 AM
To: r-sig-geo-owner at r-project.org; r-sig-geo at r-project.org
Subject: [R-sig-Geo] R Geo interact with Web Browser?

Can R be integrated into a web browser mapping application to generate
charts and graphs?  We are utilizing ASP.Net version 3.5 to build our
data visualization web application.  Could it interface using HTML and
javascripts?  If it can interface would there be any browser specific
limitations (eg. Firefox, Safari)?







Paul T. Ricci

KIT Solutions




        [[alternative HTML version deleted]]

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From tarabridwell at gmail.com  Wed Oct 17 19:55:56 2012
From: tarabridwell at gmail.com (Tara Bridwell)
Date: Wed, 17 Oct 2012 10:55:56 -0700
Subject: [R-sig-Geo] modified t-test using SpatialPack for correlation
Message-ID: <CAELQJc0QJuhH=3vj6k6KhS+nJh95miza=U3EpgMbawS7zf3PyA@mail.gmail.com>

Hi List,
I am wanting to do a modified t-test to account for auto-correlation,
similar to Dutilleul 1993 (Dutilleul, P. (1993) Modifying the t test
for assessing the correlation between two spatial processes.
Biometrics 49, 305?314.).

I was trying to use the SpatialPack package
(http://cran.r-project.org/web/packages/SpatialPack/SpatialPack.pdf),
but have had trouble installing it.  My questions are:

1. Has anyone else had trouble with package and/or used it successfully?

2. Is there another package that would allow me to do a modified
t-test?  I saw a previous post from 2007 that said that no package was
available but that was years ago.

Many thanks,
TB


From aniru123 at gmail.com  Wed Oct 17 20:54:15 2012
From: aniru123 at gmail.com (aniruddha ghosh)
Date: Wed, 17 Oct 2012 20:54:15 +0200
Subject: [R-sig-Geo] create new raster from multiple input raster following
	logical conditions?
Message-ID: <CAAFmNktbxyp-sA4e6YZAhmsKk46nxtjtUxGLnYs8=xvFK1sy0A@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121017/3a17ed02/attachment.pl>

From b.rowlingson at lancaster.ac.uk  Wed Oct 17 21:17:23 2012
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Wed, 17 Oct 2012 20:17:23 +0100
Subject: [R-sig-Geo] R Geo interact with Web Browser?
In-Reply-To: <9f285f0df5be4b62b0a91fdac92bbfcb@EX-0-HT0.lancs.local>
References: <9f285f0df5be4b62b0a91fdac92bbfcb@EX-0-HT0.lancs.local>
Message-ID: <CANVKczP3NL9_gfj5qzHZFV+b-oh_wTBvY5eaoJsCo_wZBoscDQ@mail.gmail.com>

On Wed, Oct 17, 2012 at 5:14 PM, Paul Ricci <pricci at kitsolutions.net> wrote:
> Can R be integrated into a web browser mapping application to generate
> charts and graphs?  We are utilizing ASP.Net version 3.5 to build our
> data visualization web application.  Could it interface using HTML and
> javascripts?  If it can interface would there be any browser specific
> limitations (eg. Firefox, Safari)?

 It can't run on the browser, that's for sure, so you are really
looking at a server-side application. R can generate HTML, you can
even use something like 'brew' to create templates that get filled in
with computed R values.

 R won't be much use if you want interactive charts and graphs,
although I reckon clever things can probably be done with SVG
graphics. You'd be much better off using a client-side Javascript
charting library - look into D3.js - but you could drive this from
data generated via an R server back-end.

 Personally I'd ditch ASP.Net and save a fortune in license costs by
going all-open source with a Python-based server solution.

Barry


From b.rowlingson at lancaster.ac.uk  Wed Oct 17 21:20:26 2012
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Wed, 17 Oct 2012 20:20:26 +0100
Subject: [R-sig-Geo] modified t-test using SpatialPack for correlation
In-Reply-To: <13546ca6b96546388347d698d7a49f9a@EX-0-HT0.lancs.local>
References: <13546ca6b96546388347d698d7a49f9a@EX-0-HT0.lancs.local>
Message-ID: <CANVKczOs8K18ouc_U4nRzQYdBaws6epVPAihRPUfysaRAkpwMw@mail.gmail.com>

On Wed, Oct 17, 2012 at 6:55 PM, Tara Bridwell <tarabridwell at gmail.com> wrote:
> Hi List,
> I am wanting to do a modified t-test to account for auto-correlation,
> similar to Dutilleul 1993 (Dutilleul, P. (1993) Modifying the t test
> for assessing the correlation between two spatial processes.
> Biometrics 49, 305?314.).
>
> I was trying to use the SpatialPack package
> (http://cran.r-project.org/web/packages/SpatialPack/SpatialPack.pdf),
> but have had trouble installing it.  My questions are:
>
> 1. Has anyone else had trouble with package and/or used it successfully?

 Oh no, what kind of trouble? Error messages?

 install.packages("SpatialPack") works fine for me on R 2.15

 The modified.ttest example runs as well.

> 2. Is there another package that would allow me to do a modified
> t-test?  I saw a previous post from 2007 that said that no package was
> available but that was years ago.

 Let's get this working. What was your problem precisely?

Barry


From mauriziomarchi85 at gmail.com  Wed Oct 17 21:54:05 2012
From: mauriziomarchi85 at gmail.com (Maurizio Marchi)
Date: Wed, 17 Oct 2012 21:54:05 +0200
Subject: [R-sig-Geo] Universal Kriging and raster library
Message-ID: <CANJhsN157DjWYQPsOvBoRgrxRsAD1gQsftmU_9HE3-OzuP22dA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121017/eb559942/attachment.pl>

From pricci at kitsolutions.net  Wed Oct 17 22:18:54 2012
From: pricci at kitsolutions.net (Paul Ricci)
Date: Wed, 17 Oct 2012 16:18:54 -0400
Subject: [R-sig-Geo] R Geo interact with Web Browser?
In-Reply-To: <CANVKczP3NL9_gfj5qzHZFV+b-oh_wTBvY5eaoJsCo_wZBoscDQ@mail.gmail.com>
References: <9f285f0df5be4b62b0a91fdac92bbfcb@EX-0-HT0.lancs.local>
	<CANVKczP3NL9_gfj5qzHZFV+b-oh_wTBvY5eaoJsCo_wZBoscDQ@mail.gmail.com>
Message-ID: <257A76BCE4120447919B3E9C1E0D771505CE04D9@kit-mail.corporate.kitsolutions.net>

Thanks Barry,

Were not generating interactive graphs, just stand alone graphs that go
along with an interactive mapping application.  We'd like to interface R
with that application.

-----Original Message-----
From: b.rowlingson at gmail.com [mailto:b.rowlingson at gmail.com] On Behalf
Of Barry Rowlingson
Sent: Wednesday, October 17, 2012 3:17 PM
To: Paul Ricci
Cc: r-sig-geo-owner at r-project.org; r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] R Geo interact with Web Browser?

On Wed, Oct 17, 2012 at 5:14 PM, Paul Ricci <pricci at kitsolutions.net>
wrote:
> Can R be integrated into a web browser mapping application to generate

> charts and graphs?  We are utilizing ASP.Net version 3.5 to build our 
> data visualization web application.  Could it interface using HTML and

> javascripts?  If it can interface would there be any browser specific 
> limitations (eg. Firefox, Safari)?

 It can't run on the browser, that's for sure, so you are really looking
at a server-side application. R can generate HTML, you can even use
something like 'brew' to create templates that get filled in with
computed R values.

 R won't be much use if you want interactive charts and graphs, although
I reckon clever things can probably be done with SVG graphics. You'd be
much better off using a client-side Javascript charting library - look
into D3.js - but you could drive this from data generated via an R
server back-end.

 Personally I'd ditch ASP.Net and save a fortune in license costs by
going all-open source with a Python-based server solution.

Barry


From etiennebr at gmail.com  Wed Oct 17 23:34:37 2012
From: etiennebr at gmail.com (Etienne B. Racine)
Date: Wed, 17 Oct 2012 17:34:37 -0400
Subject: [R-sig-Geo] create new raster from multiple input raster
 following logical conditions?
In-Reply-To: <CAAFmNktbxyp-sA4e6YZAhmsKk46nxtjtUxGLnYs8=xvFK1sy0A@mail.gmail.com>
References: <CAAFmNktbxyp-sA4e6YZAhmsKk46nxtjtUxGLnYs8=xvFK1sy0A@mail.gmail.com>
Message-ID: <CALjAYt7m56rd06wq=jj-mDKROYs35MehuB-6VChgPfuu1LYQog@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121017/0fbfd5a4/attachment.pl>

From HodgessE at uhd.edu  Thu Oct 18 01:27:31 2012
From: HodgessE at uhd.edu (Hodgess, Erin)
Date: Wed, 17 Oct 2012 23:27:31 +0000
Subject: [R-sig-Geo] rgeos on Debian
Message-ID: <FF9DB805FC41CC4E95825A50F6806302018ECA@columbia.uhd.campus>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121017/477d64ac/attachment.pl>

From moshersteven at gmail.com  Thu Oct 18 01:50:48 2012
From: moshersteven at gmail.com (steven mosher)
Date: Wed, 17 Oct 2012 16:50:48 -0700
Subject: [R-sig-Geo] create new raster from multiple input raster
 following logical conditions?
In-Reply-To: <CAAFmNktbxyp-sA4e6YZAhmsKk46nxtjtUxGLnYs8=xvFK1sy0A@mail.gmail.com>
References: <CAAFmNktbxyp-sA4e6YZAhmsKk46nxtjtUxGLnYs8=xvFK1sy0A@mail.gmail.com>
Message-ID: <CAFFLneRqRK7fZbDmhqnjngO0FvXw2QaW0ujMpA4j-+6F=K9Mtw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121017/23282f7d/attachment.pl>

From mitradevkota at hotmail.com  Thu Oct 18 02:16:18 2012
From: mitradevkota at hotmail.com (Mitra Devkota)
Date: Thu, 18 Oct 2012 00:16:18 +0000
Subject: [R-sig-Geo] Autologistic regression
In-Reply-To: <50648C0F.8050608@uni-muenster.de>
References: <CADfOX6x-MvVur5wxskM748Qu_KssJVfKSdy4Sadep6hLLckkSQ@mail.gmail.com>,
	<50648C0F.8050608@uni-muenster.de>
Message-ID: <SNT002-W855F9E14C9C407C2683D1BCA760@phx.gbl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121018/dd42b785/attachment.pl>

From istazahn at gmail.com  Thu Oct 18 03:37:26 2012
From: istazahn at gmail.com (Ista Zahn)
Date: Wed, 17 Oct 2012 21:37:26 -0400
Subject: [R-sig-Geo] rgeos on Debian
In-Reply-To: <FF9DB805FC41CC4E95825A50F6806302018ECA@columbia.uhd.campus>
References: <FF9DB805FC41CC4E95825A50F6806302018ECA@columbia.uhd.campus>
Message-ID: <CA+vqiLEN=pWT04UNv8sY5JhY69od7jqC2-k1dsaFQ9DMcoH1CA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121017/6048fc29/attachment.pl>

From marcelino.delacruz at upm.es  Thu Oct 18 09:32:54 2012
From: marcelino.delacruz at upm.es (Marcelino de la Cruz)
Date: Thu, 18 Oct 2012 09:32:54 +0200
Subject: [R-sig-Geo] [R-sig-eco] fitting point pattern using spatstat
In-Reply-To: <1350490130291-7577627.post@n2.nabble.com>
References: <1350490130291-7577627.post@n2.nabble.com>
Message-ID: <201210180732.q9I7WtgA032759@smtp.upm.es>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121018/1459e649/attachment.pl>

From marcelino.delacruz at upm.es  Thu Oct 18 10:05:14 2012
From: marcelino.delacruz at upm.es (Marcelino de la Cruz)
Date: Thu, 18 Oct 2012 10:05:14 +0200
Subject: [R-sig-Geo] Autologistic regression
In-Reply-To: <SNT002-W855F9E14C9C407C2683D1BCA760@phx.gbl>
References: <CADfOX6x-MvVur5wxskM748Qu_KssJVfKSdy4Sadep6hLLckkSQ@mail.gmail.com>
	<50648C0F.8050608@uni-muenster.de>
	<SNT002-W855F9E14C9C407C2683D1BCA760@phx.gbl>
Message-ID: <201210180805.q9I85Grn013405@smtp.upm.es>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121018/0a8a859f/attachment.pl>

From r.turner at auckland.ac.nz  Thu Oct 18 10:06:57 2012
From: r.turner at auckland.ac.nz (Rolf Turner)
Date: Thu, 18 Oct 2012 21:06:57 +1300
Subject: [R-sig-Geo] [R-sig-eco] fitting point pattern using spatstat
In-Reply-To: <201210180732.q9I7WtgA032759@smtp.upm.es>
References: <1350490130291-7577627.post@n2.nabble.com>
	<201210180732.q9I7WtgA032759@smtp.upm.es>
Message-ID: <507FB8A1.9070507@auckland.ac.nz>


Thanks to Marcelino for handling this question.  I would just like to
add:  Be careful!  Make sure that you really know what you are
doing.  Check that the results of your fit make sense.  The defaults
for Kest() are based on the insight of some very clever people such
as Adrian Baddeley and Brian Ripley who *do* know what they are
doing.  There are good reasons for limiting "r" to be <= 1/4 of the
shortest side.  The K function is *not* estimated very well for larger
r values --- due to edge effects.  Hence fitting by the method of minimum
contrasts may not be very reliable when based on K function fits over
larger r values.

The method of minimum contrasts is pretty much a "suck it and see" approach
anyway, as far as I can understand it.  So if you have sound reasons for 
looking
at larger values of r, then by all means go for it.  But  make sure that you
have sound reasons.

     cheers,

         Rolf Turner

On 18/10/12 20:32, Marcelino de la Cruz wrote:
> Hi Stjepan
>
> That occurs because thomas.estK calls internally Kest to compute the
> observed K and by default it computes up to 1/4 of the shortest side
> of your observational window.
>
> To "customize" the range of distances you should go in two steps:
>
> abal.K <- Kest (abal.ppp, r= seq(0,50, by = 0.5))
> fitt_pp <- thomas.estK(abal.K, c(kappa=10, sigma2=0.1), *rmin* =
> NULL, *rmax* = 50)
>
>
> By the way,  questions about spatstat are usually answered faster (or
> sometimes are only answered) if posted to the R-sig-geo list.
>
> Cheers,
>
> Marcelino
>
>
>
>
> At 18:08 17/10/2012, stjepan mikac wrote:
>> Dear all,
>> I'm trying to fit point pattern using spatstat and thomas.estK command for
>> distances r (0,50) but default values are only 0,25. Can I change this
>> values and try to fit for all range of distances.
>>
>> fitt_pp <- thomas.estK(abal.ppp, c(kappa=10, sigma2=0.1), *rmin* = NULL,
>> *rmax* = 50)
>> /Error in mincontrast(K, theoret, startpar, ctrl = list(q = q, p = p, rmin =
>> rmin,  :
>>    rmax= 50 exceeds the range of available data = [ 0 , 25 ]/
>>


From HodgessE at uhd.edu  Thu Oct 18 10:41:09 2012
From: HodgessE at uhd.edu (Hodgess, Erin)
Date: Thu, 18 Oct 2012 08:41:09 +0000
Subject: [R-sig-Geo] rgeos on Debian
In-Reply-To: <CA+vqiLEN=pWT04UNv8sY5JhY69od7jqC2-k1dsaFQ9DMcoH1CA@mail.gmail.com>
References: <FF9DB805FC41CC4E95825A50F6806302018ECA@columbia.uhd.campus>,
	<CA+vqiLEN=pWT04UNv8sY5JhY69od7jqC2-k1dsaFQ9DMcoH1CA@mail.gmail.com>
Message-ID: <FF9DB805FC41CC4E95825A50F68063020190C4@columbia.uhd.campus>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121018/6bf1edf4/attachment.pl>

From Tom_Roche at pobox.com  Thu Oct 18 14:13:39 2012
From: Tom_Roche at pobox.com (Tom Roche)
Date: Thu, 18 Oct 2012 08:13:39 -0400
Subject: [R-sig-Geo] rgeos on Debian
Message-ID: <874nls9dvw.fsf@pobox.com>


Hodgess, Erin Thu Oct 18 01:27:31 CEST 2012
> I'm not sure if I should be asking here or at the Debian sig,

That will probably be more helpful for a system-config question.

> I'm trying to load sp onto a little debian system[, but] the version
> of geos for debian is too old.

Just as background: 'debian' is not one thing, it has versions.
Are you running squeeze? Try installing the GEOS packages from
wheezy/testing: see version availability @

http://packages.debian.org/search?keywords=geos&searchon=names&suite=all&section=all

HTH, Tom Roche <Tom_Roche at pobox.com>


From benweinstein2010 at gmail.com  Thu Oct 18 14:40:43 2012
From: benweinstein2010 at gmail.com (Ben Weinstein)
Date: Thu, 18 Oct 2012 08:40:43 -0400
Subject: [R-sig-Geo] install rgdal, lazy loading error
In-Reply-To: <mailman.2047.1350497925.4555.r-sig-geo@r-project.org>
References: <mailman.2047.1350497925.4555.r-sig-geo@r-project.org>
Message-ID: <CAC28k7QHcKFYPgAhNQEzjB8yMtbk-P7Ohu9kWW-59m+ok_icMw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121018/13eebafb/attachment.pl>

From aniru123 at gmail.com  Thu Oct 18 15:06:46 2012
From: aniru123 at gmail.com (aniruddha ghosh)
Date: Thu, 18 Oct 2012 15:06:46 +0200
Subject: [R-sig-Geo] create new raster from multiple input raster
 following logical conditions?
In-Reply-To: <CAFFLneRqRK7fZbDmhqnjngO0FvXw2QaW0ujMpA4j-+6F=K9Mtw@mail.gmail.com>
References: <CAAFmNktbxyp-sA4e6YZAhmsKk46nxtjtUxGLnYs8=xvFK1sy0A@mail.gmail.com>
	<CAFFLneRqRK7fZbDmhqnjngO0FvXw2QaW0ujMpA4j-+6F=K9Mtw@mail.gmail.com>
Message-ID: <CAAFmNktTNWic3J6hfuc6a4jA1LHZFRmWsGAP9MhPDbgZs-CBnA@mail.gmail.com>

Thank you Etienne and Steven for your suggestions.

I tried the ordinary matrix method as suggested by Etienne. It works
fine. It was fast and produced excellent results for my original
raster files with 10 values.

Steven, when I try to incorporate more number of cell values, the
procedure is getting longer as I have to reclassify multiple times for
different combinations.

Best regards,


On Thu, Oct 18, 2012 at 1:50 AM, steven mosher <moshersteven at gmail.com> wrote:
>
> reclassify r1 to 1 and 0. reclassify r2 to 0 1 and 2.
> then multiply the rasters.
> so r1 becomes 0 for all values ecept 1. r2 is 1 or 2 or 0. and the product r3 will be 1 or 2 or 0
>
> On Oct 17, 2012 11:55 AM, "aniruddha ghosh" <aniru123 at gmail.com> wrote:
>>
>> Dear List,
>> I have two raster layers (r1 and r2) and the cells have values ranging 1 to
>> 10. I want to create a new raster layer from these two with different
>> conditions like:
>> 1) if r1==1 and r2==1, then r3 should be 1
>> 2) if r1==1 and r2==2, then r3 should be 2
>> else 0 etc
>>
>> With the following example:
>>
>> m1<-matrix(c(1,1,1,2,2,2,3,3,3),ncol=3,byrow=TRUE)
>> m2<-matrix(c(1,2,1,1,2,3,2,3,3),ncol=3,byrow=TRUE)
>> r1<-raster(m1)
>> r2<-raster(m2)
>> Here, r1[1,1]=1 and r2[1,1]=1, so for the new raster, [1,1] should be 1,
>> r1[1,2]=1 and r2[1,2]=2, so for the new raster, [1,2] should be 2,
>> all other cells which don't satisfy the above criteria should be zero.
>>
>> I tried with "calc" in raster package but the attempt was not successful.
>>
>> Looking forward to your suggestions!
>>
>>
>> Thanks
>> --
>> Ani
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo




--
Ani


From sylvain.willart at gmail.com  Thu Oct 18 15:14:56 2012
From: sylvain.willart at gmail.com (sylvain willart)
Date: Thu, 18 Oct 2012 15:14:56 +0200
Subject: [R-sig-Geo]  R Geo interact with Web Browser?
Message-ID: <CABW9NAwi8EkPySS9LrCUzsV2QjwYyi8iBt95bhZ+FDfR3_5Vug@mail.gmail.com>

A colleague and I did that (acutally I just helped a little bit)
What he did was he installed a PostgreSQL server, with PostGIS
extension, and PL/R for the calculus made in R.
Spatial datasets (from Open Street Maps and Google API) are stored in
PostGIS, and analysed with R, then a map is produced using MapServer,
I would recommand you the book "PostGIS in a nutshell" which very well
describes the process (the authors also have a website with tutos)
hope it helps,

Sylvain


From jmblanco at ub.edu  Thu Oct 18 16:59:31 2012
From: jmblanco at ub.edu (=?ISO-8859-1?Q?=22Jos=E9_M=2E_Blanco_Moreno=22?=)
Date: Thu, 18 Oct 2012 16:59:31 +0200
Subject: [R-sig-Geo] modified t-test using SpatialPack for correlation
In-Reply-To: <mailman.13.1350554402.9023.r-sig-geo@r-project.org>
References: <mailman.13.1350554402.9023.r-sig-geo@r-project.org>
Message-ID: <50801953.5050007@ub.edu>

>> Hi List,
>> I am wanting to do a modified t-test to account for auto-correlation,
>> similar to Dutilleul 1993 (Dutilleul, P. (1993) Modifying the t test
>> for assessing the correlation between two spatial processes.
>> Biometrics 49, 305?314.).
>>
>> I was trying to use the SpatialPack package
>> (http://cran.r-project.org/web/packages/SpatialPack/SpatialPack.pdf),
>> but have had trouble installing it.  My questions are:
>>
>> 1. Has anyone else had trouble with package and/or used it successfully?
>
>  Oh no, what kind of trouble? Error messages?
>
>  install.packages("SpatialPack") works fine for me on R 2.15
>
>  The modified.ttest example runs as well.


I have it working also, not a problem installing and running the
examples. However, if you run into trouble, you can still try a modttest
package that I produced xome time ago based upon some existing code by
Pierre Legendre (it will handle as many variables as you want at the
same time, as many coordinates, and also longitude-latitude coordinates
-- but I think it is somewhat slower than the SpatialPack version).



>
>> 2. Is there another package that would allow me to do a modified
>> t-test?  I saw a previous post from 2007 that said that no package was
>> available but that was years ago.
>
>  Let's get this working. What was your problem precisely?
>
> Barry


--
---------------------------------------
Jos? M. Blanco-Moreno
Dept. de Biologia Vegetal (Bot?nica)
Facultat de Biologia
Universitat de Barcelona
Av. Diagonal 643
08028 Barcelona
SPAIN
---------------------------------------
phone: (+34) 934 039 863
fax: (+34) 934 112 842
---------------------------------------


To cultivate kindness is a valuable
part of the business of life. -Samuel
Johnson, lexicographer (1709-1784)


Aquest correu electr?nic i els annexos poden contenir informaci? confidencial o protegida legalment i est? adre?at exclusivament a la persona o entitat destinat?ria. Si no sou el destinatari final o la persona encarregada de rebre?l, no esteu autoritzat a llegir-lo, retenir-lo, modificar-lo, distribuir-lo, copiar-lo ni a revelar-ne el contingut. Si heu rebut aquest correu electr?nic per error, us preguem que n?informeu al remitent i que elimineu del sistema el missatge i el material annex que pugui contenir. Gr?cies per la vostra col?laboraci?.

Este correo electr?nico y sus anexos pueden contener informaci?n confidencial o legalmente protegida y est? exclusivamente dirigido a la persona o entidad destinataria. Si usted no es el destinatario final o la persona encargada de recibirlo, no est? autorizado a leerlo, retenerlo, modificarlo, distribuirlo, copiarlo ni a revelar su contenido. Si ha recibido este mensaje electr?nico por error, le rogamos que informe al remitente y elimine del sistema el mensaje y el material anexo que pueda contener. Gracias por su colaboraci?n.

This email message and any documents attached to it may contain confidential or legally protected material and are intended solely for the use of the individual or organization to whom they are addressed. We remind you that if you are not the intended recipient of this email message or the person responsible for processing it, then you are not authorized to read, save, modify, send, copy or disclose any of its contents. If you have received this email message by mistake, we kindly ask you to inform the sender of this and to eliminate both the message and any attachments it carries from your account. Thank you for your collaboration.


From r.hijmans at gmail.com  Thu Oct 18 18:50:55 2012
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Thu, 18 Oct 2012 09:50:55 -0700
Subject: [R-sig-Geo] create new raster from multiple input raster
 following logical conditions?
In-Reply-To: <CAAFmNktTNWic3J6hfuc6a4jA1LHZFRmWsGAP9MhPDbgZs-CBnA@mail.gmail.com>
References: <CAAFmNktbxyp-sA4e6YZAhmsKk46nxtjtUxGLnYs8=xvFK1sy0A@mail.gmail.com>
	<CAFFLneRqRK7fZbDmhqnjngO0FvXw2QaW0ujMpA4j-+6F=K9Mtw@mail.gmail.com>
	<CAAFmNktTNWic3J6hfuc6a4jA1LHZFRmWsGAP9MhPDbgZs-CBnA@mail.gmail.com>
Message-ID: <CANtt_hzXKp4Fz_f0_rWOa6P8arCbjmZLjJzPWjrvzmkVhCzotw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121018/adac51c9/attachment.pl>

From moshersteven at gmail.com  Thu Oct 18 19:14:29 2012
From: moshersteven at gmail.com (steven mosher)
Date: Thu, 18 Oct 2012 10:14:29 -0700
Subject: [R-sig-Geo] create new raster from multiple input raster
 following logical conditions?
In-Reply-To: <CAAFmNktTNWic3J6hfuc6a4jA1LHZFRmWsGAP9MhPDbgZs-CBnA@mail.gmail.com>
References: <CAAFmNktbxyp-sA4e6YZAhmsKk46nxtjtUxGLnYs8=xvFK1sy0A@mail.gmail.com>
	<CAFFLneRqRK7fZbDmhqnjngO0FvXw2QaW0ujMpA4j-+6F=K9Mtw@mail.gmail.com>
	<CAAFmNktTNWic3J6hfuc6a4jA1LHZFRmWsGAP9MhPDbgZs-CBnA@mail.gmail.com>
Message-ID: <CAFFLneSoUPrsugLqOWUQQaTWhx-3KHcC-gvG72SLg+CMOwjDqg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121018/a05b6e12/attachment.pl>

From aortizbobea at arec.umd.edu  Thu Oct 18 20:14:03 2012
From: aortizbobea at arec.umd.edu (Ariel Ortiz-Bobea)
Date: Thu, 18 Oct 2012 11:14:03 -0700 (PDT)
Subject: [R-sig-Geo] dates with brick and multilayer netcdf file are off
Message-ID: <1350584043220-7581332.post@n2.nabble.com>

Hello,

I'm having a problem when trying to import a multi-layer netcdf file using
brick() in the raster package. The dates in the raster/brick object are off
by a lot and after importing the file I get the warning message:
 
    In .doTime(r, nc, zvar, dim3) : assuming a standard calender  

The netcdf files corresponds to the output of a climate model with years of
360 days so perhaps this has to do with the problem. I suppose the .doTime
function is having a hard time extracting this date format.

I selected a small file of 30 days (3.4MB) that you can download to
reproduce the problem:
https://dl.dropbox.com/u/45311184/tasmin_day_HadGEM2-ES_rcp85_r1i1p1_20991201-20991230.nc

That file contains data for time periods 2099/12/01-2099/12/30. When
imported, the reported range of dates is 2096/06/20-2096/07/19. So it's 30
time periods, but the wrong ones.

I could manually set the time periods given that I know the boundary dates
and the time step, but I rather have a more elegant solution.

Any help would be great. 

Thanks,

Ariel


# Reproducible code: #-----------------

# load package
   library(raster)

# Working directory where you placed the nc file
   setwd("/Users/Ariel/Downloads")
   
# Load file
   r <- brick("tasmin_day_HadGEM2-ES_rcp85_r1i1p1_20991201-20991230.nc",
varname="tasmin")
   # here I get the following warning:
   # Warning message:
   # In .doTime(r, nc, zvar, dim3) : assuming a standard calender  

# See layer names
   r at layernames # does not match the 2099/12/01-2099/12/30 time period,
dates are off ~ 2.5 years




-----
Ariel Ortiz-Bobea
PhD Candidate in Agricultural & Resource Economics
University of Maryland - College Park
--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/dates-with-brick-and-multilayer-netcdf-file-are-off-tp7581332.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From pingyang.whu at gmail.com  Fri Oct 19 04:47:07 2012
From: pingyang.whu at gmail.com (ping yang)
Date: Thu, 18 Oct 2012 22:47:07 -0400
Subject: [R-sig-Geo] "regridding" netCDF?
In-Reply-To: <87mx3ew372.fsf@pobox.com>
References: <87mx3ew372.fsf@pobox.com>
Message-ID: <CAK8gSG-7VFTN9zQTjU+cWGKti0-HMyFmYLwssS1q7i=aaxvWOw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121018/b4bc486b/attachment.pl>

From lyndon.estes at gmail.com  Fri Oct 19 17:02:28 2012
From: lyndon.estes at gmail.com (Lyndon Estes)
Date: Fri, 19 Oct 2012 11:02:28 -0400
Subject: [R-sig-Geo] Pointers for querying postGIS and bringing spatial
 geometries into R
In-Reply-To: <50757884.8020104@uni-muenster.de>
References: <4241b212a0f2480aaf1c8a0f9dc77859@EX-0-HT0.lancs.local>
	<CANVKczOt6nXANCvc_3hipSw5Wy8+_+Jx54zJnwF_8zbQZhLJKA@mail.gmail.com>
	<50749575.3090700@uni-muenster.de>
	<CALuVVaZ_xroB0hHnLfTs_sXkMPBL_0yfvPhS2oEc-4Lvt1Efhg@mail.gmail.com>
	<50757884.8020104@uni-muenster.de>
Message-ID: <CALuVVaaiLcWNqDFNqRGCE1+QB+PUDz2ojpe9boKjE6eSv=3p9A@mail.gmail.com>

Hi Edzer,

Thanks for the tip, and sorry for the slow response.

I tried this, based on the approach from the stpg vignette.  It looks
like it is getting closer, but still not quite successful.

Here's my approach (sorry I can't give a toy postgis example).  This
is trying to load in a set of 609 polygons.

# Libraries
library(RPostgreSQL)
library(rgdal)

dbname <- "mydb"
user <- "uname"
password <- "mypw"
OGRstring <- paste("PG:dbname=", dbname, " user=", user, " password=",
password, sep = "")
sitepolys <- readOGR(OGRstring, layer="sites", driver = "PostgreSQL")

> sitepolys <- readOGR(OGRstring, layer="newqaqc_sites")
OGR data source with driver: PostgreSQL
Source: "PG:dbname=mydb user=uname password=mypw", layer: "sites"
with 1 features and 2 fields
Feature type: NA with 2 dimensions
Error in readOGR(OGRstring, layer = "sites") :
  Incompatible geometry: 1853189987
In addition: Warning message:
In readOGR(OGRstring, layer = "sites") :
  Deleted feature IDs: 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,
14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30,
31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47,
48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64,
65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81,
82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98,
99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112,
113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123, 124, 125, 126,
127, 128, 129, 130, 131, 132, 133, 134, 135, 136, 137, 138, 139, 140,
141, 142, 143, 144, 145, 146, 147, 148, 149, 150, 151, 152, 153, 154,
155, 156, 157, 158, 159, 160, 161, 162, 163, 164, 165, 166, 167, 168,
169, 170, 171, 172, 173, 174, 175, 176, 177, 178, 179, 180, 181, 182,
183, 184, 185, 186, 187, 188, 189, 190, 191, 192, 193, 194, 195, 196,
197, 198, 199, 200, 201, 202, 203, 204, 205, 206, 207, 208, 209, 210,
211, 212, 213, 214, 215, 216, 217, [... truncated]

So, it looks like it could be working, but there is something
unappealing about geometries.

Still, it works fine when I load the same data from a shapefile:

qaqc.polys <- readOGR(dsn = "sites.shp", layer = "sites")

So maybe it got broken when being brought into PostGIS.

If I get readOGR working with password and user name from postGIS, I
will post back.  Otherwise, thanks again for the suggestions.

Best, Lyndon





On Wed, Oct 10, 2012 at 9:30 AM, Edzer Pebesma
<edzer.pebesma at uni-muenster.de> wrote:
> Lyndon,
>
> as a side note, readOGR with the postGIS driver does work nicely, as
> shown e.g. here:
>
> http://wiki.intamap.org/index.php/PostGIS
>
> (where no username / passwd was set); more recent (but deeper hidden) I
> reported attempts with username / passwd here:
> http://cran.r-project.org/web/packages/spacetime/vignettes/stpg.pdf (in
> this example, readOGR was not used because only the attribute tables
> resulting from spatial and/or temporal selections in postGIS were retrieved)
>
> On 10/10/2012 02:01 PM, Lyndon Estes wrote:
>> Hi to everyone,
>>
>> Thanks to all of you for the advice on this, which has solved my problem
>> quite nicely now.  Based on your suggestions, I figured out the following:
>>
>> ogr2ogr was broken for me because I had not completely removed a prior
>> custom install of gdal that I had set up for hdf4 support, which required
>> libjpeg. Once removed, I can use ogr2ogr fine from the linux shell.
>>
>> Since I want to select a particular record from the postgis database, and
>> want to keep the object in R without writing it to disk for the time being
>> (which would rule out a system call to ogr2ogr as an option), I am using
>> the RpostgreSQL option together with rgeos::readWKT.  I am basing this on
>> the idea that it is not possible to use sql statements in readOGR, and thus
>> can't select an individual geometry from a table (although I see there was
>> some talk about this in 2010:
>> http://r-sig-geo.2731867.n2.nabble.com/passing-SQL-through-readOGR-td3816889.html).
>>
>>
>> library(RPostgreSQL)
>> # CRS
>> drv <- dbDriver("PostgreSQL")
>> con <- dbConnect(drv, dbname = "mydb", user = "me", password = "mypw")
>> sql <- "SELECT ST_AsEWKT(geom) from sa1kgrid where id=9"
>> kmlGeom <- dbGetQuery(con, sql)
>> kmlGeom
>> 1 SRID=97490;MULTIPOLYGON(((570779.01553729
>> -2401338.07340772,571779.01553729 -2401338.07340772,571779.01553729
>> -2402338.07340772,570779.01553729 -2402338.07340772,570779.01553729
>> -2401338.07340772)))
>> # Comes back as data.frame with SRID, which needs to be stripped out for
>> readWKT to work
>> geomStr <- unlist(strsplit(kmlGeom[1, ], ";"))
>> geomPoly <- readWKT(geomStr[-grep("SRID", geomStr)])
>>
>> That seems to work nicely, so thanks for the solution!
>>
>> Best, Lyndon
>>
>>
>>
>>
>>
>> On Tue, Oct 9, 2012 at 5:21 PM, Edzer Pebesma <edzer.pebesma at uni-muenster.de
>>> wrote:
>>
>>>
>>>
>>> On 10/09/2012 12:04 PM, Barry Rowlingson wrote:
>>>> There must be an R WKT reader somewhere...
>>>
>>> rgeos::readWKT
>>> --
>>> Edzer Pebesma
>>> Institute for Geoinformatics (ifgi), University of M?nster
>>> Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
>>> 8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
>>> http://www.52north.org/geostatistics      e.pebesma at wwu.de
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>
> --
> Edzer Pebesma
> Institute for Geoinformatics (ifgi), University of M?nster
> Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
> 8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
> http://www.52north.org/geostatistics      e.pebesma at wwu.de
>


From narayani at ku.edu  Fri Oct 19 17:59:38 2012
From: narayani at ku.edu (Narayani Barve)
Date: Fri, 19 Oct 2012 10:59:38 -0500
Subject: [R-sig-Geo] How to cite raster package ?
Message-ID: <CAE=+0-JcBKTGkCmcDWXJkH2AQHRXbDa+MJeHCFXCmTsdohB2xw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121019/6fb980ef/attachment.pl>

From basille at ase-research.org  Fri Oct 19 18:01:29 2012
From: basille at ase-research.org (basille at ase-research.org)
Date: Fri, 19 Oct 2012 12:01:29 -0400
Subject: [R-sig-Geo] How to cite raster package ?
In-Reply-To: <CAE=+0-JcBKTGkCmcDWXJkH2AQHRXbDa+MJeHCFXCmTsdohB2xw@mail.gmail.com>
References: <CAE=+0-JcBKTGkCmcDWXJkH2AQHRXbDa+MJeHCFXCmTsdohB2xw@mail.gmail.com>
Message-ID: <50817959.6070800@ase-research.org>

As for any R package:

 > citation("raster")

To cite package ?raster? in publications use:

   Robert J. Hijmans & Jacob van Etten (2012). raster: Geographic
   analysis and modeling with raster data. R package version 2.0-12.
   http://CRAN.R-project.org/package=raster

A BibTeX entry for LaTeX users is

   @Manual{,
     title = {raster: Geographic analysis and modeling with raster data},
     author = {Robert J. Hijmans & Jacob van Etten},
     year = {2012},
     note = {R package version 2.0-12},
     url = {http://CRAN.R-project.org/package=raster},
   }

Regards,
Mathieu.


Le 19/10/2012 11:59, Narayani Barve a ?crit :
> Hi All,
>
> I have a genuine question. I want to cite raster package in my paper. But I
> could not find the citation details. Any help will be appreciated.
>
> Thanks,
> Narayani
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 

~$ whoami
Mathieu Basille, PhD

~$ locate --details
University of Florida \\
Fort Lauderdale Research and Education Center
(+1) 954-577-6314
http://ase-research.org/basille

~$ fortune
? Le tout est de tout dire, et je manque de mots
Et je manque de temps, et je manque d'audace. ?
  -- Paul ?luard


From sarah.goslee at gmail.com  Fri Oct 19 18:04:16 2012
From: sarah.goslee at gmail.com (Sarah Goslee)
Date: Fri, 19 Oct 2012 12:04:16 -0400
Subject: [R-sig-Geo] How to cite raster package ?
In-Reply-To: <CAE=+0-JcBKTGkCmcDWXJkH2AQHRXbDa+MJeHCFXCmTsdohB2xw@mail.gmail.com>
References: <CAE=+0-JcBKTGkCmcDWXJkH2AQHRXbDa+MJeHCFXCmTsdohB2xw@mail.gmail.com>
Message-ID: <CAM_vjun+TZ=z1m3f9SS9uu=vv-ghG69DW+UpyZ47kSZ+KO-qWQ@mail.gmail.com>

Great question, and I'm glad you are planning to cite the packages you use.

Load the package, and type:
citation("raster")

To get the proper citation for R itself:
citation()

Sarah

On Fri, Oct 19, 2012 at 11:59 AM, Narayani Barve <narayani at ku.edu> wrote:
> Hi All,
>
> I have a genuine question. I want to cite raster package in my paper. But I
> could not find the citation details. Any help will be appreciated.
>
> Thanks,
> Narayani
>
>         [[alternative HTML version deleted]]
>

-- 
Sarah Goslee
http://www.functionaldiversity.org


From sturgeon09 at gmail.com  Fri Oct 19 18:05:11 2012
From: sturgeon09 at gmail.com (Samuel Turgeon)
Date: Fri, 19 Oct 2012 12:05:11 -0400
Subject: [R-sig-Geo] How to cite raster package ?
In-Reply-To: <CAE=+0-JcBKTGkCmcDWXJkH2AQHRXbDa+MJeHCFXCmTsdohB2xw@mail.gmail.com>
References: <CAE=+0-JcBKTGkCmcDWXJkH2AQHRXbDa+MJeHCFXCmTsdohB2xw@mail.gmail.com>
Message-ID: <CAH3FZ066eXRA5gUFsW+sVn_HLyABjsiCBq3UF41aASWXgR-DJw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121019/8f76d231/attachment.pl>

From tyler.j.frazier at tu-berlin.de  Sun Oct 21 21:03:41 2012
From: tyler.j.frazier at tu-berlin.de (Frazier, Tyler James)
Date: Sun, 21 Oct 2012 19:03:41 +0000
Subject: [R-sig-Geo] Fwd: [Qgis-user] spatial join, many to 1
References: <1350778252.77636.YahooMailClassic@web122001.mail.ne1.yahoo.com>
Message-ID: <9659839B4C1FD4498B496BCEFF047B6F86780D00@EX-MB1.tubit.win.tu-berlin.de>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121021/d5683263/attachment.pl>

From edzer.pebesma at uni-muenster.de  Sun Oct 21 22:03:40 2012
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Sun, 21 Oct 2012 22:03:40 +0200
Subject: [R-sig-Geo] Fwd: [Qgis-user] spatial join, many to 1
In-Reply-To: <9659839B4C1FD4498B496BCEFF047B6F86780D00@EX-MB1.tubit.win.tu-berlin.de>
References: <1350778252.77636.YahooMailClassic@web122001.mail.ne1.yahoo.com>
	<9659839B4C1FD4498B496BCEFF047B6F86780D00@EX-MB1.tubit.win.tu-berlin.de>
Message-ID: <5084551C.4090005@uni-muenster.de>

Ty, you might want to read about over() and aggregate() in sp:

http://cran.r-project.org/web/packages/sp/vignettes/over.pdf

If you want to combine polygons with polygons, package rgeom contains
the required further over() methods.

Comments welcome,

On 10/21/2012 09:03 PM, Frazier, Tyler James wrote:
> 
> Hi,
> 
> Is there a way to do a spatial join: MANY to ONE --  and still retain all the feature characteristics in R?  I want to join several towns, villages etc...to a tract of land (survey enumeration area) and keep the names of all the towns, villages, etc...as part of the spatial join.  I am wondering if it would be worthwhile to try using the manageR plugin through QGIS, or readOGR and then run some type of spatial aggregate() function and then writeOGR or perhaps using postGIS with both R and QGIS.  I would prefer to keep my programming to R and not have to introduce postGIS and additional commands, unless there were some significant long-term advantages, such as better integration between R and QGIS or perhaps another open source.
> 
> All advice and suggestions are welcome.
> 
> Thanks!
> Ty
> 
> Begin forwarded message:
> 
> Subject: Re: [Qgis-user] spatial join, many to 1
> Date: October 21, 2012 2:10:52 AM GMT+02:00
> 
> Agreed,
> 
> Qgis is not really a spatial data management tool, use a spatial database for that, then use QGIS as a gui to interact with the database.
> 
> Whether you use Spatialite, MySQL or Postgis (from the FOSS world) depends on how powerful you want your database solution to be. QGIS works very well with Spatialite & Postgis.
> 
> Subject: Re: [Qgis-user] spatial join, many to 1
> Date: Sunday, October 21, 2012, 12:03 PM
> 
> Hey Tyler,
> 
> My advice would be to load you data into a spatialite database and use that to run your query. It will give you the most control.  Have a look at the QSpatialite plugin, it will let you load in your QGIS layers and run queries.
> 
> Sent: 21/10/2012 8:54 AM
> Subject: [Qgis-user] spatial join, many to 1
> Hi,
> 
> Is there a way to do a spatial join: MANY to ONE --  and still retain all the feature characteristics in QGIS?  I want to join several towns, villages etc...to a tract of land and keep the names of all the towns, villages, etc...as part of the spatial join.  I have done something similar in R with aggregate() but without the spatial component.  Any advice suggestions are welcome.
> 
> Thanks!
> Ty
> 
> 
> 
> -----
> Tyler Frazier
> Department of Transportation Planning and Telematics
> Technical University Berlin
> http://www.vsp.tu-berlin.de/
> 
> 
> 
> 
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From r.hijmans at gmail.com  Mon Oct 22 08:25:51 2012
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Sun, 21 Oct 2012 23:25:51 -0700
Subject: [R-sig-Geo] "regridding" netCDF?
In-Reply-To: <CAK8gSG-7VFTN9zQTjU+cWGKti0-HMyFmYLwssS1q7i=aaxvWOw@mail.gmail.com>
References: <87mx3ew372.fsf@pobox.com>
	<CAK8gSG-7VFTN9zQTjU+cWGKti0-HMyFmYLwssS1q7i=aaxvWOw@mail.gmail.com>
Message-ID: <CANtt_hx+xBJQCQhxww0BBKyrDGikidAcA3OiaUZPaijQ41brAw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121021/e40b982a/attachment.pl>

From r.hijmans at gmail.com  Mon Oct 22 08:34:38 2012
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Sun, 21 Oct 2012 23:34:38 -0700
Subject: [R-sig-Geo] dates with brick and multilayer netcdf file are off
In-Reply-To: <1350584043220-7581332.post@n2.nabble.com>
References: <1350584043220-7581332.post@n2.nabble.com>
Message-ID: <CANtt_hwYcxOLHg3MG5EpbYwDX2dfYynMrT5S6aTXsePx3O8bVQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121021/7b9778a5/attachment.pl>

From r.hijmans at gmail.com  Mon Oct 22 08:35:52 2012
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Sun, 21 Oct 2012 23:35:52 -0700
Subject: [R-sig-Geo] Universal Kriging and raster library
In-Reply-To: <CANJhsN157DjWYQPsOvBoRgrxRsAD1gQsftmU_9HE3-OzuP22dA@mail.gmail.com>
References: <CANJhsN157DjWYQPsOvBoRgrxRsAD1gQsftmU_9HE3-OzuP22dA@mail.gmail.com>
Message-ID: <CANtt_hwnnkk6si7Uikti3bq_YPJtaaFxmzz_j1re0Y95QWMPOg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121021/9775b7f2/attachment.pl>

From Roger.Bivand at nhh.no  Mon Oct 22 15:56:06 2012
From: Roger.Bivand at nhh.no (Roger Simon Bivand)
Date: Mon, 22 Oct 2012 13:56:06 +0000
Subject: [R-sig-Geo] install rgdal, lazy loading error
In-Reply-To: <CAC28k7QHcKFYPgAhNQEzjB8yMtbk-P7Ohu9kWW-59m+ok_icMw@mail.gmail.com>
References: <mailman.2047.1350497925.4555.r-sig-geo@r-project.org>,
	<CAC28k7QHcKFYPgAhNQEzjB8yMtbk-P7Ohu9kWW-59m+ok_icMw@mail.gmail.com>
Message-ID: <E953A98FD6EAA7479A68EE8C24491F6B4C7F01D7@CUPON.valuta.nhh.no>

This is effectively impossible to replicate, as ony you have your hardware. My intuition suggests that since you cannot run ldconfig, which is reserved for root, you may need to set the path to the proj and gdal shared objects, using an LD PATH shell variable. How the worker nodes will then find the shared objects is also an issue. You could also attempt to build the rgdal binary static, by selecting appropriate settings for configure for GDAL. It can be done, but requires particular care in making sure that only drivers that can be built static are included. Please report back on your progress - also look for local help.

Hope this helps,

Roger

--
Roger Bivand
NHH Norwegian School of Economics
Helleveien 30, 5045 Bergen, Norway
Roger.Bivand at nhh.no


________________________________________
Fra: r-sig-geo-bounces at r-project.org [r-sig-geo-bounces at r-project.org] p&#229; vegne av Ben Weinstein [benweinstein2010 at gmail.com]
Sendt: 18. oktober 2012 2:40
To: r-sig-geo
Emne: [R-sig-Geo] install rgdal, lazy loading error

Hi all,

I have successfully made and installed both gdal, and proj.4, but still
cannot get rgdal to be installed in R. I think i'm very close. I do not
have root access, if that matters, i've installed everything locally. I'm
using debian on a beowulf cluster.

I call:

install.packages("rgdal", .libPaths()[1], configure.args =
"--with-gdal-config=/usr/local/pkg/gdal/bin/gdal-config
--with-proj-include=/nfs/user08/bw4sz/include
--with-proj-lib=/nfs/user08/bw4sz/lib")

i've defeated the gdal-config and the api_proj.h file errors that have
plagued others. Now i believe i've run into a smaller problem.

The package downloads and installs but it fails the "lazy loading test".
This seems like an error with the rgdal version, since its looking for a
file libgdal.so.1 that no longer exists. Is this a versioning issue?


** R
** inst
** preparing package for lazy loading
** help
*** installing help indices
** building package indices ...
** testing if installed package can be loaded
Error in dyn.load(file, DLLpath = DLLpath, ...) :
  unable to load shared object
'/nfs/user08/bw4sz/library/rgdal/libs/rgdal.so':
  libgdal.so.1: cannot open shared object file: No such file or directory
Error: loading failed

with the R.Version()

> R.Version()
$platform
[1] "x86_64-unknown-linux-gnu"

$arch
[1] "x86_64"

$os
[1] "linux-gnu"

$system
[1] "x86_64, linux-gnu"

$status
[1] ""

$major
[1] "2"

$minor
[1] "14.2"

$year
[1] "2012"

$month
[1] "02"

$day
[1] "29"

$`svn rev`
[1] "58522"

$language
[1] "R"

$version.string
[1] "R version 2.14.2 (2012-02-29)"

Any thoughts are appreciated,

Best,

ben

please forgive cross-posting on R-sig debian for those who subscribe to
both.
--
Ben Weinstein
Graduate Student
Ecology and Evolution
Stony Brook University

http://life.bio.sunysb.edu/~bweinste/index.html

        [[alternative HTML version deleted]]

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo

From hengl at spatial-analyst.net  Mon Oct 22 16:46:32 2012
From: hengl at spatial-analyst.net (Tomislav Hengl)
Date: Mon, 22 Oct 2012 16:46:32 +0200
Subject: [R-sig-Geo] question about plotKML() - Google Earth
In-Reply-To: <BFCE57D0BE7CBB42A581347DE375AF9A11560DB1@UFEXCH-MBXN01.ad.ufl.edu>
References: <BFCE57D0BE7CBB42A581347DE375AF9A1155E685@UFEXCH-MBXN01.ad.ufl.edu>
	<5073DC92.4000905@spatial-analyst.net>
	<BFCE57D0BE7CBB42A581347DE375AF9A11560B56@UFEXCH-MBXN01.ad.ufl.edu>
	<5077CB7F.3010409@spatial-analyst.net>
	<BFCE57D0BE7CBB42A581347DE375AF9A11560DB1@UFEXCH-MBXN01.ad.ufl.edu>
Message-ID: <50855C48.9010302@spatial-analyst.net>



On 12/10/2012 15:37, Struve,Juliane wrote:
> Hi,
>
> These are the files and the code I used.
>
> Thanks for help plotting the data with correct IDs.
>
> Juliane
>
> filename <- "1647"
> Data <- read.csv(filename,header=TRUE,sep=",")
> Data <- na.omit(Data)
> head(Data)
> Data$Fish_ID <- as.numeric(Data$Fish_ID)
> Data$Date <- with(Data, as.POSIXct(paste(as.character(Date), substring(as.character(Time), 12))))
> library(sp)
> Data.sp <- SpatialPoints(cbind(Data$Xcoordinate,Data$Ycoordinate))
> proj4string(Data.sp) = CRS("+proj=longlat +datum=WGS84")
> Data.spdf <- (SpatialPointsDataFrame(Data.sp, data.frame(Data$Fish_ID)))
> plot(Data.spdf,pch=16,col="blue")
> title(filename)
> library(spacetime)
> Data.ST <- STIDF(Data.sp, Data$Date, data.frame(Data$Fish_ID))
> head(Data.ST)
> library(plotKML)
> plotKML(Data.ST,colour_scale=rep("#FFFF00", 2),kmz=FALSE)
>

The rounding of numbers is on purpose. If you send a numeric vector, I 
noticed that I need to round up numbers before writing to KML, otherwise 
the text in the KML does not look nice, e.g. you get the 32-bit computer 
numbers:

 > paste(1/3)
[1] "0.333333333333333"
 > paste(signif(1/3, 3))
[1] "0.333"

Your data set is in fact a BIG data set (although you have only 5 
points!), so I would advise you to start with a subset, then improve. To 
get the point ID's in Google Earth, I would simply use the 
"points_names" argument e.g.:

 > filename <- "1647"
 > Data <- read.csv(filename,header=TRUE,sep=",")
 > Data <- na.omit(Data)
 > Data$ID <- as.factor(Data$ID)
 > Data$Date <- with(Data, as.POSIXct(paste(as.character(Date), 
substring(as.character(Time), 12))))
 > library(sp)
 > coordinates(Data) <- ~ Xcoordinate + Ycoordinate
 > proj4string(Data) = CRS("+proj=longlat +datum=WGS84")
 > library(spacetime)
 > Data.ST <- STIDF(Data, Data$Date, data.frame(Data$ID))
 > library(plotKML)
 > Data.ST.10 <- Data.ST[1:10]
 > plotKML(Data.ST.10, points_names=Data.ST.10$Data.ID, 
colour_scale=rep("#FFFF00", 2))

HTH

T. Hengl
http://www.wewur.wur.nl/popups/vcard.aspx?id=HENGL001

>
> -----Original Message-----
> From: Tomislav Hengl [mailto:hengl at spatial-analyst.net]
> Sent: Friday, October 12, 2012 3:49 AM
> To: Struve,Juliane
> Subject: Re: [R-sig-Geo] question about plotKML() - Google Earth
>
>
> No. Please better use "hengl at spatial-analyst.net" (and please do not
> send big files etc).
>
> I plan to work on plotKML next week Monday/Tuesday.
>
> On 11/10/2012 14:23, Struve,Juliane wrote:
>> Good morning,
>>
>> Did you receive the files that I sent to your other address ?
>>
>> Thanks and best wishes,
>>
>> Juliane
>>
>> -----Original Message-----
>> From: Tomislav Hengl [mailto:hengl at spatial-analyst.net]
>> Sent: Tuesday, October 09, 2012 4:13 AM
>> To: Struve,Juliane
>> Cc: r-sig-geo at r-project.org
>> Subject: Re: [R-sig-Geo] question about plotKML() - Google Earth
>>
>>
>> On 08/10/2012 22:11, Struve,Juliane wrote:
>>> Dear list members,
>>>
>>> I am using plotKML() to plot some animal tracks on Google Earth. The
>>> attribute data that I am using are individual IDs, which consist of 4
>>> figures, e.g. 1145. In the STDIF object that I create these data
>>> appear correct in the "data" slot. However, in the plot on Google
>>> Earth the numbers are rounded, 1145 e.g. becomes 1150.
>>>
>>> Does anyone know what causes this/how to prevent it ?
>>>
>>> Thanks a lot for your time,
>>>
>>> Juliane
>>
>> I need to see your code and the KML file. Please send it outside the
>> R-sig-geo and I will try to fix.
>>
>> The original function is at:
>>
>> https://r-forge.r-project.org/scm/viewvc.php/pkg/R/layer.STTDF.R?view=markup&root=plotkml
>>
>> thanks for your e-mail,
>>
>> T. Hengl
>> http://www.wewur.wur.nl/popups/vcard.aspx?id=HENGL001
>>
>>>
>>> [[alternative HTML version deleted]]
>>>
>>> _______________________________________________ R-sig-Geo mailing
>>> list R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>


From mauriziomarchi85 at gmail.com  Mon Oct 22 19:48:21 2012
From: mauriziomarchi85 at gmail.com (Maurizio Marchi)
Date: Mon, 22 Oct 2012 19:48:21 +0200
Subject: [R-sig-Geo] Universal Kriging and raster library
Message-ID: <CANJhsN1hOvOpUqpgZQFuw7DU4gRYxAPEnsHMmZz0GkRMjy9xBg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121022/ca127215/attachment.pl>

From malindgren at alaska.edu  Mon Oct 22 20:15:59 2012
From: malindgren at alaska.edu (Michael Lindgren)
Date: Mon, 22 Oct 2012 10:15:59 -0800
Subject: [R-sig-Geo] Rotated Pole Coordinates
Message-ID: <CAObCBzsM-2j-rnftpODQKCMSXJUCkhbxjKtHk29j=5xH=qMd5g@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121022/7dcc3008/attachment.pl>

From tyler.j.frazier at tu-berlin.de  Mon Oct 22 20:52:15 2012
From: tyler.j.frazier at tu-berlin.de (Frazier, Tyler James)
Date: Mon, 22 Oct 2012 18:52:15 +0000
Subject: [R-sig-Geo] [Qgis-user] spatial join, many to 1
In-Reply-To: <5084551C.4090005@uni-muenster.de>
References: <1350778252.77636.YahooMailClassic@web122001.mail.ne1.yahoo.com>
	<9659839B4C1FD4498B496BCEFF047B6F86780D00@EX-MB1.tubit.win.tu-berlin.de>
	<5084551C.4090005@uni-muenster.de>
Message-ID: <9659839B4C1FD4498B496BCEFF047B6F86782108@EX-MB1.tubit.win.tu-berlin.de>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121022/8822aa8f/attachment.pl>

From macqueen1 at llnl.gov  Mon Oct 22 21:53:12 2012
From: macqueen1 at llnl.gov (MacQueen, Don)
Date: Mon, 22 Oct 2012 19:53:12 +0000
Subject: [R-sig-Geo] as() and conversion from character to factor
In-Reply-To: <50719F26.9030800@uni-muenster.de>
Message-ID: <CCAAF1FE.B0FE3%macqueen1@llnl.gov>

Thank you.

-Don

-- 
Don MacQueen

Lawrence Livermore National Laboratory
7000 East Ave., L-627
Livermore, CA 94550
925-423-1062





On 10/7/12 8:26 AM, "Edzer Pebesma" <edzer.pebesma at uni-muenster.de> wrote:

>For now, you should be able to prevent this by starting your script with
>an
>
>options(stringsAsFactors = FALSE)
>
>but in future releases, sp will not do this conversion.
>
>Thanks,
>
>On 10/04/2012 09:31 PM, MacQueen, Don wrote:
>> I just noticed that in the following sequence the final step to
>> SpatialGridDataFrame converts the character column to factor, whereas
>>the
>> previous ones do not. Source the following little script, and it will
>> hopefully show what I'm seeing. Shouldn't this be consistent?
>> 
>> Thanks
>> -Don
>> 
>> 
>> require(sp)
>> require(maptools)
>> 
>> tstdf <- expand.grid(x=1:3, y=1:3)
>> tstdf$ch <- rep('a',nrow(tstdf))
>> 
>> tstsp <- tstdf
>> coordinates(tstsp) <- c('x','y')
>> proj4string(tstsp) <- CRS('+init=epsg:32610')
>> 
>> tstpx <- as(tstsp, "SpatialPixelsDataFrame")
>> 
>> tstgrd <- as(tstpx, "SpatialGridDataFrame")
>> 
>> print(class(tstdf$ch))
>> print(class(tstsp$ch))
>> print(class(tstpx$ch))
>> print(class(tstgrd$ch))
>> 
>> 
>> #########
>> I get:
>> 
>>> print(class(tstdf$ch))
>> [1] "character"
>>> print(class(tstsp$ch))
>> [1] "character"
>>> print(class(tstpx$ch))
>> [1] "character"
>>> print(class(tstgrd$ch))
>> [1] "factor"
>> #########
>> 
>> 
>> 
>> 
>> 
>> 
>> 
>>> sessionInfo()
>> R version 2.15.1 (2012-06-22)
>> Platform: x86_64-apple-darwin9.8.0/x86_64 (64-bit)
>> 
>> locale:
>> [1] C
>> 
>> attached base packages:
>> [1] stats     utils     datasets  grDevices graphics  methods   base
>> 
>> other attached packages:
>> [1] maptools_0.8-16 lattice_0.20-6  foreign_0.8-50  sp_1.0-0
>> 
>> loaded via a namespace (and not attached):
>> [1] grid_2.15.1 rmacq_1.1-8
>> 
>> 
>> 
>> 
>> 
>> 
>> 
>> 
>
>-- 
>Edzer Pebesma
>Institute for Geoinformatics (ifgi), University of M?nster
>Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
>8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
>http://www.52north.org/geostatistics      e.pebesma at wwu.de
>
>_______________________________________________
>R-sig-Geo mailing list
>R-sig-Geo at r-project.org
>https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From b.rowlingson at lancaster.ac.uk  Mon Oct 22 22:02:11 2012
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Mon, 22 Oct 2012 21:02:11 +0100
Subject: [R-sig-Geo] [Qgis-user] spatial join, many to 1
In-Reply-To: <1e5cda3895204a7faf037f8cf4dc80d7@EX-1-HT0.lancs.local>
References: <1350778252.77636.YahooMailClassic@web122001.mail.ne1.yahoo.com>
	<9659839B4C1FD4498B496BCEFF047B6F86780D00@EX-MB1.tubit.win.tu-berlin.de>
	<5084551C.4090005@uni-muenster.de>
	<1e5cda3895204a7faf037f8cf4dc80d7@EX-1-HT0.lancs.local>
Message-ID: <CANVKczNNDq+5iniQ5EX8M=aOLsJ_fHudzke1+MFpdBtCX6qmwQ@mail.gmail.com>

On Mon, Oct 22, 2012 at 7:52 PM, Frazier, Tyler James
<tyler.j.frazier at tu-berlin.de> wrote:
> Hi Edzer and list,
>
> Thanks for the package, the command over() essentially achieves my intended result, which is to overlay a set of (2500) points onto a set of (1000) polygons where each polygon receives all of the attribute data from each of the points located within its boundary.

 Each polygon can't [easily] 'receive' the attributes from a differing
number of points. The SpatialPolygonsDataFrame has one polygonal
feature related to one row in the data frame. You could have one
polygonal feature for each point, but that would end up as a massive
duplication of the polygonal data.

 It would seem to be better to create a new *point* data set, where
each row of the point data frame is augmented with the information
from the polygon in which it resides. This gives you something like an
ID variable that relates the points to the polygons in the manner of a
database id field.

 Overall, it really depends on what you want to do. If you want to
draw maps of polygons based on some aggregate function of the points
within, then that's a question of doing something like a 'tapply' on
the points using the polygons each point is in as a factor.

Barry


From tyler.j.frazier at tu-berlin.de  Mon Oct 22 22:54:06 2012
From: tyler.j.frazier at tu-berlin.de (Frazier, Tyler James)
Date: Mon, 22 Oct 2012 20:54:06 +0000
Subject: [R-sig-Geo] [Qgis-user] spatial join, many to 1
In-Reply-To: <CANVKczNNDq+5iniQ5EX8M=aOLsJ_fHudzke1+MFpdBtCX6qmwQ@mail.gmail.com>
References: <1350778252.77636.YahooMailClassic@web122001.mail.ne1.yahoo.com>
	<9659839B4C1FD4498B496BCEFF047B6F86780D00@EX-MB1.tubit.win.tu-berlin.de>
	<5084551C.4090005@uni-muenster.de>
	<1e5cda3895204a7faf037f8cf4dc80d7@EX-1-HT0.lancs.local>
	<CANVKczNNDq+5iniQ5EX8M=aOLsJ_fHudzke1+MFpdBtCX6qmwQ@mail.gmail.com>
Message-ID: <9659839B4C1FD4498B496BCEFF047B6F86782673@EX-MB1.tubit.win.tu-berlin.de>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121022/b8fdcc5b/attachment.pl>

From mintibezabih at gmail.com  Mon Oct 22 23:15:46 2012
From: mintibezabih at gmail.com (alemante zd)
Date: Mon, 22 Oct 2012 22:15:46 +0100
Subject: [R-sig-Geo] converting UTM to decimal (latitude and longitude)
Message-ID: <CAJfxP+pc4D+BQNX+o3mCzzB7poeB9zbW4f5haVk4mrVdphwSTQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121022/9de34661/attachment.pl>

From jstruve at ufl.edu  Mon Oct 22 23:26:30 2012
From: jstruve at ufl.edu (Struve,Juliane)
Date: Mon, 22 Oct 2012 21:26:30 +0000
Subject: [R-sig-Geo] converting UTM to decimal (latitude and longitude)
In-Reply-To: <CAJfxP+pc4D+BQNX+o3mCzzB7poeB9zbW4f5haVk4mrVdphwSTQ@mail.gmail.com>
References: <CAJfxP+pc4D+BQNX+o3mCzzB7poeB9zbW4f5haVk4mrVdphwSTQ@mail.gmail.com>
Message-ID: <BFCE57D0BE7CBB42A581347DE375AF9A1156A6F9@UFEXCH-MBXN02.ad.ufl.edu>

Hi Minti,

Have a look at convUL() in package PBSmapping.

Regards,

Juliane 

-----Original Message-----
From: r-sig-geo-bounces at r-project.org [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of alemante zd
Sent: Monday, October 22, 2012 5:16 PM
To: r-sig-geo at r-project.org
Subject: [R-sig-Geo] converting UTM to decimal (latitude and longitude)

Dear all,

I have an ascii grid file based on UTM coordinates. How can I transform it
to decimal format.

Regards
Minti

	[[alternative HTML version deleted]]

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From r.hijmans at gmail.com  Tue Oct 23 00:17:33 2012
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Mon, 22 Oct 2012 15:17:33 -0700
Subject: [R-sig-Geo] converting UTM to decimal (latitude and longitude)
In-Reply-To: <BFCE57D0BE7CBB42A581347DE375AF9A1156A6F9@UFEXCH-MBXN02.ad.ufl.edu>
References: <CAJfxP+pc4D+BQNX+o3mCzzB7poeB9zbW4f5haVk4mrVdphwSTQ@mail.gmail.com>
	<BFCE57D0BE7CBB42A581347DE375AF9A1156A6F9@UFEXCH-MBXN02.ad.ufl.edu>
Message-ID: <CANtt_hyez70B43_-0aXu4odUYWZJVYwYLvT9XARY9GCR0avMkA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121022/cef55191/attachment.pl>

From Tom_Roche at pobox.com  Tue Oct 23 06:00:11 2012
From: Tom_Roche at pobox.com (Tom Roche)
Date: Tue, 23 Oct 2012 00:00:11 -0400
Subject: [R-sig-Geo] how to plot Raster*? problems with raster::plot,
	fields::image.plot
Message-ID: <87txtl7s8k.fsf@pobox.com>


Could I get one or more spatial-plotting experts to examine defective
output produced when I try to plot a RasterLayer? I believe I'm pretty
close to solving these problems, but am very much a beginner, and at
the limit of my competence in this domain. I've tried to do this with
both raster::plot

http://stackoverflow.com/questions/13005181/rasterplot-problems-unwanted-rotation-extents

and with fields::image.plot

http://stackoverflow.com/questions/13022919/r-problems-visualizing-a-raster-with-fieldsimage-plot

In either case, the defective output (in a single 4-page PDF

https://github.com/downloads/TomRoche/GEIA_to_netCDF/GEIA_N2O_oceanic_regrid.pdf

where pages 1-3 are from raster::plot, and page 4 is from
fields::image.plot) can be generated by

1 Cloning

git://github.com/TomRoche/GEIA_to_netCDF.git

  onto a box with bash and an appropriately-configured R (notably,
  with packages=fields, ncdf4, raster).

2 `cd` to the cloned git repo (probably `cd ./GEIA_to_netCDF`)

3 Converting the ASCII input to netCDF, and plotting that netCDF, by
  running `./GEIA_to_netCDF.sh`, which calls

https://github.com/TomRoche/GEIA_to_netCDF/blob/master/GEIA.to.netCDF.r

4 Regridding the netCDF, and plotting that regridded output, by
  running `./regrid_GEIA_netCDF.sh`, which calls

https://github.com/TomRoche/GEIA_to_netCDF/blob/master/regrid.global.to.AQMEII.r

In each case the image extents are not as desired, and there is a
rotation problem (either involving the entire image, or just the
relation between an added map and the regridded data).

Your assistance is appreciated, Tom Roche <Tom_Roche at pobox.com>


From mauriziomarchi85 at gmail.com  Tue Oct 23 08:11:21 2012
From: mauriziomarchi85 at gmail.com (Maurizio Marchi)
Date: Tue, 23 Oct 2012 08:11:21 +0200
Subject: [R-sig-Geo] Universal Kriging and raster library
Message-ID: <CANJhsN3zGeH1bLAfuO4nf7LL3khHYhoxBXV4LzTHH3Zgr8t7Cg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121023/bc970b1b/attachment.pl>

From edzer.pebesma at uni-muenster.de  Tue Oct 23 08:14:52 2012
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Tue, 23 Oct 2012 08:14:52 +0200
Subject: [R-sig-Geo] [Qgis-user] spatial join, many to 1
In-Reply-To: <9659839B4C1FD4498B496BCEFF047B6F86782673@EX-MB1.tubit.win.tu-berlin.de>
References: <1350778252.77636.YahooMailClassic@web122001.mail.ne1.yahoo.com>
	<9659839B4C1FD4498B496BCEFF047B6F86780D00@EX-MB1.tubit.win.tu-berlin.de>
	<5084551C.4090005@uni-muenster.de>
	<1e5cda3895204a7faf037f8cf4dc80d7@EX-1-HT0.lancs.local>
	<CANVKczNNDq+5iniQ5EX8M=aOLsJ_fHudzke1+MFpdBtCX6qmwQ@mail.gmail.com>
	<9659839B4C1FD4498B496BCEFF047B6F86782673@EX-MB1.tubit.win.tu-berlin.de>
Message-ID: <508635DC.70602@uni-muenster.de>



On 10/22/2012 10:54 PM, Frazier, Tyler James wrote:
> Hi Barry,
> 
> Really what I am trying to do is link raw census DATA to an enumeration area MAP, which spatially represents different aggregations of those observations.  In order to do so, on the MAP side, I first want to join a point shape file which has all of the town names to an enumeration area shape file, which is missing those names.
> 
> Previously, when I did this on the DATA side I used the following command ---
> 
> enum_areas <- aggregate(localities_region1,by=list(localities_region1$ea_code), FUN=unique)
> 
> and when an enumeration area had more then one town located within it, R created a field within a row as follows ---
> 
> c("NEW-TOWN WHARF", "BALIBANGARA", "BOLENWO").

I don't think R can hold such a structure in a data.frame. Of course,
with lists it can do any nesting, but they are not tables.

> 
> On the MAP side, it appears when I use the over() command, like so ---
> 
> spatial_join <- over(ea_map, towns)
> 
> over() supplies only the name of the first town listed within that enumeration area and ignores/omits the remainder.  If over() created all of the names in a similar manner as aggregate(), couldn't I then use

As I mentioned before, when you supply over with the returnList = TRUE
argument, it will return all matches, just not in a table (as a table is
not very useful in this case).

> 
> map <- SpatialPolygonsDataFrame(ea_map,spatial_join)
> 
> in order to create my map?  What do you think?

Which property of towns do you want in ea_map? If, for instance, you
want the population of towns in ea_map, you could do (untested, we don't
have your data):

pop = aggregate(towns["population"], ea_map, sum)

> 
> I suppose it would be possible to achieve the same using postGIS and some commands there, but would rather take a route within R.  I haven't thought about how to use tapply() yet.

Showing us the PostGIS route might help us (and maybe yourself)
understand what you want.

> 
> Thanks!
> Ty
> 
> 
> On Oct 22, 2012, at 10:02 PM, Barry Rowlingson wrote:
> 
> On Mon, Oct 22, 2012 at 7:52 PM, Frazier, Tyler James
> <tyler.j.frazier at tu-berlin.de<mailto:tyler.j.frazier at tu-berlin.de>> wrote:
> Hi Edzer and list,
> 
> Thanks for the package, the command over() essentially achieves my intended result, which is to overlay a set of (2500) points onto a set of (1000) polygons where each polygon receives all of the attribute data from each of the points located within its boundary.
> 
> Each polygon can't [easily] 'receive' the attributes from a differing
> number of points. The SpatialPolygonsDataFrame has one polygonal
> feature related to one row in the data frame. You could have one
> polygonal feature for each point, but that would end up as a massive
> duplication of the polygonal data.
> 
> It would seem to be better to create a new *point* data set, where
> each row of the point data frame is augmented with the information
> from the polygon in which it resides. This gives you something like an
> ID variable that relates the points to the polygons in the manner of a
> database id field.
> 
> Overall, it really depends on what you want to do. If you want to
> draw maps of polygons based on some aggregate function of the points
> within, then that's a question of doing something like a 'tapply' on
> the points using the polygons each point is in as a factor.
> 
> Barry
> 
> -----
> Tyler Frazier
> Department of Transportation Planning and Telematics
> Technical University Berlin
> http://www.vsp.tu-berlin.de/
> 
> 
> 
> 
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From edzer.pebesma at uni-muenster.de  Tue Oct 23 08:18:47 2012
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Tue, 23 Oct 2012 08:18:47 +0200
Subject: [R-sig-Geo] Universal Kriging and raster library
In-Reply-To: <CANJhsN3zGeH1bLAfuO4nf7LL3khHYhoxBXV4LzTHH3Zgr8t7Cg@mail.gmail.com>
References: <CANJhsN3zGeH1bLAfuO4nf7LL3khHYhoxBXV4LzTHH3Zgr8t7Cg@mail.gmail.com>
Message-ID: <508636C7.4000103@uni-muenster.de>

In your example, I see:

> UK<-interpolate(r,gUK)
Error in eval(expr, envir, enclos) : object 'elev' not found

it seems that 'elev' is not present in r.

On 10/23/2012 08:11 AM, Maurizio Marchi wrote:
> Oh, ok, I'm sorry, I had not understand the "self-contained" expression.
> Anyway, a self-contained exaple can be this:
> 
> ############################## BEGINNING
> library(gstat)
> library(rgdal)
> library(raster)
> 
> data(meuse)
> coordinates(meuse) = ~x+y
> r <- raster(system.file("external/test.grd", package="raster"))
> projection(r)<-projection(meuse)
> 
> ##ORDINARY KRIGING (working)
> v<-variogram(log(zinc)~1,meuse)
> m<-fit.variogram(v,vgm(1,"Sph",300,1))
> gOK<-gstat(NULL,"log.zinc",log(zinc)~1,meuse,model=m)
> OK<-interpolate(r,gOK)
> 
> ##UNIVERSAL KRIGING (not working!!)
> vu<-variogram(log(zinc)~elev,meuse)
> mu<-fit.variogram(vu,vgm(1,"Sph",300,1))
> gUK<-gstat(NULL,"log.zinc",log(zinc)~elev,meuse,model=mu)
> UK<-interpolate(r,gUK)
> 
> ###CO-KRIGING (working)
> gCoK<-gstat(NULL,'log.zinc',log(zinc)~1,meuse)
> gCoK<-gstat(gCoK,'elev',elev~1,meuse)
> gCoK<-gstat(gCoK,'cadmium',cadmium~1,meuse)
> gCoK<-gstat(gCoK,'copper',copper~1,meuse)
> gCoK
> coV<-variogram(gCoK)
> plot(coV,type='b',main='Co-variogram')
> coV.fit<-fit.lmc(coV,gCoK,vgm(model='Sph',range=1000))
> coV.fit
> plot(coV,coV.fit,main='Fitted Co-variogram')
> coK<-interpolate(r,coV.fit)
> ############################################ END
> 
> I hope it can be ok :)
> Thanks a lot (again)
> 
> 
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From r.hijmans at gmail.com  Tue Oct 23 08:44:35 2012
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Mon, 22 Oct 2012 23:44:35 -0700
Subject: [R-sig-Geo] Universal Kriging and raster library
In-Reply-To: <508636C7.4000103@uni-muenster.de>
References: <CANJhsN3zGeH1bLAfuO4nf7LL3khHYhoxBXV4LzTHH3Zgr8t7Cg@mail.gmail.com>
	<508636C7.4000103@uni-muenster.de>
Message-ID: <CANtt_hwkHr0ZgsWq1LLr9cn6WghTTo2R==jZt3=79OtDGuo2kg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121022/ba2429f1/attachment.pl>

From hengl at spatial-analyst.net  Tue Oct 23 10:06:07 2012
From: hengl at spatial-analyst.net (Tomislav Hengl)
Date: Tue, 23 Oct 2012 10:06:07 +0200
Subject: [R-sig-Geo] question about plotKML() - Google Earth
In-Reply-To: <BFCE57D0BE7CBB42A581347DE375AF9A1156A72C@UFEXCH-MBXN02.ad.ufl.edu>
References: <BFCE57D0BE7CBB42A581347DE375AF9A1155E685@UFEXCH-MBXN01.ad.ufl.edu>
	<5073DC92.4000905@spatial-analyst.net>
	<BFCE57D0BE7CBB42A581347DE375AF9A11560B56@UFEXCH-MBXN01.ad.ufl.edu>
	<5077CB7F.3010409@spatial-analyst.net>
	<BFCE57D0BE7CBB42A581347DE375AF9A11560DB1@UFEXCH-MBXN01.ad.ufl.edu>
	<50855C48.9010302@spatial-analyst.net>
	<BFCE57D0BE7CBB42A581347DE375AF9A1156A72C@UFEXCH-MBXN02.ad.ufl.edu>
Message-ID: <50864FEF.5040901@spatial-analyst.net>



On 23/10/2012 03:17, Struve,Juliane wrote:
> Hi,
>
> That solved it thanks a lot. Rounding makes much sense, unless you want to use numbers as labels like I do. "points_names" does what I need.
>
> KMZ=true does not work on my system. Like you said earlier there is no "zip" option. You advised earlier to look at
> Sys.getenv("R_ZIPCMD", "zip"). This yields [1] "zip". What does this tell me ? Can you explain to a lay person how to fix this ?  Sorry, this is outside my R knowledge.
>

R_ZIPCMD is the path to zip program on your OS. For more info see:

http://stat.ethz.ch/R-manual/R-patched/library/base/html/EnvVar.html
http://stat.ethz.ch/R-manual/R-patched/library/utils/html/zip.html

Says here that you need to set the location of your zip program in the 
'etc/Renviron' file.

If you miss a zip on your OS, you could try installing it:

http://gnuwin32.sourceforge.net/packages/zip.htm

I think that if you install Rtools 
[http://cran.r-project.org/bin/windows/Rtools/], you get the zip program 
included (but I am not really sure about this).

HTH,

T. Hengl


> Thanks a lot,
>
> Juliane
>
>
>
> -----Original Message-----
> From: Tomislav Hengl [mailto:hengl at spatial-analyst.net]
> Sent: Monday, October 22, 2012 10:47 AM
> To: Struve,Juliane; r-sig-geo at r-project.org
> Subject: Re: [R-sig-Geo] question about plotKML() - Google Earth
>
>
>
> On 12/10/2012 15:37, Struve,Juliane wrote:
>> Hi,
>>
>> These are the files and the code I used.
>>
>> Thanks for help plotting the data with correct IDs.
>>
>> Juliane
>>
>> filename <- "1647"
>> Data <- read.csv(filename,header=TRUE,sep=",")
>> Data <- na.omit(Data)
>> head(Data)
>> Data$Fish_ID <- as.numeric(Data$Fish_ID)
>> Data$Date <- with(Data, as.POSIXct(paste(as.character(Date), substring(as.character(Time), 12))))
>> library(sp)
>> Data.sp <- SpatialPoints(cbind(Data$Xcoordinate,Data$Ycoordinate))
>> proj4string(Data.sp) = CRS("+proj=longlat +datum=WGS84")
>> Data.spdf <- (SpatialPointsDataFrame(Data.sp, data.frame(Data$Fish_ID)))
>> plot(Data.spdf,pch=16,col="blue")
>> title(filename)
>> library(spacetime)
>> Data.ST <- STIDF(Data.sp, Data$Date, data.frame(Data$Fish_ID))
>> head(Data.ST)
>> library(plotKML)
>> plotKML(Data.ST,colour_scale=rep("#FFFF00", 2),kmz=FALSE)
>>
>
> The rounding of numbers is on purpose. If you send a numeric vector, I
> noticed that I need to round up numbers before writing to KML, otherwise
> the text in the KML does not look nice, e.g. you get the 32-bit computer
> numbers:
>
>   > paste(1/3)
> [1] "0.333333333333333"
>   > paste(signif(1/3, 3))
> [1] "0.333"
>
> Your data set is in fact a BIG data set (although you have only 5
> points!), so I would advise you to start with a subset, then improve. To
> get the point ID's in Google Earth, I would simply use the
> "points_names" argument e.g.:
>
>   > filename <- "1647"
>   > Data <- read.csv(filename,header=TRUE,sep=",")
>   > Data <- na.omit(Data)
>   > Data$ID <- as.factor(Data$ID)
>   > Data$Date <- with(Data, as.POSIXct(paste(as.character(Date),
> substring(as.character(Time), 12))))
>   > library(sp)
>   > coordinates(Data) <- ~ Xcoordinate + Ycoordinate
>   > proj4string(Data) = CRS("+proj=longlat +datum=WGS84")
>   > library(spacetime)
>   > Data.ST <- STIDF(Data, Data$Date, data.frame(Data$ID))
>   > library(plotKML)
>   > Data.ST.10 <- Data.ST[1:10]
>   > plotKML(Data.ST.10, points_names=Data.ST.10$Data.ID,
> colour_scale=rep("#FFFF00", 2))
>
> HTH
>
> T. Hengl
> http://www.wewur.wur.nl/popups/vcard.aspx?id=HENGL001
>
>>
>> -----Original Message-----
>> From: Tomislav Hengl [mailto:hengl at spatial-analyst.net]
>> Sent: Friday, October 12, 2012 3:49 AM
>> To: Struve,Juliane
>> Subject: Re: [R-sig-Geo] question about plotKML() - Google Earth
>>
>>
>> No. Please better use "hengl at spatial-analyst.net" (and please do not
>> send big files etc).
>>
>> I plan to work on plotKML next week Monday/Tuesday.
>>
>> On 11/10/2012 14:23, Struve,Juliane wrote:
>>> Good morning,
>>>
>>> Did you receive the files that I sent to your other address ?
>>>
>>> Thanks and best wishes,
>>>
>>> Juliane
>>>
>>> -----Original Message-----
>>> From: Tomislav Hengl [mailto:hengl at spatial-analyst.net]
>>> Sent: Tuesday, October 09, 2012 4:13 AM
>>> To: Struve,Juliane
>>> Cc: r-sig-geo at r-project.org
>>> Subject: Re: [R-sig-Geo] question about plotKML() - Google Earth
>>>
>>>
>>> On 08/10/2012 22:11, Struve,Juliane wrote:
>>>> Dear list members,
>>>>
>>>> I am using plotKML() to plot some animal tracks on Google Earth. The
>>>> attribute data that I am using are individual IDs, which consist of 4
>>>> figures, e.g. 1145. In the STDIF object that I create these data
>>>> appear correct in the "data" slot. However, in the plot on Google
>>>> Earth the numbers are rounded, 1145 e.g. becomes 1150.
>>>>
>>>> Does anyone know what causes this/how to prevent it ?
>>>>
>>>> Thanks a lot for your time,
>>>>
>>>> Juliane
>>>
>>> I need to see your code and the KML file. Please send it outside the
>>> R-sig-geo and I will try to fix.
>>>
>>> The original function is at:
>>>
>>> https://r-forge.r-project.org/scm/viewvc.php/pkg/R/layer.STTDF.R?view=markup&root=plotkml
>>>
>>> thanks for your e-mail,
>>>
>>> T. Hengl
>>> http://www.wewur.wur.nl/popups/vcard.aspx?id=HENGL001
>>>
>>>>
>>>> [[alternative HTML version deleted]]
>>>>
>>>> _______________________________________________ R-sig-Geo mailing
>>>> list R-sig-Geo at r-project.org
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>


From hengl at spatial-analyst.net  Tue Oct 23 10:45:31 2012
From: hengl at spatial-analyst.net (Tomislav Hengl)
Date: Tue, 23 Oct 2012 10:45:31 +0200
Subject: [R-sig-Geo] plotKML, GSIB on win xp_examples
In-Reply-To: <20121022201320.98580@gmx.net>
References: <20121022201320.98580@gmx.net>
Message-ID: <5086592B.705@spatial-analyst.net>


Axel,

The problem with the predict method was that dismo package did not 
export it properly before. Robert and I have solved this problem a month 
ago (dismo_0.7-23), but you do need to use GSIF package version 0.2-3 
(2012-10-18) to overcome this bug.

Please send me what you get for:

 > packageDescription("GSIF")
Package: GSIF
Type: Package
Title: Global Soil Information Facilities
Version: 0.2-3
Date: 2012-10-18

 > showMethods("predict")
Function: predict (package stats)
object="ANY"
object="Bioclim"
object="CirclesRange"
object="ConvexHull"
object="Domain"
object="GeographicDistance"
object="gstatModel"
object="InvDistWeightModel"
object="list"
object="Mahalanobis"
object="MaxEnt"
object="MaxEntReplicates"
object="Raster"
object="VoronoiHull"


On 22/10/2012 22:13, Axel Hille wrote:
> Dear Tom,
> thanks for your hints. I usually install new packages for R from source
> under my wIN xp: i ALSO DID WITH BOTH THE LATEST PACKAGES OF PLOTkml AND
> gsib: After new install in both examples the error messages remain the
> same, for example
>  > if(file.exists(jar)){
> +    me.eberg <- MaxEnt(occurrences=eberg.ppp, covariates=eberg_grid)
> +    par(mfrow=c(1,2), mar=c(0.5,0.5,0.5,0.5), oma=c(0,0 .... [TRUNCATED]
> Fehler in UseMethod("predict") :
>    nicht anwendbare Methode f?r 'predict' auf Objekt der Klasse
> "c('MaxEnt', 'DistModel')" angewendet
> Zus?tzlich: Warnmeldung:
> In .local(x, p, ...) :
>    1 (0.12%) of the presence points have NA predictor values
> In both cases it complains first, no method available for "predict" of
> class "c('MaxEnt', 'DistModel')"  and additional a warning (0.12%) of
> the presence points have NA predictor values. So i will try it under
> Ubuntu 10.04, maybe there are some peculiar windows problems with
> installation (please see attached).
> Best wishes
> Axel
>>
>> -------- Original-Nachricht --------
>> Datum: Mon, 22 Oct 2012 15:58:13 +0200
>> Von: Tomislav Hengl <hengl at spatial-analyst.net>
>> An: Axel Hille <axel.hille at gmx.net>
>> Betreff: Re: plotKML, GSIB on win xp_examples
>>
>>
>>
>> On 18/10/2012 22:37, Axel Hille wrote:
>> > Dear Tom,
>> > once again, it was a great workshop in Muenster! Learned a lot.
>> > I came back to my project. Want to do species distribution modelling. I
>> > made already a successful trial with SDM and the raster package and
>> > exported the data to GE. But your packages seems much more convenient to
>> > produce KML files. So I first tried your samples on MaxEnt. I installed
>> > the latest plotKML (0.2-5) and GSIB.
>> > But in both examples got the same error message, some percentage of NA
>> > values (see below). Is Should I exlude the NA values. Or should the area
>> > be defined also? Just wanted to know if you yourself tested those models
>> > or maybe it is also a problem concerning my installation?
>> > I used R-2.15.1 on Win XP.
>> > I hope to hear from you.
>> > Many thanks and best wishes
>> > Axel
>> >
>>
>> Sorry for some delay... been traveling around :)
>>
>> >
>> >
>> > setwd("~")
>> > getwd()
>> > library(plotKML)
>> > ?plotKML
>> > ## -------------- SpatialMaxEntOutput --------- ##
>> > data(bigfoot)
>> > aea.prj <- "+proj=aea +lat_1=29.5 +lat_2=45.5 +lat_0=23 +lon_0=-96
>> > +x_0=0 +y_0=0 +ellps=GRS80 +datum=NAD83 +units=m +no_defs"
>> > coordinates(bigfoot) <- ~Lon+Lat
>> > proj4string(bigfoot) <- CRS("+proj=latlon +datum=WGS84")
>> > str(bigfoot)
>> > bigfoot.aea <- spTransform(bigfoot, CRS(aea.prj))
>> > str(bigfoot.aea)
>> > library(spatstat)
>> > #?spatstat::as.ppp
>> > #xy <- matrix(runif(40), ncol=2)
>> > #pp <- as.ppp(xy, c(0,1,0,1))
>> > #pp
>> > plot(bigfoot)
>> > bigfoot.aea <- as.ppp(bigfoot.aea)
>> > str(bigfoot.aea)
>> > # Load the covariates:
>> > data(USAWgrids)
>> > gridded(USAWgrids) <- ~s1+s2
>> > proj4string(USAWgrids) <- CRS(aea.prj)
>> > sel.grids <- c("globedem","nlights03","sdroads","gcarb","twi","globcov")
>> > str(sel.grids)
>> > str(USAWgrids[sel.grids])
>> > # run MaxEnt analysis (evaluates sampling bias or mis-representation):
>> > library(dismo)
>> > library(rJava)
>> > jar <- paste(system.file(package="dismo"), "/java/maxent.jar", sep='')
>> > library(GSIF)
>> > #?GSIF::MaxEnt
>> > bigfoot.smo <- MaxEnt(bigfoot.aea, USAWgrids[sel.grids])
>> > #Fehler in UseMethod("predict") :
>> > # nicht anwendbare Methode f?r 'predict' auf Objekt der Klasse
>> > "c('MaxEnt', 'DistModel')" angewendet
>> > #zus?tzlich: Warnmeldung:
>> > #In .local(x, p, ...) :
>> > # 55 (7.21%) of the presence points have NA predictor values
>> > #
>>
>> You need to install the most recent version of GSIF:
>>
>> > download.file("http://gsif.r-forge.r-project.org/GSIF_0.2-3.tar.gz",
>> "GSIF_0.2-3.tar.gz")
>> > system("R CMD INSTALL GSIF_0.2-3.tar.gz")
>>
>> you should then get:
>>
>> > library(GSIF)
>> ...
>> GSIF version 0.2-3 (2012-10-18)
>> URL: http://gsif.r-forge.r-project.org/
>>
>> The code to test if the MaxEnt function works is at:
>>
>> http://gsif.r-forge.r-project.org/MaxEnt-method.html
>>
>> I'm very sorry you have to install GSIF from source code. There seems to
>> be that there is some problem with the R-forge package survival
>> [http://r-forge.r-project.org/R/?group_id=1125&log=build_win64&pkg=GSIF&flavor=patched],
>>
>> which is beyond me.
>>
>> all the best with your work!
>>
>> > icon = "http://plotkml.r-forge.r-project.org/bigfoot.png"
>> > plotKML(bigfoot.smo, colour_scale = R_pal[["bpy_colors"]], shape =
>> > icon)
>> >
>> >
>> >
>> > ## Not run: # load data:
>> > library(plotKML)
>> > data(eberg)
>> > data(eberg_grid)
>> > # prepare data for spatial analysis:
>> > eberg.xy <- eberg[runif(nrow(eberg)) < .3,]
>> > str(eberg.xy)
>> > coordinates(eberg.xy) <- ~X+Y
>> > proj4string(eberg.xy) <- CRS("+init=epsg:31467")
>> > # format gridded data:
>> > gridded(eberg_grid) <- ~x+y
>> > proj4string(eberg_grid) <- CRS("+init=epsg:31467")
>> > # convert to a "ppp" object:
>> > library(spatstat)
>> > eberg.ppp <- as.ppp(eberg.xy)
>> > eberg.ppp
>> > library(dismo)
>> > # run MaxEnt analysis (evaluates sampling bias or mis-representation):
>> > jar <- paste(system.file(package="dismo"), "/java/maxent.jar", sep='')
>> > if(file.exists(jar)){
>> > me.eberg <- MaxEnt(occurrences=eberg.ppp, covariates=eberg_grid)
>> > ## NOTE: MaxEnt can be time-consuming!
>> > # plot the results:
>> > par(mfrow=c(1,2), mar=c(0.5,0.5,0.5,0.5), oma=c(0,0,0,0))
>> > image(as(me.eberg at predicted, "SpatialPixelsDataFrame"),
>> > col=rev(heat.colors(25)), xlab="", ylab="")
>> > points(me.eberg at occurrences, pch="+", cex=.7)
>> > image(me.eberg at sp.domain, col="grey", xlab="", ylab="")
>> > }
>> > #Fehler in UseMethod("predict") :
>> > # nicht anwendbare Methode f?r 'predict' auf Objekt der Klasse
>> > "c('MaxEnt', 'DistModel')" angewendet
>> > #Zus?tzlich: Warnmeldungen:
>> > #1: some mark values are NA in the point pattern x
>> > #2: In .local(x, p, ...) :
>> > # 1 (0.13%) of the presence points have NA predictor values
>> >
>> >
>> >> -------- Original-Nachricht --------
>> >> Datum: Tue, 28 Aug 2012 10:41:26 +0200
>> >> Von: Tomislav Hengl <hengl at spatial-analyst.net>
>> >> An: Axel Hille <axel.hille at gmx.net>
>> >> Betreff: Re: plotKML, GSIB on win xp
>> >>
>> >>
>> >> Axel,
>> >>
>> >> First thing you have to use the R 2.15.1, because the package has been
>> >> compiled on that version of R.
>> >>
>> >> Second, try downloading the most recent version of the GSIF package:
>> >>
>> >> http://gsif.r-forge.r-project.org/
>> >>
>> >> When you install GSIF successfully, then check that you have the most
>> >> recent version:
>> >>
>> >> > packageDescription("GSIF")
>> >> Package: GSIF
>> >> Type: Package
>> >> Title: Global Soil Information Facilities
>> >> Version: 0.2-2
>> >> Date: 2012-08-24
>> >> Author: Tomislav Hengl <tom.hengl at wur.nl>, Contributions by:
>> >> Bas Kempen <bas.kempen at wur.nl>, Dylan Beaudette
>> >> <debeaudette at ucdavis.edu>, Gerard B.M. Heuvelink
>> >> <gerard.heuvelink at wur.nl>, Reuter I. Hannes
>> >> <hannes.reuter at wur.nl>, Brendan Malone
>> >> <brendan.malone at sydney.edu.au>, Pierre Roudier
>> >> <roudierp at landcareresearch.co.nz>
>> >> Maintainer: Tomislav Hengl <tom.hengl at wur.nl>
>> >> Description: Global Soil Information Facilities - tools
>> >> (standards and functions) and sample datasets for
>> >> global soil mapping.
>> >> License: GPL
>> >> URL: http://gsif.r-forge.r-project.org/
>> >> LazyLoad: yes
>> >> Depends: R (>= 2.12.0), methods, stringr, XML, RCurl, sp,
>> >> maptools, rgdal, raster, plotKML, aqp, dismo
>> >> Suggests: soiltexture, RSAGA, splines, gstat, boot, mda,
>> >> psych, fossil, nnet, SDMTools, rJava (>= 0.5-0)
>> >> Repository: R-Forge
>> >> Repository/R-Forge/Project: gsif
>> >> Repository/R-Forge/Revision: 51
>> >> Packaged: 2012-08-24 18:19:34 UTC; rforge
>> >> Built: R 2.15.1; ; 2012-08-24 17:45:28 UTC; windows
>> >>
>> >>
>> >> There were some issues with the 32-bit and 64-bit OS that I am still
>> >> trying to resolve.
>> >>
>> >> Officially, you should be able to install GSIF from R-forge and plotKML
>> >> from CRAN:
>> >>
>> >> > install.packages("plotKML")
>> >> > install.packages("GSIF", repos="http://R-Forge.R-project.org")
>> >>
>> >> see you next week,
>> >>
>> >> T. Hengl
>> >>
>> >>
>> >>
>> >> On 27/08/2012 21:28, Axel Hille wrote:
>> >> > Dear Tom,
>> >> > I tried to check-install plotKML and depending GSIB under Windows
>> XP and
>> >> > R.2.15.0.
>> >> > I checked the sources (plotKML_0.2-4.tar.gz, GSIF_0.2-2.tar.gz, ) and
>> >> > sucessfully installed plotKML (and almost started the examples).
>> But the
>> >> > check of GSIB failed, some class dependencies etc. I attach the log
>> >> > files (in German, I hope you can understand it).
>> >> > Can I also plot automap SpatialGrids with plotKML instead of GSIB
>> >> output?
>> >> > See you in Munster, best wishes
>> >> > Axel Hille
>> >> >
>> >> >
>> >> >
>> >> > --
>> >> > Dr. rer. nat. Axel Hille
>> >> > Diplom-Biologe
>> >> >
>> >
>> >
>> >
>> > --
>> > Dr. rer. nat. Axel Hille
>> > Diplom-Biologe
>> >
>
>
>
> --
> Dr. rer. nat. Axel Hille
> Diplom-Biologe
>


From mintibezabih at gmail.com  Tue Oct 23 12:03:10 2012
From: mintibezabih at gmail.com (alemante zd)
Date: Tue, 23 Oct 2012 11:03:10 +0100
Subject: [R-sig-Geo] converting UTM to decimal (latitude and longitude)
In-Reply-To: <CANtt_hyez70B43_-0aXu4odUYWZJVYwYLvT9XARY9GCR0avMkA@mail.gmail.com>
References: <CAJfxP+pc4D+BQNX+o3mCzzB7poeB9zbW4f5haVk4mrVdphwSTQ@mail.gmail.com>
	<BFCE57D0BE7CBB42A581347DE375AF9A1156A6F9@UFEXCH-MBXN02.ad.ufl.edu>
	<CANtt_hyez70B43_-0aXu4odUYWZJVYwYLvT9XARY9GCR0avMkA@mail.gmail.com>
Message-ID: <CAJfxP+qpuCOf67RxiA0ysh7FYc4qqkHX2NJhSztvM79aShfKuQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121023/c0f5cb35/attachment.pl>

From rjadenham at gmail.com  Tue Oct 23 13:02:24 2012
From: rjadenham at gmail.com (robert denham)
Date: Tue, 23 Oct 2012 21:02:24 +1000
Subject: [R-sig-Geo] converting UTM to decimal (latitude and longitude)
In-Reply-To: <CAJfxP+qpuCOf67RxiA0ysh7FYc4qqkHX2NJhSztvM79aShfKuQ@mail.gmail.com>
References: <CAJfxP+pc4D+BQNX+o3mCzzB7poeB9zbW4f5haVk4mrVdphwSTQ@mail.gmail.com>
	<BFCE57D0BE7CBB42A581347DE375AF9A1156A6F9@UFEXCH-MBXN02.ad.ufl.edu>
	<CANtt_hyez70B43_-0aXu4odUYWZJVYwYLvT9XARY9GCR0avMkA@mail.gmail.com>
	<CAJfxP+qpuCOf67RxiA0ysh7FYc4qqkHX2NJhSztvM79aShfKuQ@mail.gmail.com>
Message-ID: <CAHMvJdQTLKqc_oL-Ky4u2CTr_tPHqYA=A_9y3pkzJTgN4uj+Kg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121023/1560b827/attachment.pl>

From mintibezabih at gmail.com  Tue Oct 23 13:15:47 2012
From: mintibezabih at gmail.com (alemante zd)
Date: Tue, 23 Oct 2012 12:15:47 +0100
Subject: [R-sig-Geo] converting UTM to decimal (latitude and longitude)
In-Reply-To: <CAJfxP+ouYzE+364PdweCyZHMcnA3Go3QX0UsQgEhYm27gj7Vmg@mail.gmail.com>
References: <CAJfxP+pc4D+BQNX+o3mCzzB7poeB9zbW4f5haVk4mrVdphwSTQ@mail.gmail.com>
	<BFCE57D0BE7CBB42A581347DE375AF9A1156A6F9@UFEXCH-MBXN02.ad.ufl.edu>
	<CANtt_hyez70B43_-0aXu4odUYWZJVYwYLvT9XARY9GCR0avMkA@mail.gmail.com>
	<CAJfxP+qpuCOf67RxiA0ysh7FYc4qqkHX2NJhSztvM79aShfKuQ@mail.gmail.com>
	<CAHMvJdQTLKqc_oL-Ky4u2CTr_tPHqYA=A_9y3pkzJTgN4uj+Kg@mail.gmail.com>
	<CAJfxP+ouYzE+364PdweCyZHMcnA3Go3QX0UsQgEhYm27gj7Vmg@mail.gmail.com>
Message-ID: <CAJfxP+qsPYMzv5XyYGP==Xay25=b3jauLyB_M63p03W0X1FdyQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121023/874752af/attachment.pl>

From pingyang.whu at gmail.com  Tue Oct 23 16:22:08 2012
From: pingyang.whu at gmail.com (ping yang)
Date: Tue, 23 Oct 2012 10:22:08 -0400
Subject: [R-sig-Geo] "regridding" netCDF?
In-Reply-To: <CANtt_hx+xBJQCQhxww0BBKyrDGikidAcA3OiaUZPaijQ41brAw@mail.gmail.com>
References: <87mx3ew372.fsf@pobox.com>
	<CAK8gSG-7VFTN9zQTjU+cWGKti0-HMyFmYLwssS1q7i=aaxvWOw@mail.gmail.com>
	<CANtt_hx+xBJQCQhxww0BBKyrDGikidAcA3OiaUZPaijQ41brAw@mail.gmail.com>
Message-ID: <CAK8gSG-UfgRBTb2NFQB_mSr-Ftr=s+KTESHjXPMswDggmHhbCQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121023/4d0d98da/attachment.pl>

From mintibezabih at gmail.com  Tue Oct 23 16:53:54 2012
From: mintibezabih at gmail.com (alemante zd)
Date: Tue, 23 Oct 2012 15:53:54 +0100
Subject: [R-sig-Geo] identifying empty and non empty grids after
	interpolation
Message-ID: <CAJfxP+rQU=YJatZ9ckNfMcJFWFq+_iHx8732rJ7W51tnrQVHmQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121023/85851463/attachment.pl>

From tyler.j.frazier at tu-berlin.de  Tue Oct 23 20:29:28 2012
From: tyler.j.frazier at tu-berlin.de (Frazier, Tyler James)
Date: Tue, 23 Oct 2012 18:29:28 +0000
Subject: [R-sig-Geo] [Qgis-user] spatial join, many to 1
In-Reply-To: <508635DC.70602@uni-muenster.de>
References: <1350778252.77636.YahooMailClassic@web122001.mail.ne1.yahoo.com>
	<9659839B4C1FD4498B496BCEFF047B6F86780D00@EX-MB1.tubit.win.tu-berlin.de>
	<5084551C.4090005@uni-muenster.de>
	<1e5cda3895204a7faf037f8cf4dc80d7@EX-1-HT0.lancs.local>
	<CANVKczNNDq+5iniQ5EX8M=aOLsJ_fHudzke1+MFpdBtCX6qmwQ@mail.gmail.com>
	<9659839B4C1FD4498B496BCEFF047B6F86782673@EX-MB1.tubit.win.tu-berlin.de>
	<508635DC.70602@uni-muenster.de>
Message-ID: <9659839B4C1FD4498B496BCEFF047B6F8678451D@EX-MB1.tubit.win.tu-berlin.de>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121023/3e7ae252/attachment.pl>

From edzer.pebesma at uni-muenster.de  Tue Oct 23 21:11:54 2012
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Tue, 23 Oct 2012 21:11:54 +0200
Subject: [R-sig-Geo] [Qgis-user] spatial join, many to 1
In-Reply-To: <9659839B4C1FD4498B496BCEFF047B6F8678451D@EX-MB1.tubit.win.tu-berlin.de>
References: <1350778252.77636.YahooMailClassic@web122001.mail.ne1.yahoo.com>
	<9659839B4C1FD4498B496BCEFF047B6F86780D00@EX-MB1.tubit.win.tu-berlin.de>
	<5084551C.4090005@uni-muenster.de>
	<1e5cda3895204a7faf037f8cf4dc80d7@EX-1-HT0.lancs.local>
	<CANVKczNNDq+5iniQ5EX8M=aOLsJ_fHudzke1+MFpdBtCX6qmwQ@mail.gmail.com>
	<9659839B4C1FD4498B496BCEFF047B6F86782673@EX-MB1.tubit.win.tu-berlin.de>
	<508635DC.70602@uni-muenster.de>
	<9659839B4C1FD4498B496BCEFF047B6F8678451D@EX-MB1.tubit.win.tu-berlin.de>
Message-ID: <5086EBFA.6000905@uni-muenster.de>

As Barry tried to point out, you cannot do this.

Each area in a SpatialPolygonsDataFrame has attributes that are in a
simple table, with the number of records equal to the the number of
areas. Records are rows in a data.frame, meaning that individual fields
cannot contain (varying length) vectors, as you seem to want.

I believe the information you have is complete, you now either continue
living with these two objects, or you write your own class to merge them
into one (which is fairly trivial, btw).

On 10/23/2012 08:29 PM, Frazier, Tyler James wrote:
> Hi Edzer, Barry and list,
> 
> I made some progress on this today, when I set readOGR() to stringsAsFactors=FALSE as so
> 
> ea_map <- readOGR(".","ea_r1", stringsAsFactors=FALSE)
> towns <- readOGR(".","towns_r1", stringsAsFactors=FALSE)
> 
> and then execute over() as so
> 
> spatial_join <- over(ea_map, towns,returnList=TRUE)
> 
> I get the following results ...
> 
>> str(spatial_join)
> List of 1251
>  $ :'data.frame': 3 obs. of  3 variables:
>   ..$ NAME  : chr [1:3] "ABINAKROM" "WOSSU MANU WADRAGO" "AMOATENGKROM"
>   ..$ EA_NOS: chr [1:3] "956" "956" "956"
>   ..$ REG   : chr [1:3] "01" "01" "01"
>  $ :'data.frame': 2 obs. of  3 variables:
>   ..$ NAME  : chr [1:2] "ABOTAREYE" "KWARFO"
>   ..$ EA_NOS: chr [1:2] "827" "827"
>   ..$ REG   : chr [1:2] "01" "01"
>  $ :'data.frame': 1 obs. of  3 variables:
>   ..$ NAME  : chr "JINIJINI KOFIKROM (NYAMEBEKYERE NO.1"
>   ..$ EA_NOS: chr "826"
>   ..$ REG   : chr "01"
> 
>> head(spatial_join)
> [[1]]
>                    NAME EA_NOS REG
> 1680          ABINAKROM    956  01
> 1681 WOSSU MANU WADRAGO    956  01
> 1682       AMOATENGKROM    956  01
> 
> [[2]]
>           NAME EA_NOS REG
> 1644 ABOTAREYE    827  01
> 1645    KWARFO    827  01
> 
> [[3]]
>                                      NAME EA_NOS REG
> 1967 JINIJINI KOFIKROM (NYAMEBEKYERE NO.1    826  01
> 
> [[4]]
>               NAME EA_NOS REG
> 1657      MANGOASE    817  01
> 1660    KOO BANIER    817  01
> 1661 TEMA OKRAKROM    817  01
> 
> [[5]]
>             NAME EA_NOS REG
> 1691 KWASAREKROM    823  01
> 
> [[6]]
>                    NAME EA_NOS REG
> 1966 KWABENA NKETEAKROM    824  01
> 
> which appears to be correct.  BUT, when I attempt to rejoin with the original ea_map, I get an error
> 
> map <- SpatialPolygonsDataFrame(ea_map,spatial_join)
> 
>> map <- SpatialPolygonsDataFrame(ea_map,spatial_join)
> Error in SpatialPolygonsDataFrame(ea_map, spatial_join) :
>   row.names of data and Polygons IDs do not match
> 
> changing stringsAsFactors=FALSE in the readOGR permitted the fields to receive the names of each town, but how to join back to the original ea_map? maybe I am using the wrong command or need to add an index first?
> 
> I could export a truncated dataset if that would be helpful.
> 
> At the moment, I'm not interested in the population data.  I want to join the names of all towns and villages to the enumeration areas in order to spatially disaggregate as locally as possible.  The reason is because names of localities have often been recorded in different local dialects or languages (imagine something like the name for the city Berlin also appearing as Bearlin, B?rlin, Berlim, Buhrlin etc...if I have all the names from the two sides of the join, I have a better chance to determine which combinations are correct or eliminate incorrect ones).
> 
> Thanks!
> Ty
> 
> 
> On Oct 23, 2012, at 8:14 AM, Edzer Pebesma wrote:
> 
> 
> 
> On 10/22/2012 10:54 PM, Frazier, Tyler James wrote:
> Hi Barry,
> 
> Really what I am trying to do is link raw census DATA to an enumeration area MAP, which spatially represents different aggregations of those observations.  In order to do so, on the MAP side, I first want to join a point shape file which has all of the town names to an enumeration area shape file, which is missing those names.
> 
> Previously, when I did this on the DATA side I used the following command ---
> 
> enum_areas <- aggregate(localities_region1,by=list(localities_region1$ea_code), FUN=unique)
> 
> and when an enumeration area had more then one town located within it, R created a field within a row as follows ---
> 
> c("NEW-TOWN WHARF", "BALIBANGARA", "BOLENWO").
> 
> I don't think R can hold such a structure in a data.frame. Of course,
> with lists it can do any nesting, but they are not tables.
> 
> 
> On the MAP side, it appears when I use the over() command, like so ---
> 
> spatial_join <- over(ea_map, towns)
> 
> over() supplies only the name of the first town listed within that enumeration area and ignores/omits the remainder.  If over() created all of the names in a similar manner as aggregate(), couldn't I then use
> 
> As I mentioned before, when you supply over with the returnList = TRUE
> argument, it will return all matches, just not in a table (as a table is
> not very useful in this case).
> 
> 
> map <- SpatialPolygonsDataFrame(ea_map,spatial_join)
> 
> in order to create my map?  What do you think?
> 
> Which property of towns do you want in ea_map? If, for instance, you
> want the population of towns in ea_map, you could do (untested, we don't
> have your data):
> 
> pop = aggregate(towns["population"], ea_map, sum)
> 
> 
> I suppose it would be possible to achieve the same using postGIS and some commands there, but would rather take a route within R.  I haven't thought about how to use tapply() yet.
> 
> Showing us the PostGIS route might help us (and maybe yourself)
> understand what you want.
> 
> 
> Thanks!
> Ty
> 
> 
> On Oct 22, 2012, at 10:02 PM, Barry Rowlingson wrote:
> 
> On Mon, Oct 22, 2012 at 7:52 PM, Frazier, Tyler James
> <tyler.j.frazier at tu-berlin.de<mailto:tyler.j.frazier at tu-berlin.de><mailto:tyler.j.frazier at tu-berlin.de>> wrote:
> Hi Edzer and list,
> 
> Thanks for the package, the command over() essentially achieves my intended result, which is to overlay a set of (2500) points onto a set of (1000) polygons where each polygon receives all of the attribute data from each of the points located within its boundary.
> 
> Each polygon can't [easily] 'receive' the attributes from a differing
> number of points. The SpatialPolygonsDataFrame has one polygonal
> feature related to one row in the data frame. You could have one
> polygonal feature for each point, but that would end up as a massive
> duplication of the polygonal data.
> 
> It would seem to be better to create a new *point* data set, where
> each row of the point data frame is augmented with the information
> from the polygon in which it resides. This gives you something like an
> ID variable that relates the points to the polygons in the manner of a
> database id field.
> 
> Overall, it really depends on what you want to do. If you want to
> draw maps of polygons based on some aggregate function of the points
> within, then that's a question of doing something like a 'tapply' on
> the points using the polygons each point is in as a factor.
> 
> Barry
> 
> 
> -----
> Tyler Frazier
> Department of Transportation Planning and Telematics
> Technical University Berlin
> http://www.vsp.tu-berlin.de/
> 
> 
> 
> 
> 
> 	[[alternative HTML version deleted]]
> 
> 
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From aortizbobea at arec.umd.edu  Tue Oct 23 21:17:29 2012
From: aortizbobea at arec.umd.edu (Ariel Ortiz-Bobea)
Date: Tue, 23 Oct 2012 12:17:29 -0700 (PDT)
Subject: [R-sig-Geo] dates with brick and multilayer netcdf file are off
In-Reply-To: <CANtt_hwYcxOLHg3MG5EpbYwDX2dfYynMrT5S6aTXsePx3O8bVQ@mail.gmail.com>
References: <1350584043220-7581332.post@n2.nabble.com>
	<CANtt_hwYcxOLHg3MG5EpbYwDX2dfYynMrT5S6aTXsePx3O8bVQ@mail.gmail.com>
Message-ID: <A9AA9EB58C24EE46A649D2690C131D4F0341F0@Exch12.arec.umd.edu>

Great, good to know!
Thanks,
Ariel

---
Ariel Ortiz-Bobea
PhD Candidate, Agricultural & Resource Economics
University of Maryland - College Park
________________________________________
From: Robert Hijmans [via R-sig-geo] [ml-node+s2731867n7581343h59 at n2.nabble.com]
Sent: Monday, October 22, 2012 2:35 AM
To: Ariel Ortiz Bobea
Subject: Re: dates with brick and multilayer netcdf file are off

Ariel,

I added support for the 360 days calendar a while ago --- for processing
IPCC CMIP5 files like you do (but I think it is not on CRAN yet). Below is
what I get with the development version (on R-Forge); and that seems to be
correct. Unfortunately install from R-Forge currently does not work. I
expect this to be on CRAN in a week or two.

Robert

> r <- brick("tasmin_day_HadGEM2-ES_rcp85_r1i1p1_20991201-20991230.nc")
> r
class       : RasterBrick
dimensions  : 145, 192, 27840, 30  (nrow, ncol, ncell, nlayers)
resolution  : 1.875, 1.25  (x, y)
extent      : -0.9375, 359.0625, -90.625, 90.625  (xmin, xmax, ymin, ymax)
coord. ref. : +proj=longlat +datum=WGS84
data source :
e:\tmp\tasmin_day_HadGEM2-ES_rcp85_r1i1p1_20991201-20991230.nc
names       : X2099.12.01, X2099.12.02, X2099.12.03, X2099.12.04,
X2099.12.05, X2099.12.06, X2099.12.07, X2099.12.08, X2099.12.09,
X2099.12.10, X2099.12.11, X2099.12.12, X2099.12.13, X2099.12.14,
X2099.12.15, ...
Date        : 2099-12-01, 2099-12-30 (min, max)
varname     : tasmin

>


On Thu, Oct 18, 2012 at 11:14 AM, Ariel Ortiz-Bobea <
[hidden email]</user/SendEmail.jtp?type=node&node=7581343&i=0>> wrote:

> Hello,
>
> I'm having a problem when trying to import a multi-layer netcdf file using
> brick() in the raster package. The dates in the raster/brick object are off
> by a lot and after importing the file I get the warning message:
>
>     In .doTime(r, nc, zvar, dim3) : assuming a standard calender
>
> The netcdf files corresponds to the output of a climate model with years of
> 360 days so perhaps this has to do with the problem. I suppose the .doTime
> function is having a hard time extracting this date format.
>
> I selected a small file of 30 days (3.4MB) that you can download to
> reproduce the problem:
>
> https://dl.dropbox.com/u/45311184/tasmin_day_HadGEM2-ES_rcp85_r1i1p1_20991201-20991230.nc
>
> That file contains data for time periods 2099/12/01-2099/12/30. When
> imported, the reported range of dates is 2096/06/20-2096/07/19. So it's 30
> time periods, but the wrong ones.
>
> I could manually set the time periods given that I know the boundary dates
> and the time step, but I rather have a more elegant solution.
>
> Any help would be great.
>
> Thanks,
>
> Ariel
>
>
> # Reproducible code: #-----------------
>
> # load package
>    library(raster)
>
> # Working directory where you placed the nc file
>    setwd("/Users/Ariel/Downloads")
>
> # Load file
>    r <- brick("tasmin_day_HadGEM2-ES_rcp85_r1i1p1_20991201-20991230.nc",
> varname="tasmin")
>    # here I get the following warning:
>    # Warning message:
>    # In .doTime(r, nc, zvar, dim3) : assuming a standard calender
>
> # See layer names
>    r at layernames # does not match the 2099/12/01-2099/12/30 time period,
> dates are off ~ 2.5 years
>
>
>
>
> -----
> Ariel Ortiz-Bobea
> PhD Candidate in Agricultural & Resource Economics
> University of Maryland - College Park
> --
> View this message in context:
> http://r-sig-geo.2731867.n2.nabble.com/dates-with-brick-and-multilayer-netcdf-file-are-off-tp7581332.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
>
> _______________________________________________
> R-sig-Geo mailing list
> [hidden email]</user/SendEmail.jtp?type=node&node=7581343&i=1>
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

        [[alternative HTML version deleted]]

_______________________________________________
R-sig-Geo mailing list
[hidden email]</user/SendEmail.jtp?type=node&node=7581343&i=2>
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


________________________________
If you reply to this email, your message will be added to the discussion below:
http://r-sig-geo.2731867.n2.nabble.com/dates-with-brick-and-multilayer-netcdf-file-are-off-tp7581332p7581343.html
To unsubscribe from dates with brick and multilayer netcdf file are off, click here<http://r-sig-geo.2731867.n2.nabble.com/template/NamlServlet.jtp?macro=unsubscribe_by_code&node=7581332&code=YW9ydGl6Ym9iZWFAYXJlYy51bWQuZWR1fDc1ODEzMzJ8LTYxMzExNzA2NQ==>.
NAML<http://r-sig-geo.2731867.n2.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&id=instant_html%21nabble%3Aemail.naml&base=nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.NodeNamespace&breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml>




-----
Ariel Ortiz-Bobea
PhD Candidate in Agricultural & Resource Economics
University of Maryland - College Park
--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/dates-with-brick-and-multilayer-netcdf-file-are-off-tp7581332p7581370.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From e.jahanshiri at gmail.com  Wed Oct 24 05:39:10 2012
From: e.jahanshiri at gmail.com (Ebrahim Jahanshiri)
Date: Wed, 24 Oct 2012 11:39:10 +0800
Subject: [R-sig-Geo] Interactive (click-able) map within R
Message-ID: <CANCB45shYD8=iwZRkEksOmbTETbGDYmokziuJ9DnupJyH+Ys=A@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121024/ed7f6e44/attachment.pl>

From r.hijmans at gmail.com  Wed Oct 24 06:13:34 2012
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Tue, 23 Oct 2012 21:13:34 -0700
Subject: [R-sig-Geo] Interactive (click-able) map within R
In-Reply-To: <CANCB45shYD8=iwZRkEksOmbTETbGDYmokziuJ9DnupJyH+Ys=A@mail.gmail.com>
References: <CANCB45shYD8=iwZRkEksOmbTETbGDYmokziuJ9DnupJyH+Ys=A@mail.gmail.com>
Message-ID: <CANtt_hwJNXChO-RgZcX26VgFcpOynxz38d+Q9cA5ZQqx+qe+1A@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121023/8ca14adc/attachment.pl>

From r.hijmans at gmail.com  Wed Oct 24 06:17:24 2012
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Tue, 23 Oct 2012 21:17:24 -0700
Subject: [R-sig-Geo] "regridding" netCDF?
In-Reply-To: <CAK8gSG-UfgRBTb2NFQB_mSr-Ftr=s+KTESHjXPMswDggmHhbCQ@mail.gmail.com>
References: <87mx3ew372.fsf@pobox.com>
	<CAK8gSG-7VFTN9zQTjU+cWGKti0-HMyFmYLwssS1q7i=aaxvWOw@mail.gmail.com>
	<CANtt_hx+xBJQCQhxww0BBKyrDGikidAcA3OiaUZPaijQ41brAw@mail.gmail.com>
	<CAK8gSG-UfgRBTb2NFQB_mSr-Ftr=s+KTESHjXPMswDggmHhbCQ@mail.gmail.com>
Message-ID: <CANtt_hzf4xUPv1QXVhOhmdJj+LLKzxt7SfLqcDczGUPxVYZveg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121023/9082b8c8/attachment.pl>

From r.hijmans at gmail.com  Wed Oct 24 06:20:42 2012
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Tue, 23 Oct 2012 21:20:42 -0700
Subject: [R-sig-Geo] how to plot Raster*? problems with raster::plot,
	fields::image.plot
In-Reply-To: <87txtl7s8k.fsf@pobox.com>
References: <87txtl7s8k.fsf@pobox.com>
Message-ID: <CANtt_hx1dB+iJ7KjDtESMMNAR_EeLzBPuQar26NNjmTTLx6ROQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121023/84288ba6/attachment.pl>

From florian.lengyel at gmail.com  Wed Oct 24 06:24:36 2012
From: florian.lengyel at gmail.com (Florian Lengyel)
Date: Wed, 24 Oct 2012 00:24:36 -0400
Subject: [R-sig-Geo] Interactive (click-able) map within R
In-Reply-To: <CANCB45shYD8=iwZRkEksOmbTETbGDYmokziuJ9DnupJyH+Ys=A@mail.gmail.com>
References: <CANCB45shYD8=iwZRkEksOmbTETbGDYmokziuJ9DnupJyH+Ys=A@mail.gmail.com>
Message-ID: <CALH4PEJ6ru2n3sssHFxyQWFt3n7ROnLQOpfvpnsDonKYf0rpGQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121024/89d25a9e/attachment.pl>

From HodgessE at uhd.edu  Wed Oct 24 06:56:19 2012
From: HodgessE at uhd.edu (Hodgess, Erin)
Date: Wed, 24 Oct 2012 04:56:19 +0000
Subject: [R-sig-Geo] Interactive (click-able) map within R
In-Reply-To: <CALH4PEJ6ru2n3sssHFxyQWFt3n7ROnLQOpfvpnsDonKYf0rpGQ@mail.gmail.com>
References: <CANCB45shYD8=iwZRkEksOmbTETbGDYmokziuJ9DnupJyH+Ys=A@mail.gmail.com>,
	<CALH4PEJ6ru2n3sssHFxyQWFt3n7ROnLQOpfvpnsDonKYf0rpGQ@mail.gmail.com>
Message-ID: <FF9DB805FC41CC4E95825A50F680630201BC33@columbia.uhd.campus>

Hello:

I just started working on this yesterday (literally!) via FastRWeb.  Simon Urbanek gave me some suggestions to use which involve HTML, callbacks, etc.  I know I little about HTML but not about javascript.

However, I'm trying to put some sense to things.

Thanks,
Erin

________________________________________
From: r-sig-geo-bounces at r-project.org [r-sig-geo-bounces at r-project.org] on behalf of Florian Lengyel [florian.lengyel at gmail.com]
Sent: Tuesday, October 23, 2012 11:24 PM
To: Ebrahim Jahanshiri
Cc: r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] Interactive (click-able) map within R

I'm going to venture a suggestion--I'm interpreting your question to
mean that you would like web-enabled maps, and not a desktop application.
If you meant a desktop application, then I'm responding the question
I would have liked someone else to ask (and that I would like someone
else to solve--so I might as well attempt to work on it.)

Perhaps OpenCPU (http://opencpu.org)  would be suitable as a
web platform,  in conjunction with a javascript library such as Leaflet.
Integrating the two would involve using the REST service supplied
by OpenCPU, possibly modifying it to return GeoJSON. It might have to
be combined with a javascript library such as jQuery (for additional
controls,
and URI calls).

It's possible you could use CartoDB for map layers, in conjunction with
leaflet,
and use OpenCPU as the REST service to provide access to the multiple
regressions. This could mean duplicating your data: it is possible that
the same layers you maintain in CartoDB would have to be accessible to R
otherwise.
However, if you want your own installation of CartoDB instead of the
commercial
service, this is what you're up against:

https://plus.google.com/u/0/111972627358501525662/posts/Z6kNdt5QV93

Perhaps someone will set me straight and convince me these are terrible
ideas,
if they even rise to that level.

FL

On Tue, Oct 23, 2012 at 11:39 PM, Ebrahim Jahanshiri <e.jahanshiri at gmail.com
> wrote:

> Dear all,
>
> I am trying to create a map that is click-able i.e. like most GIS platforms
> that let the user click on the points or entities and for example see their
> attributes. I want to do this within R since I need R to do the analysis
> (multiple regression) and show the results of regression along with other
> attributes for each entity on a base map by a click of user on a map
> overlay (simple GIS work).
>
> I can not use anything based on Google maps (like GoogleVis and KML
> exportation and so on) since my data is using different projection and
> transforming them into WGS84 creates overlay miss-positions on Google
> Earth/Maps. So I need to first load up my area polygon and then overlay the
> points on top of them and as I mentioned I need it to be click-able.
>
> So far I couldn't find a way to do this totally within R. I am aware that
> by linking R to other GIS software (like GRASS GIS for example) it is
> possible to do this but my priority is R since it will be easier for me to
> work with and also I have no experience with GRASS or other open-source
> software. Moreover it will be good to find out if there is any capability
> already implemented in R.
>
> I appreciate any clue that you might have for me,
>
> Best regards,
>
> Ebrahim Jahanshiri
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

        [[alternative HTML version deleted]]

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From florian.lengyel at gmail.com  Wed Oct 24 07:12:13 2012
From: florian.lengyel at gmail.com (Florian Lengyel)
Date: Wed, 24 Oct 2012 01:12:13 -0400
Subject: [R-sig-Geo] Interactive (click-able) map within R
In-Reply-To: <FF9DB805FC41CC4E95825A50F680630201BC33@columbia.uhd.campus>
References: <CANCB45shYD8=iwZRkEksOmbTETbGDYmokziuJ9DnupJyH+Ys=A@mail.gmail.com>
	<CALH4PEJ6ru2n3sssHFxyQWFt3n7ROnLQOpfvpnsDonKYf0rpGQ@mail.gmail.com>
	<FF9DB805FC41CC4E95825A50F680630201BC33@columbia.uhd.campus>
Message-ID: <CALH4PEL=6-x=O-SDWYgSp5db=K_SR4dpJhE5eXQBzpKeXcUhbg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121024/1f019555/attachment.pl>

From HodgessE at uhd.edu  Wed Oct 24 07:17:29 2012
From: HodgessE at uhd.edu (Hodgess, Erin)
Date: Wed, 24 Oct 2012 05:17:29 +0000
Subject: [R-sig-Geo] Interactive (click-able) map within R
In-Reply-To: <CALH4PEL=6-x=O-SDWYgSp5db=K_SR4dpJhE5eXQBzpKeXcUhbg@mail.gmail.com>
References: <CANCB45shYD8=iwZRkEksOmbTETbGDYmokziuJ9DnupJyH+Ys=A@mail.gmail.com>
	<CALH4PEJ6ru2n3sssHFxyQWFt3n7ROnLQOpfvpnsDonKYf0rpGQ@mail.gmail.com>
	<FF9DB805FC41CC4E95825A50F680630201BC33@columbia.uhd.campus>,
	<CALH4PEL=6-x=O-SDWYgSp5db=K_SR4dpJhE5eXQBzpKeXcUhbg@mail.gmail.com>
Message-ID: <FF9DB805FC41CC4E95825A50F680630201BC4B@columbia.uhd.campus>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121024/4a6e8a73/attachment.pl>

From e.jahanshiri at gmail.com  Wed Oct 24 07:34:23 2012
From: e.jahanshiri at gmail.com (Ebrahim Jahanshiri)
Date: Wed, 24 Oct 2012 13:34:23 +0800
Subject: [R-sig-Geo] Interactive (click-able) map within R
In-Reply-To: <CALH4PEJ6ru2n3sssHFxyQWFt3n7ROnLQOpfvpnsDonKYf0rpGQ@mail.gmail.com>
References: <CANCB45shYD8=iwZRkEksOmbTETbGDYmokziuJ9DnupJyH+Ys=A@mail.gmail.com>
	<CALH4PEJ6ru2n3sssHFxyQWFt3n7ROnLQOpfvpnsDonKYf0rpGQ@mail.gmail.com>
Message-ID: <CANCB45usps0QY1cbQ11mN6v5t8zoH_HGd5S0G1tcWYYHr++gXg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121024/38e6bdd9/attachment.pl>

From florian.lengyel at gmail.com  Wed Oct 24 08:46:37 2012
From: florian.lengyel at gmail.com (Florian Lengyel)
Date: Wed, 24 Oct 2012 02:46:37 -0400
Subject: [R-sig-Geo] Interactive (click-able) map within R
In-Reply-To: <CANCB45usps0QY1cbQ11mN6v5t8zoH_HGd5S0G1tcWYYHr++gXg@mail.gmail.com>
References: <CANCB45shYD8=iwZRkEksOmbTETbGDYmokziuJ9DnupJyH+Ys=A@mail.gmail.com>
	<CALH4PEJ6ru2n3sssHFxyQWFt3n7ROnLQOpfvpnsDonKYf0rpGQ@mail.gmail.com>
	<CANCB45usps0QY1cbQ11mN6v5t8zoH_HGd5S0G1tcWYYHr++gXg@mail.gmail.com>
Message-ID: <CALH4PEJF1dPa-ty38uWn9-Bn-UDpQD17LuKQHH1cBKTa=gekAA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121024/ae29e915/attachment.pl>

From b.rowlingson at lancaster.ac.uk  Wed Oct 24 11:08:16 2012
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Wed, 24 Oct 2012 10:08:16 +0100
Subject: [R-sig-Geo] Interactive (click-able) map within R
In-Reply-To: <bdf4e434416c42238a5f9d1ef2030794@EX-0-HT0.lancs.local>
References: <CANCB45shYD8=iwZRkEksOmbTETbGDYmokziuJ9DnupJyH+Ys=A@mail.gmail.com>
	<bdf4e434416c42238a5f9d1ef2030794@EX-0-HT0.lancs.local>
Message-ID: <CANVKczM8TfAuNGjEOoTWjJBSjtgv67hQ1YvkeaaDW3mBV1OjBg@mail.gmail.com>

On Wed, Oct 24, 2012 at 5:13 AM, Robert J. Hijmans <r.hijmans at gmail.com> wrote:
> Ebrahim,
>
> The raster package has the function "click" for raster data (Raster* of
> Spatial*) that allows you to visually query spatial data by clicking on
> plots. In the development version of that package on R-Forge there is also
> a click method for object data (SpatialPolygons, Lines, Points).

 More minimally than the click function, there's always the locator
function which lets users click on the current plot and returns the
coordinates. Then you can do whatever you want with those coordinates,
including testing against a set of polygons to see which one the user
clicked on.

 The direction that this thread seems to have gone in (now we're on
geo web servers and REST APIs to R-in-the-cloud SaaS providers) seems
a little over the top for a 'please choose a region' query.

Barry


From b.rowlingson at lancaster.ac.uk  Wed Oct 24 11:09:36 2012
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Wed, 24 Oct 2012 10:09:36 +0100
Subject: [R-sig-Geo] Interactive (click-able) map within R
In-Reply-To: <6bb265191f624c4e97c769b85706f1ca@EX-0-HT0.lancs.local>
References: <CANCB45shYD8=iwZRkEksOmbTETbGDYmokziuJ9DnupJyH+Ys=A@mail.gmail.com>
	<CALH4PEJ6ru2n3sssHFxyQWFt3n7ROnLQOpfvpnsDonKYf0rpGQ@mail.gmail.com>
	<6bb265191f624c4e97c769b85706f1ca@EX-0-HT0.lancs.local>
Message-ID: <CANVKczM_B_EyVp8QEFGuXiMQUHWXTjHTaknJx0-j=9NMfMPASw@mail.gmail.com>

On Wed, Oct 24, 2012 at 5:56 AM, Hodgess, Erin <HodgessE at uhd.edu> wrote:
> Hello:
>
> I just started working on this yesterday (literally!) via FastRWeb.  Simon Urbanek gave me some suggestions to use which involve HTML, callbacks, etc.  I know I little about HTML but not about javascript.

 Working on what exactly? I've love to see an interactive spatial data
viewer for R, with zoom, pan, and query functions. Is your code
available?

Barry


From roland.pape at uni-oldenburg.de  Wed Oct 24 14:35:02 2012
From: roland.pape at uni-oldenburg.de (Roland Pape)
Date: Wed, 24 Oct 2012 12:35:02 +0000
Subject: [R-sig-Geo] Dummy-coding and joining SpatialGridDataFrames
Message-ID: <4780FC16AA89574CA36BB63C15DF63A1173070@mbx05.w2kroot.uni-oldenburg.de>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121024/d041c91c/attachment.pl>

From jgrn at illinois.edu  Wed Oct 24 17:41:41 2012
From: jgrn at illinois.edu (Jonathan Greenberg)
Date: Wed, 24 Oct 2012 10:41:41 -0500
Subject: [R-sig-Geo] Parallel raster processing tools in r-forge
Message-ID: <CABG0rfvzc8_iVbW59wjW-mr8hYqEUy7=m7h8-bJka99XYbPp7A@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121024/5615e6e4/attachment.pl>

From paallen at attglobal.net  Wed Oct 24 17:54:33 2012
From: paallen at attglobal.net (paallen at attglobal.net)
Date: Wed, 24 Oct 2012 15:54:33 +0000
Subject: [R-sig-Geo] alphashape3d and shapefile export
Message-ID: <201210241554.q9OFshj9013115@hypatia.math.ethz.ch>

Hi all,

I am working with mineral exploration data consisting of surface & 
subsurface data (3d points, 3d polylines, & 3d polygons).  I mainly work up 
all my statistics in R and then export things out to ArcGIS.  

I have discovered the package alphashape3d and it looks like a great tool 
to create 3D wireframes.  But it is a bit unstable and tends to crash.  Has 
anyone else experiemented with this packages and have any suggestions?

Also does anyone know how best to export the 3d-triangles produced 
from this program to something ArcGIS can read.  I would like to open 
them in ArcGIS as a 3d-polygon (triangle ) file and then convert them to a 
multi-patch for viewing in the 3D-Analyst with all the rest of the data.

The output of my first sucessuful test of this program is included below.

thanks,
Phil

> d
     x   y   z
1  100 100 100
2  200 100 100
3  200 200 200
4  100 200 200
5   50  50 150
6  100 100 200
7  200 100 200
8  100 200 100
9  200 200 100
10  50 150 150
> d.ashape.obj <- ashape3d(as.matrix(d), alpha=200, pert=TRUE)
Warning: The general position assumption is not satisfied
Perturbation of the data set was required
> d.ashape.obj
$tetra
   v1 v2 v3 v4         rhoT fc:200
9   2  3  7  9 1.042910e+03      0
9   2  3  8  9 8.660254e+01      1
9   3  4  8  9 9.904612e+01      1
10  4  6  8 10 7.500000e+01      1
10  1  6  8 10 7.500000e+01      1
8   3  4  6  8 8.660254e+01      1
10  4  5  6 10 1.057594e+11      0
10  1  5  6 10 5.590170e+01      1
7   3  4  6  7 7.507452e+01      1
8   2  3  6  8 8.660254e+01      1
8   1  2  6  8 8.660254e+01      1
7   2  5  6  7 1.030776e+02      1
6   1  2  5  6 1.030776e+02      1
7   2  3  6  7 8.660254e+01      1

$triang
   tr1 tr2 tr3 on.ch attached      rhoT          muT          MuT fc:200
     1   2   6     0        0  70.71068 8.660254e+01 1.030776e+02      1
     1   5   6     0        0  53.03301 5.590170e+01 1.030776e+02      1
     1   6   8     0        1  70.71068 7.500000e+01 8.660254e+01      1
     1   6  10     0        0  53.03301 5.590170e+01 7.500000e+01      1
     2   3   6     0        1  81.64966 8.660254e+01 8.660254e+01      1
     2   3   7     0        0  70.71068 8.660254e+01 1.042910e+03      2
     2   3   8     0        1  81.64966 8.660254e+01 8.660254e+01      1
     2   3   9     0        0  70.71068 8.660254e+01 1.042910e+03      2
     2   5   6     0        1  82.91562 1.030776e+02 1.030776e+02      1
     2   6   7     0        0  70.71068 8.660254e+01 1.030776e+02      1
     2   6   8     0        1  81.64966 8.660254e+01 8.660254e+01      1
     3   4   6     0        0  70.71068 7.507452e+01 8.660254e+01      1
     3   4   8     0        0  70.71068 8.660254e+01 9.904612e+01      1
     3   6   7     0        0  70.71068 7.507452e+01 8.660254e+01      1
     3   6   8     0        1  81.64966 8.660254e+01 8.660254e+01      1
     3   8   9     0        0  70.71068 8.660254e+01 9.904612e+01      1
     4   6   8     0        1  70.71068 7.500000e+01 8.660254e+01      1
     4   6  10     0        0  53.03301 7.500000e+01 1.057594e+11      2
     5   6  10     0        0  53.03301 5.590170e+01 1.057594e+11      2
     6   8  10     0        1  75.00000 7.500000e+01 7.500000e+01      1
10   4   5   6     1        1 101.55048 1.057594e+11 1.057594e+11      0
6    1   2   5     1        1 101.55048 1.030776e+02 1.030776e+02      2
9    3   4   9     1        1  70.71068 9.904612e+01 9.904612e+01      2
10   4   5  10     1        1 101.55048 1.057594e+11 1.057594e+11      0
10   1   5  10     1        0  53.03301 5.590170e+01 5.590170e+01      2
7    3   4   7     1        1  70.71068 7.507452e+01 7.507452e+01      2
8    1   2   8     1        0  70.71068 8.660254e+01 8.660254e+01      2
7    2   5   7     1        1  86.96264 1.030776e+02 1.030776e+02      2
9    2   7   9     1        1  70.71068 1.042910e+03 1.042910e+03      0
9    2   8   9     1        0  70.71068 8.660254e+01 8.660254e+01      2
10   4   8  10     1        0  53.03301 7.500000e+01 7.500000e+01      2
10   1   8  10     1        0  53.03301 7.500000e+01 7.500000e+01      2
9    3   7   9     1        1  70.71068 1.042910e+03 1.042910e+03      0
9    4   8   9     1        1  70.71068 9.904612e+01 9.904612e+01      2
7    4   6   7     1        1  70.71068 7.507452e+01 7.507452e+01      2
7    5   6   7     1        1 101.55048 1.030776e+02 1.030776e+02      2

$edge
      ed1 ed2 on.ch attached     rhoT          muT          MuT fc:200
 [1,]   1   2     1        0 50.00000 7.071068e+01 1.030776e+02      2
 [2,]   1   5     1        0 43.30127 5.303301e+01 1.030776e+02      2
 [3,]   1   6     0        0 50.00000 5.303301e+01 1.030776e+02      1
 [4,]   1   8     1        0 50.00000 5.303301e+01 8.660254e+01      2
 [5,]   1  10     1        0 43.30127 5.303301e+01 7.500000e+01      2
 [6,]   2   3     0        0 70.71068 7.071068e+01 1.042910e+03      2
 [7,]   2   5     1        1 82.91562 1.030776e+02 1.030776e+02      2
 [8,]   2   6     0        0 70.71068 7.071068e+01 1.030776e+02      1
 [9,]   2   7     1        0 50.00000 7.071068e+01 1.042910e+03      2
[10,]   2   8     1        0 70.71068 7.071068e+01 8.660254e+01      2
[11,]   2   9     1        0 50.00000 7.071068e+01 1.042910e+03      2
[12,]   3   4     1        0 50.00000 7.071068e+01 9.904612e+01      2
[13,]   3   6     0        1 70.71068 7.071068e+01 8.660254e+01      1
[14,]   3   7     1        0 50.00000 7.071068e+01 1.042910e+03      2
[15,]   3   8     0        0 70.71068 7.071068e+01 9.904612e+01      1
[16,]   3   9     1        0 50.00000 7.071068e+01 1.042910e+03      2
[17,]   4   5     1        1 82.91562 1.057594e+11 1.057594e+11      0
[18,]   4   6     1        0 50.00000 5.303301e+01 1.057594e+11      2
[19,]   4   7     1        1 70.71068 7.507452e+01 7.507452e+01      2
[20,]   4   8     1        0 50.00000 5.303301e+01 9.904612e+01      2
[21,]   4   9     1        1 70.71068 9.904612e+01 9.904612e+01      2
[22,]   4  10     1        0 43.30127 5.303301e+01 1.057594e+11      2
[23,]   5   6     1        0 43.30127 5.303301e+01 1.057594e+11      2
[24,]   5   7     1        1 82.91562 1.030776e+02 1.030776e+02      2
[25,]   5  10     1        0 50.00000 5.303301e+01 1.057594e+11      2
[26,]   6   7     1        0 50.00000 7.071068e+01 1.030776e+02      2
[27,]   6   8     0        1 70.71068 7.500000e+01 8.660254e+01      1
[28,]   6  10     0        0 43.30127 5.303301e+01 1.057594e+11      2
[29,]   7   9     1        1 70.71068 1.042910e+03 1.042910e+03      0
[30,]   8   9     1        0 50.00000 7.071068e+01 9.904612e+01      2
[31,]   8  10     1        0 43.30127 5.303301e+01 7.500000e+01      2

$vertex
      v1 on.ch      muT          MuT fc:200
 [1,]  1     1 43.30127 1.030776e+02      2
 [2,]  2     1 50.00000 1.042910e+03      2
 [3,]  3     1 50.00000 1.042910e+03      2
 [4,]  4     1 43.30127 1.057594e+11      2
 [5,]  5     1 43.30127 1.057594e+11      2
 [6,]  6     1 43.30127 1.057594e+11      2
 [7,]  7     1 50.00000 1.042910e+03      2
 [8,]  8     1 43.30127 9.904612e+01      2
 [9,]  9     1 50.00000 1.042910e+03      2
[10,] 10     1 43.30127 1.057594e+11      2

$x
     x   y   z
1  100 100 100
2  200 100 100
3  200 200 200
4  100 200 200
5   50  50 150
6  100 100 200
7  200 100 200
8  100 200 100
9  200 200 100
10  50 150 150

$alpha
[1] 200

$xpert
     x   y   z
1  100 100 100
2  200 100 100
3  200 200 200
4  100 200 200
5   50  50 150
6  100 100 200
7  200 100 200
8  100 200 100
9  200 200 100
10  50 150 150

attr(,"class")
[1] "ashape3d"
>


From smithtiffanyt at gmail.com  Wed Oct 24 21:51:14 2012
From: smithtiffanyt at gmail.com (Tiffany Smith)
Date: Wed, 24 Oct 2012 15:51:14 -0400
Subject: [R-sig-Geo] dropLayer
Message-ID: <56FABFAA-2A50-413E-BD0C-BDAF7ADDC419@gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121024/0473235a/attachment.pl>

From ihentu at yahoo.com  Wed Oct 24 22:39:01 2012
From: ihentu at yahoo.com (Zhaofeng Yang)
Date: Wed, 24 Oct 2012 13:39:01 -0700 (PDT)
Subject: [R-sig-Geo] Question about cokriging on sphere
Message-ID: <1351111141.20897.YahooMailNeo@web164602.mail.gq1.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121024/a84c1f7a/attachment.pl>

From r.hijmans at gmail.com  Wed Oct 24 22:56:40 2012
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Wed, 24 Oct 2012 13:56:40 -0700
Subject: [R-sig-Geo] dropLayer
In-Reply-To: <56FABFAA-2A50-413E-BD0C-BDAF7ADDC419@gmail.com>
References: <56FABFAA-2A50-413E-BD0C-BDAF7ADDC419@gmail.com>
Message-ID: <CANtt_hy2y4RY57Mt+p5HnYF5kn4bXzaWAvXY-DbyuDY356YV1w@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121024/8274bcc9/attachment.pl>

From Tom_Roche at pobox.com  Thu Oct 25 01:30:08 2012
From: Tom_Roche at pobox.com (Tom Roche)
Date: Wed, 24 Oct 2012 19:30:08 -0400
Subject: [R-sig-Geo] how to plot Raster*? problems with raster::plot,
 fields::image.plot
In-Reply-To: <CANtt_hx1dB+iJ7KjDtESMMNAR_EeLzBPuQar26NNjmTTLx6ROQ@mail.gmail.com>
References: <CANtt_hx1dB+iJ7KjDtESMMNAR_EeLzBPuQar26NNjmTTLx6ROQ@mail.gmail.com>
	<87txtl7s8k.fsf@pobox.com>
Message-ID: <87391378jj.fsf@pobox.com>


https://stat.ethz.ch/pipermail/r-sig-geo/2012-October/016467.html
>> Could I get one or more spatial-plotting experts to examine defective
>> output produced when I try to plot a RasterLayer[, as described at]

>> http://stackoverflow.com/questions/13005181/rasterplot-problems-unwanted-rotation-extents

https://stat.ethz.ch/pipermail/r-sig-geo/2012-October/016485.html
> It would be useful to provide a simple self-contained example (of R
> code) of what you are trying to achieve.

I have described this completely at the above link, and all the code and
data is contained in a single git repository. All that's required to run
it is to clone the repo and run one script.

But I "boil it down" further here, and focus solely on the raster::plot
problem, on which I have made progress. About the fields::image.plot
problem I still have no clue; with raster::plot, I fixed the rotation
problem (which appears to have been due to a former typo in my CRS), but
am still having the extents problem: the plot of the regridded output
has much larger extents (global, or close) than does the extents
RasterLayer used to create it, and therefore to define the regridding.

Here's a simple demonstration:

1. Open a shell and create a working directory: in bash,

export TEST_DIR='/tmp/projectRasterTest' # or your name here
rm -fr ${TEST_DIR}   # start fresh
mkdir -p ${TEST_DIR}
# sometimes files seem to write to cwd, so move to it just in case
pushd ${TEST_DIR}

2. Download netCDF input: in bash,

DATA_INPUT_URI='https://github.com/downloads/TomRoche/GEIA_to_netCDF/GEIA_N2O_oceanic.nc'
DATA_INPUT_FN="$(basename ${DATA_INPUT_URI})"
export DATA_INPUT_FP="${TEST_DIR}/${DATA_INPUT_FN}"
if [[ ! -r "${DATA_INPUT_FP}" ]] ; then
  for CMD in \
    "wget --no-check-certificate -c -O ${DATA_INPUT_FP} ${DATA_INPUT_URI}" \
  ; do
    echo -e "$ ${CMD}"
    eval "${CMD}"
  done
fi
export DATA_VAR_NAME='emi_n2o'  # see ncdump output
export DATA_INPUT_BAND='3'      # GEIA makes dim=TIME third

3. Download netCDF used as a template for the extents:

TEMPLATE_INPUT_URI='https://github.com/downloads/TomRoche/GEIA_to_netCDF/emis_mole_all_20080101_12US1_cmaq_cb05_soa_2008ab_08c.EXTENTS_INPUT.nc'
TEMPLATE_INPUT_FN="$(basename ${TEMPLATE_INPUT_URI})"
export TEMPLATE_INPUT_FP="${TEST_DIR}/${TEMPLATE_INPUT_FN}"
if [[ ! -r "${TEMPLATE_INPUT_FP}" ]] ; then
  for CMD in \
    "wget --no-check-certificate -c -O ${TEMPLATE_INPUT_FP} ${TEMPLATE_INPUT_URI}" \
  ; do
    echo -e "$ ${CMD}"
    eval "${CMD}"
  done
fi
export TEMPLATE_INPUT_BAND='1' # `ncks` makes dim=TSTEP first

4. Setup a few more variables for later use: in bash,

export PDF_VIEWER='xpdf'  # whatever works on your platform
PDF_FN='projectRasterTest.pdf'
export PDF_FP="${TEST_DIR}/${PDF_FN}" # path to PDF output

DATA_INPUT_FN_ROOT="${DATA_INPUT_FN%.*}"
DATA_INPUT_FN_EXT="${DATA_INPUT_FN#*.}"
DATA_OUTPUT_FN="${DATA_INPUT_FN_ROOT}_regrid.${DATA_INPUT_FN_EXT}"
export DATA_OUTPUT_FP="${TEST_DIR}/${DATA_OUTPUT_FN}"

5. From here on, everything is R, so start R in your shell, and load
   required libraries and data:

library(raster)
library(ncdf4)
library(maptools)
# run if rgeos not available
# gpclibPermit()
library(rgdal)
data(wrld_simpl) # from maptools

6. Initialize vars, mostly with environment values:

pdf.fp <- Sys.getenv('PDF_FP')
pdf.er <- Sys.getenv('PDF_VIEWER')
in.fp <- Sys.getenv('DATA_INPUT_FP')
in.band <- Sys.getenv('DATA_INPUT_BAND')
data.var.name <- Sys.getenv('DATA_VAR_NAME')
template.in.fp <- Sys.getenv('TEMPLATE_INPUT_FP')
template.band <- Sys.getenv('TEMPLATE_INPUT_BAND')
out.fp <- Sys.getenv('DATA_OUTPUT_FP')

# This corresponds to the output domain specification @
# https://github.com/TomRoche/cornbeltN2O/wiki/AQMEII-North-American-domain#wiki-EPA
out.crs <- '+proj=lcc +lat_1=33 +lat_2=45 +lat_0=40 +lon_0=-97 +x_0=-2556000 +y_0=-1728000'

7. Rasterize the input netCDF:

in.raster <- raster(in.fp, varname=data.var.name, band=in.band)
in.raster
# class       : RasterLayer 
# dimensions  : 180, 360, 64800  (nrow, ncol, ncell)
# resolution  : 1, 1  (x, y)
# extent      : -180, 180, -90, 90  (xmin, xmax, ymin, ymax)
# coord. ref. : +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0 
# values      : /tmp/projectRasterTest/GEIA_N2O_oceanic.nc 
# layer name  : N2O.emissions 
# z-value     : 0 
# zvar        : emi_n2o 

8. Rasterize the extents netCDF, which should resemble the
   output domain specification:

template.in.raster <- raster(template.in.fp, varname=data.var.name, band=template.band)
template.raster <- projectExtent(template.in.raster, crs=out.crs)
template.raster
# class       : RasterLayer 
# dimensions  : 299, 459, 137241  (nrow, ncol, ncell)
# resolution  : 53369.55, 56883.69  (x, y)
# extent      : -14802449, 9694173, -6258782, 10749443  (xmin, xmax, ymin, ymax)
# coord. ref. : +proj=lcc +lat_1=33 +lat_2=45 +lat_0=40 +lon_0=-97 +x_0=-2556000 +y_0=-1728000 +ellps=WGS84 

   It does!

9. Regrid the input netCDF using the extents netCDF:

out.raster <-
  projectRaster(
    from=in.raster, to=template.raster, method='bilinear', crs=out.crs,
    overwrite=TRUE, progress='window', format='CDF',
    # args from writeRaster
    NAflag=-999.0,  # match emi_n2o:missing_value,_FillValue
    varname=data.var.name, 
    varunit='ton N2O-N/yr',
    longname='N2O emissions',
    xname='COL',
    yname='ROW',
    filename=out.fp)
out.raster
# class       : RasterLayer 
# dimensions  : 299, 459, 137241  (nrow, ncol, ncell)
# resolution  : 53369.55, 56883.69  (x, y)
# extent      : -14802449, 9694173, -6258782, 10749443  (xmin, xmax, ymin, ymax)
# coord. ref. : +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0 
# data source : /tmp/projectRasterTest/GEIA_N2O_oceanic_regrid.nc
# names       : N2O.emissions 
# zvar        : emi_n2o 

    I'm not sure why the regridded output is still proj=longlat, given
    that I clearly set a projected CRS on it, and the extents ('to')
    used to create it has the same CRS.

10. Examine the regridded netCDF written by projectRaster: looks good,
    and note that the regridded netCDF knows its CRS (even if its
    parent RasterLayer does not).

system(sprintf('ncdump -h %s', out.fp))
# netcdf GEIA_N2O_oceanic_regrid {
# dimensions:
#   COL = 459 ;
#   ROW = 299 ;
# variables:
#   double COL(COL) ;
#       COL:units = "meter" ;
#       COL:long_name = "COL" ;
#   double ROW(ROW) ;
#       ROW:units = "meter" ;
#       ROW:long_name = "ROW" ;
#   float emi_n2o(ROW, COL) ;
#       emi_n2o:units = "ton N2O-N/yr" ;
#       emi_n2o:missing_value = -999.f ;
#       emi_n2o:_FillValue = -999.f ;
#       emi_n2o:long_name = "N2O emissions" ;
#       emi_n2o:projection = "+proj=lcc +lat_1=33 +lat_2=45 +lat_0=40 +lon_0=-97 +x_0=-2556000 +y_0=-1728000 +ellps=WGS84" ;
#       emi_n2o:projection_format = "PROJ.4" ;
#       emi_n2o:min = 5.9605e-08f ;
#       emi_n2o:max = 783.92f ;
#
# // global attributes:
#               :Conventions = "CF-1.4" ;
#               :created_by = "R, packages ncdf and raster (version 2.0-12)" ;

typo: should be 'ncdf4'                    ^^^^

11. Get a map of North America, and project it:

map.us.unproj <-
  wrld_simpl[wrld_simpl$ISO3 %in% c('CAN', 'MEX', 'USA'),]
map.us.proj <- spTransform(map.us.unproj, CRS(out.crs))

12. Plot the output 3 different ways:

# plot to PDF---------------------------------------------------------
# repeat for each plot file
pdf(file=pdf.fp, width=5.5, height=4.25)

# plot page 1: just plain plot----------------------------------------
plot(out.raster)
# add the projected CONUS map
plot(map.us.proj, add=TRUE)

# plot page 2: try setting plot extents-------------------------------
plot(out.raster, ext=template.raster)
plot(map.us.proj, add=TRUE)
# note page 2 is identical to page 1

# plot page 3: try raster::crop---------------------------------------
template.raster.extent <- extent(template.raster)
out.raster.crop <-
  # overwrite the uncropped file
  crop(out.raster, template.raster.extent, filename=out.fp, overwrite=TRUE)
plot(out.raster.crop)
plot(map.us.proj, add=TRUE)
# note page 3 is identical to page 2 and page 1

# flush the plot device
dev.off()

13. Exit R, and examine the plot: in bash,

# After exiting R, show cwd and display output PDF.
for CMD in \
  "ls -alht ${TEST_DIR}" \
  "${PDF_VIEWER} ${PDF_FP} &" \
; do
  echo -e "$ ${CMD}"
  eval "${CMD}"
done

    The resultant PDF will have 3 pages, all identical, and all having
    much greater extents than does

https://github.com/TomRoche/cornbeltN2O/wiki/images/Cmaq_aqmeii_domain.png

    the boundaries of which are the extents of the output domain.
    How to fix?

Your assistance is appreciated, Tom Roche <Tom_Roche at pobox.com>


From r.hijmans at gmail.com  Thu Oct 25 03:07:06 2012
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Wed, 24 Oct 2012 18:07:06 -0700
Subject: [R-sig-Geo] how to plot Raster*? problems with raster::plot,
	fields::image.plot
In-Reply-To: <87391378jj.fsf@pobox.com>
References: <87txtl7s8k.fsf@pobox.com>
	<CANtt_hx1dB+iJ7KjDtESMMNAR_EeLzBPuQar26NNjmTTLx6ROQ@mail.gmail.com>
	<87391378jj.fsf@pobox.com>
Message-ID: <CANtt_hzWj4JQsuKjNB5K4r8F9pw2wVP5L=hXHPADQepTP6m3Hg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121024/9d7241c4/attachment.pl>

From Tom_Roche at pobox.com  Thu Oct 25 04:01:28 2012
From: Tom_Roche at pobox.com (Tom Roche)
Date: Wed, 24 Oct 2012 22:01:28 -0400
Subject: [R-sig-Geo] how to plot Raster*? problems with raster::plot,
 fields::image.plot
In-Reply-To: <CANtt_hzWj4JQsuKjNB5K4r8F9pw2wVP5L=hXHPADQepTP6m3Hg@mail.gmail.com>
References: <CANtt_hzWj4JQsuKjNB5K4r8F9pw2wVP5L=hXHPADQepTP6m3Hg@mail.gmail.com>
	<87txtl7s8k.fsf@pobox.com>
	<CANtt_hx1dB+iJ7KjDtESMMNAR_EeLzBPuQar26NNjmTTLx6ROQ@mail.gmail.com>
	<87391378jj.fsf@pobox.com>
Message-ID: <87wqyf5myv.fsf@pobox.com>


https://stat.ethz.ch/pipermail/r-sig-geo/2012-October/016501.html
> library(raster)
> # replacing your file with example data
> in.raster <- raster()
> in.raster[] <- 1:ncell(in.raster)
> template.raster <- raster(nrow=299, ncol=459, xmn=-14802449, xmx=9694173, ymn=-6258782, ymx=10749443, crs="+proj=lcc +lat_1=33 +lat_2=45 +lat_0=40 +lon_0=-97 +x_0=-2556000 +y_0=-1728000 +ellps=WGS84")

I didn't know about the additional arguments (e.g., 'xmn'): they're not in the doc

http://cran.r-project.org/web/packages/raster/raster.pdf

> out.raster <- projectRaster(from=in.raster, to=template.raster, method='bilinear')

Actually

https://stat.ethz.ch/pipermail/r-sig-geo/2012-October/016500.html
>> out.raster <-
>>   projectRaster(
>>     from=in.raster, to=template.raster, method='bilinear', crs=out.crs,
>>     overwrite=TRUE, progress='window', format='CDF',
>>     # args from writeRaster
>>     NAflag=-999.0,  # match emi_n2o:missing_value,_FillValue
>>     varname=data.var.name, 
>>     varunit='ton N2O-N/yr',
>>     longname='N2O emissions',
>>     xname='COL',
>>     yname='ROW',
>>     filename=out.fp)

> library(maptools)
> data(wrld_simpl)
> map.us.unproj <- wrld_simpl[wrld_simpl$ISO3 %in% c('CAN', 'MEX', 'USA'),]
> map.us.proj <- spTransform(map.us.unproj, CRS=projection(out.raster, asText=F))

didn't know about that CRS parameterization, thanks

> plot(out.raster)
> plot(map.us.proj, add=TRUE)

> I take it you want a smaller extent. Then use a template with a
> better extent

What? I want to plot the *same* extent as my data, which is the *same*
extent as was used to create the output, i.e.,

>> template.in.raster <- raster(template.in.fp, varname=data.var.name, band=template.band)
>> template.raster <- projectExtent(template.in.raster, crs=out.crs)
>> template.raster
>> # class       : RasterLayer 
>> # dimensions  : 299, 459, 137241  (nrow, ncol, ncell)
>> # resolution  : 53369.55, 56883.69  (x, y)
>> # extent      : -14802449, 9694173, -6258782, 10749443  (xmin, xmax, ymin, ymax)
>> # coord. ref. : +proj=lcc +lat_1=33 +lat_2=45 +lat_0=40 +lon_0=-97 +x_0=-2556000 +y_0=-1728000 +ellps=WGS84 

which not only I, but many others, know, from years of use of that
spatial domain by various air-quality models for an international
model-intercomparison project, AQMEII (about which see, e.g., the March
2012 _Atmospheric Environment_ or

http://aqmeii.jrc.ec.europa.eu/

) is a 12-km LCC grid with 299 rows and 459 columns (not

> temp2 <- raster(nrow=70, ncol=117,

(from where comes those row and col counts?)

> xmn=-5622887, xmx=621350, ymn=-3642132, ymx=339726.7, crs="+proj=lcc +lat_1=33 +lat_2=45 +lat_0=40 +lon_0=-97 +x_0=-2556000 +y_0=-1728000 +ellps=WGS84")

) and which plots like

https://github.com/TomRoche/cornbeltN2O/wiki/images/Cmaq_aqmeii_domain.png

Don't believe me? see, e.g., figure 1 of

http://dx.doi.org/10.1016/j.atmosenv.2011.12.041

So please explain: why do I need to choose *one* set of extents to get
the regridded *data* that I need, and *another* set of extents to
display that data with raster::plot? Or am I missing something?

TIA, Tom Roche <Tom_Roche at pobox.com>


From Tom_Roche at pobox.com  Thu Oct 25 07:01:55 2012
From: Tom_Roche at pobox.com (Tom Roche)
Date: Thu, 25 Oct 2012 01:01:55 -0400
Subject: [R-sig-Geo] how to plot Raster*? problems with raster::plot,
 fields::image.plot
In-Reply-To: <87wqyf5myv.fsf@pobox.com> 
References: <87wqyf5myv.fsf@pobox.com>
	<CANtt_hzWj4JQsuKjNB5K4r8F9pw2wVP5L=hXHPADQepTP6m3Hg@mail.gmail.com>
	<87txtl7s8k.fsf@pobox.com>
	<CANtt_hx1dB+iJ7KjDtESMMNAR_EeLzBPuQar26NNjmTTLx6ROQ@mail.gmail.com>
	<87391378jj.fsf@pobox.com>
Message-ID: <87k3ufxhz0.fsf@pobox.com>


Evidence for a bug in raster::plot :

I tried adding the code you suggested. First, the additional args to
raster(...)

https://stat.ethz.ch/pipermail/r-sig-geo/2012-October/016501.html
>> template.raster <- raster(nrow=299, ncol=459, xmn=-14802449, xmx=9694173, ymn=-6258782, ymx=10749443, crs="+proj=lcc +lat_1=33 +lat_2=45 +lat_0=40 +lon_0=-97 +x_0=-2556000 +y_0=-1728000 +ellps=WGS84")

but since I am creating my template.raster using projectExtent(...), for which those args are unused, I rolled back.

However the different call to spTransform(...) was quite suggestive ...

>> map.us.proj <- spTransform(map.us.unproj, CRS=projection(out.raster, asText=F))

... because it failed: in my plot output, the map did not draw.

This made me think about *why* that might have failed, which led me to a
question previously noted in a comment in my code (starred below):

https://github.com/TomRoche/GEIA_to_netCDF/blob/master/regrid.global.to.AQMEII.r
>>> out.raster <-
>>>   projectRaster(
>>>     from=in.raster, to=template.raster, method='bilinear', crs=out.crs,
>>>     overwrite=TRUE, progress='window', format='CDF',
>>>     # args from writeRaster
>>>     NAflag=-999.0,  # match emi_n2o:missing_value,_FillValue (TODO: copy)
>>>     varname=data.var.name, 
>>>     varunit='ton N2O-N/yr',
>>>     longname='N2O emissions',
>>>     xname='COL',
>>>     yname='ROW',
>>>     filename=out.fp)
>>> out.raster
>>> #> class       : RasterLayer 
>>> #> dimensions  : 299, 459, 137241  (nrow, ncol, ncell)
>>> #> resolution  : 53369.55, 56883.69  (x, y)
>>> #> extent      : -14802449, 9694173, -6258782, 10749443  (xmin, xmax, ymin, ymax)
*** # ??? why still proj=longlat ???
>>> #> coord. ref. : +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0

That would explain why your syntax

>> map.us.proj <- spTransform(map.us.unproj, CRS=projection(out.raster, asText=F))

failed: projectRaster(...), at least in this case, is failing to
properly record its projection in out.raster. (Perhaps some slot is not
properly assigned?) This also seems to suggest why raster::plot, when
called using out.raster

https://github.com/TomRoche/GEIA_to_netCDF/blob/master/regrid.global.to.AQMEII.r
>>> plot(out.raster)
or
>>> plot(out.raster, ext=template.raster)
or
>>> template.raster.extent <- extent(template.raster)
>>> out.raster.crop <-
>>>   crop(out.raster, template.raster.extent, filename=out.fp, overwrite=TRUE)
>>> plot(out.raster.crop)

is producing a plot with *global* extents

https://github.com/downloads/TomRoche/GEIA_to_netCDF/raster..plot_bounds_problem.png

instead of respecting the extents of its projection ... because
projectRaster(...) is failing to provide out.raster with the correct
projection!

Am I missing something? Because, frankly, your previous suggestion

>> I take it you want a smaller extent. Then use a template with a
>> better extent

makes no sense, as previously noted:

https://stat.ethz.ch/pipermail/r-sig-geo/2012-October/016502.html
> why do I need to choose *one* set of extents to get the regridded
> *data* that I need, and *another* set of extents to display that
> data with raster::plot?

FWIW, Tom Roche <Tom_Roche at pobox.com>


From Tom_Roche at pobox.com  Thu Oct 25 07:38:43 2012
From: Tom_Roche at pobox.com (Tom Roche)
Date: Thu, 25 Oct 2012 01:38:43 -0400
Subject: [R-sig-Geo] how to plot Raster*? problems with raster::plot,
 fields::image.plot
In-Reply-To: <87k3ufxhz0.fsf@pobox.com>
References: <87k3ufxhz0.fsf@pobox.com> <87wqyf5myv.fsf@pobox.com>
	<CANtt_hzWj4JQsuKjNB5K4r8F9pw2wVP5L=hXHPADQepTP6m3Hg@mail.gmail.com>
	<87txtl7s8k.fsf@pobox.com>
	<CANtt_hx1dB+iJ7KjDtESMMNAR_EeLzBPuQar26NNjmTTLx6ROQ@mail.gmail.com>
	<87391378jj.fsf@pobox.com>
Message-ID: <87zk3bcdr0.fsf@pobox.com>


https://stat.ethz.ch/pipermail/r-sig-geo/2012-October/016503.html
- Evidence for a bug in raster::plot :

doh! I should have said

+ Evidence for a bug in raster::projectRaster :

rest of previous post
https://stat.ethz.ch/pipermail/r-sig-geo/2012-October/016503.html
still holds, and follows to end of post-------------------------------

I tried adding the code you suggested. First, the additional args to
raster(...)

https://stat.ethz.ch/pipermail/r-sig-geo/2012-October/016501.html
>> template.raster <- raster(nrow=299, ncol=459, xmn=-14802449, xmx=9694173, ymn=-6258782, ymx=10749443, crs="+proj=lcc +lat_1=33 +lat_2=45 +lat_0=40 +lon_0=-97 +x_0=-2556000 +y_0=-1728000 +ellps=WGS84")

but since I am creating my template.raster using projectExtent(...), for which those args are unused, I rolled back.

However the different call to spTransform(...) was quite suggestive ...

>> map.us.proj <- spTransform(map.us.unproj, CRS=projection(out.raster, asText=F))

... because it failed: in my plot output, the map did not draw.

This made me think about *why* that might have failed, which led me to a
question previously noted in a comment in my code (starred below):

https://github.com/TomRoche/GEIA_to_netCDF/blob/master/regrid.global.to.AQMEII.r
>>> out.raster <-
>>>   projectRaster(
>>>     from=in.raster, to=template.raster, method='bilinear', crs=out.crs,
>>>     overwrite=TRUE, progress='window', format='CDF',
>>>     # args from writeRaster
>>>     NAflag=-999.0,  # match emi_n2o:missing_value,_FillValue (TODO: copy)
>>>     varname=data.var.name, 
>>>     varunit='ton N2O-N/yr',
>>>     longname='N2O emissions',
>>>     xname='COL',
>>>     yname='ROW',
>>>     filename=out.fp)
>>> out.raster
>>> #> class       : RasterLayer 
>>> #> dimensions  : 299, 459, 137241  (nrow, ncol, ncell)
>>> #> resolution  : 53369.55, 56883.69  (x, y)
>>> #> extent      : -14802449, 9694173, -6258782, 10749443  (xmin, xmax, ymin, ymax)
*** # ??? why still proj=longlat ???
>>> #> coord. ref. : +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0

That would explain why your syntax

>> map.us.proj <- spTransform(map.us.unproj, CRS=projection(out.raster, asText=F))

failed: projectRaster(...), at least in this case, is failing to
properly record its projection in out.raster. (Perhaps some slot is not
properly assigned?) This also seems to suggest why raster::plot, when
called using out.raster

https://github.com/TomRoche/GEIA_to_netCDF/blob/master/regrid.global.to.AQMEII.r
>>> plot(out.raster)
or
>>> plot(out.raster, ext=template.raster)
or
>>> template.raster.extent <- extent(template.raster)
>>> out.raster.crop <-
>>>   crop(out.raster, template.raster.extent, filename=out.fp, overwrite=TRUE)
>>> plot(out.raster.crop)

is producing a plot with *global* extents

https://github.com/downloads/TomRoche/GEIA_to_netCDF/raster..plot_bounds_problem.png

instead of respecting the extents of its projection ... because
projectRaster(...) is failing to provide out.raster with the correct
projection!

Am I missing something? Because, frankly, your previous suggestion

>> I take it you want a smaller extent. Then use a template with a
>> better extent

makes no sense, as previously noted:

https://stat.ethz.ch/pipermail/r-sig-geo/2012-October/016502.html
> why do I need to choose *one* set of extents to get the regridded
> *data* that I need, and *another* set of extents to display that
> data with raster::plot?

FWIW, Tom "up past his bedtime" Roche <Tom_Roche at pobox.com>


From johan.mazel at gmail.com  Thu Oct 25 07:13:14 2012
From: johan.mazel at gmail.com (Johan Mazel)
Date: Thu, 25 Oct 2012 14:13:14 +0900
Subject: [R-sig-Geo] Azimuthal equidistant projection and rgdal
Message-ID: <CAKS5mhRy=uWM_8dS1dPd+jn19UhDSkNe0purC+dzoqqwb1Q3LQ@mail.gmail.com>

Hi
I am trying to use the solution rpesented here:
https://stat.ethz.ch/pipermail/r-sig-geo/2007-December/002939.html.

However it looks like the shifted (from the north pole) map is
displayed on top on the original azimuthal equidistant projection
centered on the north pole.
Is there any way to correct this ?

Thanks for your time.
Regards.
Johan


From edzer.pebesma at uni-muenster.de  Thu Oct 25 13:40:44 2012
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Thu, 25 Oct 2012 13:40:44 +0200
Subject: [R-sig-Geo] Question about cokriging on sphere
In-Reply-To: <1351111141.20897.YahooMailNeo@web164602.mail.gq1.yahoo.com>
References: <1351111141.20897.YahooMailNeo@web164602.mail.gq1.yahoo.com>
Message-ID: <5089253C.5030001@uni-muenster.de>

You are still using the deprecated interface that accepts data.frame
objects as input.

Please see demo(cokriging) to find out how the interface with Spatial*
objects works, and read ?proj4string to find out how to specify
projection systems for such objects.

On 10/24/2012 10:39 PM, Zhaofeng Yang wrote:
> Hi all,
> 
> I am new to geostatistics and need some help on projection. I am working on a bivariate model of a sphere and want to do cokriging with gstat package in R. My data look like
> 
>> head(mydata)
>          lon         lat         v1         v2
> 1  2.1238698  0.87854240  1.8051750  1.2222044
> 2 -2.6524104 -0.14883920 -0.4271378 -0.1659977
> 3 -2.5863044 -0.18126753 -0.4142029 -0.2782104
> 4  1.1100337 -0.03636767 -1.1252408  0.4394822
> 5 -0.5421093 -0.60182344  0.8544659  0.6174832
> 6 -3.0686334  0.53252533  0.9143837  0.9566044
> 
> where lon and lat are longitude and latitude in radian. v1and v2 are two collocated variables. The total number of points is 100 (only 6 are shown here). I want to do cokriging at a couple of new locations saved as a data frame called newloc.
> 
>> newloc
>   lon lat
> 1 0.2 0.3
> 2 0.5 1.0
> 
> My thought is to first get the sample variogram/cross variogram and use linear model of coregionalization to fit them and then do cokriging. Here is my code (basically following demo(cokriging)in gstat). I first simply neglected the sphere and just treated lon and lat as Cartesian coordinate.
> 
> g <- gstat(id = "val1", formula = v1~1, locations = ~lon+lat, data = mydata)
> g <- gstat(g, id = "val2", formula = v2~1, locations = ~lon+lat, data = mydata)
> g <- gstat(g, model = vgm(1, "Sph", 1, 1), fill.all = TRUE)
> x <- variogram(g, cutoff = 2)
> myfit <- fit.lmc(x, g)
> plot(x, model = myfit)
> newloc <- data.frame(lon = c(0.2, 0.5), lat = c(0.3, 1.0))
> z <- predict(myfit, newdata = newloc)
> 
> I don't know if the above code is correct or not but it gives me some output. Now comes the question of how to taking into account the curvature of the sphere. I combed through some R-sig-Geo posts and found something using proj4string or proj4 but I can't make it work. I really need some help on how to do projection in computing variogram/cross variogram and doing cokriging.
> 
> Please help me on this. Thank you very much.
> 
> Zhaofeng
> 	[[alternative HTML version deleted]]
> 
> 
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From rafael.wueest at wsl.ch  Thu Oct 25 13:43:06 2012
From: rafael.wueest at wsl.ch (=?iso-8859-1?Q?Rafael_W=FCest?=)
Date: Thu, 25 Oct 2012 13:43:06 +0200
Subject: [R-sig-Geo] Mosaic Option to BLEND
Message-ID: <55B31DF4-7ADE-4FFF-A2C6-46EC7D54DA5D@wsl.ch>

Dear R geo experts,

I have specific question to the raster::mosaic function.

From the help file of the mosaic function (raster version 2.0-08), I see that we have options to assign the min, max, mean to the mosaic'ed cells. From ArcINFO, I'm used to the BLEND option, which will assign a value to the mosaic'ed cell that relies on an algorithm that is weight based and dependent on the distance from the pixel to the edge within the overlapping area.

Now, is there an easy way I can get the same result using the raster::mosaic function? Or is there another elegant way to achieve the same using some other packages or functions?

I'm grateful for any hints!

Rafael


--
Rafael W?est
Swiss Federal Research Institute WSL
Z?rcherstrasse 111
8903 Birmensdorf
Switzerland

+41 44 7392126
rafael.wueest at wsl.ch
http://www.wsl.ch/info/mitarbeitende/wueest/index_EN


From etiennebr at gmail.com  Thu Oct 25 17:40:54 2012
From: etiennebr at gmail.com (Etienne B. Racine)
Date: Thu, 25 Oct 2012 11:40:54 -0400
Subject: [R-sig-Geo] Mosaic Option to BLEND
In-Reply-To: <55B31DF4-7ADE-4FFF-A2C6-46EC7D54DA5D@wsl.ch>
References: <55B31DF4-7ADE-4FFF-A2C6-46EC7D54DA5D@wsl.ch>
Message-ID: <CALjAYt4oX3b8G_k6Ha9NaCqX3wduP9p+frpbv2hFxzP=cj5FPw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121025/019eed3b/attachment.pl>

From c74gutierrez at gmail.com  Thu Oct 25 18:54:59 2012
From: c74gutierrez at gmail.com (c.gutierrez)
Date: Thu, 25 Oct 2012 09:54:59 -0700 (PDT)
Subject: [R-sig-Geo] areaint in Matlab vs. areaPolygon or areapl in R
Message-ID: <1351184099050-7581399.post@n2.nabble.com>

I am getting two different sets of values when I try to calculate the polygon
area in Matlab vs. R. In Matlab, I used areaint (with the reference
ellipsoid set to WGS84). In R, I tried both geosphere::areaPolygon on
lat-lon or splancs::areapl on grid-converted Euclidean coordinates. The R
results agree with each other, but not with the Matlab calculation. The two
sets are on average 25% different (Matlab lower). What am I missing?

[This is cross-posted on stackoverflow 
http://stackoverflow.com/questions/13038602/areaint-in-matlab-vs-areapolygon-or-areapl-in-r#comment17718262_13038602
<http://stackoverflow.com/questions/13038602/areaint-in-matlab-vs-areapolygon-or-areapl-in-r#comment17718262_13038602>  
]



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/areaint-in-Matlab-vs-areaPolygon-or-areapl-in-R-tp7581399.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From r.hijmans at gmail.com  Thu Oct 25 19:19:14 2012
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Thu, 25 Oct 2012 10:19:14 -0700
Subject: [R-sig-Geo] Mosaic Option to BLEND
In-Reply-To: <CALjAYt4oX3b8G_k6Ha9NaCqX3wduP9p+frpbv2hFxzP=cj5FPw@mail.gmail.com>
References: <55B31DF4-7ADE-4FFF-A2C6-46EC7D54DA5D@wsl.ch>
	<CALjAYt4oX3b8G_k6Ha9NaCqX3wduP9p+frpbv2hFxzP=cj5FPw@mail.gmail.com>
Message-ID: <CANtt_hzHG4Ne=g169Q7=zNi36ZdsXQmsi7iaW7S9WNvY0OKStw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121025/b2e2ffad/attachment.pl>

From r.hijmans at gmail.com  Thu Oct 25 19:24:51 2012
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Thu, 25 Oct 2012 10:24:51 -0700
Subject: [R-sig-Geo] areaint in Matlab vs. areaPolygon or areapl in R
In-Reply-To: <1351184099050-7581399.post@n2.nabble.com>
References: <1351184099050-7581399.post@n2.nabble.com>
Message-ID: <CANtt_hw8H7QtTiT96fEZcsMBTUs13NWbB7DczmRZEvTC9uqGWw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121025/5cfd8fe0/attachment.pl>

From rafael.wueest at wsl.ch  Thu Oct 25 19:25:32 2012
From: rafael.wueest at wsl.ch (=?iso-8859-1?Q?Rafael_W=FCest?=)
Date: Thu, 25 Oct 2012 19:25:32 +0200
Subject: [R-sig-Geo] Mosaic Option to BLEND
In-Reply-To: <CANtt_hzHG4Ne=g169Q7=zNi36ZdsXQmsi7iaW7S9WNvY0OKStw@mail.gmail.com>
References: <55B31DF4-7ADE-4FFF-A2C6-46EC7D54DA5D@wsl.ch>
	<CALjAYt4oX3b8G_k6Ha9NaCqX3wduP9p+frpbv2hFxzP=cj5FPw@mail.gmail.com>
	<CANtt_hzHG4Ne=g169Q7=zNi36ZdsXQmsi7iaW7S9WNvY0OKStw@mail.gmail.com>
Message-ID: <8616EEB4-909B-4A29-BE13-4C5F6AD93BC4@wsl.ch>

Dear Etienne and Robert

building on Etienne's idea, I was just about to get to Robert's suggestion.

Thank you very much, I will do some further testing, but this is pretty much what I was looking for. Thanks to both of you.

Best,
Rafael

On 25.10.2012, at 19:19, Robert J. Hijmans wrote:

> 
> Some ideas, building on Etienne's script:
> 
> 
> library(raster)
> m <- matrix(NA, 50, 50)
> r1 <- raster(m)
> r1[] <- 10
> r2 <- shift(r1, x = 0.4, y = 0.4)
> r2[] <- 20
> 
> 
> i <- intersect(raster(r1), raster(r2))
> j <- raster::expand(i, c(1,1)) 
> a <- crop(r1, j)
> values(a) <- 1
> b <- crop(r2, j)
> values(b) <- 2
> ab <- merge(a, b)
> ba <- merge(b, a)
> p1 <- rasterToPoints(ab, function(x) x==2)
> p2 <- rasterToPoints(ba, function(x) x==1)
> 
> xy <- xyFromCell(i, 1:ncell(i))
> d1 <- distanceFromPoints(i, p1[,1:2])
> d2 <- distanceFromPoints(i, p2[,1:2])
> dsum <- d1 + d2
> 
> z1 <- d1 * crop(r1, d1) / dsum
> z2 <- d2 * crop(r2, d2) / dsum
> m <- merge(z1 + z2, r1, r2)
> 
> plot(m)
> 
> 
> 
> 
> 
> On Thu, Oct 25, 2012 at 8:40 AM, Etienne B. Racine <etiennebr at gmail.com> wrote:
> I find it not very obvious what ESRI BLEND option is doing.
> 
>    - BLEND ?The output cell value of the overlapping areas will be a
>    horizontally weighted calculation of the values of the cells in the
>    overlapping area. [
>    http://help.arcgis.com/fr/arcgisdesktop/10.0/help/index.html#//00pv00000007000000
>    ]
> 
> or 9.2
> 
> 
>    - BLEND ? The output cell value of the overlapping areas will be a blend
>    of values that overlap; this blend value is based on an algorithm that is
>    weight based and is dependent on the distance from the pixel to the edge
>    within the overlapping area. [
>    http://webhelp.esri.com/arcgisdesktop/9.2/index.cfm?TopicName=mosaic_to_new_raster_%28data_management%29
>    ]
> 
> I think everything is about how you generate the weight matrix here.  I
> couldn't find with a quick search, what horizontal weight is. But let's say
> it is about giving a "priority" to cells closer to their center this makes
> sense if the overlap of the rasters is less than 50 % in each axis.
> # generate data
> library(raster)
> m <- matrix(NA, 5, 5)
> r <- raster(m)
> r[] <- 1
> r2 <- shift(raster(m), x = 0.4, y = 0.4)
> r2[] <- 2
> 
> # create a distance-weighted matrix
> d <- raster(m)
> d2 <- r2
> 
> # This is a simple example
> # Everything is happening here. How would you generate a weight
> # that make sense for your context ?
> d[] <- 1 / (as.matrix(dist(xyFromCell(r, 1:ncell(r))))[13, ] + 1e-9)
> d2[] <- 1 / (as.matrix(dist(xyFromCell(r2, 1:ncell(r))))[13, ] + 1e-9)
> 
> # merge weights
> w <- mosaic(d, d2, fun = sum)
> # create weighted rasters
> wr <- r * d / w
> wr2 <- r2 * d2 / w
> # simply sum the two weighted rasters
> mos <- mosaic(wr, wr2, fun = sum)
> plot(mos)
> 
> However as I mentioned earlier it is not working very well if the rasters
> overlap more than 50% in an axis or the other since the distance from the
> center start to decrease. Try it with a smaller shift, e.g. r2 <-
> shift(raster(m), x = 0.2, y = 0.2).
> 
> Maybe it will get you started however
> 
> Etienne
> 
> 2012/10/25 Rafael W?est <rafael.wueest at wsl.ch>
> 
> > Dear R geo experts,
> >
> > I have specific question to the raster::mosaic function.
> >
> > From the help file of the mosaic function (raster version 2.0-08), I see
> > that we have options to assign the min, max, mean to the mosaic'ed cells.
> > From ArcINFO, I'm used to the BLEND option, which will assign a value to
> > the mosaic'ed cell that relies on an algorithm that is weight based and
> > dependent on the distance from the pixel to the edge within the overlapping
> > area.
> >
> > Now, is there an easy way I can get the same result using the
> > raster::mosaic function? Or is there another elegant way to achieve the
> > same using some other packages or functions?
> >
> > I'm grateful for any hints!
> >
> > Rafael
> >
> >
> > --
> > Rafael W?est
> > Swiss Federal Research Institute WSL
> > Z?rcherstrasse 111
> > 8903 Birmensdorf
> > Switzerland
> >
> > +41 44 7392126
> > rafael.wueest at wsl.ch
> > http://www.wsl.ch/info/mitarbeitende/wueest/index_EN
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
> 
>         [[alternative HTML version deleted]]
> 
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 
> 



--
Rafael W?est
Swiss Federal Research Institute WSL
Z?rcherstrasse 111
8903 Birmensdorf
Switzerland

+41 44 7392126
rafael.wueest at wsl.ch
http://www.wsl.ch/info/mitarbeitende/wueest/index_EN


From taylorjt at me.com  Thu Oct 25 19:33:57 2012
From: taylorjt at me.com (Taylor Turner)
Date: Thu, 25 Oct 2012 13:33:57 -0400
Subject: [R-sig-Geo] Trying to plot raster variance over time
References: <C4BC274D-15AF-4EE9-B8E9-01CEDC9654A1@mac.com>
Message-ID: <9AAC694F-20C9-49BE-8623-7BA47738A0C3@me.com>


> Hello R-masters, 
> I am relatively new to R and I am even newer to its use in GIS applications so please bear with me. I am currently using all available GIMMS of Africa (from '81 to '06) and I plan on plotting the mean NDVI variance of each month over the years (1981-2006) of several smaller ranges that I have cropped out and then stacked. Each stack consists of 600 rasters - 24 semimonthly GIMMS for 25 years. Here is my problem: after reading various examples it seems that I first need to assign a z value (using setZ I presume). How can I categorize the 600 rasters into months and assign z values? 
> 
> Thanks,
> T


From r.hijmans at gmail.com  Thu Oct 25 20:03:44 2012
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Thu, 25 Oct 2012 11:03:44 -0700
Subject: [R-sig-Geo] Trying to plot raster variance over time
In-Reply-To: <9AAC694F-20C9-49BE-8623-7BA47738A0C3@me.com>
References: <C4BC274D-15AF-4EE9-B8E9-01CEDC9654A1@mac.com>
	<9AAC694F-20C9-49BE-8623-7BA47738A0C3@me.com>
Message-ID: <CANtt_hx0Z3EqHFtbjqKXWchwkBiiSWVrsoOd==zBn_x4dGhPMQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121025/e8a76fe2/attachment.pl>

From c74gutierrez at gmail.com  Thu Oct 25 21:11:17 2012
From: c74gutierrez at gmail.com (c.gutierrez)
Date: Thu, 25 Oct 2012 12:11:17 -0700 (PDT)
Subject: [R-sig-Geo] areaint in Matlab vs. areaPolygon or areapl in R
In-Reply-To: <CANtt_hw8H7QtTiT96fEZcsMBTUs13NWbB7DczmRZEvTC9uqGWw@mail.gmail.com>
References: <1351184099050-7581399.post@n2.nabble.com>
	<CANtt_hw8H7QtTiT96fEZcsMBTUs13NWbB7DczmRZEvTC9uqGWw@mail.gmail.com>
Message-ID: <1351192277140-7581411.post@n2.nabble.com>

Using the self-contained example from ?areaPolygon:

p <- rbind(c(-180,-20), c(-140,55), c(10, 0), c(-140,-60), c(-180,-20))
library(geosphere)
areaPolygon(p)
#result in m^2
[1] 2.12582e+14 

Here is the parallel code in Matlab (requires Mapping Toolkit):

p=[-180 -20; -140 55; 10 0; -140 -60; -180 -20];
area=areaint(p(:,2),p(:,1),referenceEllipsoid('wgs84','km'))
%result in km^2
area = 2.524097207871018e+08

>>> The results are ~20% (~40 km^2) different.




--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/areaint-in-Matlab-vs-areaPolygon-or-areapl-in-R-tp7581399p7581411.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From c74gutierrez at gmail.com  Thu Oct 25 21:19:10 2012
From: c74gutierrez at gmail.com (c.gutierrez)
Date: Thu, 25 Oct 2012 12:19:10 -0700 (PDT)
Subject: [R-sig-Geo] areaint in Matlab vs. areaPolygon or areapl in R
In-Reply-To: <1351192277140-7581411.post@n2.nabble.com>
References: <1351184099050-7581399.post@n2.nabble.com>
	<CANtt_hw8H7QtTiT96fEZcsMBTUs13NWbB7DczmRZEvTC9uqGWw@mail.gmail.com>
	<1351192277140-7581411.post@n2.nabble.com>
Message-ID: <1351192750092-7581413.post@n2.nabble.com>

[correction]
>>> The results are ~20% (~40*10^6 km^2) different. 



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/areaint-in-Matlab-vs-areaPolygon-or-areapl-in-R-tp7581399p7581413.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From r.hijmans at gmail.com  Thu Oct 25 22:20:53 2012
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Thu, 25 Oct 2012 13:20:53 -0700
Subject: [R-sig-Geo] areaint in Matlab vs. areaPolygon or areapl in R
In-Reply-To: <1351192750092-7581413.post@n2.nabble.com>
References: <1351184099050-7581399.post@n2.nabble.com>
	<CANtt_hw8H7QtTiT96fEZcsMBTUs13NWbB7DczmRZEvTC9uqGWw@mail.gmail.com>
	<1351192277140-7581411.post@n2.nabble.com>
	<1351192750092-7581413.post@n2.nabble.com>
Message-ID: <CANtt_hxXVHzWEe9Ou8Vt_0J_Lw4=fn_jjwxApxTosr9p=kaFXQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121025/5fc0d5c9/attachment.pl>

From c74gutierrez at gmail.com  Thu Oct 25 23:44:19 2012
From: c74gutierrez at gmail.com (c.gutierrez)
Date: Thu, 25 Oct 2012 14:44:19 -0700 (PDT)
Subject: [R-sig-Geo] areaint in Matlab vs. areaPolygon or areapl in R
In-Reply-To: <CANtt_hxXVHzWEe9Ou8Vt_0J_Lw4=fn_jjwxApxTosr9p=kaFXQ@mail.gmail.com>
References: <1351184099050-7581399.post@n2.nabble.com>
	<CANtt_hw8H7QtTiT96fEZcsMBTUs13NWbB7DczmRZEvTC9uqGWw@mail.gmail.com>
	<1351192277140-7581411.post@n2.nabble.com>
	<1351192750092-7581413.post@n2.nabble.com>
	<CANtt_hxXVHzWEe9Ou8Vt_0J_Lw4=fn_jjwxApxTosr9p=kaFXQ@mail.gmail.com>
Message-ID: <1351201459889-7581417.post@n2.nabble.com>

I'm at a bit of a loss here, because if I test a real-life case, I get the
same results from the Online Geodesic Planimeter page you indicated as I get
from Matlab's areaint() = 162606.10366468679.

>From 
"Enter the vertices as latitude longitude pairs, one per line: "
36.96353 -0.4164187
36.96273 -0.4161722
36.96179 -0.4158859
36.96247 -0.4113503
36.96429 -0.4115961
36.96484 -0.4118041
36.96581 -0.4119622
36.96562 -0.4133627
36.96516 -0.4167762
36.96502 -0.4167687
36.96459 -0.4167097
36.96367 -0.4164608
36.96353 -0.4164187

Results:

    STATUS             = OK
    number of vertices = 13
    Perimeter (m)      = 1604.00781596
    area (m^2)         = 162516.702

This seems to suggest that it's the R function(s) that are off, if we take
Kearney's result to be the best approximation of the truth. Here's what I
get from the geosphere and splancs functions:
> areaPolygon(coords)
[1] 205029.5
 ... or ...
> areapl(coords.proj4m) #projected using "+proj=utm +zone=36 +ellps=clrk80
> +units=m +towgs84=-179.1,-44.7,-302.6 +no_defs"
[1] 203332.68



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/areaint-in-Matlab-vs-areaPolygon-or-areapl-in-R-tp7581399p7581417.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From r.hijmans at gmail.com  Fri Oct 26 00:29:16 2012
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Thu, 25 Oct 2012 15:29:16 -0700
Subject: [R-sig-Geo] areaint in Matlab vs. areaPolygon or areapl in R
In-Reply-To: <1351201459889-7581417.post@n2.nabble.com>
References: <1351184099050-7581399.post@n2.nabble.com>
	<CANtt_hw8H7QtTiT96fEZcsMBTUs13NWbB7DczmRZEvTC9uqGWw@mail.gmail.com>
	<1351192277140-7581411.post@n2.nabble.com>
	<1351192750092-7581413.post@n2.nabble.com>
	<CANtt_hxXVHzWEe9Ou8Vt_0J_Lw4=fn_jjwxApxTosr9p=kaFXQ@mail.gmail.com>
	<1351201459889-7581417.post@n2.nabble.com>
Message-ID: <CANtt_hxYvoK-U+R0qzLiyMtj3BMi13wpX+7EMB4hbzJLmQp9mg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121025/5e31b472/attachment.pl>

From c74gutierrez at gmail.com  Fri Oct 26 02:25:07 2012
From: c74gutierrez at gmail.com (c.gutierrez)
Date: Thu, 25 Oct 2012 17:25:07 -0700 (PDT)
Subject: [R-sig-Geo] areaint in Matlab vs. areaPolygon or areapl in R
In-Reply-To: <CANtt_hxYvoK-U+R0qzLiyMtj3BMi13wpX+7EMB4hbzJLmQp9mg@mail.gmail.com>
References: <1351184099050-7581399.post@n2.nabble.com>
	<CANtt_hw8H7QtTiT96fEZcsMBTUs13NWbB7DczmRZEvTC9uqGWw@mail.gmail.com>
	<1351192277140-7581411.post@n2.nabble.com>
	<1351192750092-7581413.post@n2.nabble.com>
	<CANtt_hxXVHzWEe9Ou8Vt_0J_Lw4=fn_jjwxApxTosr9p=kaFXQ@mail.gmail.com>
	<1351201459889-7581417.post@n2.nabble.com>
	<CANtt_hxYvoK-U+R0qzLiyMtj3BMi13wpX+7EMB4hbzJLmQp9mg@mail.gmail.com>
Message-ID: <1351211107184-7581421.post@n2.nabble.com>

Thanks for pointing this out. Actually, my input to R was correct (lon, lat)
but the Matlab input should have been reversed (lat,lon); same for the
Kearney calculation. The 13-vertices example is from a location in Africa,
by the way -- east of Greenwich (+lon) and south of the equator (-lat).

When I re-ran the matrix in reverse column order, I got:
> areaPolygon(coords.r)
[1] 162299.1
-- which is <1% different from the Matlab result.

Or put another way, the correct result per Kearney for the 13-vertices
polygon is 202408.079 m^2 and <1% different from the R result(s).

Thanks again.



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/areaint-in-Matlab-vs-areaPolygon-or-areapl-in-R-tp7581399p7581421.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From l.hilger at ku.de  Fri Oct 26 09:44:46 2012
From: l.hilger at ku.de (Ludwig Hilger)
Date: Fri, 26 Oct 2012 09:44:46 +0200
Subject: [R-sig-Geo] RSAGA issues
Message-ID: <508A3F6E.8070508@ku.de>


Dear list,

I am comparatively new to RSAGA and have come across three problems I 
have not been able solve by searching on the internet. Your help would 
be very much appreciated. This is SAGA 2.0.8 and R 2.15.1.

1. Is there a way to access the header of a *.sgrd without having to 
load the whole grid, i.e. not using read.sgrd()$header? I want to 
determine the cellsize of a *.sgrd from within r for informational 
purposes and I have 1 m grids with 62 km2.....

-------------------------------------------------------------------------------

2. I have tried to call the Grid sum module in the following way:
     rsaga.geoprocessor(
     lib = ?grid_calculus?,
     module = 8,
     param = list(
     GRIDS = list(?t_elev_class.sgrd?, ?t_asp_class.sgrd?),
     RESULT = ?t_codes?
     		)
     )

I get the following error, i.e. arguments of the function seem to get 
mixed up:

?library path: C:Program Files (x86)SAGA-GIS_2.0.8/modules
library name: grid_calculus
module name : Grids Sum
author : O. Conrad (c) 2010

Load grid: t_codes...

failed

error: Grid file could not be opened.

error: input file t_codes

error: empty input list GRIDS
Usage: 8 -GRIDS -RESULT
-GRIDS: Grids
Grid list (input)
-RESULT: Sum
Grid (output)

error: executing module Grids Sum
Warnmeldung:
Ausf?hrung von Kommando '"C:Program Files 
(x86)SAGA-GIS_2.0.8/saga_cmd.exe" grid_calculus 8 -GRIDS 
"t_elev_class.sgrd" -RESULT "t_asp_class.sgrd" -GRIDS "t_codes"' ergab 
Status 1?

I have also tried c() instead of list() for the GRID-argument, I have 
moeved GRID out of the param-list, etc. . In contrast, 
rsaga.grid.calculus() works fine. I seem to have the same problem with 
other modules as well, probably I do not provide the input grids in the 
right way?

-------------------------------------------------------------------------------

3.
a) When I resample a grid, I have to provide USER_YMIN, USER_XMIN, 
USER_XMAX and USER_YMAX. Is there a way to automatically calculate these 
values from the input DEM header and the cellsize selected for 
resampling (as SAGA seems to do in the GUI)?
b) If I want to use a target grid as a model for the new grid, where is 
this to be specified? rsaga.get.usage("grid_tools", 0) gives me only the 
options GRID_GRID and USER_GRID (which are output arguments according to 
get.usage). There are no arguments for the path to the target grid.

thank you,
Ludwig
-- 
Dipl. Geogr. Ludwig Hilger
Wiss. MA
Lehrstuhl f?r Physische Geographie
Katholische Universit?t Eichst?tt-Ingolstadt
Ostenstra?e 18
85072 Eichst?tt

Tel.: 08421-93-1180


From jeandaniel.sylvain at gmail.com  Fri Oct 26 13:40:54 2012
From: jeandaniel.sylvain at gmail.com (Jean-Daniel Sylvain)
Date: Fri, 26 Oct 2012 07:40:54 -0400
Subject: [R-sig-Geo] RSAGA issues
In-Reply-To: <508A3F6E.8070508@ku.de>
References: <508A3F6E.8070508@ku.de>
Message-ID: <508A76C6.5070203@gmail.com>

Hi,

For point /1 use this command:

library(rgdal)
image <- 
"E:/IRDA/Automatisation/ScriptDevelopment/data/PredictionProprietesSol/Ref_L5_20000521_IBN7c.sdat"
info <- try(GDALinfo(image), silent = TRUE)


For point 2:

You need to add extension to your 't_codes.sgrd'.

rsaga.geoprocessor(lib="grid_calculus",module=1, 
param=list(GRIDS=InputGridCalc,RESULT=CalcGrid, FORMULA="a+b/2"),env=myenv)


For point 3

a) Use GDALinfo like in point 1 and extract the extent of your file.

b) I'm not sure about what is your problem.

Hope this help.

Jean-Daniel


Le 26/10/2012 3:44 AM, Ludwig Hilger a ?crit :
>
> Dear list,
>
> I am comparatively new to RSAGA and have come across three problems I 
> have not been able solve by searching on the internet. Your help would 
> be very much appreciated. This is SAGA 2.0.8 and R 2.15.1.
>
> 1. Is there a way to access the header of a *.sgrd without having to 
> load the whole grid, i.e. not using read.sgrd()$header? I want to 
> determine the cellsize of a *.sgrd from within r for informational 
> purposes and I have 1 m grids with 62 km2.....
>
> ------------------------------------------------------------------------------- 
>
>
> 2. I have tried to call the Grid sum module in the following way:
>     rsaga.geoprocessor(
>     lib = ?grid_calculus?,
>     module = 8,
>     param = list(
>     GRIDS = list(?t_elev_class.sgrd?, ?t_asp_class.sgrd?),
>     RESULT = ?t_codes?
>             )
>     )
>
> I get the following error, i.e. arguments of the function seem to get 
> mixed up:
>
> ?library path: C:Program Files (x86)SAGA-GIS_2.0.8/modules
> library name: grid_calculus
> module name : Grids Sum
> author : O. Conrad (c) 2010
>
> Load grid: t_codes...
>
> failed
>
> error: Grid file could not be opened.
>
> error: input file t_codes
>
> error: empty input list GRIDS
> Usage: 8 -GRIDS -RESULT
> -GRIDS: Grids
> Grid list (input)
> -RESULT: Sum
> Grid (output)
>
> error: executing module Grids Sum
> Warnmeldung:
> Ausf?hrung von Kommando '"C:Program Files 
> (x86)SAGA-GIS_2.0.8/saga_cmd.exe" grid_calculus 8 -GRIDS 
> "t_elev_class.sgrd" -RESULT "t_asp_class.sgrd" -GRIDS "t_codes"' ergab 
> Status 1?
>
> I have also tried c() instead of list() for the GRID-argument, I have 
> moeved GRID out of the param-list, etc. . In contrast, 
> rsaga.grid.calculus() works fine. I seem to have the same problem with 
> other modules as well, probably I do not provide the input grids in 
> the right way?
>
> ------------------------------------------------------------------------------- 
>
>
> 3.
> a) When I resample a grid, I have to provide USER_YMIN, USER_XMIN, 
> USER_XMAX and USER_YMAX. Is there a way to automatically calculate 
> these values from the input DEM header and the cellsize selected for 
> resampling (as SAGA seems to do in the GUI)?
> b) If I want to use a target grid as a model for the new grid, where 
> is this to be specified? rsaga.get.usage("grid_tools", 0) gives me 
> only the options GRID_GRID and USER_GRID (which are output arguments 
> according to get.usage). There are no arguments for the path to the 
> target grid.
>
> thank you,
> Ludwig


-- 
Jean-Daniel Sylvain
Consultant en mod?lisation et analyse spatiale (R&D)
215, rue Alleyn
Qu?bec, Qu?bec
G1K4T7
T. 418-523-7253
P. 418-809-1958

-------------- next part --------------
A non-text attachment was scrubbed...
Name: jeandaniel_sylvain.vcf
Type: text/x-vcard
Size: 386 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121026/53412fe5/attachment.vcf>

From ptitle at umich.edu  Fri Oct 26 16:19:59 2012
From: ptitle at umich.edu (Pascal Title)
Date: Fri, 26 Oct 2012 10:19:59 -0400
Subject: [R-sig-Geo] layer name in writeRaster
Message-ID: <CAPSA=ycXc9Abs3puQX65e69u-AMEnF=1a-wgLf06h2FF6Yt4gg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121026/04effa99/attachment.pl>

From Tom_Roche at pobox.com  Fri Oct 26 19:35:53 2012
From: Tom_Roche at pobox.com (Tom Roche)
Date: Fri, 26 Oct 2012 13:35:53 -0400
Subject: [R-sig-Geo] [raster] unexpected write behavior with writeRaster,
	projectRaster
Message-ID: <87ip9xnnk6.fsf@pobox.com>


Noticing an unwelcome similarity between writeRaster and projectRaster:

https://stat.ethz.ch/pipermail/r-sig-geo/2012-October/016523.html
> Here I show the raster object, I then define the name, and then I
> write it to disk. You can see that the layer name switches back to
> "layer".

> > comb
> class       : RasterLayer
> dimensions  : 7200, 7200, 51840000  (nrow, ncol, ncell)
> resolution  : 0.008333333, 0.008333333  (x, y)
> extent      : -150, -90, 30, 90  (xmin, xmax, ymin, ymax)
> coord. ref. : +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0
> data source :
> /private/var/folders/4t/f1r24pf90d724kpr9m7bpl640000gp/T/R_raster_tmp/Pascal/raster_tmp_2012-10-26_101222_71239.grd

> names       : layer
> values      : -290, 239  (min, max)

> > names(comb)<-'bio1'
> > comb
> class       : RasterLayer
> dimensions  : 7200, 7200, 51840000  (nrow, ncol, ncell)
> resolution  : 0.008333333, 0.008333333  (x, y)
> extent      : -150, -90, 30, 90  (xmin, xmax, ymin, ymax)
> coord. ref. : +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0
> data source :
> /private/var/folders/4t/f1r24pf90d724kpr9m7bpl640000gp/T/R_raster_tmp/Pascal/raster_tmp_2012-10-26_101222_71239.grd

> names       : bio1
> values      : -290, 239  (min, max)

> > writeRaster(comb,filename='/Users/Pascal/Desktop/bio1.grd')
> class       : RasterLayer
> dimensions  : 7200, 7200, 51840000  (nrow, ncol, ncell)
> resolution  : 0.008333333, 0.008333333  (x, y)
> extent      : -150, -90, 30, 90  (xmin, xmax, ymin, ymax)
> coord. ref. : +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0
> data source : /Users/Pascal/Desktop/bio1.grd
> names       : layer
> values      : -290, 239  (min, max)

I see a similar bug with projectRaster: the output CRS is longlat
(presumably the default), even if *both* the extents object ('to')
used to create it is projected (i.e., has a non-longlat CRS), *and*
I pass the desired CRS to projectRaster(...), although the crs slot in
the written netCDF is correct:

> out.crs
[1] "+proj=lcc +lat_1=33 +lat_2=45 +lat_0=40 +lon_0=-97 +x_0=-2556000 +y_0=-1728000"
> template.in.raster <- raster(template.in.fp, varname=data.var.name, band=template.band)
> template.raster <- projectExtent(template.in.raster, crs=out.crs)
Warning message:
In projectExtent(template.in.raster, crs = out.crs) :
  158 projected point(s) not finite

Is that "projected point(s) not finite" warning important?
Probably not, per Hijmans.

> template.raster
class       : RasterLayer 
dimensions  : 299, 459, 137241  (nrow, ncol, ncell)
resolution  : 53369.55, 56883.69  (x, y)
extent      : -14802449, 9694173, -6258782, 10749443  (xmin, xmax, ymin, ymax)
coord. ref. : +proj=lcc +lat_1=33 +lat_2=45 +lat_0=40 +lon_0=-97 +x_0=-2556000 +y_0=-1728000 +ellps=WGS84 

That is the correct CRS. Just to be sure,

> template.raster at crs
CRS arguments:
 +proj=lcc +lat_1=33 +lat_2=45 +lat_0=40 +lon_0=-97 +x_0=-2556000
+y_0=-1728000 +ellps=WGS84 

> out.raster <-
+   projectRaster(
+     from=in.raster, to=template.raster, method='bilinear', crs=out.crs,
+     overwrite=TRUE, progress='window', format='CDF',
+     # args from writeRaster
+     NAflag=-999.0,  # match emi_n2o:missing_value,_FillValue (TODO: copy)
+     varname=data.var.name, 
+     varunit='ton N2O-N/yr',
+     longname='N2O emissions',
+     xname='COL',
+     yname='ROW',
+     filename=out.fp)
> out.raster
class       : RasterLayer 
dimensions  : 299, 459, 137241  (nrow, ncol, ncell)
resolution  : 53369.55, 56883.69  (x, y)
extent      : -14802449, 9694173, -6258782, 10749443  (xmin, xmax, ymin, ymax)
coord. ref. : +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0 
data source : /path/to/GEIA_N2O_oceanic_regrid.nc 
names       : N2O.emissions 
zvar        : emi_n2o 

That CRS is incorrect, but ...

> system(sprintf('ncdump -h %s', out.fp))
...
    float emi_n2o(ROW, COL) ;
      emi_n2o:units = "ton N2O-N/yr" ;
      emi_n2o:_FillValue = -999. ;
      emi_n2o:missing_value = -999. ;
      emi_n2o:long_name = "N2O emissions" ;
      emi_n2o:projection = "+proj=lcc +lat_1=33 +lat_2=45 +lat_0=40 +lon_0=-97 +x_0=-2556000 +y_0=-1728000 +ellps=WGS84" ;

... that CRS is correct. Inspecting the out.raster CRS,

> out.raster at crs
CRS arguments:
 +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0 
> out.raster at crs <- CRS(out.crs)
> out.raster
class       : RasterLayer 
dimensions  : 299, 459, 137241  (nrow, ncol, ncell)
resolution  : 53369.55, 56883.69  (x, y)
extent      : -14802449, 9694173, -6258782, 10749443  (xmin, xmax, ymin, ymax)
coord. ref. : +proj=lcc +lat_1=33 +lat_2=45 +lat_0=40 +lon_0=-97 +x_0=-2556000 +y_0=-1728000 +ellps=WGS84 
data source : /path/to/GEIA_N2O_oceanic_regrid.nc 
names       : N2O.emissions 
zvar        : emi_n2o 

Unfortunately fixing out.raster's CRS does not fix the problem with
raster::plot-ing it: plot output still has incorrect (global) extents,
as described @

https://stat.ethz.ch/pipermail/r-sig-geo/2012-October/016504.html

FWIW, Tom Roche <Tom_Roche at pobox.com>


From WSteenbeek at nscr.nl  Fri Oct 26 20:46:01 2012
From: WSteenbeek at nscr.nl (Wouter Steenbeek)
Date: Fri, 26 Oct 2012 20:46:01 +0200
Subject: [R-sig-Geo] gDistance on a LARGE Spatial Object?
Message-ID: <6F935AB43360774EB2A937510A67E5D310E9AF6C3A@exchsvr1.arthur.nscr.nl>

I am trying to use the "gDistance" from the "geos" package to calculate the Euclidean distance between a large number of points: to be exact, 28000 points.

I'm doing:
distance <- gDistance(points.sp) 

R doesn't run this on my 32-bit 3Gb RAM machine. The same function works on a subset of these points (say the first 400 points I call "points1_400.sp"). I think that R doesn't run on this is because gDistance keeps a matrix of 28000 * 28000 cells in RAM. With at one byte per cell, this amounts to 28000 * 28000 * 8 / (1024 bytes per Kb / 1024 Kb per Mb / 1024 Mb per Gb) = almost 6 Gb of RAM is needed.

1. Is my interpretation of the problem correct?

2. What would be the best way to tackle this problem? (chop up the points.sp into chunks, calculate distances per chunk, and then merge matrices together? I'm not sure how I can do that in R. Code examples of how to do is is appreciated)

From edzer.pebesma at uni-muenster.de  Fri Oct 26 21:25:09 2012
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Fri, 26 Oct 2012 21:25:09 +0200
Subject: [R-sig-Geo] gDistance on a LARGE Spatial Object?
In-Reply-To: <6F935AB43360774EB2A937510A67E5D310E9AF6C3A@exchsvr1.arthur.nscr.nl>
References: <6F935AB43360774EB2A937510A67E5D310E9AF6C3A@exchsvr1.arthur.nscr.nl>
Message-ID: <508AE395.20308@uni-muenster.de>



On 10/26/2012 08:46 PM, Wouter Steenbeek wrote:
> I am trying to use the "gDistance" from the "geos" package to calculate the Euclidean distance between a large number of points: to be exact, 28000 points.
> 
> I'm doing:
> distance <- gDistance(points.sp) 
> 
> R doesn't run this on my 32-bit 3Gb RAM machine. The same function works on a subset of these points (say the first 400 points I call "points1_400.sp"). I think that R doesn't run on this is because gDistance keeps a matrix of 28000 * 28000 cells in RAM. With at one byte per cell, this amounts to 28000 * 28000 * 8 / (1024 bytes per Kb / 1024 Kb per Mb / 1024 Mb per Gb) = almost 6 Gb of RAM is needed.
> 
> 1. Is my interpretation of the problem correct?

Yes.
> 
> 2. What would be the best way to tackle this problem? (chop up the points.sp into chunks, calculate distances per chunk, and then merge matrices together? I'm not sure how I can do that in R. Code examples of how to do is is appreciated)

It will not make the object smaller, so will be difficult anyway on your
3 Gb machine. As usual, there are two solutions:

1. don't think: buy a computer with (much) more RAM;

2. think: what do you want to do with all these distances, can  you get
there without having all distances in a single matrix at once?
-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From WSteenbeek at nscr.nl  Fri Oct 26 23:13:03 2012
From: WSteenbeek at nscr.nl (Wouter Steenbeek)
Date: Fri, 26 Oct 2012 23:13:03 +0200
Subject: [R-sig-Geo] gDistance on a LARGE Spatial Object?
In-Reply-To: <508AE395.20308@uni-muenster.de>
References: <6F935AB43360774EB2A937510A67E5D310E9AF6C3A@exchsvr1.arthur.nscr.nl>,
	<508AE395.20308@uni-muenster.de>
Message-ID: <6F935AB43360774EB2A937510A67E5D310E9AF6C3C@exchsvr1.arthur.nscr.nl>

Disregarding solution1 (;-)), let me give you a practical example where I (think I) really need the full matrix. Or more specifically, an example in which I use the function gWithinDistance (but the same memory issues apply here).

I have a points.sp object containing my units of analysis (e.g., 20000 centroids of streets). I also have a buildings.sp object containing the XY coordinates of all 30000 buildings in that area. I want to calculate for each street centroid how many buildings are located within a radius of 50 meters of that centroid.

So now I do:

newbuilding <- rowSums(gWithinDistance(buildings.sp,points.sp,50, byid=T, hausdorff=FALSE, densifyFrac=NULL))

However, this of course suffers from the same memory problem. I've tried your solution 2 "think: what do you want to do with all these distances, can you get there without having all distances in a single matrix at once?". But I can't think of anything. Any tips?

Cheers, Wouter


________________________________________
From: r-sig-geo-bounces at r-project.org [r-sig-geo-bounces at r-project.org] On Behalf Of Edzer Pebesma [edzer.pebesma at uni-muenster.de]
Sent: Friday, October 26, 2012 9:25 PM
To: r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] gDistance on a LARGE Spatial Object?

On 10/26/2012 08:46 PM, Wouter Steenbeek wrote:
> I am trying to use the "gDistance" from the "geos" package to calculate the Euclidean distance between a large number of points: to be exact, 28000 points.
>
> I'm doing:
> distance <- gDistance(points.sp)
>
> R doesn't run this on my 32-bit 3Gb RAM machine. The same function works on a subset of these points (say the first 400 points I call "points1_400.sp"). I think that R doesn't run on this is because gDistance keeps a matrix of 28000 * 28000 cells in RAM. With at one byte per cell, this amounts to 28000 * 28000 * 8 / (1024 bytes per Kb / 1024 Kb per Mb / 1024 Mb per Gb) = almost 6 Gb of RAM is needed.
>
> 1. Is my interpretation of the problem correct?

Yes.
>
> 2. What would be the best way to tackle this problem? (chop up the points.sp into chunks, calculate distances per chunk, and then merge matrices together? I'm not sure how I can do that in R. Code examples of how to do is is appreciated)

It will not make the object smaller, so will be difficult anyway on your
3 Gb machine. As usual, there are two solutions:

1. don't think: buy a computer with (much) more RAM;

2. think: what do you want to do with all these distances, can  you get
there without having all distances in a single matrix at once?
--
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From Roger.Bivand at nhh.no  Fri Oct 26 23:40:40 2012
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 26 Oct 2012 23:40:40 +0200 (CEST)
Subject: [R-sig-Geo] gDistance on a LARGE Spatial Object?
In-Reply-To: <6F935AB43360774EB2A937510A67E5D310E9AF6C3C@exchsvr1.arthur.nscr.nl>
References: <6F935AB43360774EB2A937510A67E5D310E9AF6C3A@exchsvr1.arthur.nscr.nl>,
	<508AE395.20308@uni-muenster.de>
	<6F935AB43360774EB2A937510A67E5D310E9AF6C3C@exchsvr1.arthur.nscr.nl>
Message-ID: <alpine.LRH.2.02.1210262319270.24927@reclus.nhh.no>

On Fri, 26 Oct 2012, Wouter Steenbeek wrote:

> Disregarding solution1 (;-)), let me give you a practical example where 
> I (think I) really need the full matrix. Or more specifically, an 
> example in which I use the function gWithinDistance (but the same memory 
> issues apply here).
>
> I have a points.sp object containing my units of analysis (e.g., 20000 
> centroids of streets). I also have a buildings.sp object containing the 
> XY coordinates of all 30000 buildings in that area. I want to calculate 
> for each street centroid how many buildings are located within a radius 
> of 50 meters of that centroid.
>
> So now I do:
>
> newbuilding <- rowSums(gWithinDistance(buildings.sp,points.sp,50, 
> byid=T, hausdorff=FALSE, densifyFrac=NULL))
>
> However, this of course suffers from the same memory problem. I've tried 
> your solution 2 "think: what do you want to do with all these distances, 
> can you get there without having all distances in a single matrix at 
> once?". But I can't think of anything. Any tips?

library(rgeos)
data(meuse)
coordinates(meuse) <- c("x", "y")
set.seed(1)
streets <- spsample(meuse, n=5000, type="random")
buildings <- spsample(meuse, n=6000, type="random")
res <- vector(mode="list", length=length(streets))
tic <- Sys.time()
for (i in 1:length(streets)) {
  buf <- gBuffer(streets[1], width=50)
  res[[i]] <- which(!is.na(over(buildings, buf)))
}
Sys.time() - tic
# 10 seconds, will be more for your data sizes
library(fortunes)
fortune("Yoda")

Roger

>
> Cheers, Wouter
>
>
> ________________________________________
> From: r-sig-geo-bounces at r-project.org [r-sig-geo-bounces at r-project.org] On Behalf Of Edzer Pebesma [edzer.pebesma at uni-muenster.de]
> Sent: Friday, October 26, 2012 9:25 PM
> To: r-sig-geo at r-project.org
> Subject: Re: [R-sig-Geo] gDistance on a LARGE Spatial Object?
>
> On 10/26/2012 08:46 PM, Wouter Steenbeek wrote:
>> I am trying to use the "gDistance" from the "geos" package to calculate the Euclidean distance between a large number of points: to be exact, 28000 points.
>>
>> I'm doing:
>> distance <- gDistance(points.sp)
>>
>> R doesn't run this on my 32-bit 3Gb RAM machine. The same function works on a subset of these points (say the first 400 points I call "points1_400.sp"). I think that R doesn't run on this is because gDistance keeps a matrix of 28000 * 28000 cells in RAM. With at one byte per cell, this amounts to 28000 * 28000 * 8 / (1024 bytes per Kb / 1024 Kb per Mb / 1024 Mb per Gb) = almost 6 Gb of RAM is needed.
>>
>> 1. Is my interpretation of the problem correct?
>
> Yes.
>>
>> 2. What would be the best way to tackle this problem? (chop up the points.sp into chunks, calculate distances per chunk, and then merge matrices together? I'm not sure how I can do that in R. Code examples of how to do is is appreciated)
>
> It will not make the object smaller, so will be difficult anyway on your
> 3 Gb machine. As usual, there are two solutions:
>
> 1. don't think: buy a computer with (much) more RAM;
>
> 2. think: what do you want to do with all these distances, can  you get
> there without having all distances in a single matrix at once?
> --
> Edzer Pebesma
> Institute for Geoinformatics (ifgi), University of M?nster
> Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
> 8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
> http://www.52north.org/geostatistics      e.pebesma at wwu.de
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From Roger.Bivand at nhh.no  Fri Oct 26 23:47:00 2012
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 26 Oct 2012 23:47:00 +0200 (CEST)
Subject: [R-sig-Geo] gDistance on a LARGE Spatial Object?
In-Reply-To: <alpine.LRH.2.02.1210262319270.24927@reclus.nhh.no>
References: <6F935AB43360774EB2A937510A67E5D310E9AF6C3A@exchsvr1.arthur.nscr.nl>,
	<508AE395.20308@uni-muenster.de>
	<6F935AB43360774EB2A937510A67E5D310E9AF6C3C@exchsvr1.arthur.nscr.nl>
	<alpine.LRH.2.02.1210262319270.24927@reclus.nhh.no>
Message-ID: <alpine.LRH.2.02.1210262344430.24927@reclus.nhh.no>

On Fri, 26 Oct 2012, Roger Bivand wrote:

> On Fri, 26 Oct 2012, Wouter Steenbeek wrote:
>
>> Disregarding solution1 (;-)), let me give you a practical example where I 
>> (think I) really need the full matrix. Or more specifically, an example in 
>> which I use the function gWithinDistance (but the same memory issues apply 
>> here).
>> 
>> I have a points.sp object containing my units of analysis (e.g., 20000 
>> centroids of streets). I also have a buildings.sp object containing the XY 
>> coordinates of all 30000 buildings in that area. I want to calculate for 
>> each street centroid how many buildings are located within a radius of 50 
>> meters of that centroid.
>> 
>> So now I do:
>> 
>> newbuilding <- rowSums(gWithinDistance(buildings.sp,points.sp,50, byid=T, 
>> hausdorff=FALSE, densifyFrac=NULL))
>> 
>> However, this of course suffers from the same memory problem. I've tried 
>> your solution 2 "think: what do you want to do with all these distances, 
>> can you get there without having all distances in a single matrix at 
>> once?". But I can't think of anything. Any tips?
>
> library(rgeos)
> data(meuse)
> coordinates(meuse) <- c("x", "y")
> set.seed(1)
> streets <- spsample(meuse, n=5000, type="random")
> buildings <- spsample(meuse, n=6000, type="random")
> res <- vector(mode="list", length=length(streets))
> tic <- Sys.time()
> for (i in 1:length(streets)) {
> buf <- gBuffer(streets[1], width=50)

  buf <- gBuffer(streets[i], width=50)

Sorry! Now 16 seconds - add library(rgeos) first too.

Roger

> res[[i]] <- which(!is.na(over(buildings, buf)))
> }
> Sys.time() - tic
> # 10 seconds, will be more for your data sizes
> library(fortunes)
> fortune("Yoda")
>
> Roger
>
>> 
>> Cheers, Wouter
>> 
>> 
>> ________________________________________
>> From: r-sig-geo-bounces at r-project.org [r-sig-geo-bounces at r-project.org] On 
>> Behalf Of Edzer Pebesma [edzer.pebesma at uni-muenster.de]
>> Sent: Friday, October 26, 2012 9:25 PM
>> To: r-sig-geo at r-project.org
>> Subject: Re: [R-sig-Geo] gDistance on a LARGE Spatial Object?
>> 
>> On 10/26/2012 08:46 PM, Wouter Steenbeek wrote:
>>> I am trying to use the "gDistance" from the "geos" package to calculate 
>>> the Euclidean distance between a large number of points: to be exact, 
>>> 28000 points.
>>> 
>>> I'm doing:
>>> distance <- gDistance(points.sp)
>>> 
>>> R doesn't run this on my 32-bit 3Gb RAM machine. The same function works 
>>> on a subset of these points (say the first 400 points I call 
>>> "points1_400.sp"). I think that R doesn't run on this is because gDistance 
>>> keeps a matrix of 28000 * 28000 cells in RAM. With at one byte per cell, 
>>> this amounts to 28000 * 28000 * 8 / (1024 bytes per Kb / 1024 Kb per Mb / 
>>> 1024 Mb per Gb) = almost 6 Gb of RAM is needed.
>>> 
>>> 1. Is my interpretation of the problem correct?
>> 
>> Yes.
>>> 
>>> 2. What would be the best way to tackle this problem? (chop up the 
>>> points.sp into chunks, calculate distances per chunk, and then merge 
>>> matrices together? I'm not sure how I can do that in R. Code examples of 
>>> how to do is is appreciated)
>> 
>> It will not make the object smaller, so will be difficult anyway on your
>> 3 Gb machine. As usual, there are two solutions:
>> 
>> 1. don't think: buy a computer with (much) more RAM;
>> 
>> 2. think: what do you want to do with all these distances, can  you get
>> there without having all distances in a single matrix at once?
>> --
>> Edzer Pebesma
>> Institute for Geoinformatics (ifgi), University of M?nster
>> Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
>> 8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
>> http://www.52north.org/geostatistics      e.pebesma at wwu.de
>> 
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> 
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> 
>
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From WSteenbeek at nscr.nl  Sat Oct 27 00:06:33 2012
From: WSteenbeek at nscr.nl (Wouter Steenbeek)
Date: Sat, 27 Oct 2012 00:06:33 +0200
Subject: [R-sig-Geo] gDistance on a LARGE Spatial Object?
In-Reply-To: <alpine.LRH.2.02.1210262344430.24927@reclus.nhh.no>
References: <6F935AB43360774EB2A937510A67E5D310E9AF6C3A@exchsvr1.arthur.nscr.nl>,
	<508AE395.20308@uni-muenster.de>
	<6F935AB43360774EB2A937510A67E5D310E9AF6C3C@exchsvr1.arthur.nscr.nl>
	<alpine.LRH.2.02.1210262319270.24927@reclus.nhh.no>,
	<alpine.LRH.2.02.1210262344430.24927@reclus.nhh.no>
Message-ID: <6F935AB43360774EB2A937510A67E5D310E9AF6C3E@exchsvr1.arthur.nscr.nl>

About 15.5 seconds here. This is awesome, thanks!!


________________________________________
From: Roger Bivand [Roger.Bivand at nhh.no]
Sent: Friday, October 26, 2012 11:47 PM
To: Wouter Steenbeek
Cc: r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] gDistance on a LARGE Spatial Object?

On Fri, 26 Oct 2012, Roger Bivand wrote:

> On Fri, 26 Oct 2012, Wouter Steenbeek wrote:
>
>> Disregarding solution1 (;-)), let me give you a practical example where I
>> (think I) really need the full matrix. Or more specifically, an example in
>> which I use the function gWithinDistance (but the same memory issues apply
>> here).
>>
>> I have a points.sp object containing my units of analysis (e.g., 20000
>> centroids of streets). I also have a buildings.sp object containing the XY
>> coordinates of all 30000 buildings in that area. I want to calculate for
>> each street centroid how many buildings are located within a radius of 50
>> meters of that centroid.
>>
>> So now I do:
>>
>> newbuilding <- rowSums(gWithinDistance(buildings.sp,points.sp,50, byid=T,
>> hausdorff=FALSE, densifyFrac=NULL))
>>
>> However, this of course suffers from the same memory problem. I've tried
>> your solution 2 "think: what do you want to do with all these distances,
>> can you get there without having all distances in a single matrix at
>> once?". But I can't think of anything. Any tips?
>
> library(rgeos)
> data(meuse)
> coordinates(meuse) <- c("x", "y")
> set.seed(1)
> streets <- spsample(meuse, n=5000, type="random")
> buildings <- spsample(meuse, n=6000, type="random")
> res <- vector(mode="list", length=length(streets))
> tic <- Sys.time()
> for (i in 1:length(streets)) {
> buf <- gBuffer(streets[1], width=50)

  buf <- gBuffer(streets[i], width=50)

Sorry! Now 16 seconds - add library(rgeos) first too.

Roger

> res[[i]] <- which(!is.na(over(buildings, buf)))
> }
> Sys.time() - tic
> # 10 seconds, will be more for your data sizes
> library(fortunes)
> fortune("Yoda")
>
> Roger
>
>>
>> Cheers, Wouter
>>
>>
>> ________________________________________
>> From: r-sig-geo-bounces at r-project.org [r-sig-geo-bounces at r-project.org] On
>> Behalf Of Edzer Pebesma [edzer.pebesma at uni-muenster.de]
>> Sent: Friday, October 26, 2012 9:25 PM
>> To: r-sig-geo at r-project.org
>> Subject: Re: [R-sig-Geo] gDistance on a LARGE Spatial Object?
>>
>> On 10/26/2012 08:46 PM, Wouter Steenbeek wrote:
>>> I am trying to use the "gDistance" from the "geos" package to calculate
>>> the Euclidean distance between a large number of points: to be exact,
>>> 28000 points.
>>>
>>> I'm doing:
>>> distance <- gDistance(points.sp)
>>>
>>> R doesn't run this on my 32-bit 3Gb RAM machine. The same function works
>>> on a subset of these points (say the first 400 points I call
>>> "points1_400.sp"). I think that R doesn't run on this is because gDistance
>>> keeps a matrix of 28000 * 28000 cells in RAM. With at one byte per cell,
>>> this amounts to 28000 * 28000 * 8 / (1024 bytes per Kb / 1024 Kb per Mb /
>>> 1024 Mb per Gb) = almost 6 Gb of RAM is needed.
>>>
>>> 1. Is my interpretation of the problem correct?
>>
>> Yes.
>>>
>>> 2. What would be the best way to tackle this problem? (chop up the
>>> points.sp into chunks, calculate distances per chunk, and then merge
>>> matrices together? I'm not sure how I can do that in R. Code examples of
>>> how to do is is appreciated)
>>
>> It will not make the object smaller, so will be difficult anyway on your
>> 3 Gb machine. As usual, there are two solutions:
>>
>> 1. don't think: buy a computer with (much) more RAM;
>>
>> 2. think: what do you want to do with all these distances, can  you get
>> there without having all distances in a single matrix at once?
>> --
>> Edzer Pebesma
>> Institute for Geoinformatics (ifgi), University of M?nster
>> Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
>> 8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
>> http://www.52north.org/geostatistics      e.pebesma at wwu.de
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>

--
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From moshersteven at gmail.com  Sat Oct 27 00:42:55 2012
From: moshersteven at gmail.com (steven mosher)
Date: Fri, 26 Oct 2012 15:42:55 -0700
Subject: [R-sig-Geo] gDistance on a LARGE Spatial Object?
In-Reply-To: <6F935AB43360774EB2A937510A67E5D310E9AF6C3A@exchsvr1.arthur.nscr.nl>
References: <6F935AB43360774EB2A937510A67E5D310E9AF6C3A@exchsvr1.arthur.nscr.nl>
Message-ID: <CAFFLneSJ-8XJVU5UxzUTDQOs_fmyfjcQ2KB5Q92JDJaQjYS3rw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121026/1ddffe7b/attachment.pl>

From r.hijmans at gmail.com  Sat Oct 27 07:25:33 2012
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Fri, 26 Oct 2012 22:25:33 -0700
Subject: [R-sig-Geo] layer name in writeRaster
In-Reply-To: <CAPSA=ycXc9Abs3puQX65e69u-AMEnF=1a-wgLf06h2FF6Yt4gg@mail.gmail.com>
References: <CAPSA=ycXc9Abs3puQX65e69u-AMEnF=1a-wgLf06h2FF6Yt4gg@mail.gmail.com>
Message-ID: <CANtt_hzdDJm_NSzG-18OC8EbH6HcUiRLh4tchwS2pdVwj82xkg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121026/3a68925f/attachment.pl>

From rafael.wueest at wsl.ch  Sat Oct 27 16:09:08 2012
From: rafael.wueest at wsl.ch (=?iso-8859-1?Q?Rafael_W=FCest?=)
Date: Sat, 27 Oct 2012 16:09:08 +0200
Subject: [R-sig-Geo] projection for image processing
Message-ID: <CB71ED1B-1475-4135-9EAA-77369F1DEDE7@wsl.ch>

Dear List

I'm trying to do some image processing with the help of the raster package. I'm getting close to what I need. However, the last step involves raster::rastreToPolygons, with the option dissolve=T. That's where I'm running into an error: 

> Error in function (classes, fdef, mtable) : unable to find an inherited method for function "proj4string", for signature "NULL"

I figured out that the rgeos function gUnaryUnion is called in the background and requires the raster to be projected. Well, my raster is not projected, it's a jpeg image. Is there a projection I can use for this or does anyone see a workaround?

Here is a small reproducible example:
library(raster)
m<-matrix(NA,50,50)
r<-raster(m,xmn=0,xmx=ncol(m),ymn=0,ymx=nrow(m))
r[]<-runif(ncell(r),1,100)
clmps<-clump(r<20)
polys<-rasterToPolygons(clmps,dissolve=T)

My sessionInfo() output:
> R version 2.14.2 (2012-02-29)
> Platform: x86_64-apple-darwin9.8.0/x86_64 (64-bit)
> 
> locale:
> [1] de_CH.UTF-8/de_CH.UTF-8/de_CH.UTF-8/C/de_CH.UTF-8/de_CH.UTF-8
> 
> attached base packages:
> [1] tcltk     tools     stats     graphics  grDevices utils     datasets  methods  
> [9] base     
> 
> other attached packages:
> [1] rgeos_0.2-7     plyr_1.7.1      stringr_0.6     igraph0_0.5.5-2 rgdal_0.7-8    
> [6] raster_2.0-08   sp_0.9-99       SciViews_0.9-2  ellipse_0.3-7   MASS_7.3-17    
> [11] svGUI_0.9-50    svSocket_0.9-53 svMisc_0.9-65  
> 
> loaded via a namespace (and not attached):
> [1] grid_2.14.2    lattice_0.20-6

Any help is greatly appreciated,
Rafael


--
Rafael W?est
Swiss Federal Research Institute WSL
Z?rcherstrasse 111
8903 Birmensdorf
Switzerland

+41 44 7392126
rafael.wueest at wsl.ch
http://www.wsl.ch/info/mitarbeitende/wueest/index_EN


From b.rowlingson at lancaster.ac.uk  Sat Oct 27 17:28:51 2012
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Sat, 27 Oct 2012 16:28:51 +0100
Subject: [R-sig-Geo] projection for image processing
In-Reply-To: <a823078006f548359e145842fc508178@EX-0-HT0.lancs.local>
References: <a823078006f548359e145842fc508178@EX-0-HT0.lancs.local>
Message-ID: <CANVKczNQMBz=DOMMou393n4vZ4-+yBQXO7gdSjYU+qEA9+jm5Q@mail.gmail.com>

On Sat, Oct 27, 2012 at 3:09 PM, Rafael W?est <rafael.wueest at wsl.ch> wrote:
>
>> [1] grid_2.14.2    lattice_0.20-6

Any cartesian grid system will probably do. If you set it to
epsg:27700 then it will effectively be an nrow metres by ncols metres
grid somewhere off the coast of Cornwall, UK. This is the British
National Grid projection.

 I think in raster package speak that would be:

projection(r)="+init=epsg:27700"

I also think there are official cartesian grid system codes in the
epsg database somewhere...

Barry


From r.hijmans at gmail.com  Sat Oct 27 17:53:56 2012
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Sat, 27 Oct 2012 08:53:56 -0700
Subject: [R-sig-Geo] projection for image processing
In-Reply-To: <CB71ED1B-1475-4135-9EAA-77369F1DEDE7@wsl.ch>
References: <CB71ED1B-1475-4135-9EAA-77369F1DEDE7@wsl.ch>
Message-ID: <CANtt_hzT2mZvtT9mN6Q9+jK1PMV=uEEeqYCzYo9dZjwNV-_o3g@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121027/c4ee2b50/attachment.pl>

From rafael.wueest at wsl.ch  Sat Oct 27 18:25:17 2012
From: rafael.wueest at wsl.ch (=?iso-8859-1?Q?Rafael_W=FCest?=)
Date: Sat, 27 Oct 2012 18:25:17 +0200
Subject: [R-sig-Geo] projection for image processing
In-Reply-To: <CANtt_hzT2mZvtT9mN6Q9+jK1PMV=uEEeqYCzYo9dZjwNV-_o3g@mail.gmail.com>
References: <CB71ED1B-1475-4135-9EAA-77369F1DEDE7@wsl.ch>
	<CANtt_hzT2mZvtT9mN6Q9+jK1PMV=uEEeqYCzYo9dZjwNV-_o3g@mail.gmail.com>
Message-ID: <1C08C2E5-7B53-46D9-AF2A-0CE15019BC27@wsl.ch>

Robert and Barry

thank you very much! Updating raster to version 2.0-12 did the job!

Rafael

On 27.10.2012, at 17:53, Robert J. Hijmans wrote:

> Rafael, 
> 
> Your example works for me with raster 2.0-12 (on CRAN). As far as I know rgeos only gives warnings, not errors, about projections and you could turn that off with any projection description as it is not interpreted (except for lon/lat as it will warn about that). 
> 
> Robert
> 
> On Sat, Oct 27, 2012 at 7:09 AM, Rafael W?est <rafael.wueest at wsl.ch> wrote:
> Dear List
> 
> I'm trying to do some image processing with the help of the raster package. I'm getting close to what I need. However, the last step involves raster::rastreToPolygons, with the option dissolve=T. That's where I'm running into an error:
> 
> > Error in function (classes, fdef, mtable) : unable to find an inherited method for function "proj4string", for signature "NULL"
> 
> I figured out that the rgeos function gUnaryUnion is called in the background and requires the raster to be projected. Well, my raster is not projected, it's a jpeg image. Is there a projection I can use for this or does anyone see a workaround?
> 
> Here is a small reproducible example:
> library(raster)
> m<-matrix(NA,50,50)
> r<-raster(m,xmn=0,xmx=ncol(m),ymn=0,ymx=nrow(m))
> r[]<-runif(ncell(r),1,100)
> clmps<-clump(r<20)
> polys<-rasterToPolygons(clmps,dissolve=T)
> 
> My sessionInfo() output:
> > R version 2.14.2 (2012-02-29)
> > Platform: x86_64-apple-darwin9.8.0/x86_64 (64-bit)
> >
> > locale:
> > [1] de_CH.UTF-8/de_CH.UTF-8/de_CH.UTF-8/C/de_CH.UTF-8/de_CH.UTF-8
> >
> > attached base packages:
> > [1] tcltk     tools     stats     graphics  grDevices utils     datasets  methods
> > [9] base
> >
> > other attached packages:
> > [1] rgeos_0.2-7     plyr_1.7.1      stringr_0.6     igraph0_0.5.5-2 rgdal_0.7-8
> > [6] raster_2.0-08   sp_0.9-99       SciViews_0.9-2  ellipse_0.3-7   MASS_7.3-17
> > [11] svGUI_0.9-50    svSocket_0.9-53 svMisc_0.9-65
> >
> > loaded via a namespace (and not attached):
> > [1] grid_2.14.2    lattice_0.20-6
> 
> Any help is greatly appreciated,
> Rafael
> 
> 
> --
> Rafael W?est
> Swiss Federal Research Institute WSL
> Z?rcherstrasse 111
> 8903 Birmensdorf
> Switzerland
> 
> +41 44 7392126
> rafael.wueest at wsl.ch
> http://www.wsl.ch/info/mitarbeitende/wueest/index_EN
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 



--
Rafael W?est
Swiss Federal Research Institute WSL
Z?rcherstrasse 111
8903 Birmensdorf
Switzerland

+41 44 7392126
rafael.wueest at wsl.ch
http://www.wsl.ch/info/mitarbeitende/wueest/index_EN


From dpcollins at wsu.edu  Sun Oct 28 00:49:18 2012
From: dpcollins at wsu.edu (Collins, Douglas Parker)
Date: Sat, 27 Oct 2012 22:49:18 +0000
Subject: [R-sig-Geo] plot only cross variogram in gstat
Message-ID: <1F82F45497F86349B65E358ACFCCBDD619335D@EXMB-01.ad.wsu.edu>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121027/8dc6f065/attachment.pl>

From vrukol at gmail.com  Sun Oct 28 10:21:32 2012
From: vrukol at gmail.com (marco milella)
Date: Sun, 28 Oct 2012 10:21:32 +0100
Subject: [R-sig-Geo] ordinary kriging problem
Message-ID: <CAGmuAUqoPURw6j1uN9vUFex4hQtmvZgK9gRNutmGQ0dMPQRGAQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121028/2b274d61/attachment.pl>

From simon.ohanlon at imperial.ac.uk  Sun Oct 28 13:22:24 2012
From: simon.ohanlon at imperial.ac.uk (O'Hanlon, Simon J)
Date: Sun, 28 Oct 2012 12:22:24 +0000
Subject: [R-sig-Geo] spatstat crashes R when converting tess to sp objects
Message-ID: <7AE0828DCFFC0144817331B53EDC11A025D9E1EF@icexch-m5.ic.ac.uk>

Dear list,
I am experiencing a reoccurring crash in R when trying to convert a tess object from spatstat into an sp object. It seems to occur only when I create a tess object using the dirichlet function, specifically when specifying a polygonal owin object in the window argument. I am using R 2.15.1 on Mac OS X 10.7.5. (Platform: x86_64-apple-darwin9.8.0/x86_64 (64-bit) ). I have spatstat ver. 1.29-0 and sp 1.0.1. This also happened on my Windows 7 64-bit box (albeit without the helpful error message), with sp 0.9.99, spatstat 1.28.1, and R version 2.15.1 (2012-06-22) Platform: x86_64-pc-mingw32/x64 (64-bit).

I am trying to create voronoi/thiessen polygons from a point pattern, limited to within country borders.

The error thrown up is this:

*** caught segfault ***
address 0x0, cause 'memory not mapped'


Traceback:
 1: .Call("Polygons_c", srl, ID, PACKAGE = "sp")
 2: Polygons(pieces, id)
 3: owin2Polygons(y[[i]], nam[i])
 4: tess2SP(v)

Here is a small reproducible example that you should be able to copy and paste. BUT PLEASE NOTE THIS CRASHES MY CURRENT R SESSION WHEN I TRY TO RUN IT. I'd hate for anyone to lose some work! Can anyone else recreate my crash? I am guessing that the cause of my problems lies within the Polygons_c file within spatstat?


#Reproducible example

#Required libraries
library(sp); library(spatstat); library(maptools); library(rgeos)


# Data - two columns with x and y coords
p <- as.data.frame( structure(c(36.8547, 8.66667, 38.9782, 34.3265, 10.0439, 15.3166, 
15.4833, 32.8404, -6.1833, 17.8167, -16.3522, 3.46667, -1.5489, 
-0.2818, 12.449, -4.1333, -17.7167, -16.8231, 14.066, -20.5833
), .Dim = c(10L, 2L), .Dimnames = list(NULL, c("longitude", "latitude"
))))

#	Download and unzip country borders data
oldwd <- getwd(); tmp <- tempdir(); setwd(tmp)
url <- "http://www.naturalearthdata.com/http//www.naturalearthdata.com/download/50m/cultural/50m-admin-0-countries.zip"
dest <- paste(tmp,"\\tmp.zip",sep="")
download.file(url,dest)	#File is 1.3Mb
unzip(dest)

# Read in world shapefile
wld <- readShapePoly("ne_50m_admin_0_countries")

#Subset to the countries just in Africa
countries <- wld at data[order(wld at data$NAME),]
afr <- wld[ match( countries$NAME[c(4,7,25,30,36,37,39,41,43,44,48,49,50,59,64,66,67,69,77,78,82,89,90,107,113,121,122,123,130,133,136,137,145,146,151,158,159,178,181,186,188,190,191,197,198,199,207,209,215,217,220,225,236,240,241)] , wld at data$NAME ) , ]
#Melt into one polygon
africa <- gUnaryUnion( afr )

#Create polygonal observation window for voronoi polygons
win <- as.owin(africa)
points <- ppp( p[,1] , y = p[,2] , window = win )
# Create voronoi polygons
v <- dirichlet( points )
# Does not seem to work on my system
vp <- as( v , "SpatialPolygons" )
# End of example


Thanks in advance for any help,


Simon

------------------------------------
Simon O?Hanlon
Postgraduate Researcher
Department of Infectious Disease Epidemiology
Imperial College London


From pitiur at gmail.com  Sun Oct 28 13:22:14 2012
From: pitiur at gmail.com (Peter Versteegen)
Date: Sun, 28 Oct 2012 12:22:14 +0000
Subject: [R-sig-Geo] gDistance on a LARGE Spatial Object?
References: <6F935AB43360774EB2A937510A67E5D310E9AF6C3A@exchsvr1.arthur.nscr.nl>,
	<508AE395.20308@uni-muenster.de>
	<6F935AB43360774EB2A937510A67E5D310E9AF6C3C@exchsvr1.arthur.nscr.nl>
Message-ID: <loom.20121028T131737-982@post.gmane.org>

Wouter Steenbeek <WSteenbeek <at> nscr.nl> writes:
 
Your problem suggests that the spatial extent is not very large.
I have a similar problem with over 600,000 data points.
They describe bathymetric measurements of the lake.
I'm working on making contours..

Project all of your coordinates on a plane.
Means that you can work with meters instead of lat/lon.
Euclidian distances are easily calculated, d = sqrt((x-x1)^2 + (y-y1)^2).
You have to write a few lines of basic code in R.

Setup the problem with a database or write/read a textfile.

Routine computations like this 600,000 times
looking at each of the 600,000 points,
takes under a minute on my aging Mac.


I hope this helps.


From simon.ohanlon at imperial.ac.uk  Sun Oct 28 13:54:45 2012
From: simon.ohanlon at imperial.ac.uk (O'Hanlon, Simon J)
Date: Sun, 28 Oct 2012 12:54:45 +0000
Subject: [R-sig-Geo] spatstat crashes R when converting tess to sp
	objects
In-Reply-To: <7AE0828DCFFC0144817331B53EDC11A025D9E1EF@icexch-m5.ic.ac.uk>
References: <7AE0828DCFFC0144817331B53EDC11A025D9E1EF@icexch-m5.ic.ac.uk>
Message-ID: <7AE0828DCFFC0144817331B53EDC11A025D9E3BF@icexch-m5.ic.ac.uk>

>I am guessing that the cause of my problems lies within the Polygons_c file within spatstat?

Apologies, I guessed wrong here, as such a file does not exist. I now suspect (but again am not sure) that the crash is being thrown up from the sp_xports.c file from within the src directory of sp. But I still have no idea why. Can anyone help or point me in the right direction if I am still missing the source of the error?

Many thanks,

Simon

________________________________________
From: r-sig-geo-bounces at r-project.org [r-sig-geo-bounces at r-project.org] on behalf of O'Hanlon, Simon J [simon.ohanlon at imperial.ac.uk]
Sent: 28 October 2012 12:22
To: r-sig-geo at r-project.org
Subject: [R-sig-Geo] spatstat crashes R when converting tess to sp objects

Dear list,
I am experiencing a reoccurring crash in R when trying to convert a tess object from spatstat into an sp object. It seems to occur only when I create a tess object using the dirichlet function, specifically when specifying a polygonal owin object in the window argument. I am using R 2.15.1 on Mac OS X 10.7.5. (Platform: x86_64-apple-darwin9.8.0/x86_64 (64-bit) ). I have spatstat ver. 1.29-0 and sp 1.0.1. This also happened on my Windows 7 64-bit box (albeit without the helpful error message), with sp 0.9.99, spatstat 1.28.1, and R version 2.15.1 (2012-06-22) Platform: x86_64-pc-mingw32/x64 (64-bit).

I am trying to create voronoi/thiessen polygons from a point pattern, limited to within country borders.

The error thrown up is this:

*** caught segfault ***
address 0x0, cause 'memory not mapped'


Traceback:
 1: .Call("Polygons_c", srl, ID, PACKAGE = "sp")
 2: Polygons(pieces, id)
 3: owin2Polygons(y[[i]], nam[i])
 4: tess2SP(v)

Here is a small reproducible example that you should be able to copy and paste. BUT PLEASE NOTE THIS CRASHES MY CURRENT R SESSION WHEN I TRY TO RUN IT. I'd hate for anyone to lose some work! Can anyone else recreate my crash? I am guessing that the cause of my problems lies within the Polygons_c file within spatstat?


#Reproducible example

#Required libraries
library(sp); library(spatstat); library(maptools); library(rgeos)


# Data - two columns with x and y coords
p <- as.data.frame( structure(c(36.8547, 8.66667, 38.9782, 34.3265, 10.0439, 15.3166,
15.4833, 32.8404, -6.1833, 17.8167, -16.3522, 3.46667, -1.5489,
-0.2818, 12.449, -4.1333, -17.7167, -16.8231, 14.066, -20.5833
), .Dim = c(10L, 2L), .Dimnames = list(NULL, c("longitude", "latitude"
))))

#       Download and unzip country borders data
oldwd <- getwd(); tmp <- tempdir(); setwd(tmp)
url <- "http://www.naturalearthdata.com/http//www.naturalearthdata.com/download/50m/cultural/50m-admin-0-countries.zip"
dest <- paste(tmp,"\\tmp.zip",sep="")
download.file(url,dest) #File is 1.3Mb
unzip(dest)

# Read in world shapefile
wld <- readShapePoly("ne_50m_admin_0_countries")

#Subset to the countries just in Africa
countries <- wld at data[order(wld at data$NAME),]
afr <- wld[ match( countries$NAME[c(4,7,25,30,36,37,39,41,43,44,48,49,50,59,64,66,67,69,77,78,82,89,90,107,113,121,122,123,130,133,136,137,145,146,151,158,159,178,181,186,188,190,191,197,198,199,207,209,215,217,220,225,236,240,241)] , wld at data$NAME ) , ]
#Melt into one polygon
africa <- gUnaryUnion( afr )

#Create polygonal observation window for voronoi polygons
win <- as.owin(africa)
points <- ppp( p[,1] , y = p[,2] , window = win )
# Create voronoi polygons
v <- dirichlet( points )
# Does not seem to work on my system
vp <- as( v , "SpatialPolygons" )
# End of example


Thanks in advance for any help,


Simon

------------------------------------
Simon O?Hanlon
Postgraduate Researcher
Department of Infectious Disease Epidemiology
Imperial College London

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From b.rowlingson at lancaster.ac.uk  Sun Oct 28 13:57:56 2012
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Sun, 28 Oct 2012 12:57:56 +0000
Subject: [R-sig-Geo] spatstat crashes R when converting tess to sp
	objects
In-Reply-To: <e622b07988de4f949fb356bb4ade51d6@EX-1-HT0.lancs.local>
References: <e622b07988de4f949fb356bb4ade51d6@EX-1-HT0.lancs.local>
Message-ID: <CANVKczNq-rhWUCS4-DwV0iGgTW270Gk2fv8DCUOGAm2mORvQDw@mail.gmail.com>

On Sun, Oct 28, 2012 at 12:22 PM, O'Hanlon, Simon J
<simon.ohanlon at imperial.ac.uk> wrote:
> Dear list,

> #Reproducible example

 I think maptools isn't coping with certain types of tess object. I
can reproduce this in three lines without needing a download :)

1, start R, use some packages:

$ R --vanilla

R version 2.15.1 (2012-06-22) -- "Roasted Marshmallows"
Copyright (C) 2012 The R Foundation for Statistical Computing
ISBN 3-900051-07-0
Platform: i486-pc-linux-gnu (32-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> library(spatstat)
Loading required package: mgcv
This is mgcv 1.7-21. For overview type 'help("mgcv-package")'.
Loading required package: deldir
deldir 0.0-20
spatstat 1.28-2
Type ?help(spatstat)? for an overview of spatstat
     ?latest.news()? for news on latest version
     ?licence.polygons()? for licence information on polygon calculations

2. Run this to create some objects:

> example(tess)

tess>   A <- tess(xgrid=0:4,ygrid=0:4)

tess>   A
Tessellation
Tiles are equal rectangles, of dimension 1 x 1 units
4 by 4 grid of tiles
window: rectangle = [0, 4] x [0, 4] units

tess>   B <- A[c(1, 2, 5, 7, 9)]

tess>   B
Tessellation
Tessellation is determined by a factor-valued image with 5 levels
window: binary image mask
384 x 192 pixel array (ny, nx)
enclosing rectangle: [0, 3] x [1, 4] units

tess>   v <- as.im(function(x,y){factor(round(5 * (x^2 + y^2)))}, W=owin())

tess>   levels(v) <- letters[seq(length(levels(v)))]

tess>   E <- tess(image=v)

tess>   E
Tessellation
Tessellation is determined by a factor-valued image with 11 levels
window: binary image mask
128 x 128 pixel array (ny, nx)
enclosing rectangle: [0, 1] x [0, 1] units

3. Try conversion:

> as(E,"SpatialPolygons")
Error in as(E, "SpatialPolygons") :
  no method or default for coercing "tess" to "SpatialPolygons"

4. Try conversion with maptools:

> library(maptools)
Loading required package: foreign
Loading required package: sp
Loading required package: lattice
Checking rgeos availability: TRUE
> as(E,"SpatialPolygons")

 *** caught segfault ***
address (nil), cause 'memory not mapped'

I've not looked at the maptools code, but the tess object can be one
of three types according to ?tess, and I bet the conversion code
doesn't check what its dealing with...

Barry


From vrukol at gmail.com  Sun Oct 28 14:25:11 2012
From: vrukol at gmail.com (marco milella)
Date: Sun, 28 Oct 2012 14:25:11 +0100
Subject: [R-sig-Geo] kriging limits
Message-ID: <CAGmuAUqXB+ksi26djzPi1Y4+p1LWaTZ4=J-+uTk6NgwptmufQA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121028/f7b63be7/attachment.pl>

From Roger.Bivand at nhh.no  Sun Oct 28 14:30:16 2012
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sun, 28 Oct 2012 14:30:16 +0100 (CET)
Subject: [R-sig-Geo] spatstat crashes R when converting tess to sp
 objects
In-Reply-To: <CANVKczNq-rhWUCS4-DwV0iGgTW270Gk2fv8DCUOGAm2mORvQDw@mail.gmail.com>
References: <e622b07988de4f949fb356bb4ade51d6@EX-1-HT0.lancs.local>
	<CANVKczNq-rhWUCS4-DwV0iGgTW270Gk2fv8DCUOGAm2mORvQDw@mail.gmail.com>
Message-ID: <alpine.LRH.2.02.1210281402360.22752@reclus.nhh.no>

On Sun, 28 Oct 2012, Barry Rowlingson wrote:

> On Sun, Oct 28, 2012 at 12:22 PM, O'Hanlon, Simon J
> <simon.ohanlon at imperial.ac.uk> wrote:
>> Dear list,
>
>> #Reproducible example
>
> I think maptools isn't coping with certain types of tess object. I
> can reproduce this in three lines without needing a download :)

I'm seeing:

Warning message:
In as.polygonal(x) :
   Can't convert mask to polygon: gpclib is disabled/unavailable

called in maptools:::owin2Polygons:

x <- as.polygonal(x)

where x is an element of the list y made from the tesselation in 
maptools:::as.SpatialPolygons.tess by

y <- tiles(x)

Since as.polygonal(x) fails, x$bdry is NULL, and pieces is an empty 
list. I've patched sp:::Polygons() to trap the empty list on R-Forge, so 
that the user will see (using the current status of rspatial/sp on 
R-Forge):

> vp <- as( v , "SpatialPolygons" )
Error: length(srl) > 0 is not TRUE
In addition: Warning message:
In as.polygonal(x) :
   Can't convert mask to polygon: gpclib is disabled/unavailable

The resolution for now is:

spatstat.options("gpclib"=TRUE)

letting as.polygonal() do its stuff for a W$type "mask" tesselation. Not 
great, but it works; conversion to rgeos from gpclib might also work 
using the wrappers for gpclib objects included in rgeos.

Roger


>
> 1, start R, use some packages:
>
> $ R --vanilla
>
> R version 2.15.1 (2012-06-22) -- "Roasted Marshmallows"
> Copyright (C) 2012 The R Foundation for Statistical Computing
> ISBN 3-900051-07-0
> Platform: i486-pc-linux-gnu (32-bit)
>
> R is free software and comes with ABSOLUTELY NO WARRANTY.
> You are welcome to redistribute it under certain conditions.
> Type 'license()' or 'licence()' for distribution details.
>
>  Natural language support but running in an English locale
>
> R is a collaborative project with many contributors.
> Type 'contributors()' for more information and
> 'citation()' on how to cite R or R packages in publications.
>
> Type 'demo()' for some demos, 'help()' for on-line help, or
> 'help.start()' for an HTML browser interface to help.
> Type 'q()' to quit R.
>
>> library(spatstat)
> Loading required package: mgcv
> This is mgcv 1.7-21. For overview type 'help("mgcv-package")'.
> Loading required package: deldir
> deldir 0.0-20
> spatstat 1.28-2
> Type ?help(spatstat)? for an overview of spatstat
>     ?latest.news()? for news on latest version
>     ?licence.polygons()? for licence information on polygon calculations
>
> 2. Run this to create some objects:
>
>> example(tess)
>
> tess>   A <- tess(xgrid=0:4,ygrid=0:4)
>
> tess>   A
> Tessellation
> Tiles are equal rectangles, of dimension 1 x 1 units
> 4 by 4 grid of tiles
> window: rectangle = [0, 4] x [0, 4] units
>
> tess>   B <- A[c(1, 2, 5, 7, 9)]
>
> tess>   B
> Tessellation
> Tessellation is determined by a factor-valued image with 5 levels
> window: binary image mask
> 384 x 192 pixel array (ny, nx)
> enclosing rectangle: [0, 3] x [1, 4] units
>
> tess>   v <- as.im(function(x,y){factor(round(5 * (x^2 + y^2)))}, W=owin())
>
> tess>   levels(v) <- letters[seq(length(levels(v)))]
>
> tess>   E <- tess(image=v)
>
> tess>   E
> Tessellation
> Tessellation is determined by a factor-valued image with 11 levels
> window: binary image mask
> 128 x 128 pixel array (ny, nx)
> enclosing rectangle: [0, 1] x [0, 1] units
>
> 3. Try conversion:
>
>> as(E,"SpatialPolygons")
> Error in as(E, "SpatialPolygons") :
>  no method or default for coercing "tess" to "SpatialPolygons"
>
> 4. Try conversion with maptools:
>
>> library(maptools)
> Loading required package: foreign
> Loading required package: sp
> Loading required package: lattice
> Checking rgeos availability: TRUE
>> as(E,"SpatialPolygons")
>
> *** caught segfault ***
> address (nil), cause 'memory not mapped'
>
> I've not looked at the maptools code, but the tess object can be one
> of three types according to ?tess, and I bet the conversion code
> doesn't check what its dealing with...
>
> Barry
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From simon.ohanlon at imperial.ac.uk  Sun Oct 28 14:36:30 2012
From: simon.ohanlon at imperial.ac.uk (O'Hanlon, Simon J)
Date: Sun, 28 Oct 2012 13:36:30 +0000
Subject: [R-sig-Geo] spatstat crashes R when converting tess to sp
 objects
In-Reply-To: <alpine.LRH.2.02.1210281402360.22752@reclus.nhh.no>
References: <e622b07988de4f949fb356bb4ade51d6@EX-1-HT0.lancs.local>
	<CANVKczNq-rhWUCS4-DwV0iGgTW270Gk2fv8DCUOGAm2mORvQDw@mail.gmail.com>,
	<alpine.LRH.2.02.1210281402360.22752@reclus.nhh.no>
Message-ID: <7AE0828DCFFC0144817331B53EDC11A025D9E63B@icexch-m5.ic.ac.uk>

Dear Roger and Barry,
Thank you so much for your, as ever, lightening fast responses. This is one of the many reasons why I love using R as a platform so much. That workaround has solved the issue for me now.

Many, many thanks,

Simon
________________________________________
From: Roger Bivand [Roger.Bivand at nhh.no]
Sent: 28 October 2012 13:30
To: Barry Rowlingson
Cc: O'Hanlon, Simon J; r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] spatstat crashes R when converting tess to sp objects

On Sun, 28 Oct 2012, Barry Rowlingson wrote:

> On Sun, Oct 28, 2012 at 12:22 PM, O'Hanlon, Simon J
> <simon.ohanlon at imperial.ac.uk> wrote:
>> Dear list,
>
>> #Reproducible example
>
> I think maptools isn't coping with certain types of tess object. I
> can reproduce this in three lines without needing a download :)

I'm seeing:

Warning message:
In as.polygonal(x) :
   Can't convert mask to polygon: gpclib is disabled/unavailable

called in maptools:::owin2Polygons:

x <- as.polygonal(x)

where x is an element of the list y made from the tesselation in
maptools:::as.SpatialPolygons.tess by

y <- tiles(x)

Since as.polygonal(x) fails, x$bdry is NULL, and pieces is an empty
list. I've patched sp:::Polygons() to trap the empty list on R-Forge, so
that the user will see (using the current status of rspatial/sp on
R-Forge):

> vp <- as( v , "SpatialPolygons" )
Error: length(srl) > 0 is not TRUE
In addition: Warning message:
In as.polygonal(x) :
   Can't convert mask to polygon: gpclib is disabled/unavailable

The resolution for now is:

spatstat.options("gpclib"=TRUE)

letting as.polygonal() do its stuff for a W$type "mask" tesselation. Not
great, but it works; conversion to rgeos from gpclib might also work
using the wrappers for gpclib objects included in rgeos.

Roger


>
> 1, start R, use some packages:
>
> $ R --vanilla
>
> R version 2.15.1 (2012-06-22) -- "Roasted Marshmallows"
> Copyright (C) 2012 The R Foundation for Statistical Computing
> ISBN 3-900051-07-0
> Platform: i486-pc-linux-gnu (32-bit)
>
> R is free software and comes with ABSOLUTELY NO WARRANTY.
> You are welcome to redistribute it under certain conditions.
> Type 'license()' or 'licence()' for distribution details.
>
>  Natural language support but running in an English locale
>
> R is a collaborative project with many contributors.
> Type 'contributors()' for more information and
> 'citation()' on how to cite R or R packages in publications.
>
> Type 'demo()' for some demos, 'help()' for on-line help, or
> 'help.start()' for an HTML browser interface to help.
> Type 'q()' to quit R.
>
>> library(spatstat)
> Loading required package: mgcv
> This is mgcv 1.7-21. For overview type 'help("mgcv-package")'.
> Loading required package: deldir
> deldir 0.0-20
> spatstat 1.28-2
> Type ?help(spatstat)? for an overview of spatstat
>     ?latest.news()? for news on latest version
>     ?licence.polygons()? for licence information on polygon calculations
>
> 2. Run this to create some objects:
>
>> example(tess)
>
> tess>   A <- tess(xgrid=0:4,ygrid=0:4)
>
> tess>   A
> Tessellation
> Tiles are equal rectangles, of dimension 1 x 1 units
> 4 by 4 grid of tiles
> window: rectangle = [0, 4] x [0, 4] units
>
> tess>   B <- A[c(1, 2, 5, 7, 9)]
>
> tess>   B
> Tessellation
> Tessellation is determined by a factor-valued image with 5 levels
> window: binary image mask
> 384 x 192 pixel array (ny, nx)
> enclosing rectangle: [0, 3] x [1, 4] units
>
> tess>   v <- as.im(function(x,y){factor(round(5 * (x^2 + y^2)))}, W=owin())
>
> tess>   levels(v) <- letters[seq(length(levels(v)))]
>
> tess>   E <- tess(image=v)
>
> tess>   E
> Tessellation
> Tessellation is determined by a factor-valued image with 11 levels
> window: binary image mask
> 128 x 128 pixel array (ny, nx)
> enclosing rectangle: [0, 1] x [0, 1] units
>
> 3. Try conversion:
>
>> as(E,"SpatialPolygons")
> Error in as(E, "SpatialPolygons") :
>  no method or default for coercing "tess" to "SpatialPolygons"
>
> 4. Try conversion with maptools:
>
>> library(maptools)
> Loading required package: foreign
> Loading required package: sp
> Loading required package: lattice
> Checking rgeos availability: TRUE
>> as(E,"SpatialPolygons")
>
> *** caught segfault ***
> address (nil), cause 'memory not mapped'
>
> I've not looked at the maptools code, but the tess object can be one
> of three types according to ?tess, and I bet the conversion code
> doesn't check what its dealing with...
>
> Barry
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

--
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From Roger.Bivand at nhh.no  Sun Oct 28 14:43:26 2012
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sun, 28 Oct 2012 14:43:26 +0100 (CET)
Subject: [R-sig-Geo] spatstat crashes R when converting tess to sp
 objects
In-Reply-To: <7AE0828DCFFC0144817331B53EDC11A025D9E63B@icexch-m5.ic.ac.uk>
References: <e622b07988de4f949fb356bb4ade51d6@EX-1-HT0.lancs.local>
	<CANVKczNq-rhWUCS4-DwV0iGgTW270Gk2fv8DCUOGAm2mORvQDw@mail.gmail.com>,
	<alpine.LRH.2.02.1210281402360.22752@reclus.nhh.no>
	<7AE0828DCFFC0144817331B53EDC11A025D9E63B@icexch-m5.ic.ac.uk>
Message-ID: <alpine.LRH.2.02.1210281440180.22752@reclus.nhh.no>

On Sun, 28 Oct 2012, O'Hanlon, Simon J wrote:

> Dear Roger and Barry,
> Thank you so much for your, as ever, lightening fast responses. This is 
> one of the many reasons why I love using R as a platform so much. That 
> workaround has solved the issue for me now.

Simon,

With a good reproducible example available, life is much easier, and in 
fact this was a real crash, so sp will be improved (made safer) thanks to 
your posting. Making things work better is shared, really, as this case 
shows.

Roger

>
> Many, many thanks,
>
> Simon
> ________________________________________
> From: Roger Bivand [Roger.Bivand at nhh.no]
> Sent: 28 October 2012 13:30
> To: Barry Rowlingson
> Cc: O'Hanlon, Simon J; r-sig-geo at r-project.org
> Subject: Re: [R-sig-Geo] spatstat crashes R when converting tess to sp objects
>
> On Sun, 28 Oct 2012, Barry Rowlingson wrote:
>
>> On Sun, Oct 28, 2012 at 12:22 PM, O'Hanlon, Simon J
>> <simon.ohanlon at imperial.ac.uk> wrote:
>>> Dear list,
>>
>>> #Reproducible example
>>
>> I think maptools isn't coping with certain types of tess object. I
>> can reproduce this in three lines without needing a download :)
>
> I'm seeing:
>
> Warning message:
> In as.polygonal(x) :
>   Can't convert mask to polygon: gpclib is disabled/unavailable
>
> called in maptools:::owin2Polygons:
>
> x <- as.polygonal(x)
>
> where x is an element of the list y made from the tesselation in
> maptools:::as.SpatialPolygons.tess by
>
> y <- tiles(x)
>
> Since as.polygonal(x) fails, x$bdry is NULL, and pieces is an empty
> list. I've patched sp:::Polygons() to trap the empty list on R-Forge, so
> that the user will see (using the current status of rspatial/sp on
> R-Forge):
>
>> vp <- as( v , "SpatialPolygons" )
> Error: length(srl) > 0 is not TRUE
> In addition: Warning message:
> In as.polygonal(x) :
>   Can't convert mask to polygon: gpclib is disabled/unavailable
>
> The resolution for now is:
>
> spatstat.options("gpclib"=TRUE)
>
> letting as.polygonal() do its stuff for a W$type "mask" tesselation. Not
> great, but it works; conversion to rgeos from gpclib might also work
> using the wrappers for gpclib objects included in rgeos.
>
> Roger
>
>
>>
>> 1, start R, use some packages:
>>
>> $ R --vanilla
>>
>> R version 2.15.1 (2012-06-22) -- "Roasted Marshmallows"
>> Copyright (C) 2012 The R Foundation for Statistical Computing
>> ISBN 3-900051-07-0
>> Platform: i486-pc-linux-gnu (32-bit)
>>
>> R is free software and comes with ABSOLUTELY NO WARRANTY.
>> You are welcome to redistribute it under certain conditions.
>> Type 'license()' or 'licence()' for distribution details.
>>
>>  Natural language support but running in an English locale
>>
>> R is a collaborative project with many contributors.
>> Type 'contributors()' for more information and
>> 'citation()' on how to cite R or R packages in publications.
>>
>> Type 'demo()' for some demos, 'help()' for on-line help, or
>> 'help.start()' for an HTML browser interface to help.
>> Type 'q()' to quit R.
>>
>>> library(spatstat)
>> Loading required package: mgcv
>> This is mgcv 1.7-21. For overview type 'help("mgcv-package")'.
>> Loading required package: deldir
>> deldir 0.0-20
>> spatstat 1.28-2
>> Type ?help(spatstat)? for an overview of spatstat
>>     ?latest.news()? for news on latest version
>>     ?licence.polygons()? for licence information on polygon calculations
>>
>> 2. Run this to create some objects:
>>
>>> example(tess)
>>
>> tess>   A <- tess(xgrid=0:4,ygrid=0:4)
>>
>> tess>   A
>> Tessellation
>> Tiles are equal rectangles, of dimension 1 x 1 units
>> 4 by 4 grid of tiles
>> window: rectangle = [0, 4] x [0, 4] units
>>
>> tess>   B <- A[c(1, 2, 5, 7, 9)]
>>
>> tess>   B
>> Tessellation
>> Tessellation is determined by a factor-valued image with 5 levels
>> window: binary image mask
>> 384 x 192 pixel array (ny, nx)
>> enclosing rectangle: [0, 3] x [1, 4] units
>>
>> tess>   v <- as.im(function(x,y){factor(round(5 * (x^2 + y^2)))}, W=owin())
>>
>> tess>   levels(v) <- letters[seq(length(levels(v)))]
>>
>> tess>   E <- tess(image=v)
>>
>> tess>   E
>> Tessellation
>> Tessellation is determined by a factor-valued image with 11 levels
>> window: binary image mask
>> 128 x 128 pixel array (ny, nx)
>> enclosing rectangle: [0, 1] x [0, 1] units
>>
>> 3. Try conversion:
>>
>>> as(E,"SpatialPolygons")
>> Error in as(E, "SpatialPolygons") :
>>  no method or default for coercing "tess" to "SpatialPolygons"
>>
>> 4. Try conversion with maptools:
>>
>>> library(maptools)
>> Loading required package: foreign
>> Loading required package: sp
>> Loading required package: lattice
>> Checking rgeos availability: TRUE
>>> as(E,"SpatialPolygons")
>>
>> *** caught segfault ***
>> address (nil), cause 'memory not mapped'
>>
>> I've not looked at the maptools code, but the tess object can be one
>> of three types according to ?tess, and I bet the conversion code
>> doesn't check what its dealing with...
>>
>> Barry
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> --
> Roger Bivand
> Department of Economics, NHH Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From mitradevkota at hotmail.com  Sun Oct 28 15:29:33 2012
From: mitradevkota at hotmail.com (Mitra Devkota)
Date: Sun, 28 Oct 2012 14:29:33 +0000
Subject: [R-sig-Geo] Autologistic regression
Message-ID: <SNT002-W213FE287F4E3D65FC8B1D85CA7C0@phx.gbl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121028/0f5522ce/attachment.pl>

From edzer.pebesma at uni-muenster.de  Sun Oct 28 17:07:54 2012
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Sun, 28 Oct 2012 17:07:54 +0100
Subject: [R-sig-Geo] plot only cross variogram in gstat
In-Reply-To: <1F82F45497F86349B65E358ACFCCBDD619335D@EXMB-01.ad.wsu.edu>
References: <1F82F45497F86349B65E358ACFCCBDD619335D@EXMB-01.ad.wsu.edu>
Message-ID: <508D585A.8070809@uni-muenster.de>

plot(meuse.g.var[meuse.g.var$id == "zn.cu",], meuse.g.fit$model[[2]])

On 10/28/2012 12:49 AM, Collins, Douglas Parker wrote:
> Hi All,
> 
> I'm trying to show two cross variograms and their fitted models side-by-side.  Models and variograms are produced with the gstat function fit.lmc.  I would like to do this without also showing the single variograms.  I'm not very familiar with lattice or gstat, and I'm stuck.  What I would like to do from the following data set would be to produce a plot of only the zn.cu graph.  If someone could demonstrate how to do this, I think I would be able to take it from there.
> 
> 
> data(meuse)
> coordinates(meuse)=~x+y
> data(meuse.grid)
> gridded(meuse.grid)=~x+y
> meuse.g <- gstat(id = "zn", formula = log(zinc) ~ + 1, data = meuse, nmax = 10)
> meuse.g <- gstat(meuse.g, "cu", log(copper) ~ 1, meuse, nmax = 10)
> meuse.g <- gstat(meuse.g, model = vgm(1, "Sph", 900, + 1), fill.all = T)
> meuse.g
> meuse.g.var<- variogram(meuse.g, cutoff = 1000)
> plot(meuse.g.var)
> names(meuse.g)
> meuse.g.fit<-fit.lmc(meuse.g.var, meuse.g)
> plot(meuse.g.var, model=meuse.g.fit)
> 
> 
> I get close to what I want with this extra line:
> plot(meuse.g.var, subset=id=="zn.cu", meuse.g.fit)
> 
> but xyplot is still providing space for the other plots.  Not sure how to create just the single zn.cu plot.
> 
> Thanks,
> 
> Doug Collins
> Small Farms Extension Specialist
> Washington State University
> Center for Sustaining Agriculture and Natural Resources
> 2606 W Pioneer
> Puyallup, WA  98371
> 
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From dpcollins at wsu.edu  Sun Oct 28 17:44:14 2012
From: dpcollins at wsu.edu (Collins, Douglas Parker)
Date: Sun, 28 Oct 2012 16:44:14 +0000
Subject: [R-sig-Geo] plot only cross variogram in gstat
Message-ID: <1F82F45497F86349B65E358ACFCCBDD6193C0E@EXMB-01.ad.wsu.edu>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121028/e7cdd651/attachment.pl>

From rhurlin at gwdg.de  Sun Oct 28 18:57:12 2012
From: rhurlin at gwdg.de (Rainer Hurling)
Date: Sun, 28 Oct 2012 18:57:12 +0100
Subject: [R-sig-Geo] RSAGA issues
In-Reply-To: <508A3F6E.8070508@ku.de>
References: <508A3F6E.8070508@ku.de>
Message-ID: <508D71F8.8030907@gwdg.de>

On 26.10.2012 09:44 (UTC+2), Ludwig Hilger wrote:
> 
> Dear list,
> 
> I am comparatively new to RSAGA and have come across three problems I
> have not been able solve by searching on the internet. Your help would
> be very much appreciated. This is SAGA 2.0.8 and R 2.15.1.
> 
> 1. Is there a way to access the header of a *.sgrd without having to
> load the whole grid, i.e. not using read.sgrd()$header? I want to
> determine the cellsize of a *.sgrd from within r for informational
> purposes and I have 1 m grids with 62 km2.....

The .sgrd file _is_ the header file of a SAGA GIS grid file. The grids
data is in .sdat instead. You can read these very small header files
(.sgrd) with several functions, for example


hd <- readLines("filename.sgrd", n=-1)

# split strings in names and values parts
require(stringr)
hd <- unlist(str_split(hd, "\t= "))

# make a dataframe from the header data
header <- data.frame(Parameter=hd[seq(1,length(hd),2)],
                     Value=hd[seq(2,length(hd),2)])

# The contents of such header is like that
header
#         Parameter              Value
#1             NAME          DGM5_saga
#2      DESCRIPTION
#3             UNIT
#4  DATAFILE_OFFSET                  0
#5       DATAFORMAT              FLOAT
#6    BYTEORDER_BIG              FALSE
#7    POSITION_XMIN 3449220.0000000000
#8    POSITION_YMIN 5487020.0000000000
#9      CELLCOUNT_X               2907
#10     CELLCOUNT_Y               6538
#11        CELLSIZE      10.0000000000
#12        Z_FACTOR           1.000000
#13    NODATA_VALUE      -99999.000000
#14     TOPTOBOTTOM              FALSE


The other questions seem to be already answered on r-sig-geo and/or SAGA
GIS discussion forum (
http://sourceforge.net/p/saga-gis/discussion/790705/thread/77e3979c/ ).

Hope this helps,
Rainer


> -------------------------------------------------------------------------------
> 
> 
> 2. I have tried to call the Grid sum module in the following way:
>     rsaga.geoprocessor(
>     lib = ?grid_calculus?,
>     module = 8,
>     param = list(
>     GRIDS = list(?t_elev_class.sgrd?, ?t_asp_class.sgrd?),
>     RESULT = ?t_codes?
>             )
>     )
> 
> I get the following error, i.e. arguments of the function seem to get
> mixed up:
> 
> ?library path: C:Program Files (x86)SAGA-GIS_2.0.8/modules
> library name: grid_calculus
> module name : Grids Sum
> author : O. Conrad (c) 2010
> 
> Load grid: t_codes...
> 
> failed
> 
> error: Grid file could not be opened.
> 
> error: input file t_codes
> 
> error: empty input list GRIDS
> Usage: 8 -GRIDS -RESULT
> -GRIDS: Grids
> Grid list (input)
> -RESULT: Sum
> Grid (output)
> 
> error: executing module Grids Sum
> Warnmeldung:
> Ausf?hrung von Kommando '"C:Program Files
> (x86)SAGA-GIS_2.0.8/saga_cmd.exe" grid_calculus 8 -GRIDS
> "t_elev_class.sgrd" -RESULT "t_asp_class.sgrd" -GRIDS "t_codes"' ergab
> Status 1?
> 
> I have also tried c() instead of list() for the GRID-argument, I have
> moeved GRID out of the param-list, etc. . In contrast,
> rsaga.grid.calculus() works fine. I seem to have the same problem with
> other modules as well, probably I do not provide the input grids in the
> right way?
> 
> -------------------------------------------------------------------------------
> 
> 
> 3.
> a) When I resample a grid, I have to provide USER_YMIN, USER_XMIN,
> USER_XMAX and USER_YMAX. Is there a way to automatically calculate these
> values from the input DEM header and the cellsize selected for
> resampling (as SAGA seems to do in the GUI)?
> b) If I want to use a target grid as a model for the new grid, where is
> this to be specified? rsaga.get.usage("grid_tools", 0) gives me only the
> options GRID_GRID and USER_GRID (which are output arguments according to
> get.usage). There are no arguments for the path to the target grid.
> 
> thank you,
> Ludwig


From rob.robinson at bto.org  Mon Oct 29 11:46:11 2012
From: rob.robinson at bto.org (Rob Robinson)
Date: Mon, 29 Oct 2012 10:46:11 +0000
Subject: [R-sig-Geo] kriging limits
In-Reply-To: <CAGmuAUqXB+ksi26djzPi1Y4+p1LWaTZ4=J-+uTk6NgwptmufQA@mail.gmail.com>
References: <CAGmuAUqXB+ksi26djzPi1Y4+p1LWaTZ4=J-+uTk6NgwptmufQA@mail.gmail.com>
Message-ID: <CAGcXcEZT24R5RXX633kqczwhH76God59MyjhDfVm15T4q_G-7g@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121029/89494e44/attachment.pl>

From simon.ohanlon at imperial.ac.uk  Mon Oct 29 12:13:09 2012
From: simon.ohanlon at imperial.ac.uk (O'Hanlon, Simon J)
Date: Mon, 29 Oct 2012 11:13:09 +0000
Subject: [R-sig-Geo] spatstat crashes R when converting tess to sp
 objects
In-Reply-To: <alpine.LRH.2.02.1210281440180.22752@reclus.nhh.no>
References: <e622b07988de4f949fb356bb4ade51d6@EX-1-HT0.lancs.local>
	<CANVKczNq-rhWUCS4-DwV0iGgTW270Gk2fv8DCUOGAm2mORvQDw@mail.gmail.com>,
	<alpine.LRH.2.02.1210281402360.22752@reclus.nhh.no>
	<7AE0828DCFFC0144817331B53EDC11A025D9E63B@icexch-m5.ic.ac.uk>,
	<alpine.LRH.2.02.1210281440180.22752@reclus.nhh.no>
Message-ID: <7AE0828DCFFC0144817331B53EDC11A025D9EAC1@icexch-m5.ic.ac.uk>

Further to this problem, I have experienced some more odd behaviour with the coercion from tess to sp.

My real dataset is 3607 points within the observation window. If I try and run this straight away I get a segfault crash with the error message: 

 *** caught segfault ***
address 0x0, cause 'memory not mapped'

Traceback:
 1: .Call("Polygons_c", srl, ID, PACKAGE = "sp")
 2: Polygons(pieces, id)
 3: owin2Polygons(y[[i]], nam[i])
 4: as.SpatialPolygons.tess(from)
 5: asMethod(object)
 6: as(v, "SpatialPolygons")

This is using the spatstat.options(gpclib=T) workaround posted by Roger. However if I take a small sample of say 50 rows from the dataset, run the script on these and coerce from tess to sp it runs fine. Interestingly I can then re-read the data file and run the analysis on all 3607 points within the same R session and corece to sp with no problems at all. However it crashes every time if I don't 'prime' the function with a small run dataset first?!

I can try to provide a reproducible example if that will help more? (the easiest way is if I can share my datapoint locations, but I have to ask permission first). Otherwise I will try to recreate this from within R.

Thanks,

Simon

________________________________________
From: Roger Bivand [Roger.Bivand at nhh.no]
Sent: 28 October 2012 13:43
To: O'Hanlon, Simon J
Cc: Barry Rowlingson; r-sig-geo at r-project.org
Subject: RE: [R-sig-Geo] spatstat crashes R when converting tess to sp objects

On Sun, 28 Oct 2012, O'Hanlon, Simon J wrote:

> Dear Roger and Barry,
> Thank you so much for your, as ever, lightening fast responses. This is
> one of the many reasons why I love using R as a platform so much. That
> workaround has solved the issue for me now.

Simon,

With a good reproducible example available, life is much easier, and in
fact this was a real crash, so sp will be improved (made safer) thanks to
your posting. Making things work better is shared, really, as this case
shows.

Roger

>
> Many, many thanks,
>
> Simon
> ________________________________________
> From: Roger Bivand [Roger.Bivand at nhh.no]
> Sent: 28 October 2012 13:30
> To: Barry Rowlingson
> Cc: O'Hanlon, Simon J; r-sig-geo at r-project.org
> Subject: Re: [R-sig-Geo] spatstat crashes R when converting tess to sp objects
>
> On Sun, 28 Oct 2012, Barry Rowlingson wrote:
>
>> On Sun, Oct 28, 2012 at 12:22 PM, O'Hanlon, Simon J
>> <simon.ohanlon at imperial.ac.uk> wrote:
>>> Dear list,
>>
>>> #Reproducible example
>>
>> I think maptools isn't coping with certain types of tess object. I
>> can reproduce this in three lines without needing a download :)
>
> I'm seeing:
>
> Warning message:
> In as.polygonal(x) :
>   Can't convert mask to polygon: gpclib is disabled/unavailable
>
> called in maptools:::owin2Polygons:
>
> x <- as.polygonal(x)
>
> where x is an element of the list y made from the tesselation in
> maptools:::as.SpatialPolygons.tess by
>
> y <- tiles(x)
>
> Since as.polygonal(x) fails, x$bdry is NULL, and pieces is an empty
> list. I've patched sp:::Polygons() to trap the empty list on R-Forge, so
> that the user will see (using the current status of rspatial/sp on
> R-Forge):
>
>> vp <- as( v , "SpatialPolygons" )
> Error: length(srl) > 0 is not TRUE
> In addition: Warning message:
> In as.polygonal(x) :
>   Can't convert mask to polygon: gpclib is disabled/unavailable
>
> The resolution for now is:
>
> spatstat.options("gpclib"=TRUE)
>
> letting as.polygonal() do its stuff for a W$type "mask" tesselation. Not
> great, but it works; conversion to rgeos from gpclib might also work
> using the wrappers for gpclib objects included in rgeos.
>
> Roger
>
>
>>
>> 1, start R, use some packages:
>>
>> $ R --vanilla
>>
>> R version 2.15.1 (2012-06-22) -- "Roasted Marshmallows"
>> Copyright (C) 2012 The R Foundation for Statistical Computing
>> ISBN 3-900051-07-0
>> Platform: i486-pc-linux-gnu (32-bit)
>>
>> R is free software and comes with ABSOLUTELY NO WARRANTY.
>> You are welcome to redistribute it under certain conditions.
>> Type 'license()' or 'licence()' for distribution details.
>>
>>  Natural language support but running in an English locale
>>
>> R is a collaborative project with many contributors.
>> Type 'contributors()' for more information and
>> 'citation()' on how to cite R or R packages in publications.
>>
>> Type 'demo()' for some demos, 'help()' for on-line help, or
>> 'help.start()' for an HTML browser interface to help.
>> Type 'q()' to quit R.
>>
>>> library(spatstat)
>> Loading required package: mgcv
>> This is mgcv 1.7-21. For overview type 'help("mgcv-package")'.
>> Loading required package: deldir
>> deldir 0.0-20
>> spatstat 1.28-2
>> Type ?help(spatstat)? for an overview of spatstat
>>     ?latest.news()? for news on latest version
>>     ?licence.polygons()? for licence information on polygon calculations
>>
>> 2. Run this to create some objects:
>>
>>> example(tess)
>>
>> tess>   A <- tess(xgrid=0:4,ygrid=0:4)
>>
>> tess>   A
>> Tessellation
>> Tiles are equal rectangles, of dimension 1 x 1 units
>> 4 by 4 grid of tiles
>> window: rectangle = [0, 4] x [0, 4] units
>>
>> tess>   B <- A[c(1, 2, 5, 7, 9)]
>>
>> tess>   B
>> Tessellation
>> Tessellation is determined by a factor-valued image with 5 levels
>> window: binary image mask
>> 384 x 192 pixel array (ny, nx)
>> enclosing rectangle: [0, 3] x [1, 4] units
>>
>> tess>   v <- as.im(function(x,y){factor(round(5 * (x^2 + y^2)))}, W=owin())
>>
>> tess>   levels(v) <- letters[seq(length(levels(v)))]
>>
>> tess>   E <- tess(image=v)
>>
>> tess>   E
>> Tessellation
>> Tessellation is determined by a factor-valued image with 11 levels
>> window: binary image mask
>> 128 x 128 pixel array (ny, nx)
>> enclosing rectangle: [0, 1] x [0, 1] units
>>
>> 3. Try conversion:
>>
>>> as(E,"SpatialPolygons")
>> Error in as(E, "SpatialPolygons") :
>>  no method or default for coercing "tess" to "SpatialPolygons"
>>
>> 4. Try conversion with maptools:
>>
>>> library(maptools)
>> Loading required package: foreign
>> Loading required package: sp
>> Loading required package: lattice
>> Checking rgeos availability: TRUE
>>> as(E,"SpatialPolygons")
>>
>> *** caught segfault ***
>> address (nil), cause 'memory not mapped'
>>
>> I've not looked at the maptools code, but the tess object can be one
>> of three types according to ?tess, and I bet the conversion code
>> doesn't check what its dealing with...
>>
>> Barry
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> --
> Roger Bivand
> Department of Economics, NHH Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no

--
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From Roger.Bivand at nhh.no  Mon Oct 29 13:05:03 2012
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 29 Oct 2012 13:05:03 +0100
Subject: [R-sig-Geo] spatstat crashes R when converting tess to sp
 objects
In-Reply-To: <7AE0828DCFFC0144817331B53EDC11A025D9EAC1@icexch-m5.ic.ac.uk>
References: <e622b07988de4f949fb356bb4ade51d6@EX-1-HT0.lancs.local>
	<CANVKczNq-rhWUCS4-DwV0iGgTW270Gk2fv8DCUOGAm2mORvQDw@mail.gmail.com>,
	<alpine.LRH.2.02.1210281402360.22752@reclus.nhh.no>
	<7AE0828DCFFC0144817331B53EDC11A025D9E63B@icexch-m5.ic.ac.uk>,
	<alpine.LRH.2.02.1210281440180.22752@reclus.nhh.no>
	<7AE0828DCFFC0144817331B53EDC11A025D9EAC1@icexch-m5.ic.ac.uk>
Message-ID: <alpine.LRH.2.02.1210291248160.26896@reclus.nhh.no>

On Mon, 29 Oct 2012, O'Hanlon, Simon J wrote:

> Further to this problem, I have experienced some more odd behaviour with 
> the coercion from tess to sp.
>
> My real dataset is 3607 points within the observation window. If I try 
> and run this straight away I get a segfault crash with the error 
> message:
>
> *** caught segfault ***
> address 0x0, cause 'memory not mapped'
>
> Traceback:
> 1: .Call("Polygons_c", srl, ID, PACKAGE = "sp")
> 2: Polygons(pieces, id)
> 3: owin2Polygons(y[[i]], nam[i])
> 4: as.SpatialPolygons.tess(from)
> 5: asMethod(object)
> 6: as(v, "SpatialPolygons")
>
> This is using the spatstat.options(gpclib=T) workaround posted by Roger. 
> However if I take a small sample of say 50 rows from the dataset, run 
> the script on these and coerce from tess to sp it runs fine. 
> Interestingly I can then re-read the data file and run the analysis on 
> all 3607 points within the same R session and corece to sp with no 
> problems at all. However it crashes every time if I don't 'prime' the 
> function with a small run dataset first?!
>
> I can try to provide a reproducible example if that will help more? (the 
> easiest way is if I can share my datapoint locations, but I have to ask 
> permission first). Otherwise I will try to recreate this from within R.

Yes, the specific failing data set is the best bet; if passed through an 
off-list communication, it can be handled with discretion. Could you also 
perhaps update sp from R-Forge if you can install a source package (you'll 
need to check out from anonymous SVN, see this page:

https://r-forge.r-project.org/scm/?group_id=1014

or if you like I can get a Windows binary package run up on Win-builder.

I do see that with the patched sp, and points generated by:

set.seed(1)
p <- coordinates(spsample(africa, type="random", n=3500))
spatstat.options("gpclib"=TRUE)

the result is OK, but for some other seeds, a degenerate pieces is created 
and I see:

> vp <- as( v , "SpatialPolygons" )
Error: length(srl) > 0 is not TRUE

So the revised sp would trap the error, I think. However, it would be 
useful to debug this as far as possible.

Roger

>
> Thanks,
>
> Simon
>
> ________________________________________
> From: Roger Bivand [Roger.Bivand at nhh.no]
> Sent: 28 October 2012 13:43
> To: O'Hanlon, Simon J
> Cc: Barry Rowlingson; r-sig-geo at r-project.org
> Subject: RE: [R-sig-Geo] spatstat crashes R when converting tess to sp objects
>
> On Sun, 28 Oct 2012, O'Hanlon, Simon J wrote:
>
>> Dear Roger and Barry,
>> Thank you so much for your, as ever, lightening fast responses. This is
>> one of the many reasons why I love using R as a platform so much. That
>> workaround has solved the issue for me now.
>
> Simon,
>
> With a good reproducible example available, life is much easier, and in
> fact this was a real crash, so sp will be improved (made safer) thanks to
> your posting. Making things work better is shared, really, as this case
> shows.
>
> Roger
>
>>
>> Many, many thanks,
>>
>> Simon
>> ________________________________________
>> From: Roger Bivand [Roger.Bivand at nhh.no]
>> Sent: 28 October 2012 13:30
>> To: Barry Rowlingson
>> Cc: O'Hanlon, Simon J; r-sig-geo at r-project.org
>> Subject: Re: [R-sig-Geo] spatstat crashes R when converting tess to sp objects
>>
>> On Sun, 28 Oct 2012, Barry Rowlingson wrote:
>>
>>> On Sun, Oct 28, 2012 at 12:22 PM, O'Hanlon, Simon J
>>> <simon.ohanlon at imperial.ac.uk> wrote:
>>>> Dear list,
>>>
>>>> #Reproducible example
>>>
>>> I think maptools isn't coping with certain types of tess object. I
>>> can reproduce this in three lines without needing a download :)
>>
>> I'm seeing:
>>
>> Warning message:
>> In as.polygonal(x) :
>>   Can't convert mask to polygon: gpclib is disabled/unavailable
>>
>> called in maptools:::owin2Polygons:
>>
>> x <- as.polygonal(x)
>>
>> where x is an element of the list y made from the tesselation in
>> maptools:::as.SpatialPolygons.tess by
>>
>> y <- tiles(x)
>>
>> Since as.polygonal(x) fails, x$bdry is NULL, and pieces is an empty
>> list. I've patched sp:::Polygons() to trap the empty list on R-Forge, so
>> that the user will see (using the current status of rspatial/sp on
>> R-Forge):
>>
>>> vp <- as( v , "SpatialPolygons" )
>> Error: length(srl) > 0 is not TRUE
>> In addition: Warning message:
>> In as.polygonal(x) :
>>   Can't convert mask to polygon: gpclib is disabled/unavailable
>>
>> The resolution for now is:
>>
>> spatstat.options("gpclib"=TRUE)
>>
>> letting as.polygonal() do its stuff for a W$type "mask" tesselation. Not
>> great, but it works; conversion to rgeos from gpclib might also work
>> using the wrappers for gpclib objects included in rgeos.
>>
>> Roger
>>
>>
>>>
>>> 1, start R, use some packages:
>>>
>>> $ R --vanilla
>>>
>>> R version 2.15.1 (2012-06-22) -- "Roasted Marshmallows"
>>> Copyright (C) 2012 The R Foundation for Statistical Computing
>>> ISBN 3-900051-07-0
>>> Platform: i486-pc-linux-gnu (32-bit)
>>>
>>> R is free software and comes with ABSOLUTELY NO WARRANTY.
>>> You are welcome to redistribute it under certain conditions.
>>> Type 'license()' or 'licence()' for distribution details.
>>>
>>>  Natural language support but running in an English locale
>>>
>>> R is a collaborative project with many contributors.
>>> Type 'contributors()' for more information and
>>> 'citation()' on how to cite R or R packages in publications.
>>>
>>> Type 'demo()' for some demos, 'help()' for on-line help, or
>>> 'help.start()' for an HTML browser interface to help.
>>> Type 'q()' to quit R.
>>>
>>>> library(spatstat)
>>> Loading required package: mgcv
>>> This is mgcv 1.7-21. For overview type 'help("mgcv-package")'.
>>> Loading required package: deldir
>>> deldir 0.0-20
>>> spatstat 1.28-2
>>> Type ?help(spatstat)? for an overview of spatstat
>>>     ?latest.news()? for news on latest version
>>>     ?licence.polygons()? for licence information on polygon calculations
>>>
>>> 2. Run this to create some objects:
>>>
>>>> example(tess)
>>>
>>> tess>   A <- tess(xgrid=0:4,ygrid=0:4)
>>>
>>> tess>   A
>>> Tessellation
>>> Tiles are equal rectangles, of dimension 1 x 1 units
>>> 4 by 4 grid of tiles
>>> window: rectangle = [0, 4] x [0, 4] units
>>>
>>> tess>   B <- A[c(1, 2, 5, 7, 9)]
>>>
>>> tess>   B
>>> Tessellation
>>> Tessellation is determined by a factor-valued image with 5 levels
>>> window: binary image mask
>>> 384 x 192 pixel array (ny, nx)
>>> enclosing rectangle: [0, 3] x [1, 4] units
>>>
>>> tess>   v <- as.im(function(x,y){factor(round(5 * (x^2 + y^2)))}, W=owin())
>>>
>>> tess>   levels(v) <- letters[seq(length(levels(v)))]
>>>
>>> tess>   E <- tess(image=v)
>>>
>>> tess>   E
>>> Tessellation
>>> Tessellation is determined by a factor-valued image with 11 levels
>>> window: binary image mask
>>> 128 x 128 pixel array (ny, nx)
>>> enclosing rectangle: [0, 1] x [0, 1] units
>>>
>>> 3. Try conversion:
>>>
>>>> as(E,"SpatialPolygons")
>>> Error in as(E, "SpatialPolygons") :
>>>  no method or default for coercing "tess" to "SpatialPolygons"
>>>
>>> 4. Try conversion with maptools:
>>>
>>>> library(maptools)
>>> Loading required package: foreign
>>> Loading required package: sp
>>> Loading required package: lattice
>>> Checking rgeos availability: TRUE
>>>> as(E,"SpatialPolygons")
>>>
>>> *** caught segfault ***
>>> address (nil), cause 'memory not mapped'
>>>
>>> I've not looked at the maptools code, but the tess object can be one
>>> of three types according to ?tess, and I bet the conversion code
>>> doesn't check what its dealing with...
>>>
>>> Barry
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>> --
>> Roger Bivand
>> Department of Economics, NHH Norwegian School of Economics,
>> Helleveien 30, N-5045 Bergen, Norway.
>> voice: +47 55 95 93 55; fax +47 55 95 95 43
>> e-mail: Roger.Bivand at nhh.no
>
> --
> Roger Bivand
> Department of Economics, NHH Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From Roger.Bivand at nhh.no  Mon Oct 29 15:41:42 2012
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 29 Oct 2012 15:41:42 +0100
Subject: [R-sig-Geo] spatstat crashes R when converting tess to sp
 objects
In-Reply-To: <alpine.LRH.2.02.1210291248160.26896@reclus.nhh.no>
References: <e622b07988de4f949fb356bb4ade51d6@EX-1-HT0.lancs.local>
	<CANVKczNq-rhWUCS4-DwV0iGgTW270Gk2fv8DCUOGAm2mORvQDw@mail.gmail.com>,
	<alpine.LRH.2.02.1210281402360.22752@reclus.nhh.no>
	<7AE0828DCFFC0144817331B53EDC11A025D9E63B@icexch-m5.ic.ac.uk>, 
	<alpine.LRH.2.02.1210281440180.22752@reclus.nhh.no>
	<7AE0828DCFFC0144817331B53EDC11A025D9EAC1@icexch-m5.ic.ac.uk>
	<alpine.LRH.2.02.1210291248160.26896@reclus.nhh.no>
Message-ID: <alpine.LRH.2.02.1210291515340.26896@reclus.nhh.no>

On Mon, 29 Oct 2012, Roger Bivand wrote:

> On Mon, 29 Oct 2012, O'Hanlon, Simon J wrote:
>
>> Further to this problem, I have experienced some more odd behaviour with 
>> the coercion from tess to sp.
>> 
>> My real dataset is 3607 points within the observation window. If I try and 
>> run this straight away I get a segfault crash with the error message:
>> 
>> *** caught segfault ***
>> address 0x0, cause 'memory not mapped'
>> 
>> Traceback:
>> 1: .Call("Polygons_c", srl, ID, PACKAGE = "sp")
>> 2: Polygons(pieces, id)
>> 3: owin2Polygons(y[[i]], nam[i])
>> 4: as.SpatialPolygons.tess(from)
>> 5: asMethod(object)
>> 6: as(v, "SpatialPolygons")
>> 
>> This is using the spatstat.options(gpclib=T) workaround posted by Roger. 
>> However if I take a small sample of say 50 rows from the dataset, run the 
>> script on these and coerce from tess to sp it runs fine. Interestingly I 
>> can then re-read the data file and run the analysis on all 3607 points 
>> within the same R session and corece to sp with no problems at all. However 
>> it crashes every time if I don't 'prime' the function with a small run 
>> dataset first?!
>> 
>> I can try to provide a reproducible example if that will help more? (the 
>> easiest way is if I can share my datapoint locations, but I have to ask 
>> permission first). Otherwise I will try to recreate this from within R.
>
> Yes, the specific failing data set is the best bet; if passed through an 
> off-list communication, it can be handled with discretion. Could you also 
> perhaps update sp from R-Forge if you can install a source package (you'll 
> need to check out from anonymous SVN, see this page:

With your data set, the crash is prevented with the development version of 
sp (R-forge revision 1300). I've added a try() in maptools in the coercion 
method from tess to SpatialPolygons, and have established that zero-length 
pieces are created when the tile for a tesselation has a single raster 
cell TRUE. In cases with > 1 cell, as.polygonal() returns a "polygonal" 
object, but where it is just one, it returns a "rectangle" object, which 
doesn't have the required components - this may well have been the 
underlying problem all the time, as Barry suggested.

I've added code to owin2Polygons() called by the coercion method to branch 
on the object type returned by as.polygonal(), and your example now works, 
admittedly using gpclib in as.polygonal(), which it might be appropriate 
to do something about. Try with R-forge maptools check out, revision 239.

Roger

>
> https://r-forge.r-project.org/scm/?group_id=1014
>
> or if you like I can get a Windows binary package run up on Win-builder.
>
> I do see that with the patched sp, and points generated by:
>
> set.seed(1)
> p <- coordinates(spsample(africa, type="random", n=3500))
> spatstat.options("gpclib"=TRUE)
>
> the result is OK, but for some other seeds, a degenerate pieces is created 
> and I see:
>
>> vp <- as( v , "SpatialPolygons" )
> Error: length(srl) > 0 is not TRUE
>
> So the revised sp would trap the error, I think. However, it would be useful 
> to debug this as far as possible.
>
> Roger
>
>> 
>> Thanks,
>> 
>> Simon
>> 
>> ________________________________________
>> From: Roger Bivand [Roger.Bivand at nhh.no]
>> Sent: 28 October 2012 13:43
>> To: O'Hanlon, Simon J
>> Cc: Barry Rowlingson; r-sig-geo at r-project.org
>> Subject: RE: [R-sig-Geo] spatstat crashes R when converting tess to sp 
>> objects
>> 
>> On Sun, 28 Oct 2012, O'Hanlon, Simon J wrote:
>> 
>>> Dear Roger and Barry,
>>> Thank you so much for your, as ever, lightening fast responses. This is
>>> one of the many reasons why I love using R as a platform so much. That
>>> workaround has solved the issue for me now.
>> 
>> Simon,
>> 
>> With a good reproducible example available, life is much easier, and in
>> fact this was a real crash, so sp will be improved (made safer) thanks to
>> your posting. Making things work better is shared, really, as this case
>> shows.
>> 
>> Roger
>> 
>>> 
>>> Many, many thanks,
>>> 
>>> Simon
>>> ________________________________________
>>> From: Roger Bivand [Roger.Bivand at nhh.no]
>>> Sent: 28 October 2012 13:30
>>> To: Barry Rowlingson
>>> Cc: O'Hanlon, Simon J; r-sig-geo at r-project.org
>>> Subject: Re: [R-sig-Geo] spatstat crashes R when converting tess to sp 
>>> objects
>>> 
>>> On Sun, 28 Oct 2012, Barry Rowlingson wrote:
>>> 
>>>> On Sun, Oct 28, 2012 at 12:22 PM, O'Hanlon, Simon J
>>>> <simon.ohanlon at imperial.ac.uk> wrote:
>>>>> Dear list,
>>>> 
>>>>> #Reproducible example
>>>> 
>>>> I think maptools isn't coping with certain types of tess object. I
>>>> can reproduce this in three lines without needing a download :)
>>> 
>>> I'm seeing:
>>> 
>>> Warning message:
>>> In as.polygonal(x) :
>>>   Can't convert mask to polygon: gpclib is disabled/unavailable
>>> 
>>> called in maptools:::owin2Polygons:
>>> 
>>> x <- as.polygonal(x)
>>> 
>>> where x is an element of the list y made from the tesselation in
>>> maptools:::as.SpatialPolygons.tess by
>>> 
>>> y <- tiles(x)
>>> 
>>> Since as.polygonal(x) fails, x$bdry is NULL, and pieces is an empty
>>> list. I've patched sp:::Polygons() to trap the empty list on R-Forge, so
>>> that the user will see (using the current status of rspatial/sp on
>>> R-Forge):
>>> 
>>>> vp <- as( v , "SpatialPolygons" )
>>> Error: length(srl) > 0 is not TRUE
>>> In addition: Warning message:
>>> In as.polygonal(x) :
>>>   Can't convert mask to polygon: gpclib is disabled/unavailable
>>> 
>>> The resolution for now is:
>>> 
>>> spatstat.options("gpclib"=TRUE)
>>> 
>>> letting as.polygonal() do its stuff for a W$type "mask" tesselation. Not
>>> great, but it works; conversion to rgeos from gpclib might also work
>>> using the wrappers for gpclib objects included in rgeos.
>>> 
>>> Roger
>>> 
>>> 
>>>> 
>>>> 1, start R, use some packages:
>>>> 
>>>> $ R --vanilla
>>>> 
>>>> R version 2.15.1 (2012-06-22) -- "Roasted Marshmallows"
>>>> Copyright (C) 2012 The R Foundation for Statistical Computing
>>>> ISBN 3-900051-07-0
>>>> Platform: i486-pc-linux-gnu (32-bit)
>>>> 
>>>> R is free software and comes with ABSOLUTELY NO WARRANTY.
>>>> You are welcome to redistribute it under certain conditions.
>>>> Type 'license()' or 'licence()' for distribution details.
>>>>
>>>>  Natural language support but running in an English locale
>>>> 
>>>> R is a collaborative project with many contributors.
>>>> Type 'contributors()' for more information and
>>>> 'citation()' on how to cite R or R packages in publications.
>>>> 
>>>> Type 'demo()' for some demos, 'help()' for on-line help, or
>>>> 'help.start()' for an HTML browser interface to help.
>>>> Type 'q()' to quit R.
>>>> 
>>>>> library(spatstat)
>>>> Loading required package: mgcv
>>>> This is mgcv 1.7-21. For overview type 'help("mgcv-package")'.
>>>> Loading required package: deldir
>>>> deldir 0.0-20
>>>> spatstat 1.28-2
>>>> Type ?help(spatstat)? for an overview of spatstat
>>>>     ?latest.news()? for news on latest version
>>>>     ?licence.polygons()? for licence information on polygon calculations
>>>> 
>>>> 2. Run this to create some objects:
>>>> 
>>>>> example(tess)
>>>> 
>>>> tess>   A <- tess(xgrid=0:4,ygrid=0:4)
>>>> 
>>>> tess>   A
>>>> Tessellation
>>>> Tiles are equal rectangles, of dimension 1 x 1 units
>>>> 4 by 4 grid of tiles
>>>> window: rectangle = [0, 4] x [0, 4] units
>>>> 
>>>> tess>   B <- A[c(1, 2, 5, 7, 9)]
>>>> 
>>>> tess>   B
>>>> Tessellation
>>>> Tessellation is determined by a factor-valued image with 5 levels
>>>> window: binary image mask
>>>> 384 x 192 pixel array (ny, nx)
>>>> enclosing rectangle: [0, 3] x [1, 4] units
>>>> 
>>>> tess>   v <- as.im(function(x,y){factor(round(5 * (x^2 + y^2)))}, 
>>>> W=owin())
>>>> 
>>>> tess>   levels(v) <- letters[seq(length(levels(v)))]
>>>> 
>>>> tess>   E <- tess(image=v)
>>>> 
>>>> tess>   E
>>>> Tessellation
>>>> Tessellation is determined by a factor-valued image with 11 levels
>>>> window: binary image mask
>>>> 128 x 128 pixel array (ny, nx)
>>>> enclosing rectangle: [0, 1] x [0, 1] units
>>>> 
>>>> 3. Try conversion:
>>>> 
>>>>> as(E,"SpatialPolygons")
>>>> Error in as(E, "SpatialPolygons") :
>>>>  no method or default for coercing "tess" to "SpatialPolygons"
>>>> 
>>>> 4. Try conversion with maptools:
>>>> 
>>>>> library(maptools)
>>>> Loading required package: foreign
>>>> Loading required package: sp
>>>> Loading required package: lattice
>>>> Checking rgeos availability: TRUE
>>>>> as(E,"SpatialPolygons")
>>>> 
>>>> *** caught segfault ***
>>>> address (nil), cause 'memory not mapped'
>>>> 
>>>> I've not looked at the maptools code, but the tess object can be one
>>>> of three types according to ?tess, and I bet the conversion code
>>>> doesn't check what its dealing with...
>>>> 
>>>> Barry
>>>> 
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at r-project.org
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>> 
>>> 
>>> --
>>> Roger Bivand
>>> Department of Economics, NHH Norwegian School of Economics,
>>> Helleveien 30, N-5045 Bergen, Norway.
>>> voice: +47 55 95 93 55; fax +47 55 95 95 43
>>> e-mail: Roger.Bivand at nhh.no
>> 
>> --
>> Roger Bivand
>> Department of Economics, NHH Norwegian School of Economics,
>> Helleveien 30, N-5045 Bergen, Norway.
>> voice: +47 55 95 93 55; fax +47 55 95 95 43
>> e-mail: Roger.Bivand at nhh.no
>
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From l.hilger at ku.de  Mon Oct 29 16:18:23 2012
From: l.hilger at ku.de (Ludwig Hilger)
Date: Mon, 29 Oct 2012 08:18:23 -0700 (PDT)
Subject: [R-sig-Geo] RSAGA issues
In-Reply-To: <508D71F8.8030907@gwdg.de>
References: <508A3F6E.8070508@ku.de> <508D71F8.8030907@gwdg.de>
Message-ID: <1351523903168-7581491.post@n2.nabble.com>

Dear list, 

TY for answering.
The first (Mr. Hurling) and the second (Input grids in the form of GRIDS =
"t_asp_class.sgrd;t_elev_class.sgrd" helped) issue are solved now.
I am still fighting with the resampling grid module and I have not found a
solution in the archives and got none on sourceforge. So here it is again,
hopefully explained a little better now:

1. When I resample a grid, I have to provide USER_YMIN, USER_XMIN, USER_XMAX
and USER_YMAX. Is there a way to automatically calculate these values from
the input DEM header and the cellsize selected for
resampling (as SAGA seems to do in the GUI)? 
2. And if I copy the values from the SAGA GUI (after typing in the new
cellsize, the other four values in the GUI dialoge change), it is still not
working!

This code: 
setwd("My working directory")
rsaga.geoprocessor(lib = "grid_tools", module = 0, param = list(INPUT =
"mydem.sgrd", GRID_GRID = "DEM_resampled.sgrd", KEEP_TYPE = TRUE, TARGET =
0, SCALE_UP_METHOD = 6, SCALE_DOWN_METHOD = 4,
USER_SIZE = res,          # new cellsize read by scan(), eg 50
USER_XMIN = 24285,     # should be automatically calculated from input file
header and new cellsize
USER_YMIN = 186945,   # should be automatically calculated from input file
header and new cellsize
USER_YMAX = 197795,  # should be automatically calculated from input file
header and new cellsize
USER_XMAX = 35835))  # should be automatically calculated from input file
header and new cellsize            

gives:
Grid system: 10; 1158x 1086y; 24285x 186945y
Grid: DEM_2006-2010
Additional Grids: No objects
Additional Grids: No objects
Preserve Data Type: yes
Target Grid: user defined

[...] (rsaga.get.usage("grid_tools", 0))

error: executing module [Resampling]
Warnmeldung:
Ausf?hrung von Kommando '"C:\Program Files
(x86)\SAGA-GIS_2.0.8/saga_cmd.exe" grid_tools 0 -INPUT
"D:/PROSA_Daten/ALS/ALS_2006-2010/DEM_2006-2010.sgrd" -GRID_GRID
"DEM_resampled.sgrd" -KEEP_TYPE  -TARGET "0" -SCALE_UP_METHOD "6"
-SCALE_DOWN_METHOD "4" -USER_SIZE "50" -USER_XMIN "24285" -USER_YMIN
"186945" -USER_YMAX "197795" -USER_XMAX "35835"' ergab Status 1

Thank you again!
Ludwig



Rainer Hurling wrote
> On 26.10.2012 09:44 (UTC+2), Ludwig Hilger wrote:
>> 
>> Dear list,
>> 
>> I am comparatively new to RSAGA and have come across three problems I
>> have not been able solve by searching on the internet. Your help would
>> be very much appreciated. This is SAGA 2.0.8 and R 2.15.1.
>> 
>> 1. Is there a way to access the header of a *.sgrd without having to
>> load the whole grid, i.e. not using read.sgrd()$header? I want to
>> determine the cellsize of a *.sgrd from within r for informational
>> purposes and I have 1 m grids with 62 km2.....
> 
> The .sgrd file _is_ the header file of a SAGA GIS grid file. The grids
> data is in .sdat instead. You can read these very small header files
> (.sgrd) with several functions, for example
> 
> 
> hd <- readLines("filename.sgrd", n=-1)
> 
> # split strings in names and values parts
> require(stringr)
> hd <- unlist(str_split(hd, "\t= "))
> 
> # make a dataframe from the header data
> header <- data.frame(Parameter=hd[seq(1,length(hd),2)],
>                      Value=hd[seq(2,length(hd),2)])
> 
> # The contents of such header is like that
> header
> #         Parameter              Value
> #1             NAME          DGM5_saga
> #2      DESCRIPTION
> #3             UNIT
> #4  DATAFILE_OFFSET                  0
> #5       DATAFORMAT              FLOAT
> #6    BYTEORDER_BIG              FALSE
> #7    POSITION_XMIN 3449220.0000000000
> #8    POSITION_YMIN 5487020.0000000000
> #9      CELLCOUNT_X               2907
> #10     CELLCOUNT_Y               6538
> #11        CELLSIZE      10.0000000000
> #12        Z_FACTOR           1.000000
> #13    NODATA_VALUE      -99999.000000
> #14     TOPTOBOTTOM              FALSE
> 
> 
> The other questions seem to be already answered on r-sig-geo and/or SAGA
> GIS discussion forum (
> http://sourceforge.net/p/saga-gis/discussion/790705/thread/77e3979c/ ).
> 
> Hope this helps,
> Rainer
> 
> 
>> -------------------------------------------------------------------------------
>> 
>> 
>> 2. I have tried to call the Grid sum module in the following way:
>>     rsaga.geoprocessor(
>>     lib = ?grid_calculus?,
>>     module = 8,
>>     param = list(
>>     GRIDS = list(?t_elev_class.sgrd?, ?t_asp_class.sgrd?),
>>     RESULT = ?t_codes?
>>             )
>>     )
>> 
>> I get the following error, i.e. arguments of the function seem to get
>> mixed up:
>> 
>> ?library path: C:Program Files (x86)SAGA-GIS_2.0.8/modules
>> library name: grid_calculus
>> module name : Grids Sum
>> author : O. Conrad (c) 2010
>> 
>> Load grid: t_codes...
>> 
>> failed
>> 
>> error: Grid file could not be opened.
>> 
>> error: input file t_codes
>> 
>> error: empty input list GRIDS
>> Usage: 8 -GRIDS -RESULT
>> -GRIDS: Grids
>> Grid list (input)
>> -RESULT: Sum
>> Grid (output)
>> 
>> error: executing module Grids Sum
>> Warnmeldung:
>> Ausf?hrung von Kommando '"C:Program Files
>> (x86)SAGA-GIS_2.0.8/saga_cmd.exe" grid_calculus 8 -GRIDS
>> "t_elev_class.sgrd" -RESULT "t_asp_class.sgrd" -GRIDS "t_codes"' ergab
>> Status 1?
>> 
>> I have also tried c() instead of list() for the GRID-argument, I have
>> moeved GRID out of the param-list, etc. . In contrast,
>> rsaga.grid.calculus() works fine. I seem to have the same problem with
>> other modules as well, probably I do not provide the input grids in the
>> right way?
>> 
>> -------------------------------------------------------------------------------
>> 
>> 
>> 3.
>> a) When I resample a grid, I have to provide USER_YMIN, USER_XMIN,
>> USER_XMAX and USER_YMAX. Is there a way to automatically calculate these
>> values from the input DEM header and the cellsize selected for
>> resampling (as SAGA seems to do in the GUI)?
>> b) If I want to use a target grid as a model for the new grid, where is
>> this to be specified? rsaga.get.usage("grid_tools", 0) gives me only the
>> options GRID_GRID and USER_GRID (which are output arguments according to
>> get.usage). There are no arguments for the path to the target grid.
>> 
>> thank you,
>> Ludwig
> 
> _______________________________________________
> R-sig-Geo mailing list

> R-sig-Geo@

> https://stat.ethz.ch/mailman/listinfo/r-sig-geo





--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/RSAGA-issues-tp7581423p7581491.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From simon.ohanlon at imperial.ac.uk  Mon Oct 29 16:19:17 2012
From: simon.ohanlon at imperial.ac.uk (O'Hanlon, Simon J)
Date: Mon, 29 Oct 2012 15:19:17 +0000
Subject: [R-sig-Geo] spatstat crashes R when converting tess to sp
 objects
In-Reply-To: <7AE0828DCFFC0144817331B53EDC11A025D9ED34@icexch-m5.ic.ac.uk>
References: <e622b07988de4f949fb356bb4ade51d6@EX-1-HT0.lancs.local>
	<CANVKczNq-rhWUCS4-DwV0iGgTW270Gk2fv8DCUOGAm2mORvQDw@mail.gmail.com>,
	<alpine.LRH.2.02.1210281402360.22752@reclus.nhh.no>
	<7AE0828DCFFC0144817331B53EDC11A025D9E63B@icexch-m5.ic.ac.uk>,
	<alpine.LRH.2.02.1210281440180.22752@reclus.nhh.no>
	<7AE0828DCFFC0144817331B53EDC11A025D9EAC1@icexch-m5.ic.ac.uk>
	<alpine.LRH.2.02.1210291248160.26896@reclus.nhh.no>,
	<alpine.LRH.2.02.1210291515340.26896@reclus.nhh.no>,
	<7AE0828DCFFC0144817331B53EDC11A025D9ED34@icexch-m5.ic.ac.uk>
Message-ID: <7AE0828DCFFC0144817331B53EDC11A025D9ED62@icexch-m5.ic.ac.uk>

sorry - forgot to cc to list...

Dear Roger,
Thank you, very much. With maptools svn revision 239 it does indeed run through my script without crashing now.

Many thanks,

Simon


On Mon, 29 Oct 2012, Roger Bivand wrote:

> On Mon, 29 Oct 2012, O'Hanlon, Simon J wrote:
>
>> Further to this problem, I have experienced some more odd behaviour with
>> the coercion from tess to sp.
>>
>> My real dataset is 3607 points within the observation window. If I try and
>> run this straight away I get a segfault crash with the error message:
>>
>> *** caught segfault ***
>> address 0x0, cause 'memory not mapped'
>>
>> Traceback:
>> 1: .Call("Polygons_c", srl, ID, PACKAGE = "sp")
>> 2: Polygons(pieces, id)
>> 3: owin2Polygons(y[[i]], nam[i])
>> 4: as.SpatialPolygons.tess(from)
>> 5: asMethod(object)
>> 6: as(v, "SpatialPolygons")
>>
>> This is using the spatstat.options(gpclib=T) workaround posted by Roger.
>> However if I take a small sample of say 50 rows from the dataset, run the
>> script on these and coerce from tess to sp it runs fine. Interestingly I
>> can then re-read the data file and run the analysis on all 3607 points
>> within the same R session and corece to sp with no problems at all. However
>> it crashes every time if I don't 'prime' the function with a small run
>> dataset first?!
>>
>> I can try to provide a reproducible example if that will help more? (the
>> easiest way is if I can share my datapoint locations, but I have to ask
>> permission first). Otherwise I will try to recreate this from within R.
>
> Yes, the specific failing data set is the best bet; if passed through an
> off-list communication, it can be handled with discretion. Could you also
> perhaps update sp from R-Forge if you can install a source package (you'll
> need to check out from anonymous SVN, see this page:

With your data set, the crash is prevented with the development version of
sp (R-forge revision 1300). I've added a try() in maptools in the coercion
method from tess to SpatialPolygons, and have established that zero-length
pieces are created when the tile for a tesselation has a single raster
cell TRUE. In cases with > 1 cell, as.polygonal() returns a "polygonal"
object, but where it is just one, it returns a "rectangle" object, which
doesn't have the required components - this may well have been the
underlying problem all the time, as Barry suggested.

I've added code to owin2Polygons() called by the coercion method to branch
on the object type returned by as.polygonal(), and your example now works,
admittedly using gpclib in as.polygonal(), which it might be appropriate
to do something about. Try with R-forge maptools check out, revision 239.

Roger

>
> https://r-forge.r-project.org/scm/?group_id=1014
>
> or if you like I can get a Windows binary package run up on Win-builder.
>
> I do see that with the patched sp, and points generated by:
>
> set.seed(1)
> p <- coordinates(spsample(africa, type="random", n=3500))
> spatstat.options("gpclib"=TRUE)
>
> the result is OK, but for some other seeds, a degenerate pieces is created
> and I see:
>
>> vp <- as( v , "SpatialPolygons" )
> Error: length(srl) > 0 is not TRUE
>
> So the revised sp would trap the error, I think. However, it would be useful
> to debug this as far as possible.
>
> Roger
>
>>
>> Thanks,
>>
>> Simon
>>
>> ________________________________________
>> From: Roger Bivand [Roger.Bivand at nhh.no]
>> Sent: 28 October 2012 13:43
>> To: O'Hanlon, Simon J
>> Cc: Barry Rowlingson; r-sig-geo at r-project.org
>> Subject: RE: [R-sig-Geo] spatstat crashes R when converting tess to sp
>> objects
>>
>> On Sun, 28 Oct 2012, O'Hanlon, Simon J wrote:
>>
>>> Dear Roger and Barry,
>>> Thank you so much for your, as ever, lightening fast responses. This is
>>> one of the many reasons why I love using R as a platform so much. That
>>> workaround has solved the issue for me now.
>>
>> Simon,
>>
>> With a good reproducible example available, life is much easier, and in
>> fact this was a real crash, so sp will be improved (made safer) thanks to
>> your posting. Making things work better is shared, really, as this case
>> shows.
>>
>> Roger
>>
>>>
>>> Many, many thanks,
>>>
>>> Simon
>>> ________________________________________
>>> From: Roger Bivand [Roger.Bivand at nhh.no]
>>> Sent: 28 October 2012 13:30
>>> To: Barry Rowlingson
>>> Cc: O'Hanlon, Simon J; r-sig-geo at r-project.org
>>> Subject: Re: [R-sig-Geo] spatstat crashes R when converting tess to sp
>>> objects
>>>
>>> On Sun, 28 Oct 2012, Barry Rowlingson wrote:
>>>
>>>> On Sun, Oct 28, 2012 at 12:22 PM, O'Hanlon, Simon J
>>>> <simon.ohanlon at imperial.ac.uk> wrote:
>>>>> Dear list,
>>>>
>>>>> #Reproducible example
>>>>
>>>> I think maptools isn't coping with certain types of tess object. I
>>>> can reproduce this in three lines without needing a download :)
>>>
>>> I'm seeing:
>>>
>>> Warning message:
>>> In as.polygonal(x) :
>>>   Can't convert mask to polygon: gpclib is disabled/unavailable
>>>
>>> called in maptools:::owin2Polygons:
>>>
>>> x <- as.polygonal(x)
>>>
>>> where x is an element of the list y made from the tesselation in
>>> maptools:::as.SpatialPolygons.tess by
>>>
>>> y <- tiles(x)
>>>
>>> Since as.polygonal(x) fails, x$bdry is NULL, and pieces is an empty
>>> list. I've patched sp:::Polygons() to trap the empty list on R-Forge, so
>>> that the user will see (using the current status of rspatial/sp on
>>> R-Forge):
>>>
>>>> vp <- as( v , "SpatialPolygons" )
>>> Error: length(srl) > 0 is not TRUE
>>> In addition: Warning message:
>>> In as.polygonal(x) :
>>>   Can't convert mask to polygon: gpclib is disabled/unavailable
>>>
>>> The resolution for now is:
>>>
>>> spatstat.options("gpclib"=TRUE)
>>>
>>> letting as.polygonal() do its stuff for a W$type "mask" tesselation. Not
>>> great, but it works; conversion to rgeos from gpclib might also work
>>> using the wrappers for gpclib objects included in rgeos.
>>>
>>> Roger
>>>
>>>
>>>>
>>>> 1, start R, use some packages:
>>>>
>>>> $ R --vanilla
>>>>
>>>> R version 2.15.1 (2012-06-22) -- "Roasted Marshmallows"
>>>> Copyright (C) 2012 The R Foundation for Statistical Computing
>>>> ISBN 3-900051-07-0
>>>> Platform: i486-pc-linux-gnu (32-bit)
>>>>
>>>> R is free software and comes with ABSOLUTELY NO WARRANTY.
>>>> You are welcome to redistribute it under certain conditions.
>>>> Type 'license()' or 'licence()' for distribution details.
>>>>
>>>>  Natural language support but running in an English locale
>>>>
>>>> R is a collaborative project with many contributors.
>>>> Type 'contributors()' for more information and
>>>> 'citation()' on how to cite R or R packages in publications.
>>>>
>>>> Type 'demo()' for some demos, 'help()' for on-line help, or
>>>> 'help.start()' for an HTML browser interface to help.
>>>> Type 'q()' to quit R.
>>>>
>>>>> library(spatstat)
>>>> Loading required package: mgcv
>>>> This is mgcv 1.7-21. For overview type 'help("mgcv-package")'.
>>>> Loading required package: deldir
>>>> deldir 0.0-20
>>>> spatstat 1.28-2
>>>> Type ?help(spatstat)? for an overview of spatstat
>>>>     ?latest.news()? for news on latest version
>>>>     ?licence.polygons()? for licence information on polygon calculations
>>>>
>>>> 2. Run this to create some objects:
>>>>
>>>>> example(tess)
>>>>
>>>> tess>   A <- tess(xgrid=0:4,ygrid=0:4)
>>>>
>>>> tess>   A
>>>> Tessellation
>>>> Tiles are equal rectangles, of dimension 1 x 1 units
>>>> 4 by 4 grid of tiles
>>>> window: rectangle = [0, 4] x [0, 4] units
>>>>
>>>> tess>   B <- A[c(1, 2, 5, 7, 9)]
>>>>
>>>> tess>   B
>>>> Tessellation
>>>> Tessellation is determined by a factor-valued image with 5 levels
>>>> window: binary image mask
>>>> 384 x 192 pixel array (ny, nx)
>>>> enclosing rectangle: [0, 3] x [1, 4] units
>>>>
>>>> tess>   v <- as.im(function(x,y){factor(round(5 * (x^2 + y^2)))},
>>>> W=owin())
>>>>
>>>> tess>   levels(v) <- letters[seq(length(levels(v)))]
>>>>
>>>> tess>   E <- tess(image=v)
>>>>
>>>> tess>   E
>>>> Tessellation
>>>> Tessellation is determined by a factor-valued image with 11 levels
>>>> window: binary image mask
>>>> 128 x 128 pixel array (ny, nx)
>>>> enclosing rectangle: [0, 1] x [0, 1] units
>>>>
>>>> 3. Try conversion:
>>>>
>>>>> as(E,"SpatialPolygons")
>>>> Error in as(E, "SpatialPolygons") :
>>>>  no method or default for coercing "tess" to "SpatialPolygons"
>>>>
>>>> 4. Try conversion with maptools:
>>>>
>>>>> library(maptools)
>>>> Loading required package: foreign
>>>> Loading required package: sp
>>>> Loading required package: lattice
>>>> Checking rgeos availability: TRUE
>>>>> as(E,"SpatialPolygons")
>>>>
>>>> *** caught segfault ***
>>>> address (nil), cause 'memory not mapped'
>>>>
>>>> I've not looked at the maptools code, but the tess object can be one
>>>> of three types according to ?tess, and I bet the conversion code
>>>> doesn't check what its dealing with...
>>>>
>>>> Barry
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at r-project.org
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>
>>> --
>>> Roger Bivand
>>> Department of Economics, NHH Norwegian School of Economics,
>>> Helleveien 30, N-5045 Bergen, Norway.
>>> voice: +47 55 95 93 55; fax +47 55 95 95 43
>>> e-mail: Roger.Bivand at nhh.no
>>
>> --
>> Roger Bivand
>> Department of Economics, NHH Norwegian School of Economics,
>> Helleveien 30, N-5045 Bergen, Norway.
>> voice: +47 55 95 93 55; fax +47 55 95 95 43
>> e-mail: Roger.Bivand at nhh.no
>
>

--
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From mohammedrashadkm at gmail.com  Mon Oct 29 18:31:13 2012
From: mohammedrashadkm at gmail.com (Mohammed Rashad)
Date: Mon, 29 Oct 2012 23:01:13 +0530
Subject: [R-sig-Geo] Kriging on Ecological data
Message-ID: <CANNqv9d+wGujgb+Y4a6vdNpAV5dCwKZ9P5k3=rqo5o-+Vd+3DA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121029/5e5f3e68/attachment.pl>

From rhurlin at gwdg.de  Mon Oct 29 19:27:44 2012
From: rhurlin at gwdg.de (Rainer Hurling)
Date: Mon, 29 Oct 2012 19:27:44 +0100
Subject: [R-sig-Geo] RSAGA issues
In-Reply-To: <1351523903168-7581491.post@n2.nabble.com>
References: <508A3F6E.8070508@ku.de> <508D71F8.8030907@gwdg.de>
	<1351523903168-7581491.post@n2.nabble.com>
Message-ID: <508ECAA0.6090307@gwdg.de>

On 29.10.2012 16:18 (UTC+2), Ludwig Hilger wrote:
> Dear list, 
> 
> TY for answering.
> The first (Mr. Hurling) and the second (Input grids in the form of GRIDS =
> "t_asp_class.sgrd;t_elev_class.sgrd" helped) issue are solved now.
> I am still fighting with the resampling grid module and I have not found a
> solution in the archives and got none on sourceforge. So here it is again,
> hopefully explained a little better now:
> 
> 1. When I resample a grid, I have to provide USER_YMIN, USER_XMIN, USER_XMAX
> and USER_YMAX. Is there a way to automatically calculate these values from
> the input DEM header and the cellsize selected for
> resampling (as SAGA seems to do in the GUI)? 

Hi Ludwig,

one possibility to calculate USER_XMIN etc. is, to use the values from
the header data of the .sgrd file, extracted for example like described
in my previous mail (see below).

In my example with the 'header' file you could use the (numerical)
values after 'POSITION_[XY]MIN', 'CELLSIZE' and 'CELLCOUNT_[XY]' to
compute the needed values:

  USER_XMIN:   POSITION_XMIN
  USER_XMAX:   POSITION_XMIN + CELLSIZE * CELLCOUNT_X
  USER_YMIN:   POSITION_YMIN
  USER_YMAX:   POSITION_YMIN + CELLSIZE * CELLCOUNT_Y

Depending of the method you read the .sgrd file, you eventually have to
transform the strings to get numbers.

>From this view my header object is a bit to complicated. If you want to
give it a try you could use something like

position_xmin <-
  as.numeric(as.character(unlist(subset(header, Parameter %in%
  "POSITION_XMIN", Value))))

I guess there are much more elegant ways to extract the header data
directly into your wanted formats and places ;)


> 2. And if I copy the values from the SAGA GUI (after typing in the new
> cellsize, the other four values in the GUI dialoge change), it is still not
> working!

The text based version 'saga_cmd' is a bit pedantic. When I try your
code I have to change from 'GRID_GRID' to 'USER_GRID', because you are
using 'TARGET=0' (which means user defined).

So this should work:

rsaga.geoprocessor(lib = "grid_tools", module = 0,
                   param = list(
                     INPUT = "mydem.sgrd",
                     USER_GRID = "DEM_resampled.sgrd",
                     KEEP_TYPE = TRUE,
                     TARGET = 0,
                     SCALE_UP_METHOD = 6,
                     SCALE_DOWN_METHOD = 4,
                     USER_SIZE = res,  # res = 50
                     USER_XMIN = 24285,
                     USER_XMAX = 35835,
                     USER_YMIN = 186945,
                     USER_YMAX = 197795
                     ))


Hope this helps,
Rainer


> This code: 
> setwd("My working directory")
> rsaga.geoprocessor(lib = "grid_tools", module = 0, param = list(INPUT =
> "mydem.sgrd", GRID_GRID = "DEM_resampled.sgrd", KEEP_TYPE = TRUE, TARGET =
> 0, SCALE_UP_METHOD = 6, SCALE_DOWN_METHOD = 4,
> USER_SIZE = res,          # new cellsize read by scan(), eg 50
> USER_XMIN = 24285,     # should be automatically calculated from input file
> header and new cellsize
> USER_YMIN = 186945,   # should be automatically calculated from input file
> header and new cellsize
> USER_YMAX = 197795,  # should be automatically calculated from input file
> header and new cellsize
> USER_XMAX = 35835))  # should be automatically calculated from input file
> header and new cellsize            
> 
> gives:
> Grid system: 10; 1158x 1086y; 24285x 186945y
> Grid: DEM_2006-2010
> Additional Grids: No objects
> Additional Grids: No objects
> Preserve Data Type: yes
> Target Grid: user defined
> 
> [...] (rsaga.get.usage("grid_tools", 0))
> 
> error: executing module [Resampling]
> Warnmeldung:
> Ausf?hrung von Kommando '"C:\Program Files
> (x86)\SAGA-GIS_2.0.8/saga_cmd.exe" grid_tools 0 -INPUT
> "D:/PROSA_Daten/ALS/ALS_2006-2010/DEM_2006-2010.sgrd" -GRID_GRID
> "DEM_resampled.sgrd" -KEEP_TYPE  -TARGET "0" -SCALE_UP_METHOD "6"
> -SCALE_DOWN_METHOD "4" -USER_SIZE "50" -USER_XMIN "24285" -USER_YMIN
> "186945" -USER_YMAX "197795" -USER_XMAX "35835"' ergab Status 1
> 
> Thank you again!
> Ludwig
> 
> 
> 
> Rainer Hurling wrote
>> On 26.10.2012 09:44 (UTC+2), Ludwig Hilger wrote:
>>>
>>> Dear list,
>>>
>>> I am comparatively new to RSAGA and have come across three problems I
>>> have not been able solve by searching on the internet. Your help would
>>> be very much appreciated. This is SAGA 2.0.8 and R 2.15.1.
>>>
>>> 1. Is there a way to access the header of a *.sgrd without having to
>>> load the whole grid, i.e. not using read.sgrd()$header? I want to
>>> determine the cellsize of a *.sgrd from within r for informational
>>> purposes and I have 1 m grids with 62 km2.....
>>
>> The .sgrd file _is_ the header file of a SAGA GIS grid file. The grids
>> data is in .sdat instead. You can read these very small header files
>> (.sgrd) with several functions, for example
>>
>>
>> hd <- readLines("filename.sgrd", n=-1)
>>
>> # split strings in names and values parts
>> require(stringr)
>> hd <- unlist(str_split(hd, "\t= "))
>>
>> # make a dataframe from the header data
>> header <- data.frame(Parameter=hd[seq(1,length(hd),2)],
>>                      Value=hd[seq(2,length(hd),2)])
>>
>> # The contents of such header is like that
>> header
>> #         Parameter              Value
>> #1             NAME          DGM5_saga
>> #2      DESCRIPTION
>> #3             UNIT
>> #4  DATAFILE_OFFSET                  0
>> #5       DATAFORMAT              FLOAT
>> #6    BYTEORDER_BIG              FALSE
>> #7    POSITION_XMIN 3449220.0000000000
>> #8    POSITION_YMIN 5487020.0000000000
>> #9      CELLCOUNT_X               2907
>> #10     CELLCOUNT_Y               6538
>> #11        CELLSIZE      10.0000000000
>> #12        Z_FACTOR           1.000000
>> #13    NODATA_VALUE      -99999.000000
>> #14     TOPTOBOTTOM              FALSE
>>
>>
>> The other questions seem to be already answered on r-sig-geo and/or SAGA
>> GIS discussion forum (
>> http://sourceforge.net/p/saga-gis/discussion/790705/thread/77e3979c/ ).
>>
>> Hope this helps,
>> Rainer
>>
>>
>>> -------------------------------------------------------------------------------
>>>
>>>
>>> 2. I have tried to call the Grid sum module in the following way:
>>>     rsaga.geoprocessor(
>>>     lib = ?grid_calculus?,
>>>     module = 8,
>>>     param = list(
>>>     GRIDS = list(?t_elev_class.sgrd?, ?t_asp_class.sgrd?),
>>>     RESULT = ?t_codes?
>>>             )
>>>     )
>>>
>>> I get the following error, i.e. arguments of the function seem to get
>>> mixed up:
>>>
>>> ?library path: C:Program Files (x86)SAGA-GIS_2.0.8/modules
>>> library name: grid_calculus
>>> module name : Grids Sum
>>> author : O. Conrad (c) 2010
>>>
>>> Load grid: t_codes...
>>>
>>> failed
>>>
>>> error: Grid file could not be opened.
>>>
>>> error: input file t_codes
>>>
>>> error: empty input list GRIDS
>>> Usage: 8 -GRIDS -RESULT
>>> -GRIDS: Grids
>>> Grid list (input)
>>> -RESULT: Sum
>>> Grid (output)
>>>
>>> error: executing module Grids Sum
>>> Warnmeldung:
>>> Ausf?hrung von Kommando '"C:Program Files
>>> (x86)SAGA-GIS_2.0.8/saga_cmd.exe" grid_calculus 8 -GRIDS
>>> "t_elev_class.sgrd" -RESULT "t_asp_class.sgrd" -GRIDS "t_codes"' ergab
>>> Status 1?
>>>
>>> I have also tried c() instead of list() for the GRID-argument, I have
>>> moeved GRID out of the param-list, etc. . In contrast,
>>> rsaga.grid.calculus() works fine. I seem to have the same problem with
>>> other modules as well, probably I do not provide the input grids in the
>>> right way?
>>>
>>> -------------------------------------------------------------------------------
>>>
>>>
>>> 3.
>>> a) When I resample a grid, I have to provide USER_YMIN, USER_XMIN,
>>> USER_XMAX and USER_YMAX. Is there a way to automatically calculate these
>>> values from the input DEM header and the cellsize selected for
>>> resampling (as SAGA seems to do in the GUI)?
>>> b) If I want to use a target grid as a model for the new grid, where is
>>> this to be specified? rsaga.get.usage("grid_tools", 0) gives me only the
>>> options GRID_GRID and USER_GRID (which are output arguments according to
>>> get.usage). There are no arguments for the path to the target grid.
>>>
>>> thank you,
>>> Ludwig


From vrukol at gmail.com  Mon Oct 29 23:12:13 2012
From: vrukol at gmail.com (marco milella)
Date: Mon, 29 Oct 2012 23:12:13 +0100
Subject: [R-sig-Geo] kriging limits
In-Reply-To: <CAGcXcEZT24R5RXX633kqczwhH76God59MyjhDfVm15T4q_G-7g@mail.gmail.com>
References: <CAGmuAUqXB+ksi26djzPi1Y4+p1LWaTZ4=J-+uTk6NgwptmufQA@mail.gmail.com>
	<CAGcXcEZT24R5RXX633kqczwhH76God59MyjhDfVm15T4q_G-7g@mail.gmail.com>
Message-ID: <CAGmuAUq-eBoxta=GA8PO_sYow-xvX6BcbQAfMxqjq1OOUw2n+Q@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121029/ab98339f/attachment.pl>

From xanthro_m at hotmail.com  Tue Oct 30 02:49:39 2012
From: xanthro_m at hotmail.com (zlong)
Date: Mon, 29 Oct 2012 18:49:39 -0700 (PDT)
Subject: [R-sig-Geo] Trouble with first passage time analysis
Message-ID: <1351561779829-7581501.post@n2.nabble.com>

Hey all,

I posted this question a few days ago on a different forum, and was directed
here. Hopefully someone will be able to help me out. I've managed to figure
out just about everything I need, I'm just left with one unresolved issue.
I'm fine up to the point of creating the ltraj object from a dataset.

/test<-read.table("~/Desktop/R_Directory/test.txt",header=TRUE)
attach(test)
library(adehabitatLT)
xy<-test[,c("x","y")]
date1<-as.character(date)
date<-as.POSIXct(date1)
fit1<-as.ltraj(xy,date,id=test$name,burst=name,typeII=TRUE)/

from here things start to get fuzzy...


Instead of following the basic expression,

/fpt(lt, radii, units = c("seconds", "hours", "days"))/


the sample code on the tutorial expressed fpt as,

/fpt(lt, seq(300,1000, length=30))/


But as far as I can tell this code does not set a specific radius distance
(e.g., 100 m), but rather defines how many radii are to be distributed
across the dataset.

The example code returns values for 30 radii (i.e., "length=30").

/data(puechcirc)
i <- fpt(puechcirc, seq(300,1000, length=30))
plot(i, scale = 500, warn = FALSE)/


Modifying the code, I calculated values for 5 radii using a subsample of my
data (attached below).

/i <- fpt(fit1, seq(length=5), units="days")
plot(i, scale = 5, warn = FALSE)
i/
[[1]]
          r1         r2         r3         r4       r5
1         NA         NA               NA               NA       NA
2   80403.66     NA               NA               NA       NA
3   58711.45     NA               NA               NA       NA
4   5325.09   137121.1         NA               NA       NA
5   25695.41   432542.8   587729.9   742917.0 2061795
6   32629.12   394459.5   553960.4   713461.3 2050644
7   13175.66   489781.9   649159.8 1441978.8 2088730
8   35531.17 1362903.1 1521188.3 1702321.9 2107085
9   60181.97 1348559.8 1515091.3 1698974.1 2124975
10 106913.46 1323955.4 1504503.8 1700214.7 2151971
11   94222.94 1334576.0 1513000.0 1711400.7 2145693
12   66315.86 1329840.1 1488550.8 1647261.5 2089818
13   68114.22 1352723.6 1512442.1 1690046.2 2098154
14   20141.44 1339237.6 1504857.4 1677927.2 2123560
15   5553.17   142994.1         NA              NA       NA
16 231598.68       NA             NA              NA       NA
17 231598.68       NA             NA              NA       NA
18         NA          NA             NA              NA       NA

5_radii.pdf
<http://r-sig-geo.2731867.n2.nabble.com/file/n7581501/5_radii.pdf>  
Fig. 1. fpt(fit1, seq(length=5), units="days")

Is there a way to manually select radius distances (in meters) rather than
specifying how many radii you?d like distributed across the dataset? Or am I
mistaken, and I simply have to estimate radius distances from the spatial
extent of my data (i.e., if an animal traveled 5 km and I had 5 radii, they
are spaced 1000 m apart). 

I have attached the small dataset I was using to test out the code in case
you'd like to play around with the data.
test.txt <http://r-sig-geo.2731867.n2.nabble.com/file/n7581501/test.txt>  
As a point of interest, the data represent radio-telemetry points for a
western toad. 

Any assistance would be greatly appreciated



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Trouble-with-first-passage-time-analysis-tp7581501.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From l.hilger at ku.de  Tue Oct 30 08:52:09 2012
From: l.hilger at ku.de (Ludwig Hilger)
Date: Tue, 30 Oct 2012 00:52:09 -0700 (PDT)
Subject: [R-sig-Geo] RSAGA issues
In-Reply-To: <508ECAA0.6090307@gwdg.de>
References: <508A3F6E.8070508@ku.de> <508D71F8.8030907@gwdg.de>
	<1351523903168-7581491.post@n2.nabble.com>
	<508ECAA0.6090307@gwdg.de>
Message-ID: <1351583529136-7581503.post@n2.nabble.com>

Hi Rainer,

this worked! I always get so confused with parameter options for the
geoprocessor as they seem to change from SAGA version to saga version and
sometimes get.usage does not help at all!

Thank you very much!!!


Rainer Hurling wrote
> On 29.10.2012 16:18 (UTC+2), Ludwig Hilger wrote:
>> Dear list, 
>> 
>> TY for answering.
>> The first (Mr. Hurling) and the second (Input grids in the form of GRIDS
>> =
>> "t_asp_class.sgrd;t_elev_class.sgrd" helped) issue are solved now.
>> I am still fighting with the resampling grid module and I have not found
>> a
>> solution in the archives and got none on sourceforge. So here it is
>> again,
>> hopefully explained a little better now:
>> 
>> 1. When I resample a grid, I have to provide USER_YMIN, USER_XMIN,
>> USER_XMAX
>> and USER_YMAX. Is there a way to automatically calculate these values
>> from
>> the input DEM header and the cellsize selected for
>> resampling (as SAGA seems to do in the GUI)? 
> 
> Hi Ludwig,
> 
> one possibility to calculate USER_XMIN etc. is, to use the values from
> the header data of the .sgrd file, extracted for example like described
> in my previous mail (see below).
> 
> In my example with the 'header' file you could use the (numerical)
> values after 'POSITION_[XY]MIN', 'CELLSIZE' and 'CELLCOUNT_[XY]' to
> compute the needed values:
> 
>   USER_XMIN:   POSITION_XMIN
>   USER_XMAX:   POSITION_XMIN + CELLSIZE * CELLCOUNT_X
>   USER_YMIN:   POSITION_YMIN
>   USER_YMAX:   POSITION_YMIN + CELLSIZE * CELLCOUNT_Y
> 
> Depending of the method you read the .sgrd file, you eventually have to
> transform the strings to get numbers.
> 
>>From this view my header object is a bit to complicated. If you want to
> give it a try you could use something like
> 
> position_xmin <-
>   as.numeric(as.character(unlist(subset(header, Parameter %in%
>   "POSITION_XMIN", Value))))
> 
> I guess there are much more elegant ways to extract the header data
> directly into your wanted formats and places ;)
> 
> 
>> 2. And if I copy the values from the SAGA GUI (after typing in the new
>> cellsize, the other four values in the GUI dialoge change), it is still
>> not
>> working!
> 
> The text based version 'saga_cmd' is a bit pedantic. When I try your
> code I have to change from 'GRID_GRID' to 'USER_GRID', because you are
> using 'TARGET=0' (which means user defined).
> 
> So this should work:
> 
> rsaga.geoprocessor(lib = "grid_tools", module = 0,
>                    param = list(
>                      INPUT = "mydem.sgrd",
>                      USER_GRID = "DEM_resampled.sgrd",
>                      KEEP_TYPE = TRUE,
>                      TARGET = 0,
>                      SCALE_UP_METHOD = 6,
>                      SCALE_DOWN_METHOD = 4,
>                      USER_SIZE = res,  # res = 50
>                      USER_XMIN = 24285,
>                      USER_XMAX = 35835,
>                      USER_YMIN = 186945,
>                      USER_YMAX = 197795
>                      ))
> 
> 
> Hope this helps,
> Rainer
> 
> 
>> This code: 
>> setwd("My working directory")
>> rsaga.geoprocessor(lib = "grid_tools", module = 0, param = list(INPUT =
>> "mydem.sgrd", GRID_GRID = "DEM_resampled.sgrd", KEEP_TYPE = TRUE, TARGET
>> =
>> 0, SCALE_UP_METHOD = 6, SCALE_DOWN_METHOD = 4,
>> USER_SIZE = res,          # new cellsize read by scan(), eg 50
>> USER_XMIN = 24285,     # should be automatically calculated from input
>> file
>> header and new cellsize
>> USER_YMIN = 186945,   # should be automatically calculated from input
>> file
>> header and new cellsize
>> USER_YMAX = 197795,  # should be automatically calculated from input file
>> header and new cellsize
>> USER_XMAX = 35835))  # should be automatically calculated from input file
>> header and new cellsize            
>> 
>> gives:
>> Grid system: 10; 1158x 1086y; 24285x 186945y
>> Grid: DEM_2006-2010
>> Additional Grids: No objects
>> Additional Grids: No objects
>> Preserve Data Type: yes
>> Target Grid: user defined
>> 
>> [...] (rsaga.get.usage("grid_tools", 0))
>> 
>> error: executing module [Resampling]
>> Warnmeldung:
>> Ausf?hrung von Kommando '"C:\Program Files
>> (x86)\SAGA-GIS_2.0.8/saga_cmd.exe" grid_tools 0 -INPUT
>> "D:/PROSA_Daten/ALS/ALS_2006-2010/DEM_2006-2010.sgrd" -GRID_GRID
>> "DEM_resampled.sgrd" -KEEP_TYPE  -TARGET "0" -SCALE_UP_METHOD "6"
>> -SCALE_DOWN_METHOD "4" -USER_SIZE "50" -USER_XMIN "24285" -USER_YMIN
>> "186945" -USER_YMAX "197795" -USER_XMAX "35835"' ergab Status 1
>> 
>> Thank you again!
>> Ludwig
>> 
>> 
>> 
>> Rainer Hurling wrote
>>> On 26.10.2012 09:44 (UTC+2), Ludwig Hilger wrote:
>>>>
>>>> Dear list,
>>>>
>>>> I am comparatively new to RSAGA and have come across three problems I
>>>> have not been able solve by searching on the internet. Your help would
>>>> be very much appreciated. This is SAGA 2.0.8 and R 2.15.1.
>>>>
>>>> 1. Is there a way to access the header of a *.sgrd without having to
>>>> load the whole grid, i.e. not using read.sgrd()$header? I want to
>>>> determine the cellsize of a *.sgrd from within r for informational
>>>> purposes and I have 1 m grids with 62 km2.....
>>>
>>> The .sgrd file _is_ the header file of a SAGA GIS grid file. The grids
>>> data is in .sdat instead. You can read these very small header files
>>> (.sgrd) with several functions, for example
>>>
>>>
>>> hd <- readLines("filename.sgrd", n=-1)
>>>
>>> # split strings in names and values parts
>>> require(stringr)
>>> hd <- unlist(str_split(hd, "\t= "))
>>>
>>> # make a dataframe from the header data
>>> header <- data.frame(Parameter=hd[seq(1,length(hd),2)],
>>>                      Value=hd[seq(2,length(hd),2)])
>>>
>>> # The contents of such header is like that
>>> header
>>> #         Parameter              Value
>>> #1             NAME          DGM5_saga
>>> #2      DESCRIPTION
>>> #3             UNIT
>>> #4  DATAFILE_OFFSET                  0
>>> #5       DATAFORMAT              FLOAT
>>> #6    BYTEORDER_BIG              FALSE
>>> #7    POSITION_XMIN 3449220.0000000000
>>> #8    POSITION_YMIN 5487020.0000000000
>>> #9      CELLCOUNT_X               2907
>>> #10     CELLCOUNT_Y               6538
>>> #11        CELLSIZE      10.0000000000
>>> #12        Z_FACTOR           1.000000
>>> #13    NODATA_VALUE      -99999.000000
>>> #14     TOPTOBOTTOM              FALSE
>>>
>>>
>>> The other questions seem to be already answered on r-sig-geo and/or SAGA
>>> GIS discussion forum (
>>> http://sourceforge.net/p/saga-gis/discussion/790705/thread/77e3979c/ ).
>>>
>>> Hope this helps,
>>> Rainer
>>>
>>>
>>>> -------------------------------------------------------------------------------
>>>>
>>>>
>>>> 2. I have tried to call the Grid sum module in the following way:
>>>>     rsaga.geoprocessor(
>>>>     lib = ?grid_calculus?,
>>>>     module = 8,
>>>>     param = list(
>>>>     GRIDS = list(?t_elev_class.sgrd?, ?t_asp_class.sgrd?),
>>>>     RESULT = ?t_codes?
>>>>             )
>>>>     )
>>>>
>>>> I get the following error, i.e. arguments of the function seem to get
>>>> mixed up:
>>>>
>>>> ?library path: C:Program Files (x86)SAGA-GIS_2.0.8/modules
>>>> library name: grid_calculus
>>>> module name : Grids Sum
>>>> author : O. Conrad (c) 2010
>>>>
>>>> Load grid: t_codes...
>>>>
>>>> failed
>>>>
>>>> error: Grid file could not be opened.
>>>>
>>>> error: input file t_codes
>>>>
>>>> error: empty input list GRIDS
>>>> Usage: 8 -GRIDS -RESULT
>>>> -GRIDS: Grids
>>>> Grid list (input)
>>>> -RESULT: Sum
>>>> Grid (output)
>>>>
>>>> error: executing module Grids Sum
>>>> Warnmeldung:
>>>> Ausf?hrung von Kommando '"C:Program Files
>>>> (x86)SAGA-GIS_2.0.8/saga_cmd.exe" grid_calculus 8 -GRIDS
>>>> "t_elev_class.sgrd" -RESULT "t_asp_class.sgrd" -GRIDS "t_codes"' ergab
>>>> Status 1?
>>>>
>>>> I have also tried c() instead of list() for the GRID-argument, I have
>>>> moeved GRID out of the param-list, etc. . In contrast,
>>>> rsaga.grid.calculus() works fine. I seem to have the same problem with
>>>> other modules as well, probably I do not provide the input grids in the
>>>> right way?
>>>>
>>>> -------------------------------------------------------------------------------
>>>>
>>>>
>>>> 3.
>>>> a) When I resample a grid, I have to provide USER_YMIN, USER_XMIN,
>>>> USER_XMAX and USER_YMAX. Is there a way to automatically calculate
>>>> these
>>>> values from the input DEM header and the cellsize selected for
>>>> resampling (as SAGA seems to do in the GUI)?
>>>> b) If I want to use a target grid as a model for the new grid, where is
>>>> this to be specified? rsaga.get.usage("grid_tools", 0) gives me only
>>>> the
>>>> options GRID_GRID and USER_GRID (which are output arguments according
>>>> to
>>>> get.usage). There are no arguments for the path to the target grid.
>>>>
>>>> thank you,
>>>> Ludwig
> 
> _______________________________________________
> R-sig-Geo mailing list

> R-sig-Geo@

> https://stat.ethz.ch/mailman/listinfo/r-sig-geo





-----
Dipl. Geogr. Ludwig Hilger
Wiss. MA
Lehrstuhl f?r Physische Geographie
Katholische Universit?t Eichst?tt-Ingolstadt
Ostenstra?e 18
85072 Eichst?tt

Tel.: 08421-93-1180 
--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/RSAGA-issues-tp7581423p7581503.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From clement.calenge at oncfs.gouv.fr  Tue Oct 30 09:08:03 2012
From: clement.calenge at oncfs.gouv.fr (Clement Calenge)
Date: Tue, 30 Oct 2012 09:08:03 +0100
Subject: [R-sig-Geo] Trouble with first passage time analysis
In-Reply-To: <1351561779829-7581501.post@n2.nabble.com>
References: <1351561779829-7581501.post@n2.nabble.com>
Message-ID: <508F8AE3.7070109@oncfs.gouv.fr>


> I posted this question a few days ago on a different forum, and was directed
> here. Hopefully someone will be able to help me out. I've managed to figure
> out just about everything I need, I'm just left with one unresolved issue.
> I'm fine up to the point of creating the ltraj object from a dataset.
>
> /test<-read.table("~/Desktop/R_Directory/test.txt",header=TRUE)
> attach(test)
> library(adehabitatLT)
> xy<-test[,c("x","y")]
> date1<-as.character(date)
> date<-as.POSIXct(date1)
> fit1<-as.ltraj(xy,date,id=test$name,burst=name,typeII=TRUE)/
>
> from here things start to get fuzzy...
>
>
> Instead of following the basic expression,
>
> /fpt(lt, radii, units = c("seconds", "hours", "days"))/
>
>
> the sample code on the tutorial expressed fpt as,
>
> /fpt(lt, seq(300,1000, length=30))/
>
>
> But as far as I can tell this code does not set a specific radius distance
> (e.g., 100 m), but rather defines how many radii are to be distributed
> across the dataset.

radii is a vector containing the radii of the circle. Actually:

 > seq(300,1000, length=30)
  [1]  300.0000  324.1379  348.2759  372.4138  396.5517  420.6897  444.8276
  [8]  468.9655  493.1034  517.2414  541.3793  565.5172  589.6552  613.7931
[15]  637.9310  662.0690  686.2069  710.3448  734.4828  758.6207  782.7586
[22]  806.8966  831.0345  855.1724  879.3103  903.4483  927.5862  951.7241
[29]  975.8621 1000.0000

Therefore, the fpt will be calculated for a circle with a radius 300 m, 
for another circle with radius 324 m, etc. The use of the function seq() 
is just a way to generate quickly a vector of values for radii. But you 
can generate a vector of radii yourself, e.g. with:

fpt(lt, radii=300, units = c("seconds", "hours", "days"))

To calculate the fpt for a radius equal to 300 m. Or,

fpt(lt, radii=c(300, 500), units = c("seconds", "hours", "days"))

To calculate the fpt for a radius equal to 300 m, and for a radius equal 
to 500 m.

HTH,

Cl?ment Calenge

-- 
Cl?ment CALENGE
Cellule d'appui ? l'analyse de donn?es
Direction des Etudes et de la Recherche
Office national de la chasse et de la faune sauvage
Saint Benoist - 78610 Auffargis
tel. (33) 01.30.46.54.14


From simon.ohanlon at imperial.ac.uk  Tue Oct 30 10:34:25 2012
From: simon.ohanlon at imperial.ac.uk (O'Hanlon, Simon J)
Date: Tue, 30 Oct 2012 09:34:25 +0000
Subject: [R-sig-Geo] kriging limits
In-Reply-To: <CAGmuAUq-eBoxta=GA8PO_sYow-xvX6BcbQAfMxqjq1OOUw2n+Q@mail.gmail.com>
References: <CAGmuAUqXB+ksi26djzPi1Y4+p1LWaTZ4=J-+uTk6NgwptmufQA@mail.gmail.com>
	<CAGcXcEZT24R5RXX633kqczwhH76God59MyjhDfVm15T4q_G-7g@mail.gmail.com>
	<CAGmuAUq-eBoxta=GA8PO_sYow-xvX6BcbQAfMxqjq1OOUw2n+Q@mail.gmail.com>
Message-ID: <7AE0828DCFFC0144817331B53EDC11A025D9FA4B@icexch-m5.ic.ac.uk>

Dear Marco,
You can download shapefile of the world in varying resolutions at http://www.naturalearthdata.com/ Check under the links marked 'cultural'.

They  come with country boundaries but I think you can easily melt these using rgeos:::gUnaryUnion

Thanks,

Simon

-----Original Message-----
From: r-sig-geo-bounces at r-project.org [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of marco milella
Sent: 29 October 2012 22:12
To: r-sig-geo
Subject: Re: [R-sig-Geo] kriging limits

Dear Rob,

thanks for the help. However, my shp file is a SpatialLinesDataFrame, so things not work (blue plot). On the other hand, I tried with an old map of Europe (SpatialPolygonsDataFrame) and it works fine. Do any of you know where to find SpatialPolygonsDataframe .shp file of all world (possibly without coutries boundaries)?
Thanks in advance for any feedback
marco

2012/10/29 Rob Robinson <rob.robinson at bto.org>

> Marco,
>  'colouring' only the land is relatively easy, kriging over just the 
> land is much harder... To do the former, all you need to to do is plot 
> your kriged map, then plot a 'mask' over the sea area. To create the 
> mask, you need something like the snippet below
>
> world<-readShapeSpatial("10m_coastline.shp")
>
> library(rgeos)
> g3<-readWKT("POLYGON((-180 -90,-180 90,180 90,180 -90,-180 -90))")
> sea_mask<-gDifference(g3,world)
> plot(sea_mask, col='blue', border='transparent', add=T)
>
> hope that helps
> cheers
> rob
>
>
>
> **************  Find out about Britain's birds - www.bto.org/birdfacts
> **************
>
> Dr Rob Robinson, Principal Ecologist
> British Trust for Ornithology, The Nunnery, Thetford, Norfolk, IP24 2PU
> Ph: +44 (0)1842 750050     E: rob.robinson at bto.org
> Fx: +44 (0)1842 750030     W: www.bto.org/about-bto/our-staff/rob-robinson
>
> ====== "How can anyone be enlightened, when truth is so poorly lit" 
> =======
>
>
>
>
> On 28 October 2012 13:25, marco milella <vrukol at gmail.com> wrote:
>
>> Dear all,
>>
>> I'm a relatively new with R. However, I realized from colleagues the 
>> great capabilities of R or analyzing geo data.
>> I'm interested in performing an ordinary kriging to interpolate z 
>> value on a world map sarting from a dataset that (unfortunately) 
>> includes rather few observations (13 locations worldwide).
>> my problems are the following:
>>
>> 1) the obtained plot extend the kriging to seas and i would like to 
>> "color"
>> only lands
>> 2)I can't find a way to illustrate the kriging in a more "wave (or 
>> bands) of colors rather that in a extremely smooth way as you see in 
>> the attached figure
>>
>>
>>
>> below my commands
>>
>>   library(maptools);library(fields);library(maps);library(geoR)
>> #here I import a .shp file representing world coastlines downloaded 
>> from http://www.soest.hawaii.edu/pwessel/gshhs/index.html
>>   world<-readShapeSpatial("10m_coastline.shp")
>> #now I import my dataset (value.txt), including 13 rows (each 
>> location) and
>> 3 columns (Lat, Long, value)
>>   dati<-read.table("value.txt",header=TRUE)
>>   attach (dati)
>>   s<-cbind(Long,Lat);
>>   ml <- likfit(data=dati[,3],coords=s,
>>                fix.nugget=F,cov.model="exponential",
>>                ini = c(30, 5),nugget=5);
>>   sp1<-seq(min(s[,1]),max(s[,1]),length=500);
>>   sp2<-seq(min(s[,2]),max(s[,2]),length=500);
>>   sp<-expand.grid(sp1,sp2);
>>   inCA<-map.where("state",x=sp[,1],y=sp[,2]);
>>   inCA<-inCA=="world"
>>   pred<-krige.conv(data=dati[,3],coords=s,locations=sp,
>>                    krige=krige.control(cov.model="exponential",
>>                                        cov.pars=c(26.19,13.7),
>>                                        nugget=4.5763));
>>   image.plot(sp1,sp2,matrix(pred$predict,500,500),zlim=range(dati[,3]))
>>   map("world",add=T)
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>

	[[alternative HTML version deleted]]

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From vrukol at gmail.com  Tue Oct 30 10:37:44 2012
From: vrukol at gmail.com (marco milella)
Date: Tue, 30 Oct 2012 10:37:44 +0100
Subject: [R-sig-Geo] kriging limits
In-Reply-To: <7AE0828DCFFC0144817331B53EDC11A025D9FA4B@icexch-m5.ic.ac.uk>
References: <CAGmuAUqXB+ksi26djzPi1Y4+p1LWaTZ4=J-+uTk6NgwptmufQA@mail.gmail.com>
	<CAGcXcEZT24R5RXX633kqczwhH76God59MyjhDfVm15T4q_G-7g@mail.gmail.com>
	<CAGmuAUq-eBoxta=GA8PO_sYow-xvX6BcbQAfMxqjq1OOUw2n+Q@mail.gmail.com>
	<7AE0828DCFFC0144817331B53EDC11A025D9FA4B@icexch-m5.ic.ac.uk>
Message-ID: <CAGmuAUqskSz4pj24RX75L1g7uFE6aP=CiMHG5PGhfVsdb+Qg=w@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121030/d57010ae/attachment.pl>

From paolo.piras at uniroma3.it  Tue Oct 30 12:53:42 2012
From: paolo.piras at uniroma3.it (Paolo Piras)
Date: Tue, 30 Oct 2012 11:53:42 +0000
Subject: [R-sig-Geo] spatial regression model
In-Reply-To: <A7557249237BD449977E3AEE33C62AD317D83479@DBXPRD0410MB394.eurprd04.prod.outlook.com>
References: <A7557249237BD449977E3AEE33C62AD317D833A1@DBXPRD0410MB394.eurprd04.prod.outlook.com>,
	<A7557249237BD449977E3AEE33C62AD317D83479@DBXPRD0410MB394.eurprd04.prod.outlook.com>
Message-ID: <A7557249237BD449977E3AEE33C62AD317D834B7@DBXPRD0410MB394.eurprd04.prod.outlook.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121030/40e8b62d/attachment.pl>

From xanthro_m at hotmail.com  Tue Oct 30 13:46:53 2012
From: xanthro_m at hotmail.com (zlong)
Date: Tue, 30 Oct 2012 05:46:53 -0700 (PDT)
Subject: [R-sig-Geo] Trouble with first passage time analysis
In-Reply-To: <1351561779829-7581501.post@n2.nabble.com>
References: <1351561779829-7581501.post@n2.nabble.com>
Message-ID: <1351601213514-7581513.post@n2.nabble.com>

Oh! Now I get it. I figured it was something simple I just wasn't
understanding. Thank you very much



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Trouble-with-first-passage-time-analysis-tp7581501p7581513.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From Ravichandra.MONDRETI at cefe.cnrs.fr  Tue Oct 30 17:27:34 2012
From: Ravichandra.MONDRETI at cefe.cnrs.fr (Ravichandra MONDRETI)
Date: Tue, 30 Oct 2012 17:27:34 +0100
Subject: [R-sig-Geo] Spatial autocorrelation
Message-ID: <0572F5C875F0A74A97108D62AD6EACDB42C31B@ZZML.newcefe.newage.fr>



Dear all,

I have very recently started using R for analysing my spatial data. Is
there any way to split the main transect in to smaller ones to check for
autocorrelation at various lags or intervals.  For example, I am trying
to split the main transect (approximately of 20Km in length) consisting
of count data in to 3Km,5Km,10Km intervals and  perform the spatial
autocorrelation using R. Can we calculate the end points of the
Geographic coordinates (Latitude and Longitude) of the smaller transects
using that of the main transect. The time interval for each main
transect is 1 Hour or 60 minutes. My data looks like the following 

Obsevation No   Transect Id   Latitude  Longitude .........
     1                                XYZ 

Please someone help me with this.

Thanks in advance,
Ravi.


___________

Ravichandra Mondreti
PhD student/ Doctorant
Spatial Population Ecology Team
CEFE-CNRS
1919, route de Mende
F-34293 Montpellier Cedex 05
France.


From jaimebg27 at gmail.com  Wed Oct 31 12:14:43 2012
From: jaimebg27 at gmail.com (=?ISO-8859-1?Q?Jaime_Burbano_Gir=F3n?=)
Date: Wed, 31 Oct 2012 06:14:43 -0500
Subject: [R-sig-Geo] predict {dismo}
Message-ID: <CADiqS868B9v+Mjsr-hSSa0tvaOqYmdJvCG3z5J3yH0T_Bqepcw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121031/e89dca7a/attachment.pl>

From r.hijmans at gmail.com  Wed Oct 31 16:50:49 2012
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Wed, 31 Oct 2012 08:50:49 -0700
Subject: [R-sig-Geo] predict {dismo}
In-Reply-To: <CADiqS868B9v+Mjsr-hSSa0tvaOqYmdJvCG3z5J3yH0T_Bqepcw@mail.gmail.com>
References: <CADiqS868B9v+Mjsr-hSSa0tvaOqYmdJvCG3z5J3yH0T_Bqepcw@mail.gmail.com>
Message-ID: <CANtt_hxxguMJYMDjts2L3+FvmquQ9RkzAOeDVKeYCoq=hyKHmA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121031/0e4c7c7c/attachment.pl>

