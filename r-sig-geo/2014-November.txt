From sendmeoffer at gmail.com  Sat Nov  1 21:03:23 2014
From: sendmeoffer at gmail.com (Vladimir)
Date: Sat, 01 Nov 2014 21:03:23 +0100
Subject: [R-sig-Geo] Leader lines for inset map
Message-ID: <54553C8B.5030303@gmail.com>

Hello list!

I would like to add leader lines to my inset maps. These lines connect 
the frame of the inset map with the corresponding area on the main map. 
Good examples are here [1], [2], or here [3].

What is the most convenient R approach to do so?

Kind regards,
Vladimir.

---
[1] 
http://gce-lter.marsci.uga.edu/public/images/gce_study_area_blowup_nov07_rev.jpg
[2] http://pubs.usgs.gov/fs/fs08203/images/study_area.gif
[3] 
http://www.innovativegis.com/basis/supplements/bm_dec_02/Ironing_Colorado_files/image004.jpg


From bernd.vogelgesang at gmx.de  Sun Nov  2 22:32:45 2014
From: bernd.vogelgesang at gmx.de (Bernd Vogelgesang)
Date: Sun, 02 Nov 2014 22:32:45 +0100
Subject: [R-sig-Geo] Leader lines for inset map
In-Reply-To: <54553C8B.5030303@gmail.com>
References: <54553C8B.5030303@gmail.com>
Message-ID: <op.xopvgvzxl2i25i@bernd-terra-pc>

Hi Vladimir,
I'm sure, R is very versatile software, but it sounds really insane to me  
to try to do sth like your examples in R (If you haven't got to do this  
hundreds of times with different maps)
Map compositions are a matter of graphics programs or even better a  
Desktop GIS, like QGIS for example.

In QGIS, this would be a matter of just adding two composer frames,  
legend(s) and some lines drawn by hand.
"Coding" a layout seems not really reasonable when you can also drag and  
drop the items in a matter of minutes.

Just my 2 cents
Bernd

Am 01.11.2014, 21:03 Uhr, schrieb Vladimir <sendmeoffer at gmail.com>:

> Hello list!
>
> I would like to add leader lines to my inset maps. These lines connect  
> the frame of the inset map with the corresponding area on the main map.  
> Good examples are here [1], [2], or here [3].
>
> What is the most convenient R approach to do so?
>
> Kind regards,
> Vladimir.
>
> ---
> [1]  
> http://gce-lter.marsci.uga.edu/public/images/gce_study_area_blowup_nov07_rev.jpg
> [2] http://pubs.usgs.gov/fs/fs08203/images/study_area.gif
> [3]  
> http://www.innovativegis.com/basis/supplements/bm_dec_02/Ironing_Colorado_files/image004.jpg
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


-- 
Bernd Vogelgesang
Siedlerstra?e 2
91083 Baiersdorf/Igelsdorf
Tel: 09133-825374


From ropo.sadler at gmail.com  Mon Nov  3 00:23:52 2014
From: ropo.sadler at gmail.com (Rohan Sadler)
Date: Mon, 3 Nov 2014 07:23:52 +0800
Subject: [R-sig-Geo] Leader lines for inset map
In-Reply-To: <op.xopvgvzxl2i25i@bernd-terra-pc>
References: <54553C8B.5030303@gmail.com>
	<op.xopvgvzxl2i25i@bernd-terra-pc>
Message-ID: <CAJ_iHnd23MWJR9LsFOAWbU31OLmmA41mT0f_srj_t8a9HvrRJA@mail.gmail.com>

Hi Vladimir,

you will need to know the map coordinates of the corners of your AOI within
the image; and then also the map coordinates of your inset (on the scale of
the first map). Then simply use 'lines' to connect the corners.

I would concur with Bernd. I have seen ArcGIS fall over in map layout (it
becomes increasingly tedious the more maps you produce to make minor
changes and updates, even in the layout), due to an exceptionally large map
count. The only way around that as far as I can tell in ArcGIS is to
'code-it-up' and hence you are back in a similar situation as doing your
mapping with R. This is especially pertinent if you are happy with your
layouts, but your actual image/map is subject to ongoing revision and
update (e.g. it is the result of some computational process that continues
to be tuned or improved - SWeave?!?!).

On the whole, if you are getting 'publish' quality maps from R I'd be
interested. Alternatively, we would be using QGIS instead of ArcMap,
however, to get 'publish' quality maps for our reporting from QGIS requires
retraining of our GIS team and a sizable overhead to work out how best to
publish maps with QGIS (currently > cost of the software), whereas our
ArcMap workflow is already worked out. Note that you can still run R
processes from both ArcMap (through python) and QGIS if required.

Regards
Rohan



On 3 November 2014 05:32, Bernd Vogelgesang <bernd.vogelgesang at gmx.de>
wrote:

> Hi Vladimir,
> I'm sure, R is very versatile software, but it sounds really insane to me
> to try to do sth like your examples in R (If you haven't got to do this
> hundreds of times with different maps)
> Map compositions are a matter of graphics programs or even better a
> Desktop GIS, like QGIS for example.
>
> In QGIS, this would be a matter of just adding two composer frames,
> legend(s) and some lines drawn by hand.
> "Coding" a layout seems not really reasonable when you can also drag and
> drop the items in a matter of minutes.
>
> Just my 2 cents
> Bernd
>
> Am 01.11.2014, 21:03 Uhr, schrieb Vladimir <sendmeoffer at gmail.com>:
>
>
>  Hello list!
>>
>> I would like to add leader lines to my inset maps. These lines connect
>> the frame of the inset map with the corresponding area on the main map.
>> Good examples are here [1], [2], or here [3].
>>
>> What is the most convenient R approach to do so?
>>
>> Kind regards,
>> Vladimir.
>>
>> ---
>> [1] http://gce-lter.marsci.uga.edu/public/images/gce_study_
>> area_blowup_nov07_rev.jpg
>> [2] http://pubs.usgs.gov/fs/fs08203/images/study_area.gif
>> [3] http://www.innovativegis.com/basis/supplements/bm_dec_02/
>> Ironing_Colorado_files/image004.jpg
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>
> --
> Bernd Vogelgesang
> Siedlerstra?e 2
> 91083 Baiersdorf/Igelsdorf
> Tel: 09133-825374
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



-- 
Senior Scientist
Astron Environmental Services Pty. Ltd.
rohan.sadler at astron.com.au

Adjunct Senior Lecturer
School of Agricultural and Resource Economics, M089
The University of Western Australia

Office:  +61 8 94219684
Mobile:      0433 192 600

	[[alternative HTML version deleted]]


From pickering at penguin.kobe-u.ac.jp  Mon Nov  3 06:28:37 2014
From: pickering at penguin.kobe-u.ac.jp (Steve Pickering)
Date: Mon, 3 Nov 2014 14:28:37 +0900
Subject: [R-sig-Geo] Russia wrapping on orthographic projections
Message-ID: <CAEdPBsEv+0=UV2HVtDQkyVLz9bYfX=-NdyAR2xZwJUM5pqp=LQ@mail.gmail.com>

Hello, all,

I'm using the mapproj library (which is excellent; many thanks to
McIlroy, Brownrigg, Minka and Bivand!)

When I try to project the world from orientations which include Russia
or the Antarctic, these polygons do not close correctly.  Very quick
example here:

library(maps)
library(mapproj)
library(plotrix)
# plotrix just to draw a blue circle

map("world", proj="orthographic", orientation=c(0,20,0), type="n")
draw.circle(0,0,1, col="blue")
map("world", proj="orthographic", orientation=c(0,20,0), col="green",
fill=T, add=T)

Does anyone know of a workaround that will render these correctly?

Many thanks!

 - Steve.


Steve Pickering
Assistant Professor
Graduate School of Law
Kobe University
2-1 Rokkodai-cho
Nada-ku, Kobe
657-8501 Japan
pickering at penguin.kobe-u.ac.jp
http://www.stevepickering.net


From b.rowlingson at lancaster.ac.uk  Mon Nov  3 08:53:00 2014
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Mon, 3 Nov 2014 07:53:00 +0000
Subject: [R-sig-Geo] Leader lines for inset map
In-Reply-To: <8b8b67e6730d4eaba3e3ecdf21e88328@EX-1-HT0.lancs.local>
References: <8b8b67e6730d4eaba3e3ecdf21e88328@EX-1-HT0.lancs.local>
Message-ID: <CANVKczMi18zY0oS0jgEgamQukkMvZVxEdKhBoYawkTtpccG=hg@mail.gmail.com>

I don't think you'll get a complete solution from this mailing list until
you tell us how you are drawing your maps in the first place.

Are you using base graphics plotting, or ggplot, or ggmap, or lattice?
Could you throw us a few lines of code that show how you make your base and
insert maps? Otherwise you're going to get a bunch of "just draw lines"
answers...
On 1 Nov 2014 20:07, "Vladimir" <sendmeoffer at gmail.com> wrote:

> Hello list!
>
> I would like to add leader lines to my inset maps. These lines connect
> the frame of the inset map with the corresponding area on the main map.
> Good examples are here [1], [2], or here [3].
>
> What is the most convenient R approach to do so?
>
> Kind regards,
> Vladimir.
>
> ---
> [1]
>
> http://gce-lter.marsci.uga.edu/public/images/gce_study_area_blowup_nov07_rev.jpg
> [2] http://pubs.usgs.gov/fs/fs08203/images/study_area.gif
> [3]
>
> http://www.innovativegis.com/basis/supplements/bm_dec_02/Ironing_Colorado_files/image004.jpg
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From sendmeoffer at gmail.com  Mon Nov  3 11:22:14 2014
From: sendmeoffer at gmail.com (Vladimir)
Date: Mon, 03 Nov 2014 11:22:14 +0100
Subject: [R-sig-Geo] Leader lines for inset map
In-Reply-To: <CANVKczMi18zY0oS0jgEgamQukkMvZVxEdKhBoYawkTtpccG=hg@mail.gmail.com>
References: <8b8b67e6730d4eaba3e3ecdf21e88328@EX-1-HT0.lancs.local>
	<CANVKczMi18zY0oS0jgEgamQukkMvZVxEdKhBoYawkTtpccG=hg@mail.gmail.com>
Message-ID: <54575756.9040007@gmail.com>

Hello!

The minimal example is
===== (source 
http://r-sig-geo.2731867.n2.nabble.com/making-an-inset-in-a-map-figure-tp7584585p7584618.html 
)

    |library(TeachingDemos)
    library(maptools)
    |

    ||
    |data(wrld_simpl)

    plot(wrld_simpl,border=NA,col='blue',axes=TRUE, xlim=c(100,130),
    ylim=c(-40,30))

    tmp <- subplot(
      plot(wrld_simpl,border=NA,col='green',bg='white',axes=FALSE),
        'bottomleft', size=c(2,1), inset=c(0.01,0.01))

    tmp2 <- par('usr')

    tmp3 <- subplot(
    plot(wrld_simpl, border='red', axes=TRUE, xlim=c(95,105),
    ylim=c(-5,5), bg='lightgrey'), 'topright', size=c(2,2))

    par(xpd=TRUE)  # reset clipping region
    rect( tmp3$usr[1], tmp3$usr[3], tmp3$usr[2], tmp3$usr[4],
    border='orange' )

    op <- par(tmp[c('plt','usr')])
    rect( tmp2[1], tmp2[3], tmp2[2], tmp2[4], border='red' )
    par(op)
    |

=====

I want to connect orange rectangle with topright inset map.

All the best,
Vladimir.


On 03/11/14 08:53, Barry Rowlingson wrote:
>
> I don't think you'll get a complete solution from this mailing list 
> until you tell us how you are drawing your maps in the first place.
>
> Are you using base graphics plotting, or ggplot, or ggmap, or lattice? 
> Could you throw us a few lines of code that show how you make your 
> base and insert maps? Otherwise you're going to get a bunch of "just 
> draw lines" answers...
>
> On 1 Nov 2014 20:07, "Vladimir" <sendmeoffer at gmail.com 
> <mailto:sendmeoffer at gmail.com>> wrote:
>
>     Hello list!
>
>     I would like to add leader lines to my inset maps. These lines connect
>     the frame of the inset map with the corresponding area on the main
>     map.
>     Good examples are here [1], [2], or here [3].
>
>     What is the most convenient R approach to do so?
>
>     Kind regards,
>     Vladimir.
>
>     ---
>     [1]
>     http://gce-lter.marsci.uga.edu/public/images/gce_study_area_blowup_nov07_rev.jpg
>     [2] http://pubs.usgs.gov/fs/fs08203/images/study_area.gif
>     [3]
>     http://www.innovativegis.com/basis/supplements/bm_dec_02/Ironing_Colorado_files/image004.jpg
>
>     _______________________________________________
>     R-sig-Geo mailing list
>     R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
>     https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


	[[alternative HTML version deleted]]


From ropo.sadler at gmail.com  Mon Nov  3 12:45:53 2014
From: ropo.sadler at gmail.com (Rohan Sadler)
Date: Mon, 3 Nov 2014 19:45:53 +0800
Subject: [R-sig-Geo] Leader lines for inset map
In-Reply-To: <54575756.9040007@gmail.com>
References: <8b8b67e6730d4eaba3e3ecdf21e88328@EX-1-HT0.lancs.local>
	<CANVKczMi18zY0oS0jgEgamQukkMvZVxEdKhBoYawkTtpccG=hg@mail.gmail.com>
	<54575756.9040007@gmail.com>
Message-ID: <CAJ_iHnfzfE4YuQAqwFJYAqS_z1v4LnnWzYecp-ZF07NwKq4LZg@mail.gmail.com>

Hi Vladimir,

Cheap and nasty says add lines, but first define where you want to put your
insets explicitly by specifying x,y for the subplots. modified code below
(you will want to move your xy values around slightly to suit).

    library(TeachingDemos)
    library(maptools)

    data(wrld_simpl)

    plot(wrld_simpl,border=NA,col='blue',axes=TRUE, xlim=c(100,130),
    ylim=c(-40,30))

  tmp <- subplot(
      plot(wrld_simpl,border=NA,col='green',bg='white',axes=FALSE),
        y=c(-40,-25),x=c(75,110),inset=c(0.01,0.01))
    tmp2 <- par('usr')

    tmp3 <- subplot(
    plot(wrld_simpl, border='red', axes=TRUE, xlim=c(95,105),
    ylim=c(-5,5), bg='lightgrey'), y=c(-5,30),x=c(120,160))

     par(xpd=TRUE)  # reset clipping region
    rect( tmp3$usr[1], tmp3$usr[3], tmp3$usr[2], tmp3$usr[4],
    border='orange' )

  lines(c(tmp3$usr[1],120),c(tmp3$usr[4],30),lwd=2)
  lines(c(tmp3$usr[2],120),c(tmp3$usr[3],-5),lwd=2)

    op <- par(tmp[c('plt','usr')])
    rect( tmp2[1], tmp2[3], tmp2[2], tmp2[4], border='red' )
    par(op)

I've added in a ggmap equivalent, which gives close to publication quality
graphic, pulling a map from googlemaps (you may want imagery instead). All
based on Kahle & Wickham's excellent paper. Note that this example is
fudged in that the inset is a zoom out rather than a zoom in; and I could
waste a lot of time getting rid of the second 'accidental' legend. Go for
something other than the googlemaps API if you wish to publish something
similar with ggmap. Depending on one's level of abstraction, it still
requires you to add lines ... :)
(assuming I have understood your question right!!)

Regards
Rohan

library(ggmap)
# Source: http://journal.r-project.org/archive/2013-1/kahle-wickham.pdf

# violent crimes in houston, texas
violent_crimes <- subset(crime,
 offense != "auto theft" & offense != "theft" & offense != "burglary")

 # order violent crimes
 violent_crimes$offense <- factor(violent_crimes$offense,
 levels = c("robbery", "aggravated assault", "rape", "murder"))

 # restrict to downtown
 violent_crimes <- subset(violent_crimes,
 -95.39681 <= lon & lon <= -95.34188 &
 29.73631 <= lat & lat <= 29.78400)

# arbitrary area of interst
AOI<- data.frame(x=c(-95.38,-95.38,-95.385,-95.385,-95.38),
       y=c(29.74,29.745,29.745,29.74,29.74))
AOIConnectors<- data.frame(x=c(-95.38,-95.35836,-95.38,-95.35836),
       y=c(29.74,29.73631,29.745,29.75062),seg=rep(1:2,each=2))

# googlemaps api
houston <- get_map("houston", zoom = 14)

# generate your graphics layers
HoustonMap <- ggmap(houston, extent = "device", legend = "topleft")

overlay <- stat_density2d(
aes(x = lon, y = lat, fill = ..level.., alpha = ..level..),
bins = 4, geom = "polygon",
data = violent_crimes
)

# construct your image
HoustonMap + overlay + inset(
grob = ggplotGrob(ggplot() + overlay + theme_inset()),
xmin = -95.35836, xmax = Inf, ymin = -Inf, ymax = 29.75062)+
geom_line(aes(x,y,group=seg),data=AOIConnectors)+
geom_path(aes(x,y),data=AOI)





On 3 November 2014 18:22, Vladimir <sendmeoffer at gmail.com> wrote:

> Hello!
>
> The minimal example is
> ===== (source
>
> http://r-sig-geo.2731867.n2.nabble.com/making-an-inset-in-a-map-figure-tp7584585p7584618.html
> )
>
>     |library(TeachingDemos)
>     library(maptools)
>     |
>
>     ||
>     |data(wrld_simpl)
>
>     plot(wrld_simpl,border=NA,col='blue',axes=TRUE, xlim=c(100,130),
>     ylim=c(-40,30))
>
>     tmp <- subplot(
>       plot(wrld_simpl,border=NA,col='green',bg='white',axes=FALSE),
>         'bottomleft', size=c(2,1), inset=c(0.01,0.01))
>
>     tmp2 <- par('usr')
>
>     tmp3 <- subplot(
>     plot(wrld_simpl, border='red', axes=TRUE, xlim=c(95,105),
>     ylim=c(-5,5), bg='lightgrey'), 'topright', size=c(2,2))
>
>     par(xpd=TRUE)  # reset clipping region
>     rect( tmp3$usr[1], tmp3$usr[3], tmp3$usr[2], tmp3$usr[4],
>     border='orange' )
>
>     op <- par(tmp[c('plt','usr')])
>     rect( tmp2[1], tmp2[3], tmp2[2], tmp2[4], border='red' )
>     par(op)
>     |
>
> =====
>
> I want to connect orange rectangle with topright inset map.
>
> All the best,
> Vladimir.
>
>
> On 03/11/14 08:53, Barry Rowlingson wrote:
> >
> > I don't think you'll get a complete solution from this mailing list
> > until you tell us how you are drawing your maps in the first place.
> >
> > Are you using base graphics plotting, or ggplot, or ggmap, or lattice?
> > Could you throw us a few lines of code that show how you make your
> > base and insert maps? Otherwise you're going to get a bunch of "just
> > draw lines" answers...
> >
> > On 1 Nov 2014 20:07, "Vladimir" <sendmeoffer at gmail.com
> > <mailto:sendmeoffer at gmail.com>> wrote:
> >
> >     Hello list!
> >
> >     I would like to add leader lines to my inset maps. These lines
> connect
> >     the frame of the inset map with the corresponding area on the main
> >     map.
> >     Good examples are here [1], [2], or here [3].
> >
> >     What is the most convenient R approach to do so?
> >
> >     Kind regards,
> >     Vladimir.
> >
> >     ---
> >     [1]
> >
> http://gce-lter.marsci.uga.edu/public/images/gce_study_area_blowup_nov07_rev.jpg
> >     [2] http://pubs.usgs.gov/fs/fs08203/images/study_area.gif
> >     [3]
> >
> http://www.innovativegis.com/basis/supplements/bm_dec_02/Ironing_Colorado_files/image004.jpg
> >
> >     _______________________________________________
> >     R-sig-Geo mailing list
> >     R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
> >     https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
>
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



-- 
Senior Scientist
Astron Environmental Services Pty. Ltd.
rohan.sadler at astron.com.au

Adjunct Senior Lecturer
School of Agricultural and Resource Economics, M089
The University of Western Australia

Office:  +61 8 94219684
Mobile:      0433 192 600

	[[alternative HTML version deleted]]


From dan.rosauer at anu.edu.au  Wed Nov  5 03:20:31 2014
From: dan.rosauer at anu.edu.au (Dan Rosauer)
Date: Wed, 5 Nov 2014 02:20:31 +0000
Subject: [R-sig-Geo] Cause of error in spdep::errorsarlm
Message-ID: <014cba4a543a4e0197c59af8e8512987@SIXPR06MB0576.apcprd06.prod.outlook.com>

Hi Roger et al

I hope someone can help me with the following error with a call to the spdep function errorsarlm()

Calling the function returns this:  Error: $ operator is invalid for atomic vectors

Things I have already tried:
* testing with real and simulated data - error occurs
* running it on windows and linux - error is identical
* omitting various arguments to the function to see which one is the cause - error occurs with or without the data or listw arguments.  So it apparently triggers this error before it even gets to the problem of the missing arguments, and apparently they don't relate to the actual content of the data or spatial weights.

Here is a test script which generates the error:

######################
library(spdep)

# create a sample data frame
df            <- data.frame(lat=runif(100,0,3),long=runif(100,0,3), pred1=runif(100,0,1), pred2=runif(100,0,1), resp=runif(100,0,10))

cat("\nPreparing neighbourhood weights for SARLM\n\n")
coords        <-as.matrix(cbind(df$long, df$lat))
cont.nb       <- dnearneigh(coords,d1=0, d2=100,longlat=TRUE)
weight_list   <- nb2listw(cont.nb, glist=NULL, style="W", zero.policy=TRUE)

my_formula    <- "resp ~  pred1 + pred2"

# this line gives the error: $ operator is invalid for atomic vectors
SAR.mod           <- errorsarlm(my_formula, data=df, listw=weight_list)
######################

The R version is 3.1.0, and spdep 0.5-77

Any advice on how to fix this problem would be much appreciated. 

The best possibility is that I've made a dumb mistake which can be easily fixed... :-)

thanks

Dan


~~~~~~~~~~~~~~~~~~~~~~
Dan Rosauer
Postdoctoral Researcher
Moritz Lab
Ecology, Evolution & Genetics
Research School of Biology
Gould Building, Daley Road
Australian National University
Canberra ACT 0200

+61 413 950 275 (mobile)
+61 2 6125 1028 (office)
dan.rosauer at anu.edu.au

sites.google.com/site/danielrosauer


From frtog at vestas.com  Wed Nov  5 07:19:03 2014
From: frtog at vestas.com (=?iso-8859-1?Q?Frede_Aakmann_T=F8gersen?=)
Date: Wed, 5 Nov 2014 07:19:03 +0100
Subject: [R-sig-Geo] Cause of error in spdep::errorsarlm
In-Reply-To: <014cba4a543a4e0197c59af8e8512987@SIXPR06MB0576.apcprd06.prod.outlook.com>
References: <014cba4a543a4e0197c59af8e8512987@SIXPR06MB0576.apcprd06.prod.outlook.com>
Message-ID: <B078CDF40DFE4045AF172A8B4F68FC4857C9BA2A42@DKRDSEXC016.vestas.net>

Hi Dan

Remove the " from your formula. It should be 

my_formula    <- resp ~  pred1 + pred2


Yours sincerely / Med venlig hilsen


Frede Aakmann T?gersen
Specialist, M.Sc., Ph.D.
Plant Performance & Modeling

Technology & Service Solutions
T +45 9730 5135
M +45 2547 6050
frtog at vestas.com
http://www.vestas.com

Company reg. name: Vestas Wind Systems A/S
This e-mail is subject to our e-mail disclaimer statement.
Please refer to www.vestas.com/legal/notice
If you have received this e-mail in error please contact the sender. 

> -----Original Message-----
> From: r-sig-geo-bounces at r-project.org [mailto:r-sig-geo-bounces at r-
> project.org] On Behalf Of Dan Rosauer
> Sent: 5. november 2014 03:21
> To: r-sig-geo at r-project.org
> Subject: [R-sig-Geo] Cause of error in spdep::errorsarlm
> 
> Hi Roger et al
> 
> I hope someone can help me with the following error with a call to the spdep
> function errorsarlm()
> 
> Calling the function returns this:  Error: $ operator is invalid for atomic vectors
> 
> Things I have already tried:
> * testing with real and simulated data - error occurs
> * running it on windows and linux - error is identical
> * omitting various arguments to the function to see which one is the cause -
> error occurs with or without the data or listw arguments.  So it apparently
> triggers this error before it even gets to the problem of the missing
> arguments, and apparently they don't relate to the actual content of the data
> or spatial weights.
> 
> Here is a test script which generates the error:
> 
> ######################
> library(spdep)
> 
> # create a sample data frame
> df            <- data.frame(lat=runif(100,0,3),long=runif(100,0,3),
> pred1=runif(100,0,1), pred2=runif(100,0,1), resp=runif(100,0,10))
> 
> cat("\nPreparing neighbourhood weights for SARLM\n\n")
> coords        <-as.matrix(cbind(df$long, df$lat))
> cont.nb       <- dnearneigh(coords,d1=0, d2=100,longlat=TRUE)
> weight_list   <- nb2listw(cont.nb, glist=NULL, style="W", zero.policy=TRUE)
> 
> my_formula    <- "resp ~  pred1 + pred2"
> 
> # this line gives the error: $ operator is invalid for atomic vectors
> SAR.mod           <- errorsarlm(my_formula, data=df, listw=weight_list)
> ######################
> 
> The R version is 3.1.0, and spdep 0.5-77
> 
> Any advice on how to fix this problem would be much appreciated.
> 
> The best possibility is that I've made a dumb mistake which can be easily
> fixed... :-)
> 
> thanks
> 
> Dan
> 
> 
> ~~~~~~~~~~~~~~~~~~~~~~
> Dan Rosauer
> Postdoctoral Researcher
> Moritz Lab
> Ecology, Evolution & Genetics
> Research School of Biology
> Gould Building, Daley Road
> Australian National University
> Canberra ACT 0200
> 
> +61 413 950 275 (mobile)
> +61 2 6125 1028 (office)
> dan.rosauer at anu.edu.au
> 
> sites.google.com/site/danielrosauer
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From frtog at vestas.com  Wed Nov  5 08:33:17 2014
From: frtog at vestas.com (=?iso-8859-1?Q?Frede_Aakmann_T=F8gersen?=)
Date: Wed, 5 Nov 2014 08:33:17 +0100
Subject: [R-sig-Geo] Cause of error in spdep::errorsarlm
In-Reply-To: <7a822c711d04433f9af2e89aeeacfe01@SG2PR06MB0571.apcprd06.prod.outlook.com>
References: <014cba4a543a4e0197c59af8e8512987@SIXPR06MB0576.apcprd06.prod.outlook.com>
	<B078CDF40DFE4045AF172A8B4F68FC4857C9BA2A42@DKRDSEXC016.vestas.net>
	<7a822c711d04433f9af2e89aeeacfe01@SG2PR06MB0571.apcprd06.prod.outlook.com>
Message-ID: <B078CDF40DFE4045AF172A8B4F68FC4857C9BA2AB0@DKRDSEXC016.vestas.net>

Hi

Please remember to keep the r-sig-geo on the list.

See ?formula. I guess that somewhere under the hood of glm() as.formula() is called. Checking the code of glm() you can see that model.frame() is called. From ?model.frame one notice that:

     If either 'formula' or 'data' is already a model frame (a data
     frame with a '"terms"' attribute) and the other is missing, the
     model frame is returned.  Unless 'formula' is a terms object,
     'as.formula' and then 'terms' is called on it.  (If you wish to
     use the 'keep.order' argument of 'terms.formula', pass a terms
     object rather than a formula.)

All this happens in glm() but not in errorsarlm():

> my_formula    <- "resp ~  pred1 + pred2"
> SAR.mod           <- errorsarlm(my_formula, data=df, listw=weight_list)
Error: $ operator is invalid for atomic vectors
> traceback()
3: terms.default(formula, data = data)
2: terms(formula, data = data)
1: errorsarlm(my_formula, data = df, listw = weight_list)
>
> class(my_formula)
[1] "character"
> class(resp ~  pred1 + pred2)
[1] "formula"
>

In errorsarlm() terms() is called with my_formula and data and since formula is a string an error is raised.

In the man page of errorsarlm() one sees:

formula: a symbolic description of the model to be fit. The details of
          model specification are given for 'lm()'

And in ?lm we see:

formula: an object of class '"formula"' (or one that can be coerced to
          that class): a symbolic description of the model to be
          fitted.  The details of model specification are given under
          'Details'.

So strictly speaking errorsarlm() should be able to handle a formula defined as a string (maintainer on cc).


Yours sincerely / Med venlig hilsen


Frede Aakmann T?gersen
Specialist, M.Sc., Ph.D.
Plant Performance & Modeling

Technology & Service Solutions
T +45 9730 5135
M +45 2547 6050
frtog at vestas.com
http://www.vestas.com

Company reg. name: Vestas Wind Systems A/S
This e-mail is subject to our e-mail disclaimer statement.
Please refer to www.vestas.com/legal/notice
If you have received this e-mail in error please contact the sender. 


> -----Original Message-----
> From: Dan Rosauer [mailto:dan.rosauer at anu.edu.au]
> Sent: 5. november 2014 07:59
> To: Frede Aakmann T?gersen
> Subject: RE: Cause of error in spdep::errorsarlm
> 
> That worked.  Thank you!
> 
> But I don't understand.  Normally if you try to assign unquoted text to a
> variable, it check if the text refers to named objects, and if not gives an error.
> 
> And the quoted version worked perfectly for GLM models.
> 
> So problem solved, and something learned.
> 
> cheers
> Dan
> 
> ~~~~~~~~~~~~~~~~~~~~~~
> Dan Rosauer
> Postdoctoral Researcher
> Moritz Lab
> Ecology, Evolution & Genetics
> Research School of Biology
> Gould Building, Daley Road
> Australian National University
> Canberra ACT 0200
> 
> +61 413 950 275 (mobile)
> +61 2 6125 1028 (office)
> dan.rosauer at anu.edu.au
> 
> sites.google.com/site/danielrosauer
> 
> 
> 
> 
> -----Original Message-----
> From: Frede Aakmann T?gersen [mailto:frtog at vestas.com]
> Sent: Wednesday, 5 November 2014 5:19 PM
> To: Dan Rosauer; r-sig-geo at r-project.org
> Subject: RE: Cause of error in spdep::errorsarlm
> 
> Hi Dan
> 
> Remove the " from your formula. It should be
> 
> my_formula    <- resp ~  pred1 + pred2
> 
> 
> Yours sincerely / Med venlig hilsen
> 
> 
> Frede Aakmann T?gersen
> Specialist, M.Sc., Ph.D.
> Plant Performance & Modeling
> 
> Technology & Service Solutions
> T +45 9730 5135
> M +45 2547 6050
> frtog at vestas.com
> http://www.vestas.com
> 
> Company reg. name: Vestas Wind Systems A/S This e-mail is subject to our e-
> mail disclaimer statement.
> Please refer to www.vestas.com/legal/notice If you have received this e-mail
> in error please contact the sender.
> 
> > -----Original Message-----
> > From: r-sig-geo-bounces at r-project.org [mailto:r-sig-geo-bounces at r-
> > project.org] On Behalf Of Dan Rosauer
> > Sent: 5. november 2014 03:21
> > To: r-sig-geo at r-project.org
> > Subject: [R-sig-Geo] Cause of error in spdep::errorsarlm
> >
> > Hi Roger et al
> >
> > I hope someone can help me with the following error with a call to the
> > spdep function errorsarlm()
> >
> > Calling the function returns this:  Error: $ operator is invalid for
> > atomic vectors
> >
> > Things I have already tried:
> > * testing with real and simulated data - error occurs
> > * running it on windows and linux - error is identical
> > * omitting various arguments to the function to see which one is the
> > cause - error occurs with or without the data or listw arguments.  So
> > it apparently triggers this error before it even gets to the problem
> > of the missing arguments, and apparently they don't relate to the
> > actual content of the data or spatial weights.
> >
> > Here is a test script which generates the error:
> >
> > ######################
> > library(spdep)
> >
> > # create a sample data frame
> > df            <- data.frame(lat=runif(100,0,3),long=runif(100,0,3),
> > pred1=runif(100,0,1), pred2=runif(100,0,1), resp=runif(100,0,10))
> >
> > cat("\nPreparing neighbourhood weights for SARLM\n\n")
> > coords        <-as.matrix(cbind(df$long, df$lat))
> > cont.nb       <- dnearneigh(coords,d1=0, d2=100,longlat=TRUE)
> > weight_list   <- nb2listw(cont.nb, glist=NULL, style="W", zero.policy=TRUE)
> >
> > my_formula    <- "resp ~  pred1 + pred2"
> >
> > # this line gives the error: $ operator is invalid for atomic vectors
> > SAR.mod           <- errorsarlm(my_formula, data=df, listw=weight_list)
> > ######################
> >
> > The R version is 3.1.0, and spdep 0.5-77
> >
> > Any advice on how to fix this problem would be much appreciated.
> >
> > The best possibility is that I've made a dumb mistake which can be
> > easily fixed... :-)
> >
> > thanks
> >
> > Dan
> >
> >
> > ~~~~~~~~~~~~~~~~~~~~~~
> > Dan Rosauer
> > Postdoctoral Researcher
> > Moritz Lab
> > Ecology, Evolution & Genetics
> > Research School of Biology
> > Gould Building, Daley Road
> > Australian National University
> > Canberra ACT 0200
> >
> > +61 413 950 275 (mobile)
> > +61 2 6125 1028 (office)
> > dan.rosauer at anu.edu.au
> >
> > sites.google.com/site/danielrosauer
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From didier.leibovici at nottingham.ac.uk  Wed Nov  5 16:38:33 2014
From: didier.leibovici at nottingham.ac.uk (Dr Didier G. Leibovici)
Date: Wed, 05 Nov 2014 15:38:33 +0000
Subject: [R-sig-Geo] Strange Rgdal compile error (possibly three)
In-Reply-To: <1414692865798-7587374.post@n2.nabble.com>
References: <1414692865798-7587374.post@n2.nabble.com>
Message-ID: <545A4479.3090800@nottingham.ac.uk>

Hi,
I have the same problem with MacOS x maverick.

I had installed the GDAL_Complete-1.11.dmg but it looks it can't find it 
when running this R CMD?
Nonehteless $ echo $PATH
/Library/Frameworks/Python.framework/Versions/3.3/bin:/Library/Frameworks/GDAL.framework/Programs:/usr/texbin:/opt/local/bin:/opt/local/sbin:/usr/bin:/bin:/usr/sbin:/sbin:/usr/local/bin:/opt/X11/bin

console$ R CMD install rgdal_0.9-1.tar.gz

* installing to library '/Users/lgzdl/Library/R/3.1/library'
* installing *source* package 'rgdal' ...
** package 'rgdal' successfully unpacked and MD5 sums checked
configure: CC: clang
configure: CXX: clang++
configure: rgdal: 0.9-1
checking for /usr/bin/svnversion... yes
configure: svn revision: 518
configure: gdal-config: gdal-config
checking gdal-config usability... yes
configure: GDAL: 1.11.1
checking GDAL version >= 1.6.3... yes
checking GDAL version < 2... yes
checking for gcc... clang
checking whether the C compiler works... yes
checking for C compiler default output file name... a.out
checking for suffix of executables...
checking whether we are cross compiling... no
checking for suffix of object files... o
checking whether we are using the GNU C compiler... yes
checking whether clang accepts -g... yes
checking for clang option to accept ISO C89... none needed
checking how to run the C preprocessor... clang -E
checking for grep that handles long lines and -e... /usr/bin/grep
checking for egrep... /usr/bin/grep -E
checking for ANSI C header files... rm: conftest.dSYM: is a directory
rm: conftest.dSYM: is a directory
yes
checking for sys/types.h... yes
checking for sys/stat.h... yes
checking for stdlib.h... yes
checking for string.h... yes
checking for memory.h... yes
checking for strings.h... yes
checking for inttypes.h... yes
checking for stdint.h... yes
checking for unistd.h... yes
checking gdal.h usability... yes
checking gdal.h presence... yes
checking for gdal.h... yes
checking gdal: linking with --libs only... no
checking gdal: linking with --libs and --dep-libs... no
*ld: framework not found GDAL*
clang: error: linker command failed with exit code 1 (use -v to see 
invocation)
ld: framework not found GDAL
clang: error: linker command failed with exit code 1 (use -v to see 
invocation)
configure: Install failure: compilation and/or linkage problems.
configure: error: GDALAllRegister not found in libgdal.
ERROR: configuration failed for package 'rgdal'

On 30/10/2014 18:14, Paul hewson wrote:
> I'm trying to install rgdal on Kubuntu 14.04 and R 3.1.1; I have spent a lot
> of time following up various online suggestions for the problems I think I'm
> seeing but am currently rather baffled.   I'd be very grateful for a hint.
> I am using R CMD INSTALL ......
>
> libgdal1-dev is installed, mariadb is installed, and armadillo/poppler etc
> are installed (although ld can't find them).
>
> To date, I have followed
> - Old postings about GDALAllRegister not found
> http://stackoverflow.com/questions/15569720/install-rgdal-library-in-rstudio-gdalallregister-not-found-in-libgdal
> - not relevant here (I have compiliers)
> - GDAL stuff on the amadillo / poppler missing (they are not - there might
> be some ubuntu packaging issue here if I'm reading launchpad right)
> https://bugs.launchpad.net/ubuntu/+source/gdal/+bug/1194082
> - There is some stuff on MySQL / mariadb compatibility.
> https://github.com/Homebrew/homebrew/issues/32973
>
> If anyone has any hints about what I should do next I'd be really grateful.
> For example, I don't know whether to knock out mariadb to see whether/how
> that helps, but there seem to be orthogonal warnings.
>
>
> checking gdal: linking with --libs only... no
> checking gdal: linking with --libs and --dep-libs... no
>
> /usr/lib/libgdal.so: undefined reference to `mysql_error at libmysqlclient_18'
> /usr/lib/libgdal.so: undefined reference to
> `mysql_options at libmysqlclient_18'
> /usr/lib/libgdal.so: undefined reference to
> `mysql_fetch_lengths at libmysqlclient_18'
> /usr/lib/libgdal.so: undefined reference to
> `mysql_real_connect at libmysqlclient_18'
> /usr/lib/libgdal.so: undefined reference to `mysql_query at libmysqlclient_18'
> /usr/lib/libgdal.so: undefined reference to
> `mysql_free_result at libmysqlclient_18'
> /usr/lib/libgdal.so: undefined reference to `my_init at libmysqlclient_18'
> /usr/lib/libgdal.so: undefined reference to
> `mysql_field_seek at libmysqlclient_18'
> /usr/lib/libgdal.so: undefined reference to
> `mysql_num_rows at libmysqlclient_18'
> /usr/lib/libgdal.so: undefined reference to
> `mysql_num_fields at libmysqlclient_18'
> /usr/lib/libgdal.so: undefined reference to `mysql_close at libmysqlclient_18'
> /usr/lib/libgdal.so: undefined reference to
> `mysql_field_count at libmysqlclient_18'
> /usr/lib/libgdal.so: undefined reference to
> `free_defaults at libmysqlclient_18'
> /usr/lib/libgdal.so: undefined reference to `mysql_init at libmysqlclient_18'
> /usr/lib/libgdal.so: undefined reference to
> `mysql_fetch_row at libmysqlclient_18'
> /usr/lib/libgdal.so: undefined reference to
> `mysql_fetch_field at libmysqlclient_18'
> /usr/lib/libgdal.so: undefined reference to `mysql_errno at libmysqlclient_18'
> /usr/lib/libgdal.so: undefined reference to
> `mysql_insert_id at libmysqlclient_18'
> /usr/lib/libgdal.so: undefined reference to
> `mysql_use_result at libmysqlclient_18'
> /usr/lib/libgdal.so: undefined reference to
> `mysql_store_result at libmysqlclient_18'
> /usr/lib/libgdal.so: undefined reference to
> `load_defaults at libmysqlclient_18'
> /usr/lib/libgdal.so: undefined reference to
> `mysql_affected_rows at libmysqlclient_18'
> collect2: error: ld returned 1 exit status
>
> /usr/bin/ld: cannot find -larmadillo
> /usr/bin/ld: cannot find -lproj
> /usr/bin/ld: cannot find -lpoppler
> /usr/bin/ld: cannot find -lfreexl
> /usr/bin/ld: cannot find -lepsilon
> /usr/bin/ld: cannot find -lkmldom
> /usr/bin/ld: cannot find -lkmlbase
> /usr/bin/ld: cannot find -lkmlengine
> /usr/bin/ld: cannot find -lkmlconvenience
> /usr/bin/ld: cannot find -lminizip
> /usr/bin/ld: cannot find -luriparser
> collect2: error: ld returned 1 exit status
>
> configure: Install failure: compilation and/or linkage problems.
>
> configure: error: GDALAllRegister not found in libgdal.
>
>
>
>
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Strange-Rgdal-compile-error-possibly-three-tp7587374.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Dr Didier G. Leibovici
    d-d'ye    ley-bow-v-c
Senior Research Fellow
Geocomputational Modelling & Geospatial Statistics
Nottingham Geospatial Institute
University of Nottingham, UK
+44 (0)115 84 13924
http://www.nottingham.ac.uk/ngi/people/didier.leibovici
Google+ didier.leibovici at gmail.com
Skype didierleibovici


This message and any attachment are intended solely for the addressee and may contain confidential information. If you have received this message in error, please send it back to me, and immediately delete it.   Please do not use, copy or disclose the information contained in this message or in any attachment.  Any views or opinions expressed by the author of this email do not necessarily reflect the views of the University of Nottingham.

This message has been checked for viruses but the contents of an attachment
may still contain software viruses which could damage your computer system, you are advised to perform your own checks. Email communications with the University of Nottingham may be monitored as permitted by UK legislation.





	[[alternative HTML version deleted]]


From Roger.Bivand at nhh.no  Wed Nov  5 18:31:20 2014
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 5 Nov 2014 18:31:20 +0100
Subject: [R-sig-Geo] Strange Rgdal compile error (possibly three)
In-Reply-To: <545A4479.3090800@nottingham.ac.uk>
References: <1414692865798-7587374.post@n2.nabble.com>
	<545A4479.3090800@nottingham.ac.uk>
Message-ID: <alpine.LRH.2.03.1411051825350.25444@reclus.nhh.no>

On Wed, 5 Nov 2014, Dr Didier G. Leibovici wrote:

> Hi,
> I have the same problem with MacOS x maverick.
>
> I had installed the GDAL_Complete-1.11.dmg but it looks it can't find it
> when running this R CMD?
> Nonehteless $ echo $PATH
> /Library/Frameworks/Python.framework/Versions/3.3/bin:/Library/Frameworks/GDAL.framework/Programs:/usr/texbin:/opt/local/bin:/opt/local/sbin:/usr/bin:/bin:/usr/sbin:/sbin:/usr/local/bin:/opt/X11/bin
>
> console$ R CMD install rgdal_0.9-1.tar.gz

Please read the documentation, such as the README file carefully. The 
configure script does not try to guess where the dynamically loaded 
libraies are, so you'll need to work out how to pass the location -L to 
configure through a configure argument, and ensure that the library is 
also seen when rgdal loads. Using Kyngchaos is also a viable route.

Do you need the extra drivers - if not, Brian Ripley solved the Mavericks 
problem last spring, and the rgdal OSX Mavericks binary is on CRANxtras:

https://stat.ethz.ch/pipermail/r-sig-mac/2014-May/010871.html

Hope this helps,

Roger

>
> * installing to library '/Users/lgzdl/Library/R/3.1/library'
> * installing *source* package 'rgdal' ...
> ** package 'rgdal' successfully unpacked and MD5 sums checked
> configure: CC: clang
> configure: CXX: clang++
> configure: rgdal: 0.9-1
> checking for /usr/bin/svnversion... yes
> configure: svn revision: 518
> configure: gdal-config: gdal-config
> checking gdal-config usability... yes
> configure: GDAL: 1.11.1
> checking GDAL version >= 1.6.3... yes
> checking GDAL version < 2... yes
> checking for gcc... clang
> checking whether the C compiler works... yes
> checking for C compiler default output file name... a.out
> checking for suffix of executables...
> checking whether we are cross compiling... no
> checking for suffix of object files... o
> checking whether we are using the GNU C compiler... yes
> checking whether clang accepts -g... yes
> checking for clang option to accept ISO C89... none needed
> checking how to run the C preprocessor... clang -E
> checking for grep that handles long lines and -e... /usr/bin/grep
> checking for egrep... /usr/bin/grep -E
> checking for ANSI C header files... rm: conftest.dSYM: is a directory
> rm: conftest.dSYM: is a directory
> yes
> checking for sys/types.h... yes
> checking for sys/stat.h... yes
> checking for stdlib.h... yes
> checking for string.h... yes
> checking for memory.h... yes
> checking for strings.h... yes
> checking for inttypes.h... yes
> checking for stdint.h... yes
> checking for unistd.h... yes
> checking gdal.h usability... yes
> checking gdal.h presence... yes
> checking for gdal.h... yes
> checking gdal: linking with --libs only... no
> checking gdal: linking with --libs and --dep-libs... no
> *ld: framework not found GDAL*
> clang: error: linker command failed with exit code 1 (use -v to see
> invocation)
> ld: framework not found GDAL
> clang: error: linker command failed with exit code 1 (use -v to see
> invocation)
> configure: Install failure: compilation and/or linkage problems.
> configure: error: GDALAllRegister not found in libgdal.
> ERROR: configuration failed for package 'rgdal'
>
> On 30/10/2014 18:14, Paul hewson wrote:
>> I'm trying to install rgdal on Kubuntu 14.04 and R 3.1.1; I have spent a lot
>> of time following up various online suggestions for the problems I think I'm
>> seeing but am currently rather baffled.   I'd be very grateful for a hint.
>> I am using R CMD INSTALL ......
>>
>> libgdal1-dev is installed, mariadb is installed, and armadillo/poppler etc
>> are installed (although ld can't find them).
>>
>> To date, I have followed
>> - Old postings about GDALAllRegister not found
>> http://stackoverflow.com/questions/15569720/install-rgdal-library-in-rstudio-gdalallregister-not-found-in-libgdal
>> - not relevant here (I have compiliers)
>> - GDAL stuff on the amadillo / poppler missing (they are not - there might
>> be some ubuntu packaging issue here if I'm reading launchpad right)
>> https://bugs.launchpad.net/ubuntu/+source/gdal/+bug/1194082
>> - There is some stuff on MySQL / mariadb compatibility.
>> https://github.com/Homebrew/homebrew/issues/32973
>>
>> If anyone has any hints about what I should do next I'd be really grateful.
>> For example, I don't know whether to knock out mariadb to see whether/how
>> that helps, but there seem to be orthogonal warnings.
>>
>>
>> checking gdal: linking with --libs only... no
>> checking gdal: linking with --libs and --dep-libs... no
>>
>> /usr/lib/libgdal.so: undefined reference to `mysql_error at libmysqlclient_18'
>> /usr/lib/libgdal.so: undefined reference to
>> `mysql_options at libmysqlclient_18'
>> /usr/lib/libgdal.so: undefined reference to
>> `mysql_fetch_lengths at libmysqlclient_18'
>> /usr/lib/libgdal.so: undefined reference to
>> `mysql_real_connect at libmysqlclient_18'
>> /usr/lib/libgdal.so: undefined reference to `mysql_query at libmysqlclient_18'
>> /usr/lib/libgdal.so: undefined reference to
>> `mysql_free_result at libmysqlclient_18'
>> /usr/lib/libgdal.so: undefined reference to `my_init at libmysqlclient_18'
>> /usr/lib/libgdal.so: undefined reference to
>> `mysql_field_seek at libmysqlclient_18'
>> /usr/lib/libgdal.so: undefined reference to
>> `mysql_num_rows at libmysqlclient_18'
>> /usr/lib/libgdal.so: undefined reference to
>> `mysql_num_fields at libmysqlclient_18'
>> /usr/lib/libgdal.so: undefined reference to `mysql_close at libmysqlclient_18'
>> /usr/lib/libgdal.so: undefined reference to
>> `mysql_field_count at libmysqlclient_18'
>> /usr/lib/libgdal.so: undefined reference to
>> `free_defaults at libmysqlclient_18'
>> /usr/lib/libgdal.so: undefined reference to `mysql_init at libmysqlclient_18'
>> /usr/lib/libgdal.so: undefined reference to
>> `mysql_fetch_row at libmysqlclient_18'
>> /usr/lib/libgdal.so: undefined reference to
>> `mysql_fetch_field at libmysqlclient_18'
>> /usr/lib/libgdal.so: undefined reference to `mysql_errno at libmysqlclient_18'
>> /usr/lib/libgdal.so: undefined reference to
>> `mysql_insert_id at libmysqlclient_18'
>> /usr/lib/libgdal.so: undefined reference to
>> `mysql_use_result at libmysqlclient_18'
>> /usr/lib/libgdal.so: undefined reference to
>> `mysql_store_result at libmysqlclient_18'
>> /usr/lib/libgdal.so: undefined reference to
>> `load_defaults at libmysqlclient_18'
>> /usr/lib/libgdal.so: undefined reference to
>> `mysql_affected_rows at libmysqlclient_18'
>> collect2: error: ld returned 1 exit status
>>
>> /usr/bin/ld: cannot find -larmadillo
>> /usr/bin/ld: cannot find -lproj
>> /usr/bin/ld: cannot find -lpoppler
>> /usr/bin/ld: cannot find -lfreexl
>> /usr/bin/ld: cannot find -lepsilon
>> /usr/bin/ld: cannot find -lkmldom
>> /usr/bin/ld: cannot find -lkmlbase
>> /usr/bin/ld: cannot find -lkmlengine
>> /usr/bin/ld: cannot find -lkmlconvenience
>> /usr/bin/ld: cannot find -lminizip
>> /usr/bin/ld: cannot find -luriparser
>> collect2: error: ld returned 1 exit status
>>
>> configure: Install failure: compilation and/or linkage problems.
>>
>> configure: error: GDALAllRegister not found in libgdal.
>>
>>
>>
>>
>> --
>> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Strange-Rgdal-compile-error-possibly-three-tp7587374.html
>> Sent from the R-sig-geo mailing list archive at Nabble.com.
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no


From Navinder.Singh at slu.se  Thu Nov  6 00:18:12 2014
From: Navinder.Singh at slu.se (Navinder Singh)
Date: Wed, 5 Nov 2014 23:18:12 +0000
Subject: [R-sig-Geo] Error in .local(.Object,
	...) : TIFFOpen: .....Too many open files
Message-ID: <7BB6BBB6-AC8C-431C-BFA3-92222ED8FABF@slu.se>

Hi,
I am trying to clip or do any other calculations on a raster stack with 365 rasters with a given extent. However, i keep getting the following error.
A side note- This raster stack is saved as ?.tif" and was generated using the whittaker.raster function from the MODIS package. I am unable to do any further progress on this stack due to this error.

########################################################################
> setwd("/Users/nasi/Google Drive/5KMNDVI_Clipped")

> rt<-stack("NDVI_YearlyLambda5000_year2010.tif?)

> rt
class       : RasterStack
dimensions  : 1943, 1222, 2374346, 365  (nrow, ncol, ncell, nlayers)
resolution  : 0.04999591, 0.04999228  (x, y)
extent      : -17.96, 43.135, -30.055, 67.08  (xmin, xmax, ymin, ymax)
coord. ref. : +proj=longlat +ellps=clrk66 +no_defs
names       : NDVI_Year//year2010.1, NDVI_Year//year2010.2, NDVI_Year//year2010.3, NDVI_Year//year2010.4, NDVI_Year//year2010.5, NDVI_Year//year2010.6, NDVI_Year//year2010.7, NDVI_Year//year2010.8, NDVI_Year//year2010.9, NDVI_Year//ear2010.10, NDVI_Year//ear2010.11, NDVI_Year//ear2010.12, NDVI_Year//ear2010.13, NDVI_Year//ear2010.14, NDVI_Year//ear2010.15, ...
min values  :             -253440.3,             -252749.0,             -252057.7,             -251366.4,             -250675.1,             -249983.8,             -249292.4,             -248601.1,             -247909.8,             -247218.5,             -246527.2,             -245835.9,             -245144.6,             -244453.2,             -243761.9, ...
max values  :             130541.71,             130239.21,             129936.71,             129634.21,             129331.71,             129029.21,             128726.71,             128424.21,             128121.71,             127819.21,             127516.71,             127214.20,             126911.70,             126609.20,             126306.70, ...

decjan.sp<-SpatialPoints(decjan[,c(3,4)])
e<-bbox(decjan.sp)
e

> decjan.ran<-crop(rt,e)
Error in .local(.Object, ...) :
  TIFFOpen:/Users/nasi/Google Drive/5KMNDVI_Clipped/NDVI_YearlyLambda5000_year2010.tif: Too many open files

########################################################################
my session info is:

> sessionInfo()
R version 3.1.1 (2014-07-10)
Platform: x86_64-apple-darwin10.8.0 (64-bit)

locale:
[1] C

attached base packages:
[1] grid      stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
 [1] adehabitatLT_0.3.16 CircStats_0.2-4     boot_1.3-11         MASS_7.3-33
 [5] adehabitatMA_0.3.8  ade4_1.6-2          plyr_1.8.1          zoo_1.7-11
 [9] rgdal_0.8-16        rasterVis_0.28      hexbin_1.26.3       latticeExtra_0.6-26
[13] RColorBrewer_1.0-5  lattice_0.20-29     raster_2.2-31       sp_1.0-15

loaded via a namespace (and not attached):
[1] Rcpp_0.11.1


Any suggestions? I have seen this error popping up in many other packages and programs too but count really find a solution relevant to R.



Navinder J Singh
Associate Professor
Department of Wildlife, Fish, and Environmental Studies
Faculty of Forest Sciences
Swedish University of Agricultural Sciences
SE-901 83 Umea, Sweden
O: +46 (0)90 786 8538;
M: +46 (0)70 676 0103
email: navinder.singh at slu.se<mailto:navinder.singh at slu.se>
Web: navinderjsingh.weebly.com<http://navinderjsingh.weebly.com/>

www.slu.se/viltfiskmiljo/navinder_singh<http://www.slu.se/viltfiskmiljo/navinder_singh>
http://slu-se.academia.edu/NSingh





	[[alternative HTML version deleted]]


From alessandracarioli at gmail.com  Thu Nov  6 12:40:54 2014
From: alessandracarioli at gmail.com (Alessandra Carioli)
Date: Thu, 6 Nov 2014 12:40:54 +0100
Subject: [R-sig-Geo] Smooth.ppp problem
Message-ID: <65731812-319A-4D9C-96AE-B313A4B65CD7@gmail.com>

Dear all,

I am using the package spatstat and trying to smooth a pointpattern. When I try to smooth my data.ppp I keep receiving this message:

Error in Ops.data.frame(marx, yhat) : 
  - only defined for equally-sized data frames

I don?t really get it? I don?t have any ?rejects?.

shape.owin<-as(shape.shp,?owin?)
pts <- coordinates(shape.shp)
p <- ppp(pts[,1],pts[,2],window=spain.owin,marks=DF)

any ideas?

Ale

From Roger.Bivand at nhh.no  Thu Nov  6 13:45:50 2014
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 6 Nov 2014 13:45:50 +0100
Subject: [R-sig-Geo] Cause of error in spdep::errorsarlm
In-Reply-To: <B078CDF40DFE4045AF172A8B4F68FC4857C9BA2AB0@DKRDSEXC016.vestas.net>
References: <014cba4a543a4e0197c59af8e8512987@SIXPR06MB0576.apcprd06.prod.outlook.com>
	<B078CDF40DFE4045AF172A8B4F68FC4857C9BA2A42@DKRDSEXC016.vestas.net>
	<7a822c711d04433f9af2e89aeeacfe01@SG2PR06MB0571.apcprd06.prod.outlook.com>
	<B078CDF40DFE4045AF172A8B4F68FC4857C9BA2AB0@DKRDSEXC016.vestas.net>
Message-ID: <alpine.LRH.2.03.1411061331350.28561@reclus.nhh.no>

On Wed, 5 Nov 2014, Frede Aakmann T?gersen wrote:

> Hi
>
> Please remember to keep the r-sig-geo on the list.
>
> See ?formula. I guess that somewhere under the hood of glm() 
> as.formula() is called. Checking the code of glm() you can see that 
> model.frame() is called. From ?model.frame one notice that:
>
>     If either 'formula' or 'data' is already a model frame (a data
>     frame with a '"terms"' attribute) and the other is missing, the
>     model frame is returned.  Unless 'formula' is a terms object,
>     'as.formula' and then 'terms' is called on it.  (If you wish to
>     use the 'keep.order' argument of 'terms.formula', pass a terms
>     object rather than a formula.)
>
> All this happens in glm() but not in errorsarlm():

Thanks for a careful diagnosis. I've committed (R-forge, revision 563) 
simple fixes to all model fitting functions in spdep that used the formula 
argument without checking that it is of class "formula". Only spautolm() 
used the full model.frame() mechanism before, and this distinction 
remains.

With released spdep:

SAR.mod <- errorsarlm(as.formula(my_formula), data=df,
   listw=weight_list)

and

SAR.mod <- spautolm(my_formula, data=df, listw=weight_list)

give the same output. With the next release, the as.formula() is done 
internally. spautolm() was written in 2005/6, the others from 1998 
onwards, and the differences in handling model.frame objects stem from 
practice in lm() at those times.

I can see that using a string to hold a formula may seem attractive as it 
permits paste() and other string functions to be used to modify the 
formula. I would however suggest that using the update() method for 
formulae is at least as flexible, and that formula arguments be given as 
formula objects, not as strings, even if this usage is possible.

Best wishes,

Roger

>
>> my_formula    <- "resp ~  pred1 + pred2"
>> SAR.mod           <- errorsarlm(my_formula, data=df, listw=weight_list)
> Error: $ operator is invalid for atomic vectors
>> traceback()
> 3: terms.default(formula, data = data)
> 2: terms(formula, data = data)
> 1: errorsarlm(my_formula, data = df, listw = weight_list)
>>
>> class(my_formula)
> [1] "character"
>> class(resp ~  pred1 + pred2)
> [1] "formula"
>>
>
> In errorsarlm() terms() is called with my_formula and data and since formula is a string an error is raised.
>
> In the man page of errorsarlm() one sees:
>
> formula: a symbolic description of the model to be fit. The details of
>          model specification are given for 'lm()'
>
> And in ?lm we see:
>
> formula: an object of class '"formula"' (or one that can be coerced to
>          that class): a symbolic description of the model to be
>          fitted.  The details of model specification are given under
>          'Details'.
>
> So strictly speaking errorsarlm() should be able to handle a formula defined as a string (maintainer on cc).
>
>
> Yours sincerely / Med venlig hilsen
>
>
> Frede Aakmann T?gersen
> Specialist, M.Sc., Ph.D.
> Plant Performance & Modeling
>
> Technology & Service Solutions
> T +45 9730 5135
> M +45 2547 6050
> frtog at vestas.com
> http://www.vestas.com
>
> Company reg. name: Vestas Wind Systems A/S
> This e-mail is subject to our e-mail disclaimer statement.
> Please refer to www.vestas.com/legal/notice
> If you have received this e-mail in error please contact the sender.
>
>
>> -----Original Message-----
>> From: Dan Rosauer [mailto:dan.rosauer at anu.edu.au]
>> Sent: 5. november 2014 07:59
>> To: Frede Aakmann T?gersen
>> Subject: RE: Cause of error in spdep::errorsarlm
>>
>> That worked.  Thank you!
>>
>> But I don't understand.  Normally if you try to assign unquoted text to a
>> variable, it check if the text refers to named objects, and if not gives an error.
>>
>> And the quoted version worked perfectly for GLM models.
>>
>> So problem solved, and something learned.
>>
>> cheers
>> Dan
>>
>> ~~~~~~~~~~~~~~~~~~~~~~
>> Dan Rosauer
>> Postdoctoral Researcher
>> Moritz Lab
>> Ecology, Evolution & Genetics
>> Research School of Biology
>> Gould Building, Daley Road
>> Australian National University
>> Canberra ACT 0200
>>
>> +61 413 950 275 (mobile)
>> +61 2 6125 1028 (office)
>> dan.rosauer at anu.edu.au
>>
>> sites.google.com/site/danielrosauer
>>
>>
>>
>>
>> -----Original Message-----
>> From: Frede Aakmann T?gersen [mailto:frtog at vestas.com]
>> Sent: Wednesday, 5 November 2014 5:19 PM
>> To: Dan Rosauer; r-sig-geo at r-project.org
>> Subject: RE: Cause of error in spdep::errorsarlm
>>
>> Hi Dan
>>
>> Remove the " from your formula. It should be
>>
>> my_formula    <- resp ~  pred1 + pred2
>>
>>
>> Yours sincerely / Med venlig hilsen
>>
>>
>> Frede Aakmann T?gersen
>> Specialist, M.Sc., Ph.D.
>> Plant Performance & Modeling
>>
>> Technology & Service Solutions
>> T +45 9730 5135
>> M +45 2547 6050
>> frtog at vestas.com
>> http://www.vestas.com
>>
>> Company reg. name: Vestas Wind Systems A/S This e-mail is subject to our e-
>> mail disclaimer statement.
>> Please refer to www.vestas.com/legal/notice If you have received this e-mail
>> in error please contact the sender.
>>
>>> -----Original Message-----
>>> From: r-sig-geo-bounces at r-project.org [mailto:r-sig-geo-bounces at r-
>>> project.org] On Behalf Of Dan Rosauer
>>> Sent: 5. november 2014 03:21
>>> To: r-sig-geo at r-project.org
>>> Subject: [R-sig-Geo] Cause of error in spdep::errorsarlm
>>>
>>> Hi Roger et al
>>>
>>> I hope someone can help me with the following error with a call to the
>>> spdep function errorsarlm()
>>>
>>> Calling the function returns this:  Error: $ operator is invalid for
>>> atomic vectors
>>>
>>> Things I have already tried:
>>> * testing with real and simulated data - error occurs
>>> * running it on windows and linux - error is identical
>>> * omitting various arguments to the function to see which one is the
>>> cause - error occurs with or without the data or listw arguments.  So
>>> it apparently triggers this error before it even gets to the problem
>>> of the missing arguments, and apparently they don't relate to the
>>> actual content of the data or spatial weights.
>>>
>>> Here is a test script which generates the error:
>>>
>>> ######################
>>> library(spdep)
>>>
>>> # create a sample data frame
>>> df            <- data.frame(lat=runif(100,0,3),long=runif(100,0,3),
>>> pred1=runif(100,0,1), pred2=runif(100,0,1), resp=runif(100,0,10))
>>>
>>> cat("\nPreparing neighbourhood weights for SARLM\n\n")
>>> coords        <-as.matrix(cbind(df$long, df$lat))
>>> cont.nb       <- dnearneigh(coords,d1=0, d2=100,longlat=TRUE)
>>> weight_list   <- nb2listw(cont.nb, glist=NULL, style="W", zero.policy=TRUE)
>>>
>>> my_formula    <- "resp ~  pred1 + pred2"
>>>
>>> # this line gives the error: $ operator is invalid for atomic vectors
>>> SAR.mod           <- errorsarlm(my_formula, data=df, listw=weight_list)
>>> ######################
>>>
>>> The R version is 3.1.0, and spdep 0.5-77
>>>
>>> Any advice on how to fix this problem would be much appreciated.
>>>
>>> The best possibility is that I've made a dumb mistake which can be
>>> easily fixed... :-)
>>>
>>> thanks
>>>
>>> Dan
>>>
>>>
>>> ~~~~~~~~~~~~~~~~~~~~~~
>>> Dan Rosauer
>>> Postdoctoral Researcher
>>> Moritz Lab
>>> Ecology, Evolution & Genetics
>>> Research School of Biology
>>> Gould Building, Daley Road
>>> Australian National University
>>> Canberra ACT 0200
>>>
>>> +61 413 950 275 (mobile)
>>> +61 2 6125 1028 (office)
>>> dan.rosauer at anu.edu.au
>>>
>>> sites.google.com/site/danielrosauer
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no

From Ruiter at nscr.nl  Thu Nov  6 22:09:09 2014
From: Ruiter at nscr.nl (Stijn Ruiter)
Date: Thu, 6 Nov 2014 21:09:09 +0000
Subject: [R-sig-Geo] Moran's I based on inverse distance weight matrix -
 error when missing values exist
Message-ID: <4565F23CD5D7774DA07388F579A6C92B04B5426F@MAIL01.arthur.nscr.nl>

An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20141106/3038f3e9/attachment.html>

From r.turner at auckland.ac.nz  Thu Nov  6 22:35:50 2014
From: r.turner at auckland.ac.nz (Rolf Turner)
Date: Fri, 07 Nov 2014 10:35:50 +1300
Subject: [R-sig-Geo] Smooth.ppp problem
In-Reply-To: <65731812-319A-4D9C-96AE-B313A4B65CD7@gmail.com>
References: <65731812-319A-4D9C-96AE-B313A4B65CD7@gmail.com>
Message-ID: <545BE9B6.6000002@auckland.ac.nz>

On 07/11/14 00:40, Alessandra Carioli wrote:
> Dear all,
 >
> I am using the package spatstat and trying to smooth a pointpattern.
> When I try to smooth my data.ppp I keep receiving this message:
>
> Error in Ops.data.frame(marx, yhat) : - only defined for
> equally-sized data frames
>
> I don?t really get it? I don?t have any ?rejects?.
>
> shape.owin<-as(shape.shp,?owin?)
> pts <- coordinates(shape.shp)
> p <- ppp(pts[,1],pts[,2],window=spain.owin,marks=DF)
>
> any ideas?

No.  Not without more information.  There is probably something wrong 
with the marks that you have attached to your point pattern, i.e. "DF" 
--- you don't say anything about the marks, and they are central to the 
smoothing idea; Smooth.ppp() smooths the *marks*.

If you actually expect to get useful advice you need to provide a (small 
--- small as possible) ***reproducible*** example.  As fortune number 
182 says: "R is lacking a mind_read() function!"

cheers,

Rolf Turner

P. S.  What have "rejects" got to do with anything in this context?

R. T.

-- 
Rolf Turner
Technical Editor ANZJS


From andigros72 at gmail.com  Thu Nov  6 23:47:21 2014
From: andigros72 at gmail.com (Andreas Gros)
Date: Thu, 6 Nov 2014 14:47:21 -0800
Subject: [R-sig-Geo] plotKML kml_layer.Raster problem
Message-ID: <CAJPy8YXfgejRSVEMXfgxUQvixH3w4NROaLbJPJQ01m54r967Hg@mail.gmail.com>

In version 0.4-6 of plotKML, when I'm adding a kml_layer.Raster (single
layer, no stack/brick) to a kml file, I get the following error message:

Error in setValues(x, value) :
values must be numeric, integer, logical or factor


The values in the raster range between -57 and 2000 and it also occurs if I
replace NA values first with some arbitrary numerical value.
Has anyone come across this problem and knows how to fix/circumnavigate it?

Thanks!

	[[alternative HTML version deleted]]


From dan.rosauer at anu.edu.au  Fri Nov  7 04:10:07 2014
From: dan.rosauer at anu.edu.au (Dan Rosauer)
Date: Fri, 7 Nov 2014 03:10:07 +0000
Subject: [R-sig-Geo] Cause of error in spdep::errorsarlm
In-Reply-To: <alpine.LRH.2.03.1411061331350.28561@reclus.nhh.no>
References: <014cba4a543a4e0197c59af8e8512987@SIXPR06MB0576.apcprd06.prod.outlook.com>
	<B078CDF40DFE4045AF172A8B4F68FC4857C9BA2A42@DKRDSEXC016.vestas.net>
	<7a822c711d04433f9af2e89aeeacfe01@SG2PR06MB0571.apcprd06.prod.outlook.com>
	<B078CDF40DFE4045AF172A8B4F68FC4857C9BA2AB0@DKRDSEXC016.vestas.net>
	<alpine.LRH.2.03.1411061331350.28561@reclus.nhh.no>
Message-ID: <bf17adae612d4514ae4d3d81c57ac630@SG2PR06MB0571.apcprd06.prod.outlook.com>

Thanks very much Roger and Frede

This was very helpful.  

I have somehow managed to run some quite intricate model fitting and model selection code over several years, while handling formulas entirely as text, and being almost completely unaware of the formula class and associated functions such as model.frame.  But now I am elightened!

By the way Roger, I just found that errorsarlm works beautifully with dredge {MuMIn} for model selection and averaging.  The two together have just saved large amounts of time and coding compared to previous analyses.

cheers
Dan

-----Original Message-----
From: Roger Bivand [mailto:Roger.Bivand at nhh.no] 
Sent: Thursday, 6 November 2014 11:46 PM
To: Frede Aakmann T?gersen
Cc: Dan Rosauer; r-sig-geo at r-project.org
Subject: RE: Cause of error in spdep::errorsarlm

On Wed, 5 Nov 2014, Frede Aakmann T?gersen wrote:

> Hi
>
> Please remember to keep the r-sig-geo on the list.
>
> See ?formula. I guess that somewhere under the hood of glm()
> as.formula() is called. Checking the code of glm() you can see that
> model.frame() is called. From ?model.frame one notice that:
>
>     If either 'formula' or 'data' is already a model frame (a data
>     frame with a '"terms"' attribute) and the other is missing, the
>     model frame is returned.  Unless 'formula' is a terms object,
>     'as.formula' and then 'terms' is called on it.  (If you wish to
>     use the 'keep.order' argument of 'terms.formula', pass a terms
>     object rather than a formula.)
>
> All this happens in glm() but not in errorsarlm():

Thanks for a careful diagnosis. I've committed (R-forge, revision 563) simple fixes to all model fitting functions in spdep that used the formula argument without checking that it is of class "formula". Only spautolm() used the full model.frame() mechanism before, and this distinction remains.

With released spdep:

SAR.mod <- errorsarlm(as.formula(my_formula), data=df,
   listw=weight_list)

and

SAR.mod <- spautolm(my_formula, data=df, listw=weight_list)

give the same output. With the next release, the as.formula() is done internally. spautolm() was written in 2005/6, the others from 1998 onwards, and the differences in handling model.frame objects stem from practice in lm() at those times.

I can see that using a string to hold a formula may seem attractive as it permits paste() and other string functions to be used to modify the formula. I would however suggest that using the update() method for formulae is at least as flexible, and that formula arguments be given as formula objects, not as strings, even if this usage is possible.

Best wishes,

Roger

>
>> my_formula    <- "resp ~  pred1 + pred2"
>> SAR.mod           <- errorsarlm(my_formula, data=df, listw=weight_list)
> Error: $ operator is invalid for atomic vectors
>> traceback()
> 3: terms.default(formula, data = data)
> 2: terms(formula, data = data)
> 1: errorsarlm(my_formula, data = df, listw = weight_list)
>>
>> class(my_formula)
> [1] "character"
>> class(resp ~  pred1 + pred2)
> [1] "formula"
>>
>
> In errorsarlm() terms() is called with my_formula and data and since formula is a string an error is raised.
>
> In the man page of errorsarlm() one sees:
>
> formula: a symbolic description of the model to be fit. The details of
>          model specification are given for 'lm()'
>
> And in ?lm we see:
>
> formula: an object of class '"formula"' (or one that can be coerced to
>          that class): a symbolic description of the model to be
>          fitted.  The details of model specification are given under
>          'Details'.
>
> So strictly speaking errorsarlm() should be able to handle a formula defined as a string (maintainer on cc).
>
>
> Yours sincerely / Med venlig hilsen
>
>
> Frede Aakmann T?gersen
> Specialist, M.Sc., Ph.D.
> Plant Performance & Modeling
>
> Technology & Service Solutions
> T +45 9730 5135
> M +45 2547 6050
> frtog at vestas.com
> http://www.vestas.com
>
> Company reg. name: Vestas Wind Systems A/S This e-mail is subject to 
> our e-mail disclaimer statement.
> Please refer to www.vestas.com/legal/notice If you have received this 
> e-mail in error please contact the sender.
>
>
>> -----Original Message-----
>> From: Dan Rosauer [mailto:dan.rosauer at anu.edu.au]
>> Sent: 5. november 2014 07:59
>> To: Frede Aakmann T?gersen
>> Subject: RE: Cause of error in spdep::errorsarlm
>>
>> That worked.  Thank you!
>>
>> But I don't understand.  Normally if you try to assign unquoted text 
>> to a variable, it check if the text refers to named objects, and if not gives an error.
>>
>> And the quoted version worked perfectly for GLM models.
>>
>> So problem solved, and something learned.
>>
>> cheers
>> Dan
>>
>> ~~~~~~~~~~~~~~~~~~~~~~
>> Dan Rosauer
>> Postdoctoral Researcher
>> Moritz Lab
>> Ecology, Evolution & Genetics
>> Research School of Biology
>> Gould Building, Daley Road
>> Australian National University
>> Canberra ACT 0200
>>
>> +61 413 950 275 (mobile)
>> +61 2 6125 1028 (office)
>> dan.rosauer at anu.edu.au
>>
>> sites.google.com/site/danielrosauer
>>
>>
>>
>>
>> -----Original Message-----
>> From: Frede Aakmann T?gersen [mailto:frtog at vestas.com]
>> Sent: Wednesday, 5 November 2014 5:19 PM
>> To: Dan Rosauer; r-sig-geo at r-project.org
>> Subject: RE: Cause of error in spdep::errorsarlm
>>
>> Hi Dan
>>
>> Remove the " from your formula. It should be
>>
>> my_formula    <- resp ~  pred1 + pred2
>>
>>
>> Yours sincerely / Med venlig hilsen
>>
>>
>> Frede Aakmann T?gersen
>> Specialist, M.Sc., Ph.D.
>> Plant Performance & Modeling
>>
>> Technology & Service Solutions
>> T +45 9730 5135
>> M +45 2547 6050
>> frtog at vestas.com
>> http://www.vestas.com
>>
>> Company reg. name: Vestas Wind Systems A/S This e-mail is subject to 
>> our e- mail disclaimer statement.
>> Please refer to www.vestas.com/legal/notice If you have received this 
>> e-mail in error please contact the sender.
>>
>>> -----Original Message-----
>>> From: r-sig-geo-bounces at r-project.org [mailto:r-sig-geo-bounces at r- 
>>> project.org] On Behalf Of Dan Rosauer
>>> Sent: 5. november 2014 03:21
>>> To: r-sig-geo at r-project.org
>>> Subject: [R-sig-Geo] Cause of error in spdep::errorsarlm
>>>
>>> Hi Roger et al
>>>
>>> I hope someone can help me with the following error with a call to 
>>> the spdep function errorsarlm()
>>>
>>> Calling the function returns this:  Error: $ operator is invalid for 
>>> atomic vectors
>>>
>>> Things I have already tried:
>>> * testing with real and simulated data - error occurs
>>> * running it on windows and linux - error is identical
>>> * omitting various arguments to the function to see which one is the 
>>> cause - error occurs with or without the data or listw arguments.  
>>> So it apparently triggers this error before it even gets to the 
>>> problem of the missing arguments, and apparently they don't relate 
>>> to the actual content of the data or spatial weights.
>>>
>>> Here is a test script which generates the error:
>>>
>>> ######################
>>> library(spdep)
>>>
>>> # create a sample data frame
>>> df            <- data.frame(lat=runif(100,0,3),long=runif(100,0,3),
>>> pred1=runif(100,0,1), pred2=runif(100,0,1), resp=runif(100,0,10))
>>>
>>> cat("\nPreparing neighbourhood weights for SARLM\n\n")
>>> coords        <-as.matrix(cbind(df$long, df$lat))
>>> cont.nb       <- dnearneigh(coords,d1=0, d2=100,longlat=TRUE)
>>> weight_list   <- nb2listw(cont.nb, glist=NULL, style="W", zero.policy=TRUE)
>>>
>>> my_formula    <- "resp ~  pred1 + pred2"
>>>
>>> # this line gives the error: $ operator is invalid for atomic vectors
>>> SAR.mod           <- errorsarlm(my_formula, data=df, listw=weight_list)
>>> ######################
>>>
>>> The R version is 3.1.0, and spdep 0.5-77
>>>
>>> Any advice on how to fix this problem would be much appreciated.
>>>
>>> The best possibility is that I've made a dumb mistake which can be 
>>> easily fixed... :-)
>>>
>>> thanks
>>>
>>> Dan
>>>
>>>
>>> ~~~~~~~~~~~~~~~~~~~~~~
>>> Dan Rosauer
>>> Postdoctoral Researcher
>>> Moritz Lab
>>> Ecology, Evolution & Genetics
>>> Research School of Biology
>>> Gould Building, Daley Road
>>> Australian National University
>>> Canberra ACT 0200
>>>
>>> +61 413 950 275 (mobile)
>>> +61 2 6125 1028 (office)
>>> dan.rosauer at anu.edu.au
>>>
>>> sites.google.com/site/danielrosauer
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

--
Roger Bivand
Department of Economics, Norwegian School of Economics, Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no


From frtog at vestas.com  Fri Nov  7 07:52:12 2014
From: frtog at vestas.com (=?iso-8859-1?Q?Frede_Aakmann_T=F8gersen?=)
Date: Fri, 7 Nov 2014 07:52:12 +0100
Subject: [R-sig-Geo] plotKML kml_layer.Raster problem
In-Reply-To: <CAJPy8YXfgejRSVEMXfgxUQvixH3w4NROaLbJPJQ01m54r967Hg@mail.gmail.com>
References: <CAJPy8YXfgejRSVEMXfgxUQvixH3w4NROaLbJPJQ01m54r967Hg@mail.gmail.com>
Message-ID: <B078CDF40DFE4045AF172A8B4F68FC4857C9BA33B8@DKRDSEXC016.vestas.net>

Hi Andreas

Can you provide a small example showing the details of what you're trying to do. I don't think that anyone can help you with the little information you have given.

If you do not have any example please show us the output from traceback() immediately after the error.

I don't think this has anything to do with NA's in your data values as I don't get any errors doing this (from man of kml_layer.Raster):


data(eberg_grid)
library(sp)
coordinates(eberg_grid) <- ~x+y
gridded(eberg_grid) <- TRUE
proj4string(eberg_grid) <- CRS("+init=epsg:31467")
data(SAGA_pal)
library(raster)
r <- raster(eberg_grid["TWISRT6"])

## Put some NA's into data
r at data@values[1:10] <- NA

kml(r, colour_scale = SAGA_pal[[1]], colour = TWISRT6) 


 

Yours sincerely / Med venlig hilsen


Frede Aakmann T?gersen
Specialist, M.Sc., Ph.D.
Plant Performance & Modeling

Technology & Service Solutions
T +45 9730 5135
M +45 2547 6050
frtog at vestas.com
http://www.vestas.com

Company reg. name: Vestas Wind Systems A/S
This e-mail is subject to our e-mail disclaimer statement.
Please refer to www.vestas.com/legal/notice
If you have received this e-mail in error please contact the sender. 


> -----Original Message-----
> From: r-sig-geo-bounces at r-project.org [mailto:r-sig-geo-bounces at r-
> project.org] On Behalf Of Andreas Gros
> Sent: 6. november 2014 23:47
> To: r-sig-geo at r-project.org
> Subject: [R-sig-Geo] plotKML kml_layer.Raster problem
> 
> In version 0.4-6 of plotKML, when I'm adding a kml_layer.Raster (single
> layer, no stack/brick) to a kml file, I get the following error message:
> 
> Error in setValues(x, value) :
> values must be numeric, integer, logical or factor
> 
> 
> The values in the raster range between -57 and 2000 and it also occurs if I
> replace NA values first with some arbitrary numerical value.
> Has anyone come across this problem and knows how to fix/circumnavigate
> it?
> 
> Thanks!
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From hengl at spatial-analyst.net  Fri Nov  7 09:56:28 2014
From: hengl at spatial-analyst.net (Tomislav Hengl)
Date: Fri, 07 Nov 2014 09:56:28 +0100
Subject: [R-sig-Geo] plotKML kml_layer.Raster problem
In-Reply-To: <B078CDF40DFE4045AF172A8B4F68FC4857C9BA33B8@DKRDSEXC016.vestas.net>
References: <CAJPy8YXfgejRSVEMXfgxUQvixH3w4NROaLbJPJQ01m54r967Hg@mail.gmail.com>
	<B078CDF40DFE4045AF172A8B4F68FC4857C9BA33B8@DKRDSEXC016.vestas.net>
Message-ID: <545C893C.9030101@spatial-analyst.net>


I would assume that the value column in the Raster object is somehow 
converted to "character" class.

If you could provide access to your data and code we can do a better job 
(it could be that there is also a bug in plotKML i.e. completely not 
your fault).

HTH,

T. Hengl


On 7-11-2014 7:52, Frede Aakmann T?gersen wrote:
> Hi Andreas
>
> Can you provide a small example showing the details of what you're trying to do. I don't think that anyone can help you with the little information you have given.
>
> If you do not have any example please show us the output from traceback() immediately after the error.
>
> I don't think this has anything to do with NA's in your data values as I don't get any errors doing this (from man of kml_layer.Raster):
>
>
> data(eberg_grid)
> library(sp)
> coordinates(eberg_grid) <- ~x+y
> gridded(eberg_grid) <- TRUE
> proj4string(eberg_grid) <- CRS("+init=epsg:31467")
> data(SAGA_pal)
> library(raster)
> r <- raster(eberg_grid["TWISRT6"])
>
> ## Put some NA's into data
> r at data@values[1:10] <- NA
>
> kml(r, colour_scale = SAGA_pal[[1]], colour = TWISRT6)
>
>
>
>
> Yours sincerely / Med venlig hilsen
>
>
> Frede Aakmann T?gersen
> Specialist, M.Sc., Ph.D.
> Plant Performance & Modeling
>
> Technology & Service Solutions
> T +45 9730 5135
> M +45 2547 6050
> frtog at vestas.com
> http://www.vestas.com
>
> Company reg. name: Vestas Wind Systems A/S
> This e-mail is subject to our e-mail disclaimer statement.
> Please refer to www.vestas.com/legal/notice
> If you have received this e-mail in error please contact the sender.
>
>
>> -----Original Message-----
>> From: r-sig-geo-bounces at r-project.org [mailto:r-sig-geo-bounces at r-
>> project.org] On Behalf Of Andreas Gros
>> Sent: 6. november 2014 23:47
>> To: r-sig-geo at r-project.org
>> Subject: [R-sig-Geo] plotKML kml_layer.Raster problem
>>
>> In version 0.4-6 of plotKML, when I'm adding a kml_layer.Raster (single
>> layer, no stack/brick) to a kml file, I get the following error message:
>>
>> Error in setValues(x, value) :
>> values must be numeric, integer, logical or factor
>>
>>
>> The values in the raster range between -57 and 2000 and it also occurs if I
>> replace NA values first with some arbitrary numerical value.
>> Has anyone come across this problem and knows how to fix/circumnavigate
>> it?
>>
>> Thanks!
>>
>> 	[[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From boukepieter.ottow at wur.nl  Fri Nov  7 15:45:42 2014
From: boukepieter.ottow at wur.nl (Ottow, Bouke Pieter)
Date: Fri, 7 Nov 2014 14:45:42 +0000
Subject: [R-sig-Geo] rsaga.import.gdal gives weird output
Message-ID: <E77A61BE378A78468C9742BD6813C79613DF6654@SCOMP0934.wurnet.nl>

Dear list,

I am using R 3.1.2 on Ubuntu 14 with SAGA GIS 2.1.1 and RSAGA 0.93-6.
I have a SRTM derived DEM called DEM.tif which I want to use with SAGA from R.

I do:
library(raster)
library(rgdal)
library(sp)
library(RSAGA)
work_env <- rsaga.env(modules="/usr/local/lib/saga/")
rsaga.import.gdal("source/DEM.tif", env=work_env)

Now I want to check the converted file, so I do:
result <- raster("source/DEM.sdat")
plot(result)
DEM <- raster("source/DEM.tif")
plot(DEM)

The original DEM is plotted like this:
[X]
The resulting DEM is plotted like this:
[X]
How does this happen? The projection and cellsize seem lost, and it is turned upside down.
When I open the file in SAGA GIS it looks the same but it says it has the right projection (WGS 84, epsg 4326). I can also open the tif file in SAGA which seems alright.

I had this problem before with other versions too.

Kind regards,
Bouke Pieter Ottow


From rencizao at yahoo.com  Fri Nov  7 16:59:42 2014
From: rencizao at yahoo.com (Cizao Ren)
Date: Fri, 7 Nov 2014 07:59:42 -0800
Subject: [R-sig-Geo] Smoothing areal data or polygon data
Message-ID: <1415375982.5255.YahooMailNeo@web160701.mail.bf1.yahoo.com>



Hello list,
I tried to smooth a cancer by zip code in
Los Angeles county using Pycno package as the example in package. The example works, but when I run the program
using our own data and error report as following.
The zipboundary is a spatialpolygon data in sp in r and
?case? is a set of numbers of cancer in each ZIP code. I increase the memory size, but still did not work. I found  Juta
Kawalerowicz (juta.kawalerowicz at nuffield.ox.ac.uk)
met the same problem and wrote the code to solve it. However, when I tried to download the code, the web did not appear. Does anyone know
how to fix it up or any other methods for areal interpolation?
Thank you very much,
 
Cizao Ren
 
 
zip.pycno <- pycno(zipboudary,case,r=0.2,converge=1)
Warning messages:
1: In (function (..., KEEP.OUT.ATTRS = TRUE,
stringsAsFactors = TRUE)  :
  Reached total allocation of 8118Mb: see
help(memory.size)
2: In (function (..., KEEP.OUT.ATTRS = TRUE,
stringsAsFactors = TRUE)  :
  Reached total allocation of 8118Mb: see
help(memory.size)
3: In (function (..., KEEP.OUT.ATTRS = TRUE,
stringsAsFactors = TRUE)  :
  Reached total allocation of 8118Mb: see
help(memory.size)
4: In (function (..., KEEP.OUT.ATTRS = TRUE,
stringsAsFactors = TRUE)  :
  Reached total allocation of 8118Mb: see
help(memory.size)
Error in over(x, y) : 
  error in evaluating the argument 'x' in
selecting a method for function 'over': Error in coordinates(coords) : 
  error in evaluating the argument 'obj' in
selecting a method for function 'coordinates': Error: cannot allocate vector of
size 3.0 Gb
	[[alternative HTML version deleted]]


From sendmeoffer at gmail.com  Fri Nov  7 17:13:01 2014
From: sendmeoffer at gmail.com (Vladimir)
Date: Fri, 07 Nov 2014 17:13:01 +0100
Subject: [R-sig-Geo] Leader lines for inset map
In-Reply-To: <CAJ_iHnfzfE4YuQAqwFJYAqS_z1v4LnnWzYecp-ZF07NwKq4LZg@mail.gmail.com>
References: <8b8b67e6730d4eaba3e3ecdf21e88328@EX-1-HT0.lancs.local>	<CANVKczMi18zY0oS0jgEgamQukkMvZVxEdKhBoYawkTtpccG=hg@mail.gmail.com>	<54575756.9040007@gmail.com>
	<CAJ_iHnfzfE4YuQAqwFJYAqS_z1v4LnnWzYecp-ZF07NwKq4LZg@mail.gmail.com>
Message-ID: <545CEF8D.6080500@gmail.com>

Hello!

Well, I think this will work for me, thanks Rohan!

As others pointed out, R is not aimed for cartographic map design, 
though it can be used in some cases (when repetitive changes applied to 
the data drawn). For one-time maps I will export the map into SVG, and 
then do the design in the Inkscape.

Thanks again for your answers!

All the best,
Vladimir.


On 03/11/14 12:45, Rohan Sadler wrote:
> Hi Vladimir,
>
> Cheap and nasty says add lines, but first define where you want to put 
> your insets explicitly by specifying x,y for the subplots. modified 
> code below (you will want to move your xy values around slightly to suit).
>
>     library(TeachingDemos)
>     library(maptools)
>
>     data(wrld_simpl)
>
>     plot(wrld_simpl,border=NA,col='blue',axes=TRUE, xlim=c(100,130),
>     ylim=c(-40,30))
>
>   tmp <- subplot(
> plot(wrld_simpl,border=NA,col='green',bg='white',axes=FALSE),
>         y=c(-40,-25),x=c(75,110),inset=c(0.01,0.01))
>     tmp2 <- par('usr')
>
>     tmp3 <- subplot(
>     plot(wrld_simpl, border='red', axes=TRUE, xlim=c(95,105),
>     ylim=c(-5,5), bg='lightgrey'), y=c(-5,30),x=c(120,160))
>
>      par(xpd=TRUE)  # reset clipping region
>     rect( tmp3$usr[1], tmp3$usr[3], tmp3$usr[2], tmp3$usr[4],
>     border='orange' )
>
>   lines(c(tmp3$usr[1],120),c(tmp3$usr[4],30),lwd=2)
>   lines(c(tmp3$usr[2],120),c(tmp3$usr[3],-5),lwd=2)
>
>     op <- par(tmp[c('plt','usr')])
>     rect( tmp2[1], tmp2[3], tmp2[2], tmp2[4], border='red' )
>     par(op)
>
> I've added in a ggmap equivalent, which gives close to publication 
> quality graphic, pulling a map from googlemaps (you may want imagery 
> instead). All based on Kahle & Wickham's excellent paper. Note that 
> this example is fudged in that the inset is a zoom out rather than a 
> zoom in; and I could waste a lot of time getting rid of the second 
> 'accidental' legend. Go for something other than the googlemaps API if 
> you wish to publish something similar with ggmap. Depending on one's 
> level of abstraction, it still requires you to add lines ... :)
> (assuming I have understood your question right!!)
>
> Regards
> Rohan
>
> library(ggmap)
> # Source: http://journal.r-project.org/archive/2013-1/kahle-wickham.pdf
>
> # violent crimes in houston, texas
> violent_crimes <- subset(crime,
>  offense != "auto theft" & offense != "theft" & offense != "burglary")
>
>  # order violent crimes
>  violent_crimes$offense <- factor(violent_crimes$offense,
>  levels = c("robbery", "aggravated assault", "rape", "murder"))
>
>  # restrict to downtown
>  violent_crimes <- subset(violent_crimes,
>  -95.39681 <= lon & lon <= -95.34188 &
>  29.73631 <= lat & lat <= 29.78400)
>
> # arbitrary area of interst
> AOI<- data.frame(x=c(-95.38,-95.38,-95.385,-95.385,-95.38),
>        y=c(29.74,29.745,29.745,29.74,29.74))
> AOIConnectors<- data.frame(x=c(-95.38,-95.35836,-95.38,-95.35836),
> y=c(29.74,29.73631,29.745,29.75062),seg=rep(1:2,each=2))
>
> # googlemaps api
> houston <- get_map("houston", zoom = 14)
>
> # generate your graphics layers
> HoustonMap <- ggmap(houston, extent = "device", legend = "topleft")
>
> overlay <- stat_density2d(
> aes(x = lon, y = lat, fill = ..level.., alpha = ..level..),
> bins = 4, geom = "polygon",
> data = violent_crimes
> )
>
> # construct your image
> HoustonMap + overlay + inset(
> grob = ggplotGrob(ggplot() + overlay + theme_inset()),
> xmin = -95.35836, xmax = Inf, ymin = -Inf, ymax = 29.75062)+
> geom_line(aes(x,y,group=seg),data=AOIConnectors)+
> geom_path(aes(x,y),data=AOI)
>
>
>
>
>
> On 3 November 2014 18:22, Vladimir <sendmeoffer at gmail.com 
> <mailto:sendmeoffer at gmail.com>> wrote:
>
>     Hello!
>
>     The minimal example is
>     ===== (source
>     http://r-sig-geo.2731867.n2.nabble.com/making-an-inset-in-a-map-figure-tp7584585p7584618.html
>     )
>
>         |library(TeachingDemos)
>         library(maptools)
>         |
>
>         ||
>         |data(wrld_simpl)
>
>         plot(wrld_simpl,border=NA,col='blue',axes=TRUE, xlim=c(100,130),
>         ylim=c(-40,30))
>
>         tmp <- subplot(
>     plot(wrld_simpl,border=NA,col='green',bg='white',axes=FALSE),
>             'bottomleft', size=c(2,1), inset=c(0.01,0.01))
>
>         tmp2 <- par('usr')
>
>         tmp3 <- subplot(
>         plot(wrld_simpl, border='red', axes=TRUE, xlim=c(95,105),
>         ylim=c(-5,5), bg='lightgrey'), 'topright', size=c(2,2))
>
>         par(xpd=TRUE)  # reset clipping region
>         rect( tmp3$usr[1], tmp3$usr[3], tmp3$usr[2], tmp3$usr[4],
>         border='orange' )
>
>         op <- par(tmp[c('plt','usr')])
>         rect( tmp2[1], tmp2[3], tmp2[2], tmp2[4], border='red' )
>         par(op)
>         |
>
>     =====
>
>     I want to connect orange rectangle with topright inset map.
>
>     All the best,
>     Vladimir.
>
>
>     On 03/11/14 08:53, Barry Rowlingson wrote:
>     >
>     > I don't think you'll get a complete solution from this mailing list
>     > until you tell us how you are drawing your maps in the first place.
>     >
>     > Are you using base graphics plotting, or ggplot, or ggmap, or
>     lattice?
>     > Could you throw us a few lines of code that show how you make your
>     > base and insert maps? Otherwise you're going to get a bunch of "just
>     > draw lines" answers...
>     >
>     > On 1 Nov 2014 20:07, "Vladimir" <sendmeoffer at gmail.com
>     <mailto:sendmeoffer at gmail.com>
>     > <mailto:sendmeoffer at gmail.com <mailto:sendmeoffer at gmail.com>>> wrote:
>     >
>     >     Hello list!
>     >
>     >     I would like to add leader lines to my inset maps. These
>     lines connect
>     >     the frame of the inset map with the corresponding area on
>     the main
>     >     map.
>     >     Good examples are here [1], [2], or here [3].
>     >
>     >     What is the most convenient R approach to do so?
>     >
>     >     Kind regards,
>     >     Vladimir.
>     >
>     >     ---
>     >     [1]
>     >
>     http://gce-lter.marsci.uga.edu/public/images/gce_study_area_blowup_nov07_rev.jpg
>     >     [2] http://pubs.usgs.gov/fs/fs08203/images/study_area.gif
>     >     [3]
>     >
>     http://www.innovativegis.com/basis/supplements/bm_dec_02/Ironing_Colorado_files/image004.jpg
>     >
>     >     _______________________________________________
>     >     R-sig-Geo mailing list
>     > R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
>     <mailto:R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>>
>     > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>     >
>
>
>             [[alternative HTML version deleted]]
>
>     _______________________________________________
>     R-sig-Geo mailing list
>     R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
>     https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
>
>
> -- 
> Senior Scientist
> Astron Environmental Services Pty. Ltd.
> rohan.sadler at astron.com.au <mailto:rohan.sadler at astron.com.au>
>
> Adjunct Senior Lecturer
> School of Agricultural and Resource Economics, M089
> The University of Western Australia
>
> Office:  +61 8 94219684
> Mobile:      0433 192 600


	[[alternative HTML version deleted]]


From andigros72 at gmail.com  Fri Nov  7 18:12:07 2014
From: andigros72 at gmail.com (Andreas Gros)
Date: Fri, 7 Nov 2014 09:12:07 -0800
Subject: [R-sig-Geo] plotKML kml_layer.Raster problem
In-Reply-To: <B078CDF40DFE4045AF172A8B4F68FC4857C9BA33B8@DKRDSEXC016.vestas.net>
References: <CAJPy8YXfgejRSVEMXfgxUQvixH3w4NROaLbJPJQ01m54r967Hg@mail.gmail.com>
	<B078CDF40DFE4045AF172A8B4F68FC4857C9BA33B8@DKRDSEXC016.vestas.net>
Message-ID: <CAJPy8YUFh2425cBUkdCu3q81PmtE6POUrXpKvJQ7pXn=YKWK0w@mail.gmail.com>

Hi Frede,

This is the test case (using just values of 1): (traceback() below)

pheight = 100
pwidth = 200

> raster_layer <- raster(ncols=pwidth, nrows=pheight,
+                        xmn=xmin(r.ex), xmx=xmax(r.ex),
+                        ymn=ymin(r.ex), ymx=ymax(r.ex),
+                        crs=CRS(projection(bigraster)))
> values(raster_layer) <- rep(1, pwidth*pheight)


> kml_open(file.name="test.kml",
+   folder.name='top_folder',
+   kml_visibility=TRUE)
KML file opened for writing...
> kml_layer.Raster(raster_layer, folder.name='raster_sub_folder',
+   plot.legend=TRUE,
+   metadata=NULL,
+   colour=e.cRampPalette(255),
+   raster_name='raster_layer',
+   layer.name=names(raster_layer)[1],
+   png.width=1000,
+   png.height=833
+ )

Error in setValues(x, value) :
  values must be numeric, integer, logical or factor

> kml_close(file.name="test.kml")

Closing  test.kml

Traceback:
traceback()
6: stop("values must be numeric, integer, logical or factor")
5: setValues(x, value)
4: setValues(x, value)
3: `values<-`(`*tmp*`, value = c("#000000", "#010101", "#020202",
   "#030303", "#040404", "#060606", "#070707", "#080808", "#090909",
   "#0A0A0A", "#0C0C0C", "#0D0D0D", "#0E0E0E", "#0F0F0F", "#0F0F0F",
   "#101010", "#111111", "#121212", "#131313", "#141414", "#141414",
   "#151515", "#161616", "#161616", "#171717", "#181818", "#181818",
   "#191919", "#1A1A1A", "#1A1A1A", "#1B1B1B", "#1C1C1C", "#1C1C1C",
   "#1D1D1D", "#1E1E1E", "#1E1E1E", "#1F1F1F", "#202020", "#202020",
   "#212121", "#222222", "#222222", "#232323", "#242424", "#242424",
   "#252525", "#262626", "#272727", "#272727", "#282828", "#292929",
   "#292929", "#2A2A2A", "#2B2B2B", "#2B2B2B", "#2C2C2C", "#2D2D2D",
   "#2E2E2E", "#2E2E2E", "#2F2F2F", "#303030", "#303030", "#313131",
   "#323232", "#333333", "#333333", "#343434", "#353535", "#363636",
   "#363636", "#373737", "#383838", "#383838", "#393939", "#3A3A3A",
   "#3B3B3B", "#3B3B3B", "#3C3C3C", "#3D3D3D", "#3E3E3E", "#3E3E3E",

...

   ))

2: `values<-`(`*tmp*`, value = c("#000000", "#010101", "#020202",
   "#030303", "#040404", "#060606", "#070707", "#080808", "#090909",
   "#0A0A0A", "#0C0C0C", "#0D0D0D", "#0E0E0E", "#0F0F0F", "#0F0F0F",
   "#101010", "#111111", "#121212", "#131313", "#141414", "#141414",
   "#151515", "#161616", "#161616", "#171717", "#181818", "#181818",
   "#565656", "#575757", "#585858", "#595959", "#5A5A5A", "#5A5A5A",
...

 ))

1: kml_layer.Raster(raster_layer, folder.name = "raster_sub_folder",
       plot.legend = TRUE, metadata = NULL, colour = e.cRampPalette(255),
       raster_name = "raster_layer", layer.name = names(raster_layer)[1],
       png.width = 1000, png.height = 833)


And when I'm trying to use colour_scheme I'm gettiing an error that lets me
assume that kml_layer.Raster is not compatible with 'raster':

kml_open(file.name="test.kml",
+   folder.name='top_folder',
+   kml_visibility=TRUE)
KML file opened for writing...
> kml_layer.Raster(raster_layer, folder.name='raster_sub_folder',
+   plot.legend=TRUE,
+   metadata=NULL,
+   colour_scheme=e.cRampPalette(255),
+   raster_name='raster_layer',
+   layer.name=names(raster_layer)[1],
+   png.width=1000,
+   png.height=833
+ )

Error in is.factor(obj at data[, 1]) :
  error in evaluating the argument 'x' in selecting a method for function
'is.factor': Error in obj at data[, 1] : object of type 'S4' is not subsettable

> kml_close(file.name="test.kml")
Closing  test.kml

> traceback()
2: is.factor(obj at data[, 1])
1: kml_layer.Raster(raster_layer, folder.name = "raster_sub_folder",
       plot.legend = TRUE, metadata = NULL, colour_scheme =
e.cRampPalette(255),
       raster_name = "raster_layer", layer.name = names(raster_layer)[1],
       png.width = 1000, png.height = 833)

On Thu, Nov 6, 2014 at 10:52 PM, Frede Aakmann T?gersen <frtog at vestas.com>
wrote:

> Hi Andreas
>
> Can you provide a small example showing the details of what you're trying
> to do. I don't think that anyone can help you with the little information
> you have given.
>
> If you do not have any example please show us the output from traceback()
> immediately after the error.
>
> I don't think this has anything to do with NA's in your data values as I
> don't get any errors doing this (from man of kml_layer.Raster):
>
>
> data(eberg_grid)
> library(sp)
> coordinates(eberg_grid) <- ~x+y
> gridded(eberg_grid) <- TRUE
> proj4string(eberg_grid) <- CRS("+init=epsg:31467")
> data(SAGA_pal)
> library(raster)
> r <- raster(eberg_grid["TWISRT6"])
>
> ## Put some NA's into data
> r at data@values[1:10] <- NA
>
> kml(r, colour_scale = SAGA_pal[[1]], colour = TWISRT6)
>
>
>
>
> Yours sincerely / Med venlig hilsen
>
>
> Frede Aakmann T?gersen
> Specialist, M.Sc., Ph.D.
> Plant Performance & Modeling
>
> Technology & Service Solutions
> T +45 9730 5135
> M +45 2547 6050
> frtog at vestas.com
> http://www.vestas.com
>
> Company reg. name: Vestas Wind Systems A/S
> This e-mail is subject to our e-mail disclaimer statement.
> Please refer to www.vestas.com/legal/notice
> If you have received this e-mail in error please contact the sender.
>
>
> > -----Original Message-----
> > From: r-sig-geo-bounces at r-project.org [mailto:r-sig-geo-bounces at r-
> > project.org] On Behalf Of Andreas Gros
> > Sent: 6. november 2014 23:47
> > To: r-sig-geo at r-project.org
> > Subject: [R-sig-Geo] plotKML kml_layer.Raster problem
> >
> > In version 0.4-6 of plotKML, when I'm adding a kml_layer.Raster (single
> > layer, no stack/brick) to a kml file, I get the following error message:
> >
> > Error in setValues(x, value) :
> > values must be numeric, integer, logical or factor
> >
> >
> > The values in the raster range between -57 and 2000 and it also occurs
> if I
> > replace NA values first with some arbitrary numerical value.
> > Has anyone come across this problem and knows how to fix/circumnavigate
> > it?
> >
> > Thanks!
> >
> >       [[alternative HTML version deleted]]
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From frtog at vestas.com  Mon Nov 10 08:16:30 2014
From: frtog at vestas.com (=?utf-8?B?RnJlZGUgQWFrbWFubiBUw7hnZXJzZW4=?=)
Date: Mon, 10 Nov 2014 08:16:30 +0100
Subject: [R-sig-Geo] plotKML kml_layer.Raster problem
Message-ID: <B078CDF40DFE4045AF172A8B4F68FC4857C9C58971@DKRDSEXC016.vestas.net>

Hi    (cc?ing maintainer since I find the documentation to be unclear on how to use some of the arguments to the kml functions)

Well, I cannot run your example since I don?t have the r.ex, bigraster, and e.cRamplette() objects.

Using the following I can reproduce your error.

## using SAGA_pal instead of e.cRamplette()
data(SAGA_pal)

pheight = 100
pwidth = 200

raster_layer <- raster(ncols=pwidth, nrows=pheight,
                       xmn=20, xmx=25,
                       ymn=30, ymx=35,
                       crs=CRS("+proj=longlat +datum=WGS84"))

values(raster_layer) <- rnorm(pwidth*pheight, mean = 50, sd = 10)

kml_open(file.name="test.kml",
  folder.name='.',
  kml_visibility=TRUE)

kml_layer.Raster(raster_layer, folder.name='raster_sub_folder',
                 plot.legend=TRUE,
                 metadata=NULL,
                 colour=SAGA_pal[[1]],
                 raster_name='raster_layer',
                 layer.name=names(raster_layer)[1],
                 png.width=1000,
                 png.height=833
                 )

kml_close(file.name="test.kml")

> traceback()
6: stop("values must be numeric, integer, logical or factor")
5: setValues(x, value)
4: setValues(x, value)
3: `values<-`(`*tmp*`, value = c("#000180", "#0007A7", "#0019CA",
   "#0035E6", "#0058F8", "#017FFF", "#07A7F8", "#19CAE6", "#35E6CA",
   "#58F8A7", "#80FF80", "#A7F858", "#CAE635", "#E6CA19", "#F8A707",
   "#FF8001", "#F85800", "#E63500", "#CA1900", "#A70700"))
2: `values<-`(`*tmp*`, value = c("#000180", "#0007A7", "#0019CA",
   "#0035E6", "#0058F8", "#017FFF", "#07A7F8", "#19CAE6", "#35E6CA",
   "#58F8A7", "#80FF80", "#A7F858", "#CAE635", "#E6CA19", "#F8A707",
   "#FF8001", "#F85800", "#E63500", "#CA1900", "#A70700"))
1: kml_layer.Raster(raster_layer, folder.name = "raster_sub_folder",
       plot.legend = TRUE, metadata = NULL, colour = SAGA_pal[[1]],
       raster_name = "raster_layer", layer.name = names(raster_layer)[1],
       png.width = 1000, png.height = 833)

Debugging the kml_layer.Raster function shows the ?culprit? is this part of code:

    if (is.call(call[["colour"]]) | is.name(call[["colour"]])) {
        x <- data.frame(getValues(obj))
        names(x) <- names(obj)
        x <- eval(call[["colour"]], x)
        obj <- raster(obj)
        values(obj) <- x
    }
    else {

This looks strange so specifying the colour scheme using the colour argument seems to be wrong.

Looking at the man pages for kml and kml_layer.Raster there one finds that the colour scheme is specified by the colour_grade argument.

Indeed, your example works if one use that argument.

Well information on how to use colour or colour_grade argument is not well documented. Here for ?kml_layer.Raster:

kml_layer.Raster            package:plotKML            R Documentation

Writes raster objects to KML

Description:

     Writes rasters to PNG images and makes a KML code (ground
     overlays). Works with '"RasterLayer"' and '"RasterStack"' class
     objects. Target attributes can be specified using aesthetics
     arguments (e.g. '"colour"').


And from ?kml:

kml-methods              package:plotKML               R Documentation

Write to a KML file

Description:

     Writes any 'Spatial*' object (from the sp package) or 'Raster*'
     object (from the raster package) to a KML file via the
     'plotKML.fileIO' environment. Various _aesthetics_ parameters can
     be set via 'colour', 'alpha', 'size', 'shape' arguments. Their
     availability depends on the class of the object to plot.

And ?kml_aes does not really help:

aesthetics               package:plotKML               R Documentation

Plotting aesthetics parameters

Description:

     Parses various object parameters / columns to KML aesthetics: size
     of the icons, fill color, labels, altitude, width, ...

Usage:

     kml_aes(obj, ...)

Arguments:

     obj: space-time object for plotting

     ...: other arguments

Details:

     Valid aesthetics: 'colour = "black"', 'fill = "white"', 'shape',
     'whitening', 'alpha', 'width = 1', 'labels', 'altitude = 0',
     'size', 'balloon = FALSE'. Specific features (target variables and
     the connected hot-spots) can be emphasized by using two or three
     graphical parameters for the same variable. See plotKML package
     homepage / vignette for more examples.

Author(s):

     Pierre Roudier

See Also:

     'kml-methods'










Yours sincerely / Med venlig hilsen


Frede Aakmann T?gersen
Specialist, M.Sc., Ph.D.
Plant Performance & Modeling

Technology & Service Solutions
T +45 9730 5135
M +45 2547 6050
frtog at vestas.com<mailto:frtog at vestas.com>
http://www.vestas.com<http://www.vestas.com/>

Company reg. name: Vestas Wind Systems A/S
This e-mail is subject to our e-mail disclaimer statement.
Please refer to www.vestas.com/legal/notice<http://www.vestas.com/legal/notice>
If you have received this e-mail in error please contact the sender.

From: Andreas Gros [mailto:andigros72 at gmail.com]
Sent: 7. november 2014 18:12
To: Frede Aakmann T?gersen
Cc: r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] plotKML kml_layer.Raster problem

Hi Frede,

This is the test case (using just values of 1): (traceback() below)

pheight = 100
pwidth = 200

> raster_layer <- raster(ncols=pwidth, nrows=pheight,
+                        xmn=xmin(r.ex), xmx=xmax(r.ex),
+                        ymn=ymin(r.ex), ymx=ymax(r.ex),
+                        crs=CRS(projection(bigraster)))
> values(raster_layer) <- rep(1, pwidth*pheight)


> kml_open(file.name<http://file.name/>="test.kml",
+   folder.name<http://folder.name/>='top_folder',
+   kml_visibility=TRUE)
KML file opened for writing...
> kml_layer.Raster(raster_layer, folder.name<http://folder.name/>='raster_sub_folder',
+   plot.legend=TRUE,
+   metadata=NULL,
+   colour=e.cRampPalette(255),
+   raster_name='raster_layer',
+   layer.name<http://layer.name/>=names(raster_layer)[1],
+   png.width=1000,
+   png.height=833
+ )

Error in setValues(x, value) :
  values must be numeric, integer, logical or factor

> kml_close(file.name<http://file.name/>="test.kml")

Closing  test.kml

Traceback:
traceback()
6: stop("values must be numeric, integer, logical or factor")
5: setValues(x, value)
4: setValues(x, value)
3: `values<-`(`*tmp*`, value = c("#000000", "#010101", "#020202",
   "#030303", "#040404", "#060606", "#070707", "#080808", "#090909",
   "#0A0A0A", "#0C0C0C", "#0D0D0D", "#0E0E0E", "#0F0F0F", "#0F0F0F",
   "#101010", "#111111", "#121212", "#131313", "#141414", "#141414",
   "#151515", "#161616", "#161616", "#171717", "#181818", "#181818",
   "#191919", "#1A1A1A", "#1A1A1A", "#1B1B1B", "#1C1C1C", "#1C1C1C",
   "#1D1D1D", "#1E1E1E", "#1E1E1E", "#1F1F1F", "#202020", "#202020",
   "#212121", "#222222", "#222222", "#232323", "#242424", "#242424",
   "#252525", "#262626", "#272727", "#272727", "#282828", "#292929",
   "#292929", "#2A2A2A", "#2B2B2B", "#2B2B2B", "#2C2C2C", "#2D2D2D",
   "#2E2E2E", "#2E2E2E", "#2F2F2F", "#303030", "#303030", "#313131",
   "#323232", "#333333", "#333333", "#343434", "#353535", "#363636",
   "#363636", "#373737", "#383838", "#383838", "#393939", "#3A3A3A",
   "#3B3B3B", "#3B3B3B", "#3C3C3C", "#3D3D3D", "#3E3E3E", "#3E3E3E",

...

   ))

2: `values<-`(`*tmp*`, value = c("#000000", "#010101", "#020202",
   "#030303", "#040404", "#060606", "#070707", "#080808", "#090909",
   "#0A0A0A", "#0C0C0C", "#0D0D0D", "#0E0E0E", "#0F0F0F", "#0F0F0F",
   "#101010", "#111111", "#121212", "#131313", "#141414", "#141414",
   "#151515", "#161616", "#161616", "#171717", "#181818", "#181818",
   "#565656", "#575757", "#585858", "#595959", "#5A5A5A", "#5A5A5A",
...

 ))

1: kml_layer.Raster(raster_layer, folder.name<http://folder.name/> = "raster_sub_folder",
       plot.legend = TRUE, metadata = NULL, colour = e.cRampPalette(255),
       raster_name = "raster_layer", layer.name<http://layer.name/> = names(raster_layer)[1],
       png.width = 1000, png.height = 833)


And when I'm trying to use colour_scheme I'm gettiing an error that lets me assume that kml_layer.Raster is not compatible with 'raster':

kml_open(file.name<http://file.name>="test.kml",
+   folder.name<http://folder.name>='top_folder',
+   kml_visibility=TRUE)
KML file opened for writing...
> kml_layer.Raster(raster_layer, folder.name<http://folder.name>='raster_sub_folder',
+   plot.legend=TRUE,
+   metadata=NULL,
+   colour_scheme=e.cRampPalette(255),
+   raster_name='raster_layer',
+   layer.name<http://layer.name>=names(raster_layer)[1],
+   png.width=1000,
+   png.height=833
+ )

Error in is.factor(obj at data[, 1]) :
  error in evaluating the argument 'x' in selecting a method for function 'is.factor': Error in obj at data[, 1] : object of type 'S4' is not subsettable

> kml_close(file.name<http://file.name>="test.kml")
Closing  test.kml

> traceback()
2: is.factor(obj at data[, 1])
1: kml_layer.Raster(raster_layer, folder.name<http://folder.name> = "raster_sub_folder",
       plot.legend = TRUE, metadata = NULL, colour_scheme = e.cRampPalette(255),
       raster_name = "raster_layer", layer.name<http://layer.name> = names(raster_layer)[1],
       png.width = 1000, png.height = 833)

On Thu, Nov 6, 2014 at 10:52 PM, Frede Aakmann T?gersen <frtog at vestas.com<mailto:frtog at vestas.com>> wrote:
Hi Andreas

Can you provide a small example showing the details of what you're trying to do. I don't think that anyone can help you with the little information you have given.

If you do not have any example please show us the output from traceback() immediately after the error.

I don't think this has anything to do with NA's in your data values as I don't get any errors doing this (from man of kml_layer.Raster):


data(eberg_grid)
library(sp)
coordinates(eberg_grid) <- ~x+y
gridded(eberg_grid) <- TRUE
proj4string(eberg_grid) <- CRS("+init=epsg:31467")
data(SAGA_pal)
library(raster)
r <- raster(eberg_grid["TWISRT6"])

## Put some NA's into data
r at data@values[1:10] <- NA

kml(r, colour_scale = SAGA_pal[[1]], colour = TWISRT6)




Yours sincerely / Med venlig hilsen


Frede Aakmann T?gersen
Specialist, M.Sc., Ph.D.
Plant Performance & Modeling

Technology & Service Solutions
T +45 9730 5135<tel:%2B45%209730%205135>
M +45 2547 6050<tel:%2B45%202547%206050>
frtog at vestas.com<mailto:frtog at vestas.com>
http://www.vestas.com

Company reg. name: Vestas Wind Systems A/S
This e-mail is subject to our e-mail disclaimer statement.
Please refer to www.vestas.com/legal/notice<http://www.vestas.com/legal/notice>
If you have received this e-mail in error please contact the sender.


> -----Original Message-----
> From: r-sig-geo-bounces at r-project.org<mailto:r-sig-geo-bounces at r-project.org> [mailto:r-sig-geo-bounces at r-<mailto:r-sig-geo-bounces at r->
> project.org<http://project.org>] On Behalf Of Andreas Gros
> Sent: 6. november 2014 23:47
> To: r-sig-geo at r-project.org<mailto:r-sig-geo at r-project.org>
> Subject: [R-sig-Geo] plotKML kml_layer.Raster problem
>
> In version 0.4-6 of plotKML, when I'm adding a kml_layer.Raster (single
> layer, no stack/brick) to a kml file, I get the following error message:
>
> Error in setValues(x, value) :
> values must be numeric, integer, logical or factor
>
>
> The values in the raster range between -57 and 2000 and it also occurs if I
> replace NA values first with some arbitrary numerical value.
> Has anyone come across this problem and knows how to fix/circumnavigate
> it?
>
> Thanks!
>
>       [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org<mailto:R-sig-Geo at r-project.org>
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


	[[alternative HTML version deleted]]


From mparsa1050 at gmail.com  Mon Nov 10 09:36:54 2014
From: mparsa1050 at gmail.com (Mahbubeh Parsaeian)
Date: Mon, 10 Nov 2014 12:06:54 +0330
Subject: [R-sig-Geo] Error in SpatioTemporal package: system is exactly
	singular!!!
Message-ID: <CAOJY8UK1xcwN_=NDNuZx_j-2dDS9X7CKMn+3_coK-xdC=8h6Zw@mail.gmail.com>

Dear all,
I am using the package SpatioTemporal and trying to analyze PM
data.When I use estimate function I receive this message:Lapack
routine dgesv: system is exactly singular: U[1,1] = 0

> est.EBOD.model <- estimate(EBOD.model, x.init,
+                            type="p", hessian.all=FALSE)
Optimisation using starting value 1/2
N = 9, M = 5 machine precision = 2.22045e-16
At X0, 0 variables are exactly at the bounds
At iterate     0  f=        31227  |proj g|=           15
At iterate    10  f =       3036.8  |proj g|=        2.4429

iterations 17
function evaluations 31
segments explored during Cauchy searches 21
BFGS updates skipped 0
active bounds at final generalized Cauchy point 0
norm of the final projected gradient 0.0555717
final function value 3036.35

F = 3036.35
final  value 3036.345750
converged

Error in diag(solve(res[[i]]$hessian)) :
  error in evaluating the argument 'x' in selecting a method for
function 'diag': Error in solve.default(res[[i]]$hessian) :
  Lapack routine dgesv: system is exactly singular: U[1,1] = 0

I think this error occur due to high collinearity between stations but I have
 checked the correlations and they are not high:
           |     PM31     PM32     PM33     PM34     PM35     PM36
-------------+------------------------------------------------------
        PM31 |   1.0000
        PM32 |   0.3547   1.0000
        PM33 |   0.6414  -0.1596   1.0000
        PM34 |   0.7102   0.1937   0.6225   1.0000
        PM35 |   0.2578   0.6152  -0.2569   0.3733   1.0000
        PM36 |   0.4386   0.6826   0.2227   0.2510   0.1930   1.0000

I have attached R code with necessary files.
If it is possible please help me to understand the problem and find a
solution for this problem.
Thanks for your help in advance.
Kindest regards,
Mahboubeh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20141110/b038f66e/attachment.html>
-------------- next part --------------
ID	X	Y	ST_TYPE	long	lat
PM31	535737	3944857	DOE	5818.10382	35495.82329
PM32	539717	3958807	DOE	5861.32662	35621.34539
PM33	539235	3962529	DOE	5856.0921	35654.83594
PM34	572740	3955767	DOE	6219.9564	35593.99147
PM35	530506	3951224	DOE	5761.29516	35553.11355
PM36	552708	3952968	DOE	6002.40888	35568.80606
-------------- next part --------------
date	PM31	PM32	PM33	PM34	PM35	PM36
"2005-01-03"	77.5699	95.2212	147.689			37.1137
"2005-01-17"	110.342	122.781	182.969			36.9129
"2005-01-31"	95.5716	72.2073	129.292	58.9851		50.1795
"2005-02-14"	114.085	130.161	149.608	87.9972		143.677
"2005-02-28"	83.8428	96.9447	123.782	67.7066		61.4356
"2005-03-14"	57.8186	65.538	69.4267	36.1276		38.3897
"2005-03-28"	71.6618	97.3639	121.942	67.8738		87.4313
"2005-04-11"	75.1343	97.8515	111.284	76.6714		74.5232
"2005-04-25"	79.1766	95.7183	112.91	71.5106		76.2023
"2005-05-09"	78.6504	103.109	111.662	74.7137		88.088
"2005-05-23"	65.184	87.7625	105.992	76.1015		85.5665
"2005-06-06"	82.9721	86.7729	109.757	77.7298		132.142
"2005-06-20"	135.263	136.418	164.165	140.193		163.272
"2005-07-04"	121.158	121.749	146.32	140.625		108.66
"2005-07-18"	98.4822	97.8361	126.504	160.444		79.5385
"2005-08-01"	94.9587	98.7085	127.415	120.845		77.7862
"2005-08-15"	96.4996	100.166	122.235	151.058		70.8648
"2005-08-29"	105.197	96.5641	127.23	140.768		72.1686
"2005-09-12"	103.536	93.1749	129.97	104.036		70.5773
"2005-09-26"	117.163	100.519	132.652	81.0315		76.647
"2005-10-10"	126.582	102.314	140.32	104.718		79.8498
"2005-10-24"	102.995	86.8288	119.014	89.4026		
"2005-11-07"	74.2086	76.8305	102.563			
"2005-11-21"	116.235	119.553	159.828	166.642		
"2005-12-05"	144.588	139.648	183.305	147.069	144.578	
"2005-12-19"	76.5928	87.4176	120.522	82.1613	91.7381	53.8913
"2006-01-02"	70.5746	97.2782	134.748	81.0197	87.4118	76.9064
"2006-01-16"	88.5054	99.1791	123.285	83.6371	89.0786	62.7051
"2006-01-30"	88.1744	110.816	130.031	78.7251	123.367	53.1701
"2006-02-13"	76.8055	84.9524	108.151	69.103	114.934	41.3044
"2006-02-27"	95.1755	113.905	120.664	86.6606	200.587	57.4599
"2006-03-13"	85.6476	101.04	109.335	82.0466	155.265	57.8504
"2006-03-27"	49.6982	70.9892	67.1267	47.7369	57.445	40.9695
"2006-04-10"	72.4127	98.3976	90.8763	69.684		55.7429
"2006-04-24"	80.4402	104.118	88.7109	82.0519		59.355
"2006-05-08"	89.9933	102.121	74.2535	96.4501		63.3243
"2006-05-22"	77.4586	90.492	78.855	60.9779		56.184
"2006-06-05"	84.5304	94.6069	90.9458	68.8621		60.14
"2006-06-19"	136.636	93.9548	115.662	93.8705		90.3535
"2006-07-03"	107.806	106.083	102.609	95.2917		83.2577
"2006-07-17"	122.409	104.043	106.983	95.5096		87.0191
"2006-07-31"	137.549	115.832	133.276	111.135		100.955
"2006-08-14"	103.747	100.364	107.231	85.0293		83.3055
"2006-08-28"	118.556		123.106	100.238		83.7716
"2006-09-11"	116.378		147.033	102.196		82.2395
"2006-09-25"				92.1979		75.6208
"2006-10-09"				70.1287		
"2006-10-23"						
"2006-11-06"						
"2006-11-20"						80.1089
"2006-12-04"						64.9309
"2006-12-18"						87.7313
"2007-01-01"	101.774	66.2574	150.156	90.5265	71.6703	64.5003
"2007-01-15"	100.495	66.5318	170.52	102.094	134.453	68.2614
"2007-01-29"	77.9259	46.6097	98.261	54.0592	81.4183	
"2007-02-12"	90.4378	53.5467	102.269	62.4913	92.2482	
"2007-02-26"	76.6092	56.8426	111.855	68.8661	139.618	
"2007-03-12"	51.9963	44.1585	67.795	44.5355	86.5422	
"2007-03-26"	81.7353	42.128	62.4435	45.8908	47.1416	
"2007-04-09"	113.552	54.0614	133.382	73.9804	80.1158	
"2007-04-23"	83.2845	57.1326	111.957	74.3273	98.0926	
"2007-05-07"	86.816	55.0209	116.222	77.7053	128.1	
"2007-05-21"	108.149	58.9473	117.634	87.2891	134.753	20.09
"2007-06-04"	110.039	63.2283	126.817	91.4376		80.3093
"2007-06-18"	123.926	67.4053	146.125	87.9957		
"2007-07-02"	104.214	63.9684	111.194	81.6195		
"2007-07-16"	100.962	57.1797	72.8825	65.4598		
"2007-07-30"	84.7595	57.835		71.8973		
"2007-08-13"	123.358	61.1251		76.8427		
"2007-08-27"	102.787	68.2816		68.9308		
"2007-09-10"	105.254	61.2981		78.0429		
"2007-09-24"	93.1118	54.1961		65.5058		
"2007-10-08"	104.324	57.8489		76.9441		
"2007-10-22"	99.9095	60.1559		76.1873		
"2007-11-05"	124.083	33.9783		68.5597		
"2007-11-19"	104.772	35.3028				
"2007-12-03"	133.454	48.2154				
"2007-12-17"	85.3491	96.2912				
"2007-12-31"	122.797	112.788	134.537		127.701	
"2008-01-14"	165.618	172.479	144.245		189.575	
"2008-01-28"	153.621	164.707	144.473		196.324	
"2008-02-11"	130.148	195.437	178.815		211.807	
"2008-02-25"	109.305	169.605	119.031		231.803	
"2008-03-10"	137.78	186.657	117.635		229.716	
"2008-03-24"	152.794	243.888	164.935		222.352	
"2008-04-07"	112.418	173.446	114.935		158.093	
"2008-04-21"	106.74	159.047	113.188		164.39	
"2008-05-05"	115.549	182.117	91.3219		157.709	
"2008-05-19"	140.279	182.894	118.829		187.56	
"2008-06-02"	161.378	207.491	133.703		168.7	
"2008-06-16"	146.705	185.675	102.121		105.322	
"2008-06-30"	178.716	205.289	117.286		134.265	
"2008-07-14"	131.585	172.276	113.916		219.31	
"2008-07-28"	125.637	163.964	100.458		214.321	
"2008-08-11"		165.192	74.8103		188.636	
"2008-08-25"		183.972	90.7737		207.991	
"2008-09-08"		209.087	118.911		225.755	
"2008-09-22"		205.156	168.917		194.58	
"2008-10-06"		207.747	153.293		177.335	
"2008-10-20"		187.881	123.448		133.399	
"2008-11-03"		166.398	120.447		132.203	
"2008-11-17"		169.18	120.247		135.522	
"2008-12-01"		165.836	168.043		173.11	
"2008-12-15"		204.601	186.894		150.29	
"2008-12-29"		166.444	151.099		119.4	61.462
"2009-01-12"	82.4194	132.752	136.816		111.246	49.502
"2009-01-26"	74.1327	141.747	120.307		96.469	50.4087
"2009-02-09"	103.907	232.775	122.074		136.124	63.651
"2009-02-23"	87.3664	123.911	110.347		100.379	51.9734
"2009-03-09"	96.4177	187.952	92.669		114.558	66.6497
"2009-03-23"	77.8626		63.1432		90.4968	41.1579
"2009-04-06"	88.9518	129.781	83.1349		105.339	58.4464
"2009-04-20"	82.8313	130.906	76.5668		105.523	56.0572
"2009-05-04"	132.652	187.073	92.93		137.377	76.3742
"2009-05-18"	101.43	71.8219	89.7404		115.27	71.2514
"2009-06-01"	99.9719	65.8528	71.7692		107.674	82.9182
"2009-06-15"	78.1662	57.1018	54.2652		101.295	56.4237
"2009-06-29"	246.554	283.637	245.939		286.863	331.682
"2009-07-13"		204.205	103.325		141.136	118.785
"2009-07-27"	141.658	170.048	124.913		168.5	153.33
"2009-08-10"	140.164	201.447	116.624		163.202	96.5306
"2009-08-24"	121.941	183.783	98.78		150.312	93.8478
"2009-09-07"	119.194	192.189	102.802		137.66	92.8439
"2009-09-21"	114.985	178.612	84.7091		130.553	67.0556
"2009-10-05"					146.171	71.128
"2009-10-19"					114.56	52.3936
"2009-11-02"					122.596	58.8266
"2009-11-16"					80.6761	35.0138
"2009-11-30"					95.2526	52.6186
"2009-12-14"					107.174	44.0446
"2009-12-28"	78.1087	104.706	84.9622		114.828	57.801
"2010-01-11"	76.156	103.155	100.474		131.615	79.964
"2010-01-25"	63.2156	69.8904	69.3502		54.0596	31.6249
"2010-02-08"	68.6425	75.8325	107.074		46.2049	61.3008
"2010-02-22"	93.3217	94.5992	109.205		65.4482	76.6534
"2010-03-08"	119.216	130.381	137.978	59.3783	104.736	101.718
"2010-03-22"		58.6934	55.5835	45.6692	45.1942	38.7566
"2010-04-05"		85.1385	86.8483	73.8888	70.4449	64.2642
"2010-04-19"	54.4261	79.7597	78.2344	51.3323	101.886	41.4635
"2010-05-03"	63.0048	93.7391	88.9033	60.8356	109.598	86.1476
"2010-05-17"		124.055	86.5296	121.696	169.753	91.751
"2010-05-31"	118.921	144.453	109.033	91.9822	186.868	84.3003
"2010-06-14"	139.933	139.271	109.009	104.299	172.948	94.7655
"2010-06-28"	85.4189	118.788	77.3933	82.6777	191.335	71.393
"2010-07-12"		169.364	106.434	107.12	227.61	101.903
"2010-07-26"	59.8349	111.741	71.8738	73.7122	163.302	58.2537
"2010-08-09"	63.0457	93.9072	63.3552	55.6514	136.338	49.1748
"2010-08-23"	61.4978	93.0257	66.3509	60.6845	150.422	54.8798
"2010-09-06"	64.5507	102.051	69.0402	64.2097	150.851	66.2128
"2010-09-20"	60.9397	126.155	67.6608	79.8722	175.262	67.7369
"2010-10-04"		117.955		76.311	173.67	57.2803
"2010-10-18"		110.546		68.4844	164.308	59.302
"2010-11-01"		125.413		75.7955	185.27	54.9296
"2010-11-15"		147.096		104.434	242.387	76.4001
"2010-11-29"		151.028		105.019	250.323	76.3402
"2010-12-13"		109.341		71.9809	162.971	64.9604
"2010-12-27"						
"2011-01-10"						
"2011-01-24"						
"2011-02-07"						
"2011-02-21"	53.8375					
"2011-03-07"	70.6412					
"2011-03-21"	48.6999	50.2322		39.4448	81.8781	
"2011-04-04"	137.931	131.922		114.944	181.915	
"2011-04-18"	113.979	80.4552		83.0858	142.973	
"2011-05-02"	119.312	99.2889		91.9776	147.397	
"2011-05-16"	93.2647	88.5526		68.9065	142.218	
"2011-05-30"	126.686	134.845		135.341	217.304	
"2011-06-13"	95.1443	100.762		90.9106	171.738	
"2011-06-27"	92.9993	118.493		95.064	179.306	
"2011-07-11"	67.6446	83.6045		69.277	137.388	
"2011-07-25"	73.9157	88.6678		67.0895	132.536	
"2011-08-08"	79.7905	114.03		79.4362	146.848	
"2011-08-22"	37.2528	108.899		69.4501		
"2011-09-05"		97.3273		62.5054		
"2011-09-19"		109.855		68.7606		
"2011-10-03"		108.434		63.4556		
"2011-10-17"		77.3514				
"2011-10-31"						
"2011-11-14"		68.8996				
"2011-11-28"		81.0618				
"2011-12-12"		101.936		57.0327	179.451	
"2011-12-26"		84.9502		49.6994	154.534	
"2012-01-09"		81.5517		67.814	151.578	
"2012-01-23"		62.1386		53.7422	126.119	
"2012-02-06"		76.3158		73.2991	144.364	
"2012-02-20"		72.8109				
"2012-03-05"		79.2844				
"2012-03-19"		53.1878		48.6094	104.024	35.8646
"2012-04-02"		75.7904		69.301	135.773	50.7425
"2012-04-16"		74.2118		78.0367	174.378	34.7276
"2012-04-30"		57.3518		72.0551	109.647	
"2012-05-14"		82.6797		132.924		
"2012-05-28"		58.4923		104.919		
"2012-06-11"						
"2012-06-25"				73.2088		
"2012-07-09"	94.2812			98.7566		60.091
"2012-07-23"	106.812			78.8137		76.1181
"2012-08-06"	98.8931			68.028		67.0282
"2012-08-20"	81.2889			64.0033		58.9723
"2012-09-03"	97.6001			73.4868		64.2404
"2012-09-17"				79.8471		68.9743
"2012-10-01"				75.6195		66.6569
"2012-10-15"				60.4909		59.4116
"2012-10-29"				76.2034		60.7136
"2012-11-12"				51.8174		46.0817
"2012-11-26"				91.786		87.2726
"2012-12-10"				69.3033		54.5673
"2012-12-24"				95.2767		94.535
"2013-01-07"						66.0259
"2013-01-21"						46.1013
"2013-02-04"						51.2419
"2013-02-18"						44.9151
"2013-03-04"						65.2624
"2013-03-18"						53.0524
"2013-04-01"						
"2013-04-15"						
"2013-04-29"						
"2013-05-13"						
"2013-05-27"						
"2013-06-10"						
"2013-06-24"						
"2013-07-08"						
"2013-07-22"						
"2013-08-05"						
"2013-08-19"						
"2013-09-02"						
"2013-09-16"						
"2013-09-30"						
"2013-10-14"						
"2013-10-28"						
"2013-11-11"						
"2013-11-25"						
"2013-12-09"						
"2013-12-23"						
-------------- next part --------------
A non-text attachment was scrubbed...
Name: R-Script.R
Type: application/octet-stream
Size: 1180 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20141110/b038f66e/attachment.obj>

From hengl at spatial-analyst.net  Mon Nov 10 11:01:38 2014
From: hengl at spatial-analyst.net (Tomislav Hengl)
Date: Mon, 10 Nov 2014 18:01:38 +0800
Subject: [R-sig-Geo] plotKML kml_layer.Raster problem
In-Reply-To: <CAJPy8YUFh2425cBUkdCu3q81PmtE6POUrXpKvJQ7pXn=YKWK0w@mail.gmail.com>
References: <CAJPy8YXfgejRSVEMXfgxUQvixH3w4NROaLbJPJQ01m54r967Hg@mail.gmail.com>	<B078CDF40DFE4045AF172A8B4F68FC4857C9BA33B8@DKRDSEXC016.vestas.net>
	<CAJPy8YUFh2425cBUkdCu3q81PmtE6POUrXpKvJQ7pXn=YKWK0w@mail.gmail.com>
Message-ID: <54608D02.5020700@spatial-analyst.net>


The argument "colour" is reserved for the target variable (name, 
function/call or vector). plotKML allows users to visualize multiple 
variables using different aesthetics 
(http://plotkml.r-forge.r-project.org/aesthetics.html), so in your case 
this would be "colour = layer, colour_scale = e.cRampPalette(255)", 
although it might take you few iterations until you get the right legend 
/ PNG output.

To learn how to use lower level functions such as kml_layer.Raster maybe 
first study the package vignette 
(http://cran.r-project.org/web/packages/plotKML/vignettes/jss1079.pdf) 
and/or the package tutorial 
(http://gsif.isric.org/doku.php?id=wiki:tutorial_plotkml).

Sorry for some confusion between "colour" and "colour_scale".

T. Hengl


On 8-11-2014 1:12, Andreas Gros wrote:
> Hi Frede,
>
> This is the test case (using just values of 1): (traceback() below)
>
> pheight = 100
> pwidth = 200
>
>> raster_layer <- raster(ncols=pwidth, nrows=pheight,
> +                        xmn=xmin(r.ex), xmx=xmax(r.ex),
> +                        ymn=ymin(r.ex), ymx=ymax(r.ex),
> +                        crs=CRS(projection(bigraster)))
>> values(raster_layer) <- rep(1, pwidth*pheight)
>
>
>> kml_open(file.name="test.kml",
> +   folder.name='top_folder',
> +   kml_visibility=TRUE)
> KML file opened for writing...
>> kml_layer.Raster(raster_layer, folder.name='raster_sub_folder',
> +   plot.legend=TRUE,
> +   metadata=NULL,
> +   colour=e.cRampPalette(255),
> +   raster_name='raster_layer',
> +   layer.name=names(raster_layer)[1],
> +   png.width=1000,
> +   png.height=833
> + )
>
> Error in setValues(x, value) :
>    values must be numeric, integer, logical or factor
>
>> kml_close(file.name="test.kml")
>
> Closing  test.kml
>
> Traceback:
> traceback()
> 6: stop("values must be numeric, integer, logical or factor")
> 5: setValues(x, value)
> 4: setValues(x, value)
> 3: `values<-`(`*tmp*`, value = c("#000000", "#010101", "#020202",
>     "#030303", "#040404", "#060606", "#070707", "#080808", "#090909",
>     "#0A0A0A", "#0C0C0C", "#0D0D0D", "#0E0E0E", "#0F0F0F", "#0F0F0F",
>     "#101010", "#111111", "#121212", "#131313", "#141414", "#141414",
>     "#151515", "#161616", "#161616", "#171717", "#181818", "#181818",
>     "#191919", "#1A1A1A", "#1A1A1A", "#1B1B1B", "#1C1C1C", "#1C1C1C",
>     "#1D1D1D", "#1E1E1E", "#1E1E1E", "#1F1F1F", "#202020", "#202020",
>     "#212121", "#222222", "#222222", "#232323", "#242424", "#242424",
>     "#252525", "#262626", "#272727", "#272727", "#282828", "#292929",
>     "#292929", "#2A2A2A", "#2B2B2B", "#2B2B2B", "#2C2C2C", "#2D2D2D",
>     "#2E2E2E", "#2E2E2E", "#2F2F2F", "#303030", "#303030", "#313131",
>     "#323232", "#333333", "#333333", "#343434", "#353535", "#363636",
>     "#363636", "#373737", "#383838", "#383838", "#393939", "#3A3A3A",
>     "#3B3B3B", "#3B3B3B", "#3C3C3C", "#3D3D3D", "#3E3E3E", "#3E3E3E",
>
> ...
>
>     ))
>
> 2: `values<-`(`*tmp*`, value = c("#000000", "#010101", "#020202",
>     "#030303", "#040404", "#060606", "#070707", "#080808", "#090909",
>     "#0A0A0A", "#0C0C0C", "#0D0D0D", "#0E0E0E", "#0F0F0F", "#0F0F0F",
>     "#101010", "#111111", "#121212", "#131313", "#141414", "#141414",
>     "#151515", "#161616", "#161616", "#171717", "#181818", "#181818",
>     "#565656", "#575757", "#585858", "#595959", "#5A5A5A", "#5A5A5A",
> ...
>
>   ))
>
> 1: kml_layer.Raster(raster_layer, folder.name = "raster_sub_folder",
>         plot.legend = TRUE, metadata = NULL, colour = e.cRampPalette(255),
>         raster_name = "raster_layer", layer.name = names(raster_layer)[1],
>         png.width = 1000, png.height = 833)
>
>
> And when I'm trying to use colour_scheme I'm gettiing an error that lets me
> assume that kml_layer.Raster is not compatible with 'raster':
>
> kml_open(file.name="test.kml",
> +   folder.name='top_folder',
> +   kml_visibility=TRUE)
> KML file opened for writing...
>> kml_layer.Raster(raster_layer, folder.name='raster_sub_folder',
> +   plot.legend=TRUE,
> +   metadata=NULL,
> +   colour_scheme=e.cRampPalette(255),
> +   raster_name='raster_layer',
> +   layer.name=names(raster_layer)[1],
> +   png.width=1000,
> +   png.height=833
> + )
>
> Error in is.factor(obj at data[, 1]) :
>    error in evaluating the argument 'x' in selecting a method for function
> 'is.factor': Error in obj at data[, 1] : object of type 'S4' is not subsettable
>
>> kml_close(file.name="test.kml")
> Closing  test.kml
>
>> traceback()
> 2: is.factor(obj at data[, 1])
> 1: kml_layer.Raster(raster_layer, folder.name = "raster_sub_folder",
>         plot.legend = TRUE, metadata = NULL, colour_scheme =
> e.cRampPalette(255),
>         raster_name = "raster_layer", layer.name = names(raster_layer)[1],
>         png.width = 1000, png.height = 833)
>
> On Thu, Nov 6, 2014 at 10:52 PM, Frede Aakmann T?gersen <frtog at vestas.com>
> wrote:
>
>> Hi Andreas
>>
>> Can you provide a small example showing the details of what you're trying
>> to do. I don't think that anyone can help you with the little information
>> you have given.
>>
>> If you do not have any example please show us the output from traceback()
>> immediately after the error.
>>
>> I don't think this has anything to do with NA's in your data values as I
>> don't get any errors doing this (from man of kml_layer.Raster):
>>
>>
>> data(eberg_grid)
>> library(sp)
>> coordinates(eberg_grid) <- ~x+y
>> gridded(eberg_grid) <- TRUE
>> proj4string(eberg_grid) <- CRS("+init=epsg:31467")
>> data(SAGA_pal)
>> library(raster)
>> r <- raster(eberg_grid["TWISRT6"])
>>
>> ## Put some NA's into data
>> r at data@values[1:10] <- NA
>>
>> kml(r, colour_scale = SAGA_pal[[1]], colour = TWISRT6)
>>
>>
>>
>>
>> Yours sincerely / Med venlig hilsen
>>
>>
>> Frede Aakmann T?gersen
>> Specialist, M.Sc., Ph.D.
>> Plant Performance & Modeling
>>
>> Technology & Service Solutions
>> T +45 9730 5135
>> M +45 2547 6050
>> frtog at vestas.com
>> http://www.vestas.com
>>
>> Company reg. name: Vestas Wind Systems A/S
>> This e-mail is subject to our e-mail disclaimer statement.
>> Please refer to www.vestas.com/legal/notice
>> If you have received this e-mail in error please contact the sender.
>>
>>
>>> -----Original Message-----
>>> From: r-sig-geo-bounces at r-project.org [mailto:r-sig-geo-bounces at r-
>>> project.org] On Behalf Of Andreas Gros
>>> Sent: 6. november 2014 23:47
>>> To: r-sig-geo at r-project.org
>>> Subject: [R-sig-Geo] plotKML kml_layer.Raster problem
>>>
>>> In version 0.4-6 of plotKML, when I'm adding a kml_layer.Raster (single
>>> layer, no stack/brick) to a kml file, I get the following error message:
>>>
>>> Error in setValues(x, value) :
>>> values must be numeric, integer, logical or factor
>>>
>>>
>>> The values in the raster range between -57 and 2000 and it also occurs
>> if I
>>> replace NA values first with some arbitrary numerical value.
>>> Has anyone come across this problem and knows how to fix/circumnavigate
>>> it?
>>>
>>> Thanks!
>>>
>>>        [[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From shamsman87 at yahoo.com  Sat Nov  8 08:13:56 2014
From: shamsman87 at yahoo.com (shamsman87 at yahoo.com)
Date: Fri, 7 Nov 2014 23:13:56 -0800
Subject: [R-sig-Geo] A request
Message-ID: <1415430836.44717.YahooMailNeo@web122901.mail.ne1.yahoo.com>

Dear all 
Hi 
I hope you are well, I am Mansour ,Ph.D student of epidemiology in
Tehran university of medical sciences , with the help of some biostatistician,We are going to a run spatio-temporal model on
air pollution data . We are using the SpatioTemporal package.  
(http://cran.r-project.org/web/packages/SpatioTemporal/vignettes/ST_tutorial.pdf). 
we run it, but in estimation part we come across below error (highlighted
) that we cannot fixed it.  
>
est.EBOD.model <- estimate(EBOD.model, x.init, type="f",
hessian.all=TRUE)
Optimisation
using starting value 1/2
N = 13, M = 5
machine precision = 2.22045e-16
The initial X
is infeasible.  Restart with its
projection.
At X0, 2
variables are exactly at the bounds
At
iterate     0  f=        94332  |proj g|=           15
At
iterate    10  f =        12862  |proj g|=        6.1852
At
iterate    20  f =        12861  |proj g|=        1.8072
At
iterate    30  f =        12848  |proj g|=        2.0701
At
iterate    40  f =        12848  |proj g|=       0.40681
 
iterations 41
function
evaluations 54
segments
explored during Cauchy searches 47
BFGS updates
skipped 0
active bounds
at final generalized Cauchy point 2
norm of the
final projected gradient 0.0924766
final function
value 12847.5
 
F = 12847.5
final  value 12847.531525 
converged
 
Error in diag(solve(res[[i]]$hessian)) : 
  error in
evaluating the argument 'x' in selecting a method for function 'diag': Error in
solve.default(res[[i]]$hessian) : 
  Lapack
routine dgesv: system is exactly singular: U[4,4] = 0
I attached our script,
output and sample of data which we used.  The error above seems simple but we can't find
how it occurs. Any help you can give would be greatly appreciated. 
 
Best 
Mansour 
 
 
 
Best Regards, 
Mansour Shamsipour 
Ph.D Candidate in Epidemiology 
Tehran University of Medical Science,(TUMS)  
Mobile: (+98-914) 939 2486 
021-55460184
	[[alternative HTML version deleted]]


From ilyass.mbasso at gmail.com  Mon Nov 10 12:14:17 2014
From: ilyass.mbasso at gmail.com (MBASSO Ilyass)
Date: Mon, 10 Nov 2014 15:14:17 +0400
Subject: [R-sig-Geo] Dispatch point on a map
Message-ID: <CAF_jj6pM-90EamTKG9VsXAGY9mJThg-HM3nTqzNHQJ+Te0Dufg@mail.gmail.com>

Dear,

I have a question regarding using R in order to dispatch a group of points
in a map in order to cover the all map.
Each point have a buffer around (Drive time), representing the zone covered
by each point.
I would like to know if R can bring a solution to that problem, and if Yes
if someone can support to answer this issue.

Best Regards.
-- 
Ilyass MBASSO
Ing?nieur d'?tat Sciences de l'Information G?ographique "*SIG*"
Ecole Hassania des Travaux Publics
T?l : 06 62 62 09 87

	[[alternative HTML version deleted]]


From diamant.zebrat at gmail.com  Mon Nov 10 13:38:57 2014
From: diamant.zebrat at gmail.com (diamant zebrat)
Date: Mon, 10 Nov 2014 12:38:57 +0000
Subject: [R-sig-Geo] WriteRaster as Float
Message-ID: <CAPPfxyv0-d=OxigW=CSvnh7r3tbTPByAtpWHArp0s-gdA7RbPQ@mail.gmail.com>

Hello,
I am working with R processing Meteosat imagery, which mean a lot of images
every day, and thus a lot of available storage space
It looks like the write raster function of the raster package only allows
to write a Geotiff as integer or as double. I only need float precision, so
I don't need a double as the resulting file gets too big. Is there any way
to store a geotiff with float precision?
Thank you
Zebrat

	[[alternative HTML version deleted]]


From r.turner at auckland.ac.nz  Mon Nov 10 19:23:58 2014
From: r.turner at auckland.ac.nz (Rolf Turner)
Date: Tue, 11 Nov 2014 07:23:58 +1300
Subject: [R-sig-Geo] Dispatch point on a map
In-Reply-To: <CAF_jj6pM-90EamTKG9VsXAGY9mJThg-HM3nTqzNHQJ+Te0Dufg@mail.gmail.com>
References: <CAF_jj6pM-90EamTKG9VsXAGY9mJThg-HM3nTqzNHQJ+Te0Dufg@mail.gmail.com>
Message-ID: <546102BE.4000203@auckland.ac.nz>

On 11/11/14 00:14, MBASSO Ilyass wrote:
> Dear,
>
> I have a question regarding using R in order to dispatch a group of points
> in a map in order to cover the all map.
> Each point have a buffer around (Drive time), representing the zone covered
> by each point.
> I would like to know if R can bring a solution to that problem, and if Yes
> if someone can support to answer this issue.

It sounds like what you want is a hard core point process.  Check out 
the function rSSI() (random simple sequential inhibition) from the 
spatstat package; also look at the function rmh() from that package (use 
cif="hardcore" in the model specification).

cheers,

Rolf Turner

-- 
Rolf Turner
Technical Editor ANZJS


From rotundo.jose at gmail.com  Mon Nov 10 19:37:26 2014
From: rotundo.jose at gmail.com (=?UTF-8?Q?Jos=C3=A9_Luis_Rotundo?=)
Date: Mon, 10 Nov 2014 15:37:26 -0300
Subject: [R-sig-Geo] Rainbow color for kriged map
Message-ID: <CADBY2ppbam0_GnNxkoP2GPyw5BwscyJZ-o=JSV-4HMyvk8_Z4A@mail.gmail.com>

Dear List,

I am trying to modify the starting or ending color in Rainbow color
function because the first (red) and last (magenta) colors are very
similar. Ideally, I would like to start in orange or drop the magenta at
the end.

I tried modifying the start and end arguments, but the colors do not
change.

Here is part of the script:

brks.eq = classIntervals(ipl$"var1.pred", n = 12, style = "fixed",
FixedBreaks=c(30,31,32,32.5,33,33.5,34,34.5,35,35.5,36,37,38))
rainbow(12, s = 0, v = 0, start = 1, end = max(1, 12 - 1)/12, alpha = 1)
spplot(ipl, "var1.pred", at=brks.eq$brks, col.regions=rainbow,
col="transparent", colorkey = T, sp.layout = combine.layout, main="2006")

Any help would be appreciated.

Thanks a lot in advance.

Jose


-- 


Jos? L. Rotundo
CONICET
Facultad de Ciencias Agrarias
Univ. Nacional de Rosario
Zavalla, Santa Fe
Argentina

	[[alternative HTML version deleted]]


From thiagoclsilveira at yahoo.com.br  Mon Nov 10 19:43:46 2014
From: thiagoclsilveira at yahoo.com.br (Thiago Cesar Lima Silveira)
Date: Mon, 10 Nov 2014 16:43:46 -0200
Subject: [R-sig-Geo] Predict GAM model with categorical predictors
Message-ID: <520F8CDB-03A8-49A2-82A2-12139018D430@yahoo.com.br>

Hi,

I'm experiencing some problems to predict a 
gam model with factor as predictor to raster stack. 

I wrote an example code to illustrate the problem.

This is the error message when I try to predict with a model with factors:


'Error in `[.data.frame`(blockvals, , f[j]) : undefined columns selected

I home someone could help.

Thanks.

Thiago

___________________________________
Thiago Cesar Lima Silveira
Biologist - MSc. Zoology 
PhD candidate - Zoology PUCRS
e-mail: thiago.cesar at acad.pucrs.br
Skype: thiagocesarls
CV: http://lattes.cnpq.br/5960267776845701 <http://lattes.cnpq.br/5960267776845701>



#####
library(mgcv)
library(raster)

#raster example
v1rst<-raster()
values(v1rst) <- 1:ncell(v1rst)
names(v1rst)<-'v1'

# Example of response variable and predictors
y<-c(1,33,500,700, 334,320, 703,303,3030,3002,200,0,100,100,169)
v1<-c(12,33,544,600, 34,30, 03,3390,3030,302,20,108,170,101,2009)
v2<-c(0,0,0,0,0,0,0,0,1,1,1,1,1,1,1)
v3<-c(12,33,544,600, 34,30, 03,3390,3030,302,20,108,170,101,2009)
df<-data.frame(y, v1, v2)

#GAM model with factor
gam1<-gam(y~s(v1)+factor(v2), data=df)
summary(gam1)

#GAM model without factor
gam2<-gam(y~s(v1), data=df)
summary(gam2)

# data.frame with a constant value 
#(of class ?factor?) to pass that on to the predict function.
Method<-factor(var.factor<-factor( '0' ,levels=levels(df$v2))) 
add<-data.frame(var.factor)

trat<- c(0,1)
trat.list<-list(trat)
              
#Prediction with factor
   p<-predict(v1rst,gam1, type='response', factors='trat.list' )
              
#This is the error 'Error in `[.data.frame`(blockvals, , f[j]) : undefined columns selected
              
#Prediction without factor
p<-predict(v1rst,gam2, type='response')
plot(p)
              













	[[alternative HTML version deleted]]


From paulojus at c3sl.ufpr.br  Mon Nov 10 19:59:20 2014
From: paulojus at c3sl.ufpr.br (Paulo Justiniano Ribeiro Jr)
Date: Mon, 10 Nov 2014 16:59:20 -0200 (BRST)
Subject: [R-sig-Geo] Rainbow color for kriged map
In-Reply-To: <CADBY2ppbam0_GnNxkoP2GPyw5BwscyJZ-o=JSV-4HMyvk8_Z4A@mail.gmail.com>
References: <CADBY2ppbam0_GnNxkoP2GPyw5BwscyJZ-o=JSV-4HMyvk8_Z4A@mail.gmail.com>
Message-ID: <alpine.DEB.2.10.1411101658410.4663@macalan.c3sl.ufpr.br>

I would instead consider using the package RColorBrewer and
build your own palette



Paulo Justiniano Ribeiro Jr
LEG (Laboratorio de Estatistica e Geoinformacao)
Universidade Federal do Parana
Caixa Postal 19.081
CEP 81.531-990
Curitiba, PR  -  Brasil
Tel: (+55) 41 3361 3573
VOIP: (+55) (41) (3361 3600) 1053 1066
Fax: (+55) 41 3361 3141
e-mail: paulojus AT  ufpr  br
http://www.leg.ufpr.br/~paulojus

On Mon, 10 Nov 2014, Jos? Luis Rotundo wrote:

> Dear List,
>
> I am trying to modify the starting or ending color in Rainbow color
> function because the first (red) and last (magenta) colors are very
> similar. Ideally, I would like to start in orange or drop the magenta at
> the end.
>
> I tried modifying the start and end arguments, but the colors do not
> change.
>
> Here is part of the script:
>
> brks.eq = classIntervals(ipl$"var1.pred", n = 12, style = "fixed",
> FixedBreaks=c(30,31,32,32.5,33,33.5,34,34.5,35,35.5,36,37,38))
> rainbow(12, s = 0, v = 0, start = 1, end = max(1, 12 - 1)/12, alpha = 1)
> spplot(ipl, "var1.pred", at=brks.eq$brks, col.regions=rainbow,
> col="transparent", colorkey = T, sp.layout = combine.layout, main="2006")
>
> Any help would be appreciated.
>
> Thanks a lot in advance.
>
> Jose
>
>
> -- 
>
>
> Jos? L. Rotundo
> CONICET
> Facultad de Ciencias Agrarias
> Univ. Nacional de Rosario
> Zavalla, Santa Fe
> Argentina
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

From thiagoclsilveira at yahoo.com.br  Mon Nov 10 20:18:46 2014
From: thiagoclsilveira at yahoo.com.br (Thiago Cesar Lima Silveira)
Date: Mon, 10 Nov 2014 17:18:46 -0200
Subject: [R-sig-Geo] Predict GAM model with categorical predictors
In-Reply-To: <520F8CDB-03A8-49A2-82A2-12139018D430@yahoo.com.br>
References: <520F8CDB-03A8-49A2-82A2-12139018D430@yahoo.com.br>
Message-ID: <91B8CFE1-8F95-4724-B999-B92E4EA1D0E4@yahoo.com.br>


## Disregard the code sent before, this is the right

Hi,

I'm experiencing some problems to predict a 
gam model with factor as predictor to raster stack. 

I wrote an example code to illustrate the problem.

This is the error message when I try to predict with a model with factors:


'Error in `[.data.frame`(blockvals, , f[j]) : undefined columns selected

I home someone could help.

Thanks.

Thiago

___________________________________
Thiago Cesar Lima Silveira
Biologist - MSc. Zoology 
PhD candidate - Zoology PUCRS
e-mail: thiago.cesar at acad.pucrs.br <mailto:thiago.cesar at acad.pucrs.br>
Skype: thiagocesarls
CV: http://lattes.cnpq.br/5960267776845701 <http://lattes.cnpq.br/5960267776845701>



#####
library(mgcv)
library(raster)

#raster example
v1rst<-raster()
values(v1rst) <- 1:ncell(v1rst)
names(v1rst)<-'v1'

# Example of response variable and predictors
y<-c(1,33,500,700, 334,320, 703,303,3030,3002,200,0,100,100,169)
v1<-c(12,33,544,600, 34,30, 03,3390,3030,302,20,108,170,101,2009)
v2<-c(0,0,0,0,0,0,0,0,1,1,1,1,1,1,1)
v3<-c(12,33,544,600, 34,30, 03,3390,3030,302,20,108,170,101,2009)
df<-data.frame(y, v1, v2)

#GAM model with factor
gam1<-gam(y~s(v1)+factor(v2), data=df)
summary(gam1)

#GAM model without factor
gam2<-gam(y~s(v1), data=df)
summary(gam2)

# data.frame with a constant value 
#(of class ?factor?) to pass that on to the predict function.
Method<-factor( '0' ,levels=levels(df$v2))) 
add<-data.frame(Method)

#Prediction with factor
   p<-predict(v1rst,gam1, type='response', const=add )
              
#This is the error 'Error in `[.data.frame`(blockvals, , f[j]) : undefined columns selected
              
#Prediction without factor
p<-predict(v1rst,gam2, type='response')
plot(p)


	[[alternative HTML version deleted]]


From tephilippi at gmail.com  Tue Nov 11 05:32:32 2014
From: tephilippi at gmail.com (Tom Philippi)
Date: Mon, 10 Nov 2014 20:32:32 -0800
Subject: [R-sig-Geo] WriteRaster as Float
In-Reply-To: <CAPPfxyv0-d=OxigW=CSvnh7r3tbTPByAtpWHArp0s-gdA7RbPQ@mail.gmail.com>
References: <CAPPfxyv0-d=OxigW=CSvnh7r3tbTPByAtpWHArp0s-gdA7RbPQ@mail.gmail.com>
Message-ID: <CALyPt8z3DN0taprsV7j3WeefaGbx0Ej74sh08D5WUaBpvFQXRQ@mail.gmail.com>

Zebrat--
Without example code it is difficult to guess what you tried, and what you
desire.  By "float" do you mean FLT4S 4-byte values?  If so, try
datatype='FLT4S' in your call to writeRaster(), which should be the same as
'Float32' in gdal.  If you mean something else, I guessed wrong, so you
might specify a bit more about what you have, want, and have tried.

Tom 2

On Mon, Nov 10, 2014 at 4:38 AM, diamant zebrat <diamant.zebrat at gmail.com>
wrote:

> Hello,
> I am working with R processing Meteosat imagery, which mean a lot of images
> every day, and thus a lot of available storage space
> It looks like the write raster function of the raster package only allows
> to write a Geotiff as integer or as double. I only need float precision, so
> I don't need a double as the resulting file gets too big. Is there any way
> to store a geotiff with float precision?
> Thank you
> Zebrat
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From rehe0001 at stud.slu.se  Tue Nov 11 10:09:18 2014
From: rehe0001 at stud.slu.se (Rebecka)
Date: Tue, 11 Nov 2014 02:09:18 -0700 (MST)
Subject: [R-sig-Geo] gIntersection for several polygons
Message-ID: <1415696958276-7587418.post@n2.nabble.com>

Hi!

I?m a beginner with R and I?m trying to calculate area of polygons
(homerange areas of 31 individuals) intersecting with bufferzones around
4348 number of windfarms. I have read this webpage as a help:
http://rstudio-pubs-static.s3.amazonaws.com/7993_6b081819ba184047802a508a7f3187cb.html

I?ve succeeded to create bufferzones with gBuffer. Now I would like to do
gIntersection for every individuals homerange overlap with bufferzones. I?ve
tried to create homeranges as a first step using gConvexHull but I don?t
understand how to this by each id for every individual. I have a
spatialpointsdataframe with one column called "Object_ID" and also columns
"x" and "y" for coordinates and every row corresponds to one position. Every
individual have a lot of coordinates (all individuals have over 94000
positions together).

Is it possible to create one homerange for every individual using
gConvexHull? byid=TRUE just do it for every row when I tried.

I also tried to go around the problem creating mcp (packageadehabitatHR) for
every individual. 
mcpAll<-mcp(animalSpdf[,2]) *gives Spatialpolygons*

Then I tried to use that in gIntersection
inter1<-gIntersection(mcpAll,Prop1,byid=TRUE) *Prop1 is my windfarms with
bufferzones*
but it only gave a NULL result for inter1. CRS are same for both and I know
that they should overlap. 

Any ideas how to solve this?

Thanks!!

Rebecka Hedfors




--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/gIntersection-for-several-polygons-tp7587418.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From diamant.zebrat at gmail.com  Tue Nov 11 10:12:33 2014
From: diamant.zebrat at gmail.com (diamant zebrat)
Date: Tue, 11 Nov 2014 09:12:33 +0000
Subject: [R-sig-Geo] WriteRaster as Float
In-Reply-To: <CALyPt8z3DN0taprsV7j3WeefaGbx0Ej74sh08D5WUaBpvFQXRQ@mail.gmail.com>
References: <CAPPfxyv0-d=OxigW=CSvnh7r3tbTPByAtpWHArp0s-gdA7RbPQ@mail.gmail.com>
	<CALyPt8z3DN0taprsV7j3WeefaGbx0Ej74sh08D5WUaBpvFQXRQ@mail.gmail.com>
Message-ID: <CAPPfxyuWaQZ9CK9q936f8xRS5ACU+3pK29GCKiM19iiLn8XjPw@mail.gmail.com>

Tom, here goes the details
The Meteosat images are composed by a matrix of pixels with values of
surface temperature (or cloud top temperature) in Kelvin, which means
values like 273.15
I wanted to keep the decimals, thus I need a FLT4S 4-byte values. When using
writeRaster(TTemp,filename=nom,format="GTiff",overwrite=T,datatype="FLT4S")
I get a file with a size of 7.495.158 bytes.  My particular image is a
matrix of 1201 lines x 803 columns = 964.403 pixels,
with this option (datatype="FLT4S") it looks like we get an image that uses
8 bytes to store each pixel. In fact, we only need 4 bytes (float) to store
values like 273.15, thus I am getting images which are too big. Keep in
mind there is a Meteosat image each 15 min -> 96 a day, etc. These means a
lot of storage space and I should care about it
When opening one of these GEOTIFF (LTS4S) with a GIS package, it get an
image that is "double precision", confirming that the writeRaster is using
8 bytes to store each pixel when creating the GEOTIFF with the
datatype="FLT4S" option
The conclusion is that the writeRaster routine is not optimized to use the
minimum space when writing a geotiff
The only alternative by now is to multiply my kelvins by ten and save it as
an integer, this way I only keep one decimal but I get small size files
writeRaster(TTemp,filename=nom,format="GTiff",overwrite=T,datatype="INT1U")
However, I still want to keep the real values using 4 byte for each pixel...
thank you
Zebrat

2014-11-11 4:32 GMT+00:00 Tom Philippi <tephilippi at gmail.com>:

> Zebrat--
> Without example code it is difficult to guess what you tried, and what you
> desire.  By "float" do you mean FLT4S 4-byte values?  If so, try
> datatype='FLT4S' in your call to writeRaster(), which should be the same as
> 'Float32' in gdal.  If you mean something else, I guessed wrong, so you
> might specify a bit more about what you have, want, and have tried.
>
> Tom 2
>
> On Mon, Nov 10, 2014 at 4:38 AM, diamant zebrat <diamant.zebrat at gmail.com>
> wrote:
>
>> Hello,
>> I am working with R processing Meteosat imagery, which mean a lot of
>> images
>> every day, and thus a lot of available storage space
>> It looks like the write raster function of the raster package only allows
>> to write a Geotiff as integer or as double. I only need float precision,
>> so
>> I don't need a double as the resulting file gets too big. Is there any way
>> to store a geotiff with float precision?
>> Thank you
>> Zebrat
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>

	[[alternative HTML version deleted]]


From loic.dutrieux at wur.nl  Tue Nov 11 14:02:53 2014
From: loic.dutrieux at wur.nl (Dutrieux, Loic)
Date: Tue, 11 Nov 2014 13:02:53 +0000
Subject: [R-sig-Geo] WriteRaster as Float
In-Reply-To: <CAPPfxyuWaQZ9CK9q936f8xRS5ACU+3pK29GCKiM19iiLn8XjPw@mail.gmail.com>
References: <CAPPfxyv0-d=OxigW=CSvnh7r3tbTPByAtpWHArp0s-gdA7RbPQ@mail.gmail.com>
	<CALyPt8z3DN0taprsV7j3WeefaGbx0Ej74sh08D5WUaBpvFQXRQ@mail.gmail.com>
	<CAPPfxyuWaQZ9CK9q936f8xRS5ACU+3pK29GCKiM19iiLn8XjPw@mail.gmail.com>
Message-ID: <A83620D4CC4762448EFB789FD6E9BBB742B850AE@SCOMP0937.wurnet.nl>

Hello Zebrat,

The datatype= argument appears to work well on my system. See if you can reproduce the example below:

library(raster)
r <- raster(system.file("external/test.grd", package="raster"))

writeRaster(r, filename = 'rasterDefault.tif')
GDALinfo('rasterDefault.tif')
# By default raster writes to Float64

writeRaster(r, filename = 'rasterFloatSingle.tif', datatype = 'FLT4S')
GDALinfo('rasterFloatSingle.tif')
# Float 32

Make sure you do not capitalize the "t" in datatype. datatype is the writeRaster() argument and dataType is the function to retrieve data type.

Cheers,
Lo?c

-----Original Message-----
From: r-sig-geo-bounces at r-project.org [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of diamant zebrat
Sent: Tuesday, November 11, 2014 10:13
To: Tom Philippi
Cc: r-sig-geo
Subject: Re: [R-sig-Geo] WriteRaster as Float

Tom, here goes the details
The Meteosat images are composed by a matrix of pixels with values of surface temperature (or cloud top temperature) in Kelvin, which means values like 273.15 I wanted to keep the decimals, thus I need a FLT4S 4-byte values. When using
writeRaster(TTemp,filename=nom,format="GTiff",overwrite=T,datatype="FLT4S")
I get a file with a size of 7.495.158 bytes.  My particular image is a matrix of 1201 lines x 803 columns = 964.403 pixels, with this option (datatype="FLT4S") it looks like we get an image that uses
8 bytes to store each pixel. In fact, we only need 4 bytes (float) to store values like 273.15, thus I am getting images which are too big. Keep in mind there is a Meteosat image each 15 min -> 96 a day, etc. These means a lot of storage space and I should care about it When opening one of these GEOTIFF (LTS4S) with a GIS package, it get an image that is "double precision", confirming that the writeRaster is using
8 bytes to store each pixel when creating the GEOTIFF with the datatype="FLT4S" option The conclusion is that the writeRaster routine is not optimized to use the minimum space when writing a geotiff The only alternative by now is to multiply my kelvins by ten and save it as an integer, this way I only keep one decimal but I get small size files
writeRaster(TTemp,filename=nom,format="GTiff",overwrite=T,datatype="INT1U")
However, I still want to keep the real values using 4 byte for each pixel...
thank you
Zebrat

2014-11-11 4:32 GMT+00:00 Tom Philippi <tephilippi at gmail.com>:

> Zebrat--
> Without example code it is difficult to guess what you tried, and what 
> you desire.  By "float" do you mean FLT4S 4-byte values?  If so, try 
> datatype='FLT4S' in your call to writeRaster(), which should be the 
> same as 'Float32' in gdal.  If you mean something else, I guessed 
> wrong, so you might specify a bit more about what you have, want, and have tried.
>
> Tom 2
>
> On Mon, Nov 10, 2014 at 4:38 AM, diamant zebrat 
> <diamant.zebrat at gmail.com>
> wrote:
>
>> Hello,
>> I am working with R processing Meteosat imagery, which mean a lot of 
>> images every day, and thus a lot of available storage space It looks 
>> like the write raster function of the raster package only allows to 
>> write a Geotiff as integer or as double. I only need float precision, 
>> so I don't need a double as the resulting file gets too big. Is there 
>> any way to store a geotiff with float precision?
>> Thank you
>> Zebrat
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>

	[[alternative HTML version deleted]]

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From dhyeybhatpuria at gmail.com  Tue Nov 11 16:57:14 2014
From: dhyeybhatpuria at gmail.com (Dhyey Bhatpuria)
Date: Tue, 11 Nov 2014 21:27:14 +0530
Subject: [R-sig-Geo] Predict GAM model with categorical predictors
Message-ID: <CAC7AcGQfNfrn=jO8-MXRWeN7+RgGGZa5i9bA9uKGTkOOcqMABQ@mail.gmail.com>

Dear Thiago,
Your prediction raster (here v1rst) should contain three layers/bands with
each named exactly as your predictors (here v1 and v2). Currently it
contains just one raster layer. I would suggest to prepare layers and then
create a raster brick.

Regards,
Dhyey

-- 

Dhyey Bhatpuria,
Research Fellow,
Space Applications Centre, ISRO,
Ahmedabad, India

-----------------------------

Message: 5
Date: Mon, 10 Nov 2014 16:43:46 -0200
From: Thiago Cesar Lima Silveira <thiagoclsilveira at yahoo.com.br
>
To: r-sig-geo at r-project.org
Subject: [R-sig-Geo] Predict GAM model with categorical predictors
Message-ID: <520F8CDB-03A8-49A2-82A2-12139018D430 at yahoo.com.br>
Content-Type: text/plain; charset="UTF-8"

Hi,

I'm experiencing some problems to predict a
gam model with factor as predictor to raster stack.

I wrote an example code to illustrate the problem.

This is the error message when I try to predict with a model with factors:


'Error in `[.data.frame`(blockvals, , f[j]) : undefined columns selected

I home someone could help.

Thanks.

Thiago

___________________________________
Thiago Cesar Lima Silveira
Biologist - MSc. Zoology
PhD candidate - Zoology PUCRS
e-mail: thiago.cesar at acad.pucrs.br
Skype: thiagocesarls
CV: http://lattes.cnpq.br/5960267776845701 <
http://lattes.cnpq.br/5960267776845701>



#####
library(mgcv)
library(raster)

#raster example
v1rst<-raster()
values(v1rst) <- 1:ncell(v1rst)
names(v1rst)<-'v1'

# Example of response variable and predictors
y<-c(1,33,500,700, 334,320, 703,303,3030,3002,200,0,100,100,169)
v1<-c(12,33,544,600, 34,30, 03,3390,3030,302,20,108,170,101,2009)
v2<-c(0,0,0,0,0,0,0,0,1,1,1,1,1,1,1)
v3<-c(12,33,544,600, 34,30, 03,3390,3030,302,20,108,170,101,2009)
df<-data.frame(y, v1, v2)

#GAM model with factor
gam1<-gam(y~s(v1)+factor(v2), data=df)
summary(gam1)

#GAM model without factor
gam2<-gam(y~s(v1), data=df)
summary(gam2)

# data.frame with a constant value
#(of class ?factor?) to pass that on to the predict function.
Method<-factor(var.factor<-factor( '0' ,levels=levels(df$v2)))
add<-data.frame(var.factor)

trat<- c(0,1)
trat.list<-list(trat)

#Prediction with factor
   p<-predict(v1rst,gam1, type='response', factors='trat.list' )

#This is the error 'Error in `[.data.frame`(blockvals, , f[j]) : undefined
columns selected

#Prediction without factor
p<-predict(v1rst,gam2, type='response')
plot(p)

	[[alternative HTML version deleted]]


From tephilippi at gmail.com  Tue Nov 11 18:41:15 2014
From: tephilippi at gmail.com (Tom Philippi)
Date: Tue, 11 Nov 2014 09:41:15 -0800
Subject: [R-sig-Geo] WriteRaster as Float
In-Reply-To: <A83620D4CC4762448EFB789FD6E9BBB742B850AE@SCOMP0937.wurnet.nl>
References: <CAPPfxyv0-d=OxigW=CSvnh7r3tbTPByAtpWHArp0s-gdA7RbPQ@mail.gmail.com>
	<CALyPt8z3DN0taprsV7j3WeefaGbx0Ej74sh08D5WUaBpvFQXRQ@mail.gmail.com>
	<CAPPfxyuWaQZ9CK9q936f8xRS5ACU+3pK29GCKiM19iiLn8XjPw@mail.gmail.com>
	<A83620D4CC4762448EFB789FD6E9BBB742B850AE@SCOMP0937.wurnet.nl>
Message-ID: <CALyPt8zH4mkHXO1sT28C16zee212sjo3uQt+RB3VSxSWK_VOJw@mail.gmail.com>

Zebrat--
Loic's example works and generates different sized files on my system.
sessionInfo():
R version 3.1.1 (2014-07-10)
Platform: x86_64-w64-mingw32/x64 (64-bit)

locale:
[1] LC_COLLATE=English_United States.1252
[2] LC_CTYPE=English_United States.1252
[3] LC_MONETARY=English_United States.1252
[4] LC_NUMERIC=C
[5] LC_TIME=English_United States.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] raster_2.2-31 rgdal_0.8-16  sp_1.0-15

loaded via a namespace (and not attached):
[1] grid_3.1.1      lattice_0.20-29

If it doesn't work on your system, you might post your sessionInfo().

Try both FLT4S and FLT8S to see if the files have different sizes.  Then,
use GDALinfo() instead of another GIS program to inspect the file, as at
least one GIS program silently converts 4-byte floats to 8-byte doubles.

Other than that, if space is really an issue, your approach of rescaling
and storing as an integer is good. You could divide by 100 and use INT2S if
your temperatures don't get above 327deg K.

Tom 2



On Tue, Nov 11, 2014 at 5:02 AM, Dutrieux, Loic <loic.dutrieux at wur.nl>
wrote:

> Hello Zebrat,
>
> The datatype= argument appears to work well on my system. See if you can
> reproduce the example below:
>
> library(raster)
> r <- raster(system.file("external/test.grd", package="raster"))
>
> writeRaster(r, filename = 'rasterDefault.tif')
> GDALinfo('rasterDefault.tif')
> # By default raster writes to Float64
>
> writeRaster(r, filename = 'rasterFloatSingle.tif', datatype = 'FLT4S')
> GDALinfo('rasterFloatSingle.tif')
> # Float 32
>
> Make sure you do not capitalize the "t" in datatype. datatype is the
> writeRaster() argument and dataType is the function to retrieve data type.
>
> Cheers,
> Lo?c
>
> -----Original Message-----
> From: r-sig-geo-bounces at r-project.org [mailto:
> r-sig-geo-bounces at r-project.org] On Behalf Of diamant zebrat
> Sent: Tuesday, November 11, 2014 10:13
> To: Tom Philippi
> Cc: r-sig-geo
> Subject: Re: [R-sig-Geo] WriteRaster as Float
>
> Tom, here goes the details
> The Meteosat images are composed by a matrix of pixels with values of
> surface temperature (or cloud top temperature) in Kelvin, which means
> values like 273.15 I wanted to keep the decimals, thus I need a FLT4S
> 4-byte values. When using
> writeRaster(TTemp,filename=nom,format="GTiff",overwrite=T,datatype="FLT4S")
> I get a file with a size of 7.495.158 bytes.  My particular image is a
> matrix of 1201 lines x 803 columns = 964.403 pixels, with this option
> (datatype="FLT4S") it looks like we get an image that uses
> 8 bytes to store each pixel. In fact, we only need 4 bytes (float) to
> store values like 273.15, thus I am getting images which are too big. Keep
> in mind there is a Meteosat image each 15 min -> 96 a day, etc. These means
> a lot of storage space and I should care about it When opening one of these
> GEOTIFF (LTS4S) with a GIS package, it get an image that is "double
> precision", confirming that the writeRaster is using
> 8 bytes to store each pixel when creating the GEOTIFF with the
> datatype="FLT4S" option The conclusion is that the writeRaster routine is
> not optimized to use the minimum space when writing a geotiff The only
> alternative by now is to multiply my kelvins by ten and save it as an
> integer, this way I only keep one decimal but I get small size files
> writeRaster(TTemp,filename=nom,format="GTiff",overwrite=T,datatype="INT1U")
> However, I still want to keep the real values using 4 byte for each
> pixel...
> thank you
> Zebrat
>
> 2014-11-11 4:32 GMT+00:00 Tom Philippi <tephilippi at gmail.com>:
>
> > Zebrat--
> > Without example code it is difficult to guess what you tried, and what
> > you desire.  By "float" do you mean FLT4S 4-byte values?  If so, try
> > datatype='FLT4S' in your call to writeRaster(), which should be the
> > same as 'Float32' in gdal.  If you mean something else, I guessed
> > wrong, so you might specify a bit more about what you have, want, and
> have tried.
> >
> > Tom 2
> >
> > On Mon, Nov 10, 2014 at 4:38 AM, diamant zebrat
> > <diamant.zebrat at gmail.com>
> > wrote:
> >
> >> Hello,
> >> I am working with R processing Meteosat imagery, which mean a lot of
> >> images every day, and thus a lot of available storage space It looks
> >> like the write raster function of the raster package only allows to
> >> write a Geotiff as integer or as double. I only need float precision,
> >> so I don't need a double as the resulting file gets too big. Is there
> >> any way to store a geotiff with float precision?
> >> Thank you
> >> Zebrat
> >>
> >>         [[alternative HTML version deleted]]
> >>
> >> _______________________________________________
> >> R-sig-Geo mailing list
> >> R-sig-Geo at r-project.org
> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >>
> >
> >
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From thiagoclsilveira at yahoo.com.br  Tue Nov 11 18:39:00 2014
From: thiagoclsilveira at yahoo.com.br (Thiago Cesar Lima Silveira)
Date: Tue, 11 Nov 2014 17:39:00 +0000
Subject: [R-sig-Geo] Predict GAM model with categorical predictors
References: <CAC7AcGQfNfrn=jO8-MXRWeN7+RgGGZa5i9bA9uKGTkOOcqMABQ@mail.gmail.com>
Message-ID: <loom.20141111T183656-150@post.gmane.org>

Hi,

Sorry, I've posted the 
code with some mistakes.
Consider the code below.

I've one response, and two predictors, 
v1 (numeric) and v2 (factor).
 So, I have just one predictor
 which is possible to have a raster, the other is a categorical
variable.

How to predict to rasters considering categorical variables?

As described in the package raster,
 "const" is used as a constant for which there is no Raster 
object for model predictions.

In my case categorical variable. 

I'm using this argument and doesn't work. Any Idea?

######

library(mgcv)
library(raster)
library(rgdal)

#raster example
v1rst<-raster()
values(v1rst) <- 1:ncell(v1rst)
names(v1rst)<-'v1'
plot(v1rst)

# Example of response variable and predictors
y<-c(1,33,500,700, 334,320, 703,
+ 303,3030,3002,200,0,100,100,169)
v1<-c(12,33,544,600, 34,30, 03,3390,3030,
 + 302,20,108,170,101,2009)
v2<-c('t','t','t','t','t','t','t','t','c','c','c','c','c','c','c' )
df<-data.frame(y, v1, v2)

#GAM model with factor
gam1<-gam(y~s(v1)+factor(v2), data=df)
summary(gam1)

#GAM model without factor
gam2<-gam(y~s(v1), data=df)
summary(gam2)

#GLM with factor
glm1<-glm(y~v1 + factor(v2), data=df)
summary(glm1)

#GLM no factor
glm2<-glm(y~v1, data=df)
summary(glm2)


# data.frame with a constant value 
#(of class ?factor?) to pass that on to the predict function.
v2<-factor( 't',levels=levels(df$v2)) 
add2<-data.frame(v2)
str(add2)              

#Prediction with factor
p<-predict(v1rst,gam1, const=add2, type='response')

#This is the error
 'Error in `[.data.frame`(blockvals, , f[j]) : undefined columns selected
              
#Prediction without factor
p<-predict(v1rst,gam2, type="response")
plot(p)

#Prediction glm

glm1p<-predict(v1rst, glm1, type='response', const=add2)

glm2p<-predict(v1rst, glm2, type='response')
plot(glm2p)


From thiagoclsilveira at yahoo.com.br  Tue Nov 11 18:55:17 2014
From: thiagoclsilveira at yahoo.com.br (Thiago Silveira)
Date: Tue, 11 Nov 2014 10:55:17 -0700 (MST)
Subject: [R-sig-Geo] Predict GAM model with categorical predictors
In-Reply-To: <CAC7AcGQfNfrn=jO8-MXRWeN7+RgGGZa5i9bA9uKGTkOOcqMABQ@mail.gmail.com>
References: <520F8CDB-03A8-49A2-82A2-12139018D430@yahoo.com.br>
	<CAC7AcGQfNfrn=jO8-MXRWeN7+RgGGZa5i9bA9uKGTkOOcqMABQ@mail.gmail.com>
Message-ID: <1415728517192-7587424.post@n2.nabble.com>

Hi Dhyey Bhatpuria,

Sorry, I've posted the code with some mistakes. 
Consider the code below.

I've one response, and two predictors, v1 (numeric) and v2 (factor).
 So, I have just one predictor which is possible to have a raster, the other
is a categorical 
variable.

How to predict to rasters considering categorical variables?

As described in the package raster, "const" is used as a constant for which
there is no Raster 
object for model predictions.

In my case categorical variable. 

I'm using this argument and doesn't work. Any Idea?

######

library(mgcv)
library(raster)
library(rgdal)

#raster example
v1rst<-raster()
values(v1rst) <- 1:ncell(v1rst)
names(v1rst)<-'v1'
plot(v1rst)

# Example of response variable and predictors
y<-c(1,33,500,700, 334,320, 703, 303,3030,3002,200,0,100,100,169)
v1<-c(12,33,544,600, 34,30, 03,3390,3030, 302,20,108,170,101,2009)
v2<-c('t','t','t','t','t','t','t','t','c','c','c','c','c','c','c' )
df<-data.frame(y, v1, v2)

#GAM model with factor
gam1<-gam(y~s(v1)+factor(v2), data=df)
summary(gam1)

#GAM model without factor
gam2<-gam(y~s(v1), data=df)
summary(gam2)

#GLM with factor
glm1<-glm(y~v1 + factor(v2), data=df)
summary(glm1)

#GLM no factor
glm2<-glm(y~v1, data=df)
summary(glm2)


# data.frame with a constant value 
#(of class ?factor?) to pass that on to the predict function.
v2<-factor( 't',levels=levels(df$v2)) 
add2<-data.frame(v2)
str(add2)              

#Prediction with factor
p<-predict(v1rst,gam1, const=add2, type='response')

#This is the error 'Error in `[.data.frame`(blockvals, , f[j]) : undefined
columns selected
              
#Prediction without factor
p<-predict(v1rst,gam2, type="response")
plot(p)

#Prediction glm

glm1p<-predict(v1rst, glm1, type='response', const=add2)

glm2p<-predict(v1rst, glm2, type='response')
plot(glm2p)




--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Predict-GAM-model-with-categorical-predictors-tp7587414p7587424.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From smithtiffanyt at gmail.com  Tue Nov 11 18:58:36 2014
From: smithtiffanyt at gmail.com (Tiffany Smith)
Date: Tue, 11 Nov 2014 12:58:36 -0500
Subject: [R-sig-Geo] Regional Average of Rasters
Message-ID: <05BEAEE2-EA1F-4996-9566-9D399160667D@gmail.com>

I have a rasterBrick (temp) with global temperatures, and a rasterLayer (regions) of global regions. I would like to create a rasterBrick of regional average temperatures. So far I have the following:

region1<-mask(temp,regions,maskvalue=1,inverse=TRUE)
mean1<-cellStats(region1,mean)

region2<-mask(temp,regions,maskvalue=2,inverse=TRUE)
mean2<-cellStats(region2,mean)

At which point, I?m not sure how to get this back into raster format. Alternatively, this can?t be the most efficient way to do this - any ideas would be much appreciated.

Thanks,
Tiffany
	[[alternative HTML version deleted]]


From bernd.vogelgesang at gmx.de  Wed Nov 12 00:43:55 2014
From: bernd.vogelgesang at gmx.de (Bernd Vogelgesang)
Date: Wed, 12 Nov 2014 00:43:55 +0100
Subject: [R-sig-Geo] gIntersection for several polygons
In-Reply-To: <1415696958276-7587418.post@n2.nabble.com>
References: <1415696958276-7587418.post@n2.nabble.com>
Message-ID: <op.xo6pjhebl2i25i@bernd-terra-pc>

Hi Rebecka,

I can't help you with your homerange problem right now, but maybe give you  
a hint about the intersection.
I also unsuccesfully tried to use gIntersection until I was told that the  
raster (!) package has a function "intersection" which worked perfectly  
for me.

My last R-project was also on wind farms, where I had to calculate  
presence values for different species and two buffers for each single  
turbine. Maybe sth of this is useful for you (though horribly coded I  
fear). In case ... drop me a line.

Cheers
Bernd


Am 11.11.2014, 10:09 Uhr, schrieb Rebecka <rehe0001 at stud.slu.se>:

> Hi!
>
> I?m a beginner with R and I?m trying to calculate area of polygons
> (homerange areas of 31 individuals) intersecting with bufferzones around
> 4348 number of windfarms. I have read this webpage as a help:
> http://rstudio-pubs-static.s3.amazonaws.com/7993_6b081819ba184047802a508a7f3187cb.html
>
> I?ve succeeded to create bufferzones with gBuffer. Now I would like to do
> gIntersection for every individuals homerange overlap with bufferzones.  
> I?ve
> tried to create homeranges as a first step using gConvexHull but I don?t
> understand how to this by each id for every individual. I have a
> spatialpointsdataframe with one column called "Object_ID" and also  
> columns
> "x" and "y" for coordinates and every row corresponds to one position.  
> Every
> individual have a lot of coordinates (all individuals have over 94000
> positions together).
>
> Is it possible to create one homerange for every individual using
> gConvexHull? byid=TRUE just do it for every row when I tried.
>
> I also tried to go around the problem creating mcp (packageadehabitatHR)  
> for
> every individual.
> mcpAll<-mcp(animalSpdf[,2]) *gives Spatialpolygons*
>
> Then I tried to use that in gIntersection
> inter1<-gIntersection(mcpAll,Prop1,byid=TRUE) *Prop1 is my windfarms with
> bufferzones*
> but it only gave a NULL result for inter1. CRS are same for both and I  
> know
> that they should overlap.
>
> Any ideas how to solve this?
>
> Thanks!!
>
> Rebecka Hedfors
>
>
>
>
> --
> View this message in context:  
> http://r-sig-geo.2731867.n2.nabble.com/gIntersection-for-several-polygons-tp7587418.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


-- 
Bernd Vogelgesang
Siedlerstra?e 2
91083 Baiersdorf/Igelsdorf
Tel: 09133-825374


From boukepieter.ottow at wur.nl  Wed Nov 12 08:55:57 2014
From: boukepieter.ottow at wur.nl (boukepieter)
Date: Wed, 12 Nov 2014 00:55:57 -0700 (MST)
Subject: [R-sig-Geo] rsaga.import.gdal gives weird output
In-Reply-To: <E77A61BE378A78468C9742BD6813C79613DF6654@SCOMP0934.wurnet.nl>
References: <E77A61BE378A78468C9742BD6813C79613DF6654@SCOMP0934.wurnet.nl>
Message-ID: <1415778957287-7587427.post@n2.nabble.com>

Dear list,

For the record; I found a workaround for the mentioned issue.
It seems that when changing the file from tiff to sdat something goes wrong
in the transformation. In the 'GDAL: import raster' tool of SAGA there is an
option to turn transformation on and choose what method to use. This tool
can also be accessed from R with:
> rsaga.geoprocessor(lib="io_gdal", module=0,
> param=list(GRIDS=paste(getwd(),"RSAGA/Rtest.sgrd",sep="/"), 
                                                     
FILES=paste(getwd(),"source/DEM.tif",sep="/"), 
                                                      TRANSFORM=TRUE,
INTERPOL=1))

And this gives the right result with the same data.

Regards,
Bouke Pieter Ottow



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/rsaga-import-gdal-gives-weird-output-tp7587402p7587427.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From rehe0001 at stud.slu.se  Wed Nov 12 16:16:20 2014
From: rehe0001 at stud.slu.se (Rebecka)
Date: Wed, 12 Nov 2014 08:16:20 -0700 (MST)
Subject: [R-sig-Geo] gIntersection for several polygons
In-Reply-To: <op.xo6pjhebl2i25i@bernd-terra-pc>
References: <1415696958276-7587418.post@n2.nabble.com>
	<op.xo6pjhebl2i25i@bernd-terra-pc>
Message-ID: <1415805380481-7587428.post@n2.nabble.com>

Hi Bernd!

It helped! I didn?t managed to do it for individuals at the same time but at
least I was able to break it down and do some of the stuff I needed for each
individual.

Thanks a lot!

/Rebecka



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/gIntersection-for-several-polygons-tp7587418p7587428.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From thiagoclsilveira at yahoo.com.br  Wed Nov 12 17:51:45 2014
From: thiagoclsilveira at yahoo.com.br (Thiago Cesar Lima Silveira)
Date: Wed, 12 Nov 2014 14:51:45 -0200
Subject: [R-sig-Geo] Predict a gam model with factors to a raster
Message-ID: <C0B86581-2827-43F6-B524-60B02B26EF29@yahoo.com.br>

Hi,

I edited the same question to a better understanding.

I hope someone can help with the issue about a prediction using a model with factors in package ?raster'.

I would like to do the same that shows this code  from BRT vignette:


    ####Example BRT
    
    library(dismo)
    data(Anguilla_grids)
    angaus.tc5.lr005 <- gbm.step(data=Anguilla_train, gbm.x = 3:13, gbm.y = 2,family = "bernoulli", tree.complexity = 5, learning.rate = 0.005, bag.fraction = 0.5)
    
    Method <- factor('electric', levels = levels(Anguilla_train$Method)) 
    add <- data.frame(Method)
    str(add)

    p <- predict(Anguilla_grids, angaus.tc5.lr005, const=add, n.trees=angaus.tc5.lr005$gbm.call$best.trees, type="response") 
    p <- mask(p, raster(Anguilla_grids, 1))
    plot(p, main='Angaus - BRT prediction?)
    
    #####

The code above uses in ?predict ( )? an argument ?const? to handle with predictors that I have no rasters, something like a method of capture.

As described in the package raster, "const" is used as a constant for which there is no Raster object for model predictions. In my case categorical variable.

Below I have a reproducible example code to illustrate my problem with GAM and GLM models with categorical predictors.

I think this could be primary mistake in R coding, but I did not find the error by myself.

Thank you.

Thiago 

    ##### Problem with GAM and GLM
    library(mgcv)
    library(raster)
    library(rgdal)
    
    #raster layer
    v1rst<-raster()
    values(v1rst) <- 1:ncell(v1rst)
    names(v1rst)<-'v1'
    plot(v1rst)
    
    # Simple example of response variable and predictors
    y<-c(1,33,500,700, 334,320, 703,303,3030,3002,200,0,100,100,169)
    v1<-c(12,33,544,600, 34,30, 03,3390,3030,302,20,108,170,101,2009)
    v2<-c('t','t','t','t','t','t','t','t','c','c','c','c','c','c','c' )
    df<-data.frame(y, v1, v2)
    
    #GAM model with factor
    gam1<-gam(y~s(v1)+factor(v2), data=df)
    summary(gam1)
    
    #GAM model without factor
    gam2<-gam(y~s(v1), data=df)
    summary(gam2)
    
    #GLM with factor
    glm1<-glm(y~v1 + factor(v2), data=df)
    summary(glm1)
    
    #GLM without factor
    glm2<-glm(y~v1, data=df)
    summary(glm2)
    
    
    # data.frame with a constant value 
    #(of class ?factor?) to pass that on to the predict function.
    v2<-factor( 't',levels=levels(df$v2)) 
    add2<-data.frame(v2)
    str(add2)              
    
    #Prediction GAM with factor
    p<-predict(v1rst,gam1, const=add2, type='response')
    
    #This is the error 'Error in `[.data.frame`(blockvals, , f[j]) : undefined columns selected
    
    #Prediction without factor
    p<-predict(v1rst,gam2, type="response")
    plot(p) ## ok!
    
    #Prediction glm
    #with factor
    glm1p<-predict(v1rst, glm1, type='response', const=add2)
    #error
    
    
    #Prediction without factor
    glm2p<-predict(v1rst, glm2, type='response')
    plot(glm2p) ##ok!!


From andigros72 at gmail.com  Wed Nov 12 20:55:15 2014
From: andigros72 at gmail.com (Andreas Gros)
Date: Wed, 12 Nov 2014 11:55:15 -0800
Subject: [R-sig-Geo] plotKML kml_layer.Raster problem
In-Reply-To: <54608D02.5020700@spatial-analyst.net>
References: <CAJPy8YXfgejRSVEMXfgxUQvixH3w4NROaLbJPJQ01m54r967Hg@mail.gmail.com>
	<B078CDF40DFE4045AF172A8B4F68FC4857C9BA33B8@DKRDSEXC016.vestas.net>
	<CAJPy8YUFh2425cBUkdCu3q81PmtE6POUrXpKvJQ7pXn=YKWK0w@mail.gmail.com>
	<54608D02.5020700@spatial-analyst.net>
Message-ID: <CAJPy8YXJ+1cLNpAOZsxsvZ7e9jzLNxRvMk7ZnvFKf+x3Gdkenw@mail.gmail.com>

Thanks guys, but I still get the same error in this little toy example:


library(raster)
library(plotKML)

e.cRampPalette = colorRampPalette(
  c("black", "lightgray"), 1,
  space=c("Lab"),
  interpolate=c("spline"))

pwidth = 50
pheight = 50

r.ex <- extent(0, 1, 0, 1)
pproj <- "+proj=longlat +ellps=WGS84 +datum=WGS84"
raster_layer <- raster(ncols=pwidth, nrows=pheight,
                       xmn=xmin(r.ex), xmx=xmax(r.ex),
                       ymn=ymin(r.ex), ymx=ymax(r.ex),
                       crs=pproj)

values(raster_layer) <- rep(1, pwidth*pheight)

kml_open(file.name="test.kml",
  folder.name='top_folder',
  kml_visibility=TRUE)
kml_layer.Raster(raster_layer, folder.name='raster_sub_folder',
  plot.legend=TRUE,
  metadata=NULL,
  colour=names(raster_layer)[1],
  colour_scale=e.cRampPalette(255),
  raster_name='raster_layer',
  layer.name=names(raster_layer)[1],
  png.width=50,
  png.height=50
)
kml_close(file.name="test.kml")

>
Error in setValues(x, value) :
values must be numeric, integer, logical or factor

> names(raster_layer)[1]
[1] "layer"
> raster_layer[["layer"]]
class       : RasterLayer
dimensions  : 50, 50, 2500  (nrow, ncol, ncell)
resolution  : 0.02, 0.02  (x, y)
extent      : 0, 1, 0, 1  (xmin, xmax, ymin, ymax)
coord. ref. : +proj=longlat +ellps=WGS84 +datum=WGS84
data source : in memory
names       : layer
values      : 1, 1  (min, max)

> traceback()
6: stop("values must be numeric, integer, logical or factor")
5: setValues(x, value)
4: setValues(x, value)
3: `values<-`(`*tmp*`, value = "layer")
2: `values<-`(`*tmp*`, value = "layer")
1: kml_layer.Raster(raster_layer, folder.name = "raster_sub_folder",
       plot.legend = TRUE, metadata = NULL, colour = names(raster_layer)[1],
       colour_scale = e.cRampPalette(255), raster_name = "raster_layer",
       layer.name = names(raster_layer)[1], png.width = 50, png.height = 50)
>


On Mon, Nov 10, 2014 at 2:01 AM, Tomislav Hengl <hengl at spatial-analyst.net>
wrote:
>
>
> The argument "colour" is reserved for the target variable (name,
function/call or vector). plotKML allows users to visualize multiple
variables using different aesthetics (
http://plotkml.r-forge.r-project.org/aesthetics.html), so in your case this
would be "colour = layer, colour_scale = e.cRampPalette(255)", although it
might take you few iterations until you get the right legend / PNG output.
>
> To learn how to use lower level functions such as kml_layer.Raster maybe
first study the package vignette (
http://cran.r-project.org/web/packages/plotKML/vignettes/jss1079.pdf)
and/or the package tutorial (
http://gsif.isric.org/doku.php?id=wiki:tutorial_plotkml).
>
> Sorry for some confusion between "colour" and "colour_scale".
>
> T. Hengl
>
>
>
> On 8-11-2014 1:12, Andreas Gros wrote:
>>
>> Hi Frede,
>>
>> This is the test case (using just values of 1): (traceback() below)
>>
>> pheight = 100
>> pwidth = 200
>>
>>> raster_layer <- raster(ncols=pwidth, nrows=pheight,
>>
>> +                        xmn=xmin(r.ex), xmx=xmax(r.ex),
>> +                        ymn=ymin(r.ex), ymx=ymax(r.ex),
>> +                        crs=CRS(projection(bigraster)))
>>>
>>> values(raster_layer) <- rep(1, pwidth*pheight)
>>
>>
>>
>>> kml_open(file.name="test.kml",
>>
>> +   folder.name='top_folder',
>> +   kml_visibility=TRUE)
>> KML file opened for writing...
>>>
>>> kml_layer.Raster(raster_layer, folder.name='raster_sub_folder',
>>
>> +   plot.legend=TRUE,
>> +   metadata=NULL,
>> +   colour=e.cRampPalette(255),
>> +   raster_name='raster_layer',
>> +   layer.name=names(raster_layer)[1],
>> +   png.width=1000,
>> +   png.height=833
>> + )
>>
>> Error in setValues(x, value) :
>>    values must be numeric, integer, logical or factor
>>
>>> kml_close(file.name="test.kml")
>>
>>
>> Closing  test.kml
>>
>> Traceback:
>> traceback()
>> 6: stop("values must be numeric, integer, logical or factor")
>> 5: setValues(x, value)
>> 4: setValues(x, value)
>> 3: `values<-`(`*tmp*`, value = c("#000000", "#010101", "#020202",
>>     "#030303", "#040404", "#060606", "#070707", "#080808", "#090909",
>>     "#0A0A0A", "#0C0C0C", "#0D0D0D", "#0E0E0E", "#0F0F0F", "#0F0F0F",
>>     "#101010", "#111111", "#121212", "#131313", "#141414", "#141414",
>>     "#151515", "#161616", "#161616", "#171717", "#181818", "#181818",
>>     "#191919", "#1A1A1A", "#1A1A1A", "#1B1B1B", "#1C1C1C", "#1C1C1C",
>>     "#1D1D1D", "#1E1E1E", "#1E1E1E", "#1F1F1F", "#202020", "#202020",
>>     "#212121", "#222222", "#222222", "#232323", "#242424", "#242424",
>>     "#252525", "#262626", "#272727", "#272727", "#282828", "#292929",
>>     "#292929", "#2A2A2A", "#2B2B2B", "#2B2B2B", "#2C2C2C", "#2D2D2D",
>>     "#2E2E2E", "#2E2E2E", "#2F2F2F", "#303030", "#303030", "#313131",
>>     "#323232", "#333333", "#333333", "#343434", "#353535", "#363636",
>>     "#363636", "#373737", "#383838", "#383838", "#393939", "#3A3A3A",
>>     "#3B3B3B", "#3B3B3B", "#3C3C3C", "#3D3D3D", "#3E3E3E", "#3E3E3E",
>>
>> ...
>>
>>     ))
>>
>> 2: `values<-`(`*tmp*`, value = c("#000000", "#010101", "#020202",
>>     "#030303", "#040404", "#060606", "#070707", "#080808", "#090909",
>>     "#0A0A0A", "#0C0C0C", "#0D0D0D", "#0E0E0E", "#0F0F0F", "#0F0F0F",
>>     "#101010", "#111111", "#121212", "#131313", "#141414", "#141414",
>>     "#151515", "#161616", "#161616", "#171717", "#181818", "#181818",
>>     "#565656", "#575757", "#585858", "#595959", "#5A5A5A", "#5A5A5A",
>> ...
>>
>>   ))
>>
>> 1: kml_layer.Raster(raster_layer, folder.name = "raster_sub_folder",
>>         plot.legend = TRUE, metadata = NULL, colour =
e.cRampPalette(255),
>>         raster_name = "raster_layer", layer.name =
names(raster_layer)[1],
>>         png.width = 1000, png.height = 833)
>>
>>
>> And when I'm trying to use colour_scheme I'm gettiing an error that lets
me
>> assume that kml_layer.Raster is not compatible with 'raster':
>>
>> kml_open(file.name="test.kml",
>> +   folder.name='top_folder',
>> +   kml_visibility=TRUE)
>> KML file opened for writing...
>>>
>>> kml_layer.Raster(raster_layer, folder.name='raster_sub_folder',
>>
>> +   plot.legend=TRUE,
>> +   metadata=NULL,
>> +   colour_scheme=e.cRampPalette(255),
>> +   raster_name='raster_layer',
>> +   layer.name=names(raster_layer)[1],
>> +   png.width=1000,
>> +   png.height=833
>> + )
>>
>> Error in is.factor(obj at data[, 1]) :
>>    error in evaluating the argument 'x' in selecting a method for
function
>> 'is.factor': Error in obj at data[, 1] : object of type 'S4' is not
subsettable
>>
>>> kml_close(file.name="test.kml")
>>
>> Closing  test.kml
>>
>>> traceback()
>>
>> 2: is.factor(obj at data[, 1])
>> 1: kml_layer.Raster(raster_layer, folder.name = "raster_sub_folder",
>>         plot.legend = TRUE, metadata = NULL, colour_scheme =
>> e.cRampPalette(255),
>>         raster_name = "raster_layer", layer.name =
names(raster_layer)[1],
>>         png.width = 1000, png.height = 833)
>>
>> On Thu, Nov 6, 2014 at 10:52 PM, Frede Aakmann T?gersen <frtog at vestas.com
>
>> wrote:
>>
>>> Hi Andreas
>>>
>>> Can you provide a small example showing the details of what you're
trying
>>> to do. I don't think that anyone can help you with the little
information
>>> you have given.
>>>
>>> If you do not have any example please show us the output from
traceback()
>>> immediately after the error.
>>>
>>> I don't think this has anything to do with NA's in your data values as I
>>> don't get any errors doing this (from man of kml_layer.Raster):
>>>
>>>
>>> data(eberg_grid)
>>> library(sp)
>>> coordinates(eberg_grid) <- ~x+y
>>> gridded(eberg_grid) <- TRUE
>>> proj4string(eberg_grid) <- CRS("+init=epsg:31467")
>>> data(SAGA_pal)
>>> library(raster)
>>> r <- raster(eberg_grid["TWISRT6"])
>>>
>>> ## Put some NA's into data
>>> r at data@values[1:10] <- NA
>>>
>>> kml(r, colour_scale = SAGA_pal[[1]], colour = TWISRT6)
>>>
>>>
>>>
>>>
>>> Yours sincerely / Med venlig hilsen
>>>
>>>
>>> Frede Aakmann T?gersen
>>> Specialist, M.Sc., Ph.D.
>>> Plant Performance & Modeling
>>>
>>> Technology & Service Solutions
>>> T +45 9730 5135
>>> M +45 2547 6050
>>> frtog at vestas.com
>>> http://www.vestas.com
>>>
>>> Company reg. name: Vestas Wind Systems A/S
>>> This e-mail is subject to our e-mail disclaimer statement.
>>> Please refer to www.vestas.com/legal/notice
>>> If you have received this e-mail in error please contact the sender.
>>>
>>>
>>>> -----Original Message-----
>>>> From: r-sig-geo-bounces at r-project.org [mailto:r-sig-geo-bounces at r-
>>>> project.org] On Behalf Of Andreas Gros
>>>> Sent: 6. november 2014 23:47
>>>> To: r-sig-geo at r-project.org
>>>> Subject: [R-sig-Geo] plotKML kml_layer.Raster problem
>>>>
>>>> In version 0.4-6 of plotKML, when I'm adding a kml_layer.Raster (single
>>>> layer, no stack/brick) to a kml file, I get the following error
message:
>>>>
>>>> Error in setValues(x, value) :
>>>> values must be numeric, integer, logical or factor
>>>>
>>>>
>>>> The values in the raster range between -57 and 2000 and it also occurs
>>>
>>> if I
>>>>
>>>> replace NA values first with some arbitrary numerical value.
>>>> Has anyone come across this problem and knows how to fix/circumnavigate
>>>> it?
>>>>
>>>> Thanks!
>>>>
>>>>        [[alternative HTML version deleted]]
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at r-project.org
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>>
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>

	[[alternative HTML version deleted]]


From frtog at vestas.com  Thu Nov 13 07:42:28 2014
From: frtog at vestas.com (=?utf-8?B?RnJlZGUgQWFrbWFubiBUw7hnZXJzZW4=?=)
Date: Thu, 13 Nov 2014 07:42:28 +0100
Subject: [R-sig-Geo] plotKML kml_layer.Raster problem
In-Reply-To: <CAJPy8YXJ+1cLNpAOZsxsvZ7e9jzLNxRvMk7ZnvFKf+x3Gdkenw@mail.gmail.com>
References: <CAJPy8YXfgejRSVEMXfgxUQvixH3w4NROaLbJPJQ01m54r967Hg@mail.gmail.com>
	<B078CDF40DFE4045AF172A8B4F68FC4857C9BA33B8@DKRDSEXC016.vestas.net>
	<CAJPy8YUFh2425cBUkdCu3q81PmtE6POUrXpKvJQ7pXn=YKWK0w@mail.gmail.com>
	<54608D02.5020700@spatial-analyst.net>
	<CAJPy8YXJ+1cLNpAOZsxsvZ7e9jzLNxRvMk7ZnvFKf+x3Gdkenw@mail.gmail.com>
Message-ID: <B078CDF40DFE4045AF172A8B4F68FC4857C9CFE55A@DKRDSEXC016.vestas.net>

Hi

Tomislav has already given you the answer to this problem. Did you read http://cran.r-project.org/web/packages/plotKML/vignettes/jss1079.pdf as he suggested. There you can see the solution on e.g. page 9. The same thing you can see in ?kml for the eberg raster:


> data(eberg)

> names(eberg)
[1] "ID"       "soiltype" "TAXGRSC"  "X"        "Y"        "UHDICM_A"
[7] "LHDICM_A" "SNDMHT_A" "SLTMHT_A" "CLYMHT_A" "UHDICM_B" "LHDICM_B"
[13] "SNDMHT_B" "SLTMHT_B" "CLYMHT_B" "UHDICM_C" "LHDICM_C" "SNDMHT_C"
[19] "SLTMHT_C" "CLYMHT_C" "UHDICM_D" "LHDICM_D" "SNDMHT_D" "SLTMHT_D"
[25] "CLYMHT_D" "UHDICM_E" "LHDICM_E" "SNDMHT_E" "SLTMHT_E" "CLYMHT_E"
>

# Plot using aesthetics
kml(eberg, colour = SNDMHT_A, size = CLYMHT_A, alpha = 0.75, file = "eberg-1.kml")

You can see that colour is set to the SNDMHT_A layer without apostrophes.

For your raster we have

> names(raster_layer)
[1] "layer"
>

So don?t use

colour=names(raster_layer)[1],

but

colour=layer

Yours sincerely / Med venlig hilsen


Frede Aakmann T?gersen
Specialist, M.Sc., Ph.D.
Plant Performance & Modeling

Technology & Service Solutions
T +45 9730 5135
M +45 2547 6050
frtog at vestas.com<mailto:frtog at vestas.com>
http://www.vestas.com<http://www.vestas.com/>

Company reg. name: Vestas Wind Systems A/S
This e-mail is subject to our e-mail disclaimer statement.
Please refer to www.vestas.com/legal/notice<http://www.vestas.com/legal/notice>
If you have received this e-mail in error please contact the sender.

From: Andreas Gros [mailto:andigros72 at gmail.com]
Sent: 12. november 2014 20:55
To: Tomislav Hengl
Cc: Frede Aakmann T?gersen; r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] plotKML kml_layer.Raster problem

Thanks guys, but I still get the same error in this little toy example:


library(raster)
library(plotKML)

e.cRampPalette = colorRampPalette(
  c("black", "lightgray"), 1,
  space=c("Lab"),
  interpolate=c("spline"))

pwidth = 50
pheight = 50

r.ex <- extent(0, 1, 0, 1)
pproj <- "+proj=longlat +ellps=WGS84 +datum=WGS84"
raster_layer <- raster(ncols=pwidth, nrows=pheight,
                       xmn=xmin(r.ex), xmx=xmax(r.ex),
                       ymn=ymin(r.ex), ymx=ymax(r.ex),
                       crs=pproj)

values(raster_layer) <- rep(1, pwidth*pheight)

kml_open(file.name<http://file.name>="test.kml",
  folder.name<http://folder.name>='top_folder',
  kml_visibility=TRUE)
kml_layer.Raster(raster_layer, folder.name<http://folder.name>='raster_sub_folder',
  plot.legend=TRUE,
  metadata=NULL,
  colour=names(raster_layer)[1],
  colour_scale=e.cRampPalette(255),
  raster_name='raster_layer',
  layer.name<http://layer.name>=names(raster_layer)[1],
  png.width=50,
  png.height=50
)
kml_close(file.name<http://file.name>="test.kml")

>
Error in setValues(x, value) :
values must be numeric, integer, logical or factor

> names(raster_layer)[1]
[1] "layer"
> raster_layer[["layer"]]
class       : RasterLayer
dimensions  : 50, 50, 2500  (nrow, ncol, ncell)
resolution  : 0.02, 0.02  (x, y)
extent      : 0, 1, 0, 1  (xmin, xmax, ymin, ymax)
coord. ref. : +proj=longlat +ellps=WGS84 +datum=WGS84
data source : in memory
names       : layer
values      : 1, 1  (min, max)

> traceback()
6: stop("values must be numeric, integer, logical or factor")
5: setValues(x, value)
4: setValues(x, value)
3: `values<-`(`*tmp*`, value = "layer")
2: `values<-`(`*tmp*`, value = "layer")
1: kml_layer.Raster(raster_layer, folder.name<http://folder.name> = "raster_sub_folder",
       plot.legend = TRUE, metadata = NULL, colour = names(raster_layer)[1],
       colour_scale = e.cRampPalette(255), raster_name = "raster_layer",
       layer.name<http://layer.name> = names(raster_layer)[1], png.width = 50, png.height = 50)
>


On Mon, Nov 10, 2014 at 2:01 AM, Tomislav Hengl <hengl at spatial-analyst.net<mailto:hengl at spatial-analyst.net>> wrote:
>
>
> The argument "colour" is reserved for the target variable (name, function/call or vector). plotKML allows users to visualize multiple variables using different aesthetics (http://plotkml.r-forge.r-project.org/aesthetics.html), so in your case this would be "colour = layer, colour_scale = e.cRampPalette(255)", although it might take you few iterations until you get the right legend / PNG output.
>
> To learn how to use lower level functions such as kml_layer.Raster maybe first study the package vignette (http://cran.r-project.org/web/packages/plotKML/vignettes/jss1079.pdf) and/or the package tutorial (http://gsif.isric.org/doku.php?id=wiki:tutorial_plotkml).
>
> Sorry for some confusion between "colour" and "colour_scale".
>
> T. Hengl
>
>
>
> On 8-11-2014 1:12, Andreas Gros wrote:
>>
>> Hi Frede,
>>
>> This is the test case (using just values of 1): (traceback() below)
>>
>> pheight = 100
>> pwidth = 200
>>
>>> raster_layer <- raster(ncols=pwidth, nrows=pheight,
>>
>> +                        xmn=xmin(r.ex), xmx=xmax(r.ex),
>> +                        ymn=ymin(r.ex), ymx=ymax(r.ex),
>> +                        crs=CRS(projection(bigraster)))
>>>
>>> values(raster_layer) <- rep(1, pwidth*pheight)
>>
>>
>>
>>> kml_open(file.name<http://file.name>="test.kml",
>>
>> +   folder.name<http://folder.name>='top_folder',
>> +   kml_visibility=TRUE)
>> KML file opened for writing...
>>>
>>> kml_layer.Raster(raster_layer, folder.name<http://folder.name>='raster_sub_folder',
>>
>> +   plot.legend=TRUE,
>> +   metadata=NULL,
>> +   colour=e.cRampPalette(255),
>> +   raster_name='raster_layer',
>> +   layer.name<http://layer.name>=names(raster_layer)[1],
>> +   png.width=1000,
>> +   png.height=833
>> + )
>>
>> Error in setValues(x, value) :
>>    values must be numeric, integer, logical or factor
>>
>>> kml_close(file.name<http://file.name>="test.kml")
>>
>>
>> Closing  test.kml
>>
>> Traceback:
>> traceback()
>> 6: stop("values must be numeric, integer, logical or factor")
>> 5: setValues(x, value)
>> 4: setValues(x, value)
>> 3: `values<-`(`*tmp*`, value = c("#000000", "#010101", "#020202",
>>     "#030303", "#040404", "#060606", "#070707", "#080808", "#090909",
>>     "#0A0A0A", "#0C0C0C", "#0D0D0D", "#0E0E0E", "#0F0F0F", "#0F0F0F",
>>     "#101010", "#111111", "#121212", "#131313", "#141414", "#141414",
>>     "#151515", "#161616", "#161616", "#171717", "#181818", "#181818",
>>     "#191919", "#1A1A1A", "#1A1A1A", "#1B1B1B", "#1C1C1C", "#1C1C1C",
>>     "#1D1D1D", "#1E1E1E", "#1E1E1E", "#1F1F1F", "#202020", "#202020",
>>     "#212121", "#222222", "#222222", "#232323", "#242424", "#242424",
>>     "#252525", "#262626", "#272727", "#272727", "#282828", "#292929",
>>     "#292929", "#2A2A2A", "#2B2B2B", "#2B2B2B", "#2C2C2C", "#2D2D2D",
>>     "#2E2E2E", "#2E2E2E", "#2F2F2F", "#303030", "#303030", "#313131",
>>     "#323232", "#333333", "#333333", "#343434", "#353535", "#363636",
>>     "#363636", "#373737", "#383838", "#383838", "#393939", "#3A3A3A",
>>     "#3B3B3B", "#3B3B3B", "#3C3C3C", "#3D3D3D", "#3E3E3E", "#3E3E3E",
>>
>> ...
>>
>>     ))
>>
>> 2: `values<-`(`*tmp*`, value = c("#000000", "#010101", "#020202",
>>     "#030303", "#040404", "#060606", "#070707", "#080808", "#090909",
>>     "#0A0A0A", "#0C0C0C", "#0D0D0D", "#0E0E0E", "#0F0F0F", "#0F0F0F",
>>     "#101010", "#111111", "#121212", "#131313", "#141414", "#141414",
>>     "#151515", "#161616", "#161616", "#171717", "#181818", "#181818",
>>     "#565656", "#575757", "#585858", "#595959", "#5A5A5A", "#5A5A5A",
>> ...
>>
>>   ))
>>
>> 1: kml_layer.Raster(raster_layer, folder.name<http://folder.name> = "raster_sub_folder",
>>         plot.legend = TRUE, metadata = NULL, colour = e.cRampPalette(255),
>>         raster_name = "raster_layer", layer.name<http://layer.name> = names(raster_layer)[1],
>>         png.width = 1000, png.height = 833)
>>
>>
>> And when I'm trying to use colour_scheme I'm gettiing an error that lets me
>> assume that kml_layer.Raster is not compatible with 'raster':
>>
>> kml_open(file.name<http://file.name>="test.kml",
>> +   folder.name<http://folder.name>='top_folder',
>> +   kml_visibility=TRUE)
>> KML file opened for writing...
>>>
>>> kml_layer.Raster(raster_layer, folder.name<http://folder.name>='raster_sub_folder',
>>
>> +   plot.legend=TRUE,
>> +   metadata=NULL,
>> +   colour_scheme=e.cRampPalette(255),
>> +   raster_name='raster_layer',
>> +   layer.name<http://layer.name>=names(raster_layer)[1],
>> +   png.width=1000,
>> +   png.height=833
>> + )
>>
>> Error in is.factor(obj at data[, 1]) :
>>    error in evaluating the argument 'x' in selecting a method for function
>> 'is.factor': Error in obj at data[, 1] : object of type 'S4' is not subsettable
>>
>>> kml_close(file.name<http://file.name>="test.kml")
>>
>> Closing  test.kml
>>
>>> traceback()
>>
>> 2: is.factor(obj at data[, 1])
>> 1: kml_layer.Raster(raster_layer, folder.name<http://folder.name> = "raster_sub_folder",
>>         plot.legend = TRUE, metadata = NULL, colour_scheme =
>> e.cRampPalette(255),
>>         raster_name = "raster_layer", layer.name<http://layer.name> = names(raster_layer)[1],
>>         png.width = 1000, png.height = 833)
>>
>> On Thu, Nov 6, 2014 at 10:52 PM, Frede Aakmann T?gersen <frtog at vestas.com<mailto:frtog at vestas.com>>
>> wrote:
>>
>>> Hi Andreas
>>>
>>> Can you provide a small example showing the details of what you're trying
>>> to do. I don't think that anyone can help you with the little information
>>> you have given.
>>>
>>> If you do not have any example please show us the output from traceback()
>>> immediately after the error.
>>>
>>> I don't think this has anything to do with NA's in your data values as I
>>> don't get any errors doing this (from man of kml_layer.Raster):
>>>
>>>
>>> data(eberg_grid)
>>> library(sp)
>>> coordinates(eberg_grid) <- ~x+y
>>> gridded(eberg_grid) <- TRUE
>>> proj4string(eberg_grid) <- CRS("+init=epsg:31467")
>>> data(SAGA_pal)
>>> library(raster)
>>> r <- raster(eberg_grid["TWISRT6"])
>>>
>>> ## Put some NA's into data
>>> r at data@values[1:10] <- NA
>>>
>>> kml(r, colour_scale = SAGA_pal[[1]], colour = TWISRT6)
>>>
>>>
>>>
>>>
>>> Yours sincerely / Med venlig hilsen
>>>
>>>
>>> Frede Aakmann T?gersen
>>> Specialist, M.Sc., Ph.D.
>>> Plant Performance & Modeling
>>>
>>> Technology & Service Solutions
>>> T +45 9730 5135
>>> M +45 2547 6050
>>> frtog at vestas.com<mailto:frtog at vestas.com>
>>> http://www.vestas.com
>>>
>>> Company reg. name: Vestas Wind Systems A/S
>>> This e-mail is subject to our e-mail disclaimer statement.
>>> Please refer to www.vestas.com/legal/notice<http://www.vestas.com/legal/notice>
>>> If you have received this e-mail in error please contact the sender.
>>>
>>>
>>>> -----Original Message-----
>>>> From: r-sig-geo-bounces at r-project.org<mailto:r-sig-geo-bounces at r-project.org> [mailto:r-sig-geo-bounces at r-<mailto:r-sig-geo-bounces at r->
>>>> project.org<http://project.org>] On Behalf Of Andreas Gros
>>>> Sent: 6. november 2014 23:47
>>>> To: r-sig-geo at r-project.org<mailto:r-sig-geo at r-project.org>
>>>> Subject: [R-sig-Geo] plotKML kml_layer.Raster problem
>>>>
>>>> In version 0.4-6 of plotKML, when I'm adding a kml_layer.Raster (single
>>>> layer, no stack/brick) to a kml file, I get the following error message:
>>>>
>>>> Error in setValues(x, value) :
>>>> values must be numeric, integer, logical or factor
>>>>
>>>>
>>>> The values in the raster range between -57 and 2000 and it also occurs
>>>
>>> if I
>>>>
>>>> replace NA values first with some arbitrary numerical value.
>>>> Has anyone come across this problem and knows how to fix/circumnavigate
>>>> it?
>>>>
>>>> Thanks!
>>>>
>>>>        [[alternative HTML version deleted]]
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at r-project.org<mailto:R-sig-Geo at r-project.org>
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>>
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org<mailto:R-sig-Geo at r-project.org>
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>

	[[alternative HTML version deleted]]


From andigros72 at gmail.com  Thu Nov 13 20:17:12 2014
From: andigros72 at gmail.com (Andreas Gros)
Date: Thu, 13 Nov 2014 11:17:12 -0800
Subject: [R-sig-Geo] plotKML kml_layer.Raster problem
In-Reply-To: <B078CDF40DFE4045AF172A8B4F68FC4857C9CFE55A@DKRDSEXC016.vestas.net>
References: <CAJPy8YXfgejRSVEMXfgxUQvixH3w4NROaLbJPJQ01m54r967Hg@mail.gmail.com>
	<B078CDF40DFE4045AF172A8B4F68FC4857C9BA33B8@DKRDSEXC016.vestas.net>
	<CAJPy8YUFh2425cBUkdCu3q81PmtE6POUrXpKvJQ7pXn=YKWK0w@mail.gmail.com>
	<54608D02.5020700@spatial-analyst.net>
	<CAJPy8YXJ+1cLNpAOZsxsvZ7e9jzLNxRvMk7ZnvFKf+x3Gdkenw@mail.gmail.com>
	<B078CDF40DFE4045AF172A8B4F68FC4857C9CFE55A@DKRDSEXC016.vestas.net>
Message-ID: <CAJPy8YX1od9sTuCm_Q0RkFNU6j-cMKaTS3aTWxTFHScK8vDD6g@mail.gmail.com>

My bad! Thanks a lot, Frede!

On Wed, Nov 12, 2014 at 10:42 PM, Frede Aakmann T?gersen <frtog at vestas.com>
wrote:

> Hi
>
>
>
> Tomislav has already given you the answer to this problem. Did you read
> http://cran.r-project.org/web/packages/plotKML/vignettes/jss1079.pdf as
> he suggested. There you can see the solution on e.g. page 9. The same thing
> you can see in ?kml for the eberg raster:
>
>
>
>
>
> > data(eberg)
>
>
>
> > names(eberg)
>
> [1] "ID"       "soiltype" "TAXGRSC"  "X"        "Y"        "UHDICM_A"
>
> [7] "LHDICM_A" "SNDMHT_A" "SLTMHT_A" "CLYMHT_A" "UHDICM_B" "LHDICM_B"
>
> [13] "SNDMHT_B" "SLTMHT_B" "CLYMHT_B" "UHDICM_C" "LHDICM_C" "SNDMHT_C"
>
> [19] "SLTMHT_C" "CLYMHT_C" "UHDICM_D" "LHDICM_D" "SNDMHT_D" "SLTMHT_D"
>
> [25] "CLYMHT_D" "UHDICM_E" "LHDICM_E" "SNDMHT_E" "SLTMHT_E" "CLYMHT_E"
>
> >
>
>
>
> # Plot using aesthetics
>
> kml(eberg, colour = SNDMHT_A, size = CLYMHT_A, alpha = 0.75, file =
> "eberg-1.kml")
>
>
>
> You can see that colour is set to the SNDMHT_A layer without apostrophes.
>
>
>
> For your raster we have
>
>
>
> > names(raster_layer)
>
> [1] "layer"
>
> >
>
>
>
> So don?t use
>
>
>
> colour=names(raster_layer)[1],
>
>
>
> but
>
>
>
> colour=layer
>
>
>
> Yours sincerely / Med venlig hilsen
>
>
> *Frede Aakmann T?gersen*
> Specialist, M.Sc., Ph.D.
> Plant Performance & Modeling
>
> *Technology & Service Solutions*
> T +45 9730 5135
> M +45 2547 6050
> frtog at vestas.com
> http://www.vestas.com
>
> Company reg. name: Vestas Wind Systems A/S
> This e-mail is subject to our e-mail disclaimer statement.
> Please refer to www.vestas.com/legal/notice
> If you have received this e-mail in error please contact the sender.
>
>
>
> *From:* Andreas Gros [mailto:andigros72 at gmail.com]
> *Sent:* 12. november 2014 20:55
> *To:* Tomislav Hengl
> *Cc:* Frede Aakmann T?gersen; r-sig-geo at r-project.org
> *Subject:* Re: [R-sig-Geo] plotKML kml_layer.Raster problem
>
>
>
> Thanks guys, but I still get the same error in this little toy example:
>
>
>
> library(raster)
> library(plotKML)
>
> e.cRampPalette = colorRampPalette(
>   c("black", "lightgray"), 1,
>   space=c("Lab"),
>   interpolate=c("spline"))
>
> pwidth = 50
> pheight = 50
>
> r.ex <- extent(0, 1, 0, 1)
> pproj <- "+proj=longlat +ellps=WGS84 +datum=WGS84"
> raster_layer <- raster(ncols=pwidth, nrows=pheight,
>                        xmn=xmin(r.ex), xmx=xmax(r.ex),
>                        ymn=ymin(r.ex), ymx=ymax(r.ex),
>                        crs=pproj)
>
> values(raster_layer) <- rep(1, pwidth*pheight)
>
> kml_open(file.name="test.kml",
>   folder.name='top_folder',
>   kml_visibility=TRUE)
> kml_layer.Raster(raster_layer, folder.name='raster_sub_folder',
>   plot.legend=TRUE,
>   metadata=NULL,
>   colour=names(raster_layer)[1],
>   colour_scale=e.cRampPalette(255),
>   raster_name='raster_layer',
>   layer.name=names(raster_layer)[1],
>   png.width=50,
>   png.height=50
> )
> kml_close(file.name="test.kml")
>
> >
> Error in setValues(x, value) :
> values must be numeric, integer, logical or factor
>
> > names(raster_layer)[1]
> [1] "layer"
> > raster_layer[["layer"]]
> class       : RasterLayer
> dimensions  : 50, 50, 2500  (nrow, ncol, ncell)
> resolution  : 0.02, 0.02  (x, y)
> extent      : 0, 1, 0, 1  (xmin, xmax, ymin, ymax)
> coord. ref. : +proj=longlat +ellps=WGS84 +datum=WGS84
> data source : in memory
> names       : layer
> values      : 1, 1  (min, max)
>
> > traceback()
> 6: stop("values must be numeric, integer, logical or factor")
> 5: setValues(x, value)
> 4: setValues(x, value)
> 3: `values<-`(`*tmp*`, value = "layer")
> 2: `values<-`(`*tmp*`, value = "layer")
> 1: kml_layer.Raster(raster_layer, folder.name = "raster_sub_folder",
>        plot.legend = TRUE, metadata = NULL, colour =
> names(raster_layer)[1],
>        colour_scale = e.cRampPalette(255), raster_name = "raster_layer",
>        layer.name = names(raster_layer)[1], png.width = 50, png.height =
> 50)
> >
>
>
> On Mon, Nov 10, 2014 at 2:01 AM, Tomislav Hengl <hengl at spatial-analyst.net>
> wrote:
> >
> >
> > The argument "colour" is reserved for the target variable (name,
> function/call or vector). plotKML allows users to visualize multiple
> variables using different aesthetics (
> http://plotkml.r-forge.r-project.org/aesthetics.html), so in your case
> this would be "colour = layer, colour_scale = e.cRampPalette(255)",
> although it might take you few iterations until you get the right legend /
> PNG output.
> >
> > To learn how to use lower level functions such as kml_layer.Raster maybe
> first study the package vignette (
> http://cran.r-project.org/web/packages/plotKML/vignettes/jss1079.pdf)
> and/or the package tutorial (
> http://gsif.isric.org/doku.php?id=wiki:tutorial_plotkml).
> >
> > Sorry for some confusion between "colour" and "colour_scale".
> >
> > T. Hengl
> >
> >
> >
> > On 8-11-2014 1:12, Andreas Gros wrote:
> >>
> >> Hi Frede,
> >>
> >> This is the test case (using just values of 1): (traceback() below)
> >>
> >> pheight = 100
> >> pwidth = 200
> >>
> >>> raster_layer <- raster(ncols=pwidth, nrows=pheight,
> >>
> >> +                        xmn=xmin(r.ex), xmx=xmax(r.ex),
> >> +                        ymn=ymin(r.ex), ymx=ymax(r.ex),
> >> +                        crs=CRS(projection(bigraster)))
> >>>
> >>> values(raster_layer) <- rep(1, pwidth*pheight)
> >>
> >>
> >>
> >>> kml_open(file.name="test.kml",
> >>
> >> +   folder.name='top_folder',
> >> +   kml_visibility=TRUE)
> >> KML file opened for writing...
> >>>
> >>> kml_layer.Raster(raster_layer, folder.name='raster_sub_folder',
> >>
> >> +   plot.legend=TRUE,
> >> +   metadata=NULL,
> >> +   colour=e.cRampPalette(255),
> >> +   raster_name='raster_layer',
> >> +   layer.name=names(raster_layer)[1],
> >> +   png.width=1000,
> >> +   png.height=833
> >> + )
> >>
> >> Error in setValues(x, value) :
> >>    values must be numeric, integer, logical or factor
> >>
> >>> kml_close(file.name="test.kml")
> >>
> >>
> >> Closing  test.kml
> >>
> >> Traceback:
> >> traceback()
> >> 6: stop("values must be numeric, integer, logical or factor")
> >> 5: setValues(x, value)
> >> 4: setValues(x, value)
> >> 3: `values<-`(`*tmp*`, value = c("#000000", "#010101", "#020202",
> >>     "#030303", "#040404", "#060606", "#070707", "#080808", "#090909",
> >>     "#0A0A0A", "#0C0C0C", "#0D0D0D", "#0E0E0E", "#0F0F0F", "#0F0F0F",
> >>     "#101010", "#111111", "#121212", "#131313", "#141414", "#141414",
> >>     "#151515", "#161616", "#161616", "#171717", "#181818", "#181818",
> >>     "#191919", "#1A1A1A", "#1A1A1A", "#1B1B1B", "#1C1C1C", "#1C1C1C",
> >>     "#1D1D1D", "#1E1E1E", "#1E1E1E", "#1F1F1F", "#202020", "#202020",
> >>     "#212121", "#222222", "#222222", "#232323", "#242424", "#242424",
> >>     "#252525", "#262626", "#272727", "#272727", "#282828", "#292929",
> >>     "#292929", "#2A2A2A", "#2B2B2B", "#2B2B2B", "#2C2C2C", "#2D2D2D",
> >>     "#2E2E2E", "#2E2E2E", "#2F2F2F", "#303030", "#303030", "#313131",
> >>     "#323232", "#333333", "#333333", "#343434", "#353535", "#363636",
> >>     "#363636", "#373737", "#383838", "#383838", "#393939", "#3A3A3A",
> >>     "#3B3B3B", "#3B3B3B", "#3C3C3C", "#3D3D3D", "#3E3E3E", "#3E3E3E",
> >>
> >> ...
> >>
> >>     ))
> >>
> >> 2: `values<-`(`*tmp*`, value = c("#000000", "#010101", "#020202",
> >>     "#030303", "#040404", "#060606", "#070707", "#080808", "#090909",
> >>     "#0A0A0A", "#0C0C0C", "#0D0D0D", "#0E0E0E", "#0F0F0F", "#0F0F0F",
> >>     "#101010", "#111111", "#121212", "#131313", "#141414", "#141414",
> >>     "#151515", "#161616", "#161616", "#171717", "#181818", "#181818",
> >>     "#565656", "#575757", "#585858", "#595959", "#5A5A5A", "#5A5A5A",
> >> ...
> >>
> >>   ))
> >>
> >> 1: kml_layer.Raster(raster_layer, folder.name = "raster_sub_folder",
> >>         plot.legend = TRUE, metadata = NULL, colour =
> e.cRampPalette(255),
> >>         raster_name = "raster_layer", layer.name =
> names(raster_layer)[1],
> >>         png.width = 1000, png.height = 833)
> >>
> >>
> >> And when I'm trying to use colour_scheme I'm gettiing an error that
> lets me
> >> assume that kml_layer.Raster is not compatible with 'raster':
> >>
> >> kml_open(file.name="test.kml",
> >> +   folder.name='top_folder',
> >> +   kml_visibility=TRUE)
> >> KML file opened for writing...
> >>>
> >>> kml_layer.Raster(raster_layer, folder.name='raster_sub_folder',
> >>
> >> +   plot.legend=TRUE,
> >> +   metadata=NULL,
> >> +   colour_scheme=e.cRampPalette(255),
> >> +   raster_name='raster_layer',
> >> +   layer.name=names(raster_layer)[1],
> >> +   png.width=1000,
> >> +   png.height=833
> >> + )
> >>
> >> Error in is.factor(obj at data[, 1]) :
> >>    error in evaluating the argument 'x' in selecting a method for
> function
> >> 'is.factor': Error in obj at data[, 1] : object of type 'S4' is not
> subsettable
> >>
> >>> kml_close(file.name="test.kml")
> >>
> >> Closing  test.kml
> >>
> >>> traceback()
> >>
> >> 2: is.factor(obj at data[, 1])
> >> 1: kml_layer.Raster(raster_layer, folder.name = "raster_sub_folder",
> >>         plot.legend = TRUE, metadata = NULL, colour_scheme =
> >> e.cRampPalette(255),
> >>         raster_name = "raster_layer", layer.name =
> names(raster_layer)[1],
> >>         png.width = 1000, png.height = 833)
> >>
> >> On Thu, Nov 6, 2014 at 10:52 PM, Frede Aakmann T?gersen <
> frtog at vestas.com>
> >> wrote:
> >>
> >>> Hi Andreas
> >>>
> >>> Can you provide a small example showing the details of what you're
> trying
> >>> to do. I don't think that anyone can help you with the little
> information
> >>> you have given.
> >>>
> >>> If you do not have any example please show us the output from
> traceback()
> >>> immediately after the error.
> >>>
> >>> I don't think this has anything to do with NA's in your data values as
> I
> >>> don't get any errors doing this (from man of kml_layer.Raster):
> >>>
> >>>
> >>> data(eberg_grid)
> >>> library(sp)
> >>> coordinates(eberg_grid) <- ~x+y
> >>> gridded(eberg_grid) <- TRUE
> >>> proj4string(eberg_grid) <- CRS("+init=epsg:31467")
> >>> data(SAGA_pal)
> >>> library(raster)
> >>> r <- raster(eberg_grid["TWISRT6"])
> >>>
> >>> ## Put some NA's into data
> >>> r at data@values[1:10] <- NA
> >>>
> >>> kml(r, colour_scale = SAGA_pal[[1]], colour = TWISRT6)
> >>>
> >>>
> >>>
> >>>
> >>> Yours sincerely / Med venlig hilsen
> >>>
> >>>
> >>> Frede Aakmann T?gersen
> >>> Specialist, M.Sc., Ph.D.
> >>> Plant Performance & Modeling
> >>>
> >>> Technology & Service Solutions
> >>> T +45 9730 5135
> >>> M +45 2547 6050
> >>> frtog at vestas.com
> >>> http://www.vestas.com
> >>>
> >>> Company reg. name: Vestas Wind Systems A/S
> >>> This e-mail is subject to our e-mail disclaimer statement.
> >>> Please refer to www.vestas.com/legal/notice
> >>> If you have received this e-mail in error please contact the sender.
> >>>
> >>>
> >>>> -----Original Message-----
> >>>> From: r-sig-geo-bounces at r-project.org [mailto:r-sig-geo-bounces at r-
> >>>> project.org] On Behalf Of Andreas Gros
> >>>> Sent: 6. november 2014 23:47
> >>>> To: r-sig-geo at r-project.org
> >>>> Subject: [R-sig-Geo] plotKML kml_layer.Raster problem
> >>>>
> >>>> In version 0.4-6 of plotKML, when I'm adding a kml_layer.Raster
> (single
> >>>> layer, no stack/brick) to a kml file, I get the following error
> message:
> >>>>
> >>>> Error in setValues(x, value) :
> >>>> values must be numeric, integer, logical or factor
> >>>>
> >>>>
> >>>> The values in the raster range between -57 and 2000 and it also occurs
> >>>
> >>> if I
> >>>>
> >>>> replace NA values first with some arbitrary numerical value.
> >>>> Has anyone come across this problem and knows how to
> fix/circumnavigate
> >>>> it?
> >>>>
> >>>> Thanks!
> >>>>
> >>>>        [[alternative HTML version deleted]]
> >>>>
> >>>> _______________________________________________
> >>>> R-sig-Geo mailing list
> >>>> R-sig-Geo at r-project.org
> >>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >>>
> >>>
> >>
> >>         [[alternative HTML version deleted]]
> >>
> >> _______________________________________________
> >> R-sig-Geo mailing list
> >> R-sig-Geo at r-project.org
> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >>
>
>

	[[alternative HTML version deleted]]


From steven.ranney at gmail.com  Fri Nov 14 01:11:36 2014
From: steven.ranney at gmail.com (Steven Ranney)
Date: Thu, 13 Nov 2014 17:11:36 -0700
Subject: [R-sig-Geo] "Merge" shapefiles
Message-ID: <CANDt99rfvZLg_zj7QR1pHvW0apFhzv=8xMvLwKeTqQcA=hcXfQ@mail.gmail.com>

All -

I am slowly learning more about spatial data in R.  However, I am still a
relative neophyte.

What I want to do:

I have two shapefiles, shpA has ~401,000 individual polygons with
attributes.  shpB is a subset of those polygons with different attribute
data.  Even though shpB is a subset of those data, there may be multiple
rows for a given polyon, thus giving shpB more total rows (~780,000).

Effectively, I want to merge these two shapefiles.  With two dataFrame
objects in R, I would merge them like

merge(shpA, shpB, by = "APN_LABEL", all = TRUE)

but apparently, this doesn't work with shapefiles.  I have tried

merge(shpA at data, shpB at data, by = "APN_LABEL", all = TRUE)

which creates a dataFrame of the the two files but drops all of the spatial
geometries.

I've looked into gUnion() as it seems like that may be what I'm looking
for, but I get the following error:

tmp <- gUnion(shpA, shpB)
Error in RGEOSBinTopoFunc(spgeom1, spgeom2, byid, id, drop_lower_td,
"rgeos_union") :
  std::bad_alloc

Ultimately, I want a shapeFile of all ~401,000 geometries in shpA that
includes ALL of the attribute data from shpB that may exist in multiple
rows for a given polygon.

Is this possible?  Is this simple?

Steven H. Ranney

	[[alternative HTML version deleted]]


From tyler.j.frazier at icloud.com  Fri Nov 14 10:29:30 2014
From: tyler.j.frazier at icloud.com (Tyler Frazier)
Date: Fri, 14 Nov 2014 10:29:30 +0100
Subject: [R-sig-Geo] "Merge" shapefiles
In-Reply-To: <CANDt99rfvZLg_zj7QR1pHvW0apFhzv=8xMvLwKeTqQcA=hcXfQ@mail.gmail.com>
References: <CANDt99rfvZLg_zj7QR1pHvW0apFhzv=8xMvLwKeTqQcA=hcXfQ@mail.gmail.com>
Message-ID: <333A9F72-96F9-4E37-96A0-B679F4B2941F@icloud.com>

Not to belittle the spatial capabilities of R, but this sounds like a function that would be better addressed with PostgreSQL/postgis.  Integrating r & pgsql can be a good combination.

Sent from my iPhone

> On Nov 14, 2014, at 1:11 AM, Steven Ranney <steven.ranney at gmail.com> wrote:
> 
> All -
> 
> I am slowly learning more about spatial data in R.  However, I am still a
> relative neophyte.
> 
> What I want to do:
> 
> I have two shapefiles, shpA has ~401,000 individual polygons with
> attributes.  shpB is a subset of those polygons with different attribute
> data.  Even though shpB is a subset of those data, there may be multiple
> rows for a given polyon, thus giving shpB more total rows (~780,000).
> 
> Effectively, I want to merge these two shapefiles.  With two dataFrame
> objects in R, I would merge them like
> 
> merge(shpA, shpB, by = "APN_LABEL", all = TRUE)
> 
> but apparently, this doesn't work with shapefiles.  I have tried
> 
> merge(shpA at data, shpB at data, by = "APN_LABEL", all = TRUE)
> 
> which creates a dataFrame of the the two files but drops all of the spatial
> geometries.
> 
> I've looked into gUnion() as it seems like that may be what I'm looking
> for, but I get the following error:
> 
> tmp <- gUnion(shpA, shpB)
> Error in RGEOSBinTopoFunc(spgeom1, spgeom2, byid, id, drop_lower_td,
> "rgeos_union") :
>  std::bad_alloc
> 
> Ultimately, I want a shapeFile of all ~401,000 geometries in shpA that
> includes ALL of the attribute data from shpB that may exist in multiple
> rows for a given polygon.
> 
> Is this possible?  Is this simple?
> 
> Steven H. Ranney
> 
>    [[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From Roger.Bivand at nhh.no  Fri Nov 14 11:23:01 2014
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 14 Nov 2014 11:23:01 +0100
Subject: [R-sig-Geo] "Merge" shapefiles
In-Reply-To: <333A9F72-96F9-4E37-96A0-B679F4B2941F@icloud.com>
References: <CANDt99rfvZLg_zj7QR1pHvW0apFhzv=8xMvLwKeTqQcA=hcXfQ@mail.gmail.com>
	<333A9F72-96F9-4E37-96A0-B679F4B2941F@icloud.com>
Message-ID: <alpine.LRH.2.03.1411141054290.7173@reclus.nhh.no>

On Fri, 14 Nov 2014, Tyler Frazier wrote:

> Not to belittle the spatial capabilities of R, but this sounds like a 
> function that would be better addressed with PostgreSQL/postgis. 
> Integrating r & pgsql can be a good combination.

Maybe, but clarity of thinking is perhaps what is needed, it always helps 
more than guesswork. If you already know PostGIS, you'd also need clarity 
of thinking, and the steps would be very similar, although with the 
possibility to link identical objects.

>
> Sent from my iPhone
>
>> On Nov 14, 2014, at 1:11 AM, Steven Ranney <steven.ranney at gmail.com> wrote:
>>
>> All -
>>
>> I am slowly learning more about spatial data in R.  However, I am still 
>> a relative neophyte.
>>
>> What I want to do:
>>
>> I have two shapefiles, shpA has ~401,000 individual polygons with
>> attributes.  shpB is a subset of those polygons with different attribute
>> data.  Even though shpB is a subset of those data, there may be multiple
>> rows for a given polyon, thus giving shpB more total rows (~780,000).
>>

You must decide what you want to do in detail, for instance whether these 
representations make any sense. You do not provide a motivation or an 
affiliation, which make it hard to guess your application domain (ecology, 
real estate, whatever).

You have ~401,000 individual polygons with IDs and some data, are they 
unique? Do they overlap? Are they home ranges (which may overlap), census 
blocks (which shouldn't)?

Then you have extra data that happens to be in a messy shapefile with 
repeated geometries, all of which match some of those in the the first 
data set (it never needed to be a shapefile, and probably never should 
have been). Can you match them by ID (match() is much stronger than 
merge(), because it shows you what is matching)?

Note that you expect to get >=0 matches on each geometry from the first 
object, you need to control what is going on, because the maximum number 
of matches will determine the number of columns in the output (with lots 
of missing values where there are fewer than this. Are the repeat 
geometries there because the repeats are at different times? Should you be 
trying to construct an appropriate space-time object if this is the case?


>> Effectively, I want to merge these two shapefiles.  With two dataFrame
>> objects in R, I would merge them like
>>
>> merge(shpA, shpB, by = "APN_LABEL", all = TRUE)
>>
>> but apparently, this doesn't work with shapefiles.  I have tried
>>
>> merge(shpA at data, shpB at data, by = "APN_LABEL", all = TRUE)
>>
>> which creates a dataFrame of the the two files but drops all of the spatial
>> geometries.

Yes, of course, what did you expect? The only references available say 
that there is no merge method for Spatial* objects, and you are anyway 
taking their data slots, which are data frames. If the output object has 
the same number of rows as shpA, and its row.names() matches that of shpA, 
you may have what you want (create a new SPDF object with the 
SpatialPolygons from shpA, and the output from merge as its data slot), 
but beware of merge() re-ordering rows. This is, however dependent on 
prior checking for consistency in the IDs.

>>
>> I've looked into gUnion() as it seems like that may be what I'm looking
>> for, but I get the following error:

Just fishing without understanding is always pretty hopeless. Why would 
you expect that a function that is declared to only handle geometries 
could sort out your data cleaning problem?

>>
>> tmp <- gUnion(shpA, shpB)
>> Error in RGEOSBinTopoFunc(spgeom1, spgeom2, byid, id, drop_lower_td,
>> "rgeos_union") :
>>  std::bad_alloc
>>
>> Ultimately, I want a shapeFile of all ~401,000 geometries in shpA that
>> includes ALL of the attribute data from shpB that may exist in multiple
>> rows for a given polygon.

Yes, but you need to think first; I'm not even sure why these polygons 
might be meaningful anyway - you didn't say. Guessing by function name 
really doesn't help. Did reading the "combine_maptools" vignette help?

http://cran.r-project.org/web/packages/maptools/vignettes/combine_maptools.pdf

Hope this clarifies,

Roger

>>
>> Is this possible?  Is this simple?
>>
>> Steven H. Ranney
>>
>>    [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no


From r.hijmans at gmail.com  Fri Nov 14 21:49:52 2014
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Fri, 14 Nov 2014 12:49:52 -0800
Subject: [R-sig-Geo] "Merge" shapefiles
In-Reply-To: <alpine.LRH.2.03.1411141054290.7173@reclus.nhh.no>
References: <CANDt99rfvZLg_zj7QR1pHvW0apFhzv=8xMvLwKeTqQcA=hcXfQ@mail.gmail.com>
	<333A9F72-96F9-4E37-96A0-B679F4B2941F@icloud.com>
	<alpine.LRH.2.03.1411141054290.7173@reclus.nhh.no>
Message-ID: <CANtt_hxDzauaXY4zyYUPJ5X7hk9VWMhLdS5mO0N39ce+W6LwXg@mail.gmail.com>

Steven,

Please do provide a self-contained example when you ask a question
(see my example below) and try to use correct terms. You are dealing
with SpatialPolygonDataFrame objects (shpA, shpB), these objects are
perhaps derived from shapefiles, but it is not what they are.  Also,
providing a motivation is very important, particularly if you are self
proclaimed newbie. I think that merge should be able to deal with this
case, for if you really want it, through an argument in the function
that with give you an error for the default value, because in most
practical cases this truly reveals an error.

Here is an example of a route you might take. Please carefully check
if it does what you need (I did not do that).

Robert


library(raster)

# Get a SpatialPolygonsDataFrame
p <- shapefile(system.file("external/lux.shp", package="raster"))

# make a subset
s <- p[1:3, ]

# merge (combines a Spatial* object with a data.frame. ID_2 is a unique ID
m <- merge(p, data.frame(s), all=TRUE, by='ID_2')

# makes a subset with multiple instances of the same polygon
ss <- bind(s, s[1:2,])
# add something unique to each record
ss$newvar <- 1:nrow(ss)

# merge fails now
# you should have shown us something like this. There very little
value in talking about shpA and shpB as we do not have not have (or
want) access to the data

m <- merge(p, data.frame(ss), all=TRUE, by='ID_2')

# this is the error.
# Error in .local(x, y, ...) :
#  'y' has multiple records for one or more 'by.y' key(s)


# so let's merge the data.frames (using two Spatial Objects)
d <- merge(p, ss, all=TRUE, by='ID_2')

# link table d to SpatialPolgyons object with all records, p
i <- match(d$ID_2, p$ID_2)

# get the polygons we need
x <- p[i, ]

# link the polygons to the merged table
y <- SpatialPolygonsDataFrame(as(x, 'SpatialPolygons'), d, match.ID=FALSE)

# inspect
p
y
data.frame(p)
data.frame(ss)
data.frame(y)

On Fri, Nov 14, 2014 at 2:23 AM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
> On Fri, 14 Nov 2014, Tyler Frazier wrote:
>
>> Not to belittle the spatial capabilities of R, but this sounds like a
>> function that would be better addressed with PostgreSQL/postgis. Integrating
>> r & pgsql can be a good combination.
>
>
> Maybe, but clarity of thinking is perhaps what is needed, it always helps
> more than guesswork. If you already know PostGIS, you'd also need clarity of
> thinking, and the steps would be very similar, although with the possibility
> to link identical objects.
>
>>
>> Sent from my iPhone
>>
>>> On Nov 14, 2014, at 1:11 AM, Steven Ranney <steven.ranney at gmail.com>
>>> wrote:
>>>
>>> All -
>>>
>>> I am slowly learning more about spatial data in R.  However, I am still a
>>> relative neophyte.
>>>
>>> What I want to do:
>>>
>>> I have two shapefiles, shpA has ~401,000 individual polygons with
>>> attributes.  shpB is a subset of those polygons with different attribute
>>> data.  Even though shpB is a subset of those data, there may be multiple
>>> rows for a given polyon, thus giving shpB more total rows (~780,000).
>>>
>
> You must decide what you want to do in detail, for instance whether these
> representations make any sense. You do not provide a motivation or an
> affiliation, which make it hard to guess your application domain (ecology,
> real estate, whatever).
>
> You have ~401,000 individual polygons with IDs and some data, are they
> unique? Do they overlap? Are they home ranges (which may overlap), census
> blocks (which shouldn't)?
>
> Then you have extra data that happens to be in a messy shapefile with
> repeated geometries, all of which match some of those in the the first data
> set (it never needed to be a shapefile, and probably never should have
> been). Can you match them by ID (match() is much stronger than merge(),
> because it shows you what is matching)?
>
> Note that you expect to get >=0 matches on each geometry from the first
> object, you need to control what is going on, because the maximum number of
> matches will determine the number of columns in the output (with lots of
> missing values where there are fewer than this. Are the repeat geometries
> there because the repeats are at different times? Should you be trying to
> construct an appropriate space-time object if this is the case?
>
>
>>> Effectively, I want to merge these two shapefiles.  With two dataFrame
>>> objects in R, I would merge them like
>>>
>>> merge(shpA, shpB, by = "APN_LABEL", all = TRUE)
>>>
>>> but apparently, this doesn't work with shapefiles.  I have tried
>>>
>>> merge(shpA at data, shpB at data, by = "APN_LABEL", all = TRUE)
>>>
>>> which creates a dataFrame of the the two files but drops all of the
>>> spatial
>>> geometries.
>
>
> Yes, of course, what did you expect? The only references available say that
> there is no merge method for Spatial* objects, and you are anyway taking
> their data slots, which are data frames. If the output object has the same
> number of rows as shpA, and its row.names() matches that of shpA, you may
> have what you want (create a new SPDF object with the SpatialPolygons from
> shpA, and the output from merge as its data slot), but beware of merge()
> re-ordering rows. This is, however dependent on prior checking for
> consistency in the IDs.
>
>>>
>>> I've looked into gUnion() as it seems like that may be what I'm looking
>>> for, but I get the following error:
>
>
> Just fishing without understanding is always pretty hopeless. Why would you
> expect that a function that is declared to only handle geometries could sort
> out your data cleaning problem?
>
>>>
>>> tmp <- gUnion(shpA, shpB)
>>> Error in RGEOSBinTopoFunc(spgeom1, spgeom2, byid, id, drop_lower_td,
>>> "rgeos_union") :
>>>  std::bad_alloc
>>>
>>> Ultimately, I want a shapeFile of all ~401,000 geometries in shpA that
>>> includes ALL of the attribute data from shpB that may exist in multiple
>>> rows for a given polygon.
>
>
> Yes, but you need to think first; I'm not even sure why these polygons might
> be meaningful anyway - you didn't say. Guessing by function name really
> doesn't help. Did reading the "combine_maptools" vignette help?
>
> http://cran.r-project.org/web/packages/maptools/vignettes/combine_maptools.pdf
>
> Hope this clarifies,
>
> Roger
>
>>>
>>> Is this possible?  Is this simple?
>>>
>>> Steven H. Ranney
>>>
>>>    [[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> --
> Roger Bivand
> Department of Economics, Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; fax +47 55 95 91 00
> e-mail: Roger.Bivand at nhh.no
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From mkborregaard at snm.ku.dk  Mon Nov 17 11:45:43 2014
From: mkborregaard at snm.ku.dk (mkborregaard)
Date: Mon, 17 Nov 2014 03:45:43 -0700 (MST)
Subject: [R-sig-Geo] shifting points in plot window
Message-ID: <1416221143594-7587439.post@n2.nabble.com>

When I plot a raster image (package raster) and then plot points on top (type
SpatialPoints, package sp) everything aligns well. But if then resize the
window, the alignment disappears, and the points move around. Can I avoid
this behavior? The points and the raster are both defined as lat/long data.
proj4string is "+proj=longlat +ellps=WGS84 +towgs84=0,0,0,0,0,0,0 +no_defs"
for both.

I am sorry for posting a very simple question that I should be able to find
the resolution of, but I have not been able to find this.




--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/shifting-points-in-plot-window-tp7587439.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From frtog at vestas.com  Mon Nov 17 14:49:55 2014
From: frtog at vestas.com (=?iso-8859-1?Q?Frede_Aakmann_T=F8gersen?=)
Date: Mon, 17 Nov 2014 14:49:55 +0100
Subject: [R-sig-Geo] shifting points in plot window
In-Reply-To: <1416221143594-7587439.post@n2.nabble.com>
References: <1416221143594-7587439.post@n2.nabble.com>
Message-ID: <B078CDF40DFE4045AF172A8B4F68FC4857C9DA28C2@DKRDSEXC016.vestas.net>

Hi

For windows() there is a rescale argument which you can set to "fit". I don't see the same argument for X11() when on unix alike OS or for any Cairo devices on iOS. 

Yours sincerely / Med venlig hilsen


Frede Aakmann T?gersen
Specialist, M.Sc., Ph.D.
Plant Performance & Modeling

Technology & Service Solutions
T +45 9730 5135
M +45 2547 6050
frtog at vestas.com
http://www.vestas.com

Company reg. name: Vestas Wind Systems A/S
This e-mail is subject to our e-mail disclaimer statement.
Please refer to www.vestas.com/legal/notice
If you have received this e-mail in error please contact the sender. 


> -----Original Message-----
> From: r-sig-geo-bounces at r-project.org [mailto:r-sig-geo-bounces at r-
> project.org] On Behalf Of mkborregaard
> Sent: 17. november 2014 11:46
> To: r-sig-geo at r-project.org
> Subject: [R-sig-Geo] shifting points in plot window
> 
> When I plot a raster image (package raster) and then plot points on top (type
> SpatialPoints, package sp) everything aligns well. But if then resize the
> window, the alignment disappears, and the points move around. Can I avoid
> this behavior? The points and the raster are both defined as lat/long data.
> proj4string is "+proj=longlat +ellps=WGS84 +towgs84=0,0,0,0,0,0,0
> +no_defs"
> for both.
> 
> I am sorry for posting a very simple question that I should be able to find
> the resolution of, but I have not been able to find this.
> 
> 
> 
> 
> --
> View this message in context: http://r-sig-
> geo.2731867.n2.nabble.com/shifting-points-in-plot-window-tp7587439.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From felipevacar at gmail.com  Mon Nov 17 16:43:30 2014
From: felipevacar at gmail.com (Felipe Vaca)
Date: Mon, 17 Nov 2014 10:43:30 -0500
Subject: [R-sig-Geo] Waze traffic jams data
Message-ID: <CADTkP-Se4mzrxs4HZhBL0Mz7nuYw=JrPqmXSFqqfr7Zk-Kp98w@mail.gmail.com>

Hi all!  Has anybody used Waze data for modelling traffic (
https://www.waze.com/). If so, have you had good/bad experiences? What
advantages/ disadvantages have you found? Further comments appreciated.
Thanks in advance!.

Felipe

	[[alternative HTML version deleted]]


From nunocesardesa at gmail.com  Tue Nov 18 18:56:24 2014
From: nunocesardesa at gmail.com (=?UTF-8?B?TnVubyBTw6E=?=)
Date: Tue, 18 Nov 2014 17:56:24 +0000
Subject: [R-sig-Geo] Question on histograms from Raster and RasterVIS
	packages
Message-ID: <CAB-ux0CMYyh_HWVWA7ZFv6WYUiQF2cCQDOJJUMMEXZanWxQ2YA@mail.gmail.com>

Hello!

My aim is to add a "Median" or a "Mean" line to an histogram plot in R.

The problem is the following:

The "hist" function from the raster package uses a maximum of 100 000
values for generating the histogram but allows me to edit the plot, so I
can easily add a line within the plot using abline.

The "histogram" function in rasterVIS uses all my dataset but does not
allow editing of the plot area, so I cannot use the abline function to add
this line (or I do not know how to do it).

If you have an alternative or a solution to work around this, I am all hears

Thank you for any help in advance!
Ciao!
-- 

Nuno C?sar de S?
+351 91 961 90 37

	[[alternative HTML version deleted]]


From tea3rd at gmail.com  Tue Nov 18 19:04:18 2014
From: tea3rd at gmail.com (Thomas Adams)
Date: Tue, 18 Nov 2014 11:04:18 -0700
Subject: [R-sig-Geo] Question on histograms from Raster and RasterVIS
	packages
In-Reply-To: <CAB-ux0CMYyh_HWVWA7ZFv6WYUiQF2cCQDOJJUMMEXZanWxQ2YA@mail.gmail.com>
References: <CAB-ux0CMYyh_HWVWA7ZFv6WYUiQF2cCQDOJJUMMEXZanWxQ2YA@mail.gmail.com>
Message-ID: <CAGxgkWgBwcVkegcXXQk98R6LLX0eBVSG+Nm5ybsrQ_xAQgFaqA@mail.gmail.com>

Nuno,

This works for me:

> require(stats)
> set.seed(14)
> x <- rchisq(100, df = 4)
>
>
> hist(x)
> meanx<-mean(x)
> meanx
[1] 3.734162
> abline(v=meanx, col="red")

Cheers!
Tom

On Tue, Nov 18, 2014 at 10:56 AM, Nuno S? <nunocesardesa at gmail.com> wrote:

> Hello!
>
> My aim is to add a "Median" or a "Mean" line to an histogram plot in R.
>
> The problem is the following:
>
> The "hist" function from the raster package uses a maximum of 100 000
> values for generating the histogram but allows me to edit the plot, so I
> can easily add a line within the plot using abline.
>
> The "histogram" function in rasterVIS uses all my dataset but does not
> allow editing of the plot area, so I cannot use the abline function to add
> this line (or I do not know how to do it).
>
> If you have an alternative or a solution to work around this, I am all
> hears
>
> Thank you for any help in advance!
> Ciao!
> --
>
> Nuno C?sar de S?
> +351 91 961 90 37
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From nunocesardesa at gmail.com  Tue Nov 18 19:21:15 2014
From: nunocesardesa at gmail.com (=?UTF-8?B?TnVubyBTw6E=?=)
Date: Tue, 18 Nov 2014 18:21:15 +0000
Subject: [R-sig-Geo] Question on histograms from Raster and RasterVIS
	packages
In-Reply-To: <CAGxgkWgBwcVkegcXXQk98R6LLX0eBVSG+Nm5ybsrQ_xAQgFaqA@mail.gmail.com>
References: <CAB-ux0CMYyh_HWVWA7ZFv6WYUiQF2cCQDOJJUMMEXZanWxQ2YA@mail.gmail.com>
	<CAGxgkWgBwcVkegcXXQk98R6LLX0eBVSG+Nm5ybsrQ_xAQgFaqA@mail.gmail.com>
Message-ID: <CAB-ux0A3AdMtztNrvfxpS4kbUzMoohx0xvWJ5K-PGQEo-gXviw@mail.gmail.com>

Hey Thomas!

Yes thanks, I know it works for the normal hist function which uses 3% of
all data (mind I am talking about rasters) which I am not sure that is a
good enough sample, I leave that question in the air

The problem is it does not work in rasterVIS (which does use all the
raster). The error it gives me is the following:

> abline(v=m.rst,col="blue",lwd=2)
Error in int_abline(a = a, b = b, h = h, v = v, untf = untf, ...) :
  plot.new has not been called yet

Regards!!
Thank you once again!
Nuno

On 18 November 2014 18:04, Thomas Adams <tea3rd at gmail.com> wrote:

> Nuno,
>
> This works for me:
>
> > require(stats)
> > set.seed(14)
> > x <- rchisq(100, df = 4)
> >
> >
> > hist(x)
> > meanx<-mean(x)
> > meanx
> [1] 3.734162
> > abline(v=meanx, col="red")
>
> Cheers!
> Tom
>
> On Tue, Nov 18, 2014 at 10:56 AM, Nuno S? <nunocesardesa at gmail.com> wrote:
>
>> Hello!
>>
>> My aim is to add a "Median" or a "Mean" line to an histogram plot in R.
>>
>> The problem is the following:
>>
>> The "hist" function from the raster package uses a maximum of 100 000
>> values for generating the histogram but allows me to edit the plot, so I
>> can easily add a line within the plot using abline.
>>
>> The "histogram" function in rasterVIS uses all my dataset but does not
>> allow editing of the plot area, so I cannot use the abline function to add
>> this line (or I do not know how to do it).
>>
>> If you have an alternative or a solution to work around this, I am all
>> hears
>>
>> Thank you for any help in advance!
>> Ciao!
>> --
>>
>> Nuno C?sar de S?
>> +351 91 961 90 37
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>
>
>
>


-- 

Nuno C?sar de S?
+351 91 961 90 37

	[[alternative HTML version deleted]]


From tea3rd at gmail.com  Tue Nov 18 19:34:23 2014
From: tea3rd at gmail.com (Thomas Adams)
Date: Tue, 18 Nov 2014 11:34:23 -0700
Subject: [R-sig-Geo] Question on histograms from Raster and RasterVIS
	packages
In-Reply-To: <CAB-ux0A3AdMtztNrvfxpS4kbUzMoohx0xvWJ5K-PGQEo-gXviw@mail.gmail.com>
References: <CAB-ux0CMYyh_HWVWA7ZFv6WYUiQF2cCQDOJJUMMEXZanWxQ2YA@mail.gmail.com>
	<CAGxgkWgBwcVkegcXXQk98R6LLX0eBVSG+Nm5ybsrQ_xAQgFaqA@mail.gmail.com>
	<CAB-ux0A3AdMtztNrvfxpS4kbUzMoohx0xvWJ5K-PGQEo-gXviw@mail.gmail.com>
Message-ID: <CAGxgkWiQ6gXyLTWagGUk4khdpmwEu0f5Uwbn7Tb_nx43WppR5g@mail.gmail.com>

Nuno,

I thought you might say that. I have used R with GRASS GIS, which
interfaces using the spgrass6 contributed package. I have analyzed some
pretty large GIS raster files, looking at radar precipitation data, and the
approach I suggested works well. The data imported into R using sp (the
basis for spgrass6) is an sp raster object. So, from the spgrass6 manual:

After loading R from the GRASS GIS terminal prompt, for example,

spear <- readRAST6(c("geology", "elevation.dem"), cat=c(TRUE, FALSE))

Try looking at this:

summary(spear)

 you can do this:

boxplot(spear$elevation.dem ~ spear$geology)

 or this, for instance :

hist(spear$elevation.dem)
meanx<-mean(spear$elevation.dem)
abline(v=meanx, col="red")

But, maybe I don't understand the problem??

Regards,
Tom


On Tue, Nov 18, 2014 at 11:21 AM, Nuno S? <nunocesardesa at gmail.com> wrote:

> Hey Thomas!
>
> Yes thanks, I know it works for the normal hist function which uses 3% of
> all data (mind I am talking about rasters) which I am not sure that is a
> good enough sample, I leave that question in the air
>
> The problem is it does not work in rasterVIS (which does use all the
> raster). The error it gives me is the following:
>
> > abline(v=m.rst,col="blue",lwd=2)
> Error in int_abline(a = a, b = b, h = h, v = v, untf = untf, ...) :
>   plot.new has not been called yet
>
> Regards!!
> Thank you once again!
> Nuno
>
> On 18 November 2014 18:04, Thomas Adams <tea3rd at gmail.com> wrote:
>
>> Nuno,
>>
>> This works for me:
>>
>> > require(stats)
>> > set.seed(14)
>> > x <- rchisq(100, df = 4)
>> >
>> >
>> > hist(x)
>> > meanx<-mean(x)
>> > meanx
>> [1] 3.734162
>> > abline(v=meanx, col="red")
>>
>> Cheers!
>> Tom
>>
>> On Tue, Nov 18, 2014 at 10:56 AM, Nuno S? <nunocesardesa at gmail.com>
>> wrote:
>>
>>> Hello!
>>>
>>> My aim is to add a "Median" or a "Mean" line to an histogram plot in R.
>>>
>>> The problem is the following:
>>>
>>> The "hist" function from the raster package uses a maximum of 100 000
>>> values for generating the histogram but allows me to edit the plot, so I
>>> can easily add a line within the plot using abline.
>>>
>>> The "histogram" function in rasterVIS uses all my dataset but does not
>>> allow editing of the plot area, so I cannot use the abline function to
>>> add
>>> this line (or I do not know how to do it).
>>>
>>> If you have an alternative or a solution to work around this, I am all
>>> hears
>>>
>>> Thank you for any help in advance!
>>> Ciao!
>>> --
>>>
>>> Nuno C?sar de S?
>>> +351 91 961 90 37
>>>
>>>         [[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>>
>>
>>
>>
>
>
> --
>
> Nuno C?sar de S?
> +351 91 961 90 37
>
>

	[[alternative HTML version deleted]]


From 538280 at gmail.com  Tue Nov 18 19:35:07 2014
From: 538280 at gmail.com (Greg Snow)
Date: Tue, 18 Nov 2014 11:35:07 -0700
Subject: [R-sig-Geo] Question on histograms from Raster and RasterVIS
	packages
In-Reply-To: <CAB-ux0A3AdMtztNrvfxpS4kbUzMoohx0xvWJ5K-PGQEo-gXviw@mail.gmail.com>
References: <CAB-ux0CMYyh_HWVWA7ZFv6WYUiQF2cCQDOJJUMMEXZanWxQ2YA@mail.gmail.com>
	<CAGxgkWgBwcVkegcXXQk98R6LLX0eBVSG+Nm5ybsrQ_xAQgFaqA@mail.gmail.com>
	<CAB-ux0A3AdMtztNrvfxpS4kbUzMoohx0xvWJ5K-PGQEo-gXviw@mail.gmail.com>
Message-ID: <CAFEqCdwnG=eSpc8NFF2oh9Kb+cWHTOCLJOiTyMVFr_w+Sd0PVQ@mail.gmail.com>

Nuno,

Does rasterVIS use base or grid graphics?

The place I usually see the error that plot.new has not been called yet is
when trying to use a base graphics function to augment a plot created using
grid graphics.  I suspect that the plot created used grid graphics and that
is why abline is not working for you.

There is a 'grid.abline' function in the grid package, though it does not
look like it would work easily for a vertical line, so you may need to dive
into the details of using grid in more detail, probably using the
grid.lines function.  There is also the gridBase package which helps grid
and base graphics play nicely together, though it could be a bit of
overkill for just adding a vertical line.

On Tue, Nov 18, 2014 at 11:21 AM, Nuno S? <nunocesardesa at gmail.com> wrote:

> Hey Thomas!
>
> Yes thanks, I know it works for the normal hist function which uses 3% of
> all data (mind I am talking about rasters) which I am not sure that is a
> good enough sample, I leave that question in the air
>
> The problem is it does not work in rasterVIS (which does use all the
> raster). The error it gives me is the following:
>
> > abline(v=m.rst,col="blue",lwd=2)
> Error in int_abline(a = a, b = b, h = h, v = v, untf = untf, ...) :
>   plot.new has not been called yet
>
> Regards!!
> Thank you once again!
> Nuno
>
> On 18 November 2014 18:04, Thomas Adams <tea3rd at gmail.com> wrote:
>
> > Nuno,
> >
> > This works for me:
> >
> > > require(stats)
> > > set.seed(14)
> > > x <- rchisq(100, df = 4)
> > >
> > >
> > > hist(x)
> > > meanx<-mean(x)
> > > meanx
> > [1] 3.734162
> > > abline(v=meanx, col="red")
> >
> > Cheers!
> > Tom
> >
> > On Tue, Nov 18, 2014 at 10:56 AM, Nuno S? <nunocesardesa at gmail.com>
> wrote:
> >
> >> Hello!
> >>
> >> My aim is to add a "Median" or a "Mean" line to an histogram plot in R.
> >>
> >> The problem is the following:
> >>
> >> The "hist" function from the raster package uses a maximum of 100 000
> >> values for generating the histogram but allows me to edit the plot, so I
> >> can easily add a line within the plot using abline.
> >>
> >> The "histogram" function in rasterVIS uses all my dataset but does not
> >> allow editing of the plot area, so I cannot use the abline function to
> add
> >> this line (or I do not know how to do it).
> >>
> >> If you have an alternative or a solution to work around this, I am all
> >> hears
> >>
> >> Thank you for any help in advance!
> >> Ciao!
> >> --
> >>
> >> Nuno C?sar de S?
> >> +351 91 961 90 37
> >>
> >>         [[alternative HTML version deleted]]
> >>
> >> _______________________________________________
> >> R-sig-Geo mailing list
> >> R-sig-Geo at r-project.org
> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >>
> >
> >
> >
> >
> >
>
>
> --
>
> Nuno C?sar de S?
> +351 91 961 90 37
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



-- 
Gregory (Greg) L. Snow Ph.D.
538280 at gmail.com

	[[alternative HTML version deleted]]


From tea3rd at gmail.com  Tue Nov 18 19:38:32 2014
From: tea3rd at gmail.com (Thomas Adams)
Date: Tue, 18 Nov 2014 11:38:32 -0700
Subject: [R-sig-Geo] Question on histograms from Raster and RasterVIS
	packages
In-Reply-To: <CAFEqCdwnG=eSpc8NFF2oh9Kb+cWHTOCLJOiTyMVFr_w+Sd0PVQ@mail.gmail.com>
References: <CAB-ux0CMYyh_HWVWA7ZFv6WYUiQF2cCQDOJJUMMEXZanWxQ2YA@mail.gmail.com>
	<CAGxgkWgBwcVkegcXXQk98R6LLX0eBVSG+Nm5ybsrQ_xAQgFaqA@mail.gmail.com>
	<CAB-ux0A3AdMtztNrvfxpS4kbUzMoohx0xvWJ5K-PGQEo-gXviw@mail.gmail.com>
	<CAFEqCdwnG=eSpc8NFF2oh9Kb+cWHTOCLJOiTyMVFr_w+Sd0PVQ@mail.gmail.com>
Message-ID: <CAGxgkWiJFnTK5JsaFytuCWKsnC0MiBEpcW=jda4kyjEUGRBn+g@mail.gmail.com>

Nuno,

Possibly having a reproducible example would help. I do all my spatial
analysis work starting from GRASS GIS and calling R from the GRASS prompt ?
this works very well.

Tom

On Tue, Nov 18, 2014 at 11:35 AM, Greg Snow <538280 at gmail.com> wrote:

> Nuno,
>
> Does rasterVIS use base or grid graphics?
>
> The place I usually see the error that plot.new has not been called yet is
> when trying to use a base graphics function to augment a plot created using
> grid graphics.  I suspect that the plot created used grid graphics and that
> is why abline is not working for you.
>
> There is a 'grid.abline' function in the grid package, though it does not
> look like it would work easily for a vertical line, so you may need to dive
> into the details of using grid in more detail, probably using the
> grid.lines function.  There is also the gridBase package which helps grid
> and base graphics play nicely together, though it could be a bit of
> overkill for just adding a vertical line.
>
> On Tue, Nov 18, 2014 at 11:21 AM, Nuno S? <nunocesardesa at gmail.com> wrote:
>
>> Hey Thomas!
>>
>> Yes thanks, I know it works for the normal hist function which uses 3% of
>> all data (mind I am talking about rasters) which I am not sure that is a
>> good enough sample, I leave that question in the air
>>
>> The problem is it does not work in rasterVIS (which does use all the
>> raster). The error it gives me is the following:
>>
>> > abline(v=m.rst,col="blue",lwd=2)
>> Error in int_abline(a = a, b = b, h = h, v = v, untf = untf, ...) :
>>   plot.new has not been called yet
>>
>> Regards!!
>> Thank you once again!
>> Nuno
>>
>> On 18 November 2014 18:04, Thomas Adams <tea3rd at gmail.com> wrote:
>>
>> > Nuno,
>> >
>> > This works for me:
>> >
>> > > require(stats)
>> > > set.seed(14)
>> > > x <- rchisq(100, df = 4)
>> > >
>> > >
>> > > hist(x)
>> > > meanx<-mean(x)
>> > > meanx
>> > [1] 3.734162
>> > > abline(v=meanx, col="red")
>> >
>> > Cheers!
>> > Tom
>> >
>> > On Tue, Nov 18, 2014 at 10:56 AM, Nuno S? <nunocesardesa at gmail.com>
>> wrote:
>> >
>> >> Hello!
>> >>
>> >> My aim is to add a "Median" or a "Mean" line to an histogram plot in R.
>> >>
>> >> The problem is the following:
>> >>
>> >> The "hist" function from the raster package uses a maximum of 100 000
>> >> values for generating the histogram but allows me to edit the plot, so
>> I
>> >> can easily add a line within the plot using abline.
>> >>
>> >> The "histogram" function in rasterVIS uses all my dataset but does not
>> >> allow editing of the plot area, so I cannot use the abline function to
>> add
>> >> this line (or I do not know how to do it).
>> >>
>> >> If you have an alternative or a solution to work around this, I am all
>> >> hears
>> >>
>> >> Thank you for any help in advance!
>> >> Ciao!
>> >> --
>> >>
>> >> Nuno C?sar de S?
>> >> +351 91 961 90 37
>> >>
>> >>         [[alternative HTML version deleted]]
>> >>
>> >> _______________________________________________
>> >> R-sig-Geo mailing list
>> >> R-sig-Geo at r-project.org
>> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> >>
>> >
>> >
>> >
>> >
>> >
>>
>>
>> --
>>
>> Nuno C?sar de S?
>> +351 91 961 90 37
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>
>
> --
> Gregory (Greg) L. Snow Ph.D.
> 538280 at gmail.com
>

	[[alternative HTML version deleted]]


From nunocesardesa at gmail.com  Tue Nov 18 20:03:15 2014
From: nunocesardesa at gmail.com (=?UTF-8?B?TnVubyBTw6E=?=)
Date: Tue, 18 Nov 2014 19:03:15 +0000
Subject: [R-sig-Geo] Question on histograms from Raster and RasterVIS
	packages
In-Reply-To: <CAGxgkWiJFnTK5JsaFytuCWKsnC0MiBEpcW=jda4kyjEUGRBn+g@mail.gmail.com>
References: <CAB-ux0CMYyh_HWVWA7ZFv6WYUiQF2cCQDOJJUMMEXZanWxQ2YA@mail.gmail.com>
	<CAGxgkWgBwcVkegcXXQk98R6LLX0eBVSG+Nm5ybsrQ_xAQgFaqA@mail.gmail.com>
	<CAB-ux0A3AdMtztNrvfxpS4kbUzMoohx0xvWJ5K-PGQEo-gXviw@mail.gmail.com>
	<CAFEqCdwnG=eSpc8NFF2oh9Kb+cWHTOCLJOiTyMVFr_w+Sd0PVQ@mail.gmail.com>
	<CAGxgkWiJFnTK5JsaFytuCWKsnC0MiBEpcW=jda4kyjEUGRBn+g@mail.gmail.com>
Message-ID: <CAB-ux0AE1rKNL6GQ+=ogukgKxgCxtjU5n-Z3q6JwXtA69FQQzw@mail.gmail.com>

Hello!

Yes, it sorted the problem but maybe not as we were expecting, you've
"liberated" me from the raster package 3% data limitation and now I can
work with it easily as a normal histogram.

Basically the trick that I got from the "readRAST6" function you suggested
is that it converts it into sp objects (SpatialGridDataFrame in this case i
guess). From here it is easy: all I need is to convert the rasters to an sp
object and from there I am back working with normal hist functions.

So, using the conversion: as(inputraster,"SpatialGridDataFrame") sorted it
out. The rest is history. I hope they update this method into the raster
package because there is no need to be limited to a 100 000 sample which is
usually kind of low for RS data.

Found a similar limitation on usdm package recently which chooses to
needlessly convert a whole raster into a data.frame before calculating VIF
between variables. For huge rasters, it would kill off the computer memory.
Because of that, I guess the authors also made a limit on the sample size
(which was not what was actually killing the computer memory)

Dr Greg

Yes, I think the rasterVIS package uses grid. maybe it can be inserted when
we call the histogram function, but making it do a vertical line might be
kind of complicated, I think just from looking to how it is called.

Thank you guys for the suggestions!!

I jump between them also, but making graphs is usually easy enough just
using R. anyway, it is so great to have all these awesome languages and
softwares linked together.

Best of luck for all!
Nuno


On 18 November 2014 18:38, Thomas Adams <tea3rd at gmail.com> wrote:

> Nuno,
>
> Possibly having a reproducible example would help. I do all my spatial
> analysis work starting from GRASS GIS and calling R from the GRASS prompt ?
> this works very well.
>
> Tom
>
> On Tue, Nov 18, 2014 at 11:35 AM, Greg Snow <538280 at gmail.com> wrote:
>
>> Nuno,
>>
>> Does rasterVIS use base or grid graphics?
>>
>> The place I usually see the error that plot.new has not been called yet
>> is when trying to use a base graphics function to augment a plot created
>> using grid graphics.  I suspect that the plot created used grid graphics
>> and that is why abline is not working for you.
>>
>> There is a 'grid.abline' function in the grid package, though it does not
>> look like it would work easily for a vertical line, so you may need to dive
>> into the details of using grid in more detail, probably using the
>> grid.lines function.  There is also the gridBase package which helps grid
>> and base graphics play nicely together, though it could be a bit of
>> overkill for just adding a vertical line.
>>
>> On Tue, Nov 18, 2014 at 11:21 AM, Nuno S? <nunocesardesa at gmail.com>
>> wrote:
>>
>>> Hey Thomas!
>>>
>>> Yes thanks, I know it works for the normal hist function which uses 3% of
>>> all data (mind I am talking about rasters) which I am not sure that is a
>>> good enough sample, I leave that question in the air
>>>
>>> The problem is it does not work in rasterVIS (which does use all the
>>> raster). The error it gives me is the following:
>>>
>>> > abline(v=m.rst,col="blue",lwd=2)
>>> Error in int_abline(a = a, b = b, h = h, v = v, untf = untf, ...) :
>>>   plot.new has not been called yet
>>>
>>> Regards!!
>>> Thank you once again!
>>> Nuno
>>>
>>> On 18 November 2014 18:04, Thomas Adams <tea3rd at gmail.com> wrote:
>>>
>>> > Nuno,
>>> >
>>> > This works for me:
>>> >
>>> > > require(stats)
>>> > > set.seed(14)
>>> > > x <- rchisq(100, df = 4)
>>> > >
>>> > >
>>> > > hist(x)
>>> > > meanx<-mean(x)
>>> > > meanx
>>> > [1] 3.734162
>>> > > abline(v=meanx, col="red")
>>> >
>>> > Cheers!
>>> > Tom
>>> >
>>> > On Tue, Nov 18, 2014 at 10:56 AM, Nuno S? <nunocesardesa at gmail.com>
>>> wrote:
>>> >
>>> >> Hello!
>>> >>
>>> >> My aim is to add a "Median" or a "Mean" line to an histogram plot in
>>> R.
>>> >>
>>> >> The problem is the following:
>>> >>
>>> >> The "hist" function from the raster package uses a maximum of 100 000
>>> >> values for generating the histogram but allows me to edit the plot,
>>> so I
>>> >> can easily add a line within the plot using abline.
>>> >>
>>> >> The "histogram" function in rasterVIS uses all my dataset but does not
>>> >> allow editing of the plot area, so I cannot use the abline function
>>> to add
>>> >> this line (or I do not know how to do it).
>>> >>
>>> >> If you have an alternative or a solution to work around this, I am all
>>> >> hears
>>> >>
>>> >> Thank you for any help in advance!
>>> >> Ciao!
>>> >> --
>>> >>
>>> >> Nuno C?sar de S?
>>> >> +351 91 961 90 37
>>> >>
>>> >>         [[alternative HTML version deleted]]
>>> >>
>>> >> _______________________________________________
>>> >> R-sig-Geo mailing list
>>> >> R-sig-Geo at r-project.org
>>> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>> >>
>>> >
>>> >
>>> >
>>> >
>>> >
>>>
>>>
>>> --
>>>
>>> Nuno C?sar de S?
>>> +351 91 961 90 37
>>>
>>>         [[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>>
>>
>> --
>> Gregory (Greg) L. Snow Ph.D.
>> 538280 at gmail.com
>>
>
>
>
>
>
>


-- 

Nuno C?sar de S?
+351 91 961 90 37

	[[alternative HTML version deleted]]


From jshq8612 at 163.com  Wed Nov 19 08:47:38 2014
From: jshq8612 at 163.com (163)
Date: Wed, 19 Nov 2014 15:47:38 +0800
Subject: [R-sig-Geo] About rgdal package
Message-ID: <2E47DC1B-E2A2-4A59-8914-DA55E1659863@163.com>

Hello!
Now,the package rgdal not work in OS X Yosemite,how to replace?

???

From kridox at ymail.com  Wed Nov 19 09:10:58 2014
From: kridox at ymail.com (Pascal Oettli)
Date: Wed, 19 Nov 2014 17:10:58 +0900
Subject: [R-sig-Geo] Question on histograms from Raster and RasterVIS
	packages
In-Reply-To: <CAB-ux0CMYyh_HWVWA7ZFv6WYUiQF2cCQDOJJUMMEXZanWxQ2YA@mail.gmail.com>
References: <CAB-ux0CMYyh_HWVWA7ZFv6WYUiQF2cCQDOJJUMMEXZanWxQ2YA@mail.gmail.com>
Message-ID: <CAAcyNCy46c5U71AZB_uwJy1wQ=eL=YivhPdtib3w9XEuGczVAg@mail.gmail.com>

Here is an example, with the mean in dotted red line and the median in
dotted blue line:


library(rasterVis)

f <- system.file("external/test.grd", package="raster")
r <- raster(f)

mn <- cellStats(r, mean)
md <- cellStats(r, median)

histogram(r) + layer(panel.abline(v = mn, col = "red", lty = 2)) +
layer(panel.abline(v = md, col = "blue", lty = 2))

On Wed, Nov 19, 2014 at 2:56 AM, Nuno S? <nunocesardesa at gmail.com> wrote:
> Hello!
>
> My aim is to add a "Median" or a "Mean" line to an histogram plot in R.
>
> The problem is the following:
>
> The "hist" function from the raster package uses a maximum of 100 000
> values for generating the histogram but allows me to edit the plot, so I
> can easily add a line within the plot using abline.
>
> The "histogram" function in rasterVIS uses all my dataset but does not
> allow editing of the plot area, so I cannot use the abline function to add
> this line (or I do not know how to do it).
>
> If you have an alternative or a solution to work around this, I am all hears
>
> Thank you for any help in advance!
> Ciao!
> --
>
> Nuno C?sar de S?
> +351 91 961 90 37
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



-- 
Pascal Oettli
Project Scientist
JAMSTEC
Yokohama, Japan


From Roger.Bivand at nhh.no  Wed Nov 19 09:13:46 2014
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 19 Nov 2014 09:13:46 +0100
Subject: [R-sig-Geo] About rgdal package
In-Reply-To: <2E47DC1B-E2A2-4A59-8914-DA55E1659863@163.com>
References: <2E47DC1B-E2A2-4A59-8914-DA55E1659863@163.com>
Message-ID: <alpine.LRH.2.03.1411190904270.9633@reclus.nhh.no>

On Wed, 19 Nov 2014, 163 wrote:

> Hello!
> Now,the package rgdal not work in OS X Yosemite,how to replace?

If by "not work", you mean that there is no CRAN binary for OSX Mavericks
and subsequent, please see:

https://stat.ethz.ch/pipermail/r-sig-mac/2014-April/010860.html

and later

https://stat.ethz.ch/pipermail/r-sig-mac/2014-May/010871.html

(posted on this list in May), that is:

setRepositories(ind = c(1,6))  # so you get the dependencies from CRAN
install.packages('rgdal')

(untried for Yosemite by me - has anyone experience of the CRANxtras OSX 
binary on this release?). If this doesn't work, try Kyngchaos:

http://www.kyngchaos.com/software/frameworks

but note that Yosemite is not mentioned there specifically. Using OSX 
(especially newer releases) is like Unix, not like Windows, and you have 
to be prepared to install from source, including installing external 
dependencies from source.

If you meant something else, you need to say what you meant and document 
it with a reproducible example (works on Windows with R version, rgdal 
version and rgdal startup messages, doesn't work on OSX with the same 
platform data).

Roger


>
> ???
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no

From amit.boshale at yahoo.com  Wed Nov 19 14:37:46 2014
From: amit.boshale at yahoo.com (Amit Boshale)
Date: Wed, 19 Nov 2014 13:37:46 +0000
Subject: [R-sig-Geo] runGdal in MODIS package overrides the default in
	MODISoptions "asIn" pixel size and output a smaller
	resoultion pixels
Message-ID: <1416404266.46185.YahooMailNeo@web172201.mail.ir2.yahoo.com>

Dear MailLister,

I have a problem with runGdal function in MODIS package. At Nadir the resolution should be 250 m. The output of the following code result are NDVI, EVI, composite day of the year and VI quality Tifs (resolution of 150 m)


> library(MODIS)
> runGdal( job="H12V12", product="MOD13Q1", tileH=12, tileV=12, begin="2000049", end="2000049", SDSstring="111000000010", outProj="EPSG:4326 ,pixelSize="asIn" )

How to stop the re-sampling and keep the original 250 m resolution?

Any help is appreciate

Amit
> MODISoptions() All suggested packages are installed STORAGE:
_______________
localArcPath : E:/localArcPath/ 
outDirPath   : E:/outDirPath/  DOWNLOAD:
_______________
MODISserverOrder : LPDAAC, LAADS 
dlmethod         : auto 
stubbornness     : high  PROCESSING:
_______________
GDAL           : GDAL 1.10.1, released 2013/08/26 
MRT            : Version 4.1 (March 2011) 
pixelSize      : asIn 
outProj        : asIn 
resamplingType : NN 
dataFormat     : GTiff  DEPENDENCIES:
_______________ NULL


> sessionInfo() R version 3.1.2 (2014-10-31)
Platform: x86_64-w64-mingw32/x64 (64-bit) locale:
[1] LC_COLLATE=German_Germany.1252  LC_CTYPE=German_Germany.1252   
[3] LC_MONETARY=German_Germany.1252 LC_NUMERIC=C                   
[5] LC_TIME=German_Germany.1252     attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base      other attached packages:
[1] XML_3.98-1.1   RCurl_1.95-4.3 bitops_1.0-6   rgeos_0.3-8    rgdal_0.9-1   
[6] MODIS_0.10-18  raster_2.3-14  sp_1.0-16      loaded via a namespace (and not attached):
[1] grid_3.1.2      lattice_0.20-29 tools_3.1.2  
	[[alternative HTML version deleted]]


From r.hijmans at gmail.com  Wed Nov 19 16:14:03 2014
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Wed, 19 Nov 2014 07:14:03 -0800
Subject: [R-sig-Geo] Question on histograms from Raster and RasterVIS
	packages
In-Reply-To: <CAB-ux0CMYyh_HWVWA7ZFv6WYUiQF2cCQDOJJUMMEXZanWxQ2YA@mail.gmail.com>
References: <CAB-ux0CMYyh_HWVWA7ZFv6WYUiQF2cCQDOJJUMMEXZanWxQ2YA@mail.gmail.com>
Message-ID: <CANtt_hxa-F4bSYfuq6ybaoeMhwx57bO-_w-boiud=a1GtJBA-w@mail.gmail.com>

Nuno,

> The "hist" function from the raster package uses a maximum of 100 000
> values for generating the histogram

That is the default, but you do not have to use that. Did you read the
help file??

?raster::hist

Shows that you can set the "maxpixels" to any number you want. E.g.

maxpixels=Inf

if you want them all.

With very large raster you may run out of memory. If that happens,
then you can create the data for a histogram yourself by using the
function 'freq', perhaps after 'reclassify' (and then probably
'barplot').

Robert






On Tue, Nov 18, 2014 at 9:56 AM, Nuno S? <nunocesardesa at gmail.com> wrote:
> Hello!
>
> My aim is to add a "Median" or a "Mean" line to an histogram plot in R.
>
> The problem is the following:
>
> The "hist" function from the raster package uses a maximum of 100 000
> values for generating the histogram but allows me to edit the plot, so I
> can easily add a line within the plot using abline.
>
> The "histogram" function in rasterVIS uses all my dataset but does not
> allow editing of the plot area, so I cannot use the abline function to add
> this line (or I do not know how to do it).
>
> If you have an alternative or a solution to work around this, I am all hears
>
> Thank you for any help in advance!
> Ciao!
> --
>
> Nuno C?sar de S?
> +351 91 961 90 37
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From matteo.mattiuzzi at boku.ac.at  Wed Nov 19 16:34:58 2014
From: matteo.mattiuzzi at boku.ac.at (Matteo Mattiuzzi)
Date: Wed, 19 Nov 2014 16:34:58 +0100
Subject: [R-sig-Geo] runGdal in MODIS package overrides the default in
 MODISoptions "asIn" pixel size and output a smaller resoultion pixels
In-Reply-To: <1416404266.46185.YahooMailNeo@web172201.mail.ir2.yahoo.com>
References: <1416404266.46185.YahooMailNeo@web172201.mail.ir2.yahoo.com>
Message-ID: <546CC6B20200002700024192@gwia2.boku.ac.at>

Dear Amit, 
if you set pixelSize asIn, the handling of the pixelsize is done by gdal_translate, runGdal in such case does not provide any information about resolution to used 'gdal_translate'.
As your outProj is 4326 you have geographic coordinates, this means that in planar coordinates your grid is not the equal sized within your extent. I don't know how gdal decides about the resolution if no information has provided, and where it fixes the resolution (from source to target file), with where I mean if it is on a corner, in the middle or some mean of all...

To be precise (or little more precise), the MODIS 250 m resolution is 231,xx m and if you want to have more influence about the pixelsize (and you have no other option than using geographic coordinates), you could convert on the location you focus on the target pixelsize to degrees, having at least in a restricted area the resolution you wish. But I suggest you to stay in Sinusoidal projection and decide on it on a later point if needed:
 
runGdal( job="H12V12", product="MOD13Q1", tileH=12, tileV=12, 
begin="2000049", end="2000049", SDSstring="111000000010", 
outProj="asIn" ,pixelSize="asIn" )

this does not reproject at all, it simply extracts the hdf SDS to single layer tifs. This because your extent is defined with tileH and tileV and you outProj and pixelSize are asIn. 

Or if you have a target raster where you work with in your current project you could also do:

r <- raster('yourrasterfile')
runGdal( job="H12V12", product="MOD13Q1", extent=r, 
begin="2000049", end="2000049", SDSstring="111000000010" )

in this case the MODIS data will fit in any sense the r object (resolution, extent and projection)

I hope this helps,
Matteo

>>> Amit Boshale <amit.boshale at yahoo.com> 11/19/14 2:42 PM >>>
Dear MailLister,

I have a problem with runGdal function in MODIS package. At Nadir the resolution should be 250 m. The output of the following code result are NDVI, EVI, composite day of the year and VI quality Tifs (resolution of 150 m)


> library(MODIS)
> runGdal( job="H12V12", product="MOD13Q1", tileH=12, tileV=12, begin="2000049", end="2000049", SDSstring="111000000010", outProj="EPSG:4326 ,pixelSize="asIn" )

How to stop the re-sampling and keep the original 250 m resolution?

Any help is appreciate

Amit
> MODISoptions() All suggested packages are installed STORAGE:
_______________
localArcPath : E:/localArcPath/ 
outDirPath   : E:/outDirPath/  DOWNLOAD:
_______________
MODISserverOrder : LPDAAC, LAADS 
dlmethod         : auto 
stubbornness     : high  PROCESSING:
_______________
GDAL           : GDAL 1.10.1, released 2013/08/26 
MRT            : Version 4.1 (March 2011) 
pixelSize      : asIn 
outProj        : asIn 
resamplingType : NN 
dataFormat     : GTiff  DEPENDENCIES:
_______________ NULL


> sessionInfo() R version 3.1.2 (2014-10-31)
Platform: x86_64-w64-mingw32/x64 (64-bit) locale:
[1] LC_COLLATE=German_Germany.1252  LC_CTYPE=German_Germany.1252   
[3] LC_MONETARY=German_Germany.1252 LC_NUMERIC=C                   
[5] LC_TIME=German_Germany.1252     attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base      other attached packages:
[1] XML_3.98-1.1   RCurl_1.95-4.3 bitops_1.0-6   rgeos_0.3-8    rgdal_0.9-1   
[6] MODIS_0.10-18  raster_2.3-14  sp_1.0-16      loaded via a namespace (and not attached):
[1] grid_3.1.2      lattice_0.20-29 tools_3.1.2  
    [[alternative HTML version deleted]]

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From nunocesardesa at gmail.com  Wed Nov 19 20:39:28 2014
From: nunocesardesa at gmail.com (=?UTF-8?B?TnVubyBTw6E=?=)
Date: Wed, 19 Nov 2014 19:39:28 +0000
Subject: [R-sig-Geo] Question on histograms from Raster and RasterVIS
	packages
In-Reply-To: <CANtt_hxa-F4bSYfuq6ybaoeMhwx57bO-_w-boiud=a1GtJBA-w@mail.gmail.com>
References: <CAB-ux0CMYyh_HWVWA7ZFv6WYUiQF2cCQDOJJUMMEXZanWxQ2YA@mail.gmail.com>
	<CANtt_hxa-F4bSYfuq6ybaoeMhwx57bO-_w-boiud=a1GtJBA-w@mail.gmail.com>
Message-ID: <CAB-ux0AY25tWVsU3vVQFZN6zRNR8k-Wj2aQOV7oUKemZceVT_g@mail.gmail.com>

Hello!

Mr. Pascal, thank you, your suggestion works quite well.

First, I was having error calculating the median using the cellStats
because I was using brackets ("median" as opposed to median) and the error
message mislead me to think it was not implemented (which obviously I
obviously found very strange but moved quickly onwards after Thomas Adams
suggestion).

(This was the error)
Error in .local(x, stat, ...) :
  invalid 'stat'. Should be sum, min, max, sd, mean, or 'countNA'

The + operator worked 100% as you've said. So great feedback, thank you soo
much.I am now free to make some more beautiful looking plots hehe

Mr. Hijmanns, I did read the package help but failed to find a mention that
it was not limited to a maximum of 1000000, so my mistake there. It works
perfectly as you've said as well, so thank you so much for the feedback.

As usual, "computers are always right and the user was the error". Good
thing we have these forums and such a quick access to much better users.

Since I have your attention Mr. Hijmanns I ask a quick extra question - in
the cellStats you mention that it will fail "gracefully" for very large
rasters (not my case here since it gracefully succeeded), do you know what
is the limit of cells for that failure?

Once again, thank you all for the help!
Best of luck on everything for all!

Nuno

On 19 November 2014 15:14, Robert J. Hijmans <r.hijmans at gmail.com> wrote:

> Nuno,
>
> > The "hist" function from the raster package uses a maximum of 100 000
> > values for generating the histogram
>
> That is the default, but you do not have to use that. Did you read the
> help file??
>
> ?raster::hist
>
> Shows that you can set the "maxpixels" to any number you want. E.g.
>
> maxpixels=Inf
>
> if you want them all.
>
> With very large raster you may run out of memory. If that happens,
> then you can create the data for a histogram yourself by using the
> function 'freq', perhaps after 'reclassify' (and then probably
> 'barplot').
>
> Robert
>
>
>
>
>
>
> On Tue, Nov 18, 2014 at 9:56 AM, Nuno S? <nunocesardesa at gmail.com> wrote:
> > Hello!
> >
> > My aim is to add a "Median" or a "Mean" line to an histogram plot in R.
> >
> > The problem is the following:
> >
> > The "hist" function from the raster package uses a maximum of 100 000
> > values for generating the histogram but allows me to edit the plot, so I
> > can easily add a line within the plot using abline.
> >
> > The "histogram" function in rasterVIS uses all my dataset but does not
> > allow editing of the plot area, so I cannot use the abline function to
> add
> > this line (or I do not know how to do it).
> >
> > If you have an alternative or a solution to work around this, I am all
> hears
> >
> > Thank you for any help in advance!
> > Ciao!
> > --
> >
> > Nuno C?sar de S?
> > +351 91 961 90 37
> >
> >         [[alternative HTML version deleted]]
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



-- 

Nuno C?sar de S?
+351 91 961 90 37

	[[alternative HTML version deleted]]


From r.hijmans at gmail.com  Wed Nov 19 22:46:56 2014
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Wed, 19 Nov 2014 13:46:56 -0800
Subject: [R-sig-Geo] Question on histograms from Raster and RasterVIS
	packages
In-Reply-To: <CAB-ux0AY25tWVsU3vVQFZN6zRNR8k-Wj2aQOV7oUKemZceVT_g@mail.gmail.com>
References: <CAB-ux0CMYyh_HWVWA7ZFv6WYUiQF2cCQDOJJUMMEXZanWxQ2YA@mail.gmail.com>
	<CANtt_hxa-F4bSYfuq6ybaoeMhwx57bO-_w-boiud=a1GtJBA-w@mail.gmail.com>
	<CAB-ux0AY25tWVsU3vVQFZN6zRNR8k-Wj2aQOV7oUKemZceVT_g@mail.gmail.com>
Message-ID: <CANtt_hwo=uTe_kZR89FntJE8oXJQUMBDiwVfwxcBS-dv1FZ6kA@mail.gmail.com>

> cellStats will fail "gracefully" for very large rasters
> do you know what is the limit of cells for that failure?

That depends on your computer hardware (RAM), software (32 or 64 bits
OS) and perhaps memory management (will RAM expand to hard disk if
needed?).

RH


On Wed, Nov 19, 2014 at 11:39 AM, Nuno S? <nunocesardesa at gmail.com> wrote:
> Hello!
>
> Mr. Pascal, thank you, your suggestion works quite well.
>
> First, I was having error calculating the median using the cellStats because
> I was using brackets ("median" as opposed to median) and the error message
> mislead me to think it was not implemented (which obviously I obviously
> found very strange but moved quickly onwards after Thomas Adams suggestion).
>
> (This was the error)
> Error in .local(x, stat, ...) :
>   invalid 'stat'. Should be sum, min, max, sd, mean, or 'countNA'
>
> The + operator worked 100% as you've said. So great feedback, thank you soo
> much.I am now free to make some more beautiful looking plots hehe
>
> Mr. Hijmanns, I did read the package help but failed to find a mention that
> it was not limited to a maximum of 1000000, so my mistake there. It works
> perfectly as you've said as well, so thank you so much for the feedback.
>
> As usual, "computers are always right and the user was the error". Good
> thing we have these forums and such a quick access to much better users.
>
> Since I have your attention Mr. Hijmanns I ask a quick extra question - in
> the cellStats you mention that it will fail "gracefully" for very large
> rasters (not my case here since it gracefully succeeded), do you know what
> is the limit of cells for that failure?
>
> Once again, thank you all for the help!
> Best of luck on everything for all!
>
> Nuno
>
> On 19 November 2014 15:14, Robert J. Hijmans <r.hijmans at gmail.com> wrote:
>>
>> Nuno,
>>
>> > The "hist" function from the raster package uses a maximum of 100 000
>> > values for generating the histogram
>>
>> That is the default, but you do not have to use that. Did you read the
>> help file??
>>
>> ?raster::hist
>>
>> Shows that you can set the "maxpixels" to any number you want. E.g.
>>
>> maxpixels=Inf
>>
>> if you want them all.
>>
>> With very large raster you may run out of memory. If that happens,
>> then you can create the data for a histogram yourself by using the
>> function 'freq', perhaps after 'reclassify' (and then probably
>> 'barplot').
>>
>> Robert
>>
>>
>>
>>
>>
>>
>> On Tue, Nov 18, 2014 at 9:56 AM, Nuno S? <nunocesardesa at gmail.com> wrote:
>> > Hello!
>> >
>> > My aim is to add a "Median" or a "Mean" line to an histogram plot in R.
>> >
>> > The problem is the following:
>> >
>> > The "hist" function from the raster package uses a maximum of 100 000
>> > values for generating the histogram but allows me to edit the plot, so I
>> > can easily add a line within the plot using abline.
>> >
>> > The "histogram" function in rasterVIS uses all my dataset but does not
>> > allow editing of the plot area, so I cannot use the abline function to
>> > add
>> > this line (or I do not know how to do it).
>> >
>> > If you have an alternative or a solution to work around this, I am all
>> > hears
>> >
>> > Thank you for any help in advance!
>> > Ciao!
>> > --
>> >
>> > Nuno C?sar de S?
>> > +351 91 961 90 37
>> >
>> >         [[alternative HTML version deleted]]
>> >
>> > _______________________________________________
>> > R-sig-Geo mailing list
>> > R-sig-Geo at r-project.org
>> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
>
>
> --
>
> Nuno C?sar de S?
> +351 91 961 90 37
>


From thi_veloso at yahoo.com.br  Thu Nov 20 01:30:39 2014
From: thi_veloso at yahoo.com.br (Thiago V. dos Santos)
Date: Thu, 20 Nov 2014 00:30:39 +0000 (UTC)
Subject: [R-sig-Geo] About rgdal package
In-Reply-To: <alpine.LRH.2.03.1411190904270.9633@reclus.nhh.no>
References: <alpine.LRH.2.03.1411190904270.9633@reclus.nhh.no>
Message-ID: <1772064034.1837471.1416443439778.JavaMail.yahoo@jws10074.mail.ne1.yahoo.com>

I managed to install rgdal from source on Yosemite by:
1) installing the GDAL 1.11 complete framework provided by kyngchaos.com;2) pointing the right paths when building rgdal. This should work (type on system terminal, not on R prompt):
R CMD INSTALL rgdal_0.9-1.tar.gz --configure-args='--with-gdal-config=/Library/Frameworks/GDAL.framework/Programs/gdal-config --with-proj-include=/Library/Frameworks/PROJ.framework/unix/include --with-proj-lib=/Library/Frameworks/PROJ.framework/unix/lib
In case you need it, the rgeos package can be installed conversely.?
Hope it helps,
--
Thiago V. dos Santos
PhD student
Land and Atmospheric Science
University of Minnesota
http://www.laas.umn.edu/CurrentStudents/MeettheStudents/ThiagodosSantos/index.htm
Phone: (612) 323 9898 

     On Wednesday, November 19, 2014 2:16 AM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
   

 On Wed, 19 Nov 2014, 163 wrote:

> Hello!
> Now,the package rgdal not work in OS X Yosemite,how to replace?

If by "not work", you mean that there is no CRAN binary for OSX Mavericks
and subsequent, please see:

https://stat.ethz.ch/pipermail/r-sig-mac/2014-April/010860.html

and later

https://stat.ethz.ch/pipermail/r-sig-mac/2014-May/010871.html

(posted on this list in May), that is:

setRepositories(ind = c(1,6))? # so you get the dependencies from CRAN
install.packages('rgdal')

(untried for Yosemite by me - has anyone experience of the CRANxtras OSX 
binary on this release?). If this doesn't work, try Kyngchaos:

http://www.kyngchaos.com/software/frameworks

but note that Yosemite is not mentioned there specifically. Using OSX 
(especially newer releases) is like Unix, not like Windows, and you have 
to be prepared to install from source, including installing external 
dependencies from source.

If you meant something else, you need to say what you meant and document 
it with a reproducible example (works on Windows with R version, rgdal 
version and rgdal startup messages, doesn't work on OSX with the same 
platform data).

Roger


>
> ???
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no
_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


   
	[[alternative HTML version deleted]]


From rachel.saf at mail.huji.ac.il  Thu Nov 20 10:44:16 2014
From: rachel.saf at mail.huji.ac.il (Rachel Chocron)
Date: Thu, 20 Nov 2014 11:44:16 +0200
Subject: [R-sig-Geo] difference in coeeficient variance calculated from the
 ANOVA table and from the imat covariance matrix
Message-ID: <CACyw5UR+mT92JS2X57gRtXq9oGkjE9Z06BDzspZb29b_-vEJbQ@mail.gmail.com>

Hello!
I used the function spdep.spautolm to calculate spatial regression:

*text="arsin_species_num_proportion  ~
I(POINT_X/100000)+I((POINT_X/100000)^2)+I(mean_400m/1000)+I((mean_400m/1000)^2)+I(summer_temperature)+I(sqr_temperature)+I(year_precipitation/1000)+I((year_precipitation/1000)^2)
+I(RANGE_400m/1000)+I((RANGE_400m/1000)^2)+LandCoverNum_400m+sqr_LandCoverNum_400m"*

*model400mSar <-spautolm(formula = as.formula(text), data = pointsDF, listw
= weightsb,  family = "SAR", method = "eigen", verbose = TRUE, zero.policy
= TRUE)*
*Then I wanted to retrieve the coefficient covariance matrix.*

So I did it using the imat object:
*model400mSar$fit$imat*

and I compared the variance of each coefficient according to the imat
object,
with the variance calculated from the ANOVA table extracted by:

*summary(model400mSar)$Coef*

and by square root the std. error of each coefficient

and the results were different.

I also tried the fdHess covarianve matrix but it also gave different
results.

*model400mSar$fdHess*

My question is:
How can I retrieve the covariance matrix of the coeeficients that is
presented in the ANOVA table?


Many thanks,
Rachel

	[[alternative HTML version deleted]]


From amit.boshale at yahoo.com  Thu Nov 20 11:04:03 2014
From: amit.boshale at yahoo.com (Amit Boshale)
Date: Thu, 20 Nov 2014 10:04:03 +0000 (UTC)
Subject: [R-sig-Geo] runGdal in MODIS package overrides the default in
 MODISoptions "asIn" pixel size and output a smaller resoultion pixels
Message-ID: <1242744271.1621748.1416477843182.JavaMail.yahoo@jws11148.mail.ir2.yahoo.com>

Dear Matteo,
Thank you so much for the quick response :-)
Staying in Sinusoidal projection is a brilliant idea! 

I will keep the Sinusoidal projection for the first raster, then convert its projection to WGS84 using QGIS and use it as the extend raster "r" you kindly mentioned. If the gdal did the same resampling, I will simply keep Sinusoidal projection for all and convert using QGIS.
Amit

 
      Matteo Mattiuzzi <matteo.mattiuzzi at boku.ac.at> schrieb am 16:34 Mittwoch, 19.November 2014:
   

 

Dear Amit, 
if you set pixelSize asIn, the handling of the pixelsize is done by gdal_translate, runGdal in such case does not provide any information about resolution to used 'gdal_translate'.
As your outProj is 4326 you have geographic coordinates, this means that in planar coordinates your grid is not the equal sized within your extent. I don't know how gdal decides about the resolution if no information has provided, and where it fixes the resolution (from source to target file), with where I mean if it is on a corner, in the middle or some mean of all...

To be precise (or little more precise), the MODIS 250 m resolution is 231,xx m and if you want to have more influence about the pixelsize (and you have no other option than using geographic coordinates), you could convert on the location you focus on the target pixelsize to degrees, having at least in a restricted area the resolution you wish. But I suggest you to stay in Sinusoidal projection and decide on it on a later point if needed:
 
runGdal( job="H12V12", product="MOD13Q1", tileH=12, tileV=12, 
begin="2000049", end="2000049", SDSstring="111000000010", 
outProj="asIn" ,pixelSize="asIn" )

this does not reproject at all, it simply extracts the hdf SDS to single layer tifs. This because your extent is defined with tileH and tileV and you outProj and pixelSize are asIn. 

Or if you have a target raster where you work with in your current project you could also do:

r <- raster('yourrasterfile')
runGdal( job="H12V12", product="MOD13Q1", extent=r, 
begin="2000049", end="2000049", SDSstring="111000000010" )

in this case the MODIS data will fit in any sense the r object (resolution, extent and projection)

I hope this helps,
Matteo

>>> Amit Boshale <amit.boshale at yahoo.com> 11/19/14 2:42 PM >>>
Dear MailLister,

I have a problem with runGdal function in MODIS package. At Nadir the resolution should be 250 m. The output of the following code result are NDVI, EVI, composite day of the year and VI quality Tifs (resolution of 150 m)


> library(MODIS)
> runGdal( job="H12V12", product="MOD13Q1", tileH=12, tileV=12, begin="2000049", end="2000049", SDSstring="111000000010", outProj="EPSG:4326 ,pixelSize="asIn" )

How to stop the re-sampling and keep the original 250 m resolution?

Any help is appreciate

Amit
> MODISoptions() All suggested packages are installed STORAGE:
_______________
localArcPath : E:/localArcPath/ 
outDirPath? : E:/outDirPath/? DOWNLOAD:
_______________
MODISserverOrder : LPDAAC, LAADS 
dlmethod? ? ? ? : auto 
stubbornness? ? : high? PROCESSING:
_______________
GDAL? ? ? ? ? : GDAL 1.10.1, released 2013/08/26 
MRT? ? ? ? ? ? : Version 4.1 (March 2011) 
pixelSize? ? ? : asIn 
outProj? ? ? ? : asIn 
resamplingType : NN 
dataFormat? ? : GTiff? DEPENDENCIES:
_______________ NULL


> sessionInfo() R version 3.1.2 (2014-10-31)
Platform: x86_64-w64-mingw32/x64 (64-bit) locale:
[1] LC_COLLATE=German_Germany.1252? LC_CTYPE=German_Germany.1252? 
[3] LC_MONETARY=German_Germany.1252 LC_NUMERIC=C? ? ? ? ? ? ? ? ? 
[5] LC_TIME=German_Germany.1252? ? attached base packages:
[1] stats? ? graphics? grDevices utils? ? datasets? methods? base? ? ? other attached packages:
[1] XML_3.98-1.1? RCurl_1.95-4.3 bitops_1.0-6? rgeos_0.3-8? ? rgdal_0.9-1? 
[6] MODIS_0.10-18? raster_2.3-14? sp_1.0-16? ? ? loaded via a namespace (and not attached):
[1] grid_3.1.2? ? ? lattice_0.20-29 tools_3.1.2? 
? ? [[alternative HTML version deleted]]

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo



   
	[[alternative HTML version deleted]]


From anne.reichmuth at esa.int  Thu Nov 20 11:25:04 2014
From: anne.reichmuth at esa.int (anne.reichmuth at esa.int)
Date: Thu, 20 Nov 2014 11:25:04 +0100
Subject: [R-sig-Geo] Filter raster by threshold using focal and euclidean
	distance
Message-ID: <2786_1416479123_546DC193_2786_219_1_OFE67A58D0.C850D8E0-ONC1257D96.0034373C-C1257D96.00393A31@esa.int>

Dear R users,

I have the issue of defining the right function for my task. For filtering 
an image I have set up a filter matrix eucdis with

refm=matrix(1,nrow=11,ncol=11)
M = dim(refm)[1]
N = dim(refm)[2]
eucdis = matrix(NaN, nrow=11, ncol=11)
for (i in -5:5){
      for (j in -5:5){
            eucdis[i+6,j+6] = 2*(sqrt(sum(abs(0-i)^2+abs(0-j)^2))) 
#euclidean distance of the moving matrix
            eucdis[6,6]=1
            eucdis[eucdis>10]=0
            eucdis[eucdis>0]=1
      }
}


Using the example raster 

f <- system.file("external/test.grd", package="raster")
f
r <- raster(f)

 
I want to filter all values of that raster that have a certain the value, 
say 200 within 10%  (=8) of the eucdis filter matrix

s=focal(x=r,w=eucdis,fun=function(w) {if (length(w[w==2])>=8) {s=1} else 
{s=0}})

But this only gives me all values where the eucdis filter matrix has at 
least 8 pixel with any values of r. If I add the constraint about 
r[r>=200] it is not working as I thought it would. It is not taking the 
second constraint into account.

s=focal(x=r,w=eucdis,fun=function(w,x) {if (length(w[w==1])>=8 | 
x[x>=200]){s=1} else {s=0}}) # I also tried & and &&
 
If anyone can help me please. I have spend days already and can't figure 
it out my self.

Thank you,
Anne
This message and any attachments are intended for the use of the addressee or addressees only.
The unauthorised disclosure, use, dissemination or copying (either in whole or in part) of its
content is not permitted.
If you received this message in error, please notify the sender and delete it from your system.
Emails can be altered and their integrity cannot be guaranteed by the sender.

Please consider the environment before printing this email.


	[[alternative HTML version deleted]]


From rachel.saf at mail.huji.ac.il  Thu Nov 20 11:31:37 2014
From: rachel.saf at mail.huji.ac.il (Rachel Chocron)
Date: Thu, 20 Nov 2014 12:31:37 +0200
Subject: [R-sig-Geo] difference in coeeficient variance calculated from
 the ANOVA table and from the imat covariance matrix
In-Reply-To: <CACyw5UT-z__qG+hHU7i7+aNRRcYyW6yECGZiWWC5NEnfgVMm8A@mail.gmail.com>
References: <CACyw5UT-z__qG+hHU7i7+aNRRcYyW6yECGZiWWC5NEnfgVMm8A@mail.gmail.com>
Message-ID: <CACyw5UQs6g6F-81ax4P-4P=rVcbaTQ1o5GoonBwQmEgJgjYjPg@mail.gmail.com>

Just a small correction, I did *not *square root the std. error, I raised
it by power of 2.

2014-11-20 10:22 GMT+02:00 Rachel Chocron <rachel.saf at mail.huji.ac.il>:

> Hello!
> I used the function spdep.spautolm to calculate spatial regression:
>
> *text="arsin_species_num_proportion  ~
> I(POINT_X/100000)+I((POINT_X/100000)^2)+I(mean_400m/1000)+I((mean_400m/1000)^2)+I(summer_temperature)+I(sqr_temperature)+I(year_precipitation/1000)+I((year_precipitation/1000)^2)
> +I(RANGE_400m/1000)+I((RANGE_400m/1000)^2)+LandCoverNum_400m+sqr_LandCoverNum_400m"*
>
> *model400mSar <-spautolm(formula = as.formula(text), data = pointsDF,
> listw = weightsb,  family = "SAR", method = "eigen", verbose = TRUE,
> zero.policy = TRUE)*
> *Then I wanted to retrieve the coefficient covariance matrix.*
>
> So I did it using the imat object:
> *model400mSar$fit$imat*
>
> and I compared the variance of each coefficient according to the imat
> object,
> with the variance calculated from the ANOVA table extracted by:
>
> *summary(model400mSar)$Coef*
>
> and by square root the std. error of each coefficient
>
> and the results were different.
>
> I also tried the fdHess covarianve matrix but it also gave different
> results.
>
> *model400mSar$fdHess*
>
> My question is:
> How can I retrieve the covariance matrix of the coeeficients that is
> presented in the ANOVA table?
>
> Please see attached word documents with the fdHess matrix, the imat matrix
> and the ANOVA table.
>
>
> Many thanks,
> Rachel
>

	[[alternative HTML version deleted]]


From Wade.A.Wall at usace.army.mil  Thu Nov 20 16:21:20 2014
From: Wade.A.Wall at usace.army.mil (Wall, Wade A ERDC-RDE-CERL-IL)
Date: Thu, 20 Nov 2014 15:21:20 +0000
Subject: [R-sig-Geo] Maintaining band names in multiband raster objects
Message-ID: <C1524BE4BF45454293B8DF38FB9B5ECA177DACAA@MS-EX1VKS.erdc.dren.mil>

Hi all,

I am trying to keep band names from imported netcdf files intact when I export them using the writeRaster() function from the Raster package, but they are removed and replaced with "Band1, band2, band3, etc."

The .nc files I am importing are located at http://gdo-dcp.ucllnl.org/downscaled_cmip_projections/dcpInterface.html#Welcome

When I import the .nc files, names(raster object) yields band names such as x2006.01.15 (January 15 2006). These names are interpretable and I would like to preserve them.

Is there a way to specify band names for exported raster objects in R? I have seen posts suggesting it is not possible, but if they can be read, then they should be able to be written.

Wade A. Wall
US Army ERDC-CERL
P.O. Box 9005
Champaign, IL  61826-9005
1-217-373-4420
Wade.A.Wall at usace.army.mil<mailto:Wade.A.Wall at usace.army.mil>




	[[alternative HTML version deleted]]


From loic.dutrieux at wur.nl  Thu Nov 20 16:33:02 2014
From: loic.dutrieux at wur.nl (Dutrieux, Loic)
Date: Thu, 20 Nov 2014 15:33:02 +0000
Subject: [R-sig-Geo] Maintaining band names in multiband raster objects
In-Reply-To: <C1524BE4BF45454293B8DF38FB9B5ECA177DACAA@MS-EX1VKS.erdc.dren.mil>
References: <C1524BE4BF45454293B8DF38FB9B5ECA177DACAA@MS-EX1VKS.erdc.dren.mil>
Message-ID: <A83620D4CC4762448EFB789FD6E9BBB742BBB629@SCOMP0937.wurnet.nl>

Hi Wade,

If that's convenient for you, try to store your data in the native format of the raster package (.grd). It has the advantage of preserving layer names.

Best regards,
Lo?c
________________________________________
From: r-sig-geo-bounces at r-project.org [r-sig-geo-bounces at r-project.org] on behalf of Wall, Wade A ERDC-RDE-CERL-IL [Wade.A.Wall at usace.army.mil]
Sent: Thursday, November 20, 2014 4:21 PM
To: r-sig-geo at r-project.org
Subject: [R-sig-Geo] Maintaining band names in multiband raster objects

Hi all,

I am trying to keep band names from imported netcdf files intact when I export them using the writeRaster() function from the Raster package, but they are removed and replaced with "Band1, band2, band3, etc."

The .nc files I am importing are located at http://gdo-dcp.ucllnl.org/downscaled_cmip_projections/dcpInterface.html#Welcome

When I import the .nc files, names(raster object) yields band names such as x2006.01.15 (January 15 2006). These names are interpretable and I would like to preserve them.

Is there a way to specify band names for exported raster objects in R? I have seen posts suggesting it is not possible, but if they can be read, then they should be able to be written.

Wade A. Wall
US Army ERDC-CERL
P.O. Box 9005
Champaign, IL  61826-9005
1-217-373-4420
Wade.A.Wall at usace.army.mil<mailto:Wade.A.Wall at usace.army.mil>




        [[alternative HTML version deleted]]

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From Wade.A.Wall at usace.army.mil  Thu Nov 20 17:23:11 2014
From: Wade.A.Wall at usace.army.mil (Wall, Wade A ERDC-RDE-CERL-IL)
Date: Thu, 20 Nov 2014 16:23:11 +0000
Subject: [R-sig-Geo] Maintaining band names in multiband raster objects
In-Reply-To: <A83620D4CC4762448EFB789FD6E9BBB742BBB629@SCOMP0937.wurnet.nl>
References: <C1524BE4BF45454293B8DF38FB9B5ECA177DACAA@MS-EX1VKS.erdc.dren.mil>
	<A83620D4CC4762448EFB789FD6E9BBB742BBB629@SCOMP0937.wurnet.nl>
Message-ID: <C1524BE4BF45454293B8DF38FB9B5ECA177DACCF@MS-EX1VKS.erdc.dren.mil>

It is convenient for me, unfortunately it is not convenient for downstream users. They need a format that can be imported in (I hate to say it) ArcGIS. They are having trouble importing the native raster format into ArcGIS and I haven't had any luck either.

Wade A. Wall
US Army ERDC-CERL
P.O. Box 9005
Champaign, IL  61826-9005
1-217-373-4420
Wade.A.Wall at usace.army.mil




-----Original Message-----
From: Dutrieux, Loic [mailto:loic.dutrieux at wur.nl] 
Sent: Thursday, November 20, 2014 9:33 AM
To: Wall, Wade A ERDC-RDE-CERL-IL; r-sig-geo at r-project.org
Subject: [EXTERNAL] RE: Maintaining band names in multiband raster objects

Hi Wade,

If that's convenient for you, try to store your data in the native format of the raster package (.grd). It has the advantage of preserving layer names.

Best regards,
Lo?c
________________________________________
From: r-sig-geo-bounces at r-project.org [r-sig-geo-bounces at r-project.org] on behalf of Wall, Wade A ERDC-RDE-CERL-IL [Wade.A.Wall at usace.army.mil]
Sent: Thursday, November 20, 2014 4:21 PM
To: r-sig-geo at r-project.org
Subject: [R-sig-Geo] Maintaining band names in multiband raster objects

Hi all,

I am trying to keep band names from imported netcdf files intact when I export them using the writeRaster() function from the Raster package, but they are removed and replaced with "Band1, band2, band3, etc."

The .nc files I am importing are located at http://gdo-dcp.ucllnl.org/downscaled_cmip_projections/dcpInterface.html#Welcome

When I import the .nc files, names(raster object) yields band names such as x2006.01.15 (January 15 2006). These names are interpretable and I would like to preserve them.

Is there a way to specify band names for exported raster objects in R? I have seen posts suggesting it is not possible, but if they can be read, then they should be able to be written.

Wade A. Wall
US Army ERDC-CERL
P.O. Box 9005
Champaign, IL  61826-9005
1-217-373-4420
Wade.A.Wall at usace.army.mil<mailto:Wade.A.Wall at usace.army.mil>




        [[alternative HTML version deleted]]

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From loic.dutrieux at wur.nl  Thu Nov 20 17:34:04 2014
From: loic.dutrieux at wur.nl (Dutrieux, Loic)
Date: Thu, 20 Nov 2014 16:34:04 +0000
Subject: [R-sig-Geo] Maintaining band names in multiband raster objects
In-Reply-To: <C1524BE4BF45454293B8DF38FB9B5ECA177DACCF@MS-EX1VKS.erdc.dren.mil>
References: <C1524BE4BF45454293B8DF38FB9B5ECA177DACAA@MS-EX1VKS.erdc.dren.mil>
	<A83620D4CC4762448EFB789FD6E9BBB742BBB629@SCOMP0937.wurnet.nl>,
	<C1524BE4BF45454293B8DF38FB9B5ECA177DACCF@MS-EX1VKS.erdc.dren.mil>
Message-ID: <A83620D4CC4762448EFB789FD6E9BBB742BBB6AD@SCOMP0937.wurnet.nl>

If you create a header for the file, using hrd(), with e.g. format='ENVI', then you should be able to open it in pretty much any GIS software. You have to point to the .gri file.
That will preserve band names for when you re-import in R, and make the file possible to import in ArcGIS. I'm afraid you won't be able to get the band names outside of R though.

Best regards,
Lo?c
________________________________________
From: Wall, Wade A ERDC-RDE-CERL-IL [Wade.A.Wall at usace.army.mil]
Sent: Thursday, November 20, 2014 5:23 PM
To: Dutrieux, Loic; r-sig-geo at r-project.org
Subject: RE: Maintaining band names in multiband raster objects

It is convenient for me, unfortunately it is not convenient for downstream users. They need a format that can be imported in (I hate to say it) ArcGIS. They are having trouble importing the native raster format into ArcGIS and I haven't had any luck either.

Wade A. Wall
US Army ERDC-CERL
P.O. Box 9005
Champaign, IL  61826-9005
1-217-373-4420
Wade.A.Wall at usace.army.mil




-----Original Message-----
From: Dutrieux, Loic [mailto:loic.dutrieux at wur.nl]
Sent: Thursday, November 20, 2014 9:33 AM
To: Wall, Wade A ERDC-RDE-CERL-IL; r-sig-geo at r-project.org
Subject: [EXTERNAL] RE: Maintaining band names in multiband raster objects

Hi Wade,

If that's convenient for you, try to store your data in the native format of the raster package (.grd). It has the advantage of preserving layer names.

Best regards,
Lo?c
________________________________________
From: r-sig-geo-bounces at r-project.org [r-sig-geo-bounces at r-project.org] on behalf of Wall, Wade A ERDC-RDE-CERL-IL [Wade.A.Wall at usace.army.mil]
Sent: Thursday, November 20, 2014 4:21 PM
To: r-sig-geo at r-project.org
Subject: [R-sig-Geo] Maintaining band names in multiband raster objects

Hi all,

I am trying to keep band names from imported netcdf files intact when I export them using the writeRaster() function from the Raster package, but they are removed and replaced with "Band1, band2, band3, etc."

The .nc files I am importing are located at http://gdo-dcp.ucllnl.org/downscaled_cmip_projections/dcpInterface.html#Welcome

When I import the .nc files, names(raster object) yields band names such as x2006.01.15 (January 15 2006). These names are interpretable and I would like to preserve them.

Is there a way to specify band names for exported raster objects in R? I have seen posts suggesting it is not possible, but if they can be read, then they should be able to be written.

Wade A. Wall
US Army ERDC-CERL
P.O. Box 9005
Champaign, IL  61826-9005
1-217-373-4420
Wade.A.Wall at usace.army.mil<mailto:Wade.A.Wall at usace.army.mil>




        [[alternative HTML version deleted]]

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From mdsumner at gmail.com  Thu Nov 20 21:14:33 2014
From: mdsumner at gmail.com (Michael Sumner)
Date: Thu, 20 Nov 2014 20:14:33 +0000
Subject: [R-sig-Geo] Maintaining band names in multiband raster objects
References: <C1524BE4BF45454293B8DF38FB9B5ECA177DACAA@MS-EX1VKS.erdc.dren.mil>
	<A83620D4CC4762448EFB789FD6E9BBB742BBB629@SCOMP0937.wurnet.nl>
	<C1524BE4BF45454293B8DF38FB9B5ECA177DACCF@MS-EX1VKS.erdc.dren.mil>
	<A83620D4CC4762448EFB789FD6E9BBB742BBB6AD@SCOMP0937.wurnet.nl>
Message-ID: <CAAcGz98Avjv5CXkxdBhyocX1C_XQO918sCfTndJUt4y6=fFpig@mail.gmail.com>

There's just no model for the names in NetCDF, since it *really* stores a
3D array. The analogue in R would be the array's "dimnames", but with
NetCDF you'd have to store these names as another variable (sharing the
third dimension of your data), and restore them from there.



Do the end user's of the NetCDF really expect these character names, or do
they expect a "time" variable on one of the available dimensions? I would
just ensure that the "Z dimension" of the object is properly set before
writing (see setZ and getZ), and that this round-trips in the expected way.
The names can be easily added in R from getZ(x).


Cheers, Mike.

On Fri Nov 21 2014 at 03:34:24 Dutrieux, Loic <loic.dutrieux at wur.nl> wrote:

If you create a header for the file, using hrd(), with e.g. format='ENVI',
then you should be able to open it in pretty much any GIS software. You
have to point to the .gri file.
That will preserve band names for when you re-import in R, and make the
file possible to import in ArcGIS. I'm afraid you won't be able to get the
band names outside of R though.

Best regards,
Lo?c
________________________________________
From: Wall, Wade A ERDC-RDE-CERL-IL [Wade.A.Wall at usace.army.mil]
Sent: Thursday, November 20, 2014 5:23 PM
To: Dutrieux, Loic; r-sig-geo at r-project.org
Subject: RE: Maintaining band names in multiband raster objects

It is convenient for me, unfortunately it is not convenient for downstream
users. They need a format that can be imported in (I hate to say it)
ArcGIS. They are having trouble importing the native raster format into
ArcGIS and I haven't had any luck either.

Wade A. Wall
US Army ERDC-CERL
P.O. Box 9005
Champaign, IL 61826-9005
1-217-373-4420
Wade.A.Wall at usace.army.mil




-----Original Message-----
From: Dutrieux, Loic [mailto:loic.dutrieux at wur.nl]
Sent: Thursday, November 20, 2014 9:33 AM
To: Wall, Wade A ERDC-RDE-CERL-IL; r-sig-geo at r-project.org
Subject: [EXTERNAL] RE: Maintaining band names in multiband raster objects

Hi Wade,

If that's convenient for you, try to store your data in the native format
of the raster package (.grd). It has the advantage of preserving layer
names.

Best regards,
Lo?c
________________________________________
From: r-sig-geo-bounces at r-project.org [r-sig-geo-bounces at r-project.org] on
behalf of Wall, Wade A ERDC-RDE-CERL-IL [Wade.A.Wall at usace.army.mil]
Sent: Thursday, November 20, 2014 4:21 PM
To: r-sig-geo at r-project.org
Subject: [R-sig-Geo] Maintaining band names in multiband raster objects

Hi all,

I am trying to keep band names from imported netcdf files intact when I
export them using the writeRaster() function from the Raster package, but
they are removed and replaced with "Band1, band2, band3, etc."

The .nc files I am importing are located at
http://gdo-dcp.ucllnl.org/downscaled_cmip_projections/dcpInterface.html#Welcome

When I import the .nc files, names(raster object) yields band names such as
x2006.01.15 (January 15 2006). These names are interpretable and I would
like to preserve them.

Is there a way to specify band names for exported raster objects in R? I
have seen posts suggesting it is not possible, but if they can be read,
then they should be able to be written.

Wade A. Wall
US Army ERDC-CERL
P.O. Box 9005
Champaign, IL 61826-9005
1-217-373-4420
Wade.A.Wall at usace.army.mil<mailto:Wade.A.Wall at usace.army.mil>




[[alternative HTML version deleted]]

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo

	[[alternative HTML version deleted]]


From Wade.A.Wall at usace.army.mil  Thu Nov 20 22:32:32 2014
From: Wade.A.Wall at usace.army.mil (Wall, Wade A ERDC-RDE-CERL-IL)
Date: Thu, 20 Nov 2014 21:32:32 +0000
Subject: [R-sig-Geo] [EXTERNAL] Re: Maintaining band names in multiband
 raster objects
In-Reply-To: <CAAcGz98Avjv5CXkxdBhyocX1C_XQO918sCfTndJUt4y6=fFpig@mail.gmail.com>
References: <C1524BE4BF45454293B8DF38FB9B5ECA177DACAA@MS-EX1VKS.erdc.dren.mil>
	<A83620D4CC4762448EFB789FD6E9BBB742BBB629@SCOMP0937.wurnet.nl>
	<C1524BE4BF45454293B8DF38FB9B5ECA177DACCF@MS-EX1VKS.erdc.dren.mil>
	<A83620D4CC4762448EFB789FD6E9BBB742BBB6AD@SCOMP0937.wurnet.nl>
	<CAAcGz98Avjv5CXkxdBhyocX1C_XQO918sCfTndJUt4y6=fFpig@mail.gmail.com>
Message-ID: <C1524BE4BF45454293B8DF38FB9B5ECA177DAD77@MS-EX1VKS.erdc.dren.mil>

Thanks Mike,

As far as I can tell, the time variable is being stripped out also, so it is not available when the netCDF file is exported. For example, this code

clim.brick = brick(?Path to netCDF file?) ## get data
getZ(clim.brick)

yields the appropriate times, But when I export clim.brick using

writeRasterc(clim.brick,?Path to exported file.nc?)

and then attempt to reimport as above, getZ(clim.brick) yields

1,2,3,4 . . . 1104

Obviously the Z values are not being exported with writeRaster.

Wade


From: Michael Sumner [mailto:mdsumner at gmail.com]
Sent: Thursday, November 20, 2014 2:15 PM
To: Wall, Wade A ERDC-RDE-CERL-IL; r-sig-geo at r-project.org
Subject: [EXTERNAL] Re: [R-sig-Geo] Maintaining band names in multiband raster objects

There's just no model for the names in NetCDF, since it *really* stores a 3D array. The analogue in R would be the array's "dimnames", but with NetCDF you'd have to store these names as another variable (sharing the third dimension of your data), and restore them from there.



Do the end user's of the NetCDF really expect these character names, or do they expect a "time" variable on one of the available dimensions? I would just ensure that the "Z dimension" of the object is properly set before writing (see setZ and getZ), and that this round-trips in the expected way. The names can be easily added in R from getZ(x).


Cheers, Mike.

On Fri Nov 21 2014 at 03:34:24 Dutrieux, Loic <loic.dutrieux at wur.nl<mailto:loic.dutrieux at wur.nl>> wrote:

If you create a header for the file, using hrd(), with e.g. format='ENVI', then you should be able to open it in pretty much any GIS software. You have to point to the .gri file.
That will preserve band names for when you re-import in R, and make the file possible to import in ArcGIS. I'm afraid you won't be able to get the band names outside of R though.

Best regards,
Lo?c
________________________________________
From: Wall, Wade A ERDC-RDE-CERL-IL [Wade.A.Wall at usace.army.mil<mailto:Wade.A.Wall at usace.army.mil>]
Sent: Thursday, November 20, 2014 5:23 PM
To: Dutrieux, Loic; r-sig-geo at r-project.org<mailto:r-sig-geo at r-project.org>
Subject: RE: Maintaining band names in multiband raster objects

It is convenient for me, unfortunately it is not convenient for downstream users. They need a format that can be imported in (I hate to say it) ArcGIS. They are having trouble importing the native raster format into ArcGIS and I haven't had any luck either.

Wade A. Wall
US Army ERDC-CERL
P.O. Box 9005
Champaign, IL 61826-9005
1-217-373-4420
Wade.A.Wall at usace.army.mil<mailto:Wade.A.Wall at usace.army.mil>




-----Original Message-----
From: Dutrieux, Loic [mailto:loic.dutrieux at wur.nl<mailto:loic.dutrieux at wur.nl>]
Sent: Thursday, November 20, 2014 9:33 AM
To: Wall, Wade A ERDC-RDE-CERL-IL; r-sig-geo at r-project.org<mailto:r-sig-geo at r-project.org>
Subject: [EXTERNAL] RE: Maintaining band names in multiband raster objects

Hi Wade,

If that's convenient for you, try to store your data in the native format of the raster package (.grd). It has the advantage of preserving layer names.

Best regards,
Lo?c
________________________________________
From: r-sig-geo-bounces at r-project.org<mailto:r-sig-geo-bounces at r-project.org> [r-sig-geo-bounces at r-project.org<mailto:r-sig-geo-bounces at r-project.org>] on behalf of Wall, Wade A ERDC-RDE-CERL-IL [Wade.A.Wall at usace.army.mil<mailto:Wade.A.Wall at usace.army.mil>]
Sent: Thursday, November 20, 2014 4:21 PM
To: r-sig-geo at r-project.org<mailto:r-sig-geo at r-project.org>
Subject: [R-sig-Geo] Maintaining band names in multiband raster objects

Hi all,

I am trying to keep band names from imported netcdf files intact when I export them using the writeRaster() function from the Raster package, but they are removed and replaced with "Band1, band2, band3, etc."

The .nc files I am importing are located at http://gdo-dcp.ucllnl.org/downscaled_cmip_projections/dcpInterface.html#Welcome

When I import the .nc files, names(raster object) yields band names such as x2006.01.15 (January 15 2006). These names are interpretable and I would like to preserve them.

Is there a way to specify band names for exported raster objects in R? I have seen posts suggesting it is not possible, but if they can be read, then they should be able to be written.

Wade A. Wall
US Army ERDC-CERL
P.O. Box 9005
Champaign, IL 61826-9005
1-217-373-4420
Wade.A.Wall at usace.army.mil<mailto:Wade.A.Wall at usace.army.mil><mailto:Wade.A.Wall at usace.army.mil<mailto:Wade.A.Wall at usace.army.mil>>




[[alternative HTML version deleted]]

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org<mailto:R-sig-Geo at r-project.org>
https://stat.ethz.ch/mailman/listinfo/r-sig-geo

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org<mailto:R-sig-Geo at r-project.org>
https://stat.ethz.ch/mailman/listinfo/r-sig-geo

	[[alternative HTML version deleted]]


From matteo.mattiuzzi at boku.ac.at  Sat Nov 22 20:21:05 2014
From: matteo.mattiuzzi at boku.ac.at (Matteo Mattiuzzi)
Date: Sat, 22 Nov 2014 20:21:05 +0100
Subject: [R-sig-Geo] runGdal in MODIS package overrides the default in
 MODISoptions "asIn" pixel size and output a smaller resoultion pixels
In-Reply-To: <1242744271.1621748.1416477843182.JavaMail.yahoo@jws11148.mail.ir2.yahoo.com>
References: <1242744271.1621748.1416477843182.JavaMail.yahoo@jws11148.mail.ir2.yahoo.com>
Message-ID: <5470F031020000270002424D@gwia2.boku.ac.at>

Dear Amit,
I just want to correct my previous mail, runGdal uses gdalwarp not gdal_translate!
Matteo

>>> Amit Boshale <amit.boshale at yahoo.com> 11/20/14 11:08 AM >>>
Dear Matteo,
Thank you so much for the quick response :-)
Staying in Sinusoidal projection is a brilliant idea! 

I will keep the Sinusoidal projection for the first raster, then convert its projection to WGS84 using QGIS and use it as the extend raster "r" you kindly mentioned. If the gdal did the same resampling, I will simply keep Sinusoidal projection for all and convert using QGIS.
Amit

 
      Matteo Mattiuzzi <matteo.mattiuzzi at boku.ac.at> schrieb am 16:34 Mittwoch, 19.November 2014:
   

 

Dear Amit, 
if you set pixelSize asIn, the handling of the pixelsize is done by gdal_translate, runGdal in such case does not provide any information about resolution to used 'gdal_translate'.
As your outProj is 4326 you have geographic coordinates, this means that in planar coordinates your grid is not the equal sized within your extent. I don't know how gdal decides about the resolution if no information has provided, and where it fixes the resolution (from source to target file), with where I mean if it is on a corner, in the middle or some mean of all...

To be precise (or little more precise), the MODIS 250 m resolution is 231,xx m and if you want to have more influence about the pixelsize (and you have no other option than using geographic coordinates), you could convert on the location you focus on the target pixelsize to degrees, having at least in a restricted area the resolution you wish. But I suggest you to stay in Sinusoidal projection and decide on it on a later point if needed:
 
runGdal( job="H12V12", product="MOD13Q1", tileH=12, tileV=12, 
begin="2000049", end="2000049", SDSstring="111000000010", 
outProj="asIn" ,pixelSize="asIn" )

this does not reproject at all, it simply extracts the hdf SDS to single layer tifs. This because your extent is defined with tileH and tileV and you outProj and pixelSize are asIn. 

Or if you have a target raster where you work with in your current project you could also do:

r <- raster('yourrasterfile')
runGdal( job="H12V12", product="MOD13Q1", extent=r, 
begin="2000049", end="2000049", SDSstring="111000000010" )

in this case the MODIS data will fit in any sense the r object (resolution, extent and projection)

I hope this helps,
Matteo

>>> Amit Boshale <amit.boshale at yahoo.com> 11/19/14 2:42 PM >>>
Dear MailLister,

I have a problem with runGdal function in MODIS package. At Nadir the resolution should be 250 m. The output of the following code result are NDVI, EVI, composite day of the year and VI quality Tifs (resolution of 150 m)


> library(MODIS)
> runGdal( job="H12V12", product="MOD13Q1", tileH=12, tileV=12, begin="2000049", end="2000049", SDSstring="111000000010", outProj="EPSG:4326 ,pixelSize="asIn" )

How to stop the re-sampling and keep the original 250 m resolution?

Any help is appreciate

Amit
> MODISoptions() All suggested packages are installed STORAGE:
_______________
localArcPath : E:/localArcPath/ 
outDirPath  : E:/outDirPath/  DOWNLOAD:
_______________
MODISserverOrder : LPDAAC, LAADS 
dlmethod        : auto 
stubbornness    : high  PROCESSING:
_______________
GDAL          : GDAL 1.10.1, released 2013/08/26 
MRT            : Version 4.1 (March 2011) 
pixelSize      : asIn 
outProj        : asIn 
resamplingType : NN 
dataFormat    : GTiff  DEPENDENCIES:
_______________ NULL


> sessionInfo() R version 3.1.2 (2014-10-31)
Platform: x86_64-w64-mingw32/x64 (64-bit) locale:
[1] LC_COLLATE=German_Germany.1252  LC_CTYPE=German_Germany.1252  
[3] LC_MONETARY=German_Germany.1252 LC_NUMERIC=C                  
[5] LC_TIME=German_Germany.1252    attached base packages:
[1] stats    graphics  grDevices utils    datasets  methods  base      other attached packages:
[1] XML_3.98-1.1  RCurl_1.95-4.3 bitops_1.0-6  rgeos_0.3-8    rgdal_0.9-1  
[6] MODIS_0.10-18  raster_2.3-14  sp_1.0-16      loaded via a namespace (and not attached):
[1] grid_3.1.2      lattice_0.20-29 tools_3.1.2  
    [[alternative HTML version deleted]]

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo



   


From zilefacelvis at yahoo.com  Sun Nov 23 18:13:12 2014
From: zilefacelvis at yahoo.com (Zilefac Elvis)
Date: Sun, 23 Nov 2014 17:13:12 +0000 (UTC)
Subject: [R-sig-Geo] subplots of maps in R using hydroTSM package
Message-ID: <1079493693.4280158.1416762792223.JavaMail.yahoo@jws106149.mail.bf1.yahoo.com>

Hello,
Please I need help with maps in R using the hydroTSM package.
I am doing some map work using this wonderful package but encountered a problem using "par".
My intention is to generate 4 plots and show them on same window as follows:


if (dev.cur() == 1) x11(width=14,height=8)
par(mfrow=c(4,4),mai = c(0.8, 0.6, 0.1, 0),oma=c(0,1.4,6,0.1))
 
library(hydroTSM)

############
## Loading the monthly time series of precipitation within the Ebro River basin.
data(EbroPPtsMonthly)

## Loading the gis data
data(EbroPPgis)

## Loading the shapefile with the subcatchments
data(EbroCatchmentsCHE)

## Projection for the Subcatchments file
# European Datum 50, Zone 30N
require(sp)
p4s <- CRS("+proj=utm +zone=30 +ellps=intl +units=m +no_defs")

## Selecting the first day of 'EbroPPtsMonthly' for all the stations.
# The first column of 'EbroPPtsMonthly' has the dates
x.ts <- as.numeric(EbroPPtsMonthly[1, 2:ncol(EbroPPtsMonthly)])

## Setting the name of the gauging stations
names(x.ts) <- colnames(EbroPPtsMonthly[1,2:ncol(EbroPPtsMonthly)])

##################################################
## 1) IDW interpolation and plot
## Probably you will need to resize your window 
## Not run: 
x.idw <- hydrokrige(x.ts= x.ts, x.gis=EbroPPgis, 
                    X="EAST_ED50", Y="NORTH_ED50", sname="ID", bname="CHE_BASIN_NAME",
                    type= "cells",
                    subcatchments= EbroCatchmentsCHE,
                    cell.size= 3000, 
                    ColorRamp= "Precipitation",
                    main= "IDW Precipitation on the Ebro")

## End(Not run)
 


However, the existing plot disappears everytime I run this code.

Question1: How can I run this code 4 times and show the 4 maps on 1 plot window as defined by 
par(mfrow=c(4,4))?

Question2: Is it possible to convert the X and Y axes values from UTM to lat and lon and show them on the map?

Many thanks for your insighful replies.

Zilefac.


From m.yang at student.utwente.nl  Sun Nov 23 23:51:58 2014
From: m.yang at student.utwente.nl (Mengxi Yang)
Date: Sun, 23 Nov 2014 23:51:58 +0100
Subject: [R-sig-Geo] questions on spatial interpolation exercise(NL)
Message-ID: <CA+vD2zrwKNNEwYjw+HcMUCuWjRJVk=RLnxH036Bj8u9YoBp1Hw@mail.gmail.com>

Dear list,
I have a question on write.table. I found an nice exercise on spatial
interpolation from
http://spatial-analyst.net/wiki/index.php?title=Spatial_interpolation_exercises_(NL)#Spatial_prediction_of_daily_precipitation_in_the_Netherlands

In this exercise, the date is 200906. but when I change to 201310. there is
a wrong message like:

> tmp <- readLines(paste(getwd(), "/", "monv_201310.txt", sep=""))
> tmp <- gsub(pattern=' . ', replacement=' 0.0 ', tmp, fixed = TRUE)
> tmp <- gsub(pattern='[[:space:]]{2,7}', replacement=',', tmp)
> write.table(t(matrix(unlist(strsplit(tmp, ",")[-c(1:8)]), nrow=41)),
"tmp.txt", col.names=FALSE, row.names=FALSE)
Warning message:
In matrix(unlist(strsplit(tmp, ",")[-c(1:8)]), nrow = 41) :
  data length [13625] is not a sub-multiple or multiple of the number of
rows [41]


I checked several month, some success but some not.
Does anyone know what is the wrong with it? should I change something?

Thank you very much.

Mengxi Yang

	[[alternative HTML version deleted]]


From mark at dimensionaledge.com  Mon Nov 24 05:19:13 2014
From: mark at dimensionaledge.com (Mark Wynter)
Date: Mon, 24 Nov 2014 14:49:13 +1030
Subject: [R-sig-Geo] R crashes performing gstat IDW with omax argument
Message-ID: <46A96CA4-E5D3-4736-9D63-11CF984886E2@dimensionaledge.com>



I'm trying to use gstat's IDW function with an omax argument
Addition of the omax argument causes R to crash - works fine without it.

*** Error in `/usr/lib/R/bin/exec/R': corrupted double-linked list:
0x00000000038c8540 ***
I'm running R v 3.1 on Ubuntu 12.04

Can anyone else replicate this error on R 3.1 with the following script?

#Crashtest
#Libraries
library(sp)
library(gstat)
library(RColorBrewer)

#make some random xyz point data
x = round(runif(100), 2)
y = round(runif(100), 2)
z = data.frame(rainfall=round(runif(100), 2)*1000)

#convert to spatial points data frame
xy = cbind(x, y)
xy.sp = SpatialPoints(xy)
xy.spdf = SpatialPointsDataFrame(xy.sp, z)

#prepare grid surface
x.range <- range(xy.spdf at coords[,1])
y.range <- range(xy.spdf at coords[,2])
grd <- expand.grid(x=seq(from=x.range[1]-0.5, to=x.range[2]+0.5, by=0.01),
y=seq(from=y.range[1]-0.5, to=y.range[2]+0.5, by=0.01) )
coordinates(grd) <- ~ x+y
gridded(grd) <- TRUE

#perform IDW interpolation and plot results
precip.pal <- colorRampPalette(brewer.pal(7, name="Blues"))
precip.idw3 <- idw(rainfall~1, xy.spdf, grd, idp = 3, maxdist=0.2, omax=2)
spplot(precip.idw3, "var1.pred", col.regions=precip.pal, pretty=TRUE,
main="Rainfall Interpolated (mm)", labels=TRUE,
      sp.layout=list("sp.points", xy.spdf, col="red", first=FALSE))

Sent from my iPhone


From tim.appelhans at gmail.com  Mon Nov 24 09:20:47 2014
From: tim.appelhans at gmail.com (Tim Appelhans)
Date: Mon, 24 Nov 2014 09:20:47 +0100
Subject: [R-sig-Geo] R crashes performing gstat IDW with omax argument
In-Reply-To: <46A96CA4-E5D3-4736-9D63-11CF984886E2@dimensionaledge.com>
References: <46A96CA4-E5D3-4736-9D63-11CF984886E2@dimensionaledge.com>
Message-ID: <5472EA5F.9050101@gmail.com>

Hey Mark,
I'm running R 3.1.2. on Ubuntu 12.04 and see the following with your 
example:

*** glibc detected *** /usr/lib/R/bin/exec/R: free(): invalid next size 
(fast): 0x00000000073acab0 ***

So nearly, though not exactly the same....

I have no idea what it means though, sorry

Tim

On 11/24/2014 05:19 AM, Mark Wynter wrote:
>
> I'm trying to use gstat's IDW function with an omax argument
> Addition of the omax argument causes R to crash - works fine without it.
>
> *** Error in `/usr/lib/R/bin/exec/R': corrupted double-linked list:
> 0x00000000038c8540 ***
> I'm running R v 3.1 on Ubuntu 12.04
>
> Can anyone else replicate this error on R 3.1 with the following script?
>
> #Crashtest
> #Libraries
> library(sp)
> library(gstat)
> library(RColorBrewer)
>
> #make some random xyz point data
> x = round(runif(100), 2)
> y = round(runif(100), 2)
> z = data.frame(rainfall=round(runif(100), 2)*1000)
>
> #convert to spatial points data frame
> xy = cbind(x, y)
> xy.sp = SpatialPoints(xy)
> xy.spdf = SpatialPointsDataFrame(xy.sp, z)
>
> #prepare grid surface
> x.range <- range(xy.spdf at coords[,1])
> y.range <- range(xy.spdf at coords[,2])
> grd <- expand.grid(x=seq(from=x.range[1]-0.5, to=x.range[2]+0.5, by=0.01),
> y=seq(from=y.range[1]-0.5, to=y.range[2]+0.5, by=0.01) )
> coordinates(grd) <- ~ x+y
> gridded(grd) <- TRUE
>
> #perform IDW interpolation and plot results
> precip.pal <- colorRampPalette(brewer.pal(7, name="Blues"))
> precip.idw3 <- idw(rainfall~1, xy.spdf, grd, idp = 3, maxdist=0.2, omax=2)
> spplot(precip.idw3, "var1.pred", col.regions=precip.pal, pretty=TRUE,
> main="Rainfall Interpolated (mm)", labels=TRUE,
>        sp.layout=list("sp.points", xy.spdf, col="red", first=FALSE))
>
> Sent from my iPhone
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
#####################################
Tim Appelhans
Department of Geography
Environmental Informatics
Philipps Universit?t Marburg
Deutschhausstra?e 12
35032 Marburg (Paketpost: 35037 Marburg)
Germany

Tel +49 (0) 6421 28-25957

http://environmentalinformatics-marburg.de/


From edzer.pebesma at uni-muenster.de  Mon Nov 24 09:33:34 2014
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Mon, 24 Nov 2014 09:33:34 +0100
Subject: [R-sig-Geo] R crashes performing gstat IDW with omax argument
In-Reply-To: <5472EA5F.9050101@gmail.com>
References: <46A96CA4-E5D3-4736-9D63-11CF984886E2@dimensionaledge.com>
	<5472EA5F.9050101@gmail.com>
Message-ID: <5472ED5E.1020300@uni-muenster.de>

Thanks for the reproducible and small example!

I found the bug and committed a fix to r-forge.

For the the version that causes this problem, you can use omax when in
addition you specify nmax to the same value (but pls check that the
output makes sense).

On 11/24/2014 09:20 AM, Tim Appelhans wrote:
> Hey Mark,
> I'm running R 3.1.2. on Ubuntu 12.04 and see the following with your
> example:
> 
> *** glibc detected *** /usr/lib/R/bin/exec/R: free(): invalid next size
> (fast): 0x00000000073acab0 ***
> 
> So nearly, though not exactly the same....
> 
> I have no idea what it means though, sorry
> 
> Tim
> 
> On 11/24/2014 05:19 AM, Mark Wynter wrote:
>>
>> I'm trying to use gstat's IDW function with an omax argument
>> Addition of the omax argument causes R to crash - works fine without it.
>>
>> *** Error in `/usr/lib/R/bin/exec/R': corrupted double-linked list:
>> 0x00000000038c8540 ***
>> I'm running R v 3.1 on Ubuntu 12.04
>>
>> Can anyone else replicate this error on R 3.1 with the following script?
>>
>> #Crashtest
>> #Libraries
>> library(sp)
>> library(gstat)
>> library(RColorBrewer)
>>
>> #make some random xyz point data
>> x = round(runif(100), 2)
>> y = round(runif(100), 2)
>> z = data.frame(rainfall=round(runif(100), 2)*1000)
>>
>> #convert to spatial points data frame
>> xy = cbind(x, y)
>> xy.sp = SpatialPoints(xy)
>> xy.spdf = SpatialPointsDataFrame(xy.sp, z)
>>
>> #prepare grid surface
>> x.range <- range(xy.spdf at coords[,1])
>> y.range <- range(xy.spdf at coords[,2])
>> grd <- expand.grid(x=seq(from=x.range[1]-0.5, to=x.range[2]+0.5,
>> by=0.01),
>> y=seq(from=y.range[1]-0.5, to=y.range[2]+0.5, by=0.01) )
>> coordinates(grd) <- ~ x+y
>> gridded(grd) <- TRUE
>>
>> #perform IDW interpolation and plot results
>> precip.pal <- colorRampPalette(brewer.pal(7, name="Blues"))
>> precip.idw3 <- idw(rainfall~1, xy.spdf, grd, idp = 3, maxdist=0.2,
>> omax=2)
>> spplot(precip.idw3, "var1.pred", col.regions=precip.pal, pretty=TRUE,
>> main="Rainfall Interpolated (mm)", labels=TRUE,
>>        sp.layout=list("sp.points", xy.spdf, col="red", first=FALSE))
>>
>> Sent from my iPhone
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma,  Co-Editor-in-Chief Computers & Geosciences
Institute for Geoinformatics (ifgi), University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
83 33081 http://ifgi.uni-muenster.de GPG key ID 0xAC227795

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 490 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20141124/f85803c0/attachment.bin>

From edzer.pebesma at uni-muenster.de  Mon Nov 24 09:40:51 2014
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Mon, 24 Nov 2014 09:40:51 +0100
Subject: [R-sig-Geo] subplots of maps in R using hydroTSM package
In-Reply-To: <1079493693.4280158.1416762792223.JavaMail.yahoo@jws106149.mail.bf1.yahoo.com>
References: <1079493693.4280158.1416762792223.JavaMail.yahoo@jws106149.mail.bf1.yahoo.com>
Message-ID: <5472EF13.7020301@uni-muenster.de>

It looks like hydroTSM uses sp::spplot to plot maps; this function uses
lattice which builds on grid graphics, and hence mfrow does not work.

As hydrokrige does not return the trellis plot object but merely plots
it, it's not easy to arrange plots using lattice::print.trellis

It seems relatively easy though to figure out what hydrokrige does, and
then do that yourself, using spplot and print.trellis; see

library(gstat)
demo(krige)

for examples.

On 11/23/2014 06:13 PM, Zilefac Elvis wrote:
> Hello,
> Please I need help with maps in R using the hydroTSM package.
> I am doing some map work using this wonderful package but encountered a problem using "par".
> My intention is to generate 4 plots and show them on same window as follows:
> 
> 
> if (dev.cur() == 1) x11(width=14,height=8)
> par(mfrow=c(4,4),mai = c(0.8, 0.6, 0.1, 0),oma=c(0,1.4,6,0.1))
>  
> library(hydroTSM)
> 
> ############
> ## Loading the monthly time series of precipitation within the Ebro River basin.
> data(EbroPPtsMonthly)
> 
> ## Loading the gis data
> data(EbroPPgis)
> 
> ## Loading the shapefile with the subcatchments
> data(EbroCatchmentsCHE)
> 
> ## Projection for the Subcatchments file
> # European Datum 50, Zone 30N
> require(sp)
> p4s <- CRS("+proj=utm +zone=30 +ellps=intl +units=m +no_defs")
> 
> ## Selecting the first day of 'EbroPPtsMonthly' for all the stations.
> # The first column of 'EbroPPtsMonthly' has the dates
> x.ts <- as.numeric(EbroPPtsMonthly[1, 2:ncol(EbroPPtsMonthly)])
> 
> ## Setting the name of the gauging stations
> names(x.ts) <- colnames(EbroPPtsMonthly[1,2:ncol(EbroPPtsMonthly)])
> 
> ##################################################
> ## 1) IDW interpolation and plot
> ## Probably you will need to resize your window 
> ## Not run: 
> x.idw <- hydrokrige(x.ts= x.ts, x.gis=EbroPPgis, 
>                     X="EAST_ED50", Y="NORTH_ED50", sname="ID", bname="CHE_BASIN_NAME",
>                     type= "cells",
>                     subcatchments= EbroCatchmentsCHE,
>                     cell.size= 3000, 
>                     ColorRamp= "Precipitation",
>                     main= "IDW Precipitation on the Ebro")
> 
> ## End(Not run)
>  
> 
> 
> However, the existing plot disappears everytime I run this code.
> 
> Question1: How can I run this code 4 times and show the 4 maps on 1 plot window as defined by 
> par(mfrow=c(4,4))?
> 
> Question2: Is it possible to convert the X and Y axes values from UTM to lat and lon and show them on the map?
> 
> Many thanks for your insighful replies.
> 
> Zilefac.
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma,  Co-Editor-in-Chief Computers & Geosciences
Institute for Geoinformatics (ifgi), University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
83 33081 http://ifgi.uni-muenster.de GPG key ID 0xAC227795

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 490 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20141124/5400e8f0/attachment.bin>

From edzer.pebesma at uni-muenster.de  Mon Nov 24 09:41:56 2014
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Mon, 24 Nov 2014 09:41:56 +0100
Subject: [R-sig-Geo] questions on spatial interpolation exercise(NL)
In-Reply-To: <CA+vD2zrwKNNEwYjw+HcMUCuWjRJVk=RLnxH036Bj8u9YoBp1Hw@mail.gmail.com>
References: <CA+vD2zrwKNNEwYjw+HcMUCuWjRJVk=RLnxH036Bj8u9YoBp1Hw@mail.gmail.com>
Message-ID: <5472EF54.4020105@uni-muenster.de>

Mengxi, please provide a minimal script that reproduces your error.

On 11/23/2014 11:51 PM, Mengxi Yang wrote:
> Dear list,
> I have a question on write.table. I found an nice exercise on spatial
> interpolation from
> http://spatial-analyst.net/wiki/index.php?title=Spatial_interpolation_exercises_(NL)#Spatial_prediction_of_daily_precipitation_in_the_Netherlands
> 
> In this exercise, the date is 200906. but when I change to 201310. there is
> a wrong message like:
> 
>> tmp <- readLines(paste(getwd(), "/", "monv_201310.txt", sep=""))
>> tmp <- gsub(pattern=' . ', replacement=' 0.0 ', tmp, fixed = TRUE)
>> tmp <- gsub(pattern='[[:space:]]{2,7}', replacement=',', tmp)
>> write.table(t(matrix(unlist(strsplit(tmp, ",")[-c(1:8)]), nrow=41)),
> "tmp.txt", col.names=FALSE, row.names=FALSE)
> Warning message:
> In matrix(unlist(strsplit(tmp, ",")[-c(1:8)]), nrow = 41) :
>   data length [13625] is not a sub-multiple or multiple of the number of
> rows [41]
> 
> 
> I checked several month, some success but some not.
> Does anyone know what is the wrong with it? should I change something?
> 
> Thank you very much.
> 
> Mengxi Yang
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma,  Co-Editor-in-Chief Computers & Geosciences
Institute for Geoinformatics (ifgi), University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
83 33081 http://ifgi.uni-muenster.de GPG key ID 0xAC227795

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 490 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20141124/57312653/attachment.bin>

From jon.skoien at jrc.ec.europa.eu  Mon Nov 24 09:48:34 2014
From: jon.skoien at jrc.ec.europa.eu (Jon Skoien)
Date: Mon, 24 Nov 2014 09:48:34 +0100
Subject: [R-sig-Geo] subplots of maps in R using hydroTSM package
In-Reply-To: <1079493693.4280158.1416762792223.JavaMail.yahoo@jws106149.mail.bf1.yahoo.com>
References: <1079493693.4280158.1416762792223.JavaMail.yahoo@jws106149.mail.bf1.yahoo.com>
Message-ID: <5472F0E2.3000503@jrc.ec.europa.eu>

Hi Zilefac,

Your problem is not really related to hydroTSM, but to the fact that 
hydrokrige uses spplot for plotting, which is again based on the lattice 
package. This does not use the par()-arguments.
Instead there are two other ways for producing multiple plots in one figure:
- Save each of the prediction-results from hydrokrige in a different 
column of a results-object and plot them with spplot later:
res = hydrokrige("1st dataset")
res$var2.pred = hydrokrige("2nd dataset")$var1.pred
res$var3.pred = hydrokrige("2nd dataset")$var3.pred
...
spplot(res, c("var1.pred", "var2.pred", ...))

- Use the location arguments of plot.trellis when you plot the resulting 
objects.
res1 = hydrokrige("1st dataset")
res2 = hydrokrige("2nd dataset")
print(res1, position = c(0,0,.5,.5),more=TRUE)
print(res1, position = c(0,0.5,.5,.5),more=TRUE)
....

You can in both cases turn of the plotting in hydrokrige, as the 
function will not be able to do multiplots by itself.

For your second question, you should be able to transform your 
coordinates with spTransform, if you have the proj4string of your 
coordinates.

Cheers,
Jon


On 11/23/2014 6:13 PM, Zilefac Elvis wrote:
> Hello,
> Please I need help with maps in R using the hydroTSM package.
> I am doing some map work using this wonderful package but encountered a problem using "par".
> My intention is to generate 4 plots and show them on same window as follows:
>
>
> if (dev.cur() == 1) x11(width=14,height=8)
> par(mfrow=c(4,4),mai = c(0.8, 0.6, 0.1, 0),oma=c(0,1.4,6,0.1))
>
> library(hydroTSM)
>
> ############
> ## Loading the monthly time series of precipitation within the Ebro River basin.
> data(EbroPPtsMonthly)
>
> ## Loading the gis data
> data(EbroPPgis)
>
> ## Loading the shapefile with the subcatchments
> data(EbroCatchmentsCHE)
>
> ## Projection for the Subcatchments file
> # European Datum 50, Zone 30N
> require(sp)
> p4s <- CRS("+proj=utm +zone=30 +ellps=intl +units=m +no_defs")
>
> ## Selecting the first day of 'EbroPPtsMonthly' for all the stations.
> # The first column of 'EbroPPtsMonthly' has the dates
> x.ts <- as.numeric(EbroPPtsMonthly[1, 2:ncol(EbroPPtsMonthly)])
>
> ## Setting the name of the gauging stations
> names(x.ts) <- colnames(EbroPPtsMonthly[1,2:ncol(EbroPPtsMonthly)])
>
> ##################################################
> ## 1) IDW interpolation and plot
> ## Probably you will need to resize your window
> ## Not run:
> x.idw <- hydrokrige(x.ts= x.ts, x.gis=EbroPPgis,
>                      X="EAST_ED50", Y="NORTH_ED50", sname="ID", bname="CHE_BASIN_NAME",
>                      type= "cells",
>                      subcatchments= EbroCatchmentsCHE,
>                      cell.size= 3000,
>                      ColorRamp= "Precipitation",
>                      main= "IDW Precipitation on the Ebro")
>
> ## End(Not run)
>
>
>
> However, the existing plot disappears everytime I run this code.
>
> Question1: How can I run this code 4 times and show the 4 maps on 1 plot window as defined by
> par(mfrow=c(4,4))?
>
> Question2: Is it possible to convert the X and Y axes values from UTM to lat and lon and show them on the map?
>
> Many thanks for your insighful replies.
>
> Zilefac.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Jon Olav Sk?ien
Joint Research Centre - European Commission
Institute for Environment and Sustainability (IES)
Climate Risk Management Unit

Disclaimer: Views expressed in this email are those of the individual 
and do not necessarily represent official views of the European Commission.


From mkborregaard at snm.ku.dk  Mon Nov 24 14:56:57 2014
From: mkborregaard at snm.ku.dk (Michael Krabbe Borregaard)
Date: Mon, 24 Nov 2014 13:56:57 +0000
Subject: [R-sig-Geo] shifting points in plot window
In-Reply-To: <CAAcGz98PfE-7huf7L2Ocny_ozNkVS6Q9r1gOkpYngmAsixXu7w@mail.gmail.com>
References: <1416221143594-7587439.post@n2.nabble.com>
	<CAAcGz98PfE-7huf7L2Ocny_ozNkVS6Q9r1gOkpYngmAsixXu7w@mail.gmail.com>
Message-ID: <D098F762.18066%cvg147@ku.dk>

Thanks,
This was very helpful. I have a package that depends on raster, and have included a note on this in the documentation.


From: Michael Sumner:

This is a known problem with no known fix. I've been trying to isolate it but without success.

If anyone can see how to fix it we can help get it into raster - I believe that it is somewhere in the plot method/s for the raster package. It occurs for any vector data overlay, and for either useRaster (for image()) set TRUE or FALSE.

Cheers, Mike

On Mon, 17 Nov 2014 21:46 mkborregaard <mkborregaard at snm.ku.dk<mailto:mkborregaard at snm.ku.dk>> wrote:
When I plot a raster image (package raster) and then plot points on top (type
SpatialPoints, package sp) everything aligns well. But if then resize the
window, the alignment disappears, and the points move around. Can I avoid
this behavior? The points and the raster are both defined as lat/long data.
proj4string is "+proj=longlat +ellps=WGS84 +towgs84=0,0,0,0,0,0,0 +no_defs"
for both.

I am sorry for posting a very simple question that I should be able to find
the resolution of, but I have not been able to find this.




--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/shifting-points-in-plot-window-tp7587439.html
Sent from the R-sig-geo mailing list archive at Nabble.com.

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org<mailto:R-sig-Geo at r-project.org>
https://stat.ethz.ch/mailman/listinfo/r-sig-geo

	[[alternative HTML version deleted]]


From edzer.pebesma at uni-muenster.de  Mon Nov 24 15:58:34 2014
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Mon, 24 Nov 2014 15:58:34 +0100
Subject: [R-sig-Geo] shifting points in plot window
In-Reply-To: <D098F762.18066%cvg147@ku.dk>
References: <1416221143594-7587439.post@n2.nabble.com>	<CAAcGz98PfE-7huf7L2Ocny_ozNkVS6Q9r1gOkpYngmAsixXu7w@mail.gmail.com>
	<D098F762.18066%cvg147@ku.dk>
Message-ID: <5473479A.5090801@uni-muenster.de>

I believe plotting routines in raster were built from (or inspired by)
those in package fields. The issue arises when the plotting area is
split in two parts, one for the map and one for the legend, and the need
to know the aspect ratio of the first when adding to the plot -- the
legend width is fixed, and that might mess up aspect of the map region
when resizing.

image methods from sp do not have this problem, but also do not show you
the legend. sp::spplot uses grid, so doesn't let you add to plots
incrementally.



On 11/24/2014 02:56 PM, Michael Krabbe Borregaard wrote:
> Thanks,
> This was very helpful. I have a package that depends on raster, and have included a note on this in the documentation.
> 
> 
> From: Michael Sumner:
> 
> This is a known problem with no known fix. I've been trying to isolate it but without success.
> 
> If anyone can see how to fix it we can help get it into raster - I believe that it is somewhere in the plot method/s for the raster package. It occurs for any vector data overlay, and for either useRaster (for image()) set TRUE or FALSE.
> 
> Cheers, Mike
> 
> On Mon, 17 Nov 2014 21:46 mkborregaard <mkborregaard at snm.ku.dk<mailto:mkborregaard at snm.ku.dk>> wrote:
> When I plot a raster image (package raster) and then plot points on top (type
> SpatialPoints, package sp) everything aligns well. But if then resize the
> window, the alignment disappears, and the points move around. Can I avoid
> this behavior? The points and the raster are both defined as lat/long data.
> proj4string is "+proj=longlat +ellps=WGS84 +towgs84=0,0,0,0,0,0,0 +no_defs"
> for both.
> 
> I am sorry for posting a very simple question that I should be able to find
> the resolution of, but I have not been able to find this.
> 
> 
> 
> 
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/shifting-points-in-plot-window-tp7587439.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org<mailto:R-sig-Geo at r-project.org>
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma,  Co-Editor-in-Chief Computers & Geosciences
Institute for Geoinformatics (ifgi), University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
83 33081 http://ifgi.uni-muenster.de GPG key ID 0xAC227795

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 490 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20141124/f7398d08/attachment.bin>

From bakare at ualberta.ca  Mon Nov 24 18:34:59 2014
From: bakare at ualberta.ca (Moshood Agba Bakare)
Date: Mon, 24 Nov 2014 10:34:59 -0700
Subject: [R-sig-Geo] Variable search radius for interpolation
Message-ID: <CAJRR3XP2j-nbbK-OgoSPR=qs0tAOSXww5Fe5woDu3Jp2Ag_DOg@mail.gmail.com>

Hi All,
Could anyone guide me on how to define variable search radius in GSTAT
while interpolating into a grid cell? The GSTAT documentation used MAXDIST
to define fixed search radius. (2) Is there a function in GSTAT to
determine the point density while interpolating into different grids size?

Thank you

	[[alternative HTML version deleted]]


From zilefacelvis at yahoo.com  Mon Nov 24 18:39:55 2014
From: zilefacelvis at yahoo.com (Zilefac Elvis)
Date: Mon, 24 Nov 2014 17:39:55 +0000 (UTC)
Subject: [R-sig-Geo] subplots of maps in R using hydroTSM package
In-Reply-To: <5472F0E2.3000503@jrc.ec.europa.eu>
References: <5472F0E2.3000503@jrc.ec.europa.eu>
Message-ID: <701469717.261821.1416850795974.JavaMail.yahoo@jws10686.mail.bf1.yahoo.com>

Many thanks, Jon.
Just what I wanted.
Zilefac.


On Monday, November 24, 2014 2:48 AM, Jon Skoien <jon.skoien at jrc.ec.europa.eu> wrote:
Hi Zilefac,

Your problem is not really related to hydroTSM, but to the fact that 
hydrokrige uses spplot for plotting, which is again based on the lattice 
package. This does not use the par()-arguments.
Instead there are two other ways for producing multiple plots in one figure:
- Save each of the prediction-results from hydrokrige in a different 
column of a results-object and plot them with spplot later:
res = hydrokrige("1st dataset")
res$var2.pred = hydrokrige("2nd dataset")$var1.pred
res$var3.pred = hydrokrige("2nd dataset")$var3.pred
...
spplot(res, c("var1.pred", "var2.pred", ...))

- Use the location arguments of plot.trellis when you plot the resulting 
objects.
res1 = hydrokrige("1st dataset")
res2 = hydrokrige("2nd dataset")
print(res1, position = c(0,0,.5,.5),more=TRUE)
print(res1, position = c(0,0.5,.5,.5),more=TRUE)
....

You can in both cases turn of the plotting in hydrokrige, as the 
function will not be able to do multiplots by itself.

For your second question, you should be able to transform your 
coordinates with spTransform, if you have the proj4string of your 
coordinates.

Cheers,
Jon



On 11/23/2014 6:13 PM, Zilefac Elvis wrote:
> Hello,
> Please I need help with maps in R using the hydroTSM package.
> I am doing some map work using this wonderful package but encountered a problem using "par".
> My intention is to generate 4 plots and show them on same window as follows:
>
>
> if (dev.cur() == 1) x11(width=14,height=8)
> par(mfrow=c(4,4),mai = c(0.8, 0.6, 0.1, 0),oma=c(0,1.4,6,0.1))
>
> library(hydroTSM)
>
> ############
> ## Loading the monthly time series of precipitation within the Ebro River basin.
> data(EbroPPtsMonthly)
>
> ## Loading the gis data
> data(EbroPPgis)
>
> ## Loading the shapefile with the subcatchments
> data(EbroCatchmentsCHE)
>
> ## Projection for the Subcatchments file
> # European Datum 50, Zone 30N
> require(sp)
> p4s <- CRS("+proj=utm +zone=30 +ellps=intl +units=m +no_defs")
>
> ## Selecting the first day of 'EbroPPtsMonthly' for all the stations.
> # The first column of 'EbroPPtsMonthly' has the dates
> x.ts <- as.numeric(EbroPPtsMonthly[1, 2:ncol(EbroPPtsMonthly)])
>
> ## Setting the name of the gauging stations
> names(x.ts) <- colnames(EbroPPtsMonthly[1,2:ncol(EbroPPtsMonthly)])
>
> ##################################################
> ## 1) IDW interpolation and plot
> ## Probably you will need to resize your window
> ## Not run:
> x.idw <- hydrokrige(x.ts= x.ts, x.gis=EbroPPgis,
>                      X="EAST_ED50", Y="NORTH_ED50", sname="ID", bname="CHE_BASIN_NAME",
>                      type= "cells",
>                      subcatchments= EbroCatchmentsCHE,
>                      cell.size= 3000,
>                      ColorRamp= "Precipitation",
>                      main= "IDW Precipitation on the Ebro")
>
> ## End(Not run)
>
>
>
> However, the existing plot disappears everytime I run this code.
>
> Question1: How can I run this code 4 times and show the 4 maps on 1 plot window as defined by
> par(mfrow=c(4,4))?
>
> Question2: Is it possible to convert the X and Y axes values from UTM to lat and lon and show them on the map?
>
> Many thanks for your insighful replies.
>
> Zilefac.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Jon Olav Sk?ien
Joint Research Centre - European Commission
Institute for Environment and Sustainability (IES)
Climate Risk Management Unit

Disclaimer: Views expressed in this email are those of the individual 
and do not necessarily represent official views of the European Commission.


From hengl at spatial-analyst.net  Mon Nov 24 19:24:34 2014
From: hengl at spatial-analyst.net (Tomislav Hengl)
Date: Mon, 24 Nov 2014 19:24:34 +0100
Subject: [R-sig-Geo] questions on spatial interpolation exercise(NL)
In-Reply-To: <CA+vD2zrwKNNEwYjw+HcMUCuWjRJVk=RLnxH036Bj8u9YoBp1Hw@mail.gmail.com>
References: <CA+vD2zrwKNNEwYjw+HcMUCuWjRJVk=RLnxH036Bj8u9YoBp1Hw@mail.gmail.com>
Message-ID: <547377E2.6050905@spatial-analyst.net>


You need to provide access to "monv_201310.txt" so that we can see what 
is the structure of that file. The original file with rainfall data from 
that URL is simply a text file from the KNMI website (without any 
tabular structure) so that e.g.:

...
write.table(t(matrix(unlist(strsplit(tmp, ",")[-c(1:8)]), nrow=41)), 
"tmp.txt", col.names=FALSE, row.names=FALSE)
...
monv_200906 <- read.table("tmp.txt", col.names=c("empty1", "NR", 
paste("D", 1:30, sep=""), "I", "NORM", "II", "NORM", "III", "NORM", 
"MND", "NORM", "Locatie"))

creates structure based on what is in the text object (hence I first 
open the text file and then figure out the code to read the values). Of 
course, the structure of the raw KNMI files could have changed from 2009.

If you are planning to interpolate monthly rainfall data take also a 
look at the two geostatistical packages that elaborate geostatistics 
with skewed values / variables with skewed distributions (I have not 
updated the 
http://spatial-analyst.net/wiki/index.php?title=Spatial_interpolation_exercises_(NL) 
pages for a long time; sorry for that):

http://cran.r-project.org/package=georob
http://cran.r-project.org/package=geostatsp
described in -> http://pbrown.ca/geostatsp/document-rev.pdf

HTH,

T. Hengl

On 23-11-2014 23:51, Mengxi Yang wrote:
> Dear list,
> I have a question on write.table. I found an nice exercise on spatial
> interpolation from
> http://spatial-analyst.net/wiki/index.php?title=Spatial_interpolation_exercises_(NL)#Spatial_prediction_of_daily_precipitation_in_the_Netherlands
>
> In this exercise, the date is 200906. but when I change to 201310. there is
> a wrong message like:
>
>> tmp <- readLines(paste(getwd(), "/", "monv_201310.txt", sep=""))
>> tmp <- gsub(pattern=' . ', replacement=' 0.0 ', tmp, fixed = TRUE)
>> tmp <- gsub(pattern='[[:space:]]{2,7}', replacement=',', tmp)
>> write.table(t(matrix(unlist(strsplit(tmp, ",")[-c(1:8)]), nrow=41)),
> "tmp.txt", col.names=FALSE, row.names=FALSE)
> Warning message:
> In matrix(unlist(strsplit(tmp, ",")[-c(1:8)]), nrow = 41) :
>    data length [13625] is not a sub-multiple or multiple of the number of
> rows [41]
>
>
> I checked several month, some success but some not.
> Does anyone know what is the wrong with it? should I change something?
>
> Thank you very much.
>
> Mengxi Yang
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From hengl at spatial-analyst.net  Mon Nov 24 20:16:08 2014
From: hengl at spatial-analyst.net (Tomislav Hengl)
Date: Mon, 24 Nov 2014 20:16:08 +0100
Subject: [R-sig-Geo] Variable search radius for interpolation
In-Reply-To: <CAJRR3XP2j-nbbK-OgoSPR=qs0tAOSXww5Fe5woDu3Jp2Ag_DOg@mail.gmail.com>
References: <CAJRR3XP2j-nbbK-OgoSPR=qs0tAOSXww5Fe5woDu3Jp2Ag_DOg@mail.gmail.com>
Message-ID: <547383F8.7050200@spatial-analyst.net>


I've implemented recently a function that helps speeding up kriging with 
spatially clustered data (for it fits kernel density function first and 
then sub-samples regular points proportionally to the density of 
observations). It comes together with the GSIF package:

http://gsif.r-forge.r-project.org/spline.krige.html

This should be especially useful if you need to interpolate values over 
a large grid e.g. millions of prediction locations. For example, I've 
used it to interpolate values over whole Africa at 250 m (over 30,000 by 
30,000 pixels) and it took only 3-4 minutes to run.

Note that this function needs SAGA GIS (v2.1 or higher).

HTH,

T. Hengl

On 24-11-2014 18:34, Moshood Agba Bakare wrote:
> Hi All,
> Could anyone guide me on how to define variable search radius in GSTAT
> while interpolating into a grid cell? The GSTAT documentation used MAXDIST
> to define fixed search radius. (2) Is there a function in GSTAT to
> determine the point density while interpolating into different grids size?
>
> Thank you
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From masha.pautrel at gmail.com  Tue Nov 25 06:09:48 2014
From: masha.pautrel at gmail.com (Masha Pautrel)
Date: Tue, 25 Nov 2014 06:09:48 +0100
Subject: [R-sig-Geo] problem with NY8 <- readOGR(".", "NY8_utm18")
Message-ID: <54740F1C.6030809@gmail.com>

Dear all,

I try to use NY8 data set, but I can't open the file.

Here the errors message

 > library(sp)
 > library(rgdal)
 > NY8 <- readOGR(".", "NY8_utm18")
Erreur dans ogrInfo(dsn = dsn, layer = layer, encoding = encoding, 
use_iconv = use_iconv,  :
   Cannot open file
 > cities <- readOGR(".", "NY8cities")
Erreur dans ogrInfo(dsn = dsn, layer = layer, encoding = encoding, 
use_iconv = use_iconv,  :
   Cannot open file
 > TCE <- readOGR(".", "TCE")
Erreur dans ogrInfo(dsn = dsn, layer = layer, encoding = encoding, 
use_iconv = use_iconv,  :
   Cannot open file


Thank you for yours help

Sincerly
Masha Pautrel


From kridox at ymail.com  Tue Nov 25 08:49:43 2014
From: kridox at ymail.com (Pascal Oettli)
Date: Tue, 25 Nov 2014 16:49:43 +0900
Subject: [R-sig-Geo] problem with NY8 <- readOGR(".", "NY8_utm18")
In-Reply-To: <54740F1C.6030809@gmail.com>
References: <54740F1C.6030809@gmail.com>
Message-ID: <CAAcyNCx-G2c=Br6mdAV2a5bdCVvY4cv=ZHQoYAoCTzNCRM0Xmw@mail.gmail.com>

Masha,

Are you running the command in the correct directory? You should
replace "." by the path to your file.

Regards,
Pascal

On Tue, Nov 25, 2014 at 2:09 PM, Masha Pautrel <masha.pautrel at gmail.com> wrote:
> Dear all,
>
> I try to use NY8 data set, but I can't open the file.
>
> Here the errors message
>
>> library(sp)
>> library(rgdal)
>> NY8 <- readOGR(".", "NY8_utm18")
> Erreur dans ogrInfo(dsn = dsn, layer = layer, encoding = encoding, use_iconv
> = use_iconv,  :
>   Cannot open file
>> cities <- readOGR(".", "NY8cities")
> Erreur dans ogrInfo(dsn = dsn, layer = layer, encoding = encoding, use_iconv
> = use_iconv,  :
>   Cannot open file
>> TCE <- readOGR(".", "TCE")
> Erreur dans ogrInfo(dsn = dsn, layer = layer, encoding = encoding, use_iconv
> = use_iconv,  :
>   Cannot open file
>
>
> Thank you for yours help
>
> Sincerly
> Masha Pautrel
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



-- 
Pascal Oettli
Project Scientist
JAMSTEC
Yokohama, Japan


From hengl at spatial-analyst.net  Tue Nov 25 23:15:13 2014
From: hengl at spatial-analyst.net (Tomislav Hengl)
Date: Tue, 25 Nov 2014 23:15:13 +0100
Subject: [R-sig-Geo] questions on spatial interpolation exercise(NL)
In-Reply-To: <CA+vD2zqYihThSkgi1mkuj1o+KB=11Pa5qipsHNK3w4XRhFuo=g@mail.gmail.com>
References: <CA+vD2zrwKNNEwYjw+HcMUCuWjRJVk=RLnxH036Bj8u9YoBp1Hw@mail.gmail.com>	<547377E2.6050905@spatial-analyst.net>
	<CA+vD2zqYihThSkgi1mkuj1o+KB=11Pa5qipsHNK3w4XRhFuo=g@mail.gmail.com>
Message-ID: <5474FF71.3050305@spatial-analyst.net>


On 25-11-2014 21:41, Mengxi Yang wrote:
> attached file is monv_201301.Please have a look.
>

Janurary has 31 days hence you need to adjust the number of rows in that 
table:

 > tmp <- readLines(paste(getwd(), "/", "monv_201301.txt", sep=""))
 > tmp <- gsub(pattern=' . ', replacement=' 0.0 ', tmp, fixed = TRUE)
 > tmp <- gsub(pattern='[[:space:]]{2,7}', replacement=',', tmp)
 > tmp[8]
[1] "# 
NR,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,I,NORM,II,NORM,III,NORM,MND,NORM"
 > write.table(t(matrix(unlist(strsplit(tmp, ",")[-c(1:8)]), nrow=42)), 
"tmp.txt", col.names=FALSE, row.names=FALSE)
 > monv_201301 <- read.table("tmp.txt", col.names=c("empty1", "NR", 
paste("D", 1:31, sep=""), "I", "NORM", "II", "NORM", "III", "NORM", 
"MND", "NORM", "Locatie"))
 > monv_201301$empty1 <- NULL
 > monv_201301$Locatie <- as.factor(gsub(pattern='[[:space:]]+$', 
replacement='', monv_201301$Locatie))
 > str(monv_201301)
'data.frame':   325 obs. of  41 variables:
  $ NR     : int  760 458 680 572 89 664 678 560 910 441 ...
  $ D1     : num  7.2 17.2 10 9.6 12 11.9 10.2 14.3 13.6 15.5 ...
  $ D2     : num  0.4 2.8 4.7 2.7 3.2 4.5 3 2.8 0.8 3.2 ...
  $ D3     : num  0.9 0.9 1.7 0.5 0.5 1.4 1 0.5 0.9 0.2 ...
...

 From here on you can continue running the code from 
http://spatial-analyst.net/wiki/index.php?title=Spatial_interpolation_exercises_(NL)

> by the way, I want to do interpolation in different spatial resolution.
> I download the grid file from Worldclim project. But it is different
> from the exercise you provided.
> In the exercise, the prec6.asc is predicted long-term precipitation for
> June based on the Worldclim project page.
> could you please tell me how to do this?

You need to download some long term rainfall map (climatic) for January 
(I've used the one from http://worldclim.org/current) and then resample 
it to the Dutch projection system. I am sure if you search a bit you can 
find even more up-to-date maps of long term precipitation (climatic 
images) for Europe.

all the best with your work,

T. Hengl

>
> Thanks very much.
>
> On Mon, Nov 24, 2014 at 7:24 PM, Tomislav Hengl
> <hengl at spatial-analyst.net <mailto:hengl at spatial-analyst.net>> wrote:
>
>
>     You need to provide access to "monv_201310.txt" so that we can see
>     what is the structure of that file. The original file with rainfall
>     data from that URL is simply a text file from the KNMI website
>     (without any tabular structure) so that e.g.:
>
>     ...
>     write.table(t(matrix(unlist(__strsplit(tmp, ",")[-c(1:8)]),
>     nrow=41)), "tmp.txt", col.names=FALSE, row.names=FALSE)
>     ...
>     monv_200906 <- read.table("tmp.txt", col.names=c("empty1", "NR",
>     paste("D", 1:30, sep=""), "I", "NORM", "II", "NORM", "III", "NORM",
>     "MND", "NORM", "Locatie"))
>
>     creates structure based on what is in the text object (hence I first
>     open the text file and then figure out the code to read the values).
>     Of course, the structure of the raw KNMI files could have changed
>     from 2009.
>
>     If you are planning to interpolate monthly rainfall data take also a
>     look at the two geostatistical packages that elaborate geostatistics
>     with skewed values / variables with skewed distributions (I have not
>     updated the
>     http://spatial-analyst.net/__wiki/index.php?title=Spatial___interpolation_exercises_(NL)
>     <http://spatial-analyst.net/wiki/index.php?title=Spatial_interpolation_exercises_(NL)>
>     pages for a long time; sorry for that):
>
>     http://cran.r-project.org/__package=georob
>     <http://cran.r-project.org/package=georob>
>     http://cran.r-project.org/__package=geostatsp
>     <http://cran.r-project.org/package=geostatsp>
>     described in -> http://pbrown.ca/geostatsp/__document-rev.pdf
>     <http://pbrown.ca/geostatsp/document-rev.pdf>
>
>     HTH,
>
>     T. Hengl
>
>
>     On 23-11-2014 23:51, Mengxi Yang wrote:
>
>         Dear list,
>         I have a question on write.table. I found an nice exercise on
>         spatial
>         interpolation from
>         http://spatial-analyst.net/__wiki/index.php?title=Spatial___interpolation_exercises_(NL)#__Spatial_prediction_of_daily___precipitation_in_the___Netherlands
>         <http://spatial-analyst.net/wiki/index.php?title=Spatial_interpolation_exercises_(NL)#Spatial_prediction_of_daily_precipitation_in_the_Netherlands>
>
>         In this exercise, the date is 200906. but when I change to
>         201310. there is
>         a wrong message like:
>
>             tmp <- readLines(paste(getwd(), "/", "monv_201310.txt", sep=""))
>             tmp <- gsub(pattern=' . ', replacement=' 0.0 ', tmp, fixed =
>             TRUE)
>             tmp <- gsub(pattern='[[:space:]]{2,7}__', replacement=',', tmp)
>             write.table(t(matrix(unlist(__strsplit(tmp, ",")[-c(1:8)]),
>             nrow=41)),
>
>         "tmp.txt", col.names=FALSE, row.names=FALSE)
>         Warning message:
>         In matrix(unlist(strsplit(tmp, ",")[-c(1:8)]), nrow = 41) :
>             data length [13625] is not a sub-multiple or multiple of the
>         number of
>         rows [41]
>
>
>         I checked several month, some success but some not.
>         Does anyone know what is the wrong with it? should I change
>         something?
>
>         Thank you very much.
>
>         Mengxi Yang
>
>                  [[alternative HTML version deleted]]
>
>         _________________________________________________
>         R-sig-Geo mailing list
>         R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
>         https://stat.ethz.ch/mailman/__listinfo/r-sig-geo
>         <https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
>
>


From manuel.ribeiro at tecnico.ulisboa.pt  Thu Nov 27 13:24:06 2014
From: manuel.ribeiro at tecnico.ulisboa.pt (Manuel Ribeiro)
Date: Thu, 27 Nov 2014 12:24:06 -0000
Subject: [R-sig-Geo] Cross-variogram and respective envelopes
Message-ID: <005f01d00a3d$09a92ff0$1cfb8fd0$@tecnico.ulisboa.pt>

Hello, i am trying to calculate (and plot) cross-variograms and their
respective envelopes (bootstrap confidence intervals of empirical
cross-variograms).

I used gstat and geoR packages, but up to now I did not succeed. From what I
read (and tried) it seems these are not suited for this combination of
tasks.

I have no experience in programming functions, so if anyone knows any
available function(s) to do these tasks, please let me know.

Thanks for your help, Manuel

 

Manuel C Ribeiro

Cerena - Centro de Recursos Naturais e Ambiente
Instituto Superior T?cnico
Av. Rovisco Pais  1049-001 Lisboa Portugal
Tel: (+351) 21 841 74 41
Fax: (+351) 21 841 73 89

 


	[[alternative HTML version deleted]]


From boukepieter.ottow at wur.nl  Thu Nov 27 13:27:26 2014
From: boukepieter.ottow at wur.nl (Ottow, Bouke Pieter)
Date: Thu, 27 Nov 2014 12:27:26 +0000
Subject: [R-sig-Geo] RasterBrickTimeSeries in plotKML without starting GE
Message-ID: <E77A61BE378A78468C9742BD6813C79613E02B39@SCOMP0934.wurnet.nl>

Hi,

I am using the function of the package plotKML to plot a RasterBrickTimeSeries in GoogleEarth. I have it working with the plotKML() function which also immediately opens GE. I am using the function in a model I am writing and therefor I just want it to write the kml without opening it. Is there such a function as well? Like the kml_layer.xxx() or kml() functions? It seems that it is missing for RasterBrickTimeSeries?

Kind regards,
Bouke Pieter Ottow

From hengl at spatial-analyst.net  Thu Nov 27 14:18:40 2014
From: hengl at spatial-analyst.net (Tomislav Hengl)
Date: Thu, 27 Nov 2014 14:18:40 +0100
Subject: [R-sig-Geo] RasterBrickTimeSeries in plotKML without starting GE
In-Reply-To: <E77A61BE378A78468C9742BD6813C79613E02B39@SCOMP0934.wurnet.nl>
References: <E77A61BE378A78468C9742BD6813C79613E02B39@SCOMP0934.wurnet.nl>
Message-ID: <547724B0.3040609@spatial-analyst.net>


You should be able to make your own function that does that. See e.g.:

https://r-forge.r-project.org/scm/viewvc.php/pkg/R/plotKML.RasterBrickTimeSeries.R?view=markup&root=plotkml

On the end of the function mask out "kml_View".

PS: I've just added to every plotKML method an argument "open.kml=TRUE", 
so that it can be controlled, but you need to install the version 0.4-7 
from R-forge (from source code).

thank you,

T. Hengl

On 27-11-2014 13:27, Ottow, Bouke Pieter wrote:
> Hi,
>
> I am using the function of the package plotKML to plot a RasterBrickTimeSeries in GoogleEarth. I have it working with the plotKML() function which also immediately opens GE. I am using the function in a model I am writing and therefor I just want it to write the kml without opening it. Is there such a function as well? Like the kml_layer.xxx() or kml() functions? It seems that it is missing for RasterBrickTimeSeries?
>
> Kind regards,
> Bouke Pieter Ottow
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From hengl at spatial-analyst.net  Thu Nov 27 14:35:41 2014
From: hengl at spatial-analyst.net (Tomislav Hengl)
Date: Thu, 27 Nov 2014 14:35:41 +0100
Subject: [R-sig-Geo] Question about derivative work - what is the license
 for map derived using e.g. spatial "predict" function?
Message-ID: <547728AD.9010509@spatial-analyst.net>


Dear list,

I have a question about licensing the data that is produced by spatial 
prediction from point data. My ideas is that a map produced by using 
e.g. geostatistics from point data is a new data product and as such 
does not falls under the regulations of the original license used for 
the point data (so if the license for the point data is restrictive, the 
license for the output maps does not have to respect this). Consider for 
example:

R> library(gstat)
R> library(sp)
R> demo(meuse, echo=FALSE)
R> m <- vgm(.59, "Sph", 874, .04)
R> x <- krige(log(zinc)~1, meuse, meuse.grid, model = m)

The produced map "x" can be considered a new data product. There is 
absolutely no way that one could reproduce the original input points 
from this map, hence it should be considered "a non-derivative work". 
Only if we would derive a map using interpolation technique that allows 
re-constructions of points (e.g. Thiessen polygons) the license would 
need to be respected.

Or am I mistaken? (I know this is a type of a question for lawyers in 
fact, but any experience / opinion you have is welcome)

http://www.publicdomainsherpa.com/derivative-work.html

"To qualify as a derivative work, the derivative must use a substantial 
amount of the prior work?s expression. How much? Enough so that the 
average person would conclude that it had been based on or adapted from 
the prior work"

thank you,

-- 
T. (Tom) Hengl
Researcher @ ISRIC - World Soil Information
Url: http://www.wageningenur.nl/en/Persons/dr.-T-Tom-Hengl.htm
Network: http://profiles.google.com/tom.hengl
Publications: http://scholar.google.com/citations?user=2oYU7S8AAAAJ


From forrest at ufl.edu  Thu Nov 27 15:21:00 2014
From: forrest at ufl.edu (Forrest Stevens)
Date: Thu, 27 Nov 2014 14:21:00 +0000
Subject: [R-sig-Geo] Question about derivative work - what is the
 license for map derived using e.g. spatial "predict" function?
References: <547728AD.9010509@spatial-analyst.net>
Message-ID: <CAEBQMMmxNXAtBOhMv=uBwthS3RkCZ_xdH_DPNgq7uOprzNknCA@mail.gmail.com>

This is indeed a sticky question, and probably hard to generalize across
specific legal situations, but I'm sure the original data holder's view
would be that without access to the original points layer there's no way
you could produce your interpolation. Therefore, your output constitutes a
derivative work.

I think of it like classifying data that you extract in some way from
Google Earth, which is against their Terms of Service. Even if you produced
a binary, classified land cover dataset from a screen capture, yielding a
situation like you describe, impossible to recreate the original
aerial/satellite imagery from, you'd still legally be violating the TOS and
couldn't distribute your classified data.

Interested to hear other's thoughts on it though,
Forrest


On Thu, Nov 27, 2014 at 8:37 AM Tomislav Hengl <hengl at spatial-analyst.net>
wrote:

>
> Dear list,
>
> I have a question about licensing the data that is produced by spatial
> prediction from point data. My ideas is that a map produced by using
> e.g. geostatistics from point data is a new data product and as such
> does not falls under the regulations of the original license used for
> the point data (so if the license for the point data is restrictive, the
> license for the output maps does not have to respect this). Consider for
> example:
>
> R> library(gstat)
> R> library(sp)
> R> demo(meuse, echo=FALSE)
> R> m <- vgm(.59, "Sph", 874, .04)
> R> x <- krige(log(zinc)~1, meuse, meuse.grid, model = m)
>
> The produced map "x" can be considered a new data product. There is
> absolutely no way that one could reproduce the original input points
> from this map, hence it should be considered "a non-derivative work".
> Only if we would derive a map using interpolation technique that allows
> re-constructions of points (e.g. Thiessen polygons) the license would
> need to be respected.
>
> Or am I mistaken? (I know this is a type of a question for lawyers in
> fact, but any experience / opinion you have is welcome)
>
> http://www.publicdomainsherpa.com/derivative-work.html
>
> "To qualify as a derivative work, the derivative must use a substantial
> amount of the prior work?s expression. How much? Enough so that the
> average person would conclude that it had been based on or adapted from
> the prior work"
>
> thank you,
>
> --
> T. (Tom) Hengl
> Researcher @ ISRIC - World Soil Information
> Url: http://www.wageningenur.nl/en/Persons/dr.-T-Tom-Hengl.htm
> Network: http://profiles.google.com/tom.hengl
> Publications: http://scholar.google.com/citations?user=2oYU7S8AAAAJ
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From edzer.pebesma at uni-muenster.de  Thu Nov 27 15:44:31 2014
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Thu, 27 Nov 2014 15:44:31 +0100
Subject: [R-sig-Geo] Question about derivative work - what is the
 license for map derived using e.g. spatial "predict" function?
In-Reply-To: <547728AD.9010509@spatial-analyst.net>
References: <547728AD.9010509@spatial-analyst.net>
Message-ID: <547738CF.6030808@uni-muenster.de>

Tom, in your example below, x contains the kriging variance; points with
zero kriging variance must be observation locations, with the predicted
value equal to the observation.

In case the nugget in m would have been replaced by a measurement error
component (Err in m and m1 below), you would not have this effect, and
also have no discontinuity in the interpolated surface at observation
locations:

> m = vgm(1, "Sph", 900, Err = 1)
> v = variogram(log(zinc)~1, meuse)
> m1 = fit.variogram(v, m)
> m1
  model      psill    range
1   Err 0.05066243   0.0000
2   Sph 0.59060780 897.0209
> m2 = fit.variogram(v, vgm(1, "Sph", 900, 1))
> m2
  model      psill    range
1   Nug 0.05066243   0.0000
2   Sph 0.59060780 897.0209
> as(krige(log(zinc)~1, meuse, meuse[1,], m2), "data.frame")
[using ordinary kriging]
       x      y var1.pred     var1.var
1 181072 333611  6.929517 1.110223e-16
> as(krige(log(zinc)~1, meuse, meuse[1,], m1), "data.frame")
[using ordinary kriging]
       x      y var1.pred   var1.var
1 181072 333611  6.884401 0.03648868
# note identical predictions but different variances
# for other locations:
> as(krige(log(zinc)~1, meuse, meuse.grid[1,], m2), "data.frame")
[using ordinary kriging]
       x      y var1.pred  var1.var
1 181180 333740  6.499624 0.3198084
> as(krige(log(zinc)~1, meuse, meuse.grid[1,], m1), "data.frame")
[using ordinary kriging]
       x      y var1.pred var1.var
1 181180 333740  6.499624 0.269146


On 11/27/2014 02:35 PM, Tomislav Hengl wrote:
> 
> Dear list,
> 
> I have a question about licensing the data that is produced by spatial
> prediction from point data. My ideas is that a map produced by using
> e.g. geostatistics from point data is a new data product and as such
> does not falls under the regulations of the original license used for
> the point data (so if the license for the point data is restrictive, the
> license for the output maps does not have to respect this). Consider for
> example:
> 
> R> library(gstat)
> R> library(sp)
> R> demo(meuse, echo=FALSE)
> R> m <- vgm(.59, "Sph", 874, .04)
> R> x <- krige(log(zinc)~1, meuse, meuse.grid, model = m)
> 
> The produced map "x" can be considered a new data product. There is
> absolutely no way that one could reproduce the original input points
> from this map, hence it should be considered "a non-derivative work".
> Only if we would derive a map using interpolation technique that allows
> re-constructions of points (e.g. Thiessen polygons) the license would
> need to be respected.
> 
> Or am I mistaken? (I know this is a type of a question for lawyers in
> fact, but any experience / opinion you have is welcome)
> 
> http://www.publicdomainsherpa.com/derivative-work.html
> 
> "To qualify as a derivative work, the derivative must use a substantial
> amount of the prior work?s expression. How much? Enough so that the
> average person would conclude that it had been based on or adapted from
> the prior work"
> 
> thank you,
> 

-- 
Edzer Pebesma,  Co-Editor-in-Chief Computers & Geosciences
Institute for Geoinformatics (ifgi), University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
83 33081 http://ifgi.uni-muenster.de GPG key ID 0xAC227795

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 490 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20141127/f3448287/attachment.bin>

From hengl at spatial-analyst.net  Thu Nov 27 16:24:06 2014
From: hengl at spatial-analyst.net (Tomislav Hengl)
Date: Thu, 27 Nov 2014 16:24:06 +0100
Subject: [R-sig-Geo] Question about derivative work - what is the
 license for map derived using e.g. spatial "predict" function?
In-Reply-To: <547738CF.6030808@uni-muenster.de>
References: <547728AD.9010509@spatial-analyst.net>
	<547738CF.6030808@uni-muenster.de>
Message-ID: <54774216.1090703@spatial-analyst.net>


Haa! Thanks for spotting this Edzer. But I am only talking about the 
predictions in this example. The predictions from any sp prediction 
method do not go through points (plus you do not have the coordinates of 
the points). So the question is - is it a derivative work or not?

On 27-11-2014 15:44, Edzer Pebesma wrote:
> Tom, in your example below, x contains the kriging variance; points with
> zero kriging variance must be observation locations, with the predicted
> value equal to the observation.
>
> In case the nugget in m would have been replaced by a measurement error
> component (Err in m and m1 below), you would not have this effect, and
> also have no discontinuity in the interpolated surface at observation
> locations:
>
>> m = vgm(1, "Sph", 900, Err = 1)
>> v = variogram(log(zinc)~1, meuse)
>> m1 = fit.variogram(v, m)
>> m1
>    model      psill    range
> 1   Err 0.05066243   0.0000
> 2   Sph 0.59060780 897.0209
>> m2 = fit.variogram(v, vgm(1, "Sph", 900, 1))
>> m2
>    model      psill    range
> 1   Nug 0.05066243   0.0000
> 2   Sph 0.59060780 897.0209
>> as(krige(log(zinc)~1, meuse, meuse[1,], m2), "data.frame")
> [using ordinary kriging]
>         x      y var1.pred     var1.var
> 1 181072 333611  6.929517 1.110223e-16
>> as(krige(log(zinc)~1, meuse, meuse[1,], m1), "data.frame")
> [using ordinary kriging]
>         x      y var1.pred   var1.var
> 1 181072 333611  6.884401 0.03648868
> # note identical predictions but different variances
> # for other locations:
>> as(krige(log(zinc)~1, meuse, meuse.grid[1,], m2), "data.frame")
> [using ordinary kriging]
>         x      y var1.pred  var1.var
> 1 181180 333740  6.499624 0.3198084
>> as(krige(log(zinc)~1, meuse, meuse.grid[1,], m1), "data.frame")
> [using ordinary kriging]
>         x      y var1.pred var1.var
> 1 181180 333740  6.499624 0.269146
>
>
> On 11/27/2014 02:35 PM, Tomislav Hengl wrote:
>>
>> Dear list,
>>
>> I have a question about licensing the data that is produced by spatial
>> prediction from point data. My ideas is that a map produced by using
>> e.g. geostatistics from point data is a new data product and as such
>> does not falls under the regulations of the original license used for
>> the point data (so if the license for the point data is restrictive, the
>> license for the output maps does not have to respect this). Consider for
>> example:
>>
>> R> library(gstat)
>> R> library(sp)
>> R> demo(meuse, echo=FALSE)
>> R> m <- vgm(.59, "Sph", 874, .04)
>> R> x <- krige(log(zinc)~1, meuse, meuse.grid, model = m)
>>
>> The produced map "x" can be considered a new data product. There is
>> absolutely no way that one could reproduce the original input points
>> from this map, hence it should be considered "a non-derivative work".
>> Only if we would derive a map using interpolation technique that allows
>> re-constructions of points (e.g. Thiessen polygons) the license would
>> need to be respected.
>>
>> Or am I mistaken? (I know this is a type of a question for lawyers in
>> fact, but any experience / opinion you have is welcome)
>>
>> http://www.publicdomainsherpa.com/derivative-work.html
>>
>> "To qualify as a derivative work, the derivative must use a substantial
>> amount of the prior work?s expression. How much? Enough so that the
>> average person would conclude that it had been based on or adapted from
>> the prior work"
>>
>> thank you,
>>
>
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From b.rowlingson at lancaster.ac.uk  Thu Nov 27 16:38:56 2014
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Thu, 27 Nov 2014 15:38:56 +0000
Subject: [R-sig-Geo] Question about derivative work - what is the
 license for map derived using e.g. spatial "predict" function?
In-Reply-To: <547738CF.6030808@uni-muenster.de>
References: <547728AD.9010509@spatial-analyst.net>
	<547738CF.6030808@uni-muenster.de>
Message-ID: <CANVKczMnAXcHEFOJP5kC=wtpitnVhqdV6vxnHUmKT_TmnUzcvg@mail.gmail.com>

On Thu, Nov 27, 2014 at 2:44 PM, Edzer Pebesma
<edzer.pebesma at uni-muenster.de> wrote:
> Tom, in your example below, x contains the kriging variance; points with
> zero kriging variance must be observation locations, with the predicted
> value equal to the observation.
>
> In case the nugget in m would have been replaced by a measurement error
> component (Err in m and m1 below), you would not have this effect, and
> also have no discontinuity in the interpolated surface at observation
> locations:

 Now all that is going to be fun to explain to a judge and jury.

 Suppose you took all the notes of a Bach fugue as X=time, Y=pitch,
and interpolated them in time, then created a new piece using the
interpolation prediction at time points between the notes, would this
be a derivative work?

Yes, I think: "A ?derivative work? is a work based upon one or more
preexisting works, such as a translation, musical arrangement,
dramatization, fictionalization, motion picture version, sound
recording, art reproduction, abridgment, condensation, or any other
form in which a work may be recast, transformed, or adapted."
[Wikipedia, where I get all my legal advice from] - they key word
being "transformed".

But does a dataset count as a "work" here? It is supposedly a set of
measurements of "the truth", rather than something that is a creative
work. A random australian web site that comes up tops in a google
search says:

Use of a Copyright Licence

A dataset may attract copyright protection (as a literary work), if it
meets certain threshold criteria of human authorship, originality, or
creativity, for example. On that basis, significant quantities of
research data will attract copyright protection. As such, it may not
be reused by researchers (or anyone else) without permission.
[http://ands.org.au/guides/copyright-and-data-awareness.html]

 I suspect the permission to make derivative works has to be stated
when the dataset gives usage permission.

Minefield.

Barry


From hengl at spatial-analyst.net  Thu Nov 27 22:50:58 2014
From: hengl at spatial-analyst.net (Tomislav Hengl)
Date: Thu, 27 Nov 2014 22:50:58 +0100
Subject: [R-sig-Geo] Question about derivative work - what is the
 license for map derived using e.g. spatial "predict" function?
In-Reply-To: <CANVKczMnAXcHEFOJP5kC=wtpitnVhqdV6vxnHUmKT_TmnUzcvg@mail.gmail.com>
References: <547728AD.9010509@spatial-analyst.net>	<547738CF.6030808@uni-muenster.de>
	<CANVKczMnAXcHEFOJP5kC=wtpitnVhqdV6vxnHUmKT_TmnUzcvg@mail.gmail.com>
Message-ID: <54779CC2.5060106@spatial-analyst.net>


Hi Barry,

Thanks for reminding me about the "you can not copyright facts" 
principle 
(http://www.newmediarights.org/business_models/artist/are_facts_copyrighted). 
So the point measured values can be considered to be, in fact, - facts.

So here is one more time the question to everyone (I am sure some of you 
have experienced these issues in practice):

1. A point data set has a restrictive license.
2. From this point data you can derive predictions - these predictions 
can not be used to re-produce point locations and values, hence the 
source is untraceable.
3. Does this derivative work (spatial prediction) has to follow the same 
data license as used for the point data, or this a new data sets for 
which you can set license freely.

Some basic principles to consider:

1. One can not copyright facts 
(http://www.newmediarights.org/business_models/artist/are_facts_copyrighted) 
but facts can be protected using e.g. the "trade secret" laws.
2. If one would digitize content from Google Earth / maps imagery i.e. 
digitize polygon maps representing geomorphology without a permission 
from Google this would mean breaking of the Legal Notices 
(http://www.google.com/help/legalnotices_maps.html) - has anyone bee 
prosecuted for this ever?
3. "The transformation, modification or adaptation of the work must be 
substantial and bear its author's personality to be original and thus 
protected by copyright" (http://en.wikipedia.org/wiki/Derivative_work) 
hence it is OK to create derivative works as long as one can prove that 
there are "substantial" new elements. Do spatial predictions from points 
fall into this category?

thank you!

T. Hengl


On 27-11-2014 16:38, Barry Rowlingson wrote:
> On Thu, Nov 27, 2014 at 2:44 PM, Edzer Pebesma
> <edzer.pebesma at uni-muenster.de> wrote:
>> Tom, in your example below, x contains the kriging variance; points with
>> zero kriging variance must be observation locations, with the predicted
>> value equal to the observation.
>>
>> In case the nugget in m would have been replaced by a measurement error
>> component (Err in m and m1 below), you would not have this effect, and
>> also have no discontinuity in the interpolated surface at observation
>> locations:
>
>   Now all that is going to be fun to explain to a judge and jury.
>
>   Suppose you took all the notes of a Bach fugue as X=time, Y=pitch,
> and interpolated them in time, then created a new piece using the
> interpolation prediction at time points between the notes, would this
> be a derivative work?
>
> Yes, I think: "A ?derivative work? is a work based upon one or more
> preexisting works, such as a translation, musical arrangement,
> dramatization, fictionalization, motion picture version, sound
> recording, art reproduction, abridgment, condensation, or any other
> form in which a work may be recast, transformed, or adapted."
> [Wikipedia, where I get all my legal advice from] - they key word
> being "transformed".
>
> But does a dataset count as a "work" here? It is supposedly a set of
> measurements of "the truth", rather than something that is a creative
> work. A random australian web site that comes up tops in a google
> search says:
>
> Use of a Copyright Licence
>
> A dataset may attract copyright protection (as a literary work), if it
> meets certain threshold criteria of human authorship, originality, or
> creativity, for example. On that basis, significant quantities of
> research data will attract copyright protection. As such, it may not
> be reused by researchers (or anyone else) without permission.
> [http://ands.org.au/guides/copyright-and-data-awareness.html]
>
>   I suspect the permission to make derivative works has to be stated
> when the dataset gives usage permission.
>
> Minefield.
>
> Barry
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From jochen.albrecht at gmail.com  Thu Nov 27 23:36:08 2014
From: jochen.albrecht at gmail.com (Jochen Albrecht)
Date: Thu, 27 Nov 2014 17:36:08 -0500
Subject: [R-sig-Geo] Question about derivative work - what is the
 license for map derived using e.g. spatial "predict" function?
In-Reply-To: <54779CC2.5060106@spatial-analyst.net>
References: <547728AD.9010509@spatial-analyst.net>
	<547738CF.6030808@uni-muenster.de>
	<CANVKczMnAXcHEFOJP5kC=wtpitnVhqdV6vxnHUmKT_TmnUzcvg@mail.gmail.com>
	<54779CC2.5060106@spatial-analyst.net>
Message-ID: <CAKRQQ2QTkdWkB_5nL-D-dSn-n1Ataa8v+wpMhwdqf3hHTcqu8A@mail.gmail.com>

What makes Tomislav's question really hard to answer is that there is no
*one* copyright law. Just look at the long list of exceptions in the Google
legal notices that he provided. My experience is only with the United
States and here the matter is relatively clear (in spite of Hollywood's
extreme provisions).
1. As mentioned, facts are not copyrightable; so if you have just plain
data without any create packaging/mapping/analysis then these are not
protected - regardless of what the vendor may claim (and some vendor are
very creative with their claims).
2. Your derivation is your work and does therefore not inherit any
copyright either- even if the original was copyrighted, say because of the
packaging. The Google Earth digitization is a case here. Possibly not in
Israel, but here in the U.S. you may freely digitize , i.e., create new
data - the boundaries that you are digitizing are not part of the source
material but your (creative) interpretation. You may, however, not copy;
that is, you may not re-assemble the tiles.
3. The notions of original vs. derivative are every once in a while
contested in court but so far, the courts have usually sided with the
defense.
There are only two authors in our field that have published on this topic
that I am aware off. Check out either Onsrud or Cho for a long list of
cases.
Unless you find a way to make millions of your work (which would interest
me immensely) you are unlikely to be prosecuted across national boundaries
because the claimant's effort would not be worth it.
Cheers,
     Jochen

Dr. Jochen Albrecht
Computational and Theoretical Geography
HN 1030
Hunter College CUNY
695 Park Avenue
New York, NY 10065

On Thu, Nov 27, 2014 at 4:50 PM, Tomislav Hengl <hengl at spatial-analyst.net>
wrote:

>
> Hi Barry,
>
> Thanks for reminding me about the "you can not copyright facts" principle (
> http://www.newmediarights.org/business_models/artist/are_facts_copyrighted).
> So the point measured values can be considered to be, in fact, - facts.
>
> So here is one more time the question to everyone (I am sure some of you
> have experienced these issues in practice):
>
> 1. A point data set has a restrictive license.
> 2. From this point data you can derive predictions - these predictions can
> not be used to re-produce point locations and values, hence the source is
> untraceable.
> 3. Does this derivative work (spatial prediction) has to follow the same
> data license as used for the point data, or this a new data sets for which
> you can set license freely.
>
> Some basic principles to consider:
>
> 1. One can not copyright facts (http://www.newmediarights.
> org/business_models/artist/are_facts_copyrighted) but facts can be
> protected using e.g. the "trade secret" laws.
> 2. If one would digitize content from Google Earth / maps imagery i.e.
> digitize polygon maps representing geomorphology without a permission from
> Google this would mean breaking of the Legal Notices (
> http://www.google.com/help/legalnotices_maps.html) - has anyone bee
> prosecuted for this ever?
> 3. "The transformation, modification or adaptation of the work must be
> substantial and bear its author's personality to be original and thus
> protected by copyright" (http://en.wikipedia.org/wiki/Derivative_work)
> hence it is OK to create derivative works as long as one can prove that
> there are "substantial" new elements. Do spatial predictions from points
> fall into this category?
>
> thank you!
>
> T. Hengl
>
>
>
> On 27-11-2014 16:38, Barry Rowlingson wrote:
>
>> On Thu, Nov 27, 2014 at 2:44 PM, Edzer Pebesma
>> <edzer.pebesma at uni-muenster.de> wrote:
>>
>>> Tom, in your example below, x contains the kriging variance; points with
>>> zero kriging variance must be observation locations, with the predicted
>>> value equal to the observation.
>>>
>>> In case the nugget in m would have been replaced by a measurement error
>>> component (Err in m and m1 below), you would not have this effect, and
>>> also have no discontinuity in the interpolated surface at observation
>>> locations:
>>>
>>
>>   Now all that is going to be fun to explain to a judge and jury.
>>
>>   Suppose you took all the notes of a Bach fugue as X=time, Y=pitch,
>> and interpolated them in time, then created a new piece using the
>> interpolation prediction at time points between the notes, would this
>> be a derivative work?
>>
>> Yes, I think: "A ?derivative work? is a work based upon one or more
>> preexisting works, such as a translation, musical arrangement,
>> dramatization, fictionalization, motion picture version, sound
>> recording, art reproduction, abridgment, condensation, or any other
>> form in which a work may be recast, transformed, or adapted."
>> [Wikipedia, where I get all my legal advice from] - they key word
>> being "transformed".
>>
>> But does a dataset count as a "work" here? It is supposedly a set of
>> measurements of "the truth", rather than something that is a creative
>> work. A random australian web site that comes up tops in a google
>> search says:
>>
>> Use of a Copyright Licence
>>
>> A dataset may attract copyright protection (as a literary work), if it
>> meets certain threshold criteria of human authorship, originality, or
>> creativity, for example. On that basis, significant quantities of
>> research data will attract copyright protection. As such, it may not
>> be reused by researchers (or anyone else) without permission.
>> [http://ands.org.au/guides/copyright-and-data-awareness.html]
>>
>>   I suspect the permission to make derivative works has to be stated
>> when the dataset gives usage permission.
>>
>> Minefield.
>>
>> Barry
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From jianyun.fred.wu at gmail.com  Fri Nov 28 06:33:15 2014
From: jianyun.fred.wu at gmail.com (Jianyun Wu)
Date: Fri, 28 Nov 2014 16:33:15 +1100
Subject: [R-sig-Geo] How to delete some polygons from
	'SpatialPolygonsDataFrame'
Message-ID: <CAOMGRD+EadNHjNQw_HFDcEbbmKJuvC9RxB_NgLRzrV5MdispWA@mail.gmail.com>

Dear list,

I usually use 'readOGR()' from rgdal package in R to input the ESRI
shapefile.
So the inputted data are SpatialPolygonsDataFrame.

I am processing the New South Wales, Australia map for a spatial analysis.
There is an island far away from the mainland, which I want to delete it
from the map when I plot NSW.  Because it makes the whole plot small due to
its long distant.

Below is the area contains the polygons of this island and surrounding
islands. There are 14 "@Polygons" contributing to the entire area. From
some experiments, I know that it is Polygon 3-14 making the distant
islands.

Is there a simple way that I can delete those small polygons from this area
polygon and their attributes from the data

Thank you

Fred

str(nsw_lga[153, ])
Formal class 'SpatialPolygonsDataFrame' [package "sp"] with 5 slots
  ..@ data       :'data.frame':    1 obs. of  3 variables:
  .. ..$ STATE_CODE: Factor w/ 9 levels "1","2","3","4",..: 1
  .. ..$ LGA_CODE11: Factor w/ 565 levels "10050","10110",..: 153
  .. ..$ LGA_NAME11: Factor w/ 564 levels "Adelaide (C)",..: 483
  ..@ polygons   :List of 1
  .. ..$ :Formal class 'Polygons' [package "sp"] with 5 slots
  .. .. .. ..@ Polygons :List of 14
  .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
  .. .. .. .. .. .. ..@ labpt  : num [1:2] 159.1 -31.5
  .. .. .. .. .. .. ..@ area   : num 3.83e-07
  .. .. .. .. .. .. ..@ hole   : logi FALSE
  .. .. .. .. .. .. ..@ ringDir: int 1
  .. .. .. .. .. .. ..@ coords : num [1:38, 1:2] 159 159 159 159 159 ...
  .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
  .. .. .. .. .. .. ..@ labpt  : num [1:2] 159.1 -31.5
  .. .. .. .. .. .. ..@ area   : num 4.69e-07
  .. .. .. .. .. .. ..@ hole   : logi FALSE
  .. .. .. .. .. .. ..@ ringDir: int 1
  .. .. .. .. .. .. ..@ coords : num [1:13, 1:2] 159 159 159 159 159 ...
  .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
  .. .. .. .. .. .. ..@ labpt  : num [1:2] 159.1 -31.5
  .. .. .. .. .. .. ..@ area   : num 7.82e-07
  .. .. .. .. .. .. ..@ hole   : logi FALSE
  .. .. .. .. .. .. ..@ ringDir: int 1
  .. .. .. .. .. .. ..@ coords : num [1:31, 1:2] 159 159 159 159 159 ...
  .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
  .. .. .. .. .. .. ..@ labpt  : num [1:2] 159.1 -31.5
  .. .. .. .. .. .. ..@ area   : num 1.02e-06
  .. .. .. .. .. .. ..@ hole   : logi FALSE
  .. .. .. .. .. .. ..@ ringDir: int 1
  .. .. .. .. .. .. ..@ coords : num [1:47, 1:2] 159 159 159 159 159 ...
  .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
  .. .. .. .. .. .. ..@ labpt  : num [1:2] 159.1 -31.5
  .. .. .. .. .. .. ..@ area   : num 1.14e-06
  .. .. .. .. .. .. ..@ hole   : logi FALSE
  .. .. .. .. .. .. ..@ ringDir: int 1
  .. .. .. .. .. .. ..@ coords : num [1:22, 1:2] 159 159 159 159 159 ...
  .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
  .. .. .. .. .. .. ..@ labpt  : num [1:2] 159.1 -31.6
  .. .. .. .. .. .. ..@ area   : num 1.38e-06
  .. .. .. .. .. .. ..@ hole   : logi FALSE
  .. .. .. .. .. .. ..@ ringDir: int 1
  .. .. .. .. .. .. ..@ coords : num [1:24, 1:2] 159 159 159 159 159 ...
  .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
  .. .. .. .. .. .. ..@ labpt  : num [1:2] 159.1 -31.5
  .. .. .. .. .. .. ..@ area   : num 1.52e-06
  .. .. .. .. .. .. ..@ hole   : logi FALSE
  .. .. .. .. .. .. ..@ ringDir: int 1
  .. .. .. .. .. .. ..@ coords : num [1:26, 1:2] 159 159 159 159 159 ...
  .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
  .. .. .. .. .. .. ..@ labpt  : num [1:2] 159.1 -31.5
  .. .. .. .. .. .. ..@ area   : num 2.05e-06
  .. .. .. .. .. .. ..@ hole   : logi FALSE
  .. .. .. .. .. .. ..@ ringDir: int 1
  .. .. .. .. .. .. ..@ coords : num [1:32, 1:2] 159 159 159 159 159 ...
  .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
  .. .. .. .. .. .. ..@ labpt  : num [1:2] 159.1 -31.5
  .. .. .. .. .. .. ..@ area   : num 2.61e-06
  .. .. .. .. .. .. ..@ hole   : logi FALSE
  .. .. .. .. .. .. ..@ ringDir: int 1
  .. .. .. .. .. .. ..@ coords : num [1:36, 1:2] 159 159 159 159 159 ...
  .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
  .. .. .. .. .. .. ..@ labpt  : num [1:2] 159.1 -31.5
  .. .. .. .. .. .. ..@ area   : num 4.27e-06
  .. .. .. .. .. .. ..@ hole   : logi FALSE
  .. .. .. .. .. .. ..@ ringDir: int 1
  .. .. .. .. .. .. ..@ coords : num [1:109, 1:2] 159 159 159 159 159 ...
  .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
  .. .. .. .. .. .. ..@ labpt  : num [1:2] 159.1 -31.5
  .. .. .. .. .. .. ..@ area   : num 1.42e-05
  .. .. .. .. .. .. ..@ hole   : logi FALSE
  .. .. .. .. .. .. ..@ ringDir: int 1
  .. .. .. .. .. .. ..@ coords : num [1:85, 1:2] 159 159 159 159 159 ...
  .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
  .. .. .. .. .. .. ..@ labpt  : num [1:2] 159.1 -31.6
  .. .. .. .. .. .. ..@ area   : num 0.00152
  .. .. .. .. .. .. ..@ hole   : logi FALSE
  .. .. .. .. .. .. ..@ ringDir: int 1
  .. .. .. .. .. .. ..@ coords : num [1:2929, 1:2] 159 159 159 159 159 ...
  .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
  .. .. .. .. .. .. ..@ labpt  : num [1:2] 142.2 -30.7
  .. .. .. .. .. .. ..@ area   : num 8.79
  .. .. .. .. .. .. ..@ hole   : logi FALSE
  .. .. .. .. .. .. ..@ ringDir: int 1
  .. .. .. .. .. .. ..@ coords : num [1:5178, 1:2] 144 144 144 144 144 ...
  .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
  .. .. .. .. .. .. ..@ labpt  : num [1:2] 141.5 -31.9
  .. .. .. .. .. .. ..@ area   : num 0.0162
  .. .. .. .. .. .. ..@ hole   : logi TRUE
  .. .. .. .. .. .. ..@ ringDir: int -1
  .. .. .. .. .. .. ..@ coords : num [1:131, 1:2] 141 141 141 141 141 ...
  .. .. .. ..@ plotOrder: int [1:14] 13 14 12 11 10 9 8 7 6 5 ...
  .. .. .. ..@ labpt    : num [1:2] 142.2 -30.7
  .. .. .. ..@ ID       : chr "152"
  .. .. .. ..@ area     : num 8.79
  ..@ plotOrder  : int 1
  ..@ bbox       : num [1:2, 1:2] 141 -33.4 159.1 -29
  .. ..- attr(*, "dimnames")=List of 2
  .. .. ..$ : chr [1:2] "x" "y"
  .. .. ..$ : chr [1:2] "min" "max"
  ..@ proj4string:Formal class 'CRS' [package "sp"] with 1 slot
  .. .. ..@ projargs: chr "+proj=longlat +ellps=GRS80 +no_defs"

	[[alternative HTML version deleted]]


From roland.harhoff at uni-muenster.de  Fri Nov 28 09:43:00 2014
From: roland.harhoff at uni-muenster.de (Roland Harhoff)
Date: Fri, 28 Nov 2014 09:43:00 +0100 (CET)
Subject: [R-sig-Geo] How to delete some polygons from
 'SpatialPolygonsDataFrame'
In-Reply-To: <CAOMGRD+EadNHjNQw_HFDcEbbmKJuvC9RxB_NgLRzrV5MdispWA@mail.gmail.com>
Message-ID: <permail-20141128084300fe5316b600001cde-rolandh@message-id.uni-muenster.de>

Dear Fred,
you may try
mySpPolygonsDf[i, j]
with i the desired rows / polygons and j (optional) desired columns from the
@data slot / data.frame.
Please see also the package "sp" reference manual.
Cheers!
Roland


Jianyun Wu schrieb am 2014-11-28:
> Dear list,

> I usually use 'readOGR()' from rgdal package in R to input the ESRI
> shapefile.
> So the inputted data are SpatialPolygonsDataFrame.

> I am processing the New South Wales, Australia map for a spatial
> analysis.
> There is an island far away from the mainland, which I want to delete
> it
> from the map when I plot NSW.  Because it makes the whole plot small
> due to
> its long distant.

> Below is the area contains the polygons of this island and
> surrounding
> islands. There are 14 "@Polygons" contributing to the entire area.
> From
> some experiments, I know that it is Polygon 3-14 making the distant
> islands.

> Is there a simple way that I can delete those small polygons from
> this area
> polygon and their attributes from the data

> Thank you

> Fred

> str(nsw_lga[153, ])
> Formal class 'SpatialPolygonsDataFrame' [package "sp"] with 5 slots
>   ..@ data       :'data.frame':    1 obs. of  3 variables:
>   .. ..$ STATE_CODE: Factor w/ 9 levels "1","2","3","4",..: 1
>   .. ..$ LGA_CODE11: Factor w/ 565 levels "10050","10110",..: 153
>   .. ..$ LGA_NAME11: Factor w/ 564 levels "Adelaide (C)",..: 483
>   ..@ polygons   :List of 1
>   .. ..$ :Formal class 'Polygons' [package "sp"] with 5 slots
>   .. .. .. ..@ Polygons :List of 14
>   .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
>   .. .. .. .. .. .. ..@ labpt  : num [1:2] 159.1 -31.5
>   .. .. .. .. .. .. ..@ area   : num 3.83e-07
>   .. .. .. .. .. .. ..@ hole   : logi FALSE
>   .. .. .. .. .. .. ..@ ringDir: int 1
>   .. .. .. .. .. .. ..@ coords : num [1:38, 1:2] 159 159 159 159 159
>   ...
>   .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
>   .. .. .. .. .. .. ..@ labpt  : num [1:2] 159.1 -31.5
>   .. .. .. .. .. .. ..@ area   : num 4.69e-07
>   .. .. .. .. .. .. ..@ hole   : logi FALSE
>   .. .. .. .. .. .. ..@ ringDir: int 1
>   .. .. .. .. .. .. ..@ coords : num [1:13, 1:2] 159 159 159 159 159
>   ...
>   .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
>   .. .. .. .. .. .. ..@ labpt  : num [1:2] 159.1 -31.5
>   .. .. .. .. .. .. ..@ area   : num 7.82e-07
>   .. .. .. .. .. .. ..@ hole   : logi FALSE
>   .. .. .. .. .. .. ..@ ringDir: int 1
>   .. .. .. .. .. .. ..@ coords : num [1:31, 1:2] 159 159 159 159 159
>   ...
>   .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
>   .. .. .. .. .. .. ..@ labpt  : num [1:2] 159.1 -31.5
>   .. .. .. .. .. .. ..@ area   : num 1.02e-06
>   .. .. .. .. .. .. ..@ hole   : logi FALSE
>   .. .. .. .. .. .. ..@ ringDir: int 1
>   .. .. .. .. .. .. ..@ coords : num [1:47, 1:2] 159 159 159 159 159
>   ...
>   .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
>   .. .. .. .. .. .. ..@ labpt  : num [1:2] 159.1 -31.5
>   .. .. .. .. .. .. ..@ area   : num 1.14e-06
>   .. .. .. .. .. .. ..@ hole   : logi FALSE
>   .. .. .. .. .. .. ..@ ringDir: int 1
>   .. .. .. .. .. .. ..@ coords : num [1:22, 1:2] 159 159 159 159 159
>   ...
>   .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
>   .. .. .. .. .. .. ..@ labpt  : num [1:2] 159.1 -31.6
>   .. .. .. .. .. .. ..@ area   : num 1.38e-06
>   .. .. .. .. .. .. ..@ hole   : logi FALSE
>   .. .. .. .. .. .. ..@ ringDir: int 1
>   .. .. .. .. .. .. ..@ coords : num [1:24, 1:2] 159 159 159 159 159
>   ...
>   .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
>   .. .. .. .. .. .. ..@ labpt  : num [1:2] 159.1 -31.5
>   .. .. .. .. .. .. ..@ area   : num 1.52e-06
>   .. .. .. .. .. .. ..@ hole   : logi FALSE
>   .. .. .. .. .. .. ..@ ringDir: int 1
>   .. .. .. .. .. .. ..@ coords : num [1:26, 1:2] 159 159 159 159 159
>   ...
>   .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
>   .. .. .. .. .. .. ..@ labpt  : num [1:2] 159.1 -31.5
>   .. .. .. .. .. .. ..@ area   : num 2.05e-06
>   .. .. .. .. .. .. ..@ hole   : logi FALSE
>   .. .. .. .. .. .. ..@ ringDir: int 1
>   .. .. .. .. .. .. ..@ coords : num [1:32, 1:2] 159 159 159 159 159
>   ...
>   .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
>   .. .. .. .. .. .. ..@ labpt  : num [1:2] 159.1 -31.5
>   .. .. .. .. .. .. ..@ area   : num 2.61e-06
>   .. .. .. .. .. .. ..@ hole   : logi FALSE
>   .. .. .. .. .. .. ..@ ringDir: int 1
>   .. .. .. .. .. .. ..@ coords : num [1:36, 1:2] 159 159 159 159 159
>   ...
>   .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
>   .. .. .. .. .. .. ..@ labpt  : num [1:2] 159.1 -31.5
>   .. .. .. .. .. .. ..@ area   : num 4.27e-06
>   .. .. .. .. .. .. ..@ hole   : logi FALSE
>   .. .. .. .. .. .. ..@ ringDir: int 1
>   .. .. .. .. .. .. ..@ coords : num [1:109, 1:2] 159 159 159 159 159
>   ...
>   .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
>   .. .. .. .. .. .. ..@ labpt  : num [1:2] 159.1 -31.5
>   .. .. .. .. .. .. ..@ area   : num 1.42e-05
>   .. .. .. .. .. .. ..@ hole   : logi FALSE
>   .. .. .. .. .. .. ..@ ringDir: int 1
>   .. .. .. .. .. .. ..@ coords : num [1:85, 1:2] 159 159 159 159 159
>   ...
>   .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
>   .. .. .. .. .. .. ..@ labpt  : num [1:2] 159.1 -31.6
>   .. .. .. .. .. .. ..@ area   : num 0.00152
>   .. .. .. .. .. .. ..@ hole   : logi FALSE
>   .. .. .. .. .. .. ..@ ringDir: int 1
>   .. .. .. .. .. .. ..@ coords : num [1:2929, 1:2] 159 159 159 159
>   159 ...
>   .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
>   .. .. .. .. .. .. ..@ labpt  : num [1:2] 142.2 -30.7
>   .. .. .. .. .. .. ..@ area   : num 8.79
>   .. .. .. .. .. .. ..@ hole   : logi FALSE
>   .. .. .. .. .. .. ..@ ringDir: int 1
>   .. .. .. .. .. .. ..@ coords : num [1:5178, 1:2] 144 144 144 144
>   144 ...
>   .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
>   .. .. .. .. .. .. ..@ labpt  : num [1:2] 141.5 -31.9
>   .. .. .. .. .. .. ..@ area   : num 0.0162
>   .. .. .. .. .. .. ..@ hole   : logi TRUE
>   .. .. .. .. .. .. ..@ ringDir: int -1
>   .. .. .. .. .. .. ..@ coords : num [1:131, 1:2] 141 141 141 141 141
>   ...
>   .. .. .. ..@ plotOrder: int [1:14] 13 14 12 11 10 9 8 7 6 5 ...
>   .. .. .. ..@ labpt    : num [1:2] 142.2 -30.7
>   .. .. .. ..@ ID       : chr "152"
>   .. .. .. ..@ area     : num 8.79
>   ..@ plotOrder  : int 1
>   ..@ bbox       : num [1:2, 1:2] 141 -33.4 159.1 -29
>   .. ..- attr(*, "dimnames")=List of 2
>   .. .. ..$ : chr [1:2] "x" "y"
>   .. .. ..$ : chr [1:2] "min" "max"
>   ..@ proj4string:Formal class 'CRS' [package "sp"] with 1 slot
>   .. .. ..@ projargs: chr "+proj=longlat +ellps=GRS80 +no_defs"

>         [[alternative HTML version deleted]]

> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From frtog at vestas.com  Fri Nov 28 09:51:23 2014
From: frtog at vestas.com (=?iso-8859-1?Q?Frede_Aakmann_T=F8gersen?=)
Date: Fri, 28 Nov 2014 09:51:23 +0100
Subject: [R-sig-Geo] How to delete some polygons
	from	'SpatialPolygonsDataFrame'
In-Reply-To: <CAOMGRD+EadNHjNQw_HFDcEbbmKJuvC9RxB_NgLRzrV5MdispWA@mail.gmail.com>
References: <CAOMGRD+EadNHjNQw_HFDcEbbmKJuvC9RxB_NgLRzrV5MdispWA@mail.gmail.com>
Message-ID: <B078CDF40DFE4045AF172A8B4F68FC4857C9EF8D6E@DKRDSEXC016.vestas.net>

Hi

If nsw_lga[153, ] is the island that you do not want to plot then you can do

plot(nsw_lga[ -153,  ])

or you can set an xlim in plot()

plot(nsw_lga, xlim = c(140, 153))

you may perhaps need play with the settings of xlim to find the right ones.

If you want to have an object without the island then do

nsw_lga_wo_island <- nsw_lga[ -153,  ]

Something like

nsw_lga[ -153,  ] <- NULL doesn't seem to work. Don't know if something similar will work.


Yours sincerely / Med venlig hilsen


Frede Aakmann T?gersen
Specialist, M.Sc., Ph.D.
Plant Performance & Modeling

Technology & Service Solutions
T +45 9730 5135
M +45 2547 6050
frtog at vestas.com
http://www.vestas.com

Company reg. name: Vestas Wind Systems A/S
This e-mail is subject to our e-mail disclaimer statement.
Please refer to www.vestas.com/legal/notice
If you have received this e-mail in error please contact the sender. 

> -----Original Message-----
> From: R-sig-Geo [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of
> Jianyun Wu
> Sent: 28. november 2014 06:33
> To: R-sig-Geo at r-project.org
> Subject: [R-sig-Geo] How to delete some polygons from
> 'SpatialPolygonsDataFrame'
> 
> Dear list,
> 
> I usually use 'readOGR()' from rgdal package in R to input the ESRI
> shapefile.
> So the inputted data are SpatialPolygonsDataFrame.
> 
> I am processing the New South Wales, Australia map for a spatial analysis.
> There is an island far away from the mainland, which I want to delete it
> from the map when I plot NSW.  Because it makes the whole plot small due
> to
> its long distant.
> 
> Below is the area contains the polygons of this island and surrounding
> islands. There are 14 "@Polygons" contributing to the entire area. From
> some experiments, I know that it is Polygon 3-14 making the distant
> islands.
> 
> Is there a simple way that I can delete those small polygons from this area
> polygon and their attributes from the data
> 
> Thank you
> 
> Fred
> 
> str(nsw_lga[153, ])
> Formal class 'SpatialPolygonsDataFrame' [package "sp"] with 5 slots
>   ..@ data       :'data.frame':    1 obs. of  3 variables:
>   .. ..$ STATE_CODE: Factor w/ 9 levels "1","2","3","4",..: 1
>   .. ..$ LGA_CODE11: Factor w/ 565 levels "10050","10110",..: 153
>   .. ..$ LGA_NAME11: Factor w/ 564 levels "Adelaide (C)",..: 483
>   ..@ polygons   :List of 1
>   .. ..$ :Formal class 'Polygons' [package "sp"] with 5 slots
>   .. .. .. ..@ Polygons :List of 14
>   .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
>   .. .. .. .. .. .. ..@ labpt  : num [1:2] 159.1 -31.5
>   .. .. .. .. .. .. ..@ area   : num 3.83e-07
>   .. .. .. .. .. .. ..@ hole   : logi FALSE
>   .. .. .. .. .. .. ..@ ringDir: int 1
>   .. .. .. .. .. .. ..@ coords : num [1:38, 1:2] 159 159 159 159 159 ...
>   .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
>   .. .. .. .. .. .. ..@ labpt  : num [1:2] 159.1 -31.5
>   .. .. .. .. .. .. ..@ area   : num 4.69e-07
>   .. .. .. .. .. .. ..@ hole   : logi FALSE
>   .. .. .. .. .. .. ..@ ringDir: int 1
>   .. .. .. .. .. .. ..@ coords : num [1:13, 1:2] 159 159 159 159 159 ...
>   .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
>   .. .. .. .. .. .. ..@ labpt  : num [1:2] 159.1 -31.5
>   .. .. .. .. .. .. ..@ area   : num 7.82e-07
>   .. .. .. .. .. .. ..@ hole   : logi FALSE
>   .. .. .. .. .. .. ..@ ringDir: int 1
>   .. .. .. .. .. .. ..@ coords : num [1:31, 1:2] 159 159 159 159 159 ...
>   .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
>   .. .. .. .. .. .. ..@ labpt  : num [1:2] 159.1 -31.5
>   .. .. .. .. .. .. ..@ area   : num 1.02e-06
>   .. .. .. .. .. .. ..@ hole   : logi FALSE
>   .. .. .. .. .. .. ..@ ringDir: int 1
>   .. .. .. .. .. .. ..@ coords : num [1:47, 1:2] 159 159 159 159 159 ...
>   .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
>   .. .. .. .. .. .. ..@ labpt  : num [1:2] 159.1 -31.5
>   .. .. .. .. .. .. ..@ area   : num 1.14e-06
>   .. .. .. .. .. .. ..@ hole   : logi FALSE
>   .. .. .. .. .. .. ..@ ringDir: int 1
>   .. .. .. .. .. .. ..@ coords : num [1:22, 1:2] 159 159 159 159 159 ...
>   .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
>   .. .. .. .. .. .. ..@ labpt  : num [1:2] 159.1 -31.6
>   .. .. .. .. .. .. ..@ area   : num 1.38e-06
>   .. .. .. .. .. .. ..@ hole   : logi FALSE
>   .. .. .. .. .. .. ..@ ringDir: int 1
>   .. .. .. .. .. .. ..@ coords : num [1:24, 1:2] 159 159 159 159 159 ...
>   .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
>   .. .. .. .. .. .. ..@ labpt  : num [1:2] 159.1 -31.5
>   .. .. .. .. .. .. ..@ area   : num 1.52e-06
>   .. .. .. .. .. .. ..@ hole   : logi FALSE
>   .. .. .. .. .. .. ..@ ringDir: int 1
>   .. .. .. .. .. .. ..@ coords : num [1:26, 1:2] 159 159 159 159 159 ...
>   .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
>   .. .. .. .. .. .. ..@ labpt  : num [1:2] 159.1 -31.5
>   .. .. .. .. .. .. ..@ area   : num 2.05e-06
>   .. .. .. .. .. .. ..@ hole   : logi FALSE
>   .. .. .. .. .. .. ..@ ringDir: int 1
>   .. .. .. .. .. .. ..@ coords : num [1:32, 1:2] 159 159 159 159 159 ...
>   .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
>   .. .. .. .. .. .. ..@ labpt  : num [1:2] 159.1 -31.5
>   .. .. .. .. .. .. ..@ area   : num 2.61e-06
>   .. .. .. .. .. .. ..@ hole   : logi FALSE
>   .. .. .. .. .. .. ..@ ringDir: int 1
>   .. .. .. .. .. .. ..@ coords : num [1:36, 1:2] 159 159 159 159 159 ...
>   .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
>   .. .. .. .. .. .. ..@ labpt  : num [1:2] 159.1 -31.5
>   .. .. .. .. .. .. ..@ area   : num 4.27e-06
>   .. .. .. .. .. .. ..@ hole   : logi FALSE
>   .. .. .. .. .. .. ..@ ringDir: int 1
>   .. .. .. .. .. .. ..@ coords : num [1:109, 1:2] 159 159 159 159 159 ...
>   .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
>   .. .. .. .. .. .. ..@ labpt  : num [1:2] 159.1 -31.5
>   .. .. .. .. .. .. ..@ area   : num 1.42e-05
>   .. .. .. .. .. .. ..@ hole   : logi FALSE
>   .. .. .. .. .. .. ..@ ringDir: int 1
>   .. .. .. .. .. .. ..@ coords : num [1:85, 1:2] 159 159 159 159 159 ...
>   .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
>   .. .. .. .. .. .. ..@ labpt  : num [1:2] 159.1 -31.6
>   .. .. .. .. .. .. ..@ area   : num 0.00152
>   .. .. .. .. .. .. ..@ hole   : logi FALSE
>   .. .. .. .. .. .. ..@ ringDir: int 1
>   .. .. .. .. .. .. ..@ coords : num [1:2929, 1:2] 159 159 159 159 159 ...
>   .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
>   .. .. .. .. .. .. ..@ labpt  : num [1:2] 142.2 -30.7
>   .. .. .. .. .. .. ..@ area   : num 8.79
>   .. .. .. .. .. .. ..@ hole   : logi FALSE
>   .. .. .. .. .. .. ..@ ringDir: int 1
>   .. .. .. .. .. .. ..@ coords : num [1:5178, 1:2] 144 144 144 144 144 ...
>   .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
>   .. .. .. .. .. .. ..@ labpt  : num [1:2] 141.5 -31.9
>   .. .. .. .. .. .. ..@ area   : num 0.0162
>   .. .. .. .. .. .. ..@ hole   : logi TRUE
>   .. .. .. .. .. .. ..@ ringDir: int -1
>   .. .. .. .. .. .. ..@ coords : num [1:131, 1:2] 141 141 141 141 141 ...
>   .. .. .. ..@ plotOrder: int [1:14] 13 14 12 11 10 9 8 7 6 5 ...
>   .. .. .. ..@ labpt    : num [1:2] 142.2 -30.7
>   .. .. .. ..@ ID       : chr "152"
>   .. .. .. ..@ area     : num 8.79
>   ..@ plotOrder  : int 1
>   ..@ bbox       : num [1:2, 1:2] 141 -33.4 159.1 -29
>   .. ..- attr(*, "dimnames")=List of 2
>   .. .. ..$ : chr [1:2] "x" "y"
>   .. .. ..$ : chr [1:2] "min" "max"
>   ..@ proj4string:Formal class 'CRS' [package "sp"] with 1 slot
>   .. .. ..@ projargs: chr "+proj=longlat +ellps=GRS80 +no_defs"
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From Roger.Bivand at nhh.no  Fri Nov 28 11:38:10 2014
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 28 Nov 2014 11:38:10 +0100
Subject: [R-sig-Geo] How to delete some polygons from
 'SpatialPolygonsDataFrame'
In-Reply-To: <B078CDF40DFE4045AF172A8B4F68FC4857C9EF8D6E@DKRDSEXC016.vestas.net>
References: <CAOMGRD+EadNHjNQw_HFDcEbbmKJuvC9RxB_NgLRzrV5MdispWA@mail.gmail.com>
	<B078CDF40DFE4045AF172A8B4F68FC4857C9EF8D6E@DKRDSEXC016.vestas.net>
Message-ID: <alpine.LRH.2.03.1411281051330.4437@reclus.nhh.no>

On Fri, 28 Nov 2014, Frede Aakmann T?gersen wrote:

> Hi
>
> If nsw_lga[153, ] is the island that you do not want to plot then you can do

I think that the problem is that only Polygon objects 1:12 in Polygons 
object 153 are the islands, while 13:14 are larger and do not have 
label point longitude > 159. One possibility then is to take out the 
Polygons object (using Scotland in rgdal as an example and recalling 
Barry Rowlingson's insight that someone added slivers of islands to their 
desired proximate neighbours - so part of 48 Shetland is on Orkney):

library(rgdal)
dsn <- system.file("vectors", package = "rgdal")[1]
scot_BNG <- readOGR(dsn=dsn, layer="scot_BNG")
plot(scot_BNG)
plot(scot_BNG[48,], col="red", add=TRUE)
library(spdep)
nb <- poly2nb(scot_BNG)
plot(nb, coordinates(scot_BNG), add=TRUE)

If we drop Shetland and Fair Isle (using a latitude cutoff):

scot_BNG1 <- scot_BNG
pols48 <- slot(scot_BNG1, "polygons")[[48]]
pol48 <- slot(pols48, "Polygons")
length(pol48)
sapply(pol48, function(x) {slot(x, "labpt")[2]})

res <- pol48[sapply(pol48, function(x) {slot(x, "labpt")[2]}) < 1050000]

slot(pols48, "Polygons") <- res
slot(scot_BNG1, "polygons")[[48]] <- pols48

plot(scot_BNG1, lwd=3, add=TRUE)
bbox(scot_BNG)
bbox(scot_BNG1)

we appear to get what we want (but the plot order and bounding box of the 
SpatialPolygons object are not updated to match the exclusion). 
Alternatively, and reconstructing the object, use rgeos:

library(rgeos)
bb <- bbox(scot_BNG)
plot(scot_BNG)
plot(scot_BNG[48,], col="red", add=TRUE)

crds <- cbind(x=c(bb[1, 1]-1, bb[1, 1]-1, bb[1, 2]+1, bb[1, 2]+1,
  bb[1, 1]-1),  y=c(bb[2, 1]-1, 1050000, 1050000, bb[2, 1]-1, bb[2, 1]-1))
c1 <- SpatialPolygons(list(Polygons(list(Polygon(crds)), "1")),
  proj4string=CRS(proj4string(scot_BNG)))
plot(c1, add=TRUE, lty=2)

scot_BNG2a <- gIntersection(scot_BNG, c1, byid=c(TRUE, FALSE))
scot_BNG2b <- SpatialPolygonsDataFrame(scot_BNG2a, data=slot(scot_BNG,
  "data"))

plot(scot_BNG2b, lwd=3, add=TRUE)
bbox(scot_BNG)
bbox(scot_BNG2b)

Hope this clarifies,

Roger

>
> plot(nsw_lga[ -153,  ])
>
> or you can set an xlim in plot()
>
> plot(nsw_lga, xlim = c(140, 153))
>
> you may perhaps need play with the settings of xlim to find the right ones.
>
> If you want to have an object without the island then do
>
> nsw_lga_wo_island <- nsw_lga[ -153,  ]
>
> Something like
>
> nsw_lga[ -153,  ] <- NULL doesn't seem to work. Don't know if something similar will work.
>
>
> Yours sincerely / Med venlig hilsen
>
>
> Frede Aakmann T?gersen
> Specialist, M.Sc., Ph.D.
> Plant Performance & Modeling
>
> Technology & Service Solutions
> T +45 9730 5135
> M +45 2547 6050
> frtog at vestas.com
> http://www.vestas.com
>
> Company reg. name: Vestas Wind Systems A/S
> This e-mail is subject to our e-mail disclaimer statement.
> Please refer to www.vestas.com/legal/notice
> If you have received this e-mail in error please contact the sender.
>
>> -----Original Message-----
>> From: R-sig-Geo [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of
>> Jianyun Wu
>> Sent: 28. november 2014 06:33
>> To: R-sig-Geo at r-project.org
>> Subject: [R-sig-Geo] How to delete some polygons from
>> 'SpatialPolygonsDataFrame'
>>
>> Dear list,
>>
>> I usually use 'readOGR()' from rgdal package in R to input the ESRI
>> shapefile.
>> So the inputted data are SpatialPolygonsDataFrame.
>>
>> I am processing the New South Wales, Australia map for a spatial analysis.
>> There is an island far away from the mainland, which I want to delete it
>> from the map when I plot NSW.  Because it makes the whole plot small due
>> to
>> its long distant.
>>
>> Below is the area contains the polygons of this island and surrounding
>> islands. There are 14 "@Polygons" contributing to the entire area. From
>> some experiments, I know that it is Polygon 3-14 making the distant
>> islands.
>>
>> Is there a simple way that I can delete those small polygons from this area
>> polygon and their attributes from the data
>>
>> Thank you
>>
>> Fred
>>
>> str(nsw_lga[153, ])
>> Formal class 'SpatialPolygonsDataFrame' [package "sp"] with 5 slots
>>   ..@ data       :'data.frame':    1 obs. of  3 variables:
>>   .. ..$ STATE_CODE: Factor w/ 9 levels "1","2","3","4",..: 1
>>   .. ..$ LGA_CODE11: Factor w/ 565 levels "10050","10110",..: 153
>>   .. ..$ LGA_NAME11: Factor w/ 564 levels "Adelaide (C)",..: 483
>>   ..@ polygons   :List of 1
>>   .. ..$ :Formal class 'Polygons' [package "sp"] with 5 slots
>>   .. .. .. ..@ Polygons :List of 14
>>   .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
>>   .. .. .. .. .. .. ..@ labpt  : num [1:2] 159.1 -31.5
>>   .. .. .. .. .. .. ..@ area   : num 3.83e-07
>>   .. .. .. .. .. .. ..@ hole   : logi FALSE
>>   .. .. .. .. .. .. ..@ ringDir: int 1
>>   .. .. .. .. .. .. ..@ coords : num [1:38, 1:2] 159 159 159 159 159 ...
>>   .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
>>   .. .. .. .. .. .. ..@ labpt  : num [1:2] 159.1 -31.5
>>   .. .. .. .. .. .. ..@ area   : num 4.69e-07
>>   .. .. .. .. .. .. ..@ hole   : logi FALSE
>>   .. .. .. .. .. .. ..@ ringDir: int 1
>>   .. .. .. .. .. .. ..@ coords : num [1:13, 1:2] 159 159 159 159 159 ...
>>   .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
>>   .. .. .. .. .. .. ..@ labpt  : num [1:2] 159.1 -31.5
>>   .. .. .. .. .. .. ..@ area   : num 7.82e-07
>>   .. .. .. .. .. .. ..@ hole   : logi FALSE
>>   .. .. .. .. .. .. ..@ ringDir: int 1
>>   .. .. .. .. .. .. ..@ coords : num [1:31, 1:2] 159 159 159 159 159 ...
>>   .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
>>   .. .. .. .. .. .. ..@ labpt  : num [1:2] 159.1 -31.5
>>   .. .. .. .. .. .. ..@ area   : num 1.02e-06
>>   .. .. .. .. .. .. ..@ hole   : logi FALSE
>>   .. .. .. .. .. .. ..@ ringDir: int 1
>>   .. .. .. .. .. .. ..@ coords : num [1:47, 1:2] 159 159 159 159 159 ...
>>   .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
>>   .. .. .. .. .. .. ..@ labpt  : num [1:2] 159.1 -31.5
>>   .. .. .. .. .. .. ..@ area   : num 1.14e-06
>>   .. .. .. .. .. .. ..@ hole   : logi FALSE
>>   .. .. .. .. .. .. ..@ ringDir: int 1
>>   .. .. .. .. .. .. ..@ coords : num [1:22, 1:2] 159 159 159 159 159 ...
>>   .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
>>   .. .. .. .. .. .. ..@ labpt  : num [1:2] 159.1 -31.6
>>   .. .. .. .. .. .. ..@ area   : num 1.38e-06
>>   .. .. .. .. .. .. ..@ hole   : logi FALSE
>>   .. .. .. .. .. .. ..@ ringDir: int 1
>>   .. .. .. .. .. .. ..@ coords : num [1:24, 1:2] 159 159 159 159 159 ...
>>   .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
>>   .. .. .. .. .. .. ..@ labpt  : num [1:2] 159.1 -31.5
>>   .. .. .. .. .. .. ..@ area   : num 1.52e-06
>>   .. .. .. .. .. .. ..@ hole   : logi FALSE
>>   .. .. .. .. .. .. ..@ ringDir: int 1
>>   .. .. .. .. .. .. ..@ coords : num [1:26, 1:2] 159 159 159 159 159 ...
>>   .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
>>   .. .. .. .. .. .. ..@ labpt  : num [1:2] 159.1 -31.5
>>   .. .. .. .. .. .. ..@ area   : num 2.05e-06
>>   .. .. .. .. .. .. ..@ hole   : logi FALSE
>>   .. .. .. .. .. .. ..@ ringDir: int 1
>>   .. .. .. .. .. .. ..@ coords : num [1:32, 1:2] 159 159 159 159 159 ...
>>   .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
>>   .. .. .. .. .. .. ..@ labpt  : num [1:2] 159.1 -31.5
>>   .. .. .. .. .. .. ..@ area   : num 2.61e-06
>>   .. .. .. .. .. .. ..@ hole   : logi FALSE
>>   .. .. .. .. .. .. ..@ ringDir: int 1
>>   .. .. .. .. .. .. ..@ coords : num [1:36, 1:2] 159 159 159 159 159 ...
>>   .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
>>   .. .. .. .. .. .. ..@ labpt  : num [1:2] 159.1 -31.5
>>   .. .. .. .. .. .. ..@ area   : num 4.27e-06
>>   .. .. .. .. .. .. ..@ hole   : logi FALSE
>>   .. .. .. .. .. .. ..@ ringDir: int 1
>>   .. .. .. .. .. .. ..@ coords : num [1:109, 1:2] 159 159 159 159 159 ...
>>   .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
>>   .. .. .. .. .. .. ..@ labpt  : num [1:2] 159.1 -31.5
>>   .. .. .. .. .. .. ..@ area   : num 1.42e-05
>>   .. .. .. .. .. .. ..@ hole   : logi FALSE
>>   .. .. .. .. .. .. ..@ ringDir: int 1
>>   .. .. .. .. .. .. ..@ coords : num [1:85, 1:2] 159 159 159 159 159 ...
>>   .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
>>   .. .. .. .. .. .. ..@ labpt  : num [1:2] 159.1 -31.6
>>   .. .. .. .. .. .. ..@ area   : num 0.00152
>>   .. .. .. .. .. .. ..@ hole   : logi FALSE
>>   .. .. .. .. .. .. ..@ ringDir: int 1
>>   .. .. .. .. .. .. ..@ coords : num [1:2929, 1:2] 159 159 159 159 159 ...
>>   .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
>>   .. .. .. .. .. .. ..@ labpt  : num [1:2] 142.2 -30.7
>>   .. .. .. .. .. .. ..@ area   : num 8.79
>>   .. .. .. .. .. .. ..@ hole   : logi FALSE
>>   .. .. .. .. .. .. ..@ ringDir: int 1
>>   .. .. .. .. .. .. ..@ coords : num [1:5178, 1:2] 144 144 144 144 144 ...
>>   .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
>>   .. .. .. .. .. .. ..@ labpt  : num [1:2] 141.5 -31.9
>>   .. .. .. .. .. .. ..@ area   : num 0.0162
>>   .. .. .. .. .. .. ..@ hole   : logi TRUE
>>   .. .. .. .. .. .. ..@ ringDir: int -1
>>   .. .. .. .. .. .. ..@ coords : num [1:131, 1:2] 141 141 141 141 141 ...
>>   .. .. .. ..@ plotOrder: int [1:14] 13 14 12 11 10 9 8 7 6 5 ...
>>   .. .. .. ..@ labpt    : num [1:2] 142.2 -30.7
>>   .. .. .. ..@ ID       : chr "152"
>>   .. .. .. ..@ area     : num 8.79
>>   ..@ plotOrder  : int 1
>>   ..@ bbox       : num [1:2, 1:2] 141 -33.4 159.1 -29
>>   .. ..- attr(*, "dimnames")=List of 2
>>   .. .. ..$ : chr [1:2] "x" "y"
>>   .. .. ..$ : chr [1:2] "min" "max"
>>   ..@ proj4string:Formal class 'CRS' [package "sp"] with 1 slot
>>   .. .. ..@ projargs: chr "+proj=longlat +ellps=GRS80 +no_defs"
>>
>> 	[[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no

From hengl at spatial-analyst.net  Fri Nov 28 17:22:46 2014
From: hengl at spatial-analyst.net (Tomislav Hengl)
Date: Fri, 28 Nov 2014 17:22:46 +0100
Subject: [R-sig-Geo] First call GEOSTAT 2015, 16-23 August, Lancaster,
 UK: registrations are now open!
Message-ID: <5478A156.8070506@spatial-analyst.net>


The GEOSTAT 2015 Summer School for PhD students and R-sig-geo 
enthusiasts will be held this year at the Lancaster University 
(Conference center) in the period 16-23 August (arrive Sunday to depart 
Sunday). The topics include: spatial and spatio-temporal data and 
analysis in R, R as a GIS, Space-time point process data, geographically 
weighted regression, visualization of spatial and spatio-temporal data 
in Google Earth, GRASS GIS and QGIS tutorials, and spatial and 
spatio-temporal geostatistics.

To register for this summer school please visit: 
http://geostat-course.org/2015

The registration deadline is: February 1st 2015.

This summer school is limited to 55 participants. Selection of 
candidates is based on a ranking system, which is based on: time of 
registration, solidarity (participants further away from the venue 
receive higher ranking), academic record, and contributions to open 
source projects. The registration costs for the summer school are 
typically between EUR 450 - 500; these cover the actual costs, no 
profits are made. Accommodation on campus will cost ca 35 GBP (EUR 44) 
per person per night (not included in the course fees). The organizers 
provide no funding/scholarships to participants.. Participants from 
ODA-listed countries (http://www.oecd.org/dac/stats/daclist), however, 
can apply for a subsidized price for registration costs.

Lecturers:
- Roger Bivand: Representing and handling spatial and spatio-temporal 
data in R: sp, rgdal, maptools packages
- Edzer Pebesma: Handling and analyzing spatio-temporal data with R
- Markus Neteler: GRASS GIS 7 tutorial
- Jonathan A. Greenberg: rasterEngine tutorial
- Chris Brunsdon: Geographically weighted regression: GWmodel package
- Patrick E. Brown: Geostatistical modelling with geostatsp
- Edith Gabriel: Space-time point process data: analysis and simulation 
using the R package stpp
- Barry Rowlingson: QGIS vs R - mapping shootout
- Tomislav Hengl: Automated geostatistics and visualization in 3D+T: 
GSIF and plotKML packages

For more information about GEOSTAT 2015 please write to:
- T. (Tom) Hengl: registrations, website materials
- B. (Barry) Rowlingson: the official program, local organizer


From juta.kawalerowicz at nuffield.ox.ac.uk  Sun Nov 30 23:59:25 2014
From: juta.kawalerowicz at nuffield.ox.ac.uk (Juta Kawalerowicz)
Date: Sun, 30 Nov 2014 22:59:25 +0000
Subject: [R-sig-Geo] Calculating what proportion of polygons is covered by
	rivers
Message-ID: <CAHMizkMu2m2PFq4iR2AYRO90bZ3muyBkCvMgUmCcf6E5BmUxag@mail.gmail.com>

Hi, I have question - I am looking for ideas how to proceed.

I have a SpatialPolygonsDataFrame with polygons (300) representing
districts. Another SpatialPolygonsDataFrame has 700 polygons and these
polygons represent rivers and flooding areas. My question is how would you
go about calculating what proportion of districts is covered by rivers and
flooding areas?

My first intuition was to rasterize it and then use the extract function
but maybe I am overcomplicating this. Any ideas would be appreciated.

Thanks,
Juta

	[[alternative HTML version deleted]]


