From Luisr at frs.fo  Wed Nov  1 17:04:56 2006
From: Luisr at frs.fo (Luis Ridao Cruz)
Date: Wed, 01 Nov 2006 16:04:56 +0000
Subject: [R-sig-Geo] the "image" question nobody answered some time ago
Message-ID: <s548c5af.075@ffdata.setur.fo>

GeoR help,

Below is the code I used to get the kriging
for the object Su[[1]] :

> str(Su[[1]])
List of 2
 $ x          , y          : num [1:1209, 1:2] -4.24 -5.31 -7.57 -7.42
-6.91 ...
  ..- attr(*, "dimnames")=List of 2
  .. ..$ : chr [1:1209] "2235" "2236" "2237" "2238" ...
  .. ..$ : chr [1:2] "x" "y"
 $ data       : num [1:1209] 3.91 3 7.87 3.78 3.43 1.61 1.39 4.22 3.83
4.17 ...
 - attr(*, "class")= chr "geodata"

, using the  maximum likelihood estimation object "ml" :

> ml
likfit: estimated model parameters:
   beta   tausq sigmasq     phi 
"2.901" "1.033" "1.140" "0.429" 

likfit: maximised log-likelihood = -1897


######################## 
luis <- krige.conv(Su[[1]]
, locations = lociLuis1
, krige = krige.control(obj.m = ml))
#######################


But when I try to plot with "image" :

> image(luis, loc = test1, col = grey(seq(1, 0.1, l = 30)))

##################
test <- expand.grid(seq(-6,  -5,  l  = 10),  seq(61.5, 62, l = 10))
test1 <- as.matrix(test)
colnames(test1) <-  c('x','y')
##################


I get the following:

Warning messages:
1: no non-missing arguments to min; returning Inf 
2: no non-missing arguments to max; returning -Inf 

What is wrorg?

Thanks in advance

P.S: this message (similar one ) was posted on 31/05/2006 to this list
but no answerwas produced


Windows XP

> version
               _                         
platform       i386-pc-mingw32           
arch           i386                      
os             mingw32                   
system         i386, mingw32             
status                                   
major          2                         
minor          3.0                       
year           2006                      
month          04                        
day            24                        
svn rev        37909                     
language       R                         
version.string Version 2.3.0 (2006-04-24)



From paulojus at c3sl.ufpr.br  Wed Nov  1 19:04:25 2006
From: paulojus at c3sl.ufpr.br (Paulo Justiniano Ribeiro Jr)
Date: Wed, 1 Nov 2006 15:04:25 -0300 (BRT)
Subject: [R-sig-Geo] the "image" question nobody answered some time ago
In-Reply-To: <s548c5af.075@ffdata.setur.fo>
References: <s548c5af.075@ffdata.setur.fo>
Message-ID: <Pine.LNX.4.58.0611011502590.10726@macalan.c3sl.ufpr.br>

Dear Luis

Coud you please send an script and data/workspace such that I can try to
reproduce the probblem here?

best
P.J.


Paulo Justiniano Ribeiro Jr
LEG (Laborat?rio de Estat?stica e Geoinforma??o)
Departamento de Estat?stica
Universidade Federal do Paran?
Caixa Postal 19.081
CEP 81.531-990
Curitiba, PR  -  Brasil
Tel: (+55) 41 3361 3573
Fax: (+55) 41 3361 3141
e-mail: paulojus AT  ufpr  br
http://leg.ufpr.br/~paulojus

On Wed, 1 Nov 2006, Luis Ridao Cruz wrote:

> GeoR help,
>
> Below is the code I used to get the kriging
> for the object Su[[1]] :
>
> > str(Su[[1]])
> List of 2
>  $ x          , y          : num [1:1209, 1:2] -4.24 -5.31 -7.57 -7.42
> -6.91 ...
>   ..- attr(*, "dimnames")=List of 2
>   .. ..$ : chr [1:1209] "2235" "2236" "2237" "2238" ...
>   .. ..$ : chr [1:2] "x" "y"
>  $ data       : num [1:1209] 3.91 3 7.87 3.78 3.43 1.61 1.39 4.22 3.83
> 4.17 ...
>  - attr(*, "class")= chr "geodata"
>
> , using the  maximum likelihood estimation object "ml" :
>
> > ml
> likfit: estimated model parameters:
>    beta   tausq sigmasq     phi
> "2.901" "1.033" "1.140" "0.429"
>
> likfit: maximised log-likelihood = -1897
>
>
> ########################
> luis <- krige.conv(Su[[1]]
> , locations = lociLuis1
> , krige = krige.control(obj.m = ml))
> #######################
>
>
> But when I try to plot with "image" :
>
> > image(luis, loc = test1, col = grey(seq(1, 0.1, l = 30)))
>
> ##################
> test <- expand.grid(seq(-6,  -5,  l  = 10),  seq(61.5, 62, l = 10))
> test1 <- as.matrix(test)
> colnames(test1) <-  c('x','y')
> ##################
>
>
> I get the following:
>
> Warning messages:
> 1: no non-missing arguments to min; returning Inf
> 2: no non-missing arguments to max; returning -Inf
>
> What is wrorg?
>
> Thanks in advance
>
> P.S: this message (similar one ) was posted on 31/05/2006 to this list
> but no answerwas produced
>
>
> Windows XP
>
> > version
>                _
> platform       i386-pc-mingw32
> arch           i386
> os             mingw32
> system         i386, mingw32
> status
> major          2
> minor          3.0
> year           2006
> month          04
> day            24
> svn rev        37909
> language       R
> version.string Version 2.3.0 (2006-04-24)
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



From Luisr at frs.fo  Thu Nov  2 12:10:17 2006
From: Luisr at frs.fo (Luis Ridao Cruz)
Date: Thu, 02 Nov 2006 11:10:17 +0000
Subject: [R-sig-Geo] the "image" question nobody answered some
	timeago:Reproducible example
Message-ID: <s549d220.099@ffdata.setur.fo>



>>> Luis Ridao Cruz 24/05/2006 10:06:38 >>>
GeoR help,

Attached are the Script.R file to reproduce the example.


File "luisData" contains the observed data

File "olsFn" contains the fitted variogram model (using ordinary least
squares estimation)

Files "lociLuis" and "lociLuis1" are the data sets to make the kriging
preditions



If requested I can also send other modeled variograms.




Thanks in advance




Windows XP

> version
               _                           
platform       i386-pc-mingw32             
arch           i386                        
os             mingw32                     
system         i386, mingw32               
status                                     
major          2                           
minor          4.0                         
year           2006                        
month          10                          
day            03                          
svn rev        39566                       
language       R                           
version.string R version 2.4.0 (2006-10-03)
-------------- next part --------------
A non-text attachment was scrubbed...
Name: lociLuis
Type: application/octet-stream
Size: 74 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20061102/cfaad453/attachment.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: lociLuis1
Type: application/octet-stream
Size: 14483 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20061102/cfaad453/attachment-0001.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: olsFn
Type: application/octet-stream
Size: 766 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20061102/cfaad453/attachment-0002.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: luisData
Type: application/octet-stream
Size: 43488 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20061102/cfaad453/attachment-0003.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Script.R
Type: application/octet-stream
Size: 377 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20061102/cfaad453/attachment-0004.obj>

From sq210 at cam.ac.uk  Thu Nov  2 22:40:32 2006
From: sq210 at cam.ac.uk (Suhel Quader)
Date: 02 Nov 2006 21:40:32 +0000
Subject: [R-sig-Geo] gls with fixed nugget
In-Reply-To: <Pine.LNX.4.64.0609131359490.11573@hermes-2.csi.cam.ac.uk>
References: <Pine.LNX.4.64.0609131359490.11573@hermes-2.csi.cam.ac.uk>
Message-ID: <Prayer.1.0.18.0611022140320.28159@hermes-1.csi.cam.ac.uk>

Hello all,

Does anyone know whether it is possible to specify a fixed nugget in a GLS 
model, while allowing the range to vary in the optimization?

I am using gls() in the nlme package, with exponential correlation 
structure. One can pass (initial) values of the range and nugget to corExp. 
One can also pass an optional logical value to the "fixed" argument, but 
this affects both range and nugget. Is there a way to control their values 
separately?

I'd appreciate any advice!

Many thanks,
  Suhel

Suhel Quader, PhD
Department of Zoology
University of Cambridge



From mhv at dmu.dk  Fri Nov  3 10:57:48 2006
From: mhv at dmu.dk (Hvidberg, Martin)
Date: Fri, 3 Nov 2006 10:57:48 +0100
Subject: [R-sig-Geo] Getting the Shapefile package to work?
Message-ID: <D9F7DF5A990D7D4C8CE961812C8A9CA00361B3E4@dmurpost.dmu.dk>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20061103/7545a667/attachment.pl>

From Roger.Bivand at nhh.no  Fri Nov  3 11:26:30 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 3 Nov 2006 11:26:30 +0100 (CET)
Subject: [R-sig-Geo] Getting the Shapefile package to work?
In-Reply-To: <D9F7DF5A990D7D4C8CE961812C8A9CA00361B3E4@dmurpost.dmu.dk>
Message-ID: <Pine.LNX.4.44.0611031119500.640-100000@reclus.nhh.no>

Replied to on R-help, but shapefiles has an undeclared dependence on 
foreign, which ought to have been made explicit properly in the package. 

Since read.dbf() in foreign is the shapelib function (and maptools and
rgdal also use shapelib), this might suggest that using maptools or rgdal
is a better solution unless you really need to debug shapelib within R (I
have done this for GeoLytics Inc. shapefiles which were breaking the ESRI
specs for the *.shx file, so the shapefiles package can be really 
helpful with broken or non-standard shapefiles).

Roger

On Fri, 3 Nov 2006, Hvidberg, Martin wrote:

> Dear list
>  
> - Propoerly a beginner question, so bare with my frustration...
>  
> I tried install the 'shapefiles' package into R 2.4.0 but it seems that the install had little effect...
>  
> 
> 		> install.packages(c("shapefiles"))
> 		--- Please select a CRAN mirror for use in this session ---
> 		trying URL 'http://cran.dk.r-project.org/bin/windows/contrib/2.4/shapefiles_0.5.zip'
> 		Content type 'application/zip' length 42335 bytes
> 		opened URL
> 		downloaded 41Kb
> 		package 'shapefiles' successfully unpacked and MD5 sums checked
> 		The downloaded packages are in
> 		        C:\TEMP\RtmpMz5Pqb\downloaded_packages
> 		updating HTML package descriptions
> 		>  dbf <- read.dbf("test.dbf")
> 		Error: could not find function "read.dbf"
> 		> 
> 		
> 
> Note thet the last line contains an error.
>  
> Is the package installed or not?
> How do I get access to use the functionality it offers??
>  
> :-? Martin Hvidberg
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From stratja at auburn.edu  Fri Nov  3 13:21:37 2006
From: stratja at auburn.edu (Jeffrey Stratford)
Date: Fri, 03 Nov 2006 06:21:37 -0600
Subject: [R-sig-Geo] newbie: Moran's I
Message-ID: <454ADFF1020000F200018370@TMIA1.AUBURN.EDU>

Hi.

Does anyone have an example of estimating Moran's I from a file with
point (not polygon) data?  I'm getting close(r) but I still have a few
problems.

Here's my code so far:

library(spdep)
ctpoints <- read.csv("c:\\Georgia\\xy.csv", header=TRUE)
# only two columns containing the long-lat data 
str(ctpoints)
plot(ctpoints)
neigh <- tri2nb(ctpoints)
plot (neigh, ctpoints)
nblist <- nb2listw(neigh, glist=NULL, style="W", zero.policy=FALSE)
????? <- spNamedVec("?????", ctpoints)
gamoran <- moran(?????, nblist, n, S0, zero.policy=FALSE, NAOK=FALSE)   
 

I'm not sure what goes where I have "?????".  And yup, I did a
help(spNamedVec) but I'm not sure how to translate that material to my
case.  

Eventually, I would like to run a number of Poisson or negative binomial
regressions linking avian species richness to landscape variables around
the same points where I surveyed birds. See
http://web6.duc.auburn.edu/~stratja/georgia.pdf (map showing points on a
LANDSAT map) to get an idea of the proximity and location of points.
Since I will eventually incorporate spatial effects into my regressions
should I change the file to one that contains the coordinates, the bird
data, and the landscape data? 

Many thanks (again),

Jeff

****************************************
Jeffrey A. Stratford, Ph.D.
Postdoctoral Associate
331 Funchess Hall
Department of Biological Sciences
Auburn University
Auburn, AL 36849
334-329-9198
FAX 334-844-9234
http://www.auburn.edu/~stratja



From Roger.Bivand at nhh.no  Fri Nov  3 14:44:22 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 3 Nov 2006 14:44:22 +0100 (CET)
Subject: [R-sig-Geo] newbie: Moran's I
In-Reply-To: <454ADFF1020000F200018370@TMIA1.AUBURN.EDU>
Message-ID: <Pine.LNX.4.44.0611031429220.640-100000@reclus.nhh.no>

On Fri, 3 Nov 2006, Jeffrey Stratford wrote:

> Hi.
> 
> Does anyone have an example of estimating Moran's I from a file with
> point (not polygon) data?  I'm getting close(r) but I still have a few
> problems.
> 
> Here's my code so far:
> 
> library(spdep)
> ctpoints <- read.csv("c:\\Georgia\\xy.csv", header=TRUE)
> # only two columns containing the long-lat data 
> str(ctpoints)
> plot(ctpoints)
> neigh <- tri2nb(ctpoints)
> plot (neigh, ctpoints)
> nblist <- nb2listw(neigh, glist=NULL, style="W", zero.policy=FALSE)
> ????? <- spNamedVec("?????", ctpoints)
> gamoran <- moran(?????, nblist, n, S0, zero.policy=FALSE, NAOK=FALSE)   
>  
> 
> I'm not sure what goes where I have "?????".  And yup, I did a
> help(spNamedVec) but I'm not sure how to translate that material to my
> case.  
> 

The spNamedVec() mechanism was introduced four years ago as an existential
scream (think Munch) after seeing (published) results for data and a
neighbour list sorted in different orders. The idea was to name the data
vector, and, if required, compare those names with the region.id attribute
of the neighbours list.

But I think my concern that users might re-order the data wrt.  the
neighbour list (or vice-versa) by accident was rather extreme, so I guess
I'll remove the heavy-handed use of spNamedVec() from the examples. Your
????? should simply be the variable of interest (which isn't in ctpoints,
which only have two columns), which should be of length equal to the
number of rows in dtpoints. For now runif(nrow(ctpoints)) would give you a
dry run, and should not be autocorrelated.

Roger


> Eventually, I would like to run a number of Poisson or negative binomial
> regressions linking avian species richness to landscape variables around
> the same points where I surveyed birds. See
> http://web6.duc.auburn.edu/~stratja/georgia.pdf (map showing points on a
> LANDSAT map) to get an idea of the proximity and location of points.
> Since I will eventually incorporate spatial effects into my regressions
> should I change the file to one that contains the coordinates, the bird
> data, and the landscape data? 
> 
> Many thanks (again),
> 
> Jeff
> 
> ****************************************
> Jeffrey A. Stratford, Ph.D.
> Postdoctoral Associate
> 331 Funchess Hall
> Department of Biological Sciences
> Auburn University
> Auburn, AL 36849
> 334-329-9198
> FAX 334-844-9234
> http://www.auburn.edu/~stratja
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From saldanha.plangeo at gmail.com  Tue Nov  7 19:02:18 2006
From: saldanha.plangeo at gmail.com (Raphael Saldanha)
Date: Tue, 7 Nov 2006 15:02:18 -0300
Subject: [R-sig-Geo] GWR Newbie
Message-ID: <c85849370611071002p2d5af6eby11af311319d0448f@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20061107/c21c619f/attachment.pl>

From Roger.Bivand at nhh.no  Tue Nov  7 20:37:18 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 7 Nov 2006 20:37:18 +0100 (CET)
Subject: [R-sig-Geo] GWR Newbie
In-Reply-To: <c85849370611071002p2d5af6eby11af311319d0448f@mail.gmail.com>
Message-ID: <Pine.LNX.4.44.0611072032140.7834-100000@reclus.nhh.no>

On Tue, 7 Nov 2006, Raphael Saldanha wrote:

> Hi,
> 
> I'm using a SpatialPolygonsDataFrame object called "x" derived from a
> shapefile.
> 
> Here is what I have:
> 
> > x.adapt.gauss <- gwr.sel(PESSOAS ~ ENSFUND + ENSMEDI, data=x, adapt=TRUE)
> Adaptive q: 0.381966 CV score: 0
> Adaptive q: 0.618034 CV score: 0
> Adaptive q: 0.527864 CV score: 0
> Adaptive q: 0.5623059 CV score: 0
> Adaptive q: 0.5491503 CV score: 0
> Adaptive q: 0.5541753 CV score: 0
> Adaptive q: 0.5522559 CV score: 0
> Adaptive q: 0.552989 CV score: 0
> Adaptive q: 0.552709 CV score: 0
> Adaptive q: 0.552816 CV score: 0
> Adaptive q: 0.5527751 CV score: 0
> Adaptive q: 0.5527751 CV score: 0
> > res.adpt <- gwr(PESSOAS ~ ENSFUND + ENSMEDI, data=x, adapt=x.adapt.gauss)
> Erro em gwr(PESSOAS ~ ENSFUND + ENSMEDI, data = x, adapt = x.adapt.gauss) :
>         Input data and coordinates have different dimensions
> 
> What that can be ???

Thank you for a good report. With high probability, one of the variables 
in your model has missing values. This is signalled by the zero CV scores, 
too. I reproduced your problem in the Georgia data set example on the help 
page by:

data(georgia)
gSRDF$TotPop90[1] <- NA
g.adapt.gauss <- gwr.sel(PctBach ~ TotPop90 + PctRural + PctEld + PctFB + 
  PctPov + PctBlack, data=gSRDF, adapt=TRUE)
res.adpt <- gwr(PctBach ~ TotPop90 + PctRural + PctEld + PctFB + PctPov + 
  PctBlack, data=gSRDF, adapt=g.adapt.gauss)

with the same error message, because the code for the model itself drops 
the observation with the missing value, but its polygon is still present. 
You'll have to decide whether to subset to remove that polygon, or to try 
to establish what the missing value should have been. It is possible that 
the code should simply fail, reporting missing values in the data.

Roger

> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From vikingposten.com at pagehomepage.com  Wed Nov  8 09:18:04 2006
From: vikingposten.com at pagehomepage.com (Erick Hall)
Date: Wed, 08 Nov 2006 08:18:04 +0000
Subject: [R-sig-Geo] About your health
Message-ID: <000001c7030c$9bb26880$0100007f@localhost>


The ancient uncharacteristically at
the Sid Morgan rooftops 
and grover of grandparents
the shadow horned
directly to winding
capasity in the strand
plus and multiple to beset

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20061108/f804fe1c/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/jpeg
Size: 7425 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20061108/f804fe1c/attachment.jpe>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/gif
Size: 4947 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20061108/f804fe1c/attachment.gif>

From dina.daresta at dyrecta.com  Wed Nov  8 12:02:57 2006
From: dina.daresta at dyrecta.com (dina.daresta at dyrecta.com)
Date: 8 Nov 2006 12:02:57 +0100
Subject: [R-sig-Geo] =?utf-8?q?R-sig-Geo_Digest=2C_Vol_39=2C_Issue_4?=
Message-ID: <20061108110257.93831.qmail@w414.widhost.net>

Salve
l'indirizzo da lei digitato non ? pi? presente.
Se intende comunicare con la nostra azienda pu? scrivere a info at dyrecta.com



From frosch at rostockerzentrum.de  Wed Nov  8 17:00:53 2006
From: frosch at rostockerzentrum.de (Frosch, Katharina)
Date: Wed, 8 Nov 2006 17:00:53 +0100
Subject: [R-sig-Geo] readOGR() - choice of layer in MIF/MID file?
Message-ID: <8B08A3A1EA7AAC41BE24C750338754E60175326D@HERMES.demogr.mpg.de>

Hello all,

[this is the continuation of a thread originally posted to r-help]

As recommended by Roger, I installed the rgdal package and went through
the description of my MIF/MID files. However, I was not able to load the
data using readOGR(), most probably because I did not manage to
correctly specify the layer. As I am pretty new to spatial data analysis
and R, I am still a bit lost. 

I tried with 
setwd("E\\Maps\\MIF")
test<-readOGR("testmif.mif", layer = "layer1")

and got the error message "Error in ogrInfo(dsn = dsn, layer = layer:
Cannot open layer"

testmif.MIF
testmif.MID
containing "points", "polygons" and "regions" and corresponding
attribute data. 
(R version 2.4.0 on Windows XP)

How to find out the correct layer name? The description file of the
MIF/MID file contains only descriptions of the attributes and elements,
but no explicit layer names. 

Katharina

****************************+

Katharina Frosch
Rostocker Zentrum
Konrad-Zuse-Str. 1
18057 Rostock
Tel.: (0381) 2081-148
Fax: (0381) 2081-448
Mail: frosch at rostockerzentrum.de 




-----Original Message-----
From: Roger Bivand [mailto:Roger.Bivand at nhh.no] 
Sent: Dienstag, 7. November 2006 20:47
To: Frosch, Katharina
Cc: r-help at stat.math.ethz.ch
Subject: RE: [R] wrong fill colors in polygon-map

On Tue, 7 Nov 2006, Frosch, Katharina wrote:

> Dear Roger: Thank you for your help and the hint with the R-sig-geo
list
> (next time I'll post directly to it)!
> 
> I went again through all points you mentioned: 
> - polygons and rows of data are in the same order
> - the number of polygons and data rows is identical
> - I experimented with different values, and also defined explicit
> breakpoints without using the quantile (no effect)
> - then I added all.inside=TRUE in findIntervall (no effect)
> 
> However, adding the forcefill=FALSE option to the plot command led to
a
> strange effect: three districts were left blank. Two of these
districts
> were districts that are situated around another district (district
> A=city itself, district B=the countryside around). The third
problematic
> district is situated close to the Swiss border and next to a big lake.
I
> deleted the three districts, to see what happens. The problem is
partly
> resolved, but new blank districts appear. 
> 
> Could this be caused by a corrupted shape file rathern than by R? I
> loaded the shape-file with the Program Mapviewer in MIF/MID format,
> unionized some districts, then exported it to an ESRI-shapefile and
used
> it in R. 

It is at least worth trying. May I suggest reading the MIF/MID file
directly into R using the readOGR() function in the rgdal package? If
you
are a Mac OSX user, there is extra help needed installing rgdal, but on
Windows it is available for binary install directly from CRAN (thanks to
Uwe Ligges). The spatial classes used there are more robust, and the
data
and polygons can be kept together. Polygons may also be dissolved using
objects of the SpatialPolygons class.

Could I suggest that you move any reply to R-sig-geo, given that the 
details of spatial data formats are not of general interest?

Roger

> 
> I don't have any clue to resolve this...so any hint is very welcome!
> Katharina
> 
> 
> 
> **************************
> Katharina Frosch
> Rostocker Zentrum
> Konrad-Zuse-Str. 1
> 18057 Rostock
> Tel.: (0381) 2081-148
> Fax: (0381) 2081-448
> Mail: frosch at rostockerzentrum.de 
> 
>  
> 
> 
> -----Original Message-----
> From: Roger Bivand [mailto:Roger.Bivand at nhh.no] 
> Sent: Dienstag, 7. November 2006 13:27
> To: Frosch, Katharina
> Cc: r-help at stat.math.ethz.ch
> Subject: Re: [R] wrong fill colors in polygon-map
> 
> On Tue, 7 Nov 2006, Frosch, Katharina wrote:
> 
> > Dear all,
> > 
> > I would like to produce a map with information about the patenting
> > activity in German districts, by coloring districts with different
> > degrees of patenting activity in different colors. I work with the
> > packages maptools, maps and spdep. The map data is read from an
> external
> > .shp file (+ the corresponding .shx and .dbf files). Plotting a map
> with
> > the IDs or the patenting indicator itself works fine. But coloring
the
> > map leads to completely odd results (wrong colors for most of the
> > regions). I also tried simpler values (just 0 and 1 for different
> > regions), same problem. I tried to check whether there is any
problem
> > with the match of data and district ids, but everything seemed to be
> > fine. 
> > 
> > Sample code: 
> > ****************
> > brks.pat<-quantile(patenting$patbus)
> > #palette.pat<-c("green", "blue", "grey", "darkgrey", "red")
> > palette.pat<-c(rep("green", 4), "red")
> > plot(iab7.poly, col=palette.pat[findInterval(patenting$patbus,
> > brks.pat)])
> > legend(1200, -200, fill=palette.pat, legend=round(brks.pat,2),
> cex=0.6)
> > title(main="patenting activity in german districts")
> > 
> > Data:
> > ******
> > Iab7.poly contains the polygons of 343 German districts
> > patenting$patbus contains the number of corporate patents per
100.000
> > inhabitants for each district
> 
> (R-sig-geo may be a more focussed list for this kind of question)
> 
> If the polygons in Iab7.poly are in the same order as the rows of
> patenting, and the number of polygons is the same as the number of
rows,
> it is possible that the breakpoints are not quite what you think (if
for
> example some of the quantiles are equal, which happens with
> zero-inflated
> data). Omitting all.inside=TRUE in findInterval() can also lead to the
> insertion of NA values into the vector of colours.
> 
> Perhaps have a look at the classInt package for some examples of
> choosing 
> class intervals i.a. for map display.
> 
> Roger
> 
> > 
> > Any ideas would be appreciated!
> > 
> > Best regards,
> > Katharina
> > 
> > 
> > 
> > ******************************
> > 
> > Katharina Frosch
> > Rostock Center for the Study of Demographic Change
> > Konrad-Zuse-Str. 1
> > 18057 Rostock
> > Tel.: (0381) 2081-148
> > Fax: (0381) 2081-448
> > Mail: frosch at rostockerzentrum.de 
> > 
> > 
> > 
> > 
> > 
> > 
> > ----------
> > This mail has been sent through the MPI for Demographic
> Rese...{{dropped}}
> > 
> > ______________________________________________
> > R-help at stat.math.ethz.ch mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-help
> > PLEASE do read the posting guide
> http://www.R-project.org/posting-guide.html
> > and provide commented, minimal, self-contained, reproducible code.
> > 
> 
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


----------
This mail has been sent through the MPI for Demographic Rese...{{dropped}}



From Roger.Bivand at nhh.no  Wed Nov  8 18:05:26 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 8 Nov 2006 18:05:26 +0100 (CET)
Subject: [R-sig-Geo] readOGR() - choice of layer in MIF/MID file?
In-Reply-To: <8B08A3A1EA7AAC41BE24C750338754E60175326D@HERMES.demogr.mpg.de>
Message-ID: <Pine.LNX.4.44.0611081758160.10636-100000@reclus.nhh.no>

On Wed, 8 Nov 2006, Frosch, Katharina wrote:

> Hello all,
> 
> [this is the continuation of a thread originally posted to r-help]
> 
> As recommended by Roger, I installed the rgdal package and went through
> the description of my MIF/MID files. However, I was not able to load the
> data using readOGR(), most probably because I did not manage to
> correctly specify the layer. As I am pretty new to spatial data analysis
> and R, I am still a bit lost. 
> 
> I tried with 
> setwd("E\\Maps\\MIF")
> test<-readOGR("testmif.mif", layer = "layer1")
> 

Could you try:

test<-readOGR("testmif.mif", layer = "testmif")

treating the data source name as the file and the layer as the file name 
without extensions?

Roger

> and got the error message "Error in ogrInfo(dsn = dsn, layer = layer:
> Cannot open layer"
> 
> testmif.MIF
> testmif.MID
> containing "points", "polygons" and "regions" and corresponding
> attribute data. 
> (R version 2.4.0 on Windows XP)
> 
> How to find out the correct layer name? The description file of the
> MIF/MID file contains only descriptions of the attributes and elements,
> but no explicit layer names. 
> 
> Katharina
> 
> ****************************+
> 
> Katharina Frosch
> Rostocker Zentrum
> Konrad-Zuse-Str. 1
> 18057 Rostock
> Tel.: (0381) 2081-148
> Fax: (0381) 2081-448
> Mail: frosch at rostockerzentrum.de 
> 
> 
> 
> 
> -----Original Message-----
> From: Roger Bivand [mailto:Roger.Bivand at nhh.no] 
> Sent: Dienstag, 7. November 2006 20:47
> To: Frosch, Katharina
> Cc: r-help at stat.math.ethz.ch
> Subject: RE: [R] wrong fill colors in polygon-map
> 
> On Tue, 7 Nov 2006, Frosch, Katharina wrote:
> 
> > Dear Roger: Thank you for your help and the hint with the R-sig-geo
> list
> > (next time I'll post directly to it)!
> > 
> > I went again through all points you mentioned: 
> > - polygons and rows of data are in the same order
> > - the number of polygons and data rows is identical
> > - I experimented with different values, and also defined explicit
> > breakpoints without using the quantile (no effect)
> > - then I added all.inside=TRUE in findIntervall (no effect)
> > 
> > However, adding the forcefill=FALSE option to the plot command led to
> a
> > strange effect: three districts were left blank. Two of these
> districts
> > were districts that are situated around another district (district
> > A=city itself, district B=the countryside around). The third
> problematic
> > district is situated close to the Swiss border and next to a big lake.
> I
> > deleted the three districts, to see what happens. The problem is
> partly
> > resolved, but new blank districts appear. 
> > 
> > Could this be caused by a corrupted shape file rathern than by R? I
> > loaded the shape-file with the Program Mapviewer in MIF/MID format,
> > unionized some districts, then exported it to an ESRI-shapefile and
> used
> > it in R. 
> 
> It is at least worth trying. May I suggest reading the MIF/MID file
> directly into R using the readOGR() function in the rgdal package? If
> you
> are a Mac OSX user, there is extra help needed installing rgdal, but on
> Windows it is available for binary install directly from CRAN (thanks to
> Uwe Ligges). The spatial classes used there are more robust, and the
> data
> and polygons can be kept together. Polygons may also be dissolved using
> objects of the SpatialPolygons class.
> 
> Could I suggest that you move any reply to R-sig-geo, given that the 
> details of spatial data formats are not of general interest?
> 
> Roger
> 
> > 
> > I don't have any clue to resolve this...so any hint is very welcome!
> > Katharina
> > 
> > 
> > 
> > **************************
> > Katharina Frosch
> > Rostocker Zentrum
> > Konrad-Zuse-Str. 1
> > 18057 Rostock
> > Tel.: (0381) 2081-148
> > Fax: (0381) 2081-448
> > Mail: frosch at rostockerzentrum.de 
> > 
> >  
> > 
> > 
> > -----Original Message-----
> > From: Roger Bivand [mailto:Roger.Bivand at nhh.no] 
> > Sent: Dienstag, 7. November 2006 13:27
> > To: Frosch, Katharina
> > Cc: r-help at stat.math.ethz.ch
> > Subject: Re: [R] wrong fill colors in polygon-map
> > 
> > On Tue, 7 Nov 2006, Frosch, Katharina wrote:
> > 
> > > Dear all,
> > > 
> > > I would like to produce a map with information about the patenting
> > > activity in German districts, by coloring districts with different
> > > degrees of patenting activity in different colors. I work with the
> > > packages maptools, maps and spdep. The map data is read from an
> > external
> > > .shp file (+ the corresponding .shx and .dbf files). Plotting a map
> > with
> > > the IDs or the patenting indicator itself works fine. But coloring
> the
> > > map leads to completely odd results (wrong colors for most of the
> > > regions). I also tried simpler values (just 0 and 1 for different
> > > regions), same problem. I tried to check whether there is any
> problem
> > > with the match of data and district ids, but everything seemed to be
> > > fine. 
> > > 
> > > Sample code: 
> > > ****************
> > > brks.pat<-quantile(patenting$patbus)
> > > #palette.pat<-c("green", "blue", "grey", "darkgrey", "red")
> > > palette.pat<-c(rep("green", 4), "red")
> > > plot(iab7.poly, col=palette.pat[findInterval(patenting$patbus,
> > > brks.pat)])
> > > legend(1200, -200, fill=palette.pat, legend=round(brks.pat,2),
> > cex=0.6)
> > > title(main="patenting activity in german districts")
> > > 
> > > Data:
> > > ******
> > > Iab7.poly contains the polygons of 343 German districts
> > > patenting$patbus contains the number of corporate patents per
> 100.000
> > > inhabitants for each district
> > 
> > (R-sig-geo may be a more focussed list for this kind of question)
> > 
> > If the polygons in Iab7.poly are in the same order as the rows of
> > patenting, and the number of polygons is the same as the number of
> rows,
> > it is possible that the breakpoints are not quite what you think (if
> for
> > example some of the quantiles are equal, which happens with
> > zero-inflated
> > data). Omitting all.inside=TRUE in findInterval() can also lead to the
> > insertion of NA values into the vector of colours.
> > 
> > Perhaps have a look at the classInt package for some examples of
> > choosing 
> > class intervals i.a. for map display.
> > 
> > Roger
> > 
> > > 
> > > Any ideas would be appreciated!
> > > 
> > > Best regards,
> > > Katharina
> > > 
> > > 
> > > 
> > > ******************************
> > > 
> > > Katharina Frosch
> > > Rostock Center for the Study of Demographic Change
> > > Konrad-Zuse-Str. 1
> > > 18057 Rostock
> > > Tel.: (0381) 2081-148
> > > Fax: (0381) 2081-448
> > > Mail: frosch at rostockerzentrum.de 
> > > 
> > > 
> > > 
> > > 
> > > 
> > > 
> > > ----------
> > > This mail has been sent through the MPI for Demographic
> > Rese...{{dropped}}
> > > 
> > > ______________________________________________
> > > R-help at stat.math.ethz.ch mailing list
> > > https://stat.ethz.ch/mailman/listinfo/r-help
> > > PLEASE do read the posting guide
> > http://www.R-project.org/posting-guide.html
> > > and provide commented, minimal, self-contained, reproducible code.
> > > 
> > 
> > 
> 
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From e58lc at unb.ca  Wed Nov  8 20:40:36 2006
From: e58lc at unb.ca (Wang, Hao)
Date: Wed,  8 Nov 2006 15:40:36 -0400
Subject: [R-sig-Geo] How to get the code of function .spFindCG in package sp?
Message-ID: <1163014836.455232b4298a8@webmail.unb.ca>

Hi,

How to dig out the code of the function of .spFindCG, which is used in the function
Polygon. 

I also wanna to know how to calculate the area of a polygon, and how could I know if
there are intersections of  boundary in a polygon?


Best regards,

Hao



From Roger.Bivand at nhh.no  Wed Nov  8 22:06:35 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 8 Nov 2006 22:06:35 +0100 (CET)
Subject: [R-sig-Geo] How to get the code of function .spFindCG in
 package sp?
In-Reply-To: <1163014836.455232b4298a8@webmail.unb.ca>
Message-ID: <Pine.LNX.4.44.0611082145170.10636-100000@reclus.nhh.no>

On Wed, 8 Nov 2006, Wang, Hao wrote:

> Hi,
> 
> How to dig out the code of the function of .spFindCG, which is used in the function
> Polygon. 

It isn't exported from the sp namespace, so you need to access it within 
the namespace:

sp:::.spFindCG

> 
> I also wanna to know how to calculate the area of a polygon, 

See sp:::.spFindCG and the C source of the function it calls.

> and how could I know if there are intersections of boundary in a
> polygon?

There are no polygon clipping functions in sp. There are some in gpclib 
and PBSmapping; the first of these are used in some wrapper functions 
currently in the sourceforge repository spgpc package, soon to be released 
on CRAN in maptools. Neither of these provide exactly what you need, but 
some of the pieces may be there.

> 
> 
> Best regards,
> 
> Hao
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From reeves at nceas.ucsb.edu  Wed Nov  8 22:12:30 2006
From: reeves at nceas.ucsb.edu (Rick Reeves)
Date: Wed, 08 Nov 2006 13:12:30 -0800
Subject: [R-sig-Geo] How to get the code of function .spFindCG in
 package sp?
In-Reply-To: <1163014836.455232b4298a8@webmail.unb.ca>
References: <1163014836.455232b4298a8@webmail.unb.ca>
Message-ID: <4552483E.2050403@nceas.ucsb.edu>

Hao:

The PBSMapping package has reasonably stratightforward polygon area 
calculations.
In fact, I just assembled a tutorial on this topic on my Web site:

http://nceas.ucsb.edu/scicomp/GISSeminar/UseCases/PointPolyRegionsOfInterest/RPointPolyROIDemo.html

As an aside: here at NCEAS we are active R users and I am working to 
post a series of geospatial data processing
tutorials for our residents. Stay tuned for more as soon as I can 
produce them....

Regards,
Rick Reeves
Scientific Programmer
National Center for Ecological Analysis and Synthesis/ UC Santa Barbara

Wang, Hao wrote:
> Hi,
>
> How to dig out the code of the function of .spFindCG, which is used in the function
> Polygon. 
>
> I also wanna to know how to calculate the area of a polygon, and how could I know if
> there are intersections of  boundary in a polygon?
>
>
> Best regards,
>
> Hao
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>   

-- 
Rick Reeves	
Scientific Programmer / Analyst	
National Center for Ecological Analysis and Synthesis
UC Santa Barbara
reeves at nceas.ucsb.edu
www.nceas.ucsb.edu
805 892 2533

-------------- next part --------------
A non-text attachment was scrubbed...
Name: reeves.vcf
Type: text/x-vcard
Size: 339 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20061108/03cd1bfa/attachment.vcf>

From dina.daresta at dyrecta.com  Thu Nov  9 12:06:33 2006
From: dina.daresta at dyrecta.com (dina.daresta at dyrecta.com)
Date: 9 Nov 2006 12:06:33 +0100
Subject: [R-sig-Geo] =?utf-8?q?R-sig-Geo_Digest=2C_Vol_39=2C_Issue_5?=
Message-ID: <20061109110633.47588.qmail@w414.widhost.net>

Salve
l'indirizzo da lei digitato non ? pi? presente.
Se intende comunicare con la nostra azienda pu? scrivere a info at dyrecta.com



From carlosguerra at esa.ipvc.pt  Fri Nov 10 13:19:42 2006
From: carlosguerra at esa.ipvc.pt (Carlos GUERRA)
Date: Fri, 10 Nov 2006 12:19:42 -0000
Subject: [R-sig-Geo] how to do a principle component analysis with
	geo-referenced points
Message-ID: <!&!AAAAAAAAAAAYAAAAAAAAAJf1NEZJVtRHvdgUBBxUpbbCgAAAEAAAAMBFQ0P62dxKhHvfVE1zHesBAAAAAA==@esa.ipvc.pt>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20061110/cd5a5823/attachment.pl>

From frosch at rostockerzentrum.de  Fri Nov 10 15:37:45 2006
From: frosch at rostockerzentrum.de (Frosch, Katharina)
Date: Fri, 10 Nov 2006 15:37:45 +0100
Subject: [R-sig-Geo] readOGR() - choice of layer in MIF/MID file? -
	solved
Message-ID: <8B08A3A1EA7AAC41BE24C750338754E601753283@HERMES.demogr.mpg.de>

Thanks a lot for your precious help, it worked perfectly. Most probably,
the first errors arose from importing a shapefile where I merged some
counties using MapViewer - perhaps the newly created shapefile was a bit
messy. 

However, I now have the problem that I have to repeat the merging of 100
out of the 440 counties using R. But I'll better put the question 
in a new thread.

Katharina


-----Original Message-----
From: Roger Bivand [mailto:Roger.Bivand at nhh.no] 
Sent: Mittwoch, 8. November 2006 18:05
To: Frosch, Katharina
Cc: r-sig-geo at stat.math.ethz.ch
Subject: Re: readOGR() - choice of layer in MIF/MID file?

On Wed, 8 Nov 2006, Frosch, Katharina wrote:

> Hello all,
> 
> [this is the continuation of a thread originally posted to r-help]
> 
> As recommended by Roger, I installed the rgdal package and went
through
> the description of my MIF/MID files. However, I was not able to load
the
> data using readOGR(), most probably because I did not manage to
> correctly specify the layer. As I am pretty new to spatial data
analysis
> and R, I am still a bit lost. 
> 
> I tried with 
> setwd("E\\Maps\\MIF")
> test<-readOGR("testmif.mif", layer = "layer1")
> 

Could you try:

test<-readOGR("testmif.mif", layer = "testmif")

treating the data source name as the file and the layer as the file name

without extensions?

Roger

> and got the error message "Error in ogrInfo(dsn = dsn, layer = layer:
> Cannot open layer"
> 
> testmif.MIF
> testmif.MID
> containing "points", "polygons" and "regions" and corresponding
> attribute data. 
> (R version 2.4.0 on Windows XP)
> 
> How to find out the correct layer name? The description file of the
> MIF/MID file contains only descriptions of the attributes and
elements,
> but no explicit layer names. 
> 
> Katharina
> 
> ****************************+
> 
> Katharina Frosch
> Rostocker Zentrum
> Konrad-Zuse-Str. 1
> 18057 Rostock
> Tel.: (0381) 2081-148
> Fax: (0381) 2081-448
> Mail: frosch at rostockerzentrum.de 
> 
> 
> 
> 
> -----Original Message-----
> From: Roger Bivand [mailto:Roger.Bivand at nhh.no] 
> Sent: Dienstag, 7. November 2006 20:47
> To: Frosch, Katharina
> Cc: r-help at stat.math.ethz.ch
> Subject: RE: [R] wrong fill colors in polygon-map
> 
> On Tue, 7 Nov 2006, Frosch, Katharina wrote:
> 
> > Dear Roger: Thank you for your help and the hint with the R-sig-geo
> list
> > (next time I'll post directly to it)!
> > 
> > I went again through all points you mentioned: 
> > - polygons and rows of data are in the same order
> > - the number of polygons and data rows is identical
> > - I experimented with different values, and also defined explicit
> > breakpoints without using the quantile (no effect)
> > - then I added all.inside=TRUE in findIntervall (no effect)
> > 
> > However, adding the forcefill=FALSE option to the plot command led
to
> a
> > strange effect: three districts were left blank. Two of these
> districts
> > were districts that are situated around another district (district
> > A=city itself, district B=the countryside around). The third
> problematic
> > district is situated close to the Swiss border and next to a big
lake.
> I
> > deleted the three districts, to see what happens. The problem is
> partly
> > resolved, but new blank districts appear. 
> > 
> > Could this be caused by a corrupted shape file rathern than by R? I
> > loaded the shape-file with the Program Mapviewer in MIF/MID format,
> > unionized some districts, then exported it to an ESRI-shapefile and
> used
> > it in R. 
> 
> It is at least worth trying. May I suggest reading the MIF/MID file
> directly into R using the readOGR() function in the rgdal package? If
> you
> are a Mac OSX user, there is extra help needed installing rgdal, but
on
> Windows it is available for binary install directly from CRAN (thanks
to
> Uwe Ligges). The spatial classes used there are more robust, and the
> data
> and polygons can be kept together. Polygons may also be dissolved
using
> objects of the SpatialPolygons class.
> 
> Could I suggest that you move any reply to R-sig-geo, given that the 
> details of spatial data formats are not of general interest?
> 
> Roger
> 
> > 
> > I don't have any clue to resolve this...so any hint is very welcome!
> > Katharina
> > 
> > 
> > 
> > **************************
> > Katharina Frosch
> > Rostocker Zentrum
> > Konrad-Zuse-Str. 1
> > 18057 Rostock
> > Tel.: (0381) 2081-148
> > Fax: (0381) 2081-448
> > Mail: frosch at rostockerzentrum.de 
> > 
> >  
> > 
> > 
> > -----Original Message-----
> > From: Roger Bivand [mailto:Roger.Bivand at nhh.no] 
> > Sent: Dienstag, 7. November 2006 13:27
> > To: Frosch, Katharina
> > Cc: r-help at stat.math.ethz.ch
> > Subject: Re: [R] wrong fill colors in polygon-map
> > 
> > On Tue, 7 Nov 2006, Frosch, Katharina wrote:
> > 
> > > Dear all,
> > > 
> > > I would like to produce a map with information about the patenting
> > > activity in German districts, by coloring districts with different
> > > degrees of patenting activity in different colors. I work with the
> > > packages maptools, maps and spdep. The map data is read from an
> > external
> > > .shp file (+ the corresponding .shx and .dbf files). Plotting a
map
> > with
> > > the IDs or the patenting indicator itself works fine. But coloring
> the
> > > map leads to completely odd results (wrong colors for most of the
> > > regions). I also tried simpler values (just 0 and 1 for different
> > > regions), same problem. I tried to check whether there is any
> problem
> > > with the match of data and district ids, but everything seemed to
be
> > > fine. 
> > > 
> > > Sample code: 
> > > ****************
> > > brks.pat<-quantile(patenting$patbus)
> > > #palette.pat<-c("green", "blue", "grey", "darkgrey", "red")
> > > palette.pat<-c(rep("green", 4), "red")
> > > plot(iab7.poly, col=palette.pat[findInterval(patenting$patbus,
> > > brks.pat)])
> > > legend(1200, -200, fill=palette.pat, legend=round(brks.pat,2),
> > cex=0.6)
> > > title(main="patenting activity in german districts")
> > > 
> > > Data:
> > > ******
> > > Iab7.poly contains the polygons of 343 German districts
> > > patenting$patbus contains the number of corporate patents per
> 100.000
> > > inhabitants for each district
> > 
> > (R-sig-geo may be a more focussed list for this kind of question)
> > 
> > If the polygons in Iab7.poly are in the same order as the rows of
> > patenting, and the number of polygons is the same as the number of
> rows,
> > it is possible that the breakpoints are not quite what you think (if
> for
> > example some of the quantiles are equal, which happens with
> > zero-inflated
> > data). Omitting all.inside=TRUE in findInterval() can also lead to
the
> > insertion of NA values into the vector of colours.
> > 
> > Perhaps have a look at the classInt package for some examples of
> > choosing 
> > class intervals i.a. for map display.
> > 
> > Roger
> > 
> > > 
> > > Any ideas would be appreciated!
> > > 
> > > Best regards,
> > > Katharina
> > > 
> > > 
> > > 
> > > ******************************
> > > 
> > > Katharina Frosch
> > > Rostock Center for the Study of Demographic Change
> > > Konrad-Zuse-Str. 1
> > > 18057 Rostock
> > > Tel.: (0381) 2081-148
> > > Fax: (0381) 2081-448
> > > Mail: frosch at rostockerzentrum.de 
> > > 
> > > 
> > > 
> > > 
> > > 
> > > 
> > > ----------
> > > This mail has been sent through the MPI for Demographic
> > Rese...{{dropped}}
> > > 
> > > ______________________________________________
> > > R-help at stat.math.ethz.ch mailing list
> > > https://stat.ethz.ch/mailman/listinfo/r-help
> > > PLEASE do read the posting guide
> > http://www.R-project.org/posting-guide.html
> > > and provide commented, minimal, self-contained, reproducible code.
> > > 
> > 
> > 
> 
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


----------
This mail has been sent through the MPI for Demographic Rese...{{dropped}}



From frosch at rostockerzentrum.de  Fri Nov 10 16:13:01 2006
From: frosch at rostockerzentrum.de (Frosch, Katharina)
Date: Fri, 10 Nov 2006 16:13:01 +0100
Subject: [R-sig-Geo] Best way to merge selected regions in a map?
Message-ID: <8B08A3A1EA7AAC41BE24C750338754E601753284@HERMES.demogr.mpg.de>

Dear all, 

I work with a county map of Germany and have to merge 100 out of 440
counties in total. I tried several ways, using unionSpatialPolygons from
the spgpc package and combine union and append commands from the gpclib
package, but did not succeed. What is the best and most "elegant" way to
do the merging? Especially: Which objects do I have to use (+ how to
keep and to retrieve the ID of the counties without mixing it up). 

Either I do not manage to choose the respective two counties to merge,
or the commands do not correspond to the object I saved the two counties
in. I start with a MIF/MID file of Europe, which I load into R and then
save using writePolyShape. 

Any explanation how to proceed in general would be great. If this kind
of question is not very specific and is covered, more or less, in any
manual, I'd appreciate the link as I guess that I am lacking also some
basics (and the documentation . 

Thanks in advance
Katharina





Katharina Frosch
Rostocker Zentrum
Konrad-Zuse-Str. 1
18057 Rostock
Tel.: (0381) 2081-148
Fax: (0381) 2081-448
Mail: frosch at rostockerzentrum.de 


----------
This mail has been sent through the MPI for Demographic Rese...{{dropped}}



From Roger.Bivand at nhh.no  Fri Nov 10 18:04:10 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 10 Nov 2006 18:04:10 +0100 (CET)
Subject: [R-sig-Geo] Best way to merge selected regions in a map?
In-Reply-To: <8B08A3A1EA7AAC41BE24C750338754E601753284@HERMES.demogr.mpg.de>
Message-ID: <Pine.LNX.4.44.0611101757370.12398-100000@reclus.nhh.no>

On Fri, 10 Nov 2006, Frosch, Katharina wrote:

> Dear all, 
> 
> I work with a county map of Germany and have to merge 100 out of 440
> counties in total. I tried several ways, using unionSpatialPolygons from
> the spgpc package and combine union and append commands from the gpclib
> package, but did not succeed. What is the best and most "elegant" way to
> do the merging? Especially: Which objects do I have to use (+ how to
> keep and to retrieve the ID of the counties without mixing it up). 
> 
> Either I do not manage to choose the respective two counties to merge,
> or the commands do not correspond to the object I saved the two counties
> in. I start with a MIF/MID file of Europe, which I load into R and then
> save using writePolyShape. 

Please include some of the commands you have used. In principle 
unionSpatialPolygons() should work, given that the classifying factor has 

length(unique(factor)) < length(factor)

and the boundaries of the polygons are the same. If the boundaries are 
separated, for example by a river, the output Polygons object will be 
joined, but will be represented by two distinct Polygon objects.

So there are two possible reasons for the dissolve not working.

More advice on the arguments to the function will be easier to give if you 
paste the ones you used into your posting.

Roger

> 
> Any explanation how to proceed in general would be great. If this kind
> of question is not very specific and is covered, more or less, in any
> manual, I'd appreciate the link as I guess that I am lacking also some
> basics (and the documentation . 
> 
> Thanks in advance
> Katharina
> 
> 
> 
> 
> 
> Katharina Frosch
> Rostocker Zentrum
> Konrad-Zuse-Str. 1
> 18057 Rostock
> Tel.: (0381) 2081-148
> Fax: (0381) 2081-448
> Mail: frosch at rostockerzentrum.de 
> 
> 
> ----------
> This mail has been sent through the MPI for Demographic Rese...{{dropped}}
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From nikko at hailmail.net  Sat Nov 11 20:06:17 2006
From: nikko at hailmail.net (Nicholas Lewin-Koh)
Date: Sat, 11 Nov 2006 14:06:17 -0500
Subject: [R-sig-Geo] RE: how to do a principle component analysis with
 geo-referenced points
In-Reply-To: <mailman.11.1163242805.28411.r-sig-geo@stat.math.ethz.ch>
References: <mailman.11.1163242805.28411.r-sig-geo@stat.math.ethz.ch>
Message-ID: <1163271977.27398.275577115@webmail.messagingengine.com>

Hi Carlos,
There are a couple of ways to do this, but you have to be a little more
specific
about what your goals/intentions are. I assume you have points p(x1,y1),
...., p(xn,yn), where p
is a vector of observations.

If the goal is interpolation than you have to model the spatial
covariance
of the orthognal factors, and you should look at waekernagel's book.
if your goal is to extract principal components and account for the
variance induced by a spatial
process, a quick and dirty approach is to include polynomials of the xy
coordinates in the data and 
do pca on the augmented matrix. Take a look at

Borcard, D., P. Legendre & P. Drapeau. 1992. Partialling out the spatial
component of ecological variation. Ecology 73: 1045-1055

M?ot, A., P. Legendre & D. Borcard. 1998. Partialling out the spatial
component of ecological variation: questions and propositions in the
linear modeling framework. Environmental and Ecological Statistics 5
(1): 1-27.

Another approach is spatial factor analysis

Christensen, WF, and Amemiya, Y (2001).  "Generalized shifted-factor
analysis method for multivariate geo-referenced data," Mathematical
Geology, 33, 801-824.

Christensen, WF, and Amemiya, Y (2002).  "Latent variable analysis of
multivariate spatial data," Journal of the American Statistical
Association, 97, 302-317

If your question is there R code to do this, I think the ade4 package
can to the spatial variance partitioning,
but for factor analysis, you are on your own.

Nicholas

> Message: 1
> Date: Fri, 10 Nov 2006 12:19:42 -0000
> From: "Carlos GUERRA" <carlosguerra at esa.ipvc.pt>
> Subject: [R-sig-Geo] how to do a principle component analysis with
> 	geo-referenced points
> To: <r-sig-geo at stat.math.ethz.ch>
> Message-ID:
> 	<!&!AAAAAAAAAAAYAAAAAAAAAJf1NEZJVtRHvdgUBBxUpbbCgAAAEAAAAMBFQ0P62dxKhHvfVE1zHesBAAAAAA==@esa.ipvc.pt>
> 	
> Content-Type: text/plain
> 
> Dear friends,
> 
> I wanted to know how to do a principle component analysis (PCA) from
> geo-referenced points.
> 
> I have a list like:
> 
> geo$xy with coordinates,
> 
> and geo$data with the data that I want to do the analysis
> 
> 
is this right?
> 
>  
> 
>  
> 
> +++++++++++++++++++++++++++++++
> 
> Carlos GUERRA
> 
>  
> 
> Instituto Polit?cnico de Viana do Castelo
> 
> Escola Superior Agr?ria de Ponte de Lima
> 
>  
> 
> Mosteiro de Ref?ios do Lima
> 
> 4990-706 Ponte de Lima
> 
> PORTUGAL
> 
>  
> 
> MAIL: carlosguerra at esa.ipvc.pt
> 
> TEL: +351 912 407 109
> 
> +++++++++++++++++++++++++++++++
> 
>  
> 
> 
> 	[[alternative HTML version deleted]]
> 
> 
> 
> ------------------------------



From saldanha.plangeo at gmail.com  Sat Nov 11 21:33:31 2006
From: saldanha.plangeo at gmail.com (Raphael Saldanha)
Date: Sat, 11 Nov 2006 17:33:31 -0300
Subject: [R-sig-Geo] how to do a principle component analysis with
	geo-referenced points
Message-ID: <c85849370611111233o49bc0f40l4f0a8129cd932a1f@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20061111/0884ea4f/attachment.pl>

From nikko at hailmail.net  Sun Nov 12 04:22:44 2006
From: nikko at hailmail.net (Nicholas Lewin-Koh)
Date: Sat, 11 Nov 2006 22:22:44 -0500
Subject: [R-sig-Geo] how to do a principle component analysis with
 geo-referenced points
In-Reply-To: <402FD9096A2EB74AB9FDA1D3302EE35612EACA@ci04.mail2.esa.ipvc.pt>
References: <402FD9096A2EB74AB9FDA1D3302EE35612EACA@ci04.mail2.esa.ipvc.pt>
Message-ID: <1163301764.26351.275593342@webmail.messagingengine.com>

Hi Carlos,
I think that there are tools in the sp package for dealing with grids.
If I am understanding you correctly and you want to do "zoning" of your
region
than you probably are not looking to do pca, but some sort of
clustering.
Marie Jose Fortin had some nice papers on a technique called wombling,
for finding
regions of abrupt ecological change. There are some other techniques for
spatial partitioning,
but I am not sure if they are implemented in R. It has been a long time
since
I worked on ecological problems.

For more information on the spatial tools in R a good place to start is 
 http://cran.r-project.org/src/contrib/Views/Spatial.html
the CRAN task view for spatial statistics, and 
http://cran.r-project.org/src/contrib/Views/Environmetrics.html
has some more pointers.

Hope this helps,

Nicholas
On Sat, 11 Nov 2006 20:24:59 -0000, "Carlos A. Bastos M.Guerra"
<carlosguerra at esa.ipvc.pt> said:
> 
> Dear Nicholas,
> 
> First of all thanks for the references, I think they will help me with my
> current problem. :)
> The thing is that I am used to work with AcrGIS to do the spatial
> analysis, but the statistical methods in ArcGIS are a bit "dummy", namely
> in spatial PCA. I am used to work with R with the ade4 package :) but
> when I heard that I could do spatial analysis with R I ad to try it...but
> its more difficult that it seams (at first)...
> 
> What I did was: (in ArcGIS) convert the centroids of a grid into a point
> shape file, than I have integrated all the information into different
> columns. I converted the dbf file into a txt an then I imported the file
> into R ... and my problems began... :)
> 
> My objective is to do a PCA and extract the different groups of points in
> order to make an ecological zoning.
> 
> I am still starting with R and "the Geo tools" can you point me some
> reading material that I can use?
> 
> Best regards,
> 
> Carlos
> 
> 
> -----Mensagem original-----
> De: Nicholas Lewin-Koh [mailto:nikko at hailmail.net] 
> Enviada: s?bado, 11 de Novembro de 2006 19:06
> Para: r-sig-geo at stat.math.ethz.ch
> Cc: Carlos GUERRA
> Assunto: [R-sig-Geo] RE: how to do a principle component analysis with
> geo-referenced points
> 
> Hi Carlos,
> There are a couple of ways to do this, but you have to be a little more
> specific
> about what your goals/intentions are. I assume you have points p(x1,y1),
> ...., p(xn,yn), where p
> is a vector of observations.
> 
> If the goal is interpolation than you have to model the spatial
> covariance
> of the orthognal factors, and you should look at waekernagel's book.
> if your goal is to extract principal components and account for the
> variance induced by a spatial
> process, a quick and dirty approach is to include polynomials of the xy
> coordinates in the data and 
> do pca on the augmented matrix. Take a look at
> 
> Borcard, D., P. Legendre & P. Drapeau. 1992. Partialling out the spatial
> component of ecological variation. Ecology 73: 1045-1055
> 
> M?ot, A., P. Legendre & D. Borcard. 1998. Partialling out the spatial
> component of ecological variation: questions and propositions in the
> linear modeling framework. Environmental and Ecological Statistics 5
> (1): 1-27.
> 
> Another approach is spatial factor analysis
> 
> Christensen, WF, and Amemiya, Y (2001).  "Generalized shifted-factor
> analysis method for multivariate geo-referenced data," Mathematical
> Geology, 33, 801-824.
> 
> Christensen, WF, and Amemiya, Y (2002).  "Latent variable analysis of
> multivariate spatial data," Journal of the American Statistical
> Association, 97, 302-317
> 
> If your question is there R code to do this, I think the ade4 package
> can to the spatial variance partitioning,
> but for factor analysis, you are on your own.
> 
> Nicholas



From foothillsdemocrats.com at reefcorals.com  Sun Nov 12 16:15:31 2006
From: foothillsdemocrats.com at reefcorals.com (Isaiah Hernandez)
Date: Sun, 12 Nov 2006 15:15:31 +0000
Subject: [R-sig-Geo] Health
Message-ID: <000001c7066d$35f81080$0100007f@localhost>


The incident adage at
the Molly Mansor bullheaded 
and flowed of sparks
the border in ideograms
left corn to curving
deepest in the ferson
floor and ceil to remem

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20061112/5da6a4ca/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/jpeg
Size: 7744 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20061112/5da6a4ca/attachment.jpe>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/gif
Size: 4882 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20061112/5da6a4ca/attachment.gif>

From koen.hufkens at ua.ac.be  Mon Nov 13 10:15:27 2006
From: koen.hufkens at ua.ac.be (Hufkens Koen)
Date: Mon, 13 Nov 2006 10:15:27 +0100
Subject: [R-sig-Geo] how to do a principle component analysis with
	geo-referenced points
In-Reply-To: <1163301764.26351.275593342@webmail.messagingengine.com>
Message-ID: <832A948B92E5754D9062CCF62F9ED89222A3D0@xmail01.ad.ua.ac.be>

Some articles:

>From fields to objects: A review of geographic boundary analysis
http://www.springerlink.com/content/q1kxcfqegmrmjv92/

Integrating Edge Detection and Dynamic Modeling in Quantitative Analyses of Ecological Boundaries
http://www.bioone.org/perlserv/?request=get-abstract&issn=0006-3568&volume=053&issue=08&page=0730

Measuring the abruptness of patchy ecotones - A simulation-based comparison of landscape pattern statistics
http://www.springerlink.com/content/k556v88m62g02462/


Edge effects in fragmented landscapes: a generic model for
delineating area of edge influences (D-AEI)
http://scholar.google.com/url?sa=U&q=http://research.eeescience.utoledo.edu/lees/pubs/zheng2000.pdf

I've got a lot more in my endnote database, I can send you the file if you want to because this copy pasting isn't exactly efficient.

regards,
Koen

--
Koen Hufkens, Phds
Department of Biology
Research Group of Plant and Vegetation Ecology
University of Antwerp
Universiteitsplein 1
B-2610 Wilrijk, Belgium
Koen.Hufkens at ua.ac.be 

> -----Original Message-----
> From: r-sig-geo-bounces at stat.math.ethz.ch 
> [mailto:r-sig-geo-bounces at stat.math.ethz.ch] On Behalf Of 
> Nicholas Lewin-Koh
> Sent: zondag 12 november 2006 4:23
> To: Carlos A. Bastos M.Guerra
> Cc: r-sig-geo at stat.math.ethz.ch
> Subject: Re: [R-sig-Geo] how to do a principle component 
> analysis with geo-referenced points
> 
> Hi Carlos,
> I think that there are tools in the sp package for dealing with grids.
> If I am understanding you correctly and you want to do 
> "zoning" of your region than you probably are not looking to 
> do pca, but some sort of clustering.
> Marie Jose Fortin had some nice papers on a technique called 
> wombling, for finding regions of abrupt ecological change. 
> There are some other techniques for spatial partitioning, but 
> I am not sure if they are implemented in R. It has been a 
> long time since I worked on ecological problems.
> 
> For more information on the spatial tools in R a good place 
> to start is  http://cran.r-project.org/src/contrib/Views/Spatial.html
> the CRAN task view for spatial statistics, and 
> http://cran.r-project.org/src/contrib/Views/Environmetrics.html
> has some more pointers.
> 
> Hope this helps,
> 
> Nicholas
> On Sat, 11 Nov 2006 20:24:59 -0000, "Carlos A. Bastos M.Guerra"
> <carlosguerra at esa.ipvc.pt> said:
> > 
> > Dear Nicholas,
> > 
> > First of all thanks for the references, I think they will 
> help me with 
> > my current problem. :) The thing is that I am used to work 
> with AcrGIS 
> > to do the spatial analysis, but the statistical methods in 
> ArcGIS are 
> > a bit "dummy", namely in spatial PCA. I am used to work with R with 
> > the ade4 package :) but when I heard that I could do 
> spatial analysis 
> > with R I ad to try it...but its more difficult that it seams (at 
> > first)...
> > 
> > What I did was: (in ArcGIS) convert the centroids of a grid into a 
> > point shape file, than I have integrated all the information into 
> > different columns. I converted the dbf file into a txt an then I 
> > imported the file into R ... and my problems began... :)
> > 
> > My objective is to do a PCA and extract the different 
> groups of points 
> > in order to make an ecological zoning.
> > 
> > I am still starting with R and "the Geo tools" can you 
> point me some 
> > reading material that I can use?
> > 
> > Best regards,
> > 
> > Carlos
> > 
> > 
> > -----Mensagem original-----
> > De: Nicholas Lewin-Koh [mailto:nikko at hailmail.net]
> > Enviada: s?bado, 11 de Novembro de 2006 19:06
> > Para: r-sig-geo at stat.math.ethz.ch
> > Cc: Carlos GUERRA
> > Assunto: [R-sig-Geo] RE: how to do a principle component 
> analysis with 
> > geo-referenced points
> > 
> > Hi Carlos,
> > There are a couple of ways to do this, but you have to be a little 
> > more specific about what your goals/intentions are. I 
> assume you have 
> > points p(x1,y1), ...., p(xn,yn), where p is a vector of 
> observations.
> > 
> > If the goal is interpolation than you have to model the spatial 
> > covariance of the orthognal factors, and you should look at 
> > waekernagel's book.
> > if your goal is to extract principal components and account for the 
> > variance induced by a spatial process, a quick and dirty 
> approach is 
> > to include polynomials of the xy coordinates in the data 
> and do pca on 
> > the augmented matrix. Take a look at
> > 
> > Borcard, D., P. Legendre & P. Drapeau. 1992. Partialling out the 
> > spatial component of ecological variation. Ecology 73: 1045-1055
> > 
> > M?ot, A., P. Legendre & D. Borcard. 1998. Partialling out 
> the spatial 
> > component of ecological variation: questions and 
> propositions in the 
> > linear modeling framework. Environmental and Ecological Statistics 5
> > (1): 1-27.
> > 
> > Another approach is spatial factor analysis
> > 
> > Christensen, WF, and Amemiya, Y (2001).  "Generalized 
> shifted-factor 
> > analysis method for multivariate geo-referenced data," Mathematical 
> > Geology, 33, 801-824.
> > 
> > Christensen, WF, and Amemiya, Y (2002).  "Latent variable 
> analysis of 
> > multivariate spatial data," Journal of the American Statistical 
> > Association, 97, 302-317
> > 
> > If your question is there R code to do this, I think the 
> ade4 package 
> > can to the spatial variance partitioning, but for factor 
> analysis, you 
> > are on your own.
> > 
> > Nicholas
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



From saldanha.plangeo at gmail.com  Mon Nov 13 18:58:18 2006
From: saldanha.plangeo at gmail.com (Raphael Saldanha)
Date: Mon, 13 Nov 2006 14:58:18 -0300
Subject: [R-sig-Geo] GWR SDF
Message-ID: <c85849370611130958t10256eb8m4b63b487da8e8d1b@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20061113/37d79cd2/attachment.pl>

From Roger.Bivand at nhh.no  Mon Nov 13 19:14:53 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 13 Nov 2006 19:14:53 +0100 (CET)
Subject: [R-sig-Geo] GWR SDF
In-Reply-To: <c85849370611130958t10256eb8m4b63b487da8e8d1b@mail.gmail.com>
Message-ID: <Pine.LNX.4.44.0611131907510.12037-100000@reclus.nhh.no>

On Mon, 13 Nov 2006, Raphael Saldanha wrote:

> Help!
> 
> In the SDF results, what exactly means these fields:
> 
> sum_w
> X.Intercept
> V04
> V05
> X1
> X2
> X3

The spgwr package is not really intended to help people use GWR, which is
not generally accepted as a technique of analysis (because it forces
coefficients to co-vary), though it can be used for exploration. It is
rather a toolbox for examining the method. For this reason, not much
effort has been put into things like names. You would have to say what all 
the names are in this case:

names(res.adpt$SDF)

The v04, V05 look odd, but without seeing all the names, it is difficult 
to tell. The X1-X3 are probably three of the local standard errors. s_w is 
the sum of weights at that point, and X.Intercept is the local intercept 
estimate.

What happens when you run a regular regression? Do any of the coefficients 
disappear (any collinear variables)?

Roger

> 
> I'm using this code:
> 
> > x <- readShapePoly("domicilio_3136702.shp", IDvar = "ID_")
> > x.adapt.gauss <- gwr.sel(V03 ~ V06 + V07 + V08, data=x, adapt=TRUE)
> > res.adpt <- gwr(V03 ~ V06 + V07 + V08, data=x, adapt= x.adapt.gauss,
> hatmatrix = TRUE)
> 
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From saldanha.plangeo at gmail.com  Mon Nov 13 19:16:00 2006
From: saldanha.plangeo at gmail.com (Raphael Saldanha)
Date: Mon, 13 Nov 2006 15:16:00 -0300
Subject: [R-sig-Geo] GWR SDF 2
Message-ID: <c85849370611131016g6aab1e4o933bf5e460bc4fcb@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20061113/86031b0b/attachment.pl>

From Roger.Bivand at nhh.no  Mon Nov 13 19:32:07 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 13 Nov 2006 19:32:07 +0100 (CET)
Subject: [R-sig-Geo] GWR SDF 2
In-Reply-To: <c85849370611131016g6aab1e4o933bf5e460bc4fcb@mail.gmail.com>
Message-ID: <Pine.LNX.4.44.0611131931280.12037-100000@reclus.nhh.no>

On Mon, 13 Nov 2006, Raphael Saldanha wrote:

> The best way to export the results to a shapefile is:
> 
> writePolyShape(res.adpt$SDF, "nameshape")

Yes, it should work, unless there are questions about the values output by 
gwr().

Roger

> 
> Is not?
> 
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From saldanha.plangeo at gmail.com  Mon Nov 13 19:36:58 2006
From: saldanha.plangeo at gmail.com (Raphael Saldanha)
Date: Mon, 13 Nov 2006 15:36:58 -0300
Subject: [R-sig-Geo] GWR SDF
In-Reply-To: <Pine.LNX.4.44.0611131907510.12037-100000@reclus.nhh.no>
References: <c85849370611130958t10256eb8m4b63b487da8e8d1b@mail.gmail.com>
	<Pine.LNX.4.44.0611131907510.12037-100000@reclus.nhh.no>
Message-ID: <c85849370611131036h7e88c47cr1d916292d5895a39@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20061113/40a5b60b/attachment.pl>

From Roger.Bivand at nhh.no  Mon Nov 13 19:40:16 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 13 Nov 2006 19:40:16 +0100 (CET)
Subject: [R-sig-Geo] GWR SDF
In-Reply-To: <c85849370611131036h7e88c47cr1d916292d5895a39@mail.gmail.com>
Message-ID: <Pine.LNX.4.44.0611131937430.12037-100000@reclus.nhh.no>

On Mon, 13 Nov 2006, Raphael Saldanha wrote:

> Thanks Roger! I'm just making some tests with the method
> 
> Take a look below, this is what I have.
> 
> > summary(lm(V03 ~ V04 + V05, as.data.frame(x)))
> 
> Call:
> lm(formula = V03 ~ V04 + V05, data = as.data.frame(x))
> 
> Residuals:
>     Min      1Q  Median      3Q     Max
>  -5.909  -3.855   -3.380  -2.694 185.091
> 
> Coefficients:
>             Estimate Std. Error t value Pr(>|t|)
> (Intercept)   5.9086     1.9982   2.957  0.00324 **
> V04           0.8069     0.3342   2.415  0.01607 *
> V05           0.1833     0.3356   0.546  0.58524
> ---
> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
> 
> Residual standard error: 16.84 on 558 degrees of freedom
> Multiple R-Squared: 0.965,      Adjusted R-squared: 0.9649
> F-statistic:  7701 on 2 and 558 DF,  p-value: < 0.00000000000000022
> 
> > res.adpt
> Call:
> gwr(formula = V03 ~ V04 + V05, data = x, adapt = x.adapt.gauss,
>     hatmatrix = TRUE)
> Kernel function: gwr.gauss
> Adaptive quantile: 0.1087359 (about 61 of 561)
> Summary of GWR coefficient estimates:
>                  Min.  1st Qu.   Median  3rd Qu.     Max. Global OLS
> X.Intercept. -16.0400   0.7464   2.7780   7.1090   42.5200     5.9086
> V04           -0.5183   0.6884   0.8273   1.4080   3.7480     0.8069
> V05           -2.6950  -0.4328   0.1553   0.2978   1.4020     0.1833
> Number of data points: 561
> Effective number of parameters: 37.25909
> Effective degrees of freedom: 523.7409
> Sigma squared (ML): 240.1169
> AICc (GWR p. 61, eq 2.33; p. 96, eq. 4.21): 4723.854
> AIC (GWR p. 96, eq. 4.22): 4692.986
> Residual sum of squares: 134705.6
> 
> > names(res.adpt$SDF)
>  [1] "sum.w"        "X.Intercept." "V04"          "V05"          "gwr.R2"
> "X1"           "X2"           "X3"
>  [9] "coord.x"      "coord.y"

In order: sum of weights, three local coefficient estimates, the local 
R-square, three local coefficient standard errors, and the data point 
coordinates. I was puzzled that you said you included V06, V07, V08, but 
got names V04, V05, but understand that that was just an example.

> 
> 
> On 11/13/06, Roger Bivand <Roger.Bivand at nhh.no> wrote:
> >
> > On Mon, 13 Nov 2006, Raphael Saldanha wrote:
> >
> > > Help!
> > >
> > > In the SDF results, what exactly means these fields:
> > >
> > > sum_w
> > > X.Intercept
> > > V04
> > > V05
> > > X1
> > > X2
> > > X3
> >
> > The spgwr package is not really intended to help people use GWR, which is
> > not generally accepted as a technique of analysis (because it forces
> > coefficients to co-vary), though it can be used for exploration. It is
> > rather a toolbox for examining the method. For this reason, not much
> > effort has been put into things like names. You would have to say what all
> >
> > the names are in this case:
> >
> > names(res.adpt$SDF)
> >
> > The v04, V05 look odd, but without seeing all the names, it is difficult
> > to tell. The X1-X3 are probably three of the local standard errors. s_w is
> > the sum of weights at that point, and X.Intercept is the local intercept
> > estimate.
> >
> > What happens when you run a regular regression? Do any of the coefficients
> > disappear (any collinear variables)?
> >
> > Roger
> >
> > >
> > > I'm using this code:
> > >
> > > > x <- readShapePoly("domicilio_3136702.shp", IDvar = "ID_")
> > > > x.adapt.gauss <- gwr.sel(V03 ~ V06 + V07 + V08, data=x, adapt=TRUE)
> > > > res.adpt <- gwr(V03 ~ V06 + V07 + V08, data=x, adapt= x.adapt.gauss,
> > > hatmatrix = TRUE)
> > >
> > >
> >
> > --
> > Roger Bivand
> > Economic Geography Section, Department of Economics, Norwegian School of
> > Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> > Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> > e-mail: Roger.Bivand at nhh.no
> >
> >
> 
> 
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From frosch at rostockerzentrum.de  Tue Nov 14 14:10:28 2006
From: frosch at rostockerzentrum.de (Frosch, Katharina)
Date: Tue, 14 Nov 2006 14:10:28 +0100
Subject: [R-sig-Geo] Best way to merge selected regions in a map?
References: <Pine.LNX.4.44.0611101757370.12398-100000@reclus.nhh.no>
Message-ID: <8B08A3A1EA7AAC41BE24C750338754E6019C4AFB@HERMES.demogr.mpg.de>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20061114/3291f410/attachment.pl>

From massimodisasha at yahoo.it  Tue Nov 14 18:41:54 2006
From: massimodisasha at yahoo.it (massimodisasha)
Date: Tue, 14 Nov 2006 18:41:54 +0100
Subject: [R-sig-Geo] problem with R in a bash script
Message-ID: <31603868-557B-4BDB-8A56-8AD8ECBB84A0@yahoo.it>

Hi,
i'm tryng to write a script to use
  R - Grass.


i've found this tutorial :

if i execute the line directly in a bash shell it give me not problem,
but if i try to use the same code in a bash script, i've an error  
message.

"with this code there aren't problem":

The code :

======================================================
#
# this  line to GRASS
#

er_wind_size=9
wind_size=15
r.neighbors in=elev_meters out=avg size=$er_wind_size method=average
r.neighbors in=elev_meters out=min size=$er_wind_size method=minimum
r.neighbors in=elev_meters out=max size=$er_wind_size method=maximum
r.mapcalc "er = (avg - min)/(max - min) "
r.param.scale in=elev_meters size=$wind_size param=slope out=slope
r.param.scale in=elev_meters size=$wind_size param=profc out=profc
r.param.scale in=elev_meters size=$wind_size param=crosc out=crosc
r.param.scale in=elev_meters size=$wind_size param=minic out=minic
r.param.scale in=elev_meters size=$wind_size param=maxic out=maxic
r.param.scale in=elev_meters size=$wind_size param=longc out=longc

#
#This lines to R
#

require(spgrass6)
require(cluster)
gmeta6 <- gmeta6()
x <- readFLOAT6sp(c 
("er","crosc","longc","slope","profc","minic","maxic"))
morph <- data.frame(cbind(x$er, x$crosc, x$longc, x$slope, x$profc, x 
$minic, x$maxic))
morph <- data.frame(cbind(x$er, x$crosc, x$longc, x$slope/max(x 
$slope), x$profc, x$minic, x$maxic))
names(morph) <- c 
("er","crosc","longc","slope_n","profc","minic","maxic")
morph.clara <- clara(morph, k=5, stand=F)
x$morph_class <- morph.clara$clustering
rast.put6(x,"morph", zcol="morph_class")
===================================================

after this,...
  i quit R and see the result in Grass

it's all OK !


but if itry to have the same result with a "bash script"
like this :

========================================
echo "enter elevation data"
read elevation
er_wind_size=9
wind_size=15
g.region rast=$elevation -ap
r.neighbors in=$elevation out=avg size=$er_wind_size method=average
r.neighbors in=$elevation out=min size=$er_wind_size method=minimum
r.neighbors in=$elevation out=max size=$er_wind_size method=maximum
r.mapcalc "er = (avg - min)/(max - min) "
r.param.scale in=$elevation size=$wind_size param=slope out=slope
r.param.scale in=$elevation size=$wind_size param=profc out=profc
r.param.scale in=$elevation size=$wind_size param=crosc out=crosc
r.param.scale in=$elevation size=$wind_size param=minic out=minic
r.param.scale in=$elevation size=$wind_size param=maxic out=maxic
r.param.scale in=$elevation size=$wind_size param=longc out=longc
echo "
require(spgrass6)
require(cluster)
gmeta6 <- gmeta6()
x <- readFLOAT6sp(c 
("er","crosc","longc","slope","profc","minic","maxic"))
morph <- data.frame(cbind(x$er, x$crosc, x$longc, x$slope, x$profc, x 
$minic, x$maxic))
names(morph) <- c 
("er","crosc","longc","slope_n","profc","minic","maxic")
morph.clara <- clara(morph, k=5, stand=F)
x$morph_class <- morph.clara$clustering
rast.put6(x,"morph", zcol="morph_class")
" > R_temp
echo 'source("R_temp")' | R --vanilla --slave
g.region rast=morph -ap
d.mon x0 ; d.rast morph


========================

the execution of this script give me this error :

GRASS 6.2.0RC3 (remote):~ > ./morfo.sh
enter elevation data
dtm_20m

Percent complete ...  100%
Percent complete ...  100%
Percent complete ...  100%
100%
100%
100%
100%
100%
100%
100%
Carico il pacchetto richiesto: spgrass6
Carico il pacchetto richiesto: sp
Carico il pacchetto richiesto: maptools
Carico il pacchetto richiesto: foreign
Carico il pacchetto richiesto: rgdal
Geospatial Data Abstraction Library extensions to R successfully loaded
Carico il pacchetto richiesto: cluster
Errore in seq(along = vname) : oggetto "er" non trovato
Esecuzione interrotta
============================================

have you any suggestions about this ?

regards..
Massimo.



From Roger.Bivand at nhh.no  Tue Nov 14 19:06:37 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 14 Nov 2006 19:06:37 +0100 (CET)
Subject: [R-sig-Geo] problem with R in a bash script
In-Reply-To: <31603868-557B-4BDB-8A56-8AD8ECBB84A0@yahoo.it>
Message-ID: <Pine.LNX.4.44.0611141902060.16539-100000@reclus.nhh.no>

On Tue, 14 Nov 2006, massimodisasha wrote:

> Hi,
> i'm tryng to write a script to use
>   R - Grass.
> 
> 
> i've found this tutorial :
> 
> if i execute the line directly in a bash shell it give me not problem,
> but if i try to use the same code in a bash script, i've an error  
> message.
> 
> "with this code there aren't problem":
> 
> The code :
> 
> ======================================================
> #
> # this  line to GRASS
> #
> 
> er_wind_size=9
> wind_size=15
> r.neighbors in=elev_meters out=avg size=$er_wind_size method=average
> r.neighbors in=elev_meters out=min size=$er_wind_size method=minimum
> r.neighbors in=elev_meters out=max size=$er_wind_size method=maximum
> r.mapcalc "er = (avg - min)/(max - min) "
> r.param.scale in=elev_meters size=$wind_size param=slope out=slope
> r.param.scale in=elev_meters size=$wind_size param=profc out=profc
> r.param.scale in=elev_meters size=$wind_size param=crosc out=crosc
> r.param.scale in=elev_meters size=$wind_size param=minic out=minic
> r.param.scale in=elev_meters size=$wind_size param=maxic out=maxic
> r.param.scale in=elev_meters size=$wind_size param=longc out=longc
> 
> #
> #This lines to R
> #
> 
> require(spgrass6)
> require(cluster)
> gmeta6 <- gmeta6()
> x <- readFLOAT6sp(c 
> ("er","crosc","longc","slope","profc","minic","maxic"))
> morph <- data.frame(cbind(x$er, x$crosc, x$longc, x$slope, x$profc, x 
> $minic, x$maxic))
> morph <- data.frame(cbind(x$er, x$crosc, x$longc, x$slope/max(x 
> $slope), x$profc, x$minic, x$maxic))
> names(morph) <- c 
> ("er","crosc","longc","slope_n","profc","minic","maxic")
> morph.clara <- clara(morph, k=5, stand=F)
> x$morph_class <- morph.clara$clustering
> rast.put6(x,"morph", zcol="morph_class")
> ===================================================
> 
> after this,...
>   i quit R and see the result in Grass
> 
> it's all OK !
> 
> 
> but if itry to have the same result with a "bash script"
> like this :
> 
> ========================================
> echo "enter elevation data"
> read elevation
> er_wind_size=9
> wind_size=15
> g.region rast=$elevation -ap
> r.neighbors in=$elevation out=avg size=$er_wind_size method=average
> r.neighbors in=$elevation out=min size=$er_wind_size method=minimum
> r.neighbors in=$elevation out=max size=$er_wind_size method=maximum
> r.mapcalc "er = (avg - min)/(max - min) "
> r.param.scale in=$elevation size=$wind_size param=slope out=slope
> r.param.scale in=$elevation size=$wind_size param=profc out=profc
> r.param.scale in=$elevation size=$wind_size param=crosc out=crosc
> r.param.scale in=$elevation size=$wind_size param=minic out=minic
> r.param.scale in=$elevation size=$wind_size param=maxic out=maxic
> r.param.scale in=$elevation size=$wind_size param=longc out=longc
> echo "
> require(spgrass6)
> require(cluster)
> gmeta6 <- gmeta6()
> x <- readFLOAT6sp(c 
> ("er","crosc","longc","slope","profc","minic","maxic"))
> morph <- data.frame(cbind(x$er, x$crosc, x$longc, x$slope, x$profc, x 
> $minic, x$maxic))
> names(morph) <- c 
> ("er","crosc","longc","slope_n","profc","minic","maxic")
> morph.clara <- clara(morph, k=5, stand=F)
> x$morph_class <- morph.clara$clustering
> rast.put6(x,"morph", zcol="morph_class")
> " > R_temp
> echo 'source("R_temp")' | R --vanilla --slave
> g.region rast=morph -ap
> d.mon x0 ; d.rast morph
> 
> 
> ========================
> 
> the execution of this script give me this error :
> 
> GRASS 6.2.0RC3 (remote):~ > ./morfo.sh
> enter elevation data
> dtm_20m
> 
> Percent complete ...  100%
> Percent complete ...  100%
> Percent complete ...  100%
> 100%
> 100%
> 100%
> 100%
> 100%
> 100%
> 100%
> Carico il pacchetto richiesto: spgrass6
> Carico il pacchetto richiesto: sp
> Carico il pacchetto richiesto: maptools
> Carico il pacchetto richiesto: foreign
> Carico il pacchetto richiesto: rgdal
> Geospatial Data Abstraction Library extensions to R successfully loaded
> Carico il pacchetto richiesto: cluster
> Errore in seq(along = vname) : oggetto "er" non trovato
                                         ^^^^
echo "" is stripping out the internal ", so R get (er, ...
and there is no object "er". Look at R_temp - you'll see that the quotes 
are absent. Maybe say echo '':

$ echo "something"er"something else"
somethingersomething else
$ echo 'something"er"something else'
something"er"something else

since I don't see any single quotes in there.

Roger


> Esecuzione interrotta
> ============================================
> 
> have you any suggestions about this ?
> 
> regards..
> Massimo.
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From lponti at infinito.it  Wed Nov 15 01:50:51 2006
From: lponti at infinito.it (Luigi Ponti)
Date: Tue, 14 Nov 2006 16:50:51 -0800
Subject: [R-sig-Geo] Using R with cygwin/GRASS
Message-ID: <455A646B.4060500@infinito.it>

Hello,

I have looked at archives on the topic, but was not able to figure out 
if it is possible to access the GRASS/R interface when using cygwin/GRASS.

It would be nice if anybody could point me to relevant resources.

Regards,

Luigi



From Roger.Bivand at nhh.no  Wed Nov 15 08:27:23 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 15 Nov 2006 08:27:23 +0100 (CET)
Subject: [R-sig-Geo] Using R with cygwin/GRASS
In-Reply-To: <455A646B.4060500@infinito.it>
Message-ID: <Pine.LNX.4.44.0611150822010.17144-100000@reclus.nhh.no>

On Tue, 14 Nov 2006, Luigi Ponti wrote:

> Hello,
> 
> I have looked at archives on the topic, but was not able to figure out 
> if it is possible to access the GRASS/R interface when using cygwin/GRASS.

Both GRASS 5 R package "GRASS" and GRASS 6 R package "spgrass6" work with 
cygwin. They work slightly differently, with "spgrass6" working just like 
Mac OSX/Linux/Unix - start the R text console inside GRASS from the text 
console prompt - start GRASS as $ grass -text, then start R as Rterm (the 
non-GUI front end). Rterm may need its full path to start. 

If the R packages are installed in an extra library (outside the install
tree), you may also need .libPaths() to add that directory to R's search
path for libraries once R is running.

Roger

> 
> It would be nice if anybody could point me to relevant resources.
> 
> Regards,
> 
> Luigi
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From marco.helbich at gmx.at  Wed Nov 15 16:17:51 2006
From: marco.helbich at gmx.at (Marco Helbich)
Date: Wed, 15 Nov 2006 16:17:51 +0100
Subject: [R-sig-Geo] typing error shuts down R under GRASS
Message-ID: <000801c708c9$37ab9970$0300a8c0@mirk>

Dear list members,

a few days ago I've installed the GRASS6.1 (cygwin) and R (2.4.0) interface 
package. everything works (nearly) perfect... but everytime i make a typing 
error or use a wrong command in R, it "shuts down" with the error message 
"execution stopped" and i'm back in the grass command line mode?!?! Has 
anybody a solution?

best regards
Marco
______________________________

Marco Helbich
ISR
Postgasse 7/4/2
A-1010, Vienna
Tel.: +43 (0) 699 11 71 44 02
mail (a): marco.helbich at univie.ac.at
mail (b): marco.helbich at gmx.at



From Roger.Bivand at nhh.no  Wed Nov 15 20:38:38 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 15 Nov 2006 20:38:38 +0100 (CET)
Subject: [R-sig-Geo] typing error shuts down R under GRASS
In-Reply-To: <000801c708c9$37ab9970$0300a8c0@mirk>
Message-ID: <Pine.LNX.4.44.0611152030440.17215-100000@reclus.nhh.no>

On Wed, 15 Nov 2006, Marco Helbich wrote:

> Dear list members,
> 
> a few days ago I've installed the GRASS6.1 (cygwin) and R (2.4.0) interface 
> package. everything works (nearly) perfect... but everytime i make a typing 
> error or use a wrong command in R, it "shuts down" with the error message 
> "execution stopped" and i'm back in the grass command line mode?!?! Has 
> anybody a solution?

I cannot reproduce this problem with Rterm, R 2.4.0, GRASS 6.1, cygwin. 
Please be more specific, your report could be caused by almost anything, 
and doesn't include any necessary contextual information.

> 
> best regards
> Marco
> ______________________________
> 
> Marco Helbich
> ISR
> Postgasse 7/4/2
> A-1010, Vienna
> Tel.: +43 (0) 699 11 71 44 02
> mail (a): marco.helbich at univie.ac.at
> mail (b): marco.helbich at gmx.at
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From dgoliche at sclc.ecosur.mx  Thu Nov 16 01:13:08 2006
From: dgoliche at sclc.ecosur.mx (Duncan Golicher)
Date: Wed, 15 Nov 2006 18:13:08 -0600
Subject: [R-sig-Geo] spTransform problem
Message-ID: <455BAD14.4030307@sclc.ecosur.mx>

Can anyone tell me what I am doing wrong when using spTransform?
I need to transform points in Southern Mexico from UTM NAD27 to Long Lat 
WGS84.

Three small functions.

NAD27_WGS84ll<-function(points){
coordinates(points)<-~x+y
points at proj4string<-CRS("+proj=utm +zone=15 +ellps=clrk66 +datum=NAD27 
+units=m")
spTransform(points, CRS("+proj=longlat +datum=WGS84"))}

NAD27_NAD27ll<-function(points){
coordinates(points)<-~x+y
points at proj4string<-CRS("+proj=utm +zone=15 +datum=NAD27 +units=m")
spTransform(points, CRS("+proj=longlat +datum=NAD27"))}

NAD27_WGS84<-function(points){
coordinates(points)<-~x+y
points at proj4string<-CRS("+proj=utm +zone=15 +datum=NAD27 +units=m")
spTransform(points, CRS("+proj=utm +zone=15 +datum=WGS84 +units=m"))}

When I test them I get strange results.

x<-c(541987,541970)
y<-c(1846598,1846799)

points<-data.frame(x,y)

NAD27_WGS84ll(points)

SpatialPoints:
             x        y
[1,] -92.60617 16.70272
[2,] -92.60633 16.70454
Coordinate Reference System (CRS) arguments:  +proj=longlat +datum=WGS84 
+ellps=WGS84 +towgs84=0,0,0

NAD27_NAD27ll(points)

SpatialPoints:
             x        y
[1,] -92.60617 16.70272
[2,] -92.60633 16.70454
Coordinate Reference System (CRS) arguments:  +proj=longlat +datum=NAD27 
+ellps=clrk66 +nadgrids=@conus, at alaska, at ntv2_0.gsb, at ntv1_can.dat

The results are the same, even though one function involves a datum 
shift and the other doesn't.

The difference between NAD27 and WGS84 in Southern Mexico should be 
around 200m N and 20m E. But I get

points-as.data.frame(NAD27_WGS84(points))

          x         y
1 0.5857494 -112.2658
2 0.5855395 -112.2768


Thanks for any advice.

Duncan Golicher
-- 

Dr Duncan Golicher
Ecologia y Sistematica Terrestre
Conservaci?n de la Biodiversidad
El Colegio de la Frontera Sur
San Cristobal de Las Casas, 
Chiapas, Mexico

Email: dgoliche at sclc.ecosur.mx 

Tel: 967 674 9000 ext 1310
Fax: 967 678 2322

United Kingdom Skypein; 020 7870 6251
Skype name: duncangolicher



From Roger.Bivand at nhh.no  Thu Nov 16 09:26:00 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 16 Nov 2006 09:26:00 +0100 (CET)
Subject: [R-sig-Geo] spTransform problem
In-Reply-To: <455BAD14.4030307@sclc.ecosur.mx>
Message-ID: <Pine.LNX.4.44.0611160910050.17859-100000@reclus.nhh.no>

On Wed, 15 Nov 2006, Duncan Golicher wrote:

> Can anyone tell me what I am doing wrong when using spTransform?
> I need to transform points in Southern Mexico from UTM NAD27 to Long Lat 
> WGS84.

Because spTransform uses PROJ.4, this is a PROJ.4 problem. I wonder 
whether PROJ.4 provides NAD grids for Southern Mexico, or whether you will 
rather need to find the +towgs= arguments directly? If PROJ.4 doesn't 
provide the NAD transformation for your location, I'd search. Without 
knowing if it helps, this looks relevant:

http://article.gmane.org/gmane.comp.gis.proj-4.devel/1582/match=mexico

with +towgs84=-12,130,190. I don't think just putting +datum=NAD27 will 
work, as you've found. Is there a Grids&Datums for Mexico (can't see one 
on: http://www.asprs.org/resources/grids/)? 

Roger

> 
> Three small functions.
> 
> NAD27_WGS84ll<-function(points){
> coordinates(points)<-~x+y
> points at proj4string<-CRS("+proj=utm +zone=15 +ellps=clrk66 +datum=NAD27 
> +units=m")
> spTransform(points, CRS("+proj=longlat +datum=WGS84"))}
> 
> NAD27_NAD27ll<-function(points){
> coordinates(points)<-~x+y
> points at proj4string<-CRS("+proj=utm +zone=15 +datum=NAD27 +units=m")
> spTransform(points, CRS("+proj=longlat +datum=NAD27"))}
> 
> NAD27_WGS84<-function(points){
> coordinates(points)<-~x+y
> points at proj4string<-CRS("+proj=utm +zone=15 +datum=NAD27 +units=m")
> spTransform(points, CRS("+proj=utm +zone=15 +datum=WGS84 +units=m"))}
> 
> When I test them I get strange results.
> 
> x<-c(541987,541970)
> y<-c(1846598,1846799)
> 
> points<-data.frame(x,y)
> 
> NAD27_WGS84ll(points)
> 
> SpatialPoints:
>              x        y
> [1,] -92.60617 16.70272
> [2,] -92.60633 16.70454
> Coordinate Reference System (CRS) arguments:  +proj=longlat +datum=WGS84 
> +ellps=WGS84 +towgs84=0,0,0
> 
> NAD27_NAD27ll(points)
> 
> SpatialPoints:
>              x        y
> [1,] -92.60617 16.70272
> [2,] -92.60633 16.70454
> Coordinate Reference System (CRS) arguments:  +proj=longlat +datum=NAD27 
> +ellps=clrk66 +nadgrids=@conus, at alaska, at ntv2_0.gsb, at ntv1_can.dat
> 
> The results are the same, even though one function involves a datum 
> shift and the other doesn't.
> 
> The difference between NAD27 and WGS84 in Southern Mexico should be 
> around 200m N and 20m E. But I get
> 
> points-as.data.frame(NAD27_WGS84(points))
> 
>           x         y
> 1 0.5857494 -112.2658
> 2 0.5855395 -112.2768
> 
> 
> Thanks for any advice.
> 
> Duncan Golicher
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From Roger.Bivand at nhh.no  Thu Nov 16 09:48:40 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 16 Nov 2006 09:48:40 +0100 (CET)
Subject: [R-sig-Geo] spTransform problem
In-Reply-To: <Pine.LNX.4.44.0611160910050.17859-100000@reclus.nhh.no>
Message-ID: <Pine.LNX.4.44.0611160944130.17859-100000@reclus.nhh.no>

On Thu, 16 Nov 2006, Roger Bivand wrote:

> On Wed, 15 Nov 2006, Duncan Golicher wrote:
> 
> > Can anyone tell me what I am doing wrong when using spTransform?
> > I need to transform points in Southern Mexico from UTM NAD27 to Long Lat 
> > WGS84.
> 
> Because spTransform uses PROJ.4, this is a PROJ.4 problem. I wonder 
> whether PROJ.4 provides NAD grids for Southern Mexico, or whether you will 
> rather need to find the +towgs= arguments directly? If PROJ.4 doesn't 
> provide the NAD transformation for your location, I'd search. Without 
> knowing if it helps, this looks relevant:
> 
> http://article.gmane.org/gmane.comp.gis.proj-4.devel/1582/match=mexico
> 
> with +towgs84=-12,130,190. I don't think just putting +datum=NAD27 will 
> work, as you've found. Is there a Grids&Datums for Mexico (can't see one 
> on: http://www.asprs.org/resources/grids/)? 

So far:

pts <- SpatialPoints(cbind(c(541987,541970), c(1846598,1846799)), 
 proj4string=CRS(
 "+proj=utm +zone=15 +ellps=clrk66 +towgs84=-12,130,190"))
coordinates(pts) - coordinates(spTransform(pts, CRS(
 "+proj=utm +zone=15 +datum=WGS84")))

gives:

     coords.x1 coords.x2
[1,]  18.65260 -200.7308
[2,]  18.65267 -200.7314

which is near your ballpark 20m E  and 200m N (well, it's -200m, but the 
absolute number agrees). I find that is very often necessary to search 
extensively to find relevant +towgs= arguments.

Roger


> 
> Roger
> 
> > 
> > Three small functions.
> > 
> > NAD27_WGS84ll<-function(points){
> > coordinates(points)<-~x+y
> > points at proj4string<-CRS("+proj=utm +zone=15 +ellps=clrk66 +datum=NAD27 
> > +units=m")
> > spTransform(points, CRS("+proj=longlat +datum=WGS84"))}
> > 
> > NAD27_NAD27ll<-function(points){
> > coordinates(points)<-~x+y
> > points at proj4string<-CRS("+proj=utm +zone=15 +datum=NAD27 +units=m")
> > spTransform(points, CRS("+proj=longlat +datum=NAD27"))}
> > 
> > NAD27_WGS84<-function(points){
> > coordinates(points)<-~x+y
> > points at proj4string<-CRS("+proj=utm +zone=15 +datum=NAD27 +units=m")
> > spTransform(points, CRS("+proj=utm +zone=15 +datum=WGS84 +units=m"))}
> > 
> > When I test them I get strange results.
> > 
> > x<-c(541987,541970)
> > y<-c(1846598,1846799)
> > 
> > points<-data.frame(x,y)
> > 
> > NAD27_WGS84ll(points)
> > 
> > SpatialPoints:
> >              x        y
> > [1,] -92.60617 16.70272
> > [2,] -92.60633 16.70454
> > Coordinate Reference System (CRS) arguments:  +proj=longlat +datum=WGS84 
> > +ellps=WGS84 +towgs84=0,0,0
> > 
> > NAD27_NAD27ll(points)
> > 
> > SpatialPoints:
> >              x        y
> > [1,] -92.60617 16.70272
> > [2,] -92.60633 16.70454
> > Coordinate Reference System (CRS) arguments:  +proj=longlat +datum=NAD27 
> > +ellps=clrk66 +nadgrids=@conus, at alaska, at ntv2_0.gsb, at ntv1_can.dat
> > 
> > The results are the same, even though one function involves a datum 
> > shift and the other doesn't.
> > 
> > The difference between NAD27 and WGS84 in Southern Mexico should be 
> > around 200m N and 20m E. But I get
> > 
> > points-as.data.frame(NAD27_WGS84(points))
> > 
> >           x         y
> > 1 0.5857494 -112.2658
> > 2 0.5855395 -112.2768
> > 
> > 
> > Thanks for any advice.
> > 
> > Duncan Golicher
> > 
> 
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From amsantac at hotmail.com  Sun Nov 19 22:34:28 2006
From: amsantac at hotmail.com (=?iso-8859-1?B?QWztIFNhbnRhY3J1eg==?=)
Date: Sun, 19 Nov 2006 16:34:28 -0500
Subject: [R-sig-Geo] lag.listw function in spdep package
Message-ID: <BAY20-F13EB5E4C078D865015EDFAC9EE0@phx.gbl>

Dear list members,

I am studying the SAR models and its implementation in R, step by step. For 
the creation of the spatial lags, I found that function lag.listw calls an 
internal function ?lagw?.

I would like to know if it is possible to see the code of ?lagw? function in 
R, is there any command to do this?

I really appreciate your help,

Sincerely,

Al? M. Santacruz
M.Sc. Geomatics, Student
National University of Colombia
E-mail: amsantac at unal.edu.co
Bogot? D.C.

_________________________________________________________________
MSN Amor: busca tu ? naranja http://latam.msn.com/amor/



From Roger.Bivand at nhh.no  Sun Nov 19 22:44:59 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sun, 19 Nov 2006 22:44:59 +0100
Subject: [R-sig-Geo] lag.listw function in spdep package
Message-ID: <AD51AB79BC327C40AB2C7EB75D57A3C405128D@TOLAR.valuta.nhh.no>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20061119/8e6dd2b7/attachment.pl>

From amsantac at hotmail.com  Mon Nov 20 16:36:24 2006
From: amsantac at hotmail.com (=?iso-8859-1?B?QWztIFNhbnRhY3J1eg==?=)
Date: Mon, 20 Nov 2006 10:36:24 -0500
Subject: [R-sig-Geo] lag.listw function in spdep package
In-Reply-To: <AD51AB79BC327C40AB2C7EB75D57A3C405128D@TOLAR.valuta.nhh.no>
Message-ID: <BAY20-F27AE151F84F67BA7D94C1C9ED0@phx.gbl>

Thank you very much!

Although it?s C code, it is not so difficult to understand (with a little 
help from google and R manuals).

Thanks again,

Best regards,

Al? M. Santacruz
M.Sc. Geomatics, Student
National University of Colombia
E-mail: amsantac at unal.edu.co
Bogot? D.C.




>From: "Roger Bivand" <Roger.Bivand at nhh.no>
>To: Al? Santacruz <amsantac at hotmail.com>,<r-sig-geo at stat.math.ethz.ch>
>Subject: RE: [R-sig-Geo] lag.listw function in spdep package
>Date: Sun, 19 Nov 2006 22:44:59 +0100
>
>This is C code, not(yet) on a public CVS server. The only way to examine 
>the source is to download the source package from CRAN, unpack it, and look 
>in src/lagw.c
>
>If the macros are not clear enough, you can browse the R source code 
>including the headers at https://svn.r-project.org/R/, and please refer to 
>the relevant sections of the "writing R extensions" manual.
>
>If you have further questions (and suggestions), please write!
>
>(I am starting to re-implement at least listw objects as S4 (new-style) 
>classes based on sparse matrices - if anyone on the list is interested in 
>this, please let me know)
>
>Best wishes
>
>Roger
>
>---
>Roger Bivand, NHH, Helleveien 30, N-5045 Bergen,
>Roger.Bivand at nhh.no
>
>
>
>-----Original Message-----
>From: r-sig-geo-bounces at stat.math.ethz.ch on behalf of Al? Santacruz
>Sent: Sun 19.11.2006 22:34
>To: r-sig-geo at stat.math.ethz.ch
>Subject: [R-sig-Geo] lag.listw function in spdep package
>
>Dear list members,
>
>I am studying the SAR models and its implementation in R, step by step. For
>the creation of the spatial lags, I found that function lag.listw calls an
>internal function "lagw".
>
>I would like to know if it is possible to see the code of "lagw" function 
>in
>R, is there any command to do this?
>
>I really appreciate your help,
>
>Sincerely,
>
>Al? M. Santacruz
>M.Sc. Geomatics, Student
>National University of Colombia
>E-mail: amsantac at unal.edu.co
>Bogot? D.C.
>
>_________________________________________________________________
>MSN Amor: busca tu ? naranja http://latam.msn.com/amor/
>
>_______________________________________________
>R-sig-Geo mailing list
>R-sig-Geo at stat.math.ethz.ch
>https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

_________________________________________________________________
MSN Amor: busca tu ? naranja http://latam.msn.com/amor/



From carm_rodrig at hotmail.com  Tue Nov 21 15:39:55 2006
From: carm_rodrig at hotmail.com (CARMEN RODRIGUEZ)
Date: Tue, 21 Nov 2006 14:39:55 +0000
Subject: [R-sig-Geo] GWR
Message-ID: <BAY104-F20ECC1810F17D0D2AA0CA188EC0@phx.gbl>

Hi there,

I'm new at R, but I managed to run gwr (with spgwr). However, I get only a 
Summary of GWR coefficient estimates and I would like to get them all. Is 
anyone so kind to tell me how?

Regards,

Carmen

_________________________________________________________________
Grandes ?xitos, superh?roes, imitaciones, cine y TV...



From Roger.Bivand at nhh.no  Tue Nov 21 15:58:39 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 21 Nov 2006 15:58:39 +0100 (CET)
Subject: [R-sig-Geo] GWR
In-Reply-To: <BAY104-F20ECC1810F17D0D2AA0CA188EC0@phx.gbl>
Message-ID: <Pine.LNX.4.44.0611211556000.5894-100000@reclus.nhh.no>

On Tue, 21 Nov 2006, CARMEN RODRIGUEZ wrote:

> Hi there,
> 
> I'm new at R, but I managed to run gwr (with spgwr). However, I get only a 
> Summary of GWR coefficient estimates and I would like to get them all. Is 
> anyone so kind to tell me how?

They are in the output object. If your output object is called x, then:

as(x$SDF, "data.frame")

will give you the output columns, coefficients, standard errors, etc. 
There was a thread about this on this list just a week ago - searching the 
archives can be fruitful!

Roger

> 
> Regards,
> 
> Carmen
> 
> _________________________________________________________________
> Grandes ?xitos, superh?roes, imitaciones, cine y TV...
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From hi_ono2001 at yahoo.co.jp  Wed Nov 22 08:18:36 2006
From: hi_ono2001 at yahoo.co.jp (Hisaji ONO)
Date: Wed, 22 Nov 2006 16:18:36 +0900 (JST)
Subject: [R-sig-Geo] Any plan of R interface to GEOS
Message-ID: <20061122071836.37236.qmail@web10711.mail.bbt.yahoo.co.jp>

Hello.

 Currently GEOS C API interface has been already
available. And RCppTemplate package is also available.

 I think GEOS's functions are far better than gpclib's. It
can manipulate points, linestrings, polygons and
multi-geometries and it has lots of functions(ca. buffer,
union, overlay query/analysis)

 If R interface to GEOS, one of core functions of creating
spatial weight matrices will be easy, faster and correct
since current spdep took time to build them.

 Does any one have plan to build R interface using above
packages?


 Regards.



From Alexander.Herr at csiro.au  Fri Nov 24 02:48:44 2006
From: Alexander.Herr at csiro.au (Alexander.Herr at csiro.au)
Date: Fri, 24 Nov 2006 11:48:44 +1000
Subject: [R-sig-Geo] plot() and Jpeg() increase font size and resolution
Message-ID: <062AE320EF971E40ACD0F6C93391D769B8BA40@exqld1-tsv.nexus.csiro.au>

 
Dear list,

I am having troubles increasing the fontize when plotting a
variogram{gstat} and its model (vgm) with plot and using jpeg(). Also
the resolution in the jpeg call does not work. I am using R2.4 on
Mandriva 10.2 linux.

I can change fontsize with cex.axis in a normal plot, so I presume it
has to do with plotting the variogram model. Any help on how to increase
the font size and resolution would be appreciated?

R-calls:
v1<-variogram(log(z)~x+y, loc=coordinates(shp1),data=shp1)
m1<-vgm(0.0175, "Gau", 200000,0.052)

jpeg(file="LOTPLAN_variogram_mod.jpg", bg="white", res=300,
pointsize=16, width=1200, height=1200, quality=100)

 plot(v1,plot.number=F, model=m1, ylim=c(0.04,0.08), col="black",
cex.axis=1.5)

dev.off()

Thanks Herry

Dr Alexander Herr
Spatial and statistical analyst
CSIRO, Sustainable Ecosystems
Davies Laboratory,
University Drive, Douglas, QLD 4814 
Private Mail Bag, Aitkenvale, QLD 4814
 
Phone/www 
(07) 4753 8510; 4753 8650(fax)
Home: http://herry.ausbats.org.au
Webadmin ABS: http://ausbats.org.au
Sustainable Ecosystems: http://www.cse.csiro.au/



From Alexander.Herr at csiro.au  Fri Nov 24 08:24:27 2006
From: Alexander.Herr at csiro.au (Alexander.Herr at csiro.au)
Date: Fri, 24 Nov 2006 17:24:27 +1000
Subject: [R-sig-Geo] krige{gstat} error with new data prediction
Message-ID: <062AE320EF971E40ACD0F6C93391D769B8BA8D@exqld1-tsv.nexus.csiro.au>

Dear list,

I am using point data of an area as shapefile import (shp1). The
attribute data is log(AREA) as z reflecting areas size of the polygons.
Grid data (1000m pixel) as ascii grid imports (a1000) of the same
bounding box. Point and grid file stem from ArcInfo imported into R
using readShapePoints() and readAsciiGrid, this producing
SpatialPointsDataFrame and SpatialGridDataFrame. 

I was hoping to predict the missing areas between the points with
kriging but to no avail. What am I doing wrong?


Code:

library(spatial)
library(maptools)
library(maps)
library(geoR)
library(gstat)

#v1<-variogram(z~x+y, loc=coordinates(shp1),data=shp1)
#XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXx
load("qldproperty.Rdata") #this has all data and v1

plot(v1,plot.numbers=T)
m1<-vgm(2.7,"Gau",200000,5.75)
plot(v1,plot.number=F, model=m1, ylim=c(4,9))

m2<-fit.variogram(v1,model=m1)
plot(v1,plot.number=F, model=m2, ylim=c(4,9))


#Xvalidation
shp1 at coords[,1]->x
shp1 at coords[,2]->y
shp1$z->z
as.data.frame(cbind(x,y,z))->dta1
kcv<-krige.cv(z~x+y, ~x+y, dta1, model=m2, nmax=40, nfold=50,
verbose=TRUE,maxdist=10000)
truehist(kcv$residual, xlim=c(-20,20), h=1, col="grey")
rownames(kcv[is.na(kcv$residual),])->exclude
kcv[!rownames(kcv) %in% exclude,]->tmp

#goodness of fit: Mean error (0), Root Mean square error (low), and mean
squared Dev.ratio. (1) 
mean(tmp$residual);mean(tmp$residual**2);mean((tmp$residual)**2/tmp$var1
.var)

coordinates(tmp)<- ~x+y
bubble(tmp, "residual", main = "log(area): 50-fold validated krieging
residuals",fill=F)

k1<-krige(z ~ x+y, ~x+y, data=shp1, newdata=a1000, model=m2, nmax=40)


Error:
Error in function (classes, fdef, mtable)  :
        unable to find an inherited method for function "coordinates<-",
for signature "SpatialPointsDataFrame"
>  

Running R2.4 on Mandrake linux 10.2

The data is at ftp://ftp.csiro.au/Herry/ file: qldproperty.Rdata

Any help appreciated. 
Thanx
Herry

Dr Alexander Herr
Spatial and statistical analyst
CSIRO, Sustainable Ecosystems
Davies Laboratory,
University Drive, Douglas, QLD 4814 
Private Mail Bag, Aitkenvale, QLD 4814
 
Phone/www 
(07) 4753 8510; 4753 8650(fax)
Home: http://herry.ausbats.org.au
Webadmin ABS: http://ausbats.org.au
Sustainable Ecosystems: http://www.cse.csiro.au/
--------------------------------------------


-----Original Message-----
From: r-sig-geo-bounces at stat.math.ethz.ch
[mailto:r-sig-geo-bounces at stat.math.ethz.ch] On Behalf Of
r-sig-geo-request at stat.math.ethz.ch
Sent: Tuesday, August 15, 2006 8:00 PM
To: r-sig-geo at stat.math.ethz.ch
Subject: R-sig-Geo Digest, Vol 36, Issue 12

Send R-sig-Geo mailing list submissions to
	r-sig-geo at stat.math.ethz.ch

To subscribe or unsubscribe via the World Wide Web, visit
	https://stat.ethz.ch/mailman/listinfo/r-sig-geo
or, via email, send a message with subject or body 'help' to
	r-sig-geo-request at stat.math.ethz.ch

You can reach the person managing the list at
	r-sig-geo-owner at stat.math.ethz.ch

When replying, please edit your Subject line so it is more specific than
"Re: Contents of R-sig-Geo digest..."


Today's Topics:

   1. Linking lm residuls to specific polygon in shape files
      (David Martell)
   2. Re: Linking lm residuls to specific polygon in shape files
      (Roger Bivand)
   3. Re: Linking lm residuls to specific polygon in shape files
      (David Martell)


----------------------------------------------------------------------

Message: 1
Date: Mon, 14 Aug 2006 14:26:19 -0400
From: David Martell <martell at smokey.forestry.utoronto.ca>
Subject: [R-sig-Geo] Linking lm residuls to specific polygon in shape
	files
To: r-sig-geo at stat.math.ethz.ch
Message-ID:
	<Pine.SOL.4.55.0608141416550.867 at smokey.forestry.utoronto.ca>
Content-Type: TEXT/PLAIN; charset=US-ASCII


I am using the lm.morantest procedure in spdep to test for spatial
autocorrelation in my lm residuals.

I am not sure where this procedure gets the residuals.

I have prepared a GIS coverage that has a .shp file.  I ran the lm
model, produced the residuals, then put them them in the GIS coverage.


When I run lm in my R program, it produces an lm object that also
contains the residuals.


Does lm.morantest get the residuals from the .shp file or the lm object.

If it gets them from the latter, how does it determine which residual is
assigned to which polygon in the .shp file.

Thanks,

Dave Martell

_____________________________________________________________

David L. Martell, Professor
Faculty of Forestry, University of Toronto
33 Willcocks Street, Toronto, Ontario, Canada, M5S 3B3

E-mail:  martell at smokey.forestry.utoronto.ca
URL:     http://www.firelab.utoronto.ca
Phone:   (416) 978-6960
Fax:     (416) 978-3834
Map:     ES on campus map at http://oracle.osm.utoronto.ca/map/



------------------------------

Message: 2
Date: Mon, 14 Aug 2006 22:12:55 +0200 (CEST)
From: Roger Bivand <Roger.Bivand at nhh.no>
Subject: Re: [R-sig-Geo] Linking lm residuls to specific polygon in
	shape files
To: David Martell <martell at smokey.forestry.utoronto.ca>
Cc: r-sig-geo at stat.math.ethz.ch
Message-ID: <Pine.LNX.4.44.0608142156080.13097-100000 at reclus.nhh.no>
Content-Type: TEXT/PLAIN; charset=US-ASCII

On Mon, 14 Aug 2006, David Martell wrote:

> 
> I am using the lm.morantest procedure in spdep to test for spatial 
> autocorrelation in my lm residuals.
> 
> I am not sure where this procedure gets the residuals.
> 
> I have prepared a GIS coverage that has a .shp file.  I ran the lm 
> model, produced the residuals, then put them them in the GIS coverage.
> 
> 
> When I run lm in my R program, it produces an lm object that also 
> contains the residuals.
> 
> 
> Does lm.morantest get the residuals from the .shp file or the lm
object.
> 
> If it gets them from the latter, how does it determine which residual 
> is assigned to which polygon in the .shp file.

lm.morantest() uses the whole "lm" object returned by lm(), so the
residuals are by definition in the same order as the variables included
in the model formula. If you need tight control, do something like this:

xx <- readShapePoly(system.file("shapes/columbus.shp",
  package="maptools")[1], IDvar="NEIGNO") row.names(as(xx,
"data.frame")) xx_nb <- poly2nb(as(xx, "SpatialPolygons")) attr(xx_nb,
"region.id") lm_obj <- lm(CRIME ~ INC + HOVAL, data=xx)
names(residuals(lm_obj))
lm.morantest(lm_obj, nb2listw(xx_nb), spChk=TRUE)

where spChk=TRUE checks the equality of the names of the residuals of
the "lm" object (taken from the data= object of the call to lm()) with
the "region.id" attribute of the neighbour list. From the time the
sapefile is read, it has nothing more to do with the
SpatialPolygonsDataFrame object (here xx). Doing something like:

xx$lm_obj_resids <- residuals(lm_obj)

and then

writePolyShape(xx, "newshape")

includes them in a new shapefile.

Does this clarify things?

Roger

> 
> Thanks,
> 
> Dave Martell
> 
> _____________________________________________________________
> 
> David L. Martell, Professor
> Faculty of Forestry, University of Toronto
> 33 Willcocks Street, Toronto, Ontario, Canada, M5S 3B3
> 
> E-mail:  martell at smokey.forestry.utoronto.ca
> URL:     http://www.firelab.utoronto.ca
> Phone:   (416) 978-6960
> Fax:     (416) 978-3834
> Map:     ES on campus map at http://oracle.osm.utoronto.ca/map/
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

--
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



------------------------------

Message: 3
Date: Mon, 14 Aug 2006 16:19:25 -0400
From: David Martell <martell at smokey.forestry.utoronto.ca>
Subject: Re: [R-sig-Geo] Linking lm residuls to specific polygon in
	shape files
To: Roger Bivand <Roger.Bivand at nhh.no>
Cc: r-sig-geo at stat.math.ethz.ch
Message-ID:
	<Pine.SOL.4.55.0608141617260.867 at smokey.forestry.utoronto.ca>
Content-Type: TEXT/PLAIN; charset=US-ASCII


Hello Roger,

Yes, that's very helpful.

Thanks very much,

Dave Martell


On Mon, 14 Aug 2006, Roger Bivand wrote:

> On Mon, 14 Aug 2006, David Martell wrote:
>
> >
> > I am using the lm.morantest procedure in spdep to test for spatial
> > autocorrelation in my lm residuals.
> >
> > I am not sure where this procedure gets the residuals.
> >
> > I have prepared a GIS coverage that has a .shp file.  I ran the lm
model,
> > produced the residuals, then put them them in the GIS coverage.
> >
> >
> > When I run lm in my R program, it produces an lm object that also
contains
> > the residuals.
> >
> >
> > Does lm.morantest get the residuals from the .shp file or the lm
object.
> >
> > If it gets them from the latter, how does it determine which
residual is
> > assigned to which polygon in the .shp file.
>
> lm.morantest() uses the whole "lm" object returned by lm(), so the
> residuals are by definition in the same order as the variables
included in
> the model formula. If you need tight control, do something like this:
>
> xx <- readShapePoly(system.file("shapes/columbus.shp",
>   package="maptools")[1], IDvar="NEIGNO")
> row.names(as(xx, "data.frame"))
> xx_nb <- poly2nb(as(xx, "SpatialPolygons"))
> attr(xx_nb, "region.id")
> lm_obj <- lm(CRIME ~ INC + HOVAL, data=xx)
> names(residuals(lm_obj))
> lm.morantest(lm_obj, nb2listw(xx_nb), spChk=TRUE)
>
> where spChk=TRUE checks the equality of the names of the residuals of
the
> "lm" object (taken from the data= object of the call to lm()) with the
> "region.id" attribute of the neighbour list. From the time the
sapefile is
> read, it has nothing more to do with the SpatialPolygonsDataFrame
object
> (here xx). Doing something like:
>
> xx$lm_obj_resids <- residuals(lm_obj)
>
> and then
>
> writePolyShape(xx, "newshape")
>
> includes them in a new shapefile.
>
> Does this clarify things?
>
> Roger
>
> >
> > Thanks,
> >
> > Dave Martell
> >
> > _____________________________________________________________
> >
> > David L. Martell, Professor
> > Faculty of Forestry, University of Toronto
> > 33 Willcocks Street, Toronto, Ontario, Canada, M5S 3B3
> >
> > E-mail:  martell at smokey.forestry.utoronto.ca
> > URL:     http://www.firelab.utoronto.ca
> > Phone:   (416) 978-6960
> > Fax:     (416) 978-3834
> > Map:     ES on campus map at http://oracle.osm.utoronto.ca/map/
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at stat.math.ethz.ch
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
>
> --
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School
of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>
>

_____________________________________________________________

David L. Martell, Professor
Faculty of Forestry, University of Toronto
33 Willcocks Street, Toronto, Ontario, Canada, M5S 3B3

E-mail:  martell at smokey.forestry.utoronto.ca
URL:     http://www.firelab.utoronto.ca
Phone:   (416) 978-6960
Fax:     (416) 978-3834
Map:     ES on campus map at http://oracle.osm.utoronto.ca/map/



------------------------------

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at stat.math.ethz.ch
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


End of R-sig-Geo Digest, Vol 36, Issue 12



From e.pebesma at geo.uu.nl  Fri Nov 24 08:35:36 2006
From: e.pebesma at geo.uu.nl (Edzer J. Pebesma)
Date: Fri, 24 Nov 2006 08:35:36 +0100
Subject: [R-sig-Geo] krige{gstat} error with new data prediction
In-Reply-To: <062AE320EF971E40ACD0F6C93391D769B8BA8D@exqld1-tsv.nexus.csiro.au>
References: <062AE320EF971E40ACD0F6C93391D769B8BA8D@exqld1-tsv.nexus.csiro.au>
Message-ID: <4566A0C8.6000900@geo.uu.nl>

Herry, in

k1<-krige(z ~ x+y, ~x+y, data=shp1, newdata=a1000, model=m2, nmax=40)


shpl is alread a SpatialPointsDataFrame object, so you shouldn't specify 
it's coordinates, ~x+y. Rather, use

k1<-krige(z ~ x+y, shp1, a1000, model=m2, nmax=40)


I must admit that a more helpful error message would be useful here, as 
this starts to become a FAQ.
--
Edzer

Alexander.Herr at csiro.au wrote:
> Dear list,
>
> I am using point data of an area as shapefile import (shp1). The
> attribute data is log(AREA) as z reflecting areas size of the polygons.
> Grid data (1000m pixel) as ascii grid imports (a1000) of the same
> bounding box. Point and grid file stem from ArcInfo imported into R
> using readShapePoints() and readAsciiGrid, this producing
> SpatialPointsDataFrame and SpatialGridDataFrame. 
>
> I was hoping to predict the missing areas between the points with
> kriging but to no avail. What am I doing wrong?
>
>
> Code:
>
> library(spatial)
> library(maptools)
> library(maps)
> library(geoR)
> library(gstat)
>
> #v1<-variogram(z~x+y, loc=coordinates(shp1),data=shp1)
> #XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXx
> load("qldproperty.Rdata") #this has all data and v1
>
> plot(v1,plot.numbers=T)
> m1<-vgm(2.7,"Gau",200000,5.75)
> plot(v1,plot.number=F, model=m1, ylim=c(4,9))
>
> m2<-fit.variogram(v1,model=m1)
> plot(v1,plot.number=F, model=m2, ylim=c(4,9))
>
>
> #Xvalidation
> shp1 at coords[,1]->x
> shp1 at coords[,2]->y
> shp1$z->z
> as.data.frame(cbind(x,y,z))->dta1
> kcv<-krige.cv(z~x+y, ~x+y, dta1, model=m2, nmax=40, nfold=50,
> verbose=TRUE,maxdist=10000)
> truehist(kcv$residual, xlim=c(-20,20), h=1, col="grey")
> rownames(kcv[is.na(kcv$residual),])->exclude
> kcv[!rownames(kcv) %in% exclude,]->tmp
>
> #goodness of fit: Mean error (0), Root Mean square error (low), and mean
> squared Dev.ratio. (1) 
> mean(tmp$residual);mean(tmp$residual**2);mean((tmp$residual)**2/tmp$var1
> .var)
>
> coordinates(tmp)<- ~x+y
> bubble(tmp, "residual", main = "log(area): 50-fold validated krieging
> residuals",fill=F)
>
> k1<-krige(z ~ x+y, ~x+y, data=shp1, newdata=a1000, model=m2, nmax=40)
>
>
> Error:
> Error in function (classes, fdef, mtable)  :
>         unable to find an inherited method for function "coordinates<-",
> for signature "SpatialPointsDataFrame"
>   
>>  
>>     
>
> Running R2.4 on Mandrake linux 10.2
>
> The data is at ftp://ftp.csiro.au/Herry/ file: qldproperty.Rdata
>
> Any help appreciated. 
> Thanx
> Herry
>
> Dr Alexander Herr
> Spatial and statistical analyst
> CSIRO, Sustainable Ecosystems
> Davies Laboratory,
> University Drive, Douglas, QLD 4814 
> Private Mail Bag, Aitkenvale, QLD 4814
>  
> Phone/www 
> (07) 4753 8510; 4753 8650(fax)
> Home: http://herry.ausbats.org.au
> Webadmin ABS: http://ausbats.org.au
> Sustainable Ecosystems: http://www.cse.csiro.au/
> --------------------------------------------
>
>
> -----Original Message-----
> From: r-sig-geo-bounces at stat.math.ethz.ch
> [mailto:r-sig-geo-bounces at stat.math.ethz.ch] On Behalf Of
> r-sig-geo-request at stat.math.ethz.ch
> Sent: Tuesday, August 15, 2006 8:00 PM
> To: r-sig-geo at stat.math.ethz.ch
> Subject: R-sig-Geo Digest, Vol 36, Issue 12
>
> Send R-sig-Geo mailing list submissions to
> 	r-sig-geo at stat.math.ethz.ch
>
> To subscribe or unsubscribe via the World Wide Web, visit
> 	https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> or, via email, send a message with subject or body 'help' to
> 	r-sig-geo-request at stat.math.ethz.ch
>
> You can reach the person managing the list at
> 	r-sig-geo-owner at stat.math.ethz.ch
>
> When replying, please edit your Subject line so it is more specific than
> "Re: Contents of R-sig-Geo digest..."
>
>
> Today's Topics:
>
>    1. Linking lm residuls to specific polygon in shape files
>       (David Martell)
>    2. Re: Linking lm residuls to specific polygon in shape files
>       (Roger Bivand)
>    3. Re: Linking lm residuls to specific polygon in shape files
>       (David Martell)
>
>
> ----------------------------------------------------------------------
>
> Message: 1
> Date: Mon, 14 Aug 2006 14:26:19 -0400
> From: David Martell <martell at smokey.forestry.utoronto.ca>
> Subject: [R-sig-Geo] Linking lm residuls to specific polygon in shape
> 	files
> To: r-sig-geo at stat.math.ethz.ch
> Message-ID:
> 	<Pine.SOL.4.55.0608141416550.867 at smokey.forestry.utoronto.ca>
> Content-Type: TEXT/PLAIN; charset=US-ASCII
>
>
> I am using the lm.morantest procedure in spdep to test for spatial
> autocorrelation in my lm residuals.
>
> I am not sure where this procedure gets the residuals.
>
> I have prepared a GIS coverage that has a .shp file.  I ran the lm
> model, produced the residuals, then put them them in the GIS coverage.
>
>
> When I run lm in my R program, it produces an lm object that also
> contains the residuals.
>
>
> Does lm.morantest get the residuals from the .shp file or the lm object.
>
> If it gets them from the latter, how does it determine which residual is
> assigned to which polygon in the .shp file.
>
> Thanks,
>
> Dave Martell
>
> _____________________________________________________________
>
> David L. Martell, Professor
> Faculty of Forestry, University of Toronto
> 33 Willcocks Street, Toronto, Ontario, Canada, M5S 3B3
>
> E-mail:  martell at smokey.forestry.utoronto.ca
> URL:     http://www.firelab.utoronto.ca
> Phone:   (416) 978-6960
> Fax:     (416) 978-3834
> Map:     ES on campus map at http://oracle.osm.utoronto.ca/map/
>
>
>
> ------------------------------
>
> Message: 2
> Date: Mon, 14 Aug 2006 22:12:55 +0200 (CEST)
> From: Roger Bivand <Roger.Bivand at nhh.no>
> Subject: Re: [R-sig-Geo] Linking lm residuls to specific polygon in
> 	shape files
> To: David Martell <martell at smokey.forestry.utoronto.ca>
> Cc: r-sig-geo at stat.math.ethz.ch
> Message-ID: <Pine.LNX.4.44.0608142156080.13097-100000 at reclus.nhh.no>
> Content-Type: TEXT/PLAIN; charset=US-ASCII
>
> On Mon, 14 Aug 2006, David Martell wrote:
>
>   
>> I am using the lm.morantest procedure in spdep to test for spatial 
>> autocorrelation in my lm residuals.
>>
>> I am not sure where this procedure gets the residuals.
>>
>> I have prepared a GIS coverage that has a .shp file.  I ran the lm 
>> model, produced the residuals, then put them them in the GIS coverage.
>>
>>
>> When I run lm in my R program, it produces an lm object that also 
>> contains the residuals.
>>
>>
>> Does lm.morantest get the residuals from the .shp file or the lm
>>     
> object.
>   
>> If it gets them from the latter, how does it determine which residual 
>> is assigned to which polygon in the .shp file.
>>     
>
> lm.morantest() uses the whole "lm" object returned by lm(), so the
> residuals are by definition in the same order as the variables included
> in the model formula. If you need tight control, do something like this:
>
> xx <- readShapePoly(system.file("shapes/columbus.shp",
>   package="maptools")[1], IDvar="NEIGNO") row.names(as(xx,
> "data.frame")) xx_nb <- poly2nb(as(xx, "SpatialPolygons")) attr(xx_nb,
> "region.id") lm_obj <- lm(CRIME ~ INC + HOVAL, data=xx)
> names(residuals(lm_obj))
> lm.morantest(lm_obj, nb2listw(xx_nb), spChk=TRUE)
>
> where spChk=TRUE checks the equality of the names of the residuals of
> the "lm" object (taken from the data= object of the call to lm()) with
> the "region.id" attribute of the neighbour list. From the time the
> sapefile is read, it has nothing more to do with the
> SpatialPolygonsDataFrame object (here xx). Doing something like:
>
> xx$lm_obj_resids <- residuals(lm_obj)
>
> and then
>
> writePolyShape(xx, "newshape")
>
> includes them in a new shapefile.
>
> Does this clarify things?
>
> Roger
>
>   
>> Thanks,
>>
>> Dave Martell
>>
>> _____________________________________________________________
>>
>> David L. Martell, Professor
>> Faculty of Forestry, University of Toronto
>> 33 Willcocks Street, Toronto, Ontario, Canada, M5S 3B3
>>
>> E-mail:  martell at smokey.forestry.utoronto.ca
>> URL:     http://www.firelab.utoronto.ca
>> Phone:   (416) 978-6960
>> Fax:     (416) 978-3834
>> Map:     ES on campus map at http://oracle.osm.utoronto.ca/map/
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>     
>
> --
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>
>
>
> ------------------------------
>
> Message: 3
> Date: Mon, 14 Aug 2006 16:19:25 -0400
> From: David Martell <martell at smokey.forestry.utoronto.ca>
> Subject: Re: [R-sig-Geo] Linking lm residuls to specific polygon in
> 	shape files
> To: Roger Bivand <Roger.Bivand at nhh.no>
> Cc: r-sig-geo at stat.math.ethz.ch
> Message-ID:
> 	<Pine.SOL.4.55.0608141617260.867 at smokey.forestry.utoronto.ca>
> Content-Type: TEXT/PLAIN; charset=US-ASCII
>
>
> Hello Roger,
>
> Yes, that's very helpful.
>
> Thanks very much,
>
> Dave Martell
>
>
> On Mon, 14 Aug 2006, Roger Bivand wrote:
>
>   
>> On Mon, 14 Aug 2006, David Martell wrote:
>>
>>     
>>> I am using the lm.morantest procedure in spdep to test for spatial
>>> autocorrelation in my lm residuals.
>>>
>>> I am not sure where this procedure gets the residuals.
>>>
>>> I have prepared a GIS coverage that has a .shp file.  I ran the lm
>>>       
> model,
>   
>>> produced the residuals, then put them them in the GIS coverage.
>>>
>>>
>>> When I run lm in my R program, it produces an lm object that also
>>>       
> contains
>   
>>> the residuals.
>>>
>>>
>>> Does lm.morantest get the residuals from the .shp file or the lm
>>>       
> object.
>   
>>> If it gets them from the latter, how does it determine which
>>>       
> residual is
>   
>>> assigned to which polygon in the .shp file.
>>>       
>> lm.morantest() uses the whole "lm" object returned by lm(), so the
>> residuals are by definition in the same order as the variables
>>     
> included in
>   
>> the model formula. If you need tight control, do something like this:
>>
>> xx <- readShapePoly(system.file("shapes/columbus.shp",
>>   package="maptools")[1], IDvar="NEIGNO")
>> row.names(as(xx, "data.frame"))
>> xx_nb <- poly2nb(as(xx, "SpatialPolygons"))
>> attr(xx_nb, "region.id")
>> lm_obj <- lm(CRIME ~ INC + HOVAL, data=xx)
>> names(residuals(lm_obj))
>> lm.morantest(lm_obj, nb2listw(xx_nb), spChk=TRUE)
>>
>> where spChk=TRUE checks the equality of the names of the residuals of
>>     
> the
>   
>> "lm" object (taken from the data= object of the call to lm()) with the
>> "region.id" attribute of the neighbour list. From the time the
>>     
> sapefile is
>   
>> read, it has nothing more to do with the SpatialPolygonsDataFrame
>>     
> object
>   
>> (here xx). Doing something like:
>>
>> xx$lm_obj_resids <- residuals(lm_obj)
>>
>> and then
>>
>> writePolyShape(xx, "newshape")
>>
>> includes them in a new shapefile.
>>
>> Does this clarify things?
>>
>> Roger
>>
>>     
>>> Thanks,
>>>
>>> Dave Martell
>>>
>>> _____________________________________________________________
>>>
>>> David L. Martell, Professor
>>> Faculty of Forestry, University of Toronto
>>> 33 Willcocks Street, Toronto, Ontario, Canada, M5S 3B3
>>>
>>> E-mail:  martell at smokey.forestry.utoronto.ca
>>> URL:     http://www.firelab.utoronto.ca
>>> Phone:   (416) 978-6960
>>> Fax:     (416) 978-3834
>>> Map:     ES on campus map at http://oracle.osm.utoronto.ca/map/
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>>       
>> --
>> Roger Bivand
>> Economic Geography Section, Department of Economics, Norwegian School
>>     
> of
>   
>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>> e-mail: Roger.Bivand at nhh.no
>>
>>
>>     
>
> _____________________________________________________________
>
> David L. Martell, Professor
> Faculty of Forestry, University of Toronto
> 33 Willcocks Street, Toronto, Ontario, Canada, M5S 3B3
>
> E-mail:  martell at smokey.forestry.utoronto.ca
> URL:     http://www.firelab.utoronto.ca
> Phone:   (416) 978-6960
> Fax:     (416) 978-3834
> Map:     ES on campus map at http://oracle.osm.utoronto.ca/map/
>
>
>
> ------------------------------
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
> End of R-sig-Geo Digest, Vol 36, Issue 12
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



From e.pebesma at geo.uu.nl  Fri Nov 24 08:37:23 2006
From: e.pebesma at geo.uu.nl (Edzer J. Pebesma)
Date: Fri, 24 Nov 2006 08:37:23 +0100
Subject: [R-sig-Geo] plot() and Jpeg() increase font size and resolution
In-Reply-To: <062AE320EF971E40ACD0F6C93391D769B8BA40@exqld1-tsv.nexus.csiro.au>
References: <062AE320EF971E40ACD0F6C93391D769B8BA40@exqld1-tsv.nexus.csiro.au>
Message-ID: <4566A133.5020802@geo.uu.nl>

plotting variograms in gstat is done through xyplot in lattice; you'll 
find where it gets it's defaults by

library(lattice)
trellis.par.get()
?trellis.par.set
--
Edzer

Alexander.Herr at csiro.au wrote:
>  
> Dear list,
>
> I am having troubles increasing the fontize when plotting a
> variogram{gstat} and its model (vgm) with plot and using jpeg(). Also
> the resolution in the jpeg call does not work. I am using R2.4 on
> Mandriva 10.2 linux.
>
> I can change fontsize with cex.axis in a normal plot, so I presume it
> has to do with plotting the variogram model. Any help on how to increase
> the font size and resolution would be appreciated?
>
> R-calls:
> v1<-variogram(log(z)~x+y, loc=coordinates(shp1),data=shp1)
> m1<-vgm(0.0175, "Gau", 200000,0.052)
>
> jpeg(file="LOTPLAN_variogram_mod.jpg", bg="white", res=300,
> pointsize=16, width=1200, height=1200, quality=100)
>
>  plot(v1,plot.number=F, model=m1, ylim=c(0.04,0.08), col="black",
> cex.axis=1.5)
>
> dev.off()
>
> Thanks Herry
>
> Dr Alexander Herr
> Spatial and statistical analyst
> CSIRO, Sustainable Ecosystems
> Davies Laboratory,
> University Drive, Douglas, QLD 4814 
> Private Mail Bag, Aitkenvale, QLD 4814
>  
> Phone/www 
> (07) 4753 8510; 4753 8650(fax)
> Home: http://herry.ausbats.org.au
> Webadmin ABS: http://ausbats.org.au
> Sustainable Ecosystems: http://www.cse.csiro.au/
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



From Roger.Bivand at nhh.no  Fri Nov 24 08:40:48 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 24 Nov 2006 08:40:48 +0100 (CET)
Subject: [R-sig-Geo] plot() and Jpeg() increase font size and resolution
In-Reply-To: <062AE320EF971E40ACD0F6C93391D769B8BA40@exqld1-tsv.nexus.csiro.au>
Message-ID: <Pine.LNX.4.44.0611240823390.9258-100000@reclus.nhh.no>

On Fri, 24 Nov 2006 Alexander.Herr at csiro.au wrote:

>  
> Dear list,
> 
> I am having troubles increasing the fontize when plotting a
> variogram{gstat} and its model (vgm) with plot and using jpeg(). Also
> the resolution in the jpeg call does not work. I am using R2.4 on
> Mandriva 10.2 linux.
> 
> I can change fontsize with cex.axis in a normal plot, so I presume it
> has to do with plotting the variogram model. Any help on how to increase
> the font size and resolution would be appreciated?

I believe that the underlying plot.gstatVariogram() method uses lattice 
graphics, not base graphics. So the problem is to find the right way of 
passing the parameter for xyplot(), and then see if plot.gstatVariogram() 
lets you do the same.

df <- data.frame(x=1:10, y=runif(10))
xyplot(y ~ x, df, scales=list(cex=3))

works, but

data(meuse)
vgm1 <- variogram(log(zinc)~1, ~x+y, meuse)
plot(vgm1, scales=list(cex=3))

unfortunately doesn't, so more exploration will be needed. I think the 
scales= argument is not passed through in the final brach to xyplot() in 
gstat:::plot.gstatVariogram(). From the examples:

plot(v, group.id = FALSE, auto.key = TRUE, scales=list(cex=2))

works, but

plot(vgm2, scales=list(cex=2))

doesn't.

Roger

> 
> R-calls:
> v1<-variogram(log(z)~x+y, loc=coordinates(shp1),data=shp1)
> m1<-vgm(0.0175, "Gau", 200000,0.052)
> 
> jpeg(file="LOTPLAN_variogram_mod.jpg", bg="white", res=300,
> pointsize=16, width=1200, height=1200, quality=100)
> 
>  plot(v1,plot.number=F, model=m1, ylim=c(0.04,0.08), col="black",
> cex.axis=1.5)
> 
> dev.off()
> 
> Thanks Herry
> 
> Dr Alexander Herr
> Spatial and statistical analyst
> CSIRO, Sustainable Ecosystems
> Davies Laboratory,
> University Drive, Douglas, QLD 4814 
> Private Mail Bag, Aitkenvale, QLD 4814
>  
> Phone/www 
> (07) 4753 8510; 4753 8650(fax)
> Home: http://herry.ausbats.org.au
> Webadmin ABS: http://ausbats.org.au
> Sustainable Ecosystems: http://www.cse.csiro.au/
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From Alexander.Herr at csiro.au  Mon Nov 27 03:19:07 2006
From: Alexander.Herr at csiro.au (Alexander.Herr at csiro.au)
Date: Mon, 27 Nov 2006 12:19:07 +1000
Subject: [R-sig-Geo] krige{gstat} error with new data prediction
Message-ID: <062AE320EF971E40ACD0F6C93391D769B8BB66@exqld1-tsv.nexus.csiro.au>

Thanks Edzer,

k1<-krige(z ~ x+y, shp1, a1000, model=m2, nmax=40) produces the
following:

Error in eval(expr. envir. enclos): object "x" not found
In addition: Warning message:
grid has empty columns/rows in dimension 2 in: points2grid(points,
tolerance).

The grid will have empty
I was hoping to predict values for within areas (currently assigned bar
some pixels stemming from spatial errors) and ignore those outside (ie
the once that fill the grid boundary between study area and bounding
box). I presume the empty columns/rows refer to the NA outside the study
area?

Any suggestions?

Thanks
Herry

Dr Alexander Herr
Spatial and statistical analyst
CSIRO, Sustainable Ecosystems
Davies Laboratory,
University Drive, Douglas, QLD 4814 
Private Mail Bag, Aitkenvale, QLD 4814
 
Phone/www 
(07) 4753 8510; 4753 8650(fax)
Home: http://herry.ausbats.org.au
Webadmin ABS: http://ausbats.org.au
Sustainable Ecosystems: http://www.cse.csiro.au/
--------------------------------------------


-----Original Message-----
From: Edzer J. Pebesma [mailto:e.pebesma at geo.uu.nl] 
Sent: Friday, November 24, 2006 5:36 PM
To: Herr, Alexander Herr - Herry (CSE, Townsville)
Cc: r-sig-geo at stat.math.ethz.ch
Subject: Re: [R-sig-Geo] krige{gstat} error with new data prediction

Herry, in

k1<-krige(z ~ x+y, ~x+y, data=shp1, newdata=a1000, model=m2, nmax=40)


shpl is alread a SpatialPointsDataFrame object, so you shouldn't specify
it's coordinates, ~x+y. Rather, use

k1<-krige(z ~ x+y, shp1, a1000, model=m2, nmax=40)


I must admit that a more helpful error message would be useful here, as
this starts to become a FAQ.
--
Edzer

Alexander.Herr at csiro.au wrote:
> Dear list,
>
> I am using point data of an area as shapefile import (shp1). The 
> attribute data is log(AREA) as z reflecting areas size of the
polygons.
> Grid data (1000m pixel) as ascii grid imports (a1000) of the same 
> bounding box. Point and grid file stem from ArcInfo imported into R 
> using readShapePoints() and readAsciiGrid, this producing 
> SpatialPointsDataFrame and SpatialGridDataFrame.
>
> I was hoping to predict the missing areas between the points with 
> kriging but to no avail. What am I doing wrong?
>
>
> Code:
>
> library(spatial)
> library(maptools)
> library(maps)
> library(geoR)
> library(gstat)
>
> #v1<-variogram(z~x+y, loc=coordinates(shp1),data=shp1) 
> #XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXx
> load("qldproperty.Rdata") #this has all data and v1
>
> plot(v1,plot.numbers=T)
> m1<-vgm(2.7,"Gau",200000,5.75)
> plot(v1,plot.number=F, model=m1, ylim=c(4,9))
>
> m2<-fit.variogram(v1,model=m1)
> plot(v1,plot.number=F, model=m2, ylim=c(4,9))
>
>
> #Xvalidation
> shp1 at coords[,1]->x
> shp1 at coords[,2]->y
> shp1$z->z
> as.data.frame(cbind(x,y,z))->dta1
> kcv<-krige.cv(z~x+y, ~x+y, dta1, model=m2, nmax=40, nfold=50,
> verbose=TRUE,maxdist=10000)
> truehist(kcv$residual, xlim=c(-20,20), h=1, col="grey") 
> rownames(kcv[is.na(kcv$residual),])->exclude
> kcv[!rownames(kcv) %in% exclude,]->tmp
>
> #goodness of fit: Mean error (0), Root Mean square error (low), and 
> mean squared Dev.ratio. (1)
> mean(tmp$residual);mean(tmp$residual**2);mean((tmp$residual)**2/tmp$va
> r1
> .var)
>
> coordinates(tmp)<- ~x+y
> bubble(tmp, "residual", main = "log(area): 50-fold validated krieging
> residuals",fill=F)
>
> k1<-krige(z ~ x+y, ~x+y, data=shp1, newdata=a1000, model=m2, nmax=40)
>
>
> Error:
> Error in function (classes, fdef, mtable)  :
>         unable to find an inherited method for function 
> "coordinates<-", for signature "SpatialPointsDataFrame"
>   
>>  
>>     
>
> Running R2.4 on Mandrake linux 10.2
>
> The data is at ftp://ftp.csiro.au/Herry/ file: qldproperty.Rdata
>
> Any help appreciated. 
> Thanx
> Herry
>
> Dr Alexander Herr
> Spatial and statistical analyst
> CSIRO, Sustainable Ecosystems
> Davies Laboratory,
> University Drive, Douglas, QLD 4814
> Private Mail Bag, Aitkenvale, QLD 4814
>  
> Phone/www
> (07) 4753 8510; 4753 8650(fax)
> Home: http://herry.ausbats.org.au
> Webadmin ABS: http://ausbats.org.au
> Sustainable Ecosystems: http://www.cse.csiro.au/
> --------------------------------------------
>
>
> -----Original Message-----
> From: r-sig-geo-bounces at stat.math.ethz.ch
> [mailto:r-sig-geo-bounces at stat.math.ethz.ch] On Behalf Of 
> r-sig-geo-request at stat.math.ethz.ch
> Sent: Tuesday, August 15, 2006 8:00 PM
> To: r-sig-geo at stat.math.ethz.ch
> Subject: R-sig-Geo Digest, Vol 36, Issue 12
>
> Send R-sig-Geo mailing list submissions to
> 	r-sig-geo at stat.math.ethz.ch
>
> To subscribe or unsubscribe via the World Wide Web, visit
> 	https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> or, via email, send a message with subject or body 'help' to
> 	r-sig-geo-request at stat.math.ethz.ch
>
> You can reach the person managing the list at
> 	r-sig-geo-owner at stat.math.ethz.ch
>
> When replying, please edit your Subject line so it is more specific 
> than
> "Re: Contents of R-sig-Geo digest..."
>
>
> Today's Topics:
>
>    1. Linking lm residuls to specific polygon in shape files
>       (David Martell)
>    2. Re: Linking lm residuls to specific polygon in shape files
>       (Roger Bivand)
>    3. Re: Linking lm residuls to specific polygon in shape files
>       (David Martell)
>
>
> ----------------------------------------------------------------------
>
> Message: 1
> Date: Mon, 14 Aug 2006 14:26:19 -0400
> From: David Martell <martell at smokey.forestry.utoronto.ca>
> Subject: [R-sig-Geo] Linking lm residuls to specific polygon in shape
> 	files
> To: r-sig-geo at stat.math.ethz.ch
> Message-ID:
> 	<Pine.SOL.4.55.0608141416550.867 at smokey.forestry.utoronto.ca>
> Content-Type: TEXT/PLAIN; charset=US-ASCII
>
>
> I am using the lm.morantest procedure in spdep to test for spatial 
> autocorrelation in my lm residuals.
>
> I am not sure where this procedure gets the residuals.
>
> I have prepared a GIS coverage that has a .shp file.  I ran the lm 
> model, produced the residuals, then put them them in the GIS coverage.
>
>
> When I run lm in my R program, it produces an lm object that also 
> contains the residuals.
>
>
> Does lm.morantest get the residuals from the .shp file or the lm
object.
>
> If it gets them from the latter, how does it determine which residual 
> is assigned to which polygon in the .shp file.
>
> Thanks,
>
> Dave Martell
>
> _____________________________________________________________
>
> David L. Martell, Professor
> Faculty of Forestry, University of Toronto
> 33 Willcocks Street, Toronto, Ontario, Canada, M5S 3B3
>
> E-mail:  martell at smokey.forestry.utoronto.ca
> URL:     http://www.firelab.utoronto.ca
> Phone:   (416) 978-6960
> Fax:     (416) 978-3834
> Map:     ES on campus map at http://oracle.osm.utoronto.ca/map/
>
>
>
> ------------------------------
>
> Message: 2
> Date: Mon, 14 Aug 2006 22:12:55 +0200 (CEST)
> From: Roger Bivand <Roger.Bivand at nhh.no>
> Subject: Re: [R-sig-Geo] Linking lm residuls to specific polygon in
> 	shape files
> To: David Martell <martell at smokey.forestry.utoronto.ca>
> Cc: r-sig-geo at stat.math.ethz.ch
> Message-ID: <Pine.LNX.4.44.0608142156080.13097-100000 at reclus.nhh.no>
> Content-Type: TEXT/PLAIN; charset=US-ASCII
>
> On Mon, 14 Aug 2006, David Martell wrote:
>
>   
>> I am using the lm.morantest procedure in spdep to test for spatial 
>> autocorrelation in my lm residuals.
>>
>> I am not sure where this procedure gets the residuals.
>>
>> I have prepared a GIS coverage that has a .shp file.  I ran the lm 
>> model, produced the residuals, then put them them in the GIS
coverage.
>>
>>
>> When I run lm in my R program, it produces an lm object that also 
>> contains the residuals.
>>
>>
>> Does lm.morantest get the residuals from the .shp file or the lm
>>     
> object.
>   
>> If it gets them from the latter, how does it determine which residual

>> is assigned to which polygon in the .shp file.
>>     
>
> lm.morantest() uses the whole "lm" object returned by lm(), so the 
> residuals are by definition in the same order as the variables 
> included in the model formula. If you need tight control, do something
like this:
>
> xx <- readShapePoly(system.file("shapes/columbus.shp",
>   package="maptools")[1], IDvar="NEIGNO") row.names(as(xx,
> "data.frame")) xx_nb <- poly2nb(as(xx, "SpatialPolygons")) attr(xx_nb,
> "region.id") lm_obj <- lm(CRIME ~ INC + HOVAL, data=xx)
> names(residuals(lm_obj))
> lm.morantest(lm_obj, nb2listw(xx_nb), spChk=TRUE)
>
> where spChk=TRUE checks the equality of the names of the residuals of 
> the "lm" object (taken from the data= object of the call to lm()) with

> the "region.id" attribute of the neighbour list. From the time the 
> sapefile is read, it has nothing more to do with the 
> SpatialPolygonsDataFrame object (here xx). Doing something like:
>
> xx$lm_obj_resids <- residuals(lm_obj)
>
> and then
>
> writePolyShape(xx, "newshape")
>
> includes them in a new shapefile.
>
> Does this clarify things?
>
> Roger
>
>   
>> Thanks,
>>
>> Dave Martell
>>
>> _____________________________________________________________
>>
>> David L. Martell, Professor
>> Faculty of Forestry, University of Toronto
>> 33 Willcocks Street, Toronto, Ontario, Canada, M5S 3B3
>>
>> E-mail:  martell at smokey.forestry.utoronto.ca
>> URL:     http://www.firelab.utoronto.ca
>> Phone:   (416) 978-6960
>> Fax:     (416) 978-3834
>> Map:     ES on campus map at http://oracle.osm.utoronto.ca/map/
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>     
>
> --
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School 
> of Economics and Business Administration, Helleveien 30, N-5045 
> Bergen, Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>
>
>
> ------------------------------
>
> Message: 3
> Date: Mon, 14 Aug 2006 16:19:25 -0400
> From: David Martell <martell at smokey.forestry.utoronto.ca>
> Subject: Re: [R-sig-Geo] Linking lm residuls to specific polygon in
> 	shape files
> To: Roger Bivand <Roger.Bivand at nhh.no>
> Cc: r-sig-geo at stat.math.ethz.ch
> Message-ID:
> 	<Pine.SOL.4.55.0608141617260.867 at smokey.forestry.utoronto.ca>
> Content-Type: TEXT/PLAIN; charset=US-ASCII
>
>
> Hello Roger,
>
> Yes, that's very helpful.
>
> Thanks very much,
>
> Dave Martell
>
>
> On Mon, 14 Aug 2006, Roger Bivand wrote:
>
>   
>> On Mon, 14 Aug 2006, David Martell wrote:
>>
>>     
>>> I am using the lm.morantest procedure in spdep to test for spatial 
>>> autocorrelation in my lm residuals.
>>>
>>> I am not sure where this procedure gets the residuals.
>>>
>>> I have prepared a GIS coverage that has a .shp file.  I ran the lm
>>>       
> model,
>   
>>> produced the residuals, then put them them in the GIS coverage.
>>>
>>>
>>> When I run lm in my R program, it produces an lm object that also
>>>       
> contains
>   
>>> the residuals.
>>>
>>>
>>> Does lm.morantest get the residuals from the .shp file or the lm
>>>       
> object.
>   
>>> If it gets them from the latter, how does it determine which
>>>       
> residual is
>   
>>> assigned to which polygon in the .shp file.
>>>       
>> lm.morantest() uses the whole "lm" object returned by lm(), so the 
>> residuals are by definition in the same order as the variables
>>     
> included in
>   
>> the model formula. If you need tight control, do something like this:
>>
>> xx <- readShapePoly(system.file("shapes/columbus.shp",
>>   package="maptools")[1], IDvar="NEIGNO") row.names(as(xx, 
>> "data.frame")) xx_nb <- poly2nb(as(xx, "SpatialPolygons")) 
>> attr(xx_nb, "region.id") lm_obj <- lm(CRIME ~ INC + HOVAL, data=xx)
>> names(residuals(lm_obj))
>> lm.morantest(lm_obj, nb2listw(xx_nb), spChk=TRUE)
>>
>> where spChk=TRUE checks the equality of the names of the residuals of
>>     
> the
>   
>> "lm" object (taken from the data= object of the call to lm()) with 
>> the "region.id" attribute of the neighbour list. From the time the
>>     
> sapefile is
>   
>> read, it has nothing more to do with the SpatialPolygonsDataFrame
>>     
> object
>   
>> (here xx). Doing something like:
>>
>> xx$lm_obj_resids <- residuals(lm_obj)
>>
>> and then
>>
>> writePolyShape(xx, "newshape")
>>
>> includes them in a new shapefile.
>>
>> Does this clarify things?
>>
>> Roger
>>
>>     
>>> Thanks,
>>>
>>> Dave Martell
>>>
>>> _____________________________________________________________
>>>
>>> David L. Martell, Professor
>>> Faculty of Forestry, University of Toronto
>>> 33 Willcocks Street, Toronto, Ontario, Canada, M5S 3B3
>>>
>>> E-mail:  martell at smokey.forestry.utoronto.ca
>>> URL:     http://www.firelab.utoronto.ca
>>> Phone:   (416) 978-6960
>>> Fax:     (416) 978-3834
>>> Map:     ES on campus map at http://oracle.osm.utoronto.ca/map/
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>>       
>> --
>> Roger Bivand
>> Economic Geography Section, Department of Economics, Norwegian School
>>     
> of
>   
>> Economics and Business Administration, Helleveien 30, N-5045 Bergen, 
>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>> e-mail: Roger.Bivand at nhh.no
>>
>>
>>     
>
> _____________________________________________________________
>
> David L. Martell, Professor
> Faculty of Forestry, University of Toronto
> 33 Willcocks Street, Toronto, Ontario, Canada, M5S 3B3
>
> E-mail:  martell at smokey.forestry.utoronto.ca
> URL:     http://www.firelab.utoronto.ca
> Phone:   (416) 978-6960
> Fax:     (416) 978-3834
> Map:     ES on campus map at http://oracle.osm.utoronto.ca/map/
>
>
>
> ------------------------------
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
> End of R-sig-Geo Digest, Vol 36, Issue 12
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



From Alexander.Herr at csiro.au  Mon Nov 27 04:19:37 2006
From: Alexander.Herr at csiro.au (Alexander.Herr at csiro.au)
Date: Mon, 27 Nov 2006 13:19:37 +1000
Subject: [R-sig-Geo] plot() and Jpeg() increase font size and resolution
Message-ID: <062AE320EF971E40ACD0F6C93391D769B8BB91@exqld1-tsv.nexus.csiro.au>

Thanks to Edzer and Roger,
I can now plot with increased font sizes. However, jpeg still does not
reproduce these, nor does it show up in high quality. What I would like
to do is produce some highresolution jpegs.

Any help would be appreciated

Thanx
Herry


R2.4 on Mandriva 10.2 linux.

Dr Alexander Herr
Spatial and statistical analyst
CSIRO, Sustainable Ecosystems
Davies Laboratory,
University Drive, Douglas, QLD 4814 
Private Mail Bag, Aitkenvale, QLD 4814
 
Phone/www 
(07) 4753 8510; 4753 8650(fax)
Home: http://herry.ausbats.org.au
Webadmin ABS: http://ausbats.org.au
Sustainable Ecosystems: http://www.cse.csiro.au/
--------------------------------------------


-----Original Message-----
From: Edzer J. Pebesma [mailto:e.pebesma at geo.uu.nl] 
Sent: Friday, November 24, 2006 5:37 PM
To: Herr, Alexander Herr - Herry (CSE, Townsville)
Cc: r-help at stat.math.ethz.ch; r-sig-geo at stat.math.ethz.ch
Subject: Re: [R-sig-Geo] plot() and Jpeg() increase font size and
resolution

plotting variograms in gstat is done through xyplot in lattice; you'll
find where it gets it's defaults by

library(lattice)
trellis.par.get()
?trellis.par.set
--
Edzer

Alexander.Herr at csiro.au wrote:
>  
> Dear list,
>
> I am having troubles increasing the fontize when plotting a 
> variogram{gstat} and its model (vgm) with plot and using jpeg(). Also 
> the resolution in the jpeg call does not work. I am using R2.4 on 
> Mandriva 10.2 linux.
>
> I can change fontsize with cex.axis in a normal plot, so I presume it 
> has to do with plotting the variogram model. Any help on how to 
> increase the font size and resolution would be appreciated?
>
> R-calls:
> v1<-variogram(log(z)~x+y, loc=coordinates(shp1),data=shp1) 
> m1<-vgm(0.0175, "Gau", 200000,0.052)
>
> jpeg(file="LOTPLAN_variogram_mod.jpg", bg="white", res=300, 
> pointsize=16, width=1200, height=1200, quality=100)
>
>  plot(v1,plot.number=F, model=m1, ylim=c(0.04,0.08), col="black",
> cex.axis=1.5)
>
> dev.off()
>
> Thanks Herry
>
> Dr Alexander Herr
> Spatial and statistical analyst
> CSIRO, Sustainable Ecosystems
> Davies Laboratory,
> University Drive, Douglas, QLD 4814
> Private Mail Bag, Aitkenvale, QLD 4814
>  
> Phone/www
> (07) 4753 8510; 4753 8650(fax)
> Home: http://herry.ausbats.org.au
> Webadmin ABS: http://ausbats.org.au
> Sustainable Ecosystems: http://www.cse.csiro.au/
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



From e.pebesma at geo.uu.nl  Mon Nov 27 08:33:54 2006
From: e.pebesma at geo.uu.nl (Edzer J. Pebesma)
Date: Mon, 27 Nov 2006 08:33:54 +0100
Subject: [R-sig-Geo] plot() and Jpeg() increase font size and resolution
In-Reply-To: <062AE320EF971E40ACD0F6C93391D769B8BB91@exqld1-tsv.nexus.csiro.au>
References: <062AE320EF971E40ACD0F6C93391D769B8BB91@exqld1-tsv.nexus.csiro.au>
Message-ID: <456A94E2.5090502@geo.uu.nl>

Alexander.Herr at csiro.au wrote:
> Thanks to Edzer and Roger,
> I can now plot with increased font sizes. However, jpeg still does not
> reproduce these, nor does it show up in high quality. What I would like
> to do is produce some highresolution jpegs.
>   
Please specify the commands that you used, preferrably such that we can 
reproduce them, and specify which worked and which didn't the way you 
expected. Also please give the output of sessionInfo(), and tell us the 
platform you work on. Have you tried producing png, did that work?
--
Edzer
> Any help would be appreciated
>
> Thanx
> Herry
>
>
> R2.4 on Mandriva 10.2 linux.
>
> Dr Alexander Herr
> Spatial and statistical analyst
> CSIRO, Sustainable Ecosystems
> Davies Laboratory,
> University Drive, Douglas, QLD 4814 
> Private Mail Bag, Aitkenvale, QLD 4814
>  
> Phone/www 
> (07) 4753 8510; 4753 8650(fax)
> Home: http://herry.ausbats.org.au
> Webadmin ABS: http://ausbats.org.au
> Sustainable Ecosystems: http://www.cse.csiro.au/
> --------------------------------------------
>
>
> -----Original Message-----
> From: Edzer J. Pebesma [mailto:e.pebesma at geo.uu.nl] 
> Sent: Friday, November 24, 2006 5:37 PM
> To: Herr, Alexander Herr - Herry (CSE, Townsville)
> Cc: r-help at stat.math.ethz.ch; r-sig-geo at stat.math.ethz.ch
> Subject: Re: [R-sig-Geo] plot() and Jpeg() increase font size and
> resolution
>
> plotting variograms in gstat is done through xyplot in lattice; you'll
> find where it gets it's defaults by
>
> library(lattice)
> trellis.par.get()
> ?trellis.par.set
> --
> Edzer
>
> Alexander.Herr at csiro.au wrote:
>   
>>  
>> Dear list,
>>
>> I am having troubles increasing the fontize when plotting a 
>> variogram{gstat} and its model (vgm) with plot and using jpeg(). Also 
>> the resolution in the jpeg call does not work. I am using R2.4 on 
>> Mandriva 10.2 linux.
>>
>> I can change fontsize with cex.axis in a normal plot, so I presume it 
>> has to do with plotting the variogram model. Any help on how to 
>> increase the font size and resolution would be appreciated?
>>
>> R-calls:
>> v1<-variogram(log(z)~x+y, loc=coordinates(shp1),data=shp1) 
>> m1<-vgm(0.0175, "Gau", 200000,0.052)
>>
>> jpeg(file="LOTPLAN_variogram_mod.jpg", bg="white", res=300, 
>> pointsize=16, width=1200, height=1200, quality=100)
>>
>>  plot(v1,plot.number=F, model=m1, ylim=c(0.04,0.08), col="black",
>> cex.axis=1.5)
>>
>> dev.off()
>>
>> Thanks Herry
>>
>> Dr Alexander Herr
>> Spatial and statistical analyst
>> CSIRO, Sustainable Ecosystems
>> Davies Laboratory,
>> University Drive, Douglas, QLD 4814
>> Private Mail Bag, Aitkenvale, QLD 4814
>>  
>> Phone/www
>> (07) 4753 8510; 4753 8650(fax)
>> Home: http://herry.ausbats.org.au
>> Webadmin ABS: http://ausbats.org.au
>> Sustainable Ecosystems: http://www.cse.csiro.au/
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>     
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



From carm_rodrig at hotmail.com  Mon Nov 27 14:03:04 2006
From: carm_rodrig at hotmail.com (CARMEN RODRIGUEZ)
Date: Mon, 27 Nov 2006 13:03:04 +0000
Subject: [R-sig-Geo] Mixed GWR
Message-ID: <BAY104-F13332A0451A485FDF5371A88E60@phx.gbl>

Does anyone know how tu run a mixed GWR in R?

Thank you

_________________________________________________________________
?Est?s pensando en cambiar de coche? Todas los modelos de serie y extras en 
MSN Motor. http://motor.msn.es/researchcentre/



From Roger.Bivand at nhh.no  Mon Nov 27 14:20:13 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 27 Nov 2006 14:20:13 +0100 (CET)
Subject: [R-sig-Geo] Mixed GWR
In-Reply-To: <BAY104-F13332A0451A485FDF5371A88E60@phx.gbl>
Message-ID: <Pine.LNX.4.44.0611271409520.9225-100000@reclus.nhh.no>

On Mon, 27 Nov 2006, CARMEN RODRIGUEZ wrote:

> Does anyone know how tu run a mixed GWR in R?

If by mixed GWR you mean a model where some of the coefficients are held
fixed at the global level, and others vary locally, this is equivalent to
fitting a global model first and fitting the local model to the residuals,
but watch out for the intercept! This omits the possible covariance
between the global and local subsets, treating the global as a known
offset, so if you like, you can do steps 1-5 of pp. 67-8 in the GWR book
by hand and see if there is a big difference.  In any case, GWR is not an
explanatory model, as I expect you are aware.

Roger

> 
> Thank you
> 
> _________________________________________________________________
> ?Est?s pensando en cambiar de coche? Todas los modelos de serie y extras en 
> MSN Motor. http://motor.msn.es/researchcentre/
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From Alexander.Herr at csiro.au  Tue Nov 28 00:40:01 2006
From: Alexander.Herr at csiro.au (Alexander.Herr at csiro.au)
Date: Tue, 28 Nov 2006 09:40:01 +1000
Subject: [R-sig-Geo] plot() and Jpeg() increase font size and resolution
Message-ID: <062AE320EF971E40ACD0F6C93391D769B8BC51@exqld1-tsv.nexus.csiro.au>

Hi Edzer,

png also does not increase the file size. 

Following the commands. The data are located at
ftp://ftp.csiro.au/Herry, file qldproperty.Rdata.

XXXXXXXXXXXXXXXXXXXX
trellis.par.get("fontsize")->fontsize
 fontsize$default<-16
 fontsize$points<-16
 fontsize$text<-18
  trellis.par.set("fontsize",fontsize)
trellis.par.get("fontsize")
 
 
 
plot(v1,plot.number=F, model=m2, ylim=c(4,9))

plt1<-plot(v1,plot.number=F, model=m1, ylim=c(4,9), col="black",
pch="+", scales=list(cex=1.5,)) 

jpeg(file="LOTPLAN_variogram_mod.png", bg="white", res=300,
pointsize=16, width=800, height=800)
 plt1
dev.off()
XXXXXXXXXXXXXXXXXXXXXXXXXXX


SessionInfo:
R version 2.4.0 (2006-10-03)
i686-pc-linux-gnu

locale:
LC_CTYPE=en_US;LC_NUMERIC=C;LC_TIME=en_US;LC_COLLATE=en_US;LC_MONETARY=e
n_US;LC_MESSAGES=en_US;LC_PAPER=en_US;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHON
E=C;LC_MEASUREMENT=en_US;LC_IDENTIFICATION=C

attached base packages:
[1] "methods"   "stats"     "graphics"  "grDevices" "utils"
"datasets"
[7] "base"

other attached packages:
        geoR        gstat     MCMCpack         MASS         coda
lattice
    "1.6-11"     "0.9-34"      "0.7-4"     "7.2-29"     "0.10-7"
"0.14-13"
        mcmc RColorBrewer         maps     maptools           sp
foreign
     "0.5-1"      "0.2-3"     "2.0-32"      "0.6-3"      "0.9-4"
"0.8-17"
     spatial
    "7.2-29"


Thanks
Herry


Dr Alexander Herr
Spatial and statistical analyst
CSIRO, Sustainable Ecosystems
Davies Laboratory,
University Drive, Douglas, QLD 4814 
Private Mail Bag, Aitkenvale, QLD 4814
 
Phone/www 
(07) 4753 8510; 4753 8650(fax)
Home: http://herry.ausbats.org.au
Webadmin ABS: http://ausbats.org.au
Sustainable Ecosystems: http://www.cse.csiro.au/
--------------------------------------------


-----Original Message-----
From: Edzer J. Pebesma [mailto:e.pebesma at geo.uu.nl] 
Sent: Monday, November 27, 2006 5:34 PM
To: Herr, Alexander Herr - Herry (CSE, Townsville)
Cc: r-help at stat.math.ethz.ch; r-sig-geo at stat.math.ethz.ch
Subject: Re: [R-sig-Geo] plot() and Jpeg() increase font size and
resolution

Alexander.Herr at csiro.au wrote:
> Thanks to Edzer and Roger,
> I can now plot with increased font sizes. However, jpeg still does not

> reproduce these, nor does it show up in high quality. What I would 
> like to do is produce some highresolution jpegs.
>   
Please specify the commands that you used, preferrably such that we can
reproduce them, and specify which worked and which didn't the way you
expected. Also please give the output of sessionInfo(), and tell us the
platform you work on. Have you tried producing png, did that work?
--
Edzer
> Any help would be appreciated
>
> Thanx
> Herry
>
>
> R2.4 on Mandriva 10.2 linux.
>
> Dr Alexander Herr
> Spatial and statistical analyst
> CSIRO, Sustainable Ecosystems
> Davies Laboratory,
> University Drive, Douglas, QLD 4814
> Private Mail Bag, Aitkenvale, QLD 4814
>  
> Phone/www
> (07) 4753 8510; 4753 8650(fax)
> Home: http://herry.ausbats.org.au
> Webadmin ABS: http://ausbats.org.au
> Sustainable Ecosystems: http://www.cse.csiro.au/
> --------------------------------------------
>
>
> -----Original Message-----
> From: Edzer J. Pebesma [mailto:e.pebesma at geo.uu.nl]
> Sent: Friday, November 24, 2006 5:37 PM
> To: Herr, Alexander Herr - Herry (CSE, Townsville)
> Cc: r-help at stat.math.ethz.ch; r-sig-geo at stat.math.ethz.ch
> Subject: Re: [R-sig-Geo] plot() and Jpeg() increase font size and 
> resolution
>
> plotting variograms in gstat is done through xyplot in lattice; you'll

> find where it gets it's defaults by
>
> library(lattice)
> trellis.par.get()
> ?trellis.par.set
> --
> Edzer
>
> Alexander.Herr at csiro.au wrote:
>   
>>  
>> Dear list,
>>
>> I am having troubles increasing the fontize when plotting a 
>> variogram{gstat} and its model (vgm) with plot and using jpeg(). Also

>> the resolution in the jpeg call does not work. I am using R2.4 on 
>> Mandriva 10.2 linux.
>>
>> I can change fontsize with cex.axis in a normal plot, so I presume it

>> has to do with plotting the variogram model. Any help on how to 
>> increase the font size and resolution would be appreciated?
>>
>> R-calls:
>> v1<-variogram(log(z)~x+y, loc=coordinates(shp1),data=shp1) 
>> m1<-vgm(0.0175, "Gau", 200000,0.052)
>>
>> jpeg(file="LOTPLAN_variogram_mod.jpg", bg="white", res=300, 
>> pointsize=16, width=1200, height=1200, quality=100)
>>
>>  plot(v1,plot.number=F, model=m1, ylim=c(0.04,0.08), col="black",
>> cex.axis=1.5)
>>
>> dev.off()
>>
>> Thanks Herry
>>
>> Dr Alexander Herr
>> Spatial and statistical analyst
>> CSIRO, Sustainable Ecosystems
>> Davies Laboratory,
>> University Drive, Douglas, QLD 4814
>> Private Mail Bag, Aitkenvale, QLD 4814
>>  
>> Phone/www
>> (07) 4753 8510; 4753 8650(fax)
>> Home: http://herry.ausbats.org.au
>> Webadmin ABS: http://ausbats.org.au
>> Sustainable Ecosystems: http://www.cse.csiro.au/
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>     
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



From e.pebesma at geo.uu.nl  Tue Nov 28 09:24:39 2006
From: e.pebesma at geo.uu.nl (Edzer J. Pebesma)
Date: Tue, 28 Nov 2006 09:24:39 +0100
Subject: [R-sig-Geo] plot() and Jpeg() increase font size and resolution
In-Reply-To: <062AE320EF971E40ACD0F6C93391D769B8BC51@exqld1-tsv.nexus.csiro.au>
References: <062AE320EF971E40ACD0F6C93391D769B8BC51@exqld1-tsv.nexus.csiro.au>
Message-ID: <456BF247.4040107@geo.uu.nl>

Herry, you need to set font size after opening a device; try after your 
example e.g.

png("out.png")
trellis.par.set("fontsize",fontsize)
plt1
dev.off()

Hth,
--
Edzer



Alexander.Herr at csiro.au wrote:
> Hi Edzer,
>
> png also does not increase the file size. 
>
> Following the commands. The data are located at
> ftp://ftp.csiro.au/Herry, file qldproperty.Rdata.
>
> XXXXXXXXXXXXXXXXXXXX
> trellis.par.get("fontsize")->fontsize
>  fontsize$default<-16
>  fontsize$points<-16
>  fontsize$text<-18
>   trellis.par.set("fontsize",fontsize)
> trellis.par.get("fontsize")
>  
>  
>  
> plot(v1,plot.number=F, model=m2, ylim=c(4,9))
>
> plt1<-plot(v1,plot.number=F, model=m1, ylim=c(4,9), col="black",
> pch="+", scales=list(cex=1.5,)) 
>
> jpeg(file="LOTPLAN_variogram_mod.png", bg="white", res=300,
> pointsize=16, width=800, height=800)
>  plt1
> dev.off()
> XXXXXXXXXXXXXXXXXXXXXXXXXXX
>
>
> SessionInfo:
> R version 2.4.0 (2006-10-03)
> i686-pc-linux-gnu
>
> locale:
> LC_CTYPE=en_US;LC_NUMERIC=C;LC_TIME=en_US;LC_COLLATE=en_US;LC_MONETARY=e
> n_US;LC_MESSAGES=en_US;LC_PAPER=en_US;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHON
> E=C;LC_MEASUREMENT=en_US;LC_IDENTIFICATION=C
>
> attached base packages:
> [1] "methods"   "stats"     "graphics"  "grDevices" "utils"
> "datasets"
> [7] "base"
>
> other attached packages:
>         geoR        gstat     MCMCpack         MASS         coda
> lattice
>     "1.6-11"     "0.9-34"      "0.7-4"     "7.2-29"     "0.10-7"
> "0.14-13"
>         mcmc RColorBrewer         maps     maptools           sp
> foreign
>      "0.5-1"      "0.2-3"     "2.0-32"      "0.6-3"      "0.9-4"
> "0.8-17"
>      spatial
>     "7.2-29"
>
>
> Thanks
> Herry
>
>
> Dr Alexander Herr
> Spatial and statistical analyst
> CSIRO, Sustainable Ecosystems
> Davies Laboratory,
> University Drive, Douglas, QLD 4814 
> Private Mail Bag, Aitkenvale, QLD 4814
>  
> Phone/www 
> (07) 4753 8510; 4753 8650(fax)
> Home: http://herry.ausbats.org.au
> Webadmin ABS: http://ausbats.org.au
> Sustainable Ecosystems: http://www.cse.csiro.au/
> --------------------------------------------
>
>
> -----Original Message-----
> From: Edzer J. Pebesma [mailto:e.pebesma at geo.uu.nl] 
> Sent: Monday, November 27, 2006 5:34 PM
> To: Herr, Alexander Herr - Herry (CSE, Townsville)
> Cc: r-help at stat.math.ethz.ch; r-sig-geo at stat.math.ethz.ch
> Subject: Re: [R-sig-Geo] plot() and Jpeg() increase font size and
> resolution
>
> Alexander.Herr at csiro.au wrote:
>   
>> Thanks to Edzer and Roger,
>> I can now plot with increased font sizes. However, jpeg still does not
>>     
>
>   
>> reproduce these, nor does it show up in high quality. What I would 
>> like to do is produce some highresolution jpegs.
>>   
>>     
> Please specify the commands that you used, preferrably such that we can
> reproduce them, and specify which worked and which didn't the way you
> expected. Also please give the output of sessionInfo(), and tell us the
> platform you work on. Have you tried producing png, did that work?
> --
> Edzer
>   
>> Any help would be appreciated
>>
>> Thanx
>> Herry
>>
>>
>> R2.4 on Mandriva 10.2 linux.
>>
>> Dr Alexander Herr
>> Spatial and statistical analyst
>> CSIRO, Sustainable Ecosystems
>> Davies Laboratory,
>> University Drive, Douglas, QLD 4814
>> Private Mail Bag, Aitkenvale, QLD 4814
>>  
>> Phone/www
>> (07) 4753 8510; 4753 8650(fax)
>> Home: http://herry.ausbats.org.au
>> Webadmin ABS: http://ausbats.org.au
>> Sustainable Ecosystems: http://www.cse.csiro.au/
>> --------------------------------------------
>>
>>
>> -----Original Message-----
>> From: Edzer J. Pebesma [mailto:e.pebesma at geo.uu.nl]
>> Sent: Friday, November 24, 2006 5:37 PM
>> To: Herr, Alexander Herr - Herry (CSE, Townsville)
>> Cc: r-help at stat.math.ethz.ch; r-sig-geo at stat.math.ethz.ch
>> Subject: Re: [R-sig-Geo] plot() and Jpeg() increase font size and 
>> resolution
>>
>> plotting variograms in gstat is done through xyplot in lattice; you'll
>>     
>
>   
>> find where it gets it's defaults by
>>
>> library(lattice)
>> trellis.par.get()
>> ?trellis.par.set
>> --
>> Edzer
>>
>> Alexander.Herr at csiro.au wrote:
>>   
>>     
>>>  
>>> Dear list,
>>>
>>> I am having troubles increasing the fontize when plotting a 
>>> variogram{gstat} and its model (vgm) with plot and using jpeg(). Also
>>>       
>
>   
>>> the resolution in the jpeg call does not work. I am using R2.4 on 
>>> Mandriva 10.2 linux.
>>>
>>> I can change fontsize with cex.axis in a normal plot, so I presume it
>>>       
>
>   
>>> has to do with plotting the variogram model. Any help on how to 
>>> increase the font size and resolution would be appreciated?
>>>
>>> R-calls:
>>> v1<-variogram(log(z)~x+y, loc=coordinates(shp1),data=shp1) 
>>> m1<-vgm(0.0175, "Gau", 200000,0.052)
>>>
>>> jpeg(file="LOTPLAN_variogram_mod.jpg", bg="white", res=300, 
>>> pointsize=16, width=1200, height=1200, quality=100)
>>>
>>>  plot(v1,plot.number=F, model=m1, ylim=c(0.04,0.08), col="black",
>>> cex.axis=1.5)
>>>
>>> dev.off()
>>>
>>> Thanks Herry
>>>
>>> Dr Alexander Herr
>>> Spatial and statistical analyst
>>> CSIRO, Sustainable Ecosystems
>>> Davies Laboratory,
>>> University Drive, Douglas, QLD 4814
>>> Private Mail Bag, Aitkenvale, QLD 4814
>>>  
>>> Phone/www
>>> (07) 4753 8510; 4753 8650(fax)
>>> Home: http://herry.ausbats.org.au
>>> Webadmin ABS: http://ausbats.org.au
>>> Sustainable Ecosystems: http://www.cse.csiro.au/
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>>     
>>>       
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>   
>>



From e.pebesma at geo.uu.nl  Tue Nov 28 09:37:23 2006
From: e.pebesma at geo.uu.nl (Edzer J. Pebesma)
Date: Tue, 28 Nov 2006 09:37:23 +0100
Subject: [R-sig-Geo] krige{gstat} error with new data prediction
In-Reply-To: <062AE320EF971E40ACD0F6C93391D769B8BC4B@exqld1-tsv.nexus.csiro.au>
References: <062AE320EF971E40ACD0F6C93391D769B8BC4B@exqld1-tsv.nexus.csiro.au>
Message-ID: <456BF543.9080400@geo.uu.nl>

Hi Herry, the problem is that your trend model specifies a linear trend 
in x and y, the coordinate names of shp1, but that x and y cannot be 
resolved for the prediction locations in a1000 because there they have 
names coords.x1 and coords.x2 (probably chosen default by sp). Perhaps 
you replace z~x+y with z~1 (you seem to have plenty of data), otherwise 
make sure that in both data sets coordinates have the same names.
--
Edzer

Alexander.Herr at csiro.au wrote:
> Hi Edzer,
>
> the data are located at ftp://ftp.csiro.au/Herry, file
> qldproperty.Rdata.
>
> call is:
> k1<-krige(z ~ x+y, ~x+y, data=shp1, newdata=a1000, model=m2, nmax=40)
>
>
> SessionInfo:
> R version 2.4.0 (2006-10-03)
> i686-pc-linux-gnu
>
> locale:
> LC_CTYPE=en_US;LC_NUMERIC=C;LC_TIME=en_US;LC_COLLATE=en_US;LC_MONETARY=e
> n_US;LC_MESSAGES=en_US;LC_PAPER=en_US;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHON
> E=C;LC_MEASUREMENT=en_US;LC_IDENTIFICATION=C
>
> attached base packages:
> [1] "methods"   "stats"     "graphics"  "grDevices" "utils"
> "datasets"
> [7] "base"
>
> other attached packages:
>         geoR        gstat     MCMCpack         MASS         coda
> lattice
>     "1.6-11"     "0.9-34"      "0.7-4"     "7.2-29"     "0.10-7"
> "0.14-13"
>         mcmc RColorBrewer         maps     maptools           sp
> foreign
>      "0.5-1"      "0.2-3"     "2.0-32"      "0.6-3"      "0.9-4"
> "0.8-17"
>      spatial
>     "7.2-29"
>
>
> Thanx
> Herry
>
> Dr Alexander Herr - Herry
> Spatial and statistical analyst
> CSIRO, Sustainable Ecosystems
> Davies Laboratory,
> University Drive, Douglas, QLD 4814 
> Private Mail Bag, Aitkenvale, QLD 4814
>  
> Phone/www 
> (07) 4753 8510; 4753 8650(fax)
> Home: http://herry.ausbats.org.au
> Webadmin ABS: http://ausbats.org.au
> Sustainable Ecosystems: http://www.cse.csiro.au/
> --------------------------------------------
>
>
> -----Original Message-----
> From: Edzer J. Pebesma [mailto:e.pebesma at geo.uu.nl] 
> Sent: Monday, November 27, 2006 5:31 PM
> To: Herr, Alexander Herr - Herry (CSE, Townsville)
> Subject: Re: [R-sig-Geo] krige{gstat} error with new data prediction
>
> Alexander.Herr at csiro.au wrote:
>   
>> Thanks Edzer,
>>
>> k1<-krige(z ~ x+y, shp1, a1000, model=m2, nmax=40) produces the
>> following:
>>
>> Error in eval(expr. envir. enclos): object "x" not found In addition: 
>> Warning message:
>> grid has empty columns/rows in dimension 2 in: points2grid(points, 
>> tolerance).
>>
>> The grid will have empty
>> I was hoping to predict values for within areas (currently assigned 
>> bar some pixels stemming from spatial errors) and ignore those outside
>>     
>
>   
>> (ie the once that fill the grid boundary between study area and 
>> bounding box). I presume the empty columns/rows refer to the NA 
>> outside the study area?
>>
>> Any suggestions?
>>   
>>     
> Yes, provide me with data (off-list), such that I can reproduce your
> problem. Also send me the output of sessionInfo(), and make sure you use
> latest versions of everything.
> --
> Edzer
>   
>> Thanks
>> Herry
>>
>> Dr Alexander Herr
>> Spatial and statistical analyst
>> CSIRO, Sustainable Ecosystems
>> Davies Laboratory,
>> University Drive, Douglas, QLD 4814
>> Private Mail Bag, Aitkenvale, QLD 4814
>>  
>> Phone/www
>> (07) 4753 8510; 4753 8650(fax)
>> Home: http://herry.ausbats.org.au
>> Webadmin ABS: http://ausbats.org.au
>> Sustainable Ecosystems: http://www.cse.csiro.au/
>> --------------------------------------------
>>
>>
>> -----Original Message-----
>> From: Edzer J. Pebesma [mailto:e.pebesma at geo.uu.nl]
>> Sent: Friday, November 24, 2006 5:36 PM
>> To: Herr, Alexander Herr - Herry (CSE, Townsville)
>> Cc: r-sig-geo at stat.math.ethz.ch
>> Subject: Re: [R-sig-Geo] krige{gstat} error with new data prediction
>>
>> Herry, in
>>
>> k1<-krige(z ~ x+y, ~x+y, data=shp1, newdata=a1000, model=m2, nmax=40)
>>
>>
>> shpl is alread a SpatialPointsDataFrame object, so you shouldn't 
>> specify it's coordinates, ~x+y. Rather, use
>>
>> k1<-krige(z ~ x+y, shp1, a1000, model=m2, nmax=40)
>>
>>
>> I must admit that a more helpful error message would be useful here, 
>> as this starts to become a FAQ.
>> --
>> Edzer
>>
>> Alexander.Herr at csiro.au wrote:
>>   
>>     
>>> Dear list,
>>>
>>> I am using point data of an area as shapefile import (shp1). The 
>>> attribute data is log(AREA) as z reflecting areas size of the
>>>     
>>>       
>> polygons.
>>   
>>     
>>> Grid data (1000m pixel) as ascii grid imports (a1000) of the same 
>>> bounding box. Point and grid file stem from ArcInfo imported into R 
>>> using readShapePoints() and readAsciiGrid, this producing 
>>> SpatialPointsDataFrame and SpatialGridDataFrame.
>>>
>>> I was hoping to predict the missing areas between the points with 
>>> kriging but to no avail. What am I doing wrong?
>>>
>>>
>>> Code:
>>>
>>> library(spatial)
>>> library(maptools)
>>> library(maps)
>>> library(geoR)
>>> library(gstat)
>>>
>>> #v1<-variogram(z~x+y, loc=coordinates(shp1),data=shp1) 
>>> #XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXx
>>> load("qldproperty.Rdata") #this has all data and v1
>>>
>>> plot(v1,plot.numbers=T)
>>> m1<-vgm(2.7,"Gau",200000,5.75)
>>> plot(v1,plot.number=F, model=m1, ylim=c(4,9))
>>>
>>> m2<-fit.variogram(v1,model=m1)
>>> plot(v1,plot.number=F, model=m2, ylim=c(4,9))
>>>
>>>
>>> #Xvalidation
>>> shp1 at coords[,1]->x
>>> shp1 at coords[,2]->y
>>> shp1$z->z
>>> as.data.frame(cbind(x,y,z))->dta1
>>> kcv<-krige.cv(z~x+y, ~x+y, dta1, model=m2, nmax=40, nfold=50,
>>> verbose=TRUE,maxdist=10000)
>>> truehist(kcv$residual, xlim=c(-20,20), h=1, col="grey") 
>>> rownames(kcv[is.na(kcv$residual),])->exclude
>>> kcv[!rownames(kcv) %in% exclude,]->tmp
>>>
>>> #goodness of fit: Mean error (0), Root Mean square error (low), and 
>>> mean squared Dev.ratio. (1) 
>>> mean(tmp$residual);mean(tmp$residual**2);mean((tmp$residual)**2/tmp$v
>>> a
>>> r1
>>> .var)
>>>
>>> coordinates(tmp)<- ~x+y
>>> bubble(tmp, "residual", main = "log(area): 50-fold validated krieging
>>> residuals",fill=F)
>>>
>>> k1<-krige(z ~ x+y, ~x+y, data=shp1, newdata=a1000, model=m2, nmax=40)
>>>
>>>
>>> Error:
>>> Error in function (classes, fdef, mtable)  :
>>>         unable to find an inherited method for function 
>>> "coordinates<-", for signature "SpatialPointsDataFrame"
>>>   
>>>     
>>>       
>>>>  
>>>>     
>>>>       
>>>>         
>>> Running R2.4 on Mandrake linux 10.2
>>>
>>> The data is at ftp://ftp.csiro.au/Herry/ file: qldproperty.Rdata
>>>
>>> Any help appreciated. 
>>> Thanx
>>> Herry
>>>
>>> Dr Alexander Herr
>>> Spatial and statistical analyst
>>> CSIRO, Sustainable Ecosystems
>>> Davies Laboratory,
>>> University Drive, Douglas, QLD 4814
>>> Private Mail Bag, Aitkenvale, QLD 4814
>>>  
>>> Phone/www
>>> (07) 4753 8510; 4753 8650(fax)
>>> Home: http://herry.ausbats.org.au
>>> Webadmin ABS: http://ausbats.org.au
>>> Sustainable Ecosystems: http://www.cse.csiro.au/
>>> --------------------------------------------
>>>
>>>
>>> -----Original Message-----
>>> From: r-sig-geo-bounces at stat.math.ethz.ch
>>> [mailto:r-sig-geo-bounces at stat.math.ethz.ch] On Behalf Of 
>>> r-sig-geo-request at stat.math.ethz.ch
>>> Sent: Tuesday, August 15, 2006 8:00 PM
>>> To: r-sig-geo at stat.math.ethz.ch
>>> Subject: R-sig-Geo Digest, Vol 36, Issue 12
>>>
>>> Send R-sig-Geo mailing list submissions to
>>> 	r-sig-geo at stat.math.ethz.ch
>>>
>>> To subscribe or unsubscribe via the World Wide Web, visit
>>> 	https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>> or, via email, send a message with subject or body 'help' to
>>> 	r-sig-geo-request at stat.math.ethz.ch
>>>
>>> You can reach the person managing the list at
>>> 	r-sig-geo-owner at stat.math.ethz.ch
>>>
>>> When replying, please edit your Subject line so it is more specific 
>>> than
>>> "Re: Contents of R-sig-Geo digest..."
>>>
>>>
>>> Today's Topics:
>>>
>>>    1. Linking lm residuls to specific polygon in shape files
>>>       (David Martell)
>>>    2. Re: Linking lm residuls to specific polygon in shape files
>>>       (Roger Bivand)
>>>    3. Re: Linking lm residuls to specific polygon in shape files
>>>       (David Martell)
>>>
>>>
>>> ---------------------------------------------------------------------
>>> -
>>>
>>> Message: 1
>>> Date: Mon, 14 Aug 2006 14:26:19 -0400
>>> From: David Martell <martell at smokey.forestry.utoronto.ca>
>>> Subject: [R-sig-Geo] Linking lm residuls to specific polygon in shape
>>> 	files
>>> To: r-sig-geo at stat.math.ethz.ch
>>> Message-ID:
>>> 	<Pine.SOL.4.55.0608141416550.867 at smokey.forestry.utoronto.ca>
>>> Content-Type: TEXT/PLAIN; charset=US-ASCII
>>>
>>>
>>> I am using the lm.morantest procedure in spdep to test for spatial 
>>> autocorrelation in my lm residuals.
>>>
>>> I am not sure where this procedure gets the residuals.
>>>
>>> I have prepared a GIS coverage that has a .shp file.  I ran the lm 
>>> model, produced the residuals, then put them them in the GIS
>>>       
> coverage.
>   
>>> When I run lm in my R program, it produces an lm object that also 
>>> contains the residuals.
>>>
>>>
>>> Does lm.morantest get the residuals from the .shp file or the lm
>>>     
>>>       
>> object.
>>   
>>     
>>> If it gets them from the latter, how does it determine which residual
>>>       
>
>   
>>> is assigned to which polygon in the .shp file.
>>>
>>> Thanks,
>>>
>>> Dave Martell
>>>
>>> _____________________________________________________________
>>>
>>> David L. Martell, Professor
>>> Faculty of Forestry, University of Toronto
>>> 33 Willcocks Street, Toronto, Ontario, Canada, M5S 3B3
>>>
>>> E-mail:  martell at smokey.forestry.utoronto.ca
>>> URL:     http://www.firelab.utoronto.ca
>>> Phone:   (416) 978-6960
>>> Fax:     (416) 978-3834
>>> Map:     ES on campus map at http://oracle.osm.utoronto.ca/map/
>>>
>>>
>>>
>>> ------------------------------
>>>
>>> Message: 2
>>> Date: Mon, 14 Aug 2006 22:12:55 +0200 (CEST)
>>> From: Roger Bivand <Roger.Bivand at nhh.no>
>>> Subject: Re: [R-sig-Geo] Linking lm residuls to specific polygon in
>>> 	shape files
>>> To: David Martell <martell at smokey.forestry.utoronto.ca>
>>> Cc: r-sig-geo at stat.math.ethz.ch
>>> Message-ID: <Pine.LNX.4.44.0608142156080.13097-100000 at reclus.nhh.no>
>>> Content-Type: TEXT/PLAIN; charset=US-ASCII
>>>
>>> On Mon, 14 Aug 2006, David Martell wrote:
>>>
>>>   
>>>     
>>>       
>>>> I am using the lm.morantest procedure in spdep to test for spatial 
>>>> autocorrelation in my lm residuals.
>>>>
>>>> I am not sure where this procedure gets the residuals.
>>>>
>>>> I have prepared a GIS coverage that has a .shp file.  I ran the lm 
>>>> model, produced the residuals, then put them them in the GIS
>>>>       
>>>>         
>> coverage.
>>   
>>     
>>>> When I run lm in my R program, it produces an lm object that also 
>>>> contains the residuals.
>>>>
>>>>
>>>> Does lm.morantest get the residuals from the .shp file or the lm
>>>>     
>>>>       
>>>>         
>>> object.
>>>   
>>>     
>>>       
>>>> If it gets them from the latter, how does it determine which 
>>>> residual
>>>>       
>>>>         
>>   
>>     
>>>> is assigned to which polygon in the .shp file.
>>>>     
>>>>       
>>>>         
>>> lm.morantest() uses the whole "lm" object returned by lm(), so the 
>>> residuals are by definition in the same order as the variables 
>>> included in the model formula. If you need tight control, do 
>>> something
>>>     
>>>       
>> like this:
>>   
>>     
>>> xx <- readShapePoly(system.file("shapes/columbus.shp",
>>>   package="maptools")[1], IDvar="NEIGNO") row.names(as(xx,
>>> "data.frame")) xx_nb <- poly2nb(as(xx, "SpatialPolygons")) 
>>> attr(xx_nb,
>>> "region.id") lm_obj <- lm(CRIME ~ INC + HOVAL, data=xx)
>>> names(residuals(lm_obj))
>>> lm.morantest(lm_obj, nb2listw(xx_nb), spChk=TRUE)
>>>
>>> where spChk=TRUE checks the equality of the names of the residuals of
>>>       
>
>   
>>> the "lm" object (taken from the data= object of the call to lm()) 
>>> with
>>>     
>>>       
>>   
>>     
>>> the "region.id" attribute of the neighbour list. From the time the 
>>> sapefile is read, it has nothing more to do with the 
>>> SpatialPolygonsDataFrame object (here xx). Doing something like:
>>>
>>> xx$lm_obj_resids <- residuals(lm_obj)
>>>
>>> and then
>>>
>>> writePolyShape(xx, "newshape")
>>>
>>> includes them in a new shapefile.
>>>
>>> Does this clarify things?
>>>
>>> Roger
>>>
>>>   
>>>     
>>>       
>>>> Thanks,
>>>>
>>>> Dave Martell
>>>>
>>>> _____________________________________________________________
>>>>
>>>> David L. Martell, Professor
>>>> Faculty of Forestry, University of Toronto
>>>> 33 Willcocks Street, Toronto, Ontario, Canada, M5S 3B3
>>>>
>>>> E-mail:  martell at smokey.forestry.utoronto.ca
>>>> URL:     http://www.firelab.utoronto.ca
>>>> Phone:   (416) 978-6960
>>>> Fax:     (416) 978-3834
>>>> Map:     ES on campus map at http://oracle.osm.utoronto.ca/map/
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at stat.math.ethz.ch
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>>     
>>>>       
>>>>         
>>> --
>>> Roger Bivand
>>> Economic Geography Section, Department of Economics, Norwegian School
>>>       
>
>   
>>> of Economics and Business Administration, Helleveien 30, N-5045 
>>> Bergen, Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>>> e-mail: Roger.Bivand at nhh.no
>>>
>>>
>>>
>>> ------------------------------
>>>
>>> Message: 3
>>> Date: Mon, 14 Aug 2006 16:19:25 -0400
>>> From: David Martell <martell at smokey.forestry.utoronto.ca>
>>> Subject: Re: [R-sig-Geo] Linking lm residuls to specific polygon in
>>> 	shape files
>>> To: Roger Bivand <Roger.Bivand at nhh.no>
>>> Cc: r-sig-geo at stat.math.ethz.ch
>>> Message-ID:
>>> 	<Pine.SOL.4.55.0608141617260.867 at smokey.forestry.utoronto.ca>
>>> Content-Type: TEXT/PLAIN; charset=US-ASCII
>>>
>>>
>>> Hello Roger,
>>>
>>> Yes, that's very helpful.
>>>
>>> Thanks very much,
>>>
>>> Dave Martell
>>>
>>>
>>> On Mon, 14 Aug 2006, Roger Bivand wrote:
>>>
>>>   
>>>     
>>>       
>>>> On Mon, 14 Aug 2006, David Martell wrote:
>>>>
>>>>     
>>>>       
>>>>         
>>>>> I am using the lm.morantest procedure in spdep to test for spatial 
>>>>> autocorrelation in my lm residuals.
>>>>>
>>>>> I am not sure where this procedure gets the residuals.
>>>>>
>>>>> I have prepared a GIS coverage that has a .shp file.  I ran the lm
>>>>>       
>>>>>         
>>>>>           
>>> model,
>>>   
>>>     
>>>       
>>>>> produced the residuals, then put them them in the GIS coverage.
>>>>>
>>>>>
>>>>> When I run lm in my R program, it produces an lm object that also
>>>>>       
>>>>>         
>>>>>           
>>> contains
>>>   
>>>     
>>>       
>>>>> the residuals.
>>>>>
>>>>>
>>>>> Does lm.morantest get the residuals from the .shp file or the lm
>>>>>       
>>>>>         
>>>>>           
>>> object.
>>>   
>>>     
>>>       
>>>>> If it gets them from the latter, how does it determine which
>>>>>       
>>>>>         
>>>>>           
>>> residual is
>>>   
>>>     
>>>       
>>>>> assigned to which polygon in the .shp file.
>>>>>       
>>>>>         
>>>>>           
>>>> lm.morantest() uses the whole "lm" object returned by lm(), so the 
>>>> residuals are by definition in the same order as the variables
>>>>     
>>>>       
>>>>         
>>> included in
>>>   
>>>     
>>>       
>>>> the model formula. If you need tight control, do something like
>>>>         
> this:
>   
>>>> xx <- readShapePoly(system.file("shapes/columbus.shp",
>>>>   package="maptools")[1], IDvar="NEIGNO") row.names(as(xx,
>>>> "data.frame")) xx_nb <- poly2nb(as(xx, "SpatialPolygons")) 
>>>> attr(xx_nb, "region.id") lm_obj <- lm(CRIME ~ INC + HOVAL, data=xx)
>>>> names(residuals(lm_obj))
>>>> lm.morantest(lm_obj, nb2listw(xx_nb), spChk=TRUE)
>>>>
>>>> where spChk=TRUE checks the equality of the names of the residuals 
>>>> of
>>>>     
>>>>       
>>>>         
>>> the
>>>   
>>>     
>>>       
>>>> "lm" object (taken from the data= object of the call to lm()) with 
>>>> the "region.id" attribute of the neighbour list. From the time the
>>>>     
>>>>       
>>>>         
>>> sapefile is
>>>   
>>>     
>>>       
>>>> read, it has nothing more to do with the SpatialPolygonsDataFrame
>>>>     
>>>>       
>>>>         
>>> object
>>>   
>>>     
>>>       
>>>> (here xx). Doing something like:
>>>>
>>>> xx$lm_obj_resids <- residuals(lm_obj)
>>>>
>>>> and then
>>>>
>>>> writePolyShape(xx, "newshape")
>>>>
>>>> includes them in a new shapefile.
>>>>
>>>> Does this clarify things?
>>>>
>>>> Roger
>>>>
>>>>     
>>>>       
>>>>         
>>>>> Thanks,
>>>>>
>>>>> Dave Martell
>>>>>
>>>>> _____________________________________________________________
>>>>>
>>>>> David L. Martell, Professor
>>>>> Faculty of Forestry, University of Toronto
>>>>> 33 Willcocks Street, Toronto, Ontario, Canada, M5S 3B3
>>>>>
>>>>> E-mail:  martell at smokey.forestry.utoronto.ca
>>>>> URL:     http://www.firelab.utoronto.ca
>>>>> Phone:   (416) 978-6960
>>>>> Fax:     (416) 978-3834
>>>>> Map:     ES on campus map at http://oracle.osm.utoronto.ca/map/
>>>>>
>>>>> _______________________________________________
>>>>> R-sig-Geo mailing list
>>>>> R-sig-Geo at stat.math.ethz.ch
>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>
>>>>>       
>>>>>         
>>>>>           
>>>> --
>>>> Roger Bivand
>>>> Economic Geography Section, Department of Economics, Norwegian 
>>>> School
>>>>     
>>>>       
>>>>         
>>> of
>>>   
>>>     
>>>       
>>>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>>>>         
>
>   
>>>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>>>> e-mail: Roger.Bivand at nhh.no
>>>>
>>>>
>>>>     
>>>>       
>>>>         
>>> _____________________________________________________________
>>>
>>> David L. Martell, Professor
>>> Faculty of Forestry, University of Toronto
>>> 33 Willcocks Street, Toronto, Ontario, Canada, M5S 3B3
>>>
>>> E-mail:  martell at smokey.forestry.utoronto.ca
>>> URL:     http://www.firelab.utoronto.ca
>>> Phone:   (416) 978-6960
>>> Fax:     (416) 978-3834
>>> Map:     ES on campus map at http://oracle.osm.utoronto.ca/map/
>>>
>>>
>>>
>>> ------------------------------
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>>
>>> End of R-sig-Geo Digest, Vol 36, Issue 12
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>   
>>>     
>>>



From stratja at auburn.edu  Tue Nov 28 16:55:50 2006
From: stratja at auburn.edu (Jeffrey Stratford)
Date: Tue, 28 Nov 2006 09:55:50 -0600
Subject: [R-sig-Geo] neg bin models with errorsalm and lagsarlm
Message-ID: <456C07A6020000F20001ADDA@TMIA1.AUBURN.EDU>

Hi folks,

Is it appropriate to use a negative binomial with errorsalm and
lagsarlm?  If not is there an alternative to do spatial error and
spatial models with a negative binomial?  

Thanks,

Jeff

****************************************
Jeffrey A. Stratford, Ph.D.
Postdoctoral Associate
331 Funchess Hall
Department of Biological Sciences
Auburn University
Auburn, AL 36849
334-329-9198
FAX 334-844-9234
http://www.auburn.edu/~stratja



From Roger.Bivand at nhh.no  Tue Nov 28 18:25:14 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 28 Nov 2006 18:25:14 +0100 (CET)
Subject: [R-sig-Geo] neg bin models with errorsalm and lagsarlm
In-Reply-To: <456C07A6020000F20001ADDA@TMIA1.AUBURN.EDU>
Message-ID: <Pine.LNX.4.44.0611281802080.9896-100000@reclus.nhh.no>

On Tue, 28 Nov 2006, Jeffrey Stratford wrote:

> Hi folks,
> 
> Is it appropriate to use a negative binomial with errorsalm and
> lagsarlm?  If not is there an alternative to do spatial error and
> spatial models with a negative binomial?  

The spatial regression fitting functions are written for an assumed 
continuous dependent variable with Gaussian errors, so they are not 
suitable for the negative binomial case. You could try the autocov_dist 
function or equivalents on its help page as a quick fix, otherwise this 
probably looks like WinBUGS with your choice of CAR.

Roger

> 
> Thanks,
> 
> Jeff
> 
> ****************************************
> Jeffrey A. Stratford, Ph.D.
> Postdoctoral Associate
> 331 Funchess Hall
> Department of Biological Sciences
> Auburn University
> Auburn, AL 36849
> 334-329-9198
> FAX 334-844-9234
> http://www.auburn.edu/~stratja
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From Tom.Mulholland at dpi.wa.gov.au  Wed Nov 29 07:35:32 2006
From: Tom.Mulholland at dpi.wa.gov.au (Mulholland, Tom)
Date: Wed, 29 Nov 2006 14:35:32 +0800
Subject: [R-sig-Geo] Saving jpeg world files
Message-ID: <4702645135092E4497088F71D9C8F51A0224E62B@afhex01.dpi.wa.gov.au>

I am beginning to get a little bit bog eyed with the myriad of options there are within the various spatial packages. I am trying to find ways of porting the results I get within R into a GIS environment and I can't seem to see anything that would let me write a jpeg file with an appropriate world file.

I have managed to create an ASCIIGrid but my first tests seem to indicate that not all grids are created equally. My experience with some of the "free" windows GIS applications is that jpg files seem to be more universally supported, so I thought that might be a more fruitful way to go. I will then have to worry less about making sure my output is the type that can be imported.

It looks to me as if the class "im" in spatstat is conceptually straightforward to process. It looks as if all the attributes are there to create a world file. Since my data is already projected it would seem that I should be able to simply use the jpeg device for output (not that I have any idea how I'll go about that) and create a text file to go along with it.

The first question is 'Am I missing something really simple?' and the second is "Is there a straightforward solution that I have already missed."

Tom

platform       i386-pc-mingw32             
arch           i386                        
os             mingw32                     
system         i386, mingw32               
status                                     
major          2                           
minor          4.0                         
year           2006                        
month          10                          
day            03                          
svn rev        39566                       
language       R                           
version.string R version 2.4.0 (2006-10-03) 

Tom Mulholland
Senior Demographer
Applied Research and Modelling
State and Regional Policy
Department for Planning and Infrastructure
Perth, Western Australia
+61 (08) 9264 7936



From Roger.Bivand at nhh.no  Wed Nov 29 09:12:22 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 29 Nov 2006 09:12:22 +0100 (CET)
Subject: [R-sig-Geo] Saving jpeg world files
In-Reply-To: <4702645135092E4497088F71D9C8F51A0224E62B@afhex01.dpi.wa.gov.au>
Message-ID: <Pine.LNX.4.44.0611290844190.10691-100000@reclus.nhh.no>

On Wed, 29 Nov 2006, Mulholland, Tom wrote:

> I am beginning to get a little bit bog eyed with the myriad of options
> there are within the various spatial packages. I am trying to find ways
> of porting the results I get within R into a GIS environment and I can't
> seem to see anything that would let me write a jpeg file with an
> appropriate world file.

The most direct route is to use a SpatialGridDataFrame or equivalently 
SpatialPixelDataFrame, and writeGDAL() in rgdal. That gives very good 
support for GeoTiff files. The JPEG driver is present, but much more 
limited than GeoTiff - it has to be either single-band or three-band, and 
only Byte data. For released rgdal, you would write the jpeg from a single 
variable by stretching it over 0-255, taking integers, writing as GeoTiff 
to a temp file, opening the file as a GDAL data set, copying to JPEG, 
and saving:

library(sp)
library(rgdal)
data(meuse.grid)
coordinates(meuse.grid) <- c("x", "y")
gridded(meuse.grid) <- TRUE
# quantize
rd <- range(meuse.grid$dist)
meuse.grid$idist <- as.integer(255*(meuse.grid$dist-rd[1])/(rd[2]-rd[1]))
# write temporary GTiff
tf <- tempfile()
writeGDAL(meuse.grid["idist"], tf, drivername="GTiff", type="Byte")
# open temporary file as GDAL dataset and copy to JPEG
x <- GDAL.open(tf)
dx <- copyDataset(x, driver="JPEG", options="WORLDFILE=YES")
# and write out
td <- tempdir()
tf1 <- paste(td, "output.jpg", sep="/")
saveDataset(dx, tf1, options="WORLDFILE=YES")
GDAL.close(x)
GDAL.close(dx)
# check to see if worldfile present and OK (*.wld use cell centre 
# registration, the bounding box goes to the cell boundaries
list.files(td)
slot(meuse.grid, "grid")
file.show(paste(td, "output.wld", sep="/"))

Had rgdal and the underlying GDAL library allowed jpeg files to be written 
directly, this would be simpler. However, you may find that the software 
that reads jpeg files also reads GeoTiff files, which are far more 
flexible, taking many more data types, including floating point values.

For those interested in image overlays in Google Earth, this recipe lets 
you make PNG files too (but so far I haven't got GE to read a worldfile to 
place the image, and of course GE wants geographical coordinates). PNG 
support an alpha channel too.

Hope this isn't too complicated. We probably need an interface between im 
and sp classes so that getting from im to GDAL is simpler.

Roger


> 
> I have managed to create an ASCIIGrid but my first tests seem to
> indicate that not all grids are created equally. My experience with some
> of the "free" windows GIS applications is that jpg files seem to be more
> universally supported, so I thought that might be a more fruitful way to
> go. I will then have to worry less about making sure my output is the
> type that can be imported.
> 
> It looks to me as if the class "im" in spatstat is conceptually
> straightforward to process. It looks as if all the attributes are there
> to create a world file. Since my data is already projected it would seem
> that I should be able to simply use the jpeg device for output (not that
> I have any idea how I'll go about that) and create a text file to go
> along with it.
> 
> The first question is 'Am I missing something really simple?' and the
> second is "Is there a straightforward solution that I have already
> missed."
> 
> Tom
> 
> platform       i386-pc-mingw32             
> arch           i386                        
> os             mingw32                     
> system         i386, mingw32               
> status                                     
> major          2                           
> minor          4.0                         
> year           2006                        
> month          10                          
> day            03                          
> svn rev        39566                       
> language       R                           
> version.string R version 2.4.0 (2006-10-03) 
> 
> Tom Mulholland
> Senior Demographer
> Applied Research and Modelling
> State and Regional Policy
> Department for Planning and Infrastructure
> Perth, Western Australia
> +61 (08) 9264 7936
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From carm_rodrig at hotmail.com  Wed Nov 29 10:57:14 2006
From: carm_rodrig at hotmail.com (CARMEN RODRIGUEZ)
Date: Wed, 29 Nov 2006 09:57:14 +0000
Subject: [R-sig-Geo] GWR
Message-ID: <BAY104-F30853618EA1984A6D6A20488E40@phx.gbl>

I insist on GWR. To run a GWR model I'm using both R and GWR 3.0. Comparing 
the estimated coefficients for an adaptative bisquare kernel in R with the 
results for an adaptative kernel in GWR 3.0 (which is supposed to be a 
bisquare function too), differences are very big. I check the bandwidths and 
they are not that different (as I understand, in R the adaptative bandwidth 
is expressed as a percentage of observations, while in GWR 3.0 the bandwidth 
is the number of observations itself). But anyway, the estimated 
coefficients shouldn't be so different, should they?

Thank you.

_________________________________________________________________
Descubre la descarga digital con MSN Music. M?s de un mill?n de canciones.



From Roger.Bivand at nhh.no  Wed Nov 29 11:33:56 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 29 Nov 2006 11:33:56 +0100 (CET)
Subject: [R-sig-Geo] GWR
In-Reply-To: <BAY104-F30853618EA1984A6D6A20488E40@phx.gbl>
Message-ID: <Pine.LNX.4.44.0611291130250.10691-100000@reclus.nhh.no>

On Wed, 29 Nov 2006, CARMEN RODRIGUEZ wrote:

> I insist on GWR. To run a GWR model I'm using both R and GWR 3.0. Comparing 
> the estimated coefficients for an adaptative bisquare kernel in R with the 
> results for an adaptative kernel in GWR 3.0 (which is supposed to be a 
> bisquare function too), differences are very big. I check the bandwidths and 
> they are not that different (as I understand, in R the adaptative bandwidth 
> is expressed as a percentage of observations, while in GWR 3.0 the bandwidth 
> is the number of observations itself). But anyway, the estimated 
> coefficients shouldn't be so different, should they?

Well, without documentation, it is impossible to tell. So please provide 
documentation, access to data and scripts of what you are doing that 
worries you. We cannot see over your shoulder.

Roger

> 
> Thank you.
> 
> _________________________________________________________________
> Descubre la descarga digital con MSN Music. M?s de un mill?n de canciones.
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From tmulholland at bigpond.com  Wed Nov 29 12:10:20 2006
From: tmulholland at bigpond.com (Tom Mulholland)
Date: Wed, 29 Nov 2006 19:10:20 +0800
Subject: [R-sig-Geo] Saving jpeg world files
In-Reply-To: <Pine.LNX.4.44.0611290844190.10691-100000@reclus.nhh.no>
References: <Pine.LNX.4.44.0611290844190.10691-100000@reclus.nhh.no>
Message-ID: <456D6A9C.9070603@bigpond.com>

Doh! I had completely forgotten about rgdal. That's exactly the route I 
need to take.

Thanks

Roger Bivand wrote:
> On Wed, 29 Nov 2006, Mulholland, Tom wrote:
> 
>> I am beginning to get a little bit bog eyed with the myriad of options
>> there are within the various spatial packages. I am trying to find ways
>> of porting the results I get within R into a GIS environment and I can't
>> seem to see anything that would let me write a jpeg file with an
>> appropriate world file.
> 
> The most direct route is to use a SpatialGridDataFrame or equivalently 
> SpatialPixelDataFrame, and writeGDAL() in rgdal. That gives very good 
> support for GeoTiff files. The JPEG driver is present, but much more 
> limited than GeoTiff - it has to be either single-band or three-band, and 
> only Byte data. For released rgdal, you would write the jpeg from a single 
> variable by stretching it over 0-255, taking integers, writing as GeoTiff 
> to a temp file, opening the file as a GDAL data set, copying to JPEG, 
> and saving:
> 
> library(sp)
> library(rgdal)
> data(meuse.grid)
> coordinates(meuse.grid) <- c("x", "y")
> gridded(meuse.grid) <- TRUE
> # quantize
> rd <- range(meuse.grid$dist)
> meuse.grid$idist <- as.integer(255*(meuse.grid$dist-rd[1])/(rd[2]-rd[1]))
> # write temporary GTiff
> tf <- tempfile()
> writeGDAL(meuse.grid["idist"], tf, drivername="GTiff", type="Byte")
> # open temporary file as GDAL dataset and copy to JPEG
> x <- GDAL.open(tf)
> dx <- copyDataset(x, driver="JPEG", options="WORLDFILE=YES")
> # and write out
> td <- tempdir()
> tf1 <- paste(td, "output.jpg", sep="/")
> saveDataset(dx, tf1, options="WORLDFILE=YES")
> GDAL.close(x)
> GDAL.close(dx)
> # check to see if worldfile present and OK (*.wld use cell centre 
> # registration, the bounding box goes to the cell boundaries
> list.files(td)
> slot(meuse.grid, "grid")
> file.show(paste(td, "output.wld", sep="/"))
> 
> Had rgdal and the underlying GDAL library allowed jpeg files to be written 
> directly, this would be simpler. However, you may find that the software 
> that reads jpeg files also reads GeoTiff files, which are far more 
> flexible, taking many more data types, including floating point values.
> 
> For those interested in image overlays in Google Earth, this recipe lets 
> you make PNG files too (but so far I haven't got GE to read a worldfile to 
> place the image, and of course GE wants geographical coordinates). PNG 
> support an alpha channel too.
> 
> Hope this isn't too complicated. We probably need an interface between im 
> and sp classes so that getting from im to GDAL is simpler.
> 
> Roger
> 
> 
>> I have managed to create an ASCIIGrid but my first tests seem to
>> indicate that not all grids are created equally. My experience with some
>> of the "free" windows GIS applications is that jpg files seem to be more
>> universally supported, so I thought that might be a more fruitful way to
>> go. I will then have to worry less about making sure my output is the
>> type that can be imported.
>>
>> It looks to me as if the class "im" in spatstat is conceptually
>> straightforward to process. It looks as if all the attributes are there
>> to create a world file. Since my data is already projected it would seem
>> that I should be able to simply use the jpeg device for output (not that
>> I have any idea how I'll go about that) and create a text file to go
>> along with it.
>>
>> The first question is 'Am I missing something really simple?' and the
>> second is "Is there a straightforward solution that I have already
>> missed."
>>
>> Tom
>>
>> platform       i386-pc-mingw32             
>> arch           i386                        
>> os             mingw32                     
>> system         i386, mingw32               
>> status                                     
>> major          2                           
>> minor          4.0                         
>> year           2006                        
>> month          10                          
>> day            03                          
>> svn rev        39566                       
>> language       R                           
>> version.string R version 2.4.0 (2006-10-03) 
>>
>> Tom Mulholland
>> Senior Demographer
>> Applied Research and Modelling
>> State and Regional Policy
>> Department for Planning and Infrastructure
>> Perth, Western Australia
>> +61 (08) 9264 7936
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>



From Luisr at frs.fo  Wed Nov 29 12:40:25 2006
From: Luisr at frs.fo (Luis Ridao Cruz)
Date: Wed, 29 Nov 2006 11:40:25 +0000
Subject: [R-sig-Geo] group data into squares
Message-ID: <s56d71b1.063@ffdata.setur.fo>

R-sig-geo-help,

I have locations of fish abundance
which I want to aggregate into squares.

The code below creates the grid:


library(sp)
test <- GridTopology(c(-10.5,60),c(0.1,0.1),c(67,35))
coordinates(test)
coordinatevalues(test)
yy <-SpatialGrid(grid=test)
plot(yy,pch=16,cex=0.3,col=1)

and within each cell the total abundance of fish
should be specified.

How can I do this?


Thanks in advance


> version
               _                           
platform       i386-pc-mingw32             
arch           i386                        
os             mingw32                     
system         i386, mingw32               
status                                     
major          2                           
minor          4.0                         
year           2006                        
month          10                          
day            03                          
svn rev        39566                       
language       R                           
version.string R version 2.4.0 (2006-10-03)
>



From calenge at biomserv.univ-lyon1.fr  Wed Nov 29 13:07:59 2006
From: calenge at biomserv.univ-lyon1.fr (=?ISO-8859-1?Q?Cl=E9ment_Calenge?=)
Date: Wed, 29 Nov 2006 13:07:59 +0100
Subject: [R-sig-Geo] group data into squares
In-Reply-To: <s56d71b1.063@ffdata.setur.fo>
References: <s56d71b1.063@ffdata.setur.fo>
Message-ID: <456D781F.2080302@biomserv.univ-lyon1.fr>

Dear Luis,

> The code below creates the grid:
>
>
> library(sp)
> test <- GridTopology(c(-10.5,60),c(0.1,0.1),c(67,35))
> coordinates(test)
> coordinatevalues(test)
> yy <-SpatialGrid(grid=test)
> plot(yy,pch=16,cex=0.3,col=1)
>
> and within each cell the total abundance of fish
> should be specified.
>
> How can I do this?
>   
You can try the functions ascgen() and/or count.points() from the 
package adehabitat. Then, use the function asc2spixdf to convert the 
result to the class SpatialGridDataFrame.
Hope this helps,


Cl?ment Calenge

-- 
Cl?ment CALENGE
LBBE - UMR CNRS 5558 - Universit? Claude Bernard Lyon 1 - FRANCE
tel. (+33) 04.72.43.27.57
fax. (+33) 04.72.43.13.88



From Roger.Bivand at nhh.no  Wed Nov 29 13:43:21 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 29 Nov 2006 13:43:21 +0100 (CET)
Subject: [R-sig-Geo] group data into squares
In-Reply-To: <s56d71b1.063@ffdata.setur.fo>
Message-ID: <Pine.LNX.4.44.0611291317450.10691-100000@reclus.nhh.no>

On Wed, 29 Nov 2006, Luis Ridao Cruz wrote:

> R-sig-geo-help,
> 
> I have locations of fish abundance
> which I want to aggregate into squares.
> 
> The code below creates the grid:
> 
> 
> library(sp)
> test <- GridTopology(c(-10.5,60),c(0.1,0.1),c(67,35))
> coordinates(test)
> coordinatevalues(test)
> yy <-SpatialGrid(grid=test)
> plot(yy,pch=16,cex=0.3,col=1)
> 
> and within each cell the total abundance of fish
> should be specified.
> 
> How can I do this?

Use the overlay() method. Something like:

fish <- SpatialPoints(cbind(runif(10000, bbox(yy)[1,1], bbox(yy)[1,2]), 
  runif(10000, bbox(yy)[2,1], bbox(yy)[2,2])))
plot(fish, add=TRUE, pch=".", col="green")
out <- overlay(yy, fish)
out1 <- formatC(out, width=4, format="d", flag="0")
# otherwise it sorts 1, 10, 100, ...
res <- aggregate(rep(1, length(out)), list(out1), sum)

and res$x are the counts. Because some cells have zero counts, they are 
not in res$Group.1, so maybe:

res1 <- numeric(nrow(coordinates(yy)))
res1[as.integer(as.character(res$Group.1))] <- res$x
# to insert the values in the cells with positive counts
table(res1)

where the zero counts are now in place. I didn't check whether the counts 
had ended up in the correct cells here - too many, but:

test <- GridTopology(c(-10.5,60),c(1,1),c(7,4))
yy <-SpatialGrid(grid=test)
fish <- SpatialPoints(cbind(runif(10, bbox(yy)[1,1], bbox(yy)[1,2]),
  runif(10, bbox(yy)[2,1], bbox(yy)[2,2])))
out <- overlay(yy, fish)
out1 <- formatC(out, width=4, format="d", flag="0")
res <- aggregate(rep(1, length(out)), list(out1), sum)
res1 <- numeric(nrow(coordinates(yy)))
res1[as.integer(as.character(res$Group.1))] <- res$x
yyy<- SpatialGridDataFrame(grid=test, data=data.frame(fish_count=res1))
image(yyy)
text(coordinates(yyy), labels=yyy$fish_count)
plot(fish, add=TRUE, pch=16, col="blue", cex=0.6)

looks OK.

Roger





> 
> 
> Thanks in advance
> 
> 
> > version
>                _                           
> platform       i386-pc-mingw32             
> arch           i386                        
> os             mingw32                     
> system         i386, mingw32               
> status                                     
> major          2                           
> minor          4.0                         
> year           2006                        
> month          10                          
> day            03                          
> svn rev        39566                       
> language       R                           
> version.string R version 2.4.0 (2006-10-03)
> >
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From White.Denis at epamail.epa.gov  Wed Nov 29 19:20:19 2006
From: White.Denis at epamail.epa.gov (White.Denis at epamail.epa.gov)
Date: Wed, 29 Nov 2006 10:20:19 -0800
Subject: [R-sig-Geo] group data into squares
In-Reply-To: <s56d71b1.063@ffdata.setur.fo>
Message-ID: <OFF851F3E3.6D552B1A-ON88257235.00648C20-88257235.0064C010@epamail.epa.gov>

Luis Ridao Cruz <Luisr at frs.fo> wrote on 2006-11-29 03:40:25:

> R-sig-geo-help,
>
> I have locations of fish abundance
> which I want to aggregate into squares.
>
> The code below creates the grid:
>
>
> library(sp)
> test <- GridTopology(c(-10.5,60),c(0.1,0.1),c(67,35))
> coordinates(test)
> coordinatevalues(test)
> yy <-SpatialGrid(grid=test)
> plot(yy,pch=16,cex=0.3,col=1)
>
> and within each cell the total abundance of fish
> should be specified.
>
> How can I do this?
>

Here's an old fashioned way:

# set up grid
nx <- 67
ny <- 35
test <- matrix (0, nrow=ny, ncol=nx)
xmin <- -10.5
ymin <- 60
xinc <- 0.1
yinc <- 0.1

# generate random sample points
npts <- 5000
pts <- cbind (x = runif (npts) * nx * xinc + xmin,
              y = runif (npts) * ny * yinc + ymin)

# count points in grid cells
for (i in 1:npts)
{
    x <- pts[i, 1]
    y <- pts[i, 2]
    tcol <- round ((x - xmin) / xinc)
    trow <- round ((y - ymin) / yinc)
    test[trow, tcol] <- test[trow, tcol] + 1
}

# distribution of counts
table (test)
sum (table (test))



From White.Denis at epamail.epa.gov  Wed Nov 29 19:34:00 2006
From: White.Denis at epamail.epa.gov (White.Denis at epamail.epa.gov)
Date: Wed, 29 Nov 2006 10:34:00 -0800
Subject: [R-sig-Geo] group data into squares [map projection]
In-Reply-To: <s56d71b1.063@ffdata.setur.fo>
Message-ID: <OFBE3E3959.70398F61-ON88257235.00655D27-88257235.006600D5@epamail.epa.gov>

Luis Ridao Cruz <Luisr at frs.fo> wrote on 2006-11-29 03:40:25:

> R-sig-geo-help,
>
> I have locations of fish abundance
> which I want to aggregate into squares.
>
> The code below creates the grid:
>
>
> library(sp)
> test <- GridTopology(c(-10.5,60),c(0.1,0.1),c(67,35))
> coordinates(test)
> coordinatevalues(test)
> yy <-SpatialGrid(grid=test)
> plot(yy,pch=16,cex=0.3,col=1)
>
> and within each cell the total abundance of fish
> should be specified.
>
> How can I do this?
>

One other point that could be made here has to do with counts in
non-equal area grids.  It appears that this is a latitude-longitude grid
over the Faroe Islands.  Because the grid covers a small extent in
latitude, the distortion in area for this grid is probably minimal,
however variation in cell size in such a grid does increase rapidly in
high latitudes.

If there is concern about this because of wanting the counts to
represent the same area of ocean, then the map projection facilities
available through package 'sp' would be the way to go.



From benstabler at yahoo.com  Wed Nov 29 20:32:19 2006
From: benstabler at yahoo.com (Ben Stabler)
Date: Wed, 29 Nov 2006 11:32:19 -0800 (PST)
Subject: [R-sig-Geo] Getting the Shapefile package to work?
Message-ID: <20061129193219.20291.qmail@web51308.mail.yahoo.com>

I uploaded a fixed version to CRAN.  Thanks for spotting that.

Ben

----- Original Message ----
From: Roger Bivand <Roger.Bivand at nhh.no>
To: "Hvidberg, Martin" <mhv at dmu.dk>
Cc: r-sig-geo at stat.math.ethz.ch; benstabler at yahoo.com
Sent: Friday, November 3, 2006 11:26:30 AM
Subject: Re: [R-sig-Geo] Getting the Shapefile package to work?


Replied to on R-help, but shapefiles has an undeclared dependence on 
foreign, which ought to have been made explicit properly in the package. 

Since read.dbf() in foreign is the shapelib function (and maptools and
rgdal also use shapelib), this might suggest that using maptools or rgdal
is a better solution unless you really need to debug shapelib within R (I
have done this for GeoLytics Inc. shapefiles which were breaking the ESRI
specs for the *.shx file, so the shapefiles package can be really 
helpful with broken or non-standard shapefiles).

Roger

On Fri, 3 Nov 2006, Hvidberg, Martin wrote:

> Dear list
>  
> - Propoerly a beginner question, so bare with my frustration...
>  
> I tried install the 'shapefiles' package into R 2.4.0 but it seems that the install had little effect...
>  
> 
>         > install.packages(c("shapefiles"))
>         --- Please select a CRAN mirror for use in this session ---
>         trying URL 'http://cran.dk.r-project.org/bin/windows/contrib/2.4/shapefiles_0.5.zip'
>         Content type 'application/zip' length 42335 bytes
>         opened URL
>         downloaded 41Kb
>         package 'shapefiles' successfully unpacked and MD5 sums checked
>         The downloaded packages are in
>                 C:\TEMP\RtmpMz5Pqb\downloaded_packages
>         updating HTML package descriptions
>         >  dbf <- read.dbf("test.dbf")
>         Error: could not find function "read.dbf"
>         > 
>         
> 
> Note thet the last line contains an error.
>  
> Is the package installed or not?
> How do I get access to use the functionality it offers??
>  
> :-? Martin Hvidberg
> 
>     [[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From mdsumner at utas.edu.au  Wed Nov 29 22:51:26 2006
From: mdsumner at utas.edu.au (Michael Sumner)
Date: Thu, 30 Nov 2006 08:51:26 +1100
Subject: [R-sig-Geo] group data into squares
In-Reply-To: <OFF851F3E3.6D552B1A-ON88257235.00648C20-88257235.0064C010@epamail.epa.gov>
References: <OFF851F3E3.6D552B1A-ON88257235.00648C20-88257235.0064C010@epamail.epa.gov>
Message-ID: <456E00DE.5090305@utas.edu.au>

Here is a variant on Denis' method that scales up for large numbers of 
points. You have to be sure no points fall outside your grid, or 
tabulate will be in error:

# set up grid
nx <- 67
ny <- 35
test <- matrix (0, nrow=ny, ncol=nx)
xmin <- -10.5
ymin <- 60
xinc <- 0.1
yinc <- 0.1

# generate random sample points
npts <- 5000
pts <- cbind (x = runif (npts) * nx * xinc + xmin,
              y = runif (npts) * ny * yinc + ymin)

# count points in grid (you should check none fall out of bounds)
cps <- ceiling(cbind((pts[,1] - xmin)/xinc, (pts[,2] - ymin)/yinc))
tps <- tabulate((cps[, 1] - 1) * ny + cps[, 2], nx * ny)
t2 <- matrix(tps, ny, nx)
table(t2)

## try again to show result in terms of corners of cell coordinates
xx <- seq(xmin, by = xinc, length = nx+1)
yy <- seq(ymin, by = yinc, length = ny+1)

npts <- 50
pts <- cbind (x = runif (npts) * nx * xinc + xmin,
              y = runif (npts) * ny * yinc + ymin)

# count points in grid

cps <- ceiling(cbind((pts[,1] - xmin)/xinc, (pts[,2] - ymin)/yinc))
tps <- tabulate((cps[, 1] - 1) * ny + cps[, 2], nx * ny)
t2 <- matrix(tps, ny, nx)points(pts)

image(xx, yy, t(t2))



From Roger.Bivand at nhh.no  Thu Nov 30 21:13:10 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 30 Nov 2006 21:13:10 +0100 (CET)
Subject: [R-sig-Geo] Any plan of R interface to GEOS
In-Reply-To: <20061122071836.37236.qmail@web10711.mail.bbt.yahoo.co.jp>
Message-ID: <Pine.LNX.4.44.0611302107190.11410-100000@reclus.nhh.no>

On Wed, 22 Nov 2006, Hisaji ONO wrote:

> Hello.
> 
>  Currently GEOS C API interface has been already
> available. And RCppTemplate package is also available.
> 
>  I think GEOS's functions are far better than gpclib's. It
> can manipulate points, linestrings, polygons and
> multi-geometries and it has lots of functions(ca. buffer,
> union, overlay query/analysis)
> 
>  If R interface to GEOS, one of core functions of creating
> spatial weight matrices will be easy, faster and correct
> since current spdep took time to build them.
> 
>  Does any one have plan to build R interface using above
> packages?
> 

GEOS is larger than R in terms of disk footprint, the libgeos*.a library 
is 27MB. It could be interfaced directly, but would probably be better 
used through OGR, since the rgdal read/write vector functions have to 
convert sp objects to OGR anyway. I'm not sure in that case whether to 
avoid GEOS, since many users will not have it as part of GDAL, and 
distribution for Windows of a MSYS/MinGW built GEOM inside the gdal DLL 
doesn't seem inviting. I can see arguments for this, but maybe operations 
like this should be done in a GIS?

Best wishes,

Roger

> 
>  Regards.
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



