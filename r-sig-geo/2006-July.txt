From amsantac at hotmail.com  Sat Jul  1 01:56:06 2006
From: amsantac at hotmail.com (=?iso-8859-1?B?QWztIFNhbnRhY3J1eg==?=)
Date: Fri, 30 Jun 2006 18:56:06 -0500
Subject: [R-sig-Geo] universal kriging in gstat
Message-ID: <BAY20-F11D75B4EAAD85E246CD04C97D0@phx.gbl>

Dear list members,

I am trying to perform universal kriging in gstat, and according to the help 
of 'krige' function, the names of the coordinates of 'newdata' argument must 
be the same as defined in 'locations'.

I am creating an SpatialPixels object for the prediction locations, using 
the next code:

>pts<-spsample(myShapePoly, n=3000, "regular")
>gridded(pts) <- TRUE class(pts)
[1] "SpatialPixels"
attr(,"package")
[1] "sp"

And x1 and x2 are the names of the coordinates of the prediction locations 
grid.

So, to perform universal kriging, I have to change the names of the 
coordinates of my observed data to x1 and x2, but I would like to know if I 
can change the name of the coordinates of the prediction grid ('pts').

I appreciate any comment. Sincerely,

Al? M. Santacruz
M.Sc. Geomatics, Student
National University of Colombia
Bogot? D.C.



From karl.sommer at dpi.vic.gov.au  Mon Jul  3 08:01:25 2006
From: karl.sommer at dpi.vic.gov.au (karl.sommer at dpi.vic.gov.au)
Date: Mon, 3 Jul 2006 16:01:25 +1000
Subject: [R-sig-Geo] distance calculation; meuse.grid
Message-ID: <OF7F7D1B74.BA90FE70-ONCA2571A0.001DFB7B-CA2571A0.002116B0@nre.vic.gov.au>


Hello

I was wondering if there is a way in "R" or "sp" to calculate shortest
distance from a given object such as a river, similar to the data example
"meuse.grid"  under the gstat package. I was wondering how the "dist"
variable in the "meuse.grid"  file was orignially calculated?  I would like
to perform a similar calculation as shortest distance for each point in a
field (1m x 1m grid) from an irrigation channel for which I have generated
a shape file.  Or is such an operation better performed in a GIS
environment?

Regards

Karl



From Roger.Bivand at nhh.no  Mon Jul  3 11:11:39 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 3 Jul 2006 11:11:39 +0200 (CEST)
Subject: [R-sig-Geo] distance calculation; meuse.grid
In-Reply-To: <OF7F7D1B74.BA90FE70-ONCA2571A0.001DFB7B-CA2571A0.002116B0@nre.vic.gov.au>
Message-ID: <Pine.LNX.4.44.0607031104100.27516-100000@reclus.nhh.no>

On Mon, 3 Jul 2006 karl.sommer at dpi.vic.gov.au wrote:

> 
> Hello
> 
> I was wondering if there is a way in "R" or "sp" to calculate shortest
> distance from a given object such as a river, similar to the data example
> "meuse.grid"  under the gstat package. I was wondering how the "dist"
> variable in the "meuse.grid"  file was orignially calculated?  I would like
> to perform a similar calculation as shortest distance for each point in a
> field (1m x 1m grid) from an irrigation channel for which I have generated
> a shape file.  Or is such an operation better performed in a GIS
> environment?

You can use spDistsN1() in sp to measure distances from many points to one 
point, including Great Circle distances. This will not be good enough for 
distances between other kinds of objects, so a GIS is the obvious choice 
for that. My guess for the origins of the meuse.grid distances is 
PCRaster, a raster GIS. If your irrigation channel has a lot of detail, 
you could use spDistsN1 in a loop between the grid of points and each 
point representing the channel, but it would be very messy, a GIS is 
designed to do this.

Roger

> 
> Regards
> 
> Karl
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From adrian at maths.uwa.edu.au  Mon Jul  3 12:30:08 2006
From: adrian at maths.uwa.edu.au (Adrian Baddeley)
Date: Mon, 3 Jul 2006 18:30:08 +0800
Subject: [R-sig-Geo]  distance calculation; meuse.grid
In-Reply-To: <mailman.11.1151920804.10328.r-sig-geo@stat.math.ethz.ch>
References: <mailman.11.1151920804.10328.r-sig-geo@stat.math.ethz.ch>
Message-ID: <17576.61872.719383.235669@maths.uwa.edu.au>


karl.sommer at dpi.vic.gov.au writes:

> I was wondering if there is a way in "R" or "sp" to calculate shortest
> distance from a given object such as a river, similar to the data example
> "meuse.grid"  under the gstat package.

In package 'spatstat' there is a function distmap() 
designed for this purpose. 

The object (the river) may be either

	  - a list of line segments (line segment pattern object, class "psp")

	  - a list of x,y coordinate points (point pattern object, class "ppp")

or
	  - a binary pixel image (window object, class "owin", type "mask")

The return value is a pixel image; the brightness value of each pixel
gives the shortest distance from that pixel to the target object. 

You can display the pixel image, extract the values at chosen locations
using the subset operator "[ ]", or extract the entire pixel array
using "as.matrix".

Adrian Baddeley



From Roger.Bivand at nhh.no  Mon Jul  3 15:40:54 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 3 Jul 2006 15:40:54 +0200 (CEST)
Subject: [R-sig-Geo] distance calculation; meuse.grid
In-Reply-To: <17576.61872.719383.235669@maths.uwa.edu.au>
Message-ID: <Pine.LNX.4.44.0607031534320.27568-100000@reclus.nhh.no>

On Mon, 3 Jul 2006, Adrian Baddeley wrote:

> 
> karl.sommer at dpi.vic.gov.au writes:
> 
> > I was wondering if there is a way in "R" or "sp" to calculate shortest
> > distance from a given object such as a river, similar to the data example
> > "meuse.grid"  under the gstat package.
> 
> In package 'spatstat' there is a function distmap() 
> designed for this purpose. 

Excellent! I'll add suitable functions to the sourceforge repository 
spspatstat package to interface sp classes to this solution, probably 
within a month. The as.mask() arguments can be derived from a SpatialGrid 
GridTopology slot, so this will help more people. Visiting 

http://www.spatstat.org/

is always instructive!

> 
> The object (the river) may be either
> 
> 	  - a list of line segments (line segment pattern object, class "psp")
> 
> 	  - a list of x,y coordinate points (point pattern object, class "ppp")
> 
> or
> 	  - a binary pixel image (window object, class "owin", type "mask")
> 
> The return value is a pixel image; the brightness value of each pixel
> gives the shortest distance from that pixel to the target object. 
> 
> You can display the pixel image, extract the values at chosen locations
> using the subset operator "[ ]", or extract the entire pixel array
> using "as.matrix".
> 
> Adrian Baddeley
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From e.pebesma at geo.uu.nl  Mon Jul  3 17:40:27 2006
From: e.pebesma at geo.uu.nl (Edzer J. Pebesma)
Date: Mon, 03 Jul 2006 17:40:27 +0200
Subject: [R-sig-Geo] universal kriging in gstat
In-Reply-To: <BAY20-F11D75B4EAAD85E246CD04C97D0@phx.gbl>
References: <BAY20-F11D75B4EAAD85E246CD04C97D0@phx.gbl>
Message-ID: <44A93A6B.1080506@geo.uu.nl>

Al? Santacruz wrote:
> Dear list members,
>
> I am trying to perform universal kriging in gstat, and according to the help 
> of 'krige' function, the names of the coordinates of 'newdata' argument must 
> be the same as defined in 'locations'.
>   
I suspect it is time to update this documentation; If you're using sp
objects, the names of coordinates does not play a role anymore, as
we can retrieve them using the coordinates() method.

Does this help?
--
Edzer
> I am creating an SpatialPixels object for the prediction locations, using 
> the next code:
>
>   
>> pts<-spsample(myShapePoly, n=3000, "regular")
>> gridded(pts) <- TRUE class(pts)
>>     
> [1] "SpatialPixels"
> attr(,"package")
> [1] "sp"
>
> And x1 and x2 are the names of the coordinates of the prediction locations 
> grid.
>
> So, to perform universal kriging, I have to change the names of the 
> coordinates of my observed data to x1 and x2, but I would like to know if I 
> can change the name of the coordinates of the prediction grid ('pts').
>
> I appreciate any comment. Sincerely,
>
> Al? M. Santacruz
> M.Sc. Geomatics, Student
> National University of Colombia
> Bogot? D.C.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



From amsantac at hotmail.com  Mon Jul  3 18:07:11 2006
From: amsantac at hotmail.com (=?iso-8859-1?B?QWztIFNhbnRhY3J1eg==?=)
Date: Mon, 03 Jul 2006 11:07:11 -0500
Subject: [R-sig-Geo] universal kriging in gstat
In-Reply-To: <44A93A6B.1080506@geo.uu.nl>
Message-ID: <BAY20-F1459BD628A19AC4BE1667CC9700@phx.gbl>

Thanks Edzer,

Yes, I found that the answer was very simple: as you say, we can use the 
coordinates() method.

Best regards,

Al? Santacruz



>From: "Edzer J. Pebesma" <e.pebesma at geo.uu.nl>
>To: Al? Santacruz <amsantac at hotmail.com>
>CC: r-sig-geo at stat.math.ethz.ch
>Subject: Re: [R-sig-Geo] universal kriging in gstat
>Date: Mon, 03 Jul 2006 17:40:27 +0200
>
>Al? Santacruz wrote:
>>Dear list members,
>>
>>I am trying to perform universal kriging in gstat, and according to the 
>>help of 'krige' function, the names of the coordinates of 'newdata' 
>>argument must be the same as defined in 'locations'.
>>
>I suspect it is time to update this documentation; If you're using sp
>objects, the names of coordinates does not play a role anymore, as
>we can retrieve them using the coordinates() method.
>
>Does this help?
>--
>Edzer
>>I am creating an SpatialPixels object for the prediction locations, using 
>>the next code:
>>
>>
>>>pts<-spsample(myShapePoly, n=3000, "regular")
>>>gridded(pts) <- TRUE class(pts)
>>>
>>[1] "SpatialPixels"
>>attr(,"package")
>>[1] "sp"
>>
>>And x1 and x2 are the names of the coordinates of the prediction locations 
>>grid.
>>
>>So, to perform universal kriging, I have to change the names of the 
>>coordinates of my observed data to x1 and x2, but I would like to know if 
>>I can change the name of the coordinates of the prediction grid ('pts').
>>
>>I appreciate any comment. Sincerely,
>>
>>Al? M. Santacruz
>>M.Sc. Geomatics, Student
>>National University of Colombia
>>Bogot? D.C.
>>
>>_______________________________________________
>>R-sig-Geo mailing list
>>R-sig-Geo at stat.math.ethz.ch
>>https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>

_________________________________________________________________
MSN Amor: busca tu ? naranja http://latam.msn.com/amor/



From vladimir.batagelj at fmf.uni-lj.si  Tue Jul  4 02:01:13 2006
From: vladimir.batagelj at fmf.uni-lj.si (Vladimir Batagelj)
Date: Tue, 4 Jul 2006 02:01:13 +0200 (CEST)
Subject: [R-sig-Geo] Line width in sp maps
Message-ID: <1228.193.2.67.50.1151971273.squirrel@webmail.fmf.uni-lj.si>


Hi,

I am trying to change the line width in (shape) maps
produced using sp package, but without success.
All my attempts with lwd parameter failed.
I found a brute force solution to save the map in
EPS and change the linewidth there - but I would
expect that there is a regular solution.

best regards,  Vladimir Batagelj

-- 
Vladimir Batagelj, University of Ljubljana, Department of Mathematics
  Jadranska 19, PO Box 2964, 1111 Ljubljana, Slovenia
http://vlado.fmf.uni-lj.si



From karl.sommer at dpi.vic.gov.au  Tue Jul  4 06:33:58 2006
From: karl.sommer at dpi.vic.gov.au (karl.sommer at dpi.vic.gov.au)
Date: Tue, 4 Jul 2006 14:33:58 +1000
Subject: [R-sig-Geo] error message rgdal: dimensions do not match
Message-ID: <OFD100C2A2.F3A90A9F-ONCA2571A1.0017DCA6-CA2571A1.001914D1@nre.vic.gov.au>


I am encountering a error message when attempting to do "inverse distance
kriging" or variogram calculations. The error is always the same

ERROR: dimensions do not match: locations 1513600 and data 611452.

What puzzles me is the fact that I am using the same code as I have
successfully
used with 2 other images.

I have tried to reduce the dimensions of the imported image in using
gdal_translate from the command prompt. The same error was still present
but with different "address-numbers" relating to locations and data.

I have tried to find some pointers re error messages under the GDAL
manual but without success.

I am able to plot the imported image as well as the target grid and SPDF
without error.

following is the code:

library(rgdal)
# import image
> t1 <- readGDAL("images/test1.bil", half.cell=c(0.5, 0.5), silent = FALSE)

images/test1.bil has GDAL driver GTiff
and has 860 rows and 880 columns

Closing GDAL dataset handle 0100ACB8...  destroyed ... done.
Closing GDAL dataset handle 00000000... done.

# get shape file of field
> image(t1)
> poly <- locator()
> poly <- do.call("cbind", poly)
> poly <- rbind(poly, poly[1,])
> lines(poly)
> field <- SpatialPolygons(list(Polygons(list(Polygon(poly)), ID="field")))
> grd <- GridTopology(c(599040, 6228570), c(.5,.5), c(880, 860))
> SG <- SpatialGrid(grd)
> x1 <- overlay(SG, field)
> SGDF <- SpatialGridDataFrame(grd, data=AttributeList(list(field=x1)))
> SPDF <- as(SGDF, "SpatialPixelsDataFrame")

# do kriging
> library(gstat)
> t1.idw <- krige(ndvi~1, t1,  SPDF)
Error: dimensions do not match: locations 1513600 and data 611452

Regards

Karl
_________________________________
Karl J Sommer,
Department of Primary Industries,
Catchment & Agriculture Services,
PO Box 905
Mildura, VIC, Australia 3502

Tel: +61 (0)3 5051 4390
Fax +61 (0)3 5051 4534

Email:     karl.sommer at dpi.vic.gov.au



From epistat at gmail.com  Tue Jul  4 10:03:42 2006
From: epistat at gmail.com (zhijie zhang)
Date: Tue, 4 Jul 2006 16:03:42 +0800
Subject: [R-sig-Geo] how do we sample in spatial statistics?
Message-ID: <2fc17e30607040103l27de228bh64e36a7561ab94b8@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20060704/4cfe1d89/attachment.pl>

From e.pebesma at geo.uu.nl  Tue Jul  4 10:19:28 2006
From: e.pebesma at geo.uu.nl (Edzer J. Pebesma)
Date: Tue, 04 Jul 2006 10:19:28 +0200
Subject: [R-sig-Geo] how do we sample in spatial statistics?
In-Reply-To: <2fc17e30607040103l27de228bh64e36a7561ab94b8@mail.gmail.com>
References: <2fc17e30607040103l27de228bh64e36a7561ab94b8@mail.gmail.com>
Message-ID: <44AA2490.4040007@geo.uu.nl>

zhijie zhang wrote:
> Dear friends,
>   Sorry for sending an empty email because of mismanipulation.
>   Do we also use sample() function to do the spatial sampling? I look for
> the sample() and think it's one-dimensional sampling.
> In spatial statistics, do we need two-dimentional sampling or some other
> sampling techniques? Which functions could be used in spatial samping in R?
> thanks very much!
>
>   
spsample in package has a few simple spatial sampling techniques
(basically those described in Ripley, 1981: random, regular,
stratified, nonaligned systematic) on lines, polygons and
grids. More advanced sampling techniques are found in
package spatstat.

--
Edzer



From dgoliche at sclc.ecosur.mx  Tue Jul  4 17:39:06 2006
From: dgoliche at sclc.ecosur.mx (Duncan Golicher)
Date: Tue, 04 Jul 2006 10:39:06 -0500
Subject: [R-sig-Geo] drawing order in spplot
Message-ID: <44AA8B9A.7030200@sclc.ecosur.mx>

Many thanks to everyone involved in putting together the excelent sp 
package. I have just used for teaching a brief intro to applied geostats 
with gstat. Students found life much easier than a year ago when I had 
to try to explain a less structured approach to the data.
A simple question arose after the class. According to the spplot 
documentation "for grids and polygons sp.layout is drawn afterwards (so 
the item will not be overdrawn by the grid and/or polygon)".
So in this example we expected a DEM to be drawn first, then municipal 
boundaries.

 > class(municipios)
[1] "SpatialPolygonsDataFrame"
 > class(chisgrid)
[1] "SpatialPixelsDataFrame"

municips <- list("sp.polygons", municipios)
spplot(chisgrid["dem"],sp.layout=municips)

The municipal boundaries are drawn first then overdrawn by the DEM, 
which was not what we expected or wanted. I couldn't find how to avoid 
this, apart from the simple solution of ..

image(chisgrid,col=terrain.colors(20))
plot(municipios,add=T)

instead of spplot.The figures on  http://r-spatial.sourceforge.net all 
appear to have the grid drawn first. Is there a way to reverse this?

Duncan

-- 

Dr Duncan Golicher
Ecologia y Sistematica Terrestre
Conservaci?n de la Biodiversidad
El Colegio de la Frontera Sur
San Cristobal de Las Casas, 
Chiapas, Mexico

Email: dgoliche at sclc.ecosur.mx 

Tel: 967 674 9000 ext 1310
Fax: 967 678 2322
Celular: 044 9671041021

United Kingdom Skypein; 020 7870 6251
Skype name: duncangolicher 
Download Skype from http://www.skype.com



From Roger.Bivand at nhh.no  Tue Jul  4 18:49:39 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 4 Jul 2006 18:49:39 +0200 (CEST)
Subject: [R-sig-Geo] Line width in sp maps
In-Reply-To: <1228.193.2.67.50.1151971273.squirrel@webmail.fmf.uni-lj.si>
Message-ID: <Pine.LNX.4.44.0607041842360.28211-100000@reclus.nhh.no>

On Tue, 4 Jul 2006, Vladimir Batagelj wrote:

> 
> Hi,
> 
> I am trying to change the line width in (shape) maps
> produced using sp package, but without success.
> All my attempts with lwd parameter failed.
> I found a brute force solution to save the map in
> EPS and change the linewidth there - but I would
> expect that there is a regular solution.

Please include at least an indication of which functions you are using. 
The following for SpatialLines objects does work:

library(sp)
SLDF <- contourLines2SLDF(contourLines(volcano))
length(slot(SLDF, "lines"))
plot(SLDF, lwd=1:10)

and this works for SpatialPolygons:

grd <- GridTopology(c(1,1), c(1,1), c(10,10))
polys <- as.SpatialPolygons.GridTopology(grd)
plot(polys, lwd=3)

both for base graphics. Are you using spplot()?

Roger

> 
> best regards,  Vladimir Batagelj
> 
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From Roger.Bivand at nhh.no  Tue Jul  4 18:59:11 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 4 Jul 2006 18:59:11 +0200 (CEST)
Subject: [R-sig-Geo] error message rgdal: dimensions do not match
In-Reply-To: <OFD100C2A2.F3A90A9F-ONCA2571A1.0017DCA6-CA2571A1.001914D1@nre.vic.gov.au>
Message-ID: <Pine.LNX.4.44.0607041853100.28211-100000@reclus.nhh.no>

On Tue, 4 Jul 2006 karl.sommer at dpi.vic.gov.au wrote:

> 
> I am encountering a error message when attempting to do "inverse distance
> kriging" or variogram calculations. The error is always the same
> 
> ERROR: dimensions do not match: locations 1513600 and data 611452.

Indeed strange, given that 880 by 860 is 756800 (though 756800*2 is the 
first number). What does summary(t1) say? Is the single column named band1 
or ndvi? The class of t1 will be SpatialGridDataFrame, wouldn't 
SpatialPointsDataFrame be more digestible? Does doing it in two steps 
(gstat() then predict() of the gstat object) show anything? What did 
traceback() say after krige()?

Roger

> 
> What puzzles me is the fact that I am using the same code as I have
> successfully
> used with 2 other images.
> 
> I have tried to reduce the dimensions of the imported image in using
> gdal_translate from the command prompt. The same error was still present
> but with different "address-numbers" relating to locations and data.
> 
> I have tried to find some pointers re error messages under the GDAL
> manual but without success.
> 
> I am able to plot the imported image as well as the target grid and SPDF
> without error.
> 
> following is the code:
> 
> library(rgdal)
> # import image
> > t1 <- readGDAL("images/test1.bil", half.cell=c(0.5, 0.5), silent = FALSE)
> 
> images/test1.bil has GDAL driver GTiff
> and has 860 rows and 880 columns
> 
> Closing GDAL dataset handle 0100ACB8...  destroyed ... done.
> Closing GDAL dataset handle 00000000... done.
> 
> # get shape file of field
> > image(t1)
> > poly <- locator()
> > poly <- do.call("cbind", poly)
> > poly <- rbind(poly, poly[1,])
> > lines(poly)
> > field <- SpatialPolygons(list(Polygons(list(Polygon(poly)), ID="field")))
> > grd <- GridTopology(c(599040, 6228570), c(.5,.5), c(880, 860))
> > SG <- SpatialGrid(grd)
> > x1 <- overlay(SG, field)
> > SGDF <- SpatialGridDataFrame(grd, data=AttributeList(list(field=x1)))
> > SPDF <- as(SGDF, "SpatialPixelsDataFrame")
> 
> # do kriging
> > library(gstat)
> > t1.idw <- krige(ndvi~1, t1,  SPDF)
> Error: dimensions do not match: locations 1513600 and data 611452
> 
> Regards
> 
> Karl
> _________________________________
> Karl J Sommer,
> Department of Primary Industries,
> Catchment & Agriculture Services,
> PO Box 905
> Mildura, VIC, Australia 3502
> 
> Tel: +61 (0)3 5051 4390
> Fax +61 (0)3 5051 4534
> 
> Email:     karl.sommer at dpi.vic.gov.au
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From karl.sommer at dpi.vic.gov.au  Wed Jul  5 02:02:33 2006
From: karl.sommer at dpi.vic.gov.au (karl.sommer at dpi.vic.gov.au)
Date: Wed, 5 Jul 2006 10:02:33 +1000
Subject: [R-sig-Geo] error message rgdal: dimensions do not match
Message-ID: <OFACAC028D.F16A73C7-ONCA2571A1.0082783D-CA2571A2.00003B94@nre.vic.gov.au>


As suggested by Roger Bivand and Edzer Pebesma I have included the
output of str(t1) and str(SPDF) below.

The error persited when I tried to do the kriging in two steps, using gstat
() and project().
Kriging a different variable, eg. "band1", results in the same error.
Converting t1 to a SpatialPointsDataFrame before kriging results in the
same error.
I also eliminated all zero values before calculating ndvi but the error
persited.
The traceback() info is included below.


Regards

Karl


Indeed strange, given that 880 by 860 is 756800 (though 756800*2 is the
first number). What does summary(t1) say? Is the single column named band1
or ndvi? The class of t1 will be SpatialGridDataFrame, wouldn't
SpatialPointsDataFrame be more digestible? Does doing it in two steps
(gstat() then predict() of the gstat object) show anything? What did
traceback() say after krige()?

Roger

ouput follows:

> str(t1)
Loading required package: sp
Formal class 'SpatialGridDataFrame' [package "sp"] with 6 slots
  ..@ data       :Formal class 'AttributeList' [package "sp"] with 1 slots
  .. .. ..@ att:List of 5
  .. .. .. ..$ band1: int [1:834470] 0 0 0 0 0 0 0 0 0 0 ...
  .. .. .. ..$ band2: int [1:834470] 0 0 0 0 0 0 0 0 0 0 ...
  .. .. .. ..$ band3: int [1:834470] 0 0 0 0 0 0 0 0 0 0 ...
  .. .. .. ..$ band4: int [1:834470] 0 0 0 0 0 0 0 0 0 0 ...
  .. .. .. ..$ ndvi : num [1:834470] NaN NaN NaN NaN NaN NaN NaN NaN NaN
NaN ...
  ..@ grid       :Formal class 'GridTopology' [package "sp"] with 3 slots
  .. .. ..@ cellcentre.offset: Named num [1:2]  599029 6228561
  .. .. .. ..- attr(*, "names")= chr [1:2] "x" "y"
  .. .. ..@ cellsize         : num [1:2] 0.5 0.5
  .. .. ..@ cells.dim        : int [1:2] 917 910
  ..@ grid.index : int(0)
  ..@ coords     : num [1:2, 1:2]  599029  599487 6228561 6229016
  .. ..- attr(*, "dimnames")=List of 2
  .. .. ..$ : NULL
  .. .. ..$ : chr [1:2] "x" "y"
  ..@ bbox       : num [1:2, 1:2]  599029 6228561  599487 6229016
  .. ..- attr(*, "dimnames")=List of 2
  .. .. ..$ : chr [1:2] "x" "y"
  .. .. ..$ : chr [1:2] "min" "max"
  ..@ proj4string:Formal class 'CRS' [package "sp"] with 1 slots
  .. .. ..@ projargs: chr NA

> str(SPDF)
Formal class 'SpatialPixelsDataFrame' [package "sp"] with 7 slots
  ..@ data       :Formal class 'AttributeList' [package "sp"] with 1 slots
  .. .. ..@ att:List of 1
  .. .. .. ..$ field: num [1:481262] 1 1 1 1 1 1 1 1 1 1 ...
  ..@ coords.nrs : num(0)
  ..@ grid       :Formal class 'GridTopology' [package "sp"] with 3 slots
  .. .. ..@ cellcentre.offset: Named num [1:2]  599059 6228577
  .. .. .. ..- attr(*, "names")= chr [1:2] "s1" "s2"
  .. .. ..@ cellsize         : Named num [1:2] 0.5 0.5
  .. .. .. ..- attr(*, "names")= chr [1:2] "s1" "s2"
  .. .. ..@ cells.dim        : Named int [1:2] 809 830
  .. .. .. ..- attr(*, "names")= chr [1:2] "s1" "s2"
  ..@ grid.index : int [1:481262] 421 422 423 424 425 426 427 428 429 430
...
  ..@ coords     : num [1:481262, 1:2] 599269 599269 599270 599270 599271
...
  .. ..- attr(*, "dimnames")=List of 2
  .. .. ..$ : NULL
  .. .. ..$ : chr [1:2] "s1" "s2"
  ..@ bbox       : num [1:2, 1:2]  599058 6228577  599463 6228992
  .. ..- attr(*, "dimnames")=List of 2
  .. .. ..$ : chr [1:2] "s1" "s2"
  .. .. ..$ : chr [1:2] "min" "max"
  ..@ proj4string:Formal class 'CRS' [package "sp"] with 1 slots
  .. .. ..@ projargs: chr NA

> summary(t1)
Object of class SpatialGridDataFrame
Coordinates:
        min     max
x  599028.5  599487
y 6228561.0 6229016
Is projected: NA
proj4string : [NA]
Number of points: 2
Grid attributes:
  cellcentre.offset cellsize cells.dim
x          599028.8      0.5       917
y         6228561.3      0.5       910
Data attributes:
     band1            band2            band3            band4
 Min.   :   0.0   Min.   :   0.0   Min.   :   0.0   Min.   :   0.0
 1st Qu.: 299.0   1st Qu.: 480.0   1st Qu.: 261.0   1st Qu.: 491.0
 Median : 347.0   Median : 613.0   Median : 387.0   Median : 776.0
 Mean   : 302.5   Mean   : 540.4   Mean   : 467.4   Mean   : 633.3
 3rd Qu.: 394.0   3rd Qu.: 715.0   3rd Qu.: 637.0   3rd Qu.: 913.0
 Max.   :2352.0   Max.   :3279.0   Max.   :2815.0   Max.   :1653.0

      ndvi
 Min.   :-3.235e-01
 1st Qu.: 9.552e-03
 Median : 2.467e-01
 Mean   : 1.992e-01
 3rd Qu.: 4.209e-01
 Max.   : 7.185e-01
 NA's   : 2.046e+05

# traceback after kriging provides the following messages
> traceback()
5: .Call("gstat_new_data", as.double(raw$y), as.double(raw$locations),
       as.double(raw$X), as.integer(raw$has.intercept), as.double(d$beta),
       nmax, nmin, maxdist, as.integer(d$vfn), as.numeric(w), double(0),
       as.integer(d$degree))
4: predict.gstat(g, newdata = newdata, block = block, nsim = nsim,
       indicators = indicators, na.action = na.action)
3: .local(formula, locations, ...)
2: krige(ndvi ~ 1, t1, SPDF)
1: krige(ndvi ~ 1, t1, SPDF)

# converting to a SpatialPointsDataFrame before kriging resulted in
the same error

t1 <- as(t1, "SpatialPointsDataFrame")

> t1.idw <- krige(ndvi~1, t1,  SPDF)
Error: dimensions do not match: locations 1668940 and data 629822

# using two steps as suggested by Roger Bivand results in the same error

> t1.idw <- gstat(id = "ndvi", formula = ndvi ~ 1,
        data = t1, nmax = 7, set = list(idp = .5))

> predict(t1.idw, SPDF)
Error: dimensions do not match: locations 1668940 and data 629822

_________________________________
Karl J Sommer,
Department of Primary Industries,
Catchment & Agriculture Services,
PO Box 905
Mildura, VIC, Australia 3502

Tel: +61 (0)3 5051 4390
Fax +61 (0)3 5051 4534

Email:     karl.sommer at dpi.vic.gov.au



From adrian at maths.uwa.edu.au  Wed Jul  5 05:57:03 2006
From: adrian at maths.uwa.edu.au (Adrian Baddeley)
Date: Wed, 5 Jul 2006 11:57:03 +0800
Subject: [R-sig-Geo] [R] how do we sample in spatial statistics?
In-Reply-To: <mailman.9.1152007204.15936.r-sig-geo@stat.math.ethz.ch>
References: <mailman.9.1152007204.15936.r-sig-geo@stat.math.ethz.ch>
Message-ID: <17579.14479.894617.187218@maths.uwa.edu.au>


Zhijie Zhang writes:

> Do we also use sample() function to do the spatial sampling?

> In spatial statistics, do we need two-dimentional sampling or some other
> sampling techniques? Which functions could be used in spatial samping in R?

  It depends on what kind of data or population you are sampling.

  (a) If your data or population are stored in a vector, a list or a data frame,
  then you can sample some of the items in the list, simply by using
  the R function sample() to select values of the list index.
  For example 
	mydata <- list(.............)
	index <- sample(seq(mydata), 3, replace=FALSE) 
	sam <- mydata[index]
  will select three items at random from the list.

  In package 'spatstat', a pattern of points or a pattern of line segments
  can also be indexed by numerical values. For example
	data(cells)
	index <- sample(cells$n, 3, replace=TRUE)
	sam <- cells[index]
  takes the `cells' dataset, a spatial point pattern, 
  and selects three of the points at random.
	
  (b) If your data are spatially referenced (for example a map of
  temperatures across the ocean), you may want to sample these data
  at `spatially random' locations. In principle you can use any
  random pattern of points to do this. 

  Package 'spatstat' contains a large number of functions for generating
  random patterns of points. Type help(spatstat) for a list of them.
  These functions can be used to sample spatially-referenced data in any package. 

  In spatstat, for example, if ocean temperatures are stored as a pixel image, you can 
  sample them using a point pattern:
	temperature <- im(........)
	samplepoints <- rstrat(temperature$window, 10, 10, 3)
	sam <- temperature[samplepoints]
   creates an image called 'temperature', then generates a stratified random pattern
   of points, and extracts the ocean temperatures at these points.

Adrian Baddeley



From vladimir.batagelj at fmf.uni-lj.si  Wed Jul  5 06:29:10 2006
From: vladimir.batagelj at fmf.uni-lj.si (Vladimir Batagelj)
Date: Wed, 5 Jul 2006 06:29:10 +0200 (CEST)
Subject: [R-sig-Geo] Line width in sp maps
In-Reply-To: <Pine.LNX.4.44.0607041842360.28211-100000@reclus.nhh.no>
References: <1228.193.2.67.50.1151971273.squirrel@webmail.fmf.uni-lj.si>
	<Pine.LNX.4.44.0607041842360.28211-100000@reclus.nhh.no>
Message-ID: <3206.193.77.179.147.1152073750.squirrel@webmail.fmf.uni-lj.si>


<<<-------- Roger Bivand-------->>>

> both for base graphics. Are you using spplot()?

Yes.
I am trying to get a display of administrative units in the world

> rc <- readShapePoly("admin98/admin98.shp")
> names(rc)
 [1] "FIPS_ADMIN" "GMI_ADMIN"  "ADMIN_NAME" "FIPS_CNTRY" "GMI_CNTRY" 
"CNTRY_NAME" "REGION"     "CONTINENT"
 [9] "POP_ADMIN"  "SQKM_ADMIN" "SQMI_ADMIN" "TYPE_ENG"   "TYPE_LOC"  
"COLOR_MAP"
> length(rc$ADMIN_NAME)
[1] 2604
> rc$f = factor(sample(1:10, 2604, replace = T), labels = letters[1:10])
> spplot(rc, "f", col.regions=brewer.pal(10, "Set3"), scales=list(draw =
TRUE))

I get the complete picture but with thick lines.
I tried in different ways to set the lwd parameter to spplot:

> spplot(rc, "f", col.regions=brewer.pal(10, "Set3"), scales=list(draw =
TRUE),lwd=0.01)

> trellis.par.set(list(plot.line=list(lwd=0.01)))
> spplot(rc, "f", col.regions=brewer.pal(10, "Set3"), scales=list(draw =
TRUE))

> spplot(rc, "f", col.regions=brewer.pal(10, "Set3"), scales=list(draw =
TRUE),
+ par.settings=list(plot.line=list(lwd=0.01)))

> spplot(rc, "f", col.regions=brewer.pal(10, "Set3"), scales=list(draw =
TRUE),
+ par.settings=list(plot.polygon=list(lwd=0.01)))

I couldn't obtain thin lines.

Vlado

-- 
Vladimir Batagelj, University of Ljubljana, Department of Mathematics
  Jadranska 19, PO Box 2964, 1111 Ljubljana, Slovenia
http://vlado.fmf.uni-lj.si



From Roger.Bivand at nhh.no  Wed Jul  5 12:19:20 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 5 Jul 2006 12:19:20 +0200 (CEST)
Subject: [R-sig-Geo] Line width in sp maps
In-Reply-To: <3206.193.77.179.147.1152073750.squirrel@webmail.fmf.uni-lj.si>
Message-ID: <Pine.LNX.4.44.0607051201210.31976-100000@reclus.nhh.no>

On Wed, 5 Jul 2006, Vladimir Batagelj wrote:

> 
> <<<-------- Roger Bivand-------->>>
> 
> > both for base graphics. Are you using spplot()?
> 
> Yes.

Then this is an spplot/lattice graphics question, where I'm as out of my 
depth as you are. It looks as though sp.polygon() takes arguments that are 
passed to grid.polygon(gpar()) and panel.lines(), so it is a matter of 
inding the right incantation. It looks to me as though the '...' in 
spplot.polygons doesn't make it all the way through. This would need 
fixing in code. The workaround is to use base graphics.

Roger

> I am trying to get a display of administrative units in the world
> 
> > rc <- readShapePoly("admin98/admin98.shp")
> > names(rc)
>  [1] "FIPS_ADMIN" "GMI_ADMIN"  "ADMIN_NAME" "FIPS_CNTRY" "GMI_CNTRY" 
> "CNTRY_NAME" "REGION"     "CONTINENT"
>  [9] "POP_ADMIN"  "SQKM_ADMIN" "SQMI_ADMIN" "TYPE_ENG"   "TYPE_LOC"  
> "COLOR_MAP"
> > length(rc$ADMIN_NAME)
> [1] 2604
> > rc$f = factor(sample(1:10, 2604, replace = T), labels = letters[1:10])
> > spplot(rc, "f", col.regions=brewer.pal(10, "Set3"), scales=list(draw =
> TRUE))
> 
> I get the complete picture but with thick lines.
> I tried in different ways to set the lwd parameter to spplot:
> 
> > spplot(rc, "f", col.regions=brewer.pal(10, "Set3"), scales=list(draw =
> TRUE),lwd=0.01)
> 
> > trellis.par.set(list(plot.line=list(lwd=0.01)))
> > spplot(rc, "f", col.regions=brewer.pal(10, "Set3"), scales=list(draw =
> TRUE))
> 
> > spplot(rc, "f", col.regions=brewer.pal(10, "Set3"), scales=list(draw =
> TRUE),
> + par.settings=list(plot.line=list(lwd=0.01)))
> 
> > spplot(rc, "f", col.regions=brewer.pal(10, "Set3"), scales=list(draw =
> TRUE),
> + par.settings=list(plot.polygon=list(lwd=0.01)))
> 
> I couldn't obtain thin lines.
> 
> Vlado
> 
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From Olsen.Tony at epamail.epa.gov  Wed Jul  5 16:34:30 2006
From: Olsen.Tony at epamail.epa.gov (Olsen.Tony at epamail.epa.gov)
Date: Wed, 05 Jul 2006 07:34:30 -0700
Subject: [R-sig-Geo] how do we sample in spatial statistics?
In-Reply-To: <44AA2490.4040007@geo.uu.nl>
Message-ID: <OF928479E4.4D7232EB-ON882571A2.004F8FE4-882571A2.0050102A@epamail.epa.gov>

We have developed a spatial sampling library, spsurvey,  that we are
about to submit to cran.  It can sample points, lines, or polygons using
either simple random sampling, unequal probability sampling,
stratification.  Main focus is on spatially balanced sampling - new
approach developed by Stevens and Olsen.  spsurvey currently uses ESRI
shapefiles as main input but when it reads them in it creates an sp
object.  The resulting sample is also an sp object.  A prelliminary
version of the library can be found at http://www.epa.gov/nheerl/arm
under "Software Downloads".  It is called psurvey.design there.
spsurvey should be on cran before end of July.

Tony Olsen




                                                                        
             "Edzer J.                                                  
             Pebesma"                                                   
             <e.pebesma at geo.u                                        To 
             u.nl>                    zhijie zhang <epistat at gmail.com>  
             Sent by:                                                cc 
             r-sig-geo-bounce         r-sig-geo at stat.math.ethz.ch       
             s at stat.math.ethz                                   Subject 
             .ch                      Re: [R-sig-Geo] how do we sample  
                                      in spatial statistics?            
                                                                        
             07/04/2006 01:19                                           
             AM                                                         
                                                                        
                                                                        
                                                                        




zhijie zhang wrote:
> Dear friends,
>   Sorry for sending an empty email because of mismanipulation.
>   Do we also use sample() function to do the spatial sampling? I look
for
> the sample() and think it's one-dimensional sampling.
> In spatial statistics, do we need two-dimentional sampling or some
other
> sampling techniques? Which functions could be used in spatial samping
in R?
> thanks very much!
>
>
spsample in package has a few simple spatial sampling techniques
(basically those described in Ripley, 1981: random, regular,
stratified, nonaligned systematic) on lines, polygons and
grids. More advanced sampling techniques are found in
package spatstat.

--
Edzer

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at stat.math.ethz.ch
https://stat.ethz.ch/mailman/listinfo/r-sig-geo



From Roger.Bivand at nhh.no  Wed Jul  5 18:11:03 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 5 Jul 2006 18:11:03 +0200 (CEST)
Subject: [R-sig-Geo] how do we sample in spatial statistics?
In-Reply-To: <OF928479E4.4D7232EB-ON882571A2.004F8FE4-882571A2.0050102A@epamail.epa.gov>
Message-ID: <Pine.LNX.4.44.0607051809001.32309-100000@reclus.nhh.no>

On Wed, 5 Jul 2006 Olsen.Tony at epamail.epa.gov wrote:

> We have developed a spatial sampling library, spsurvey,  that we are
> about to submit to cran.  It can sample points, lines, or polygons using
> either simple random sampling, unequal probability sampling,
> stratification.  Main focus is on spatially balanced sampling - new
> approach developed by Stevens and Olsen.  spsurvey currently uses ESRI
> shapefiles as main input but when it reads them in it creates an sp
> object.  The resulting sample is also an sp object.  A prelliminary
> version of the library can be found at http://www.epa.gov/nheerl/arm
> under "Software Downloads".  It is called psurvey.design there.
> spsurvey should be on cran before end of July.

Thanks for this information, it is very good news. May I copy this 
information to the Rgeo website, or would you prefer to wait until the 
package reaches CRAN?

Roger

> 
> Tony Olsen
> 
>                                                                         
>              "Edzer J.                                                  
>              Pebesma"                                                   
>              <e.pebesma at geo.u                                        To 
>              u.nl>                    zhijie zhang <epistat at gmail.com>  
>              Sent by:                                                cc 
>              r-sig-geo-bounce         r-sig-geo at stat.math.ethz.ch       
>              s at stat.math.ethz                                   Subject 
>              .ch                      Re: [R-sig-Geo] how do we sample  
>                                       in spatial statistics?            
>                                                                         
>              07/04/2006 01:19                                           
>              AM                                                         
>                                                                         
>                                                                         
>                                                                         
> 
> 
> 
> 
> zhijie zhang wrote:
> > Dear friends,
> >   Sorry for sending an empty email because of mismanipulation.
> >   Do we also use sample() function to do the spatial sampling? I look
> for
> > the sample() and think it's one-dimensional sampling.
> > In spatial statistics, do we need two-dimentional sampling or some
> other
> > sampling techniques? Which functions could be used in spatial samping
> in R?
> > thanks very much!
> >
> >
> spsample in package has a few simple spatial sampling techniques
> (basically those described in Ripley, 1981: random, regular,
> stratified, nonaligned systematic) on lines, polygons and
> grids. More advanced sampling techniques are found in
> package spatstat.
> 
> --
> Edzer
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From dgoliche at sclc.ecosur.mx  Thu Jul  6 17:52:05 2006
From: dgoliche at sclc.ecosur.mx (Duncan Golicher)
Date: Thu, 06 Jul 2006 10:52:05 -0500
Subject: [R-sig-Geo] drawing order in spplot
In-Reply-To: <44ABB62B.5080505@geo.uu.nl>
References: <44AA8B9A.7030200@sclc.ecosur.mx> <44ABB62B.5080505@geo.uu.nl>
Message-ID: <44AD31A5.9080801@sclc.ecosur.mx>

Thanks for this Arien,

Just can't get it to work though. I messed around a bit more yesterday 
but couldn't find a way. No one else on the list replied. I have another 
reason to want to do something similar, so I was hoping there was a work 
around out there. Here is the data if you (or anyone else) can help.

load(file=url("ftp://200.23.34.16/simulacion/SPATIAL/chisgrid.rob"))
load(file=url("ftp://200.23.34.16/simulacion/SPATIAL//municipios.rob"))

#municipios was originally imported from a shapefile. The "dem" is a 
coarse 1 km x 1km grid imported from GRASS 5.7. Both use UTM NAD27, but 
the projections are not #set. The data represents the state of Chiapas 
in Southern Mexico

image(chisgrid,"dem",col=terrain.colors(100))
plot(municipios,add=T)

#Gives what we wanted in base graphics

#But
 
spplot(municipios, "AREA", panel <- function(x,y,...){
    sp.grid(chisgrid)
    panel.polygonsplot(x,y,...)
    })
#Doesn't

#and

municips <- list("sp.polygons", municipios)
spplot(chisgrid["dem"],sp.layout=municips)

#Draws them in the wrong order.

#As an aside, this is great fun with rgl and the students loved it. Can 
anyone improve the code?

view3d<-function(grid=chisgrid,dem=1,drape=2,exag=3,pal=sp.theme()$regions$col){
  fullgrid(grid)<-TRUE
  y<-grid[[dem]]*exag
  y[is.na(y)]<-0
  dim(y)<-grid at grid@cells.dim

  x <- grid at grid@cellsize[1]*(1:grid at grid@cells.dim[1])
  z <-grid at grid@cellsize[2]*(1:grid at grid@cells.dim[2])

  y2<-grid[[drape]]
  y2[!is.na(y2)]<-as.numeric(cut( y2[!is.na(y2)],length(pal)))
  y2[is.na(y2)]<-0

  ylim <- range(y2)
  ylen <- ylim[2] - ylim[1] + 1

  pal<-c("black",pal)
  col <- pal[ y2-ylim[1]+1 ] # assign colors to heights for each point

  rgl.clear()
  rgl.surface(x, z, y, color=col)
}

view3d(drape=1,pal=terrain.colors(100))

Duncan



Arien Lam wrote:

> I stumbled there too.
> A way is to customize the default panel function within spplot.
>
> Try:
>
> spplot(municipios, "yourvariable", panel <- function(x,y,...){
>     sp.grid(chisgrid)
>     panel.polygonsplot(x,y,...)
>     })
>
> Regards, Arien
>
> Duncan Golicher schreef:
>
>> Many thanks to everyone involved in putting together the excelent sp 
>> package. I have just used for teaching a brief intro to applied 
>> geostats with gstat. Students found life much easier than a year ago 
>> when I had to try to explain a less structured approach to the data.
>> A simple question arose after the class. According to the spplot 
>> documentation "for grids and polygons sp.layout is drawn afterwards 
>> (so the item will not be overdrawn by the grid and/or polygon)".
>> So in this example we expected a DEM to be drawn first, then 
>> municipal boundaries.
>>
>>  > class(municipios)
>> [1] "SpatialPolygonsDataFrame"
>>  > class(chisgrid)
>> [1] "SpatialPixelsDataFrame"
>>
>> municips <- list("sp.polygons", municipios)
>> spplot(chisgrid["dem"],sp.layout=municips)
>>
>> The municipal boundaries are drawn first then overdrawn by the DEM, 
>> which was not what we expected or wanted. I couldn't find how to 
>> avoid this, apart from the simple solution of ..
>>
>> image(chisgrid,col=terrain.colors(20))
>> plot(municipios,add=T)
>>
>> instead of spplot.The figures on  http://r-spatial.sourceforge.net 
>> all appear to have the grid drawn first. Is there a way to reverse this?
>>
>> Duncan
>>
>


-- 
Dr Duncan Golicher
Ecologia y Sistematica Terrestre
Conservaci?n de la Biodiversidad
El Colegio de la Frontera Sur
San Cristobal de Las Casas, 
Chiapas, Mexico

Email: dgoliche at sclc.ecosur.mx 

Tel: 967 674 9000 ext 1310
Fax: 967 678 2322
Celular: 044 9671041021

United Kingdom Skypein; 020 7870 6251
Skype name: duncangolicher 
Download Skype from http://www.skype.com



From a.lam at geo.uu.nl  Thu Jul  6 20:33:12 2006
From: a.lam at geo.uu.nl (Arien Lam)
Date: Thu, 6 Jul 2006 20:33:12 +0200 (CEST)
Subject: [R-sig-Geo] drawing order in spplot
In-Reply-To: <44AD31A5.9080801@sclc.ecosur.mx>
References: <44AA8B9A.7030200@sclc.ecosur.mx> <44ABB62B.5080505@geo.uu.nl>
	<44AD31A5.9080801@sclc.ecosur.mx>
Message-ID: <39388.131.211.65.133.1152210792.squirrel@webmail.geo.uu.nl>

Duncan,

After a few tries I found:

spplot(chisgrid, "dem", panel = function(x,y, ...){
    panel.gridplot(x,y, ...)
    sp.polygons(municipios, col=1,fill=0)
    })

, which is just the reverse nesting order from my previous shot at it.
HTH, Arien

To be precise, this worked on:
> sessionInfo()
Version 2.3.1 (2006-06-01)
i486-pc-linux-gnu

attached base packages:
[1] "methods"   "stats"     "graphics"  "grDevices" "utils"     "datasets"
[7] "base"

other attached packages:
 lattice       sp
"0.13-8" "0.8-16"


This approach is advocated for tweaking trellis plots.

On Thu, July 6, 2006 17:52, Duncan Golicher wrote:
> Thanks for this Arien,
>
> Just can't get it to work though. I messed around a bit more yesterday
> but couldn't find a way. No one else on the list replied. I have another
> reason to want to do something similar, so I was hoping there was a work
> around out there. Here is the data if you (or anyone else) can help.
>
> load(file=url("ftp://200.23.34.16/simulacion/SPATIAL/chisgrid.rob"))
> load(file=url("ftp://200.23.34.16/simulacion/SPATIAL//municipios.rob"))
>
> #municipios was originally imported from a shapefile. The "dem" is a
> coarse 1 km x 1km grid imported from GRASS 5.7. Both use UTM NAD27, but
> the projections are not #set. The data represents the state of Chiapas
> in Southern Mexico
>
> image(chisgrid,"dem",col=terrain.colors(100))
> plot(municipios,add=T)
>
> #Gives what we wanted in base graphics
>
> #But
>
> spplot(municipios, "AREA", panel <- function(x,y,...){
>     sp.grid(chisgrid)
>     panel.polygonsplot(x,y,...)
>     })
> #Doesn't
>
> #and
>
> municips <- list("sp.polygons", municipios)
> spplot(chisgrid["dem"],sp.layout=municips)
>
> #Draws them in the wrong order.
>
> #As an aside, this is great fun with rgl and the students loved it. Can
> anyone improve the code?
>
> view3d<-function(grid=chisgrid,dem=1,drape=2,exag=3,pal=sp.theme()$regions$col){
>   fullgrid(grid)<-TRUE
>   y<-grid[[dem]]*exag
>   y[is.na(y)]<-0
>   dim(y)<-grid at grid@cells.dim
>
>   x <- grid at grid@cellsize[1]*(1:grid at grid@cells.dim[1])
>   z <-grid at grid@cellsize[2]*(1:grid at grid@cells.dim[2])
>
>   y2<-grid[[drape]]
>   y2[!is.na(y2)]<-as.numeric(cut( y2[!is.na(y2)],length(pal)))
>   y2[is.na(y2)]<-0
>
>   ylim <- range(y2)
>   ylen <- ylim[2] - ylim[1] + 1
>
>   pal<-c("black",pal)
>   col <- pal[ y2-ylim[1]+1 ] # assign colors to heights for each point
>
>   rgl.clear()
>   rgl.surface(x, z, y, color=col)
> }
>
> view3d(drape=1,pal=terrain.colors(100))
>
> Duncan
>
>
>
> Arien Lam wrote:
>
>> I stumbled there too.
>> A way is to customize the default panel function within spplot.
>>
>> Try:
>>
>> spplot(municipios, "yourvariable", panel <- function(x,y,...){
>>     sp.grid(chisgrid)
>>     panel.polygonsplot(x,y,...)
>>     })
>>
>> Regards, Arien
>>
>> Duncan Golicher schreef:
>>
>>> Many thanks to everyone involved in putting together the excelent sp
>>> package. I have just used for teaching a brief intro to applied
>>> geostats with gstat. Students found life much easier than a year ago
>>> when I had to try to explain a less structured approach to the data.
>>> A simple question arose after the class. According to the spplot
>>> documentation "for grids and polygons sp.layout is drawn afterwards
>>> (so the item will not be overdrawn by the grid and/or polygon)".
>>> So in this example we expected a DEM to be drawn first, then
>>> municipal boundaries.
>>>
>>>  > class(municipios)
>>> [1] "SpatialPolygonsDataFrame"
>>>  > class(chisgrid)
>>> [1] "SpatialPixelsDataFrame"
>>>
>>> municips <- list("sp.polygons", municipios)
>>> spplot(chisgrid["dem"],sp.layout=municips)
>>>
>>> The municipal boundaries are drawn first then overdrawn by the DEM,
>>> which was not what we expected or wanted. I couldn't find how to
>>> avoid this, apart from the simple solution of ..
>>>
>>> image(chisgrid,col=terrain.colors(20))
>>> plot(municipios,add=T)
>>>
>>> instead of spplot.The figures on  http://r-spatial.sourceforge.net
>>> all appear to have the grid drawn first. Is there a way to reverse
>>> this?
>>>
>>> Duncan
>>>
>>
>
>
> --
> Dr Duncan Golicher
> Ecologia y Sistematica Terrestre
> Conservaci?n de la Biodiversidad
> El Colegio de la Frontera Sur
> San Cristobal de Las Casas,
> Chiapas, Mexico
>
> Email: dgoliche at sclc.ecosur.mx
>
> Tel: 967 674 9000 ext 1310
> Fax: 967 678 2322
> Celular: 044 9671041021
>
> United Kingdom Skypein; 020 7870 6251
> Skype name: duncangolicher
> Download Skype from http://www.skype.com
>
>
>


-- 
drs. H.A. (Arien) Lam (Ph.D. student)
Department of Physical Geography
Faculty of Geosciences
Utrecht University, The Netherlands

E-mail:     a.lam at geo.uu.nl
Web:        http://www.geo.uu.nl/staff/a.lam

Telephone:  +31(0)30-253 2988 (direct), 2749 (secretary)
Fax:        +31(0)30-2531145

Visiting address: Room Zon 121, Heidelberglaan 2, Utrecht
Postal address: P.O.Box 80.115, 3508 TC Utrecht



From dgoliche at sclc.ecosur.mx  Thu Jul  6 23:03:47 2006
From: dgoliche at sclc.ecosur.mx (Duncan Golicher)
Date: Thu, 06 Jul 2006 16:03:47 -0500
Subject: [R-sig-Geo] drawing order in spplot and Line width in sp maps
In-Reply-To: <39388.131.211.65.133.1152210792.squirrel@webmail.geo.uu.nl>
References: <44AA8B9A.7030200@sclc.ecosur.mx> <44ABB62B.5080505@geo.uu.nl>  
	<44AD31A5.9080801@sclc.ecosur.mx> 
	<39388.131.211.65.133.1152210792.squirrel@webmail.geo.uu.nl>
Message-ID: <44AD7AB3.2040402@sclc.ecosur.mx>

Great. Thanks so much. It was obvious really.
You also seem to have come up with one solution to the line width 
question asked a couple of days ago,  as this works.

spplot(chisgrid, "dem", panel = function(x,y, ...){
    panel.gridplot(x,y,...)
    sp.polygons(municipios, col=1,fill=0,lwd=3,lty=2)
    })


Duncan

Arien Lam wrote:

>Duncan,
>
>After a few tries I found:
>
>spplot(chisgrid, "dem", panel = function(x,y, ...){
>    panel.gridplot(x,y, ...)
>    sp.polygons(municipios, col=1,fill=0)
>    })
>
>, which is just the reverse nesting order from my previous shot at it.
>HTH, Arien
>
>To be precise, this worked on:
>  
>
>>sessionInfo()
>>    
>>
>Version 2.3.1 (2006-06-01)
>i486-pc-linux-gnu
>
>attached base packages:
>[1] "methods"   "stats"     "graphics"  "grDevices" "utils"     "datasets"
>[7] "base"
>
>other attached packages:
> lattice       sp
>"0.13-8" "0.8-16"
>
>
>This approach is advocated for tweaking trellis plots.
>
>On Thu, July 6, 2006 17:52, Duncan Golicher wrote:
>  
>
>>Thanks for this Arien,
>>
>>Just can't get it to work though. I messed around a bit more yesterday
>>but couldn't find a way. No one else on the list replied. I have another
>>reason to want to do something similar, so I was hoping there was a work
>>around out there. Here is the data if you (or anyone else) can help.
>>
>>load(file=url("ftp://200.23.34.16/simulacion/SPATIAL/chisgrid.rob"))
>>load(file=url("ftp://200.23.34.16/simulacion/SPATIAL//municipios.rob"))
>>
>>#municipios was originally imported from a shapefile. The "dem" is a
>>coarse 1 km x 1km grid imported from GRASS 5.7. Both use UTM NAD27, but
>>the projections are not #set. The data represents the state of Chiapas
>>in Southern Mexico
>>
>>image(chisgrid,"dem",col=terrain.colors(100))
>>plot(municipios,add=T)
>>
>>#Gives what we wanted in base graphics
>>
>>#But
>>
>>spplot(municipios, "AREA", panel <- function(x,y,...){
>>    sp.grid(chisgrid)
>>    panel.polygonsplot(x,y,...)
>>    })
>>#Doesn't
>>
>>#and
>>
>>municips <- list("sp.polygons", municipios)
>>spplot(chisgrid["dem"],sp.layout=municips)
>>
>>#Draws them in the wrong order.
>>
>>#As an aside, this is great fun with rgl and the students loved it. Can
>>anyone improve the code?
>>
>>view3d<-function(grid=chisgrid,dem=1,drape=2,exag=3,pal=sp.theme()$regions$col){
>>  fullgrid(grid)<-TRUE
>>  y<-grid[[dem]]*exag
>>  y[is.na(y)]<-0
>>  dim(y)<-grid at grid@cells.dim
>>
>>  x <- grid at grid@cellsize[1]*(1:grid at grid@cells.dim[1])
>>  z <-grid at grid@cellsize[2]*(1:grid at grid@cells.dim[2])
>>
>>  y2<-grid[[drape]]
>>  y2[!is.na(y2)]<-as.numeric(cut( y2[!is.na(y2)],length(pal)))
>>  y2[is.na(y2)]<-0
>>
>>  ylim <- range(y2)
>>  ylen <- ylim[2] - ylim[1] + 1
>>
>>  pal<-c("black",pal)
>>  col <- pal[ y2-ylim[1]+1 ] # assign colors to heights for each point
>>
>>  rgl.clear()
>>  rgl.surface(x, z, y, color=col)
>>}
>>
>>view3d(drape=1,pal=terrain.colors(100))
>>
>>Duncan
>>
>>
>>
>>Arien Lam wrote:
>>
>>    
>>
>>>I stumbled there too.
>>>A way is to customize the default panel function within spplot.
>>>
>>>Try:
>>>
>>>spplot(municipios, "yourvariable", panel <- function(x,y,...){
>>>    sp.grid(chisgrid)
>>>    panel.polygonsplot(x,y,...)
>>>    })
>>>
>>>Regards, Arien
>>>
>>>Duncan Golicher schreef:
>>>
>>>      
>>>
>>>>Many thanks to everyone involved in putting together the excelent sp
>>>>package. I have just used for teaching a brief intro to applied
>>>>geostats with gstat. Students found life much easier than a year ago
>>>>when I had to try to explain a less structured approach to the data.
>>>>A simple question arose after the class. According to the spplot
>>>>documentation "for grids and polygons sp.layout is drawn afterwards
>>>>(so the item will not be overdrawn by the grid and/or polygon)".
>>>>So in this example we expected a DEM to be drawn first, then
>>>>municipal boundaries.
>>>>
>>>> > class(municipios)
>>>>[1] "SpatialPolygonsDataFrame"
>>>> > class(chisgrid)
>>>>[1] "SpatialPixelsDataFrame"
>>>>
>>>>municips <- list("sp.polygons", municipios)
>>>>spplot(chisgrid["dem"],sp.layout=municips)
>>>>
>>>>The municipal boundaries are drawn first then overdrawn by the DEM,
>>>>which was not what we expected or wanted. I couldn't find how to
>>>>avoid this, apart from the simple solution of ..
>>>>
>>>>image(chisgrid,col=terrain.colors(20))
>>>>plot(municipios,add=T)
>>>>
>>>>instead of spplot.The figures on  http://r-spatial.sourceforge.net
>>>>all appear to have the grid drawn first. Is there a way to reverse
>>>>this?
>>>>
>>>>Duncan
>>>>
>>>>        
>>>>
>>--
>>Dr Duncan Golicher
>>Ecologia y Sistematica Terrestre
>>Conservaci?n de la Biodiversidad
>>El Colegio de la Frontera Sur
>>San Cristobal de Las Casas,
>>Chiapas, Mexico
>>
>>Email: dgoliche at sclc.ecosur.mx
>>
>>Tel: 967 674 9000 ext 1310
>>Fax: 967 678 2322
>>Celular: 044 9671041021
>>
>>United Kingdom Skypein; 020 7870 6251
>>Skype name: duncangolicher
>>Download Skype from http://www.skype.com
>>
>>
>>
>>    
>>
>
>
>  
>


-- 
Dr Duncan Golicher
Ecologia y Sistematica Terrestre
Conservaci?n de la Biodiversidad
El Colegio de la Frontera Sur
San Cristobal de Las Casas, 
Chiapas, Mexico

Email: dgoliche at sclc.ecosur.mx 

Tel: 967 674 9000 ext 1310
Fax: 967 678 2322
Celular: 044 9671041021

United Kingdom Skypein; 020 7870 6251
Skype name: duncangolicher 
Download Skype from http://www.skype.com



From epistat at gmail.com  Fri Jul  7 09:38:16 2006
From: epistat at gmail.com (zhijie zhang)
Date: Fri, 7 Jul 2006 15:38:16 +0800
Subject: [R-sig-Geo] [R] how do we sample in spatial statistics?
In-Reply-To: <17580.29817.450605.537921@maths.uwa.edu.au>
References: <mailman.9.1152007204.15936.r-sig-geo@stat.math.ethz.ch>
	<17579.14479.894617.187218@maths.uwa.edu.au>
	<2fc17e30607050710j3338e022j21b1962c56487c9d@mail.gmail.com>
	<17580.29817.450605.537921@maths.uwa.edu.au>
Message-ID: <2fc17e30607070038y88f0686qb92823191efaa770@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20060707/643b1514/attachment.pl>

From e.pebesma at geo.uu.nl  Fri Jul  7 16:03:06 2006
From: e.pebesma at geo.uu.nl (Edzer J. Pebesma)
Date: Fri, 07 Jul 2006 15:03:06 +0100
Subject: [R-sig-Geo] error message rgdal: dimensions do not match
In-Reply-To: <OFACAC028D.F16A73C7-ONCA2571A1.0082783D-CA2571A2.00003B94@nre.vic.gov.au>
References: <OFACAC028D.F16A73C7-ONCA2571A1.0082783D-CA2571A2.00003B94@nre.vic.gov.au>
Message-ID: <44AE699A.2090807@geo.uu.nl>

Karl, I can see there are some NaNs in your image; this may be a source 
of problem but I cannot see whether they are also present in band1. 
Otherwise, could you provide me with this or another example that lets 
me reproduce the bug (assuming it is one)?
--
Edzer

karl.sommer at dpi.vic.gov.au wrote:

>As suggested by Roger Bivand and Edzer Pebesma I have included the
>output of str(t1) and str(SPDF) below.
>
>The error persited when I tried to do the kriging in two steps, using gstat
>() and project().
>Kriging a different variable, eg. "band1", results in the same error.
>Converting t1 to a SpatialPointsDataFrame before kriging results in the
>same error.
>I also eliminated all zero values before calculating ndvi but the error
>persited.
>The traceback() info is included below.
>
>
>Regards
>
>Karl
>
>
>Indeed strange, given that 880 by 860 is 756800 (though 756800*2 is the
>first number). What does summary(t1) say? Is the single column named band1
>or ndvi? The class of t1 will be SpatialGridDataFrame, wouldn't
>SpatialPointsDataFrame be more digestible? Does doing it in two steps
>(gstat() then predict() of the gstat object) show anything? What did
>traceback() say after krige()?
>
>Roger
>
>ouput follows:
>
>  
>
>>str(t1)
>>    
>>
>Loading required package: sp
>Formal class 'SpatialGridDataFrame' [package "sp"] with 6 slots
>  ..@ data       :Formal class 'AttributeList' [package "sp"] with 1 slots
>  .. .. ..@ att:List of 5
>  .. .. .. ..$ band1: int [1:834470] 0 0 0 0 0 0 0 0 0 0 ...
>  .. .. .. ..$ band2: int [1:834470] 0 0 0 0 0 0 0 0 0 0 ...
>  .. .. .. ..$ band3: int [1:834470] 0 0 0 0 0 0 0 0 0 0 ...
>  .. .. .. ..$ band4: int [1:834470] 0 0 0 0 0 0 0 0 0 0 ...
>  .. .. .. ..$ ndvi : num [1:834470] NaN NaN NaN NaN NaN NaN NaN NaN NaN
>NaN ...
>  ..@ grid       :Formal class 'GridTopology' [package "sp"] with 3 slots
>  .. .. ..@ cellcentre.offset: Named num [1:2]  599029 6228561
>  .. .. .. ..- attr(*, "names")= chr [1:2] "x" "y"
>  .. .. ..@ cellsize         : num [1:2] 0.5 0.5
>  .. .. ..@ cells.dim        : int [1:2] 917 910
>  ..@ grid.index : int(0)
>  ..@ coords     : num [1:2, 1:2]  599029  599487 6228561 6229016
>  .. ..- attr(*, "dimnames")=List of 2
>  .. .. ..$ : NULL
>  .. .. ..$ : chr [1:2] "x" "y"
>  ..@ bbox       : num [1:2, 1:2]  599029 6228561  599487 6229016
>  .. ..- attr(*, "dimnames")=List of 2
>  .. .. ..$ : chr [1:2] "x" "y"
>  .. .. ..$ : chr [1:2] "min" "max"
>  ..@ proj4string:Formal class 'CRS' [package "sp"] with 1 slots
>  .. .. ..@ projargs: chr NA
>
>  
>
>>str(SPDF)
>>    
>>
>Formal class 'SpatialPixelsDataFrame' [package "sp"] with 7 slots
>  ..@ data       :Formal class 'AttributeList' [package "sp"] with 1 slots
>  .. .. ..@ att:List of 1
>  .. .. .. ..$ field: num [1:481262] 1 1 1 1 1 1 1 1 1 1 ...
>  ..@ coords.nrs : num(0)
>  ..@ grid       :Formal class 'GridTopology' [package "sp"] with 3 slots
>  .. .. ..@ cellcentre.offset: Named num [1:2]  599059 6228577
>  .. .. .. ..- attr(*, "names")= chr [1:2] "s1" "s2"
>  .. .. ..@ cellsize         : Named num [1:2] 0.5 0.5
>  .. .. .. ..- attr(*, "names")= chr [1:2] "s1" "s2"
>  .. .. ..@ cells.dim        : Named int [1:2] 809 830
>  .. .. .. ..- attr(*, "names")= chr [1:2] "s1" "s2"
>  ..@ grid.index : int [1:481262] 421 422 423 424 425 426 427 428 429 430
>...
>  ..@ coords     : num [1:481262, 1:2] 599269 599269 599270 599270 599271
>...
>  .. ..- attr(*, "dimnames")=List of 2
>  .. .. ..$ : NULL
>  .. .. ..$ : chr [1:2] "s1" "s2"
>  ..@ bbox       : num [1:2, 1:2]  599058 6228577  599463 6228992
>  .. ..- attr(*, "dimnames")=List of 2
>  .. .. ..$ : chr [1:2] "s1" "s2"
>  .. .. ..$ : chr [1:2] "min" "max"
>  ..@ proj4string:Formal class 'CRS' [package "sp"] with 1 slots
>  .. .. ..@ projargs: chr NA
>
>  
>
>>summary(t1)
>>    
>>
>Object of class SpatialGridDataFrame
>Coordinates:
>        min     max
>x  599028.5  599487
>y 6228561.0 6229016
>Is projected: NA
>proj4string : [NA]
>Number of points: 2
>Grid attributes:
>  cellcentre.offset cellsize cells.dim
>x          599028.8      0.5       917
>y         6228561.3      0.5       910
>Data attributes:
>     band1            band2            band3            band4
> Min.   :   0.0   Min.   :   0.0   Min.   :   0.0   Min.   :   0.0
> 1st Qu.: 299.0   1st Qu.: 480.0   1st Qu.: 261.0   1st Qu.: 491.0
> Median : 347.0   Median : 613.0   Median : 387.0   Median : 776.0
> Mean   : 302.5   Mean   : 540.4   Mean   : 467.4   Mean   : 633.3
> 3rd Qu.: 394.0   3rd Qu.: 715.0   3rd Qu.: 637.0   3rd Qu.: 913.0
> Max.   :2352.0   Max.   :3279.0   Max.   :2815.0   Max.   :1653.0
>
>      ndvi
> Min.   :-3.235e-01
> 1st Qu.: 9.552e-03
> Median : 2.467e-01
> Mean   : 1.992e-01
> 3rd Qu.: 4.209e-01
> Max.   : 7.185e-01
> NA's   : 2.046e+05
>
># traceback after kriging provides the following messages
>  
>
>>traceback()
>>    
>>
>5: .Call("gstat_new_data", as.double(raw$y), as.double(raw$locations),
>       as.double(raw$X), as.integer(raw$has.intercept), as.double(d$beta),
>       nmax, nmin, maxdist, as.integer(d$vfn), as.numeric(w), double(0),
>       as.integer(d$degree))
>4: predict.gstat(g, newdata = newdata, block = block, nsim = nsim,
>       indicators = indicators, na.action = na.action)
>3: .local(formula, locations, ...)
>2: krige(ndvi ~ 1, t1, SPDF)
>1: krige(ndvi ~ 1, t1, SPDF)
>
># converting to a SpatialPointsDataFrame before kriging resulted in
>the same error
>
>t1 <- as(t1, "SpatialPointsDataFrame")
>
>  
>
>>t1.idw <- krige(ndvi~1, t1,  SPDF)
>>    
>>
>Error: dimensions do not match: locations 1668940 and data 629822
>
># using two steps as suggested by Roger Bivand results in the same error
>
>  
>
>>t1.idw <- gstat(id = "ndvi", formula = ndvi ~ 1,
>>    
>>
>        data = t1, nmax = 7, set = list(idp = .5))
>
>  
>
>>predict(t1.idw, SPDF)
>>    
>>
>Error: dimensions do not match: locations 1668940 and data 629822
>
>_________________________________
>Karl J Sommer,
>Department of Primary Industries,
>Catchment & Agriculture Services,
>PO Box 905
>Mildura, VIC, Australia 3502
>
>Tel: +61 (0)3 5051 4390
>Fax +61 (0)3 5051 4534
>
>Email:     karl.sommer at dpi.vic.gov.au
>__________________________________
>
>
>  
>



From dgoliche at sclc.ecosur.mx  Sat Jul  8 04:00:16 2006
From: dgoliche at sclc.ecosur.mx (Duncan Golicher)
Date: Fri, 07 Jul 2006 21:00:16 -0500
Subject: [R-sig-Geo] spgrass6 with cygwin
Message-ID: <44AF11B0.9000605@sclc.ecosur.mx>

Can spgrass6 work with cygwin? I am trying to use grass 6 on a windows 
laptop instead of my old grass5.7. but can't find how to get stuff into R.
I admit to not exactly following what is meant by "R is assumed to be 
running within GRASS" 
I used to open grass, set the region then use, for example

set.cygwinstring("c/cygwin")
GRASS.connect(TRUE,gisdbase="c:/cygwin/Duncan",loc="altos",mapset="SCLC")
G<-gmeta()
d<-rast.get(G,c("dem","slope")

but I can't find the equivalent with spgrass6.

Thanks for any advice,

Duncan
-- 

Dr Duncan Golicher
Ecologia y Sistematica Terrestre
Conservaci?n de la Biodiversidad
El Colegio de la Frontera Sur
San Cristobal de Las Casas, 
Chiapas, Mexico

Email: dgoliche at sclc.ecosur.mx 

Tel: 967 674 9000 ext 1310
Fax: 967 678 2322
Celular: 044 9671041021

United Kingdom Skypein; 020 7870 6251
Skype name: duncangolicher 
Download Skype from http://www.skype.com



From amsantac at hotmail.com  Sat Jul  8 20:32:19 2006
From: amsantac at hotmail.com (=?iso-8859-1?B?QWztIFNhbnRhY3J1eg==?=)
Date: Sat, 08 Jul 2006 13:32:19 -0500
Subject: [R-sig-Geo] ossfim with Universal Kriging?
Message-ID: <BAY20-F5318C1A5D51CE1FD02560C9750@phx.gbl>

Dear list members:

I am trying to make a cost/benefit analysis in a sampling network for 
organic matter soil content data. The best model fitted was exponential 
(universal kriging, first order trend).

So I need to know if it is possible to use ossfim function with universal 
kriging.

I tried to modify the ossfim function but I get an error:

>ossfim.UK<-function (spacings = 1:5, block.sizes = 1:5, model, nmax = 25,
+     debug = 0)
+ {
+     n = floor(sqrt(nmax)) + 1
+     x = 0:(n - 1) + 0.5
+     x = sort(c(-x, x))
+     ret = matrix(NA, length(spacings) * length(block.sizes),
+         3)
+     r = 1
+     for (sp in spacings) {
+         for (bl in block.sizes) {
+             data.grid = data.frame(expand.grid(x * sp, x * sp),
+                 z = rep(1, length(x)^2))
+             names(data.grid) = c("x", "y", "z")
+             gridded(data.grid) = c("x", "y")
+             x0 = SpatialPoints(matrix(0, 1, 2))
## Next I modify the formula in krige using the coordinates names of my data
## to use universal kriging:
+             kr = krige(z ~ e+n, data.grid, x0, block = c(bl, bl),
+                 model = model, nmax = nmax, set = list(debug = debug))
+             ret[r, ] = c(sp, bl, sqrt(kr[["var1.var"]][1]))
+             r = r + 1
+         }
+     }
+     ret = data.frame(ret)
+     names(ret) = c("spacing", "block.size", "kriging.se")
+     ret
+ }
>err.grid <- ossfim.UK(seq(10,60,10),block.sizes=0,m.f.exp.t1)
Error in model.frame(formula, rownames, variables, varnames, extras, 
extranames,  :
        variable lengths differ (found for 'e')

Is it possible what I want to do? Does it have sense?

I appreciate any help or comment.

Sincerely,

Al? M. Santacruz
M.Sc. Geomatics, Student
National University of Colombia
Bogot? D.C.



From e.pebesma at geo.uu.nl  Sat Jul  8 21:48:21 2006
From: e.pebesma at geo.uu.nl (Edzer J Pebesma)
Date: Sat, 08 Jul 2006 21:48:21 +0200
Subject: [R-sig-Geo] ossfim with Universal Kriging?
In-Reply-To: <BAY20-F5318C1A5D51CE1FD02560C9750@phx.gbl>
References: <BAY20-F5318C1A5D51CE1FD02560C9750@phx.gbl>
Message-ID: <44B00C05.7000903@geo.uu.nl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20060708/dea2aaad/attachment.pl>

From amsantac at hotmail.com  Sun Jul  9 19:50:46 2006
From: amsantac at hotmail.com (=?iso-8859-1?B?QWztIFNhbnRhY3J1eg==?=)
Date: Sun, 09 Jul 2006 12:50:46 -0500
Subject: [R-sig-Geo] ossfim with Universal Kriging?
In-Reply-To: <44B00C05.7000903@geo.uu.nl>
Message-ID: <BAY20-F12BB85517B20BA6B0F3799C96A0@phx.gbl>

Dear Edzer,

Replacing e+n with x+y does not work either:

>err.grid <- ossfim.UK(seq(10,60,10),block.sizes=0,m.f.exp.t1)
Error in model.frame(formula, rownames, variables, varnames, extras, 
extranames,  :
        variable lengths differ (found for 'y')
In addition: Warning message:
'newdata' had 1 rows but variable(s) found have 104 rows


Al?




>From: Edzer J Pebesma <e.pebesma at geo.uu.nl>
>To: Al? Santacruz <amsantac at hotmail.com>
>CC: r-sig-geo at stat.math.ethz.ch
>Subject: Re: [R-sig-Geo] ossfim with Universal Kriging?
>Date: Sat, 08 Jul 2006 21:48:21 +0200
>
>Ali, if you replace e+n with x+y, does that work?
>
>I wasn't aware that ossfim was this restrictive; there's
>clearly some room for generalisation here.
>--
>Edzer
>
>Al? Santacruz wrote:
>
>>Dear list members:
>>
>>I am trying to make a cost/benefit analysis in a sampling network for 
>>organic matter soil content data. The best model fitted was exponential 
>>(universal kriging, first order trend).
>>
>>So I need to know if it is possible to use ossfim function with universal 
>>kriging.
>>
>>I tried to modify the ossfim function but I get an error:
>>
>>
>>
>>>ossfim.UK<-function (spacings = 1:5, block.sizes = 1:5, model, nmax = 25,
>>>
>>>
>>+     debug = 0)
>>+ {
>>+     n = floor(sqrt(nmax)) + 1
>>+     x = 0:(n - 1) + 0.5
>>+     x = sort(c(-x, x))
>>+     ret = matrix(NA, length(spacings) * length(block.sizes),
>>+         3)
>>+     r = 1
>>+     for (sp in spacings) {
>>+         for (bl in block.sizes) {
>>+             data.grid = data.frame(expand.grid(x * sp, x * sp),
>>+                 z = rep(1, length(x)^2))
>>+             names(data.grid) = c("x", "y", "z")
>>+             gridded(data.grid) = c("x", "y")
>>+             x0 = SpatialPoints(matrix(0, 1, 2))
>>## Next I modify the formula in krige using the coordinates names of my 
>>data
>>## to use universal kriging:
>>+             kr = krige(z ~ e+n, data.grid, x0, block = c(bl, bl),
>>+                 model = model, nmax = nmax, set = list(debug = debug))
>>+             ret[r, ] = c(sp, bl, sqrt(kr[["var1.var"]][1]))
>>+             r = r + 1
>>+         }
>>+     }
>>+     ret = data.frame(ret)
>>+     names(ret) = c("spacing", "block.size", "kriging.se")
>>+     ret
>>+ }
>>
>>
>>>err.grid <- ossfim.UK(seq(10,60,10),block.sizes=0,m.f.exp.t1)
>>>
>>>
>>Error in model.frame(formula, rownames, variables, varnames, extras, 
>>extranames,  :
>>        variable lengths differ (found for 'e')
>>
>>Is it possible what I want to do? Does it have sense?
>>
>>I appreciate any help or comment.
>>
>>Sincerely,
>>
>>Al? M. Santacruz
>>M.Sc. Geomatics, Student
>>National University of Colombia
>>Bogot? D.C.
>>
>>_______________________________________________
>>R-sig-Geo mailing list
>>R-sig-Geo at stat.math.ethz.ch
>>https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>



From e.pebesma at geo.uu.nl  Sun Jul  9 23:29:37 2006
From: e.pebesma at geo.uu.nl (Edzer J. Pebesma)
Date: Sun, 09 Jul 2006 23:29:37 +0200
Subject: [R-sig-Geo] drawing order in spplot
In-Reply-To: <44AA8B9A.7030200@sclc.ecosur.mx>
References: <44AA8B9A.7030200@sclc.ecosur.mx>
Message-ID: <44B17541.3090501@geo.uu.nl>

Duncan Golicher wrote:

>Many thanks to everyone involved in putting together the excelent sp 
>package. I have just used for teaching a brief intro to applied geostats 
>with gstat. Students found life much easier than a year ago when I had 
>to try to explain a less structured approach to the data.
>A simple question arose after the class. According to the spplot 
>documentation "for grids and polygons sp.layout is drawn afterwards (so 
>the item will not be overdrawn by the grid and/or polygon)".
>So in this example we expected a DEM to be drawn first, then municipal 
>boundaries.
>
> > class(municipios)
>[1] "SpatialPolygonsDataFrame"
> > class(chisgrid)
>[1] "SpatialPixelsDataFrame"
>
>municips <- list("sp.polygons", municipios)
>spplot(chisgrid["dem"],sp.layout=municips)
>
>The municipal boundaries are drawn first then overdrawn by the DEM, 
>which was not what we expected or wanted. I couldn't find how to avoid 
>this, apart from the simple solution of ..
>
>image(chisgrid,col=terrain.colors(20))
>plot(municipios,add=T)
>
>instead of spplot.The figures on  http://r-spatial.sourceforge.net all 
>appear to have the grid drawn first. Is there a way to reverse this?
>
>Duncan
>
>  
>
the sp.layout argument accepts a list item, first=TRUE or first=FALSE,
telling whether to
first or to last plot this item; you could try to use that.

I'll review whether the current setup is logical, or not.
--
Edzer



From e.pebesma at geo.uu.nl  Mon Jul 10 09:43:05 2006
From: e.pebesma at geo.uu.nl (Edzer J. Pebesma)
Date: Mon, 10 Jul 2006 09:43:05 +0200
Subject: [R-sig-Geo] drawing order in spplot and Line width in sp maps
In-Reply-To: <44AD7AB3.2040402@sclc.ecosur.mx>
References: <44AA8B9A.7030200@sclc.ecosur.mx> <44ABB62B.5080505@geo.uu.nl>
	<44AD31A5.9080801@sclc.ecosur.mx>
	<39388.131.211.65.133.1152210792.squirrel@webmail.geo.uu.nl>
	<44AD7AB3.2040402@sclc.ecosur.mx>
Message-ID: <44B20509.9050702@geo.uu.nl>

I uploaded sp 0.8-18 to CRAN, which should fix:
- a bug that breaks sp 0.8-16 on r-devel
- not passing lty and lwd to spplot methods for SpatialPolygonsDataFrame
and SpatialLinesDataFrame objects.
--
Edzer

Duncan Golicher wrote:
> Great. Thanks so much. It was obvious really.
> You also seem to have come up with one solution to the line width 
> question asked a couple of days ago,  as this works.
>
> spplot(chisgrid, "dem", panel = function(x,y, ...){
>     panel.gridplot(x,y,...)
>     sp.polygons(municipios, col=1,fill=0,lwd=3,lty=2)
>     })
>
>
> Duncan
>   
>



From e.pebesma at geo.uu.nl  Mon Jul 10 09:47:46 2006
From: e.pebesma at geo.uu.nl (Edzer J. Pebesma)
Date: Mon, 10 Jul 2006 09:47:46 +0200
Subject: [R-sig-Geo] drawing order in spplot and Line width in sp maps
In-Reply-To: <44AD7AB3.2040402@sclc.ecosur.mx>
References: <44AA8B9A.7030200@sclc.ecosur.mx> <44ABB62B.5080505@geo.uu.nl>
	<44AD31A5.9080801@sclc.ecosur.mx>
	<39388.131.211.65.133.1152210792.squirrel@webmail.geo.uu.nl>
	<44AD7AB3.2040402@sclc.ecosur.mx>
Message-ID: <44B20622.3070903@geo.uu.nl>

Duncan Golicher wrote:
> Great. Thanks so much. It was obvious really.
> You also seem to have come up with one solution to the line width 
> question asked a couple of days ago,  as this works.
>
> spplot(chisgrid, "dem", panel = function(x,y, ...){
>     panel.gridplot(x,y,...)
>     sp.polygons(municipios, col=1,fill=0,lwd=3,lty=2)
>     })
>
>
>   
Yes, or:

spplot(chisgrid, "dem", sp.layout=list("sp.polygons", municipios, col=1, 
fill=0, lwd=3, lty=2, first=F))

> Duncan
>
> Arien Lam wrote:
>
>   
>> Duncan,
>>
>> After a few tries I found:
>>
>> spplot(chisgrid, "dem", panel = function(x,y, ...){
>>    panel.gridplot(x,y, ...)
>>    sp.polygons(municipios, col=1,fill=0)
>>    })
>>
>> , which is just the reverse nesting order from my previous shot at it.
>> HTH, Arien
>>
>> To be precise, this worked on:
>>  
>>
>>     
>>> sessionInfo()
>>>    
>>>
>>>       
>> Version 2.3.1 (2006-06-01)
>> i486-pc-linux-gnu
>>
>> attached base packages:
>> [1] "methods"   "stats"     "graphics"  "grDevices" "utils"     "datasets"
>> [7] "base"
>>
>> other attached packages:
>> lattice       sp
>> "0.13-8" "0.8-16"
>>
>>
>> This approach is advocated for tweaking trellis plots.
>>
>> On Thu, July 6, 2006 17:52, Duncan Golicher wrote:
>>  
>>
>>     
>>> Thanks for this Arien,
>>>
>>> Just can't get it to work though. I messed around a bit more yesterday
>>> but couldn't find a way. No one else on the list replied. I have another
>>> reason to want to do something similar, so I was hoping there was a work
>>> around out there. Here is the data if you (or anyone else) can help.
>>>
>>> load(file=url("ftp://200.23.34.16/simulacion/SPATIAL/chisgrid.rob"))
>>> load(file=url("ftp://200.23.34.16/simulacion/SPATIAL//municipios.rob"))
>>>
>>> #municipios was originally imported from a shapefile. The "dem" is a
>>> coarse 1 km x 1km grid imported from GRASS 5.7. Both use UTM NAD27, but
>>> the projections are not #set. The data represents the state of Chiapas
>>> in Southern Mexico
>>>
>>> image(chisgrid,"dem",col=terrain.colors(100))
>>> plot(municipios,add=T)
>>>
>>> #Gives what we wanted in base graphics
>>>
>>> #But
>>>
>>> spplot(municipios, "AREA", panel <- function(x,y,...){
>>>    sp.grid(chisgrid)
>>>    panel.polygonsplot(x,y,...)
>>>    })
>>> #Doesn't
>>>
>>> #and
>>>
>>> municips <- list("sp.polygons", municipios)
>>> spplot(chisgrid["dem"],sp.layout=municips)
>>>
>>> #Draws them in the wrong order.
>>>
>>> #As an aside, this is great fun with rgl and the students loved it. Can
>>> anyone improve the code?
>>>
>>> view3d<-function(grid=chisgrid,dem=1,drape=2,exag=3,pal=sp.theme()$regions$col){
>>>  fullgrid(grid)<-TRUE
>>>  y<-grid[[dem]]*exag
>>>  y[is.na(y)]<-0
>>>  dim(y)<-grid at grid@cells.dim
>>>
>>>  x <- grid at grid@cellsize[1]*(1:grid at grid@cells.dim[1])
>>>  z <-grid at grid@cellsize[2]*(1:grid at grid@cells.dim[2])
>>>
>>>  y2<-grid[[drape]]
>>>  y2[!is.na(y2)]<-as.numeric(cut( y2[!is.na(y2)],length(pal)))
>>>  y2[is.na(y2)]<-0
>>>
>>>  ylim <- range(y2)
>>>  ylen <- ylim[2] - ylim[1] + 1
>>>
>>>  pal<-c("black",pal)
>>>  col <- pal[ y2-ylim[1]+1 ] # assign colors to heights for each point
>>>
>>>  rgl.clear()
>>>  rgl.surface(x, z, y, color=col)
>>> }
>>>
>>> view3d(drape=1,pal=terrain.colors(100))
>>>
>>> Duncan
>>>
>>>
>>>
>>> Arien Lam wrote:
>>>
>>>    
>>>
>>>       
>>>> I stumbled there too.
>>>> A way is to customize the default panel function within spplot.
>>>>
>>>> Try:
>>>>
>>>> spplot(municipios, "yourvariable", panel <- function(x,y,...){
>>>>    sp.grid(chisgrid)
>>>>    panel.polygonsplot(x,y,...)
>>>>    })
>>>>
>>>> Regards, Arien
>>>>
>>>> Duncan Golicher schreef:
>>>>
>>>>      
>>>>
>>>>         
>>>>> Many thanks to everyone involved in putting together the excelent sp
>>>>> package. I have just used for teaching a brief intro to applied
>>>>> geostats with gstat. Students found life much easier than a year ago
>>>>> when I had to try to explain a less structured approach to the data.
>>>>> A simple question arose after the class. According to the spplot
>>>>> documentation "for grids and polygons sp.layout is drawn afterwards
>>>>> (so the item will not be overdrawn by the grid and/or polygon)".
>>>>> So in this example we expected a DEM to be drawn first, then
>>>>> municipal boundaries.
>>>>>
>>>>>           
>>>>>> class(municipios)
>>>>>>             
>>>>> [1] "SpatialPolygonsDataFrame"
>>>>>           
>>>>>> class(chisgrid)
>>>>>>             
>>>>> [1] "SpatialPixelsDataFrame"
>>>>>
>>>>> municips <- list("sp.polygons", municipios)
>>>>> spplot(chisgrid["dem"],sp.layout=municips)
>>>>>
>>>>> The municipal boundaries are drawn first then overdrawn by the DEM,
>>>>> which was not what we expected or wanted. I couldn't find how to
>>>>> avoid this, apart from the simple solution of ..
>>>>>
>>>>> image(chisgrid,col=terrain.colors(20))
>>>>> plot(municipios,add=T)
>>>>>
>>>>> instead of spplot.The figures on  http://r-spatial.sourceforge.net
>>>>> all appear to have the grid drawn first. Is there a way to reverse
>>>>> this?
>>>>>
>>>>> Duncan
>>>>>
>>>>>        
>>>>>
>>>>>           
>>> --
>>> Dr Duncan Golicher
>>> Ecologia y Sistematica Terrestre
>>> Conservaci?n de la Biodiversidad
>>> El Colegio de la Frontera Sur
>>> San Cristobal de Las Casas,
>>> Chiapas, Mexico
>>>
>>> Email: dgoliche at sclc.ecosur.mx
>>>
>>> Tel: 967 674 9000 ext 1310
>>> Fax: 967 678 2322
>>> Celular: 044 9671041021
>>>
>>> United Kingdom Skypein; 020 7870 6251
>>> Skype name: duncangolicher
>>> Download Skype from http://www.skype.com
>>>
>>>
>>>
>>>    
>>>
>>>       
>>  
>>
>>     
>
>
>



From sonia.broner at upc.edu  Tue Jul 11 16:52:36 2006
From: sonia.broner at upc.edu (Sonia Broner - UPC)
Date: Tue, 11 Jul 2006 16:52:36 +0200
Subject: [R-sig-Geo] map legend
Message-ID: <002d01c6a4f9$a64acdd0$a8185393@Sonia>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20060711/87e4d3ce/attachment.pl>

From e.pebesma at geo.uu.nl  Thu Jul 13 11:30:17 2006
From: e.pebesma at geo.uu.nl (Edzer J. Pebesma)
Date: Thu, 13 Jul 2006 10:30:17 +0100
Subject: [R-sig-Geo] map legend
In-Reply-To: <002d01c6a4f9$a64acdd0$a8185393@Sonia>
References: <002d01c6a4f9$a64acdd0$a8185393@Sonia>
Message-ID: <44B612A9.9020407@geo.uu.nl>

Sonia, it might help to send an example that we can reproduce without 
access to your data, in order to see what's going on. If that doesn't 
help, you might to ask r-help, as the legend() command is not specific 
to geospatial data analysis, afaics.
--
Edzer

Sonia Broner - UPC wrote:

>Hi list!
>
>I`ve tried to do a choropleth map in R but I`ve had problems with the legend.
>I`d like only two digits in the legend but  don`t know how to do this.
>Thanks
>
>Sonia
>
>
>library(RColorBrewer)
>
>par(mfrow=c(1,1))
>
>nivel<-cut(CIU_T,5)
>
>par(pty="m")
>
>nParts<-as.numeric(nivel)
>
>mypalette<-brewer.pal(7,"YlOrRd")
>
>fgs<-mypalette[nParts]
>
>plot(zrp_ov,fg=fgs,xlab="",ylab="",xaxt="n",yaxt="n",bty="n",ol="grey")
>
>brks<-attributes(nivel)$levels
>
>legend("topleft",legend=brks,fill=mypalette,bty="n",cex=.8,title="CIU_T",inset=0)
>
>
>
>
>	[[alternative HTML version deleted]]
>
>_______________________________________________
>R-sig-Geo mailing list
>R-sig-Geo at stat.math.ethz.ch
>https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>  
>



From dgoliche at sclc.ecosur.mx  Fri Jul 14 02:42:18 2006
From: dgoliche at sclc.ecosur.mx (Duncan Golicher)
Date: Thu, 13 Jul 2006 19:42:18 -0500
Subject: [R-sig-Geo] reading from Grass
Message-ID: <44B6E86A.1040805@sclc.ecosur.mx>

Can anyone help me to understand how to read data from grass6 running in 
cygwin using spgrass6? I asked on friday, but got no reply.
I first thought I could always resort to my old way with GRASS, but (of 
course?) as soon as I change a region with grass6 I get

GRASS.connect(TRUE,gisdbase="e:/",loc="wgs84",mapset="PERMANENT")
Error in gmeta() : Bad or no region for current mapset
Error in GRASS.connect(TRUE, gisdbase = "e:/", loc = "wgs84", mapset = 
"PERMANENT") :
        cannot retrieve window metadata from specificed location

Thanks for any advice.

Duncan

-- 
Dr Duncan Golicher
Ecologia y Sistematica Terrestre
Conservaci?n de la Biodiversidad
El Colegio de la Frontera Sur
San Cristobal de Las Casas, 
Chiapas, Mexico

Email: dgoliche at sclc.ecosur.mx 

Tel: 967 674 9000 ext 1310
Fax: 967 678 2322
Celular: 044 9671041021

United Kingdom Skypein; 020 7870 6251
Skype name: duncangolicher 
Download Skype from http://www.skype.com



From e.pebesma at geo.uu.nl  Sat Jul 15 21:43:41 2006
From: e.pebesma at geo.uu.nl (Edzer J. Pebesma)
Date: Sat, 15 Jul 2006 21:43:41 +0200
Subject: [R-sig-Geo] map legend
In-Reply-To: <002d01c6a4f9$a64acdd0$a8185393@Sonia>
References: <002d01c6a4f9$a64acdd0$a8185393@Sonia>
Message-ID: <44B9456D.7000905@geo.uu.nl>

Sonia, perhaps by

nivel <- cut(CIU_T ,seq(min(CIU_T),max(CIU_T),length=6))

hth,
--
Edzer

Sonia Broner - UPC wrote:
> Hi list!
>
> I`ve tried to do a choropleth map in R but I`ve had problems with the legend.
> I`d like only two digits in the legend but  don`t know how to do this.
> Thanks
>
> Sonia
>
>
> library(RColorBrewer)
>
> par(mfrow=c(1,1))
>
> nivel<-cut(CIU_T,5)
>
> par(pty="m")
>
> nParts<-as.numeric(nivel)
>
> mypalette<-brewer.pal(7,"YlOrRd")
>
> fgs<-mypalette[nParts]
>
> plot(zrp_ov,fg=fgs,xlab="",ylab="",xaxt="n",yaxt="n",bty="n",ol="grey")
>
> brks<-attributes(nivel)$levels
>
> legend("topleft",legend=brks,fill=mypalette,bty="n",cex=.8,title="CIU_T",inset=0)
>
>
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



From mmfuller at tiem.utk.edu  Mon Jul 17 23:56:28 2006
From: mmfuller at tiem.utk.edu (Michael Fuller)
Date: Mon, 17 Jul 2006 17:56:28 -0400
Subject: [R-sig-Geo] geo-newbie Q: overlay lat-long data onto projected map?
Message-ID: <BFB0EC0B-E445-46D1-ABF3-C323D9E21711@tiem.utk.edu>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20060717/3cb58de6/attachment.pl>

From mdsumner at utas.edu.au  Tue Jul 18 04:18:58 2006
From: mdsumner at utas.edu.au (Michael Sumner)
Date: Tue, 18 Jul 2006 4:18:58 +0200
Subject: [R-sig-Geo] problem assigning POSIX class to AttributeList column
Message-ID: <200607180218.k6I2IwZO016178@corinna.its.utas.edu.au>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20060718/ca493fd7/attachment.pl>

From mmfuller at tiem.utk.edu  Tue Jul 18 15:43:23 2006
From: mmfuller at tiem.utk.edu (Michael Fuller)
Date: Tue, 18 Jul 2006 09:43:23 -0400
Subject: [R-sig-Geo] geo-newbie Q: overlay lat-long data onto projected
	map?
In-Reply-To: <4702645135092E4497088F71D9C8F51A0224E5A3@afhex01.dpi.wa.gov.au>
References: <4702645135092E4497088F71D9C8F51A0224E5A3@afhex01.dpi.wa.gov.au>
Message-ID: <883D4509-CFB2-4A03-B7D0-6FB30BF5343A@tiem.utk.edu>

This is awesome help! Thank you very much Tom!
I will give it a go.
Mike

On Jul 17, 2006, at 10:04 PM, Mulholland, Tom wrote:

> Yes you are correct in your assumption that if you are not using  
> the "maps" package you need to have your own boundary files. There  
> is the "National Atlas of the United States" produced by the USGS  
> which I recall has downloads of a variety of shapefiles. http://www- 
> atlas.usgs.gov/ is the mainpage but administrative boundaries are  
> on http://www-atlas.usgs.gov/atlasftp.html? 
> openChapters=chpbound#chpbound in compressed files. I'm sure I have  
> previously found them uncompressed, but it's not too hard to  
> decompress tham as you only have to do it once.
>
>
> So once you have the shapefiles you can read them using the  
> maptools package with the readShapePoly set of commands.
>
> such as
>
> US <- readShapePoly("name of shape file")
> #make sure you have the correct transformation
> # set the CRS for the shapefile you have downloaded.
> # You need to check the metadata associated with your shapefile
>
> # I typically use sommething like
> #    proj4string(x) <- CRS("+proj=longlat +datum=NAD83")
> # Then reproject it into the format you wnat to use
> #    x <- transform(x,CRS("+proj=utm +zone=50"))
> #    }
>
> # Having done that
>
> plot(US,...)
>
> #Then you add your data to the map
> plot(S, pch = 20, add = TRUE)
>
> Yes you can extract the coordinates from maps
>
>> test <- map("world","UK",xlim = c(-8.08932,3.4), ylim = c 
>> (49.11741,61.54963))
>> str(test)
> List of 4
>  $ x    : num [1:296] -6.24 -6.30 -6.23 -6.38 -6.46 ...
>  $ y    : num [1:296] 58.5 58.3 58.2 58.2 58.1 ...
>  $ range: num [1:4] -8.09  1.73 49.25 60.84
>  $ names: chr [1:25] "UK:Scotland:Isle of Lewis" "UK:Guernsey"  
> "UK:Great Britain" "UK:Scotland:Shetland Islands:Unst" ...
>  - attr(*, "class")= chr "map"
>
> but it looks like you would them have to process them into an sp  
> format. However the world map is not particularly detailed. It's  
> possible the US county data is of more precision.
>
> If you just use maps then you should be able to use "points" to  
> plot your data
>
> map('usa')
> points(S$x, S$y, pch = 20)
>
> Not having delved into the map package I don't know exactly how it  
> handles projections but it looks like
>
> map('usa', projection = "yourCRS")
>
> would be sufficient.
>
> I hope this helps.
>
> Tom Mulholland
> Senior Demographer
> Applied Research and Modelling
> State and Regional Policy
> Department for Planning and Infrastructure
> Perth, Western Australia
> +61 (08) 9264 7936
>
>
>>
>> -----Original Message-----
>> From: r-sig-geo-bounces at stat.math.ethz.ch
>> [mailto:r-sig-geo-bounces at stat.math.ethz.ch]On Behalf Of
>> Michael Fuller
>> Sent: Tuesday, 18 July 2006 5:56 AM
>> To: r-sig-geo at stat.math.ethz.ch
>> Subject: [R-sig-Geo] geo-newbie Q: overlay lat-long data onto
>> projected
>> map?
>>
>>
>> I've spent the last 5 days trying to figure out how to overlay the
>> positions of geographic data on top of a map. I've scoured the man
>> pages for the maps, mapproj, maptools, mapdata, and the huge sp
>> package. I've experimented with countless permutations of commands.
>> So far I've learned a lot about map projections, but I still have no
>> ideas how to display my data the way I want! (sigh)
>>
>> The data are the latitude-longitude coordinates of 1,599
>> survey sites
>> located across the US. I want to plot these sites on a map of
>> the US.
>> Seems like a simple task. I've tried converting them to a
>> SpatialPoints object and worked out how to project the sites using a
>> given map projection (i.e. Bonne). But how do I correctly overlay
>> (i.e. display) the data points onto a similarly projected map of the
>> US? It might be possible to do it using overlay {sp} but for that it
>> seems I would need the coordinates of the geopolitical boundary for
>> the map of the US. Can these values be extracted somehow from the US
>> map?
>>
>> Here's how I generated the SpatialPoints object:
>>
>> #x = longitude values in decimal degrees
>> #y = latitude values in decimal degrees
>> #create SpatialPoints object using CRS-class Bonne projection
>> centered on longitude 100
>> S <- SpatialPoints(cbind(x,y),CRS("+proj=bonne +lon_0=100"))
>>
>> #this next part plots just the data points (cloud of points)
>> plot(S,pch=20)
>>
>> How do I overlay the same points on top of a map of the US such that
>> they are correctly positioned wrt coordinates?
>>
>> Also, the R-sig-geo info page does show an URL for a searchable
>> archive of R-sig-geo. Does one exist?
>>
>> Many thanks for your time.
>> Mike
>> ______________________________
>> Michael M Fuller, Ph.D.
>> The Institute for Environmental Modeling
>> University of Tennessee
>> 1416 Circle Drive
>> Knoxville, TN 37996-1610
>>
>>
>>
>>
>> 	[[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>



From e.pebesma at geo.uu.nl  Tue Jul 18 17:22:17 2006
From: e.pebesma at geo.uu.nl (Edzer J. Pebesma)
Date: Tue, 18 Jul 2006 16:22:17 +0100
Subject: [R-sig-Geo] geo-newbie Q: overlay lat-long data onto projected
 map?
In-Reply-To: <883D4509-CFB2-4A03-B7D0-6FB30BF5343A@tiem.utk.edu>
References: <4702645135092E4497088F71D9C8F51A0224E5A3@afhex01.dpi.wa.gov.au>
	<883D4509-CFB2-4A03-B7D0-6FB30BF5343A@tiem.utk.edu>
Message-ID: <44BCFCA8.3030001@geo.uu.nl>

Michael, on http://r-spatial.sourceforge.net you'll find a package (and 
installation instructions) called spmaps, which converts an object from 
the maps package (and data base) to an sp object. If needed at all...
--
Edzer

Michael Fuller wrote:

>This is awesome help! Thank you very much Tom!
>I will give it a go.
>Mike
>
>On Jul 17, 2006, at 10:04 PM, Mulholland, Tom wrote:
>
>  
>
>>Yes you are correct in your assumption that if you are not using  
>>the "maps" package you need to have your own boundary files. There  
>>is the "National Atlas of the United States" produced by the USGS  
>>which I recall has downloads of a variety of shapefiles. http://www- 
>>atlas.usgs.gov/ is the mainpage but administrative boundaries are  
>>on http://www-atlas.usgs.gov/atlasftp.html? 
>>openChapters=chpbound#chpbound in compressed files. I'm sure I have  
>>previously found them uncompressed, but it's not too hard to  
>>decompress tham as you only have to do it once.
>>
>>
>>So once you have the shapefiles you can read them using the  
>>maptools package with the readShapePoly set of commands.
>>
>>such as
>>
>>US <- readShapePoly("name of shape file")
>>#make sure you have the correct transformation
>># set the CRS for the shapefile you have downloaded.
>># You need to check the metadata associated with your shapefile
>>
>># I typically use sommething like
>>#    proj4string(x) <- CRS("+proj=longlat +datum=NAD83")
>># Then reproject it into the format you wnat to use
>>#    x <- transform(x,CRS("+proj=utm +zone=50"))
>>#    }
>>
>># Having done that
>>
>>plot(US,...)
>>
>>#Then you add your data to the map
>>plot(S, pch = 20, add = TRUE)
>>
>>Yes you can extract the coordinates from maps
>>
>>    
>>
>>>test <- map("world","UK",xlim = c(-8.08932,3.4), ylim = c 
>>>(49.11741,61.54963))
>>>str(test)
>>>      
>>>
>>List of 4
>> $ x    : num [1:296] -6.24 -6.30 -6.23 -6.38 -6.46 ...
>> $ y    : num [1:296] 58.5 58.3 58.2 58.2 58.1 ...
>> $ range: num [1:4] -8.09  1.73 49.25 60.84
>> $ names: chr [1:25] "UK:Scotland:Isle of Lewis" "UK:Guernsey"  
>>"UK:Great Britain" "UK:Scotland:Shetland Islands:Unst" ...
>> - attr(*, "class")= chr "map"
>>
>>but it looks like you would them have to process them into an sp  
>>format. However the world map is not particularly detailed. It's  
>>possible the US county data is of more precision.
>>
>>If you just use maps then you should be able to use "points" to  
>>plot your data
>>
>>map('usa')
>>points(S$x, S$y, pch = 20)
>>
>>Not having delved into the map package I don't know exactly how it  
>>handles projections but it looks like
>>
>>map('usa', projection = "yourCRS")
>>
>>would be sufficient.
>>
>>I hope this helps.
>>
>>Tom Mulholland
>>Senior Demographer
>>Applied Research and Modelling
>>State and Regional Policy
>>Department for Planning and Infrastructure
>>Perth, Western Australia
>>+61 (08) 9264 7936
>>
>>
>>    
>>
>>>-----Original Message-----
>>>From: r-sig-geo-bounces at stat.math.ethz.ch
>>>[mailto:r-sig-geo-bounces at stat.math.ethz.ch]On Behalf Of
>>>Michael Fuller
>>>Sent: Tuesday, 18 July 2006 5:56 AM
>>>To: r-sig-geo at stat.math.ethz.ch
>>>Subject: [R-sig-Geo] geo-newbie Q: overlay lat-long data onto
>>>projected
>>>map?
>>>
>>>
>>>I've spent the last 5 days trying to figure out how to overlay the
>>>positions of geographic data on top of a map. I've scoured the man
>>>pages for the maps, mapproj, maptools, mapdata, and the huge sp
>>>package. I've experimented with countless permutations of commands.
>>>So far I've learned a lot about map projections, but I still have no
>>>ideas how to display my data the way I want! (sigh)
>>>
>>>The data are the latitude-longitude coordinates of 1,599
>>>survey sites
>>>located across the US. I want to plot these sites on a map of
>>>the US.
>>>Seems like a simple task. I've tried converting them to a
>>>SpatialPoints object and worked out how to project the sites using a
>>>given map projection (i.e. Bonne). But how do I correctly overlay
>>>(i.e. display) the data points onto a similarly projected map of the
>>>US? It might be possible to do it using overlay {sp} but for that it
>>>seems I would need the coordinates of the geopolitical boundary for
>>>the map of the US. Can these values be extracted somehow from the US
>>>map?
>>>
>>>Here's how I generated the SpatialPoints object:
>>>
>>>#x = longitude values in decimal degrees
>>>#y = latitude values in decimal degrees
>>>#create SpatialPoints object using CRS-class Bonne projection
>>>centered on longitude 100
>>>S <- SpatialPoints(cbind(x,y),CRS("+proj=bonne +lon_0=100"))
>>>
>>>#this next part plots just the data points (cloud of points)
>>>plot(S,pch=20)
>>>
>>>How do I overlay the same points on top of a map of the US such that
>>>they are correctly positioned wrt coordinates?
>>>
>>>Also, the R-sig-geo info page does show an URL for a searchable
>>>archive of R-sig-geo. Does one exist?
>>>
>>>Many thanks for your time.
>>>Mike
>>>______________________________
>>>Michael M Fuller, Ph.D.
>>>The Institute for Environmental Modeling
>>>University of Tennessee
>>>1416 Circle Drive
>>>Knoxville, TN 37996-1610
>>>
>>>
>>>
>>>
>>>	[[alternative HTML version deleted]]
>>>
>>>_______________________________________________
>>>R-sig-Geo mailing list
>>>R-sig-Geo at stat.math.ethz.ch
>>>https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>>      
>>>
>
>_______________________________________________
>R-sig-Geo mailing list
>R-sig-Geo at stat.math.ethz.ch
>https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>  
>



From e.pebesma at geo.uu.nl  Tue Jul 18 17:49:24 2006
From: e.pebesma at geo.uu.nl (Edzer J. Pebesma)
Date: Tue, 18 Jul 2006 16:49:24 +0100
Subject: [R-sig-Geo] problem assigning POSIX class to AttributeList
	column
In-Reply-To: <200607180218.k6I2IwZO016178@corinna.its.utas.edu.au>
References: <200607180218.k6I2IwZO016178@corinna.its.utas.edu.au>
Message-ID: <44BD0304.4080404@geo.uu.nl>

Michael, this missing feature is definately a bug; AttributeList objects 
were meant to resemble data.frame objects but without having a row.names 
attribute (like the data.frame in R 2.4.0 will be); POSIXct vectors are 
allowed in data.frame's.

Did you actually solve it?

Best regards,
--
Edzer

Michael Sumner wrote:

>Hello, I've been unable to use "[[<-.AttributeList" to assign POSIXct vectors.
>
>It seems to be because 
>is.vector(Sys.time()) 
>
>is FALSE.  The test "is.vector(value)" is perhaps too strict ?? but I
>don't see whether this is perhaps a problem with the datetimeClasses. 
>
>Example follows. 
>
>Cheers, Mike.
>
>
>sessionInfo()
>#Version 2.3.1 (2006-06-01) 
>#i386-pc-mingw32 
>
>#attached base packages:
>#[1] "methods"   "stats"     "graphics"  "grDevices" "utils"     "datasets" 
>#[7] "base"     
>
>#other attached packages:
>#      sp 
>#"0.8-16" 
>
>al <- AttributeList(list(x = 1:10, y = gl(2, 5), t = Sys.time() + 1:10))
>
>
>al[["t"]] <- Sys.time() + 1:10  
>#Error: is.vector(value) || is.factor(value) is not TRUE
>
>traceback()
>#4: stop(paste(deparse(mc[[i + 1]]), " is not ", if (length(r) > 
>#       1) "all ", "TRUE", sep = ""), call. = FALSE)
>#3: stopifnot(is.vector(value) || is.factor(value))
>#2: "[[<-.AttributeList"(`*tmp*`, "t", value = c(1153188132.868, 
>#   1153188133.868, 1153188134.868, 1153188135.868, 1153188136.868, 
>#   1153188137.868, 1153188138.868, 1153188139.868, 1153188140.868, 
>#   1153188141.868))
>#1: "[[<-"(`*tmp*`, "t", value = c(1153188132.868, 1153188133.868, 
>#   1153188134.868, 1153188135.868, 1153188136.868, 1153188137.868, 
>#   1153188138.868, 1153188139.868, 1153188140.868, 1153188141.868
>#   ))
>
>
>## the same problem occurs with
>al[[3]] <- Sys.time() + 1:10
>
>## and with
>
>al[["t"]] <- al[["t"]]
>
>## assigning numeric to numeric OK
>al[["x"]] <- 2:11
>
>## but assigning POSIX to same is not
>al[["x"]] <- Sys.time() + 1:10
>
>
># straight list version
>
>l <- list(x = 1:10, y = gl(2, 5), t = Sys.time() + 1:10)
>
>## works fine:
>l[["t"]] <- l[["t"]]
>
>_______________________________________________
>R-sig-Geo mailing list
>R-sig-Geo at stat.math.ethz.ch
>https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>  
>



From mmfuller at tiem.utk.edu  Tue Jul 18 17:55:31 2006
From: mmfuller at tiem.utk.edu (Michael Fuller)
Date: Tue, 18 Jul 2006 11:55:31 -0400
Subject: [R-sig-Geo] geo-newbie Q: overlay lat-long data onto projected
	map?
In-Reply-To: <44BCFCA8.3030001@geo.uu.nl>
References: <4702645135092E4497088F71D9C8F51A0224E5A3@afhex01.dpi.wa.gov.au>
	<883D4509-CFB2-4A03-B7D0-6FB30BF5343A@tiem.utk.edu>
	<44BCFCA8.3030001@geo.uu.nl>
Message-ID: <9E6EF395-46DC-424B-A196-19F678F7681A@tiem.utk.edu>

Great! Thanks Edzer
Mike

On Jul 18, 2006, at 11:22 AM, Edzer J. Pebesma wrote:

> Michael, on http://r-spatial.sourceforge.net you'll find a package  
> (and installation instructions) called spmaps, which converts an  
> object from the maps package (and data base) to an sp object. If  
> needed at all...
> --
> Edzer
>
> Michael Fuller wrote:
>
>> This is awesome help! Thank you very much Tom!
>> I will give it a go.
>> Mike
>>
>> On Jul 17, 2006, at 10:04 PM, Mulholland, Tom wrote:
>>
>>
>>> Yes you are correct in your assumption that if you are not using   
>>> the "maps" package you need to have your own boundary files.  
>>> There  is the "National Atlas of the United States" produced by  
>>> the USGS  which I recall has downloads of a variety of  
>>> shapefiles. http://www- atlas.usgs.gov/ is the mainpage but  
>>> administrative boundaries are  on http://www-atlas.usgs.gov/ 
>>> atlasftp.html? openChapters=chpbound#chpbound in compressed  
>>> files. I'm sure I have  previously found them uncompressed, but  
>>> it's not too hard to  decompress tham as you only have to do it  
>>> once.
>>>
>>>
>>> So once you have the shapefiles you can read them using the   
>>> maptools package with the readShapePoly set of commands.
>>>
>>> such as
>>>
>>> US <- readShapePoly("name of shape file")
>>> #make sure you have the correct transformation
>>> # set the CRS for the shapefile you have downloaded.
>>> # You need to check the metadata associated with your shapefile
>>>
>>> # I typically use sommething like
>>> #    proj4string(x) <- CRS("+proj=longlat +datum=NAD83")
>>> # Then reproject it into the format you wnat to use
>>> #    x <- transform(x,CRS("+proj=utm +zone=50"))
>>> #    }
>>>
>>> # Having done that
>>>
>>> plot(US,...)
>>>
>>> #Then you add your data to the map
>>> plot(S, pch = 20, add = TRUE)
>>>
>>> Yes you can extract the coordinates from maps
>>>
>>>
>>>> test <- map("world","UK",xlim = c(-8.08932,3.4), ylim = c  
>>>> (49.11741,61.54963))
>>>> str(test)
>>>>
>>> List of 4
>>> $ x    : num [1:296] -6.24 -6.30 -6.23 -6.38 -6.46 ...
>>> $ y    : num [1:296] 58.5 58.3 58.2 58.2 58.1 ...
>>> $ range: num [1:4] -8.09  1.73 49.25 60.84
>>> $ names: chr [1:25] "UK:Scotland:Isle of Lewis" "UK:Guernsey"   
>>> "UK:Great Britain" "UK:Scotland:Shetland Islands:Unst" ...
>>> - attr(*, "class")= chr "map"
>>>
>>> but it looks like you would them have to process them into an sp   
>>> format. However the world map is not particularly detailed. It's   
>>> possible the US county data is of more precision.
>>>
>>> If you just use maps then you should be able to use "points" to   
>>> plot your data
>>>
>>> map('usa')
>>> points(S$x, S$y, pch = 20)
>>>
>>> Not having delved into the map package I don't know exactly how  
>>> it  handles projections but it looks like
>>>
>>> map('usa', projection = "yourCRS")
>>>
>>> would be sufficient.
>>>
>>> I hope this helps.
>>>
>>> Tom Mulholland
>>> Senior Demographer
>>> Applied Research and Modelling
>>> State and Regional Policy
>>> Department for Planning and Infrastructure
>>> Perth, Western Australia
>>> +61 (08) 9264 7936
>>>
>>>
>>>
>>>> -----Original Message-----
>>>> From: r-sig-geo-bounces at stat.math.ethz.ch
>>>> [mailto:r-sig-geo-bounces at stat.math.ethz.ch]On Behalf Of
>>>> Michael Fuller
>>>> Sent: Tuesday, 18 July 2006 5:56 AM
>>>> To: r-sig-geo at stat.math.ethz.ch
>>>> Subject: [R-sig-Geo] geo-newbie Q: overlay lat-long data onto
>>>> projected
>>>> map?
>>>>
>>>>
>>>> I've spent the last 5 days trying to figure out how to overlay the
>>>> positions of geographic data on top of a map. I've scoured the man
>>>> pages for the maps, mapproj, maptools, mapdata, and the huge sp
>>>> package. I've experimented with countless permutations of commands.
>>>> So far I've learned a lot about map projections, but I still  
>>>> have no
>>>> ideas how to display my data the way I want! (sigh)
>>>>
>>>> The data are the latitude-longitude coordinates of 1,599
>>>> survey sites
>>>> located across the US. I want to plot these sites on a map of
>>>> the US.
>>>> Seems like a simple task. I've tried converting them to a
>>>> SpatialPoints object and worked out how to project the sites  
>>>> using a
>>>> given map projection (i.e. Bonne). But how do I correctly overlay
>>>> (i.e. display) the data points onto a similarly projected map of  
>>>> the
>>>> US? It might be possible to do it using overlay {sp} but for  
>>>> that it
>>>> seems I would need the coordinates of the geopolitical boundary for
>>>> the map of the US. Can these values be extracted somehow from  
>>>> the US
>>>> map?
>>>>
>>>> Here's how I generated the SpatialPoints object:
>>>>
>>>> #x = longitude values in decimal degrees
>>>> #y = latitude values in decimal degrees
>>>> #create SpatialPoints object using CRS-class Bonne projection
>>>> centered on longitude 100
>>>> S <- SpatialPoints(cbind(x,y),CRS("+proj=bonne +lon_0=100"))
>>>>
>>>> #this next part plots just the data points (cloud of points)
>>>> plot(S,pch=20)
>>>>
>>>> How do I overlay the same points on top of a map of the US such  
>>>> that
>>>> they are correctly positioned wrt coordinates?
>>>>
>>>> Also, the R-sig-geo info page does show an URL for a searchable
>>>> archive of R-sig-geo. Does one exist?
>>>>
>>>> Many thanks for your time.
>>>> Mike
>>>> ______________________________
>>>> Michael M Fuller, Ph.D.
>>>> The Institute for Environmental Modeling
>>>> University of Tennessee
>>>> 1416 Circle Drive
>>>> Knoxville, TN 37996-1610
>>>>
>>>>
>>>>
>>>>
>>>> 	[[alternative HTML version deleted]]
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at stat.math.ethz.ch
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>



From mdsumner at utas.edu.au  Wed Jul 19 06:35:08 2006
From: mdsumner at utas.edu.au (Michael Sumner)
Date: Wed, 19 Jul 2006 14:35:08 +1000
Subject: [R-sig-Geo] problem assigning POSIX class to AttributeList
	column
In-Reply-To: <44BD0304.4080404@geo.uu.nl>
References: <200607180218.k6I2IwZO016178@corinna.its.utas.edu.au>
	<44BD0304.4080404@geo.uu.nl>
Message-ID: <44BDB67C.5080606@utas.edu.au>

Edzer J. Pebesma wrote:
> Michael, this missing feature is definately a bug; AttributeList 
> objects were meant to resemble data.frame objects but without having a 
> row.names attribute (like the data.frame in R 2.4.0 will be); POSIXct 
> vectors are allowed in data.frame's.
>
> Did you actually solve it?
>
Thanks Edzer, I can just work around it.  I look forward to the new 
data.frame. ;)

Cheers, Mike.



From debarchana.ghosh at gmail.com  Wed Jul 19 23:24:17 2006
From: debarchana.ghosh at gmail.com (Debarchana Ghosh)
Date: Wed, 19 Jul 2006 16:24:17 -0500
Subject: [R-sig-Geo] Moran's I - nb class?
Message-ID: <d1b8ff630607191424o6b804432he6833873dd6f6541@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20060719/84012a5a/attachment.pl>

From Olli at trunorthsystems.com  Thu Jul 20 20:32:28 2006
From: Olli at trunorthsystems.com (Andreas M. Olligschlaeger)
Date: Thu, 20 Jul 2006 14:32:28 -0400
Subject: [R-sig-Geo] Availability of R Script for WSAF(weighted spatial
 adaptive filter)
Message-ID: <6.2.3.4.2.20060720142949.02d3bd60@pop.business.earthlink.net>

No, I'm afraid it is not. The original system was written in Pascal.

Olli

____________________________
Andreas M. Olligschlaeger, Ph.D.
TruNorth Data Systems, Inc.
(724) 775-8441



From mmfuller at tiem.utk.edu  Fri Jul 21 19:50:47 2006
From: mmfuller at tiem.utk.edu (Michael Fuller)
Date: Fri, 21 Jul 2006 13:50:47 -0400
Subject: [R-sig-Geo] Adding Contours to Map (revisited)
Message-ID: <DDE0E0BF-D4E9-40A7-B01A-619B14E8F839@tiem.utk.edu>

I'm trying to add filled contour lines of count data to a projected  
map but I'm having difficulty getting the contours to match up  
properly with the projection. A nearly identical problem was  
described in a previous post (Nov 2005) by Jeanne Thibeault and I've  
tried the approach recommended by Roger Bivand, but I've been  
unsuccessful so far.

The raw data are the longitude-latitude coordinates (x,y) of 307  
survey locations spread across the US. Each coordinate pair is  
associated with a count value (z). I've generated a grid of  
interpolated data using interp() {akima}

 > dat.intrp <- interp(x,y,z)

But how can I display these as filled contours on a US map? Roger  
suggested the following for Jeanne's interpolated data set called  
"Sum.80.83.li" (also created using interp()):

<begin quote>
    With a little work, you can use contourLines():

    res <- contourLines(Sum.80.83.li)
    contours_x <- unlist(sapply(res, function(x) c(x$x, NA)))
    contours_y <- unlist(sapply(res, function(x) c(x$y, NA)))
    contours <- list(x=contours_x, y=contours_y)

    gets you contours you can give as an argument to mapproject(),  
but you'll
    need to handle label positions and values yourself based on res -  
look at
    str(res[[1]]) to get a view of what the raw contours look like.

    plot(mapproject(contours, ...), type="l")

    does the plotting.
<end quote>

I'm not sure what this transformation yields (I'm still a relative  
newbie). It seems that 'contours_x' and 'contours_y' are vectors  
whose values are 'NA', generated using unlist() and using sapply() to  
replace the x and y values of 'res'  with 'NA'?

For example:
junk <-c(1:5)
junk2 <-unlist(sapply(junk, function(x) c(x$x,NA)))
junk2
[1] NA NA NA NA NA

Obviously I'm missing something here. How does this generate  
contours? (It doesn't work for me).

Thanks for your patience.
Mike



From dray at biomserv.univ-lyon1.fr  Mon Jul 24 09:59:52 2006
From: dray at biomserv.univ-lyon1.fr (=?ISO-8859-1?Q?St=E9phane_Dray?=)
Date: Mon, 24 Jul 2006 09:59:52 +0200
Subject: [R-sig-Geo] Moran's I - nb class?
In-Reply-To: <d1b8ff630607191424o6b804432he6833873dd6f6541@mail.gmail.com>
References: <d1b8ff630607191424o6b804432he6833873dd6f6541@mail.gmail.com>
Message-ID: <44C47DF8.6000908@biomserv.univ-lyon1.fr>

You can fin dome information on the vignette of my own package spacemakeR.
Go to http://biomserv.univ-lyon1.fr/~dray/, Softwares section, download 
or open the spacemakeR archive, and read the tutorial in the inst/doc 
directory.

Sincerely,

Debarchana Ghosh wrote:

>Hi,
>
>I'm trying to calculate global Moran's I for residuals from glm model. I
>read the manual of spdep package and for the function 'moran'  it requires a
>'listw' object created by the function nb2listw, which in turn requires the
>object of class 'nb'. I can't understand how to create the object of class
>nb and which function to use to create it.
>
>Any help will be appreciated.
>
>Thanks,
>Debarchana.
>
>  
>


-- 
St?phane DRAY (dray at biomserv.univ-lyon1.fr )
Laboratoire BBE-CNRS-UMR-5558, Univ. C. Bernard - Lyon I
43, Bd du 11 Novembre 1918, 69622 Villeurbanne Cedex, France
Tel: 33 4 72 43 27 57       Fax: 33 4 72 43 13 88
http://biomserv.univ-lyon1.fr/~dray/



From zev at zevross.com  Tue Jul 25 17:28:33 2006
From: zev at zevross.com (Zev Ross)
Date: Tue, 25 Jul 2006 11:28:33 -0400
Subject: [R-sig-Geo] Creating metadata - xml?
Message-ID: <44C638A1.9020600@zevross.com>

Hi All,

I'm wondering if anyone has pointers in generating and/or editing 
spatial metadata in R. Roger, Edzer and others have done such a great 
job of developing tools to create shapefiles without ArcGIS but I'd like 
to add a few notes about how the files were created without the extra 
step of opening ArcCatalog.

All I, personally, would need at this point is a way to edit the 
"abstract" portion of a traditional metadata, though ultimately editing 
the other fields (like the spatial reference info) would also be great.

I spent some time trying to use the XML library to do this, but I 
couldn't hack it and wasn't sure I was heading down the right path.

The code below does not work and reveals my ignorance, but perhaps it 
can convince someone to give me some tips.

Zev


d<-parseDTD("http://www.esri.com/metadata/esriprof80.dtd", asText=FALSE,
      isURL=TRUE)

tree<-xmlOutputDOM("mytest", dtd=d)
tree$addTag("abstract", "myblah")
tree$closeTag()
saveXML(tree$value(), file="c:/junk/blah2.xml")



-- 
Zev Ross
ZevRoss Spatial Analysis
303 Fairmount Ave.
Ithaca, NY 14850
(607) 277-0004 (phone)
(866) 877-3690 (fax toll-free)
zev at zevross.com
www.zevross.com



From hi_ono2001 at yahoo.co.jp  Thu Jul 27 03:07:55 2006
From: hi_ono2001 at yahoo.co.jp (Hisaji ONO)
Date: Thu, 27 Jul 2006 10:07:55 +0900 (JST)
Subject: [R-sig-Geo] availability of Least-Squares Collocation(LSC)
	technique for optimal interpolation of spatial data. on r
Message-ID: <20060727010755.34412.qmail@web10712.mail.bbt.yahoo.co.jp>

Hi

 Recently among geostatistics Least-Squares
Collocation(LSC) technique seems to be one of notable
methods.

 I've searched this method on R spatial packages, but no
luck.


 Does anyone know free application/package support this
method?


 Regards.



From hi_ono2001 at ybb.ne.jp  Thu Jul 27 03:46:28 2006
From: hi_ono2001 at ybb.ne.jp (Hisaji ONO)
Date: Thu, 27 Jul 2006 10:46:28 +0900 (JST)
Subject: [R-sig-Geo] Availability of R Script for WSAF(weighted spatial
	adaptive filter)
In-Reply-To: <6.2.3.4.2.20060720142949.02d3bd60@pop.business.earthlink.net>
Message-ID: <20060727014628.26701.qmail@web10714.mail.bbt.yahoo.co.jp>

Hello, Andreas 

 Thank you for your important info.

 Sorry for late for my response. 

--- "M. Olligschlaeger" <Olli at trunorthsystems.com> wrote:

> No, I'm afraid it is not. The original system was
> written in Pascal.

 Could you tell me availability of this Pascal source?

 If I could get this, I've tried to port it to R script.


 Regards.



From karl.sommer at dpi.vic.gov.au  Thu Jul 27 04:17:06 2006
From: karl.sommer at dpi.vic.gov.au (karl.sommer at dpi.vic.gov.au)
Date: Thu, 27 Jul 2006 12:17:06 +1000
Subject: [R-sig-Geo]  gstat error: singular matrix in function LDLfactor()
Message-ID: <OFA5FF45E8.BC9D5E23-ONCA2571B8.0007CBF1-CA2571B8.000C8D3B@nre.vic.gov.au>

When performing ordinary kriging under gstat in R I received the following
error after the program had stopped.

---R output
vert.ok <- krige(vert~1, em38a, SPDF, model=vert.fit)
[using ordinary kriging]

"chfactor.c", line 130: singular matrix in function LDLfactor()

gstat caught an error that occurred in the matrix library,
the reason for it was: singular matrix

HINT: Read the manual at http://www.gstat.org/ ;
look for: Trouble shooting -> Error messages -> From meschach

"chfactor.c", line 130: singular matrix in function LDLfactor()
Error in predict.gstat(g, newdata = newdata, block = block, nsim = nsim,  :
      matrix library error: gstat: matrix library error: singular matrix
---end R output

after consulting the gstat manual I found the following reference:

"These two error messages may occur (a) during simulation, when an
observation falls almost exactly at a simulation location (b) when two
observations occur at identical location occur and noaverage was defined in
its data definition. Solution to (a): increase the value of zero, to (b):
remove the noaverage. Read also the next section."

My input file was converted from lat/long to UTM using spTransform.  The
sampling density is quite high and it is possible that after conversion
from latlong to UTM because of rounding some measurements fall on identical
coordinates.  Is this a possible explanation for the error?

The GSTAT online manual suggests to remove "noaverage" or increase "zero"
to overcome the problem. However, I have not figured out how to do this
when running gstat under R.

Should I use only a subset of the orignial data or are there other
alternatives to overcome the problem?

Regards

Karl

_________________________________
Karl J Sommer,
Department of Primary Industries,
Catchment & Agriculture Services,
PO Box 905
Mildura, VIC, Australia 3502

Tel: +61 (0)3 5051 4390
Fax +61 (0)3 5051 4534

Email:     karl.sommer at dpi.vic.gov.au



From dgoliche at sclc.ecosur.mx  Thu Jul 27 17:08:50 2006
From: dgoliche at sclc.ecosur.mx (Duncan Golicher)
Date: Thu, 27 Jul 2006 10:08:50 -0500
Subject: [R-sig-Geo] gstat error: singular matrix in function
Message-ID: <44C8D702.7020307@sclc.ecosur.mx>

A simple work around is to just add some random noise to the points with 
jitter.

?jitter


-- 
Dr Duncan Golicher
Ecologia y Sistematica Terrestre
Conservaci?n de la Biodiversidad
El Colegio de la Frontera Sur
San Cristobal de Las Casas, 
Chiapas, Mexico

Email: dgoliche at sclc.ecosur.mx 

Tel: 967 674 9000 ext 1310
Fax: 967 678 2322
Celular: 044 9671041021

United Kingdom Skypein; 020 7870 6251
Skype name: duncangolicher 
Download Skype from http://www.skype.com



From jansc at gmx.net  Fri Jul 28 01:58:41 2006
From: jansc at gmx.net (Jan Schwanbeck)
Date: Fri, 28 Jul 2006 01:58:41 +0200
Subject: [R-sig-Geo] contourline as border between cells containing numbers
	and those containing NA of ASCII grid
Message-ID: <op.tddgv3ef6wy4pi@winpuffo>

Hi R spatial experts,

 From an ASCII grid I have made a couple of filled.contour - plots.

All cells outside the area of interest are set to NA. The cells inside
the area of investigation are numbers(real).

In my plots - both NA's and values smaller than 0.5 are "transparent".

To show the border of the area of investigation I would like to generate
a contourline or something similar in between cells containing numbers and  
those containing NA.

Is there any possibile way to do that?

If not: -> How could I overlay a filled.contour-plot with a shape file  
(the border of the area)?

Thanks a lot.

Jan Schwanbeck



From Roger.Bivand at nhh.no  Fri Jul 28 12:09:44 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 28 Jul 2006 12:09:44 +0200 (CEST)
Subject: [R-sig-Geo] contourline as border between cells containing
 numbers and those containing NA of ASCII grid
In-Reply-To: <op.tddgv3ef6wy4pi@winpuffo>
Message-ID: <Pine.LNX.4.44.0607281200260.15447-100000@reclus.nhh.no>

On Fri, 28 Jul 2006, Jan Schwanbeck wrote:

> Hi R spatial experts,
> 
>  From an ASCII grid I have made a couple of filled.contour - plots.
> 
> All cells outside the area of interest are set to NA. The cells inside
> the area of investigation are numbers(real).
> 
> In my plots - both NA's and values smaller than 0.5 are "transparent".
> 
> To show the border of the area of investigation I would like to generate
> a contourline or something similar in between cells containing numbers and  
> those containing NA.
> 
> Is there any possibile way to do that?
> 
> If not: -> How could I overlay a filled.contour-plot with a shape file  
> (the border of the area)?

Have a look at the plot.axes= argument for how to insert extra graphics 
into the plot:

library(maptools)
xx <- readShapePoly(system.file("shapes/sids.shp",
  package = "maptools")[1], IDvar = "FIPSNO",
  proj4string = CRS("+proj=longlat +ellps=clrk66"))
plot(xx)
bbox(xx)
x <- seq(-85,-75,1)
y <- seq(33,37,1)
xy <- expand.grid(x,y)
length(x)
length(y)
z <- matrix(runif(55), nrow=11)
filled.contour(x, y, z, asp=1)
filled.contour(x, y, z, asp=1, plot.axes={axis(1); axis(2); plot(xx, 
  add=TRUE)})

does seem to work.

Roger

> 
> Thanks a lot.
> 
> Jan Schwanbeck
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From aruiz at eeza.csic.es  Mon Jul 31 12:17:34 2006
From: aruiz at eeza.csic.es (Alberto Ruiz Moreno)
Date: Mon, 31 Jul 2006 12:17:34 +0200
Subject: [R-sig-Geo] randomForests for mapping vegetation with big data
Message-ID: <306770A257EE3840A78215253AF233C815AC61@CORREO.eeza.csic.es>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20060731/52baefdd/attachment.pl>

From aruiz at eeza.csic.es  Mon Jul 31 12:37:17 2006
From: aruiz at eeza.csic.es (Alberto Ruiz Moreno)
Date: Mon, 31 Jul 2006 12:37:17 +0200
Subject: [R-sig-Geo] randomForests for mapping vegetation with big data
Message-ID: <306770A257EE3840A78215253AF233C815AC64@CORREO.eeza.csic.es>

Hi,
 
I?m trying to ran randomForests in R to do vegetation suitability maps.
 
I?m working with 1000x1000 pixel maps and 30 environmental  variables.
 
My software is R v2.3.1 and RandomForests 4.5-16. 
1GB Ram memory and 3GB swap partition in a Linux or Windows machine
(the problem is the same in both configurations).
 
R abort with an memory limits error when I try to train randomForest with 
big data frames, 300000 rows x 30 columns and 500 trees.
 
I have lost one week tuning the use of memory in R (I read tens of messages on it) but
I think that it is not a R misconfiguration but a big memory expense of randomforests library implementation.
 
My conclusion is: I need to divide...
 
ok, to solve this memory error, I ran randomForests several times, 
with less rows in the training data, and use the combine() function to join the forests.
 
The cuestion is...
 
Is this the right way to train randomForest with big data? 
There are another way?
How do you make it?
 

thanks...



