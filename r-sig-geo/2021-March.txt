From tom@heng| @end|ng |rom gm@||@com  Tue Mar  2 13:53:37 2021
From: tom@heng| @end|ng |rom gm@||@com (Tomislav Hengl)
Date: Tue, 2 Mar 2021 13:53:37 +0100
Subject: [R-sig-Geo] Spatial layers for Europe at 30-m available as Cloud
 Optimized GeoTiffs
Message-ID: <f59a3b07-c2f0-21ac-1f9c-3388578a82a2@gmail.com>

**

**

*

We have mapped land cover classes for the 2000-2019 period for 
continental Europe at 30-m resolution using spatiotemporal Machine 
Learning (we used R and python for modeling). Explore the dynamic EU 
landscapes on your palm using the ODS-Europe viewer: 
https://maps.opendatascience.eu

*

*To access almost 10TB of data using R you use the terra or similar 
packages e.g.:*
****

**R> library(terra)R> in.tif = 
"/vsicurl/http://s3.eu-central-1.wasabisys.com/eumap/lcv/lcv_landcover.hcl_lucas.corine.rf_p_30m_0..0cm_2019_eumap_epsg3035_v0.1.tif"R> 
tif = rast(in.tif)**

**From here you can use any native operation e.g. to crop some polygon 
or resample / aggregate values** (there is no need to download whole 
data sets). A detailed tutorial on how to work with **Cloud Optimized 
GeoTiffs is available here: 
https://gitlab.com/openlandmap/global-layers/-/blob/master/tutorial/OpenLandMap_COG_tutorial.md.** 
Complete list of Cloud Optimized GeoTiffs we produced so far for Europe 
is available here: 
https://gitlab.com/geoharmonizer_inea/eumap/-/blob/master/gh_raster_layers.csv 
**

**If not otherwise specified, the data available on this portal is 
licensed under the Open Data Commons Open Database License 
<https://opendatacommons.org/licenses/odbl/> (ODbL) and/or Creative 
Commons Attribution-ShareAlike 4.0 
<https://creativecommons.org/licenses/by-sa/4.0/legalcode> and/or 
Creative Commons Attribution 4.0 
<https://creativecommons.org/licenses/by/4.0/legalcode> International 
license (CC BY). ****

*Read more in: 
https://opengeohub.medium.com/europe-from-above-space-time-machine-learning-reveals-our-changing-environment-1b05cb7be520
*

*If you experience any technical problems or if you discover a bug, 
please report via: 
*https://gitlab.com/geoharmonizer_inea/spatial-layers/-/issues

T. Hengl
https://opengeohub.org/about


From m@p|no|@10 @end|ng |rom gm@||@com  Tue Mar  2 18:15:08 2021
From: m@p|no|@10 @end|ng |rom gm@||@com (=?UTF-8?Q?Manuel_Sp=C3=ADnola?=)
Date: Tue, 2 Mar 2021 11:15:08 -0600
Subject: [R-sig-Geo] How to identify the different discrete classes from a
 raster of land cover data (tif).
Message-ID: <CABkCotTEq+8SsQadO1wrhZDSUxEzCDaXBQFefGg0ot98Jy+F6Q@mail.gmail.com>

Dear list members,

I am working with a .tif file from the Copernicus Global Land Service with
land cover data.  The file has 23 discrete classes but the raster shows a
continuous range of values (0 to 255).

r =
raster(W100N20_PROBAV_LC100_global_v3.0.1_2019-nrt_Discrete-Classification-map_EPSG-4326.tif)

class      : RasterLayer
dimensions : 20160, 20160, 406425600  (nrow, ncol, ncell)
resolution : 0.0009920635, 0.0009920635  (x, y)
extent     : -100, -80, 0, 20  (xmin, xmax, ymin, ymax)
crs        : +proj=longlat +datum=WGS84 +no_defs
source     : /Users/manuelspinola/Documents/01-Manolo/R_OVS_material/landscape_ecology/datos_copernicus/W100N20_PROBAV_LC100_global_v3.0.1_2019-nrt_Discrete-Classification-map_EPSG-4326.tif
names      : W100N20_PROBAV_LC100_global_v3.0.1_2019.nrt_Discrete.Classification.map_EPSG.4326
values     : 0, 255  (min, max)



How can I recognize the different discrete classes included in the raster
representing each land cover type.

Manuel


-- 
*Manuel Sp?nola, Ph.D.*
Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
Universidad Nacional
Apartado 1350-3000
Heredia
COSTA RICA
mspinola at una.cr <mspinola at una.ac.cr>
mspinola10 at gmail.com
Tel?fono: (506) 8706 - 4662
Personal website: Lobito de r?o <https://sites.google.com/site/lobitoderio/>
Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>

	[[alternative HTML version deleted]]


From tom@heng| @end|ng |rom gm@||@com  Tue Mar  2 18:30:25 2021
From: tom@heng| @end|ng |rom gm@||@com (Tomislav Hengl)
Date: Tue, 2 Mar 2021 18:30:25 +0100
Subject: [R-sig-Geo] Spatial layers for Europe at 30-m available as Cloud
 Optimized GeoTiffs (corrected)
Message-ID: <e76c6c53-d554-c79d-96b9-ac4ba1701542@gmail.com>


We have mapped land cover classes for the 2000-2019 period for 
continental Europe at 30-m resolution using spatiotemporal Machine
Learning (we used R and python for modeling). Explore the dynamic EU 
landscapes on your palm using the ODS-Europe viewer: 
https://maps.opendatascience.eu

To access almost 10TB of data using R you use the terra or similar
packages e.g.:

R> library(terra)
R> in.tif = 
"/vsicurl/http://s3.eu-central-1.wasabisys.com/eumap/lcv/lcv_landcover.hcl_lucas.corine.rf_p_30m_0..0cm_2019_eumap_epsg3035_v0.1.tif"
R> tif = rast(in.tif)

 From here you can use any native operation e.g. to crop some polygon
or resample / aggregate values (there is no need to download whole
data sets). A detailed tutorial on how to work with Cloud Optimized
GeoTiffs is available here: 
https://gitlab.com/openlandmap/global-layers/-/blob/master/tutorial/OpenLandMap_COG_tutorial.md.

Complete list of Cloud Optimized GeoTiffs we produced so far for Europe
is available here: 
https://gitlab.com/geoharmonizer_inea/eumap/-/blob/master/gh_raster_layers.csv

If not otherwise specified, the data available on this portal is 
licensed under the Open Data Commons Open Database License 
<https://opendatacommons.org/licenses/odbl/> (ODbL) and/or Creative
Commons Attribution-ShareAlike 4.0 
<https://creativecommons.org/licenses/by-sa/4.0/legalcode> and/or 
Creative Commons Attribution 4.0 
<https://creativecommons.org/licenses/by/4.0/legalcode> International
license (CC BY).

Read more in: 
https://opengeohub.medium.com/europe-from-above-space-time-machine-learning-reveals-our-changing-environment-1b05cb7be520

If you experience any technical problems or if you discover a bug,
please report via: 
https://gitlab.com/geoharmonizer_inea/spatial-layers/-/issues

T. Hengl
https://opengeohub.org/about


From btupper @end|ng |rom b|ge|ow@org  Tue Mar  2 19:50:04 2021
From: btupper @end|ng |rom b|ge|ow@org (Ben Tupper)
Date: Tue, 2 Mar 2021 13:50:04 -0500
Subject: [R-sig-Geo] 
 How to identify the different discrete classes from a
 raster of land cover data (tif).
In-Reply-To: <CABkCotTEq+8SsQadO1wrhZDSUxEzCDaXBQFefGg0ot98Jy+F6Q@mail.gmail.com>
References: <CABkCotTEq+8SsQadO1wrhZDSUxEzCDaXBQFefGg0ot98Jy+F6Q@mail.gmail.com>
Message-ID: <CALrbzg3Cj6BEDmrHONrTix135mtmUEm-WmiXSj0AuJbn_8KuMA@mail.gmail.com>

Hi,

I'm not familiar with the dataset, but I am guessing it is related to how
the labels are encoded. If that is the case, then it is possible the stored
class labels are not literally 1-23 but are 23 labels selected from the
range of 0-255.  You could do a brief check with ...

table(r[])

Cheers,
Ben



On Tue, Mar 2, 2021 at 12:15 PM Manuel Sp?nola <mspinola10 at gmail.com> wrote:

> Dear list members,
>
> I am working with a .tif file from the Copernicus Global Land Service with
> land cover data.  The file has 23 discrete classes but the raster shows a
> continuous range of values (0 to 255).
>
> r =
>
> raster(W100N20_PROBAV_LC100_global_v3.0.1_2019-nrt_Discrete-Classification-map_EPSG-4326.tif)
>
> class      : RasterLayer
> dimensions : 20160, 20160, 406425600  (nrow, ncol, ncell)
> resolution : 0.0009920635, 0.0009920635  (x, y)
> extent     : -100, -80, 0, 20  (xmin, xmax, ymin, ymax)
> crs        : +proj=longlat +datum=WGS84 +no_defs
> source     :
> /Users/manuelspinola/Documents/01-Manolo/R_OVS_material/landscape_ecology/datos_copernicus/W100N20_PROBAV_LC100_global_v3.0.1_2019-nrt_Discrete-Classification-map_EPSG-4326.tif
> names      :
> W100N20_PROBAV_LC100_global_v3.0.1_2019.nrt_Discrete.Classification.map_EPSG.4326
> values     : 0, 255  (min, max)
>
>
>
> How can I recognize the different discrete classes included in the raster
> representing each land cover type.
>
> Manuel
>
>
> --
> *Manuel Sp?nola, Ph.D.*
> Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
> Universidad Nacional
> Apartado 1350-3000
> Heredia
> COSTA RICA
> mspinola at una.cr <mspinola at una.ac.cr>
> mspinola10 at gmail.com
> Tel?fono: (506) 8706 - 4662
> Personal website: Lobito de r?o <
> https://sites.google.com/site/lobitoderio/>
> Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


-- 
Ben Tupper
Bigelow Laboratory for Ocean Science
East Boothbay, Maine
http://www.bigelow.org/
https://eco.bigelow.org

	[[alternative HTML version deleted]]


From m@p|no|@10 @end|ng |rom gm@||@com  Tue Mar  2 20:35:57 2021
From: m@p|no|@10 @end|ng |rom gm@||@com (=?UTF-8?Q?Manuel_Sp=C3=ADnola?=)
Date: Tue, 2 Mar 2021 13:35:57 -0600
Subject: [R-sig-Geo] 
 How to identify the different discrete classes from a
 raster of land cover data (tif).
In-Reply-To: <CALrbzg3Cj6BEDmrHONrTix135mtmUEm-WmiXSj0AuJbn_8KuMA@mail.gmail.com>
References: <CABkCotTEq+8SsQadO1wrhZDSUxEzCDaXBQFefGg0ot98Jy+F6Q@mail.gmail.com>
 <CALrbzg3Cj6BEDmrHONrTix135mtmUEm-WmiXSj0AuJbn_8KuMA@mail.gmail.com>
Message-ID: <CABkCotTfmbecxKhhNfs4wxwYNXr3j3_kUHubEXAJrXHbueh01g@mail.gmail.com>

Thank you very much Ben.  That works.

Manuel









El mar, 2 mar 2021 a las 12:50, Ben Tupper (<btupper at bigelow.org>) escribi?:

> Hi,
>
> I'm not familiar with the dataset, but I am guessing it is related to how
> the labels are encoded. If that is the case, then it is possible the stored
> class labels are not literally 1-23 but are 23 labels selected from the
> range of 0-255.  You could do a brief check with ...
>
> table(r[])
>
> Cheers,
> Ben
>
>
>
> On Tue, Mar 2, 2021 at 12:15 PM Manuel Sp?nola <mspinola10 at gmail.com>
> wrote:
>
>> Dear list members,
>>
>> I am working with a .tif file from the Copernicus Global Land Service with
>> land cover data.  The file has 23 discrete classes but the raster shows a
>> continuous range of values (0 to 255).
>>
>> r =
>>
>> raster(W100N20_PROBAV_LC100_global_v3.0.1_2019-nrt_Discrete-Classification-map_EPSG-4326.tif)
>>
>> class      : RasterLayer
>> dimensions : 20160, 20160, 406425600  (nrow, ncol, ncell)
>> resolution : 0.0009920635, 0.0009920635  (x, y)
>> extent     : -100, -80, 0, 20  (xmin, xmax, ymin, ymax)
>> crs        : +proj=longlat +datum=WGS84 +no_defs
>> source     :
>> /Users/manuelspinola/Documents/01-Manolo/R_OVS_material/landscape_ecology/datos_copernicus/W100N20_PROBAV_LC100_global_v3.0.1_2019-nrt_Discrete-Classification-map_EPSG-4326.tif
>> names      :
>> W100N20_PROBAV_LC100_global_v3.0.1_2019.nrt_Discrete.Classification.map_EPSG.4326
>> values     : 0, 255  (min, max)
>>
>>
>>
>> How can I recognize the different discrete classes included in the raster
>> representing each land cover type.
>>
>> Manuel
>>
>>
>> --
>> *Manuel Sp?nola, Ph.D.*
>> Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
>> Universidad Nacional
>> Apartado 1350-3000
>> Heredia
>> COSTA RICA
>> mspinola at una.cr <mspinola at una.ac.cr>
>> mspinola10 at gmail.com
>> Tel?fono: (506) 8706 - 4662
>> Personal website: Lobito de r?o <
>> https://sites.google.com/site/lobitoderio/>
>> Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>
> --
> Ben Tupper
> Bigelow Laboratory for Ocean Science
> East Boothbay, Maine
> http://www.bigelow.org/
> https://eco.bigelow.org
>
>

-- 
*Manuel Sp?nola, Ph.D.*
Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
Universidad Nacional
Apartado 1350-3000
Heredia
COSTA RICA
mspinola at una.cr <mspinola at una.ac.cr>
mspinola10 at gmail.com
Tel?fono: (506) 8706 - 4662
Personal website: Lobito de r?o <https://sites.google.com/site/lobitoderio/>
Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>

	[[alternative HTML version deleted]]


From edzer@pebe@m@ @end|ng |rom un|-muen@ter@de  Mon Mar 15 16:40:56 2021
From: edzer@pebe@m@ @end|ng |rom un|-muen@ter@de (Edzer Pebesma)
Date: Mon, 15 Mar 2021 16:40:56 +0100
Subject: [R-sig-Geo] 
 Spatial layers for Europe at 30-m available as Cloud
 Optimized GeoTiffs (corrected)
In-Reply-To: <e76c6c53-d554-c79d-96b9-ac4ba1701542@gmail.com>
References: <e76c6c53-d554-c79d-96b9-ac4ba1701542@gmail.com>
Message-ID: <71569e60-5155-22aa-e526-4d1de620a9fd@uni-muenster.de>

Hi Tom, great work!

When reading this either with terra or stars, as in

in.tif = 
"/vsicurl/http://s3.eu-central-1.wasabisys.com/eumap/lcv/lcv_landcover.hcl_lucas.corine.rf_p_30m_0..0cm_2019_eumap_epsg3035_v0.1.tif"

library(terra)
# terra version 1.1.5
plot(rast(in.tif))

#library(raster)
#plot(raster(in.tif))

library(stars)
# Loading required package: abind
# Loading required package: sf
# Linking to GEOS 3.9.0, GDAL 3.2.1, PROJ 7.2.1
plot(read_stars(in.tif))

I see that both plots show a continuous raster, not a categorical. We 
spent quite a bit of time recently in stars & tmap development to get 
handling and plotting of categorical rasters right (including those 
having a color table), but this file doesn't give proper access to the 
categories.

The metadata tags do have them:

stars::gdal_metadata(in.tif)
#  [1] "1=111 - Urban fabric"
#  [2] "10=212 - Permanently irrigated arable land"
#  [3] "11=213 - Rice fields"
#  [4] "12=221 - Vineyards"
#  [5] "13=222 - Fruit trees and berry plantations"
#  [6] "14=223 - Olive groves"
#  [7] "15=231 - Pastures"
#  [8] "16=311 - Broad-leaved forest"
#  [9] "17=312 - Coniferous forest"
# [10] "18=321 - Natural grasslands"
# [11] "19=322 - Moors and heathland"
# [12] "2=122 - Road and rail networks and associated land"
# [13] "20=323 - Sclerophyllous vegetation"
# [14] "21=324 - Transitional woodland-shrub"
# [15] "22=331 - Beaches, dunes, sands"
# [16] "23=332 - Bare rocks"
# [17] "24=333 - Sparsely vegetated areas"
# [18] "25=334 - Burnt areas"
# [19] "26=335 - Glaciers and perpetual snow"
# [20] "27=411 - Inland wetlands"
# [21] "28=421 - Maritime wetlands"
# [22] "29=511 - Water courses"
# [23] "3=123 - Port areas"
# [24] "30=512 - Water bodies"
# [25] "31=521 - Coastal lagoons"
# [26] "32=522 - Estuaries"
# [27] "33=523 - Sea and ocean"
# [28] "4=124 - Airports"
# [29] "5=131 - Mineral extraction sites"
# [30] "6=132 - Dump sites"
# [31] "7=133 - Construction sites"
# [32] "8=141 - Green urban areas"
# [33] "9=211 - Non-irrigated arable land"
# [34] "AREA_OR_POINT=Area"

but GDAL doesn't give access to those in a programmatic way. I've tried 
to add a .aux.xml file with the table, this worked locally (for both 
stars - after using droplevels() - and terra) and might as well work 
over the /vsicurl connection. File attached.

Many regards,


On 02/03/2021 18:30, Tomislav Hengl wrote:
> 
> We have mapped land cover classes for the 2000-2019 period for 
> continental Europe at 30-m resolution using spatiotemporal Machine
> Learning (we used R and python for modeling). Explore the dynamic EU 
> landscapes on your palm using the ODS-Europe viewer: 
> https://maps.opendatascience.eu
> 
> To access almost 10TB of data using R you use the terra or similar
> packages e.g.:
> 
> R> library(terra)
> R> in.tif = 
> "/vsicurl/http://s3.eu-central-1.wasabisys.com/eumap/lcv/lcv_landcover.hcl_lucas.corine.rf_p_30m_0..0cm_2019_eumap_epsg3035_v0.1.tif" 
> 
> R> tif = rast(in.tif)
> 
>  From here you can use any native operation e.g. to crop some polygon
> or resample / aggregate values (there is no need to download whole
> data sets). A detailed tutorial on how to work with Cloud Optimized
> GeoTiffs is available here: 
> https://gitlab.com/openlandmap/global-layers/-/blob/master/tutorial/OpenLandMap_COG_tutorial.md. 
> 
> 
> Complete list of Cloud Optimized GeoTiffs we produced so far for Europe
> is available here: 
> https://gitlab.com/geoharmonizer_inea/eumap/-/blob/master/gh_raster_layers.csv 
> 
> 
> If not otherwise specified, the data available on this portal is 
> licensed under the Open Data Commons Open Database License 
> <https://opendatacommons.org/licenses/odbl/> (ODbL) and/or Creative
> Commons Attribution-ShareAlike 4.0 
> <https://creativecommons.org/licenses/by-sa/4.0/legalcode> and/or 
> Creative Commons Attribution 4.0 
> <https://creativecommons.org/licenses/by/4.0/legalcode> International
> license (CC BY).
> 
> Read more in: 
> https://opengeohub.medium.com/europe-from-above-space-time-machine-learning-reveals-our-changing-environment-1b05cb7be520 
> 
> 
> If you experience any technical problems or if you discover a bug,
> please report via: 
> https://gitlab.com/geoharmonizer_inea/spatial-layers/-/issues
> 
> T. Hengl
> https://opengeohub.org/about
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Edzer Pebesma
Institute for Geoinformatics
Heisenbergstrasse 2, 48151 Muenster, Germany
Phone: +49 251 8333081

-------------- next part --------------
A non-text attachment was scrubbed...
Name: out.tif.aux.xml
Type: text/xml
Size: 3809 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20210315/24668202/attachment.xml>

From tom@heng| @end|ng |rom gm@||@com  Tue Mar 16 12:24:58 2021
From: tom@heng| @end|ng |rom gm@||@com (Tomislav Hengl)
Date: Tue, 16 Mar 2021 12:24:58 +0100
Subject: [R-sig-Geo] 
 Spatial layers for Europe at 30-m available as Cloud
 Optimized GeoTiffs (corrected)
In-Reply-To: <71569e60-5155-22aa-e526-4d1de620a9fd@uni-muenster.de>
References: <e76c6c53-d554-c79d-96b9-ac4ba1701542@gmail.com>
 <71569e60-5155-22aa-e526-4d1de620a9fd@uni-muenster.de>
Message-ID: <fccd72bc-7bd0-336d-e73f-60f95fe10098@gmail.com>


Hi Edzer thanks for spotting this.

Cloud Optimized GeoTiffs seems to be somewhat complicated when it comes 
to adding metadata etc in the tif file directly. For example, the COG 
validator reports:

# rio cogeo validate 
/data/raster/lcv/lcv_landcover.hcl_lucas.corine.rf_p_30m_0..0cm_2019_eumap_epsg3035_v0.1.tif
he following errors were found:
- The offset of the main IFD should be < 300. It is 1681443308 instead
- The offset of the IFD for overview of index 0 is 750, whereas it 
should be greater than the one of the main image, which is at byte 
1681443308
/data/raster/lcv/lcv_landcover.hcl_lucas.corine.rf_p_30m_0..0cm_2019_eumap_epsg3035_v0.1.tif 
is NOT a valid cloud optimized GeoTIFF

But it seems that the tif fails the check, but works fine on the end.

We are still only testing if this has any effect on speed of access etc. 
The worst case scenario is that users can not access the data because of 
some small glitch in the tif header.

To produce a legend for land cover maps, we recommend using:

https://gitlab.com/geoharmonizer_inea/spatial-layers/-/blob/master/map-style/lcv_landcover.hcl_lucas.corine.rf_p_30m_0..0cm_2000_eumap_epsg3035_v0.1.qml

You can of course always visually check what you get via:

https://maps.opendatascience.eu

HTH,

T. Hengl
https://opengeohub.org/about

On 3/15/21 4:40 PM, Edzer Pebesma wrote:
> Hi Tom, great work!
> 
> When reading this either with terra or stars, as in
> 
> in.tif = 
> "/vsicurl/http://s3.eu-central-1.wasabisys.com/eumap/lcv/lcv_landcover.hcl_lucas.corine.rf_p_30m_0..0cm_2019_eumap_epsg3035_v0.1.tif" 
> 
> 
> library(terra)
> # terra version 1.1.5
> plot(rast(in.tif))
> 
> #library(raster)
> #plot(raster(in.tif))
> 
> library(stars)
> # Loading required package: abind
> # Loading required package: sf
> # Linking to GEOS 3.9.0, GDAL 3.2.1, PROJ 7.2.1
> plot(read_stars(in.tif))
> 
> I see that both plots show a continuous raster, not a categorical. We 
> spent quite a bit of time recently in stars & tmap development to get 
> handling and plotting of categorical rasters right (including those 
> having a color table), but this file doesn't give proper access to the 
> categories.
> 
> The metadata tags do have them:
> 
> stars::gdal_metadata(in.tif)
> #? [1] "1=111 - Urban fabric"
> #? [2] "10=212 - Permanently irrigated arable land"
> #? [3] "11=213 - Rice fields"
> #? [4] "12=221 - Vineyards"
> #? [5] "13=222 - Fruit trees and berry plantations"
> #? [6] "14=223 - Olive groves"
> #? [7] "15=231 - Pastures"
> #? [8] "16=311 - Broad-leaved forest"
> #? [9] "17=312 - Coniferous forest"
> # [10] "18=321 - Natural grasslands"
> # [11] "19=322 - Moors and heathland"
> # [12] "2=122 - Road and rail networks and associated land"
> # [13] "20=323 - Sclerophyllous vegetation"
> # [14] "21=324 - Transitional woodland-shrub"
> # [15] "22=331 - Beaches, dunes, sands"
> # [16] "23=332 - Bare rocks"
> # [17] "24=333 - Sparsely vegetated areas"
> # [18] "25=334 - Burnt areas"
> # [19] "26=335 - Glaciers and perpetual snow"
> # [20] "27=411 - Inland wetlands"
> # [21] "28=421 - Maritime wetlands"
> # [22] "29=511 - Water courses"
> # [23] "3=123 - Port areas"
> # [24] "30=512 - Water bodies"
> # [25] "31=521 - Coastal lagoons"
> # [26] "32=522 - Estuaries"
> # [27] "33=523 - Sea and ocean"
> # [28] "4=124 - Airports"
> # [29] "5=131 - Mineral extraction sites"
> # [30] "6=132 - Dump sites"
> # [31] "7=133 - Construction sites"
> # [32] "8=141 - Green urban areas"
> # [33] "9=211 - Non-irrigated arable land"
> # [34] "AREA_OR_POINT=Area"
> 
> but GDAL doesn't give access to those in a programmatic way. I've tried 
> to add a .aux.xml file with the table, this worked locally (for both 
> stars - after using droplevels() - and terra) and might as well work 
> over the /vsicurl connection. File attached.
> 
> Many regards,
> 
> 
> On 02/03/2021 18:30, Tomislav Hengl wrote:
>>
>> We have mapped land cover classes for the 2000-2019 period for 
>> continental Europe at 30-m resolution using spatiotemporal Machine
>> Learning (we used R and python for modeling). Explore the dynamic EU 
>> landscapes on your palm using the ODS-Europe viewer: 
>> https://maps.opendatascience.eu
>>
>> To access almost 10TB of data using R you use the terra or similar
>> packages e.g.:
>>
>> R> library(terra)
>> R> in.tif = 
>> "/vsicurl/http://s3.eu-central-1.wasabisys.com/eumap/lcv/lcv_landcover.hcl_lucas.corine.rf_p_30m_0..0cm_2019_eumap_epsg3035_v0.1.tif" 
>>
>> R> tif = rast(in.tif)
>>
>> ?From here you can use any native operation e.g. to crop some polygon
>> or resample / aggregate values (there is no need to download whole
>> data sets). A detailed tutorial on how to work with Cloud Optimized
>> GeoTiffs is available here: 
>> https://gitlab.com/openlandmap/global-layers/-/blob/master/tutorial/OpenLandMap_COG_tutorial.md. 
>>
>>
>> Complete list of Cloud Optimized GeoTiffs we produced so far for Europe
>> is available here: 
>> https://gitlab.com/geoharmonizer_inea/eumap/-/blob/master/gh_raster_layers.csv 
>>
>>
>> If not otherwise specified, the data available on this portal is 
>> licensed under the Open Data Commons Open Database License 
>> <https://opendatacommons.org/licenses/odbl/> (ODbL) and/or Creative
>> Commons Attribution-ShareAlike 4.0 
>> <https://creativecommons.org/licenses/by-sa/4.0/legalcode> and/or 
>> Creative Commons Attribution 4.0 
>> <https://creativecommons.org/licenses/by/4.0/legalcode> International
>> license (CC BY).
>>
>> Read more in: 
>> https://opengeohub.medium.com/europe-from-above-space-time-machine-learning-reveals-our-changing-environment-1b05cb7be520 
>>
>>
>> If you experience any technical problems or if you discover a bug,
>> please report via: 
>> https://gitlab.com/geoharmonizer_inea/spatial-layers/-/issues
>>
>> T. Hengl
>> https://opengeohub.org/about
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From edzer@pebe@m@ @end|ng |rom un|-muen@ter@de  Thu Mar 18 13:11:47 2021
From: edzer@pebe@m@ @end|ng |rom un|-muen@ter@de (Edzer Pebesma)
Date: Thu, 18 Mar 2021 13:11:47 +0100
Subject: [R-sig-Geo] 
 Spatial layers for Europe at 30-m available as Cloud
 Optimized GeoTiffs (corrected)
In-Reply-To: <fccd72bc-7bd0-336d-e73f-60f95fe10098@gmail.com>
References: <e76c6c53-d554-c79d-96b9-ac4ba1701542@gmail.com>
 <71569e60-5155-22aa-e526-4d1de620a9fd@uni-muenster.de>
 <fccd72bc-7bd0-336d-e73f-60f95fe10098@gmail.com>
Message-ID: <090499e7-f837-be90-b847-7dbb1a297324@uni-muenster.de>

Thanks, Tom.

How can one use the .qml file you point to in an R workflow to get 
category labels and colors for the COG data you shared originally?

On 16/03/2021 12:24, Tomislav Hengl wrote:
> 
> Hi Edzer thanks for spotting this.
> 
> Cloud Optimized GeoTiffs seems to be somewhat complicated when it comes 
> to adding metadata etc in the tif file directly. For example, the COG 
> validator reports:
> 
> # rio cogeo validate 
> /data/raster/lcv/lcv_landcover.hcl_lucas.corine.rf_p_30m_0..0cm_2019_eumap_epsg3035_v0.1.tif 
> 
> he following errors were found:
> - The offset of the main IFD should be < 300. It is 1681443308 instead
> - The offset of the IFD for overview of index 0 is 750, whereas it 
> should be greater than the one of the main image, which is at byte 
> 1681443308
> /data/raster/lcv/lcv_landcover.hcl_lucas.corine.rf_p_30m_0..0cm_2019_eumap_epsg3035_v0.1.tif 
> is NOT a valid cloud optimized GeoTIFF
> 
> But it seems that the tif fails the check, but works fine on the end.
> 
> We are still only testing if this has any effect on speed of access etc. 
> The worst case scenario is that users can not access the data because of 
> some small glitch in the tif header.
> 
> To produce a legend for land cover maps, we recommend using:
> 
> https://gitlab.com/geoharmonizer_inea/spatial-layers/-/blob/master/map-style/lcv_landcover.hcl_lucas.corine.rf_p_30m_0..0cm_2000_eumap_epsg3035_v0.1.qml 
> 
> 
> You can of course always visually check what you get via:
> 
> https://maps.opendatascience.eu
> 
> HTH,
> 
> T. Hengl
> https://opengeohub.org/about
> 
> On 3/15/21 4:40 PM, Edzer Pebesma wrote:
>> Hi Tom, great work!
>>
>> When reading this either with terra or stars, as in
>>
>> in.tif = 
>> "/vsicurl/http://s3.eu-central-1.wasabisys.com/eumap/lcv/lcv_landcover.hcl_lucas.corine.rf_p_30m_0..0cm_2019_eumap_epsg3035_v0.1.tif" 
>>
>>
>> library(terra)
>> # terra version 1.1.5
>> plot(rast(in.tif))
>>
>> #library(raster)
>> #plot(raster(in.tif))
>>
>> library(stars)
>> # Loading required package: abind
>> # Loading required package: sf
>> # Linking to GEOS 3.9.0, GDAL 3.2.1, PROJ 7.2.1
>> plot(read_stars(in.tif))
>>
>> I see that both plots show a continuous raster, not a categorical. We 
>> spent quite a bit of time recently in stars & tmap development to get 
>> handling and plotting of categorical rasters right (including those 
>> having a color table), but this file doesn't give proper access to the 
>> categories.
>>
>> The metadata tags do have them:
>>
>> stars::gdal_metadata(in.tif)
>> #? [1] "1=111 - Urban fabric"
>> #? [2] "10=212 - Permanently irrigated arable land"
>> #? [3] "11=213 - Rice fields"
>> #? [4] "12=221 - Vineyards"
>> #? [5] "13=222 - Fruit trees and berry plantations"
>> #? [6] "14=223 - Olive groves"
>> #? [7] "15=231 - Pastures"
>> #? [8] "16=311 - Broad-leaved forest"
>> #? [9] "17=312 - Coniferous forest"
>> # [10] "18=321 - Natural grasslands"
>> # [11] "19=322 - Moors and heathland"
>> # [12] "2=122 - Road and rail networks and associated land"
>> # [13] "20=323 - Sclerophyllous vegetation"
>> # [14] "21=324 - Transitional woodland-shrub"
>> # [15] "22=331 - Beaches, dunes, sands"
>> # [16] "23=332 - Bare rocks"
>> # [17] "24=333 - Sparsely vegetated areas"
>> # [18] "25=334 - Burnt areas"
>> # [19] "26=335 - Glaciers and perpetual snow"
>> # [20] "27=411 - Inland wetlands"
>> # [21] "28=421 - Maritime wetlands"
>> # [22] "29=511 - Water courses"
>> # [23] "3=123 - Port areas"
>> # [24] "30=512 - Water bodies"
>> # [25] "31=521 - Coastal lagoons"
>> # [26] "32=522 - Estuaries"
>> # [27] "33=523 - Sea and ocean"
>> # [28] "4=124 - Airports"
>> # [29] "5=131 - Mineral extraction sites"
>> # [30] "6=132 - Dump sites"
>> # [31] "7=133 - Construction sites"
>> # [32] "8=141 - Green urban areas"
>> # [33] "9=211 - Non-irrigated arable land"
>> # [34] "AREA_OR_POINT=Area"
>>
>> but GDAL doesn't give access to those in a programmatic way. I've 
>> tried to add a .aux.xml file with the table, this worked locally (for 
>> both stars - after using droplevels() - and terra) and might as well 
>> work over the /vsicurl connection. File attached.
>>
>> Many regards,
>>
>>
>> On 02/03/2021 18:30, Tomislav Hengl wrote:
>>>
>>> We have mapped land cover classes for the 2000-2019 period for 
>>> continental Europe at 30-m resolution using spatiotemporal Machine
>>> Learning (we used R and python for modeling). Explore the dynamic EU 
>>> landscapes on your palm using the ODS-Europe viewer: 
>>> https://maps.opendatascience.eu
>>>
>>> To access almost 10TB of data using R you use the terra or similar
>>> packages e.g.:
>>>
>>> R> library(terra)
>>> R> in.tif = 
>>> "/vsicurl/http://s3.eu-central-1.wasabisys.com/eumap/lcv/lcv_landcover.hcl_lucas.corine.rf_p_30m_0..0cm_2019_eumap_epsg3035_v0.1.tif" 
>>>
>>> R> tif = rast(in.tif)
>>>
>>> ?From here you can use any native operation e.g. to crop some polygon
>>> or resample / aggregate values (there is no need to download whole
>>> data sets). A detailed tutorial on how to work with Cloud Optimized
>>> GeoTiffs is available here: 
>>> https://gitlab.com/openlandmap/global-layers/-/blob/master/tutorial/OpenLandMap_COG_tutorial.md. 
>>>
>>>
>>> Complete list of Cloud Optimized GeoTiffs we produced so far for Europe
>>> is available here: 
>>> https://gitlab.com/geoharmonizer_inea/eumap/-/blob/master/gh_raster_layers.csv 
>>>
>>>
>>> If not otherwise specified, the data available on this portal is 
>>> licensed under the Open Data Commons Open Database License 
>>> <https://opendatacommons.org/licenses/odbl/> (ODbL) and/or Creative
>>> Commons Attribution-ShareAlike 4.0 
>>> <https://creativecommons.org/licenses/by-sa/4.0/legalcode> and/or 
>>> Creative Commons Attribution 4.0 
>>> <https://creativecommons.org/licenses/by/4.0/legalcode> International
>>> license (CC BY).
>>>
>>> Read more in: 
>>> https://opengeohub.medium.com/europe-from-above-space-time-machine-learning-reveals-our-changing-environment-1b05cb7be520 
>>>
>>>
>>> If you experience any technical problems or if you discover a bug,
>>> please report via: 
>>> https://gitlab.com/geoharmonizer_inea/spatial-layers/-/issues
>>>
>>> T. Hengl
>>> https://opengeohub.org/about
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Edzer Pebesma
Institute for Geoinformatics
Heisenbergstrasse 2, 48151 Muenster, Germany
Phone: +49 251 8333081


From @trende @end|ng |rom re@|c|e@rpo||t|c@@com  Thu Mar 18 14:02:49 2021
From: @trende @end|ng |rom re@|c|e@rpo||t|c@@com (Sean Trende)
Date: Thu, 18 Mar 2021 13:02:49 +0000
Subject: [R-sig-Geo] Question for cleaning shapefiles for dissertation
Message-ID: <CH2PR20MB3045867E0745F7E74C6A2E60BE699@CH2PR20MB3045.namprd20.prod.outlook.com>

Hello,

First, thank you for allowing me to join this group. To be able to (quietly) observe discussions from so many great minds in an area so important for my day-to-day job is something I am greatly looking forward to.

I do have a question that I hope someone can help with.  For my dissertation, I am building an areal model off of Ohio precincts. The shapefile (https://github.com/mggg/ohio-precincts) is notoriously filled with slivers, which complicates the adjacency matrix.

I've come up with a wonky solution (code at bottom) where, after loading the shapefile and filtering by county I manually increase the size of the snap by .01 and look to see whether the number of nonzero links increases.  If it does, I can then plot the new and old adjacency matrices, and eyeball the new link(s) to determine whether it is "real" or if the snap has grown so large I am linking precincts that are not actually adjacent.  I am hoping I can find a snap level that links most of the truly adjacent precincts, without linking too many precincts that are not actually adjacent.  I've gotten through ten counties, and it looking like the best snap is ~30.

This is obviously time-consuming, and in cities it can be tough to see whether precincts are actually adjacent given their small size.  My questions are:

1) Is there a way to extract the number nonzero links from an 'nb' class of files and assign it to a variable? This would allow me to automate the inquiry and examine only those snaps that increased the number of links, saving time.
2) Am I missing a much more straightforward solution to cleaning the shapefile entirely?

Thank you for your time,

Sean

df <- readOGR("OH_precincts.shp")
vect <- as.character(unique(df$COUNTY))
j <- 1 #####Increase this as you want to do successive counties

selected_county <- vect[j]
df_county <- subset(df, COUNTY == selected_county)

ia <- 0
ib <- 0.01 #####First compare no snap with a snap of 0.01

nb_a <- poly2nb(df_county, snap = ia)
nb_b <- poly2nb(df_county, snap = ib)
coords <- coordinates(df_county)

nb_a
nb_b #####This allows you to look and see if there are more links with the larger snap than with the smaller snap

plot(df_county)
plot(nb_b, coords, col = "blue", add = T, lwd = 2)
plot(nb_a, coords, col = "grey", add = T, lwd = 2) #####Because of the overlay, the new connection will be blue

ia <- ia + .01
ib <- ib + .01 ##### increases the size of the snap by 0.01, and increases the comparison by a similar amount
#####so if this is the first time you run it, your next comparison will be snaps of 0.01 and 0.02
#####To keep it from resetting I just highlight up to the assignment of nb_a, and then hit cntrl_enter until the number of links increases


From R@|ner @end|ng |rom krug@@de  Thu Mar 18 14:41:19 2021
From: R@|ner @end|ng |rom krug@@de (Rainer Krug)
Date: Thu, 18 Mar 2021 14:41:19 +0100
Subject: [R-sig-Geo] Question for cleaning shapefiles for dissertation
In-Reply-To: <CH2PR20MB3045867E0745F7E74C6A2E60BE699@CH2PR20MB3045.namprd20.prod.outlook.com>
References: <CH2PR20MB3045867E0745F7E74C6A2E60BE699@CH2PR20MB3045.namprd20.prod.outlook.com>
Message-ID: <203FF0FE-9EE7-4005-8B57-4547A219352A@krugs.de>

Hi Sean,

Shape files are notoriously bad, and you just found one reason why.

I would suggest to look int e.g. GRASS (https://grass.osgeo.org <https://grass.osgeo.org/>) or QGIS (https://www.qgis.org/en/site/) for doing the cleaning and joining. Afterwards, you can go back to R to do further analysis. 

Cheers,

Rainer



> On 18 Mar 2021, at 14:02, Sean Trende <strende at realclearpolitics.com> wrote:
> 
> Hello,
> 
> First, thank you for allowing me to join this group. To be able to (quietly) observe discussions from so many great minds in an area so important for my day-to-day job is something I am greatly looking forward to.
> 
> I do have a question that I hope someone can help with.  For my dissertation, I am building an areal model off of Ohio precincts. The shapefile (https://github.com/mggg/ohio-precincts) is notoriously filled with slivers, which complicates the adjacency matrix.
> 
> I've come up with a wonky solution (code at bottom) where, after loading the shapefile and filtering by county I manually increase the size of the snap by .01 and look to see whether the number of nonzero links increases.  If it does, I can then plot the new and old adjacency matrices, and eyeball the new link(s) to determine whether it is "real" or if the snap has grown so large I am linking precincts that are not actually adjacent.  I am hoping I can find a snap level that links most of the truly adjacent precincts, without linking too many precincts that are not actually adjacent.  I've gotten through ten counties, and it looking like the best snap is ~30.
> 
> This is obviously time-consuming, and in cities it can be tough to see whether precincts are actually adjacent given their small size.  My questions are:
> 
> 1) Is there a way to extract the number nonzero links from an 'nb' class of files and assign it to a variable? This would allow me to automate the inquiry and examine only those snaps that increased the number of links, saving time.
> 2) Am I missing a much more straightforward solution to cleaning the shapefile entirely?
> 
> Thank you for your time,
> 
> Sean
> 
> df <- readOGR("OH_precincts.shp")
> vect <- as.character(unique(df$COUNTY))
> j <- 1 #####Increase this as you want to do successive counties
> 
> selected_county <- vect[j]
> df_county <- subset(df, COUNTY == selected_county)
> 
> ia <- 0
> ib <- 0.01 #####First compare no snap with a snap of 0.01
> 
> nb_a <- poly2nb(df_county, snap = ia)
> nb_b <- poly2nb(df_county, snap = ib)
> coords <- coordinates(df_county)
> 
> nb_a
> nb_b #####This allows you to look and see if there are more links with the larger snap than with the smaller snap
> 
> plot(df_county)
> plot(nb_b, coords, col = "blue", add = T, lwd = 2)
> plot(nb_a, coords, col = "grey", add = T, lwd = 2) #####Because of the overlay, the new connection will be blue
> 
> ia <- ia + .01
> ib <- ib + .01 ##### increases the size of the snap by 0.01, and increases the comparison by a similar amount
> #####so if this is the first time you run it, your next comparison will be snaps of 0.01 and 0.02
> #####To keep it from resetting I just highlight up to the assignment of nb_a, and then hit cntrl_enter until the number of links increases
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20210318/b8c2b50e/attachment.html>

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 4372 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20210318/b8c2b50e/attachment.p7s>

From tom@heng| @end|ng |rom gm@||@com  Thu Mar 18 18:11:23 2021
From: tom@heng| @end|ng |rom gm@||@com (Tomislav Hengl)
Date: Thu, 18 Mar 2021 18:11:23 +0100
Subject: [R-sig-Geo] 
 Spatial layers for Europe at 30-m available as Cloud
 Optimized GeoTiffs (corrected)
In-Reply-To: <090499e7-f837-be90-b847-7dbb1a297324@uni-muenster.de>
References: <e76c6c53-d554-c79d-96b9-ac4ba1701542@gmail.com>
 <71569e60-5155-22aa-e526-4d1de620a9fd@uni-muenster.de>
 <fccd72bc-7bd0-336d-e73f-60f95fe10098@gmail.com>
 <090499e7-f837-be90-b847-7dbb1a297324@uni-muenster.de>
Message-ID: <662292af-b0c5-2be6-8ab8-dbbdda4a4211@gmail.com>


I'm not an expert for the XML but something like this:

library(xml2)
leg = 
read_xml("lcv_landcover.hcl_lucas.corine.rf_p_30m_0..0cm_2000_eumap_epsg3035_v0.1.qml", 
)
leg.col = 
as_list(xml_children(xml_children(xml_children(leg)[[3]])[[1]])[[3]])
leg.df = do.call(rbind, lapply(leg.col, 
function(i){as.data.frame(attributes(i))}))
str(leg.df)

See csv file in att.

On 3/18/21 1:11 PM, Edzer Pebesma wrote:
> Thanks, Tom.
> 
> How can one use the .qml file you point to in an R workflow to get 
> category labels and colors for the COG data you shared originally?
> 
> On 16/03/2021 12:24, Tomislav Hengl wrote:
>>
>> Hi Edzer thanks for spotting this.
>>
>> Cloud Optimized GeoTiffs seems to be somewhat complicated when it 
>> comes to adding metadata etc in the tif file directly. For example, 
>> the COG validator reports:
>>
>> # rio cogeo validate 
>> /data/raster/lcv/lcv_landcover.hcl_lucas.corine.rf_p_30m_0..0cm_2019_eumap_epsg3035_v0.1.tif 
>>
>> he following errors were found:
>> - The offset of the main IFD should be < 300. It is 1681443308 instead
>> - The offset of the IFD for overview of index 0 is 750, whereas it 
>> should be greater than the one of the main image, which is at byte 
>> 1681443308
>> /data/raster/lcv/lcv_landcover.hcl_lucas.corine.rf_p_30m_0..0cm_2019_eumap_epsg3035_v0.1.tif 
>> is NOT a valid cloud optimized GeoTIFF
>>
>> But it seems that the tif fails the check, but works fine on the end.
>>
>> We are still only testing if this has any effect on speed of access 
>> etc. The worst case scenario is that users can not access the data 
>> because of some small glitch in the tif header.
>>
>> To produce a legend for land cover maps, we recommend using:
>>
>> https://gitlab.com/geoharmonizer_inea/spatial-layers/-/blob/master/map-style/lcv_landcover.hcl_lucas.corine.rf_p_30m_0..0cm_2000_eumap_epsg3035_v0.1.qml 
>>
>>
>> You can of course always visually check what you get via:
>>
>> https://maps.opendatascience.eu
>>
>> HTH,
>>
>> T. Hengl
>> https://opengeohub.org/about
>>
>> On 3/15/21 4:40 PM, Edzer Pebesma wrote:
>>> Hi Tom, great work!
>>>
>>> When reading this either with terra or stars, as in
>>>
>>> in.tif = 
>>> "/vsicurl/http://s3.eu-central-1.wasabisys.com/eumap/lcv/lcv_landcover.hcl_lucas.corine.rf_p_30m_0..0cm_2019_eumap_epsg3035_v0.1.tif" 
>>>
>>>
>>> library(terra)
>>> # terra version 1.1.5
>>> plot(rast(in.tif))
>>>
>>> #library(raster)
>>> #plot(raster(in.tif))
>>>
>>> library(stars)
>>> # Loading required package: abind
>>> # Loading required package: sf
>>> # Linking to GEOS 3.9.0, GDAL 3.2.1, PROJ 7.2.1
>>> plot(read_stars(in.tif))
>>>
>>> I see that both plots show a continuous raster, not a categorical. We 
>>> spent quite a bit of time recently in stars & tmap development to get 
>>> handling and plotting of categorical rasters right (including those 
>>> having a color table), but this file doesn't give proper access to 
>>> the categories.
>>>
>>> The metadata tags do have them:
>>>
>>> stars::gdal_metadata(in.tif)
>>> #? [1] "1=111 - Urban fabric"
>>> #? [2] "10=212 - Permanently irrigated arable land"
>>> #? [3] "11=213 - Rice fields"
>>> #? [4] "12=221 - Vineyards"
>>> #? [5] "13=222 - Fruit trees and berry plantations"
>>> #? [6] "14=223 - Olive groves"
>>> #? [7] "15=231 - Pastures"
>>> #? [8] "16=311 - Broad-leaved forest"
>>> #? [9] "17=312 - Coniferous forest"
>>> # [10] "18=321 - Natural grasslands"
>>> # [11] "19=322 - Moors and heathland"
>>> # [12] "2=122 - Road and rail networks and associated land"
>>> # [13] "20=323 - Sclerophyllous vegetation"
>>> # [14] "21=324 - Transitional woodland-shrub"
>>> # [15] "22=331 - Beaches, dunes, sands"
>>> # [16] "23=332 - Bare rocks"
>>> # [17] "24=333 - Sparsely vegetated areas"
>>> # [18] "25=334 - Burnt areas"
>>> # [19] "26=335 - Glaciers and perpetual snow"
>>> # [20] "27=411 - Inland wetlands"
>>> # [21] "28=421 - Maritime wetlands"
>>> # [22] "29=511 - Water courses"
>>> # [23] "3=123 - Port areas"
>>> # [24] "30=512 - Water bodies"
>>> # [25] "31=521 - Coastal lagoons"
>>> # [26] "32=522 - Estuaries"
>>> # [27] "33=523 - Sea and ocean"
>>> # [28] "4=124 - Airports"
>>> # [29] "5=131 - Mineral extraction sites"
>>> # [30] "6=132 - Dump sites"
>>> # [31] "7=133 - Construction sites"
>>> # [32] "8=141 - Green urban areas"
>>> # [33] "9=211 - Non-irrigated arable land"
>>> # [34] "AREA_OR_POINT=Area"
>>>
>>> but GDAL doesn't give access to those in a programmatic way. I've 
>>> tried to add a .aux.xml file with the table, this worked locally (for 
>>> both stars - after using droplevels() - and terra) and might as well 
>>> work over the /vsicurl connection. File attached.
>>>
>>> Many regards,
>>>
>>>
>>> On 02/03/2021 18:30, Tomislav Hengl wrote:
>>>>
>>>> We have mapped land cover classes for the 2000-2019 period for 
>>>> continental Europe at 30-m resolution using spatiotemporal Machine
>>>> Learning (we used R and python for modeling). Explore the dynamic EU 
>>>> landscapes on your palm using the ODS-Europe viewer: 
>>>> https://maps.opendatascience.eu
>>>>
>>>> To access almost 10TB of data using R you use the terra or similar
>>>> packages e.g.:
>>>>
>>>> R> library(terra)
>>>> R> in.tif = 
>>>> "/vsicurl/http://s3.eu-central-1.wasabisys.com/eumap/lcv/lcv_landcover.hcl_lucas.corine.rf_p_30m_0..0cm_2019_eumap_epsg3035_v0.1.tif" 
>>>>
>>>> R> tif = rast(in.tif)
>>>>
>>>> ?From here you can use any native operation e.g. to crop some polygon
>>>> or resample / aggregate values (there is no need to download whole
>>>> data sets). A detailed tutorial on how to work with Cloud Optimized
>>>> GeoTiffs is available here: 
>>>> https://gitlab.com/openlandmap/global-layers/-/blob/master/tutorial/OpenLandMap_COG_tutorial.md. 
>>>>
>>>>
>>>> Complete list of Cloud Optimized GeoTiffs we produced so far for Europe
>>>> is available here: 
>>>> https://gitlab.com/geoharmonizer_inea/eumap/-/blob/master/gh_raster_layers.csv 
>>>>
>>>>
>>>> If not otherwise specified, the data available on this portal is 
>>>> licensed under the Open Data Commons Open Database License 
>>>> <https://opendatacommons.org/licenses/odbl/> (ODbL) and/or Creative
>>>> Commons Attribution-ShareAlike 4.0 
>>>> <https://creativecommons.org/licenses/by-sa/4.0/legalcode> and/or 
>>>> Creative Commons Attribution 4.0 
>>>> <https://creativecommons.org/licenses/by/4.0/legalcode> International
>>>> license (CC BY).
>>>>
>>>> Read more in: 
>>>> https://opengeohub.medium.com/europe-from-above-space-time-machine-learning-reveals-our-changing-environment-1b05cb7be520 
>>>>
>>>>
>>>> If you experience any technical problems or if you discover a bug,
>>>> please report via: 
>>>> https://gitlab.com/geoharmonizer_inea/spatial-layers/-/issues
>>>>
>>>> T. Hengl
>>>> https://opengeohub.org/about
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at r-project.org
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-------------- next part --------------
A non-text attachment was scrubbed...
Name: lcv_landcover.hcl_lucas.corine.rf_p_30m_0..0cm_2000_eumap_epsg3035_v0.1.csv
Type: text/csv
Size: 2084 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20210318/ba486b07/attachment.csv>

From tob|@@@rutten@uer @end|ng |rom nu|||e|d@ox@@c@uk  Wed Mar 24 12:11:58 2021
From: tob|@@@rutten@uer @end|ng |rom nu|||e|d@ox@@c@uk (Tobias Ruttenauer)
Date: Wed, 24 Mar 2021 11:11:58 +0000
Subject: [R-sig-Geo] Impute missing values along a spatial network
Message-ID: <CWLP265MB00492183AEFB98C3C2DE76CAE3639@CWLP265MB0049.GBRP265.PROD.OUTLOOK.COM>

Dear list members,

I am trying to construct a road network with traffic estimates for each road segment. I have count data of the traffic for a subset of the segments and I have the road network as spatial lines data. For those segments without count data, I would like to perform something like linear imputation or some sort of interpolation / kriging along the road network instead of using pure geographical distance. For instance, if I have 7 road segments A-B-C-D-E and F-G (F and G are unconnected to the rest), and I have data for A and D, how can I impute data for B, C (and E) by only using A and D, while ignoring F and G even though they might be geographically close?

This seems fairly intuitive to me but I couldn't find a package doing that. stplanr would do something related but it seems it needs origin-destination data (which I don't have). I'd be grateful if someone could nudge me into the right direction. I guess I'm using the wrong terminology.

Thanks a lot and best wishes
Tobias

Tobias R?ttenauer
Nuffield College
University of Oxford
Oxford, OX1 1NF


From P|etro_te|@to @end|ng |rom hotm@||@com  Wed Mar 24 14:45:21 2021
From: P|etro_te|@to @end|ng |rom hotm@||@com (Pietro Andre Telatin Paschoalino)
Date: Wed, 24 Mar 2021 13:45:21 +0000
Subject: [R-sig-Geo] Simple doubt - CRS
Message-ID: <BN8PR17MB2980C6727DA01A3229A0C9E282639@BN8PR17MB2980.namprd17.prod.outlook.com>

Hello everyone,

I'm extracting a precipitation data of a raster to shapefile and have a simple doubt.

To extract I'm transforming my shape to the crs of the rasterstack to get the same crs.

What I'm concerned about is that before and after the changing in the crs when I ask for the function proj4string I have a warning:

"In proj4string(shape) : CRS object has comment, which is lost in output"

I read that it's because of the development of the rgdal and that in most cases there is no problem. But I would like confirmation that this is not affecting my results of extraction. I believe that if the warning came after the extraction, I should be more concerned. Could anyone help?

The code Is like that:

shape <- readOGR(dsn = ".", layer = "myshape")

proj4string(shape)

fn<-file.path("mypath\\cru_ts4.04.2011.2019.pre.dat.nc")

rasbrick <- stack(fn)

shape2<- spTransform(shape, crs(rasbrick))

proj4string(shape2)

for (i in 1:length(rasbrick at layers)) {
  weath_dt[,2+i] = raster::extract(rasbrick[[i]], shape2, mean, na.rm=T)
}

Thanks.

Pietro Andre Telatin Paschoalino
Doutorando em Ci?ncias Econ?micas da Universidade Estadual de Maring? - PCE.

	[[alternative HTML version deleted]]


From Roger@B|v@nd @end|ng |rom nhh@no  Wed Mar 24 15:11:02 2021
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Wed, 24 Mar 2021 15:11:02 +0100
Subject: [R-sig-Geo] Simple doubt - CRS
In-Reply-To: <BN8PR17MB2980C6727DA01A3229A0C9E282639@BN8PR17MB2980.namprd17.prod.outlook.com>
References: <BN8PR17MB2980C6727DA01A3229A0C9E282639@BN8PR17MB2980.namprd17.prod.outlook.com>
Message-ID: <7c6b83b-a798-f3c8-efea-a22c8829801d@reclus.nhh.no>

On Wed, 24 Mar 2021, Pietro Andre Telatin Paschoalino wrote:

> Hello everyone,
>
> I'm extracting a precipitation data of a raster to shapefile and have a 
> simple doubt.
>
> To extract I'm transforming my shape to the crs of the rasterstack to 
> get the same crs.
>
> What I'm concerned about is that before and after the changing in the 
> crs when I ask for the function proj4string I have a warning:
>
> "In proj4string(shape) : CRS object has comment, which is lost in output"
>
> I read that it's because of the development of the rgdal and that in 
> most cases there is no problem. But I would like confirmation that this 
> is not affecting my results of extraction. I believe that if the warning 
> came after the extraction, I should be more concerned. Could anyone 
> help?

Not rgdal itself, but the underlying PROJ library, which has changed 
dramatically. The warnings should lead users to check at least three times 
before assuming that things are OK.

>
> The code Is like that:
>
> shape <- readOGR(dsn = ".", layer = "myshape")
>
> proj4string(shape)
>
> fn<-file.path("mypath\\cru_ts4.04.2011.2019.pre.dat.nc")
>
> rasbrick <- stack(fn)
>

I see for this publically available file, with current CRAN sp, rgdal and 
raster:

> str(crs(rasbrick))
Formal class 'CRS' [package "sp"] with 1 slot
   ..@ projargs: chr "+proj=longlat +datum=WGS84 +no_defs"

but crucially:

> cat(wkt(crs(rasbrick)), "\n")
GEOGCRS["unknown",
     DATUM["World Geodetic System 1984",
         ELLIPSOID["WGS 84",6378137,298.257223563,
             LENGTHUNIT["metre",1]],
         ID["EPSG",6326]],
     PRIMEM["Greenwich",0,
         ANGLEUNIT["degree",0.0174532925199433],
         ID["EPSG",8901]],
     CS[ellipsoidal,2],
         AXIS["longitude",east,
             ORDER[1],
             ANGLEUNIT["degree",0.0174532925199433,
                 ID["EPSG",9122]]],
         AXIS["latitude",north,
             ORDER[2],
             ANGLEUNIT["degree",0.0174532925199433,
                 ID["EPSG",9122]]]]

The WKT2-2019 representation also present in the CRS object suggests that 
the CRU_TS grid is read correctly.

> shape2<- spTransform(shape, crs(rasbrick))
>

The success of this operation will depend on:

cat(wkt(shape), "\n")

being well-defined, the on there being an optimal path from the CRS of 
shape to that of rasbrick (up to PROJ 6, there was no choice in the 
operation, as the source and target CRS defined their relationship to 
WGS84). After spTransform(), you can use get_last_coordOp() to show the 
coordinate operation pipeline. In sp/rgdal, every effort has been made to 
prevent axis-swapping.

> proj4string(shape2)

Rather check with cat(wkt(shape2), "\n"), as proj4string() may issue a 
warning, as you are asking to look at the deprecated Proj4 representation.

>
> for (i in 1:length(rasbrick at layers)) {
>  weath_dt[,2+i] = raster::extract(rasbrick[[i]], shape2, mean, na.rm=T)
> }

Because raster uses sp/rgdal, it may also issue warnings. The warnings are 
there to provoke questions like yours. Warnings may be muted for sp and 
rgdal by options("rgdal_show_exportToProj4_warnings"="none") before 
loading rgdal.

Hope this clarifies,

Roger

>
> Thanks.
>
> Pietro Andre Telatin Paschoalino
> Doutorando em Ci?ncias Econ?micas da Universidade Estadual de Maring? - PCE.
>
> 	[[alternative HTML version deleted]]
>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Postboks 3490 Ytre Sandviken, 5045 Bergen, Norway.
e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

From Roger@B|v@nd @end|ng |rom nhh@no  Wed Mar 24 15:18:16 2021
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Wed, 24 Mar 2021 15:18:16 +0100
Subject: [R-sig-Geo] Impute missing values along a spatial network
In-Reply-To: <CWLP265MB00492183AEFB98C3C2DE76CAE3639@CWLP265MB0049.GBRP265.PROD.OUTLOOK.COM>
References: <CWLP265MB00492183AEFB98C3C2DE76CAE3639@CWLP265MB0049.GBRP265.PROD.OUTLOOK.COM>
Message-ID: <3ddad650-d23-5fdd-b25-9546cc2d3994@reclus.nhh.no>

On Wed, 24 Mar 2021, Tobias Ruttenauer wrote:

> Dear list members,
>
> I am trying to construct a road network with traffic estimates for each 
> road segment. I have count data of the traffic for a subset of the 
> segments and I have the road network as spatial lines data. For those 
> segments without count data, I would like to perform something like 
> linear imputation or some sort of interpolation / kriging along the road 
> network instead of using pure geographical distance. For instance, if I 
> have 7 road segments A-B-C-D-E and F-G (F and G are unconnected to the 
> rest), and I have data for A and D, how can I impute data for B, C (and 
> E) by only using A and D, while ignoring F and G even though they might 
> be geographically close?

Are there any relevant covariates associated with the road segments? I 
think that this is more of a Markov than a Gaussian random field, so a 
Poisson spatial regression with a neighbour matrix representing contiguous 
segments might be possible. Covariates, or an offset by an expected volume 
might help. INLA with a Besag model - INLA fits missing responses, or 
mgcv::gam() with an "mrf" smooth or hglm() then predict?

Any other suggestions?

Roger

>
> This seems fairly intuitive to me but I couldn't find a package doing 
> that. stplanr would do something related but it seems it needs 
> origin-destination data (which I don't have). I'd be grateful if someone 
> could nudge me into the right direction. I guess I'm using the wrong 
> terminology.
>
> Thanks a lot and best wishes
> Tobias
>
> Tobias R?ttenauer
> Nuffield College
> University of Oxford
> Oxford, OX1 1NF
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Postboks 3490 Ytre Sandviken, 5045 Bergen, Norway.
e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

From p|etro_te|@to @end|ng |rom hotm@||@com  Wed Mar 24 15:38:50 2021
From: p|etro_te|@to @end|ng |rom hotm@||@com (Pietro Andre Telatin Paschoalino)
Date: Wed, 24 Mar 2021 14:38:50 +0000
Subject: [R-sig-Geo] Simple doubt - CRS
In-Reply-To: <7c6b83b-a798-f3c8-efea-a22c8829801d@reclus.nhh.no>
References: <BN8PR17MB2980C6727DA01A3229A0C9E282639@BN8PR17MB2980.namprd17.prod.outlook.com>,
 <7c6b83b-a798-f3c8-efea-a22c8829801d@reclus.nhh.no>
Message-ID: <BN8PR17MB2980CCBC5A3485BA03BCACB082639@BN8PR17MB2980.namprd17.prod.outlook.com>

Hello Roger, thank you for your explanation.

So if my str(crs(rasbrick)) are equal than cat(wkt(shape2), "\n") (here you put shape but I think that is shape2 with the new CRS) so I'm okay, right?
There is some function to check automatically if the two are equal?

I'm only don't understand very well what I need to know about the: "get_last_coordOp()" I did that and in return I had:

"+proj=noop +ellps=GRS80"

Thank you.

Pietro Andre Telatin Paschoalino
Doutorando em Ci?ncias Econ?micas da Universidade Estadual de Maring? - PCE.

________________________________
De: Roger Bivand <Roger.Bivand at nhh.no>
Enviado: quarta-feira, 24 de mar?o de 2021 11:11
Para: Pietro Andre Telatin Paschoalino <Pietro_telato at hotmail.com>
Cc: r-sig-geo at r-project.org <r-sig-geo at r-project.org>
Assunto: Re: [R-sig-Geo] Simple doubt - CRS

On Wed, 24 Mar 2021, Pietro Andre Telatin Paschoalino wrote:

> Hello everyone,
>
> I'm extracting a precipitation data of a raster to shapefile and have a
> simple doubt.
>
> To extract I'm transforming my shape to the crs of the rasterstack to
> get the same crs.
>
> What I'm concerned about is that before and after the changing in the
> crs when I ask for the function proj4string I have a warning:
>
> "In proj4string(shape) : CRS object has comment, which is lost in output"
>
> I read that it's because of the development of the rgdal and that in
> most cases there is no problem. But I would like confirmation that this
> is not affecting my results of extraction. I believe that if the warning
> came after the extraction, I should be more concerned. Could anyone
> help?

Not rgdal itself, but the underlying PROJ library, which has changed
dramatically. The warnings should lead users to check at least three times
before assuming that things are OK.

>
> The code Is like that:
>
> shape <- readOGR(dsn = ".", layer = "myshape")
>
> proj4string(shape)
>
> fn<-file.path("mypath\\cru_ts4.04.2011.2019.pre.dat.nc")
>
> rasbrick <- stack(fn)
>

I see for this publically available file, with current CRAN sp, rgdal and
raster:

> str(crs(rasbrick))
Formal class 'CRS' [package "sp"] with 1 slot
   ..@ projargs: chr "+proj=longlat +datum=WGS84 +no_defs"

but crucially:

> cat(wkt(crs(rasbrick)), "\n")
GEOGCRS["unknown",
     DATUM["World Geodetic System 1984",
         ELLIPSOID["WGS 84",6378137,298.257223563,
             LENGTHUNIT["metre",1]],
         ID["EPSG",6326]],
     PRIMEM["Greenwich",0,
         ANGLEUNIT["degree",0.0174532925199433],
         ID["EPSG",8901]],
     CS[ellipsoidal,2],
         AXIS["longitude",east,
             ORDER[1],
             ANGLEUNIT["degree",0.0174532925199433,
                 ID["EPSG",9122]]],
         AXIS["latitude",north,
             ORDER[2],
             ANGLEUNIT["degree",0.0174532925199433,
                 ID["EPSG",9122]]]]

The WKT2-2019 representation also present in the CRS object suggests that
the CRU_TS grid is read correctly.

> shape2<- spTransform(shape, crs(rasbrick))
>

The success of this operation will depend on:

cat(wkt(shape), "\n")

being well-defined, the on there being an optimal path from the CRS of
shape to that of rasbrick (up to PROJ 6, there was no choice in the
operation, as the source and target CRS defined their relationship to
WGS84). After spTransform(), you can use get_last_coordOp() to show the
coordinate operation pipeline. In sp/rgdal, every effort has been made to
prevent axis-swapping.

> proj4string(shape2)

Rather check with cat(wkt(shape2), "\n"), as proj4string() may issue a
warning, as you are asking to look at the deprecated Proj4 representation.

>
> for (i in 1:length(rasbrick at layers)) {
>  weath_dt[,2+i] = raster::extract(rasbrick[[i]], shape2, mean, na.rm=T)
> }

Because raster uses sp/rgdal, it may also issue warnings. The warnings are
there to provoke questions like yours. Warnings may be muted for sp and
rgdal by options("rgdal_show_exportToProj4_warnings"="none") before
loading rgdal.

Hope this clarifies,

Roger

>
> Thanks.
>
> Pietro Andre Telatin Paschoalino
> Doutorando em Ci?ncias Econ?micas da Universidade Estadual de Maring? - PCE.
>
>        [[alternative HTML version deleted]]
>
>

--
Roger Bivand
Department of Economics, Norwegian School of Economics,
Postboks 3490 Ytre Sandviken, 5045 Bergen, Norway.
e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

	[[alternative HTML version deleted]]


From Roger@B|v@nd @end|ng |rom nhh@no  Wed Mar 24 15:59:58 2021
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Wed, 24 Mar 2021 15:59:58 +0100
Subject: [R-sig-Geo] Simple doubt - CRS
In-Reply-To: <BN8PR17MB2980CCBC5A3485BA03BCACB082639@BN8PR17MB2980.namprd17.prod.outlook.com>
References: <BN8PR17MB2980C6727DA01A3229A0C9E282639@BN8PR17MB2980.namprd17.prod.outlook.com>,
 <7c6b83b-a798-f3c8-efea-a22c8829801d@reclus.nhh.no>
 <BN8PR17MB2980CCBC5A3485BA03BCACB082639@BN8PR17MB2980.namprd17.prod.outlook.com>
Message-ID: <90342658-68f6-f02c-4e35-867c5869168@reclus.nhh.no>

On Wed, 24 Mar 2021, Pietro Andre Telatin Paschoalino wrote:

> Hello Roger, thank you for your explanation.
>
> So if my str(crs(rasbrick)) are equal than cat(wkt(shape2), "\n") (here 
> you put shape but I think that is shape2 with the new CRS) so I'm okay, 
> right? There is some function to check automatically if the two are 
> equal?

No, str(crs(rasbrick)) only shows the revealed contents of the CRS object. 
The WKT2-2019 representation has to be hidden in comment(crs(rasbrick)), 
which is *not* shown by str(). It had to be hidden in this way because CRS 
is a formal class, so its definition is fixed. If the formal definition of 
the CRS class was changed, many packages and workflows would break, so the 
WKT2-2019 representation was added, but can most easily be seen using the 
wkt() method.

>
> I'm only don't understand very well what I need to know about the: 
> "get_last_coordOp()" I did that and in return I had:
>
> "+proj=noop +ellps=GRS80"
>

This means that shape and rasbrick had the same CRS, so the coordinate 
operation was a noop, no operation. If they had differed, it would show 
the steps taken. rgdal::list_coordOps() can show what spTransform can 
choose, equivalently in sf 0.9-8 it is called sf::sf_proj_pipelines(). 
https://github.com/r-spatial/sf/issues/1634 is an example of its use. In a 
different case in Canada, not using the PROJ CDN for on-demand 
transformation grid downloading led to 20m errors, so keepin one's eye on 
the instantiable pipelines is potentially important.

Roger

> Thank you.
>
> Pietro Andre Telatin Paschoalino
> Doutorando em Ci?ncias Econ?micas da Universidade Estadual de Maring? - PCE.
>
> ________________________________
> De: Roger Bivand <Roger.Bivand at nhh.no>
> Enviado: quarta-feira, 24 de mar?o de 2021 11:11
> Para: Pietro Andre Telatin Paschoalino <Pietro_telato at hotmail.com>
> Cc: r-sig-geo at r-project.org <r-sig-geo at r-project.org>
> Assunto: Re: [R-sig-Geo] Simple doubt - CRS
>
> On Wed, 24 Mar 2021, Pietro Andre Telatin Paschoalino wrote:
>
>> Hello everyone,
>>
>> I'm extracting a precipitation data of a raster to shapefile and have a
>> simple doubt.
>>
>> To extract I'm transforming my shape to the crs of the rasterstack to
>> get the same crs.
>>
>> What I'm concerned about is that before and after the changing in the
>> crs when I ask for the function proj4string I have a warning:
>>
>> "In proj4string(shape) : CRS object has comment, which is lost in output"
>>
>> I read that it's because of the development of the rgdal and that in
>> most cases there is no problem. But I would like confirmation that this
>> is not affecting my results of extraction. I believe that if the warning
>> came after the extraction, I should be more concerned. Could anyone
>> help?
>
> Not rgdal itself, but the underlying PROJ library, which has changed
> dramatically. The warnings should lead users to check at least three times
> before assuming that things are OK.
>
>>
>> The code Is like that:
>>
>> shape <- readOGR(dsn = ".", layer = "myshape")
>>
>> proj4string(shape)
>>
>> fn<-file.path("mypath\\cru_ts4.04.2011.2019.pre.dat.nc")
>>
>> rasbrick <- stack(fn)
>>
>
> I see for this publically available file, with current CRAN sp, rgdal and
> raster:
>
>> str(crs(rasbrick))
> Formal class 'CRS' [package "sp"] with 1 slot
>   ..@ projargs: chr "+proj=longlat +datum=WGS84 +no_defs"
>
> but crucially:
>
>> cat(wkt(crs(rasbrick)), "\n")
> GEOGCRS["unknown",
>     DATUM["World Geodetic System 1984",
>         ELLIPSOID["WGS 84",6378137,298.257223563,
>             LENGTHUNIT["metre",1]],
>         ID["EPSG",6326]],
>     PRIMEM["Greenwich",0,
>         ANGLEUNIT["degree",0.0174532925199433],
>         ID["EPSG",8901]],
>     CS[ellipsoidal,2],
>         AXIS["longitude",east,
>             ORDER[1],
>             ANGLEUNIT["degree",0.0174532925199433,
>                 ID["EPSG",9122]]],
>         AXIS["latitude",north,
>             ORDER[2],
>             ANGLEUNIT["degree",0.0174532925199433,
>                 ID["EPSG",9122]]]]
>
> The WKT2-2019 representation also present in the CRS object suggests that
> the CRU_TS grid is read correctly.
>
>> shape2<- spTransform(shape, crs(rasbrick))
>>
>
> The success of this operation will depend on:
>
> cat(wkt(shape), "\n")
>
> being well-defined, the on there being an optimal path from the CRS of
> shape to that of rasbrick (up to PROJ 6, there was no choice in the
> operation, as the source and target CRS defined their relationship to
> WGS84). After spTransform(), you can use get_last_coordOp() to show the
> coordinate operation pipeline. In sp/rgdal, every effort has been made to
> prevent axis-swapping.
>
>> proj4string(shape2)
>
> Rather check with cat(wkt(shape2), "\n"), as proj4string() may issue a
> warning, as you are asking to look at the deprecated Proj4 representation.
>
>>
>> for (i in 1:length(rasbrick at layers)) {
>>  weath_dt[,2+i] = raster::extract(rasbrick[[i]], shape2, mean, na.rm=T)
>> }
>
> Because raster uses sp/rgdal, it may also issue warnings. The warnings are
> there to provoke questions like yours. Warnings may be muted for sp and
> rgdal by options("rgdal_show_exportToProj4_warnings"="none") before
> loading rgdal.
>
> Hope this clarifies,
>
> Roger
>
>>
>> Thanks.
>>
>> Pietro Andre Telatin Paschoalino
>> Doutorando em Ci?ncias Econ?micas da Universidade Estadual de Maring? - PCE.
>>
>>        [[alternative HTML version deleted]]
>>
>>
>
> --
> Roger Bivand
> Department of Economics, Norwegian School of Economics,
> Postboks 3490 Ytre Sandviken, 5045 Bergen, Norway.
> e-mail: Roger.Bivand at nhh.no
> https://orcid.org/0000-0003-2392-6140
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Postboks 3490 Ytre Sandviken, 5045 Bergen, Norway.
e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

From tob|@@@rutten@uer @end|ng |rom nu|||e|d@ox@@c@uk  Wed Mar 24 16:21:37 2021
From: tob|@@@rutten@uer @end|ng |rom nu|||e|d@ox@@c@uk (Tobias Ruttenauer)
Date: Wed, 24 Mar 2021 15:21:37 +0000
Subject: [R-sig-Geo] Impute missing values along a spatial network
In-Reply-To: <3ddad650-d23-5fdd-b25-9546cc2d3994@reclus.nhh.no>
References: <CWLP265MB00492183AEFB98C3C2DE76CAE3639@CWLP265MB0049.GBRP265.PROD.OUTLOOK.COM>
 <3ddad650-d23-5fdd-b25-9546cc2d3994@reclus.nhh.no>
Message-ID: <CWLP265MB00494AC71C5BA0294C3FD730E3639@CWLP265MB0049.GBRP265.PROD.OUTLOOK.COM>

Thank you very much for the hint, Roger! Completely right, a Gaussian process actually does not make too much sense in this case. I'll have a look into INLA and see if I can work with that.

For now, I don't have any covariates in this. This is mainly because I'm specifically interested in the annual variation of traffic counts, but available covariates are all time-constant.

Thanks again and best wishes
Tobias


-----Original Message-----
From: Roger Bivand <Roger.Bivand at nhh.no> 
Sent: 24 March 2021 14:18
To: Tobias Ruttenauer <tobias.ruttenauer at nuffield.ox.ac.uk>
Cc: r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] Impute missing values along a spatial network

On Wed, 24 Mar 2021, Tobias Ruttenauer wrote:

> Dear list members,
>
> I am trying to construct a road network with traffic estimates for 
> each road segment. I have count data of the traffic for a subset of 
> the segments and I have the road network as spatial lines data. For 
> those segments without count data, I would like to perform something 
> like linear imputation or some sort of interpolation / kriging along 
> the road network instead of using pure geographical distance. For 
> instance, if I have 7 road segments A-B-C-D-E and F-G (F and G are 
> unconnected to the rest), and I have data for A and D, how can I 
> impute data for B, C (and
> E) by only using A and D, while ignoring F and G even though they 
> might be geographically close?

Are there any relevant covariates associated with the road segments? I think that this is more of a Markov than a Gaussian random field, so a Poisson spatial regression with a neighbour matrix representing contiguous segments might be possible. Covariates, or an offset by an expected volume might help. INLA with a Besag model - INLA fits missing responses, or
mgcv::gam() with an "mrf" smooth or hglm() then predict?

Any other suggestions?

Roger

>
> This seems fairly intuitive to me but I couldn't find a package doing 
> that. stplanr would do something related but it seems it needs 
> origin-destination data (which I don't have). I'd be grateful if 
> someone could nudge me into the right direction. I guess I'm using the 
> wrong terminology.
>
> Thanks a lot and best wishes
> Tobias
>
> Tobias R?ttenauer
> Nuffield College
> University of Oxford
> Oxford, OX1 1NF
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

--
Roger Bivand
Department of Economics, Norwegian School of Economics, Postboks 3490 Ytre Sandviken, 5045 Bergen, Norway.
e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en


From Roger@B|v@nd @end|ng |rom nhh@no  Wed Mar 24 18:00:59 2021
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Wed, 24 Mar 2021 18:00:59 +0100
Subject: [R-sig-Geo] Impute missing values along a spatial network
In-Reply-To: <CWLP265MB00494AC71C5BA0294C3FD730E3639@CWLP265MB0049.GBRP265.PROD.OUTLOOK.COM>
References: <CWLP265MB00492183AEFB98C3C2DE76CAE3639@CWLP265MB0049.GBRP265.PROD.OUTLOOK.COM>
 <3ddad650-d23-5fdd-b25-9546cc2d3994@reclus.nhh.no>
 <CWLP265MB00494AC71C5BA0294C3FD730E3639@CWLP265MB0049.GBRP265.PROD.OUTLOOK.COM>
Message-ID: <164e3f3a-7af-88d-c122-26716daae9a7@reclus.nhh.no>

On Wed, 24 Mar 2021, Tobias Ruttenauer wrote:

> Thank you very much for the hint, Roger! Completely right, a Gaussian 
> process actually does not make too much sense in this case. I'll have a 
> look into INLA and see if I can work with that.

If you look at this like a rate shrinkage problem, maybe you can set up a 
spatial interaction model based on data at the end nodes of the segments 
to generate "expected" volumes? These would then not be (necessarily) time 
constant covariates at the nodes, but could reflect supply/demand factors. 
Otherwise you just have the volume counts. A basic intrinsic CAR might be 
helpful, but the data would need to guide the signal/noise ratio - without 
expectations, and with many missing counts, the predictions for segments 
with no counts will have broad posterior distributions. Avoiding Gaussian 
may help avoid predicting negative volumes - but log volumes might be OK.

Roger

>
> For now, I don't have any covariates in this. This is mainly because I'm 
> specifically interested in the annual variation of traffic counts, but 
> available covariates are all time-constant.
>
> Thanks again and best wishes
> Tobias
>
>
> -----Original Message-----
> From: Roger Bivand <Roger.Bivand at nhh.no>
> Sent: 24 March 2021 14:18
> To: Tobias Ruttenauer <tobias.ruttenauer at nuffield.ox.ac.uk>
> Cc: r-sig-geo at r-project.org
> Subject: Re: [R-sig-Geo] Impute missing values along a spatial network
>
> On Wed, 24 Mar 2021, Tobias Ruttenauer wrote:
>
>> Dear list members,
>>
>> I am trying to construct a road network with traffic estimates for
>> each road segment. I have count data of the traffic for a subset of
>> the segments and I have the road network as spatial lines data. For
>> those segments without count data, I would like to perform something
>> like linear imputation or some sort of interpolation / kriging along
>> the road network instead of using pure geographical distance. For
>> instance, if I have 7 road segments A-B-C-D-E and F-G (F and G are
>> unconnected to the rest), and I have data for A and D, how can I
>> impute data for B, C (and
>> E) by only using A and D, while ignoring F and G even though they
>> might be geographically close?
>
> Are there any relevant covariates associated with the road segments? I think that this is more of a Markov than a Gaussian random field, so a Poisson spatial regression with a neighbour matrix representing contiguous segments might be possible. Covariates, or an offset by an expected volume might help. INLA with a Besag model - INLA fits missing responses, or
> mgcv::gam() with an "mrf" smooth or hglm() then predict?
>
> Any other suggestions?
>
> Roger
>
>>
>> This seems fairly intuitive to me but I couldn't find a package doing
>> that. stplanr would do something related but it seems it needs
>> origin-destination data (which I don't have). I'd be grateful if
>> someone could nudge me into the right direction. I guess I'm using the
>> wrong terminology.
>>
>> Thanks a lot and best wishes
>> Tobias
>>
>> Tobias R?ttenauer
>> Nuffield College
>> University of Oxford
>> Oxford, OX1 1NF
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> --
> Roger Bivand
> Department of Economics, Norwegian School of Economics, Postboks 3490 Ytre Sandviken, 5045 Bergen, Norway.
> e-mail: Roger.Bivand at nhh.no
> https://orcid.org/0000-0003-2392-6140
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Postboks 3490 Ytre Sandviken, 5045 Bergen, Norway.
e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

From th|erry@onke||nx @end|ng |rom |nbo@be  Thu Mar 25 10:14:29 2021
From: th|erry@onke||nx @end|ng |rom |nbo@be (Thierry Onkelinx)
Date: Thu, 25 Mar 2021 10:14:29 +0100
Subject: [R-sig-Geo] Impute missing values along a spatial network
In-Reply-To: <CWLP265MB00494AC71C5BA0294C3FD730E3639@CWLP265MB0049.GBRP265.PROD.OUTLOOK.COM>
References: <CWLP265MB00492183AEFB98C3C2DE76CAE3639@CWLP265MB0049.GBRP265.PROD.OUTLOOK.COM>
 <3ddad650-d23-5fdd-b25-9546cc2d3994@reclus.nhh.no>
 <CWLP265MB00494AC71C5BA0294C3FD730E3639@CWLP265MB0049.GBRP265.PROD.OUTLOOK.COM>
Message-ID: <CAJuCY5wipG7NW5ht42pG_TkYLW84ViXmBZqn3QmLZ_7m=pSVxQ@mail.gmail.com>

Dear Tobias,

Keep in mind that you'll need multiple imputation (). If you use the
predicted values to impute, then you'll get a variance which is lower than
the variance of the complete dataset. Whereas the variance should increase
with the amount of missing data. Multiple imputation solves that problem.

Best regards,

ir. Thierry Onkelinx
Statisticus / Statistician

Vlaamse Overheid / Government of Flanders
INSTITUUT VOOR NATUUR- EN BOSONDERZOEK / RESEARCH INSTITUTE FOR NATURE AND
FOREST
Team Biometrie & Kwaliteitszorg / Team Biometrics & Quality Assurance
thierry.onkelinx at inbo.be
Havenlaan 88 bus 73, 1000 Brussel
www.inbo.be

///////////////////////////////////////////////////////////////////////////////////////////
To call in the statistician after the experiment is done may be no more
than asking him to perform a post-mortem examination: he may be able to say
what the experiment died of. ~ Sir Ronald Aylmer Fisher
The plural of anecdote is not data. ~ Roger Brinner
The combination of some data and an aching desire for an answer does not
ensure that a reasonable answer can be extracted from a given body of data.
~ John Tukey
///////////////////////////////////////////////////////////////////////////////////////////

<https://www.inbo.be>


Op wo 24 mrt. 2021 om 16:22 schreef Tobias Ruttenauer <
tobias.ruttenauer at nuffield.ox.ac.uk>:

> Thank you very much for the hint, Roger! Completely right, a Gaussian
> process actually does not make too much sense in this case. I'll have a
> look into INLA and see if I can work with that.
>
> For now, I don't have any covariates in this. This is mainly because I'm
> specifically interested in the annual variation of traffic counts, but
> available covariates are all time-constant.
>
> Thanks again and best wishes
> Tobias
>
>
> -----Original Message-----
> From: Roger Bivand <Roger.Bivand at nhh.no>
> Sent: 24 March 2021 14:18
> To: Tobias Ruttenauer <tobias.ruttenauer at nuffield.ox.ac.uk>
> Cc: r-sig-geo at r-project.org
> Subject: Re: [R-sig-Geo] Impute missing values along a spatial network
>
> On Wed, 24 Mar 2021, Tobias Ruttenauer wrote:
>
> > Dear list members,
> >
> > I am trying to construct a road network with traffic estimates for
> > each road segment. I have count data of the traffic for a subset of
> > the segments and I have the road network as spatial lines data. For
> > those segments without count data, I would like to perform something
> > like linear imputation or some sort of interpolation / kriging along
> > the road network instead of using pure geographical distance. For
> > instance, if I have 7 road segments A-B-C-D-E and F-G (F and G are
> > unconnected to the rest), and I have data for A and D, how can I
> > impute data for B, C (and
> > E) by only using A and D, while ignoring F and G even though they
> > might be geographically close?
>
> Are there any relevant covariates associated with the road segments? I
> think that this is more of a Markov than a Gaussian random field, so a
> Poisson spatial regression with a neighbour matrix representing contiguous
> segments might be possible. Covariates, or an offset by an expected volume
> might help. INLA with a Besag model - INLA fits missing responses, or
> mgcv::gam() with an "mrf" smooth or hglm() then predict?
>
> Any other suggestions?
>
> Roger
>
> >
> > This seems fairly intuitive to me but I couldn't find a package doing
> > that. stplanr would do something related but it seems it needs
> > origin-destination data (which I don't have). I'd be grateful if
> > someone could nudge me into the right direction. I guess I'm using the
> > wrong terminology.
> >
> > Thanks a lot and best wishes
> > Tobias
> >
> > Tobias R?ttenauer
> > Nuffield College
> > University of Oxford
> > Oxford, OX1 1NF
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
>
> --
> Roger Bivand
> Department of Economics, Norwegian School of Economics, Postboks 3490 Ytre
> Sandviken, 5045 Bergen, Norway.
> e-mail: Roger.Bivand at nhh.no
> https://orcid.org/0000-0003-2392-6140
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From m@p|no|@10 @end|ng |rom gm@||@com  Thu Mar 25 21:55:34 2021
From: m@p|no|@10 @end|ng |rom gm@||@com (=?UTF-8?Q?Manuel_Sp=C3=ADnola?=)
Date: Thu, 25 Mar 2021 14:55:34 -0600
Subject: [R-sig-Geo] Not perfect match between the bounding box for a EPSG
 when projected (st_bbox from sf)
Message-ID: <CABkCotSWqOf_uT31DmoVyKixbg0qFL6M+O7KYo-A+mWaMbnOvQ@mail.gmail.com>

Dear list members,

I am working with the epsg 5367.

The information for this epsg according to this website (
https://epsg.io/5367) is:

WGS84 bounds:
-90.45 2.15
-81.43 11.77

Projected bounds:
-218963.01 239235.14
780173.56 1302793.77

When I create a box with st_bbox from the package sf and transform the
object I don't get the same bounding box that I was expecting.  Is it a
fair expectation?

b <- st_bbox(c(xmin = -90.45, xmax = -81.43, ymax = 11.77, ymin = 2.15),
crs = st_crs(4326))

b <- st_as_sfc(b)

b_5367 <- st_transform(b, crs = 5367)

b_5367

Geometry set for 1 feature
Geometry type: POLYGON
Dimension:     XY
Bounding box:  xmin: -218962 ymin: 237951.9 xmax: 785959.7 ymax: 1309622
Projected CRS: CR05 / CRTM05POLYGON ((-218962 239233.5, 785959.7 237951.9, ...



-- 
*Manuel Sp?nola, Ph.D.*
Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
Universidad Nacional
Apartado 1350-3000
Heredia
COSTA RICA
mspinola at una.cr <mspinola at una.ac.cr>
mspinola10 at gmail.com
Tel?fono: (506) 8706 - 4662
Personal website: Lobito de r?o <https://sites.google.com/site/lobitoderio/>
Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>

	[[alternative HTML version deleted]]


From Roger@B|v@nd @end|ng |rom nhh@no  Fri Mar 26 15:47:01 2021
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Fri, 26 Mar 2021 15:47:01 +0100
Subject: [R-sig-Geo] 
 Not perfect match between the bounding box for a EPSG
 when projected (st_bbox from sf)
In-Reply-To: <CABkCotSWqOf_uT31DmoVyKixbg0qFL6M+O7KYo-A+mWaMbnOvQ@mail.gmail.com>
References: <CABkCotSWqOf_uT31DmoVyKixbg0qFL6M+O7KYo-A+mWaMbnOvQ@mail.gmail.com>
Message-ID: <a24b11a9-d531-88cf-7234-2b0d18855c7@reclus.nhh.no>

On Thu, 25 Mar 2021, Manuel Sp?nola wrote:

> Dear list members,
>
> I am working with the epsg 5367.
>
> The information for this epsg according to this website (
> https://epsg.io/5367) is:
>
> WGS84 bounds:
> -90.45 2.15
> -81.43 11.77
>
> Projected bounds:
> -218963.01 239235.14
> 780173.56 1302793.77
>
> When I create a box with st_bbox from the package sf and transform the
> object I don't get the same bounding box that I was expecting.  Is it a
> fair expectation?

No. Firstly, epsg.io is not an EPSG service. Secondly, two different 
definitions are offered. I think that this works (sf 0.9-8):

pts1 <- st_sfc(list(st_point(c(-90.45, 2.15)), st_point(c(-81.43,
  11.77))), crs="OGC:CRS84")
st_transform(pts1, "EPSG:5367")
# POINT (-218962 239233.5)
# POINT (780173.7 1302793)
o <- sf_proj_pipelines("OGC:CRS84", "EPSG:5367")
o$definition
st_transform(pts1, "EPSG:5367", pipeline = o$definition[1])
# POINT (-218962 239233.5)
# POINT (780173.7 1302793)
# Costa Rica - onshore and offshore, accuracy 1.0 m, code 8969 [grid] 
st_transform(pts1, "EPSG:5367", pipeline = o$definition[2])
# POINT (-218963 239235.1)
# POINT (780173.6 1302794)
# Costa Rica - onshore and offshore, accuracy 1.0 m, code 5376 (default) 
# [grid]

So, as in https://github.com/r-spatial/sf/issues/1634, treating epsg.io as 
authoritative (especially when there are different transformation 
pipelines in play) may be unhelpful.sf/PROJ chooses a different pipeline 
as default than epsg.io.

This roundtrips:

st_transform(st_transform(pts1, "EPSG:5367"), "OGC:CRS84")
# POINT (-90.45 2.15)
# POINT (-81.43 11.77)
# Costa Rica - onshore and offshore, accuracy 1.0 m, code 8969 [grid]

but for epsg.io's default, one needs to intervene manually to choose 
pipelines both ways that are not sf's default choices.

Of course, here I am not using the bounding box polygon, because its 
projected version is not a rectangle, so its bounding box expands the 
range, especially further from the equator.

Hope this clarifies,

Roger

>
> b <- st_bbox(c(xmin = -90.45, xmax = -81.43, ymax = 11.77, ymin = 2.15),
> crs = st_crs(4326))
>
> b <- st_as_sfc(b)
>
> b_5367 <- st_transform(b, crs = 5367)
>
> b_5367
>
> Geometry set for 1 feature
> Geometry type: POLYGON
> Dimension:     XY
> Bounding box:  xmin: -218962 ymin: 237951.9 xmax: 785959.7 ymax: 1309622
> Projected CRS: CR05 / CRTM05POLYGON ((-218962 239233.5, 785959.7 237951.9, ...
>
>
>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Postboks 3490 Ytre Sandviken, 5045 Bergen, Norway.
e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

From m@p|no|@10 @end|ng |rom gm@||@com  Fri Mar 26 16:17:24 2021
From: m@p|no|@10 @end|ng |rom gm@||@com (=?UTF-8?Q?Manuel_Sp=C3=ADnola?=)
Date: Fri, 26 Mar 2021 09:17:24 -0600
Subject: [R-sig-Geo] 
 Not perfect match between the bounding box for a EPSG
 when projected (st_bbox from sf)
In-Reply-To: <a24b11a9-d531-88cf-7234-2b0d18855c7@reclus.nhh.no>
References: <CABkCotSWqOf_uT31DmoVyKixbg0qFL6M+O7KYo-A+mWaMbnOvQ@mail.gmail.com>
 <a24b11a9-d531-88cf-7234-2b0d18855c7@reclus.nhh.no>
Message-ID: <CABkCotSb4bfhyoMigXmNx01OUb9gZwcMJK7=gphXdLivpZ87jw@mail.gmail.com>

Thank you very much Roger.

Manuel

El vie, 26 mar 2021 a las 8:47, Roger Bivand (<Roger.Bivand at nhh.no>)
escribi?:

> On Thu, 25 Mar 2021, Manuel Sp?nola wrote:
>
> > Dear list members,
> >
> > I am working with the epsg 5367.
> >
> > The information for this epsg according to this website (
> > https://epsg.io/5367) is:
> >
> > WGS84 bounds:
> > -90.45 2.15
> > -81.43 11.77
> >
> > Projected bounds:
> > -218963.01 239235.14
> > 780173.56 1302793.77
> >
> > When I create a box with st_bbox from the package sf and transform the
> > object I don't get the same bounding box that I was expecting.  Is it a
> > fair expectation?
>
> No. Firstly, epsg.io is not an EPSG service. Secondly, two different
> definitions are offered. I think that this works (sf 0.9-8):
>
> pts1 <- st_sfc(list(st_point(c(-90.45, 2.15)), st_point(c(-81.43,
>   11.77))), crs="OGC:CRS84")
> st_transform(pts1, "EPSG:5367")
> # POINT (-218962 239233.5)
> # POINT (780173.7 1302793)
> o <- sf_proj_pipelines("OGC:CRS84", "EPSG:5367")
> o$definition
> st_transform(pts1, "EPSG:5367", pipeline = o$definition[1])
> # POINT (-218962 239233.5)
> # POINT (780173.7 1302793)
> # Costa Rica - onshore and offshore, accuracy 1.0 m, code 8969 [grid]
> st_transform(pts1, "EPSG:5367", pipeline = o$definition[2])
> # POINT (-218963 239235.1)
> # POINT (780173.6 1302794)
> # Costa Rica - onshore and offshore, accuracy 1.0 m, code 5376 (default)
> # [grid]
>
> So, as in https://github.com/r-spatial/sf/issues/1634, treating epsg.io
> as
> authoritative (especially when there are different transformation
> pipelines in play) may be unhelpful.sf/PROJ chooses a different pipeline
> as default than epsg.io.
>
> This roundtrips:
>
> st_transform(st_transform(pts1, "EPSG:5367"), "OGC:CRS84")
> # POINT (-90.45 2.15)
> # POINT (-81.43 11.77)
> # Costa Rica - onshore and offshore, accuracy 1.0 m, code 8969 [grid]
>
> but for epsg.io's default, one needs to intervene manually to choose
> pipelines both ways that are not sf's default choices.
>
> Of course, here I am not using the bounding box polygon, because its
> projected version is not a rectangle, so its bounding box expands the
> range, especially further from the equator.
>
> Hope this clarifies,
>
> Roger
>
> >
> > b <- st_bbox(c(xmin = -90.45, xmax = -81.43, ymax = 11.77, ymin = 2.15),
> > crs = st_crs(4326))
> >
> > b <- st_as_sfc(b)
> >
> > b_5367 <- st_transform(b, crs = 5367)
> >
> > b_5367
> >
> > Geometry set for 1 feature
> > Geometry type: POLYGON
> > Dimension:     XY
> > Bounding box:  xmin: -218962 ymin: 237951.9 xmax: 785959.7 ymax: 1309622
> > Projected CRS: CR05 / CRTM05POLYGON ((-218962 239233.5, 785959.7
> 237951.9, ...
> >
> >
> >
> >
>
> --
> Roger Bivand
> Department of Economics, Norwegian School of Economics,
> Postboks 3490 Ytre Sandviken, 5045 Bergen, Norway.
> e-mail: Roger.Bivand at nhh.no
> https://orcid.org/0000-0003-2392-6140
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en



-- 
*Manuel Sp?nola, Ph.D.*
Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
Universidad Nacional
Apartado 1350-3000
Heredia
COSTA RICA
mspinola at una.cr <mspinola at una.ac.cr>
mspinola10 at gmail.com
Tel?fono: (506) 8706 - 4662
Personal website: Lobito de r?o <https://sites.google.com/site/lobitoderio/>
Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>

	[[alternative HTML version deleted]]


From m@ur|c|o@m@rdone@ @end|ng |rom ||op@c|  Fri Mar 26 16:26:49 2021
From: m@ur|c|o@m@rdone@ @end|ng |rom ||op@c| (MAURICIO MARDONES)
Date: Fri, 26 Mar 2021 12:26:49 -0300
Subject: [R-sig-Geo] geoRglm
Message-ID: <AF2D10FD-B181-42FE-A6E3-E37C81B5CAD4@ifop.cl>

Dear list members,

I have some trouble to trying installing library ?geoRglm". I guess this is not more in CRAN, but I need it. 
Someone know how install from another repo?

Best 
-- 
C*ertificaci?n ISO 9001/2015*: Sistema de Datos Biol?gico-Pesqueros?(Arica, 
Iquique, Coquimbo, Valpara?so, San Antonio, Talcahuano y Calbuco, 
pesquer?as industriales y artesanales)


From Roger@B|v@nd @end|ng |rom nhh@no  Fri Mar 26 16:44:53 2021
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Fri, 26 Mar 2021 16:44:53 +0100
Subject: [R-sig-Geo] geoRglm
In-Reply-To: <AF2D10FD-B181-42FE-A6E3-E37C81B5CAD4@ifop.cl>
References: <AF2D10FD-B181-42FE-A6E3-E37C81B5CAD4@ifop.cl>
Message-ID: <ae382c45-4763-9149-ac55-2b29bdbc6c7a@reclus.nhh.no>

On Fri, 26 Mar 2021, MAURICIO MARDONES wrote:

> Dear list members,
>
> I have some trouble to trying installing library ?geoRglm". I guess this is not more in CRAN, but I need it.
> Someone know how install from another repo?

The source package is in the CRAN archive:

https://cran.r-project.org/src/contrib/Archive/geoRglm/

You can install it from source, but:

CRAN repository db overrides:
   X-CRAN-Comment: Archived on 2020-03-18 as check problems were not
     corrected despite reminders.

   Several LTO errors.

(https://en.wikipedia.org/wiki/Interprocedural_optimization)

So until the maintainer corrects these errors, or someone initiates a 
process to orphan/adopt the package and corrects them, it will not return 
to CRAN. It probably still works OK, but is vulnerable to degradation with 
modern compilers.

Roger

>
> Best
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Postboks 3490 Ytre Sandviken, 5045 Bergen, Norway.
e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

From m@ur|c|o@m@rdone@ @end|ng |rom ||op@c|  Fri Mar 26 16:54:49 2021
From: m@ur|c|o@m@rdone@ @end|ng |rom ||op@c| (MAURICIO MARDONES)
Date: Fri, 26 Mar 2021 12:54:49 -0300
Subject: [R-sig-Geo] geoRglm
In-Reply-To: <ae382c45-4763-9149-ac55-2b29bdbc6c7a@reclus.nhh.no>
References: <AF2D10FD-B181-42FE-A6E3-E37C81B5CAD4@ifop.cl>
 <ae382c45-4763-9149-ac55-2b29bdbc6c7a@reclus.nhh.no>
Message-ID: <9BBFFB8A-A52E-4271-9CBE-0A98AD1D3D14@ifop.cl>

Thanks Roger

I think this is way to install from the source right?
https://stackoverflow.com/questions/1474081/how-do-i-install-an-r-package-from-source <https://stackoverflow.com/questions/1474081/how-do-i-install-an-r-package-from-source>

Best

> On 26-03-2021, at 12:44, Roger Bivand <Roger.Bivand at nhh.no> wrote:
> 
> On Fri, 26 Mar 2021, MAURICIO MARDONES wrote:
> 
>> Dear list members,
>> 
>> I have some trouble to trying installing library ?geoRglm". I guess this is not more in CRAN, but I need it.
>> Someone know how install from another repo?
> 
> The source package is in the CRAN archive:
> 
> https://cran.r-project.org/src/contrib/Archive/geoRglm/
> 
> You can install it from source, but:
> 
> CRAN repository db overrides:
>  X-CRAN-Comment: Archived on 2020-03-18 as check problems were not
>    corrected despite reminders.
> 
>  Several LTO errors.
> 
> (https://en.wikipedia.org/wiki/Interprocedural_optimization)
> 
> So until the maintainer corrects these errors, or someone initiates a process to orphan/adopt the package and corrects them, it will not return to CRAN. It probably still works OK, but is vulnerable to degradation with modern compilers.
> 
> Roger
> 
>> 
>> Best
>> 
> 
> -- 
> Roger Bivand
> Department of Economics, Norwegian School of Economics,
> Postboks 3490 Ytre Sandviken, 5045 Bergen, Norway.
> e-mail: Roger.Bivand at nhh.no
> https://orcid.org/0000-0003-2392-6140
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en


-- 
C*ertificaci?n ISO 9001/2015*: Sistema de Datos Biol?gico-Pesqueros?(Arica, 
Iquique, Coquimbo, Valpara?so, San Antonio, Talcahuano y Calbuco, 
pesquer?as industriales y artesanales)

	[[alternative HTML version deleted]]


From Roger@B|v@nd @end|ng |rom nhh@no  Fri Mar 26 17:06:38 2021
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Fri, 26 Mar 2021 17:06:38 +0100
Subject: [R-sig-Geo] geoRglm
In-Reply-To: <9BBFFB8A-A52E-4271-9CBE-0A98AD1D3D14@ifop.cl>
References: <AF2D10FD-B181-42FE-A6E3-E37C81B5CAD4@ifop.cl>
 <ae382c45-4763-9149-ac55-2b29bdbc6c7a@reclus.nhh.no>
 <9BBFFB8A-A52E-4271-9CBE-0A98AD1D3D14@ifop.cl>
Message-ID: <eec2cbc6-cf27-e060-e86b-2834991a857d@reclus.nhh.no>

On Fri, 26 Mar 2021, MAURICIO MARDONES wrote:

> Thanks Roger
>
> I think this is way to install from the source right?

I would not trust that. Go to the authorised source after downloading the 
source package tarball, do not use a GUI or RStudio if compiled code is 
involved, as it is here (see 
https://cran.r-project.org/doc/manuals/r-release/R-admin.html#Installing-packages).

From the command line, try R CMD INSTALL geoRglm_0.9-16.tar.gz. If on 
Windows with RTools installed, this will work 
(https://cran.r-project.org/bin/windows/Rtools/). If on MacOS, work out 
from https://cran.r-project.org/bin/macosx/tools what you need to install 
of compilers, etc., if not already installed.

Running R CMD INSTALL geoRglm_0.9-16.tar.gz will show what is missing. 
Since you used a web search and reached an unhelpful page, maybe review 
https://cran.r-project.org/bin/macosx/RMacOSX-FAQ.html#How-to-install-packages
and 
https://cran.r-project.org/bin/macosx/RMacOSX-FAQ.html#Installation-of-source-packages 
first.

Roger

> https://stackoverflow.com/questions/1474081/how-do-i-install-an-r-package-from-source <https://stackoverflow.com/questions/1474081/how-do-i-install-an-r-package-from-source>
>
> Best
>
>> On 26-03-2021, at 12:44, Roger Bivand <Roger.Bivand at nhh.no> wrote:
>>
>> On Fri, 26 Mar 2021, MAURICIO MARDONES wrote:
>>
>>> Dear list members,
>>>
>>> I have some trouble to trying installing library ?geoRglm". I guess this is not more in CRAN, but I need it.
>>> Someone know how install from another repo?
>>
>> The source package is in the CRAN archive:
>>
>> https://cran.r-project.org/src/contrib/Archive/geoRglm/
>>
>> You can install it from source, but:
>>
>> CRAN repository db overrides:
>>  X-CRAN-Comment: Archived on 2020-03-18 as check problems were not
>>    corrected despite reminders.
>>
>>  Several LTO errors.
>>
>> (https://en.wikipedia.org/wiki/Interprocedural_optimization)
>>
>> So until the maintainer corrects these errors, or someone initiates a process to orphan/adopt the package and corrects them, it will not return to CRAN. It probably still works OK, but is vulnerable to degradation with modern compilers.
>>
>> Roger
>>
>>>
>>> Best
>>>
>>
>> --
>> Roger Bivand
>> Department of Economics, Norwegian School of Economics,
>> Postboks 3490 Ytre Sandviken, 5045 Bergen, Norway.
>> e-mail: Roger.Bivand at nhh.no
>> https://orcid.org/0000-0003-2392-6140
>> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>
>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Postboks 3490 Ytre Sandviken, 5045 Bergen, Norway.
e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

From m@ur|c|o@m@rdone@ @end|ng |rom ||op@c|  Fri Mar 26 17:41:49 2021
From: m@ur|c|o@m@rdone@ @end|ng |rom ||op@c| (MAURICIO MARDONES)
Date: Fri, 26 Mar 2021 13:41:49 -0300
Subject: [R-sig-Geo] geoRglm
In-Reply-To: <eec2cbc6-cf27-e060-e86b-2834991a857d@reclus.nhh.no>
References: <AF2D10FD-B181-42FE-A6E3-E37C81B5CAD4@ifop.cl>
 <ae382c45-4763-9149-ac55-2b29bdbc6c7a@reclus.nhh.no>
 <9BBFFB8A-A52E-4271-9CBE-0A98AD1D3D14@ifop.cl>
 <eec2cbc6-cf27-e060-e86b-2834991a857d@reclus.nhh.no>
Message-ID: <0366D772-882F-4BA5-9623-0B0678FAD186@ifop.cl>

Thanks again Roger!

Best

> On 26-03-2021, at 13:06, Roger Bivand <Roger.Bivand at nhh.no> wrote:
> 
> On Fri, 26 Mar 2021, MAURICIO MARDONES wrote:
> 
>> Thanks Roger
>> 
>> I think this is way to install from the source right?
> 
> I would not trust that. Go to the authorised source after downloading the source package tarball, do not use a GUI or RStudio if compiled code is involved, as it is here (see https://cran.r-project.org/doc/manuals/r-release/R-admin.html#Installing-packages <https://cran.r-project.org/doc/manuals/r-release/R-admin.html#Installing-packages>).
> 
> From the command line, try R CMD INSTALL geoRglm_0.9-16.tar.gz. If on Windows with RTools installed, this will work (https://cran.r-project.org/bin/windows/Rtools/ <https://cran.r-project.org/bin/windows/Rtools/>). If on MacOS, work out from https://cran.r-project.org/bin/macosx/tools <https://cran.r-project.org/bin/macosx/tools> what you need to install of compilers, etc., if not already installed.
> 
> Running R CMD INSTALL geoRglm_0.9-16.tar.gz will show what is missing. Since you used a web search and reached an unhelpful page, maybe review https://cran.r-project.org/bin/macosx/RMacOSX-FAQ.html#How-to-install-packages <https://cran.r-project.org/bin/macosx/RMacOSX-FAQ.html#How-to-install-packages>
> and https://cran.r-project.org/bin/macosx/RMacOSX-FAQ.html#Installation-of-source-packages <https://cran.r-project.org/bin/macosx/RMacOSX-FAQ.html#Installation-of-source-packages> first.
> 
> Roger
> 
>> https://stackoverflow.com/questions/1474081/how-do-i-install-an-r-package-from-source <https://stackoverflow.com/questions/1474081/how-do-i-install-an-r-package-from-source> <https://stackoverflow.com/questions/1474081/how-do-i-install-an-r-package-from-source <https://stackoverflow.com/questions/1474081/how-do-i-install-an-r-package-from-source>>
>> 
>> Best
>> 
>>> On 26-03-2021, at 12:44, Roger Bivand <Roger.Bivand at nhh.no> wrote:
>>> 
>>> On Fri, 26 Mar 2021, MAURICIO MARDONES wrote:
>>> 
>>>> Dear list members,
>>>> 
>>>> I have some trouble to trying installing library ?geoRglm". I guess this is not more in CRAN, but I need it.
>>>> Someone know how install from another repo?
>>> 
>>> The source package is in the CRAN archive:
>>> 
>>> https://cran.r-project.org/src/contrib/Archive/geoRglm/
>>> 
>>> You can install it from source, but:
>>> 
>>> CRAN repository db overrides:
>>> X-CRAN-Comment: Archived on 2020-03-18 as check problems were not
>>>   corrected despite reminders.
>>> 
>>> Several LTO errors.
>>> 
>>> (https://en.wikipedia.org/wiki/Interprocedural_optimization)
>>> 
>>> So until the maintainer corrects these errors, or someone initiates a process to orphan/adopt the package and corrects them, it will not return to CRAN. It probably still works OK, but is vulnerable to degradation with modern compilers.
>>> 
>>> Roger
>>> 
>>>> 
>>>> Best
>>>> 
>>> 
>>> --
>>> Roger Bivand
>>> Department of Economics, Norwegian School of Economics,
>>> Postboks 3490 Ytre Sandviken, 5045 Bergen, Norway.
>>> e-mail: Roger.Bivand at nhh.no
>>> https://orcid.org/0000-0003-2392-6140
>>> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>> 
>> 
>> 
> 
> -- 
> Roger Bivand
> Department of Economics, Norwegian School of Economics,
> Postboks 3490 Ytre Sandviken, 5045 Bergen, Norway.
> e-mail: Roger.Bivand at nhh.no <mailto:Roger.Bivand at nhh.no>
> https://orcid.org/0000-0003-2392-6140 <https://orcid.org/0000-0003-2392-6140>
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en <https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en>

-- 
C*ertificaci?n ISO 9001/2015*: Sistema de Datos Biol?gico-Pesqueros?(Arica, 
Iquique, Coquimbo, Valpara?so, San Antonio, Talcahuano y Calbuco, 
pesquer?as industriales y artesanales)

	[[alternative HTML version deleted]]


From g@b|k|m01 @end|ng |rom gm@||@com  Fri Mar 26 19:56:17 2021
From: g@b|k|m01 @end|ng |rom gm@||@com (Gabriel Cotlier)
Date: Fri, 26 Mar 2021 21:56:17 +0300
Subject: [R-sig-Geo] question on writeRaster error
Message-ID: <CAAKwTDF960BhduO1abFDWZ3=7K7m27JfAv=mE=kPfsppGcDhtA@mail.gmail.com>

Hello,

I'm trying to save a raster on workspace as GeoTIFF file into a folder
named ST in Desktop

writeRaster(x = ST ,  file = paste(n,"_Rescaled_band",sep=" "),
format="GTiff",  overwrite = T)

and got the following error message :

Error in .local(x, filename, ...) :
  Attempting to write a file to a path that does not exist:
  ST

Thanks for your help.
Regards.

	[[alternative HTML version deleted]]


From ykp@|me| @end|ng |rom uc@c|  Fri Mar 26 20:34:15 2021
From: ykp@|me| @end|ng |rom uc@c| (Yasna K Palmeiro Silva)
Date: Fri, 26 Mar 2021 19:34:15 +0000
Subject: [R-sig-Geo] question on writeRaster error
In-Reply-To: <CAAKwTDF960BhduO1abFDWZ3=7K7m27JfAv=mE=kPfsppGcDhtA@mail.gmail.com>
References: <CAAKwTDF960BhduO1abFDWZ3=7K7m27JfAv=mE=kPfsppGcDhtA@mail.gmail.com>
Message-ID: <CAKq0nOx+AUc1cQsrBxE3nS1e62TArXDwwogfr=VPeVYiRcTy9w@mail.gmail.com>

Hi Gabriel,

I guess, the syntax is different:

The general syntax is:
writeRaster(NameRaster, file="PathOfFolderSTinDesktop/NameFile.tif",
format= ""GTiff", overwrite=TRUE)

If you want to add options with bands:
writeRaster(NameRaster, file="FolderPath/NameFile.tif", format= ""GTiff",
overwrite=TRUE, options= c("INTERLEAVE=BAND","COMPRESS=LZW"))

NameRaster is a RasterLayer or RasterBrick t in your global environment.

Hope this works,

Best
Yasna







On Fri, 26 Mar 2021 at 18:57, Gabriel Cotlier <gabiklm01 at gmail.com> wrote:

> Hello,
>
> I'm trying to save a raster on workspace as GeoTIFF file into a folder
> named ST in Desktop
>
> writeRaster(x = ST ,  file = paste(n,"_Rescaled_band",sep=" "),
> format="GTiff",  overwrite = T)
>
> and got the following error message :
>
> Error in .local(x, filename, ...) :
>   Attempting to write a file to a path that does not exist:
>   ST
>
> Thanks for your help.
> Regards.
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


-- 
*?Yasna K Palmeiro Silva.*

?*Tildes han sido omitidos? intencionalmente

	[[alternative HTML version deleted]]


From tob|@@@rutten@uer @end|ng |rom nu|||e|d@ox@@c@uk  Fri Mar 26 21:49:54 2021
From: tob|@@@rutten@uer @end|ng |rom nu|||e|d@ox@@c@uk (Tobias Ruttenauer)
Date: Fri, 26 Mar 2021 20:49:54 +0000
Subject: [R-sig-Geo] Impute missing values along a spatial network
In-Reply-To: <164e3f3a-7af-88d-c122-26716daae9a7@reclus.nhh.no>
References: <CWLP265MB00492183AEFB98C3C2DE76CAE3639@CWLP265MB0049.GBRP265.PROD.OUTLOOK.COM>
 <3ddad650-d23-5fdd-b25-9546cc2d3994@reclus.nhh.no>
 <CWLP265MB00494AC71C5BA0294C3FD730E3639@CWLP265MB0049.GBRP265.PROD.OUTLOOK.COM>
 <164e3f3a-7af-88d-c122-26716daae9a7@reclus.nhh.no>
Message-ID: <CWXP265MB0053FD8043C241212C944C84E3619@CWXP265MB0053.GBRP265.PROD.OUTLOOK.COM>

Thanks again for the additional comments, Roger and Thierry!

I've tried a couple of things in the meantime. An empty Besag or intrinsic CAR model shrinks extreme values very strongly towards the overall mean (one would somehow need to increase the spatial influence). What works quite well for those streets with at least one valid count are Besag or intrinsic CAR models with road number dummies (for the higher unit of road segments) as covariates. This seems to shrink towards the road mean instead of the overall mean. On the negative side, it can lead to very rough transitions where two streets with different numbers transition into each other, and it gives me a prediction of zero for all segments of road numbers without any valid count (but it might be reasonable to exclude those anyway). Using the road type (e.g. highway, minor road) as dummies is a compromise between the empty and the road number model. 

Results are btw very similar for a Gaussian on the log transformed count and a Poisson, at least in terms of covariance (correlation of 0.99 between the mean posterior predictions of the two models).

One thing I was wondering: is there a way of changing the weights or the normalization method for the adjacency matrix in INLA models if I need to store it on disk via nb2INLA()? For instance, if one road is connected to many others at a given crossing, it might be reasonable to assume something like an additive spatial influence instead of an average right? Or would that be something that can better be solved with a spatial interaction or gravity model?

Thanks a lot again for the great help and best wishes
Tobias


-----Original Message-----
From: Roger Bivand <Roger.Bivand at nhh.no> 
Sent: 24 March 2021 17:01
To: Tobias Ruttenauer <tobias.ruttenauer at nuffield.ox.ac.uk>
Cc: r-sig-geo at r-project.org
Subject: RE: [R-sig-Geo] Impute missing values along a spatial network

On Wed, 24 Mar 2021, Tobias Ruttenauer wrote:

> Thank you very much for the hint, Roger! Completely right, a Gaussian 
> process actually does not make too much sense in this case. I'll have 
> a look into INLA and see if I can work with that.

If you look at this like a rate shrinkage problem, maybe you can set up a spatial interaction model based on data at the end nodes of the segments to generate "expected" volumes? These would then not be (necessarily) time constant covariates at the nodes, but could reflect supply/demand factors. 
Otherwise you just have the volume counts. A basic intrinsic CAR might be helpful, but the data would need to guide the signal/noise ratio - without expectations, and with many missing counts, the predictions for segments with no counts will have broad posterior distributions. Avoiding Gaussian may help avoid predicting negative volumes - but log volumes might be OK.

Roger

>
> For now, I don't have any covariates in this. This is mainly because 
> I'm specifically interested in the annual variation of traffic counts, 
> but available covariates are all time-constant.
>
> Thanks again and best wishes
> Tobias
>
>
> -----Original Message-----
> From: Roger Bivand <Roger.Bivand at nhh.no>
> Sent: 24 March 2021 14:18
> To: Tobias Ruttenauer <tobias.ruttenauer at nuffield.ox.ac.uk>
> Cc: r-sig-geo at r-project.org
> Subject: Re: [R-sig-Geo] Impute missing values along a spatial network
>
> On Wed, 24 Mar 2021, Tobias Ruttenauer wrote:
>
>> Dear list members,
>>
>> I am trying to construct a road network with traffic estimates for 
>> each road segment. I have count data of the traffic for a subset of 
>> the segments and I have the road network as spatial lines data. For 
>> those segments without count data, I would like to perform something 
>> like linear imputation or some sort of interpolation / kriging along 
>> the road network instead of using pure geographical distance. For 
>> instance, if I have 7 road segments A-B-C-D-E and F-G (F and G are 
>> unconnected to the rest), and I have data for A and D, how can I 
>> impute data for B, C (and
>> E) by only using A and D, while ignoring F and G even though they 
>> might be geographically close?
>
> Are there any relevant covariates associated with the road segments? I 
> think that this is more of a Markov than a Gaussian random field, so a 
> Poisson spatial regression with a neighbour matrix representing 
> contiguous segments might be possible. Covariates, or an offset by an 
> expected volume might help. INLA with a Besag model - INLA fits 
> missing responses, or
> mgcv::gam() with an "mrf" smooth or hglm() then predict?
>
> Any other suggestions?
>
> Roger
>
>>
>> This seems fairly intuitive to me but I couldn't find a package doing 
>> that. stplanr would do something related but it seems it needs 
>> origin-destination data (which I don't have). I'd be grateful if 
>> someone could nudge me into the right direction. I guess I'm using 
>> the wrong terminology.
>>
>> Thanks a lot and best wishes
>> Tobias
>>
>> Tobias R?ttenauer
>> Nuffield College
>> University of Oxford
>> Oxford, OX1 1NF
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> --
> Roger Bivand
> Department of Economics, Norwegian School of Economics, Postboks 3490 Ytre Sandviken, 5045 Bergen, Norway.
> e-mail: Roger.Bivand at nhh.no
> https://orcid.org/0000-0003-2392-6140
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>

--
Roger Bivand
Department of Economics, Norwegian School of Economics, Postboks 3490 Ytre Sandviken, 5045 Bergen, Norway.
e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en


From g@b|k|m01 @end|ng |rom gm@||@com  Sat Mar 27 08:26:58 2021
From: g@b|k|m01 @end|ng |rom gm@||@com (Gabriel Cotlier)
Date: Sat, 27 Mar 2021 10:26:58 +0300
Subject: [R-sig-Geo] question on writeRaster error
In-Reply-To: <CAKq0nOx+AUc1cQsrBxE3nS1e62TArXDwwogfr=VPeVYiRcTy9w@mail.gmail.com>
References: <CAAKwTDF960BhduO1abFDWZ3=7K7m27JfAv=mE=kPfsppGcDhtA@mail.gmail.com>
 <CAKq0nOx+AUc1cQsrBxE3nS1e62TArXDwwogfr=VPeVYiRcTy9w@mail.gmail.com>
Message-ID: <CAAKwTDGFFPMAARb+KC9nJzFU3XSeyYnfgOhfqSd-DV7ZaBEYJw@mail.gmail.com>

Hello Lukasz and Yasna,
Now it works !!
Thanks a lot for your help!!!
Kind regards,
Gabriel



On Fri, Mar 26, 2021 at 10:34 PM Yasna K Palmeiro Silva <ykpalmei at uc.cl>
wrote:

> Hi Gabriel,
>
> I guess, the syntax is different:
>
> The general syntax is:
> writeRaster(NameRaster, file="PathOfFolderSTinDesktop/NameFile.tif",
> format= ""GTiff", overwrite=TRUE)
>
> If you want to add options with bands:
> writeRaster(NameRaster, file="FolderPath/NameFile.tif", format= ""GTiff",
> overwrite=TRUE, options= c("INTERLEAVE=BAND","COMPRESS=LZW"))
>
> NameRaster is a RasterLayer or RasterBrick t in your global environment.
>
> Hope this works,
>
> Best
> Yasna
>
>
>
>
>
>
>
> On Fri, 26 Mar 2021 at 18:57, Gabriel Cotlier <gabiklm01 at gmail.com> wrote:
>
>> Hello,
>>
>> I'm trying to save a raster on workspace as GeoTIFF file into a folder
>> named ST in Desktop
>>
>> writeRaster(x = ST ,  file = paste(n,"_Rescaled_band",sep=" "),
>> format="GTiff",  overwrite = T)
>>
>> and got the following error message :
>>
>> Error in .local(x, filename, ...) :
>>   Attempting to write a file to a path that does not exist:
>>   ST
>>
>> Thanks for your help.
>> Regards.
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>
> --
> *?Yasna K Palmeiro Silva.*
>
> ?*Tildes han sido omitidos? intencionalmente
>

	[[alternative HTML version deleted]]


From perep1972 @end|ng |rom gm@||@com  Sat Mar 27 15:42:09 2021
From: perep1972 @end|ng |rom gm@||@com (Pedro Perez)
Date: Sat, 27 Mar 2021 11:42:09 -0300
Subject: [R-sig-Geo] A global autocorrelation statistic for categorical
 data?
In-Reply-To: <e1eb9117-b6e-caae-7ad6-11bbbe9628c0@reclus.nhh.no>
References: <CAD2jFn8=TBMGqi4+0-M=ugwwqOqzBMubXyGU6o-iX3J6Bxip-w@mail.gmail.com>
 <e1eb9117-b6e-caae-7ad6-11bbbe9628c0@reclus.nhh.no>
Message-ID: <CAD2jFn-q4cGJCxq3703CE4XO==dS4U4UUXTuiLYXzKAGy+1_cw@mail.gmail.com>

Thanks a lot!

Best!

Pedro

El mar, 16 feb 2021 a las 11:02, Roger Bivand (<Roger.Bivand at nhh.no>)
escribi?:

> On Tue, 16 Feb 2021, Pedro Perez wrote:
>
> > Hello everybody!
> >
> > Sorry for the dumb question, I have very limited experience with regards
> to
> > spatial autocorrelation. I have a lot of spatial points for which I
> > measured both continuous and categorical variables. I need to calculate
> > *global* measures of spatial autocorrelation for both kinds of
> variables. I
> > know that this task is relatively easy for continuous ones, here an
> example
> > using the package elsa:
> >
> > rm(list = ls())
> > library(raster)
> > library(elsa)
> >
> > dta <- data.frame(Lon = (runif(60)*100),
> >                              Lat = (runif(60)*100),
> >                              Cat = sample(LETTERS[1:5], 60, replace = T),
> >                              Cont = (runif(60)*100))
> > coordinates(dta) <- ~Lon + Lat
> > # Moran's I global index:
> > moran(dta[,2], d1=0, d2=2000)
> > [1] -0.01694915 # The value varies given that seed was not set
> > # Geary's c global index:
> > geary(dta[,2], d1=0, d2=2000)
> > [1] 1
>
> set.seed(1)
> dta <- data.frame(Lon = (runif(60)*100),
>                                Lat = (runif(60)*100),
>                                Cat = sample(LETTERS[1:5], 60,
>                                             replace = TRUE),
>                                Cont = (runif(60)*100))
> coordinates(dta) <- ~Lon + Lat
> library(spdep)
> nb <- dnearneigh(dta, 0, 50) # 2000 was far too big, all neighbours of all
> moran.test(dta$Cont, nb2listw(nb, style="B"))$estimate[1]
> elsa::moran(dta[,2], d1=0, d2=50)
> geary.test(dta$Cont, nb2listw(nb, style="B"))$estimate[1]
> elsa::geary(dta[,2], d1=0, d2=50)
> joincount.multi(factor(dta$Cat), nb2listw(nb, style="B"))["Jtot",]
>
> Jtot summarises all the k-colour matches.
>
> Hope this clarifies,
>
> Roger
>
> >
> > That is, I need something like the moran or geary commands in the
> previous
> > example, but applicable to categorical covariates. I have been googleing
> > for a while, but I have not been able to find a solution. Any idea?
> >
> >
> > Thanks in advance!
> >
> >
> > Perep
> > ResponderReenviar
> >
> >       [[alternative HTML version deleted]]
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
>
> --
> Roger Bivand
> Department of Economics, Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
> https://orcid.org/0000-0003-2392-6140
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>

	[[alternative HTML version deleted]]


From |err|@|eber| @end|ng |rom gmx@@t  Sun Mar 28 15:47:11 2021
From: |err|@|eber| @end|ng |rom gmx@@t (Ferri Leberl)
Date: Sun, 28 Mar 2021 15:47:11 +0200
Subject: [R-sig-Geo] Shapes of the districts of Brandenburg
Message-ID: <trinity-35041aa2-31d5-4785-a670-45d9355889af-1616939231934@3c-app-gmx-bs43>

An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20210328/15ab7990/attachment.html>

From m@p|no|@10 @end|ng |rom gm@||@com  Wed Mar 31 17:55:13 2021
From: m@p|no|@10 @end|ng |rom gm@||@com (=?UTF-8?Q?Manuel_Sp=C3=ADnola?=)
Date: Wed, 31 Mar 2021 09:55:13 -0600
Subject: [R-sig-Geo] R crashes when reading geopackage files with st_read
 (sf package) in macOS
Message-ID: <CABkCotT4QgJSMvyAHVctLN+5qffEg-qxBrR1em+LRL5Ugh2mAg@mail.gmail.com>

Dear list members,

When reading geopackages files with st_read (sf package) RStudio crashes (R
session aborted) in macOS.  Any suggestions to fix this problem?

Should I ask this question to the macOS group (r-sig-mac)?

library(sf)
Linking to GEOS 3.9.0, GDAL 3.2.1, PROJ 7.2.1


library(spData)


world = st_read(system.file("shapes/world.gpkg", package = "spData"))




-- 
*Manuel Sp?nola, Ph.D.*
Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
Universidad Nacional
Apartado 1350-3000
Heredia
COSTA RICA
mspinola at una.cr <mspinola at una.ac.cr>
mspinola10 at gmail.com
Tel?fono: (506) 8706 - 4662
Personal website: Lobito de r?o <https://sites.google.com/site/lobitoderio/>
Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>

	[[alternative HTML version deleted]]


From Roger@B|v@nd @end|ng |rom nhh@no  Wed Mar 31 18:25:59 2021
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Wed, 31 Mar 2021 16:25:59 +0000
Subject: [R-sig-Geo] 
 R crashes when reading geopackage files with st_read
 (sf package) in macOS
In-Reply-To: <CABkCotT4QgJSMvyAHVctLN+5qffEg-qxBrR1em+LRL5Ugh2mAg@mail.gmail.com>
References: <CABkCotT4QgJSMvyAHVctLN+5qffEg-qxBrR1em+LRL5Ugh2mAg@mail.gmail.com>
Message-ID: <49318902c1c849ab968076e2fa26c755@nhh.no>

Please refer to the associated sf issue on github: https://github.com/r-spatial/sf/issues/1606 for completeness. Please confirm that you are not using the MacOS sf CRAN binary package, but have installed GDAL, PROJ and GEOS yourself. Please also confirm that you see the same error with every GPKG file. 

--
Roger Bivand
Norwegian School of Economics
Postboks 3490 Ytre Sandviken, 5045 Bergen, Norway
Roger.Bivand at nhh.no


________________________________________
Fra: R-sig-Geo <r-sig-geo-bounces at r-project.org> p? vegne av Manuel Sp?nola <mspinola10 at gmail.com>
Sendt: onsdag 31. mars 2021 17.55
Til: r-sig-geo
Emne: [R-sig-Geo] R crashes when reading geopackage files with st_read (sf package) in macOS

Dear list members,

When reading geopackages files with st_read (sf package) RStudio crashes (R
session aborted) in macOS.  Any suggestions to fix this problem?

Should I ask this question to the macOS group (r-sig-mac)?

library(sf)
Linking to GEOS 3.9.0, GDAL 3.2.1, PROJ 7.2.1


library(spData)


world = st_read(system.file("shapes/world.gpkg", package = "spData"))




--
*Manuel Sp?nola, Ph.D.*
Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
Universidad Nacional
Apartado 1350-3000
Heredia
COSTA RICA
mspinola at una.cr <mspinola at una.ac.cr>
mspinola10 at gmail.com
Tel?fono: (506) 8706 - 4662
Personal website: Lobito de r?o <https://sites.google.com/site/lobitoderio/>
Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>

        [[alternative HTML version deleted]]

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From Roger@B|v@nd @end|ng |rom nhh@no  Wed Mar 31 19:26:00 2021
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Wed, 31 Mar 2021 17:26:00 +0000
Subject: [R-sig-Geo] 
 R crashes when reading geopackage files with st_read
 (sf package) in macOS
In-Reply-To: <49318902c1c849ab968076e2fa26c755@nhh.no>
References: <CABkCotT4QgJSMvyAHVctLN+5qffEg-qxBrR1em+LRL5Ugh2mAg@mail.gmail.com>,
 <49318902c1c849ab968076e2fa26c755@nhh.no>
Message-ID: <c5e945f22b234051a64fcee033334e97@nhh.no>

Further, with R 4.0.4 on Rosetta but with CRAN binary packages, there is no problem. It is most likely that the problem is caused by user-installed upstream software components, and sf or rgdal installed from source, possibly with libsqlite3 also installed from source. Please report back if any other drivers fail - RSQLite does not use local binaries, but bundles the software library itself.

--
Roger Bivand
Norwegian School of Economics
Postboks 3490 Ytre Sandviken, 5045 Bergen, Norway
Roger.Bivand at nhh.no


________________________________________
Fra: R-sig-Geo <r-sig-geo-bounces at r-project.org> p? vegne av Roger Bivand <Roger.Bivand at nhh.no>
Sendt: onsdag 31. mars 2021 18.25
Til: Manuel Sp?nola; r-sig-geo
Emne: Re: [R-sig-Geo]  R crashes when reading geopackage files with st_read (sf package) in macOS

Please refer to the associated sf issue on github: https://github.com/r-spatial/sf/issues/1606 for completeness. Please confirm that you are not using the MacOS sf CRAN binary package, but have installed GDAL, PROJ and GEOS yourself. Please also confirm that you see the same error with every GPKG file.

--
Roger Bivand
Norwegian School of Economics
Postboks 3490 Ytre Sandviken, 5045 Bergen, Norway
Roger.Bivand at nhh.no


________________________________________
Fra: R-sig-Geo <r-sig-geo-bounces at r-project.org> p? vegne av Manuel Sp?nola <mspinola10 at gmail.com>
Sendt: onsdag 31. mars 2021 17.55
Til: r-sig-geo
Emne: [R-sig-Geo] R crashes when reading geopackage files with st_read (sf package) in macOS

Dear list members,

When reading geopackages files with st_read (sf package) RStudio crashes (R
session aborted) in macOS.  Any suggestions to fix this problem?

Should I ask this question to the macOS group (r-sig-mac)?

library(sf)
Linking to GEOS 3.9.0, GDAL 3.2.1, PROJ 7.2.1


library(spData)


world = st_read(system.file("shapes/world.gpkg", package = "spData"))




--
*Manuel Sp?nola, Ph.D.*
Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
Universidad Nacional
Apartado 1350-3000
Heredia
COSTA RICA
mspinola at una.cr <mspinola at una.ac.cr>
mspinola10 at gmail.com
Tel?fono: (506) 8706 - 4662
Personal website: Lobito de r?o <https://sites.google.com/site/lobitoderio/>
Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>

        [[alternative HTML version deleted]]

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From m@p|no|@10 @end|ng |rom gm@||@com  Wed Mar 31 20:48:30 2021
From: m@p|no|@10 @end|ng |rom gm@||@com (=?UTF-8?Q?Manuel_Sp=C3=ADnola?=)
Date: Wed, 31 Mar 2021 12:48:30 -0600
Subject: [R-sig-Geo] 
 R crashes when reading geopackage files with st_read
 (sf package) in macOS
In-Reply-To: <49318902c1c849ab968076e2fa26c755@nhh.no>
References: <CABkCotT4QgJSMvyAHVctLN+5qffEg-qxBrR1em+LRL5Ugh2mAg@mail.gmail.com>
 <49318902c1c849ab968076e2fa26c755@nhh.no>
Message-ID: <CABkCotS-mqwjvWdBCBKMwYB0gPRRqRc40H2scN=bAYWyF_1+cQ@mail.gmail.com>

Thank you very much Roger.

I reinstalled the sf and rgdal packages from binaries and the problem
persisted.

To install GDAL, PROJ and GEOS i followed the instructions in the sf github
site.

Yes, the problem is with several geopackages files.  I see the problem also
with st_write when working trying to save a file in geopackage format.

I can read the files without problem with readOGR.

Manuel

El mi?, 31 mar 2021 a las 10:26, Roger Bivand (<Roger.Bivand at nhh.no>)
escribi?:

> Please refer to the associated sf issue on github:
> https://github.com/r-spatial/sf/issues/1606 for completeness. Please
> confirm that you are not using the MacOS sf CRAN binary package, but have
> installed GDAL, PROJ and GEOS yourself. Please also confirm that you see
> the same error with every GPKG file.
>
> --
> Roger Bivand
> Norwegian School of Economics
> Postboks 3490 Ytre Sandviken, 5045 Bergen, Norway
> Roger.Bivand at nhh.no
>
>
> ________________________________________
> Fra: R-sig-Geo <r-sig-geo-bounces at r-project.org> p? vegne av Manuel
> Sp?nola <mspinola10 at gmail.com>
> Sendt: onsdag 31. mars 2021 17.55
> Til: r-sig-geo
> Emne: [R-sig-Geo] R crashes when reading geopackage files with st_read (sf
> package) in macOS
>
> Dear list members,
>
> When reading geopackages files with st_read (sf package) RStudio crashes (R
> session aborted) in macOS.  Any suggestions to fix this problem?
>
> Should I ask this question to the macOS group (r-sig-mac)?
>
> library(sf)
> Linking to GEOS 3.9.0, GDAL 3.2.1, PROJ 7.2.1
>
>
> library(spData)
>
>
> world = st_read(system.file("shapes/world.gpkg", package = "spData"))
>
>
>
>
> --
> *Manuel Sp?nola, Ph.D.*
> Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
> Universidad Nacional
> Apartado 1350-3000
> Heredia
> COSTA RICA
> mspinola at una.cr <mspinola at una.ac.cr>
> mspinola10 at gmail.com
> Tel?fono: (506) 8706 - 4662
> Personal website: Lobito de r?o <
> https://sites.google.com/site/lobitoderio/>
> Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


-- 
*Manuel Sp?nola, Ph.D.*
Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
Universidad Nacional
Apartado 1350-3000
Heredia
COSTA RICA
mspinola at una.cr <mspinola at una.ac.cr>
mspinola10 at gmail.com
Tel?fono: (506) 8706 - 4662
Personal website: Lobito de r?o <https://sites.google.com/site/lobitoderio/>
Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>

	[[alternative HTML version deleted]]


From Roger@B|v@nd @end|ng |rom nhh@no  Wed Mar 31 21:07:00 2021
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Wed, 31 Mar 2021 21:07:00 +0200
Subject: [R-sig-Geo] 
 R crashes when reading geopackage files with st_read
 (sf package) in macOS
In-Reply-To: <CABkCotS-mqwjvWdBCBKMwYB0gPRRqRc40H2scN=bAYWyF_1+cQ@mail.gmail.com>
References: <CABkCotT4QgJSMvyAHVctLN+5qffEg-qxBrR1em+LRL5Ugh2mAg@mail.gmail.com>
 <49318902c1c849ab968076e2fa26c755@nhh.no>
 <CABkCotS-mqwjvWdBCBKMwYB0gPRRqRc40H2scN=bAYWyF_1+cQ@mail.gmail.com>
Message-ID: <3437c0d-6676-f678-a399-be1bc8db7c0@reclus.nhh.no>

On Wed, 31 Mar 2021, Manuel Sp?nola wrote:

> Thank you very much Roger.
>
> I reinstalled the sf and rgdal packages from binaries and the problem
> persisted.

This must be either because you did not remove all of the traces of the 
previous attempts. If sf failed, then 
https://cran.r-project.org/web/checks/check_results_sf.html
would show errors for MacOS.

>
> To install GDAL, PROJ and GEOS i followed the instructions in the sf github
> site.

Please avoid installing the source package unless there is functionality 
not provided by the CRAN binary.

>
> Yes, the problem is with several geopackages files.  I see the problem also
> with st_write when working trying to save a file in geopackage format.
>

Which other drivers are affected - if only GPKG, then libsqlite3 is the 
most likely culprit. However, unless you must have facilities only 
available by source install, avoid source installs.

> I can read the files without problem with readOGR.
>

Installed as the CRAN binary or source?

Roger

> Manuel
>
> El mi?, 31 mar 2021 a las 10:26, Roger Bivand (<Roger.Bivand at nhh.no>)
> escribi?:
>
>> Please refer to the associated sf issue on github:
>> https://github.com/r-spatial/sf/issues/1606 for completeness. Please
>> confirm that you are not using the MacOS sf CRAN binary package, but have
>> installed GDAL, PROJ and GEOS yourself. Please also confirm that you see
>> the same error with every GPKG file.
>>
>> --
>> Roger Bivand
>> Norwegian School of Economics
>> Postboks 3490 Ytre Sandviken, 5045 Bergen, Norway
>> Roger.Bivand at nhh.no
>>
>>
>> ________________________________________
>> Fra: R-sig-Geo <r-sig-geo-bounces at r-project.org> p? vegne av Manuel
>> Sp?nola <mspinola10 at gmail.com>
>> Sendt: onsdag 31. mars 2021 17.55
>> Til: r-sig-geo
>> Emne: [R-sig-Geo] R crashes when reading geopackage files with st_read (sf
>> package) in macOS
>>
>> Dear list members,
>>
>> When reading geopackages files with st_read (sf package) RStudio crashes (R
>> session aborted) in macOS.  Any suggestions to fix this problem?
>>
>> Should I ask this question to the macOS group (r-sig-mac)?
>>
>> library(sf)
>> Linking to GEOS 3.9.0, GDAL 3.2.1, PROJ 7.2.1
>>
>>
>> library(spData)
>>
>>
>> world = st_read(system.file("shapes/world.gpkg", package = "spData"))
>>
>>
>>
>>
>> --
>> *Manuel Sp?nola, Ph.D.*
>> Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
>> Universidad Nacional
>> Apartado 1350-3000
>> Heredia
>> COSTA RICA
>> mspinola at una.cr <mspinola at una.ac.cr>
>> mspinola10 at gmail.com
>> Tel?fono: (506) 8706 - 4662
>> Personal website: Lobito de r?o <
>> https://sites.google.com/site/lobitoderio/>
>> Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Postboks 3490 Ytre Sandviken, 5045 Bergen, Norway.
e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

From m@p|no|@10 @end|ng |rom gm@||@com  Wed Mar 31 22:34:47 2021
From: m@p|no|@10 @end|ng |rom gm@||@com (=?UTF-8?Q?Manuel_Sp=C3=ADnola?=)
Date: Wed, 31 Mar 2021 14:34:47 -0600
Subject: [R-sig-Geo] 
 R crashes when reading geopackage files with st_read
 (sf package) in macOS
In-Reply-To: <3437c0d-6676-f678-a399-be1bc8db7c0@reclus.nhh.no>
References: <CABkCotT4QgJSMvyAHVctLN+5qffEg-qxBrR1em+LRL5Ugh2mAg@mail.gmail.com>
 <49318902c1c849ab968076e2fa26c755@nhh.no>
 <CABkCotS-mqwjvWdBCBKMwYB0gPRRqRc40H2scN=bAYWyF_1+cQ@mail.gmail.com>
 <3437c0d-6676-f678-a399-be1bc8db7c0@reclus.nhh.no>
Message-ID: <CABkCotTCZFgrU-tvj6c5Ss+mGzzsHZ625Jyu_QUP5TTURj7zKg@mail.gmail.com>

Thank you very much Roger.

I can read shapefile without any problem with st_read.

I think it works for both versions, but definitely is working with the
binary version.

How can I work around the problem with libsqlite3?

How can I install the GDAL, PROJ and GEOS without being from source?

Best,

Manuel


El mi?, 31 mar 2021 a las 13:07, Roger Bivand (<Roger.Bivand at nhh.no>)
escribi?:

> On Wed, 31 Mar 2021, Manuel Sp?nola wrote:
>
> > Thank you very much Roger.
> >
> > I reinstalled the sf and rgdal packages from binaries and the problem
> > persisted.
>
> This must be either because you did not remove all of the traces of the
> previous attempts. If sf failed, then
> https://cran.r-project.org/web/checks/check_results_sf.html
> would show errors for MacOS.
>
> >
> > To install GDAL, PROJ and GEOS i followed the instructions in the sf
> github
> > site.
>
> Please avoid installing the source package unless there is functionality
> not provided by the CRAN binary.
>
> >
> > Yes, the problem is with several geopackages files.  I see the problem
> also
> > with st_write when working trying to save a file in geopackage format.
> >
>
> Which other drivers are affected - if only GPKG, then libsqlite3 is the
> most likely culprit. However, unless you must have facilities only
> available by source install, avoid source installs.
>
> > I can read the files without problem with readOGR.
> >
>
> Installed as the CRAN binary or source?
>
> Roger
>
> > Manuel
> >
> > El mi?, 31 mar 2021 a las 10:26, Roger Bivand (<Roger.Bivand at nhh.no>)
> > escribi?:
> >
> >> Please refer to the associated sf issue on github:
> >> https://github.com/r-spatial/sf/issues/1606 for completeness. Please
> >> confirm that you are not using the MacOS sf CRAN binary package, but
> have
> >> installed GDAL, PROJ and GEOS yourself. Please also confirm that you see
> >> the same error with every GPKG file.
> >>
> >> --
> >> Roger Bivand
> >> Norwegian School of Economics
> >> Postboks 3490 Ytre Sandviken, 5045 Bergen, Norway
> >> Roger.Bivand at nhh.no
> >>
> >>
> >> ________________________________________
> >> Fra: R-sig-Geo <r-sig-geo-bounces at r-project.org> p? vegne av Manuel
> >> Sp?nola <mspinola10 at gmail.com>
> >> Sendt: onsdag 31. mars 2021 17.55
> >> Til: r-sig-geo
> >> Emne: [R-sig-Geo] R crashes when reading geopackage files with st_read
> (sf
> >> package) in macOS
> >>
> >> Dear list members,
> >>
> >> When reading geopackages files with st_read (sf package) RStudio
> crashes (R
> >> session aborted) in macOS.  Any suggestions to fix this problem?
> >>
> >> Should I ask this question to the macOS group (r-sig-mac)?
> >>
> >> library(sf)
> >> Linking to GEOS 3.9.0, GDAL 3.2.1, PROJ 7.2.1
> >>
> >>
> >> library(spData)
> >>
> >>
> >> world = st_read(system.file("shapes/world.gpkg", package = "spData"))
> >>
> >>
> >>
> >>
> >> --
> >> *Manuel Sp?nola, Ph.D.*
> >> Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
> >> Universidad Nacional
> >> Apartado 1350-3000
> >> Heredia
> >> COSTA RICA
> >> mspinola at una.cr <mspinola at una.ac.cr>
> >> mspinola10 at gmail.com
> >> Tel?fono: (506) 8706 - 4662
> >> Personal website: Lobito de r?o <
> >> https://sites.google.com/site/lobitoderio/>
> >> Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>
> >>
> >>         [[alternative HTML version deleted]]
> >>
> >> _______________________________________________
> >> R-sig-Geo mailing list
> >> R-sig-Geo at r-project.org
> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >>
> >
> >
> >
>
> --
> Roger Bivand
> Department of Economics, Norwegian School of Economics,
> Postboks 3490 Ytre Sandviken, 5045 Bergen, Norway.
> e-mail: Roger.Bivand at nhh.no
> https://orcid.org/0000-0003-2392-6140
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en



-- 
*Manuel Sp?nola, Ph.D.*
Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
Universidad Nacional
Apartado 1350-3000
Heredia
COSTA RICA
mspinola at una.cr <mspinola at una.ac.cr>
mspinola10 at gmail.com
Tel?fono: (506) 8706 - 4662
Personal website: Lobito de r?o <https://sites.google.com/site/lobitoderio/>
Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>

	[[alternative HTML version deleted]]


