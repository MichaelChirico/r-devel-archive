From rvaldezr at gmail.com  Tue Jul  1 00:16:27 2014
From: rvaldezr at gmail.com (Rolando Valdez)
Date: Mon, 30 Jun 2014 17:16:27 -0500
Subject: [R-sig-Geo] Assign coordinates to zip address
In-Reply-To: <5573751744pavia@uv.es>
References: <106471BD-9EE8-4837-A0AB-8C85DEED3234@gmail.com>
	<5573751744pavia@uv.es>
Message-ID: <038E5F5E-179E-4894-8609-04ABBA1AF94A@gmail.com>

Thank you, I?ll try.

El 30/06/2014, a las 14:25, Jose M. Pavia <Jose.M.Pavia at uv.es> escribi?:

> Ronaldo, maybe you can ask to the local authorities of the urban area 
> for a file that contains the coordinates for each postal address in 
> the area. I made it in the past for research purposes in my city and 
> they provide me the file for free. 
> Other way, maybe you can create (or ask someome to do it) some kind 
> of robot to consult postal addresses in google maps that can collect 
> and save the coordinates for you . 
> 
> best regards
> jm
> 
> 
>> Hi,
>> 
>> The zipcode package provides coordinates by zip code in the U.S. 
> The problem is, the information is not from the U.S., and I don?t 
> need the coordinates by zip code, I have some surveys with the same 
> zip code but different street name and number, as I said, I need the 
> coordinate by survey.
>> 
>> Thank you anyway,
>> 
>> El 30/06/2014, a las 12:20, Frede Aakmann T?gersen 
> <frtog at vestas.com> escribi?:
>> 
>>> Perhaps Google is your friend. Google for:
>>> 
>>> r zip code to location
>>> 
>>> Br. Frede
>>> 
>>> 
>>> Sendt fra Samsung mobil
>>> 
>>> 
>>> -------- Oprindelig meddelelse --------
>>> Fra: Rolando Valdez 
>>> Dato:30/06/2014 19.04 (GMT+01:00) 
>>> Til: r-sig-geo at r-project.org 
>>> Emne: [R-sig-Geo] Assign coordinates to zip address 
>>> 
>>> Hi everyone,
>>> 
>>> Is possible assign coordinates to zip address? I?m not sure if it 
> is possible and how could I do it. I have a lot of surveys from a 
> specific urban area and the zip address by survey.
>>> 
>>> Thank you in advance
>>> 
>>> Rolando Valdez
>>> 
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> 
>> Rolando Valdez
>> 
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> 
>> 
> 
> 
> --
> Jose M. Pavia
> Quantitative Methods' Professor
> Universitat de Valencia
> Av Tarongers, s/n
> 46022 Valencia, Spain
> Phone: +34 963 828 404
> Fax: +34 963 828 415
> e-mail: pavia at uv.es
> 
> 
> 

Rolando Valdez


From Roger.Bivand at nhh.no  Tue Jul  1 00:56:31 2014
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 1 Jul 2014 00:56:31 +0200
Subject: [R-sig-Geo] Conversion geographical coodinate in UTM
In-Reply-To: <CANVKczOBUWZJE897Ax63cOYKhq9S3CE0+cV_WTQ+OLRVi=wSwQ@mail.gmail.com>
References: <CANVKczNb30-SU6RrajTaz4jCvoQwM1KCUk=xts5cEyGf6iNKtg@mail.gmail.com>
	<5a3e20375d5b4b30bb2c16ae8547256a@EX-1-HT0.lancs.local>
	<CANVKczOBUWZJE897Ax63cOYKhq9S3CE0+cV_WTQ+OLRVi=wSwQ@mail.gmail.com>
Message-ID: <alpine.LRH.2.03.1407010054140.15217@reclus.nhh.no>

On Mon, 30 Jun 2014, Barry Rowlingson wrote:

> Not your fault that readShapeSpatial ignores the projection!
>
> I think Roger recently spoke about fixing these things...

The underlying shapelib code will not be maintained, anmd 
maptools::readShape* will be deprecated very soon. Always use 
rgdal::readOGR() for reading shapefiles - it reads thje *.prj file. the 
maptools functions cannot do so. The fix is to make maptools::readShape* 
defunct.

Roger

>
> Barry
>
>
>
> On Mon, Jun 30, 2014 at 4:33 PM, Gilles Benjamin Leduc <gbl1 at hi.is> wrote:
>> Thanks Barry,
>>
>> That's it? Sorry if my question was too simple? I'm not a geograph, I'm a molecular biologist? so I'm not used to these packages ? I started from the simple script I had for normal maps? (and it is monday, brain isn't fully operational!)
>>
>> Benjamin
>>
>>
>>
>>
>> Le Lundi 30 Juin 2014 15:12 GMT, Barry Rowlingson <b.rowlingson at lancaster.ac.uk> a ?crit:
>>
>>> On Mon, Jun 30, 2014 at 3:18 PM, Sarah Goslee <sarah.goslee at gmail.com> wrote:
>>> > Hi,
>>> >
>>> > At a guess, your Front dataset doesn't have a CRS set, so
>>>
>>> Probably because you've used readShapeSpatial which ignores projection
>>> info from shapefiles...
>>>
>>> >> Front<-readShapeSpatial("ISL_adm0.shp")
>>> >> class(Front)
>>> >> [1] "SpatialPolygonsDataFrame"
>>>
>>> Use rgdal:
>>>
>>> require(rgdal)
>>> Front = readOGR(".","ISL_adm0")
>>>
>>> then check Front has a proj4string. summary(Front) should mention it.
>>>
>>> This is getting to be the R-sig-geo equivalent of R FAQ 7.31..
>>>
>>> Barry
>>
>>
>>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no

From Dominik.Schneider at colorado.edu  Tue Jul  1 05:57:46 2014
From: Dominik.Schneider at colorado.edu (Dominik Schneider)
Date: Mon, 30 Jun 2014 21:57:46 -0600
Subject: [R-sig-Geo] too many raster files open?
Message-ID: <CAHYDKLYyjH6xt0GAJAu04PspEnsTRDbHy8x0h6HHPXbXsicH-g@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140630/5118d55b/attachment.pl>

From gbl1 at hi.is  Tue Jul  1 12:18:54 2014
From: gbl1 at hi.is (Gilles Benjamin Leduc)
Date: Tue, 01 Jul 2014 10:18:54 +0000
Subject: [R-sig-Geo] Conversion geographical coodinate in UTM
In-Reply-To: <CANVKczOBUWZJE897Ax63cOYKhq9S3CE0+cV_WTQ+OLRVi=wSwQ@mail.gmail.com>
Message-ID: <47ad-53b28b00-67-15638a00@185684448>

Dear R FAQ Team :p 

So I have been able to use the readOGR function, could anyone transfer to its maintainer a request to add writeOGR in the "see also" section of help?  
 
Anyway, after having done that for my shapefile, I tried to deal with the points I had to plot on, here is what I tried: 
> uniqueGPS(datgps)
       lat    lon
B-40 64.76 -21.59
D-01 66.01 -16.50
E-01 65.32 -14.36
G-04 64.43 -14.90
H-03 64.03 -16.98
M-02 66.10 -22.39
> SpatialPoints(uniqueGPS(datgps))
SpatialPoints:
       lat    lon
[1,] 64.76 -21.59
[2,] 66.01 -16.50
[3,] 65.32 -14.36
[4,] 64.43 -14.90
[5,] 64.03 -16.98
[6,] 66.10 -22.39
Coordinate Reference System (CRS) arguments: NA 
> SpatialPoints(uniqueGPS(datgps))->position
>  positionUTM <- spTransform(position, CRS("+proj=utm +zone=28 +north +datum=WGS84"))
Erreur dans spTransform(position, CRS("+proj=utm +zone=28 +north +datum=WGS84")) : 
  No transformation possible from NA reference system
> 

What have I missed? 

Benjamin 
 
Le Lundi 30 Juin 2014 16:19 GMT, Barry Rowlingson <b.rowlingson at lancaster.ac.uk> a ?crit: 
 
> Not your fault that readShapeSpatial ignores the projection!
> 
> I think Roger recently spoke about fixing these things...
> 
> Barry
> 
> 
> 
> On Mon, Jun 30, 2014 at 4:33 PM, Gilles Benjamin Leduc <gbl1 at hi.is> wrote:
> > Thanks Barry,
> >
> > That's it? Sorry if my question was too simple? I'm not a geograph, I'm a molecular biologist? so I'm not used to these packages ? I started from the simple script I had for normal maps? (and it is monday, brain isn't fully operational!)
> >
> > Benjamin
> >
> >
> >
> >
> > Le Lundi 30 Juin 2014 15:12 GMT, Barry Rowlingson <b.rowlingson at lancaster.ac.uk> a ?crit:
> >
> >> On Mon, Jun 30, 2014 at 3:18 PM, Sarah Goslee <sarah.goslee at gmail.com> wrote:
> >> > Hi,
> >> >
> >> > At a guess, your Front dataset doesn't have a CRS set, so
> >>
> >> Probably because you've used readShapeSpatial which ignores projection
> >> info from shapefiles...
> >>
> >> >> Front<-readShapeSpatial("ISL_adm0.shp")
> >> >> class(Front)
> >> >> [1] "SpatialPolygonsDataFrame"
> >>
> >> Use rgdal:
> >>
> >> require(rgdal)
> >> Front = readOGR(".","ISL_adm0")
> >>
> >> then check Front has a proj4string. summary(Front) should mention it.
> >>
> >> This is getting to be the R-sig-geo equivalent of R FAQ 7.31..
> >>
> >> Barry
> >
> >
> >


From spencer.graves at prodsyse.com  Tue Jul  1 20:29:15 2014
From: spencer.graves at prodsyse.com (Spencer Graves)
Date: Tue, 01 Jul 2014 11:29:15 -0700
Subject: [R-sig-Geo] maps showing post-Soviet states?
Message-ID: <53B2FDFB.7080509@prodsyse.com>

       What would you suggest I do to create a world map highlighting 
Taiwan and post-Soviet states like Azerbaijan, Uzbekistan, Tajikistan, 
Turkmenistan, and Croatia?


       The region argument in maps::map won't recognize any of these, 
and my literature search identified hundreds of packages with some 
spatial / geographical / mapping content.


       Thanks,
       Spencer Graves


From 538280 at gmail.com  Tue Jul  1 23:07:11 2014
From: 538280 at gmail.com (Greg Snow)
Date: Tue, 1 Jul 2014 15:07:11 -0600
Subject: [R-sig-Geo] maps showing post-Soviet states?
In-Reply-To: <53B2FDFB.7080509@prodsyse.com>
References: <53B2FDFB.7080509@prodsyse.com>
Message-ID: <CAFEqCdxQQmV0BWe9ibSGq1mMcOC=TE+hqYETREaXLNoBztOhtg@mail.gmail.com>

The combination of the sp and maptools packages will read in
shapefiles and plot them, you just need to find a shapefile that has
the countries that you are interested in (google for shape files,
there are a lot of free ones available, I have not checked for the
countries you specified, but I expect there are some available).



On Tue, Jul 1, 2014 at 12:29 PM, Spencer Graves
<spencer.graves at prodsyse.com> wrote:
>       What would you suggest I do to create a world map highlighting Taiwan
> and post-Soviet states like Azerbaijan, Uzbekistan, Tajikistan,
> Turkmenistan, and Croatia?
>
>
>       The region argument in maps::map won't recognize any of these, and my
> literature search identified hundreds of packages with some spatial /
> geographical / mapping content.
>
>
>       Thanks,
>       Spencer Graves
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



-- 
Gregory (Greg) L. Snow Ph.D.
538280 at gmail.com


From tea3rd at gmail.com  Tue Jul  1 23:56:20 2014
From: tea3rd at gmail.com (Thomas Adams)
Date: Tue, 1 Jul 2014 17:56:20 -0400
Subject: [R-sig-Geo] maps showing post-Soviet states?
In-Reply-To: <53B2FDFB.7080509@prodsyse.com>
References: <53B2FDFB.7080509@prodsyse.com>
Message-ID: <CAGxgkWg3JfijgTOq95T4ZLceKMQdCQ1qFKW5VqRkHwy53vxb4A@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140701/f2f3d137/attachment.pl>

From mdsumner at gmail.com  Wed Jul  2 01:09:26 2014
From: mdsumner at gmail.com (Michael Sumner)
Date: Wed, 2 Jul 2014 09:09:26 +1000
Subject: [R-sig-Geo] maps showing post-Soviet states?
In-Reply-To: <CAGxgkWg3JfijgTOq95T4ZLceKMQdCQ1qFKW5VqRkHwy53vxb4A@mail.gmail.com>
References: <53B2FDFB.7080509@prodsyse.com>
	<CAGxgkWg3JfijgTOq95T4ZLceKMQdCQ1qFKW5VqRkHwy53vxb4A@mail.gmail.com>
Message-ID: <CAAcGz98bCG2aDrp7Npy7nVcJzJLLSm5YtrtQrfD=BoxWnqsAuA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140702/1e7f13bf/attachment.pl>

From mdsumner at gmail.com  Wed Jul  2 01:38:20 2014
From: mdsumner at gmail.com (Michael Sumner)
Date: Wed, 2 Jul 2014 09:38:20 +1000
Subject: [R-sig-Geo] maps showing post-Soviet states?
In-Reply-To: <CAAcGz98bCG2aDrp7Npy7nVcJzJLLSm5YtrtQrfD=BoxWnqsAuA@mail.gmail.com>
References: <53B2FDFB.7080509@prodsyse.com>
	<CAGxgkWg3JfijgTOq95T4ZLceKMQdCQ1qFKW5VqRkHwy53vxb4A@mail.gmail.com>
	<CAAcGz98bCG2aDrp7Npy7nVcJzJLLSm5YtrtQrfD=BoxWnqsAuA@mail.gmail.com>
Message-ID: <CAAcGz99AaPeXFVjdrco0TcbZP=4eBtG_ggVBjT3hW6JsmKjUjQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140702/5580d928/attachment.pl>

From spencer.graves at prodsyse.com  Wed Jul  2 02:57:41 2014
From: spencer.graves at prodsyse.com (Spencer Graves)
Date: Tue, 01 Jul 2014 17:57:41 -0700
Subject: [R-sig-Geo] maps showing post-Soviet states?
In-Reply-To: <CAAcGz99AaPeXFVjdrco0TcbZP=4eBtG_ggVBjT3hW6JsmKjUjQ@mail.gmail.com>
References: <53B2FDFB.7080509@prodsyse.com>	<CAGxgkWg3JfijgTOq95T4ZLceKMQdCQ1qFKW5VqRkHwy53vxb4A@mail.gmail.com>	<CAAcGz98bCG2aDrp7Npy7nVcJzJLLSm5YtrtQrfD=BoxWnqsAuA@mail.gmail.com>
	<CAAcGz99AaPeXFVjdrco0TcbZP=4eBtG_ggVBjT3hW6JsmKjUjQ@mail.gmail.com>
Message-ID: <53B35905.9030105@prodsyse.com>

       Thanks to Gilles Leduc, Greg Snow, Thomas Adams, Barry 
Rowlingson, and Michael Sumner for their replies.  For the archives, in 
case someone else might find this in the archives, I will record here 
two solutions to my problem.


       1.  Michael's reply was the simplest, especially since it worked 
with "map" adding "add=TRUE" and "col" to the plot:

map(xlim=c(10, 90), ylim=c(30, 60))
library(raster)
ct <- getData("countries")
plot(subset(ct, NAME %in% c("Azerbaijan", "Uzbekistan", "Tajikistan",
                             "Turkmenistan", "Croatia")),
             add=TRUE, col='red')


       2.  Before I saw Michael's reply, I had solved the problem with 
much greater effort:  (1) I downloaded a zip file for each country from 
"www.diva-gis.org/datadown", as suggested by Gilles. (2) Unzipping 
produced folders with names like "..\TWN_adm" and files with names 
beginning "TWN_adm0", "TWN_adm1", and "TWN_adm2" and extensions bdf, 
prj, sbn, sbx, shp, and shx.  I could then get what I wanted with code 
like the following:


Taiwan0 <- readShapeSpatial("..\TWN_adm0")
map(xlim=c(100, 150), ylim=c(10, 30))
plot(Taiwan0, add=TRUE, col='blue', lwd=3, fill=FALSE)


       Again, thanks for the replies.


On 7/1/2014 4:38 PM, Michael Sumner wrote:
> An example:
>
> library(raster)
> ct <- getData("countries")
> plot(subset(ct, NAME %in% c("Azerbaijan", "Uzbekistan", "Tajikistan",
> "Turkmenistan", "Croatia"))
>
>
>
>
> On Wed, Jul 2, 2014 at 9:09 AM, Michael Sumner <mdsumner at gmail.com> wrote:
>
>>
>> On Wed, Jul 2, 2014 at 7:56 AM, Thomas Adams <tea3rd at gmail.com> wrote:
>>
>>> Spencer,
>>>
>>> Maybe I'm not sure what you're asking but here
>>> http://www.gadm.org/version1
>>> are current shapefiles by country. The highlighting (selection) canals  be
>>> done in GRASS GIS, QGIS, GMT
>>>
>>>
>>   raster::getData can read this. See here http://www.gadm.org/ and
>>
>> library(raster)
>> ?getData
>>
>>
>>
>>
>>
>>
>>> Tom
>>>
>>>
>>> On Tue, Jul 1, 2014 at 2:29 PM, Spencer Graves <
>>> spencer.graves at prodsyse.com>
>>> wrote:
>>>
>>>>        What would you suggest I do to create a world map highlighting
>>>> Taiwan and post-Soviet states like Azerbaijan, Uzbekistan, Tajikistan,
>>>> Turkmenistan, and Croatia?
>>>>
>>>>
>>>>        The region argument in maps::map won't recognize any of these, and
>>>> my literature search identified hundreds of packages with some spatial /
>>>> geographical / mapping content.
>>>>
>>>>
>>>>        Thanks,
>>>>        Spencer Graves
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at r-project.org
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>
>>> --
>>> Michael Sumner
>>> Software and Database Engineer
>>> Australian Antarctic Division
>>> Hobart, Australia
>>> e-mail: mdsumner at gmail.com


From spencer.graves at prodsyse.com  Wed Jul  2 05:54:00 2014
From: spencer.graves at prodsyse.com (Spencer Graves)
Date: Tue, 01 Jul 2014 20:54:00 -0700
Subject: [R-sig-Geo] line color in plot(SpatialPolygonsDataFrame) [was: maps
 showing post-Soviet states?]
In-Reply-To: <CAAcGz99AaPeXFVjdrco0TcbZP=4eBtG_ggVBjT3hW6JsmKjUjQ@mail.gmail.com>
References: <53B2FDFB.7080509@prodsyse.com>	<CAGxgkWg3JfijgTOq95T4ZLceKMQdCQ1qFKW5VqRkHwy53vxb4A@mail.gmail.com>	<CAAcGz98bCG2aDrp7Npy7nVcJzJLLSm5YtrtQrfD=BoxWnqsAuA@mail.gmail.com>
	<CAAcGz99AaPeXFVjdrco0TcbZP=4eBtG_ggVBjT3hW6JsmKjUjQ@mail.gmail.com>
Message-ID: <53B38258.3040807@prodsyse.com>

	  How can one control the color of lines with 
plot(SpatialPolygonsDataFrame)?


	  Adding lwd=9 to the arguments for plot produces black borders so wide 
most of the red disappears:


map(xlim=c(10, 90), ylim=c(30, 60))
library(raster)
ct <- getData("countries")
plot(subset(ct, NAME %in% c("Azerbaijan", "Uzbekistan", "Tajikistan",
                             "Turkmenistan", "Croatia")),
             add=TRUE, col='red', lwd=9)


	  A related question is how can I see the plot function used here? 
Methods dispatch does not take this to plot.default nor to 
plot.SpatialPolygonsDataFrame, as it would with an S3 method.


	  Thanks,
	  Spencer


#########################
       Thanks to Gilles Leduc, Greg Snow, Thomas Adams, Barry 
Rowlingson, and Michael Sumner for their replies.  For the archives, in 
case someone else might find this in the archives, I will record here 
two solutions to my problem.


       1.  Michael's reply was the simplest, especially since it worked 
with "map" adding "add=TRUE" and "col" to the plot:

map(xlim=c(10, 90), ylim=c(30, 60))
library(raster)
ct <- getData("countries")
plot(subset(ct, NAME %in% c("Azerbaijan", "Uzbekistan", "Tajikistan",
                             "Turkmenistan", "Croatia")),
             add=TRUE, col='red')


       2.  Before I saw Michael's reply, I had solved the problem with 
much greater effort:  (1) I downloaded a zip file for each country from 
"www.diva-gis.org/datadown", as suggested by Gilles. (2) Unzipping 
produced folders with names like "..\TWN_adm" and files with names 
beginning "TWN_adm0", "TWN_adm1", and "TWN_adm2" and extensions bdf, 
prj, sbn, sbx, shp, and shx.  I could then get what I wanted with code 
like the following:


Taiwan0 <- readShapeSpatial("..\TWN_adm0")
map(xlim=c(100, 150), ylim=c(10, 30))
plot(Taiwan0, add=TRUE, col='blue', lwd=3, fill=FALSE)


       Again, thanks for the replies.


On 7/1/2014 4:38 PM, Michael Sumner wrote:
> An example:
>
> library(raster)
> ct <- getData("countries")
> plot(subset(ct, NAME %in% c("Azerbaijan", "Uzbekistan", "Tajikistan",
> "Turkmenistan", "Croatia"))
>
>
>
>
> On Wed, Jul 2, 2014 at 9:09 AM, Michael Sumner <mdsumner at gmail.com> wrote:
>
>>
>> On Wed, Jul 2, 2014 at 7:56 AM, Thomas Adams <tea3rd at gmail.com> wrote:
>>
>>> Spencer,
>>>
>>> Maybe I'm not sure what you're asking but here
>>> http://www.gadm.org/version1
>>> are current shapefiles by country. The highlighting (selection) canals  be
>>> done in GRASS GIS, QGIS, GMT
>>>
>>>
>>   raster::getData can read this. See here http://www.gadm.org/ and
>>
>> library(raster)
>> ?getData
>>
>>
>>
>>
>>
>>
>>> Tom
>>>
>>>
>>> On Tue, Jul 1, 2014 at 2:29 PM, Spencer Graves <
>>> spencer.graves at prodsyse.com>
>>> wrote:
>>>
>>>>        What would you suggest I do to create a world map highlighting
>>>> Taiwan and post-Soviet states like Azerbaijan, Uzbekistan, Tajikistan,
>>>> Turkmenistan, and Croatia?
>>>>
>>>>
>>>>        The region argument in maps::map won't recognize any of these, and
>>>> my literature search identified hundreds of packages with some spatial /
>>>> geographical / mapping content.
>>>>
>>>>
>>>>        Thanks,
>>>>        Spencer Graves
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at r-project.org
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>
>>> --
>>> Michael Sumner
>>> Software and Database Engineer
>>> Australian Antarctic Division
>>> Hobart, Australia
>>> e-mail: mdsumner at gmail.com


From mdsumner at gmail.com  Wed Jul  2 06:11:54 2014
From: mdsumner at gmail.com (Michael Sumner)
Date: Wed, 2 Jul 2014 14:11:54 +1000
Subject: [R-sig-Geo] line color in plot(SpatialPolygonsDataFrame) [was:
 maps showing post-Soviet states?]
In-Reply-To: <53B38258.3040807@prodsyse.com>
References: <53B2FDFB.7080509@prodsyse.com>
	<CAGxgkWg3JfijgTOq95T4ZLceKMQdCQ1qFKW5VqRkHwy53vxb4A@mail.gmail.com>
	<CAAcGz98bCG2aDrp7Npy7nVcJzJLLSm5YtrtQrfD=BoxWnqsAuA@mail.gmail.com>
	<CAAcGz99AaPeXFVjdrco0TcbZP=4eBtG_ggVBjT3hW6JsmKjUjQ@mail.gmail.com>
	<53B38258.3040807@prodsyse.com>
Message-ID: <CAAcGz9-Wftu8-taT5GX2XceQDZ=je96s03-T6rFsOnOwMJCk8g@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140702/72c9c24c/attachment.pl>

From Roger.Bivand at nhh.no  Wed Jul  2 09:53:04 2014
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 2 Jul 2014 09:53:04 +0200
Subject: [R-sig-Geo] line color in plot(SpatialPolygonsDataFrame) [was:
 maps showing post-Soviet states?]
In-Reply-To: <53B38258.3040807@prodsyse.com>
References: <53B2FDFB.7080509@prodsyse.com>
	<CAGxgkWg3JfijgTOq95T4ZLceKMQdCQ1qFKW5VqRkHwy53vxb4A@mail.gmail.com>
	<CAAcGz98bCG2aDrp7Npy7nVcJzJLLSm5YtrtQrfD=BoxWnqsAuA@mail.gmail.com>
	<CAAcGz99AaPeXFVjdrco0TcbZP=4eBtG_ggVBjT3hW6JsmKjUjQ@mail.gmail.com>
	<53B38258.3040807@prodsyse.com>
Message-ID: <alpine.LRH.2.03.1407020952130.20782@reclus.nhh.no>

As with polygon, use the border= argument.

Roger

On Wed, 2 Jul 2014, Spencer Graves wrote:

> 	  How can one control the color of lines with 
> plot(SpatialPolygonsDataFrame)?
>
>
> 	  Adding lwd=9 to the arguments for plot produces black borders so 
> wide most of the red disappears:
>
>
> map(xlim=c(10, 90), ylim=c(30, 60))
> library(raster)
> ct <- getData("countries")
> plot(subset(ct, NAME %in% c("Azerbaijan", "Uzbekistan", "Tajikistan",
>                            "Turkmenistan", "Croatia")),
>            add=TRUE, col='red', lwd=9)
>
>
> 	  A related question is how can I see the plot function used here? 
> Methods dispatch does not take this to plot.default nor to 
> plot.SpatialPolygonsDataFrame, as it would with an S3 method.
>
>
> 	  Thanks,
> 	  Spencer
>
>
> #########################
>      Thanks to Gilles Leduc, Greg Snow, Thomas Adams, Barry Rowlingson, and 
> Michael Sumner for their replies.  For the archives, in case someone else 
> might find this in the archives, I will record here two solutions to my 
> problem.
>
>
>      1.  Michael's reply was the simplest, especially since it worked with 
> "map" adding "add=TRUE" and "col" to the plot:
>
> map(xlim=c(10, 90), ylim=c(30, 60))
> library(raster)
> ct <- getData("countries")
> plot(subset(ct, NAME %in% c("Azerbaijan", "Uzbekistan", "Tajikistan",
>                            "Turkmenistan", "Croatia")),
>            add=TRUE, col='red')
>
>
>      2.  Before I saw Michael's reply, I had solved the problem with much 
> greater effort:  (1) I downloaded a zip file for each country from 
> "www.diva-gis.org/datadown", as suggested by Gilles. (2) Unzipping produced 
> folders with names like "..\TWN_adm" and files with names beginning 
> "TWN_adm0", "TWN_adm1", and "TWN_adm2" and extensions bdf, prj, sbn, sbx, 
> shp, and shx.  I could then get what I wanted with code like the following:
>
>
> Taiwan0 <- readShapeSpatial("..\TWN_adm0")
> map(xlim=c(100, 150), ylim=c(10, 30))
> plot(Taiwan0, add=TRUE, col='blue', lwd=3, fill=FALSE)
>
>
>      Again, thanks for the replies.
>
>
> On 7/1/2014 4:38 PM, Michael Sumner wrote:
>> An example:
>> 
>> library(raster)
>> ct <- getData("countries")
>> plot(subset(ct, NAME %in% c("Azerbaijan", "Uzbekistan", "Tajikistan",
>> "Turkmenistan", "Croatia"))
>> 
>> 
>> 
>> 
>> On Wed, Jul 2, 2014 at 9:09 AM, Michael Sumner <mdsumner at gmail.com> wrote:
>> 
>>> 
>>> On Wed, Jul 2, 2014 at 7:56 AM, Thomas Adams <tea3rd at gmail.com> wrote:
>>> 
>>>> Spencer,
>>>> 
>>>> Maybe I'm not sure what you're asking but here
>>>> http://www.gadm.org/version1
>>>> are current shapefiles by country. The highlighting (selection) canals 
>>>> be
>>>> done in GRASS GIS, QGIS, GMT
>>>> 
>>>>
>>>   raster::getData can read this. See here http://www.gadm.org/ and
>>> 
>>> library(raster)
>>> ?getData
>>> 
>>> 
>>> 
>>> 
>>> 
>>> 
>>>> Tom
>>>> 
>>>> 
>>>> On Tue, Jul 1, 2014 at 2:29 PM, Spencer Graves <
>>>> spencer.graves at prodsyse.com>
>>>> wrote:
>>>>
>>>>>        What would you suggest I do to create a world map highlighting
>>>>> Taiwan and post-Soviet states like Azerbaijan, Uzbekistan, Tajikistan,
>>>>> Turkmenistan, and Croatia?
>>>>> 
>>>>>
>>>>>        The region argument in maps::map won't recognize any of these, 
>>>>> and
>>>>> my literature search identified hundreds of packages with some spatial /
>>>>> geographical / mapping content.
>>>>> 
>>>>>
>>>>>        Thanks,
>>>>>        Spencer Graves
>>>>> 
>>>>> _______________________________________________
>>>>> R-sig-Geo mailing list
>>>>> R-sig-Geo at r-project.org
>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>> 
>>>> 
>>>> --
>>>> Michael Sumner
>>>> Software and Database Engineer
>>>> Australian Antarctic Division
>>>> Hobart, Australia
>>>> e-mail: mdsumner at gmail.com
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no


From julleeyaw at yahoo.ca  Wed Jul  2 14:37:11 2014
From: julleeyaw at yahoo.ca (Julie Lee-Yaw)
Date: Wed, 2 Jul 2014 05:37:11 -0700
Subject: [R-sig-Geo] Help mosiacing rasters OR replacing NA values in one
	raster based on cell coordinates
Message-ID: <1404304631.91596.YahooMailNeo@web142504.mail.bf1.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140702/51b4c513/attachment.pl>

From spencer.graves at prodsyse.com  Wed Jul  2 17:11:12 2014
From: spencer.graves at prodsyse.com (Spencer Graves)
Date: Wed, 02 Jul 2014 08:11:12 -0700
Subject: [R-sig-Geo] line color in plot(SpatialPolygonsDataFrame) [was:
 maps showing post-Soviet states?]
In-Reply-To: <CAAcGz9-Wftu8-taT5GX2XceQDZ=je96s03-T6rFsOnOwMJCk8g@mail.gmail.com>
References: <53B2FDFB.7080509@prodsyse.com>	<CAGxgkWg3JfijgTOq95T4ZLceKMQdCQ1qFKW5VqRkHwy53vxb4A@mail.gmail.com>	<CAAcGz98bCG2aDrp7Npy7nVcJzJLLSm5YtrtQrfD=BoxWnqsAuA@mail.gmail.com>	<CAAcGz99AaPeXFVjdrco0TcbZP=4eBtG_ggVBjT3hW6JsmKjUjQ@mail.gmail.com>	<53B38258.3040807@prodsyse.com>
	<CAAcGz9-Wftu8-taT5GX2XceQDZ=je96s03-T6rFsOnOwMJCk8g@mail.gmail.com>
Message-ID: <53B42110.9070201@prodsyse.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140702/ddb42bcd/attachment.pl>

From jgrn at illinois.edu  Thu Jul  3 00:51:05 2014
From: jgrn at illinois.edu (Jonathan Greenberg)
Date: Wed, 2 Jul 2014 17:51:05 -0500
Subject: [R-sig-Geo] spatial.tools 1.4.8 now on CRAN
Message-ID: <CABG0rfvNJWp9+RJZer4nVTFEwJh+C75hOdYXgqN-g9GiJYof=A@mail.gmail.com>

Folks:

I released a new version of spatial.tools on CRAN (it should be making
its rounds via update.packages() in the next 24 hours).  In addition
to the requisite bug squashing, here are some the major new
features/functions:

rasterEngine/focal_hpc:
- new parameter: "datatype" -- will now output files using a
user-specific datatype (e.g. you can now select integer outputs
instead of being forced to use floating point).  Check ?dataType in
the raster package for a list of possible datatypes.
- new parameter: "clearworkers" (TRUE by default) -- once rasterEngine
is complete, it will now "flush" any parallel workers registered with
foreach (recovering memory).  If you have any issues with this
function, disable it by setting to FALSE and please let me know!
- Useful bug fix: you should get an ENVI header corresponding to the
output file before rasterEngine begins its main processing run, so you
can monitor the output in semi-real time by simply opening the output
file in your favorite GIS program (black stripes are
yet-to-be-completed regions).

New functions:
- raster_to_GLT: Creates a geometry lookup (GLT) file from a raster (a
two-band brick where the pixel values for the first band are the
column numbers, and the pixel values for the second band are the row
numbers of the corresponding pixels in the input Raster* file)
- raster_to_IGM: Creates an input geometry (IGM) file from a raster (a
two-band brick where the pixel values for the first band are the
geographic x-coordinates, and the pixel values for the second band are
the geographic y-coordinates of the corresponding pixels in the input
Raster* file)

As always, if you come across any bugs let me know!

--j

-- 
Jonathan A. Greenberg, PhD
Assistant Professor
Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
Department of Geography and Geographic Information Science
University of Illinois at Urbana-Champaign
259 Computing Applications Building, MC-150
605 East Springfield Avenue
Champaign, IL  61820-6371
Phone: 217-300-1924
http://www.geog.illinois.edu/~jgrn/
AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007


From nevil.amos at gmail.com  Thu Jul  3 08:17:23 2014
From: nevil.amos at gmail.com (nevil amos)
Date: Thu, 3 Jul 2014 16:17:23 +1000
Subject: [R-sig-Geo] Create SpatialPolygonsDataFrame indicating the polygons
 in a single source SpatialPolygonsDataFrame that overlap with the new
 polygons?
Message-ID: <CAN9eD7k5Di=bRnVy=NzmJ=VouEbrzNEZKxzAFV+peA81uN4GVQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140703/e5fe00e2/attachment.pl>

From janka.vanschoenwinkel at uhasselt.be  Thu Jul  3 10:35:58 2014
From: janka.vanschoenwinkel at uhasselt.be (Janka VANSCHOENWINKEL)
Date: Thu, 3 Jul 2014 10:35:58 +0200
Subject: [R-sig-Geo] Choropleth map
In-Reply-To: <75C8D19A1470D344A8AF5312F01160A602BC2BCC8959@GOMAIL.college.tcd.ie>
References: <CAHymutKaqonuZdTuyyynZ8KqHHpr6x2JBhWnJkJ0VEYTkBSM2Q@mail.gmail.com>
	<75C8D19A1470D344A8AF5312F01160A602BC2BCC8959@GOMAIL.college.tcd.ie>
Message-ID: <CAHymut+20D_QqSyJs=zzeQ0sojhabYqQtTCm3n3AkT63+gcgnA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140703/8b034eda/attachment.pl>

From d.g.rossiter at utwente.nl  Thu Jul  3 14:16:34 2014
From: d.g.rossiter at utwente.nl (d.g.rossiter at utwente.nl)
Date: Thu, 3 Jul 2014 12:16:34 +0000
Subject: [R-sig-Geo] Date indexing error for STFDF objects?
Message-ID: <2BB4CAA243815F4BA16E205054AA61D11A137682@EXMBX22.ad.utwente.nl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140703/aac0e1f8/attachment.pl>

From ROONEYJ4 at tcd.ie  Thu Jul  3 14:34:45 2014
From: ROONEYJ4 at tcd.ie (James Rooney)
Date: Thu, 3 Jul 2014 13:34:45 +0100
Subject: [R-sig-Geo] Choropleth map
In-Reply-To: <CAHymut+20D_QqSyJs=zzeQ0sojhabYqQtTCm3n3AkT63+gcgnA@mail.gmail.com>
References: <CAHymutKaqonuZdTuyyynZ8KqHHpr6x2JBhWnJkJ0VEYTkBSM2Q@mail.gmail.com>
	<75C8D19A1470D344A8AF5312F01160A602BC2BCC8959@GOMAIL.college.tcd.ie>,
	<CAHymut+20D_QqSyJs=zzeQ0sojhabYqQtTCm3n3AkT63+gcgnA@mail.gmail.com>
Message-ID: <75C8D19A1470D344A8AF5312F01160A602BC2BCC895D@GOMAIL.college.tcd.ie>

Thank you Janka,

I'm aware of the solution and it is what I use myself. However Roger generally advises not to use @slots directly which is why I did not suggest the solution.

Roger I am curious is there an alternative here to using the @data construct with a match function ?

James

________________________________________
From: Janka VANSCHOENWINKEL [janka.vanschoenwinkel at uhasselt.be]
Sent: 03 July 2014 09:35
To: James Rooney; Roger.Bivand at nhh.no
Cc: r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] Choropleth map

Hi James and Roger,

You both pointed out that maybe I should not use the merge function to join data to an sp object.

I found the explanation for this on the internet (http://gis.stackexchange.com/) and thought it would be interesting to tell you:
The merge function resorts the data during the operation which breaks the internal relationship in the sp object. Therefore to merge a dataframe to the @data slot of an sp object, using match is indeed better and is done in this way:

shape = name of shapefile
Otherdata = data that I want to match
IDS = identifier I want to merge on

shape at data = data.frame(shape at data, OtherData[match(shape at data$IDS, OtherData$IDS),])


Furthermore, I have not yet entirely found the code to make the chloropleth plot, but I am getting there!

Thanks again for you advice,

Janka





2014-06-25 14:40 GMT+02:00 James Rooney <ROONEYJ4 at tcd.ie<mailto:ROONEYJ4 at tcd.ie>>:
Dear Janka,

I can't answer your ggplot questions as I don't really use it much however I did spot something in your code that will cause problems.

You used a "merge" to combine data between a dataframe and an SPDF:

> ValueMapDf <- merge(nuts, Value, by.x="NUTS_ID", by.y="NUTS_ID")

I've forgotten the reasoning, but this will not give you the merge results you expect. You might want to do some manual checking on your merge results.
James

________________________________________
From: r-sig-geo-bounces at r-project.org<mailto:r-sig-geo-bounces at r-project.org> [r-sig-geo-bounces at r-project.org<mailto:r-sig-geo-bounces at r-project.org>] On Behalf Of Janka VANSCHOENWINKEL [janka.vanschoenwinkel at uhasselt.be<mailto:janka.vanschoenwinkel at uhasselt.be>]
Sent: 24 June 2014 18:35
To: r-sig-geo at r-project.org<mailto:r-sig-geo at r-project.org>
Subject: [R-sig-Geo] Choropleth map

Dear list members,


I am trying to make a basic choropleth map for all nuts3 regions in Europe
( = a map where

regions are colored by the value of a certain variable ? think for instance
about a populations

 density map).


I am struggling with this for over a week by now and I always get the same
error message:

Error: Aesthetics must either be length one, or the same length as

 the dataProblems:ValueMapDf$NUTS_ID



I checked the book ?ggplot2? from Hadley Weckham and several internet
sources.  They

document the different steps very properly, but still I don?t know what I
am doing wrong.


Could somebody help me out, please? Thanks in advance!

*Below you can find my code. I hope I gave sufficient information,
otherwise, just let me know!*


library(maptools)

library(ggplot2)

library(ggmap)


# read administrative boundaries (I call the SpatialPolygonsDataFrame:
"nuts" since it contains all nuts3 regions of Europe) )

nuts <- readShapePoly(fn="NUTS_RG_60M_2006")

names(nuts)

[1] "OBJECTID"   "NUTS_ID"    "STAT_LEVL_" "AREA"       "LEN"
"Shape_Leng" "Shape_Area"


# Then I have a dataset with over 60000 observations (several observations
per nuts3 region). I take the average of the different

observations per nuts3 region and save it as "Value"

# The dataset is called Alldata and MEt is the variable I would like to map
over the different nuts3 regions


Value <- aggregate(Alldata$MEt,list(Alldata$nuts3),mean)

colnames(Value) <- c("NUTS_ID","ValueMEt")


head(Value)

  NUTS_ID   ValueMEt

1   AT111 0.04856170

2   AT112 0.05448523

3   AT113 0.04563415

4   AT121 0.02164469

5   AT122 0.02664611

6   AT123 0.03163034



# merge map and data: I call the result "ValueMapDf"

ValueMapDf <- merge(nuts, Value, by.x="NUTS_ID", by.y="NUTS_ID")

ValueMapDf <- ValueMapDf[order(ValueMapDf$NUTS_ID),]



# then I dropped some regions of the SpatialPolygonsDataFrame, for which I
don't have observations (I did this manually since I didn't

know if there was a way to do it automatically)

ValueMapDf<-ValueMapDf[ValueMapDf$OBJECTID > 441,]

ValueMapDf<-ValueMapDf[ValueMapDf$OBJECTID != 444,]

ValueMapDf<-ValueMapDf[ValueMapDf$OBJECTID != 447,]

?.

ValueMapDf<-ValueMapDf[ValueMapDf$OBJECTID != 1927,]



# So far so good: now I continue with plotting my map with the values!
However, as you can see below, here something goes wrong.

# ggplot mapping

# data layer

m0 <- ggplot(data=ValueMapDf)

# fill with Value data

m1 <- m0 + geom_polygon(aes(x=long, y=lat, group=ValueMapDf$NUTS_ID,
fill="ValueMapDf$ValueMEt")) + coord_equal()

# add map with only borders (to have visible borders)

m2 <- m1 + geom_path(aes(x=long, y=lat, group=ValueMapDf$NUTS_ID),
color='black')

m2

Error: Aesthetics must either be length one, or the same length as the
dataProblems:ValueMapDf$NUTS_ID



I also tried:

qplot(long,lat,data=ValueMapDf, group=ValueMapDf$NUTS_ID,
fill=ValueMapDf$ValueMEt, geom="polygon")

Regions defined for each Polygons

Error: Aesthetics must either be length one, or the same length as the
dataProblems:ValueMapDf$ValueMEt, ValueMapDf$NUTS_ID





> length(ValueMapDf$OBJECTID)

[1] 1122

> length(ValueMapDf)

[1] 1122

> length(ValueMapDf$NUTS_ID)

[1] 1122

> length(ValueMapDf$ValueMEt)

[1] 1122



*When I write:*

m0 <- ggplot(data=ValueMapDf)

# fill with Value data

m1 <- m0 + geom_polygon(aes(x=long, y=lat, group=NUTS_ID,
fill="ValueMapDf$ValueMEt")) + coord_equal()

# add map with only borders (to have visible borders)

m2 <- m1 + geom_path(aes(x=long, y=lat, group=NUTS_ID), color='black')

m2

It get: Error in eval(expr, envir, enclos) : object 'NUTS_ID' not found



 Thanks in advance!


Janka

        [[alternative HTML version deleted]]


From edzer.pebesma at uni-muenster.de  Thu Jul  3 15:54:44 2014
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Thu, 03 Jul 2014 15:54:44 +0200
Subject: [R-sig-Geo] Date indexing error for STFDF objects?
In-Reply-To: <2BB4CAA243815F4BA16E205054AA61D11A137682@EXMBX22.ad.utwente.nl>
References: <2BB4CAA243815F4BA16E205054AA61D11A137682@EXMBX22.ad.utwente.nl>
Message-ID: <53B560A4.2070108@uni-muenster.de>

Dear David, thanks for the clear report!

I believe this is a time zone issue -- in my time zone,

> date.ix
[1] "2009-03-21"
> class(date.ix)
[1] "Date"
> as.POSIXct(date.ix)
[1] "2009-03-21 01:00:00 CET"

internally xts, and hence spacetime, work with POSIXct time stamps.

If I run R with environmental variable TZ="", or TZ="GMT", I see

> as.POSIXct("2009-03-21")
[1] "2009-03-21 GMT"
> summary(rr[,"2009-03-21"]$PM10)
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's
  13.71   20.06   26.45   31.94   31.03  269.10      32
> summary(rr[,"2009-03-22"]$PM10)
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's
  3.523  10.150  14.410  15.970  21.830  31.080      32

would that be right?

# with TZ="" or TZ="GMT":
> range(index(rr))
[1] "2009-01-01" "2009-12-30"
# with TZ not set:
> range(index(rr))
[1] "2008-12-31" "2009-12-30"

So, it looks like the data set rr uses start-of-day time indexes, in
seconds (POSIXct), in GMT.

On 07/03/2014 02:16 PM, d.g.rossiter at utwente.nl wrote:
> Please see this as-simple-as-possible-but-no-simpler test; it appears to me as if date indexing is off by one day when extracting from STFDF objects.
> 
> ## packages and version
> require(sp); require(xts); require(spacetime); require(gstat)
> sessionInfo()
> ## R version 3.1.0 (2014-04-10)
> ## Platform: x86_64-w64-mingw32/x64 (64-bit)
> 
> ## locale ...
> 
> ## attached base packages:
> ## [1] stats     graphics  grDevices utils     datasets  methods
> ## [7] base
> 
> ## other attached packages:
> ## [1] gstat_1.0-19    spacetime_1.1-0 xts_0.9-7       zoo_1.7-11
> ## [5] sp_1.0-15
> 
> ## loaded via a namespace (and not attached):
> ## [1] FNN_1.1          grid_3.1.0       intervals_0.14.0
> ## [4] lattice_0.20-29  rgeos_0.3-5      tools_3.1.0
> 
> ## Germany & neighbours air quality test dataset
> data(air)
> rr <- rural[, "2009"] ## one year
> (ix <- which.max(rr$PM10)) ## which record has max PM10?
> station.xts <- rr[ix%%dim(rr)[1],] ## extract that station's time series
> summary(station.xts)
> ## date of maximum PM10 in this station's time series
> (date.xts <- station.xts[which.max(station.xts)])
> ## find index of the record with the maximum PM10
> (date.ix <- index(date.xts))
> as.numeric(date.ix)
> ## correctly extracts the record from the xts
> station.xts[date.ix]
> station.xts["2009-03-21"]
> as.numeric(date.ix)
> 
> ## now try to use this date index to
> ## extract all stations on that date
> ## from the STFDF object
> rr.maxpm <- rr[,date.ix]
> summary(rr.maxpm$PM10) ## wrong !!
> (date.ix.plus1 <- date.ix + 1) ## go to next day
> summary(rr[,date.ix.plus1]$PM10) ## right !!
> summary(rr[,"2009-03-21"]$PM10) ## wrong !!
> summary(rr[,"2009-03-22"]$PM10) ## right !!
> 
> ## conclusion -- indexing off by one day??
> -----------------------------------------------------------------------------------------------
> D G (David) Rossiter
> Department of Earth Systems Analysis
> University of Twente (NL)
> http://www.itc.nl/personal/rossiter
> 
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
83 33081 http://ifgi.uni-muenster.de GPG key ID 0xAC227795

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 490 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140703/1a5cdfe0/attachment.bin>

From edzer.pebesma at uni-muenster.de  Thu Jul  3 15:56:32 2014
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Thu, 03 Jul 2014 15:56:32 +0200
Subject: [R-sig-Geo] Choropleth map
In-Reply-To: <75C8D19A1470D344A8AF5312F01160A602BC2BCC895D@GOMAIL.college.tcd.ie>
References: <CAHymutKaqonuZdTuyyynZ8KqHHpr6x2JBhWnJkJ0VEYTkBSM2Q@mail.gmail.com>	<75C8D19A1470D344A8AF5312F01160A602BC2BCC8959@GOMAIL.college.tcd.ie>,
	<CAHymut+20D_QqSyJs=zzeQ0sojhabYqQtTCm3n3AkT63+gcgnA@mail.gmail.com>
	<75C8D19A1470D344A8AF5312F01160A602BC2BCC895D@GOMAIL.college.tcd.ie>
Message-ID: <53B56110.9030200@uni-muenster.de>

shape$IDs , as(shape, "data.frame"), as.data.frame(shape) should all work.


On 07/03/2014 02:34 PM, James Rooney wrote:
> Thank you Janka,
> 
> I'm aware of the solution and it is what I use myself. However Roger generally advises not to use @slots directly which is why I did not suggest the solution.
> 
> Roger I am curious is there an alternative here to using the @data construct with a match function ?
> 
> James
> 
> ________________________________________
> From: Janka VANSCHOENWINKEL [janka.vanschoenwinkel at uhasselt.be]
> Sent: 03 July 2014 09:35
> To: James Rooney; Roger.Bivand at nhh.no
> Cc: r-sig-geo at r-project.org
> Subject: Re: [R-sig-Geo] Choropleth map
> 
> Hi James and Roger,
> 
> You both pointed out that maybe I should not use the merge function to join data to an sp object.
> 
> I found the explanation for this on the internet (http://gis.stackexchange.com/) and thought it would be interesting to tell you:
> The merge function resorts the data during the operation which breaks the internal relationship in the sp object. Therefore to merge a dataframe to the @data slot of an sp object, using match is indeed better and is done in this way:
> 
> shape = name of shapefile
> Otherdata = data that I want to match
> IDS = identifier I want to merge on
> 
> shape at data = data.frame(shape at data, OtherData[match(shape at data$IDS, OtherData$IDS),])
> 
> 
> Furthermore, I have not yet entirely found the code to make the chloropleth plot, but I am getting there!
> 
> Thanks again for you advice,
> 
> Janka
> 
> 
> 
> 
> 
> 2014-06-25 14:40 GMT+02:00 James Rooney <ROONEYJ4 at tcd.ie<mailto:ROONEYJ4 at tcd.ie>>:
> Dear Janka,
> 
> I can't answer your ggplot questions as I don't really use it much however I did spot something in your code that will cause problems.
> 
> You used a "merge" to combine data between a dataframe and an SPDF:
> 
>> ValueMapDf <- merge(nuts, Value, by.x="NUTS_ID", by.y="NUTS_ID")
> 
> I've forgotten the reasoning, but this will not give you the merge results you expect. You might want to do some manual checking on your merge results.
> James
> 
> ________________________________________
> From: r-sig-geo-bounces at r-project.org<mailto:r-sig-geo-bounces at r-project.org> [r-sig-geo-bounces at r-project.org<mailto:r-sig-geo-bounces at r-project.org>] On Behalf Of Janka VANSCHOENWINKEL [janka.vanschoenwinkel at uhasselt.be<mailto:janka.vanschoenwinkel at uhasselt.be>]
> Sent: 24 June 2014 18:35
> To: r-sig-geo at r-project.org<mailto:r-sig-geo at r-project.org>
> Subject: [R-sig-Geo] Choropleth map
> 
> Dear list members,
> 
> 
> I am trying to make a basic choropleth map for all nuts3 regions in Europe
> ( = a map where
> 
> regions are colored by the value of a certain variable ? think for instance
> about a populations
> 
>  density map).
> 
> 
> I am struggling with this for over a week by now and I always get the same
> error message:
> 
> Error: Aesthetics must either be length one, or the same length as
> 
>  the dataProblems:ValueMapDf$NUTS_ID
> 
> 
> 
> I checked the book ?ggplot2? from Hadley Weckham and several internet
> sources.  They
> 
> document the different steps very properly, but still I don?t know what I
> am doing wrong.
> 
> 
> Could somebody help me out, please? Thanks in advance!
> 
> *Below you can find my code. I hope I gave sufficient information,
> otherwise, just let me know!*
> 
> 
> library(maptools)
> 
> library(ggplot2)
> 
> library(ggmap)
> 
> 
> # read administrative boundaries (I call the SpatialPolygonsDataFrame:
> "nuts" since it contains all nuts3 regions of Europe) )
> 
> nuts <- readShapePoly(fn="NUTS_RG_60M_2006")
> 
> names(nuts)
> 
> [1] "OBJECTID"   "NUTS_ID"    "STAT_LEVL_" "AREA"       "LEN"
> "Shape_Leng" "Shape_Area"
> 
> 
> # Then I have a dataset with over 60000 observations (several observations
> per nuts3 region). I take the average of the different
> 
> observations per nuts3 region and save it as "Value"
> 
> # The dataset is called Alldata and MEt is the variable I would like to map
> over the different nuts3 regions
> 
> 
> Value <- aggregate(Alldata$MEt,list(Alldata$nuts3),mean)
> 
> colnames(Value) <- c("NUTS_ID","ValueMEt")
> 
> 
> head(Value)
> 
>   NUTS_ID   ValueMEt
> 
> 1   AT111 0.04856170
> 
> 2   AT112 0.05448523
> 
> 3   AT113 0.04563415
> 
> 4   AT121 0.02164469
> 
> 5   AT122 0.02664611
> 
> 6   AT123 0.03163034
> 
> 
> 
> # merge map and data: I call the result "ValueMapDf"
> 
> ValueMapDf <- merge(nuts, Value, by.x="NUTS_ID", by.y="NUTS_ID")
> 
> ValueMapDf <- ValueMapDf[order(ValueMapDf$NUTS_ID),]
> 
> 
> 
> # then I dropped some regions of the SpatialPolygonsDataFrame, for which I
> don't have observations (I did this manually since I didn't
> 
> know if there was a way to do it automatically)
> 
> ValueMapDf<-ValueMapDf[ValueMapDf$OBJECTID > 441,]
> 
> ValueMapDf<-ValueMapDf[ValueMapDf$OBJECTID != 444,]
> 
> ValueMapDf<-ValueMapDf[ValueMapDf$OBJECTID != 447,]
> 
> ?.
> 
> ValueMapDf<-ValueMapDf[ValueMapDf$OBJECTID != 1927,]
> 
> 
> 
> # So far so good: now I continue with plotting my map with the values!
> However, as you can see below, here something goes wrong.
> 
> # ggplot mapping
> 
> # data layer
> 
> m0 <- ggplot(data=ValueMapDf)
> 
> # fill with Value data
> 
> m1 <- m0 + geom_polygon(aes(x=long, y=lat, group=ValueMapDf$NUTS_ID,
> fill="ValueMapDf$ValueMEt")) + coord_equal()
> 
> # add map with only borders (to have visible borders)
> 
> m2 <- m1 + geom_path(aes(x=long, y=lat, group=ValueMapDf$NUTS_ID),
> color='black')
> 
> m2
> 
> Error: Aesthetics must either be length one, or the same length as the
> dataProblems:ValueMapDf$NUTS_ID
> 
> 
> 
> I also tried:
> 
> qplot(long,lat,data=ValueMapDf, group=ValueMapDf$NUTS_ID,
> fill=ValueMapDf$ValueMEt, geom="polygon")
> 
> Regions defined for each Polygons
> 
> Error: Aesthetics must either be length one, or the same length as the
> dataProblems:ValueMapDf$ValueMEt, ValueMapDf$NUTS_ID
> 
> 
> 
> 
> 
>> length(ValueMapDf$OBJECTID)
> 
> [1] 1122
> 
>> length(ValueMapDf)
> 
> [1] 1122
> 
>> length(ValueMapDf$NUTS_ID)
> 
> [1] 1122
> 
>> length(ValueMapDf$ValueMEt)
> 
> [1] 1122
> 
> 
> 
> *When I write:*
> 
> m0 <- ggplot(data=ValueMapDf)
> 
> # fill with Value data
> 
> m1 <- m0 + geom_polygon(aes(x=long, y=lat, group=NUTS_ID,
> fill="ValueMapDf$ValueMEt")) + coord_equal()
> 
> # add map with only borders (to have visible borders)
> 
> m2 <- m1 + geom_path(aes(x=long, y=lat, group=NUTS_ID), color='black')
> 
> m2
> 
> It get: Error in eval(expr, envir, enclos) : object 'NUTS_ID' not found
> 
> 
> 
>  Thanks in advance!
> 
> 
> Janka
> 
>         [[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
83 33081 http://ifgi.uni-muenster.de GPG key ID 0xAC227795

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 490 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140703/6344fe28/attachment.bin>

From juta.kawalerowicz at nuffield.ox.ac.uk  Thu Jul  3 22:12:01 2014
From: juta.kawalerowicz at nuffield.ox.ac.uk (Juta Kawalerowicz)
Date: Thu, 3 Jul 2014 21:12:01 +0100
Subject: [R-sig-Geo] Can anyone recommend an areal interpolation package?
Message-ID: <CAHMizkNp2dp8K+XxU6E6mPK6eHJhgy0UbK0q69+1R46JCK9bvQ@mail.gmail.com>

Dear list members,

Does anyone know a working package for areal interpolation? I have 2
shapefiles (let's call them shapfile 1 and shapefile 2) for a country
(with attribute table). They are from different time period, the
boundaries change and I would like to calculate values from attribute
table in shapefile 1 over boundaries from shapefile 2.

The process is described here for ArcGIS (I found that the estimates
it produced were not accurate):

http://resources.arcgis.com/en/help/main/10.1/index.html#//0031000000q8000000

In the past I used pycno package written by Chris Brunsdon
http://cran.r-project.org/web/packages/pycno/index.html

but I see it is no longer maintained. Any ideas would be appreciated!

Thanks,
Juta


From oscar.perpinan at upm.es  Thu Jul  3 23:10:22 2014
From: oscar.perpinan at upm.es (=?UTF-8?Q?Oscar_Perpi=C3=B1an?=)
Date: Thu, 3 Jul 2014 23:10:22 +0200
Subject: [R-sig-Geo] Choropleth map
In-Reply-To: <53B56110.9030200@uni-muenster.de>
References: <CAHymutKaqonuZdTuyyynZ8KqHHpr6x2JBhWnJkJ0VEYTkBSM2Q@mail.gmail.com>
	<75C8D19A1470D344A8AF5312F01160A602BC2BCC8959@GOMAIL.college.tcd.ie>
	<CAHymut+20D_QqSyJs=zzeQ0sojhabYqQtTCm3n3AkT63+gcgnA@mail.gmail.com>
	<75C8D19A1470D344A8AF5312F01160A602BC2BCC895D@GOMAIL.college.tcd.ie>
	<53B56110.9030200@uni-muenster.de>
Message-ID: <CAMLL7b=GNVn06nnGMWiGaMMD+qV_wuBxq5i14ZVTbNpkcv4rkg@mail.gmail.com>

Hi,

I propose the code below to solve your problem. By the way, I have
found your shapefiles here:
https://github.com/briatte/kmaps/tree/master/maps/regions.

Best,

Oscar.

library(sp)
library(maptools)

nuts <- readShapePoly(fn="NUTS_RG_60M_2006")

## no data provided, so I have to produce a toy example
someNuts <- sample(nuts$NUTS_ID, 300)
Alldata <- data.frame(nuts3 = someNuts, MEt = rnorm(6000))
Value <- aggregate(MEt ~ nuts3, data = Alldata, FUN = mean)
names(Value) <-  c("NUTS_ID","ValueMEt")

## Match polygons with data
idx <- match(nuts$NUTS_ID, Value$NUTS_ID)
## Places without information
idxNA <- which(is.na(idx))
##Information to be added to the SpatialPolygons object
dat2add <- Value[idx, ]
## spCbind uses row names to match polygons with data
## First, extract polygon IDs
IDs <- sapply(nuts at polygons, function(x)x at ID)
## and join with the SpatialPolygons
row.names(dat2add) <- IDs
datPols <- spCbind(nuts, dat2add)
## Drop those places without information
datPols <- datPols[-idxNA, ]

## Display variable using 'spplot'
spplot(datPols["ValueMEt"])

-----------------------------------------------------------------
Oscar Perpi??n Lamigueiro
Dpto. Ingenier?a El?ctrica (ETSIDI-UPM)
Grupo de Sistemas Fotovoltaicos (IES-UPM)
URL: http://oscarperpinan.github.io
Twitter: @oscarperpinan


From janka.vanschoenwinkel at uhasselt.be  Fri Jul  4 09:36:12 2014
From: janka.vanschoenwinkel at uhasselt.be (Janka VANSCHOENWINKEL)
Date: Fri, 4 Jul 2014 09:36:12 +0200
Subject: [R-sig-Geo] Choropleth map
In-Reply-To: <CAMLL7b=GNVn06nnGMWiGaMMD+qV_wuBxq5i14ZVTbNpkcv4rkg@mail.gmail.com>
References: <CAHymutKaqonuZdTuyyynZ8KqHHpr6x2JBhWnJkJ0VEYTkBSM2Q@mail.gmail.com>
	<75C8D19A1470D344A8AF5312F01160A602BC2BCC8959@GOMAIL.college.tcd.ie>
	<CAHymut+20D_QqSyJs=zzeQ0sojhabYqQtTCm3n3AkT63+gcgnA@mail.gmail.com>
	<75C8D19A1470D344A8AF5312F01160A602BC2BCC895D@GOMAIL.college.tcd.ie>
	<53B56110.9030200@uni-muenster.de>
	<CAMLL7b=GNVn06nnGMWiGaMMD+qV_wuBxq5i14ZVTbNpkcv4rkg@mail.gmail.com>
Message-ID: <CAHymutKkDrftF+T3qu0WyrNg_4ry0T5Zj7eKYFwNESc+n-xc5Q@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140704/2ab391f5/attachment.pl>

From nevil.amos at gmail.com  Fri Jul  4 18:00:33 2014
From: nevil.amos at gmail.com (nevil amos)
Date: Sat, 5 Jul 2014 02:00:33 +1000
Subject: [R-sig-Geo] RasterLayerSparse?
Message-ID: <CAN9eD7nxQyKAXPU3fP3FoFC=1o0EUMtWOWQn7v_GQESBR7sUcg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140705/735df13c/attachment.pl>

From nevil.amos at gmail.com  Fri Jul  4 18:33:55 2014
From: nevil.amos at gmail.com (nevil amos)
Date: Sat, 5 Jul 2014 02:33:55 +1000
Subject: [R-sig-Geo] Create SpatialPolygonsDataFrame indicating the
 polygons in a single source SpatialPolygonsDataFrame that overlap with the
 new polygons?
In-Reply-To: <CAN9eD7k5Di=bRnVy=NzmJ=VouEbrzNEZKxzAFV+peA81uN4GVQ@mail.gmail.com>
References: <CAN9eD7k5Di=bRnVy=NzmJ=VouEbrzNEZKxzAFV+peA81uN4GVQ@mail.gmail.com>
Message-ID: <CAN9eD7kHAYpA5G2K9h4EfP8XQZZM+7KgWvywfxLDrHt8prpqnA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140705/059ba979/attachment.pl>

From seyatranspo at yahoo.co.jp  Fri Jul  4 19:33:38 2014
From: seyatranspo at yahoo.co.jp (seyatranspo at yahoo.co.jp)
Date: Sat, 5 Jul 2014 02:33:38 +0900 (JST)
Subject: [R-sig-Geo] Considers offset term in binary spatial logit/probit
	model
Message-ID: <80822.29460.qm@web100515.mail.kks.yahoo.co.jp>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140705/8796381f/attachment.pl>

From Roger.Bivand at nhh.no  Fri Jul  4 22:53:29 2014
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 4 Jul 2014 22:53:29 +0200
Subject: [R-sig-Geo] Create SpatialPolygonsDataFrame indicating the
 polygons in a single source SpatialPolygonsDataFrame that overlap with the
 new polygons?
In-Reply-To: <CAN9eD7kHAYpA5G2K9h4EfP8XQZZM+7KgWvywfxLDrHt8prpqnA@mail.gmail.com>
References: <CAN9eD7k5Di=bRnVy=NzmJ=VouEbrzNEZKxzAFV+peA81uN4GVQ@mail.gmail.com>
	<CAN9eD7kHAYpA5G2K9h4EfP8XQZZM+7KgWvywfxLDrHt8prpqnA@mail.gmail.com>
Message-ID: <alpine.LRH.2.03.1407042230200.4347@reclus.nhh.no>

On Fri, 4 Jul 2014, nevil amos wrote:

> I figured out how to achieve this  in raster, however for the real data the
> raster files and array exceed my availible 16gb memory.
>
> I would still be interested in any suggestions on how to achieve directly
> with the SpatialPolygons

Yes, use the rgeos package. In fact your problem isn't very well formed, 
because the outcome is 9 intersections, 3 of which are equal:

gII <- gIntersection(SDF, SDF, byid=c(TRUE, TRUE))
gEquals(gII, gII, byid=TRUE)

Retrieve the IDs from the row.names() of GII, but you'll need to copy back 
the off-diagonal equalities.

You can set up gIntersection() for large n by first using gIntersects(..., 
returnDense=FALSE) to return only an n-list of predicate TRUE indices, or 
query a binary STRtree to generate a similar list. See for example 
suggestions in:

http://spatial.nhh.no/misc/ogrs14/ogrs140612.zip

in ogrs_140612.R (there line/polygon intersections)

This should put you on a feasible track, I hope.

Roger



>
> For the record here is the raster/ array approach I figured out:
> rm(list=ls())
> library(rgdal)
> library(raster)
> library(sp)
> library (plyr)
> p1<-Polygons(list(Polygon(cbind(x=c(0,2,2,0,0),y=c(0,0,2,2,0)))),1)
> p2<-Polygons(list(Polygon(cbind(x=c(1,3,3,1,1),y=c(1,1,3,3,1)))),2)
> p3<-Polygons(list(Polygon(cbind(x=c(0,2,2,0,0),y=c(1,1,2,2,1)))),3)
>
> mypolys<-list(p1,p2,p3)
>
>
> SDF<-SpatialPolygons(mypolys)
> plot(SDF)
> ext<-(extent(SDF))
>
> xy <- abs(apply(as.matrix(bbox(ext)), 1, diff))
> n <- 1
> r <- raster(ext, ncol=xy[1]*n, nrow=xy[2]*n)
> for(i in 1:length(SDF)){
>  rr<-rasterize(SDF[i,],r)
>  if(exists("S")) S<-stack(S,rr) else S<-stack(rr)
> }
> A<-as.array(S)
>
> C<-apply(A,3,as.numeric)
> U<-unique(C)
> C<-data.frame(C)
> U<-data.frame(U)
> ID<-as.numeric(rownames(U))
> U<-cbind(ID,U)
> Vals<-matrix(join(C,U)$ID,dim(S)[1],dim(S)[2])
> Vals<-setValues(r,Vals)
> Vals<-ratify(Vals)
> levels(Vals)[[1]]<-U
> names(levels(Vals)[[1]])<-c("ID","p1","p2","p3")
> plot(Vals)
> plot(SDF,add=T)
> print(Vals)
>
>
>
> On Thu, Jul 3, 2014 at 4:17 PM, nevil amos <nevil.amos at gmail.com> wrote:
>
>> I am trying to create a polygon dataset that creates a new polygon for
>> each unique combination of location and overlap of polygons in an input
>> polygon dataset, and is attributed with the input polygons underlying each
>> of the derived polygons, and th output does not contain any overlapping
>> polygons.
>>
>>
>> #trivial example
>> #single layer with three partially overlapping polygons
>> library(sp)
>> p1<-Polygons(list(Polygon(cbind(x=c(0,2,2,0,0),y=c(0,0,2,2,0)))),1)
>> p2<-Polygons(list(Polygon(cbind(x=c(1,3,3,1,1),y=c(1,1,3,3,1)))),2)
>>
>> p3<-Polygons(list(Polygon(cbind(x=c(1.5,3,3,1.5,1.5),y=c(1.5,1.5,3,3,1.5)))),3)
>> mypolys<-list(p1,p2,p3)
>> mydata<-data.frame(Name=c("p1","p2","p3"),row.names=c(1,2,3))
>>
>> SDF<-SpatialPolygonsDataFrame(SpatialPolygons(mypolys),mydata)
>> par(mfrow=c(3,4))
>> plot(SDF)
>>
>>
>> #the desired result is a SpatialPolygonsDataFrame with a single separate
>> polygon for each of the six areas deifined by the interection of the
>> boundaries of the three input polygons
>> text(.5,.5,1)
>> text(1.25,1.25,2)
>> text(1.75,1.75,3)
>> text(2.5,2.5,4)
>> text(1.25,2.5,5)
>> text(2.5,1.25,6)
>>
>> # such that the data frame lists the input polygons (p1,p2,p3) that
>> overlap at the location of each of the output polygons (1:6) and the output
>> has no overlap between the polygons
>> # the results would be the six unique polygons shown in the plot and so
>> the attributes would look like:
>> data.frame(polys=c("p1","p1 p2","p1 p2 p3","p2 p3","p2","p2"))
>> # or alternatively
>>
>> data.frame(cbind(c("p1","p1","p1","p2","p2","p2"),c(NA,"p2","p2","p3",NA,NA),c(NA,NA,"p3",NA,NA,NA)))
>> # or alternatively
>> data.frame(cbind(p1=c(1,1,1,0,0,0),p2=c(0,1,1,1,1,1),p3=c(0,0,1,1,0,0)))
>>
>>
>> #This last plot shows the "apparent polygons" I want in separate colors (
>> because you cannot see the overlapping portions)
>> Outpoly<-union(SDF,SDF)
>> plot(OutPoly,col=1:9)
>>
>> plot(SpatialPolygons(list(Polygons(list(Polygon(cbind(x=c(2,2,3,3,2),y=c(1,1.5,1.5,1,1)))),1))),col=12,add=T)
>> text(.5,.5,1)
>> text(1.25,1.25,2)
>> text(1.75,1.75,3)
>> text(2.5,2.5,4)
>> text(1.25,2.5,5)
>> text(2.5,1.25,6)
>> #The nearest I could get was raster::union however this requires two ( and
>> only 2) SpatialDataFrames as input , what I need is union with a single
>> input union(SDF,SDF) results in 9 polygons not 6, these are all simple
>> rectangles of overlapping pairs (union(union(SDF,SDF)SDF)) results in 27
>> polygons - all again just the simple rectangular overlaps and original
>> polygons
>> union(SDF,SDF)@data
>>
>>
>>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no


From julleeyaw at yahoo.ca  Sat Jul  5 09:55:07 2014
From: julleeyaw at yahoo.ca (Julie Lee-Yaw)
Date: Sat, 5 Jul 2014 00:55:07 -0700
Subject: [R-sig-Geo] Help mosiacing rasters OR replacing NA values in one
	raster based on cell coordinates
In-Reply-To: <mailman.11.1404381603.19993.r-sig-geo@r-project.org>
References: <mailman.11.1404381603.19993.r-sig-geo@r-project.org>
Message-ID: <1404546907.2559.YahooMailNeo@web142502.mail.bf1.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140705/5c98776c/attachment.pl>

From Roger.Bivand at nhh.no  Sat Jul  5 22:34:20 2014
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sat, 5 Jul 2014 22:34:20 +0200
Subject: [R-sig-Geo] Considers offset term in binary spatial
 logit/probit model
In-Reply-To: <80822.29460.qm@web100515.mail.kks.yahoo.co.jp>
References: <80822.29460.qm@web100515.mail.kks.yahoo.co.jp>
Message-ID: <alpine.LRH.2.03.1407052231160.8634@reclus.nhh.no>

On Fri, 4 Jul 2014, seyatranspo at yahoo.co.jp wrote:

> Hi everyone,
> ??
> There is nice R package for spatial probit
> model including "spatialprobit"
> http://rjournal.github.io/archive/2013-1/wilhelm-matos.pdf
> However, such package do not offer the option
> to introduce offset term.??

I suggest sending a copy of this question to the authors of the package 
with a motivating example. I do note, however, that using the formula 
interface to sarprobit() permits for example:

sarprobit.fit <- sarprobit(y ~ X[,3] + offset(1*X[,2]), W, ndraw=1000,
   thinning=1, prior=NULL)

using the example on the function help page. See ?formula for the offset() 
term.

Hope this helps,

Roger

> I would like to add/consider offset term in spatial
> econometric binary logit/probit model,??
> but I???m not sure if it is possible.
>
> I
> have been noticed that "CARBayes" package offers such options, but I would like to use??
> an
> asymmetric spatial weight matrix, and in fact not sure in such case CAR
> approach could be applicable...??
> Do you have any information??somehow??to consider
> offset term using existing R packages??
> for binary spatial logit/probit model?
> Thank you very much in advance.
> ??
> Hajime Seya
> 	[[alternative HTML version deleted]]
>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no


From seyatranspo at yahoo.co.jp  Sun Jul  6 15:50:00 2014
From: seyatranspo at yahoo.co.jp (seyatranspo at yahoo.co.jp)
Date: Sun, 6 Jul 2014 22:50:00 +0900 (JST)
Subject: [R-sig-Geo] Considers offset term in binary spatial
	logit/probit model
In-Reply-To: <alpine.LRH.2.03.1407052231160.8634@reclus.nhh.no>
References: <80822.29460.qm@web100515.mail.kks.yahoo.co.jp>
	<alpine.LRH.2.03.1407052231160.8634@reclus.nhh.no>
Message-ID: <344145.59724.qm@web100508.mail.kks.yahoo.co.jp>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140706/d2da82d0/attachment.pl>

From ROONEYJ4 at tcd.ie  Sun Jul  6 23:34:22 2014
From: ROONEYJ4 at tcd.ie (James Rooney)
Date: Sun, 6 Jul 2014 22:34:22 +0100
Subject: [R-sig-Geo] rgdal writeOGR - clipping variable names
In-Reply-To: <alpine.LRH.2.03.1407052231160.8634@reclus.nhh.no>
References: <80822.29460.qm@web100515.mail.kks.yahoo.co.jp>,
	<alpine.LRH.2.03.1407052231160.8634@reclus.nhh.no>
Message-ID: <75C8D19A1470D344A8AF5312F01160A602BC2BCC895F@GOMAIL.college.tcd.ie>

Hi all,

I am using writeOGR to save ESRI shapefiles after a ton of processing. Typical warning message I get is as follows:

> writeOGR(ED, "/Users/jrooney/Documents/My Projects/ALS Spatial - Advanced/Irish Data/Processed Data/", layer="ED.cluster",driver="ESRI Shapefile",overwrite=T)
Warning message:
In writeOGR(ED, "/Users/jrooney/Documents/My Projects/ALS Spatial - Advanced/Irish Data/Processed Data/",  :
  Field names abbreviated for ESRI Shapefile driver

Now it has been doing this all along. But lately it has changed. For example - I frequently use the column id "GEOGID" as I've inherited it somewhere along the line from some dataset I got somewhere.
Until recently it was happily saving this column name in its entireity. Lately, for some mystery reason it is not saving it fully and only saving 5 letters - "GEOGI". This, as you can imagine is causing me troubles.

Anyhow - why are field names so short for ESRI shapfiles and why does it sometimes accept 6 letter fields and other times not ? It would be great if it would allow longer field names, as 5 letters is not alot when you have over 100 variables - it gets confusing even when you use codes.

Many thanks,
James

From Roger.Bivand at nhh.no  Mon Jul  7 00:12:22 2014
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 7 Jul 2014 00:12:22 +0200
Subject: [R-sig-Geo] rgdal writeOGR - clipping variable names
In-Reply-To: <75C8D19A1470D344A8AF5312F01160A602BC2BCC895F@GOMAIL.college.tcd.ie>
References: <80822.29460.qm@web100515.mail.kks.yahoo.co.jp>,
	<alpine.LRH.2.03.1407052231160.8634@reclus.nhh.no>
	<75C8D19A1470D344A8AF5312F01160A602BC2BCC895F@GOMAIL.college.tcd.ie>
Message-ID: <alpine.LRH.2.03.1407062340280.25352@reclus.nhh.no>

On Sun, 6 Jul 2014, James Rooney wrote:

> Hi all,
>
> I am using writeOGR to save ESRI shapefiles after a ton of processing. 
> Typical warning message I get is as follows:
>
>> writeOGR(ED, "/Users/jrooney/Documents/My Projects/ALS Spatial - 
>> Advanced/Irish Data/Processed Data/", layer="ED.cluster",driver="ESRI 
>> Shapefile",overwrite=T)
> Warning message:
> In writeOGR(ED, "/Users/jrooney/Documents/My Projects/ALS Spatial - 
> Advanced/Irish Data/Processed Data/", :
>  Field names abbreviated for ESRI Shapefile driver
>
> Now it has been doing this all along. But lately it has changed. For 
> example - I frequently use the column id "GEOGID" as I've inherited it 
> somewhere along the line from some dataset I got somewhere.

It would have helped if you gave the output of sessionInfo() - including 
the version of rgdal, and the startup messages on loading rgdal, as rgdal 
version, underlying GDAL version, and platform may make a difference. In 
addition, it would help to know how you installed rgdal.

The warning and field-name abbreviation occurs in R/ogr_write.R after line 
116, and has been present since mid-November 2011. This is based on:

http://trac.osgeo.org/gdal/browser/trunk/gdal/ogr/ogrsf_frmts/shape/drv_shapefile.html

after line 120, describing what GDAL does to field names, and trying to 
pre-empt this in R. As the OGR driver only supports names <= 10 characters 
long, the R code uses up to two passes of abbreviate() to shorten field 
names in data to be exported, first trying to get to minlength=7 
chararacters, and if this is insufficient, to minlength=5. Your case 
suggests that you now have so many similar field names over 10 characters 
long that abbreviate() no longer succeeds with a wish of minlength=7, so 
goes to minlength=5 - this would explain the change in behaviour.

Testing each name separately rather than using abbreviate() on the vector 
of names would incur the further cost of checking for uniqueness - the 
function preserves uniqueness when strict=FALSE.

The reason for the difficulty is that the underlying DBF format cannot be 
relied on to support field names > 10 characters long, so the OGR driver, 
and writeOGR(), are obliged to protect users from arbitrary shortening, 
which could lead to multiple fields having the same name. Some 
applications may permit longer names, but others do not, and those are the 
ones that set the limit.

The only reliable resolution is to give your own variable/field names that 
are all <= 10 characters long if you use the ESRI Shapefile driver for 
exporting objects. You can handle this in scripts yourself by looking at 
nchar(names(<obj>)), and abbreviating uniquely any that are longer.

Note that there are also substantial encoding challenges in the DBF format 
too, although I don't think that this is affecting nchar() here - keeping 
to ASCII (always single byte) in field names with an archaic format like 
DBF may be judicious.

Hope this clarifies,

Roger

> Until recently it was happily saving this column name in its entireity. 
> Lately, for some mystery reason it is not saving it fully and only 
> saving 5 letters - "GEOGI". This, as you can imagine is causing me 
> troubles.
>
> Anyhow - why are field names so short for ESRI shapfiles and why does it sometimes accept 6 letter fields and other times not ? It would be great if it would allow longer field names, as 5 letters is not alot when you have over 100 variables - it gets confusing even when you use codes.
>
> Many thanks,
> James
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no


From ROONEYJ4 at tcd.ie  Mon Jul  7 09:16:49 2014
From: ROONEYJ4 at tcd.ie (James Rooney)
Date: Mon, 7 Jul 2014 08:16:49 +0100
Subject: [R-sig-Geo] rgdal writeOGR - clipping variable names
In-Reply-To: <alpine.LRH.2.03.1407062340280.25352@reclus.nhh.no>
References: <80822.29460.qm@web100515.mail.kks.yahoo.co.jp>,
	<alpine.LRH.2.03.1407052231160.8634@reclus.nhh.no>
	<75C8D19A1470D344A8AF5312F01160A602BC2BCC895F@GOMAIL.college.tcd.ie>,
	<alpine.LRH.2.03.1407062340280.25352@reclus.nhh.no>
Message-ID: <75C8D19A1470D344A8AF5312F01160A602BC2BCC8960@GOMAIL.college.tcd.ie>

Hi Roger,

Many thanks for your answer - very enlightening.
Apologies I didn't realise the sessionInfo and other stuff would help.
As it happens your explanation makes perfect sense - it is only after I started using some longer and similar field names that the behaviour changed. Knowing how it works now thanks to your explanation I should be able to avoid that. I will make changes and see if it works. If it doens't work I'll post back with all the version info etc.

Many thanks,
James
________________________________________
From: Roger Bivand [Roger.Bivand at nhh.no]
Sent: 06 July 2014 23:12
To: James Rooney
Cc: R-sig-Geo at r-project.org
Subject: Re: [R-sig-Geo] rgdal writeOGR - clipping variable names

On Sun, 6 Jul 2014, James Rooney wrote:

> Hi all,
>
> I am using writeOGR to save ESRI shapefiles after a ton of processing.
> Typical warning message I get is as follows:
>
>> writeOGR(ED, "/Users/jrooney/Documents/My Projects/ALS Spatial -
>> Advanced/Irish Data/Processed Data/", layer="ED.cluster",driver="ESRI
>> Shapefile",overwrite=T)
> Warning message:
> In writeOGR(ED, "/Users/jrooney/Documents/My Projects/ALS Spatial -
> Advanced/Irish Data/Processed Data/", :
>  Field names abbreviated for ESRI Shapefile driver
>
> Now it has been doing this all along. But lately it has changed. For
> example - I frequently use the column id "GEOGID" as I've inherited it
> somewhere along the line from some dataset I got somewhere.

It would have helped if you gave the output of sessionInfo() - including
the version of rgdal, and the startup messages on loading rgdal, as rgdal
version, underlying GDAL version, and platform may make a difference. In
addition, it would help to know how you installed rgdal.

The warning and field-name abbreviation occurs in R/ogr_write.R after line
116, and has been present since mid-November 2011. This is based on:

http://trac.osgeo.org/gdal/browser/trunk/gdal/ogr/ogrsf_frmts/shape/drv_shapefile.html

after line 120, describing what GDAL does to field names, and trying to
pre-empt this in R. As the OGR driver only supports names <= 10 characters
long, the R code uses up to two passes of abbreviate() to shorten field
names in data to be exported, first trying to get to minlength=7
chararacters, and if this is insufficient, to minlength=5. Your case
suggests that you now have so many similar field names over 10 characters
long that abbreviate() no longer succeeds with a wish of minlength=7, so
goes to minlength=5 - this would explain the change in behaviour.

Testing each name separately rather than using abbreviate() on the vector
of names would incur the further cost of checking for uniqueness - the
function preserves uniqueness when strict=FALSE.

The reason for the difficulty is that the underlying DBF format cannot be
relied on to support field names > 10 characters long, so the OGR driver,
and writeOGR(), are obliged to protect users from arbitrary shortening,
which could lead to multiple fields having the same name. Some
applications may permit longer names, but others do not, and those are the
ones that set the limit.

The only reliable resolution is to give your own variable/field names that
are all <= 10 characters long if you use the ESRI Shapefile driver for
exporting objects. You can handle this in scripts yourself by looking at
nchar(names(<obj>)), and abbreviating uniquely any that are longer.

Note that there are also substantial encoding challenges in the DBF format
too, although I don't think that this is affecting nchar() here - keeping
to ASCII (always single byte) in field names with an archaic format like
DBF may be judicious.

Hope this clarifies,

Roger

> Until recently it was happily saving this column name in its entireity.
> Lately, for some mystery reason it is not saving it fully and only
> saving 5 letters - "GEOGI". This, as you can imagine is causing me
> troubles.
>
> Anyhow - why are field names so short for ESRI shapfiles and why does it sometimes accept 6 letter fields and other times not ? It would be great if it would allow longer field names, as 5 letters is not alot when you have over 100 variables - it gets confusing even when you use codes.
>
> Many thanks,
> James
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

--
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no


From jon.skoien at jrc.ec.europa.eu  Mon Jul  7 09:51:47 2014
From: jon.skoien at jrc.ec.europa.eu (Jon Olav Skoien)
Date: Mon, 07 Jul 2014 09:51:47 +0200
Subject: [R-sig-Geo] Can anyone recommend an areal interpolation package?
In-Reply-To: <CAHMizkNp2dp8K+XxU6E6mPK6eHJhgy0UbK0q69+1R46JCK9bvQ@mail.gmail.com>
References: <CAHMizkNp2dp8K+XxU6E6mPK6eHJhgy0UbK0q69+1R46JCK9bvQ@mail.gmail.com>
Message-ID: <53BA5193.3030206@jrc.ec.europa.eu>

Hi Juta,

You could try with the rtop package which also does area to area 
interpolation, but with a different method than the one used by ArcGIS. 
It was developed for a rather different use case (hydrological variables 
along stream networks), but should also be able to deal with data of the 
type you describe.

Best wishes,
Jon

On 03-Jul-14 22:12, Juta Kawalerowicz wrote:
> Dear list members,
>
> Does anyone know a working package for areal interpolation? I have 2
> shapefiles (let's call them shapfile 1 and shapefile 2) for a country
> (with attribute table). They are from different time period, the
> boundaries change and I would like to calculate values from attribute
> table in shapefile 1 over boundaries from shapefile 2.
>
> The process is described here for ArcGIS (I found that the estimates
> it produced were not accurate):
>
> http://resources.arcgis.com/en/help/main/10.1/index.html#//0031000000q8000000
>
> In the past I used pycno package written by Chris Brunsdon
> http://cran.r-project.org/web/packages/pycno/index.html
>
> but I see it is no longer maintained. Any ideas would be appreciated!
>
> Thanks,
> Juta
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


-- 
Jon Olav Sk?ien
Joint Research Centre - European Commission
Institute for Environment and Sustainability (IES)
Climate Risk Management Unit

Via Fermi 2749, TP 100-01,  I-21027 Ispra (VA), ITALY

jon.skoien at jrc.ec.europa.eu
Tel:  +39 0332 789205

Disclaimer: Views expressed in this email are those of the individual and do not necessarily represent official views of the European Commission.


From b.rowlingson at lancaster.ac.uk  Mon Jul  7 10:44:15 2014
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Mon, 7 Jul 2014 09:44:15 +0100
Subject: [R-sig-Geo] rgdal writeOGR - clipping variable names
In-Reply-To: <d1a929867ea04edab9501d80a267d34a@EX-0-HT0.lancs.local>
References: <80822.29460.qm@web100515.mail.kks.yahoo.co.jp>
	<alpine.LRH.2.03.1407052231160.8634@reclus.nhh.no>
	<75C8D19A1470D344A8AF5312F01160A602BC2BCC895F@GOMAIL.college.tcd.ie>
	<alpine.LRH.2.03.1407062340280.25352@reclus.nhh.no>
	<d1a929867ea04edab9501d80a267d34a@EX-0-HT0.lancs.local>
Message-ID: <CANVKczNx-OPqheTYMLWoMyUHiP08gMPUR=EMkgCF4vC+rMoiMQ@mail.gmail.com>

"Ten characters in field names should be enough for everyone" - Jack
Dangermond (ESRI founder and billionaire)

Okay, he didn't really say that (just as Bill Gates didn't say
something similar about 640K of RAM) but at some point someone decided
it was enough for DBF files.

So, you might want to think about not using shapefiles...

Alternatives include GML (which most modern GISs will read and write
but can be verbose and I've heard people swearing at it almost as much
as shapefiles) or SpatiaLite databases...

If your rgdal package has SQLite drivers then you can use SpatiaLite
databases now. eg:

writeOGR(scot, "scotland.sqlite","scot",driver = "SQLite",
dataset_options=c("SPATIALITE=yes"))

[note some options may have changed, I'm using a slightly old system here]

this creates a *single* file (win #1 over shapefiles) called
scotland.sqlite with a map layer in it, and preserves long field names
(win #2 over shapefiles). The SQLite database is an open standard
(that's a tie with shapefiles) but is being actively developed into a
wider geodatabase package standard (win #3 over shapefiles).

you can also store non-spatial data in it, since its a SQLite database
file (win #4 over shapefiles) and so send someone a whole bunch of
spatial and non-spatial data in a single file (win #5).

Spatialite DBs can be read in to QGIS and I think they can be read
into the leading proprietary GIS package (call that a tie too).

At the moment with rgdal I can't figure out how to add several layers
to a single Spatialite file or overwrite a single existing layer but I
suspect I'm just missing an option or two. I can just delete the
.sqlite file and recreate it, but that's an annoyance... Oh well,
there has to be one doesn't there?

Barry



On Mon, Jul 7, 2014 at 8:16 AM, James Rooney <ROONEYJ4 at tcd.ie> wrote:
> Hi Roger,
>
> Many thanks for your answer - very enlightening.
> Apologies I didn't realise the sessionInfo and other stuff would help.
> As it happens your explanation makes perfect sense - it is only after I started using some longer and similar field names that the behaviour changed. Knowing how it works now thanks to your explanation I should be able to avoid that. I will make changes and see if it works. If it doens't work I'll post back with all the version info etc.
>
> Many thanks,
> James
> ________________________________________
> From: Roger Bivand [Roger.Bivand at nhh.no]
> Sent: 06 July 2014 23:12
> To: James Rooney
> Cc: R-sig-Geo at r-project.org
> Subject: Re: [R-sig-Geo] rgdal writeOGR - clipping variable names
>
> On Sun, 6 Jul 2014, James Rooney wrote:
>
>> Hi all,
>>
>> I am using writeOGR to save ESRI shapefiles after a ton of processing.
>> Typical warning message I get is as follows:
>>
>>> writeOGR(ED, "/Users/jrooney/Documents/My Projects/ALS Spatial -
>>> Advanced/Irish Data/Processed Data/", layer="ED.cluster",driver="ESRI
>>> Shapefile",overwrite=T)
>> Warning message:
>> In writeOGR(ED, "/Users/jrooney/Documents/My Projects/ALS Spatial -
>> Advanced/Irish Data/Processed Data/", :
>>  Field names abbreviated for ESRI Shapefile driver
>>
>> Now it has been doing this all along. But lately it has changed. For
>> example - I frequently use the column id "GEOGID" as I've inherited it
>> somewhere along the line from some dataset I got somewhere.
>
> It would have helped if you gave the output of sessionInfo() - including
> the version of rgdal, and the startup messages on loading rgdal, as rgdal
> version, underlying GDAL version, and platform may make a difference. In
> addition, it would help to know how you installed rgdal.
>
> The warning and field-name abbreviation occurs in R/ogr_write.R after line
> 116, and has been present since mid-November 2011. This is based on:
>
> http://trac.osgeo.org/gdal/browser/trunk/gdal/ogr/ogrsf_frmts/shape/drv_shapefile.html
>
> after line 120, describing what GDAL does to field names, and trying to
> pre-empt this in R. As the OGR driver only supports names <= 10 characters
> long, the R code uses up to two passes of abbreviate() to shorten field
> names in data to be exported, first trying to get to minlength=7
> chararacters, and if this is insufficient, to minlength=5. Your case
> suggests that you now have so many similar field names over 10 characters
> long that abbreviate() no longer succeeds with a wish of minlength=7, so
> goes to minlength=5 - this would explain the change in behaviour.
>
> Testing each name separately rather than using abbreviate() on the vector
> of names would incur the further cost of checking for uniqueness - the
> function preserves uniqueness when strict=FALSE.
>
> The reason for the difficulty is that the underlying DBF format cannot be
> relied on to support field names > 10 characters long, so the OGR driver,
> and writeOGR(), are obliged to protect users from arbitrary shortening,
> which could lead to multiple fields having the same name. Some
> applications may permit longer names, but others do not, and those are the
> ones that set the limit.
>
> The only reliable resolution is to give your own variable/field names that
> are all <= 10 characters long if you use the ESRI Shapefile driver for
> exporting objects. You can handle this in scripts yourself by looking at
> nchar(names(<obj>)), and abbreviating uniquely any that are longer.
>
> Note that there are also substantial encoding challenges in the DBF format
> too, although I don't think that this is affecting nchar() here - keeping
> to ASCII (always single byte) in field names with an archaic format like
> DBF may be judicious.
>
> Hope this clarifies,
>
> Roger
>
>> Until recently it was happily saving this column name in its entireity.
>> Lately, for some mystery reason it is not saving it fully and only
>> saving 5 letters - "GEOGI". This, as you can imagine is causing me
>> troubles.
>>
>> Anyhow - why are field names so short for ESRI shapfiles and why does it sometimes accept 6 letter fields and other times not ? It would be great if it would allow longer field names, as 5 letters is not alot when you have over 100 variables - it gets confusing even when you use codes.
>>
>> Many thanks,
>> James
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> --
> Roger Bivand
> Department of Economics, Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; fax +47 55 95 91 00
> e-mail: Roger.Bivand at nhh.no
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From johannesradinger at gmail.com  Mon Jul  7 13:30:48 2014
From: johannesradinger at gmail.com (Johannes Radinger)
Date: Mon, 7 Jul 2014 13:30:48 +0200
Subject: [R-sig-Geo] Spatial clustering of points based on max. euclidian
	distance
Message-ID: <CABsGe_zLc3b7Okr8XXr+ZXkVgM_Q6CNQ_MtW5PK6h5EMqoxccA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140707/2e03f30c/attachment.pl>

From ROONEYJ4 at tcd.ie  Mon Jul  7 13:35:29 2014
From: ROONEYJ4 at tcd.ie (James Rooney)
Date: Mon, 7 Jul 2014 12:35:29 +0100
Subject: [R-sig-Geo] rgdal writeOGR - clipping variable names
In-Reply-To: <CANVKczNx-OPqheTYMLWoMyUHiP08gMPUR=EMkgCF4vC+rMoiMQ@mail.gmail.com>
References: <80822.29460.qm@web100515.mail.kks.yahoo.co.jp>
	<alpine.LRH.2.03.1407052231160.8634@reclus.nhh.no>
	<75C8D19A1470D344A8AF5312F01160A602BC2BCC895F@GOMAIL.college.tcd.ie>
	<alpine.LRH.2.03.1407062340280.25352@reclus.nhh.no>
	<d1a929867ea04edab9501d80a267d34a@EX-0-HT0.lancs.local>,
	<CANVKczNx-OPqheTYMLWoMyUHiP08gMPUR=EMkgCF4vC+rMoiMQ@mail.gmail.com>
Message-ID: <75C8D19A1470D344A8AF5312F01160A602BC2BCC8961@GOMAIL.college.tcd.ie>

Haha thanks very much for the comparison.

Hmm it is something I shall have to think about. There was some reason I decided to use shapefiles that escapes my memory. Apart from that at I'm kind of invested now - if I change it could be a nightmare to trace through the workflow.
However - I take your thoughts on board and will think about it if a natural breakpoint in the work to make such a change presents itself!

Thanks again,

James
________________________________________
From: b.rowlingson at gmail.com [b.rowlingson at gmail.com] On Behalf Of Barry Rowlingson [b.rowlingson at lancaster.ac.uk]
Sent: 07 July 2014 09:44
To: James Rooney
Cc: R-sig-Geo at r-project.org
Subject: Re: [R-sig-Geo] rgdal writeOGR - clipping variable names

"Ten characters in field names should be enough for everyone" - Jack
Dangermond (ESRI founder and billionaire)

Okay, he didn't really say that (just as Bill Gates didn't say
something similar about 640K of RAM) but at some point someone decided
it was enough for DBF files.

So, you might want to think about not using shapefiles...

Alternatives include GML (which most modern GISs will read and write
but can be verbose and I've heard people swearing at it almost as much
as shapefiles) or SpatiaLite databases...

If your rgdal package has SQLite drivers then you can use SpatiaLite
databases now. eg:

writeOGR(scot, "scotland.sqlite","scot",driver = "SQLite",
dataset_options=c("SPATIALITE=yes"))

[note some options may have changed, I'm using a slightly old system here]

this creates a *single* file (win #1 over shapefiles) called
scotland.sqlite with a map layer in it, and preserves long field names
(win #2 over shapefiles). The SQLite database is an open standard
(that's a tie with shapefiles) but is being actively developed into a
wider geodatabase package standard (win #3 over shapefiles).

you can also store non-spatial data in it, since its a SQLite database
file (win #4 over shapefiles) and so send someone a whole bunch of
spatial and non-spatial data in a single file (win #5).

Spatialite DBs can be read in to QGIS and I think they can be read
into the leading proprietary GIS package (call that a tie too).

At the moment with rgdal I can't figure out how to add several layers
to a single Spatialite file or overwrite a single existing layer but I
suspect I'm just missing an option or two. I can just delete the
.sqlite file and recreate it, but that's an annoyance... Oh well,
there has to be one doesn't there?

Barry



On Mon, Jul 7, 2014 at 8:16 AM, James Rooney <ROONEYJ4 at tcd.ie> wrote:
> Hi Roger,
>
> Many thanks for your answer - very enlightening.
> Apologies I didn't realise the sessionInfo and other stuff would help.
> As it happens your explanation makes perfect sense - it is only after I started using some longer and similar field names that the behaviour changed. Knowing how it works now thanks to your explanation I should be able to avoid that. I will make changes and see if it works. If it doens't work I'll post back with all the version info etc.
>
> Many thanks,
> James
> ________________________________________
> From: Roger Bivand [Roger.Bivand at nhh.no]
> Sent: 06 July 2014 23:12
> To: James Rooney
> Cc: R-sig-Geo at r-project.org
> Subject: Re: [R-sig-Geo] rgdal writeOGR - clipping variable names
>
> On Sun, 6 Jul 2014, James Rooney wrote:
>
>> Hi all,
>>
>> I am using writeOGR to save ESRI shapefiles after a ton of processing.
>> Typical warning message I get is as follows:
>>
>>> writeOGR(ED, "/Users/jrooney/Documents/My Projects/ALS Spatial -
>>> Advanced/Irish Data/Processed Data/", layer="ED.cluster",driver="ESRI
>>> Shapefile",overwrite=T)
>> Warning message:
>> In writeOGR(ED, "/Users/jrooney/Documents/My Projects/ALS Spatial -
>> Advanced/Irish Data/Processed Data/", :
>>  Field names abbreviated for ESRI Shapefile driver
>>
>> Now it has been doing this all along. But lately it has changed. For
>> example - I frequently use the column id "GEOGID" as I've inherited it
>> somewhere along the line from some dataset I got somewhere.
>
> It would have helped if you gave the output of sessionInfo() - including
> the version of rgdal, and the startup messages on loading rgdal, as rgdal
> version, underlying GDAL version, and platform may make a difference. In
> addition, it would help to know how you installed rgdal.
>
> The warning and field-name abbreviation occurs in R/ogr_write.R after line
> 116, and has been present since mid-November 2011. This is based on:
>
> http://trac.osgeo.org/gdal/browser/trunk/gdal/ogr/ogrsf_frmts/shape/drv_shapefile.html
>
> after line 120, describing what GDAL does to field names, and trying to
> pre-empt this in R. As the OGR driver only supports names <= 10 characters
> long, the R code uses up to two passes of abbreviate() to shorten field
> names in data to be exported, first trying to get to minlength=7
> chararacters, and if this is insufficient, to minlength=5. Your case
> suggests that you now have so many similar field names over 10 characters
> long that abbreviate() no longer succeeds with a wish of minlength=7, so
> goes to minlength=5 - this would explain the change in behaviour.
>
> Testing each name separately rather than using abbreviate() on the vector
> of names would incur the further cost of checking for uniqueness - the
> function preserves uniqueness when strict=FALSE.
>
> The reason for the difficulty is that the underlying DBF format cannot be
> relied on to support field names > 10 characters long, so the OGR driver,
> and writeOGR(), are obliged to protect users from arbitrary shortening,
> which could lead to multiple fields having the same name. Some
> applications may permit longer names, but others do not, and those are the
> ones that set the limit.
>
> The only reliable resolution is to give your own variable/field names that
> are all <= 10 characters long if you use the ESRI Shapefile driver for
> exporting objects. You can handle this in scripts yourself by looking at
> nchar(names(<obj>)), and abbreviating uniquely any that are longer.
>
> Note that there are also substantial encoding challenges in the DBF format
> too, although I don't think that this is affecting nchar() here - keeping
> to ASCII (always single byte) in field names with an archaic format like
> DBF may be judicious.
>
> Hope this clarifies,
>
> Roger
>
>> Until recently it was happily saving this column name in its entireity.
>> Lately, for some mystery reason it is not saving it fully and only
>> saving 5 letters - "GEOGI". This, as you can imagine is causing me
>> troubles.
>>
>> Anyhow - why are field names so short for ESRI shapfiles and why does it sometimes accept 6 letter fields and other times not ? It would be great if it would allow longer field names, as 5 letters is not alot when you have over 100 variables - it gets confusing even when you use codes.
>>
>> Many thanks,
>> James
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> --
> Roger Bivand
> Department of Economics, Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; fax +47 55 95 91 00
> e-mail: Roger.Bivand at nhh.no
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From nevil.amos at gmail.com  Mon Jul  7 15:52:06 2014
From: nevil.amos at gmail.com (nevil amos)
Date: Mon, 7 Jul 2014 23:52:06 +1000
Subject: [R-sig-Geo] raster::ratify and as.factor Error in 1:ncol(r) :
 argument of length with raster read from large tif
Message-ID: <CAN9eD7=XUmTL0Muaq6XhGG0dTJn5+dtN=RR2AJRjRN61P1Ecgg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140707/bd0b437c/attachment.pl>

From etiss18 at gmail.com  Mon Jul  7 06:54:04 2014
From: etiss18 at gmail.com (etiss18)
Date: Sun, 7 Jul 2014 04:54:04 +0000
Subject: [R-sig-Geo] (no subject)
Message-ID: <ef9f5cd9b93c$ec83879f$7da40abe$@gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140707/53faeafe/attachment.pl>

From veroandreo at gmail.com  Mon Jul  7 18:31:31 2014
From: veroandreo at gmail.com (Veronica Andreo)
Date: Mon, 7 Jul 2014 13:31:31 -0300
Subject: [R-sig-Geo] write.tgrass (spacetime) does not create init.txt
Message-ID: <CAAMki4EuOXFUCj0Md0E-9jawkYjai=Erw527xpbX6s5_R78wyg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140707/e687d1f9/attachment.pl>

From edzer.pebesma at uni-muenster.de  Mon Jul  7 18:46:58 2014
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Mon, 07 Jul 2014 18:46:58 +0200
Subject: [R-sig-Geo] write.tgrass (spacetime) does not create init.txt
In-Reply-To: <CAAMki4EuOXFUCj0Md0E-9jawkYjai=Erw527xpbX6s5_R78wyg@mail.gmail.com>
References: <CAAMki4EuOXFUCj0Md0E-9jawkYjai=Erw527xpbX6s5_R78wyg@mail.gmail.com>
Message-ID: <53BACF02.8010700@uni-muenster.de>

Thanks for the clear report, Veronica.

Soeren (Cc:), do you know where we can find a description of the
requirements, or examples, of the init.txt file?

On 07/07/2014 06:31 PM, Veronica Andreo wrote:
> Hi list
> 
> I'm using R to run some processing over a spatio-temporal raster dataset
> coming from GRASS. The workflow is as follows:
> 
> 1. Export all my images from GRASS with t.rast.export
> 2. Import them as a raster stack in R with read.tgrass
> 3. do the processing... which implies converting the rasterstack into a
> matrix, transposing and running dineof
> 4. create the rasterstack again, add the time with setZ
> 5. export with write.tgrass (which only seems to work for RasterStack and
> not for STFDF, i tried both ways)
> 6. and import to grass again...
> 
> here is where I get the error since an init.txt file with the following
> information is needed but it's not created by write.tgrass...
> 
> stds_type=strds
> format=GTiff
> temporal_type=absolute
> semantic_type=mean
> number_of_maps=
> north=
> south=
> east=
> west=
> 
> There are of course some workarounds but it would be nice -and much more
> straightforward- that the function which is intended to provide interface
> between R and T-GRASS, already does the job itself :)
> 
> Thanks much!
> 
> Best,
> Vero
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
83 33081 http://ifgi.uni-muenster.de GPG key ID 0xAC227795

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 490 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140707/e6934df7/attachment.bin>

From soerengebbert at googlemail.com  Mon Jul  7 18:57:17 2014
From: soerengebbert at googlemail.com (=?UTF-8?Q?S=C3=B6ren_Gebbert?=)
Date: Mon, 7 Jul 2014 18:57:17 +0200
Subject: [R-sig-Geo] write.tgrass (spacetime) does not create init.txt
In-Reply-To: <53BACF02.8010700@uni-muenster.de>
References: <CAAMki4EuOXFUCj0Md0E-9jawkYjai=Erw527xpbX6s5_R78wyg@mail.gmail.com>
	<53BACF02.8010700@uni-muenster.de>
Message-ID: <CAPHDReKONfszhz01LLEE5KhUYRZF=JweSmV=hPHoCk5d-c2VHA@mail.gmail.com>

Hi,
init.txt has the following content:

temporal_type=absolute
semantic_type=mean
relative_time_unit=years
number_of_maps=61
north=75.5
south=25.25
east=75.5
west=-40.5

The spatial extent is ignored while importing, but the temporal type,
semantic type (still a dummy in TGRASS) and the number of maps must be
provided. The relative time unit is mandatory if the dataset has
relative time, otherwise it can be left out.

I noticed that the reader expects always absolute time, is it possible
to support relative time as well?


Best regards
Soeren

2014-07-07 18:46 GMT+02:00 Edzer Pebesma <edzer.pebesma at uni-muenster.de>:
> Thanks for the clear report, Veronica.
>
> Soeren (Cc:), do you know where we can find a description of the
> requirements, or examples, of the init.txt file?
>
> On 07/07/2014 06:31 PM, Veronica Andreo wrote:
>> Hi list
>>
>> I'm using R to run some processing over a spatio-temporal raster dataset
>> coming from GRASS. The workflow is as follows:
>>
>> 1. Export all my images from GRASS with t.rast.export
>> 2. Import them as a raster stack in R with read.tgrass
>> 3. do the processing... which implies converting the rasterstack into a
>> matrix, transposing and running dineof
>> 4. create the rasterstack again, add the time with setZ
>> 5. export with write.tgrass (which only seems to work for RasterStack and
>> not for STFDF, i tried both ways)
>> 6. and import to grass again...
>>
>> here is where I get the error since an init.txt file with the following
>> information is needed but it's not created by write.tgrass...
>>
>> stds_type=strds
>> format=GTiff
>> temporal_type=absolute
>> semantic_type=mean
>> number_of_maps=
>> north=
>> south=
>> east=
>> west=
>>
>> There are of course some workarounds but it would be nice -and much more
>> straightforward- that the function which is intended to provide interface
>> between R and T-GRASS, already does the job itself :)
>>
>> Thanks much!
>>
>> Best,
>> Vero
>>
>>       [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> --
> Edzer Pebesma
> Institute for Geoinformatics (ifgi), University of M?nster
> Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
> 83 33081 http://ifgi.uni-muenster.de GPG key ID 0xAC227795
>


From aeldeiry at rams.colostate.edu  Mon Jul  7 20:44:08 2014
From: aeldeiry at rams.colostate.edu (Ahmed Eldeiry)
Date: Mon, 7 Jul 2014 12:44:08 -0600
Subject: [R-sig-Geo] help
Message-ID: <CAJMgfGUGYuBn+G60Qq68UcY6YAAXUny76oXtRS3hxk=hwe+X5w@mail.gmail.com>

The attached file contains collected soil salinity samples and extracted
pixels values from Ikonos image.
I am trying to interpolate soil salinity data and use regression models
with the axillary data

I created a grid as follows:
mydata <- read.table("C:............//mydata.txt", header = TRUE)
coordinates(mydata) <- c("x", "y")
diff(sort(unique(coordinates(mydata)[,2])))
diff(sort(unique(coordinates(mydata)[,1])))
bb = bbox(mydata)
mydata.gt = GridTopology(c(bb[1,1],bb[2,1]), c(30,30),
round(c(diff(bb[1,]), diff(bb[2,]))/30) + 1)
plot(mydata)
plot(SpatialGrid(mydata.gt),col='red',add=T)
mydata.sg = SpatialGrid(mydata.gt)
fullgrid(mydata.sg)=F
mydata.grid = SpatialPixelsDataFrame(mydata.sg, data.frame(x = rep(NA,
8*15))

This above grid works fine with simple and ordinary kriging, however, I got
this error when using universal kriging or linear model:

salinity.uk <- krige(salinity~ndvi, mydata, mydata.grid, vt.fit)  #### UK

salinity.lm <- lm(salinity~ndvi, mydata)         #### LM
mydata.grid$pred <- predict(sal.lm, mydata.grid)

*Error in eval(expr, envir, enclos) : object 'ndvi' not found*

Therefore, I created another grid that contains the whole data as follows:

mydata_g <- read.table("C:............//mydata.txt", header = TRUE)
coordinates(mydata_g) <- ~ x+y
rast <- raster(ncol =8, nrow=15)
extent(rast) <- extent(mydata_g)
rasterize(mydata_g, rast, mydata_g$salinity, c(30,30), fun = mean)
gridded(mydata_g) <- TRUE









*Warning messages:1: In points2grid(points, tolerance, round) :  grid has
empty column/rows in dimension 12: In points2grid(points, tolerance, round)
:  grid topology may be corrupt in dimension 13: In points2grid(points,
tolerance, round) :  grid has empty column/rows in dimension 24: In
points2grid(points, tolerance, round) :  grid topology may be corrupt in
dimension 2*

fullgrid(mydata_g) <- F
plot(f40_g)    ### it is empty

I would appreciate if someone could help me how to create a grid that
contains the rest of columns beside x and y coordinates and also displays
only the shape of the field which has the following coordinates
list(x=c(621606,621685,621685,621606,621606),y=c(4211472,4211472,4211396,4211396,4211472))

Best Regards,
Ahmed
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140707/cf2515a4/attachment.html>
-------------- next part --------------
x	y	salinity	blue	green	red	near	ndvi
621564	4211184	3.6	505	584	501	790	0.22
621592	4211182	4	409	469	319	1025	0.53
621632	4211180	3.6	426	495	347	995	0.48
621650	4211217	4.2	415	452	317	948	0.5
621614	4211219	3.6	416	461	334	950	0.48
621569	4211222	3.1	441	492	374	838	0.38
621571	4211268	4.7	428	480	357	878	0.42
621611	4211265	6.6	417	453	319	981	0.51
621663	4211262	3.8	412	450	311	1014	0.53
621689	4211301	6.2	416	441	308	1000	0.53
621648	4211304	6.1	434	491	369	903	0.42
621608	4211307	6.4	421	482	351	912	0.44
621564	4211310	3.6	430	459	338	931	0.47
621567	4211354	4	414	451	331	923	0.47
621611	4211351	5.4	406	449	321	938	0.49
621653	4211348	7.7	453	514	417	903	0.37
621706	4211344	5.6	423	471	336	976	0.49
621739	4211387	7.4	435	501	399	874	0.37
621693	4211391	10.6	543	675	644	750	0.08
621640	4211394	10.7	463	551	463	822	0.28
621578	4211399	8.2	414	463	350	885	0.43
621564	4211446	3.2	425	474	368	841	0.39
621619	4211441	9.4	439	495	411	690	0.25
621674	4211437	9.2	464	553	482	688	0.18
621727	4211434	8	463	546	461	741	0.23
621774	4211430	4.8	435	498	400	811	0.34
621777	4211476	5.7	444	496	388	751	0.32
621717	4211480	7.2	478	566	513	607	0.08
621666	4211484	7.9	460	549	471	708	0.2
621616	4211488	5.6	417	467	348	784	0.39
621565	4211491	3.1	428	506	395	921	0.4
621624	4211534	7.8	466	541	471	717	0.21
621678	4211530	8.2	514	622	586	670	0.07
621746	4211526	8	501	580	521	609	0.08
621772	4211524	5.2	485	548	449	733	0.24
621770	4211571	3.6	503	559	460	690	0.2
621713	4211576	4.5	471	530	421	716	0.26
621662	4211579	4	475	547	468	691	0.19
621611	4211583	3.8	434	481	382	781	0.34
621566	4211586	3	486	583	491	906	0.3
621556	4211596	3.2	501	638	611	810	0.14
621612	4211592	3.7	446	490	408	722	0.28
621658	4211589	7.9	484	547	455	701	0.21
621712	4211585	5.6	471	526	417	741	0.28
621768	4211581	5.4	510	568	460	699	0.21
621771	4211527	6.5	470	535	403	810	0.34
621720	4211528	9.2	492	582	527	622	0.08
621670	4211531	11.3	497	603	554	667	0.09
621622	4211535	10.8	458	536	445	702	0.22
621569	4211538	5.3	439	481	343	924	0.46
621568	4211483	4	424	487	356	843	0.41
621620	4211479	10.1	425	478	359	796	0.38
621668	4211476	11.5	472	554	478	652	0.15
621719	4211472	10.3	485	565	497	601	0.09
621769	4211469	5	446	499	380	794	0.35
621763	4211398	3.6	425	472	364	898	0.42
621708	4211402	11.9	514	645	582	757	0.13
621660	4211406	11.3	500	597	522	809	0.22
621614	4211409	12.2	471	542	449	813	0.29
621570	4211411	8.5	438	493	392	822	0.35
621563	4211364	4.8	416	469	356	887	0.43
621612	4211360	5.7	423	462	347	887	0.44
621663	4211356	10.1	465	540	444	889	0.33
621710	4211353	7.1	456	526	405	927	0.39
621693	4211299	7.5	415	446	315	984	0.52
621650	4211302	8	427	471	341	923	0.46
621603	4211305	7.4	437	488	369	896	0.42
621572	4211308	4.5	407	445	317	963	0.5
621568	4211260	4.8	437	491	372	833	0.38
621611	4211257	5.1	419	458	322	997	0.51
621662	4211254	4.2	415	451	316	983	0.51
621650	4211208	3.7	411	447	309	950	0.51
621609	4211211	3.4	416	461	323	923	0.48
621573	4211213	3.5	427	467	341	933	0.46
621571	4211193	3.5	441	505	404	851	0.36
621610	4211190	4	432	491	363	926	0.44
621640	4211188	4.7	429	482	377	871	0.4
621628	4211173	4.6	409	452	302	1137	0.58
621599	4211176	3.8	415	463	320	1016	0.52
621565	4211177	4.2	552	688	657	772	0.08

From Lee.Hachadoorian+L at gmail.com  Mon Jul  7 21:26:42 2014
From: Lee.Hachadoorian+L at gmail.com (Lee Hachadoorian)
Date: Mon, 7 Jul 2014 15:26:42 -0400
Subject: [R-sig-Geo] rgdal writeOGR - clipping variable names
In-Reply-To: <CANVKczNx-OPqheTYMLWoMyUHiP08gMPUR=EMkgCF4vC+rMoiMQ@mail.gmail.com>
References: <80822.29460.qm@web100515.mail.kks.yahoo.co.jp>
	<alpine.LRH.2.03.1407052231160.8634@reclus.nhh.no>
	<75C8D19A1470D344A8AF5312F01160A602BC2BCC895F@GOMAIL.college.tcd.ie>
	<alpine.LRH.2.03.1407062340280.25352@reclus.nhh.no>
	<d1a929867ea04edab9501d80a267d34a@EX-0-HT0.lancs.local>
	<CANVKczNx-OPqheTYMLWoMyUHiP08gMPUR=EMkgCF4vC+rMoiMQ@mail.gmail.com>
Message-ID: <CANnCtnLe40NK=kfqOSRGJy+HeX-oJ1SZridHVSptVZ8gHW5-1g@mail.gmail.com>

On Mon, Jul 7, 2014 at 4:44 AM, Barry Rowlingson
<b.rowlingson at lancaster.ac.uk> wrote:

> At the moment with rgdal I can't figure out how to add several layers
> to a single Spatialite file or overwrite a single existing layer but I
> suspect I'm just missing an option or two. I can just delete the
> .sqlite file and recreate it, but that's an annoyance... Oh well,
> there has to be one doesn't there?
>
> Barry
>

Interesting. This can be done at the terminal with ogr2ogr, but
requires the -update switch. ogr2ogr requires the -update switch to
add a layer to a SpatiaLite file, but not to PostGIS. Hence, writeOGR
can add layers to PostGIS but not to SpatiaLite.

I don't think there's any way to pass the -update switch via writeOGR,
as it is not a dataset creation option or layer creation option.

Best,
--Lee


From jbechara at lri-lb.org  Tue Jul  8 16:31:26 2014
From: jbechara at lri-lb.org (JOSEPH BECHARA)
Date: Tue, 8 Jul 2014 17:31:26 +0300
Subject: [R-sig-Geo] reading a feature class
Message-ID: <000001cf9ab9$4cd4de80$e67e9b80$@lri-lb.org>

Dear All,

 

I 'm trying ti import a feature class from a gdb to R using readOGR.

Unfortunately it is not working.

Anybody has a suggestion of a function to read it.

 

 

JOSEPH BECHARA

Wildfire Management Component Coordinator

Ashrafieh 1020 Building, 8th floor, Mathaf, Beirut, Lebanon

Tel.: +961 (1) 426630-1-2

Fax: +961 (1) 426631

Mail:  <mailto:jbejjani at lri-lb.org> jbechara at lri-lb.org

 <http://www.lri-lb.org/> www.lri-lb.org

Description: Description: LRI-logo-Email

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140708/12451d67/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/jpeg
Size: 16370 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140708/12451d67/attachment.jpe>

From frtog at vestas.com  Tue Jul  8 17:12:33 2014
From: frtog at vestas.com (=?Windows-1252?Q?Frede_Aakmann_T=F8gersen?=)
Date: Tue, 8 Jul 2014 17:12:33 +0200
Subject: [R-sig-Geo] reading a feature class
Message-ID: <vhhfft2qouxhtwv854ak6vob.1404832348824@email.android.com>

Hi

I don't know the gdb file format. Is it in raster or vector format?

Since you used readOGR you probably did have a look at

http://www.gdal.org/ogr_formats.html

before asking.

So there, two ESRI formats are mentioned: personal gdb (old) and file gdb (new?).

Do you what kind of gdb file you have?

Why you can't read the file could be because of several problems.

Is the file corrupted?

What is your OS?

What version of R/rgdal?

Does the OS/R/rgdal combination involves formats for either pgdb or filegdb?

Nobody can help you with that little information you have given us.

Br.

Frede


Sendt fra Samsung mobil


-------- Oprindelig meddelelse --------
Fra: JOSEPH BECHARA
Dato:08/07/2014 16.35 (GMT+01:00)
Til: r-sig-geo at r-project.org
Emne: [R-sig-Geo] reading a feature class

Dear All,

I ?m trying ti import a feature class from a gdb to R using readOGR.
Unfortunately it is not working.
Anybody has a suggestion of a function to read it.


JOSEPH BECHARA
Wildfire Management Component Coordinator
Ashrafieh 1020 Building, 8th floor, Mathaf, Beirut, Lebanon
Tel.: +961 (1) 426630-1-2
Fax: +961 (1) 426631
Mail: jbechara at lri-lb.org<mailto:jbejjani at lri-lb.org>
www.lri-lb.org<http://www.lri-lb.org/>
[cid:image001.jpg at 01CF9AD2.72028090]

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140708/d992d957/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.jpg
Type: image/jpeg
Size: 16370 bytes
Desc: image001.jpg
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140708/d992d957/attachment.jpg>

From jbechara at lri-lb.org  Wed Jul  9 08:58:27 2014
From: jbechara at lri-lb.org (JOSEPH BECHARA)
Date: Wed, 9 Jul 2014 09:58:27 +0300
Subject: [R-sig-Geo] reading a feature class
In-Reply-To: <vhhfft2qouxhtwv854ak6vob.1404832348824@email.android.com>
References: <vhhfft2qouxhtwv854ak6vob.1404832348824@email.android.com>
Message-ID: <000001cf9b43$307cc0b0$91764210$@lri-lb.org>

Dear Frede, 

 

Thanks for your reply.

 

This is the function that is not working

bb<-readOGR(dsn="C:/sophie/Allpoints/All_poly.gdb",layer="All_lays1")

 

All lays is a feature class in a file gdb(new) .

The file is not corrupted I?m able to open it on ARCIS and I?m doing the
zonal statisctics there.

I opened the rgdal library and I?m using R studio 

Rgdal version 0.8-16

 

JOSEPH BECHARA

Wildfire Management Component Coordinator

Ashrafieh 1020 Building, 8th floor, Mathaf, Beirut, Lebanon

Tel.: +961 (1) 426630-1-2

Fax: +961 (1) 426631

Mail:  <mailto:jbejjani at lri-lb.org> jbechara at lri-lb.org

 <http://www.lri-lb.org/> www.lri-lb.org

Description: Description: LRI-logo-Email

 

From: Frede Aakmann T?gersen [mailto:frtog at vestas.com] 
Sent: Tuesday, July 08, 2014 6:13 PM
To: JOSEPH BECHARA; r-sig-geo at r-project.org
Subject: RE: [R-sig-Geo] reading a feature class

 

Hi

 

I don't know the gdb file format. Is it in raster or vector format?

 

Since you used readOGR you probably did have a look at

 

http://www.gdal.org/ogr_formats.html

 

before asking. 

 

So there, two ESRI formats are mentioned: personal gdb (old) and file gdb
(new?).

 

Do you what kind of gdb file you have?

 

Why you can't read the file could be because of several problems. 

 

Is the file corrupted?

 

What is your OS?

 

What version of R/rgdal?

 

Does the OS/R/rgdal combination involves formats for either pgdb or filegdb?

 

Nobody can help you with that little information you have given us. 

 

Br.

 

Frede

 

 

Sendt fra Samsung mobil



-------- Oprindelig meddelelse --------
Fra: JOSEPH BECHARA 
Dato:08/07/2014 16.35 (GMT+01:00) 
Til: r-sig-geo at r-project.org 
Emne: [R-sig-Geo] reading a feature class 

Dear All,

 

I ?m trying ti import a feature class from a gdb to R using readOGR.

Unfortunately it is not working.

Anybody has a suggestion of a function to read it.

 

 

JOSEPH BECHARA

Wildfire Management Component Coordinator

Ashrafieh 1020 Building, 8th floor, Mathaf, Beirut, Lebanon

Tel.: +961 (1) 426630-1-2

Fax: +961 (1) 426631

Mail:  <mailto:jbejjani at lri-lb.org> jbechara at lri-lb.org

 <http://www.lri-lb.org/> www.lri-lb.org

Description: Description: LRI-logo-Email

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140709/390672a5/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/jpeg
Size: 16370 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140709/390672a5/attachment.jpe>

From frtog at vestas.com  Wed Jul  9 10:47:57 2014
From: frtog at vestas.com (=?Windows-1252?Q?Frede_Aakmann_T=F8gersen?=)
Date: Wed, 9 Jul 2014 10:47:57 +0200
Subject: [R-sig-Geo] reading a feature class
Message-ID: <jr3vh8rmcxj0axqol5mejg73.1404895671537@email.android.com>

Hi Joseph

If you email me or otherwise make it available to me and/or the list then I'll have a look at it.

Br. Frede


Sendt fra Samsung mobil


-------- Oprindelig meddelelse --------
Fra: JOSEPH BECHARA
Dato:09/07/2014 08.58 (GMT+01:00)
Til: Frede Aakmann T?gersen ,r-sig-geo at r-project.org
Emne: RE: [R-sig-Geo] reading a feature class

Dear Frede,

Thanks for your reply.

This is the function that is not working
bb<-readOGR(dsn="C:/sophie/Allpoints/All_poly.gdb",layer="All_lays1")

All lays is a feature class in a file gdb(new) .
The file is not corrupted I?m able to open it on ARCIS and I?m doing the zonal statisctics there.
I opened the rgdal library and I?m using R studio
Rgdal version 0.8-16

JOSEPH BECHARA
Wildfire Management Component Coordinator
Ashrafieh 1020 Building, 8th floor, Mathaf, Beirut, Lebanon
Tel.: +961 (1) 426630-1-2
Fax: +961 (1) 426631
Mail: jbechara at lri-lb.org<mailto:jbejjani at lri-lb.org>
www.lri-lb.org<http://www.lri-lb.org/>
[cid:image001.jpg at 01CF9B5A.A7B80290]

From: Frede Aakmann T?gersen [mailto:frtog at vestas.com]
Sent: Tuesday, July 08, 2014 6:13 PM
To: JOSEPH BECHARA; r-sig-geo at r-project.org
Subject: RE: [R-sig-Geo] reading a feature class

Hi

I don't know the gdb file format. Is it in raster or vector format?

Since you used readOGR you probably did have a look at

http://www.gdal.org/ogr_formats.html

before asking.

So there, two ESRI formats are mentioned: personal gdb (old) and file gdb (new?).

Do you what kind of gdb file you have?

Why you can't read the file could be because of several problems.

Is the file corrupted?

What is your OS?

What version of R/rgdal?

Does the OS/R/rgdal combination involves formats for either pgdb or filegdb?

Nobody can help you with that little information you have given us.

Br.

Frede


Sendt fra Samsung mobil


-------- Oprindelig meddelelse --------
Fra: JOSEPH BECHARA
Dato:08/07/2014 16.35 (GMT+01:00)
Til: r-sig-geo at r-project.org<mailto:r-sig-geo at r-project.org>
Emne: [R-sig-Geo] reading a feature class
Dear All,

I ?m trying ti import a feature class from a gdb to R using readOGR.
Unfortunately it is not working.
Anybody has a suggestion of a function to read it.


JOSEPH BECHARA
Wildfire Management Component Coordinator
Ashrafieh 1020 Building, 8th floor, Mathaf, Beirut, Lebanon
Tel.: +961 (1) 426630-1-2
Fax: +961 (1) 426631
Mail: jbechara at lri-lb.org<mailto:jbejjani at lri-lb.org>
www.lri-lb.org<http://www.lri-lb.org/>
[cid:image001.jpg at 01CF9B5A.A7B80290]

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140709/a86f3ce5/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.jpg
Type: image/jpeg
Size: 16370 bytes
Desc: image001.jpg
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140709/a86f3ce5/attachment.jpg>

From mdsumner at gmail.com  Wed Jul  9 11:34:13 2014
From: mdsumner at gmail.com (Michael Sumner)
Date: Wed, 9 Jul 2014 19:34:13 +1000
Subject: [R-sig-Geo] reading a feature class
In-Reply-To: <000001cf9b43$307cc0b0$91764210$@lri-lb.org>
References: <vhhfft2qouxhtwv854ak6vob.1404832348824@email.android.com>
	<000001cf9b43$307cc0b0$91764210$@lri-lb.org>
Message-ID: <CAAcGz98NKuTvMEt=jtzF7B-JKHy6gThpxxnvXnb=pCJUS9u-mA@mail.gmail.com>

Try

ogrListLayers( dsn="C:/sophie/Allpoints/All_poly.gdb")

that should give you the right layer name/s for use with readOGR
On 9 Jul 2014 16:59, "JOSEPH BECHARA" <jbechara at lri-lb.org> wrote:

> Dear Frede,
>
>
>
> Thanks for your reply.
>
>
>
> This is the function that is not working
>
> bb<-readOGR(dsn="C:/sophie/Allpoints/All_poly.gdb",layer="All_lays1")
>
>
>
> All lays is a feature class in a file gdb(new) .
>
> The file is not corrupted I?m able to open it on ARCIS and I?m doing the
> zonal statisctics there.
>
> I opened the rgdal library and I?m using R studio
>
> Rgdal version 0.8-16
>
>
>
> *JOSEPH BECHARA*
>
> *Wildfire Management Component Coordinator*
>
> Ashrafieh 1020 Building, 8th floor, Mathaf, Beirut, Lebanon
>
> Tel.: +961 (1) 426630-1-2
>
> Fax: +961 (1) 426631
>
> Mail: jbechara at lri-lb.org <jbejjani at lri-lb.org>
>
> www.lri-lb.org
>
> [image: Description: Description: LRI-logo-Email]
>
>
>
> *From:* Frede Aakmann T?gersen [mailto:frtog at vestas.com]
> *Sent:* Tuesday, July 08, 2014 6:13 PM
> *To:* JOSEPH BECHARA; r-sig-geo at r-project.org
> *Subject:* RE: [R-sig-Geo] reading a feature class
>
>
>
> Hi
>
>
>
> I don't know the gdb file format. Is it in raster or vector format?
>
>
>
> Since you used readOGR you probably did have a look at
>
>
>
> http://www.gdal.org/ogr_formats.html
>
>
>
> before asking.
>
>
>
> So there, two ESRI formats are mentioned: personal gdb (old) and file gdb
> (new?).
>
>
>
> Do you what kind of gdb file you have?
>
>
>
> Why you can't read the file could be because of several problems.
>
>
>
> Is the file corrupted?
>
>
>
> What is your OS?
>
>
>
> What version of R/rgdal?
>
>
>
> Does the OS/R/rgdal combination involves formats for either pgdb or
> filegdb?
>
>
>
> Nobody can help you with that little information you have given us.
>
>
>
> Br.
>
>
>
> Frede
>
>
>
>
>
> Sendt fra Samsung mobil
>
>
>
> -------- Oprindelig meddelelse --------
> Fra: JOSEPH BECHARA
> Dato:08/07/2014 16.35 (GMT+01:00)
> Til: r-sig-geo at r-project.org
> Emne: [R-sig-Geo] reading a feature class
>
> Dear All,
>
>
>
> I ?m trying ti import a feature class from a gdb to R using readOGR.
>
> Unfortunately it is not working.
>
> Anybody has a suggestion of a function to read it.
>
>
>
>
>
> *JOSEPH BECHARA*
>
> *Wildfire Management Component Coordinator*
>
> Ashrafieh 1020 Building, 8th floor, Mathaf, Beirut, Lebanon
>
> Tel.: +961 (1) 426630-1-2
>
> Fax: +961 (1) 426631
>
> Mail: jbechara at lri-lb.org <jbejjani at lri-lb.org>
>
> www.lri-lb.org
>
> [image: Description: Description: LRI-logo-Email]
>
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140709/0ebd3d8a/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.jpg
Type: image/jpeg
Size: 16370 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140709/0ebd3d8a/attachment.jpg>

From jbechara at lri-lb.org  Wed Jul  9 11:59:30 2014
From: jbechara at lri-lb.org (JOSEPH BECHARA)
Date: Wed, 9 Jul 2014 12:59:30 +0300
Subject: [R-sig-Geo] reading a feature class
In-Reply-To: <CAAcGz98NKuTvMEt=jtzF7B-JKHy6gThpxxnvXnb=pCJUS9u-mA@mail.gmail.com>
References: <vhhfft2qouxhtwv854ak6vob.1404832348824@email.android.com>	<000001cf9b43$307cc0b0$91764210$@lri-lb.org>
	<CAAcGz98NKuTvMEt=jtzF7B-JKHy6gThpxxnvXnb=pCJUS9u-mA@mail.gmail.com>
Message-ID: <001b01cf9b5c$79f6aee0$6de40ca0$@lri-lb.org>

Hi Michael, 

 

It worked partially.

I still have an error message

 

> dd<-ogrListLayers(dsn="C:/sophie/Allpoints/All_poly.gdb")

> bb<-readOGR(dsn=dd,layer="All_lays1")

Error in ogrInfo(dsn = dsn, layer = layer, encoding = encoding, use_iconv = use_iconv) : 

  Cannot open file

In addition: Warning messages:

1: In if (nchar(dsn) == 0) stop("empty name") :

  the condition has length > 1 and only the first element will be used

2: In if (nchar(dsn) == 0) stop("empty name") :

  the condition has length > 1 and only the first element will be used

 

 

JOSEPH BECHARA

Wildfire Management Component Coordinator

Ashrafieh 1020 Building, 8th floor, Mathaf, Beirut, Lebanon

Tel.: +961 (1) 426630-1-2

Fax: +961 (1) 426631

Mail:  <mailto:jbejjani at lri-lb.org> jbechara at lri-lb.org

 <http://www.lri-lb.org/> www.lri-lb.org

Description: Description: LRI-logo-Email

 

From: Michael Sumner [mailto:mdsumner at gmail.com] 
Sent: Wednesday, July 09, 2014 12:34 PM
To: Joseph Bechara
Cc: RsigGeo; Frede Aakmann T?gersen
Subject: Re: [R-sig-Geo] reading a feature class

 

Try 

ogrListLayers( dsn="C:/sophie/Allpoints/All_poly.gdb")

that should give you the right layer name/s for use with readOGR

On 9 Jul 2014 16:59, "JOSEPH BECHARA" <jbechara at lri-lb.org> wrote:

Dear Frede, 

 

Thanks for your reply.

 

This is the function that is not working

bb<-readOGR(dsn="C:/sophie/Allpoints/All_poly.gdb",layer="All_lays1")

 

All lays is a feature class in a file gdb(new) .

The file is not corrupted I?m able to open it on ARCIS and I?m doing the zonal statisctics there.

I opened the rgdal library and I?m using R studio 

Rgdal version 0.8-16

 

JOSEPH BECHARA

Wildfire Management Component Coordinator

Ashrafieh 1020 Building, 8th floor, Mathaf, Beirut, Lebanon

Tel.: +961 (1) 426630-1-2

Fax: +961 (1) 426631 <tel:%2B961%20%281%29%20426631> 

Mail:  <mailto:jbejjani at lri-lb.org> jbechara at lri-lb.org

 <http://www.lri-lb.org/> www.lri-lb.org

Description: Description: LRI-logo-Email

 

From: Frede Aakmann T?gersen [mailto:frtog at vestas.com] 
Sent: Tuesday, July 08, 2014 6:13 PM
To: JOSEPH BECHARA; r-sig-geo at r-project.org
Subject: RE: [R-sig-Geo] reading a feature class

 

Hi

 

I don't know the gdb file format. Is it in raster or vector format?

 

Since you used readOGR you probably did have a look at

 

http://www.gdal.org/ogr_formats.html

 

before asking. 

 

So there, two ESRI formats are mentioned: personal gdb (old) and file gdb (new?).

 

Do you what kind of gdb file you have?

 

Why you can't read the file could be because of several problems. 

 

Is the file corrupted?

 

What is your OS?

 

What version of R/rgdal?

 

Does the OS/R/rgdal combination involves formats for either pgdb or filegdb?

 

Nobody can help you with that little information you have given us. 

 

Br.

 

Frede

 

 

Sendt fra Samsung mobil



-------- Oprindelig meddelelse --------
Fra: JOSEPH BECHARA 
Dato:08/07/2014 16.35 (GMT+01:00) 
Til: r-sig-geo at r-project.org 
Emne: [R-sig-Geo] reading a feature class 

Dear All,

 

I ?m trying ti import a feature class from a gdb to R using readOGR.

Unfortunately it is not working.

Anybody has a suggestion of a function to read it.

 

 

JOSEPH BECHARA

Wildfire Management Component Coordinator

Ashrafieh 1020 Building, 8th floor, Mathaf, Beirut, Lebanon

Tel.: +961 (1) 426630-1-2

Fax: +961 (1) 426631 <tel:%2B961%20%281%29%20426631> 

Mail:  <mailto:jbejjani at lri-lb.org> jbechara at lri-lb.org

 <http://www.lri-lb.org/> www.lri-lb.org

Description: Description: LRI-logo-Email

 


_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140709/d8439539/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/jpeg
Size: 16370 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140709/d8439539/attachment.jpe>

From mdsumner at gmail.com  Wed Jul  9 12:59:42 2014
From: mdsumner at gmail.com (Michael Sumner)
Date: Wed, 9 Jul 2014 20:59:42 +1000
Subject: [R-sig-Geo] reading a feature class
In-Reply-To: <001b01cf9b5c$79f6aee0$6de40ca0$@lri-lb.org>
References: <vhhfft2qouxhtwv854ak6vob.1404832348824@email.android.com>
	<000001cf9b43$307cc0b0$91764210$@lri-lb.org>
	<CAAcGz98NKuTvMEt=jtzF7B-JKHy6gThpxxnvXnb=pCJUS9u-mA@mail.gmail.com>
	<001b01cf9b5c$79f6aee0$6de40ca0$@lri-lb.org>
Message-ID: <CAAcGz9-CcECGeBV_hDV2KLfTfknKQfW5vAFBxFv=zxW8veNhKg@mail.gmail.com>

dd is the layer name/s, so literally I meant to use it to find what
"All_lays1" really should be. (I have no experience with this format
thankfully).

So see for yourself what ogrListLayers reports, then the dsn for readOGR is
the same, but it also wants a layer name as the second arg.

(I probably need to find one of these "geodatabases" things and try for
myself before I can help.)

dsn is the data source (the mothership)

layer is the one or more layer-thingys in that ship

(shapefiles have just one layer, hence the most available example breaks
the more general mould)

Clear? See ?readOGR for examples
On 9 Jul 2014 19:59, "JOSEPH BECHARA" <jbechara at lri-lb.org> wrote:

> Hi Michael,
>
>
>
> It worked partially.
>
> I still have an error message
>
>
>
> > dd<-ogrListLayers(dsn="C:/sophie/Allpoints/All_poly.gdb")
>
> > bb<-readOGR(dsn=dd,layer="All_lays1")
>
> Error in ogrInfo(dsn = dsn, layer = layer, encoding = encoding, use_iconv
> = use_iconv) :
>
>   Cannot open file
>
> In addition: Warning messages:
>
> 1: In if (nchar(dsn) == 0) stop("empty name") :
>
>   the condition has length > 1 and only the first element will be used
>
> 2: In if (nchar(dsn) == 0) stop("empty name") :
>
>   the condition has length > 1 and only the first element will be used
>
>
>
>
>
> *JOSEPH BECHARA*
>
> *Wildfire Management Component Coordinator*
>
> Ashrafieh 1020 Building, 8th floor, Mathaf, Beirut, Lebanon
>
> Tel.: +961 (1) 426630-1-2
>
> Fax: +961 (1) 426631
>
> Mail: jbechara at lri-lb.org <jbejjani at lri-lb.org>
>
> www.lri-lb.org
>
> [image: Description: Description: LRI-logo-Email]
>
>
>
> *From:* Michael Sumner [mailto:mdsumner at gmail.com]
> *Sent:* Wednesday, July 09, 2014 12:34 PM
> *To:* Joseph Bechara
> *Cc:* RsigGeo; Frede Aakmann T?gersen
> *Subject:* Re: [R-sig-Geo] reading a feature class
>
>
>
> Try
>
> ogrListLayers( dsn="C:/sophie/Allpoints/All_poly.gdb")
>
> that should give you the right layer name/s for use with readOGR
>
> On 9 Jul 2014 16:59, "JOSEPH BECHARA" <jbechara at lri-lb.org> wrote:
>
> Dear Frede,
>
>
>
> Thanks for your reply.
>
>
>
> This is the function that is not working
>
> bb<-readOGR(dsn="C:/sophie/Allpoints/All_poly.gdb",layer="All_lays1")
>
>
>
> All lays is a feature class in a file gdb(new) .
>
> The file is not corrupted I?m able to open it on ARCIS and I?m doing the
> zonal statisctics there.
>
> I opened the rgdal library and I?m using R studio
>
> Rgdal version 0.8-16
>
>
>
> *JOSEPH BECHARA*
>
> *Wildfire Management Component Coordinator*
>
> Ashrafieh 1020 Building, 8th floor, Mathaf, Beirut, Lebanon
>
> Tel.: +961 (1) 426630-1-2
>
> Fax: +961 (1) 426631
>
> Mail: jbechara at lri-lb.org <jbejjani at lri-lb.org>
>
> www.lri-lb.org
>
> [image: Description: Description: LRI-logo-Email]
>
>
>
> *From:* Frede Aakmann T?gersen [mailto:frtog at vestas.com]
> *Sent:* Tuesday, July 08, 2014 6:13 PM
> *To:* JOSEPH BECHARA; r-sig-geo at r-project.org
> *Subject:* RE: [R-sig-Geo] reading a feature class
>
>
>
> Hi
>
>
>
> I don't know the gdb file format. Is it in raster or vector format?
>
>
>
> Since you used readOGR you probably did have a look at
>
>
>
> http://www.gdal.org/ogr_formats.html
>
>
>
> before asking.
>
>
>
> So there, two ESRI formats are mentioned: personal gdb (old) and file gdb
> (new?).
>
>
>
> Do you what kind of gdb file you have?
>
>
>
> Why you can't read the file could be because of several problems.
>
>
>
> Is the file corrupted?
>
>
>
> What is your OS?
>
>
>
> What version of R/rgdal?
>
>
>
> Does the OS/R/rgdal combination involves formats for either pgdb or
> filegdb?
>
>
>
> Nobody can help you with that little information you have given us.
>
>
>
> Br.
>
>
>
> Frede
>
>
>
>
>
> Sendt fra Samsung mobil
>
>
>
> -------- Oprindelig meddelelse --------
> Fra: JOSEPH BECHARA
> Dato:08/07/2014 16.35 (GMT+01:00)
> Til: r-sig-geo at r-project.org
> Emne: [R-sig-Geo] reading a feature class
>
> Dear All,
>
>
>
> I ?m trying ti import a feature class from a gdb to R using readOGR.
>
> Unfortunately it is not working.
>
> Anybody has a suggestion of a function to read it.
>
>
>
>
>
> *JOSEPH BECHARA*
>
> *Wildfire Management Component Coordinator*
>
> Ashrafieh 1020 Building, 8th floor, Mathaf, Beirut, Lebanon
>
> Tel.: +961 (1) 426630-1-2
>
> Fax: +961 (1) 426631
>
> Mail: jbechara at lri-lb.org <jbejjani at lri-lb.org>
>
> www.lri-lb.org
>
> [image: Description: Description: LRI-logo-Email]
>
>
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140709/e85334fd/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.jpg
Type: image/jpeg
Size: 16370 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140709/e85334fd/attachment.jpg>

From frtog at vestas.com  Wed Jul  9 15:15:53 2014
From: frtog at vestas.com (=?utf-8?B?RnJlZGUgQWFrbWFubiBUw7hnZXJzZW4=?=)
Date: Wed, 9 Jul 2014 15:15:53 +0200
Subject: [R-sig-Geo] reading a feature class
References: <vhhfft2qouxhtwv854ak6vob.1404832348824@email.android.com>
	<000001cf9b43$307cc0b0$91764210$@lri-lb.org>
	<CAAcGz98NKuTvMEt=jtzF7B-JKHy6gThpxxnvXnb=pCJUS9u-mA@mail.gmail.com>
	<001b01cf9b5c$79f6aee0$6de40ca0$@lri-lb.org>
	<CAAcGz9-CcECGeBV_hDV2KLfTfknKQfW5vAFBxFv=zxW8veNhKg@mail.gmail.com>
	<008a01cf9b73$7599c5f0$60cd51d0$@lri-lb.org>  
Message-ID: <B078CDF40DFE4045AF172A8B4F68FC4857C6855533@DKRDSEXC016.vestas.net>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140709/0dc76482/attachment.pl>

From HodgessE at uhd.edu  Wed Jul  9 18:04:59 2014
From: HodgessE at uhd.edu (Hodgess, Erin)
Date: Wed, 9 Jul 2014 16:04:59 +0000
Subject: [R-sig-Geo] a KMZ question, please
Message-ID: <FF9DB805FC41CC4E95825A50F68063021A886F9B@challenger.uhd.campus>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140709/48ffb03c/attachment.pl>

From forrest at ufl.edu  Wed Jul  9 18:12:54 2014
From: forrest at ufl.edu (Forrest Stevens)
Date: Wed, 9 Jul 2014 12:12:54 -0400
Subject: [R-sig-Geo] a KMZ question, please
In-Reply-To: <FF9DB805FC41CC4E95825A50F68063021A886F9B@challenger.uhd.campus>
References: <FF9DB805FC41CC4E95825A50F68063021A886F9B@challenger.uhd.campus>
Message-ID: <CAEBQMMn_xr8szpcB+o--FQNhqw1abTRBS--oYNFV9J7ZVO0QFg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140709/4e6bb482/attachment.pl>

From mtreglia at gmail.com  Wed Jul  9 18:17:10 2014
From: mtreglia at gmail.com (Michael Treglia)
Date: Wed, 9 Jul 2014 11:17:10 -0500
Subject: [R-sig-Geo] a KMZ question, please
In-Reply-To: <CAEBQMMn_xr8szpcB+o--FQNhqw1abTRBS--oYNFV9J7ZVO0QFg@mail.gmail.com>
References: <FF9DB805FC41CC4E95825A50F68063021A886F9B@challenger.uhd.campus>
	<CAEBQMMn_xr8szpcB+o--FQNhqw1abTRBS--oYNFV9J7ZVO0QFg@mail.gmail.com>
Message-ID: <CAPKp32tB33On22D6BPc2vOgcDANRvTh-KJK76MLLpwFyRM-AFg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140709/4b05b88a/attachment.pl>

From michael.peichl at ufz.de  Wed Jul  9 18:35:06 2014
From: michael.peichl at ufz.de (Michael Peichl)
Date: Wed, 09 Jul 2014 18:35:06 +0200
Subject: [R-sig-Geo] RasterBrick: Change resolution, keep the values
Message-ID: <53BD6F3A.3090601@ufz.de>

Dear all,

I would like to change the resolution of the following RasterBrick to 
100, 100.

class       : RasterBrick
dimensions  : 225, 175, 39375, 720  (nrow, ncol, ncell, nlayers)
resolution  : 4000, 4000  (x, y)
extent      : 4038000, 4738000, 5220000, 6120000  (xmin, xmax, ymin, ymax)
coord. ref. : +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0
data source : /home/usr/Documents/projects/...
names       : X1, X2, X3, X4, X5, X6, X7, X8, X9, X10, X11, X12, X13, 
X14, X15, ...
z-value     : 1, 720 (min, max)
varname     : varname

Thereby, the values of each Raster Cell on 4000,4000 resolution should 
be allocated to 40x40 raster cellls, having the same value as the large 
cells. I want to do this, because I want to use a raster on the more 
detailed resolution as mask:

class       : RasterLayer
dimensions  : 9000, 7000, 6.3e+07  (nrow, ncol, ncell)
resolution  : 100, 100  (x, y)
extent      : 4038000, 4738000, 5220000, 6120000  (xmin, xmax, ymin, ymax)
coord. ref. : NA
data source : in memory
names       : layer
values      : 12, 12  (min, max)

Any recommendations?

Thanks a lot!

Sincerely
Michael

-- 
						
Dipl.-Vw. Michael Peichl
?konomie / Economics
				
Helmholtz-Zentrum f?r Umweltforschung GmbH - UFZ
Helmholtz Centre for Environmental Research GmbH - UFZ	
Permoserstra?e 15 / 04318 Leipzig / Germany
Telefon +49 341 235 1641 / Fax 0341 235 451641
michael.peichl at ufz.de / www.ufz.de

Sitz der Gesellschaft: Leipzig
Registergericht: Amtsgericht Leipzig, Handelsregister Nr. B 4703
Vorsitzender des Aufsichtsrats: MinDirig Wilfried Kraus
Wissenschaftlicher Gesch?ftsf?hrer: Prof. Dr. Georg Teutsch
Administrative Gesch?ftsf?hrerin: Dr. Heike Gra?mann


From mtreglia at gmail.com  Wed Jul  9 18:48:08 2014
From: mtreglia at gmail.com (Michael Treglia)
Date: Wed, 9 Jul 2014 11:48:08 -0500
Subject: [R-sig-Geo] RasterBrick: Change resolution, keep the values
In-Reply-To: <53BD6F3A.3090601@ufz.de>
References: <53BD6F3A.3090601@ufz.de>
Message-ID: <CAPKp32vTi1yoRoqttWMREjL3OmA234xeA-ohXeEvK9HkH6hdgg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140709/6e5d53c1/attachment.pl>

From rafael.wueest at gmail.com  Wed Jul  9 19:00:50 2014
From: rafael.wueest at gmail.com (=?windows-1252?Q?Rafael_W=FCest?=)
Date: Wed, 09 Jul 2014 19:00:50 +0200
Subject: [R-sig-Geo] RasterBrick: Change resolution, keep the values
In-Reply-To: <CAPKp32vTi1yoRoqttWMREjL3OmA234xeA-ohXeEvK9HkH6hdgg@mail.gmail.com>
References: <53BD6F3A.3090601@ufz.de>
	<CAPKp32vTi1yoRoqttWMREjL3OmA234xeA-ohXeEvK9HkH6hdgg@mail.gmail.com>
Message-ID: <53BD7542.9000700@gmail.com>

Hi Micheal,

I think you can use the raster::disaggregate function in this case, with 
method = ''

Check out ?disaggregate for more details.

HTH, Rafael


On 09.07.14 18:48, Michael Treglia wrote:
> Hi Michael,
>
> Looks like you're using the Raster package.  In that package, check out the
> resample() function (
> http://www.inside-r.org/packages/cran/raster/docs/resample) - looks like
> that does what you want.
>
> Make sure both layers are in the same projection - otherwise you can use
> projectRaster() instead.
>
> It looks like you haven't defined the projection for the second layer (as
> listed above, "coord. ref. : NA") - do that first (use projection() [
> http://www.inside-r.org/packages/cran/raster/docs/projection]).
> Alternatively, you can define the projection on import with the raster()
> command, using the "crs" argument.
>
> Hope that helps.
> Mike
>
>
>
>
> On Wed, Jul 9, 2014 at 11:35 AM, Michael Peichl <michael.peichl at ufz.de>
> wrote:
>
>> Dear all,
>>
>> I would like to change the resolution of the following RasterBrick to 100,
>> 100.
>>
>> class       : RasterBrick
>> dimensions  : 225, 175, 39375, 720  (nrow, ncol, ncell, nlayers)
>> resolution  : 4000, 4000  (x, y)
>> extent      : 4038000, 4738000, 5220000, 6120000  (xmin, xmax, ymin, ymax)
>> coord. ref. : +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0
>> data source : /home/usr/Documents/projects/...
>> names       : X1, X2, X3, X4, X5, X6, X7, X8, X9, X10, X11, X12, X13, X14,
>> X15, ...
>> z-value     : 1, 720 (min, max)
>> varname     : varname
>>
>> Thereby, the values of each Raster Cell on 4000,4000 resolution should be
>> allocated to 40x40 raster cellls, having the same value as the large cells.
>> I want to do this, because I want to use a raster on the more detailed
>> resolution as mask:
>>
>> class       : RasterLayer
>> dimensions  : 9000, 7000, 6.3e+07  (nrow, ncol, ncell)
>> resolution  : 100, 100  (x, y)
>> extent      : 4038000, 4738000, 5220000, 6120000  (xmin, xmax, ymin, ymax)
>> coord. ref. : NA
>> data source : in memory
>> names       : layer
>> values      : 12, 12  (min, max)
>>
>> Any recommendations?
>>
>> Thanks a lot!
>>
>> Sincerely
>> Michael
>>
>> --
>>
>> Dipl.-Vw. Michael Peichl
>> ??konomie / Economics
>>
>> Helmholtz-Zentrum f??r Umweltforschung GmbH - UFZ
>> Helmholtz Centre for Environmental Research GmbH - UFZ
>> Permoserstra??e 15 / 04318 Leipzig / Germany
>> Telefon +49 341 235 1641 / Fax 0341 235 451641
>> michael.peichl at ufz.de / www.ufz.de
>>
>> Sitz der Gesellschaft: Leipzig
>> Registergericht: Amtsgericht Leipzig, Handelsregister Nr. B 4703
>> Vorsitzender des Aufsichtsrats: MinDirig Wilfried Kraus
>> Wissenschaftlicher Gesch??ftsf??hrer: Prof. Dr. Georg Teutsch
>> Administrative Gesch??ftsf??hrerin: Dr. Heike Gra??mann
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> 	[[alternative HTML version deleted]]
>
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Rafael W?est
rafael.wueest at gmail.com
http://www.rowueest.net


From Roger.Bivand at nhh.no  Wed Jul  9 19:23:12 2014
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 9 Jul 2014 19:23:12 +0200
Subject: [R-sig-Geo] reading a feature class
In-Reply-To: <B078CDF40DFE4045AF172A8B4F68FC4857C6855533@DKRDSEXC016.vestas.net>
References: <vhhfft2qouxhtwv854ak6vob.1404832348824@email.android.com>
	<000001cf9b43$307cc0b0$91764210$@lri-lb.org>
	<CAAcGz98NKuTvMEt=jtzF7B-JKHy6gThpxxnvXnb=pCJUS9u-mA@mail.gmail.com>
	<001b01cf9b5c$79f6aee0$6de40ca0$@lri-lb.org>
	<CAAcGz9-CcECGeBV_hDV2KLfTfknKQfW5vAFBxFv=zxW8veNhKg@mail.gmail.com>
	<008a01cf9b73$7599c5f0$60cd51d0$@lri-lb.org>
	<B078CDF40DFE4045AF172A8B4F68FC4857C6855533@DKRDSEXC016.vestas.net>
Message-ID: <alpine.LRH.2.03.1407091918390.6706@reclus.nhh.no>

The reason is that Joseph Bechara's post included a jpeg image at 16KB, 
and an HTML component breaking the list requirement to post in plain text 
only. Multiple copies of his logo then clog up the system.

The real answer to is problem is that ogrDrivers() will show that he does 
not have the driver (certainly not in the CRAN binaries). GDB is a 
proprietary format that can be used if you builds GDAL/OGR against ESRI 
binaries, not otherwise (certainly for Personal GDB, and effectively for 
File GDB). The data must be saved from ArcGIS in an open format.

Hope this clarifies,

Roger

On Wed, 9 Jul 2014, Frede Aakmann T?gersen wrote:

>
> From: Frede Aakmann T??gersen
> Sent: 9. juli 2014 15:12
> To: 'JOSEPH BECHARA'; 'Michael Sumner'
> Cc: 'RsigGeo'
> Subject: FW: [R-sig-Geo] reading a feature class
>
> Hi I am getting some information like this from the list:
>
>
> Your mail to 'R-sig-Geo' with the subject
>
>
>
>    RE: [R-sig-Geo] reading a feature class
>
>
>
> Is being held until the list moderator can review it for approval.
>
>
>
> The reason it is being held:
>
>
>
>    Message body is too big: 76484 bytes with a limit of 50 KB
>
>
>
> Either the message will get posted to the list, or you will receive
>
> notification of the moderator's decision.  If you would like to cancel
>
> this posting, please visit the following URL:
>
>
>
>    https://stat.ethz.ch/mailman/confirm/r-sig-geo/5859051c379864eae2b43f7c1fcf9c94159715a0
>
> Cutting and resending:
>
>
> Hi
>
> Well both Michael and I are just guessing because of lack of information. I cannot really help you before I can try to read your file on my system (both windows and linux) before I can be of any use to help you. I suppose that Michael expressed the same.
>
> One thing that comes to my mind is that reading vector formats into R requires lots of physical memory. If your computer do not have that it is probably swapping to hard disk (hence working along for ever). Can you check that? If so you might as well kill the process and think on other approaches.
>
> Yes, other software may handle this more efficient than R.
>
> Yours sincerely / Med venlig hilsen
>
>
> Frede Aakmann T??gersen
> Specialist, M.Sc., Ph.D.
> Plant Performance & Modeling
>
> Technology & Service Solutions
> T +45 9730 5135
> M +45 2547 6050
> frtog at vestas.com<mailto:frtog at vestas.com>
> http://www.vestas.com<http://www.vestas.com/>
>
> Company reg. name: Vestas Wind Systems A/Sas well
> This e-mail is subject to our e-mail disclaimer statement.
> Please refer to www.vestas.com/legal/notice<http://www.vestas.com/legal/notice>
> If you have received this e-mail in error please contact the sender.
>
> From: JOSEPH BECHARA [mailto:jbechara at lri-lb.org]
> Sent: 9. juli 2014 14:44
> To: 'Michael Sumner'
> Cc: Frede Aakmann T??gersen; 'RsigGeo'
> Subject: RE: [R-sig-Geo] reading a feature class
>
> I tried your suggestion and it is working.  I got the below message but it have been running for almost 1 h and didn???t close the ring yet.
>
>
>
>
>
>> bb<-readOGR(dsn="All_poly.gdb",layer="All_lays1")
> OGR data source with driver: OpenFileGDB
> Source: "All_poly.gdb", layer: "All_lays1"
> with 9067252 features and 5 fields
> Feature type: wkbMultiPolygon with 2 dimensions
>
>
> JOSEPH BECHARA
> Wildfire Management Component Coordinator
> Ashrafieh 1020 Building, 8th floor, Mathaf, Beirut, Lebanon
> Tel.: +961 (1) 426630-1-2
> Fax: +961 (1) 426631
> Mail: jbechara at lri-lb.org<mailto:jbejjani at lri-lb.org>
> www.lri-lb.org<http://www.lri-lb.org/>
>
>
> From: Michael Sumner [mailto:mdsumner at gmail.com]
> Sent: Wednesday, July 09, 2014 2:00 PM
> To: Joseph Bechara
> Cc: Frede Aakmann T??gersen; RsigGeo
> Subject: RE: [R-sig-Geo] reading a feature class
>
>
> dd is the layer name/s, so literally I meant to use it to find what "All_lays1" really should be. (I have no experience with this format thankfully).
>
> So see for yourself what ogrListLayers reports, then the dsn for readOGR is the same, but it also wants a layer name as the second arg.
>
> (I probably need to find one of these "geodatabases" things and try for myself before I can help.)
>
> dsn is the data source (the mothership)
>
> layer is the one or more layer-thingys in that ship
>
> (shapefiles have just one layer, hence the most available example breaks the more general mould)
>
> Clear? See ?readOGR for examples
> On 9 Jul 2014 19:59, "JOSEPH BECHARA" <jbechara at lri-lb.org<mailto:jbechara at lri-lb.org>> wrote:
> Hi Michael,
>
> It worked partially.
> I still have an error message
>
>> dd<-ogrListLayers(dsn="C:/sophie/Allpoints/All_poly.gdb")
>> bb<-readOGR(dsn=dd,layer="All_lays1")
> Error in ogrInfo(dsn = dsn, layer = layer, encoding = encoding, use_iconv = use_iconv) :
>  Cannot open file
> In addition: Warning messages:
> 1: In if (nchar(dsn) == 0) stop("empty name") :
>  the condition has length > 1 and only the first element will be used
> 2: In if (nchar(dsn) == 0) stop("empty name") :
>  the condition has length > 1 and only the first element will be used
>
>
> JOSEPH BECHARA
> Wildfire Management Component Coordinator
> Ashrafieh 1020 Building, 8th floor, Mathaf, Beirut, Lebanon
> Tel.: +961 (1) 426630-1-2
> Fax: +961 (1) 426631<tel:%2B961%20%281%29%20426631>
> Mail: jbechara at lri-lb.org<mailto:jbejjani at lri-lb.org>
> www.lri-lb.org<http://www.lri-lb.org/>
>
>
>
> 	[[alternative HTML version deleted]]

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no

From mdsumner at gmail.com  Thu Jul 10 02:16:42 2014
From: mdsumner at gmail.com (Michael Sumner)
Date: Thu, 10 Jul 2014 10:16:42 +1000
Subject: [R-sig-Geo] reading a feature class
In-Reply-To: <alpine.LRH.2.03.1407091918390.6706@reclus.nhh.no>
References: <vhhfft2qouxhtwv854ak6vob.1404832348824@email.android.com>
	<000001cf9b43$307cc0b0$91764210$@lri-lb.org>
	<CAAcGz98NKuTvMEt=jtzF7B-JKHy6gThpxxnvXnb=pCJUS9u-mA@mail.gmail.com>
	<001b01cf9b5c$79f6aee0$6de40ca0$@lri-lb.org>
	<CAAcGz9-CcECGeBV_hDV2KLfTfknKQfW5vAFBxFv=zxW8veNhKg@mail.gmail.com>
	<008a01cf9b73$7599c5f0$60cd51d0$@lri-lb.org>
	<B078CDF40DFE4045AF172A8B4F68FC4857C6855533@DKRDSEXC016.vestas.net>
	<alpine.LRH.2.03.1407091918390.6706@reclus.nhh.no>
Message-ID: <CAAcGz9_wOvs12jKGfZGfdMNpxVVgj0WH=wyJXqGSAHQnQd=1iQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140710/5dda6bc4/attachment.pl>

From frtog at vestas.com  Thu Jul 10 08:04:22 2014
From: frtog at vestas.com (=?utf-8?B?RnJlZGUgQWFrbWFubiBUw7hnZXJzZW4=?=)
Date: Thu, 10 Jul 2014 08:04:22 +0200
Subject: [R-sig-Geo] reading a feature class
In-Reply-To: <CAAcGz9_wOvs12jKGfZGfdMNpxVVgj0WH=wyJXqGSAHQnQd=1iQ@mail.gmail.com>
References: <vhhfft2qouxhtwv854ak6vob.1404832348824@email.android.com>
	<000001cf9b43$307cc0b0$91764210$@lri-lb.org>
	<CAAcGz98NKuTvMEt=jtzF7B-JKHy6gThpxxnvXnb=pCJUS9u-mA@mail.gmail.com>
	<001b01cf9b5c$79f6aee0$6de40ca0$@lri-lb.org>
	<CAAcGz9-CcECGeBV_hDV2KLfTfknKQfW5vAFBxFv=zxW8veNhKg@mail.gmail.com>
	<008a01cf9b73$7599c5f0$60cd51d0$@lri-lb.org>
	<B078CDF40DFE4045AF172A8B4F68FC4857C6855533@DKRDSEXC016.vestas.net>
	<alpine.LRH.2.03.1407091918390.6706@reclus.nhh.no>
	<CAAcGz9_wOvs12jKGfZGfdMNpxVVgj0WH=wyJXqGSAHQnQd=1iQ@mail.gmail.com>
Message-ID: <B078CDF40DFE4045AF172A8B4F68FC4857C68556C3@DKRDSEXC016.vestas.net>

Hi Michael

Thanks for the information about gdal drivers. The version I had on my windows box was:

rgdal: version: 0.8-16, (SVN revision 498)
Geospatial Data Abstraction Library extensions to R successfully loaded
Loaded GDAL runtime: GDAL 1.10.1, released 2013/08/26

Which did not have the GDB driver. An update.packages(oldPkgs = "rgdal") didn't give me the GDAL 1.11.0 version. I had to remove.packages("rgdal") and then install.packages("rgdal").

Yours sincerely / Med venlig hilsen


Frede Aakmann T?gersen
Specialist, M.Sc., Ph.D.
Plant Performance & Modeling

Technology & Service Solutions
T +45 9730 5135
M +45 2547 6050
frtog at vestas.com
http://www.vestas.com

Company reg. name: Vestas Wind Systems A/S
This e-mail is subject to our e-mail disclaimer statement.
Please refer to www.vestas.com/legal/notice
If you have received this e-mail in error please contact the sender. 

From: Michael Sumner [mailto:mdsumner at gmail.com] 
Sent: 10. juli 2014 02:17
To: Roger Bivand
Cc: Joseph Bechara; Frede Aakmann T?gersen; RsigGeo
Subject: Re: [R-sig-Geo] reading a feature class

On 10 Jul 2014 03:24, "Roger Bivand" <Roger.Bivand at nhh.no> wrote:
The reason is that Joseph Bechara's post included a jpeg image at 16KB, and an HTML component breaking the list requirement to post in plain text only. Multiple copies of his logo then clog up the system.

The real answer to is problem is that ogrDrivers() will show that he does not have the driver (certainly not in the CRAN binaries). GDB is a proprietary format that can be used if you builds GDAL/OGR against ESRI binaries, not otherwise (certainly for Personal GDB, and effectively for File GDB). The data must be saved from ArcGIS in an open format.

Hope this clarifies,

Roger

?
GDB has been reverse engineered and is included in the Windows binary on CRAN, as well as by default in source installs.?
http://erouault.blogspot.com.au/2013/10/filegdb-format-reverse-engineered.html
http://www.gdal.org/drv_openfilegdb.html
(Unless I'm still missing something).?
Platform: x86_64-w64-mingw32/x64 (64-bit)
...
> library(rgdal)
Loading required package: sp
rgdal: version: 0.8-16, (SVN revision 498)
...Loaded GDAL runtime: GDAL 1.11.0, released 2014/04/16
...GDAL does not use iconv for recoding strings.
Loaded PROJ.4 runtime: Rel. 4.8.0, 6 March 2012, [PJ_VERSION: 480]
library(rgdal)
subset(ogrDrivers(), grepl("GDB", name))
? ? ? ? ? name write
29 OpenFileGDB FALSE

ogrListLayers("/path/to/folderworld.gdb")
[1] "cities" ? ? ? ? ? ? "latitude_longitude" "countries" ? ? ? ??
[4] "continents" ??

Cheers, Mike.?



On Wed, 9 Jul 2014, Frede Aakmann T?gersen wrote:

From: Frede Aakmann T??gersen
Sent: 9. juli 2014 15:12
To: 'JOSEPH BECHARA'; 'Michael Sumner'
Cc: 'RsigGeo'
Subject: FW: [R-sig-Geo] reading a feature class

Hi I am getting some information like this from the list:


Your mail to 'R-sig-Geo' with the subject



? ?RE: [R-sig-Geo] reading a feature class



Is being held until the list moderator can review it for approval.



The reason it is being held:



? ?Message body is too big: 76484 bytes with a limit of 50 KB



Either the message will get posted to the list, or you will receive

notification of the moderator's decision. ?If you would like to cancel

this posting, please visit the following URL:



? ?https://stat.ethz.ch/mailman/confirm/r-sig-geo/5859051c379864eae2b43f7c1fcf9c94159715a0

Cutting and resending:


Hi

Well both Michael and I are just guessing because of lack of information. I cannot really help you before I can try to read your file on my system (both windows and linux) before I can be of any use to help you. I suppose that Michael expressed the same.

One thing that comes to my mind is that reading vector formats into R requires lots of physical memory. If your computer do not have that it is probably swapping to hard disk (hence working along for ever). Can you check that? If so you might as well kill the process and think on other approaches.

Yes, other software may handle this more efficient than R.

Yours sincerely / Med venlig hilsen


Frede Aakmann T??gersen
Specialist, M.Sc., Ph.D.
Plant Performance & Modeling

Technology & Service Solutions
T +45 9730 5135
M +45 2547 6050
frtog at vestas.com<mailto:frtog at vestas.com>
http://www.vestas.com<http://www.vestas.com/>

Company reg. name: Vestas Wind Systems A/Sas well
This e-mail is subject to our e-mail disclaimer statement.
Please refer to www.vestas.com/legal/notice<http://www.vestas.com/legal/notice>
If you have received this e-mail in error please contact the sender.

From: JOSEPH BECHARA [mailto:jbechara at lri-lb.org]
Sent: 9. juli 2014 14:44
To: 'Michael Sumner'
Cc: Frede Aakmann T??gersen; 'RsigGeo'
Subject: RE: [R-sig-Geo] reading a feature class

I tried your suggestion and it is working. ?I got the below message but it have been running for almost 1 h and didn???t close the ring yet.




bb<-readOGR(dsn="All_poly.gdb",layer="All_lays1")
OGR data source with driver: OpenFileGDB
Source: "All_poly.gdb", layer: "All_lays1"
with 9067252 features and 5 fields
Feature type: wkbMultiPolygon with 2 dimensions


JOSEPH BECHARA
Wildfire Management Component Coordinator
Ashrafieh 1020 Building, 8th floor, Mathaf, Beirut, Lebanon
Tel.: +961 (1) 426630-1-2
Fax: +961 (1) 426631
Mail: jbechara at lri-lb.org<mailto:jbejjani at lri-lb.org>
www.lri-lb.org<http://www.lri-lb.org/>


From: Michael Sumner [mailto:mdsumner at gmail.com]
Sent: Wednesday, July 09, 2014 2:00 PM
To: Joseph Bechara
Cc: Frede Aakmann T??gersen; RsigGeo
Subject: RE: [R-sig-Geo] reading a feature class


dd is the layer name/s, so literally I meant to use it to find what "All_lays1" really should be. (I have no experience with this format thankfully).

So see for yourself what ogrListLayers reports, then the dsn for readOGR is the same, but it also wants a layer name as the second arg.

(I probably need to find one of these "geodatabases" things and try for myself before I can help.)

dsn is the data source (the mothership)

layer is the one or more layer-thingys in that ship

(shapefiles have just one layer, hence the most available example breaks the more general mould)

Clear? See ?readOGR for examples
On 9 Jul 2014 19:59, "JOSEPH BECHARA" <jbechara at lri-lb.org<mailto:jbechara at lri-lb.org>> wrote:
Hi Michael,

It worked partially.
I still have an error message
dd<-ogrListLayers(dsn="C:/sophie/Allpoints/All_poly.gdb")
bb<-readOGR(dsn=dd,layer="All_lays1")
Error in ogrInfo(dsn = dsn, layer = layer, encoding = encoding, use_iconv = use_iconv) :
?Cannot open file
In addition: Warning messages:
1: In if (nchar(dsn) == 0) stop("empty name") :
?the condition has length > 1 and only the first element will be used
2: In if (nchar(dsn) == 0) stop("empty name") :
?the condition has length > 1 and only the first element will be used


JOSEPH BECHARA
Wildfire Management Component Coordinator
Ashrafieh 1020 Building, 8th floor, Mathaf, Beirut, Lebanon
Tel.: +961 (1) 426630-1-2
Fax: +961 (1) 426631<tel:%2B961%20%281%29%20426631>
Mail: jbechara at lri-lb.org<mailto:jbejjani at lri-lb.org>
www.lri-lb.org<http://www.lri-lb.org/>



? ? ? ? [[alternative HTML version deleted]]

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no

From r.rhodes at pgr.reading.ac.uk  Thu Jul 10 23:23:02 2014
From: r.rhodes at pgr.reading.ac.uk (rhodes.uor)
Date: Thu, 10 Jul 2014 14:23:02 -0700 (PDT)
Subject: [R-sig-Geo] Finding distances between points and contour lines
Message-ID: <1405027382424-7586733.post@n2.nabble.com>

Hi all,

I have two sets of data; a dataframe of lon/lat pairs which correspond to
storm track locations, and a gridded rainfall dataset. I've taken contours
of the rainfall dataset at a single level and saved them as a
SpatialLinesDataFrame. I'm attempting to determine the distance between each
of the storm track coordinates and each of the contours. Below is an example
of what I have so far, but I can't figure out the next step:



For each entry in track.pts I want to return a distance to the nearest point
of each entry in contourSL (or in contours, for that matter). Can anyone
recommend a way to do this?
Thanks very much!



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Finding-distances-between-points-and-contour-lines-tp7586733.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From b.rowlingson at lancaster.ac.uk  Fri Jul 11 09:44:09 2014
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Fri, 11 Jul 2014 08:44:09 +0100
Subject: [R-sig-Geo] Finding distances between points and contour lines
In-Reply-To: <8028dc8eda804fac8ab582baabd1c223@EX-0-HT0.lancs.local>
References: <8028dc8eda804fac8ab582baabd1c223@EX-0-HT0.lancs.local>
Message-ID: <CANVKczOgDqryb7=2q__vhebydkkBC9230UJD2vqiQ3T4_jPb-Q@mail.gmail.com>

Couple of clarifications:

 * I think you sent an HTML email which stripped out your example. Its
visible here:

http://r-sig-geo.2731867.n2.nabble.com/Finding-distances-between-points-and-contour-lines-tp7586733.html

but you shouldn't send HTML emails to the mailing list.

 * Do you want the minimal distance between the *vertices* of the
lines or the minimal distance between the lines themselves?

 For the former its just a question of extracting the vertex
coordinates from the spatial data structure and doing a distance
calculation between all pairs from each item. If you've transformed
your data to a regular cartesian coordinate system then Pythagoras
will help you.

 For the latter just turn your track into a SpatialLines object and
use gDistance from package rgeos:

trackSL = SpatialLines(LinesList=list(Lines(Line(coords=track.pts),1)))
gDistance(trackSL,contourSL)
[1] 0.02220655

this will return zero if the track defined by the points crosses the
contour, whereas the vertex distance method will return zero only if a
vertex is exactly on the contour.

# fiddle the track to cross the contour:

 track.pts[1,1]=.1

# rebuild the lines:

 trackSL = SpatialLines(LinesList=list(Lines(Line(coords=track.pts),1)))

# plot and check:

 lines(trackSL)

# distance should be zero:

 gDistance(trackSL,contourSL)
 # returns [1] 0



On Thu, Jul 10, 2014 at 10:23 PM, rhodes.uor <r.rhodes at pgr.reading.ac.uk> wrote:
> Hi all,
>
> I have two sets of data; a dataframe of lon/lat pairs which correspond to
> storm track locations, and a gridded rainfall dataset. I've taken contours
> of the rainfall dataset at a single level and saved them as a
> SpatialLinesDataFrame. I'm attempting to determine the distance between each
> of the storm track coordinates and each of the contours. Below is an example
> of what I have so far, but I can't figure out the next step:
>
>
>
> For each entry in track.pts I want to return a distance to the nearest point
> of each entry in contourSL (or in contours, for that matter). Can anyone
> recommend a way to do this?
> Thanks very much!
>
>
>
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Finding-distances-between-points-and-contour-lines-tp7586733.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From r.rhodes at pgr.reading.ac.uk  Fri Jul 11 13:18:11 2014
From: r.rhodes at pgr.reading.ac.uk (rhodes.uor)
Date: Fri, 11 Jul 2014 04:18:11 -0700 (PDT)
Subject: [R-sig-Geo] Finding distances between points and contour lines
In-Reply-To: <CANVKczOgDqryb7=2q__vhebydkkBC9230UJD2vqiQ3T4_jPb-Q@mail.gmail.com>
References: <1405027382424-7586733.post@n2.nabble.com>
	<CANVKczOgDqryb7=2q__vhebydkkBC9230UJD2vqiQ3T4_jPb-Q@mail.gmail.com>
Message-ID: <53BFC7D9.7000606@pgr.reading.ac.uk>

Hi Barry,

Thanks for the reply, my apologies for the HTML code. I think you've hit 
the nail on the head though even without the example. A simple bit of 
Pythagorus on the vertices has done the job perfectly well for now, 
although I'll bear gDistance in mind as I'm certain it will be of use 
later in this project.

Thanks for your help!
Ruari


On 07/11/14 08:45, Barry Rowlingson [via R-sig-geo] wrote:
> Couple of clarifications:
>
>  * I think you sent an HTML email which stripped out your example. Its
> visible here:
>
> http://r-sig-geo.2731867.n2.nabble.com/Finding-distances-between-points-and-contour-lines-tp7586733.html
>
> but you shouldn't send HTML emails to the mailing list.
>
>  * Do you want the minimal distance between the *vertices* of the
> lines or the minimal distance between the lines themselves?
>
>  For the former its just a question of extracting the vertex
> coordinates from the spatial data structure and doing a distance
> calculation between all pairs from each item. If you've transformed
> your data to a regular cartesian coordinate system then Pythagoras
> will help you.
>
>  For the latter just turn your track into a SpatialLines object and
> use gDistance from package rgeos:
>
> trackSL = SpatialLines(LinesList=list(Lines(Line(coords=track.pts),1)))
> gDistance(trackSL,contourSL)
> [1] 0.02220655
>
> this will return zero if the track defined by the points crosses the
> contour, whereas the vertex distance method will return zero only if a
> vertex is exactly on the contour.
>
> # fiddle the track to cross the contour:
>
>  track.pts[1,1]=.1
>
> # rebuild the lines:
>
>  trackSL = SpatialLines(LinesList=list(Lines(Line(coords=track.pts),1)))
>
> # plot and check:
>
>  lines(trackSL)
>
> # distance should be zero:
>
>  gDistance(trackSL,contourSL)
>  # returns [1] 0
>
>
>
> On Thu, Jul 10, 2014 at 10:23 PM, rhodes.uor <[hidden email] 
> </user/SendEmail.jtp?type=node&node=7586734&i=0>> wrote:
>
> > Hi all,
> >
> > I have two sets of data; a dataframe of lon/lat pairs which 
> correspond to
> > storm track locations, and a gridded rainfall dataset. I've taken 
> contours
> > of the rainfall dataset at a single level and saved them as a
> > SpatialLinesDataFrame. I'm attempting to determine the distance 
> between each
> > of the storm track coordinates and each of the contours. Below is an 
> example
> > of what I have so far, but I can't figure out the next step:
> >
> >
> >
> > For each entry in track.pts I want to return a distance to the 
> nearest point
> > of each entry in contourSL (or in contours, for that matter). Can 
> anyone
> > recommend a way to do this?
> > Thanks very much!
> >
> >
> >
> > --
> > View this message in context: 
> http://r-sig-geo.2731867.n2.nabble.com/Finding-distances-between-points-and-contour-lines-tp7586733.html
> > Sent from the R-sig-geo mailing list archive at Nabble.com.
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > [hidden email] </user/SendEmail.jtp?type=node&node=7586734&i=1>
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> _______________________________________________
> R-sig-Geo mailing list
> [hidden email] </user/SendEmail.jtp?type=node&node=7586734&i=2>
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
> ------------------------------------------------------------------------
> If you reply to this email, your message will be added to the 
> discussion below:
> http://r-sig-geo.2731867.n2.nabble.com/Finding-distances-between-points-and-contour-lines-tp7586733p7586734.html 
>
> To unsubscribe from Finding distances between points and contour 
> lines, click here 
> <http://r-sig-geo.2731867.n2.nabble.com/template/NamlServlet.jtp?macro=unsubscribe_by_code&node=7586733&code=ci5yaG9kZXNAcGdyLnJlYWRpbmcuYWMudWt8NzU4NjczM3wtMTkwNzI5ODU5OA==>.
> NAML 
> <http://r-sig-geo.2731867.n2.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&id=instant_html%21nabble%3Aemail.naml&base=nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.NodeNamespace&breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml> 
>




--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Finding-distances-between-points-and-contour-lines-tp7586733p7586735.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From b.rowlingson at lancaster.ac.uk  Fri Jul 11 16:53:38 2014
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Fri, 11 Jul 2014 15:53:38 +0100
Subject: [R-sig-Geo] Finding distances between points and contour lines
In-Reply-To: <4c945ece043549e08393a9b4ad6f3e6b@EX-0-HT0.lancs.local>
References: <1405027382424-7586733.post@n2.nabble.com>
	<CANVKczOgDqryb7=2q__vhebydkkBC9230UJD2vqiQ3T4_jPb-Q@mail.gmail.com>
	<4c945ece043549e08393a9b4ad6f3e6b@EX-0-HT0.lancs.local>
Message-ID: <CANVKczNrm7DEt=Lf7OGZSdeP8P6s8_8JVn+CMT6PaHsPE+32uQ@mail.gmail.com>

You can use gDistance on points, in which case it computes the minimum
distance between points in each argument...

 If you convert your polygon to SpatialPoints you get all the vertices. So....

> gDistance(SpatialPoints(track.pts), as(contourSL,"SpatialPoints"))
[1] 0.03261514

 - that *should* be the minimum distance between a track point and a
contour point.


On Fri, Jul 11, 2014 at 12:18 PM, rhodes.uor <r.rhodes at pgr.reading.ac.uk> wrote:
> Hi Barry,
>
> Thanks for the reply, my apologies for the HTML code. I think you've hit
> the nail on the head though even without the example. A simple bit of
> Pythagorus on the vertices has done the job perfectly well for now,
> although I'll bear gDistance in mind as I'm certain it will be of use
> later in this project.
>
> Thanks for your help!
> Ruari
>
>
> On 07/11/14 08:45, Barry Rowlingson [via R-sig-geo] wrote:
>> Couple of clarifications:
>>
>>  * I think you sent an HTML email which stripped out your example. Its
>> visible here:
>>
>> http://r-sig-geo.2731867.n2.nabble.com/Finding-distances-between-points-and-contour-lines-tp7586733.html
>>
>> but you shouldn't send HTML emails to the mailing list.
>>
>>  * Do you want the minimal distance between the *vertices* of the
>> lines or the minimal distance between the lines themselves?
>>
>>  For the former its just a question of extracting the vertex
>> coordinates from the spatial data structure and doing a distance
>> calculation between all pairs from each item. If you've transformed
>> your data to a regular cartesian coordinate system then Pythagoras
>> will help you.
>>
>>  For the latter just turn your track into a SpatialLines object and
>> use gDistance from package rgeos:
>>
>> trackSL = SpatialLines(LinesList=list(Lines(Line(coords=track.pts),1)))
>> gDistance(trackSL,contourSL)
>> [1] 0.02220655
>>
>> this will return zero if the track defined by the points crosses the
>> contour, whereas the vertex distance method will return zero only if a
>> vertex is exactly on the contour.
>>
>> # fiddle the track to cross the contour:
>>
>>  track.pts[1,1]=.1
>>
>> # rebuild the lines:
>>
>>  trackSL = SpatialLines(LinesList=list(Lines(Line(coords=track.pts),1)))
>>
>> # plot and check:
>>
>>  lines(trackSL)
>>
>> # distance should be zero:
>>
>>  gDistance(trackSL,contourSL)
>>  # returns [1] 0
>>
>>
>>
>> On Thu, Jul 10, 2014 at 10:23 PM, rhodes.uor <[hidden email]
>> </user/SendEmail.jtp?type=node&node=7586734&i=0>> wrote:
>>
>> > Hi all,
>> >
>> > I have two sets of data; a dataframe of lon/lat pairs which
>> correspond to
>> > storm track locations, and a gridded rainfall dataset. I've taken
>> contours
>> > of the rainfall dataset at a single level and saved them as a
>> > SpatialLinesDataFrame. I'm attempting to determine the distance
>> between each
>> > of the storm track coordinates and each of the contours. Below is an
>> example
>> > of what I have so far, but I can't figure out the next step:
>> >
>> >
>> >
>> > For each entry in track.pts I want to return a distance to the
>> nearest point
>> > of each entry in contourSL (or in contours, for that matter). Can
>> anyone
>> > recommend a way to do this?
>> > Thanks very much!
>> >
>> >
>> >
>> > --
>> > View this message in context:
>> http://r-sig-geo.2731867.n2.nabble.com/Finding-distances-between-points-and-contour-lines-tp7586733.html
>> > Sent from the R-sig-geo mailing list archive at Nabble.com.
>> >
>> > _______________________________________________
>> > R-sig-Geo mailing list
>> > [hidden email] </user/SendEmail.jtp?type=node&node=7586734&i=1>
>> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> [hidden email] </user/SendEmail.jtp?type=node&node=7586734&i=2>
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>
>> ------------------------------------------------------------------------
>> If you reply to this email, your message will be added to the
>> discussion below:
>> http://r-sig-geo.2731867.n2.nabble.com/Finding-distances-between-points-and-contour-lines-tp7586733p7586734.html
>>
>> To unsubscribe from Finding distances between points and contour
>> lines, click here
>> <http://r-sig-geo.2731867.n2.nabble.com/template/NamlServlet.jtp?macro=unsubscribe_by_code&node=7586733&code=ci5yaG9kZXNAcGdyLnJlYWRpbmcuYWMudWt8NzU4NjczM3wtMTkwNzI5ODU5OA==>.
>> NAML
>> <http://r-sig-geo.2731867.n2.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&id=instant_html%21nabble%3Aemail.naml&base=nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.NodeNamespace&breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml>
>>
>
>
>
>
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Finding-distances-between-points-and-contour-lines-tp7586733p7586735.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From jgrn at illinois.edu  Fri Jul 11 17:15:02 2014
From: jgrn at illinois.edu (Jonathan Greenberg)
Date: Fri, 11 Jul 2014 10:15:02 -0500
Subject: [R-sig-Geo] RasterLayerSparse?
In-Reply-To: <CAN9eD7mZFoP2r4B+F9Z0Aa_MD0BAmv1JnMbyCF1mF2D_9HC4tA@mail.gmail.com>
References: <CAN9eD7nxQyKAXPU3fP3FoFC=1o0EUMtWOWQn7v_GQESBR7sUcg@mail.gmail.com>
	<CABG0rfv0W0XRvhnP=DUSAqKOA7Jesd+ri8wCjQDMXiQ8_SrT4g@mail.gmail.com>
	<CAN9eD7mZFoP2r4B+F9Z0Aa_MD0BAmv1JnMbyCF1mF2D_9HC4tA@mail.gmail.com>
Message-ID: <CABG0rftUk4HQyQMfObJ2ZwdXpRZk+bEPpbdXxSZCBu1CqLPhqQ@mail.gmail.com>

Hi Nevil (cc'ing r-sig-geo):

How are they sparse, exactly?  Is this something where you could be
using a vector-like format instead (x,y,category time 1, category time
2), etc?  It might be looking towards the spacetime data models for
some inspiration, since they have a lot of different sparse and
semi-sparse formats.

I'm not quite following why a compressed format wouldn't work in terms
of storage space -- raster, and the functions like getValueBlock (for
instance) don't care what raster format the files are in -- in your
example, those 160 layers could be MUCH smaller (on disk) if they are
truly sparse (lots of 0s or similar values), and still provide the
read/write capabilities just like an uncompressed TIFF would.

--j

On Fri, Jul 11, 2014 at 3:37 AM, nevil amos <nevil.amos at gmail.com> wrote:
> Thanks for the suggestion.
>
> I am compiling a raster stack with ~160 layers of 8000x5000 categorical
> rasters I then need to do an apply() to get unique value combinations for
> each corresponding cell in the rasters, so reading from compressed format (
> as I might do if I were plotting them woes not work.
>
>
> On Fri, Jul 11, 2014 at 7:35 AM, Jonathan Greenberg <jgrn at illinois.edu>
> wrote:
>>
>> Nevil:
>>
>> Have you considered using an alternative backing format that has
>> compression, like an LZW Tiff?  Raster can wrap these with no problem
>> but you benefit from a significantly smaller footprint.
>>
>> --j
>>
>> On Fri, Jul 4, 2014 at 11:00 AM, nevil amos <nevil.amos at gmail.com> wrote:
>> > I note mention of RasterLayerSparse in the raster package documentation
>> > e.g. under setValues()
>> >
>> > Is it possible to setValues from a sparse matrix? can the values be
>> > stored
>> > in the raster object in sparse form to save memory?
>> > Trying to create "sparse raster"  the sparse matrix is not accepted:
>> > library(raster)
>> > library(Matrix)
>> > m<-matrix(c(0,0,1),3,3)
>> > M<-Matrix(m)
>> >> M
>> > 3 x 3 sparse Matrix of class "dtCMatrix"
>> >
>> > [1,] . . .
>> > [2,] . . .
>> > [3,] 1 1 1
>> > ext<-extent(c(0,3,0,3))
>> > R<-raster(ext,3,3)
>> > setValues(R,M)
>> > Error in setValues(R, M) : values must be a vector
>> >
>> >         [[alternative HTML version deleted]]
>> >
>> > _______________________________________________
>> > R-sig-Geo mailing list
>> > R-sig-Geo at r-project.org
>> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>
>>
>> --
>> Jonathan A. Greenberg, PhD
>> Assistant Professor
>> Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
>> Department of Geography and Geographic Information Science
>> University of Illinois at Urbana-Champaign
>> 259 Computing Applications Building, MC-150
>> 605 East Springfield Avenue
>> Champaign, IL  61820-6371
>> Phone: 217-300-1924
>> http://www.geog.illinois.edu/~jgrn/
>> AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007
>
>



-- 
Jonathan A. Greenberg, PhD
Assistant Professor
Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
Department of Geography and Geographic Information Science
University of Illinois at Urbana-Champaign
259 Computing Applications Building, MC-150
605 East Springfield Avenue
Champaign, IL  61820-6371
Phone: 217-300-1924
http://www.geog.illinois.edu/~jgrn/
AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007


From tchafros at gmail.com  Sat Jul 12 19:09:11 2014
From: tchafros at gmail.com (Franklin Tchakounte)
Date: Sat, 12 Jul 2014 18:09:11 +0100
Subject: [R-sig-Geo] Prediction with SpTimer
Message-ID: <CAA2guuyX-Ydpuh_LxDmRxpm9qjvdDczgPZorocKq4dbGa6JBpw@mail.gmail.com>

Hello,

using spTimer i have written the following code to predict in 2015
based on observed data from 2010, 2011, 2012 and 2014. The data file
is attached into this mail.

# Beginning of the code

library(sp)
library(spacetime)
library(gstat)
library(spTimer)
library(timeDate)
setwd("/home//tchakounte//Bureau//Bureau.6.5.2014//nao")
dataSet <- read.csv("DTPP.csv", sep=";")
str(dataSet)
# drop the last two empty rows
#dataSet <- dataSet[1:195,]
#str(dataSet)
dataSet
coords<-as.matrix(unique(cbind(dataSet[,2:3])))
coords
time.data<-spT.time(t.series=39,segment=1)
post.ar <- spT.Gibbs(formula=Population~1, data=dataSet,
coords=coords, model="GP", scale.transform="SQRT")
print(post.ar)
names(post.ar)

# Temporal prediction/forecast for the GP model
 # 1. In the unobserved locations

dataSet1 <- read.csv("DTP11.csv", sep=";")
str(dataSet1)
dataSet1
# define forecast coordinates
fore.coords<-as.matrix(unique(cbind(dataSet1[,2:3])))
 # Two-step ahead forecast, i.e., in day 61 and 62
 # in the unobserved locations using output from spT.Gibbs
   set.seed(11)
   fore.gp <- predict(post.ar, newdata=dataSet1,
newcoords=fore.coords, type="temporal", foreStep=1, tol.dist=0.2,
time.data=time.data)
   print(fore.gp)
   names(fore.gp)
 # Display of the results
   fore.gp$Mean

# End

I obtained in 2015 the following data. But they are far from data in
2014 (pop2014 column) and to the reality . What can be the reason? Is
it possible to improve these results? is the code not good?

9091.872
12556.05
8597.584
13149.06
13274.52
12901.98
5943.395
12714.68
12244.41
14581.41
10488.06
10456.81
10456.72
10618.93
10868.03
9995.434
10011.75
9852.718
10038.11
10813.48
10588.04
10531.63
10320.15
13652.01
9871.999
12379.98
12971.01
12034.11
11955.15
14497.78
10812.44
10714.2
10360.53
10632.32
10596.62
10256.28
10279.86
9967.04
10362.7

Thanks in advance.

Franklin Tchakount?
-------------- next part --------------
A non-text attachment was scrubbed...
Name: DTPP.csv
Type: text/csv
Size: 7162 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140712/a70f79e0/attachment.bin>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: DTP11.csv
Type: text/csv
Size: 1320 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140712/a70f79e0/attachment-0001.bin>

From edzer.pebesma at uni-muenster.de  Sun Jul 13 18:11:42 2014
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Sun, 13 Jul 2014 18:11:42 +0200
Subject: [R-sig-Geo] write.tgrass (spacetime) does not create init.txt
In-Reply-To: <CAPHDReKONfszhz01LLEE5KhUYRZF=JweSmV=hPHoCk5d-c2VHA@mail.gmail.com>
References: <CAAMki4EuOXFUCj0Md0E-9jawkYjai=Erw527xpbX6s5_R78wyg@mail.gmail.com>	<53BACF02.8010700@uni-muenster.de>
	<CAPHDReKONfszhz01LLEE5KhUYRZF=JweSmV=hPHoCk5d-c2VHA@mail.gmail.com>
Message-ID: <53C2AFBE.3030103@uni-muenster.de>

spacetime::write.tgrass (as it is on github) now writes init.txt,
hopefully correct. I took examples from
https://www-pool.math.tu-berlin.de/~soeren/grass/ , and used file
precipitation_1950_2013_yearly_mm.tar.gz.

In this file, init.txt has quite different content from that you
describe below:

stds_type=strds
format=GTiff
temporal_type=absolute
semantic_type=mean
number_of_maps=63
north=75.5
south=25.25
east=75.5
west=-40.5

Does tgrass depend on knowing "relative_time_unit"?

I could write a function that write "years" when the number of days
between time stamps is 356 or 366, and act similarly for "months" (28,
29, 30 or 31), but this is somewhat messy of course, and things get
worse in case of daylight saving time and monthly data... Suggestions
welcome!

On 07/07/2014 06:57 PM, S?ren Gebbert wrote:
> Hi,
> init.txt has the following content:
> 
> temporal_type=absolute
> semantic_type=mean
> relative_time_unit=years
> number_of_maps=61
> north=75.5
> south=25.25
> east=75.5
> west=-40.5
> 
> The spatial extent is ignored while importing, but the temporal type,
> semantic type (still a dummy in TGRASS) and the number of maps must be
> provided. The relative time unit is mandatory if the dataset has
> relative time, otherwise it can be left out.
> 
> I noticed that the reader expects always absolute time, is it possible
> to support relative time as well?
> 
> 
> Best regards
> Soeren
> 
> 2014-07-07 18:46 GMT+02:00 Edzer Pebesma <edzer.pebesma at uni-muenster.de>:
>> Thanks for the clear report, Veronica.
>>
>> Soeren (Cc:), do you know where we can find a description of the
>> requirements, or examples, of the init.txt file?
>>
>> On 07/07/2014 06:31 PM, Veronica Andreo wrote:
>>> Hi list
>>>
>>> I'm using R to run some processing over a spatio-temporal raster dataset
>>> coming from GRASS. The workflow is as follows:
>>>
>>> 1. Export all my images from GRASS with t.rast.export
>>> 2. Import them as a raster stack in R with read.tgrass
>>> 3. do the processing... which implies converting the rasterstack into a
>>> matrix, transposing and running dineof
>>> 4. create the rasterstack again, add the time with setZ
>>> 5. export with write.tgrass (which only seems to work for RasterStack and
>>> not for STFDF, i tried both ways)
>>> 6. and import to grass again...
>>>
>>> here is where I get the error since an init.txt file with the following
>>> information is needed but it's not created by write.tgrass...
>>>
>>> stds_type=strds
>>> format=GTiff
>>> temporal_type=absolute
>>> semantic_type=mean
>>> number_of_maps=
>>> north=
>>> south=
>>> east=
>>> west=
>>>
>>> There are of course some workarounds but it would be nice -and much more
>>> straightforward- that the function which is intended to provide interface
>>> between R and T-GRASS, already does the job itself :)
>>>
>>> Thanks much!
>>>
>>> Best,
>>> Vero
>>>
>>>       [[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>> --
>> Edzer Pebesma
>> Institute for Geoinformatics (ifgi), University of M?nster
>> Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
>> 83 33081 http://ifgi.uni-muenster.de GPG key ID 0xAC227795
>>

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
83 33081 http://ifgi.uni-muenster.de GPG key ID 0xAC227795

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 490 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140713/ead03221/attachment.bin>

From ben.graeler at uni-muenster.de  Mon Jul 14 16:58:01 2014
From: ben.graeler at uni-muenster.de (=?ISO-8859-1?Q?Benedikt_Gr=E4ler?=)
Date: Mon, 14 Jul 2014 16:58:01 +0200
Subject: [R-sig-Geo] Spatial Copula Workshop -- call for participation
Message-ID: <53C3EFF9.2010303@uni-muenster.de>

Dear list members,

we would like to turn your interest to the Spatial Copula Workshop held
at the Institute for Geoinformatics in M?nster on 22nd and 23rd
September 2014. The program is now settled but joining the audience in
talks and discussions is still possible.

Please find further details on the workshop at:

http://blogs.ifgi.de/SpatialCopulaWorkshop

Copula based models have been developed for various spatial applications
in recent years. In hydrology, copulas are for instance used to model
dependencies among storm variables or to interpolate precipitation
across space. Copulas can be found as well in weather prediction,
interpolation of radioactive radiation, air quality assessments, disease
mapping, or risk evaluation of infectious disease. Some of these models
are based on classical multivariate elliptical copulas with the Matern
class of spatial dependencies, while other allow for the more flexible
class of vine copulas. This workshop aims at gathering researchers
across different domains developing and using spatial copulas. During
these two days recent theoretical developments of spatial copulas and
their applications will be presented and discussed. This exchange of
ideas will contribute to the future development of spatial copulas for
many application scenarios and provides opportunities for collaboration
in this exciting and fast-growing research topic. The spatial copula
workshop is a fork of a series of vine copula workshops (see
www.vine-copula.org) and a join with the wide field of spatial statistics.

Kind regards,

 Ben

-- 
Benedikt Gr?ler

ifgi - Institute for Geoinformatics
University of Muenster

http://ifgi.uni-muenster.de/graeler

Phone: +49 251 83-33082
Mail: ben.graeler at uni-muenster.de

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 560 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140714/3d3e54ac/attachment.bin>

From Alexander.Herr at csiro.au  Tue Jul 15 08:07:55 2014
From: Alexander.Herr at csiro.au (Alexander.Herr at csiro.au)
Date: Tue, 15 Jul 2014 06:07:55 +0000
Subject: [R-sig-Geo] getValues: error extracting values of large raster
Message-ID: <DE9431576890DA46BC57EA03BC10449B7FC4BB9D@exmbx06-cdc.nexus.csiro.au>

Hello,
I am getting the following:


While extracting all values with: 
> rs<-getValues(rster)

Error in getRasterData(con, offset = offs, region.dim = reg, band = object at data@band): long vectors not supported yet: memory.c:3308

> rster
class       : RasterLayer 
dimensions  : 76740, 80200, 6154548000  (nrow, ncol, ncell)
resolution  : 50, 50  (x, y)
extent      : -1888000, 2122000, -4847000, -1010000  (xmin, xmax, ymin, ymax)
coord. ref. : +proj=aea +lat_1=-18 +lat_2=-36 +lat_0=0 +lon_0=132 +x_0=0 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs 
data source : /data/her134/BA/GDA94albers/clum50m0314 
names       : clum50m0314 
values      : 100, 663  (min, max)
attributes  :
        ID  COUNT LU_CODEV7 LU_CODEV7N                                  TERTIARY_V7
 from: 100 540931     1.0.0        100  1.0.0 Conservation and natural environments
 to  : 663   1755     6.6.3        663 6.6.3 Estuary/coastal waters - intensive use
                              SECONDARY_V7                              PRIMARY_V7 CLASSES_18
 1.0 Conservation and natural environments 1 Conservation and natural environments          1
                6.6 Estuary/coastal waters                                 6 Water         17
           C18_DESCRIPTION
 Nature conservation (1.1)
               Water (6.0)



Using:
platform       x86_64-unknown-linux-gnu    
arch           x86_64                      
os             linux-gnu                   
system         x86_64, linux-gnu           
status                                     
major          3                           
minor          1.0                         
year           2014                        
month          04                          
day            10                          
svn rev        65387                       
language       R                           
version.string R version 3.1.0 (2014-04-10)
nickname       Spring Dance        

raster version 2.2.31

Linux:
LSB Version:	core-2.0-noarch:core-3.2-noarch:core-4.0-noarch:core-2.0-x86_64:core-3.2-x86_64:core-4.0-x86_64:desktop-4.0-amd64:desktop-4.0-noarch:graphics-2.0-amd64:graphics-2.0-noarch:graphics-3.2-amd64:graphics-3.2-noarch:graphics-4.0-amd64:graphics-4.0-noarch
Distributor ID:	SUSE LINUX
Description:	SUSE Linux Enterprise Server 11 (x86_64)
Release:	11
Codename:	n/a


I used to be able to handle this sized raster in earlier versions. Any ideas of a workaround?

Cheers and thanks
Herry


From bhartendu1988pandey at gmail.com  Tue Jul 15 21:07:46 2014
From: bhartendu1988pandey at gmail.com (bhartendupandey)
Date: Tue, 15 Jul 2014 12:07:46 -0700 (PDT)
Subject: [R-sig-Geo] GWmodel package results
Message-ID: <1405451266876-7586742.post@n2.nabble.com>

Dear list, 

I am experimenting with the GWmodel package and I just ran an example code
(with LondonHP data) given in the reference manual for gwr.generalised()
function. Incidently, I ran it in two different computers installed with
different versions of the package. I noted differences between the results
(for both poisson and binomial models) from the two versions:

1. GWmodel_1.2-1
2. GWmodel_1.2-3 

Essentially, I noted that the bandwidth estimated using bw.ggwr() function
from the two versions were different, which is ultimately causing the GWR
model results to vary. Now I wonder what is causing the differences in
bandwidth estimates and more importantly, which version of the package is
reliable? 

I ran the following code:

data(LondonHP)
DM<-gw.dist(dp.locat=coordinates(londonhp))
bw.f1 <- bw.ggwr(BATH2~FLOORSZ,data=londonhp, dMat=DM)
res.poisson<-gwr.generalised(BATH2~FLOORSZ, bw=bw.f1,data=londonhp, dMat=DM)
bw.f2 <- bw.ggwr(BATH2~FLOORSZ,data=londonhp, dMat=DM,family ="binomial")
res.binomial<-gwr.generalised(BATH2~FLOORSZ, bw=bw.f2,data=londonhp,
dMat=DM,
family ="binomial")
 
Here is the sessionInfo() from the two computers: 

Computer 1: 
> sessionInfo()
R version 3.0.1 (2013-05-16)
Platform: x86_64-w64-mingw32/x64 (64-bit)

locale:
[1] LC_COLLATE=English_United States.1252 
[2] LC_CTYPE=English_United States.1252   
[3] LC_MONETARY=English_United States.1252
[4] LC_NUMERIC=C                          
[5] LC_TIME=English_United States.1252    

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
[1] GWmodel_1.2-3     robustbase_0.91-1 maptools_0.8-30   sp_1.0-15        

loaded via a namespace (and not attached):
[1] DEoptimR_1.0-1  foreign_0.8-53  grid_3.0.1      lattice_0.20-15
[5] tools_3.0.1    

 Computer 2: 
> sessionInfo()
R version 3.0.0 (2013-04-03)
Platform: x86_64-w64-mingw32/x64 (64-bit)

locale:
[1] LC_COLLATE=English_United States.1252 
[2] LC_CTYPE=English_United States.1252   
[3] LC_MONETARY=English_United States.1252
[4] LC_NUMERIC=C                          
[5] LC_TIME=English_United States.1252    

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
[1] raster_2.1-16     lattice_0.20-15   GWmodel_1.2-1     robustbase_0.9-10
[5] maptools_0.8-26   sp_1.0-11        

loaded via a namespace (and not attached):
[1] foreign_0.8-53 grid_3.0.0     tools_3.0.0         

loaded via a namespace (and not attached):
[1] DEoptimR_1.0-1  foreign_0.8-53  grid_3.0.1      lattice_0.20-15
tools_3.0.1 

Many thanks for any help and your time.

Best regards,
Bhartendu





--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/GWmodel-package-results-tp7586742.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From lubinbin220 at gmail.com  Wed Jul 16 04:03:33 2014
From: lubinbin220 at gmail.com (lubinbin220 at gmail.com)
Date: Wed, 16 Jul 2014 10:03:33 +0800
Subject: [R-sig-Geo] GWmodel package results
References: <1405451266876-7586742.post@n2.nabble.com>
Message-ID: <201407161003317144325@gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140716/0afedbb6/attachment.pl>

From Alexander.Herr at csiro.au  Wed Jul 16 06:43:03 2014
From: Alexander.Herr at csiro.au (Herry)
Date: Tue, 15 Jul 2014 21:43:03 -0700 (PDT)
Subject: [R-sig-Geo] writeRaster give error "no slot of name "file" for
 this object..."
In-Reply-To: <1307468974241-6450713.post@n2.nabble.com>
References: <1307465799277-6450479.post@n2.nabble.com>
	<1307468974241-6450713.post@n2.nabble.com>
Message-ID: <1405485783495-7586744.post@n2.nabble.com>

Hello,

I have a similar problem, but using the latest versions of R and raster:

"luse1"<-function(x){ 
  x[x >=1 & x<=199]<-100        #Conservation land use
  x[x >=200 & x<=299]<-200        #Native Vegetation extensive use
  x[x >=210 & x<=210]<-210        #Grazing native vegetation
  x[x >=221 & x<=222]<-220        #Production forestry
  x[x >=300 & x<=399]<-300        #Dryland agriculture and plantations
  x[x >=310 & x<=314]<-310        #Plantations
  x[x >=321 & x<=325]<-320        #Grazing modified pastures
  x[x >=331 & x<=338]<-330        #Cropping
  x[x >=341 & x<=349]<-340        #Horticulture
  x[x >=400 & x<=499]<-400        #Irrigated agriculture and plantations
  x[x >=411 & x<=414]<-410        #Irrigated plantation
  x[x >=421 & x<=224]<-420        #Irrigated pasture
  x[x >=431 & x<=439]<-430        #Irrigated cropping
  x[x >=441 & x<=449]<-440        #Irrigated horticulture
  x[x >=451 & x<=455]<-450        #Irrigated seasonal horticulture
  x[x >=500 & x<=599]<-500        #Intensive uses
  x[x >=600 & x<=699]<-600        #Water
  x[x >=611 & x<=614]<-610        #Lake
  x[x >=621 & x<=623]<-620        #Reservoir or dam
  x[x >=631 & x<=633]<-630        #River
  x[x >=641 & x<=643]<-640        #Channel/aquaduct
  x[x >=651 & x<=654]<-650        #Marsh/wetland
  x[x >=661 & x<=663]<-660        #Estuary/coast waters
  return(x[])
}



> writeStart(s, filename = 'landuse4BA.grd', overwrite =TRUE)
class       : RasterLayer 
dimensions  : 76740, 80200, 6154548000  (nrow, ncol, ncell)
resolution  : 50, 50  (x, y)
extent      : -1888000, 2122000, -4847000, -1010000  (xmin, xmax, ymin,
ymax)
coord. ref. : +proj=aea +lat_1=-18 +lat_2=-36 +lat_0=0 +lon_0=132 +x_0=0
+y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs 
data source :
\\wron/Project/BA/BA_ecology/Ozdata/landuse/clum_50m0314m/R/landuse4BA.grd 
names       : clum50m0314 

> for (i in 1:nrow(rs)) {
+   print(paste(i, "of", nrow(rs),";", round(i/nrow(rs)*100,1), "%
complete"))
+   v <- getValues(rs, row=i, nrows=1)
+   z<-luse1(v) #assign landuse value
+   s <- writeValues(s, z, i)
+ }
[1] "1 of 76740 ; 0 % complete"
Error in is(object) : 
  no slot of name "transient" for this object of class ".RasterFile"


> sessionInfo()
R version 3.1.1 (2014-07-10)
Platform: x86_64-w64-mingw32/x64 (64-bit)

locale:
[1] LC_COLLATE=English_Australia.1252  LC_CTYPE=English_Australia.1252   
LC_MONETARY=English_Australia.1252 LC_NUMERIC=C                      
LC_TIME=English_Australia.1252    

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
[1] rgdal_0.8-16  raster_2.2-31 sp_1.0-15     spatial_7.3-8

loaded via a namespace (and not attached):
[1] grid_3.1.1      lattice_0.20-29


Any suggestions?
Thanks and cheers
Herry



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/writeRaster-give-error-no-slot-of-name-file-for-this-object-tp6450479p7586744.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From jon.skoien at jrc.ec.europa.eu  Wed Jul 16 11:12:02 2014
From: jon.skoien at jrc.ec.europa.eu (Jon Olav Skoien)
Date: Wed, 16 Jul 2014 11:12:02 +0200
Subject: [R-sig-Geo] writeRaster give error "no slot of name "file" for
 this object..."
In-Reply-To: <1405485783495-7586744.post@n2.nabble.com>
References: <1307465799277-6450479.post@n2.nabble.com>
	<1307468974241-6450713.post@n2.nabble.com>
	<1405485783495-7586744.post@n2.nabble.com>
Message-ID: <53C641E2.3040006@jrc.ec.europa.eu>

s is not updated with the file name of your output grid just by a call 
to writeStart, you need to assign the result of writeStart to s:

s <- writeStart(s, filename = 'landuse4BA.grd', overwrite =TRUE)

See the output of str(s) before and after the call to writeStart to see 
the difference. Then it should be possible to write values to the file 
as well.

Cheers,
Jon


On 16-Jul-14 6:43, Herry wrote:
> Hello,
>
> I have a similar problem, but using the latest versions of R and raster:
>
> "luse1"<-function(x){
>    x[x >=1 & x<=199]<-100        #Conservation land use
>    x[x >=200 & x<=299]<-200        #Native Vegetation extensive use
>    x[x >=210 & x<=210]<-210        #Grazing native vegetation
>    x[x >=221 & x<=222]<-220        #Production forestry
>    x[x >=300 & x<=399]<-300        #Dryland agriculture and plantations
>    x[x >=310 & x<=314]<-310        #Plantations
>    x[x >=321 & x<=325]<-320        #Grazing modified pastures
>    x[x >=331 & x<=338]<-330        #Cropping
>    x[x >=341 & x<=349]<-340        #Horticulture
>    x[x >=400 & x<=499]<-400        #Irrigated agriculture and plantations
>    x[x >=411 & x<=414]<-410        #Irrigated plantation
>    x[x >=421 & x<=224]<-420        #Irrigated pasture
>    x[x >=431 & x<=439]<-430        #Irrigated cropping
>    x[x >=441 & x<=449]<-440        #Irrigated horticulture
>    x[x >=451 & x<=455]<-450        #Irrigated seasonal horticulture
>    x[x >=500 & x<=599]<-500        #Intensive uses
>    x[x >=600 & x<=699]<-600        #Water
>    x[x >=611 & x<=614]<-610        #Lake
>    x[x >=621 & x<=623]<-620        #Reservoir or dam
>    x[x >=631 & x<=633]<-630        #River
>    x[x >=641 & x<=643]<-640        #Channel/aquaduct
>    x[x >=651 & x<=654]<-650        #Marsh/wetland
>    x[x >=661 & x<=663]<-660        #Estuary/coast waters
>    return(x[])
> }
>
>
>
>> writeStart(s, filename = 'landuse4BA.grd', overwrite =TRUE)
> class       : RasterLayer
> dimensions  : 76740, 80200, 6154548000  (nrow, ncol, ncell)
> resolution  : 50, 50  (x, y)
> extent      : -1888000, 2122000, -4847000, -1010000  (xmin, xmax, ymin,
> ymax)
> coord. ref. : +proj=aea +lat_1=-18 +lat_2=-36 +lat_0=0 +lon_0=132 +x_0=0
> +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs
> data source :
> \\wron/Project/BA/BA_ecology/Ozdata/landuse/clum_50m0314m/R/landuse4BA.grd
> names       : clum50m0314
>
>> for (i in 1:nrow(rs)) {
> +   print(paste(i, "of", nrow(rs),";", round(i/nrow(rs)*100,1), "%
> complete"))
> +   v <- getValues(rs, row=i, nrows=1)
> +   z<-luse1(v) #assign landuse value
> +   s <- writeValues(s, z, i)
> + }
> [1] "1 of 76740 ; 0 % complete"
> Error in is(object) :
>    no slot of name "transient" for this object of class ".RasterFile"
>
>
>> sessionInfo()
> R version 3.1.1 (2014-07-10)
> Platform: x86_64-w64-mingw32/x64 (64-bit)
>
> locale:
> [1] LC_COLLATE=English_Australia.1252  LC_CTYPE=English_Australia.1252
> LC_MONETARY=English_Australia.1252 LC_NUMERIC=C
> LC_TIME=English_Australia.1252
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> other attached packages:
> [1] rgdal_0.8-16  raster_2.2-31 sp_1.0-15     spatial_7.3-8
>
> loaded via a namespace (and not attached):
> [1] grid_3.1.1      lattice_0.20-29
>
>
> Any suggestions?
> Thanks and cheers
> Herry
>
>
>
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/writeRaster-give-error-no-slot-of-name-file-for-this-object-tp6450479p7586744.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


-- 
Jon Olav Sk?ien
Joint Research Centre - European Commission
Institute for Environment and Sustainability (IES)
Climate Risk Management Unit

Via Fermi 2749, TP 100-01,  I-21027 Ispra (VA), ITALY

jon.skoien at jrc.ec.europa.eu
Tel:  +39 0332 789205

Disclaimer: Views expressed in this email are those of the individual and do not necessarily represent official views of the European Commission.


From thi_veloso at yahoo.com.br  Wed Jul 16 11:50:58 2014
From: thi_veloso at yahoo.com.br (Thiago V. dos Santos)
Date: Wed, 16 Jul 2014 02:50:58 -0700
Subject: [R-sig-Geo] Count values "greater than" in rasterbrick layers
Message-ID: <1405504258.52913.YahooMailNeo@web121901.mail.ne1.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140716/c7624bb8/attachment.pl>

From jstachel at sfwmd.gov  Wed Jul 16 14:30:45 2014
From: jstachel at sfwmd.gov (Stachelek, Joseph)
Date: Wed, 16 Jul 2014 12:30:45 +0000
Subject: [R-sig-Geo] Count values "greater than" in rasterbrick layers
In-Reply-To: <1405504258.52913.YahooMailNeo@web121901.mail.ne1.yahoo.com>
References: <1405504258.52913.YahooMailNeo@web121901.mail.ne1.yahoo.com>
Message-ID: <D51374C4B889BC47B3C5286047C86DA17C14B3A9@whqembx03p.ad.sfwmd.gov>

Hi Thiago,

Ignoring the fact that you have negative rainfall amounts in your example, I would go about this problem by reclassifying the raster brick to a binary classification. Then if you sum you get raw counts.

#count wet days
b.wet<-reclassify(b,c(-Inf,0,0))
b.wet<-reclassify(b.wet,c(0,+Inf,1))
plot(b.wet[[1]])
plot(sum(b.wet))

-----Original Message-----
From: r-sig-geo-bounces at r-project.org [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of Thiago V. dos Santos
Sent: Wednesday, July 16, 2014 5:51 AM
To: R-SIG list
Subject: [R-sig-Geo] Count values "greater than" in rasterbrick layers

Dear all,

I have a 31-layer rasterbrick where each layer represents daily rainfall records for a certain month.

My goal is to perform two calculations in this brick:

a) Sum up total rainfall for the entire month

b) For the entire month (all rasterbrick layers), calculate the number of days where it rained (i.e. rainfall > 1)

Problem a) is straightforward and I solved it with the help of a simple calc command.

Problem b), however, is where I am having troubles. The command I came up with doesn't work, as the final raster has values way greater than 31 (which would be the limit of each cell, if it had rained every day of the month on that cell).

This is my code so far. Any suggestions?

library(raster)

# generate raster data
r <- raster(ncol=384, nrow=190)
b <- brick(sapply(1:31, function(i) setValues(r, rnorm(ncell(r), i, 3))))

# sum up rain
acc.rain <- calc(b, fun=sum)

# count wet days
wet.days <- calc(b, fun=function(x,na.rm) sum(x[x>1]))


Many thanks in advance,
--
Thiago V. dos Santos
PhD student
Land and Atmospheric Science
University of Minnesota
http://www.laas.umn.edu/CurrentStudents/MeettheStudents/ThiagodosSantos/index.htm
Phone: (612) 323 9898
        [[alternative HTML version deleted]]



We value your opinion. Please take a few minutes to share your comments on the service you received from the District by clicking on this link<http://my.sfwmd.gov/portal/page/portal/pg_grp_surveysystem/survey%20ext?pid=1653>.


From danielvdelatorre at gmail.com  Wed Jul 16 21:45:58 2014
From: danielvdelatorre at gmail.com (=?UTF-8?Q?Daniel_Varaj=C3=A3o_de_Latorre?=)
Date: Wed, 16 Jul 2014 16:45:58 -0300
Subject: [R-sig-Geo] Projection issue with Zoogeographic Realms maps
Message-ID: <CAOtDXvC3pOWeMzHZhHGGaA4Bv52irv3GSLdqEtcdQM2nPrvp+w@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140716/4b591651/attachment.pl>

From b.rowlingson at lancaster.ac.uk  Thu Jul 17 00:09:54 2014
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Wed, 16 Jul 2014 23:09:54 +0100
Subject: [R-sig-Geo] Projection issue with Zoogeographic Realms maps
In-Reply-To: <3aba25a654f44fd2887d627515713e07@EX-1-HT0.lancs.local>
References: <3aba25a654f44fd2887d627515713e07@EX-1-HT0.lancs.local>
Message-ID: <CANVKczNWLjnw611rF8nyXXF0B7sNZ_-6+fC9WgDhj7SrixdbPQ@mail.gmail.com>

The bounding box of your data is:

> bbox(newRealms)
         min      max
x -180.00000 180.0000
y  -55.90223  83.6236

and since -180 is the same longitude as +180, its a coin toss as to
what side of the world the projection will end up putting it on (well,
not really a coin toss but subject to the approximations of floating
point arithmetic and rounding).

So any feature that has any point near + or - 180 has a chance of
those points being mapped to the other side of the world on the
Mollweide projection. This doesn't happen with the lat-long projection
because +180 and -180 are stored separately and treated as those
numbers without any transformation. Only once you start computing on
those numbers (taking sines and cosines, for example) will you get
into trouble.

This may be the same problem as here:

http://r-sig-geo.2731867.n2.nabble.com/Strange-lines-when-projecting-a-world-map-td7585274.html

the solution might be to clip the original at -179 and +179 - that
should keep points far enough away from the limb of the Mollweide
projection.

On Wed, Jul 16, 2014 at 8:45 PM, Daniel Varaj?o de Latorre
<danielvdelatorre at gmail.com> wrote:
> Dear list,
>
> I am trying to change the projection of a SpatialPolygonsDataFrame but
> there is something wrong going on that I can't figure. The projected map
> show some lines that shouldn't be there.
>
> The shape file was downloaded from here:
> http://macroecology.ku.dk/resources/wallace/#Gis
>
> Here is the very simple code I'm using:
>
> setwd(PATH)
> newrealms<-readShapePoly("newRealms.shp")
> proj4string(newrealms) <- CRS("+proj=longlat +ellps=WGS84 +datum=WGS84
> +no_defs")
> moll_crs<-CRS("+proj=moll +ellps=WGS84")
> newrealms_moll <- spTransform(newrealms, moll_crs)
> plot(newrealms)
> plot(newrealms_moll) #unexpected lines
>
> Can anyone help me with this?
>
> Thanks in advance!
>
> Daniel
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From jgrn at illinois.edu  Thu Jul 17 04:53:33 2014
From: jgrn at illinois.edu (Jonathan Greenberg)
Date: Wed, 16 Jul 2014 21:53:33 -0500
Subject: [R-sig-Geo] getValues: error extracting values of large raster
In-Reply-To: <DE9431576890DA46BC57EA03BC10449B7FC4BB9D@exmbx06-cdc.nexus.csiro.au>
References: <DE9431576890DA46BC57EA03BC10449B7FC4BB9D@exmbx06-cdc.nexus.csiro.au>
Message-ID: <CABG0rfu45hiQiT_Vff1OE9yT2OGZXbcsA-QakP4v7mL2tDg9Uw@mail.gmail.com>

Herry:

This is going to be an issue with your R install, not something
specific to raster -- you are attempting to load an entire raster into
an in-memory vector/matrix, and some versions/installs of R only allow
vectors of length 2^31-1 = 2,147,483,647 values.  Your raster has
6,154,548,000 values, approximately 3x this size.  If your data is
being read in as a 16 bit integer, this means you need 6,154,548,000
times 16 bits equals approximately 12 gb of RAM.  If it is being read
in as a double precision floating point, this means the vector needs
to have at least 48gb of RAM.

You might want to search for that error "long vectors not supported
yet" and see what solutions people have.

As a general rule, you should try to avoid loading an entire raster
into memory if you can avoid it -- why are you trying to do a full
read-into-memory?  Can you do chunk-based processing?  Subsampling?

--j


On Tue, Jul 15, 2014 at 1:07 AM,  <Alexander.Herr at csiro.au> wrote:
> Hello,
> I am getting the following:
>
>
> While extracting all values with:
>> rs<-getValues(rster)
>
> Error in getRasterData(con, offset = offs, region.dim = reg, band = object at data@band): long vectors not supported yet: memory.c:3308
>
>> rster
> class       : RasterLayer
> dimensions  : 76740, 80200, 6154548000  (nrow, ncol, ncell)
> resolution  : 50, 50  (x, y)
> extent      : -1888000, 2122000, -4847000, -1010000  (xmin, xmax, ymin, ymax)
> coord. ref. : +proj=aea +lat_1=-18 +lat_2=-36 +lat_0=0 +lon_0=132 +x_0=0 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs
> data source : /data/her134/BA/GDA94albers/clum50m0314
> names       : clum50m0314
> values      : 100, 663  (min, max)
> attributes  :
>         ID  COUNT LU_CODEV7 LU_CODEV7N                                  TERTIARY_V7
>  from: 100 540931     1.0.0        100  1.0.0 Conservation and natural environments
>  to  : 663   1755     6.6.3        663 6.6.3 Estuary/coastal waters - intensive use
>                               SECONDARY_V7                              PRIMARY_V7 CLASSES_18
>  1.0 Conservation and natural environments 1 Conservation and natural environments          1
>                 6.6 Estuary/coastal waters                                 6 Water         17
>            C18_DESCRIPTION
>  Nature conservation (1.1)
>                Water (6.0)
>
>
>
> Using:
> platform       x86_64-unknown-linux-gnu
> arch           x86_64
> os             linux-gnu
> system         x86_64, linux-gnu
> status
> major          3
> minor          1.0
> year           2014
> month          04
> day            10
> svn rev        65387
> language       R
> version.string R version 3.1.0 (2014-04-10)
> nickname       Spring Dance
>
> raster version 2.2.31
>
> Linux:
> LSB Version:    core-2.0-noarch:core-3.2-noarch:core-4.0-noarch:core-2.0-x86_64:core-3.2-x86_64:core-4.0-x86_64:desktop-4.0-amd64:desktop-4.0-noarch:graphics-2.0-amd64:graphics-2.0-noarch:graphics-3.2-amd64:graphics-3.2-noarch:graphics-4.0-amd64:graphics-4.0-noarch
> Distributor ID: SUSE LINUX
> Description:    SUSE Linux Enterprise Server 11 (x86_64)
> Release:        11
> Codename:       n/a
>
>
> I used to be able to handle this sized raster in earlier versions. Any ideas of a workaround?
>
> Cheers and thanks
> Herry
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



-- 
Jonathan A. Greenberg, PhD
Assistant Professor
Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
Department of Geography and Geographic Information Science
University of Illinois at Urbana-Champaign
259 Computing Applications Building, MC-150
605 East Springfield Avenue
Champaign, IL  61820-6371
Phone: 217-300-1924
http://www.geog.illinois.edu/~jgrn/
AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007


From jgrn at illinois.edu  Thu Jul 17 07:43:29 2014
From: jgrn at illinois.edu (Jonathan Greenberg)
Date: Thu, 17 Jul 2014 00:43:29 -0500
Subject: [R-sig-Geo] getValues: error extracting values of large raster
In-Reply-To: <DE9431576890DA46BC57EA03BC10449B7FC4DCB8@exmbx06-cdc.nexus.csiro.au>
References: <DE9431576890DA46BC57EA03BC10449B7FC4BB9D@exmbx06-cdc.nexus.csiro.au>
	<CABG0rfu45hiQiT_Vff1OE9yT2OGZXbcsA-QakP4v7mL2tDg9Uw@mail.gmail.com>
	<DE9431576890DA46BC57EA03BC10449B7FC4DCB8@exmbx06-cdc.nexus.csiro.au>
Message-ID: <CABG0rfsC_9ej3AxeTVpyiFeF2HBLitn7pMCsos-X3ysxjz4hfQ@mail.gmail.com>

Herry:

If you are just doing reclassification, consider using rasterEngine in
the spatial.tools package which can be used for HPC computing of
rasters.

--j

On Wed, Jul 16, 2014 at 10:43 PM,  <Alexander.Herr at csiro.au> wrote:
> Thanks Johathan,
>
> I am working on a HPC, so could get the memory, but it is obviously the vector size limit... I was attempting to load the raster values to reclassify and thought it might be faster working on vectors in memory.
>
> I have since moved to getValuesBlock() and am working it in junks.
>
>
> Cheers
> Herry
>
>
> -----Original Message-----
> From: jgrn307 at gmail.com [mailto:jgrn307 at gmail.com] On Behalf Of Jonathan Greenberg
> Sent: Thursday, 17 July 2014 12:54 PM
> To: Herr, Alexander Herr - Herry (L&W, Black Mountain)
> Cc: r-sig-geo at r-project.org
> Subject: Re: [R-sig-Geo] getValues: error extracting values of large raster
>
> Herry:
>
> This is going to be an issue with your R install, not something specific to raster -- you are attempting to load an entire raster into an in-memory vector/matrix, and some versions/installs of R only allow vectors of length 2^31-1 = 2,147,483,647 values.  Your raster has
> 6,154,548,000 values, approximately 3x this size.  If your data is being read in as a 16 bit integer, this means you need 6,154,548,000 times 16 bits equals approximately 12 gb of RAM.  If it is being read in as a double precision floating point, this means the vector needs to have at least 48gb of RAM.
>
> You might want to search for that error "long vectors not supported yet" and see what solutions people have.
>
> As a general rule, you should try to avoid loading an entire raster into memory if you can avoid it -- why are you trying to do a full read-into-memory?  Can you do chunk-based processing?  Subsampling?
>
> --j
>
>
> On Tue, Jul 15, 2014 at 1:07 AM,  <Alexander.Herr at csiro.au> wrote:
>> Hello,
>> I am getting the following:
>>
>>
>> While extracting all values with:
>>> rs<-getValues(rster)
>>
>> Error in getRasterData(con, offset = offs, region.dim = reg, band =
>> object at data@band): long vectors not supported yet: memory.c:3308
>>
>>> rster
>> class       : RasterLayer
>> dimensions  : 76740, 80200, 6154548000  (nrow, ncol, ncell) resolution
>> : 50, 50  (x, y)
>> extent      : -1888000, 2122000, -4847000, -1010000  (xmin, xmax, ymin, ymax)
>> coord. ref. : +proj=aea +lat_1=-18 +lat_2=-36 +lat_0=0 +lon_0=132
>> +x_0=0 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs data source : /data/her134/BA/GDA94albers/clum50m0314
>> names       : clum50m0314
>> values      : 100, 663  (min, max)
>> attributes  :
>>         ID  COUNT LU_CODEV7 LU_CODEV7N                                  TERTIARY_V7
>>  from: 100 540931     1.0.0        100  1.0.0 Conservation and natural environments
>>  to  : 663   1755     6.6.3        663 6.6.3 Estuary/coastal waters - intensive use
>>                               SECONDARY_V7                              PRIMARY_V7 CLASSES_18
>>  1.0 Conservation and natural environments 1 Conservation and natural environments          1
>>                 6.6 Estuary/coastal waters                                 6 Water         17
>>            C18_DESCRIPTION
>>  Nature conservation (1.1)
>>                Water (6.0)
>>
>>
>>
>> Using:
>> platform       x86_64-unknown-linux-gnu
>> arch           x86_64
>> os             linux-gnu
>> system         x86_64, linux-gnu
>> status
>> major          3
>> minor          1.0
>> year           2014
>> month          04
>> day            10
>> svn rev        65387
>> language       R
>> version.string R version 3.1.0 (2014-04-10)
>> nickname       Spring Dance
>>
>> raster version 2.2.31
>>
>> Linux:
>> LSB Version:    core-2.0-noarch:core-3.2-noarch:core-4.0-noarch:core-2.0-x86_64:core-3.2-x86_64:core-4.0-x86_64:desktop-4.0-amd64:desktop-4.0-noarch:graphics-2.0-amd64:graphics-2.0-noarch:graphics-3.2-amd64:graphics-3.2-noarch:graphics-4.0-amd64:graphics-4.0-noarch
>> Distributor ID: SUSE LINUX
>> Description:    SUSE Linux Enterprise Server 11 (x86_64)
>> Release:        11
>> Codename:       n/a
>>
>>
>> I used to be able to handle this sized raster in earlier versions. Any ideas of a workaround?
>>
>> Cheers and thanks
>> Herry
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
>
> --
> Jonathan A. Greenberg, PhD
> Assistant Professor
> Global Environmental Analysis and Remote Sensing (GEARS) Laboratory Department of Geography and Geographic Information Science University of Illinois at Urbana-Champaign
> 259 Computing Applications Building, MC-150
> 605 East Springfield Avenue
> Champaign, IL  61820-6371
> Phone: 217-300-1924
> http://www.geog.illinois.edu/~jgrn/
> AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007



-- 
Jonathan A. Greenberg, PhD
Assistant Professor
Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
Department of Geography and Geographic Information Science
University of Illinois at Urbana-Champaign
259 Computing Applications Building, MC-150
605 East Springfield Avenue
Champaign, IL  61820-6371
Phone: 217-300-1924
http://www.geog.illinois.edu/~jgrn/
AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007


From florian.detsch at staff.uni-marburg.de  Thu Jul 17 09:27:03 2014
From: florian.detsch at staff.uni-marburg.de (Florian Detsch)
Date: Thu, 17 Jul 2014 09:27:03 +0200
Subject: [R-sig-Geo] Cannot properly import MODIS MOD07_L2 .hdf files into R
	using rgdal
Message-ID: <53C77AC7.8040406@staff.uni-marburg.de>

Dear list,

I've been trying to import and process some .hdf files from the MODIS 
Atmospheric Profile product (MOD07_L2) in R for several days now. Still, 
there's something going wrong during data import. The below code can be 
reproduced using an exemplary .hdf file 
(MOD07_L2.A2013001.0835.006.2013001192145.hdf) that can be downloaded 
from Dropbox via the following link: 
https://www.dropbox.com/s/nz6p2011od0bmn4/MOD07_L2.A2013001.0835.006.2013001192145.hdf.

library(rgdal)

# Extraction of metadata via `GDALinfo`
filename <- "MOD07_L2.A2013001.0835.006.2013001192145.hdf"
gdalinfo <- GDALinfo(filename, returnScaleOffset = FALSE)
metadata <- attr(gdalinfo, "subdsmdata")

# Extraction of SDS string for parameter 'Skin_Temperature' (formerly 
'Surface_Temperature')
sds <- metadata[grep("Skin_Temperature", metadata)[1]]
sds <- sapply(strsplit(sds, "="), "[[", 2)

# Raster import via `readGDAL`
sds.rg <- readGDAL(sds)

So far, so good, but here comes the confusing part:

 > summary(sds.rg$band1)
    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's
  -14870  -14850  -14850  -14840  -14840  -14820   53529

Considering the fact that Skin_Temperature has an official valid range 
from 150 to 350 K (see e.g. 
http://modis-atmos.gsfc.nasa.gov/MOD07_L2/format.html), the mean would 
inherit a value of

 > (-14840 - (-15000)) * 0.01
[1] 1.6

after considering the corresponding add_offset (-15000) and scale_factor 
(0.01). Note that we're still talking about Kelvin, not ?C. Extracting 
SDS No. 8, i.e. 'Skin_Temperature', from the .hdf file using

library(gdalUtils)
gdal_translate(filename, dst_dataset = "tmp.tif", sd_index = 8)

and opening the resulting file called "tmp.tif" in QGIS resulted in 
seemingly reliable values centered around 15000, i.e. roughly 27 ?C. 
However, importing "tmp.tif" back into R using `raster` again resulted 
in values comparable to the ones shown above:

 > summary(raster("tmp.tif"))
               tmp
Min.    -14867.31
1st Qu. -14848.13
Median  -14845.89
3rd Qu. -14840.53
Max.    -14819.93
NA's         0.00

I've been searching the internet and stumbled across a similar problem 
on R-sig-Geo related to rgdal and signed/unsigned raster data import 
(http://grokbase.com/t/r/r-sig-geo/098mmnbt41/rgdal-and-unsigned-integers). 
However, when I tried to cast `toUnSigned` on band 1 of my previously 
generated 'SpatialGridDataFrame', I received the following error message:

 > toUnSigned(sds.rg$band1, 16)
Error in toUnSigned(sds.rg$band1, 16) : band not integer

Apparently, the data imported into R is not even of type integer (what 
it is supposed to be), but numeric as shown by the first 5 cell values 
of band 1:

 > sds.rg$band1[1:5]
[1]        NA        NA -14839.40 -14840.25 -14839.26

Is there an apparent mistake in my code, or is there any point I miss 
when importing the .hdf and .tif files using `rgdal`? I would be 
extremely grateful for any kind of help.

Cheers,
Florian

-- 
Florian Detsch, M.Sc. Physical Geography
Environmental Informatics
Faculty of Geography
Philipp University of Marburg
Deutschhausstra?e 12
35037 Marburg, Germany
Tel. +49 6421 2825323


From bhartendu1988pandey at gmail.com  Thu Jul 17 16:53:12 2014
From: bhartendu1988pandey at gmail.com (bhartendupandey)
Date: Thu, 17 Jul 2014 07:53:12 -0700 (PDT)
Subject: [R-sig-Geo] GWmodel package results
In-Reply-To: <201407161003317144325@gmail.com>
References: <1405451266876-7586742.post@n2.nabble.com>
	<201407161003317144325@gmail.com>
Message-ID: <1405608792657-7586753.post@n2.nabble.com>

Dear Dr. Lu,

Thank you for your prompt reply.

I understand that these are two different versions with different default
kernel functions. But I noticed something strange here. Even when I specify
the kernel function in bw.ggwr() as "bisquare" and run the code in the two
versions, i.e., GWmodel_1.2-1 and GWmodel_1.2-3, I get different bandwidth
estimates. This further is yielding inconsistent parameter estimates from
the two versions of the package. This is, in fact, keeping me confounded of
the reliability of results from the two versions. Or if the differences here
is merely because I am doing something anomalous.
 
I ran the following codes in two different computers installed with
different versions of the GWmodel package, as stated above: 

rm(list=ls())
require(GWmodel)
data(LondonHP)
DM<-gw.dist(dp.locat=coordinates(londonhp))
bw.f2 <- bw.ggwr(BATH2~FLOORSZ,data=londonhp, dMat=DM,family
="binomial",adaptive=T, kernel='bisquare',approach='AIC')
res.binomial<-gwr.generalised(BATH2~FLOORSZ, bw=bw.f2,data=londonhp,
dMat=DM,
              family ="binomial",adaptive=T, kernel='bisquare')

rm(list=ls())
require(GWmodel)
data(LondonHP)
DM<-gw.dist(dp.locat=coordinates(londonhp))
bw.f2 <- bw.ggwr(BATH2~FLOORSZ,data=londonhp, dMat=DM,family
="binomial",adaptive=F, kernel='bisquare',approach='AIC')
res.binomial<-gwr.generalised(BATH2~FLOORSZ, bw=bw.f2,data=londonhp,
dMat=DM,
              family ="binomial",adaptive=F, kernel='bisquare')


When I run this code in computer 1, I get, 

1.  Adaptive bandwidth: 269 (number of nearest neighbors)
2.  Fixed bandwidth: 36091.69 

and when I run it in computer 2, I get 

1. Adaptive bandwidth: 273 (number of nearest neighbors)
2. Fixed bandwidth: 35582.65  

Computer 1:

> sessionInfo()
R version 3.1.0 (2014-04-10)
Platform: x86_64-w64-mingw32/x64 (64-bit)

locale:
[1] LC_COLLATE=English_United States.1252 
[2] LC_CTYPE=English_United States.1252   
[3] LC_MONETARY=English_United States.1252
[4] LC_NUMERIC=C                          
[5] LC_TIME=English_United States.1252    

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
[1] GWmodel_1.2-3     robustbase_0.91-1 maptools_0.8-30   sp_1.0-15        

loaded via a namespace (and not attached):
[1] DEoptimR_1.0-1  foreign_0.8-61  grid_3.1.0      lattice_0.20-29
[5] tools_3.1.0    


Computer 2: 

> sessionInfo()
R version 3.0.0 (2013-04-03)
Platform: x86_64-w64-mingw32/x64 (64-bit)

locale:
[1] LC_COLLATE=English_United States.1252 
[2] LC_CTYPE=English_United States.1252   
[3] LC_MONETARY=English_United States.1252
[4] LC_NUMERIC=C                          
[5] LC_TIME=English_United States.1252    

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
[1] GWmodel_1.2-1     robustbase_0.9-10 maptools_0.8-26   sp_1.0-11        

loaded via a namespace (and not attached):
[1] foreign_0.8-53  grid_3.0.0      lattice_0.20-15 tools_3.0.0   


I thank you for your help and time. 

Best regards,
Bhartendu Pandey




--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/GWmodel-package-results-tp7586742p7586753.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From jgrn at illinois.edu  Thu Jul 17 16:54:09 2014
From: jgrn at illinois.edu (Jonathan Greenberg)
Date: Thu, 17 Jul 2014 09:54:09 -0500
Subject: [R-sig-Geo] Cannot properly import MODIS MOD07_L2 .hdf files
 into R using rgdal
In-Reply-To: <53C77AC7.8040406@staff.uni-marburg.de>
References: <53C77AC7.8040406@staff.uni-marburg.de>
Message-ID: <CABG0rfv7M-70B3BT_0KS1fL1-8WuD=mzL4m6MZ4Bt+8gZQm03Q@mail.gmail.com>

Hi Florian:

I took a look at your input, and I SUSPECT what you are seeing is a
problem with the documentation, but I agree you are seeing some odd
things.  Using only gdalUtils:

filename <- "MOD07_L2.A2013001.0835.006.2013001192145.hdf"
gdalinfo(modis_file,sd=8)
# Confirmed that your offset is -15000, scale is: 0.00999999977648258 or ~ 0.01

modis_trans <- gdal_translate(filename, dst_dataset = "tmp.tif",
sd_index = 8,output_Raster=TRUE)
summary(modis_trans)
# Confirmed the same values you got above
plot(modis_trans) # Looks good

modis_trans_conv <- (modis_trans+15000)*0.00999999977648258
summary(modis_trans_conv)
# Yep:
Min.        1.32690
1st Qu.     1.51870
Median      1.54110
3rd Qu.     1.59475
Max.        1.80070
NA's    53529.00000

I also confirmed the 15000 values in QGIS, which is a bit odd...

I'm not convinced this is a file translation issue, or at least one
the R community may be able to help with, since that subdataset is
documented as being a 16-bit integer (not unsigned) (QGIS also
confirmed this).  Also, gdalUtils should be using whatever GDAL you
have installed -- I've got the latest and greatest on my machine and
can replicate this issue, so if the translation is wrong, this is an
issue with the main GDAL developers (gdalUtils is simply wrapping
those functions).

So, I'd recommend a few email barrages:
1) Contact the MODIS folks and CONFIRM that once the gains/offsets are
applied, the output should be Kelvin, and not Celsius (which it
appears to be -- 1.6 deg C = 274.75 K, in the range you were looking
for).  Basically: they may have documented this wrong.
2) Contact the GDAL people and show them the gdal_translate and
gdalinfo results (run gdalUtils "gdal_translate" with the verbose=TRUE
flag and copy the "GDAL command being used:" line, which is the "pure"
gdal_translate command).
3) Contact the QGIS folks and let them know what you are seeing :)

--j


On Thu, Jul 17, 2014 at 2:27 AM, Florian Detsch
<florian.detsch at staff.uni-marburg.de> wrote:
> Dear list,
>
> I've been trying to import and process some .hdf files from the MODIS
> Atmospheric Profile product (MOD07_L2) in R for several days now. Still,
> there's something going wrong during data import. The below code can be
> reproduced using an exemplary .hdf file
> (MOD07_L2.A2013001.0835.006.2013001192145.hdf) that can be downloaded from
> Dropbox via the following link:
> https://www.dropbox.com/s/nz6p2011od0bmn4/MOD07_L2.A2013001.0835.006.2013001192145.hdf.
>
> library(rgdal)
>
> # Extraction of metadata via `GDALinfo`
> filename <- "MOD07_L2.A2013001.0835.006.2013001192145.hdf"
> gdalinfo <- GDALinfo(filename, returnScaleOffset = FALSE)
> metadata <- attr(gdalinfo, "subdsmdata")
>
> # Extraction of SDS string for parameter 'Skin_Temperature' (formerly
> 'Surface_Temperature')
> sds <- metadata[grep("Skin_Temperature", metadata)[1]]
> sds <- sapply(strsplit(sds, "="), "[[", 2)
>
> # Raster import via `readGDAL`
> sds.rg <- readGDAL(sds)
>
> So far, so good, but here comes the confusing part:
>
>> summary(sds.rg$band1)
>    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's
>  -14870  -14850  -14850  -14840  -14840  -14820   53529
>
> Considering the fact that Skin_Temperature has an official valid range from
> 150 to 350 K (see e.g.
> http://modis-atmos.gsfc.nasa.gov/MOD07_L2/format.html), the mean would
> inherit a value of
>
>> (-14840 - (-15000)) * 0.01
> [1] 1.6
>
> after considering the corresponding add_offset (-15000) and scale_factor
> (0.01). Note that we're still talking about Kelvin, not ?C. Extracting SDS
> No. 8, i.e. 'Skin_Temperature', from the .hdf file using
>
> library(gdalUtils)
> gdal_translate(filename, dst_dataset = "tmp.tif", sd_index = 8)
>
> and opening the resulting file called "tmp.tif" in QGIS resulted in
> seemingly reliable values centered around 15000, i.e. roughly 27 ?C.
> However, importing "tmp.tif" back into R using `raster` again resulted in
> values comparable to the ones shown above:
>
>> summary(raster("tmp.tif"))
>               tmp
> Min.    -14867.31
> 1st Qu. -14848.13
> Median  -14845.89
> 3rd Qu. -14840.53
> Max.    -14819.93
> NA's         0.00
>
> I've been searching the internet and stumbled across a similar problem on
> R-sig-Geo related to rgdal and signed/unsigned raster data import
> (http://grokbase.com/t/r/r-sig-geo/098mmnbt41/rgdal-and-unsigned-integers).
> However, when I tried to cast `toUnSigned` on band 1 of my previously
> generated 'SpatialGridDataFrame', I received the following error message:
>
>> toUnSigned(sds.rg$band1, 16)
> Error in toUnSigned(sds.rg$band1, 16) : band not integer
>
> Apparently, the data imported into R is not even of type integer (what it is
> supposed to be), but numeric as shown by the first 5 cell values of band 1:
>
>> sds.rg$band1[1:5]
> [1]        NA        NA -14839.40 -14840.25 -14839.26
>
> Is there an apparent mistake in my code, or is there any point I miss when
> importing the .hdf and .tif files using `rgdal`? I would be extremely
> grateful for any kind of help.
>
> Cheers,
> Florian
>
> --
> Florian Detsch, M.Sc. Physical Geography
> Environmental Informatics
> Faculty of Geography
> Philipp University of Marburg
> Deutschhausstra?e 12
> 35037 Marburg, Germany
> Tel. +49 6421 2825323
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



-- 
Jonathan A. Greenberg, PhD
Assistant Professor
Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
Department of Geography and Geographic Information Science
University of Illinois at Urbana-Champaign
259 Computing Applications Building, MC-150
605 East Springfield Avenue
Champaign, IL  61820-6371
Phone: 217-300-1924
http://www.geog.illinois.edu/~jgrn/
AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007


From loic.dutrieux at wur.nl  Thu Jul 17 18:49:35 2014
From: loic.dutrieux at wur.nl (Dutrieux, Loic)
Date: Thu, 17 Jul 2014 16:49:35 +0000
Subject: [R-sig-Geo] Cannot properly import MODIS MOD07_L2 .hdf files
 into R using rgdal
In-Reply-To: <CABG0rfv7M-70B3BT_0KS1fL1-8WuD=mzL4m6MZ4Bt+8gZQm03Q@mail.gmail.com>
References: <53C77AC7.8040406@staff.uni-marburg.de>,
	<CABG0rfv7M-70B3BT_0KS1fL1-8WuD=mzL4m6MZ4Bt+8gZQm03Q@mail.gmail.com>
Message-ID: <A83620D4CC4762448EFB789FD6E9BBB73A3F9394@SCOMP0937.wurnet.nl>

Hi Florian, Jonathan,

I remember experiencing similar issues a while back with MODIS (I think NDVI product), simply because the product metadata were not correct (scaling factor) and readGDAL() uses them by default for automatic scaling on import.
The trick was to import using as.is=TRUE and doing the scaling myself using values from the product description.

So in your case, that would mean:
# Raster import via `readGDAL`
sds.rg <- readGDAL(sds, as.is=TRUE)

You can also wrap that into raster if you prefer working with classes of the raster package.
r0 <- raster(readGDAL(sds, as.is=TRUE))
r <- (r0 - 15000) * 0.01

Hope this helps,
Best regards,
Lo?c
________________________________________
From: r-sig-geo-bounces at r-project.org [r-sig-geo-bounces at r-project.org] on behalf of Jonathan Greenberg [jgrn at illinois.edu]
Sent: Thursday, July 17, 2014 4:54 PM
To: Florian Detsch
Cc: r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] Cannot properly import MODIS MOD07_L2 .hdf files into R using rgdal

Hi Florian:

I took a look at your input, and I SUSPECT what you are seeing is a
problem with the documentation, but I agree you are seeing some odd
things.  Using only gdalUtils:

filename <- "MOD07_L2.A2013001.0835.006.2013001192145.hdf"
gdalinfo(modis_file,sd=8)
# Confirmed that your offset is -15000, scale is: 0.00999999977648258 or ~ 0.01

modis_trans <- gdal_translate(filename, dst_dataset = "tmp.tif",
sd_index = 8,output_Raster=TRUE)
summary(modis_trans)
# Confirmed the same values you got above
plot(modis_trans) # Looks good

modis_trans_conv <- (modis_trans+15000)*0.00999999977648258
summary(modis_trans_conv)
# Yep:
Min.        1.32690
1st Qu.     1.51870
Median      1.54110
3rd Qu.     1.59475
Max.        1.80070
NA's    53529.00000

I also confirmed the 15000 values in QGIS, which is a bit odd...

I'm not convinced this is a file translation issue, or at least one
the R community may be able to help with, since that subdataset is
documented as being a 16-bit integer (not unsigned) (QGIS also
confirmed this).  Also, gdalUtils should be using whatever GDAL you
have installed -- I've got the latest and greatest on my machine and
can replicate this issue, so if the translation is wrong, this is an
issue with the main GDAL developers (gdalUtils is simply wrapping
those functions).

So, I'd recommend a few email barrages:
1) Contact the MODIS folks and CONFIRM that once the gains/offsets are
applied, the output should be Kelvin, and not Celsius (which it
appears to be -- 1.6 deg C = 274.75 K, in the range you were looking
for).  Basically: they may have documented this wrong.
2) Contact the GDAL people and show them the gdal_translate and
gdalinfo results (run gdalUtils "gdal_translate" with the verbose=TRUE
flag and copy the "GDAL command being used:" line, which is the "pure"
gdal_translate command).
3) Contact the QGIS folks and let them know what you are seeing :)

--j


On Thu, Jul 17, 2014 at 2:27 AM, Florian Detsch
<florian.detsch at staff.uni-marburg.de> wrote:
> Dear list,
>
> I've been trying to import and process some .hdf files from the MODIS
> Atmospheric Profile product (MOD07_L2) in R for several days now. Still,
> there's something going wrong during data import. The below code can be
> reproduced using an exemplary .hdf file
> (MOD07_L2.A2013001.0835.006.2013001192145.hdf) that can be downloaded from
> Dropbox via the following link:
> https://www.dropbox.com/s/nz6p2011od0bmn4/MOD07_L2.A2013001.0835.006.2013001192145.hdf.
>
> library(rgdal)
>
> # Extraction of metadata via `GDALinfo`
> filename <- "MOD07_L2.A2013001.0835.006.2013001192145.hdf"
> gdalinfo <- GDALinfo(filename, returnScaleOffset = FALSE)
> metadata <- attr(gdalinfo, "subdsmdata")
>
> # Extraction of SDS string for parameter 'Skin_Temperature' (formerly
> 'Surface_Temperature')
> sds <- metadata[grep("Skin_Temperature", metadata)[1]]
> sds <- sapply(strsplit(sds, "="), "[[", 2)
>
> # Raster import via `readGDAL`
> sds.rg <- readGDAL(sds)
>
> So far, so good, but here comes the confusing part:
>
>> summary(sds.rg$band1)
>    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's
>  -14870  -14850  -14850  -14840  -14840  -14820   53529
>
> Considering the fact that Skin_Temperature has an official valid range from
> 150 to 350 K (see e.g.
> http://modis-atmos.gsfc.nasa.gov/MOD07_L2/format.html), the mean would
> inherit a value of
>
>> (-14840 - (-15000)) * 0.01
> [1] 1.6
>
> after considering the corresponding add_offset (-15000) and scale_factor
> (0.01). Note that we're still talking about Kelvin, not ?C. Extracting SDS
> No. 8, i.e. 'Skin_Temperature', from the .hdf file using
>
> library(gdalUtils)
> gdal_translate(filename, dst_dataset = "tmp.tif", sd_index = 8)
>
> and opening the resulting file called "tmp.tif" in QGIS resulted in
> seemingly reliable values centered around 15000, i.e. roughly 27 ?C.
> However, importing "tmp.tif" back into R using `raster` again resulted in
> values comparable to the ones shown above:
>
>> summary(raster("tmp.tif"))
>               tmp
> Min.    -14867.31
> 1st Qu. -14848.13
> Median  -14845.89
> 3rd Qu. -14840.53
> Max.    -14819.93
> NA's         0.00
>
> I've been searching the internet and stumbled across a similar problem on
> R-sig-Geo related to rgdal and signed/unsigned raster data import
> (http://grokbase.com/t/r/r-sig-geo/098mmnbt41/rgdal-and-unsigned-integers).
> However, when I tried to cast `toUnSigned` on band 1 of my previously
> generated 'SpatialGridDataFrame', I received the following error message:
>
>> toUnSigned(sds.rg$band1, 16)
> Error in toUnSigned(sds.rg$band1, 16) : band not integer
>
> Apparently, the data imported into R is not even of type integer (what it is
> supposed to be), but numeric as shown by the first 5 cell values of band 1:
>
>> sds.rg$band1[1:5]
> [1]        NA        NA -14839.40 -14840.25 -14839.26
>
> Is there an apparent mistake in my code, or is there any point I miss when
> importing the .hdf and .tif files using `rgdal`? I would be extremely
> grateful for any kind of help.
>
> Cheers,
> Florian
>
> --
> Florian Detsch, M.Sc. Physical Geography
> Environmental Informatics
> Faculty of Geography
> Philipp University of Marburg
> Deutschhausstra?e 12
> 35037 Marburg, Germany
> Tel. +49 6421 2825323
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



--
Jonathan A. Greenberg, PhD
Assistant Professor
Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
Department of Geography and Geographic Information Science
University of Illinois at Urbana-Champaign
259 Computing Applications Building, MC-150
605 East Springfield Avenue
Champaign, IL  61820-6371
Phone: 217-300-1924
http://www.geog.illinois.edu/~jgrn/
AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From Alexander.Herr at csiro.au  Fri Jul 18 08:56:01 2014
From: Alexander.Herr at csiro.au (Herry)
Date: Thu, 17 Jul 2014 23:56:01 -0700 (PDT)
Subject: [R-sig-Geo] image(rs) returns error after reclassify
Message-ID: <1405666561008-7586756.post@n2.nabble.com>

Hiya,

I am getting the following error:

> image(rs)
Error in setValues(outras, m) : 
  length(values) is not equal to ncell(x), or to 1

rs was created from 
reclassify(rster, rcl, filename = 'landuse4BA', overwrite =TRUE,
progress='text')->rs
this finished without error. 

rster displays fine with image(rster)

any suggestions?
 - thanks 
Herry



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/image-rs-returns-error-after-reclassify-tp7586756.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From Alexander.Herr at csiro.au  Fri Jul 18 08:57:36 2014
From: Alexander.Herr at csiro.au (Herry)
Date: Thu, 17 Jul 2014 23:57:36 -0700 (PDT)
Subject: [R-sig-Geo] image(rs) returns error after reclassify
In-Reply-To: <1405666561008-7586756.post@n2.nabble.com>
References: <1405666561008-7586756.post@n2.nabble.com>
Message-ID: <1405666656295-7586757.post@n2.nabble.com>


you probably also want to know about the raster:

> rster
class       : RasterLayer 
dimensions  : 76740, 80200, 6154548000  (nrow, ncol, ncell)
resolution  : 50, 50  (x, y)
extent      : -1888000, 2122000, -4847000, -1010000  (xmin, xmax, ymin,
ymax)
coord. ref. : +proj=aea +lat_1=-18 +lat_2=-36 +lat_0=0 +lon_0=132 +x_0=0
+y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs 
data source : /data/her134/BA/GDA94albers/clum50m0314 
names       : clum50m0314 
values      : 100, 663  (min, max)

>rs
class       : RasterLayer 
dimensions  : 76740, 80200, 6154548000  (nrow, ncol, ncell)
resolution  : 50, 50  (x, y)
extent      : -1888000, 2122000, -4847000, -1010000  (xmin, xmax, ymin,
ymax)
coord. ref. : +proj=aea +lat_1=-18 +lat_2=-36 +lat_0=0 +lon_0=132 +x_0=0
+y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs 
data source : /data/her134/BA/landuse4BA.grd 
names       : layer 
values      : 100, 661  (min, max)



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/image-rs-returns-error-after-reclassify-tp7586756p7586757.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From luis.miguel.royo at gmail.com  Fri Jul 18 09:19:19 2014
From: luis.miguel.royo at gmail.com (=?ISO-8859-1?Q?Luis_Miguel_Royo_P=E9rez?=)
Date: Fri, 18 Jul 2014 09:19:19 +0200
Subject: [R-sig-Geo] R "frozen" in GRASS
In-Reply-To: <53C6AEC4.8050303@gmail.com>
References: <53C6AEC4.8050303@gmail.com>
Message-ID: <53C8CA77.4080407@gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140718/b2500dbe/attachment.pl>

From alessandracarioli at gmail.com  Fri Jul 18 10:00:18 2014
From: alessandracarioli at gmail.com (Alessandra Carioli)
Date: Fri, 18 Jul 2014 10:00:18 +0200
Subject: [R-sig-Geo] semivariogram geoR
Message-ID: <A04E92E9-75C8-44A3-B9D0-E559783C4622@gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140718/e0413d02/attachment.pl>

From florian.detsch at staff.uni-marburg.de  Fri Jul 18 10:21:47 2014
From: florian.detsch at staff.uni-marburg.de (Florian Detsch)
Date: Fri, 18 Jul 2014 10:21:47 +0200
Subject: [R-sig-Geo] Cannot properly import MODIS MOD07_L2 .hdf files
 into R using rgdal
In-Reply-To: <A83620D4CC4762448EFB789FD6E9BBB73A3F9394@SCOMP0937.wurnet.nl>
References: <53C77AC7.8040406@staff.uni-marburg.de>,
	<CABG0rfv7M-70B3BT_0KS1fL1-8WuD=mzL4m6MZ4Bt+8gZQm03Q@mail.gmail.com>
	<A83620D4CC4762448EFB789FD6E9BBB73A3F9394@SCOMP0937.wurnet.nl>
Message-ID: <53C8D91B.8020901@staff.uni-marburg.de>

The solution using readGDAL(..., as.is = TRUE) worked out fine and all 
SDS layers are in a valid range now.

Thank you, Lo?c and Jonathan, for the precious input.

Florian

On 17.07.2014 18:49, Dutrieux, Loic wrote:
> Hi Florian, Jonathan,
>
> I remember experiencing similar issues a while back with MODIS (I think NDVI product), simply because the product metadata were not correct (scaling factor) and readGDAL() uses them by default for automatic scaling on import.
> The trick was to import using as.is=TRUE and doing the scaling myself using values from the product description.
>
> So in your case, that would mean:
> # Raster import via `readGDAL`
> sds.rg <- readGDAL(sds, as.is=TRUE)
>
> You can also wrap that into raster if you prefer working with classes of the raster package.
> r0 <- raster(readGDAL(sds, as.is=TRUE))
> r <- (r0 - 15000) * 0.01
>
> Hope this helps,
> Best regards,
> Lo?c
> ________________________________________
> From: r-sig-geo-bounces at r-project.org [r-sig-geo-bounces at r-project.org] on behalf of Jonathan Greenberg [jgrn at illinois.edu]
> Sent: Thursday, July 17, 2014 4:54 PM
> To: Florian Detsch
> Cc: r-sig-geo at r-project.org
> Subject: Re: [R-sig-Geo] Cannot properly import MODIS MOD07_L2 .hdf files into R using rgdal
>
> Hi Florian:
>
> I took a look at your input, and I SUSPECT what you are seeing is a
> problem with the documentation, but I agree you are seeing some odd
> things.  Using only gdalUtils:
>
> filename <- "MOD07_L2.A2013001.0835.006.2013001192145.hdf"
> gdalinfo(modis_file,sd=8)
> # Confirmed that your offset is -15000, scale is: 0.00999999977648258 or ~ 0.01
>
> modis_trans <- gdal_translate(filename, dst_dataset = "tmp.tif",
> sd_index = 8,output_Raster=TRUE)
> summary(modis_trans)
> # Confirmed the same values you got above
> plot(modis_trans) # Looks good
>
> modis_trans_conv <- (modis_trans+15000)*0.00999999977648258
> summary(modis_trans_conv)
> # Yep:
> Min.        1.32690
> 1st Qu.     1.51870
> Median      1.54110
> 3rd Qu.     1.59475
> Max.        1.80070
> NA's    53529.00000
>
> I also confirmed the 15000 values in QGIS, which is a bit odd...
>
> I'm not convinced this is a file translation issue, or at least one
> the R community may be able to help with, since that subdataset is
> documented as being a 16-bit integer (not unsigned) (QGIS also
> confirmed this).  Also, gdalUtils should be using whatever GDAL you
> have installed -- I've got the latest and greatest on my machine and
> can replicate this issue, so if the translation is wrong, this is an
> issue with the main GDAL developers (gdalUtils is simply wrapping
> those functions).
>
> So, I'd recommend a few email barrages:
> 1) Contact the MODIS folks and CONFIRM that once the gains/offsets are
> applied, the output should be Kelvin, and not Celsius (which it
> appears to be -- 1.6 deg C = 274.75 K, in the range you were looking
> for).  Basically: they may have documented this wrong.
> 2) Contact the GDAL people and show them the gdal_translate and
> gdalinfo results (run gdalUtils "gdal_translate" with the verbose=TRUE
> flag and copy the "GDAL command being used:" line, which is the "pure"
> gdal_translate command).
> 3) Contact the QGIS folks and let them know what you are seeing :)
>
> --j
>
>
> On Thu, Jul 17, 2014 at 2:27 AM, Florian Detsch
> <florian.detsch at staff.uni-marburg.de> wrote:
>> Dear list,
>>
>> I've been trying to import and process some .hdf files from the MODIS
>> Atmospheric Profile product (MOD07_L2) in R for several days now. Still,
>> there's something going wrong during data import. The below code can be
>> reproduced using an exemplary .hdf file
>> (MOD07_L2.A2013001.0835.006.2013001192145.hdf) that can be downloaded from
>> Dropbox via the following link:
>> https://www.dropbox.com/s/nz6p2011od0bmn4/MOD07_L2.A2013001.0835.006.2013001192145.hdf.
>>
>> library(rgdal)
>>
>> # Extraction of metadata via `GDALinfo`
>> filename <- "MOD07_L2.A2013001.0835.006.2013001192145.hdf"
>> gdalinfo <- GDALinfo(filename, returnScaleOffset = FALSE)
>> metadata <- attr(gdalinfo, "subdsmdata")
>>
>> # Extraction of SDS string for parameter 'Skin_Temperature' (formerly
>> 'Surface_Temperature')
>> sds <- metadata[grep("Skin_Temperature", metadata)[1]]
>> sds <- sapply(strsplit(sds, "="), "[[", 2)
>>
>> # Raster import via `readGDAL`
>> sds.rg <- readGDAL(sds)
>>
>> So far, so good, but here comes the confusing part:
>>
>>> summary(sds.rg$band1)
>>     Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's
>>   -14870  -14850  -14850  -14840  -14840  -14820   53529
>>
>> Considering the fact that Skin_Temperature has an official valid range from
>> 150 to 350 K (see e.g.
>> http://modis-atmos.gsfc.nasa.gov/MOD07_L2/format.html), the mean would
>> inherit a value of
>>
>>> (-14840 - (-15000)) * 0.01
>> [1] 1.6
>>
>> after considering the corresponding add_offset (-15000) and scale_factor
>> (0.01). Note that we're still talking about Kelvin, not ?C. Extracting SDS
>> No. 8, i.e. 'Skin_Temperature', from the .hdf file using
>>
>> library(gdalUtils)
>> gdal_translate(filename, dst_dataset = "tmp.tif", sd_index = 8)
>>
>> and opening the resulting file called "tmp.tif" in QGIS resulted in
>> seemingly reliable values centered around 15000, i.e. roughly 27 ?C.
>> However, importing "tmp.tif" back into R using `raster` again resulted in
>> values comparable to the ones shown above:
>>
>>> summary(raster("tmp.tif"))
>>                tmp
>> Min.    -14867.31
>> 1st Qu. -14848.13
>> Median  -14845.89
>> 3rd Qu. -14840.53
>> Max.    -14819.93
>> NA's         0.00
>>
>> I've been searching the internet and stumbled across a similar problem on
>> R-sig-Geo related to rgdal and signed/unsigned raster data import
>> (http://grokbase.com/t/r/r-sig-geo/098mmnbt41/rgdal-and-unsigned-integers).
>> However, when I tried to cast `toUnSigned` on band 1 of my previously
>> generated 'SpatialGridDataFrame', I received the following error message:
>>
>>> toUnSigned(sds.rg$band1, 16)
>> Error in toUnSigned(sds.rg$band1, 16) : band not integer
>>
>> Apparently, the data imported into R is not even of type integer (what it is
>> supposed to be), but numeric as shown by the first 5 cell values of band 1:
>>
>>> sds.rg$band1[1:5]
>> [1]        NA        NA -14839.40 -14840.25 -14839.26
>>
>> Is there an apparent mistake in my code, or is there any point I miss when
>> importing the .hdf and .tif files using `rgdal`? I would be extremely
>> grateful for any kind of help.
>>
>> Cheers,
>> Florian
>>
>> --
>> Florian Detsch, M.Sc. Physical Geography
>> Environmental Informatics
>> Faculty of Geography
>> Philipp University of Marburg
>> Deutschhausstra?e 12
>> 35037 Marburg, Germany
>> Tel. +49 6421 2825323
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
>
> --
> Jonathan A. Greenberg, PhD
> Assistant Professor
> Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
> Department of Geography and Geographic Information Science
> University of Illinois at Urbana-Champaign
> 259 Computing Applications Building, MC-150
> 605 East Springfield Avenue
> Champaign, IL  61820-6371
> Phone: 217-300-1924
> http://www.geog.illinois.edu/~jgrn/
> AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From Roger.Bivand at nhh.no  Fri Jul 18 12:28:32 2014
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 18 Jul 2014 12:28:32 +0200
Subject: [R-sig-Geo] R "frozen" in GRASS
In-Reply-To: <53C8CA77.4080407@gmail.com>
References: <53C6AEC4.8050303@gmail.com> <53C8CA77.4080407@gmail.com>
Message-ID: <alpine.LRH.2.03.1407181222150.7073@reclus.nhh.no>

Please do not post HTML.

Please rather use the grass-stats or grass-users list, as this is not an R 
problem, but more likely an issue with your installation of GRASS. The 
GRASS GUI is the source of the error messages. In any case, did you try 
starting R from the command line in the regular terminal from which you 
started GRASS, which should avoid all GUI/Python interaction? Why did you 
use R --save rather than just R; maybe the GUI console is trying to 
interpret the option?

Roger

On Fri, 18 Jul 2014, Luis Miguel Royo P?rez wrote:

>
> On 16/07/14 18:56, Luis Miguel Royo P?rez wrote:
>> Hi everyone,
>>
>> I'm new in this matter. I've intalled R GRASS and the packages needed
>> for use R and GRASS together. When I run GRASS I type this in the console:
>>
>> R --save
>>
>> And I get this:
>>
>> R version 3.1.1 (2014-07-10) -- "Sock it to Me"
>> Copyright (C) 2014 The R Foundation for Statistical Computing
>> Platform: i686-pc-linux-gnu (32-bit)
>> R es un software libre y viene sin GARANTIA ALGUNA.
>> Usted puede redistribuirlo bajo ciertas circunstancias.
>> Escriba 'license()' o 'licence()' para detalles de distribucion.
>> R es un proyecto colaborativo con muchos contribuyentes.
>> Escriba 'demo()' para demostraciones, 'help()' para el sistema on-line
>> de ayuda,
>> o 'help.start()' para abrir el sistema de ayuda HTML con su navegador.
>> Escriba 'q()' para salir de R.
>> Traceback (most recent call last):
>>   File "/usr/lib/grass64/etc/wxpython/gui_core/goutput.py",
>> line 759, in OnCmdOutput
>>
>> self.cmdOutput.AddTextWrapped(message, wrap = None)
>>   File "/usr/lib/grass64/etc/wxpython/gui_core/goutput.py",
>> line 1238, in AddTextWrapped
>>
>> txt = EncodeString(txt)
>>   File "/usr/lib/grass64/etc/wxpython/core/gcmd.py", line
>> 103, in EncodeString
>>
>> return string.encode(enc)
>> UnicodeDecodeError
>> :
>> 'ascii' codec can't decode byte 0xe1 in position 39: ordinal
>> not in range(128)
>> Traceback (most recent call last):
>>   File "/usr/lib/grass64/etc/wxpython/gui_core/goutput.py",
>> line 759, in OnCmdOutput
>>
>> self.cmdOutput.AddTextWrapped(message, wrap = None)
>>   File "/usr/lib/grass64/etc/wxpython/gui_core/goutput.py",
>> line 1238, in AddTextWrapped
>>
>> txt = EncodeString(txt)
>>   File "/usr/lib/grass64/etc/wxpython/core/gcmd.py", line
>> 103, in EncodeString
>>
>> return string.encode(enc)
>> UnicodeDecodeError
>> :
>> 'ascii' codec can't decode byte 0xf3 in position 25: ordinal
>> not in range(128)
>>
>> Everything seems ok, but when I try to run these couple of commands
>> nothing happens:
>>
>>> library(spgrass6)
>>> G <- gmeta6()
>>
>> I'm running GRASS 6.4.3 on a Ubuntu 12.04.
>>
>> Anyone could help me?
>>
>> Thanks per advance.
>> --
>>
>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no

From carolina.lang at ifop.cl  Fri Jul 18 15:41:10 2014
From: carolina.lang at ifop.cl (carolina.lang at ifop.cl)
Date: Fri, 18 Jul 2014 09:41:10 -0400 (CLT)
Subject: [R-sig-Geo] semivariogram geoR
In-Reply-To: <A04E92E9-75C8-44A3-B9D0-E559783C4622@gmail.com>
References: <A04E92E9-75C8-44A3-B9D0-E559783C4622@gmail.com>
Message-ID: <786850361.1555668.1405690870104.JavaMail.zimbra@ifop.cl>

DEar Alessandra, 

In the function variog(), you complete with uvec=(??), this allow you define the lag distance and max.dist= ??, define the max distance for your experimental variogram or domain, An Example: uvec=seq(0,37040,by=926), max.dist=37040

regards, Carolina Lang


	

Carolina Lang Abarz??a 
Investigador 
Instituto de Fomento Pesquero 
Av. Blanco #839, Valparaiso, Chile. 
Fono: (32) 2151572 

www.ifop.cl 



----- Mensaje original -----
De: "Alessandra Carioli" <alessandracarioli at gmail.com>
Para: r-sig-geo at r-project.org
Enviados: Viernes, 18 de Julio 2014 4:00:18
Asunto: [R-sig-Geo] semivariogram geoR

Dear bloggers,

I am using geoR package to do semivariograms (variog). I would like to specify 50km distances with a maximum of 2000km distance and I am at loss on how to do it. The Coordinates of my shape file are projected longitude and latitude

A         13.515094 	37.44574
B         8.664217 	44.82956
C         13.155760 	43.50457
D         7.393502 	45.73274
E         11.856243	43.53362
F         13.555405 	42.88887
G         8.187188 	44.87850 [???]

Here is my code:

lat <- coordinates(shape.shp)[,1]
lon <- coordinates(shape.shp)[,2]
data <- cbind(lat,lon,fert)
dist <- dist(data[,1:2])
summary(dist)
breaks=seq(0,12,l=21)
v1 <- variog(coords = fert.l[,1:2], data = fert[,5], breaks = breaks,na.rm = TRUE)
v1.summary <- cbind(c(1:20), v1$v, v1$n)
colnames(v1.summary) <- c("lag", "semi-variance", "# of pairs")
plot(v1, type = "b", main = "Variogram") 


Any help on the matter is greatly appreciated.

Ale


	[[alternative HTML version deleted]]


_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


------------------------------------------------------------------------------------------------
Certificaci?n ISO 9001/2008: Sistema de Datos Bio-Pesqueros ( Arica, Iquique, Coquimbo, Valpara?so, San Antonio, Talcahuano y Calbuco, pesquer?as industriales y artesanales)


     


From azvoleff at conservation.org  Fri Jul 18 20:18:17 2014
From: azvoleff at conservation.org (Alex Zvoleff)
Date: Fri, 18 Jul 2014 14:18:17 -0400
Subject: [R-sig-Geo] Unexpected behavior of raster "mask" function
Message-ID: <CACwzsXHyCH09+qsPdre8NmNxE3BjehOcyuOmkAhKPn7UpAgA1w@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140718/d3db913a/attachment.pl>

From julleeyaw at yahoo.ca  Fri Jul 18 20:35:31 2014
From: julleeyaw at yahoo.ca (Julie Lee-Yaw)
Date: Fri, 18 Jul 2014 11:35:31 -0700
Subject: [R-sig-Geo] "rasterize" shape file return empty raster
Message-ID: <1405708531.59996.YahooMailNeo@web142504.mail.bf1.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140718/e02ae6f0/attachment.pl>

From lubinbin220 at gmail.com  Sat Jul 19 11:24:27 2014
From: lubinbin220 at gmail.com (lubinbin220 at gmail.com)
Date: Sat, 19 Jul 2014 17:24:27 +0800
Subject: [R-sig-Geo] GWmodel package results
References: <1405451266876-7586742.post@n2.nabble.com>, 
	<201407161003317144325@gmail.com>, 
	<1405608792657-7586753.post@n2.nabble.com>
Message-ID: <2014071917242534290920@gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140719/a3125c93/attachment.pl>

From soerengebbert at googlemail.com  Sat Jul 19 16:55:23 2014
From: soerengebbert at googlemail.com (=?UTF-8?Q?S=C3=B6ren_Gebbert?=)
Date: Sat, 19 Jul 2014 16:55:23 +0200
Subject: [R-sig-Geo] write.tgrass (spacetime) does not create init.txt
In-Reply-To: <53C2AFBE.3030103@uni-muenster.de>
References: <CAAMki4EuOXFUCj0Md0E-9jawkYjai=Erw527xpbX6s5_R78wyg@mail.gmail.com>
	<53BACF02.8010700@uni-muenster.de>
	<CAPHDReKONfszhz01LLEE5KhUYRZF=JweSmV=hPHoCk5d-c2VHA@mail.gmail.com>
	<53C2AFBE.3030103@uni-muenster.de>
Message-ID: <CAPHDRe+EuGgHRD7hV=8cfLZUJ=uT6p3g2Czjwxm60RVJDRN-cQ@mail.gmail.com>

Hi Edzer,
sorry for the delay.


2014-07-13 18:11 GMT+02:00 Edzer Pebesma <edzer.pebesma at uni-muenster.de>:
> spacetime::write.tgrass (as it is on github) now writes init.txt,
> hopefully correct. I took examples from
> https://www-pool.math.tu-berlin.de/~soeren/grass/ , and used file
> precipitation_1950_2013_yearly_mm.tar.gz.
>
> In this file, init.txt has quite different content from that you
> describe below:

Oh, yes, sorry, i explained only the most basic file format. The
keywords "stds_type" and "format" are by default "strds" and "GTiff"
and can therefor be omitted in your case. But they have to be set in
case of stvds and other data formats than geotiff. For raster data
only GTiff, AAIGrid and the native tar-gzipped GRASS data formats are
supported.

>
> stds_type=strds
> format=GTiff
> temporal_type=absolute
> semantic_type=mean
> number_of_maps=63
> north=75.5
> south=25.25
> east=75.5
> west=-40.5
>
> Does tgrass depend on knowing "relative_time_unit"?

TGRASS depends on relative time unit in case of relative time. Hence
if you write time like 1,2,3,4, ... , 100 then you have to specify the
unit of them. The relative time unit is not needed in case of calendar
time, since only Gregorian time is supported.

>
> I could write a function that write "years" when the number of days
> between time stamps is 356 or 366, and act similarly for "months" (28,
> 29, 30 or 31), but this is somewhat messy of course, and things get
> worse in case of daylight saving time and monthly data... Suggestions
> welcome!

How does R implements the concept of relative time, hence time without
an absolute reference?

Best regards
Soeren

>
> On 07/07/2014 06:57 PM, S?ren Gebbert wrote:
>> Hi,
>> init.txt has the following content:
>>
>> temporal_type=absolute
>> semantic_type=mean
>> relative_time_unit=years
>> number_of_maps=61
>> north=75.5
>> south=25.25
>> east=75.5
>> west=-40.5
>>
>> The spatial extent is ignored while importing, but the temporal type,
>> semantic type (still a dummy in TGRASS) and the number of maps must be
>> provided. The relative time unit is mandatory if the dataset has
>> relative time, otherwise it can be left out.
>>
>> I noticed that the reader expects always absolute time, is it possible
>> to support relative time as well?
>>
>>
>> Best regards
>> Soeren
>>
>> 2014-07-07 18:46 GMT+02:00 Edzer Pebesma <edzer.pebesma at uni-muenster.de>:
>>> Thanks for the clear report, Veronica.
>>>
>>> Soeren (Cc:), do you know where we can find a description of the
>>> requirements, or examples, of the init.txt file?
>>>
>>> On 07/07/2014 06:31 PM, Veronica Andreo wrote:
>>>> Hi list
>>>>
>>>> I'm using R to run some processing over a spatio-temporal raster dataset
>>>> coming from GRASS. The workflow is as follows:
>>>>
>>>> 1. Export all my images from GRASS with t.rast.export
>>>> 2. Import them as a raster stack in R with read.tgrass
>>>> 3. do the processing... which implies converting the rasterstack into a
>>>> matrix, transposing and running dineof
>>>> 4. create the rasterstack again, add the time with setZ
>>>> 5. export with write.tgrass (which only seems to work for RasterStack and
>>>> not for STFDF, i tried both ways)
>>>> 6. and import to grass again...
>>>>
>>>> here is where I get the error since an init.txt file with the following
>>>> information is needed but it's not created by write.tgrass...
>>>>
>>>> stds_type=strds
>>>> format=GTiff
>>>> temporal_type=absolute
>>>> semantic_type=mean
>>>> number_of_maps=
>>>> north=
>>>> south=
>>>> east=
>>>> west=
>>>>
>>>> There are of course some workarounds but it would be nice -and much more
>>>> straightforward- that the function which is intended to provide interface
>>>> between R and T-GRASS, already does the job itself :)
>>>>
>>>> Thanks much!
>>>>
>>>> Best,
>>>> Vero
>>>>
>>>>       [[alternative HTML version deleted]]
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at r-project.org
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>
>>> --
>>> Edzer Pebesma
>>> Institute for Geoinformatics (ifgi), University of M?nster
>>> Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
>>> 83 33081 http://ifgi.uni-muenster.de GPG key ID 0xAC227795
>>>
>
> --
> Edzer Pebesma
> Institute for Geoinformatics (ifgi), University of M?nster
> Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
> 83 33081 http://ifgi.uni-muenster.de GPG key ID 0xAC227795
>


From mauriziomarchi85 at gmail.com  Sat Jul 19 20:33:16 2014
From: mauriziomarchi85 at gmail.com (Maurizio Marchi)
Date: Sat, 19 Jul 2014 20:33:16 +0200
Subject: [R-sig-Geo] PA selection in biomod2: how to merge different models
	before projection?
Message-ID: <CANJhsN3RWDQpE-zCmrM+7itdXhiG9iQ2ZZDBEJqHr2-t0A_zbw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140719/69e2c3bc/attachment.pl>

From kat.emidio at gmail.com  Sun Jul 20 17:51:29 2014
From: kat.emidio at gmail.com (=?UTF-8?Q?K=C3=A1tia_Emidio?=)
Date: Sun, 20 Jul 2014 11:51:29 -0400
Subject: [R-sig-Geo] Local_coord
Message-ID: <CABFLJOkCva_3cL1KW_9zQsyuLGNSqa0yJUEM3m5B_rbTeK0cug@mail.gmail.com>

Hi there,
I need to consolidate my local coordinates gotten in 10x10m sub-plots and
to transform them into 100x100m reference. I am doing this by hand in
excel... too much time!!
I need to sum up a reference measure to subplots measure by creating a
loop..
The file "Coord_ha_R" has the columns names "Parcela Sub_parc X_local
Y_local"
The reference file (ref_sub_parc_coord) to sum up values to X and Y_ local
has  the colums name  "sub-parc X Y".

For each "XY_local fields in the "coord_ha_R", I need to sum up the
respective XY  values in the  "ref_sub_parc_coord" file, considering each
sub-parcel.

I'll really apreciate any help, because I have too many plots!!

Thanks
-- 
K?tia Em?dio da Silva DSc
Eng. Florestal
Manaus/AM



Forestry Engineer
Manaus/AM-Brazil
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140720/468d622a/attachment.html>
-------------- next part --------------
Parcela	Sub_parc	X_local	Y_local
3	1	2.78	4.4
3	1	10	5.2
3	1	6.28	6.1
3	1	1.28	6
3	2	4.99	2
3	2	6.96	6.35
3	2	1.17	5.1
3	2	6.96	8.3
3	2	4.78	9.8
3	3	5.88	1
3	3	7.25	2.6
3	3	6.92	5.2
3	3	0.2	7.9
3	3	6.04	7.2
3	3	4.61	8.6
3	4	6.03	2.94
3	4	3.9	2.96
3	4	7.62	10
3	4	8.7	7.1
3	4	9.3	9.62
3	5	9.9	0.3
3	5	1.53	1.2
3	5	9.8	1.9
3	5	5.96	3.15
3	5	7.8	2.96
3	5	8.96	5.6
3	6	7.62	0.3
3	6	5.39	1.5
3	6	0.95	2.45
3	6	7.76	7.3
3	6	3.64	5.8
3	6	8.89	8.7
3	6	1.02	
3	6	5.31	8.5
3	6	2.09	8.6
3	6	0.46	9.3
3	7	0	3.55
3	7	3	5.8
3	7	10	8.05
3	7	0.73	8.8
3	8	2.63	0.85
3	8	4.2	4
3	8	5.37	4.5
3	8	0.96	6.7
3	8	7.03	8.1
3	8	7.32	9
3	8	8.6	9.7
3	9	6.91	1.3
3	9	4.53	3.3
3	9	7.32	7.3
3	9	1.09	6.1
3	9	0.54	6.4
3	10	5.54	3.3
3	10	10	8.2
3	10	5.32	5.7
-------------- next part --------------
sub-parc	X	Y
sub-parc1	0	0
sub-parc2	0	10
sub-parc3	0	20
sub-parc4	0	30
sub-parc5	0	40
sub-parc6	0	50
sub-parc7	0	60
sub-parc8	0	70
sub-parc9	0	80
sub-parc10	0	90

From loic.dutrieux at wur.nl  Sun Jul 20 23:17:33 2014
From: loic.dutrieux at wur.nl (=?ISO-8859-1?Q?Lo=EFc_Dutrieux?=)
Date: Sun, 20 Jul 2014 23:17:33 +0200
Subject: [R-sig-Geo] Local_coord
In-Reply-To: <CABFLJOkCva_3cL1KW_9zQsyuLGNSqa0yJUEM3m5B_rbTeK0cug@mail.gmail.com>
References: <CABFLJOkCva_3cL1KW_9zQsyuLGNSqa0yJUEM3m5B_rbTeK0cug@mail.gmail.com>
Message-ID: <53CC31ED.3070409@wur.nl>

Hello K?tia,

That sounds more like a dataframe manipulation problem; though we can 
help. See the code below.

library(dplyr)

coord <- read.table('Coord_ha_R.txt', header = TRUE, fill = TRUE)

plots <- 'ref_sub_parc_coord.txt' %.%
   read.table(header = TRUE) %.%
   mutate(Sub_parc = seq(1,10)) %.%
   merge(coord, by = 'Sub_parc') %.%
   mutate(X_global = X_local + X, Y_global = Y_local + Y)


Is it more or less what you're aiming at? There are certainly many ways 
to come to the same result.
Also you may want to take a look at the dplyr vignette, it's a quick 
read. 
(http://cran.rstudio.com/web/packages/dplyr/vignettes/introduction.html)

Cheers,
--
Lo?c Dutrieux
Wageningen University

On 14-07-20 05:51 PM, K?tia Emidio wrote:
> Hi there,
> I need to consolidate my local coordinates gotten in 10x10m sub-plots
> and to transform them into 100x100m reference. I am doing this by hand
> in excel... too much time!!
> I need to sum up a reference measure to subplots measure by creating a
> loop..
> The file "Coord_ha_R" has the columns names "ParcelaSub_parcX_localY_local"
> The reference file (ref_sub_parc_coord) to sum up values to X and Y_
> local has  the colums name  "sub-parcXY".
>
> For each "XY_local fields in the "coord_ha_R", I need to sum up the
> respective XY  values in the  "ref_sub_parc_coord" file, considering
> each sub-parcel.
>
> I'll really apreciate any help, because I have too many plots!!
>
> Thanks
> --
> K?tia Em?dio da Silva DSc
> Eng. Florestal
> Manaus/AM
>
>
>
> Forestry Engineer
> Manaus/AM-Brazil
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From oscar.perpinan at upm.es  Mon Jul 21 10:45:32 2014
From: oscar.perpinan at upm.es (=?UTF-8?Q?Oscar_Perpi=C3=B1an?=)
Date: Mon, 21 Jul 2014 10:45:32 +0200
Subject: [R-sig-Geo] Local_coord
In-Reply-To: <53CC31ED.3070409@wur.nl>
References: <CABFLJOkCva_3cL1KW_9zQsyuLGNSqa0yJUEM3m5B_rbTeK0cug@mail.gmail.com>
	<53CC31ED.3070409@wur.nl>
Message-ID: <CAMLL7bny4zQn84tcym517eYKoJbP1Xmuiu3aAPd8aBGp8N+Jjg@mail.gmail.com>

Hi,

You can solve it using base functions if you prefer:

coord <- read.delim('Coord_ha_R.txt')
ref <- read.delim('ref_sub_parc_coord.txt')

ref <- transform(ref, sub.parc = substr(sub.parc, 9, 10))
coordRef <- merge(coord, ref, by.x = 'Sub_parc', by.y = 'sub.parc')
coordRef <- transform(coordRef, Xref = X_local + X, Yref = Y_local + Y)

Best,

Oscar.
-----------------------------------------------------------------
Oscar Perpi??n Lamigueiro
Dpto. Ingenier?a El?ctrica (ETSIDI-UPM)
Grupo de Sistemas Fotovoltaicos (IES-UPM)
URL: http://oscarperpinan.github.io
Twitter: @oscarperpinan


From edoardo.baldoni at gmail.com  Mon Jul 21 12:27:51 2014
From: edoardo.baldoni at gmail.com (Edoardo Baldoni)
Date: Mon, 21 Jul 2014 12:27:51 +0200
Subject: [R-sig-Geo] Logit spatial predictions outside range [0,1]
Message-ID: <CAOcqoUPgNtcd-oGSyhn=hvy69TJzst3D8E6WqRzx+V6zjFDHFg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140721/b3c17643/attachment.pl>

From Roger.Bivand at nhh.no  Mon Jul 21 13:59:25 2014
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 21 Jul 2014 13:59:25 +0200
Subject: [R-sig-Geo] Local_coord
In-Reply-To: <53CC31ED.3070409@wur.nl>
References: <CABFLJOkCva_3cL1KW_9zQsyuLGNSqa0yJUEM3m5B_rbTeK0cug@mail.gmail.com>
	<53CC31ED.3070409@wur.nl>
Message-ID: <alpine.LRH.2.03.1407211341000.31169@reclus.nhh.no>

On Sun, 20 Jul 2014, Lo?c Dutrieux wrote:

> Hello K?tia,
>
> That sounds more like a dataframe manipulation problem; though we can help. 
> See the code below.
>
> library(dplyr)

This may work, but is no help at all in understanding R - dplyr is very 
new, and the %.% or %>% syntax is even newer, and very confusing if the 
assumptions made in chaining the steps together are wrong. If you do 
things step-by-step, you can debug them:

coord <- read.table('Coord_ha_R.txt', header = TRUE, fill = TRUE)
str(coord)
% str() describes structure, so showing factors as such;
% head() doesn't do this - see dplyr documentation
ref_sub_parc_coord <- read.table("ref_sub_parc_coord.txt",
  header = TRUE)
str(ref_sub_parc_coord)
# create index
# ref_sub_parc_coord$Sub_parc <- seq(1,10)
# how does mutate() do this properly?
ref_sub_parc_coord$Sub_parc <- 1:nrow(ref_sub_parc_coord)
# merge two data frames
mm <- merge(ref_sub_parc_coord, coord, by = "Sub_parc")
str(mm)
mm$X_global = mm$X_local + mm$X
mm$Y_global = mm$Y_local + mm$Y
str(mm)

By the way, using dplyr:

all.equal(plots, mm)

Please always try to use standard R functions if possible; things like 
dlpyr may be helpful sometimes, but for working scientists simplicity and 
the ability to debug each step are really much more practical.

Roger


>
> coord <- read.table('Coord_ha_R.txt', header = TRUE, fill = TRUE)
>
> plots <- 'ref_sub_parc_coord.txt' %.%
>  read.table(header = TRUE) %.%
>  mutate(Sub_parc = seq(1,10)) %.%
>  merge(coord, by = 'Sub_parc') %.%
>  mutate(X_global = X_local + X, Y_global = Y_local + Y)
>
>
> Is it more or less what you're aiming at? There are certainly many ways to 
> come to the same result.
> Also you may want to take a look at the dplyr vignette, it's a quick read. 
> (http://cran.rstudio.com/web/packages/dplyr/vignettes/introduction.html)
>
> Cheers,
> --
> Lo?c Dutrieux
> Wageningen University
>
> On 14-07-20 05:51 PM, K?tia Emidio wrote:
>> Hi there,
>> I need to consolidate my local coordinates gotten in 10x10m sub-plots
>> and to transform them into 100x100m reference. I am doing this by hand
>> in excel... too much time!!
>> I need to sum up a reference measure to subplots measure by creating a
>> loop..
>> The file "Coord_ha_R" has the columns names "ParcelaSub_parcX_localY_local"
>> The reference file (ref_sub_parc_coord) to sum up values to X and Y_
>> local has  the colums name  "sub-parcXY".
>> 
>> For each "XY_local fields in the "coord_ha_R", I need to sum up the
>> respective XY  values in the  "ref_sub_parc_coord" file, considering
>> each sub-parcel.
>> 
>> I'll really apreciate any help, because I have too many plots!!
>> 
>> Thanks
>> --
>> K?tia Em?dio da Silva DSc
>> Eng. Florestal
>> Manaus/AM
>> 
>> 
>> 
>> Forestry Engineer
>> Manaus/AM-Brazil
>> 
>> 
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> 
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no

From marcelino.delacruz at upm.es  Mon Jul 21 14:53:57 2014
From: marcelino.delacruz at upm.es (Marcelino de la Cruz)
Date: Mon, 21 Jul 2014 14:53:57 +0200
Subject: [R-sig-Geo] Logit spatial predictions outside range [0,1]
In-Reply-To: <CAOcqoUPgNtcd-oGSyhn=hvy69TJzst3D8E6WqRzx+V6zjFDHFg@mail.gmail.com>
References: <CAOcqoUPgNtcd-oGSyhn=hvy69TJzst3D8E6WqRzx+V6zjFDHFg@mail.gmail.com>
Message-ID: <53CD0D65.5070608@upm.es>

Hi Edoardo,

This happens because, as the help for predict.glm() says:

'The default [prediction]  is on the scale of the linear predictors; the 
alternative "response" is on the scale of the response variable.'

I.e., you should use

pred = predict(predictors, logit, ext=ext, type ="response")

to get your predictions on the [0,1] scale.

Hope this helps


Marcelino



El 21/07/2014 12:27, Edoardo Baldoni escribi?:
> Hello R-sig-Geo,
>
>
> my name is Edoardo and this is the first time I am asking for help here.
>
> I am going through the "sdm" vignette of package "dismo" and, when using
> the Logistic regression model of presence/absence(background) data of
> bradypus (p. 53) for spatial prediction, I get values outside the range
> [0,1]. I think this should not happen as using the Logit cumulative
> distribution function should limit them in the [0,1] range.
>
> It follows the code with the data:
>
> ## This is the dataset I use. It is just a random sample of the original
> envtrain dataset of
> ## the "sdm" vignette
>
>> envtrain0
>      pa bio1 bio12 bio16 bio17 bio5 bio6 bio7 bio8 biome
> 735  0  265  2618   954   391  314  224   90  264     1
> 634  0  264  2590  1007   203  327  200  127  263     1
> 861  0  243  1783   916    29  335  132  202  247     1
> 70   1  261  2791  1077   148  310  218   92  254     1
> 48   1  257  3575  1295   359  316  202  114  258     1
> 511  0  220  1583   457   281  339  114  225  226     7
> 344  0  230  3352  1436   247  294  167  127  228     1
> 453  0  242   240   140    14  308  186  121  260    13
> 325  0  240  1541   447   302  291  186  104  249     1
> 193  0  232  1130   506    87  311  123  188  256     1
> 568  0  257  2269   774   246  317  188  128  259     1
> 664  0  190  1512   544   251  282   85  196  219     1
> 82   1  268  2403   723   407  327  207  120  268     1
> 271  0  180  1078   336   195  320   65  255  238     7
> 873  0  258  4238  1378   814  301  222   79  260     1
> 105  0   92   719   290    98  150   36  114   92     1
> 461  0  271  2112   849   254  330  224  106  268     1
> 37   1  276   372   215    25  330  222  108  278    13
> 822  0  110  1427   707   115  232   31  201   79     4
> 59   1  252  2471  1094   172  319  194  124  254     1
> 26   1  199  2005   657   256  262  143  119  196     1
> 115  0  215  1247   518   178  329   79  251  271     5
> 714  0  257  1903   714   162  325  182  143  260     1
> 781  0  265  2048   909   172  329  212  117  259     1
> 84   1  263  2921   868   607  318  205  113  262     1
> 604  0  119  1251   595   117  237   41  196   87     4
> 449  0  243  1307   540    86  310  148  162  259     7
> 384  0  233  2257   955   237  300  159  140  241     1
> 187  0  125  1282   616   115  230   50  180  101     4
> 278  0  254   819   521    12  314  199  115  255    13
> 766  0  178  1220   333   269  316   64  251  201     7
> 426  0  255  2207   984    52  350  159  191  253     1
> 153  0  253  1874   775   101  320  172  148  256     1
> 174  0  220  1410   492   168  304  113  191  241     7
> 214  0  238  1667   722   101  320  159  161  245     1
> 626  0  258  2116   959   203  333  206  127  252     7
> 779  0  224  1834   907    28  316  107  210  235     7
> 429  0  247   569   226    58  315  180  136  237    13
> 580  0  261  2507  1085    94  346  171  175  258     1
> 388  0  252  2408   886   278  319  181  138  255     1
>
> ## I then estimate a Logit model and use it for prediction
> ##  with new data (predictors)
>
> logit = glm(pa ~ bio1 + bio5 + bio6 + bio7 + bio8 + bio12 + bio16 + bio17,
> family = binomial(link = 'logit'), data = envtrain0)
> files = list.files(paste(system.file(package = 'dismo'),'/ex',sep=''),
> pattern = 'grd', full.names = T)
> predictors = stack(files)
> ext = extent(-90,-32,-33,23)
> pred = predict(predictors, logit, ext=ext)
> pred
>
> ## The output says that predicted values are in the range (-22.41863,
> 5.837521)
>
>> pred
> class       : RasterLayer
> dimensions  : 112, 116, 12992  (nrow, ncol, ncell)
> resolution  : 0.5, 0.5  (x, y)
> extent      : -90, -32, -33, 23  (xmin, xmax, ymin, ymax)
> coord. ref. : +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0
> data source : in memory
> names       : layer
> values      : -22.41863, 5.837521  (min, max)
>
> I was expecting to get values included in the range [0,1] as the logit
> model should do. Indeed,
> the fitted values of the model all lie between 0 and 1.
>
> Why predicted values are in the range (-22.41863, 5.837521) here ?
> Can you tell me where I am making a mistake ?
> Thanks
>
> Regards,
>
>
> Edoardo
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From thi_veloso at yahoo.com.br  Mon Jul 21 16:30:12 2014
From: thi_veloso at yahoo.com.br (Thiago V. dos Santos)
Date: Mon, 21 Jul 2014 07:30:12 -0700
Subject: [R-sig-Geo] Count values "greater than" in rasterbrick layers
In-Reply-To: <D51374C4B889BC47B3C5286047C86DA17C14B3A9@whqembx03p.ad.sfwmd.gov>
References: <1405504258.52913.YahooMailNeo@web121901.mail.ne1.yahoo.com>
	<D51374C4B889BC47B3C5286047C86DA17C14B3A9@whqembx03p.ad.sfwmd.gov>
Message-ID: <1405953012.96058.YahooMailNeo@web121901.mail.ne1.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140721/7fa039f8/attachment.pl>

From roland.pape at uni-oldenburg.de  Mon Jul 21 21:22:21 2014
From: roland.pape at uni-oldenburg.de (Roland Pape)
Date: Mon, 21 Jul 2014 19:22:21 +0000
Subject: [R-sig-Geo] Best way to provide meaningful interpretation of axes
 out of GNESFA, KSelect and Niche analyses
Message-ID: <4780FC16AA89574CA36BB63C15DF63A10151B59C@mbx05.w2kroot.uni-oldenburg.de>

Dear list,

while working with the adehabitatHS package to explore habitat use of different animal species I wondered about the best solution to provide a meaningful interpretation of the axes resulting from the various approaches. 
According to the vignette of the package (p 19), it is preferred to give meaning to the axes of the Gnesfa with the help of correlations between the environmental variables and the axes of the Gnesfa rather than using the coefficients of the variables. The reason to do so (correlated variables may render the interpretation of coefficients difficult) holds also for other approaches like the Kselect and Niche analyses. However, their output provides per default only variable coordinates and normed scores with the latter being used to give meaning to the axes. Wouldn't it be appropriate to use correlations here as well and if yes, how could they be achieved?

Kind regards,
Roland

From Dominik.Schneider at colorado.edu  Tue Jul 22 02:26:36 2014
From: Dominik.Schneider at colorado.edu (Dominik Schneider)
Date: Mon, 21 Jul 2014 20:26:36 -0400
Subject: [R-sig-Geo] extracting raster data with point and polygons
Message-ID: <CAHYDKLZDLN18suT=UXJ2H7Fpng-VngaKZuLw5xXBN-KiZEhptQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140721/07788041/attachment.pl>

From oscar.perpinan at upm.es  Tue Jul 22 11:17:30 2014
From: oscar.perpinan at upm.es (=?UTF-8?Q?Oscar_Perpi=C3=B1an?=)
Date: Tue, 22 Jul 2014 11:17:30 +0200
Subject: [R-sig-Geo] extracting raster data with point and polygons
In-Reply-To: <CAHYDKLZDLN18suT=UXJ2H7Fpng-VngaKZuLw5xXBN-KiZEhptQ@mail.gmail.com>
References: <CAHYDKLZDLN18suT=UXJ2H7Fpng-VngaKZuLw5xXBN-KiZEhptQ@mail.gmail.com>
Message-ID: <CAMLL7bmrLGc-cPwmdxGqMRyFSQn7xtbgmXhC8JhSSVxpuFqCzQ@mail.gmail.com>

Hello,

If I understood you right, I think you can solve it using `zonal` and
`mask`. This is my proposal:

library(raster)

###### Your code
#define DEM
dem2m=raster(x=matrix(runif(22500,min=2000,max=2500),nrow=150),crs='+proj=utm
+zone=13 +datum=NAD83')
extent(dem2m)=c(0,300,0,3000)
#
#define satellite image
fsca.dem=raster(x=matrix(runif(100,0,100),nrow=10),crs='+proj=utm
+zone=13 +datum=NAD83')
extent(fsca.dem)=c(0,300,0,3000)

#define point data
obs=data.frame(x=runif(5,0,300),y=runif(5,0,300),sd=runif(5,0,5))
coordinates(obs)=~x+y
proj4string(obs)='+proj=utm +zone=13 +datum=NAD83'

###### My proposal
## Create a Raster with the same resolution as `dem2m`, whose values are
## the cell numbers of `fsca.dem`
xyDEM2m <- xyFromCell(dem2m, cell = seq_len(ncell(dem2m)))
zones <- setValues(dem2m, cellFromXY(fsca.dem, xyDEM2m))
## Compute the cv for each zone. `zoneVariation` has the same
## resolution as `fsca.dem`
zoneVariation <- setValues(fsca.dem, zonal(dem2m, zones, fun = cv)[,2])
## We are only interested in those cells with observations
varObs <- mask(zoneVariation, obs)

If you work with large rasters maybe it is better to apply mask before.

Best,

Oscar.
-----------------------------------------------------------------
Oscar Perpi??n Lamigueiro
Dpto. Ingenier?a El?ctrica (ETSIDI-UPM)
Grupo de Sistemas Fotovoltaicos (IES-UPM)
URL: http://oscarperpinan.github.io
Twitter: @oscarperpinan


2014-07-22 2:26 GMT+02:00 Dominik Schneider <Dominik.Schneider at colorado.edu>:
> Hi -
> I have a 2 meter DEM, a 30m satellite image and some point data. Basically,
> I would like to extract the 2m dem pixels that correspond with the 30m
> satellite data, but only for the satellite pixels that correspond with a
> point observation. i've been trying to get at the answer from the sp
> vignette 'over' but am stuck.
> an example:
> #define DEM
> dem2m=raster(x=matrix(runif(22500,min=2000,max=2500),nrow=150),crs='+proj=utm
> +zone=13 +datum=NAD83')
> extent(dem2m)=c(0,300,0,3000)
> #
> #define satellite image
> fsca.dem=raster(x=matrix(runiff(100,0,100),nrow=10),crs='+proj=utm +zone=13
> +datum=NAD83')
> extent(dem2m)=c(0,300,0,3000)
> #
> #define point data
> obs=data.frame(x=runif(5,0,300),y=runif(5,0,300),sd=runif(5,0,5))
> coordinates(obs)=~x+y
> proj4string(obs)='+proj=utm +zone=13 +datum=NAD83'
> #
> #--- in my case, I resampled the sat image to the dem grid. but thats
> already taken care of in the example.
> ##dem.pe=projectExtent(dem2m,crs=projection(dem2m))
> ##res(dem.pe) <- 30
> ##fsca.dem=projectRaster(fsca,dem.pe,method='ngb')
> #
> # This is where I am lost
> # ----------- I thought I'd use polygons to extract the dem data. The catch
> is, rather than extracting every polygon of data (which takes longer than
> I've been willing to wait given 2e6 pixels) I would like to subset this
> spatialpolygondf to the 5 polygons that have observational data. if the
> same polygon has multiple obs in it, it should be replicated.
> fsca.poly=rasterToPolygons(fsca.dem)
>
> #first i tried this but this extracts the fsca values. I need this too
> eventually but was hoping for a subsetted spatialpolygon.dataframe
> fsca.pts=over(ss.depth,fsca.poly)
>
> #second i tried this but the list has rownames that I can't interpret.
> (fsca cellnumbers?)
> fsca.pts.poly=over(ss.depth,fsca.poly,returnList=T)
> polynames=unlist(lapply(fsca.pts.poly,rownames))
>
> #but what i'd like to do is apply the cv function on the 225 2m elev pixels
> that correspond to the 30 fsca pixel for which i have an observation point.
> elev.cv=extract(dem2m,*y=fsca.poly.w.pts*,fun=cv)
>
> # as a note, the buffer option in extract would not work currently because
> the point data isn't necessarily in the middle dem pixel relative to the
> fsca pixel. so one solution might be to 1. subset the polygon dataframe 2.
> use the cell center from the fsca pixel to extract from the dem raster with
> a buffer of 7 cells.
>
> anyway, i appreciate any help you can give, in particulary with subsetting
> the spatialpolygondf.
> Thanks
> Dominik
>
>
>> sessionInfo()
> R version 3.0.2 (2013-09-25)
> Platform: x86_64-apple-darwin10.8.0 (64-bit)
>
> locale:
> [1] C
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> other attached packages:
> [1] maptools_0.8-30    reshape2_1.2.2     plyr_1.8
> rgdal_0.8-16
> [5] ggplot2_0.9.3.1    RColorBrewer_1.0-5 scales_0.2.3
> raster_2.2-31
> [9] sp_1.0-15
>
> loaded via a namespace (and not attached):
>  [1] MASS_7.3-29      colorspace_1.2-4 compiler_3.0.2   dichromat_2.0-0
>  [5] digest_0.6.4     foreign_0.8-55   grid_3.0.2       gtable_0.1.2
>  [9] labeling_0.2     lattice_0.20-29  munsell_0.4.2    proto_0.3-10
> [13] stringr_0.6.2    tcltk_3.0.2      tools_3.0.2
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From alfios17 at hotmail.com  Tue Jul 22 16:04:31 2014
From: alfios17 at hotmail.com (Lorenzo Alfieri)
Date: Tue, 22 Jul 2014 16:04:31 +0200
Subject: [R-sig-Geo] apply interpolation functions on a map
Message-ID: <DUB115-W85E2377CCF65965F566FE2D7F10@phx.gbl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140722/fd60bc86/attachment.pl>

From Dominik.Schneider at colorado.edu  Tue Jul 22 16:37:02 2014
From: Dominik.Schneider at colorado.edu (Dominik Schneider)
Date: Tue, 22 Jul 2014 10:37:02 -0400
Subject: [R-sig-Geo] extracting raster data with point and polygons
In-Reply-To: <CAMLL7bmrLGc-cPwmdxGqMRyFSQn7xtbgmXhC8JhSSVxpuFqCzQ@mail.gmail.com>
References: <CAHYDKLZDLN18suT=UXJ2H7Fpng-VngaKZuLw5xXBN-KiZEhptQ@mail.gmail.com>
	<CAMLL7bmrLGc-cPwmdxGqMRyFSQn7xtbgmXhC8JhSSVxpuFqCzQ@mail.gmail.com>
Message-ID: <CAHYDKLYDR_EoMqMN3+SNbUwhaq6dP=x80Ku69-OKOgi97vZHyw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140722/9228da5f/attachment.pl>

From Dominik.Schneider at colorado.edu  Tue Jul 22 22:36:30 2014
From: Dominik.Schneider at colorado.edu (dschneiderch)
Date: Tue, 22 Jul 2014 13:36:30 -0700 (PDT)
Subject: [R-sig-Geo] Count values "greater than" in rasterbrick layers
In-Reply-To: <1405504258.52913.YahooMailNeo@web121901.mail.ne1.yahoo.com>
References: <1405504258.52913.YahooMailNeo@web121901.mail.ne1.yahoo.com>
Message-ID: <1406061390595-7586782.post@n2.nabble.com>

Thiago - 
With regards to your original attempt for part b, I  believe using length()
instead of sum() will get you what you want.  In this case, sum(x) and
sum(x[x>1]) are the same assuming you have no values less than 1. Length can
be used as a proxy for counting how many days rain>1.




--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Count-values-greater-than-in-rasterbrick-layers-tp7586746p7586782.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From oscar.perpinan at upm.es  Wed Jul 23 10:37:55 2014
From: oscar.perpinan at upm.es (=?UTF-8?Q?Oscar_Perpi=C3=B1an?=)
Date: Wed, 23 Jul 2014 10:37:55 +0200
Subject: [R-sig-Geo] extracting raster data with point and polygons
In-Reply-To: <CAHYDKLYDR_EoMqMN3+SNbUwhaq6dP=x80Ku69-OKOgi97vZHyw@mail.gmail.com>
References: <CAHYDKLZDLN18suT=UXJ2H7Fpng-VngaKZuLw5xXBN-KiZEhptQ@mail.gmail.com>
	<CAMLL7bmrLGc-cPwmdxGqMRyFSQn7xtbgmXhC8JhSSVxpuFqCzQ@mail.gmail.com>
	<CAHYDKLYDR_EoMqMN3+SNbUwhaq6dP=x80Ku69-OKOgi97vZHyw@mail.gmail.com>
Message-ID: <CAMLL7bk6CYd2WPAp5+JoXvo0tCk5rVn-vFCLZZH_xE2nAjr9og@mail.gmail.com>

Hi,
> Could you clarify
> where you would use mask() to make this more efficient for larger rasters?
> It seems this will always use all the cellnumbers. I though maybe
> mask(zones,obs) but then zonal() threw an error.

I mean that you may save computation time if you apply `cv` (or
whatever function) only over those cells that correspond to the point
observations. However, this does not work with `zonal` as you point.

Best,

Oscar.


From jon.skoien at jrc.ec.europa.eu  Wed Jul 23 11:53:09 2014
From: jon.skoien at jrc.ec.europa.eu (Jon Olav Skoien)
Date: Wed, 23 Jul 2014 11:53:09 +0200
Subject: [R-sig-Geo] apply interpolation functions on a map
In-Reply-To: <DUB115-W85E2377CCF65965F566FE2D7F10@phx.gbl>
References: <DUB115-W85E2377CCF65965F566FE2D7F10@phx.gbl>
Message-ID: <53CF8605.5030903@jrc.ec.europa.eu>

Hi Lorenzo,

I think you should be able to achieve what you are trying with mapply, 
passing function type and water depth for each pixel:

Cost[] <- mapply(FUN = function(dfun, wlevel) dfun(wlevel),
                              dfun = DDFun[getValues(LandUse)],
                              wlevel = getValues(WaterDepth))

I am not sure if this is the most efficient method if the raster is 
large though, it could even be that looping would be better. 
raster:::calc seems not to be able to take multiple functions as 
argument, otherwise it could have been a better option.

Cheers,
Jon

On 22-Jul-14 16:04, Lorenzo Alfieri wrote:
> Dear list,
> I can't find a solution to this problem:
> Let's say I have a map of water depth due to a flood , and the corresponding land-use:
>
> library(raster)
> WaterDepth<-raster(matrix(1:20, nrow = 5, ncol = 4))
> LandUse<-raster(WaterDepth)
> LandUse[]<-c(rep(1,12),rep(2,8))
>
> # each land use class has a different relation between water depth and damage, which is defined per points and that I can interpolate linearly:
> Damage<-data.frame(V1=c(0,100,150,230,340,340),V2=c(0,55,120,160,225,225))
> Depths<-c(0,0.5,1,2,4,100)     #Water depth in meters
> DDFun<-lapply(Damage, approxfun, x=Depths)
>
> # Now if I want to know the estimated cost of the damage on a specific grid point it seems to work:
> i<-3
> Cost<-raster(WaterDepth)
> Cost[i] <- DDFun[[LandUse[i]]](WaterDepth[i])
>
>> Cost[i]
>      
> 340
>
>
> But it doesn't work if I try to apply it to the entire map extent:
>
>> Cost[] <- DDFun[[LandUse[]]](WaterDepth[])
> Error in DDFun[[LandUse[]]] : recursive indexing failed at level 2
>
> Any suggestion on how to do this (possibly without looping on each land use class)?
>
> Thanks
>
> Lorenzo
>   		 	   		
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


-- 
Jon Olav Sk?ien
Joint Research Centre - European Commission
Institute for Environment and Sustainability (IES)
Climate Risk Management Unit

Via Fermi 2749, TP 100-01,  I-21027 Ispra (VA), ITALY

jon.skoien at jrc.ec.europa.eu
Tel:  +39 0332 789205

Disclaimer: Views expressed in this email are those of the individual and do not necessarily represent official views of the European Commission.


From frank.davenport at gmail.com  Wed Jul 23 18:17:07 2014
From: frank.davenport at gmail.com (Frank Davenport)
Date: Wed, 23 Jul 2014 09:17:07 -0700
Subject: [R-sig-Geo] raster::extract fails on brick but works on individual
	layers of brick
Message-ID: <CAEVpnsEKcbasN=UThFCbdYusvk3EuJ1XV9iEYxGXZv9o1A6jNQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140723/ce277a57/attachment.pl>

From lyndon.estes at gmail.com  Wed Jul 23 19:07:42 2014
From: lyndon.estes at gmail.com (Lyndon Estes)
Date: Wed, 23 Jul 2014 13:07:42 -0400
Subject: [R-sig-Geo] raster::extract fails on brick but works on
 individual layers of brick
In-Reply-To: <CAEVpnsEKcbasN=UThFCbdYusvk3EuJ1XV9iEYxGXZv9o1A6jNQ@mail.gmail.com>
References: <CAEVpnsEKcbasN=UThFCbdYusvk3EuJ1XV9iEYxGXZv9o1A6jNQ@mail.gmail.com>
Message-ID: <CALuVVaanebwpnUqpbSMPEu5_vHwrS_eEXJHKby8HodgAykYF3g@mail.gmail.com>

Hi Frank,

I think the mean function is getting in the way, since if you want to
extra the values for all cells each polygon overlaps, the outputs will
first end up in a list.

test1 <- extract(g, dsd, weights = TRUE, small = TRUE)

Will get the cell values for each polygon from each layer in the
brick, along with their weight (while allowing very small polygons to
get their underlying cell values).

I would then process the mean function on the list.

v <- t(sapply(test1, function(x) apply(t(sapply(1:nrow(x), function(y)
x[y, 1:10] * x[y, 11])), 2, sum)))  # matrix of annual values per
polygon

Hope this helps.

Cheers, Lyndon


On Wed, Jul 23, 2014 at 12:17 PM, Frank Davenport
<frank.davenport at gmail.com> wrote:
> Hello,
>
> I am using extract() to aggregate values from a raster to a polygon. The
> raster is a brick object. Extract fails on the brick object but succeeds
> when applied on each individual layer of the brick (via a for() loop). I
> would use this as a work around but in my actual scenario the brick is much
> bigger and the individual approach is too slow.
>
> The specific error message is: "Error in t(sapply(res, meanfunc)) :  error
> in evaluating the argument 'x' in selecting a method for function 't':
> Error in apply(x, 1, function(X) { : dim(X) must have a positive length"
>
> I believe this has something to do with the relative sizes of the polygons
> (small) and the grid cells. I have successfully extracted this brick to
> another shapefile that had much larger polygons. Likewise I can also do the
> extraction if I resample the cells to a smaller resolution (not shown
> below).
>
>
> Finally the extract will work if I set 'na.rm=F' but then produces mostly
> NA's, even though there are no NAs in the brick. I realize this might be
> something to do with the dataType(). However that does not explain why
> extract works on individual layers, but not the whole brick.
>
> Reproducible code is below and prettier example can be found here:
> http://rpubs.com/frank_davenport/22698
>
> The data necessary to run the example can be found here:
> https://dl.dropboxusercontent.com/u/9577903/99_raster_bugreport.Rdata
>
> Thank you for your help and apologies if a solution is already posted.
>
> Frank
>
>> rm(list=ls())
>> library(raster)
> Loading required package: sp
>>
>> ##-Download data from here:
> https://dl.dropboxusercontent.com/u/9577903/99_raster_bugreport.Rdata
>>
>> ##contains 'dsd' a spatial polygons data.frame and 'g' a raster brick
> with 10 layers
>> load('~/Dropbox/Public/99_raster_bugreport.Rdata')
>>
>> dsd
> class       : SpatialPolygonsDataFrame
> features    : 36
> extent      : 34.04665, 39.70319, -4.67742, 1.19921  (xmin, xmax, ymin,
> ymax)
> coord. ref. : +proj=longlat +a=6378249.145 +b=6356514.96582849 +no_defs
> variables   : 4
> names       : Province, District,         Division, uidu
> min values  :  CENTRAL,  BUNGOMA, ABOTHUGUCHI WEST,    1
> max values  :  WESTERN,   VIHIGA,            WINAM,   44
>> g
> class       : RasterBrick
> dimensions  : 24, 20, 480, 10  (nrow, ncol, ncell, nlayers)
> resolution  : 0.5, 0.5  (x, y)
> extent      : 33, 43, -6, 6  (xmin, xmax, ymin, ymax)
> coord. ref. : +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0
> data source : in memory
> names       : X1999.03.01, X1999.03.02, X1999.03.03, X1999.03.04,
> X1999.03.05, X1999.03.06, X1999.03.07, X1999.03.08, X1999.03.09,
> X1999.03.10
> min values  :    22.47562,    22.44415,    22.25507,    22.23166,
> 22.12387,    22.42477,    22.27802,    22.15134,    22.36218,    22.33447
> max values  :    41.47818,    40.53116,    41.54944,    42.33093,
> 41.67810,    40.79260,    41.83319,    40.83359,    41.12604,    42.00555
>
>>
>> #---Show the data
>> plot(g[[1]])
>> plot(dsd,add=T)
>>
>> #--Try to extract, with weights yeilds an error
>> test1<-extract(g,dsd,fun=mean,na.rm=T,weights=T)
> Error in t(sapply(res, meanfunc)) :
>   error in evaluating the argument 'x' in selecting a method for function
> 't': Error in apply(x, 1, function(X) { : dim(X) must have a positive length
>>
>> #--Extract without weights--produces NA's for most polygons
>> test2<-extract(g,dsd,fun=mean,na.m=T)
>> head(test2)
>      X1999.03.01 X1999.03.02 X1999.03.03 X1999.03.04 X1999.03.05
> X1999.03.06 X1999.03.07 X1999.03.08 X1999.03.09 X1999.03.10
> [1,]          NA          NA          NA          NA          NA
> NA          NA          NA          NA          NA
> [2,]          NA          NA          NA          NA          NA
> NA          NA          NA          NA          NA
> [3,]          NA          NA          NA          NA          NA
> NA          NA          NA          NA          NA
> [4,]          NA          NA          NA          NA          NA
> NA          NA          NA          NA          NA
> [5,]          NA          NA          NA          NA          NA
> NA          NA          NA          NA          NA
> [6,]          NA          NA          NA          NA          NA
> NA          NA          NA          NA          NA
>> summary(test2)
>   X1999.03.01     X1999.03.02     X1999.03.03     X1999.03.04
> X1999.03.05     X1999.03.06     X1999.03.07     X1999.03.08
>  Min.   :24.47   Min.   :25.21   Min.   :24.67   Min.   :25.47   Min.
> :27.42   Min.   :25.38   Min.   :25.93   Min.   :24.11
>  1st Qu.:29.29   1st Qu.:30.99   1st Qu.:29.55   1st Qu.:30.83   1st
> Qu.:31.58   1st Qu.:29.78   1st Qu.:29.51   1st Qu.:28.35
>  Median :30.31   Median :33.63   Median :31.13   Median :31.88   Median
> :33.32   Median :30.31   Median :30.52   Median :29.71
>  Mean   :29.87   Mean   :32.75   Mean   :30.41   Mean   :31.78   Mean
> :32.61   Mean   :29.71   Mean   :29.90   Mean   :29.19
>  3rd Qu.:31.86   3rd Qu.:36.08   3rd Qu.:32.59   3rd Qu.:34.37   3rd
> Qu.:34.73   3rd Qu.:30.60   3rd Qu.:31.32   3rd Qu.:30.82
>  Max.   :32.81   Max.   :37.00   Max.   :33.45   Max.   :35.77   Max.
> :35.42   Max.   :31.98   Max.   :31.69   Max.   :32.53
>  NA's   :30      NA's   :30      NA's   :30      NA's   :30      NA's
> :30      NA's   :30      NA's   :30      NA's   :30
>   X1999.03.09     X1999.03.10
>  Min.   :25.98   Min.   :25.53
>  1st Qu.:29.53   1st Qu.:30.73
>  Median :30.57   Median :31.06
>  Mean   :30.12   Mean   :31.24
>  3rd Qu.:31.41   3rd Qu.:33.52
>  Max.   :32.75   Max.   :34.83
>  NA's   :30      NA's   :30
>>
>> #--Extract each layer seperatley--works but is SLOW
>> glist<-vector(mode='list',length=nlayers(g))
>>
>> for(i in 1:length(glist)){
> +   glist[[i]]<-extract(g[[i]],dsd,fun=mean,na.rm=T,weigths=T)
> + }
>>
>> sessionInfo()
> R version 3.1.0 (2014-04-10)
> Platform: x86_64-apple-darwin10.8.0 (64-bit)
>
> locale:
> [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> other attached packages:
> [1] raster_2.2-31 sp_1.0-15
>
> loaded via a namespace (and not attached):
> [1] grid_3.1.0      lattice_0.20-29 tools_3.1.0
>>
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From alfios17 at hotmail.com  Thu Jul 24 09:09:07 2014
From: alfios17 at hotmail.com (Lorenzo Alfieri)
Date: Thu, 24 Jul 2014 09:09:07 +0200
Subject: [R-sig-Geo] apply interpolation functions on a map
In-Reply-To: <53CF8605.5030903@jrc.ec.europa.eu>
References: <DUB115-W85E2377CCF65965F566FE2D7F10@phx.gbl>,
	<53CF8605.5030903@jrc.ec.europa.eu>
Message-ID: <DUB115-W561A9D6B573C97A6324B39D7FF0@phx.gbl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140724/7c035fcb/attachment.pl>

From ferra.xu at yahoo.com  Thu Jul 24 19:22:46 2014
From: ferra.xu at yahoo.com (Ferra Xu)
Date: Thu, 24 Jul 2014 10:22:46 -0700
Subject: [R-sig-Geo] Kernel smoothing density function
Message-ID: <1406222566.83547.YahooMailNeo@web125101.mail.ne1.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140724/a1dda480/attachment.pl>

From sarah.goslee at gmail.com  Thu Jul 24 21:35:49 2014
From: sarah.goslee at gmail.com (Sarah Goslee)
Date: Thu, 24 Jul 2014 15:35:49 -0400
Subject: [R-sig-Geo] Kernel smoothing density function
In-Reply-To: <1406222566.83547.YahooMailNeo@web125101.mail.ne1.yahoo.com>
References: <1406222566.83547.YahooMailNeo@web125101.mail.ne1.yahoo.com>
Message-ID: <CAM_vjunimvsXBwu08hy16t_sNm=_kK7=YGY4GH7CY9S1zROKvw@mail.gmail.com>

Hi,

On Thu, Jul 24, 2014 at 1:22 PM, Ferra Xu <ferra.xu at yahoo.com> wrote:
> Hello all,
> In order to find the kernel smoothing density function of a 3 dimensional data-set, I wrote this code in R:
> library(ks)defect <-read.table(file.choose(),sep=",")hat <-kde(defect)pdf("SampleGraph.pdf")plot(hat,drawpoints=TRUE)dev.off()
> But I have problem in interpretation of the result..I don't see the estimated values for density function (I need to have the values of f to use it in another code). The other problem is that the pdf file is not created correctly..Although the plot is created in R window, when I want to open the pdf file, it says:There was an error opening this document. This file cannot be opened because it has no pages.
>         [[alternative HTML version deleted]]


See why you shouldn't post HTML to this list?

Trying to parse that, I see that I can't run your example because no
data are provided (dput() is a good function to know).

When I run the example code given in ?kde it works as expected. Does
your plot command create a plot on other devices, like the default for
your OS? Does the example code in ?kde work when you run it? Does it
create a plot?

As for the estimated values, did you carefully read the Value section
of the help file?

     A kernel density estimate is an object of class ?kde? which is a
     list with fields:

       x: data points - same as input

eval.points: points at which the estimate is evaluated

estimate: density estimate at ?eval.points?

If this density estimate is not the estimate you are looking for,
you'll need to be more specific.

Sarah

-- 
Sarah Goslee
http://www.functionaldiversity.org


From ferra.xu at yahoo.com  Thu Jul 24 22:06:54 2014
From: ferra.xu at yahoo.com (Ferra Xu)
Date: Thu, 24 Jul 2014 13:06:54 -0700
Subject: [R-sig-Geo] Kernel smoothing density function
In-Reply-To: <CAM_vjunimvsXBwu08hy16t_sNm=_kK7=YGY4GH7CY9S1zROKvw@mail.gmail.com>
References: <1406222566.83547.YahooMailNeo@web125101.mail.ne1.yahoo.com>
	<CAM_vjunimvsXBwu08hy16t_sNm=_kK7=YGY4GH7CY9S1zROKvw@mail.gmail.com>
Message-ID: <1406232414.23707.YahooMailNeo@web125101.mail.ne1.yahoo.com>

Dear Sarah
Thank you for your response. I have attached the data that I'm using. I noticed that no estimate and eval.points are generated...Would you please take a look at it??
It creates a plot in R environment but the pdf file doesn't work.

Appreciate your help,


On Thursday, July 24, 2014 12:35 PM, Sarah Goslee <sarah.goslee at gmail.com> wrote:
 


Hi,


On Thu, Jul 24, 2014 at 1:22 PM, Ferra Xu <ferra.xu at yahoo.com> wrote:
> Hello all,
> In order to find the kernel smoothing density function of a 3 dimensional data-set, I wrote this code in R:
> library(ks)defect <-read.table(file.choose(),sep=",")hat <-kde(defect)pdf("SampleGraph.pdf")plot(hat,drawpoints=TRUE)dev.off()
> But I have problem in interpretation of the result..I don't see the estimated values for density function (I need to have the values of f to use it in another code). The other problem is that the pdf file is not created correctly..Although the plot is created in R window, when I want to open the pdf file, it says:There was an error opening this document. This file cannot be opened because it has no pages.
>? ? ? ?  [[alternative HTML version deleted]]


See why you shouldn't post HTML to this list?

Trying to parse that, I see that I can't run your example because no
data are provided (dput() is a good function to know).

When I run the example code given in ?kde it works as expected. Does
your plot command create a plot on other devices, like the default for
your OS? Does the example code in ?kde work when you run it? Does it
create a plot?

As for the estimated values, did you carefully read the Value section
of the help file?

? ?  A kernel density estimate is an object of class ?kde? which is a
? ?  list with fields:

? ? ?  x: data points - same as input

eval.points: points at which the estimate is evaluated

estimate: density estimate at ?eval.points?

If this density estimate is not the estimate you are looking for,
you'll need to be more specific.

Sarah

-- 
Sarah Goslee
http://www.functionaldiversity.org
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140724/08f1b145/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: kernel1.csv
Type: application/vnd.ms-excel
Size: 9661 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140724/08f1b145/attachment.xlb>

From sarah.goslee at gmail.com  Thu Jul 24 22:19:07 2014
From: sarah.goslee at gmail.com (Sarah Goslee)
Date: Thu, 24 Jul 2014 16:19:07 -0400
Subject: [R-sig-Geo] Kernel smoothing density function
In-Reply-To: <1406232414.23707.YahooMailNeo@web125101.mail.ne1.yahoo.com>
References: <1406222566.83547.YahooMailNeo@web125101.mail.ne1.yahoo.com>
	<CAM_vjunimvsXBwu08hy16t_sNm=_kK7=YGY4GH7CY9S1zROKvw@mail.gmail.com>
	<1406232414.23707.YahooMailNeo@web125101.mail.ne1.yahoo.com>
Message-ID: <CAM_vjum9UT4HQAV_V6RT0P0qoWi-G01vu19tZtm1GiqnqSTTdA@mail.gmail.com>

On Thu, Jul 24, 2014 at 4:06 PM, Ferra Xu <ferra.xu at yahoo.com> wrote:
> Dear Sarah
> Thank you for your response. I have attached the data that I'm using. I
> noticed that no estimate and eval.points are generated...Would you please
> take a look at it?

Of course the estimate is generated, just as the help file promised.

hat$estimate

contains the estimate: all the named components given in the Value
section of the helpfile
are part of hat, and you can see that with
names(hat)

Have you read the Introduction to R that comes with your R
installation? Perhaps you should.

> It creates a plot in R environment but the pdf file doesn't work.
>
> Appreciate your help,

Well, ?plot.kde states that for 3D data it produces an interactive RGL
plot, and unlike for 1D and 2D there are no other options.

What do you expect to be printed to PDF when you create an interactive plot?

Reading ?rgl suggests that you might want to look into ?rgl.snapshot

Sarah

>
> On Thursday, July 24, 2014 12:35 PM, Sarah Goslee <sarah.goslee at gmail.com>
> wrote:
>
>
> Hi,
>
> On Thu, Jul 24, 2014 at 1:22 PM, Ferra Xu <ferra.xu at yahoo.com> wrote:
>> Hello all,
>> In order to find the kernel smoothing density function of a 3 dimensional
>> data-set, I wrote this code in R:
>> library(ks)defect <-read.table(file.choose(),sep=",")hat
>> <-kde(defect)pdf("SampleGraph.pdf")plot(hat,drawpoints=TRUE)dev.off()
>> But I have problem in interpretation of the result..I don't see the
>> estimated values for density function (I need to have the values of f to use
>> it in another code). The other problem is that the pdf file is not created
>> correctly..Although the plot is created in R window, when I want to open the
>> pdf file, it says:There was an error opening this document. This file cannot
>> be opened because it has no pages.
>
>>        [[alternative HTML version deleted]]
>
>
> See why you shouldn't post HTML to this list?
>
> Trying to parse that, I see that I can't run your example because no
> data are provided (dput() is a good function to know).
>
> When I run the example code given in ?kde it works as expected. Does
> your plot command create a plot on other devices, like the default for
> your OS? Does the example code in ?kde work when you run it? Does it
> create a plot?
>
> As for the estimated values, did you carefully read the Value section
> of the help file?
>
>     A kernel density estimate is an object of class ?kde? which is a
>     list with fields:
>
>       x: data points - same as input
>
> eval.points: points at which the estimate is evaluated
>
> estimate: density estimate at ?eval.points?
>
> If this density estimate is not the estimate you are looking for,
> you'll need to be more specific.
>
> Sarah
>


-- 
Sarah Goslee
http://www.functionaldiversity.org


From Alexander.Herr at csiro.au  Fri Jul 25 02:43:12 2014
From: Alexander.Herr at csiro.au (Herry)
Date: Thu, 24 Jul 2014 17:43:12 -0700 (PDT)
Subject: [R-sig-Geo] error exporting ESRI raster to raster native format
Message-ID: <1406248992814-7586795.post@n2.nabble.com>

hi list,

after loading a large ESRI raster file with a raster attribute table I
cannot process it. A simple writeRaster results in an unusable file
importing without the RAT.
>rster<-raster('GDA94albers/clum50m0314', RAT=FALSE)

image(rster) works fine
>writeRaster(rster,'luse4BA.grd', progress='text')->rs
image(rs) results in 

"Error in setValues(outras, m) : 
  length(values) is not equal to ncell(x), or to 1
In addition: Warning messages:
1: In .readCells(x, cells, 1) : NAs introduced by coercion
2: In cbind(cells[, 1], vals[, 2:ncol(vals)]) :
  number of rows of result is not a multiple of vector length (arg 1)"

I get the same result importing the raster and doing a deratify...
info on the raster:
>rster
class       : RasterLayer 
dimensions  : 76740, 80200, 6154548000  (nrow, ncol, ncell)
resolution  : 50, 50  (x, y)
extent      : -1888000, 2122000, -4847000, -1010000  (xmin, xmax, ymin,
ymax)
coord. ref. : +proj=aea +lat_1=-18 +lat_2=-36 +lat_0=0 +lon_0=132 +x_0=0
+y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs 
data source : /data/her134/BA/GDA94albers/clum50m0314 
names       : clum50m0314 
values      : 100, 663  (min, max)

I am suspecting this is a problem with importing the ESRI raster...

Any suggestions?

Thanks and cheers
herry






--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/error-exporting-ESRI-raster-to-raster-native-format-tp7586795.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From alanchalk at gmail.com  Fri Jul 25 08:22:50 2014
From: alanchalk at gmail.com (Alan Chalk)
Date: Fri, 25 Jul 2014 07:22:50 +0100
Subject: [R-sig-Geo] Creating a tesselation of polygons around a set of lines
Message-ID: <53D1F7BA.1020501@gmail.com>

Dear List,

I have a set of lines that are within a given area.  I would like to 
create a set of polygons that tesselate the same area and which fulfil 
the condition that each polygon contains exactly one line (that is, the 
line is within the polygon and does not form one of its edges).

As an example, imagine we have the following three lines:

    require(sp)
# create 3 Lines objects
    Lines1.l <- Lines(ID=1, list(Line(matrix(c(0,0,1,1), ncol=2, 
byrow=TRUE))))
    Lines2.l <- Lines(ID=2, list(Line(matrix(c(1,1,2,3), ncol=2, 
byrow=TRUE))))
    Lines3.l <- Lines(ID=3, list(Line(matrix(c(4,4,5,5), ncol=2, 
byrow=TRUE))))

# Create and plot SpatialLines object
    exampleSpatialLines.sl <- SpatialLines(list(Lines1.l, Lines2.l, 
Lines3.l))
    plot(exampleSpatialLines.sl)

Then, one solution to the problem would be as shown below.

# Plot an example solution to my problem
    examplePolygons1.p <- Polygons(ID=1, 
list(Polygon(matrix(c(0,0,0,1,1,1,1,0,0,0), ncol=2, byrow=TRUE))))
    examplePolygons2.p <- Polygons(ID=2, 
list(Polygon(matrix(c(0,1,0,5,2,5,5,0,1,0,1,1,0,1 ),
                                                             ncol=2, 
byrow=TRUE))))
    examplePolygons3.p <- Polygons(ID=3, 
list(Polygon(matrix(c(5,0,2,5,5,5,5,0), ncol=2, byrow=TRUE))))

    exampleSpatialPolygons.sp <- SpatialPolygons(list(examplePolygons1.p,
                     examplePolygons2.p,
                     examplePolygons3.p
                       )
                 )
    plot(exampleSpatialPolygons.sp[1], border="red", col="NA", add=TRUE, 
lwd=4)
    plot(exampleSpatialPolygons.sp[2], border="green", col="NA", 
add=TRUE, lwd=2.5)
    plot(exampleSpatialPolygons.sp[3], border="blue", col="NA", 
add=TRUE, lwd=0.1)

Clearly there are many solutions to this problem - however any solution 
(where the lines are within the polygons and not one of the edges) will 
suffice.

I would be grateful if anyone could supply an automated solution to this 
problem.

Many thanks

Alan Chalk


From damien.georges2 at gmail.com  Fri Jul 25 08:51:05 2014
From: damien.georges2 at gmail.com (Damien GEORGES)
Date: Fri, 25 Jul 2014 08:51:05 +0200
Subject: [R-sig-Geo] Issue saving ascii with writeRaster function
Message-ID: <53D1FE59.80000@gmail.com>

Dear all,

When I try to write a raster as .asc file on my HD using writeRaster 
function. When I check then the .asc file produce with a text editor, 
the first item on my raster is always stored under a strange format (e.g 
adding lot of decimals). That cause then some trouble in other software 
using this maps as input..

Here a (reproducible example) :

##########

library(raster)

## create raster
r <- raster(ncols=2,nrows=2,xmn=-100,ymn=-100,xmx=100,ymx=100)
r[] <- 1
# plot(r)

## save the raster in acii format
writeRaster(r, filename = "test.asc")

## check .asc file content
cat(readLines("test.asc"), sep="\n")

## output :
# NCOLS 2
# NROWS 2
# XLLCORNER -100
# YLLCORNER -100
# CELLSIZE 100
# NODATA_value -9999
# 1.000000000000000 1
# 1 1

## The first value is 1.00000000000 and I want it to be 1

##########

Does someone has already experiment this kind of issue?
Any suggestion to prevent from it?

Best,
Damien.


From Thierry.ONKELINX at inbo.be  Fri Jul 25 15:16:15 2014
From: Thierry.ONKELINX at inbo.be (ONKELINX, Thierry)
Date: Fri, 25 Jul 2014 13:16:15 +0000
Subject: [R-sig-Geo] %over% is omitting data
Message-ID: <AA818EAD2576BC488B4F623941DA7427F3AC5F15@inbomail.inbo.be>

Dear all,

I use %over% to append the attributes of the SpatialPolygonsDataFrame to a SpatialGridDataFrame. It works fine expect for two polygons. Both are completely contained by the grid (see the summary below) and are large enough. Both cover several grid cell completely, so there should be output. Neither polygon is marked as a hole.

I'm out of ideas on what is going wrong. Any suggestions are welcome. I can send the data off list if required. The rda file is 4.3MB

Best regards,

Thierry

> library(rgdal)
> combination <- basis.grid %over% basis.poly
>   summary(combination)
       ID
 8731563:    607
 9413613:    520
 7623223:    359
 3044067:    354
 6812906:    337
 (Other):   4757
 NA's   :1111136
>   summary(basis.grid)
Object of class SpatialGridDataFrame
Coordinates:
        min      max
x  22573.66 243973.7
y 184600.44 235100.4
Is projected: TRUE
proj4string :
[+proj=lcc +lat_1=49.8333339 +lat_2=51.16666733333333 +lat_0=90 +lon_0=4.367486666666666
+x_0=150000.01256 +y_0=5400088.4378 +ellps=intl +units=m +no_defs]
Grid attributes:
  cellcentre.offset cellsize cells.dim
x          22623.66      100      2214
y         184650.44      100       505
Data attributes:
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.
      0  279500  559000  559000  838600 1118000
>   summary(basis.poly)
Object of class SpatialPolygonsDataFrame
Coordinates:
        min      max
x  22573.66 243877.2
y 184600.44 235090.9
Is projected: TRUE
proj4string :
[+proj=lcc +lat_1=49.8333339 +lat_2=51.16666733333333 +lat_0=90 +lon_0=4.367486666666666
+x_0=150000.01256 +y_0=5400088.4378 +ellps=intl +units=m +no_defs]
Data attributes:
1104276 1184605 1212939 1321132  150057 1640781 1757090 1770778 1855918 2001918 2090205 2370933
      1       1       1       1       1       1       1       1       1       1       1       1
 241856 2590901 2659228 2957550 3040078 3042825 3044067  316529 3178448 3230545 3322126 3384170
      1       1       1       1       1       1       1       1       1       1       1       1
3394372 3633380 3714251 3833887 3839772 3920302 3974872 4012319  411473 4155071 4193712  422510
      1       1       1       1       1       1       1       1       1       1       1       1
4230828 4300995 4352428 4393061  446323 4477397 4559869 4599815 4720075 4849248  493549 4940272
      1       1       1       1       1       1       1       1       1       1       1       1
5005842 5236141 5434095 5539529 5853116 5904606 6048855 6211032 6252318   63260 6377909 6496260
      1       1       1       1       1       1       1       1       1       1       1       1
6812906 6890180 6958065 7190203 7284585 7316045 7389494 7477761 7484048 7613684 7618484 7623223
      1       1       1       1       1       1       1       1       1       1       1       1
7682161 7708077  784327 7865873 7951049  798473 8175618 8208627 8227675 8359132 8370365 8434383
      1       1       1       1       1       1       1       1       1       1       1       1
 852311 8591606 8705267 8731563 8759351 8788624 8869929 8932474 8952361 9091973 9095956  911327
      1       1       1       1       1       1       1       1       1       1       1       1
9228048 9296002 9413613 (Other)
      1       1       1       3
> which.missing <- which(!basis.poly$ID %in% unique(combination$ID))
> which.missing
[1] 54 86

ir. Thierry Onkelinx
Instituut voor natuur- en bosonderzoek / Research Institute for Nature and Forest
team Biometrie & Kwaliteitszorg / team Biometrics & Quality Assurance
Kliniekstraat 25
1070 Anderlecht
Belgium
+ 32 2 525 02 51
+ 32 54 43 61 85
Thierry.Onkelinx at inbo.be
www.inbo.be

To call in the statistician after the experiment is done may be no more than asking him to perform a post-mortem examination: he may be able to say what the experiment died of.
~ Sir Ronald Aylmer Fisher

The plural of anecdote is not data.
~ Roger Brinner

The combination of some data and an aching desire for an answer does not ensure that a reasonable answer can be extracted from a given body of data.
~ John Tukey

* * * * * * * * * * * * * D I S C L A I M E R * * * * * * * * * * * * *
Dit bericht en eventuele bijlagen geven enkel de visie van de schrijver weer en binden het INBO onder geen enkel beding, zolang dit bericht niet bevestigd is door een geldig ondertekend document.
The views expressed in this message and any annex are purely those of the writer and may not be regarded as stating an official position of INBO, as long as the message is not confirmed by a duly signed document.


From holtermann at hwwi.org  Fri Jul 25 16:07:08 2014
From: holtermann at hwwi.org (Linus Holtermann)
Date: Fri, 25 Jul 2014 16:07:08 +0200
Subject: [R-sig-Geo] Spatial Regression with two Weights matrix (SAR)
Message-ID: <AD0050057515F54084E7D5B93478C8481FC6620691@winxbede39.exchange.xchg>

Hello,

is there a R function that could estimate the following spatial regression:

y = rho_1*W1*y + rho_2*W2*y + XB + e

W1 and W2 are not identical, of course. 

Bests,
 
 
Linus Holtermann
Hamburgisches WeltWirtschaftsInstitut gemeinn?tzige GmbH (HWWI)
Heimhuder Stra?e 71
20148 Hamburg
Tel +49-(0)40-340576-336
Fax+49-(0)40-340576-776
Internet: www.hwwi.org
Email: holtermann at hwwi.org
 
AmtsgerichtHamburg HRB 94303
Gesch?ftsf?hrer: Prof. Dr. Thomas Straubhaar, Gunnar Geyer
Umsatzsteuer-ID: DE 241849425

From josh.london at noaa.gov  Fri Jul 25 18:17:48 2014
From: josh.london at noaa.gov (Josh London)
Date: Fri, 25 Jul 2014 09:17:48 -0700
Subject: [R-sig-Geo] GeoJSON errors when reading/writing with rgdal
Message-ID: <CA+wRd=U55=TyrfsiqK4U23gwbY_zS2mkg8EhBfa7-gupO9je2Q@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140725/b2361a17/attachment.pl>

From HodgessE at uhd.edu  Fri Jul 25 18:36:54 2014
From: HodgessE at uhd.edu (Hodgess, Erin)
Date: Fri, 25 Jul 2014 16:36:54 +0000
Subject: [R-sig-Geo] raster plotting question
Message-ID: <FF9DB805FC41CC4E95825A50F68063021AA5237A@columbia.uhd.campus>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140725/fb8cc04c/attachment.pl>

From HodgessE at uhd.edu  Fri Jul 25 20:25:13 2014
From: HodgessE at uhd.edu (Hodgess, Erin)
Date: Fri, 25 Jul 2014 18:25:13 +0000
Subject: [R-sig-Geo] raster plotting question:  figured it out
Message-ID: <FF9DB805FC41CC4E95825A50F68063021AA534B7@columbia.uhd.campus>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140725/33bc2439/attachment.pl>

From mtreglia at gmail.com  Fri Jul 25 20:42:02 2014
From: mtreglia at gmail.com (Michael Treglia)
Date: Fri, 25 Jul 2014 14:42:02 -0400
Subject: [R-sig-Geo] raster plotting question: figured it out
In-Reply-To: <FF9DB805FC41CC4E95825A50F68063021AA534B7@columbia.uhd.campus>
References: <FF9DB805FC41CC4E95825A50F68063021AA534B7@columbia.uhd.campus>
Message-ID: <CAPKp32v7mBNDoCE88BO5uMts+8Cm34L6wU_mtq1kY8=RW_7JPg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140725/5a4c2c2a/attachment.pl>

From HodgessE at uhd.edu  Fri Jul 25 21:09:32 2014
From: HodgessE at uhd.edu (Hodgess, Erin)
Date: Fri, 25 Jul 2014 19:09:32 +0000
Subject: [R-sig-Geo] raster plotting question: figured it out
In-Reply-To: <CAPKp32v7mBNDoCE88BO5uMts+8Cm34L6wU_mtq1kY8=RW_7JPg@mail.gmail.com>
References: <FF9DB805FC41CC4E95825A50F68063021AA534B7@columbia.uhd.campus>,
	<CAPKp32v7mBNDoCE88BO5uMts+8Cm34L6wU_mtq1kY8=RW_7JPg@mail.gmail.com>
Message-ID: <FF9DB805FC41CC4E95825A50F68063021AA534EB@columbia.uhd.campus>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140725/cdd5299a/attachment.pl>

From frank.davenport at gmail.com  Fri Jul 25 21:16:06 2014
From: frank.davenport at gmail.com (Frank Davenport)
Date: Fri, 25 Jul 2014 12:16:06 -0700
Subject: [R-sig-Geo] raster::extract fails on brick but works on
 individual layers of brick
In-Reply-To: <CALuVVaanebwpnUqpbSMPEu5_vHwrS_eEXJHKby8HodgAykYF3g@mail.gmail.com>
References: <CAEVpnsEKcbasN=UThFCbdYusvk3EuJ1XV9iEYxGXZv9o1A6jNQ@mail.gmail.com>
	<CALuVVaanebwpnUqpbSMPEu5_vHwrS_eEXJHKby8HodgAykYF3g@mail.gmail.com>
Message-ID: <53D2ACF6.2080908@gmail.com>

Hi Lydon,

Thanks for the work around! I can use that for now, but it is still not 
clear to me why the extract/mean works on each individual layer but not 
on the brick. When I've used extract() on bricks in the past it will 
return a mean (or whatever function) value for each layer of the brick 
(but much faster than doing it individually).

In this case, since I can use extract(..,..,mean) on each individual 
layer without error, which led me to believe this may be a bug.

Regardless, I appreciate the help.

Thanks again,

F


On 7/23/14 10:07 AM, Lyndon Estes wrote:
> Hi Frank,
>
> I think the mean function is getting in the way, since if you want to
> extra the values for all cells each polygon overlaps, the outputs will
> first end up in a list.
>
> test1 <- extract(g, dsd, weights = TRUE, small = TRUE)
>
> Will get the cell values for each polygon from each layer in the
> brick, along with their weight (while allowing very small polygons to
> get their underlying cell values).
>
> I would then process the mean function on the list.
>
> v <- t(sapply(test1, function(x) apply(t(sapply(1:nrow(x), function(y)
> x[y, 1:10] * x[y, 11])), 2, sum)))  # matrix of annual values per
> polygon
>
> Hope this helps.
>
> Cheers, Lyndon
>
>
> On Wed, Jul 23, 2014 at 12:17 PM, Frank Davenport
> <frank.davenport at gmail.com> wrote:
>> Hello,
>>
>> I am using extract() to aggregate values from a raster to a polygon. The
>> raster is a brick object. Extract fails on the brick object but succeeds
>> when applied on each individual layer of the brick (via a for() loop). I
>> would use this as a work around but in my actual scenario the brick is much
>> bigger and the individual approach is too slow.
>>
>> The specific error message is: "Error in t(sapply(res, meanfunc)) :  error
>> in evaluating the argument 'x' in selecting a method for function 't':
>> Error in apply(x, 1, function(X) { : dim(X) must have a positive length"
>>
>> I believe this has something to do with the relative sizes of the polygons
>> (small) and the grid cells. I have successfully extracted this brick to
>> another shapefile that had much larger polygons. Likewise I can also do the
>> extraction if I resample the cells to a smaller resolution (not shown
>> below).
>>
>>
>> Finally the extract will work if I set 'na.rm=F' but then produces mostly
>> NA's, even though there are no NAs in the brick. I realize this might be
>> something to do with the dataType(). However that does not explain why
>> extract works on individual layers, but not the whole brick.
>>
>> Reproducible code is below and prettier example can be found here:
>> http://rpubs.com/frank_davenport/22698
>>
>> The data necessary to run the example can be found here:
>> https://dl.dropboxusercontent.com/u/9577903/99_raster_bugreport.Rdata
>>
>> Thank you for your help and apologies if a solution is already posted.
>>
>> Frank
>>
>>> rm(list=ls())
>>> library(raster)
>> Loading required package: sp
>>> ##-Download data from here:
>> https://dl.dropboxusercontent.com/u/9577903/99_raster_bugreport.Rdata
>>> ##contains 'dsd' a spatial polygons data.frame and 'g' a raster brick
>> with 10 layers
>>> load('~/Dropbox/Public/99_raster_bugreport.Rdata')
>>>
>>> dsd
>> class       : SpatialPolygonsDataFrame
>> features    : 36
>> extent      : 34.04665, 39.70319, -4.67742, 1.19921  (xmin, xmax, ymin,
>> ymax)
>> coord. ref. : +proj=longlat +a=6378249.145 +b=6356514.96582849 +no_defs
>> variables   : 4
>> names       : Province, District,         Division, uidu
>> min values  :  CENTRAL,  BUNGOMA, ABOTHUGUCHI WEST,    1
>> max values  :  WESTERN,   VIHIGA,            WINAM,   44
>>> g
>> class       : RasterBrick
>> dimensions  : 24, 20, 480, 10  (nrow, ncol, ncell, nlayers)
>> resolution  : 0.5, 0.5  (x, y)
>> extent      : 33, 43, -6, 6  (xmin, xmax, ymin, ymax)
>> coord. ref. : +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0
>> data source : in memory
>> names       : X1999.03.01, X1999.03.02, X1999.03.03, X1999.03.04,
>> X1999.03.05, X1999.03.06, X1999.03.07, X1999.03.08, X1999.03.09,
>> X1999.03.10
>> min values  :    22.47562,    22.44415,    22.25507,    22.23166,
>> 22.12387,    22.42477,    22.27802,    22.15134,    22.36218,    22.33447
>> max values  :    41.47818,    40.53116,    41.54944,    42.33093,
>> 41.67810,    40.79260,    41.83319,    40.83359,    41.12604,    42.00555
>>
>>> #---Show the data
>>> plot(g[[1]])
>>> plot(dsd,add=T)
>>>
>>> #--Try to extract, with weights yeilds an error
>>> test1<-extract(g,dsd,fun=mean,na.rm=T,weights=T)
>> Error in t(sapply(res, meanfunc)) :
>>    error in evaluating the argument 'x' in selecting a method for function
>> 't': Error in apply(x, 1, function(X) { : dim(X) must have a positive length
>>> #--Extract without weights--produces NA's for most polygons
>>> test2<-extract(g,dsd,fun=mean,na.m=T)
>>> head(test2)
>>       X1999.03.01 X1999.03.02 X1999.03.03 X1999.03.04 X1999.03.05
>> X1999.03.06 X1999.03.07 X1999.03.08 X1999.03.09 X1999.03.10
>> [1,]          NA          NA          NA          NA          NA
>> NA          NA          NA          NA          NA
>> [2,]          NA          NA          NA          NA          NA
>> NA          NA          NA          NA          NA
>> [3,]          NA          NA          NA          NA          NA
>> NA          NA          NA          NA          NA
>> [4,]          NA          NA          NA          NA          NA
>> NA          NA          NA          NA          NA
>> [5,]          NA          NA          NA          NA          NA
>> NA          NA          NA          NA          NA
>> [6,]          NA          NA          NA          NA          NA
>> NA          NA          NA          NA          NA
>>> summary(test2)
>>    X1999.03.01     X1999.03.02     X1999.03.03     X1999.03.04
>> X1999.03.05     X1999.03.06     X1999.03.07     X1999.03.08
>>   Min.   :24.47   Min.   :25.21   Min.   :24.67   Min.   :25.47   Min.
>> :27.42   Min.   :25.38   Min.   :25.93   Min.   :24.11
>>   1st Qu.:29.29   1st Qu.:30.99   1st Qu.:29.55   1st Qu.:30.83   1st
>> Qu.:31.58   1st Qu.:29.78   1st Qu.:29.51   1st Qu.:28.35
>>   Median :30.31   Median :33.63   Median :31.13   Median :31.88   Median
>> :33.32   Median :30.31   Median :30.52   Median :29.71
>>   Mean   :29.87   Mean   :32.75   Mean   :30.41   Mean   :31.78   Mean
>> :32.61   Mean   :29.71   Mean   :29.90   Mean   :29.19
>>   3rd Qu.:31.86   3rd Qu.:36.08   3rd Qu.:32.59   3rd Qu.:34.37   3rd
>> Qu.:34.73   3rd Qu.:30.60   3rd Qu.:31.32   3rd Qu.:30.82
>>   Max.   :32.81   Max.   :37.00   Max.   :33.45   Max.   :35.77   Max.
>> :35.42   Max.   :31.98   Max.   :31.69   Max.   :32.53
>>   NA's   :30      NA's   :30      NA's   :30      NA's   :30      NA's
>> :30      NA's   :30      NA's   :30      NA's   :30
>>    X1999.03.09     X1999.03.10
>>   Min.   :25.98   Min.   :25.53
>>   1st Qu.:29.53   1st Qu.:30.73
>>   Median :30.57   Median :31.06
>>   Mean   :30.12   Mean   :31.24
>>   3rd Qu.:31.41   3rd Qu.:33.52
>>   Max.   :32.75   Max.   :34.83
>>   NA's   :30      NA's   :30
>>> #--Extract each layer seperatley--works but is SLOW
>>> glist<-vector(mode='list',length=nlayers(g))
>>>
>>> for(i in 1:length(glist)){
>> +   glist[[i]]<-extract(g[[i]],dsd,fun=mean,na.rm=T,weigths=T)
>> + }
>>> sessionInfo()
>> R version 3.1.0 (2014-04-10)
>> Platform: x86_64-apple-darwin10.8.0 (64-bit)
>>
>> locale:
>> [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
>>
>> attached base packages:
>> [1] stats     graphics  grDevices utils     datasets  methods   base
>>
>> other attached packages:
>> [1] raster_2.2-31 sp_1.0-15
>>
>> loaded via a namespace (and not attached):
>> [1] grid_3.1.0      lattice_0.20-29 tools_3.1.0
>>          [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Frank Davenport, Ph.D
Climate Hazards Group
UCSB Geography


From frank.davenport at gmail.com  Fri Jul 25 21:40:17 2014
From: frank.davenport at gmail.com (Frank Davenport)
Date: Fri, 25 Jul 2014 12:40:17 -0700
Subject: [R-sig-Geo] raster::extract fails on brick but works on
 individual layers of brick
In-Reply-To: <CALuVVaanebwpnUqpbSMPEu5_vHwrS_eEXJHKby8HodgAykYF3g@mail.gmail.com>
References: <CAEVpnsEKcbasN=UThFCbdYusvk3EuJ1XV9iEYxGXZv9o1A6jNQ@mail.gmail.com>
	<CALuVVaanebwpnUqpbSMPEu5_vHwrS_eEXJHKby8HodgAykYF3g@mail.gmail.com>
Message-ID: <53D2B2A1.6080402@gmail.com>

Sorry for the mutliple postings but I found another solution using 
raster::disaggregate(). Essentially the same as resample but prerserves 
all the cell values. The fundamental issue was the small size of the 
polygons compared to the cells (which can be problematic when using 
weights()).

See the discussion here: 
https://stackoverflow.com/questions/17766989/extract-data-from-raster-with-small-polygons-rounded-weights-too-small


g2<-raster::disaggregate(g,10)
test1<-extract(g2,dsd,fun=mean,na.rm=T,weights=T,small=T)
On 7/23/14 10:07 AM, Lyndon Estes wrote:
> Hi Frank,
>
> I think the mean function is getting in the way, since if you want to
> extra the values for all cells each polygon overlaps, the outputs will
> first end up in a list.
>
> test1 <- extract(g, dsd, weights = TRUE, small = TRUE)
>
> Will get the cell values for each polygon from each layer in the
> brick, along with their weight (while allowing very small polygons to
> get their underlying cell values).
>
> I would then process the mean function on the list.
>
> v <- t(sapply(test1, function(x) apply(t(sapply(1:nrow(x), function(y)
> x[y, 1:10] * x[y, 11])), 2, sum)))  # matrix of annual values per
> polygon
>
> Hope this helps.
>
> Cheers, Lyndon
>
>
> On Wed, Jul 23, 2014 at 12:17 PM, Frank Davenport
> <frank.davenport at gmail.com> wrote:
>> Hello,
>>
>> I am using extract() to aggregate values from a raster to a polygon. The
>> raster is a brick object. Extract fails on the brick object but succeeds
>> when applied on each individual layer of the brick (via a for() loop). I
>> would use this as a work around but in my actual scenario the brick is much
>> bigger and the individual approach is too slow.
>>
>> The specific error message is: "Error in t(sapply(res, meanfunc)) :  error
>> in evaluating the argument 'x' in selecting a method for function 't':
>> Error in apply(x, 1, function(X) { : dim(X) must have a positive length"
>>
>> I believe this has something to do with the relative sizes of the polygons
>> (small) and the grid cells. I have successfully extracted this brick to
>> another shapefile that had much larger polygons. Likewise I can also do the
>> extraction if I resample the cells to a smaller resolution (not shown
>> below).
>>
>>
>> Finally the extract will work if I set 'na.rm=F' but then produces mostly
>> NA's, even though there are no NAs in the brick. I realize this might be
>> something to do with the dataType(). However that does not explain why
>> extract works on individual layers, but not the whole brick.
>>
>> Reproducible code is below and prettier example can be found here:
>> http://rpubs.com/frank_davenport/22698
>>
>> The data necessary to run the example can be found here:
>> https://dl.dropboxusercontent.com/u/9577903/99_raster_bugreport.Rdata
>>
>> Thank you for your help and apologies if a solution is already posted.
>>
>> Frank
>>
>>> rm(list=ls())
>>> library(raster)
>> Loading required package: sp
>>> ##-Download data from here:
>> https://dl.dropboxusercontent.com/u/9577903/99_raster_bugreport.Rdata
>>> ##contains 'dsd' a spatial polygons data.frame and 'g' a raster brick
>> with 10 layers
>>> load('~/Dropbox/Public/99_raster_bugreport.Rdata')
>>>
>>> dsd
>> class       : SpatialPolygonsDataFrame
>> features    : 36
>> extent      : 34.04665, 39.70319, -4.67742, 1.19921  (xmin, xmax, ymin,
>> ymax)
>> coord. ref. : +proj=longlat +a=6378249.145 +b=6356514.96582849 +no_defs
>> variables   : 4
>> names       : Province, District,         Division, uidu
>> min values  :  CENTRAL,  BUNGOMA, ABOTHUGUCHI WEST,    1
>> max values  :  WESTERN,   VIHIGA,            WINAM,   44
>>> g
>> class       : RasterBrick
>> dimensions  : 24, 20, 480, 10  (nrow, ncol, ncell, nlayers)
>> resolution  : 0.5, 0.5  (x, y)
>> extent      : 33, 43, -6, 6  (xmin, xmax, ymin, ymax)
>> coord. ref. : +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0
>> data source : in memory
>> names       : X1999.03.01, X1999.03.02, X1999.03.03, X1999.03.04,
>> X1999.03.05, X1999.03.06, X1999.03.07, X1999.03.08, X1999.03.09,
>> X1999.03.10
>> min values  :    22.47562,    22.44415,    22.25507,    22.23166,
>> 22.12387,    22.42477,    22.27802,    22.15134,    22.36218,    22.33447
>> max values  :    41.47818,    40.53116,    41.54944,    42.33093,
>> 41.67810,    40.79260,    41.83319,    40.83359,    41.12604,    42.00555
>>
>>> #---Show the data
>>> plot(g[[1]])
>>> plot(dsd,add=T)
>>>
>>> #--Try to extract, with weights yeilds an error
>>> test1<-extract(g,dsd,fun=mean,na.rm=T,weights=T)
>> Error in t(sapply(res, meanfunc)) :
>>    error in evaluating the argument 'x' in selecting a method for function
>> 't': Error in apply(x, 1, function(X) { : dim(X) must have a positive length
>>> #--Extract without weights--produces NA's for most polygons
>>> test2<-extract(g,dsd,fun=mean,na.m=T)
>>> head(test2)
>>       X1999.03.01 X1999.03.02 X1999.03.03 X1999.03.04 X1999.03.05
>> X1999.03.06 X1999.03.07 X1999.03.08 X1999.03.09 X1999.03.10
>> [1,]          NA          NA          NA          NA          NA
>> NA          NA          NA          NA          NA
>> [2,]          NA          NA          NA          NA          NA
>> NA          NA          NA          NA          NA
>> [3,]          NA          NA          NA          NA          NA
>> NA          NA          NA          NA          NA
>> [4,]          NA          NA          NA          NA          NA
>> NA          NA          NA          NA          NA
>> [5,]          NA          NA          NA          NA          NA
>> NA          NA          NA          NA          NA
>> [6,]          NA          NA          NA          NA          NA
>> NA          NA          NA          NA          NA
>>> summary(test2)
>>    X1999.03.01     X1999.03.02     X1999.03.03     X1999.03.04
>> X1999.03.05     X1999.03.06     X1999.03.07     X1999.03.08
>>   Min.   :24.47   Min.   :25.21   Min.   :24.67   Min.   :25.47   Min.
>> :27.42   Min.   :25.38   Min.   :25.93   Min.   :24.11
>>   1st Qu.:29.29   1st Qu.:30.99   1st Qu.:29.55   1st Qu.:30.83   1st
>> Qu.:31.58   1st Qu.:29.78   1st Qu.:29.51   1st Qu.:28.35
>>   Median :30.31   Median :33.63   Median :31.13   Median :31.88   Median
>> :33.32   Median :30.31   Median :30.52   Median :29.71
>>   Mean   :29.87   Mean   :32.75   Mean   :30.41   Mean   :31.78   Mean
>> :32.61   Mean   :29.71   Mean   :29.90   Mean   :29.19
>>   3rd Qu.:31.86   3rd Qu.:36.08   3rd Qu.:32.59   3rd Qu.:34.37   3rd
>> Qu.:34.73   3rd Qu.:30.60   3rd Qu.:31.32   3rd Qu.:30.82
>>   Max.   :32.81   Max.   :37.00   Max.   :33.45   Max.   :35.77   Max.
>> :35.42   Max.   :31.98   Max.   :31.69   Max.   :32.53
>>   NA's   :30      NA's   :30      NA's   :30      NA's   :30      NA's
>> :30      NA's   :30      NA's   :30      NA's   :30
>>    X1999.03.09     X1999.03.10
>>   Min.   :25.98   Min.   :25.53
>>   1st Qu.:29.53   1st Qu.:30.73
>>   Median :30.57   Median :31.06
>>   Mean   :30.12   Mean   :31.24
>>   3rd Qu.:31.41   3rd Qu.:33.52
>>   Max.   :32.75   Max.   :34.83
>>   NA's   :30      NA's   :30
>>> #--Extract each layer seperatley--works but is SLOW
>>> glist<-vector(mode='list',length=nlayers(g))
>>>
>>> for(i in 1:length(glist)){
>> +   glist[[i]]<-extract(g[[i]],dsd,fun=mean,na.rm=T,weigths=T)
>> + }
>>> sessionInfo()
>> R version 3.1.0 (2014-04-10)
>> Platform: x86_64-apple-darwin10.8.0 (64-bit)
>>
>> locale:
>> [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
>>
>> attached base packages:
>> [1] stats     graphics  grDevices utils     datasets  methods   base
>>
>> other attached packages:
>> [1] raster_2.2-31 sp_1.0-15
>>
>> loaded via a namespace (and not attached):
>> [1] grid_3.1.0      lattice_0.20-29 tools_3.1.0
>>          [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Frank Davenport, Ph.D
Climate Hazards Group
UCSB Geography


From mdsumner at gmail.com  Fri Jul 25 23:22:02 2014
From: mdsumner at gmail.com (Michael Sumner)
Date: Sat, 26 Jul 2014 07:22:02 +1000
Subject: [R-sig-Geo] raster plotting question
In-Reply-To: <FF9DB805FC41CC4E95825A50F68063021AA5237A@columbia.uhd.campus>
References: <FF9DB805FC41CC4E95825A50F68063021AA5237A@columbia.uhd.campus>
Message-ID: <CAAcGz99TgRFp8c9YQzPzPB2wUwiye0mxUZDJ0RfFhGR1yU6WtA@mail.gmail.com>

Use the breaks and cols arguments to (the raster methods for) plot.
See ?raster::plot

This is like the way the ?base::image function operates essentially
you give it one less colour than break (though raster is less fussy):

library(raster)
r <- raster(volcano)
brks <- pretty(cellStats(r, range))
col <- heat.colors(length(brks) - 1)

plot(brick(r, r/1.2), col = col, breaks = brks)

Note that this forces the ticks for the legend, so you can't really
give many more breaks without also creating an ugly legend:

lbrks <- seq(cellStats(r, min), cellStats(r, max), length = 48)
lcol <- heat.colors(length(lbrks) - 1)

plot(brick(r, r/1.2), col = lcol, breaks = lbrks)

You can use the legend and "legend.only" arguments to raster's plot to
turn off default legend painting, but then you are back to controlling
each plot panel too:

op <- par(mfrow = c(1, 2))
plot(r, col = lcol, breaks = lbrks, legend = FALSE)
plot(r, col = col, breaks = brks, legend.only = TRUE)
plot(r/1.2, col = lcol, breaks = lbrks, legend = FALSE)
plot(r, col = col, breaks = brks, legend.only = TRUE)
par(op)

HTH


On Sat, Jul 26, 2014 at 2:36 AM, Hodgess, Erin <HodgessE at uhd.edu> wrote:
> Hello R-Sig-Geo People!
>
>
>
> I have a quick question, please:
>
>
>
> I have two raster layer objects, a and b.
>
>
>
> I want to plot them on one page.  No problem.
>
>
>
>> par(mfrow=c(1,2))
>
>> plot(a)
>
>> plot(b)
>
>
>
> But I would like to use the same colors for each.  How can I do that, please?
>
>
>
> Thanks,
>
> Erin
>
>
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



-- 
Michael Sumner
Software and Database Engineer
Australian Antarctic Division
Hobart, Australia
e-mail: mdsumner at gmail.com


From sanctavega at gmail.com  Sat Jul 26 12:20:13 2014
From: sanctavega at gmail.com (Sancta Vega)
Date: Sat, 26 Jul 2014 10:20:13 +0000
Subject: [R-sig-Geo] Isohyetes with R
Message-ID: <CAHy2=VJdOXrppVzYi7pzGt8p0Pc2wBiEpTmWFNb1yGyXEgXa7w@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140726/623a3f28/attachment.pl>

From roman.lustrik at gmail.com  Sat Jul 26 12:51:43 2014
From: roman.lustrik at gmail.com (=?UTF-8?Q?Roman_Lu=C5=A1trik?=)
Date: Sat, 26 Jul 2014 12:51:43 +0200
Subject: [R-sig-Geo] Isohyetes with R
In-Reply-To: <CAHy2=VJdOXrppVzYi7pzGt8p0Pc2wBiEpTmWFNb1yGyXEgXa7w@mail.gmail.com>
References: <CAHy2=VJdOXrppVzYi7pzGt8p0Pc2wBiEpTmWFNb1yGyXEgXa7w@mail.gmail.com>
Message-ID: <CAHT1vpjQq5qKJbveM6sKnKmvMPSnK93L=H+6Q49j2-CLCH_tHw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140726/7353616e/attachment.pl>

From micha at arava.co.il  Sat Jul 26 16:43:59 2014
From: micha at arava.co.il (Micha Silver)
Date: Sat, 26 Jul 2014 17:43:59 +0300
Subject: [R-sig-Geo] Isohyetes with R
In-Reply-To: <CAHy2=VJdOXrppVzYi7pzGt8p0Pc2wBiEpTmWFNb1yGyXEgXa7w@mail.gmail.com>
References: <CAHy2=VJdOXrppVzYi7pzGt8p0Pc2wBiEpTmWFNb1yGyXEgXa7w@mail.gmail.com>
Message-ID: <53D3BEAF.7030306@arava.co.il>

Perhaps have a look at:
http://www.surfaces.co.il/geostatistics-and-rainfall-with-r/
  It might be of some help to you.

On 07/26/2014 01:20 PM, Sancta Vega wrote:
> Someone can help me. I want to plot isohyete map of my country using R.
> I need any idea.
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> This mail was received via Mail-SeCure System.
>
>


From abdoulayesar at gmail.com  Sat Jul 26 17:16:29 2014
From: abdoulayesar at gmail.com (Abdoulaye Sarr)
Date: Sat, 26 Jul 2014 15:16:29 +0000
Subject: [R-sig-Geo] space time error message
Message-ID: <CAN=6O0Lf4uWoVZtkwmHbF4KaXV-otHkva9aUJUVZgKRmJ1D-pg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140726/a270bd54/attachment.pl>

From abdoulayesar at gmail.com  Sat Jul 26 20:29:07 2014
From: abdoulayesar at gmail.com (Abdoulaye SARR)
Date: Sat, 26 Jul 2014 18:29:07 +0000
Subject: [R-sig-Geo] space time error message
Message-ID: <91BE0E35-083C-4206-A032-DDBDF13893E4@gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140726/04b131b7/attachment.pl>

From Roger.Bivand at nhh.no  Sun Jul 27 15:17:21 2014
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sun, 27 Jul 2014 15:17:21 +0200
Subject: [R-sig-Geo] Spatial Regression with two Weights matrix (SAR)
In-Reply-To: <AD0050057515F54084E7D5B93478C8481FC6620691@winxbede39.exchange.xchg>
References: <AD0050057515F54084E7D5B93478C8481FC6620691@winxbede39.exchange.xchg>
Message-ID: <alpine.LRH.2.03.1407271505500.26815@reclus.nhh.no>

On Fri, 25 Jul 2014, Linus Holtermann wrote:

> Hello,
>
> is there a R function that could estimate the following spatial regression:
>
> y = rho_1*W1*y + rho_2*W2*y + XB + e
>
> W1 and W2 are not identical, of course.

No, not least because the mutual constraints on \rho_* are unknown. Too 
little is known about (I - (\sum{i=1}{k}\rho_i W_i)) in the literature as 
far as I am aware. It may seem attractive to see W_i as bands of 
increasing distances, or graph steps, but these models actually work 
through (I - \rho W)^{-1}, which includes all higher order 
relationships implicitly. The same lack of knowledge about constraints 
applies to the SEM error case:

y = X\beta + u, u = \sum{i=1}{k}(\rho_i W_i u) + e

but this is more like the case of a collection of variogram models.

In the SAR (lag), you also face the problem of finding the impacts, as the 
\beta values should not be interpreted directly, as the reduced form is:

y = (I - (\sum{i=1}{k}\rho_i W_i))^{-1} (X\beta + e)

and the \rho's and \beta interact.

Contributions welcome,

Roger

>
> Bests,
>
>
> Linus Holtermann
> Hamburgisches WeltWirtschaftsInstitut gemeinn?tzige GmbH (HWWI)
> Heimhuder Stra?e 71
> 20148 Hamburg
> Tel +49-(0)40-340576-336
> Fax+49-(0)40-340576-776
> Internet: www.hwwi.org
> Email: holtermann at hwwi.org
>
> AmtsgerichtHamburg HRB 94303
> Gesch?ftsf?hrer: Prof. Dr. Thomas Straubhaar, Gunnar Geyer
> Umsatzsteuer-ID: DE 241849425
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no

From kridox at ymail.com  Mon Jul 28 05:49:28 2014
From: kridox at ymail.com (Pascal Oettli)
Date: Mon, 28 Jul 2014 12:49:28 +0900
Subject: [R-sig-Geo] raster plotting question
In-Reply-To: <FF9DB805FC41CC4E95825A50F68063021AA5237A@columbia.uhd.campus>
References: <FF9DB805FC41CC4E95825A50F68063021AA5237A@columbia.uhd.campus>
Message-ID: <CAAcyNCwC53kmZ5F2P0HboFQziMwUYLPoTm_zwUUSAWYTGzPg4g@mail.gmail.com>

Hi Erin,

You can stack "a" and "b" together then use the "rasterVis" package to
plot the Raster* object.

Best,
Pascal

On Sat, Jul 26, 2014 at 1:36 AM, Hodgess, Erin <HodgessE at uhd.edu> wrote:
> Hello R-Sig-Geo People!
>
>
>
> I have a quick question, please:
>
>
>
> I have two raster layer objects, a and b.
>
>
>
> I want to plot them on one page.  No problem.
>
>
>
>> par(mfrow=c(1,2))
>
>> plot(a)
>
>> plot(b)
>
>
>
> But I would like to use the same colors for each.  How can I do that, please?
>
>
>
> Thanks,
>
> Erin
>
>
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



-- 
Pascal Oettli
Project Scientist
JAMSTEC
Yokohama, Japan


From hengl at spatial-analyst.net  Mon Jul 28 13:07:47 2014
From: hengl at spatial-analyst.net (Tomislav Hengl)
Date: Mon, 28 Jul 2014 13:07:47 +0200
Subject: [R-sig-Geo] Special issue: Spatial and spatio-temporal models for
 interpolating climatic and meteorological data
Message-ID: <53D62F03.2060808@spatial-analyst.net>


Dear R-sig-geo,

This is to inform you that the submissions for the special issue on 
"Spatial and spatio-temporal models for interpolating climatic and 
meteorological data" (based on the http://dailymeteo.org/2014 
conference) are now open.

Spatial Statistics (SPASTA): 
http://www.journals.elsevier.com/spatial-statistics/
Special issue title: Spatial and spatio-temporal models for 
interpolating climatic and meteorological data
Guest editor(s): Dr. Tomislav Hengl, Dr. Edzer Pebesma, Dr. Robert J Hijmans

Submissions open: 1st of July 2014
Submissions close: 15th of October 2014
Acceptance deadline (closing of the special issue): 1st of March 2015

If you plan to submit a paper for this special issue (and have not 
participated in the conference), please reply to this e-mail with a 
working title / 300 words abstract, and why you think this paper should 
be included in the special issue.

Submission guidelines:

1. Download the Elsevier article template (e.g. LaTeX template from 
http://www.elsevier.com/author-schemas/latex-instructions);
2. Study the themes of interest 
(http://dailymeteo.org/2014#toc-themes-9HSRW43W);
3. This special issue is about methods for interpolating climatic and 
meteo data, but also about using Open Source software to achieve this. 
Consider using a combination of R and/or Python and LaTeX code to 
produce papers that include both formulas and code snippets.
4. Once you have managed to compile a PDF of your article for 
peer-review, visit the SPASTA editorial system at 
http://ees.elsevier.com/spasta/default.asp, register a new author 
account (if required) and then login and upload your article.
5. During the article submission, you need to select the right article 
type "SI:Dailymeteo.org/2014" when you reach the "article type" step in 
the submission process, so that their papers will be routed together for 
the special issue into the right channel, not get mixed with other SI 
papers, or regular papers in the system.

cheers,

Tomislav Hengl (ISRIC ? World Soil Information)


From gab.cozzi at gmail.com  Mon Jul 28 15:56:27 2014
From: gab.cozzi at gmail.com (Gabriele Cozzi)
Date: Mon, 28 Jul 2014 15:56:27 +0200
Subject: [R-sig-Geo] distance between raster cell centroids and spatial
	points
Message-ID: <CADr8yXCUN4ezhyRt_NUCUokEJYNFwu-CpEgoQNOBQrmJOYi0gg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140728/63201ae7/attachment.pl>

From josh.london at noaa.gov  Mon Jul 28 18:37:02 2014
From: josh.london at noaa.gov (Josh London)
Date: Mon, 28 Jul 2014 09:37:02 -0700
Subject: [R-sig-Geo] GeoJSON errors when reading/writing with rgdal
In-Reply-To: <CA+wRd=U55=TyrfsiqK4U23gwbY_zS2mkg8EhBfa7-gupO9je2Q@mail.gmail.com>
References: <CA+wRd=U55=TyrfsiqK4U23gwbY_zS2mkg8EhBfa7-gupO9je2Q@mail.gmail.com>
Message-ID: <CA+wRd=U=KaOjDt0xSRXpNG7HpEU7fsaLVjPV4T=UYgS6D1bbLQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140728/d65a83bc/attachment.pl>

From gangwism at informatik.uni-freiburg.de  Mon Jul 28 18:44:20 2014
From: gangwism at informatik.uni-freiburg.de (Marcel Gangwisch)
Date: Mon, 28 Jul 2014 18:44:20 +0200
Subject: [R-sig-Geo] Plot Raster an Shape in one Plot with two different
	scales
Message-ID: <53D67DE4.9040204@informatik.uni-freiburg.de>

Hi *,

I want to plot a rasterfile and a shapefile in one plot with two map 
legends.
One scale for my shapes filling the polygon respectively to an attribute.
And one scale for my underlying raster filling the raster respectively 
to the grayscale.

I've already tried it with ggplot2, but I think it's not possible to get 
2 different map legends?

Maybe you have an idea, how to solve my problem.
Or maybe I should make it with QGIS.. but I think the maps made with R, 
look fancier.

Best regards,
Marcel


From ferra.xu at yahoo.com  Mon Jul 28 20:26:07 2014
From: ferra.xu at yahoo.com (Ferra Xu)
Date: Mon, 28 Jul 2014 11:26:07 -0700
Subject: [R-sig-Geo] rgl.postscript doesn't show the colors correctly
Message-ID: <1406571967.48645.YahooMailNeo@web125106.mail.ne1.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140728/07c7f64e/attachment.pl>

From Roger.Bivand at nhh.no  Mon Jul 28 20:52:54 2014
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 28 Jul 2014 20:52:54 +0200
Subject: [R-sig-Geo] GeoJSON errors when reading/writing with rgdal
In-Reply-To: <CA+wRd=U=KaOjDt0xSRXpNG7HpEU7fsaLVjPV4T=UYgS6D1bbLQ@mail.gmail.com>
References: <CA+wRd=U55=TyrfsiqK4U23gwbY_zS2mkg8EhBfa7-gupO9je2Q@mail.gmail.com>
	<CA+wRd=U=KaOjDt0xSRXpNG7HpEU7fsaLVjPV4T=UYgS6D1bbLQ@mail.gmail.com>
Message-ID: <alpine.LRH.2.03.1407282032230.32714@reclus.nhh.no>

Without access to your system, it is very difficult to advise. However, 
the behaviour of this driver under Linux and GDAL 1.11.0 is:

library(rgdal)
library(maptools)
nc <- readShapePoly(system.file("shapes/sids.shp",
  package="maptools")[1], proj4string=CRS("+proj=longlat +datum=NAD27"))
td <- tempdir()
writeOGR(nc, paste(td, '.geojson', sep="/"), 'nc', driver='GeoJSON')
list.files(td, all.files=TRUE)
ogrListLayers(paste(td, ".geojson", sep="/"))
ogrInfo(paste(td, ".geojson", sep="/"), "OGRGeoJSON")
writeOGR(nc, paste(td, 'ncGeoJson', sep="/"), 'nc', driver='GeoJSON')
ogrListLayers(paste(td, "ncGeoJson", sep="/"))
ogrInfo(paste(td, "ncGeoJson", sep="/"), "OGRGeoJSON")

that is that the dsn is an arbitrary file name (may have a leading or 
trailing dot, but no dot anywhere else). The layer is always "OGRGeoJSON" 
on arrival irrespective of the given layer name - this from:

http://www.gdal.org/drv_geojson.html

"A GeoJSON datasource is translated to single OGRLayer object with 
pre-defined name OGRGeoJSON"

Hope this helps,

Roger


On Mon, 28 Jul 2014, Josh London wrote:

> As a followup to this, I downgraded to GDAL 1.10.1 (released 2013/08/26)
> and I still get a file creation error, although instead of 'GDAL Error 3:
> Cannot open file', I get 'Creation of output file failed'.
>
> as before, ogr2ogr, still works as expected when reading/writing GeoJSON
> files.
>
> I also realized I was clear in my previous post that I am running OS X
> 10.9.4
>
> cheers
> Josh
>
>
> On Fri, Jul 25, 2014 at 9:17 AM, Josh London <josh.london at noaa.gov> wrote:
>
>> Hello
>>
>> I am trying to track down the source of an error that has crept up on me
>> in the last 3-4 months. I was suspicious the issues was related to the
>> release of GDAL 1.11 in April, but it has taken me a while to confirm.
>>
>> Essentially, any time use readOGR(), writeOGR() or ogrInfo() on a GeoJSON
>> file, I get 'GDAL Error 3: Cannot open file'.
>>
>> The following code reliably reproduces the error for me:
>>
>>> library(rgdal)
>>>
>>> library(maptools)
>>> nc <-
>> readShapePoly(system.file("shapes/sids.shp",package="maptools")[1],
>> proj4string=CRS("+proj=longlat +datum=NAD27"))
>>>
>>> writeOGR(nc, 'nc.geojson','nc', driver='GeoJSON')
>>
>> I confirmed the "GeoJSON" drivers are installed and available with
>>
>>> "GeoJSON" %in% ogrDrivers()$name
>>> [1] TRUE
>>
>> and, I also confirmed that ogr2ogr can read/write GeoJSON outside of R, so
>> the issue seems to only impact rgdal.
>>
>> My GDAL libraries are all built from Homebrew and then rgdal is built from
>> source against these libraries. I have the following versions:
>>
>>> rgdal: version: 0.8-16, (SVN revision 498)
>>> GDAL 1.11.0, released 2014/04/16
>>> Path to GDAL shared files: /usr/local/Cellar/gdal/1.11.0/share/gdal
>>> PROJ.4 runtime: Rel. 4.8.0, 6 March 2012, [PJ_VERSION: 480]
>>> Path to PROJ.4 shared files: (autodetected)
>>
>> As a final test, I installed rgdal via
>>
>>> install.packages("rgdal",type="mac.binary")
>>
>> With this version of the rgdal library, the code above works successfully.
>> The 'mac.binary' library appears to install with GDAL 1.9.2. So, I suspect
>> the issue is related to GDAL 1.11. I am fairly certain the code worked
>> without issue with GDAL 1.10, but I haven't had a chance to confirm this.
>>
>> A search for issues related to GeoJSON, GDAL and rgdal has not turned up
>> any useful clues, so I am suspicious the issue may be isolated to my
>> machine/setup. That said, a colleague with a similar setup is able to
>> reproduce the issues.
>>
>> Any assistance or guidance troubleshooting and resolving this issue would
>> be appreciated.
>>
>> cheers
>> josh
>>
>>> sessionInfo()
>>> R version 3.1.1 (2014-07-10)
>>> Platform: x86_64-apple-darwin13.1.0 (64-bit)
>>>
>>> locale:
>>> [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
>>>
>>> attached base packages:
>>> [1] stats     graphics  grDevices utils     datasets  methods   base
>>>
>>> other attached packages:
>>> [1] maptools_0.8-30 rgdal_0.8-16    sp_1.0-15
>>>
>>> loaded via a namespace (and not attached):
>>> [1] foreign_0.8-61  grid_3.1.1      lattice_0.20-29 tools_3.1.1
>>
>> --
>> *Josh M. London, PhD Wildlife BiologistPolar Ecosystems ProgramAFSC
>> National Marine Mammal LaboratoryNOAA Fisheries, Seattle, Washington*
>>
>
>
>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no


From HodgessE at uhd.edu  Mon Jul 28 22:22:26 2014
From: HodgessE at uhd.edu (Hodgess, Erin)
Date: Mon, 28 Jul 2014 20:22:26 +0000
Subject: [R-sig-Geo] how to change the fit.method from autoKrige, please
Message-ID: <FF9DB805FC41CC4E95825A50F68063021AA564A2@columbia.uhd.campus>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140728/9b46c02b/attachment.pl>

From albert.physik at gmail.com  Tue Jul 29 08:21:39 2014
From: albert.physik at gmail.com (A. Robles R.)
Date: Tue, 29 Jul 2014 01:21:39 -0500
Subject: [R-sig-Geo] Help me please
Message-ID: <CAEmkAg7ZRvGfMTTck6zdu-iEh-cOTCCQ818-HO5um+ow=fjujw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140729/1c6e068d/attachment.pl>

From albert.physik at gmail.com  Tue Jul 29 08:46:51 2014
From: albert.physik at gmail.com (A. Robles R.)
Date: Tue, 29 Jul 2014 01:46:51 -0500
Subject: [R-sig-Geo] Help me please
In-Reply-To: <CAEmkAg7ZRvGfMTTck6zdu-iEh-cOTCCQ818-HO5um+ow=fjujw@mail.gmail.com>
References: <CAEmkAg7ZRvGfMTTck6zdu-iEh-cOTCCQ818-HO5um+ow=fjujw@mail.gmail.com>
Message-ID: <CAEmkAg5BJeb09XFZaTZuPAGi_wKJ=_4fZBqLEdO6JKK0F_FC6Q@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140729/6f0184b4/attachment.pl>

From jon.skoien at jrc.ec.europa.eu  Tue Jul 29 09:06:31 2014
From: jon.skoien at jrc.ec.europa.eu (Jon Skoien)
Date: Tue, 29 Jul 2014 09:06:31 +0200
Subject: [R-sig-Geo] how to change the fit.method from autoKrige, please
In-Reply-To: <FF9DB805FC41CC4E95825A50F68063021AA564A2@columbia.uhd.campus>
References: <FF9DB805FC41CC4E95825A50F68063021AA564A2@columbia.uhd.campus>
Message-ID: <53D747F7.3040709@jrc.ec.europa.eu>

It seems you cannot change the fit.method from autoKrige or 
autofitVariogram, it uses the default from gstat::fit.variogram, which 
is method 7.
However, you should probably first try to see why you get the error and 
what is zero. I assume that your error is that you have zero distances 
semivariances, do you have a lot of duplicated locations? Is this 
necessary for your case to keep these, can you delete them, or can you 
add some noise to the coordinates with jitter?

Best wishes,
Jon


On 7/28/2014 10:22 PM, Hodgess, Erin wrote:
> Hello!
>
>
>
> I'm using the autoKrige function on a data set and keep getting an error that fit.method 7 has zero semivariances.
>
>
>
> How do I change the fit.method from within autoKrige, please?
>
>
>
> I've tried using it both inside and outside of miscFitOptions, but no luck yet.
>
>
>
> Any suggestions would be much appreciated.
>
>
>
> Sincerely,
>
> Erin
>
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From frtog at vestas.com  Tue Jul 29 09:15:14 2014
From: frtog at vestas.com (=?iso-8859-1?Q?Frede_Aakmann_T=F8gersen?=)
Date: Tue, 29 Jul 2014 09:15:14 +0200
Subject: [R-sig-Geo] Help me please
In-Reply-To: <CAEmkAg5BJeb09XFZaTZuPAGi_wKJ=_4fZBqLEdO6JKK0F_FC6Q@mail.gmail.com>
References: <CAEmkAg7ZRvGfMTTck6zdu-iEh-cOTCCQ818-HO5um+ow=fjujw@mail.gmail.com>
	<CAEmkAg5BJeb09XFZaTZuPAGi_wKJ=_4fZBqLEdO6JKK0F_FC6Q@mail.gmail.com>
Message-ID: <B078CDF40DFE4045AF172A8B4F68FC4857C71C6FD2@DKRDSEXC016.vestas.net>

Hi

It seems that you need to set an environment variable used by programs in ~/MRT/bin. I don't have this installed so please have a look for some README files in ~/MRT or other places to find which value the variable are supposed to have.

In R before calling reprojectHDF() do a:

Sys.setenv(MRT_DATA_DIR  = "to_some_value, probably: ~/MRT/data or something like that")

Hope that helps.

Yours sincerely / Med venlig hilsen


Frede Aakmann T?gersen
Specialist, M.Sc., Ph.D.
Plant Performance & Modeling

Technology & Service Solutions
T +45 9730 5135
M +45 2547 6050
frtog at vestas.com
http://www.vestas.com

Company reg. name: Vestas Wind Systems A/S
This e-mail is subject to our e-mail disclaimer statement.
Please refer to www.vestas.com/legal/notice
If you have received this e-mail in error please contact the sender. 

> -----Original Message-----
> From: r-sig-geo-bounces at r-project.org [mailto:r-sig-geo-bounces at r-
> project.org] On Behalf Of A. Robles R.
> Sent: 29. juli 2014 08:47
> To: r-sig-geo at r-project.org
> Subject: Re: [R-sig-Geo] Help me please
> 
> I change the input syntax:
> input<-list.files(path=".",".hdf",all.files=T,recursive=T)
> 
> and now my error is:
> 
> >
> reprojectHDF(hdfName=input,filename=outname,MRTpath="~/MRT/bin",+
> resample_type="NEAREST_NEIGHBOR",+
> proj_type="GEO",datum='WGS84')*******************************
> ***********************************************
> 
> MODIS Reprojection Tool (v4.1 March 2009)
> Start Time:  Tue Jul 29 01:37:37 2014
> 
> ------------------------------------------------------------------
> 
> Warning: gctp_call : Environmental Variable Not Found
>      : MRT_DATA_DIR nor MRTDATADIR not defined
> Error: GetInputGeoCorner : General Processing
>      : Error converting input projection coordinates to lat/long coordinates.
> Fatal Error, Terminating...
> [1] FALSE
> 
> 
> 
> 2014-07-29 1:21 GMT-05:00 A. Robles R. <albert.physik at gmail.com>:
> 
> > I have the following problem:
> > I am using the reprojectHDF() function (http://r-
> gis.net/?q=ModisDownload
> > <http://l.facebook.com/l.php?u=http%3A%2F%2Fr-
> gis.net%2F%3Fq%3DModisDownload&h=1AQFfebGn&enc=AZM5YrD9AkE2y
> 7Rnk6mbbkY0ZyXJ74Tw0ErhgFhwX0uZ9ComxS8l0Ap5a9oxWLUibJyzZ40-
> fdx0TejlaLCeB4gT47JF_ly2QHY7Z4SEuRHrCWaGxIiU9PL9jUOLCbQYnPYuwNCi
> Vop4xVvlVN0HNeZj&s=1>
> > )
> > ####
> > source('ModisDownload.R')
> > library(raster)
> > library(RCurl)
> > path<-"~/R/MODIS/Data/Test"
> > input<-list.files(path,"*.hdf",all.files=T,recursive=T,full.names=T)
> > input
> > outname<-paste(substr(input[1],40,45),".tif",sep='')
> > outname
> > reprojectHDF(hdfName=input,filename=outname,MRTpath="~/MRT/bin",
> > resample_type="NEAREST_NEIGHBOR",
> > proj_type="GEO",datum='WGS84')
> > ####
> > but I find the following problem.
> > ####
> > >
> reprojectHDF(hdfName=input,filename=outname,MRTpath="~/MRT/bin",
> > + resample_type="NEAREST_NEIGHBOR",
> > + proj_type="GEO",datum='WGS84')
> >
> >
> **********************************************************
> ********************
> > MODIS Reprojection Tool (v4.1 March 2009)
> > Start Time: Tue Jul 29 00:57:18 2014
> > ------------------------------------------------------------------
> > Error: ReadHDFHeader : Opening Input Header File
> > : Unable to open
> >
> /home/rral/R/MODIS/Data/Test//home/rral/R/MODIS/Data/Test/MOD13Q1
> .A2000065.h09v08.005.2008238073751.hdf
> > Fatal Error, Terminating...
> > [1] FALSE
> > ####
> > All suggestions are welcome
> > ####
> > PD: my variables are:
> > > input
> > [1]
> >
> "/home/rral/R/MODIS/Data/Test/MOD13Q1.A2000065.h09v08.005.20082380
> 73751.hdf"
> > [2]
> >
> "/home/rral/R/MODIS/Data/Test/MOD13Q1.A2000065.h09v09.005.20082380
> 81536.hdf"
> > [3]
> >
> "/home/rral/R/MODIS/Data/Test/MOD13Q1.A2000065.h10v08.005.20082380
> 53313.hdf"
> > [4]
> >
> "/home/rral/R/MODIS/Data/Test/MOD13Q1.A2000065.h10v09.005.20082380
> 61408.hdf"
> > and
> > > outname
> > [1] "2000065.tif
> >
> > --
> > *Atte:*   *A. Robles R.*
> >
> 
> 
> 
> --
> *Atte:*   *A. Robles R.*
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From markpayneatwork at gmail.com  Tue Jul 29 11:43:44 2014
From: markpayneatwork at gmail.com (Mark Payne)
Date: Tue, 29 Jul 2014 11:43:44 +0200
Subject: [R-sig-Geo] raster - 4D Bricks
Message-ID: <CAGBzUO9GunwRVUe_2zMaVQn0LT02wH=JCkknS-N7fAo3vsLOhw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140729/f6092097/attachment.pl>

From tim.appelhans at gmail.com  Tue Jul 29 12:34:25 2014
From: tim.appelhans at gmail.com (Tim Appelhans)
Date: Tue, 29 Jul 2014 12:34:25 +0200
Subject: [R-sig-Geo] Special issue: Spatial and spatio-temporal models
 for interpolating climatic and meteorological data
In-Reply-To: <53D62F03.2060808@spatial-analyst.net>
References: <53D62F03.2060808@spatial-analyst.net>
Message-ID: <53D778B1.9030609@gmail.com>

Dear R-sig-geo,

is anyone interested in working together on a submission for the below 
mentioned special issue of SPASTA?

The situation is as follows:
We have about 3.5 yrs worth of temperature and humidity data from Mt. 
Kilimanjaro at hourly resolution. In addition we have numerous landscape 
data derived from a high-resolution DEM (30m) plus NDVI images at the 
same spatial resolution.

So far, we have conducted a (though not in the strict sense) 
spatio-temporal interpolation study on a monthly basis for the above 
mentioned data focussing on machine learning / data mining algorithms. 
As a reference we also used ordinary kriging (through the 'automap' 
package). The results of this exercise look quite promising (see link 
below for a figure showing the RMSE of predictions - observations for 
250 repeated random subsampling runs). There are 6 machine learning 
algorithms that perform significantly better than our reference kriging 
runs.

https://www.dropbox.com/s/rlvvxxbr355hi44/ML_results_temperature_monthly.pdf

Here's the caveat:
The kriging done for this exercise can hardly be considered optimal. We 
simply used the autoKrige function.

Therfore, I would like to find one (or more) person(s) with profound 
knowledge of 'classical' spatio-temporal interpolation methods to 
provide an exhaustive comparison of the most promising machine learning 
algorithms and optimised classical approaches (e.g. various kriging 
flavours, IDW, GWR etc).

So, if anyone from this list might be interested, please write me and 
I'll be happy to provide more detailed information on both the results 
of the presented figure as well as the intended comparison study for the 
special issue (or another journal - this merely seems a very appropriate 
opportunity to come forward).

Regards,
Tim



On 07/28/2014 01:07 PM, Tomislav Hengl wrote:
>
> Dear R-sig-geo,
>
> This is to inform you that the submissions for the special issue on 
> "Spatial and spatio-temporal models for interpolating climatic and 
> meteorological data" (based on the http://dailymeteo.org/2014 
> conference) are now open.
>
> Spatial Statistics (SPASTA): 
> http://www.journals.elsevier.com/spatial-statistics/
> Special issue title: Spatial and spatio-temporal models for 
> interpolating climatic and meteorological data
> Guest editor(s): Dr. Tomislav Hengl, Dr. Edzer Pebesma, Dr. Robert J 
> Hijmans
>
> Submissions open: 1st of July 2014
> Submissions close: 15th of October 2014
> Acceptance deadline (closing of the special issue): 1st of March 2015
>
> If you plan to submit a paper for this special issue (and have not 
> participated in the conference), please reply to this e-mail with a 
> working title / 300 words abstract, and why you think this paper 
> should be included in the special issue.
>
> Submission guidelines:
>
> 1. Download the Elsevier article template (e.g. LaTeX template from 
> http://www.elsevier.com/author-schemas/latex-instructions);
> 2. Study the themes of interest 
> (http://dailymeteo.org/2014#toc-themes-9HSRW43W);
> 3. This special issue is about methods for interpolating climatic and 
> meteo data, but also about using Open Source software to achieve this. 
> Consider using a combination of R and/or Python and LaTeX code to 
> produce papers that include both formulas and code snippets.
> 4. Once you have managed to compile a PDF of your article for 
> peer-review, visit the SPASTA editorial system at 
> http://ees.elsevier.com/spasta/default.asp, register a new author 
> account (if required) and then login and upload your article.
> 5. During the article submission, you need to select the right article 
> type "SI:Dailymeteo.org/2014" when you reach the "article type" step 
> in the submission process, so that their papers will be routed 
> together for the special issue into the right channel, not get mixed 
> with other SI papers, or regular papers in the system.
>
> cheers,
>
> Tomislav Hengl (ISRIC ? World Soil Information)
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
#####################################
Tim Appelhans
Department of Geography
Environmental Informatics
Philipps Universit?t Marburg
Deutschhausstra?e 12
35032 Marburg (Paketpost: 35037 Marburg)
Germany

Tel +49 (0) 6421 28-25957

http://environmentalinformatics-marburg.de/


From HodgessE at uhd.edu  Tue Jul 29 12:58:18 2014
From: HodgessE at uhd.edu (Hodgess, Erin)
Date: Tue, 29 Jul 2014 10:58:18 +0000
Subject: [R-sig-Geo] how to change the fit.method from autoKrige, please
In-Reply-To: <53D747F7.3040709@jrc.ec.europa.eu>
References: <FF9DB805FC41CC4E95825A50F68063021AA564A2@columbia.uhd.campus>,
	<53D747F7.3040709@jrc.ec.europa.eu>
Message-ID: <FF9DB805FC41CC4E95825A50F68063021AA568C6@columbia.uhd.campus>

Great....thanks so much!

Sincerely,
Erin

________________________________________
From: Jon Skoien [jon.skoien at jrc.ec.europa.eu]
Sent: Tuesday, July 29, 2014 2:06 AM
To: Hodgess, Erin; r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] how to change the fit.method from autoKrige, please

It seems you cannot change the fit.method from autoKrige or
autofitVariogram, it uses the default from gstat::fit.variogram, which
is method 7.
However, you should probably first try to see why you get the error and
what is zero. I assume that your error is that you have zero distances
semivariances, do you have a lot of duplicated locations? Is this
necessary for your case to keep these, can you delete them, or can you
add some noise to the coordinates with jitter?

Best wishes,
Jon


On 7/28/2014 10:22 PM, Hodgess, Erin wrote:
> Hello!
>
>
>
> I'm using the autoKrige function on a data set and keep getting an error that fit.method 7 has zero semivariances.
>
>
>
> How do I change the fit.method from within autoKrige, please?
>
>
>
> I've tried using it both inside and outside of miscFitOptions, but no luck yet.
>
>
>
> Any suggestions would be much appreciated.
>
>
>
> Sincerely,
>
> Erin
>
>
>
>       [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



From mdsumner at gmail.com  Tue Jul 29 13:24:45 2014
From: mdsumner at gmail.com (Michael Sumner)
Date: Tue, 29 Jul 2014 21:24:45 +1000
Subject: [R-sig-Geo] raster - 4D Bricks
In-Reply-To: <CAGBzUO9GunwRVUe_2zMaVQn0LT02wH=JCkknS-N7fAo3vsLOhw@mail.gmail.com>
References: <CAGBzUO9GunwRVUe_2zMaVQn0LT02wH=JCkknS-N7fAo3vsLOhw@mail.gmail.com>
Message-ID: <CAAcGz9_Uo8Qh7quyvKMQta-=dHnUEe5kjKUXjy0dFQ2pWEyBiQ@mail.gmail.com>

Are you sure that your "b" is still really a RasterBrick? That message
comes if you give the functions character:

library(raster)
dropLayer("sometext", 1)
Error in (function (classes, fdef, mtable)  :
  unable to find an inherited method for function ?dropLayer? for
signature ?"character"?

(Basically because the functions are all generics, they scans through
available methods and tells you it can't find one for "character").

It works for me, see contrived example below that I had on hand due to
obscure testing many years ago.
(There is warning related to subsetting a linked-4D file, but that
seems harmless).

But, also try selecting only the bands you want at read time (or even
just use a stack), so

b <- brick("/blah/blah/ncep_07c_tho_all_1948-2010.mon.nc", level = 3,
band = 1:5)

Cheers, Mike.

## create a 4D NetCDF file in R
## load NetCDF package
library(RNetCDF)
## generate 4D data - 1:N
dims <- c(2, 3, 2, 2)
a <- array(data = 1:prod(dims), dim = dims)

## create NetCDF file
nc <- create.nc("test-1.nc")
## coordinate values for NetCDF (to test transform and band metadata)
x <- seq(0, 5, length = dim(a)[1])
y <- seq(0, 2, length = dim(a)[2])
c3 <- seq(0, 1, length = dim(a)[3])
c4 <- seq(0, 1, length = dim(a)[4])

## dimensions
dim.def.nc(nc, "x", length(x))
dim.def.nc(nc, "y", length(y))
dim.def.nc(nc, "c3", length(c3))
dim.def.nc(nc, "c4", length(c4))

## variables
var.def.nc(nc, "a", "NC_DOUBLE", c(0, 1, 2, 3))
var.def.nc(nc, "x", "NC_DOUBLE", 0)
var.def.nc(nc, "y", "NC_DOUBLE", 1)
var.def.nc(nc, "c3", "NC_DOUBLE", 2)
var.def.nc(nc, "c4", "NC_DOUBLE", 3)
## write the data (all at once, no start/count)
var.put.nc(nc, "a", a)
var.put.nc(nc, "x", x)
var.put.nc(nc, "y", y)
var.put.nc(nc, "c3", c3)
var.put.nc(nc, "c4", c4)
## finish up
close.nc(nc)

library(raster)
b <- brick("test-1.nc", level = 2)
nlevels(b)
dropLayer(b, 1)
class       : RasterLayer
band        : 2  (of  2  bands)
dimensions  : 3, 2, 6  (nrow, ncol, ncell)
resolution  : 5, 1  (x, y)
extent      : -2.5, 7.5, -0.5, 2.5  (xmin, xmax, ymin, ymax)
coord. ref. : NA
data source : C:\temp\test-1.nc
names       : X1
z-value     : 1
zvar        : a
level       : 1

Warning message:
In .rasterObjectFromCDF(x, type = objecttype, band = band, ...) :
  "level" set to 1 (there are 2 levels)


On Tue, Jul 29, 2014 at 7:43 PM, Mark Payne <markpayneatwork at gmail.com> wrote:
> Hi,
>
> I have a 4D climate model output that I am trying to work with via raster,
> and that is unfortunately giving problems. I create the object as a brick:
>
>> b
> class       : RasterBrick
> dimensions  : 220, 254, 55880, 756  (nrow, ncol, ncell, nlayers)
> resolution  : 1, 1  (x, y)
> extent      : 0.5, 254.5, 0.5, 220.5  (xmin, xmax, ymin, ymax)
> coord. ref. : +proj=longlat +datum=WGS84
> data source : /home/mpayne/Documents/NACLIM/
> ncep_07c_tho_all_1948-2010.mon.nc
> names       : X19480131, X19480229, X19480331, X19480430, X19480531,
> X19480630, X19480731, X19480831, X19480930, X19481031, X19481130,
> X19481231, X19490131, X19490228, X19490331, ...
> z-value     : 19480131, 20101231 (min, max)
> varname     : var2
> level       : 3
>
> But I would like to drop a lot of the layers, so I try:
>
>> dropLayer(b,1:5)
> Error in (function (classes, fdef, mtable)  :
>   unable to find an inherited method for function ?extent? for signature
> ?"character"?
>>
>
> And get a rather strange error.... Trying subset instead:
>
>> subset(b,1:5)
> Error in (function (classes, fdef, mtable)  :
>   unable to find an inherited method for function ?extent? for signature
> ?"character"?
>>
> Gives the same error. I'm assuming that this is related to the 4D nature of
> the data, as I can't reproduce it elsewise, e.g. using the examples... Any
> ideas?
>
> Best wishes,
>
> Mark
>
>         [[alternative HTML version deleted]]
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



-- 
Michael Sumner
Software and Database Engineer
Australian Antarctic Division
Hobart, Australia
e-mail: mdsumner at gmail.com


From mauriziomarchi85 at gmail.com  Tue Jul 29 17:48:58 2014
From: mauriziomarchi85 at gmail.com (Maurizio Marchi)
Date: Tue, 29 Jul 2014 17:48:58 +0200
Subject: [R-sig-Geo] GAM: which package?
Message-ID: <CANJhsN0UQXP1nfqSxpHQZtH2NwCj8-0CBtTbVCh+b4rjtmypew@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140729/c3f8b0c4/attachment.pl>

From raptorbio at hotmail.com  Tue Jul 29 18:09:38 2014
From: raptorbio at hotmail.com (adamsmith)
Date: Tue, 29 Jul 2014 09:09:38 -0700 (PDT)
Subject: [R-sig-Geo] Classical or robust variogram to model temporal
	autocorrelation?
Message-ID: <1406650178138-7586831.post@n2.nabble.com>

Hello list,

I'm modeling counts of organisms over time at eleven locations.  I'd like to
account for temporal autocorrelation in the counts (assuming it's present),
which I'm exploring (and fitting) using gstat's variogram function on the
residuals of a generalized linear model not incorporating any kind of
correlation structure.  

As the example below illustrates, I'm finding that the classical variogram
estimator looks quite different from the robust (Cressie) estimator. 
Furthermore, a fit of most variogram models to the classic variogram
produces singularity errors (with good reason based on the variogram plot)
while a decent exponential model (e.g.) can be fitted to the robust
variogram.  Unfortunately, it seems as though nlme:::lme (which I'm using
for the generalized model) only uses the classical variogram when fitting
correlation structures.

Thus, my questions:

(1) Is the use of the robust estimator for constructing the correlation
structure justified in this case?  
(2) If so, is it appropriate to fit the the robust variogram model in, e.g.,
gstat, and then specify/fix the correlation structure in the lme fit?

Thanks very much for considering,

Adam Smith
Dept. Natural Resources Science
University of Rhode Island

# Code to recreate example

# Download data
datURL <- "https://www.dropbox.com/s/54q9ocwztt3swap/rsiggeo_variogram.csv"
dat <- repmis::source_data(datURL, sep = ",", header = TRUE)

# Convert to appropriate class
# Y coordinates are arbitrarily assigned values for each of
# 11 sites (count locations; assumed independent); Y coords
# were assigned such that each site is separated from others 
# by more than the cutoff distance used in variogram construction
coordinates(dat) <- ~x+y

# Classic variogram model with example exponential fit
varClassic <- variogram(resid ~ 1, dat, cutoff = 180, width = 180/25)
# Note singularity error; starting values determine 'fit'
expClassic <- fit.variogram(varClassic, model = vgm(1, "Exp", 1, 0))
plot(varClassic, expClassic)

# Robust (Cressie) variogram model with example exponential fit
varCressie <- variogram(resid ~ 1, dat, cutoff = 180, width = 180/25,
cressie=TRUE)
expCressie <- fit.variogram(varCressie, model = vgm(0.3, "Exp", 50, 0.1))
plot(varCressie, expCressie)





--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Classical-or-robust-variogram-to-model-temporal-autocorrelation-tp7586831.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From HodgessE at uhd.edu  Tue Jul 29 18:56:46 2014
From: HodgessE at uhd.edu (Hodgess, Erin)
Date: Tue, 29 Jul 2014 16:56:46 +0000
Subject: [R-sig-Geo] question about autoKrige anis1 and anis2
Message-ID: <FF9DB805FC41CC4E95825A50F68063021AA56A5B@columbia.uhd.campus>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140729/b5a7ac04/attachment.pl>

From Henk.Sierdsema at sovon.nl  Tue Jul 29 22:14:49 2014
From: Henk.Sierdsema at sovon.nl (Henk Sierdsema)
Date: Tue, 29 Jul 2014 20:14:49 +0000
Subject: [R-sig-Geo] GAM: which package?
In-Reply-To: <CANJhsN0UQXP1nfqSxpHQZtH2NwCj8-0CBtTbVCh+b4rjtmypew@mail.gmail.com>
References: <CANJhsN0UQXP1nfqSxpHQZtH2NwCj8-0CBtTbVCh+b4rjtmypew@mail.gmail.com>
Message-ID: <BC87E34B7CBD41498BE3598ABBE4E6970A16CE37@SOVON6.SOVON.local>

Hi Maurizio,

If your main interest is distribution modelling I would skip the GAM's and their inherent problems with overfitting, covariates with high correlations, etc. and use something like Random Forests or Generalized Boosting Models/Boosted Regression Trees. They have proven to be superior to GLM's and GAM's for species distribution modelling, but don't suffer from overfitting and can easily deal with large numbers of covariates, even when these are correlated. Both are described in dismo. For Random Forests you can also use BIOMOD.

Success,

Henk Sierdsema

Sovon Vogelonderzoek Nederland / Sovon Dutch Centre for Field Ornithology

www.sovon.nl
P.O. Box 6521
NL-6503 GA Nijmegen
+31-247410445
The Netherlands

________________________________________
Van: r-sig-geo-bounces at r-project.org [r-sig-geo-bounces at r-project.org] namens Maurizio Marchi [mauriziomarchi85 at gmail.com]
Verzonden: dinsdag 29 juli 2014 17:48
Aan: R-mailing list
Onderwerp: [R-sig-Geo] GAM: which package?

Hi everybody,
I would like to try to work with generalized Additive Models to interpolate
some climatic data and to build a Species Distribution Model. The aim is to
check performances comparing them with works made by my colleague.
I was wondering:
Which R package is the most complete?

here (http://cran.r-project.org/web/packages/dismo/vignettes/sdm.pdf)
"mgcv" is suggested even if "gam" package seems the "pure" GAM.

many thanks,

--
Maurizio Marchi, Ph.D. student
Florence, Italy
ID skype: maurizioxyz
Ubuntu 14.04 LTS
linux user 552742

        [[alternative HTML version deleted]]

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From Alexander.Herr at csiro.au  Wed Jul 30 05:39:44 2014
From: Alexander.Herr at csiro.au (Herry)
Date: Tue, 29 Jul 2014 20:39:44 -0700 (PDT)
Subject: [R-sig-Geo] plotting raster returns error about NA
Message-ID: <1406691584510-7586834.post@n2.nabble.com>

Hi List,

surely others have come across this and the solution is probably simple - I
cannot find it online anywhere. I am trying to plot a gtiff raster (produced
in grass 6.4.2, lzw compression)

image(rs) works fine but when trying to use plot I get the following error
message:
Error in .readCellsGDAL(x, uniquecells, layers) : 
  NAs are not allowed in subscripted assignments
In addition: Warning message:
In .readCells(x, cells, 1) : NAs introduced by coercion

What am I doing wrong?

thanks and cheers
Herry



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/plotting-raster-returns-error-about-NA-tp7586834.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From markpayneatwork at gmail.com  Wed Jul 30 09:45:37 2014
From: markpayneatwork at gmail.com (Mark Payne)
Date: Wed, 30 Jul 2014 09:45:37 +0200
Subject: [R-sig-Geo] raster - 4D Bricks
In-Reply-To: <CAAcGz9_Uo8Qh7quyvKMQta-=dHnUEe5kjKUXjy0dFQ2pWEyBiQ@mail.gmail.com>
References: <CAGBzUO9GunwRVUe_2zMaVQn0LT02wH=JCkknS-N7fAo3vsLOhw@mail.gmail.com>
	<CAAcGz9_Uo8Qh7quyvKMQta-=dHnUEe5kjKUXjy0dFQ2pWEyBiQ@mail.gmail.com>
Message-ID: <CAGBzUO-70X42FiCmZgS-r6RH54fyOMz=6WGfVOfg69vfzp7Kng@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140730/154b0d68/attachment.pl>

From mdsumner at gmail.com  Wed Jul 30 10:13:08 2014
From: mdsumner at gmail.com (Michael Sumner)
Date: Wed, 30 Jul 2014 18:13:08 +1000
Subject: [R-sig-Geo] raster - 4D Bricks
In-Reply-To: <CAGBzUO-70X42FiCmZgS-r6RH54fyOMz=6WGfVOfg69vfzp7Kng@mail.gmail.com>
References: <CAGBzUO9GunwRVUe_2zMaVQn0LT02wH=JCkknS-N7fAo3vsLOhw@mail.gmail.com>
	<CAAcGz9_Uo8Qh7quyvKMQta-=dHnUEe5kjKUXjy0dFQ2pWEyBiQ@mail.gmail.com>
	<CAGBzUO-70X42FiCmZgS-r6RH54fyOMz=6WGfVOfg69vfzp7Kng@mail.gmail.com>
Message-ID: <CAAcGz990Lp-GhXM6woNbG06T0UCCw2tMsqBMS+iJg1mQw57h6Q@mail.gmail.com>

Hello,

Thanks for clarifying, I get that problem too.  If I get a chance I'll
have a closer look, but otherwise here's my notes for now.

Note that conversion to stack allows it to work:
library(raster)
Loading required package: sp
b <- brick('http://www.esrl.noaa.gov/psd/thredds/dodsC/Datasets/godas/pottmp.2013.nc',
lvar=3, level=1, varname='pottmp')
dropLayer(stack(b), 1:2)

I presume you are getting this url read via the ncdf4 package? (And
not via the GDAL DODS driver, for example).

I get the same problem with subset() where i is longer than 1
(dropLayer is a wrapper around subset). Below is my subset traceback
and session info.

Cheers, Mike.

subset(x, 1:2)
Error in (function (classes, fdef, mtable)  :
  unable to find an inherited method for function ?extent? for
signature ?"character"?
In addition: Warning message:
In .stackCDF(x, varname = varname, bands = bands) :
  pottmp has 4 dimensions, I am using the last one
> traceback()
8: stop(gettextf("unable to find an inherited method for function %s
for signature %s",
       sQuote(fdef at generic), sQuote(cnames)), domain = NA)
7: (function (classes, fdef, mtable)
   {
       methods <- .findInheritedMethods(classes, fdef, mtable)
       if (length(methods) == 1L)
           return(methods[[1L]])
       else if (length(methods) == 0L) {
           cnames <- paste0("\"", sapply(classes, as.character),
               "\"", collapse = ", ")
           stop(gettextf("unable to find an inherited method for
function %s for signature %s",
               sQuote(fdef at generic), sQuote(cnames)), domain = NA)
       }
       else stop("Internal error in finding inherited methods; didn't
return a unique method",
           domain = NA)
   })(list("character"), function (x, ...)
   standardGeneric("extent"), <environment>)
6: extent(x)
5: setExtent(x, value)
4: `extent<-`(`*tmp*`, value = <S4 object of class "Extent">)
3: .local(x, ...)
2: subset(x, 1:2)
1: subset(x, 1:2)

sessionInfo()
R version 3.1.0 (2014-04-10)
Platform: x86_64-redhat-linux-gnu (64-bit)

locale:
[1] C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] ncdf4_1.12    raster_2.2-31 sp_1.0-15

loaded via a namespace (and not attached):
[1] grid_3.1.0      lattice_0.20-29 tools_3.1.0






On Wed, Jul 30, 2014 at 5:45 PM, Mark Payne <markpayneatwork at gmail.com> wrote:
> No, apparently it is still a brick:
>
>> class(b)
> [1] "RasterBrick"
> attr(,"package")
> [1] "raster"
>
>
> Here is a minimum (not)-working example, based on this post, which seems to
> be having similar problems:
> http://r-sig-geo.2731867.n2.nabble.com/Subset-a-Raster-object-read-from-a-4D-NetCDF-file-td7586200.html
>
> Example follows:
>> library(raster)
> Loading required package: sp
>> b <-
>> brick('http://www.esrl.noaa.gov/psd/thredds/dodsC/Datasets/godas/pottmp.2013.nc',
>> lvar=3, level=1, varname='pottmp')
>> b
> class       : RasterBrick
> dimensions  : 418, 360, 150480, 12  (nrow, ncol, ncell, nlayers)
> resolution  : 1, 0.3333309  (x, y)
> extent      : 0, 360, -74.66667, 64.66567  (xmin, xmax, ymin, ymax)
> coord. ref. : +proj=longlat +datum=WGS84
> data source :
> http://www.esrl.noaa.gov/psd/thredds/dodsC/Datasets/godas/pottmp.2013.nc
> names       : X2013.01.01, X2013.02.01, X2013.03.01, X2013.04.01,
> X2013.05.01, X2013.06.01, X2013.07.01, X2013.08.01, X2013.09.01,
> X2013.10.01, X2013.11.01, X2013.12.01
> Date        : 2013-01-01, 2013-02-01, 2013-03-01, 2013-04-01, 2013-05-01,
> 2013-06-01, 2013-07-01, 2013-08-01, 2013-09-01, 2013-10-01, 2013-11-01,
> 2013-12-01
> varname     : pottmp
> level       : 1
>
>> dropLayer(b,1)
>
> Error in (function (classes, fdef, mtable)  :
>   unable to find an inherited method for function ?extent? for signature
> ?"character"?
> In addition: Warning message:
> In .stackCDF(x, varname = varname, bands = bands) :
>   pottmp has 4 dimensions, I am using the last one
>>
>
>
>
> On 29 July 2014 13:24, Michael Sumner <mdsumner at gmail.com> wrote:
>>
>> Are you sure that your "b" is still really a RasterBrick? That message
>> comes if you give the functions character:
>>
>> library(raster)
>> dropLayer("sometext", 1)
>> Error in (function (classes, fdef, mtable)  :
>>   unable to find an inherited method for function ?dropLayer? for
>> signature ?"character"?
>>
>> (Basically because the functions are all generics, they scans through
>> available methods and tells you it can't find one for "character").
>>
>> It works for me, see contrived example below that I had on hand due to
>> obscure testing many years ago.
>> (There is warning related to subsetting a linked-4D file, but that
>> seems harmless).
>>
>> But, also try selecting only the bands you want at read time (or even
>> just use a stack), so
>>
>> b <- brick("/blah/blah/ncep_07c_tho_all_1948-2010.mon.nc", level = 3,
>> band = 1:5)
>>
>> Cheers, Mike.
>>
>> ## create a 4D NetCDF file in R
>> ## load NetCDF package
>> library(RNetCDF)
>> ## generate 4D data - 1:N
>> dims <- c(2, 3, 2, 2)
>> a <- array(data = 1:prod(dims), dim = dims)
>>
>> ## create NetCDF file
>> nc <- create.nc("test-1.nc")
>> ## coordinate values for NetCDF (to test transform and band metadata)
>> x <- seq(0, 5, length = dim(a)[1])
>> y <- seq(0, 2, length = dim(a)[2])
>> c3 <- seq(0, 1, length = dim(a)[3])
>> c4 <- seq(0, 1, length = dim(a)[4])
>>
>> ## dimensions
>> dim.def.nc(nc, "x", length(x))
>> dim.def.nc(nc, "y", length(y))
>> dim.def.nc(nc, "c3", length(c3))
>> dim.def.nc(nc, "c4", length(c4))
>>
>> ## variables
>> var.def.nc(nc, "a", "NC_DOUBLE", c(0, 1, 2, 3))
>> var.def.nc(nc, "x", "NC_DOUBLE", 0)
>> var.def.nc(nc, "y", "NC_DOUBLE", 1)
>> var.def.nc(nc, "c3", "NC_DOUBLE", 2)
>> var.def.nc(nc, "c4", "NC_DOUBLE", 3)
>> ## write the data (all at once, no start/count)
>> var.put.nc(nc, "a", a)
>> var.put.nc(nc, "x", x)
>> var.put.nc(nc, "y", y)
>> var.put.nc(nc, "c3", c3)
>> var.put.nc(nc, "c4", c4)
>> ## finish up
>> close.nc(nc)
>>
>> library(raster)
>> b <- brick("test-1.nc", level = 2)
>> nlevels(b)
>> dropLayer(b, 1)
>> class       : RasterLayer
>> band        : 2  (of  2  bands)
>> dimensions  : 3, 2, 6  (nrow, ncol, ncell)
>> resolution  : 5, 1  (x, y)
>> extent      : -2.5, 7.5, -0.5, 2.5  (xmin, xmax, ymin, ymax)
>> coord. ref. : NA
>> data source : C:\temp\test-1.nc
>> names       : X1
>> z-value     : 1
>> zvar        : a
>> level       : 1
>>
>> Warning message:
>> In .rasterObjectFromCDF(x, type = objecttype, band = band, ...) :
>>   "level" set to 1 (there are 2 levels)
>>
>>
>> On Tue, Jul 29, 2014 at 7:43 PM, Mark Payne <markpayneatwork at gmail.com>
>> wrote:
>> > Hi,
>> >
>> > I have a 4D climate model output that I am trying to work with via
>> > raster,
>> > and that is unfortunately giving problems. I create the object as a
>> > brick:
>> >
>> >> b
>> > class       : RasterBrick
>> > dimensions  : 220, 254, 55880, 756  (nrow, ncol, ncell, nlayers)
>> > resolution  : 1, 1  (x, y)
>> > extent      : 0.5, 254.5, 0.5, 220.5  (xmin, xmax, ymin, ymax)
>> > coord. ref. : +proj=longlat +datum=WGS84
>> > data source : /home/mpayne/Documents/NACLIM/
>> > ncep_07c_tho_all_1948-2010.mon.nc
>> > names       : X19480131, X19480229, X19480331, X19480430, X19480531,
>> > X19480630, X19480731, X19480831, X19480930, X19481031, X19481130,
>> > X19481231, X19490131, X19490228, X19490331, ...
>> > z-value     : 19480131, 20101231 (min, max)
>> > varname     : var2
>> > level       : 3
>> >
>> > But I would like to drop a lot of the layers, so I try:
>> >
>> >> dropLayer(b,1:5)
>> > Error in (function (classes, fdef, mtable)  :
>> >   unable to find an inherited method for function ?extent? for signature
>> > ?"character"?
>> >>
>> >
>> > And get a rather strange error.... Trying subset instead:
>> >
>> >> subset(b,1:5)
>> > Error in (function (classes, fdef, mtable)  :
>> >   unable to find an inherited method for function ?extent? for signature
>> > ?"character"?
>> >>
>> > Gives the same error. I'm assuming that this is related to the 4D nature
>> > of
>> > the data, as I can't reproduce it elsewise, e.g. using the examples...
>> > Any
>> > ideas?
>> >
>> > Best wishes,
>> >
>> > Mark
>> >
>> >         [[alternative HTML version deleted]]
>> >
>> >
>> > _______________________________________________
>> > R-sig-Geo mailing list
>> > R-sig-Geo at r-project.org
>> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> >
>>
>>
>>
>> --
>> Michael Sumner
>> Software and Database Engineer
>> Australian Antarctic Division
>> Hobart, Australia
>> e-mail: mdsumner at gmail.com
>
>



-- 
Michael Sumner
Software and Database Engineer
Australian Antarctic Division
Hobart, Australia
e-mail: mdsumner at gmail.com


From paolo.piras at uniroma3.it  Wed Jul 30 13:00:00 2014
From: paolo.piras at uniroma3.it (Paolo Piras)
Date: Wed, 30 Jul 2014 11:00:00 +0000
Subject: [R-sig-Geo] spatial data 3D bivariate distributions
In-Reply-To: <CAAcGz9_wOvs12jKGfZGfdMNpxVVgj0WH=wyJXqGSAHQnQd=1iQ@mail.gmail.com>
References: <vhhfft2qouxhtwv854ak6vob.1404832348824@email.android.com>
	<000001cf9b43$307cc0b0$91764210$@lri-lb.org>
	<CAAcGz98NKuTvMEt=jtzF7B-JKHy6gThpxxnvXnb=pCJUS9u-mA@mail.gmail.com>
	<001b01cf9b5c$79f6aee0$6de40ca0$@lri-lb.org>
	<CAAcGz9-CcECGeBV_hDV2KLfTfknKQfW5vAFBxFv=zxW8veNhKg@mail.gmail.com>
	<008a01cf9b73$7599c5f0$60cd51d0$@lri-lb.org>
	<B078CDF40DFE4045AF172A8B4F68FC4857C6855533@DKRDSEXC016.vestas.net>
	<alpine.LRH.2.03.1407091918390.6706@reclus.nhh.no>,
	<CAAcGz9_wOvs12jKGfZGfdMNpxVVgj0WH=wyJXqGSAHQnQd=1iQ@mail.gmail.com>
Message-ID: <1406718081959.34096@uniroma3.it>


Hi folks,
I'm trying to modify an R code for plotting x,y spatial data in 3D  bivariate distribution using R;
I modified a code from here:
http://stackoverflow.com/questions/19949435/3d-plot-of-bivariate-distribution-using-r-or-matlab

 I would like to obtain the same results coming from the code suggested by r2evans user but with distributions separated by groups, possibly with semi-transparent color. I have problems in:

1) plotting the histograms on y axis; I just cannot "translate" the procedure for x in the y axis
2) putting all histograms perfectly superimposed and not shifted one from each other

here below the modified r2evans's code with a stand alone reprodicible example.
thanks in advance for your suggestions
best
paolo



library(rgl)
bvn<-matrix(rnorm(900,0,0.1),ncol=3)
group<-factor(rep(1:3,each=100))
xmaxlist<-NULL
ymaxlist<-NULL
zmaxlist<-NULL
hxlist<-NULL
hxslist<-NULL
hylist<-NULL
hyslist<-NULL

for(i in 1: nlevels(group)){
  hxi<- hist(bvn[,2][as.numeric(group)==i], plot=FALSE)
  hxsi <- hxi$density / sum(hxi$density)
  hyi <- hist(bvn[,1][as.numeric(group)==i], plot=FALSE)
  hysi <- hyi$density / sum(hyi$density)
  
  ## [xy]max: so that there's no overlap in the adjoining corner
  xmaxi <- tail(hxi$breaks, n=1) + diff(tail(hxi$breaks, n=2))
  ymaxi <- tail(hyi$breaks, n=1) + diff(tail(hyi$breaks, n=2))
  zmaxi <- max(hxsi, hysi)
  
  hxlist<-c(hxlist,list(hxi))
  hxslist<-c(hxslist,list(hxsi))
  hylist<-c(hylist,list(hyi))
  hyslist<-c(hyslist,list(hysi))
  xmaxlist<-c(xmaxlist,list(xmaxi))
  ymaxlist<-c(ymaxlist,list(ymaxi))
  zmaxlist<-c(zmaxlist,list(zmaxi))
}
for(i in 1:length(zmaxlist)){
  
  for (ii in seq_along(hxlist[[i]]$counts)) {
    quads3d(hxlist[[i]]$breaks[ii]*c(.9,.9,.1,.1) + hxlist[[i]]$breaks[ii+1]*c(.1,.1,.9,.9),
            rep(ymaxlist[[i]], 4),
            hxslist[[i]][ii]*c(0,1,1,0), color=i,alpha=0.5,add=T)
  }
  
}

plot3d(bvn[,2], bvn[,1], 0, zlim=c(0, max(unlist(zmaxlist))), radius=0.02,axes=FALSE,col=as.numeric(group),type="s",add=T)


From leighton at hydrofocus.com  Wed Jul 30 21:18:33 2014
From: leighton at hydrofocus.com (Dave Leighton)
Date: Wed, 30 Jul 2014 12:18:33 -0700
Subject: [R-sig-Geo] Copulas and spatial modeling
Message-ID: <CAGGwnOBhJHcpzPwgwfSgv44mNVfxRDrqN=b2q4-ERBd6pEN06w@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140730/2c6ca93e/attachment.pl>

From sam_l_cruickshank at hotmail.com  Thu Jul 31 14:32:13 2014
From: sam_l_cruickshank at hotmail.com (HallS)
Date: Thu, 31 Jul 2014 05:32:13 -0700 (PDT)
Subject: [R-sig-Geo] Merging shapefiles and csv
Message-ID: <1406809933918-7586839.post@n2.nabble.com>

Hi all,

I'm struggling to know how this will come across as my data is confidential.

Basically I have a shapefile (.shp) and a csv file while contain the same
regions (i.e.) a column which has the same information.  Using this link:
https://sites.google.com/site/eospansite/alobotips/spatial_r_tips/rshp_xls
I managed to get quite far but once I got to the writeOGR command, I get the
error
 Error in writeOGR(RSANHS, dsn = "C:/Users/Laptop/Documents/Rworkspace/",  : 
  number of objects mismatch

shape1 at data <- merge(shape1 at data,csv,by.x="RSA", 
+                           by.y="RSA", all.x=T, sort=F)
> 
> ###Checking it
> dim(shape at data)
[1] 1745    2
> dim(shape1 at data)
[1] 1747    5

This shows a discrepancy in two rows between the original shapefile and the
new merged one.  When I looked at the merged file in full, there were a
number of NA rows at the bottom where there was no corresponding data to the
shapefile.  I tried shape1 at data <- na.exclude(shape1 at data) and with na.omit,
and this did reduce the number of rows to 1690, but the problem persists.

Sorry if this is a really unhelpful question, I'm not sure how to do it when
data is confidential.



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Merging-shapefiles-and-csv-tp7586839.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From lyndon.estes at gmail.com  Thu Jul 31 15:14:13 2014
From: lyndon.estes at gmail.com (Lyndon Estes)
Date: Thu, 31 Jul 2014 09:14:13 -0400
Subject: [R-sig-Geo] Merging shapefiles and csv
In-Reply-To: <1406809933918-7586839.post@n2.nabble.com>
References: <1406809933918-7586839.post@n2.nabble.com>
Message-ID: <CALuVVaZAB0Sh8cP-_qLr0u4LawkMqKEoj08jXRX_g-gzFAwUUw@mail.gmail.com>

I am not sure about the mismatch issue, but I thinking merging the
data slot of spatialPolygonsDataFrame with a data frame produces
undesirable results.

I wrote a function a while back that does the merge in such a way that
the problems are avoided, and perhaps this might help.  I think there
are other, more recent, and undoubtedly better solutions (in fact I
recall seeing a very recent thread about this, but not sure where)
than this one that you could find.

joinAttributeTable <- function(x, y, xcol, ycol) {
# Merges data frame to SpatialPolygonsDataFrame, keeping the correct
order. Code from suggestions at:
# https://stat.ethz.ch/pipermail/r-sig-geo/2008-January/003064.html
# Args:
#   x: SpatialPolygonsDataFrame
#   y: Name of data.frame to merge
#   xcol: Merge column name
#   ycol: Merge column name
# Returns: Shapefile with merged attribute table

  x$sort_id <- 1:nrow(as(x, "data.frame"))  # Column containing
original row order for later sorting

  x.dat <- as(x, "data.frame")  # Create new data.frame object
  x.dat2 <- merge(x.dat, y, by.x = xcol, by.y = ycol)  # Merge
  x.dat2.ord <- x.dat2[order(x.dat2$sort_id), ]  # Reorder back to original
  x2 <- x[x$sort_id %in% x.dat2$sort_id, ]  # Make new set of
polygons, dropping those which aren't in merge
  x2.dat <- as(x2, "data.frame")  # Make update x2 into a data.frame
  row.names(x.dat2.ord) <- row.names(x2.dat)  # Reassign row.names
from original data.frame
  x2 at data <- x.dat2.ord  # Assign to shapefile the new data.frame
  return(x2)
}

Hope it helps.

Best, Lyndon


On Thu, Jul 31, 2014 at 8:32 AM, HallS <sam_l_cruickshank at hotmail.com> wrote:
> Hi all,
>
> I'm struggling to know how this will come across as my data is confidential.
>
> Basically I have a shapefile (.shp) and a csv file while contain the same
> regions (i.e.) a column which has the same information.  Using this link:
> https://sites.google.com/site/eospansite/alobotips/spatial_r_tips/rshp_xls
> I managed to get quite far but once I got to the writeOGR command, I get the
> error
>  Error in writeOGR(RSANHS, dsn = "C:/Users/Laptop/Documents/Rworkspace/",  :
>   number of objects mismatch
>
> shape1 at data <- merge(shape1 at data,csv,by.x="RSA",
> +                           by.y="RSA", all.x=T, sort=F)
>>
>> ###Checking it
>> dim(shape at data)
> [1] 1745    2
>> dim(shape1 at data)
> [1] 1747    5
>
> This shows a discrepancy in two rows between the original shapefile and the
> new merged one.  When I looked at the merged file in full, there were a
> number of NA rows at the bottom where there was no corresponding data to the
> shapefile.  I tried shape1 at data <- na.exclude(shape1 at data) and with na.omit,
> and this did reduce the number of rows to 1690, but the problem persists.
>
> Sorry if this is a really unhelpful question, I'm not sure how to do it when
> data is confidential.
>
>
>
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Merging-shapefiles-and-csv-tp7586839.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From rafael.wueest at gmail.com  Thu Jul 31 15:19:01 2014
From: rafael.wueest at gmail.com (=?ISO-8859-1?Q?Rafael_W=FCest?=)
Date: Thu, 31 Jul 2014 15:19:01 +0200
Subject: [R-sig-Geo] Merging shapefiles and csv
In-Reply-To: <CALuVVaZAB0Sh8cP-_qLr0u4LawkMqKEoj08jXRX_g-gzFAwUUw@mail.gmail.com>
References: <1406809933918-7586839.post@n2.nabble.com>
	<CALuVVaZAB0Sh8cP-_qLr0u4LawkMqKEoj08jXRX_g-gzFAwUUw@mail.gmail.com>
Message-ID: <53DA4245.1000809@gmail.com>

Hi there

have a look at

?sp::merge

Should do what you need.

HTH, Rafael

On 31/07/2014 15:14, Lyndon Estes wrote:
> I am not sure about the mismatch issue, but I thinking merging the
> data slot of spatialPolygonsDataFrame with a data frame produces
> undesirable results.
>
> I wrote a function a while back that does the merge in such a way that
> the problems are avoided, and perhaps this might help.  I think there
> are other, more recent, and undoubtedly better solutions (in fact I
> recall seeing a very recent thread about this, but not sure where)
> than this one that you could find.
>
> joinAttributeTable <- function(x, y, xcol, ycol) {
> # Merges data frame to SpatialPolygonsDataFrame, keeping the correct
> order. Code from suggestions at:
> # https://stat.ethz.ch/pipermail/r-sig-geo/2008-January/003064.html
> # Args:
> #   x: SpatialPolygonsDataFrame
> #   y: Name of data.frame to merge
> #   xcol: Merge column name
> #   ycol: Merge column name
> # Returns: Shapefile with merged attribute table
>
>    x$sort_id <- 1:nrow(as(x, "data.frame"))  # Column containing
> original row order for later sorting
>
>    x.dat <- as(x, "data.frame")  # Create new data.frame object
>    x.dat2 <- merge(x.dat, y, by.x = xcol, by.y = ycol)  # Merge
>    x.dat2.ord <- x.dat2[order(x.dat2$sort_id), ]  # Reorder back to original
>    x2 <- x[x$sort_id %in% x.dat2$sort_id, ]  # Make new set of
> polygons, dropping those which aren't in merge
>    x2.dat <- as(x2, "data.frame")  # Make update x2 into a data.frame
>    row.names(x.dat2.ord) <- row.names(x2.dat)  # Reassign row.names
> from original data.frame
>    x2 at data <- x.dat2.ord  # Assign to shapefile the new data.frame
>    return(x2)
> }
>
> Hope it helps.
>
> Best, Lyndon
>
>
> On Thu, Jul 31, 2014 at 8:32 AM, HallS <sam_l_cruickshank at hotmail.com> wrote:
>> Hi all,
>>
>> I'm struggling to know how this will come across as my data is confidential.
>>
>> Basically I have a shapefile (.shp) and a csv file while contain the same
>> regions (i.e.) a column which has the same information.  Using this link:
>> https://sites.google.com/site/eospansite/alobotips/spatial_r_tips/rshp_xls
>> I managed to get quite far but once I got to the writeOGR command, I get the
>> error
>>   Error in writeOGR(RSANHS, dsn = "C:/Users/Laptop/Documents/Rworkspace/",  :
>>    number of objects mismatch
>>
>> shape1 at data <- merge(shape1 at data,csv,by.x="RSA",
>> +                           by.y="RSA", all.x=T, sort=F)
>>>
>>> ###Checking it
>>> dim(shape at data)
>> [1] 1745    2
>>> dim(shape1 at data)
>> [1] 1747    5
>>
>> This shows a discrepancy in two rows between the original shapefile and the
>> new merged one.  When I looked at the merged file in full, there were a
>> number of NA rows at the bottom where there was no corresponding data to the
>> shapefile.  I tried shape1 at data <- na.exclude(shape1 at data) and with na.omit,
>> and this did reduce the number of rows to 1690, but the problem persists.
>>
>> Sorry if this is a really unhelpful question, I'm not sure how to do it when
>> data is confidential.
>>
>>
>>
>> --
>> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Merging-shapefiles-and-csv-tp7586839.html
>> Sent from the R-sig-geo mailing list archive at Nabble.com.
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Rafael W?est
rafael.wueest at gmail.com
http://www.rowueest.net


From sam_l_cruickshank at hotmail.com  Thu Jul 31 16:10:40 2014
From: sam_l_cruickshank at hotmail.com (sam cruickshank)
Date: Thu, 31 Jul 2014 15:10:40 +0100
Subject: [R-sig-Geo] Merging shapefiles and csv
In-Reply-To: <53DA4245.1000809@gmail.com>
References: <1406809933918-7586839.post@n2.nabble.com>,
	<CALuVVaZAB0Sh8cP-_qLr0u4LawkMqKEoj08jXRX_g-gzFAwUUw@mail.gmail.com>,
	<53DA4245.1000809@gmail.com>
Message-ID: <DUB127-W63E9BDD3D557328A329023A6E60@phx.gbl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140731/9c6ebb82/attachment.pl>

From rvaldezr at gmail.com  Thu Jul 31 17:03:36 2014
From: rvaldezr at gmail.com (Rolando Valdez)
Date: Thu, 31 Jul 2014 10:03:36 -0500
Subject: [R-sig-Geo] Merging shapefiles and csv
In-Reply-To: <DUB127-W63E9BDD3D557328A329023A6E60@phx.gbl>
References: <1406809933918-7586839.post@n2.nabble.com>,
	<CALuVVaZAB0Sh8cP-_qLr0u4LawkMqKEoj08jXRX_g-gzFAwUUw@mail.gmail.com>,
	<53DA4245.1000809@gmail.com>
	<DUB127-W63E9BDD3D557328A329023A6E60@phx.gbl>
Message-ID: <39FF945A-BAA9-4AC6-A90E-D2046DF8E128@gmail.com>

Hi,

I have used this proceeding:

spatial.data <- readOGR(?.)
stat.data <- read.csv(?.)
spatial.data at data=data.frame(stat.data)

This will merge your statistical data to your spatial data. Make sure you have the same order in both sides of your data.

Hope this help, greetings.

El 31/07/2014, a las 09:10, sam cruickshank <sam_l_cruickshank at hotmail.com> escribi?:

> Hi,Thank you Lyndon and Rafael for your thoughts.  After the sp::merge comment I followed the code below, but again it failed at the write OGR bit, but this time with "Error in writeOGR(spatial.data, dsn = "C:/Users/Laptop/Documents/Rworkspace/Shape",  :   Creating Name field failed"
> This could be because the "new_layer" command...does this have to be named anything in particular?  Does it have to match the file name etc.  Lyndon I'll try yours next but must admit it's confused me a little.
> 
> Joining New Data to an Existing sp Object
> # use to read in some vector data
> library(rgdal)
> 
> # read something in, rows are identified by a column called 'id'
> spatial.data <- readOGR(...)
> 
> # read in some tabular data, rows are identified by a column called 'id'
> new_table <- read.csv(...)
> 
> # 'join' the new data with merge()
> # all.x=TRUE is used to ensure we have the same number of rows after the join
> # in case that the new table has fewer
> merged <- merge(x=spatial.data at data, y=new_table, by.x='id', by.y='id', all.x=TRUE)
> 
> # generate a vector that represents the original ordering of rows in the sp object
> correct.ordering <- match(spatial.data at data$id, merged$id)
> 
> # overwrite the original dataframe with the new merged dataframe, in the correct order
> spatial.data at data <- merged[correct.ordering, ]
> 
> # check the ordering of the merged data, with the original spatial data
> cbind(spatial.data at data$id, merged$id[correct.ordering]) 
> Correctly Write 'NA' Values to Shapefile [bug in writeOGR()]
> # libraries we need
> require(rgdal)
> require(foreign)
> 
> # pass 1: write the shapefile
> writeOGR(spatial.data, dsn='new_folder', driver='ESRI Shapefile', layer='new_layer')
> 
> # re-make the DBF:
> write.dbf(spatial.data at data, file='new_folder/new_layer.dbf')
> 
> 
>> Date: Thu, 31 Jul 2014 15:19:01 +0200
>> From: rafael.wueest at gmail.com
>> To: r-sig-geo at r-project.org
>> Subject: Re: [R-sig-Geo] Merging shapefiles and csv
>> 
>> Hi there
>> 
>> have a look at
>> 
>> ?sp::merge
>> 
>> Should do what you need.
>> 
>> HTH, Rafael
>> 
>> On 31/07/2014 15:14, Lyndon Estes wrote:
>>> I am not sure about the mismatch issue, but I thinking merging the
>>> data slot of spatialPolygonsDataFrame with a data frame produces
>>> undesirable results.
>>> 
>>> I wrote a function a while back that does the merge in such a way that
>>> the problems are avoided, and perhaps this might help.  I think there
>>> are other, more recent, and undoubtedly better solutions (in fact I
>>> recall seeing a very recent thread about this, but not sure where)
>>> than this one that you could find.
>>> 
>>> joinAttributeTable <- function(x, y, xcol, ycol) {
>>> # Merges data frame to SpatialPolygonsDataFrame, keeping the correct
>>> order. Code from suggestions at:
>>> # https://stat.ethz.ch/pipermail/r-sig-geo/2008-January/003064.html
>>> # Args:
>>> #   x: SpatialPolygonsDataFrame
>>> #   y: Name of data.frame to merge
>>> #   xcol: Merge column name
>>> #   ycol: Merge column name
>>> # Returns: Shapefile with merged attribute table
>>> 
>>>   x$sort_id <- 1:nrow(as(x, "data.frame"))  # Column containing
>>> original row order for later sorting
>>> 
>>>   x.dat <- as(x, "data.frame")  # Create new data.frame object
>>>   x.dat2 <- merge(x.dat, y, by.x = xcol, by.y = ycol)  # Merge
>>>   x.dat2.ord <- x.dat2[order(x.dat2$sort_id), ]  # Reorder back to original
>>>   x2 <- x[x$sort_id %in% x.dat2$sort_id, ]  # Make new set of
>>> polygons, dropping those which aren't in merge
>>>   x2.dat <- as(x2, "data.frame")  # Make update x2 into a data.frame
>>>   row.names(x.dat2.ord) <- row.names(x2.dat)  # Reassign row.names
>>> from original data.frame
>>>   x2 at data <- x.dat2.ord  # Assign to shapefile the new data.frame
>>>   return(x2)
>>> }
>>> 
>>> Hope it helps.
>>> 
>>> Best, Lyndon
>>> 
>>> 
>>> On Thu, Jul 31, 2014 at 8:32 AM, HallS <sam_l_cruickshank at hotmail.com> wrote:
>>>> Hi all,
>>>> 
>>>> I'm struggling to know how this will come across as my data is confidential.
>>>> 
>>>> Basically I have a shapefile (.shp) and a csv file while contain the same
>>>> regions (i.e.) a column which has the same information.  Using this link:
>>>> https://sites.google.com/site/eospansite/alobotips/spatial_r_tips/rshp_xls
>>>> I managed to get quite far but once I got to the writeOGR command, I get the
>>>> error
>>>>  Error in writeOGR(RSANHS, dsn = "C:/Users/Laptop/Documents/Rworkspace/",  :
>>>>   number of objects mismatch
>>>> 
>>>> shape1 at data <- merge(shape1 at data,csv,by.x="RSA",
>>>> +                           by.y="RSA", all.x=T, sort=F)
>>>>> 
>>>>> ###Checking it
>>>>> dim(shape at data)
>>>> [1] 1745    2
>>>>> dim(shape1 at data)
>>>> [1] 1747    5
>>>> 
>>>> This shows a discrepancy in two rows between the original shapefile and the
>>>> new merged one.  When I looked at the merged file in full, there were a
>>>> number of NA rows at the bottom where there was no corresponding data to the
>>>> shapefile.  I tried shape1 at data <- na.exclude(shape1 at data) and with na.omit,
>>>> and this did reduce the number of rows to 1690, but the problem persists.
>>>> 
>>>> Sorry if this is a really unhelpful question, I'm not sure how to do it when
>>>> data is confidential.
>>>> 
>>>> 
>>>> 
>>>> --
>>>> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Merging-shapefiles-and-csv-tp7586839.html
>>>> Sent from the R-sig-geo mailing list archive at Nabble.com.
>>>> 
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at r-project.org
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>> 
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>> 
>> 
>> -- 
>> Rafael W?est
>> rafael.wueest at gmail.com
>> http://www.rowueest.net
>> 
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 		 	   		  
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

Rolando Valdez


From diederik.strubbe at uantwerpen.be  Thu Jul 31 17:11:35 2014
From: diederik.strubbe at uantwerpen.be (Diederik Strubbe)
Date: Thu, 31 Jul 2014 17:11:35 +0200
Subject: [R-sig-Geo] biomod2 - weighting or subsetting occurrence data?
Message-ID: <53DA5CA7.5060009@uantwerpen.be>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140731/0ec1bf18/attachment.pl>

From sam_l_cruickshank at hotmail.com  Thu Jul 31 17:27:53 2014
From: sam_l_cruickshank at hotmail.com (HallS)
Date: Thu, 31 Jul 2014 08:27:53 -0700 (PDT)
Subject: [R-sig-Geo] Merging shapefiles and csv
In-Reply-To: <1406809933918-7586839.post@n2.nabble.com>
References: <1406809933918-7586839.post@n2.nabble.com>
Message-ID: <1406820473540-7586845.post@n2.nabble.com>

Hi all,

OK thanks for all your help.  I believe now I have successfully merged the
two, when I run str(merged_file) it shows all of the correct variables, and
when I run plot(merged_file), I still get the outline of the correct shape.

Thank you for all your help, I must confess writeOGR doesn't work still, but
I thought this was required in order to draw a choropleth map and I realise
now this is not the case and it can be done with just the merged file I
believe.  

Thanks again



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Merging-shapefiles-and-csv-tp7586839p7586845.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From lyndon.estes at gmail.com  Thu Jul 31 17:44:27 2014
From: lyndon.estes at gmail.com (Lyndon Estes)
Date: Thu, 31 Jul 2014 11:44:27 -0400
Subject: [R-sig-Geo] Merging shapefiles and csv
In-Reply-To: <1406820473540-7586845.post@n2.nabble.com>
References: <1406809933918-7586839.post@n2.nabble.com>
	<1406820473540-7586845.post@n2.nabble.com>
Message-ID: <CALuVVaawUWDtP-v04D94L6xDDMTsrzfz1Amojm-=MiYbOKZoDA@mail.gmail.com>

Hi Sam,

One thing you might check is the column names in your csv file. If you
can change them to something simpler, without periods in them, etc,
that might get rid of the problem.  There are some threads on this
problem as well, I believe.

Cheers, Lyndon

On Thu, Jul 31, 2014 at 11:27 AM, HallS <sam_l_cruickshank at hotmail.com> wrote:
> Hi all,
>
> OK thanks for all your help.  I believe now I have successfully merged the
> two, when I run str(merged_file) it shows all of the correct variables, and
> when I run plot(merged_file), I still get the outline of the correct shape.
>
> Thank you for all your help, I must confess writeOGR doesn't work still, but
> I thought this was required in order to draw a choropleth map and I realise
> now this is not the case and it can be done with just the merged file I
> believe.
>
> Thanks again
>
>
>
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Merging-shapefiles-and-csv-tp7586839p7586845.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From ftonini84 at gmail.com  Thu Jul 31 17:45:28 2014
From: ftonini84 at gmail.com (Francesco Tonini)
Date: Thu, 31 Jul 2014 11:45:28 -0400
Subject: [R-sig-Geo] Error gstat function krigeST
Message-ID: <53DA6498.6010606@gmail.com>

Dear all,

I am working with an hourly dataset of air temperature, recorded at ~200 
stations over a relatively small area. I chose a space-time variogram 
(e.g. sum-metric) to fit my data and am now trying to make predictions 
over my same stations in order to fill NA (missing value) gaps. When 
using the krigeST() function over daily aggregated data everything seems 
to go smooth but when I use it at the original hourly resolution I 
always get the following error:

Error in chol.default(A)
the leading minor of order 68 is not positive definite

I googled it and found that it is related to a matrix not being 
completely positive-definite. However, I am not sure why this happens 
and was wondering if any of you know a way of fixing this (a workaround 
to avoid it).

Thanks!
Francesco


From Roger.Bivand at nhh.no  Thu Jul 31 18:46:16 2014
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 31 Jul 2014 18:46:16 +0200
Subject: [R-sig-Geo] Merging shapefiles and csv
In-Reply-To: <39FF945A-BAA9-4AC6-A90E-D2046DF8E128@gmail.com>
References: <1406809933918-7586839.post@n2.nabble.com>,
	<CALuVVaZAB0Sh8cP-_qLr0u4LawkMqKEoj08jXRX_g-gzFAwUUw@mail.gmail.com>,
	<53DA4245.1000809@gmail.com>
	<DUB127-W63E9BDD3D557328A329023A6E60@phx.gbl>
	<39FF945A-BAA9-4AC6-A90E-D2046DF8E128@gmail.com>
Message-ID: <alpine.LRH.2.03.1407311842290.14798@reclus.nhh.no>

On Thu, 31 Jul 2014, Rolando Valdez wrote:

> Hi,
>
> I have used this proceeding:
>
> spatial.data <- readOGR(?.)
> stat.data <- read.csv(?.)
> spatial.data at data=data.frame(stat.data)
>
> This will merge your statistical data to your spatial data. Make sure 
> you have the same order in both sides of your data.

No, this only holds under very specific assumptions (same observations in 
both data objects in the same order). Please do refer to the vignette in 
the maptools package, and to previous threads which have advised that 
merge() should not be used, and that the row.names of the data frames be 
used as ID keys. Typically using match() on the row.names of the two 
objects will show which are not correctly aligned.

Hope this clarifies,

Roger

>
> Hope this help, greetings.
>
> El 31/07/2014, a las 09:10, sam cruickshank <sam_l_cruickshank at hotmail.com> escribi?:
>
>> Hi,Thank you Lyndon and Rafael for your thoughts.  After the sp::merge comment I followed the code below, but again it failed at the write OGR bit, but this time with "Error in writeOGR(spatial.data, dsn = "C:/Users/Laptop/Documents/Rworkspace/Shape",  :   Creating Name field failed"
>> This could be because the "new_layer" command...does this have to be named anything in particular?  Does it have to match the file name etc.  Lyndon I'll try yours next but must admit it's confused me a little.
>>
>> Joining New Data to an Existing sp Object
>> # use to read in some vector data
>> library(rgdal)
>>
>> # read something in, rows are identified by a column called 'id'
>> spatial.data <- readOGR(...)
>>
>> # read in some tabular data, rows are identified by a column called 'id'
>> new_table <- read.csv(...)
>>
>> # 'join' the new data with merge()
>> # all.x=TRUE is used to ensure we have the same number of rows after the join
>> # in case that the new table has fewer
>> merged <- merge(x=spatial.data at data, y=new_table, by.x='id', by.y='id', all.x=TRUE)
>>
>> # generate a vector that represents the original ordering of rows in the sp object
>> correct.ordering <- match(spatial.data at data$id, merged$id)
>>
>> # overwrite the original dataframe with the new merged dataframe, in the correct order
>> spatial.data at data <- merged[correct.ordering, ]
>>
>> # check the ordering of the merged data, with the original spatial data
>> cbind(spatial.data at data$id, merged$id[correct.ordering])
>> Correctly Write 'NA' Values to Shapefile [bug in writeOGR()]
>> # libraries we need
>> require(rgdal)
>> require(foreign)
>>
>> # pass 1: write the shapefile
>> writeOGR(spatial.data, dsn='new_folder', driver='ESRI Shapefile', layer='new_layer')
>>
>> # re-make the DBF:
>> write.dbf(spatial.data at data, file='new_folder/new_layer.dbf')
>>
>>
>>> Date: Thu, 31 Jul 2014 15:19:01 +0200
>>> From: rafael.wueest at gmail.com
>>> To: r-sig-geo at r-project.org
>>> Subject: Re: [R-sig-Geo] Merging shapefiles and csv
>>>
>>> Hi there
>>>
>>> have a look at
>>>
>>> ?sp::merge
>>>
>>> Should do what you need.
>>>
>>> HTH, Rafael
>>>
>>> On 31/07/2014 15:14, Lyndon Estes wrote:
>>>> I am not sure about the mismatch issue, but I thinking merging the
>>>> data slot of spatialPolygonsDataFrame with a data frame produces
>>>> undesirable results.
>>>>
>>>> I wrote a function a while back that does the merge in such a way that
>>>> the problems are avoided, and perhaps this might help.  I think there
>>>> are other, more recent, and undoubtedly better solutions (in fact I
>>>> recall seeing a very recent thread about this, but not sure where)
>>>> than this one that you could find.
>>>>
>>>> joinAttributeTable <- function(x, y, xcol, ycol) {
>>>> # Merges data frame to SpatialPolygonsDataFrame, keeping the correct
>>>> order. Code from suggestions at:
>>>> # https://stat.ethz.ch/pipermail/r-sig-geo/2008-January/003064.html
>>>> # Args:
>>>> #   x: SpatialPolygonsDataFrame
>>>> #   y: Name of data.frame to merge
>>>> #   xcol: Merge column name
>>>> #   ycol: Merge column name
>>>> # Returns: Shapefile with merged attribute table
>>>>
>>>>   x$sort_id <- 1:nrow(as(x, "data.frame"))  # Column containing
>>>> original row order for later sorting
>>>>
>>>>   x.dat <- as(x, "data.frame")  # Create new data.frame object
>>>>   x.dat2 <- merge(x.dat, y, by.x = xcol, by.y = ycol)  # Merge
>>>>   x.dat2.ord <- x.dat2[order(x.dat2$sort_id), ]  # Reorder back to original
>>>>   x2 <- x[x$sort_id %in% x.dat2$sort_id, ]  # Make new set of
>>>> polygons, dropping those which aren't in merge
>>>>   x2.dat <- as(x2, "data.frame")  # Make update x2 into a data.frame
>>>>   row.names(x.dat2.ord) <- row.names(x2.dat)  # Reassign row.names
>>>> from original data.frame
>>>>   x2 at data <- x.dat2.ord  # Assign to shapefile the new data.frame
>>>>   return(x2)
>>>> }
>>>>
>>>> Hope it helps.
>>>>
>>>> Best, Lyndon
>>>>
>>>>
>>>> On Thu, Jul 31, 2014 at 8:32 AM, HallS <sam_l_cruickshank at hotmail.com> wrote:
>>>>> Hi all,
>>>>>
>>>>> I'm struggling to know how this will come across as my data is confidential.
>>>>>
>>>>> Basically I have a shapefile (.shp) and a csv file while contain the same
>>>>> regions (i.e.) a column which has the same information.  Using this link:
>>>>> https://sites.google.com/site/eospansite/alobotips/spatial_r_tips/rshp_xls
>>>>> I managed to get quite far but once I got to the writeOGR command, I get the
>>>>> error
>>>>>  Error in writeOGR(RSANHS, dsn = "C:/Users/Laptop/Documents/Rworkspace/",  :
>>>>>   number of objects mismatch
>>>>>
>>>>> shape1 at data <- merge(shape1 at data,csv,by.x="RSA",
>>>>> +                           by.y="RSA", all.x=T, sort=F)
>>>>>>
>>>>>> ###Checking it
>>>>>> dim(shape at data)
>>>>> [1] 1745    2
>>>>>> dim(shape1 at data)
>>>>> [1] 1747    5
>>>>>
>>>>> This shows a discrepancy in two rows between the original shapefile and the
>>>>> new merged one.  When I looked at the merged file in full, there were a
>>>>> number of NA rows at the bottom where there was no corresponding data to the
>>>>> shapefile.  I tried shape1 at data <- na.exclude(shape1 at data) and with na.omit,
>>>>> and this did reduce the number of rows to 1690, but the problem persists.
>>>>>
>>>>> Sorry if this is a really unhelpful question, I'm not sure how to do it when
>>>>> data is confidential.
>>>>>
>>>>>
>>>>>
>>>>> --
>>>>> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Merging-shapefiles-and-csv-tp7586839.html
>>>>> Sent from the R-sig-geo mailing list archive at Nabble.com.
>>>>>
>>>>> _______________________________________________
>>>>> R-sig-Geo mailing list
>>>>> R-sig-Geo at r-project.org
>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at r-project.org
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>
>>> --
>>> Rafael W?est
>>> rafael.wueest at gmail.com
>>> http://www.rowueest.net
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>> 	[[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> Rolando Valdez
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no

From Roger.Bivand at nhh.no  Thu Jul 31 18:51:44 2014
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 31 Jul 2014 18:51:44 +0200
Subject: [R-sig-Geo] Merging shapefiles and csv
In-Reply-To: <1406820473540-7586845.post@n2.nabble.com>
References: <1406809933918-7586839.post@n2.nabble.com>
	<1406820473540-7586845.post@n2.nabble.com>
Message-ID: <alpine.LRH.2.03.1407311849230.14798@reclus.nhh.no>

On Thu, 31 Jul 2014, HallS wrote:

> Hi all,
>
> OK thanks for all your help.  I believe now I have successfully merged the
> two, when I run str(merged_file) it shows all of the correct variables, and
> when I run plot(merged_file), I still get the outline of the correct shape.

Beware that the data from the objects may be jumbled - never use merge, 
always use match() on the row.names vectors of the objects to ensure that 
the key-IDs agree. Jumbled data happens, it is important not to think 
"shapefile" but to think DBMS with the ID key your way of staying sane.

Hope this clarifies,

Roger

>
> Thank you for all your help, I must confess writeOGR doesn't work still, but
> I thought this was required in order to draw a choropleth map and I realise
> now this is not the case and it can be done with just the merged file I
> believe.
>
> Thanks again
>
>
>
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Merging-shapefiles-and-csv-tp7586839p7586845.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no


