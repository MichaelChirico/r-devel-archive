From wul1984 at gmail.com  Wed Dec  1 11:41:03 2010
From: wul1984 at gmail.com (=?GB2312?B?wu2/yQ==?=)
Date: Wed, 1 Dec 2010 18:41:03 +0800
Subject: [R-sig-Geo] Digit positions in writing files
Message-ID: <AANLkTik8Jjrr89UzEO1DCHGO7BG_NF5Nwj1j35P7q+vK@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101201/093dc720/attachment.pl>

From zbynek.janoska at centrum.cz  Wed Dec  1 12:12:00 2010
From: zbynek.janoska at centrum.cz (zbynek.janoska at centrum.cz)
Date: Wed, 1 Dec 2010 03:12:00 -0800 (PST)
Subject: [R-sig-Geo] problem creating point pattern class object with
	spatstat package
Message-ID: <1291201920796-5791421.post@n2.nabble.com>


I have troubles creating ppp object in spatstat using spatstat package.
I would like to upload some lidar data and convert them to ppp, but error
occured.
I am working with dataset lidar, consisnting of two columns (x and y
coordinates)

> x1 <- min(lidar[,1])-1
> x2 <- max(lidar[,1])+1
> y1 <- min(lidar[,2])-1
> y2 <- max(lidar[,2])+1
> owin1 <- owin(c(x1,x2),c(y1,y2))

so far it works well and I can also plot owin object

> ppp1 <- ppp(lidar[,1],lidar[,2],owin1)
Error in owin(...) : 
  If one of xrange, yrange is specified then both must be.

I can not get past this error.
I have succesfully created owin1 - window of class owin, but i can not use
it to create ppp object

Does anyone see what mistake I have done?
Possibly it is something very easy, but I am quite new to R.

Thanks,
Zbynek
-- 
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/problem-creating-point-pattern-class-object-with-spatstat-package-tp5791421p5791421.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From roman.lustrik at gmail.com  Wed Dec  1 12:22:11 2010
From: roman.lustrik at gmail.com (=?UTF-8?Q?Roman_Lu=C5=A1trik?=)
Date: Wed, 1 Dec 2010 12:22:11 +0100
Subject: [R-sig-Geo] problem creating point pattern class object with
 spatstat package
In-Reply-To: <1291201920796-5791421.post@n2.nabble.com>
References: <1291201920796-5791421.post@n2.nabble.com>
Message-ID: <AANLkTi=9Yuod5eVM52uMuytVRLpzjkqXQXDkcyn-ZDkK@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101201/42584c84/attachment.pl>

From roman.lustrik at gmail.com  Wed Dec  1 13:17:09 2010
From: roman.lustrik at gmail.com (=?UTF-8?Q?Roman_Lu=C5=A1trik?=)
Date: Wed, 1 Dec 2010 13:17:09 +0100
Subject: [R-sig-Geo] Fwd:  Digit positions in writing files
In-Reply-To: <AANLkTimygQb8V9SH8htEGcRCB2NPA7A91ywOduWzywab@mail.gmail.com>
References: <AANLkTik8Jjrr89UzEO1DCHGO7BG_NF5Nwj1j35P7q+vK@mail.gmail.com>
	<AANLkTikcn=x538SbLzu=-j0E8Y_23pwh-gJr8kjmL7vJ@mail.gmail.com>
	<AANLkTinRzDJ=NerqbGvimdJtF8ttwyx8HvJ+JW-LG-Mq@mail.gmail.com>
	<AANLkTimygQb8V9SH8htEGcRCB2NPA7A91ywOduWzywab@mail.gmail.com>
Message-ID: <AANLkTikcpP2ESpnCUr9YjBB=V5X3NWQwD9o_RBGey=uu@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101201/e925bddf/attachment.pl>

From wul1984 at gmail.com  Wed Dec  1 13:20:02 2010
From: wul1984 at gmail.com (=?GB2312?B?wu2/yQ==?=)
Date: Wed, 1 Dec 2010 20:20:02 +0800
Subject: [R-sig-Geo] Fwd:  Digit positions in writing files
In-Reply-To: <AANLkTinRzDJ=NerqbGvimdJtF8ttwyx8HvJ+JW-LG-Mq@mail.gmail.com>
References: <AANLkTik8Jjrr89UzEO1DCHGO7BG_NF5Nwj1j35P7q+vK@mail.gmail.com>
	<AANLkTikcn=x538SbLzu=-j0E8Y_23pwh-gJr8kjmL7vJ@mail.gmail.com>
	<AANLkTinRzDJ=NerqbGvimdJtF8ttwyx8HvJ+JW-LG-Mq@mail.gmail.com>
Message-ID: <AANLkTimJdV2Oufx42w0iiK4rcxzdGFkK+6X00sVbBuUo@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101201/e2d2baf0/attachment.pl>

From wul1984 at gmail.com  Wed Dec  1 13:36:01 2010
From: wul1984 at gmail.com (=?GB2312?B?wu2/yQ==?=)
Date: Wed, 1 Dec 2010 20:36:01 +0800
Subject: [R-sig-Geo] Fwd: Digit positions in writing files
In-Reply-To: <AANLkTimahLKHSD8_OduzEopm9hu2ZdNOroZEncX7cprF@mail.gmail.com>
References: <AANLkTik8Jjrr89UzEO1DCHGO7BG_NF5Nwj1j35P7q+vK@mail.gmail.com>
	<AANLkTikcn=x538SbLzu=-j0E8Y_23pwh-gJr8kjmL7vJ@mail.gmail.com>
	<AANLkTinRzDJ=NerqbGvimdJtF8ttwyx8HvJ+JW-LG-Mq@mail.gmail.com>
	<AANLkTimJdV2Oufx42w0iiK4rcxzdGFkK+6X00sVbBuUo@mail.gmail.com>
	<AANLkTinfST-u4k2h-bWdsRMEES3DAYhjxm0F5fe20=T6@mail.gmail.com>
	<AANLkTikBwEcDgF1C3DhhtKyP_hkc0QXg9w6cnBu7S2t4@mail.gmail.com>
	<AANLkTinugQ6HD012fGgwxtQmnGK+0w+_duD6c8LKWHKC@mail.gmail.com>
	<AANLkTimahLKHSD8_OduzEopm9hu2ZdNOroZEncX7cprF@mail.gmail.com>
Message-ID: <AANLkTim_6yVMrPW0i0Krp2omoxSYZLxw-ESmgMmQf4vL@mail.gmail.com>

Hi, romunov:

Sorry, I am quite unfamiliar with the mail system, and send the
example only to Roman:

This is the data segment and script that I used to replace the
coordinate, and the result is constant space in between each columns:

####old coordinates
#colnames
##site prec site   lat    lon
 7969    0 55248   32.30   84.05
 7970    3 55279   31.37   90.02
 7971    0 55294   32.27   91.67
 7972    0 55299   31.48   92.07
 7973    0 55437   30.55   81.43
 7974    0 55472   30.95   88.63
 7975    0 55493   30.73   92.45
 7976    0 55569   29.07   87.68
 7977    1 55578   29.25   88.88
 7978    0 55591   29.67   91.13
 7979    0 55598   29.23   91.77
 7980    2 55664   28.63   87.08
 7981    0 55680   29.00   89.63
 7982    0 55690   28.70   91.63
 7983   12 55696   28.42   92.47
###new coordinates
#site		lat		lon
55248	32.15	84.42
55294	32.35	91.1
55437	30.28	81.25
55493	30.48	91.1
55569	29.08	87.6
55598	29.25	91.77
55680	28.92	89.6
55690	27.98	91.95
56202	30.67	93.28
56312	29.67	94.33

##My searching ID
findlist<-c(55248,55294,55437,55493,55569,55598,55680,55690)

old<-read.table('old.txt',head=F,sep='')
names(old)<-c('ID','value','site','lat','lon')
new<-read.table('new.txt',head=F,sep='')
names(x)<-c('site','lat','lon')
for (j in findlist){
old$lat[old$site==j]<-new$lat[new$site==j]
old$lon[old$site==j]<-new$lon[new$site==j]
}
write.table(old,'replaced.txt',row.names = F,col.names =F,eol='\r',sep='   ')

The script looks very silly, but that what I can do in my skill.

My aim again is to obtain the replaced.txt that confirm to the
required format, ie: constant digit length for each column, not
constant space in between.
Anyone could help me out?

Cheers,
Marco


2010/12/1 romunov <romunov at gmail.com>:
> Oh, I missed one function. Try cat(paste(column1...)). This should get rid
> of the start/end quotation marks.
>
>
>
>
> On Wed, Dec 1, 2010 at 1:29 PM, romunov <romunov at gmail.com> wrote:
>>
>> It would pay off if you provide a minimal reproducible example of working
>> code. That way, you higher you chance of getting an answer (faster).
>>
>> Cheers,
>> Roman
>>
>>
>>
>> On Wed, Dec 1, 2010 at 1:27 PM, ?? <wul1984 at gmail.com> wrote:
>>>
>>> Hi,?romunov:
>>>
>>> Unfortunately, the space varies, and I also tried to paste the column
>>> with space of different blanks, but the output then becomes a
>>> character, with quote marks outside of the columns.
>>>
>>> However, thanks very much, and I will try to post the problem in the
>>> stackoverflow!
>>>
>>> Best Regards~
>>> Marco
>>>
>>>
>>> 2010/12/1 romunov <romunov at gmail.com>:
>>> > If you have R related questions that are not directly linked to some
>>> > specific topic (i.e. spatial analysis), you might have better luck @
>>> > stackoverflow. I use it every day and I think it's a great tool. If you
>>> > don't know it yet, have a look @
>>> > http://stackoverflow.com/questions/tagged/r
>>> >
>>> > Cheers,
>>> > Roman
>>> >
>>> >
>>> >
>>> > On Wed, Dec 1, 2010 at 1:20 PM, ?? <wul1984 at gmail.com> wrote:
>>> >>
>>> >> Sorry, I forget to sent the reply to the list:
>>> >>
>>> >>
>>> >> Hi Roman:
>>> >>
>>> >> Thanks for posting~
>>> >>
>>> >> This is the data segment and script that I used to replace the
>>> >> coordinate,
>>> >> and the result is constant space in between each columns:
>>> >>
>>> >> ####old coordinates
>>> >> #colnames
>>> >> ##site prec site ? lat ? ?lon
>>> >> ?7969 ? ?0 55248 ? 32.30 ? 84.05
>>> >> ?7970 ? ?3 55279 ? 31.37 ? 90.02
>>> >> ?7971 ? ?0 55294 ? 32.27 ? 91.67
>>> >> ?7972 ? ?0 55299 ? 31.48 ? 92.07
>>> >> ?7973 ? ?0 55437 ? 30.55 ? 81.43
>>> >> ?7974 ? ?0 55472 ? 30.95 ? 88.63
>>> >> ?7975 ? ?0 55493 ? 30.73 ? 92.45
>>> >> ?7976 ? ?0 55569 ? 29.07 ? 87.68
>>> >> ?7977 ? ?1 55578 ? 29.25 ? 88.88
>>> >> ?7978 ? ?0 55591 ? 29.67 ? 91.13
>>> >> ?7979 ? ?0 55598 ? 29.23 ? 91.77
>>> >> ?7980 ? ?2 55664 ? 28.63 ? 87.08
>>> >> ?7981 ? ?0 55680 ? 29.00 ? 89.63
>>> >> ?7982 ? ?0 55690 ? 28.70 ? 91.63
>>> >> ?7983 ? 12 55696 ? 28.42 ? 92.47
>>> >> ###new coordinates
>>> >> #site lat lon
>>> >> 55248 32.15 84.42
>>> >> 55294 32.35 91.1
>>> >> 55437 30.28 81.25
>>> >> 55493 30.48 91.1
>>> >> 55569 29.08 87.6
>>> >> 55598 29.25 91.77
>>> >> 55680 28.92 89.6
>>> >> 55690 27.98 91.95
>>> >> 56202 30.67 93.28
>>> >> 56312 29.67 94.33
>>> >>
>>> >> ##My searching ID
>>> >> findlist<-c(55248,55294,55437,55493,55569,55598,55680,55690)
>>> >>
>>> >> old<-read.table('old.txt',head=F,sep='')
>>> >> names(old)<-c('ID','value','site','lat','lon')
>>> >> new<-read.table('new.txt',head=F,sep='')
>>> >> names(x)<-c('site','lat','lon')
>>> >> for (j in findlist){
>>> >> old$lat[old$site==j]<-new$lat[new$site==j]
>>> >> old$lon[old$site==j]<-new$lon[new$site==j]
>>> >> }
>>> >> write.table(old,'replaced.txt',row.names = F,col.names
>>> >> =F,eol='\r',sep='
>>> >> ')
>>> >>
>>> >> The script looks very silly, but that what I can do in my skill.
>>> >>
>>> >> My aim again is to obtain the replaced.txt that confirm to the
>>> >> required
>>> >> format, ie: constant digit length for each column, not constant space
>>> >> in
>>> >> between.
>>> >> Anyone could help me out?
>>> >>
>>> >> Cheers,
>>> >> Marco
>>> >>
>>> >>
>>> >> 2010/12/1 Roman Lu?trik <roman.lustrik at gmail.com>
>>> >>
>>> >> Hey,
>>> >> >
>>> >> > this sounds like an interesting problem. I may be a bit dense, but
>>> >> > could
>>> >> > you elaborate a bit more?
>>> >> >
>>> >> > Cheers,
>>> >> > Roman
>>> >> >
>>> >> >
>>> >> >
>>> >> > On Wed, Dec 1, 2010 at 11:41 AM, ?? <wul1984 at gmail.com> wrote:
>>> >> >
>>> >> >> Hi, list:
>>> >> >>
>>> >> >> I am processing a kind of data which has very strict format on
>>> >> >> digit
>>> >> >> position, ie., for the first column, the last digit should be in
>>> >> >> column
>>> >> >> 5,
>>> >> >> the second in column 10, and 16, 24, 32 for the 3rd, 4th, and 5th,
>>> >> >> respectively. Here is the segment:
>>> >> >>
>>> >> >> ? ? ? ?29 ?-999 ?1051 ? 69.58 ? 23.53
>>> >> >> ? ? ? ?30 ?-999 ?1052 ? 70.67 ? 23.67
>>> >> >> ? ? ? ?31 ?-999 ?1053 ? 70.68 ? 23.68
>>> >> >> ? ? ? ?32 ?-999 ?1055 ? 71.10 ? 24.00
>>> >> >> ? ? ? ? .......
>>> >> >> ? 13642 -999 97890 ? -7.83 ?129.67
>>> >> >> ? 13643 ? 30 97900 ? -7.98 ?131.30
>>> >> >> ? 13644 ?100 97980 ? -8.47 ?140.38
>>> >> >> ? 13645 ? 66 98132 ? 20.80 ?121.85
>>> >> >> ? 13646 -999 98133 ? 19.27 ?121.47
>>> >> >>
>>> >> >> My aim is to replace the coordinates of certain rows using new
>>> >> >> coordinates,
>>> >> >> and put the whole file back into the same filee, but it seems that
>>> >> >> I
>>> >> >> can
>>> >> >> only get constant spaces between each column if I use write.table,
>>> >> >> with
>>> >> >> sep=' '. So, my question is, is there any way that I could get the
>>> >> >> desired
>>> >> >> format? By the way, I have more than 10,000 rows in each file
>>> >> >> (day),
>>> >> >> and
>>> >> >> 365
>>> >> >> days for each year, I think for me, R is the only way to do this.
>>> >> >>
>>> >> >> Thanks in advance~
>>> >> >>
>>> >> >> Best regards~
>>> >> >>
>>> >> >> Marco
>>> >> >>
>>> >> >> ? ? ? ?[[alternative HTML version deleted]]
>>> >> >>
>>> >> >> _______________________________________________
>>> >> >> R-sig-Geo mailing list
>>> >> >> R-sig-Geo at r-project.org
>>> >> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>> >> >>
>>> >> >
>>> >> >
>>> >> >
>>> >> > --
>>> >> > In God we trust, all others bring data.
>>> >> >
>>> >>
>>> >>
>>> >>
>>> >> --
>>> >> -------------------------------------------------------
>>> >> Chinese Ecological Research Network,
>>> >> Institute of Geographical Science and Natural Resource Research,
>>> >> ?Chinese Academy Of Science,
>>> >> 100101, Beijing
>>> >> Tel: (86)-10-64880 9809
>>> >>
>>> >> ? ? ? ?[[alternative HTML version deleted]]
>>> >>
>>> >>
>>> >> _______________________________________________
>>> >> R-sig-Geo mailing list
>>> >> R-sig-Geo at r-project.org
>>> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>> >>
>>> >
>>> >
>>> >
>>> > --
>>> > In God we trust, all others bring data.
>>> >
>>>
>>>
>>>
>>> --
>>> -------------------------------------------------------
>>> Chinese Ecological Research Network,
>>> Institute of Geographical Science and Natural Resource Research,
>>> ?Chinese Academy Of Science,
>>> 100101, Beijing
>>> Tel: (86)-10-64880 9809
>>
>>
>>
>> --
>> In God we trust, all others bring data.
>
>
>
> --
> In God we trust, all others bring data.
>



-- 
-------------------------------------------------------
Chinese Ecological Research Network,
Institute of Geographical Science and Natural Resource Research,
?Chinese Academy Of Science,
100101, Beijing
Tel: (86)-10-64880 9809


From f.veronesi at cranfield.ac.uk  Wed Dec  1 17:54:43 2010
From: f.veronesi at cranfield.ac.uk (Veronesi, Fabio)
Date: Wed, 1 Dec 2010 16:54:43 +0000
Subject: [R-sig-Geo] 3D Anisotropy in GSTAT
Message-ID: <6E3C09D338C1BB46AD3778BB99012D6005EC0FFDD2@CCEXCHSTORE-2.central.cranfield.ac.uk>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101201/b53d2aeb/attachment.pl>

From r.hijmans at gmail.com  Wed Dec  1 18:10:03 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Wed, 1 Dec 2010 09:10:03 -0800
Subject: [R-sig-Geo] Digit positions in writing files
In-Reply-To: <AANLkTik8Jjrr89UzEO1DCHGO7BG_NF5Nwj1j35P7q+vK@mail.gmail.com>
References: <AANLkTik8Jjrr89UzEO1DCHGO7BG_NF5Nwj1j35P7q+vK@mail.gmail.com>
Message-ID: <AANLkTikVDTRroppH8G9hnBboekSmjpnhdiracY-+OTV6@mail.gmail.com>

Have a look at sprintf

Robert

On Wed, Dec 1, 2010 at 2:41 AM, ?? <wul1984 at gmail.com> wrote:
> Hi, list:
>
> I am processing a kind of data which has very strict format on digit
> position, ie., for the first column, the last digit should be in column 5,
> the second in column 10, and 16, 24, 32 for the 3rd, 4th, and 5th,
> respectively. Here is the segment:
>
> ? ? ? ?29 ?-999 ?1051 ? 69.58 ? 23.53
> ? ? ? ?30 ?-999 ?1052 ? 70.67 ? 23.67
> ? ? ? ?31 ?-999 ?1053 ? 70.68 ? 23.68
> ? ? ? ?32 ?-999 ?1055 ? 71.10 ? 24.00
> ? ? ? ? .......
> ? 13642 -999 97890 ? -7.83 ?129.67
> ? 13643 ? 30 97900 ? -7.98 ?131.30
> ? 13644 ?100 97980 ? -8.47 ?140.38
> ? 13645 ? 66 98132 ? 20.80 ?121.85
> ? 13646 -999 98133 ? 19.27 ?121.47
>
> My aim is to replace the coordinates of certain rows using new coordinates,
> and put the whole file back into the same filee, but it seems that I can
> only get constant spaces between each column if I use write.table, with
> sep=' '. So, my question is, is there any way that I could get the desired
> format? By the way, I have more than 10,000 rows in each file (day), and 365
> days for each year, I think for me, R is the only way to do this.
>
> Thanks in advance~
>
> Best regards~
>
> Marco
>
> ? ? ? ?[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From r.turner at auckland.ac.nz  Wed Dec  1 20:05:54 2010
From: r.turner at auckland.ac.nz (Rolf Turner)
Date: Thu, 2 Dec 2010 08:05:54 +1300
Subject: [R-sig-Geo] problem creating point pattern class object with
	spatstat package
In-Reply-To: <1291201920796-5791421.post@n2.nabble.com>
References: <1291201920796-5791421.post@n2.nabble.com>
Message-ID: <FEB8B802-BBDB-4531-A112-A95B3581D727@auckland.ac.nz>


On 2/12/2010, at 12:12 AM, zbynek.janoska at centrum.cz wrote:

> 
> I have troubles creating ppp object in spatstat using spatstat package.
> I would like to upload some lidar data and convert them to ppp, but error
> occured.
> I am working with dataset lidar, consisnting of two columns (x and y
> coordinates)
> 
>> x1 <- min(lidar[,1])-1
>> x2 <- max(lidar[,1])+1
>> y1 <- min(lidar[,2])-1
>> y2 <- max(lidar[,2])+1
>> owin1 <- owin(c(x1,x2),c(y1,y2))
> 
> so far it works well and I can also plot owin object
> 
>> ppp1 <- ppp(lidar[,1],lidar[,2],owin1)
> Error in owin(...) : 
>  If one of xrange, yrange is specified then both must be.
> 
> I can not get past this error.
> I have succesfully created owin1 - window of class owin, but i can not use
> it to create ppp object
> 
> Does anyone see what mistake I have done?
> Possibly it is something very easy, but I am quite new to R.


Very easy indeed.  RTFM.  It tells you that the argument list for ppp()
is given by:

	ppp(x,y, ..., window, marks, check=TRUE)

and that the ... argument is

	arguments passed to owin to create the window, if window is missing

so it is taking ``owin1'' in your call to be an argument to be passed to as.owin
(which confuses the living Drambuie out of it), rather than being the window argument.

Do:

	ppp1 <- ppp(lidar[,1],lidar[,2],window=owin1)

and all will be well.

	cheers,

		Rolf Turner


From zbynek.janoska at centrum.cz  Wed Dec  1 22:31:39 2010
From: zbynek.janoska at centrum.cz (zbynek.janoska at centrum.cz)
Date: Wed, 1 Dec 2010 13:31:39 -0800 (PST)
Subject: [R-sig-Geo] problem creating point pattern class object with
 spatstat package
In-Reply-To: <FEB8B802-BBDB-4531-A112-A95B3581D727@auckland.ac.nz>
References: <1291201920796-5791421.post@n2.nabble.com>
	<FEB8B802-BBDB-4531-A112-A95B3581D727@auckland.ac.nz>
Message-ID: <1291239099648-5793672.post@n2.nabble.com>


Yes,
thank both of you, specifying arguments has worked indeed.
Sorry about stupid question, just a rookie mistake I hope
-- 
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/problem-creating-point-pattern-class-object-with-spatstat-package-tp5791421p5793672.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From mloranty at whrc.org  Wed Dec  1 22:44:56 2010
From: mloranty at whrc.org (Michael Loranty)
Date: Wed, 1 Dec 2010 16:44:56 -0500
Subject: [R-sig-Geo] temporal interpolation with stackApply
Message-ID: <5FDDBA76-5FA2-4773-882C-0500709635F5@whrc.org>

Hi All,

I have a raster stack, that represents a time series of temperature  
observations, and would like to interpolate temporally to fill gaps in  
the data. That is, to apply a gap-filling function across all layers  
in a stack, pixel by pixel. My hope was to accomplish this using  
stackApply, however this doesn't seem to work. The reason seems to be  
associated with how the data are handled within stackApply which is  
based upon the type of function that is used.

Has anyone else encountered a similar problem or come up with a  
solution? It seems to me that it may not be too difficult to make a a  
function to do this based upon few minor adjustments to the current  
raster function. A simple example is below.

Best,
Mike


 > r <- raster(ncol=10, nrow=10)
 > r[]=1:ncell(r)
 > s <- brick(r,flip(r,direction = "x"),flip(r,direction =  
"y"),r,flip(r,direction = "y"),flip(r,direction = "x"))
 >
 > set.NA <- function(x, na.rm = T){x[x==18] <- NA; return(x)}
 >
 > s <- stackApply(s,fun = set.NA, indices = 1:nlayers(s))
 >
 > fill.NA <- function(x,na.rm = F){
+ 			fill <- approxfun(x, y = NULL, method = 'linear', rule = 2);
+ 			new <- fill(1:length(x));
+ 			rec <- which(is.na(x));
+ 			x[rec] <- new[rec];
+ 			return(x)
+ 			}
 >
 > s < - stackApply(s,fun=fill.NA,indices = 1:nlayers(s))
Error in approxfun(x, y = NULL, method = "linear", rule = 2) :
   need at least two non-NA values to interpolate
 >
 > sessionInfo()
R version 2.11.1 (2010-05-31)
x86_64-apple-darwin9.8.0

other attached packages:
[1] rgdal_0.6-27  raster_1.6-22 sp_0.9-72



Michael Loranty Ph.D.
Postdoctoral Fellow
The Woods Hole Research Center
149 Woods Hole Rd
Falmouth, MA 02540
508.444.1560
mloranty at whrc.org


From r.turner at auckland.ac.nz  Wed Dec  1 22:47:44 2010
From: r.turner at auckland.ac.nz (Rolf Turner)
Date: Thu, 2 Dec 2010 10:47:44 +1300
Subject: [R-sig-Geo] problem creating point pattern class object with
	spatstat package
In-Reply-To: <1291239099648-5793672.post@n2.nabble.com>
References: <1291201920796-5791421.post@n2.nabble.com>
	<FEB8B802-BBDB-4531-A112-A95B3581D727@auckland.ac.nz>
	<1291239099648-5793672.post@n2.nabble.com>
Message-ID: <1377198C-3EBC-4647-9885-8C1A11A939D5@auckland.ac.nz>


On 2/12/2010, at 10:31 AM, zbynek.janoska at centrum.cz wrote:

> 
> Yes,
> thank both of you, specifying arguments has worked indeed.
> Sorry about stupid question, just a rookie mistake I hope.


	``The only stupid question is the one that isn't asked!''

		cheers,

			Rolf Turner

P. S. The ``name=value'' way of specifying function arguments in R
is very powerful but takes a little getting used to.

		R. T.


From r.hijmans at gmail.com  Thu Dec  2 01:34:35 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Wed, 1 Dec 2010 16:34:35 -0800
Subject: [R-sig-Geo] temporal interpolation with stackApply
In-Reply-To: <5FDDBA76-5FA2-4773-882C-0500709635F5@whrc.org>
References: <5FDDBA76-5FA2-4773-882C-0500709635F5@whrc.org>
Message-ID: <AANLkTikEwor_d-FMObMKt8FDmsArnByT0piRZpsSKs7U@mail.gmail.com>

Michael,

Thanks for sending an good self-contained example. If you use
stackApply with layers=1:nlayers you are requesting that the function
should be applied to each layer separately. That is OK for the first
case (set.NA) although 'calc' would be more direct. But it does not
for fill.NA, because that function needs the values of all layers in a
single computations. In this case you must use calc. The below works:


r <- raster(ncol=10, nrow=10)
r[] <- 1:ncell(r)

s <- stack(r,flip(r,direction = "x"),flip(r,direction =
"y"),r,flip(r,direction = "y"),flip(r,direction = "x"))
set.NA <- function(x, na.rm = T){x[x==18] <- NA; return(x)}
s <- calc(s, fun=set.NA)

fill.NA <- function(x,na.rm = F){
    fill <- approxfun(x, y = NULL, method = 'linear', rule = 2)
    rec <- which(is.na(x))
    x[rec] <- fill(rec)
    return(x)
}

ss <- calc(s,fun=fill.NA)


Best, Robert

On Wed, Dec 1, 2010 at 1:44 PM, Michael Loranty <mloranty at whrc.org> wrote:
> Hi All,
>
> I have a raster stack, that represents a time series of temperature
> observations, and would like to interpolate temporally to fill gaps in the
> data. That is, to apply a gap-filling function across all layers in a stack,
> pixel by pixel. My hope was to accomplish this using stackApply, however
> this doesn't seem to work. The reason seems to be associated with how the
> data are handled within stackApply which is based upon the type of function
> that is used.
>
> Has anyone else encountered a similar problem or come up with a solution? It
> seems to me that it may not be too difficult to make a a function to do this
> based upon few minor adjustments to the current raster function. A simple
> example is below.
>
> Best,
> Mike
>
>
>> r <- raster(ncol=10, nrow=10)
>> r[]=1:ncell(r)
>> s <- brick(r,flip(r,direction = "x"),flip(r,direction =
>> "y"),r,flip(r,direction = "y"),flip(r,direction = "x"))
>>
>> set.NA <- function(x, na.rm = T){x[x==18] <- NA; return(x)}
>>
>> s <- stackApply(s,fun = set.NA, indices = 1:nlayers(s))
>>
>> fill.NA <- function(x,na.rm = F){
> + ? ? ? ? ? ? ? ? ? ? ? fill <- approxfun(x, y = NULL, method = 'linear',
> rule = 2);
> + ? ? ? ? ? ? ? ? ? ? ? new <- fill(1:length(x));
> + ? ? ? ? ? ? ? ? ? ? ? rec <- which(is.na(x));
> + ? ? ? ? ? ? ? ? ? ? ? x[rec] <- new[rec];
> + ? ? ? ? ? ? ? ? ? ? ? return(x)
> + ? ? ? ? ? ? ? ? ? ? ? }
>>
>> s < - stackApply(s,fun=fill.NA,indices = 1:nlayers(s))
> Error in approxfun(x, y = NULL, method = "linear", rule = 2) :
> ?need at least two non-NA values to interpolate
>>
>> sessionInfo()
> R version 2.11.1 (2010-05-31)
> x86_64-apple-darwin9.8.0
>
> other attached packages:
> [1] rgdal_0.6-27 ?raster_1.6-22 sp_0.9-72
>
>
>
> Michael Loranty Ph.D.
> Postdoctoral Fellow
> The Woods Hole Research Center
> 149 Woods Hole Rd
> Falmouth, MA 02540
> 508.444.1560
> mloranty at whrc.org
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From mloranty at whrc.org  Thu Dec  2 03:04:35 2010
From: mloranty at whrc.org (Michael Loranty)
Date: Wed, 1 Dec 2010 21:04:35 -0500
Subject: [R-sig-Geo] temporal interpolation with stackApply
In-Reply-To: <AANLkTikEwor_d-FMObMKt8FDmsArnByT0piRZpsSKs7U@mail.gmail.com>
References: <5FDDBA76-5FA2-4773-882C-0500709635F5@whrc.org>
	<AANLkTikEwor_d-FMObMKt8FDmsArnByT0piRZpsSKs7U@mail.gmail.com>
Message-ID: <4B548144-6983-42E3-8B0D-659D16BA6E5D@whrc.org>

Thanks for the quick response, Robert.

I hadn't realized I was misusing the stackApply. For some reason I'm  
getting a similar error with calc.  I don't know how to look at the  
function definition for calc to diagnose further.

Best,
Mike

 > r <- raster(ncol=10, nrow=10)
 > r[]=1:ncell(r)
 > s <- brick(r,flip(r,direction = "x"),flip(r,direction =  
"y"),r,flip(r,direction = "y"),flip(r,direction = "x"))
 >
 > set.NA <- function(x, na.rm = T){x[x==18] <- NA; return(x)}
 >
 > s <- stackApply(s,fun = set.NA, indices = 1:nlayers(s))
 >
 > fill.NA <- function(x,na.rm = F){
+ 			fill <- approxfun(x, y = NULL, method = 'linear', rule = 2);
+ 			new <- fill(1:length(x));
+ 			rec <- which(is.na(x));
+ 			x[rec] <- new[rec];
+ 			return(x)
+ 			}
 >
 > ss < - calc(s,fun=fill.NA)
Error in approxfun(x, y = NULL, method = "linear", rule = 2) :
   need at least two non-NA values to interpolate

 > s[13]
[1] 13 NA 83 13 83 NA
 > fill.NA(s[13])
[1] 13 48 83 13 83 83
 >

Michael Loranty Ph.D.
Postdoctoral Fellow
The Woods Hole Research Center
149 Woods Hole Rd
Falmouth, MA 02540
508.444.1560
mloranty at whrc.org








On Dec 1, 2010, at 7:34 PM, Robert J. Hijmans wrote:

> Michael,
>
> Thanks for sending an good self-contained example. If you use
> stackApply with layers=1:nlayers you are requesting that the function
> should be applied to each layer separately. That is OK for the first
> case (set.NA) although 'calc' would be more direct. But it does not
> for fill.NA, because that function needs the values of all layers in a
> single computations. In this case you must use calc. The below works:
>
>
> r <- raster(ncol=10, nrow=10)
> r[] <- 1:ncell(r)
>
> s <- stack(r,flip(r,direction = "x"),flip(r,direction =
> "y"),r,flip(r,direction = "y"),flip(r,direction = "x"))
> set.NA <- function(x, na.rm = T){x[x==18] <- NA; return(x)}
> s <- calc(s, fun=set.NA)
>
> fill.NA <- function(x,na.rm = F){
>    fill <- approxfun(x, y = NULL, method = 'linear', rule = 2)
>    rec <- which(is.na(x))
>    x[rec] <- fill(rec)
>    return(x)
> }
>
> ss <- calc(s,fun=fill.NA)
>
>
> Best, Robert
>
> On Wed, Dec 1, 2010 at 1:44 PM, Michael Loranty <mloranty at whrc.org>  
> wrote:
>> Hi All,
>>
>> I have a raster stack, that represents a time series of temperature
>> observations, and would like to interpolate temporally to fill gaps  
>> in the
>> data. That is, to apply a gap-filling function across all layers in  
>> a stack,
>> pixel by pixel. My hope was to accomplish this using stackApply,  
>> however
>> this doesn't seem to work. The reason seems to be associated with  
>> how the
>> data are handled within stackApply which is based upon the type of  
>> function
>> that is used.
>>
>> Has anyone else encountered a similar problem or come up with a  
>> solution? It
>> seems to me that it may not be too difficult to make a a function  
>> to do this
>> based upon few minor adjustments to the current raster function. A  
>> simple
>> example is below.
>>
>> Best,
>> Mike
>>
>>
>>> r <- raster(ncol=10, nrow=10)
>>> r[]=1:ncell(r)
>>> s <- brick(r,flip(r,direction = "x"),flip(r,direction =
>>> "y"),r,flip(r,direction = "y"),flip(r,direction = "x"))
>>>
>>> set.NA <- function(x, na.rm = T){x[x==18] <- NA; return(x)}
>>>
>>> s <- stackApply(s,fun = set.NA, indices = 1:nlayers(s))
>>>
>>> fill.NA <- function(x,na.rm = F){
>> +                       fill <- approxfun(x, y = NULL, method =  
>> 'linear',
>> rule = 2);
>> +                       new <- fill(1:length(x));
>> +                       rec <- which(is.na(x));
>> +                       x[rec] <- new[rec];
>> +                       return(x)
>> +                       }
>>>
>>> s < - stackApply(s,fun=fill.NA,indices = 1:nlayers(s))
>> Error in approxfun(x, y = NULL, method = "linear", rule = 2) :
>>  need at least two non-NA values to interpolate
>>>
>>> sessionInfo()
>> R version 2.11.1 (2010-05-31)
>> x86_64-apple-darwin9.8.0
>>
>> other attached packages:
>> [1] rgdal_0.6-27  raster_1.6-22 sp_0.9-72
>>
>>
>>
>> Michael Loranty Ph.D.
>> Postdoctoral Fellow
>> The Woods Hole Research Center
>> 149 Woods Hole Rd
>> Falmouth, MA 02540
>> 508.444.1560
>> mloranty at whrc.org
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>


From r.hijmans at gmail.com  Thu Dec  2 04:37:58 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Wed, 1 Dec 2010 19:37:58 -0800
Subject: [R-sig-Geo] temporal interpolation with stackApply
In-Reply-To: <4B548144-6983-42E3-8B0D-659D16BA6E5D@whrc.org>
References: <5FDDBA76-5FA2-4773-882C-0500709635F5@whrc.org>
	<AANLkTikEwor_d-FMObMKt8FDmsArnByT0piRZpsSKs7U@mail.gmail.com>
	<4B548144-6983-42E3-8B0D-659D16BA6E5D@whrc.org>
Message-ID: <AANLkTi=L=BRCeRpJGg8OoyQkKrxEWy12JwwQMWuko3GB@mail.gmail.com>

Michael,

I think that is because of a difference in versions. The error should
go away with a more recent version of 'raster'. You can get one from
R-Forge:  install.packages("raster",
repos="http://R-Forge.R-project.org")

The current version on CRAN, 1.6-22, has some glitches, and I just
uploaded version 1.7-6 to CRAN. This version should be available for
install from there within 24 hrs.

Robert


On Wed, Dec 1, 2010 at 6:04 PM, Michael Loranty <mloranty at whrc.org> wrote:
> Thanks for the quick response, Robert.
>
> I hadn't realized I was misusing the stackApply. For some reason I'm getting
> a similar error with calc. ?I don't know how to look at the function
> definition for calc to diagnose further.
>
> Best,
> Mike
>
>> r <- raster(ncol=10, nrow=10)
>> r[]=1:ncell(r)
>> s <- brick(r,flip(r,direction = "x"),flip(r,direction =
>> "y"),r,flip(r,direction = "y"),flip(r,direction = "x"))
>>
>> set.NA <- function(x, na.rm = T){x[x==18] <- NA; return(x)}
>>
>> s <- stackApply(s,fun = set.NA, indices = 1:nlayers(s))
>>
>> fill.NA <- function(x,na.rm = F){
> + ? ? ? ? ? ? ? ? ? ? ? fill <- approxfun(x, y = NULL, method = 'linear',
> rule = 2);
> + ? ? ? ? ? ? ? ? ? ? ? new <- fill(1:length(x));
> + ? ? ? ? ? ? ? ? ? ? ? rec <- which(is.na(x));
> + ? ? ? ? ? ? ? ? ? ? ? x[rec] <- new[rec];
> + ? ? ? ? ? ? ? ? ? ? ? return(x)
> + ? ? ? ? ? ? ? ? ? ? ? }
>>
>> ss < - calc(s,fun=fill.NA)
> Error in approxfun(x, y = NULL, method = "linear", rule = 2) :
> ?need at least two non-NA values to interpolate
>
>> s[13]
> [1] 13 NA 83 13 83 NA
>> fill.NA(s[13])
> [1] 13 48 83 13 83 83
>>
>
> Michael Loranty Ph.D.
> Postdoctoral Fellow
> The Woods Hole Research Center
> 149 Woods Hole Rd
> Falmouth, MA 02540
> 508.444.1560
> mloranty at whrc.org
>
>
>
>
>
>
>
>
> On Dec 1, 2010, at 7:34 PM, Robert J. Hijmans wrote:
>
>> Michael,
>>
>> Thanks for sending an good self-contained example. If you use
>> stackApply with layers=1:nlayers you are requesting that the function
>> should be applied to each layer separately. That is OK for the first
>> case (set.NA) although 'calc' would be more direct. But it does not
>> for fill.NA, because that function needs the values of all layers in a
>> single computations. In this case you must use calc. The below works:
>>
>>
>> r <- raster(ncol=10, nrow=10)
>> r[] <- 1:ncell(r)
>>
>> s <- stack(r,flip(r,direction = "x"),flip(r,direction =
>> "y"),r,flip(r,direction = "y"),flip(r,direction = "x"))
>> set.NA <- function(x, na.rm = T){x[x==18] <- NA; return(x)}
>> s <- calc(s, fun=set.NA)
>>
>> fill.NA <- function(x,na.rm = F){
>> ? fill <- approxfun(x, y = NULL, method = 'linear', rule = 2)
>> ? rec <- which(is.na(x))
>> ? x[rec] <- fill(rec)
>> ? return(x)
>> }
>>
>> ss <- calc(s,fun=fill.NA)
>>
>>
>> Best, Robert
>>
>> On Wed, Dec 1, 2010 at 1:44 PM, Michael Loranty <mloranty at whrc.org> wrote:
>>>
>>> Hi All,
>>>
>>> I have a raster stack, that represents a time series of temperature
>>> observations, and would like to interpolate temporally to fill gaps in
>>> the
>>> data. That is, to apply a gap-filling function across all layers in a
>>> stack,
>>> pixel by pixel. My hope was to accomplish this using stackApply, however
>>> this doesn't seem to work. The reason seems to be associated with how the
>>> data are handled within stackApply which is based upon the type of
>>> function
>>> that is used.
>>>
>>> Has anyone else encountered a similar problem or come up with a solution?
>>> It
>>> seems to me that it may not be too difficult to make a a function to do
>>> this
>>> based upon few minor adjustments to the current raster function. A simple
>>> example is below.
>>>
>>> Best,
>>> Mike
>>>
>>>
>>>> r <- raster(ncol=10, nrow=10)
>>>> r[]=1:ncell(r)
>>>> s <- brick(r,flip(r,direction = "x"),flip(r,direction =
>>>> "y"),r,flip(r,direction = "y"),flip(r,direction = "x"))
>>>>
>>>> set.NA <- function(x, na.rm = T){x[x==18] <- NA; return(x)}
>>>>
>>>> s <- stackApply(s,fun = set.NA, indices = 1:nlayers(s))
>>>>
>>>> fill.NA <- function(x,na.rm = F){
>>>
>>> + ? ? ? ? ? ? ? ? ? ? ? fill <- approxfun(x, y = NULL, method = 'linear',
>>> rule = 2);
>>> + ? ? ? ? ? ? ? ? ? ? ? new <- fill(1:length(x));
>>> + ? ? ? ? ? ? ? ? ? ? ? rec <- which(is.na(x));
>>> + ? ? ? ? ? ? ? ? ? ? ? x[rec] <- new[rec];
>>> + ? ? ? ? ? ? ? ? ? ? ? return(x)
>>> + ? ? ? ? ? ? ? ? ? ? ? }
>>>>
>>>> s < - stackApply(s,fun=fill.NA,indices = 1:nlayers(s))
>>>
>>> Error in approxfun(x, y = NULL, method = "linear", rule = 2) :
>>> ?need at least two non-NA values to interpolate
>>>>
>>>> sessionInfo()
>>>
>>> R version 2.11.1 (2010-05-31)
>>> x86_64-apple-darwin9.8.0
>>>
>>> other attached packages:
>>> [1] rgdal_0.6-27 ?raster_1.6-22 sp_0.9-72
>>>
>>>
>>>
>>> Michael Loranty Ph.D.
>>> Postdoctoral Fellow
>>> The Woods Hole Research Center
>>> 149 Woods Hole Rd
>>> Falmouth, MA 02540
>>> 508.444.1560
>>> mloranty at whrc.org
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>
>
>


From wul1984 at gmail.com  Thu Dec  2 06:40:10 2010
From: wul1984 at gmail.com (=?GB2312?B?wu2/yQ==?=)
Date: Thu, 2 Dec 2010 13:40:10 +0800
Subject: [R-sig-Geo] Digit positions in writing files
In-Reply-To: <AANLkTikVDTRroppH8G9hnBboekSmjpnhdiracY-+OTV6@mail.gmail.com>
References: <AANLkTik8Jjrr89UzEO1DCHGO7BG_NF5Nwj1j35P7q+vK@mail.gmail.com>
	<AANLkTikVDTRroppH8G9hnBboekSmjpnhdiracY-+OTV6@mail.gmail.com>
Message-ID: <AANLkTikm-6GrBCQoHMxa9E4uTQPzYUar2VTbTrNs2Rku@mail.gmail.com>

Thanks Robert,sprintf works exactly what I want~

Marco



2010/12/2 Robert J. Hijmans <r.hijmans at gmail.com>:
> Have a look at sprintf
>
> Robert
>
> On Wed, Dec 1, 2010 at 2:41 AM, ?? <wul1984 at gmail.com> wrote:
>> Hi, list:
>>
>> I am processing a kind of data which has very strict format on digit
>> position, ie., for the first column, the last digit should be in column 5,
>> the second in column 10, and 16, 24, 32 for the 3rd, 4th, and 5th,
>> respectively. Here is the segment:
>>
>>        29  -999  1051   69.58   23.53
>>        30  -999  1052   70.67   23.67
>>        31  -999  1053   70.68   23.68
>>        32  -999  1055   71.10   24.00
>>         .......
>>   13642 -999 97890   -7.83  129.67
>>   13643   30 97900   -7.98  131.30
>>   13644  100 97980   -8.47  140.38
>>   13645   66 98132   20.80  121.85
>>   13646 -999 98133   19.27  121.47
>>
>> My aim is to replace the coordinates of certain rows using new coordinates,
>> and put the whole file back into the same filee, but it seems that I can
>> only get constant spaces between each column if I use write.table, with
>> sep=' '. So, my question is, is there any way that I could get the desired
>> format? By the way, I have more than 10,000 rows in each file (day), and 365
>> days for each year, I think for me, R is the only way to do this.
>>
>> Thanks in advance~
>>
>> Best regards~
>>
>> Marco
>>
>>        [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>



-- 
-------------------------------------------------------
Chinese Ecological Research Network,
Institute of Geographical Science and Natural Resource Research,
 Chinese Academy Of Science,
100101, Beijing
Tel: (86)-10-64880 9809


From advaitgodbole at gmail.com  Thu Dec  2 14:16:12 2010
From: advaitgodbole at gmail.com (Advait Godbole)
Date: Thu, 2 Dec 2010 08:16:12 -0500
Subject: [R-sig-Geo] gridded time series analysis
In-Reply-To: <AANLkTikd-PJKWZdWUL2+S9VYAq1QJ4LPwG2==erEs2+Q@mail.gmail.com>
References: <AANLkTimTdxzoDCfJQOB8bgQRhjLy3YzSbtGtMdijk9sQ@mail.gmail.com>
	<771411.8321.qm@web29709.mail.ird.yahoo.com>
	<AANLkTin2DYocWNOAR-LfGoBP4+gCtA7eVDHmoaQ6wriR@mail.gmail.com>
	<AANLkTimFw1zMH75s+TG+SFkBHfXzpURm2WXskAa8Kp=m@mail.gmail.com>
	<AANLkTim9dBnVkZ0tjvoa1YRpPRr156jJ9zcezMDrtzhX@mail.gmail.com>
	<AANLkTi=vW6NXYXKGNa0gcTfZ8ezEjvegdxU3Dt5SPA4F@mail.gmail.com>
	<AANLkTikqNmC62Pv-n9Dxd1w7fTHJPx8cR72U6YEtWMTV@mail.gmail.com>
	<AANLkTikQsL9opzu1i0mWxtJA6YmcgBbGdbihXFOwPRho@mail.gmail.com>
	<AANLkTinY5+3JbpZfWnriDZNOdmcfic0628Qi0=NDZghK@mail.gmail.com>
	<AANLkTikd-PJKWZdWUL2+S9VYAq1QJ4LPwG2==erEs2+Q@mail.gmail.com>
Message-ID: <AANLkTi=eZL0Rq5EyoRA29fdnN2VL-Xt6hcGN4DnZgCKk@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101202/e5f4855e/attachment.pl>

From isabelle.boulangeat at gmail.com  Thu Dec  2 18:02:36 2010
From: isabelle.boulangeat at gmail.com (isabelle boulangeat)
Date: Thu, 2 Dec 2010 18:02:36 +0100
Subject: [R-sig-Geo] new function predict, package raster
Message-ID: <AANLkTikU1d4LrvtOCsVUb3FOVWV+NMcL2cpjvC8Bw8OC@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101202/70c8df76/attachment.pl>

From r.hijmans at gmail.com  Thu Dec  2 19:14:02 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Thu, 2 Dec 2010 10:14:02 -0800
Subject: [R-sig-Geo] new function predict, package raster
In-Reply-To: <AANLkTikU1d4LrvtOCsVUb3FOVWV+NMcL2cpjvC8Bw8OC@mail.gmail.com>
References: <AANLkTikU1d4LrvtOCsVUb3FOVWV+NMcL2cpjvC8Bw8OC@mail.gmail.com>
Message-ID: <AANLkTim4_1NH-sJE1OkUAgari22wy1_V=AHf8F5MB3v=@mail.gmail.com>

Isabelle,

If you use a factor that is represented by numbers on a grid you can
just fit the model (with the factor variable as factor), and the
predict function will then make a factor from the predictor layers
(i.e. there is nothing else you need to do). Where this can go wrong
is if you have factor levels on your raster that were not in the data
used to fit the model. You can get something like:
Error in model.frame.default(Terms, newdata, na.action = na.action,
xlev = object$xlevels) :
  factor 'x' has new level(s):  2, 3, 4, 5,
Which means that you first need to remove those levels (set to NA)
from your predictor raster. (I will try to automate that problem away,
in raster::predict, eventually)

The argument "const" is for factor type variables for which you do not
have spatial data. Hence they could be considered 'constant' in some
contexts. For example, with fish observation data you might have a
model that predicts abundance from a number of variables including the
method used to catch the fish. Say a factor variable "method" with
levels "A" or "B". You can then do something like
method = factor("A")
predict(raster, model, const=method)

Robert

On Thu, Dec 2, 2010 at 9:02 AM, isabelle boulangeat
<isabelle.boulangeat at gmail.com> wrote:
> Hello,
>
> I am trying to use the recently updated function "predict" from the package
> raster. I would like to use the field "const", as one of my variable is
> categorial.
> I have an error message but I can't find where is the problem.
>
> Error message : Erreur dans `[.data.frame`(blockvals, , f[i]) : undefined
> columns selected
>
> code : Pred_fac <- predict(rasStack, model=model_fac, predict=predict.glm,
> progress='text', const=factorDF)
>
> rasStack is a RasterStack and contains only one layer with one explicative
> variable. the layer name is the same as in the model.
> factorDF is a data.frame and contains only one column with one explicative
> variable. the column name is the same as in the model.
>
> the dimensions are the same : the number of rows in the data frame
> correspond to the number of cells in the raster.
>
> Does someone succeed to use this function with the new field "const" ?
>
> Thanks for help,
>
> Cheers,
>
> Isabelle.
>
> --
> Isabelle Boulangeat, PhD student
> Ecosystem dynamics and plant traits
>
> Bureau 203, +33 (0) 476 635 733
>
> Laboratoire d'?cologie Alpine (LECA)
> Grenoble, France
> lab' s website : http://www-leca.ujf-grenoble.fr/
> my website : http://j.boulangeat.free.fr/
>
> ? ? ? ?[[alternative HTML version deleted]]
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>


From moshersteven at gmail.com  Thu Dec  2 19:23:23 2010
From: moshersteven at gmail.com (steven mosher)
Date: Thu, 2 Dec 2010 10:23:23 -0800
Subject: [R-sig-Geo] gridded time series analysis
In-Reply-To: <AANLkTi=eZL0Rq5EyoRA29fdnN2VL-Xt6hcGN4DnZgCKk@mail.gmail.com>
References: <AANLkTimTdxzoDCfJQOB8bgQRhjLy3YzSbtGtMdijk9sQ@mail.gmail.com>
	<771411.8321.qm@web29709.mail.ird.yahoo.com>
	<AANLkTin2DYocWNOAR-LfGoBP4+gCtA7eVDHmoaQ6wriR@mail.gmail.com>
	<AANLkTimFw1zMH75s+TG+SFkBHfXzpURm2WXskAa8Kp=m@mail.gmail.com>
	<AANLkTim9dBnVkZ0tjvoa1YRpPRr156jJ9zcezMDrtzhX@mail.gmail.com>
	<AANLkTi=vW6NXYXKGNa0gcTfZ8ezEjvegdxU3Dt5SPA4F@mail.gmail.com>
	<AANLkTikqNmC62Pv-n9Dxd1w7fTHJPx8cR72U6YEtWMTV@mail.gmail.com>
	<AANLkTikQsL9opzu1i0mWxtJA6YmcgBbGdbihXFOwPRho@mail.gmail.com>
	<AANLkTinY5+3JbpZfWnriDZNOdmcfic0628Qi0=NDZghK@mail.gmail.com>
	<AANLkTikd-PJKWZdWUL2+S9VYAq1QJ4LPwG2==erEs2+Q@mail.gmail.com>
	<AANLkTi=eZL0Rq5EyoRA29fdnN2VL-Xt6hcGN4DnZgCKk@mail.gmail.com>
Message-ID: <AANLkTikVto4GD=vO=5YKwKXL7y+Ze4ADn2KXpsw1AFVA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101202/4c06aa65/attachment.pl>

From r.hijmans at gmail.com  Thu Dec  2 19:43:05 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Thu, 2 Dec 2010 10:43:05 -0800
Subject: [R-sig-Geo] gridded time series analysis
In-Reply-To: <AANLkTikVto4GD=vO=5YKwKXL7y+Ze4ADn2KXpsw1AFVA@mail.gmail.com>
References: <AANLkTimTdxzoDCfJQOB8bgQRhjLy3YzSbtGtMdijk9sQ@mail.gmail.com>
	<771411.8321.qm@web29709.mail.ird.yahoo.com>
	<AANLkTin2DYocWNOAR-LfGoBP4+gCtA7eVDHmoaQ6wriR@mail.gmail.com>
	<AANLkTimFw1zMH75s+TG+SFkBHfXzpURm2WXskAa8Kp=m@mail.gmail.com>
	<AANLkTim9dBnVkZ0tjvoa1YRpPRr156jJ9zcezMDrtzhX@mail.gmail.com>
	<AANLkTi=vW6NXYXKGNa0gcTfZ8ezEjvegdxU3Dt5SPA4F@mail.gmail.com>
	<AANLkTikqNmC62Pv-n9Dxd1w7fTHJPx8cR72U6YEtWMTV@mail.gmail.com>
	<AANLkTikQsL9opzu1i0mWxtJA6YmcgBbGdbihXFOwPRho@mail.gmail.com>
	<AANLkTinY5+3JbpZfWnriDZNOdmcfic0628Qi0=NDZghK@mail.gmail.com>
	<AANLkTikd-PJKWZdWUL2+S9VYAq1QJ4LPwG2==erEs2+Q@mail.gmail.com>
	<AANLkTi=eZL0Rq5EyoRA29fdnN2VL-Xt6hcGN4DnZgCKk@mail.gmail.com>
	<AANLkTikVto4GD=vO=5YKwKXL7y+Ze4ADn2KXpsw1AFVA@mail.gmail.com>
Message-ID: <AANLkTinUvhmDLP2YSWuqb5=G0YKX=sWp6yMOj9KPAgdA@mail.gmail.com>

The question marks indicate that the min and max values are not known
to the object (because the file type does not store them, and it is
too 'expensive' to determine them on the fly). setMinMax if you really
need to know.
The error on trim seems to be a problem with layerNames being numeric.
I'll fix that. This may be a work-around






On Thu, Dec 2, 2010 at 10:23 AM, steven mosher <moshersteven at gmail.com> wrote:
> ?see the setMinMax()
>
> ?for the error on trim() I'm not sure.
>
> On Thu, Dec 2, 2010 at 5:16 AM, Advait Godbole <advaitgodbole at gmail.com>
> wrote:
>>
>> That worked perfectly. Thanks for pointing this out. I changed the way my
>> variables were being written to the netCDF and now "brick" works. However,
>> I
>> am getting an error while using the stack function, like so:
>>
>> "Error in function (classes, fdef, mtable) ?:
>> ?unable to find an inherited method for function "trim", for signature
>> "integer"
>>
>> The two rasters show the following:
>> > rcmraster
>> class ? ? ? : RasterBrick
>> filename ? ?: regcm.cumul.hdd.10k.96_05.fixed.latlonvars.nc
>> nlayers ? ? : 120
>> nrow ? ? ? ?: 356
>> ncol ? ? ? ?: 507
>> ncell ? ? ? : 180492
>> projection ?: +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0
>> min value ? : ? ? ? ? ? ? ? ? ? ?
>> max value ? : ? ? ? ? ? ? ? ? ? ?
>> xmin ? ? ? ?: -137.3312
>> xmax ? ? ? ?: -62.11259
>> ymin ? ? ? ?: 22.12693
>> ymax ? ? ? ?: 57.35954
>> xres ? ? ? ?: 0.1483602
>> yres ? ? ? ?: 0.09896801
>>
>> > emitraster
>> class ? ? ? : RasterBrick
>> filename ? ?:
>> flip.percap.vulcan.10k.dp.build.381.RES.EIAmy.96_05.this.latest.nc
>> nlayers ? ? : 120
>> nrow ? ? ? ?: 356
>> ncol ? ? ? ?: 507
>> ncell ? ? ? : 180492
>> projection ?: +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0
>> min value ? : ? ? ? ? ? ? ? ? ? ?
>> max value ? : ? ? ? ? ? ? ? ? ? ?
>> xmin ? ? ? ?: -137.3312
>> xmax ? ? ? ?: -62.11259
>> ymin ? ? ? ?: 22.12693
>> ymax ? ? ? ?: 57.35954
>> xres ? ? ? ?: 0.1483602
>> yres ? ? ? ?: 0.09896801
>>
>> A getValues call shows a lot of NAs. Now, my original file does have a
>> large
>> number of missing values so that is why this should happen, but I suspect
>> something is going wrong since the min and max values are not being
>> displayed for either of these rasters. Is that the source of the problem
>> in
>> the "stack" function?
>>
>> Thanks,
>>
>> Advait
>>
>> On Tue, Nov 30, 2010 at 5:18 PM, Robert J. Hijmans
>> <r.hijmans at gmail.com>wrote:
>>
>> > Advait,
>> >
>> > The is an error in the file, I think, see below:
>> >
>> > > library(ncdf)
>> > > filename = "c:/downloads/regcm.cumul.hdd.10k.96_05.new.nc"
>> > > nc <- open.ncdf(filename)
>> > >
>> > > zvar <- 'hdd'
>> > > nc$var[[zvar]]$dim[[1]]$len
>> > [1] 507
>> > > nc$var[[zvar]]$dim[[2]]$len
>> > [1] 356
>> > >
>> > > xx <- nc$var[[zvar]]$dim[[1]]$vals
>> > > # should be a vector of 507 longitudes but:
>> > > dim(xx)
>> > [1] 507 356 120
>> > >
>> > > # works anyway
>> > > xrange <- c(min(xx), max(xx))
>> > > xrange
>> > [1] -137.25705 ?-62.18677
>> > >
>> > > yy <- nc$var[[zvar]]$dim[[2]]$vals
>> > > # should be a vector of 356 latitudes but:
>> > > dim(yy)
>> > [1] 507 356 120
>> > >
>> > > # this fails
>> > > yrange <- c(min(yy), max(yy))
>> > > yrange
>> > [1] NaN NaN
>> > > # and that is the only reason why raster failed.
>> > >
>> > > #OK
>> > > yy[,,1][1:10,350:355]
>> > ? ? ? ? ?[,1] ? ? [,2] ? ? [,3] ? ? [,4] ? ? [,5] ? ? [,6]
>> > ?[1,] 51.49148 51.57122 51.65092 51.73055 51.81014 51.88967
>> > ?[2,] 51.52888 51.60866 51.68839 51.76807 51.84769 51.92727
>> > ?[3,] 51.56616 51.64598 51.72575 51.80547 51.88513 51.96474
>> > ?[4,] 51.60332 51.68318 51.76299 51.84275 51.92245 52.00210
>> > ?[5,] 51.64036 51.72026 51.80011 51.87991 51.95965 52.03934
>> > ?[6,] 51.67728 51.75722 51.83711 51.91695 51.99673 52.07646
>> > ?[7,] 51.71409 51.79407 51.87399 51.95387 52.03369 52.11345
>> > ?[8,] 51.75077 51.83079 51.91076 51.99067 52.07053 52.15033
>> > ?[9,] 51.78734 51.86739 51.94740 52.02735 52.10725 52.18709
>> > [10,] 51.82378 51.90388 51.98392 52.06391 52.14385 52.22373
>> > >
>> > > #bad values here (and note the NaN):
>> > > yy[,,120][1:10,350:355]
>> > ? ? ? ? ? ? ? ?[,1] ? ? ? ? ? [,2] ? ? ? ? ? [,3] ? ? ? ? ? [,4]
>> > ? ? [,5] ? ? ? ? ? [,6]
>> > ?[1,] -1.313847e-229 -4.895880e-272 -7.553765e-266 ? 1.293814e+58
>> > 9.551441e-293 ?-3.291580e-36
>> > ?[2,] -5.321424e+272 -3.076997e-223 ?-1.515780e-33 -9.895836e+171
>> > 3.115686e-149 ?-4.970539e+92
>> > ?[3,] ?5.259277e-203 ? 5.980335e-56 ?2.893449e-212 ?2.974200e+274
>> > 3.186547e-218 ?2.503689e+296
>> > ?[4,] -3.977129e+225 -3.696719e-283 ? 1.284612e+42 ? 1.887923e+28
>> > -2.322520e+268 ?5.005820e-108
>> > ?[5,] ?-6.569744e+88 ? 1.824506e-74 ? 7.663356e+39 ?1.608759e-201
>> > -1.433761e+110 -8.804183e-211
>> > ?[6,] -4.237822e-162 ? ? ? ? ? ?NaN ?7.405904e-275 ?5.859877e-258
>> > 1.339820e+110 ?1.631993e+229
>> > ?[7,] ? 5.603325e-64 ? 4.188764e+37 -2.188887e+243 -4.657907e+280
>> > 1.795268e-185 ?1.166057e-175
>> > ?[8,] -2.112804e-229 ?4.536625e+137 ?2.910322e-278 ?4.407645e-274
>> > 8.886205e-239 -1.913860e+238
>> > ?[9,] ?-9.126350e+44 -1.866422e+177 -2.578975e+256 ?3.275379e+208
>> > -2.657457e+75 ?-1.258259e-90
>> > [10,] ?6.698325e+216 -2.958355e+137 -1.058748e-178 -1.776776e+215
>> > -6.368807e+78 -5.337653e+299
>> > >
>> > > # this would have worked
>> > > yrange <- c(min(yy[,,1]), max(yy[,,1]))
>> > > yrange
>> > [1] 22.17641 57.31006
>> > >
>> > > close.ncdf(nc)
>> >
>> >
>> > Best, Robert
>> >
>> >
>> > On Tue, Nov 30, 2010 at 10:37 AM, Advait Godbole
>> > <advaitgodbole at gmail.com> wrote:
>> > > Dear Robert,
>> > > here is the link to the file:
>> > > http://dl.dropbox.com/u/4030944/regcm.cumul.hdd.10k.96_05.new.nc. It
>> > > is
>> > a
>> > > large file ~400 MB. Let me know if dropbox is not convenient and you
>> > would
>> > > rather do ftp - ?but our machines are down for maintenance and I may
>> > > not
>> > be
>> > > immediately able to get access.
>> > > I was going over the NCL code that processes the files but did not
>> > > find
>> > > anything glaringly amiss, so I will have to look at it in greater
>> > > detail
>> > > since it is clear that the number of entries in the variables is not
>> > right
>> > > as you've pointed out. There is a chance that I have not written out
>> > > the
>> > > co-ordinates properly.
>> > > Thanks,
>> > > Advait
>> > > On Mon, Nov 29, 2010 at 1:14 PM, Robert J. Hijmans
>> > > <r.hijmans at gmail.com>
>> > > wrote:
>> > >>
>> > >> Advait,
>> > >> I do not think I can help you further unless you send me your file;
>> > >> but this suggests that it is either not following the CF standards,
>> > >> or
>> > >> something is wrong with the file, or that there is something I have
>> > >> not understood about these files.
>> > >> You said you have 507 x 356 x 120 values. I would expect
>> > >> length(frcm$dim[[1]]$vals) == 507 and length(frcm$dim[[2]]$vals) ==
>> > >> 356
>> > >> Robert
>> > >>
>> > >> On Mon, Nov 29, 2010 at 6:11 AM, Advait Godbole <
>> > advaitgodbole at gmail.com>
>> > >> wrote:
>> > >> > sorry to disrupt the flow of the conversation, but after doing what
>> > >> > Robert
>> > >> > suggested, this is what was returned:
>> > >> >> length(frcm$dim[[1]]$vals)
>> > >> > [1] 21659040
>> > >> >> length(frcm$dim[[2]]$vals)
>> > >> > [1] 21659040
>> > >> > the other two functions return the latitude and longitude arrays
>> > >> > not
>> > >> > populated with NAs/missing values. I havent reproduced them here
>> > because
>> > >> > of
>> > >> > their number.
>> > >> > Regards,
>> > >> > advait
>> > >> > On Sat, Nov 27, 2010 at 3:48 PM, Robert J. Hijmans <
>> > r.hijmans at gmail.com>
>> > >> > wrote:
>> > >> >>
>> > >> >> Advait,
>> > >> >>
>> > >> >> That suggests that you have missing values in the lon or lat
>> > >> >> dimensions. Is that true? That would be awkward, but perhaps
>> > something
>> > >> >> else is going on. Can you send me your file? If not can you send
>> > >> >> the
>> > >> >> results of this:
>> > >> >>
>> > >> >> filename <- "regcm.cumul.hdd.10k.96_05.new.nc"
>> > >> >> nc <- open.ncdf(filename)
>> > >> >> length(nc$dim[[1]]$vals)
>> > >> >> length(nc$dim[[2]]$vals)
>> > >> >> nc$dim[[1]]$vals
>> > >> >> nc$dim[[2]]$vals
>> > >> >> close.ncdf(nc)
>> > >> >>
>> > >> >> Thanks, Robert
>> > >> >>
>> > >> >> On Sat, Nov 27, 2010 at 8:36 AM, Advait Godbole
>> > >> >> <advaitgodbole at gmail.com>
>> > >> >> wrote:
>> > >> >> > Thanks everyone for these leads..However, I am running into
>> > problems
>> > >> >> > with
>> > >> >> > data handling. I used ncdf to extract the two variables (507 x
>> > >> >> > 356
>> > x
>> > >> >> > 120
>> > >> >> > -
>> > >> >> > lon,lat,time) and converted them into array objects. The
>> > suggestions
>> > >> >> > provided all utilize the raster package, but using "brick" on
>> > >> >> > the
>> > >> >> > file
>> > >> >> > returns this error: "rcmraster <-
>> > >> >> > brick("regcm.cumul.hdd.10k.96_05.new.nc")
>> > >> >> > Error in if (e at xmin > -400 & e at xmax < 400 & e at ymin > -90.1 &
>> > e at ymax <
>> > >> >> > ?:
>> > >> >> > missing value where TRUE/FALSE needed"
>> > >> >> >
>> > >> >> > I have a fair number of NAs (all missing values in the original
>> > >> >> > variables).
>> > >> >> > Is there a way to set a flag for that? Or any other workaround?
>> > >> >> > Thanks much,
>> > >> >> > advait
>> > >> >> > On Fri, Nov 26, 2010 at 6:25 PM, Robert J. Hijmans
>> > >> >> > <r.hijmans at gmail.com>
>> > >> >> > wrote:
>> > >> >> >>
>> > >> >> >> There are some difference in the behavior of 'calc' between
>> > >> >> >> functions,
>> > >> >> >> because of attempts to accommodate different functions &
>> > intentions.
>> > >> >> >> But in 'raster' 1.7-4 (available from R-Forge in ~ 24 hrs; and
>> > from
>> > >> >> >> CRAN soon), the below will work:
>> > >> >> >>
>> > >> >> >> library(raster)
>> > >> >> >> #creating some data
>> > >> >> >> r <- raster(nrow=10, ncol=10)
>> > >> >> >> s1 <- s2<- list()
>> > >> >> >> for (i in 1:12) {
>> > >> >> >> ? ? ? ?s1[i] <- setValues(r, rnorm(ncell(r), i, 3) )
>> > >> >> >> ? ? ? ?s2[i] <- setValues(r, rnorm(ncell(r), i, 3) )
>> > >> >> >> }
>> > >> >> >> s1 <- stack(s1)
>> > >> >> >> s2 <- stack(s2)
>> > >> >> >>
>> > >> >> >> # regression of values in one brick (or stack) with another
>> > (Jacob's
>> > >> >> >> suggestion)
>> > >> >> >> s <- stack(s1, s2)
>> > >> >> >> # s1 and s2 have 12 layers
>> > >> >> >> fun <- function(x) { lm(x[1:12] ~ x[13:24])$coefficients[2] }
>> > >> >> >> x1 <- calc(s, fun)
>> > >> >> >>
>> > >> >> >> # regression of values in one brick (or stack) with 'time'
>> > >> >> >> time <- 1:nlayers(s)
>> > >> >> >> fun <- function(x) { lm(x ~ time)$coefficients[2] }
>> > >> >> >> x2 <- calc(s, fun)
>> > >> >> >>
>> > >> >> >> # get multiple layers, e.g. the slope _and_ intercept
>> > >> >> >> fun <- function(x) { lm(x ~ time)$coefficients }
>> > >> >> >> x3 <- calc(s, fun)
>> > >> >> >>
>> > >> >> >> If this does not work in your version, you can use apply( ) as
>> > >> >> >> in
>> > >> >> >> what
>> > >> >> >> I send earlier.
>> > >> >> >>
>> > >> >> >> Robert
>> > >> >> >>
>> > >> >> >> On Fri, Nov 26, 2010 at 2:56 PM, Robert J. Hijmans
>> > >> >> >> <r.hijmans at gmail.com>
>> > >> >> >> wrote:
>> > >> >> >> > It seems that 'calc' does not like this (any more; another
>> > >> >> >> > thing
>> > >> >> >> > to
>> > >> >> >> > fix) . If your rasters are not very large you can use apply,
>> > which
>> > >> >> >> > makes it much faster:
>> > >> >> >> >
>> > >> >> >> > library(raster)
>> > >> >> >> > #creating some data
>> > >> >> >> > r <- raster(nrow=10, ncol=10)
>> > >> >> >> > s <- list()
>> > >> >> >> > for (i in 1:25) { s[i] <- setValues(r, rnorm(ncell(r), i, 3)
>> > >> >> >> > ) }
>> > >> >> >> > s <- stack(s)
>> > >> >> >> >
>> > >> >> >> > # regression
>> > >> >> >> > time <- 1:nlayers(s)
>> > >> >> >> > fun <- function(x) { lm(x ~ time)$coefficients[2] }
>> > >> >> >> > r[] <- apply(getValues(s), 1, fun)
>> > >> >> >> >
>> > >> >> >> > Robert
>> > >> >> >> >
>> > >> >> >> >
>> > >> >> >> >
>> > >> >> >> > On Fri, Nov 26, 2010 at 2:51 PM, Jacob van Etten
>> > >> >> >> > <jacobvanetten at yahoo.com> wrote:
>> > >> >> >> >> you could try this approach (use calc whenever you can):
>> > >> >> >> >>
>> > >> >> >> >> (supposing your bricks have 12 layers)
>> > >> >> >> >>
>> > >> >> >> >> br3 <- stack(brick1, brick2)
>> > >> >> >> >> lmS <- function(x) lm(x[1:12] ~ x[13:24)$coefficients[2]
>> > >> >> >> >> r <- calc(br3, lmS)
>> > >> >> >> >>
>> > >> >> >> >> Jacob.
>> > >> >> >> >>
>> > >> >> >> >> --- On Fri, 26/11/10, steven mosher <moshersteven at gmail.com>
>> > >> >> >> >> wrote:
>> > >> >> >> >>
>> > >> >> >> >> From: steven mosher <moshersteven at gmail.com>
>> > >> >> >> >> Subject: Re: [R-sig-Geo] gridded time series analysis
>> > >> >> >> >> To: "Martin" <martin_brandt at gmx.net>
>> > >> >> >> >> Cc: r-sig-geo at stat.math.ethz.ch
>> > >> >> >> >> Date: Friday, 26 November, 2010, 23:33
>> > >> >> >> >>
>> > >> >> >> >> that's cool, I'm also interested in a similar problem but
>> > >> >> >> >> just
>> > >> >> >> >> with
>> > >> >> >> >> one
>> > >> >> >> >> brick ending up with a slope raster as the output. It may be
>> > >> >> >> >> possible
>> > >> >> >> >> with
>> > >> >> >> >> stackApply(). have a look. or maybe robert will chime in
>> > >> >> >> >>
>> > >> >> >> >>
>> > >> >> >> >>
>> > >> >> >> >> On Fri, Nov 26, 2010 at 1:35 PM, Martin
>> > >> >> >> >> <martin_brandt at gmx.net
>> > >
>> > >> >> >> >> wrote:
>> > >> >> >> >>
>> > >> >> >> >>>
>> > >> >> >> >>> this is what I did to perform a regression between two
>> > >> >> >> >>> bricks
>> > >> >> >> >>> (each
>> > >> >> >> >>> brick
>> > >> >> >> >>> represent a time series):
>> > >> >> >> >>>
>> > >> >> >> >>> r <- raster(brick1)
>> > >> >> >> >>> for (i in 1:ncell(r)) {
>> > >> >> >> >>> r[i] = lm(as.ts(cellValues(brick1, i)) ~
>> > >> >> >> >>> as.ts(cellValues(brick2,
>> > >> >> >> >>> i)))$coefficients[2]
>> > >> >> >> >>> }
>> > >> >> >> >>>
>> > >> >> >> >>> The result will be a slope raster, but it really takes a
>> > >> >> >> >>> lot
>> > of
>> > >> >> >> >>> time,
>> > >> >> >> >>> so
>> > >> >> >> >>> maybe there is a better solution..
>> > >> >> >> >>>
>> > >> >> >> >>>
>> > >> >> >> >>> --
>> > >> >> >> >>> View this message in context:
>> > >> >> >> >>>
>> > >> >> >> >>>
>> > >> >> >> >>>
>> > >> >> >> >>>
>> >
>> > http://r-sig-geo.2731867.n2.nabble.com/gridded-time-series-analysis-tp5775651p5778472.html
>> > >> >> >> >>> Sent from the R-sig-geo mailing list archive at Nabble.com.
>> > >> >> >> >>>
>> > >> >> >> >>> _______________________________________________
>> > >> >> >> >>> R-sig-Geo mailing list
>> > >> >> >> >>> R-sig-Geo at stat.math.ethz.ch
>> > >> >> >> >>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> > >> >> >> >>>
>> > >> >> >> >>
>> > >> >> >> >> ? ? [[alternative HTML version deleted]]
>> > >> >> >> >>
>> > >> >> >> >> _______________________________________________
>> > >> >> >> >> R-sig-Geo mailing list
>> > >> >> >> >> R-sig-Geo at stat.math.ethz.ch
>> > >> >> >> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> > >> >> >> >>
>> > >> >> >> >>
>> > >> >> >> >>
>> > >> >> >> >>
>> > >> >> >> >> ? ? ? ?[[alternative HTML version deleted]]
>> > >> >> >> >>
>> > >> >> >> >>
>> > >> >> >> >> _______________________________________________
>> > >> >> >> >> R-sig-Geo mailing list
>> > >> >> >> >> R-sig-Geo at stat.math.ethz.ch
>> > >> >> >> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> > >> >> >> >>
>> > >> >> >> >>
>> > >> >> >> >
>> > >> >> >>
>> > >> >> >> _______________________________________________
>> > >> >> >> R-sig-Geo mailing list
>> > >> >> >> R-sig-Geo at stat.math.ethz.ch
>> > >> >> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> > >> >> >
>> > >> >> >
>> > >> >> >
>> > >> >> > --
>> > >> >> > advait godbole
>> > >> >> >
>> > >> >
>> > >> >
>> > >> >
>> > >> > --
>> > >> > advait godbole
>> > >> >
>> > >
>> > >
>> > >
>> > > --
>> > > advait godbole
>> > >
>> >
>>
>>
>>
>> --
>> advait godbole
>>
>> ? ? ? ?[[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>


From r.hijmans at gmail.com  Thu Dec  2 19:43:50 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Thu, 2 Dec 2010 10:43:50 -0800
Subject: [R-sig-Geo] gridded time series analysis
In-Reply-To: <AANLkTinUvhmDLP2YSWuqb5=G0YKX=sWp6yMOj9KPAgdA@mail.gmail.com>
References: <AANLkTimTdxzoDCfJQOB8bgQRhjLy3YzSbtGtMdijk9sQ@mail.gmail.com>
	<771411.8321.qm@web29709.mail.ird.yahoo.com>
	<AANLkTin2DYocWNOAR-LfGoBP4+gCtA7eVDHmoaQ6wriR@mail.gmail.com>
	<AANLkTimFw1zMH75s+TG+SFkBHfXzpURm2WXskAa8Kp=m@mail.gmail.com>
	<AANLkTim9dBnVkZ0tjvoa1YRpPRr156jJ9zcezMDrtzhX@mail.gmail.com>
	<AANLkTi=vW6NXYXKGNa0gcTfZ8ezEjvegdxU3Dt5SPA4F@mail.gmail.com>
	<AANLkTikqNmC62Pv-n9Dxd1w7fTHJPx8cR72U6YEtWMTV@mail.gmail.com>
	<AANLkTikQsL9opzu1i0mWxtJA6YmcgBbGdbihXFOwPRho@mail.gmail.com>
	<AANLkTinY5+3JbpZfWnriDZNOdmcfic0628Qi0=NDZghK@mail.gmail.com>
	<AANLkTikd-PJKWZdWUL2+S9VYAq1QJ4LPwG2==erEs2+Q@mail.gmail.com>
	<AANLkTi=eZL0Rq5EyoRA29fdnN2VL-Xt6hcGN4DnZgCKk@mail.gmail.com>
	<AANLkTikVto4GD=vO=5YKwKXL7y+Ze4ADn2KXpsw1AFVA@mail.gmail.com>
	<AANLkTinUvhmDLP2YSWuqb5=G0YKX=sWp6yMOj9KPAgdA@mail.gmail.com>
Message-ID: <AANLkTi=P5HNFjEsaapUBF7vSAFAsekU_4bYJqXnW=gbu@mail.gmail.com>

This is the work around:

layerNames(rcmraster) <- layerNames(rcmraster)


On Thu, Dec 2, 2010 at 10:43 AM, Robert J. Hijmans <r.hijmans at gmail.com> wrote:
> The question marks indicate that the min and max values are not known
> to the object (because the file type does not store them, and it is
> too 'expensive' to determine them on the fly). setMinMax if you really
> need to know.
> The error on trim seems to be a problem with layerNames being numeric.
> I'll fix that. This may be a work-around
>
>
>
>
>
>
> On Thu, Dec 2, 2010 at 10:23 AM, steven mosher <moshersteven at gmail.com> wrote:
>> ?see the setMinMax()
>>
>> ?for the error on trim() I'm not sure.
>>
>> On Thu, Dec 2, 2010 at 5:16 AM, Advait Godbole <advaitgodbole at gmail.com>
>> wrote:
>>>
>>> That worked perfectly. Thanks for pointing this out. I changed the way my
>>> variables were being written to the netCDF and now "brick" works. However,
>>> I
>>> am getting an error while using the stack function, like so:
>>>
>>> "Error in function (classes, fdef, mtable) ?:
>>> ?unable to find an inherited method for function "trim", for signature
>>> "integer"
>>>
>>> The two rasters show the following:
>>> > rcmraster
>>> class ? ? ? : RasterBrick
>>> filename ? ?: regcm.cumul.hdd.10k.96_05.fixed.latlonvars.nc
>>> nlayers ? ? : 120
>>> nrow ? ? ? ?: 356
>>> ncol ? ? ? ?: 507
>>> ncell ? ? ? : 180492
>>> projection ?: +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0
>>> min value ? : ? ? ? ? ? ? ? ? ? ?
>>> max value ? : ? ? ? ? ? ? ? ? ? ?
>>> xmin ? ? ? ?: -137.3312
>>> xmax ? ? ? ?: -62.11259
>>> ymin ? ? ? ?: 22.12693
>>> ymax ? ? ? ?: 57.35954
>>> xres ? ? ? ?: 0.1483602
>>> yres ? ? ? ?: 0.09896801
>>>
>>> > emitraster
>>> class ? ? ? : RasterBrick
>>> filename ? ?:
>>> flip.percap.vulcan.10k.dp.build.381.RES.EIAmy.96_05.this.latest.nc
>>> nlayers ? ? : 120
>>> nrow ? ? ? ?: 356
>>> ncol ? ? ? ?: 507
>>> ncell ? ? ? : 180492
>>> projection ?: +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0
>>> min value ? : ? ? ? ? ? ? ? ? ? ?
>>> max value ? : ? ? ? ? ? ? ? ? ? ?
>>> xmin ? ? ? ?: -137.3312
>>> xmax ? ? ? ?: -62.11259
>>> ymin ? ? ? ?: 22.12693
>>> ymax ? ? ? ?: 57.35954
>>> xres ? ? ? ?: 0.1483602
>>> yres ? ? ? ?: 0.09896801
>>>
>>> A getValues call shows a lot of NAs. Now, my original file does have a
>>> large
>>> number of missing values so that is why this should happen, but I suspect
>>> something is going wrong since the min and max values are not being
>>> displayed for either of these rasters. Is that the source of the problem
>>> in
>>> the "stack" function?
>>>
>>> Thanks,
>>>
>>> Advait
>>>
>>> On Tue, Nov 30, 2010 at 5:18 PM, Robert J. Hijmans
>>> <r.hijmans at gmail.com>wrote:
>>>
>>> > Advait,
>>> >
>>> > The is an error in the file, I think, see below:
>>> >
>>> > > library(ncdf)
>>> > > filename = "c:/downloads/regcm.cumul.hdd.10k.96_05.new.nc"
>>> > > nc <- open.ncdf(filename)
>>> > >
>>> > > zvar <- 'hdd'
>>> > > nc$var[[zvar]]$dim[[1]]$len
>>> > [1] 507
>>> > > nc$var[[zvar]]$dim[[2]]$len
>>> > [1] 356
>>> > >
>>> > > xx <- nc$var[[zvar]]$dim[[1]]$vals
>>> > > # should be a vector of 507 longitudes but:
>>> > > dim(xx)
>>> > [1] 507 356 120
>>> > >
>>> > > # works anyway
>>> > > xrange <- c(min(xx), max(xx))
>>> > > xrange
>>> > [1] -137.25705 ?-62.18677
>>> > >
>>> > > yy <- nc$var[[zvar]]$dim[[2]]$vals
>>> > > # should be a vector of 356 latitudes but:
>>> > > dim(yy)
>>> > [1] 507 356 120
>>> > >
>>> > > # this fails
>>> > > yrange <- c(min(yy), max(yy))
>>> > > yrange
>>> > [1] NaN NaN
>>> > > # and that is the only reason why raster failed.
>>> > >
>>> > > #OK
>>> > > yy[,,1][1:10,350:355]
>>> > ? ? ? ? ?[,1] ? ? [,2] ? ? [,3] ? ? [,4] ? ? [,5] ? ? [,6]
>>> > ?[1,] 51.49148 51.57122 51.65092 51.73055 51.81014 51.88967
>>> > ?[2,] 51.52888 51.60866 51.68839 51.76807 51.84769 51.92727
>>> > ?[3,] 51.56616 51.64598 51.72575 51.80547 51.88513 51.96474
>>> > ?[4,] 51.60332 51.68318 51.76299 51.84275 51.92245 52.00210
>>> > ?[5,] 51.64036 51.72026 51.80011 51.87991 51.95965 52.03934
>>> > ?[6,] 51.67728 51.75722 51.83711 51.91695 51.99673 52.07646
>>> > ?[7,] 51.71409 51.79407 51.87399 51.95387 52.03369 52.11345
>>> > ?[8,] 51.75077 51.83079 51.91076 51.99067 52.07053 52.15033
>>> > ?[9,] 51.78734 51.86739 51.94740 52.02735 52.10725 52.18709
>>> > [10,] 51.82378 51.90388 51.98392 52.06391 52.14385 52.22373
>>> > >
>>> > > #bad values here (and note the NaN):
>>> > > yy[,,120][1:10,350:355]
>>> > ? ? ? ? ? ? ? ?[,1] ? ? ? ? ? [,2] ? ? ? ? ? [,3] ? ? ? ? ? [,4]
>>> > ? ? [,5] ? ? ? ? ? [,6]
>>> > ?[1,] -1.313847e-229 -4.895880e-272 -7.553765e-266 ? 1.293814e+58
>>> > 9.551441e-293 ?-3.291580e-36
>>> > ?[2,] -5.321424e+272 -3.076997e-223 ?-1.515780e-33 -9.895836e+171
>>> > 3.115686e-149 ?-4.970539e+92
>>> > ?[3,] ?5.259277e-203 ? 5.980335e-56 ?2.893449e-212 ?2.974200e+274
>>> > 3.186547e-218 ?2.503689e+296
>>> > ?[4,] -3.977129e+225 -3.696719e-283 ? 1.284612e+42 ? 1.887923e+28
>>> > -2.322520e+268 ?5.005820e-108
>>> > ?[5,] ?-6.569744e+88 ? 1.824506e-74 ? 7.663356e+39 ?1.608759e-201
>>> > -1.433761e+110 -8.804183e-211
>>> > ?[6,] -4.237822e-162 ? ? ? ? ? ?NaN ?7.405904e-275 ?5.859877e-258
>>> > 1.339820e+110 ?1.631993e+229
>>> > ?[7,] ? 5.603325e-64 ? 4.188764e+37 -2.188887e+243 -4.657907e+280
>>> > 1.795268e-185 ?1.166057e-175
>>> > ?[8,] -2.112804e-229 ?4.536625e+137 ?2.910322e-278 ?4.407645e-274
>>> > 8.886205e-239 -1.913860e+238
>>> > ?[9,] ?-9.126350e+44 -1.866422e+177 -2.578975e+256 ?3.275379e+208
>>> > -2.657457e+75 ?-1.258259e-90
>>> > [10,] ?6.698325e+216 -2.958355e+137 -1.058748e-178 -1.776776e+215
>>> > -6.368807e+78 -5.337653e+299
>>> > >
>>> > > # this would have worked
>>> > > yrange <- c(min(yy[,,1]), max(yy[,,1]))
>>> > > yrange
>>> > [1] 22.17641 57.31006
>>> > >
>>> > > close.ncdf(nc)
>>> >
>>> >
>>> > Best, Robert
>>> >
>>> >
>>> > On Tue, Nov 30, 2010 at 10:37 AM, Advait Godbole
>>> > <advaitgodbole at gmail.com> wrote:
>>> > > Dear Robert,
>>> > > here is the link to the file:
>>> > > http://dl.dropbox.com/u/4030944/regcm.cumul.hdd.10k.96_05.new.nc. It
>>> > > is
>>> > a
>>> > > large file ~400 MB. Let me know if dropbox is not convenient and you
>>> > would
>>> > > rather do ftp - ?but our machines are down for maintenance and I may
>>> > > not
>>> > be
>>> > > immediately able to get access.
>>> > > I was going over the NCL code that processes the files but did not
>>> > > find
>>> > > anything glaringly amiss, so I will have to look at it in greater
>>> > > detail
>>> > > since it is clear that the number of entries in the variables is not
>>> > right
>>> > > as you've pointed out. There is a chance that I have not written out
>>> > > the
>>> > > co-ordinates properly.
>>> > > Thanks,
>>> > > Advait
>>> > > On Mon, Nov 29, 2010 at 1:14 PM, Robert J. Hijmans
>>> > > <r.hijmans at gmail.com>
>>> > > wrote:
>>> > >>
>>> > >> Advait,
>>> > >> I do not think I can help you further unless you send me your file;
>>> > >> but this suggests that it is either not following the CF standards,
>>> > >> or
>>> > >> something is wrong with the file, or that there is something I have
>>> > >> not understood about these files.
>>> > >> You said you have 507 x 356 x 120 values. I would expect
>>> > >> length(frcm$dim[[1]]$vals) == 507 and length(frcm$dim[[2]]$vals) ==
>>> > >> 356
>>> > >> Robert
>>> > >>
>>> > >> On Mon, Nov 29, 2010 at 6:11 AM, Advait Godbole <
>>> > advaitgodbole at gmail.com>
>>> > >> wrote:
>>> > >> > sorry to disrupt the flow of the conversation, but after doing what
>>> > >> > Robert
>>> > >> > suggested, this is what was returned:
>>> > >> >> length(frcm$dim[[1]]$vals)
>>> > >> > [1] 21659040
>>> > >> >> length(frcm$dim[[2]]$vals)
>>> > >> > [1] 21659040
>>> > >> > the other two functions return the latitude and longitude arrays
>>> > >> > not
>>> > >> > populated with NAs/missing values. I havent reproduced them here
>>> > because
>>> > >> > of
>>> > >> > their number.
>>> > >> > Regards,
>>> > >> > advait
>>> > >> > On Sat, Nov 27, 2010 at 3:48 PM, Robert J. Hijmans <
>>> > r.hijmans at gmail.com>
>>> > >> > wrote:
>>> > >> >>
>>> > >> >> Advait,
>>> > >> >>
>>> > >> >> That suggests that you have missing values in the lon or lat
>>> > >> >> dimensions. Is that true? That would be awkward, but perhaps
>>> > something
>>> > >> >> else is going on. Can you send me your file? If not can you send
>>> > >> >> the
>>> > >> >> results of this:
>>> > >> >>
>>> > >> >> filename <- "regcm.cumul.hdd.10k.96_05.new.nc"
>>> > >> >> nc <- open.ncdf(filename)
>>> > >> >> length(nc$dim[[1]]$vals)
>>> > >> >> length(nc$dim[[2]]$vals)
>>> > >> >> nc$dim[[1]]$vals
>>> > >> >> nc$dim[[2]]$vals
>>> > >> >> close.ncdf(nc)
>>> > >> >>
>>> > >> >> Thanks, Robert
>>> > >> >>
>>> > >> >> On Sat, Nov 27, 2010 at 8:36 AM, Advait Godbole
>>> > >> >> <advaitgodbole at gmail.com>
>>> > >> >> wrote:
>>> > >> >> > Thanks everyone for these leads..However, I am running into
>>> > problems
>>> > >> >> > with
>>> > >> >> > data handling. I used ncdf to extract the two variables (507 x
>>> > >> >> > 356
>>> > x
>>> > >> >> > 120
>>> > >> >> > -
>>> > >> >> > lon,lat,time) and converted them into array objects. The
>>> > suggestions
>>> > >> >> > provided all utilize the raster package, but using "brick" on
>>> > >> >> > the
>>> > >> >> > file
>>> > >> >> > returns this error: "rcmraster <-
>>> > >> >> > brick("regcm.cumul.hdd.10k.96_05.new.nc")
>>> > >> >> > Error in if (e at xmin > -400 & e at xmax < 400 & e at ymin > -90.1 &
>>> > e at ymax <
>>> > >> >> > ?:
>>> > >> >> > missing value where TRUE/FALSE needed"
>>> > >> >> >
>>> > >> >> > I have a fair number of NAs (all missing values in the original
>>> > >> >> > variables).
>>> > >> >> > Is there a way to set a flag for that? Or any other workaround?
>>> > >> >> > Thanks much,
>>> > >> >> > advait
>>> > >> >> > On Fri, Nov 26, 2010 at 6:25 PM, Robert J. Hijmans
>>> > >> >> > <r.hijmans at gmail.com>
>>> > >> >> > wrote:
>>> > >> >> >>
>>> > >> >> >> There are some difference in the behavior of 'calc' between
>>> > >> >> >> functions,
>>> > >> >> >> because of attempts to accommodate different functions &
>>> > intentions.
>>> > >> >> >> But in 'raster' 1.7-4 (available from R-Forge in ~ 24 hrs; and
>>> > from
>>> > >> >> >> CRAN soon), the below will work:
>>> > >> >> >>
>>> > >> >> >> library(raster)
>>> > >> >> >> #creating some data
>>> > >> >> >> r <- raster(nrow=10, ncol=10)
>>> > >> >> >> s1 <- s2<- list()
>>> > >> >> >> for (i in 1:12) {
>>> > >> >> >> ? ? ? ?s1[i] <- setValues(r, rnorm(ncell(r), i, 3) )
>>> > >> >> >> ? ? ? ?s2[i] <- setValues(r, rnorm(ncell(r), i, 3) )
>>> > >> >> >> }
>>> > >> >> >> s1 <- stack(s1)
>>> > >> >> >> s2 <- stack(s2)
>>> > >> >> >>
>>> > >> >> >> # regression of values in one brick (or stack) with another
>>> > (Jacob's
>>> > >> >> >> suggestion)
>>> > >> >> >> s <- stack(s1, s2)
>>> > >> >> >> # s1 and s2 have 12 layers
>>> > >> >> >> fun <- function(x) { lm(x[1:12] ~ x[13:24])$coefficients[2] }
>>> > >> >> >> x1 <- calc(s, fun)
>>> > >> >> >>
>>> > >> >> >> # regression of values in one brick (or stack) with 'time'
>>> > >> >> >> time <- 1:nlayers(s)
>>> > >> >> >> fun <- function(x) { lm(x ~ time)$coefficients[2] }
>>> > >> >> >> x2 <- calc(s, fun)
>>> > >> >> >>
>>> > >> >> >> # get multiple layers, e.g. the slope _and_ intercept
>>> > >> >> >> fun <- function(x) { lm(x ~ time)$coefficients }
>>> > >> >> >> x3 <- calc(s, fun)
>>> > >> >> >>
>>> > >> >> >> If this does not work in your version, you can use apply( ) as
>>> > >> >> >> in
>>> > >> >> >> what
>>> > >> >> >> I send earlier.
>>> > >> >> >>
>>> > >> >> >> Robert
>>> > >> >> >>
>>> > >> >> >> On Fri, Nov 26, 2010 at 2:56 PM, Robert J. Hijmans
>>> > >> >> >> <r.hijmans at gmail.com>
>>> > >> >> >> wrote:
>>> > >> >> >> > It seems that 'calc' does not like this (any more; another
>>> > >> >> >> > thing
>>> > >> >> >> > to
>>> > >> >> >> > fix) . If your rasters are not very large you can use apply,
>>> > which
>>> > >> >> >> > makes it much faster:
>>> > >> >> >> >
>>> > >> >> >> > library(raster)
>>> > >> >> >> > #creating some data
>>> > >> >> >> > r <- raster(nrow=10, ncol=10)
>>> > >> >> >> > s <- list()
>>> > >> >> >> > for (i in 1:25) { s[i] <- setValues(r, rnorm(ncell(r), i, 3)
>>> > >> >> >> > ) }
>>> > >> >> >> > s <- stack(s)
>>> > >> >> >> >
>>> > >> >> >> > # regression
>>> > >> >> >> > time <- 1:nlayers(s)
>>> > >> >> >> > fun <- function(x) { lm(x ~ time)$coefficients[2] }
>>> > >> >> >> > r[] <- apply(getValues(s), 1, fun)
>>> > >> >> >> >
>>> > >> >> >> > Robert
>>> > >> >> >> >
>>> > >> >> >> >
>>> > >> >> >> >
>>> > >> >> >> > On Fri, Nov 26, 2010 at 2:51 PM, Jacob van Etten
>>> > >> >> >> > <jacobvanetten at yahoo.com> wrote:
>>> > >> >> >> >> you could try this approach (use calc whenever you can):
>>> > >> >> >> >>
>>> > >> >> >> >> (supposing your bricks have 12 layers)
>>> > >> >> >> >>
>>> > >> >> >> >> br3 <- stack(brick1, brick2)
>>> > >> >> >> >> lmS <- function(x) lm(x[1:12] ~ x[13:24)$coefficients[2]
>>> > >> >> >> >> r <- calc(br3, lmS)
>>> > >> >> >> >>
>>> > >> >> >> >> Jacob.
>>> > >> >> >> >>
>>> > >> >> >> >> --- On Fri, 26/11/10, steven mosher <moshersteven at gmail.com>
>>> > >> >> >> >> wrote:
>>> > >> >> >> >>
>>> > >> >> >> >> From: steven mosher <moshersteven at gmail.com>
>>> > >> >> >> >> Subject: Re: [R-sig-Geo] gridded time series analysis
>>> > >> >> >> >> To: "Martin" <martin_brandt at gmx.net>
>>> > >> >> >> >> Cc: r-sig-geo at stat.math.ethz.ch
>>> > >> >> >> >> Date: Friday, 26 November, 2010, 23:33
>>> > >> >> >> >>
>>> > >> >> >> >> that's cool, I'm also interested in a similar problem but
>>> > >> >> >> >> just
>>> > >> >> >> >> with
>>> > >> >> >> >> one
>>> > >> >> >> >> brick ending up with a slope raster as the output. It may be
>>> > >> >> >> >> possible
>>> > >> >> >> >> with
>>> > >> >> >> >> stackApply(). have a look. or maybe robert will chime in
>>> > >> >> >> >>
>>> > >> >> >> >>
>>> > >> >> >> >>
>>> > >> >> >> >> On Fri, Nov 26, 2010 at 1:35 PM, Martin
>>> > >> >> >> >> <martin_brandt at gmx.net
>>> > >
>>> > >> >> >> >> wrote:
>>> > >> >> >> >>
>>> > >> >> >> >>>
>>> > >> >> >> >>> this is what I did to perform a regression between two
>>> > >> >> >> >>> bricks
>>> > >> >> >> >>> (each
>>> > >> >> >> >>> brick
>>> > >> >> >> >>> represent a time series):
>>> > >> >> >> >>>
>>> > >> >> >> >>> r <- raster(brick1)
>>> > >> >> >> >>> for (i in 1:ncell(r)) {
>>> > >> >> >> >>> r[i] = lm(as.ts(cellValues(brick1, i)) ~
>>> > >> >> >> >>> as.ts(cellValues(brick2,
>>> > >> >> >> >>> i)))$coefficients[2]
>>> > >> >> >> >>> }
>>> > >> >> >> >>>
>>> > >> >> >> >>> The result will be a slope raster, but it really takes a
>>> > >> >> >> >>> lot
>>> > of
>>> > >> >> >> >>> time,
>>> > >> >> >> >>> so
>>> > >> >> >> >>> maybe there is a better solution..
>>> > >> >> >> >>>
>>> > >> >> >> >>>
>>> > >> >> >> >>> --
>>> > >> >> >> >>> View this message in context:
>>> > >> >> >> >>>
>>> > >> >> >> >>>
>>> > >> >> >> >>>
>>> > >> >> >> >>>
>>> >
>>> > http://r-sig-geo.2731867.n2.nabble.com/gridded-time-series-analysis-tp5775651p5778472.html
>>> > >> >> >> >>> Sent from the R-sig-geo mailing list archive at Nabble.com.
>>> > >> >> >> >>>
>>> > >> >> >> >>> _______________________________________________
>>> > >> >> >> >>> R-sig-Geo mailing list
>>> > >> >> >> >>> R-sig-Geo at stat.math.ethz.ch
>>> > >> >> >> >>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>> > >> >> >> >>>
>>> > >> >> >> >>
>>> > >> >> >> >> ? ? [[alternative HTML version deleted]]
>>> > >> >> >> >>
>>> > >> >> >> >> _______________________________________________
>>> > >> >> >> >> R-sig-Geo mailing list
>>> > >> >> >> >> R-sig-Geo at stat.math.ethz.ch
>>> > >> >> >> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>> > >> >> >> >>
>>> > >> >> >> >>
>>> > >> >> >> >>
>>> > >> >> >> >>
>>> > >> >> >> >> ? ? ? ?[[alternative HTML version deleted]]
>>> > >> >> >> >>
>>> > >> >> >> >>
>>> > >> >> >> >> _______________________________________________
>>> > >> >> >> >> R-sig-Geo mailing list
>>> > >> >> >> >> R-sig-Geo at stat.math.ethz.ch
>>> > >> >> >> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>> > >> >> >> >>
>>> > >> >> >> >>
>>> > >> >> >> >
>>> > >> >> >>
>>> > >> >> >> _______________________________________________
>>> > >> >> >> R-sig-Geo mailing list
>>> > >> >> >> R-sig-Geo at stat.math.ethz.ch
>>> > >> >> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>> > >> >> >
>>> > >> >> >
>>> > >> >> >
>>> > >> >> > --
>>> > >> >> > advait godbole
>>> > >> >> >
>>> > >> >
>>> > >> >
>>> > >> >
>>> > >> > --
>>> > >> > advait godbole
>>> > >> >
>>> > >
>>> > >
>>> > >
>>> > > --
>>> > > advait godbole
>>> > >
>>> >
>>>
>>>
>>>
>>> --
>>> advait godbole
>>>
>>> ? ? ? ?[[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>
>


From mloranty at whrc.org  Thu Dec  2 23:24:33 2010
From: mloranty at whrc.org (Michael Loranty)
Date: Thu, 2 Dec 2010 17:24:33 -0500
Subject: [R-sig-Geo] temporal interpolation with stackApply - seg fault
In-Reply-To: <AANLkTi=L=BRCeRpJGg8OoyQkKrxEWy12JwwQMWuko3GB@mail.gmail.com>
References: <5FDDBA76-5FA2-4773-882C-0500709635F5@whrc.org>
	<AANLkTikEwor_d-FMObMKt8FDmsArnByT0piRZpsSKs7U@mail.gmail.com>
	<4B548144-6983-42E3-8B0D-659D16BA6E5D@whrc.org>
	<AANLkTi=L=BRCeRpJGg8OoyQkKrxEWy12JwwQMWuko3GB@mail.gmail.com>
Message-ID: <00D2CC12-C917-44CB-AFA1-C351C7D2382B@whrc.org>

Hello again...

I've successfully applied the previously discussed function over a  
raster stack using calc.  However, the process seems to choke on large  
data sets.  It ran successfully on a stack with nlayers: 13, nrow:  
119, ncol 1048 but aborted with the stack below.

Could this be a memory issue?  I'm not sure if this is on my end, or  
something to do with the function.

Many thanks,
Mike


 > day
class       : RasterStack
nlayers     : 13
nrow        : 508
ncol        : 3825
ncell       : 1943100
projection  : +proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs  
+towgs84=0,0,0
min value   : 0 0 0 0 0 0 0 0 0 0 ...
max value   : 65535 65535 65535 65535 65535 65535 65535 65535 65535  
65535 ...
extent      : -175.4283, -100.0055, 59.98306, 70  (xmin, xmax, ymin,  
ymax)
resolution  : 0.01971838, 0.01971838  (x, y)

 > fill.LST <- function(x,na.rm = F){
+ x[x==0] <- NA
+ if(length(which(is.na(x)==F))>2){
+ fill <- approxfun(x, y=NULL, method='linear', rule=2)
+ rec <- which(is.na(x))
+ x[rec] <- fill(rec)
+ }
+ x <- (x*0.02)-273.15
+ return(x)
+ }

 > day.fill <- calc(day, fun=fill.LST, filename = "LST/ 
day.LST.h12v02.2005.tif")

  *** caught segfault ***
address 0x1020, cause 'memory not mapped'

Traceback:
  1: .Call("RGDAL_PutRasterData", raster, rasterData,  
as.integer(offset),     PACKAGE = "rgdal")
  2: putRasterData(raster at file@transient, t(v), band = i, c(0, 0))
  3: .writeGDALall(x, filename = filename, format = filetype, ...)
  4: .local(x, filename, ...)
  5: writeRaster(x, filename, ...)
  6: writeRaster(x, filename, ...)
  7: .local(x, fun, ...)
  8: calc(day, fun = fill.LST, filename = "LST/day.LST.h12v02.2005.tif")
  9: calc(day, fun = fill.LST, filename = "LST/day.LST.h12v02.2005.tif")

 > sessionInfo()
R version 2.10.0 (2009-10-26)
x86_64-redhat-linux-gnu

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] spatial_7.3-1 raster_1.7-5  rgdal_0.6-28  sp_0.9-66

loaded via a namespace (and not attached):
[1] grid_2.10.0     lattice_0.17-26
 >


Michael Loranty Ph.D.
Postdoctoral Fellow
The Woods Hole Research Center
149 Woods Hole Rd
Falmouth, MA 02540
508.444.1560
mloranty at whrc.org








On Dec 1, 2010, at 10:37 PM, Robert J. Hijmans wrote:

> Michael,
>
> I think that is because of a difference in versions. The error should
> go away with a more recent version of 'raster'. You can get one from
> R-Forge:  install.packages("raster",
> repos="http://R-Forge.R-project.org")
>
> The current version on CRAN, 1.6-22, has some glitches, and I just
> uploaded version 1.7-6 to CRAN. This version should be available for
> install from there within 24 hrs.
>
> Robert
>
>
> On Wed, Dec 1, 2010 at 6:04 PM, Michael Loranty <mloranty at whrc.org>  
> wrote:
>> Thanks for the quick response, Robert.
>>
>> I hadn't realized I was misusing the stackApply. For some reason  
>> I'm getting
>> a similar error with calc.  I don't know how to look at the function
>> definition for calc to diagnose further.
>>
>> Best,
>> Mike
>>
>>> r <- raster(ncol=10, nrow=10)
>>> r[]=1:ncell(r)
>>> s <- brick(r,flip(r,direction = "x"),flip(r,direction =
>>> "y"),r,flip(r,direction = "y"),flip(r,direction = "x"))
>>>
>>> set.NA <- function(x, na.rm = T){x[x==18] <- NA; return(x)}
>>>
>>> s <- stackApply(s,fun = set.NA, indices = 1:nlayers(s))
>>>
>>> fill.NA <- function(x,na.rm = F){
>> +                       fill <- approxfun(x, y = NULL, method =  
>> 'linear',
>> rule = 2);
>> +                       new <- fill(1:length(x));
>> +                       rec <- which(is.na(x));
>> +                       x[rec] <- new[rec];
>> +                       return(x)
>> +                       }
>>>
>>> ss < - calc(s,fun=fill.NA)
>> Error in approxfun(x, y = NULL, method = "linear", rule = 2) :
>>  need at least two non-NA values to interpolate
>>
>>> s[13]
>> [1] 13 NA 83 13 83 NA
>>> fill.NA(s[13])
>> [1] 13 48 83 13 83 83
>>>
>>
>> Michael Loranty Ph.D.
>> Postdoctoral Fellow
>> The Woods Hole Research Center
>> 149 Woods Hole Rd
>> Falmouth, MA 02540
>> 508.444.1560
>> mloranty at whrc.org
>>
>>
>>
>>
>>
>>
>>
>>
>> On Dec 1, 2010, at 7:34 PM, Robert J. Hijmans wrote:
>>
>>> Michael,
>>>
>>> Thanks for sending an good self-contained example. If you use
>>> stackApply with layers=1:nlayers you are requesting that the  
>>> function
>>> should be applied to each layer separately. That is OK for the first
>>> case (set.NA) although 'calc' would be more direct. But it does not
>>> for fill.NA, because that function needs the values of all layers  
>>> in a
>>> single computations. In this case you must use calc. The below  
>>> works:
>>>
>>>
>>> r <- raster(ncol=10, nrow=10)
>>> r[] <- 1:ncell(r)
>>>
>>> s <- stack(r,flip(r,direction = "x"),flip(r,direction =
>>> "y"),r,flip(r,direction = "y"),flip(r,direction = "x"))
>>> set.NA <- function(x, na.rm = T){x[x==18] <- NA; return(x)}
>>> s <- calc(s, fun=set.NA)
>>>
>>> fill.NA <- function(x,na.rm = F){
>>>   fill <- approxfun(x, y = NULL, method = 'linear', rule = 2)
>>>   rec <- which(is.na(x))
>>>   x[rec] <- fill(rec)
>>>   return(x)
>>> }
>>>
>>> ss <- calc(s,fun=fill.NA)
>>>
>>>
>>> Best, Robert
>>>
>>> On Wed, Dec 1, 2010 at 1:44 PM, Michael Loranty  
>>> <mloranty at whrc.org> wrote:
>>>>
>>>> Hi All,
>>>>
>>>> I have a raster stack, that represents a time series of temperature
>>>> observations, and would like to interpolate temporally to fill  
>>>> gaps in
>>>> the
>>>> data. That is, to apply a gap-filling function across all layers  
>>>> in a
>>>> stack,
>>>> pixel by pixel. My hope was to accomplish this using stackApply,  
>>>> however
>>>> this doesn't seem to work. The reason seems to be associated with  
>>>> how the
>>>> data are handled within stackApply which is based upon the type of
>>>> function
>>>> that is used.
>>>>
>>>> Has anyone else encountered a similar problem or come up with a  
>>>> solution?
>>>> It
>>>> seems to me that it may not be too difficult to make a a function  
>>>> to do
>>>> this
>>>> based upon few minor adjustments to the current raster function.  
>>>> A simple
>>>> example is below.
>>>>
>>>> Best,
>>>> Mike
>>>>
>>>>
>>>>> r <- raster(ncol=10, nrow=10)
>>>>> r[]=1:ncell(r)
>>>>> s <- brick(r,flip(r,direction = "x"),flip(r,direction =
>>>>> "y"),r,flip(r,direction = "y"),flip(r,direction = "x"))
>>>>>
>>>>> set.NA <- function(x, na.rm = T){x[x==18] <- NA; return(x)}
>>>>>
>>>>> s <- stackApply(s,fun = set.NA, indices = 1:nlayers(s))
>>>>>
>>>>> fill.NA <- function(x,na.rm = F){
>>>>
>>>> +                       fill <- approxfun(x, y = NULL, method =  
>>>> 'linear',
>>>> rule = 2);
>>>> +                       new <- fill(1:length(x));
>>>> +                       rec <- which(is.na(x));
>>>> +                       x[rec] <- new[rec];
>>>> +                       return(x)
>>>> +                       }
>>>>>
>>>>> s < - stackApply(s,fun=fill.NA,indices = 1:nlayers(s))
>>>>
>>>> Error in approxfun(x, y = NULL, method = "linear", rule = 2) :
>>>>  need at least two non-NA values to interpolate
>>>>>
>>>>> sessionInfo()
>>>>
>>>> R version 2.11.1 (2010-05-31)
>>>> x86_64-apple-darwin9.8.0
>>>>
>>>> other attached packages:
>>>> [1] rgdal_0.6-27  raster_1.6-22 sp_0.9-72
>>>>
>>>>
>>>>
>>>> Michael Loranty Ph.D.
>>>> Postdoctoral Fellow
>>>> The Woods Hole Research Center
>>>> 149 Woods Hole Rd
>>>> Falmouth, MA 02540
>>>> 508.444.1560
>>>> mloranty at whrc.org
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at r-project.org
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>
>>
>>
>>
>


From v8extra at gmail.com  Fri Dec  3 02:08:44 2010
From: v8extra at gmail.com (=?iso-8859-1?Q?S=E9bastien_Durand?=)
Date: Thu, 2 Dec 2010 20:08:44 -0500
Subject: [R-sig-Geo] Creating polygons out of an irregular data set to
	represent specific classes
Message-ID: <C8EDDA59-9F78-441E-A83C-FD5C2320490B@gmail.com>

Hello to all,

I have struggling with R for at least a weak and I guess I do really need your help figuring this out.

I have to work with a large data set (thousands of points) and to create figures that are small and good looking for publications.

You can probably suggest me a slick a working way to approach this problem. 

I would really appreciate.

Let say we start with:

data(akima)
dimgrid=50
ak.li=interp(akima$x, akima$y, akima$z, xo=seq(min(akima$x), max(akima$x), length = dimgrid),yo=seq(min(akima$y), max(akima$y), length = dimgrid),linear = TRUE, extrap=FALSE, duplicate = "mean")

# Now I have the regular grid. 

 cLines = contourLines(x = ak.li$x, y = ak.li$y, z = ak.li$z, nlevels = 7)

# Now I have the contours...

That is from that point on that I cannot find a solution.

I tough of selecting all the image data and converting it a specific class value, but then I still get stuck into the same issue I dont know how to convert those pixel into polygons.

# ...

I do need guidance...

Thanks a lot!


Seb

From v8extra at gmail.com  Fri Dec  3 05:09:23 2010
From: v8extra at gmail.com (=?iso-8859-1?Q?S=E9bastien_Durand?=)
Date: Thu, 2 Dec 2010 23:09:23 -0500
Subject: [R-sig-Geo] Creating polygons out of an irregular data set to
	represent specific classes
Message-ID: <28F42F77-42C7-4718-8CAB-2573BA30620E@gmail.com>

I am getting there! I only need to find a way to merge the adjacent independent polygons!

Here is what I found a marvelous package : raster...  which have "rasterToPolygons"

data(akima)
dimgrid=50
ak.li=interp(akima$x, akima$y, akima$z, xo=seq(min(akima$x), max(akima$x), length = dimgrid),yo=seq(min(akima$y), max(akima$y), length = dimgrid),linear = TRUE, extrap=FALSE, duplicate = "mean")
image(ak.li)
points(akima)
with(akima, text(x, y, formatC(z,dig=2), adj = -0.1))


r <- raster(nrow=length(ak.li$y), ncol=length(ak.li$x), crs=NA)
xmin(r) <- min(ak.li$x, na.rm=TRUE)
xmax(r) <- max(ak.li$x, na.rm=TRUE)
ymin(r) <- min(ak.li$y, na.rm=TRUE)
ymax(r) <- max(ak.li$y, na.rm=TRUE)
tmp=ak.li$z
tmp=apply(tmp, 1, rev)
r[] <- tmp
plot(r)

pol <- rasterToPolygons(r, fun=function(x){x>20 & x<25})
plot(pol, add=T, col='red')

#pol=SpatialPolygons2PolySet(pol)

So if any body have an hit on how to merge the adjacent polygons into one. (or different groups of adjacent polygons into larger polygons). 

I would be very happy to know it!

Thanks!

From v8extra at gmail.com  Fri Dec  3 06:03:29 2010
From: v8extra at gmail.com (=?iso-8859-1?Q?S=E9bastien_Durand?=)
Date: Fri, 3 Dec 2010 00:03:29 -0500
Subject: [R-sig-Geo] Creating polygons out of an irregular data set to
	represent specific classes
Message-ID: <A4743DE6-3660-47A0-8366-1B66319A596F@gmail.com>

Ok here is my latest development on the topic! But I still have a question! At the end I still get segmented polygons!

library(akima)
library(maptools)
library(raster)

data(akima)
# define de dimension of grid
dimgrid=50

# Interpolate to regular grid
ak.li=interp(akima$x, akima$y, akima$z, xo=seq(min(akima$x), max(akima$x), length = dimgrid),yo=seq(min(akima$y), max(akima$y), length = dimgrid),linear = TRUE, extrap=FALSE, duplicate = "mean")

# Show interpolation
image(ak.li)
points(akima)
with(akima, text(x, y, formatC(z,dig=2), adj = -0.1))

# Create a raster with the data
r <- raster(nrow=length(ak.li$y), ncol=length(ak.li$x), crs=NA)
xmin(r) <- min(ak.li$x, na.rm=TRUE)
xmax(r) <- max(ak.li$x, na.rm=TRUE)
ymin(r) <- min(ak.li$y, na.rm=TRUE)
ymax(r) <- max(ak.li$y, na.rm=TRUE)
tmp=ak.li$z
tmp=apply(tmp, 1, rev)
r[] <- tmp

# Show the raster
plot(r)

# Convert the data found between ]20 and 25[ into polygons
pol <- rasterToPolygons(r, fun=function(x){x>20 & x<25})

# Show the polygons
plot(pol, add=T, col='red')

# Attempt to merge similar adjacent into one polygon
union = unionSpatialPolygons(pol, ID=rep(1,
times=length(pol at polygons)))

# Show
plot(union, add=TRUE, col="red")


All polygons were not merged into a single one and I don't know how to fix that!

Any help?

From r.hijmans at gmail.com  Fri Dec  3 06:45:55 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Thu, 2 Dec 2010 21:45:55 -0800
Subject: [R-sig-Geo] temporal interpolation with stackApply - seg fault
In-Reply-To: <00D2CC12-C917-44CB-AFA1-C351C7D2382B@whrc.org>
References: <5FDDBA76-5FA2-4773-882C-0500709635F5@whrc.org>
	<AANLkTikEwor_d-FMObMKt8FDmsArnByT0piRZpsSKs7U@mail.gmail.com>
	<4B548144-6983-42E3-8B0D-659D16BA6E5D@whrc.org>
	<AANLkTi=L=BRCeRpJGg8OoyQkKrxEWy12JwwQMWuko3GB@mail.gmail.com>
	<00D2CC12-C917-44CB-AFA1-C351C7D2382B@whrc.org>
Message-ID: <AANLkTi=Khha_DJBcCqAeczByQ=zUbh4A3BASwuz79vzv@mail.gmail.com>

Could be a memory problem, but it does not look like something that R
would say. Rather looks like something caused by the C routine of
approxfun. Perhaps it is related to the values in your rasters as I
was able to run the below (on a PC with ample of RAM).


r <- raster(nrow=508, ncol=3825, xmn=-175.4283, xmx=-100.0055,
ymn=59.98306, ymx=70)
s <- list()
for (i in 1:12) {
	r[] = runif(ncell(r)) *  65535
	n <- unique(round(runif(0.5 * ncell(r)) * ncell(r) ))
	r[n] <- NA
	s[i] <- r
}

s <- stack(s)

 fill.LST <- function(x,na.rm = F){
 x[x==0] <- NA
 if(length(which(is.na(x)==F))>2){
 fill <- approxfun(x, y=NULL, method='linear', rule=2)
 rec <- which(is.na(x))
 x[rec] <- fill(rec)
 }
 x <- (x*0.02)-273.15
 return(x)
}

day.fill <- calc(s, fun=fill.LST) #, filename = "day.LST.h12v02.2005.tif")



Perhaps you can debug this by doing the equivalent:

b <- brick(s, values=F)
s <- getValues(s)
s <- fill.LST(s)
# and if there is no error:
b <- setValues(b, s)


Best, Robert


On Thu, Dec 2, 2010 at 2:24 PM, Michael Loranty <mloranty at whrc.org> wrote:
> Hello again...
>
> I've successfully applied the previously discussed function over a raster
> stack using calc. ?However, the process seems to choke on large data sets.
> ?It ran successfully on a stack with nlayers: 13, nrow: 119, ncol 1048 but
> aborted with the stack below.
>
> Could this be a memory issue? ?I'm not sure if this is on my end, or
> something to do with the function.
>
> Many thanks,
> Mike
>
>
>> day
> class ? ? ? : RasterStack
> nlayers ? ? : 13
> nrow ? ? ? ?: 508
> ncol ? ? ? ?: 3825
> ncell ? ? ? : 1943100
> projection ?: +proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs
> +towgs84=0,0,0
> min value ? : 0 0 0 0 0 0 0 0 0 0 ...
> max value ? : 65535 65535 65535 65535 65535 65535 65535 65535 65535 65535
> ...
> extent ? ? ?: -175.4283, -100.0055, 59.98306, 70 ?(xmin, xmax, ymin, ymax)
> resolution ?: 0.01971838, 0.01971838 ?(x, y)
>
>> fill.LST <- function(x,na.rm = F){
> + x[x==0] <- NA
> + if(length(which(is.na(x)==F))>2){
> + fill <- approxfun(x, y=NULL, method='linear', rule=2)
> + rec <- which(is.na(x))
> + x[rec] <- fill(rec)
> + }
> + x <- (x*0.02)-273.15
> + return(x)
> + }
>
>> day.fill <- calc(day, fun=fill.LST, filename =
>> "LST/day.LST.h12v02.2005.tif")
>
> ?*** caught segfault ***
> address 0x1020, cause 'memory not mapped'
>
> Traceback:
> ?1: .Call("RGDAL_PutRasterData", raster, rasterData, as.integer(offset),
> PACKAGE = "rgdal")
> ?2: putRasterData(raster at file@transient, t(v), band = i, c(0, 0))
> ?3: .writeGDALall(x, filename = filename, format = filetype, ...)
> ?4: .local(x, filename, ...)
> ?5: writeRaster(x, filename, ...)
> ?6: writeRaster(x, filename, ...)
> ?7: .local(x, fun, ...)
> ?8: calc(day, fun = fill.LST, filename = "LST/day.LST.h12v02.2005.tif")
> ?9: calc(day, fun = fill.LST, filename = "LST/day.LST.h12v02.2005.tif")
>
>> sessionInfo()
> R version 2.10.0 (2009-10-26)
> x86_64-redhat-linux-gnu
>
> attached base packages:
> [1] stats ? ? graphics ?grDevices utils ? ? datasets ?methods ? base
>
> other attached packages:
> [1] spatial_7.3-1 raster_1.7-5 ?rgdal_0.6-28 ?sp_0.9-66
>
> loaded via a namespace (and not attached):
> [1] grid_2.10.0 ? ? lattice_0.17-26
>>
>
>
> Michael Loranty Ph.D.
> Postdoctoral Fellow
> The Woods Hole Research Center
> 149 Woods Hole Rd
> Falmouth, MA 02540
> 508.444.1560
> mloranty at whrc.org
>
>
>
>
>
>
>
>
> On Dec 1, 2010, at 10:37 PM, Robert J. Hijmans wrote:
>
>> Michael,
>>
>> I think that is because of a difference in versions. The error should
>> go away with a more recent version of 'raster'. You can get one from
>> R-Forge: ?install.packages("raster",
>> repos="http://R-Forge.R-project.org")
>>
>> The current version on CRAN, 1.6-22, has some glitches, and I just
>> uploaded version 1.7-6 to CRAN. This version should be available for
>> install from there within 24 hrs.
>>
>> Robert
>>
>>
>> On Wed, Dec 1, 2010 at 6:04 PM, Michael Loranty <mloranty at whrc.org> wrote:
>>>
>>> Thanks for the quick response, Robert.
>>>
>>> I hadn't realized I was misusing the stackApply. For some reason I'm
>>> getting
>>> a similar error with calc. ?I don't know how to look at the function
>>> definition for calc to diagnose further.
>>>
>>> Best,
>>> Mike
>>>
>>>> r <- raster(ncol=10, nrow=10)
>>>> r[]=1:ncell(r)
>>>> s <- brick(r,flip(r,direction = "x"),flip(r,direction =
>>>> "y"),r,flip(r,direction = "y"),flip(r,direction = "x"))
>>>>
>>>> set.NA <- function(x, na.rm = T){x[x==18] <- NA; return(x)}
>>>>
>>>> s <- stackApply(s,fun = set.NA, indices = 1:nlayers(s))
>>>>
>>>> fill.NA <- function(x,na.rm = F){
>>>
>>> + ? ? ? ? ? ? ? ? ? ? ? fill <- approxfun(x, y = NULL, method = 'linear',
>>> rule = 2);
>>> + ? ? ? ? ? ? ? ? ? ? ? new <- fill(1:length(x));
>>> + ? ? ? ? ? ? ? ? ? ? ? rec <- which(is.na(x));
>>> + ? ? ? ? ? ? ? ? ? ? ? x[rec] <- new[rec];
>>> + ? ? ? ? ? ? ? ? ? ? ? return(x)
>>> + ? ? ? ? ? ? ? ? ? ? ? }
>>>>
>>>> ss < - calc(s,fun=fill.NA)
>>>
>>> Error in approxfun(x, y = NULL, method = "linear", rule = 2) :
>>> ?need at least two non-NA values to interpolate
>>>
>>>> s[13]
>>>
>>> [1] 13 NA 83 13 83 NA
>>>>
>>>> fill.NA(s[13])
>>>
>>> [1] 13 48 83 13 83 83
>>>>
>>>
>>> Michael Loranty Ph.D.
>>> Postdoctoral Fellow
>>> The Woods Hole Research Center
>>> 149 Woods Hole Rd
>>> Falmouth, MA 02540
>>> 508.444.1560
>>> mloranty at whrc.org
>>>
>>>
>>>
>>>
>>>
>>>
>>>
>>>
>>> On Dec 1, 2010, at 7:34 PM, Robert J. Hijmans wrote:
>>>
>>>> Michael,
>>>>
>>>> Thanks for sending an good self-contained example. If you use
>>>> stackApply with layers=1:nlayers you are requesting that the function
>>>> should be applied to each layer separately. That is OK for the first
>>>> case (set.NA) although 'calc' would be more direct. But it does not
>>>> for fill.NA, because that function needs the values of all layers in a
>>>> single computations. In this case you must use calc. The below works:
>>>>
>>>>
>>>> r <- raster(ncol=10, nrow=10)
>>>> r[] <- 1:ncell(r)
>>>>
>>>> s <- stack(r,flip(r,direction = "x"),flip(r,direction =
>>>> "y"),r,flip(r,direction = "y"),flip(r,direction = "x"))
>>>> set.NA <- function(x, na.rm = T){x[x==18] <- NA; return(x)}
>>>> s <- calc(s, fun=set.NA)
>>>>
>>>> fill.NA <- function(x,na.rm = F){
>>>> ?fill <- approxfun(x, y = NULL, method = 'linear', rule = 2)
>>>> ?rec <- which(is.na(x))
>>>> ?x[rec] <- fill(rec)
>>>> ?return(x)
>>>> }
>>>>
>>>> ss <- calc(s,fun=fill.NA)
>>>>
>>>>
>>>> Best, Robert
>>>>
>>>> On Wed, Dec 1, 2010 at 1:44 PM, Michael Loranty <mloranty at whrc.org>
>>>> wrote:
>>>>>
>>>>> Hi All,
>>>>>
>>>>> I have a raster stack, that represents a time series of temperature
>>>>> observations, and would like to interpolate temporally to fill gaps in
>>>>> the
>>>>> data. That is, to apply a gap-filling function across all layers in a
>>>>> stack,
>>>>> pixel by pixel. My hope was to accomplish this using stackApply,
>>>>> however
>>>>> this doesn't seem to work. The reason seems to be associated with how
>>>>> the
>>>>> data are handled within stackApply which is based upon the type of
>>>>> function
>>>>> that is used.
>>>>>
>>>>> Has anyone else encountered a similar problem or come up with a
>>>>> solution?
>>>>> It
>>>>> seems to me that it may not be too difficult to make a a function to do
>>>>> this
>>>>> based upon few minor adjustments to the current raster function. A
>>>>> simple
>>>>> example is below.
>>>>>
>>>>> Best,
>>>>> Mike
>>>>>
>>>>>
>>>>>> r <- raster(ncol=10, nrow=10)
>>>>>> r[]=1:ncell(r)
>>>>>> s <- brick(r,flip(r,direction = "x"),flip(r,direction =
>>>>>> "y"),r,flip(r,direction = "y"),flip(r,direction = "x"))
>>>>>>
>>>>>> set.NA <- function(x, na.rm = T){x[x==18] <- NA; return(x)}
>>>>>>
>>>>>> s <- stackApply(s,fun = set.NA, indices = 1:nlayers(s))
>>>>>>
>>>>>> fill.NA <- function(x,na.rm = F){
>>>>>
>>>>> + ? ? ? ? ? ? ? ? ? ? ? fill <- approxfun(x, y = NULL, method =
>>>>> 'linear',
>>>>> rule = 2);
>>>>> + ? ? ? ? ? ? ? ? ? ? ? new <- fill(1:length(x));
>>>>> + ? ? ? ? ? ? ? ? ? ? ? rec <- which(is.na(x));
>>>>> + ? ? ? ? ? ? ? ? ? ? ? x[rec] <- new[rec];
>>>>> + ? ? ? ? ? ? ? ? ? ? ? return(x)
>>>>> + ? ? ? ? ? ? ? ? ? ? ? }
>>>>>>
>>>>>> s < - stackApply(s,fun=fill.NA,indices = 1:nlayers(s))
>>>>>
>>>>> Error in approxfun(x, y = NULL, method = "linear", rule = 2) :
>>>>> ?need at least two non-NA values to interpolate
>>>>>>
>>>>>> sessionInfo()
>>>>>
>>>>> R version 2.11.1 (2010-05-31)
>>>>> x86_64-apple-darwin9.8.0
>>>>>
>>>>> other attached packages:
>>>>> [1] rgdal_0.6-27 ?raster_1.6-22 sp_0.9-72
>>>>>
>>>>>
>>>>>
>>>>> Michael Loranty Ph.D.
>>>>> Postdoctoral Fellow
>>>>> The Woods Hole Research Center
>>>>> 149 Woods Hole Rd
>>>>> Falmouth, MA 02540
>>>>> 508.444.1560
>>>>> mloranty at whrc.org
>>>>>
>>>>> _______________________________________________
>>>>> R-sig-Geo mailing list
>>>>> R-sig-Geo at r-project.org
>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>
>>>>
>>>
>>>
>>>
>>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From lee.kitty at yahoo.com  Fri Dec  3 09:25:40 2010
From: lee.kitty at yahoo.com (Kitty Lee)
Date: Fri, 3 Dec 2010 00:25:40 -0800 (PST)
Subject: [R-sig-Geo] SaTScan in R
Message-ID: <156428.51956.qm@web36306.mail.mud.yahoo.com>

I'm wondering is there a package in R that has similar functions as SaTscan? In particular, I'm looking for space-time cluster detection. The D-cluster package doesn't appear to have a function for space-time detection (please correct me if I'm wrong).

Any ideas would be highly appreciated!


K.


From isabelle.boulangeat at gmail.com  Fri Dec  3 12:26:13 2010
From: isabelle.boulangeat at gmail.com (isabelle boulangeat)
Date: Fri, 3 Dec 2010 12:26:13 +0100
Subject: [R-sig-Geo] new function predict, package raster
In-Reply-To: <AANLkTim4_1NH-sJE1OkUAgari22wy1_V=AHf8F5MB3v=@mail.gmail.com>
References: <AANLkTikU1d4LrvtOCsVUb3FOVWV+NMcL2cpjvC8Bw8OC@mail.gmail.com>
	<AANLkTim4_1NH-sJE1OkUAgari22wy1_V=AHf8F5MB3v=@mail.gmail.com>
Message-ID: <AANLkTi=ez4w1dnc3kM00jTL482JAy1MQtyAkhpPBR+dn@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101203/fd568505/attachment.pl>

From villers.alexandre at gmail.com  Fri Dec  3 12:42:09 2010
From: villers.alexandre at gmail.com (Alexandre Villers)
Date: Fri, 03 Dec 2010 13:42:09 +0200
Subject: [R-sig-Geo] gpclib problem with as.polygonal in spatstat ?
Message-ID: <4CF8D791.2090106@gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101203/ec7d9c2e/attachment.pl>

From advaitgodbole at gmail.com  Fri Dec  3 13:13:04 2010
From: advaitgodbole at gmail.com (Advait Godbole)
Date: Fri, 3 Dec 2010 07:13:04 -0500
Subject: [R-sig-Geo] gridded time series analysis
In-Reply-To: <AANLkTi=P5HNFjEsaapUBF7vSAFAsekU_4bYJqXnW=gbu@mail.gmail.com>
References: <AANLkTimTdxzoDCfJQOB8bgQRhjLy3YzSbtGtMdijk9sQ@mail.gmail.com>
	<771411.8321.qm@web29709.mail.ird.yahoo.com>
	<AANLkTin2DYocWNOAR-LfGoBP4+gCtA7eVDHmoaQ6wriR@mail.gmail.com>
	<AANLkTimFw1zMH75s+TG+SFkBHfXzpURm2WXskAa8Kp=m@mail.gmail.com>
	<AANLkTim9dBnVkZ0tjvoa1YRpPRr156jJ9zcezMDrtzhX@mail.gmail.com>
	<AANLkTi=vW6NXYXKGNa0gcTfZ8ezEjvegdxU3Dt5SPA4F@mail.gmail.com>
	<AANLkTikqNmC62Pv-n9Dxd1w7fTHJPx8cR72U6YEtWMTV@mail.gmail.com>
	<AANLkTikQsL9opzu1i0mWxtJA6YmcgBbGdbihXFOwPRho@mail.gmail.com>
	<AANLkTinY5+3JbpZfWnriDZNOdmcfic0628Qi0=NDZghK@mail.gmail.com>
	<AANLkTikd-PJKWZdWUL2+S9VYAq1QJ4LPwG2==erEs2+Q@mail.gmail.com>
	<AANLkTi=eZL0Rq5EyoRA29fdnN2VL-Xt6hcGN4DnZgCKk@mail.gmail.com>
	<AANLkTikVto4GD=vO=5YKwKXL7y+Ze4ADn2KXpsw1AFVA@mail.gmail.com>
	<AANLkTinUvhmDLP2YSWuqb5=G0YKX=sWp6yMOj9KPAgdA@mail.gmail.com>
	<AANLkTi=P5HNFjEsaapUBF7vSAFAsekU_4bYJqXnW=gbu@mail.gmail.com>
Message-ID: <AANLkTikwWainpBBeSr8xnNNq8uoFXdU2n_34y2-u6K5J@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101203/f4b516b8/attachment.pl>

From advaitgodbole at gmail.com  Fri Dec  3 13:28:54 2010
From: advaitgodbole at gmail.com (Advait Godbole)
Date: Fri, 3 Dec 2010 07:28:54 -0500
Subject: [R-sig-Geo] gridded time series analysis
In-Reply-To: <AANLkTikwWainpBBeSr8xnNNq8uoFXdU2n_34y2-u6K5J@mail.gmail.com>
References: <AANLkTimTdxzoDCfJQOB8bgQRhjLy3YzSbtGtMdijk9sQ@mail.gmail.com>
	<771411.8321.qm@web29709.mail.ird.yahoo.com>
	<AANLkTin2DYocWNOAR-LfGoBP4+gCtA7eVDHmoaQ6wriR@mail.gmail.com>
	<AANLkTimFw1zMH75s+TG+SFkBHfXzpURm2WXskAa8Kp=m@mail.gmail.com>
	<AANLkTim9dBnVkZ0tjvoa1YRpPRr156jJ9zcezMDrtzhX@mail.gmail.com>
	<AANLkTi=vW6NXYXKGNa0gcTfZ8ezEjvegdxU3Dt5SPA4F@mail.gmail.com>
	<AANLkTikqNmC62Pv-n9Dxd1w7fTHJPx8cR72U6YEtWMTV@mail.gmail.com>
	<AANLkTikQsL9opzu1i0mWxtJA6YmcgBbGdbihXFOwPRho@mail.gmail.com>
	<AANLkTinY5+3JbpZfWnriDZNOdmcfic0628Qi0=NDZghK@mail.gmail.com>
	<AANLkTikd-PJKWZdWUL2+S9VYAq1QJ4LPwG2==erEs2+Q@mail.gmail.com>
	<AANLkTi=eZL0Rq5EyoRA29fdnN2VL-Xt6hcGN4DnZgCKk@mail.gmail.com>
	<AANLkTikVto4GD=vO=5YKwKXL7y+Ze4ADn2KXpsw1AFVA@mail.gmail.com>
	<AANLkTinUvhmDLP2YSWuqb5=G0YKX=sWp6yMOj9KPAgdA@mail.gmail.com>
	<AANLkTi=P5HNFjEsaapUBF7vSAFAsekU_4bYJqXnW=gbu@mail.gmail.com>
	<AANLkTikwWainpBBeSr8xnNNq8uoFXdU2n_34y2-u6K5J@mail.gmail.com>
Message-ID: <AANLkTin5-hV=b8yxQnvviF_4w-uPfsSJ9X82pmbi=WQo@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101203/1a9afd68/attachment.pl>

From marcelino.delacruz at upm.es  Fri Dec  3 13:59:50 2010
From: marcelino.delacruz at upm.es (Marcelino de la Cruz)
Date: Fri, 03 Dec 2010 13:59:50 +0100
Subject: [R-sig-Geo] gpclib problem with as.polygonal in spatstat ?
In-Reply-To: <4CF8D791.2090106@gmail.com>
Message-ID: <sKxdve4P.1291381190.5383800.marcelino.delacruz@upm.es>

Hi Alexander,
Try this:

spatstat.options(gpclib=TRUE)
data(letterR)
    m<- as.mask(letterR, dimyx=32)
    p<- as.polygonal(m)

Cheers,

Marcelino


Con fecha 3/12/2010, "Alexandre Villers" <villers.alexandre at gmail.com>
escribi?:

>Good afternoon
>
>I'm trying to convert a mask to a polygonal windows with spatstat.
>However, despite, the gpclibPermit() command, I get this error message:
>
>Warning message:
>In as.polygonal(m) :
>
>   Can't convert mask to polygon: gpclib is disabled/unavailable
>
>While trying this
>
>data(letterR)
>    m<- as.mask(letterR, dimyx=32)
>    p<- as.polygonal(m)
>
>>  sessionInfo()
>R version 2.11.1 (2010-05-31)
>i386-pc-mingw32
>
>locale:
>[1] LC_COLLATE=English_United Kingdom.1252  LC_CTYPE=English_United Kingdom.1252    LC_MONETARY=English_United Kingdom.1252 LC_NUMERIC=C                            LC_TIME=English_United Kingdom.1252
>
>attached base packages:
>[1] stats     graphics  grDevices utils     datasets  methods   base
>
>other attached packages:
>  [1] gdata_2.8.1     gpclib_1.5-1    maptools_0.7-38 lattice_0.18-8  foreign_0.8-40  rgdal_0.6-29    sp_0.9-72       spatstat_1.21-2 deldir_0.0-13   mgcv_1.6-2
>
>loaded via a namespace (and not attached):
>[1] grid_2.11.1        gtools_2.6.2       Matrix_0.999375-39 nlme_3.1-96        tools_2.11.1
>
>
>Thanks for any hint
>
>Alex
>
>
><http://www.mozilla-europe.org/fr/>
>
>	[[alternative HTML version deleted]]
>
>_______________________________________________
>R-sig-Geo mailing list
>R-sig-Geo at r-project.org
>https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From villers.alexandre at gmail.com  Fri Dec  3 14:01:50 2010
From: villers.alexandre at gmail.com (Alexandre Villers)
Date: Fri, 03 Dec 2010 15:01:50 +0200
Subject: [R-sig-Geo] gpclib problem with as.polygonal in spatstat ?
In-Reply-To: <sKxdve4P.1291381190.5383800.marcelino.delacruz@upm.es>
References: <sKxdve4P.1291381190.5383800.marcelino.delacruz@upm.es>
Message-ID: <4CF8EA3E.1020405@gmail.com>

Thanks for this,

I just updated the spatstat package and found out some changes in the 
licence.polygons()...
Best regards

Alex


On 3.12.2010 14:59, Marcelino de la Cruz wrote:
> Hi Alexander,
> Try this:
>
> spatstat.options(gpclib=TRUE)
> data(letterR)
>      m<- as.mask(letterR, dimyx=32)
>      p<- as.polygonal(m)
>
> Cheers,
>
> Marcelino
>
>
> Con fecha 3/12/2010, "Alexandre Villers"<villers.alexandre at gmail.com>
> escribi?:
>
>> Good afternoon
>>
>> I'm trying to convert a mask to a polygonal windows with spatstat.
>> However, despite, the gpclibPermit() command, I get this error message:
>>
>> Warning message:
>> In as.polygonal(m) :
>>
>>    Can't convert mask to polygon: gpclib is disabled/unavailable
>>
>> While trying this
>>
>> data(letterR)
>>     m<- as.mask(letterR, dimyx=32)
>>     p<- as.polygonal(m)
>>
>>>   sessionInfo()
>> R version 2.11.1 (2010-05-31)
>> i386-pc-mingw32
>>
>> locale:
>> [1] LC_COLLATE=English_United Kingdom.1252  LC_CTYPE=English_United Kingdom.1252    LC_MONETARY=English_United Kingdom.1252 LC_NUMERIC=C                            LC_TIME=English_United Kingdom.1252
>>
>> attached base packages:
>> [1] stats     graphics  grDevices utils     datasets  methods   base
>>
>> other attached packages:
>>   [1] gdata_2.8.1     gpclib_1.5-1    maptools_0.7-38 lattice_0.18-8  foreign_0.8-40  rgdal_0.6-29    sp_0.9-72       spatstat_1.21-2 deldir_0.0-13   mgcv_1.6-2
>>
>> loaded via a namespace (and not attached):
>> [1] grid_2.11.1        gtools_2.6.2       Matrix_0.999375-39 nlme_3.1-96        tools_2.11.1
>>
>>
>> Thanks for any hint
>>
>> Alex
>>
>>
>> <http://www.mozilla-europe.org/fr/>
>>
>> 	[[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


-- 
Alexandre Villers, PhD.
Postdoc researcher
Spatial Ecology & Population Dynamics
Section of Ecology, Department of Biology
University of Turku
FIN-20014 Turku
Finland

@mail: alexandre.villers at utu.fi
phone: 00358 (0)2 333 5039

Skype You can skype me (but think of using Ekiga instead !) 
<skype:aquila06?call>


*Use open source and free softwares*
<http://cran.r-project.org/> <http://grass.itc.it/> 
<http://www.qgis.org/> <http://fr.openoffice.org/> 
<http://www.mozilla-europe.org/fr/> <http://www.mozilla-europe.org/fr/>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101203/0bb6e49e/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Skypelogo.jpg
Type: image/jpeg
Size: 5395 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101203/0bb6e49e/attachment.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Rlogo.jpg
Type: image/jpeg
Size: 1753 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101203/0bb6e49e/attachment-0001.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: GRASSlogo.png
Type: image/png
Size: 3277 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101203/0bb6e49e/attachment.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: QGIS.png
Type: image/png
Size: 4144 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101203/0bb6e49e/attachment-0001.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: OOlogo.gif
Type: image/gif
Size: 4246 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101203/0bb6e49e/attachment.gif>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: TBlogo.jpg
Type: image/jpeg
Size: 1385 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101203/0bb6e49e/attachment-0002.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: FFlogo.jpg
Type: image/jpeg
Size: 1686 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101203/0bb6e49e/attachment-0003.jpg>

From gianni.lavaredo at gmail.com  Fri Dec  3 15:10:37 2010
From: gianni.lavaredo at gmail.com (gianni lavaredo)
Date: Fri, 3 Dec 2010 15:10:37 +0100
Subject: [R-sig-Geo] Randmforest and VARIABLE SELECTION with leaps()
Message-ID: <AANLkTi=fVQ51vsNKx+9q=ZUo1PBMJeZi=aGEnqxt6h8z@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101203/b7d7b303/attachment.pl>

From a.mosnier at gmail.com  Fri Dec  3 15:38:10 2010
From: a.mosnier at gmail.com (Arnaud Mosnier)
Date: Fri, 3 Dec 2010 09:38:10 -0500
Subject: [R-sig-Geo] Spatial interpolation possibilities
Message-ID: <AANLkTi=DM-WQO7yFK+mkai2sZ2mvKFkwGSKTxUBq-06r@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101203/a30d1dec/attachment.pl>

From giuseppe.amatulli at gmail.com  Fri Dec  3 16:04:03 2010
From: giuseppe.amatulli at gmail.com (Giuseppe Amatulli)
Date: Fri, 3 Dec 2010 16:04:03 +0100
Subject: [R-sig-Geo] Randmforest and VARIABLE SELECTION with leaps()
In-Reply-To: <AANLkTi=fVQ51vsNKx+9q=ZUo1PBMJeZi=aGEnqxt6h8z@mail.gmail.com>
References: <AANLkTi=fVQ51vsNKx+9q=ZUo1PBMJeZi=aGEnqxt6h8z@mail.gmail.com>
Message-ID: <AANLkTik-6wTXFcDTqWABGCMk8G1AGsDE+eGZgpvFZa0f@mail.gmail.com>

Ciao Gianni,
no, in principal you do not need to do do any variable selection or
transformation.
The multiple random permutations allow to discover all the possible
relationship even if the variable are very similar. Indeed if the
variable are very similar they should be close in the variable
importance.

Usually the tree growing is not very memory demanding (for a matrix
of 100 000 ) so you do not need to reduce the number of variables. But
in case of prediction to raster data can be important to split in
tails the predictors. In this case a re-run of random forest without
the less important variables can speed up the final map creation.

Ciao
Giuseppe Amatulli


On 3 December 2010 15:10, gianni lavaredo <gianni.lavaredo at gmail.com> wrote:
> Dear Researchers,
>
> i am not a RandomForest expertise and sorry for not smart question.
>
> I have several predict variables ?(some conceptually really similar) and I
> wish to use randomforest in R. Is It useful to use a variable secletion
> before using RandomForest to select reduce the number of variable?
>
>
> thanks
> Gianni
>
> ? ? ? ?[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From yan_boulanger at hotmail.com  Fri Dec  3 16:33:12 2010
From: yan_boulanger at hotmail.com (Yan Boulanger)
Date: Fri, 3 Dec 2010 15:33:12 +0000
Subject: [R-sig-Geo] spatial null models to assess "validity" of spatial
	clusterings
Message-ID: <SNT124-W12F1A87D1AE1D70B7FAFD48D280@phx.gbl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101203/6f711e8e/attachment.pl>

From b.rowlingson at lancaster.ac.uk  Fri Dec  3 18:57:43 2010
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Fri, 3 Dec 2010 17:57:43 +0000
Subject: [R-sig-Geo] SaTScan in R
In-Reply-To: <156428.51956.qm@web36306.mail.mud.yahoo.com>
References: <156428.51956.qm@web36306.mail.mud.yahoo.com>
Message-ID: <AANLkTikgJ609qU2vkVmrj4xKX=GkcyWNSyAqSXM_sO+v@mail.gmail.com>

On Fri, Dec 3, 2010 at 8:25 AM, Kitty Lee <lee.kitty at yahoo.com> wrote:
> I'm wondering is there a package in R that has similar functions as SaTscan? In particular, I'm looking for space-time cluster detection. The D-cluster package doesn't appear to have a function for space-time detection (please correct me if I'm wrong).
>
> Any ideas would be highly appreciated!

 SaTScan (TM) seems to be a Java GUI on a whole bunch of scan
statistics devised by Kulldorff. Running RSiteSearch("kulldorff")
doesn't find any implementations of space-time scan statistics in R.
So I'm thinking not.

 But it would be a heck of a great project to start. SaTScan (TM) is
closed source, but has a fairly permissive license (it allows
redistribution). I thought it would be able to produce pretty maps
like on its web page, but that appears to be misleading - one would
have to load the output data into a GIS (or R) for mapping.

 Also, don't forget that SaTScan(TM) is trademarked to Kulldorff so
you have to say (TM) every time you mention it. All the methods are
published, so reimplementations of them should not be covered by
trademark, patent, copyright problems (oh, I'm not a lawyer...).

 So basically, the answer is no, but if Kulldorff reads this, how
about opening the source?

Barry


From mloranty at whrc.org  Fri Dec  3 20:22:01 2010
From: mloranty at whrc.org (Michael Loranty)
Date: Fri, 3 Dec 2010 14:22:01 -0500
Subject: [R-sig-Geo] temporal interpolation with stackApply
In-Reply-To: <AANLkTikEwor_d-FMObMKt8FDmsArnByT0piRZpsSKs7U@mail.gmail.com>
References: <5FDDBA76-5FA2-4773-882C-0500709635F5@whrc.org>
	<AANLkTikEwor_d-FMObMKt8FDmsArnByT0piRZpsSKs7U@mail.gmail.com>
Message-ID: <A76F9A37-A7E2-4DFD-B066-3092D2844F60@whrc.org>

Thanks again for your help Robert.

It turns out that the problem has to do with writing a geotiff file  
(see example below).  I'm not knowledgeable enough to know much more  
than the fact that the number of layers~number of cells seems to be  
limiting somehow.  At any rate my code runs happily and quickly when I  
write .grd files.

Best,
Mike

 > r <- raster(nrow=508, ncol=3825, xmn=-175.4283, xmx=-100.0055,
+ ymn=59.98306, ymx=70)
 > s <- list()
 > for (i in 1:12) {
+ r[] = runif(ncell(r)) *  65535
+ n <- unique(round(runif(0.5 * ncell(r)) * ncell(r) ))
+ r[n] <- NA
+ s[i] <- r
+ }

 >
 > s <- stack(s)

 > writeRaster(s, filename = "big_raster_test.tif", overwrite = T)

  *** caught segfault ***
address 0x1020, cause 'memory not mapped'

Traceback:
  1: .Call("RGDAL_CopyDataset", dataset, getDriver(dataset),  
FALSE,     options, filename, PACKAGE = "rgdal")
  2: .local(.Object, ...)
  3: initialize(value, ...)
  4: initialize(value, ...)
  5: new(new.class, handle = .Call("RGDAL_CopyDataset", dataset,  
getDriver(dataset),     FALSE, options, filename, PACKAGE = "rgdal"))
  6: saveDataset(raster at file@transient, raster at file@name, options =  
options)
  7: .stopGDALwriting(x)
  8: writeStop(b)
  9: writeStop(b)
10: .local(x, filename, ...)
11: writeRaster(s, filename = "big_raster_test.tif", overwrite = T)
12: writeRaster(s, filename = "big_raster_test.tif", overwrite = T)



Michael Loranty Ph.D.
Postdoctoral Fellow
The Woods Hole Research Center
149 Woods Hole Rd
Falmouth, MA 02540
508.444.1560
mloranty at whrc.org








On Dec 1, 2010, at 7:34 PM, Robert J. Hijmans wrote:

> Michael,
>
> Thanks for sending an good self-contained example. If you use
> stackApply with layers=1:nlayers you are requesting that the function
> should be applied to each layer separately. That is OK for the first
> case (set.NA) although 'calc' would be more direct. But it does not
> for fill.NA, because that function needs the values of all layers in a
> single computations. In this case you must use calc. The below works:
>
>
> r <- raster(ncol=10, nrow=10)
> r[] <- 1:ncell(r)
>
> s <- stack(r,flip(r,direction = "x"),flip(r,direction =
> "y"),r,flip(r,direction = "y"),flip(r,direction = "x"))
> set.NA <- function(x, na.rm = T){x[x==18] <- NA; return(x)}
> s <- calc(s, fun=set.NA)
>
> fill.NA <- function(x,na.rm = F){
>    fill <- approxfun(x, y = NULL, method = 'linear', rule = 2)
>    rec <- which(is.na(x))
>    x[rec] <- fill(rec)
>    return(x)
> }
>
> ss <- calc(s,fun=fill.NA)
>
>
> Best, Robert
>
> On Wed, Dec 1, 2010 at 1:44 PM, Michael Loranty <mloranty at whrc.org>  
> wrote:
>> Hi All,
>>
>> I have a raster stack, that represents a time series of temperature
>> observations, and would like to interpolate temporally to fill gaps  
>> in the
>> data. That is, to apply a gap-filling function across all layers in  
>> a stack,
>> pixel by pixel. My hope was to accomplish this using stackApply,  
>> however
>> this doesn't seem to work. The reason seems to be associated with  
>> how the
>> data are handled within stackApply which is based upon the type of  
>> function
>> that is used.
>>
>> Has anyone else encountered a similar problem or come up with a  
>> solution? It
>> seems to me that it may not be too difficult to make a a function  
>> to do this
>> based upon few minor adjustments to the current raster function. A  
>> simple
>> example is below.
>>
>> Best,
>> Mike
>>
>>
>>> r <- raster(ncol=10, nrow=10)
>>> r[]=1:ncell(r)
>>> s <- brick(r,flip(r,direction = "x"),flip(r,direction =
>>> "y"),r,flip(r,direction = "y"),flip(r,direction = "x"))
>>>
>>> set.NA <- function(x, na.rm = T){x[x==18] <- NA; return(x)}
>>>
>>> s <- stackApply(s,fun = set.NA, indices = 1:nlayers(s))
>>>
>>> fill.NA <- function(x,na.rm = F){
>> +                       fill <- approxfun(x, y = NULL, method =  
>> 'linear',
>> rule = 2);
>> +                       new <- fill(1:length(x));
>> +                       rec <- which(is.na(x));
>> +                       x[rec] <- new[rec];
>> +                       return(x)
>> +                       }
>>>
>>> s < - stackApply(s,fun=fill.NA,indices = 1:nlayers(s))
>> Error in approxfun(x, y = NULL, method = "linear", rule = 2) :
>>  need at least two non-NA values to interpolate
>>>
>>> sessionInfo()
>> R version 2.11.1 (2010-05-31)
>> x86_64-apple-darwin9.8.0
>>
>> other attached packages:
>> [1] rgdal_0.6-27  raster_1.6-22 sp_0.9-72
>>
>>
>>
>> Michael Loranty Ph.D.
>> Postdoctoral Fellow
>> The Woods Hole Research Center
>> 149 Woods Hole Rd
>> Falmouth, MA 02540
>> 508.444.1560
>> mloranty at whrc.org
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>


From renaud.lancelot at cirad.fr  Fri Dec  3 20:37:08 2010
From: renaud.lancelot at cirad.fr (lancelot)
Date: Fri, 03 Dec 2010 20:37:08 +0100
Subject: [R-sig-Geo] SaTScan in R
In-Reply-To: <AANLkTikgJ609qU2vkVmrj4xKX=GkcyWNSyAqSXM_sO+v@mail.gmail.com>
References: <156428.51956.qm@web36306.mail.mud.yahoo.com>
	<AANLkTikgJ609qU2vkVmrj4xKX=GkcyWNSyAqSXM_sO+v@mail.gmail.com>
Message-ID: <4CF946E4.6050403@cirad.fr>

Le 03/12/2010 18:57, Barry Rowlingson a ?crit :
> On Fri, Dec 3, 2010 at 8:25 AM, Kitty Lee<lee.kitty at yahoo.com>
> wrote:
>> I'm wondering is there a package in R that has similar functions as
>> SaTscan? In particular, I'm looking for space-time cluster
>> detection. The D-cluster package doesn't appear to have a function
>> for space-time detection (please correct me if I'm wrong).
>>
>> Any ideas would be highly appreciated!
>
> SaTScan (TM) seems to be a Java GUI on a whole bunch of scan
> statistics devised by Kulldorff. Running RSiteSearch("kulldorff")
> doesn't find any implementations of space-time scan statistics in R.
> So I'm thinking not.
>
> But it would be a heck of a great project to start. SaTScan (TM) is
> closed source, but has a fairly permissive license (it allows
> redistribution). I thought it would be able to produce pretty maps
> like on its web page, but that appears to be misleading - one would
> have to load the output data into a GIS (or R) for mapping.
>
> Also, don't forget that SaTScan(TM) is trademarked to Kulldorff so
> you have to say (TM) every time you mention it. All the methods are
> published, so reimplementations of them should not be covered by
> trademark, patent, copyright problems (oh, I'm not a lawyer...).
>
> So basically, the answer is no, but if Kulldorff reads this, how
> about opening the source?

That would be great! I feel we miss these methods in the current 
implementation of R packages for spatial epidemiology.

All the best,

Renaud



>
> Barry
>
> _______________________________________________ R-sig-Geo mailing
> list R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Renaud Lancelot
EDEN Project, coordinator
http://www.eden-fp6project.net/

UMR CIRAD-INRA "Contr?le des maladies animales exotiques et ?mergentes"
Joint research unit "Control of emerging and exotic animal diseases"

CIRAD, Campus International de Baillarguet TA A-DIR / B
F34398 Montpellier
http://umr-cmaee.cirad.fr/

Tel.  +33 4 67 59 37 17  -  Fax  +33 4 67 59 37 95
Secr. +33 4 67 59 37 37  - Cell. +33 6 77 52 08 69


From moshersteven at gmail.com  Fri Dec  3 20:54:48 2010
From: moshersteven at gmail.com (steven mosher)
Date: Fri, 3 Dec 2010 11:54:48 -0800
Subject: [R-sig-Geo] gridded time series analysis
In-Reply-To: <AANLkTin5-hV=b8yxQnvviF_4w-uPfsSJ9X82pmbi=WQo@mail.gmail.com>
References: <AANLkTimTdxzoDCfJQOB8bgQRhjLy3YzSbtGtMdijk9sQ@mail.gmail.com>
	<771411.8321.qm@web29709.mail.ird.yahoo.com>
	<AANLkTin2DYocWNOAR-LfGoBP4+gCtA7eVDHmoaQ6wriR@mail.gmail.com>
	<AANLkTimFw1zMH75s+TG+SFkBHfXzpURm2WXskAa8Kp=m@mail.gmail.com>
	<AANLkTim9dBnVkZ0tjvoa1YRpPRr156jJ9zcezMDrtzhX@mail.gmail.com>
	<AANLkTi=vW6NXYXKGNa0gcTfZ8ezEjvegdxU3Dt5SPA4F@mail.gmail.com>
	<AANLkTikqNmC62Pv-n9Dxd1w7fTHJPx8cR72U6YEtWMTV@mail.gmail.com>
	<AANLkTikQsL9opzu1i0mWxtJA6YmcgBbGdbihXFOwPRho@mail.gmail.com>
	<AANLkTinY5+3JbpZfWnriDZNOdmcfic0628Qi0=NDZghK@mail.gmail.com>
	<AANLkTikd-PJKWZdWUL2+S9VYAq1QJ4LPwG2==erEs2+Q@mail.gmail.com>
	<AANLkTi=eZL0Rq5EyoRA29fdnN2VL-Xt6hcGN4DnZgCKk@mail.gmail.com>
	<AANLkTikVto4GD=vO=5YKwKXL7y+Ze4ADn2KXpsw1AFVA@mail.gmail.com>
	<AANLkTinUvhmDLP2YSWuqb5=G0YKX=sWp6yMOj9KPAgdA@mail.gmail.com>
	<AANLkTi=P5HNFjEsaapUBF7vSAFAsekU_4bYJqXnW=gbu@mail.gmail.com>
	<AANLkTikwWainpBBeSr8xnNNq8uoFXdU2n_34y2-u6K5J@mail.gmail.com>
	<AANLkTin5-hV=b8yxQnvviF_4w-uPfsSJ9X82pmbi=WQo@mail.gmail.com>
Message-ID: <AANLkTikmPMvBRuu6RvjXsd8LdJc38FP+tAiF9iAc31Ks@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101203/c5941829/attachment.pl>

From r.hijmans at gmail.com  Fri Dec  3 20:58:19 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Fri, 3 Dec 2010 11:58:19 -0800
Subject: [R-sig-Geo] gridded time series analysis
In-Reply-To: <AANLkTikmPMvBRuu6RvjXsd8LdJc38FP+tAiF9iAc31Ks@mail.gmail.com>
References: <AANLkTimTdxzoDCfJQOB8bgQRhjLy3YzSbtGtMdijk9sQ@mail.gmail.com>
	<771411.8321.qm@web29709.mail.ird.yahoo.com>
	<AANLkTin2DYocWNOAR-LfGoBP4+gCtA7eVDHmoaQ6wriR@mail.gmail.com>
	<AANLkTimFw1zMH75s+TG+SFkBHfXzpURm2WXskAa8Kp=m@mail.gmail.com>
	<AANLkTim9dBnVkZ0tjvoa1YRpPRr156jJ9zcezMDrtzhX@mail.gmail.com>
	<AANLkTi=vW6NXYXKGNa0gcTfZ8ezEjvegdxU3Dt5SPA4F@mail.gmail.com>
	<AANLkTikqNmC62Pv-n9Dxd1w7fTHJPx8cR72U6YEtWMTV@mail.gmail.com>
	<AANLkTikQsL9opzu1i0mWxtJA6YmcgBbGdbihXFOwPRho@mail.gmail.com>
	<AANLkTinY5+3JbpZfWnriDZNOdmcfic0628Qi0=NDZghK@mail.gmail.com>
	<AANLkTikd-PJKWZdWUL2+S9VYAq1QJ4LPwG2==erEs2+Q@mail.gmail.com>
	<AANLkTi=eZL0Rq5EyoRA29fdnN2VL-Xt6hcGN4DnZgCKk@mail.gmail.com>
	<AANLkTikVto4GD=vO=5YKwKXL7y+Ze4ADn2KXpsw1AFVA@mail.gmail.com>
	<AANLkTinUvhmDLP2YSWuqb5=G0YKX=sWp6yMOj9KPAgdA@mail.gmail.com>
	<AANLkTi=P5HNFjEsaapUBF7vSAFAsekU_4bYJqXnW=gbu@mail.gmail.com>
	<AANLkTikwWainpBBeSr8xnNNq8uoFXdU2n_34y2-u6K5J@mail.gmail.com>
	<AANLkTin5-hV=b8yxQnvviF_4w-uPfsSJ9X82pmbi=WQo@mail.gmail.com>
	<AANLkTikmPMvBRuu6RvjXsd8LdJc38FP+tAiF9iAc31Ks@mail.gmail.com>
Message-ID: <AANLkTikSowU_SFiCmZyE3TKEa_UesH_SDQdPP63i+ERY@mail.gmail.com>

It may have been fixed. Please try this again in raster 1.7-8 (now on
CRAN for windows and linux, mac in a day or so). Robert

On Fri, Dec 3, 2010 at 11:54 AM, steven mosher <moshersteven at gmail.com> wrote:
> Well,
> ??I need some more information.
> ?before you create the stack do this and report the results
> test1 <- layerNames(rcmraster)
> test2 <- layerNames(emitraster)
> str(test1)
> str(test2)
> Its a bit of a hack but ?you can try to copy the layerNames out of the
> invidual stacks.
> Then set them to ? ?""
> then create one big stack
> then set the layerNames.
> ( I recall having to do that once in the past after a stackApply())
> I know in the past, I've had some similar issues, but I thought that they
> ?had been fixed.
> I'll try to take a look at the code ?in a bit, but if there is a bug, either
> robert or Jacob would have to fix it.
>
> On Fri, Dec 3, 2010 at 4:28 AM, Advait Godbole <advaitgodbole at gmail.com>
> wrote:
>>
>> With Robert being away until the 15th, can someone else help out with this
>> issue? To recap, I have read in two 507 x ?356 x 120 (lon,lat,time) netCDF
>> files into R using the "brick" function. I get the following error when I
>> use "stack" to clump these two multi layer rasters together.
>> > s <- stack(rcmraster,emitraster)
>> Error in function (classes, fdef, mtable) ?:
>> ??unable to find an inherited method for function "trim", for signature
>> "integer"
>> Robert suggested that it is because of the layerNames being numeric, annd
>> that layerNames() <- layerNames() would solve it but it did not help, even
>> though layerNames() is now of type character.
>> Thanks much!
>> adv
>> On Fri, Dec 3, 2010 at 7:13 AM, Advait Godbole <advaitgodbole at gmail.com>
>> wrote:
>>>
>>> the setMinMax() function worked. Thanks Steve and Robert..
>>> the work around did not work - I still get the trim() error..
>>> adv
>>>
>>> On Thu, Dec 2, 2010 at 1:43 PM, Robert J. Hijmans <r.hijmans at gmail.com>
>>> wrote:
>>>>
>>>> This is the work around:
>>>>
>>>> layerNames(rcmraster) <- layerNames(rcmraster)
>>>>
>>>>
>>>> On Thu, Dec 2, 2010 at 10:43 AM, Robert J. Hijmans <r.hijmans at gmail.com>
>>>> wrote:
>>>> > The question marks indicate that the min and max values are not known
>>>> > to the object (because the file type does not store them, and it is
>>>> > too 'expensive' to determine them on the fly). setMinMax if you really
>>>> > need to know.
>>>> > The error on trim seems to be a problem with layerNames being numeric.
>>>> > I'll fix that. This may be a work-around
>>>> >
>>>> >
>>>> >
>>>> >
>>>> >
>>>> >
>>>> > On Thu, Dec 2, 2010 at 10:23 AM, steven mosher
>>>> > <moshersteven at gmail.com> wrote:
>>>> >> ?see the setMinMax()
>>>> >>
>>>> >> ?for the error on trim() I'm not sure.
>>>> >>
>>>> >> On Thu, Dec 2, 2010 at 5:16 AM, Advait Godbole
>>>> >> <advaitgodbole at gmail.com>
>>>> >> wrote:
>>>> >>>
>>>> >>> That worked perfectly. Thanks for pointing this out. I changed the
>>>> >>> way my
>>>> >>> variables were being written to the netCDF and now "brick" works.
>>>> >>> However,
>>>> >>> I
>>>> >>> am getting an error while using the stack function, like so:
>>>> >>>
>>>> >>> "Error in function (classes, fdef, mtable) ?:
>>>> >>> ?unable to find an inherited method for function "trim", for
>>>> >>> signature
>>>> >>> "integer"
>>>> >>>
>>>> >>> The two rasters show the following:
>>>> >>> > rcmraster
>>>> >>> class ? ? ? : RasterBrick
>>>> >>> filename ? ?: regcm.cumul.hdd.10k.96_05.fixed.latlonvars.nc
>>>> >>> nlayers ? ? : 120
>>>> >>> nrow ? ? ? ?: 356
>>>> >>> ncol ? ? ? ?: 507
>>>> >>> ncell ? ? ? : 180492
>>>> >>> projection ?: +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0
>>>> >>> min value ? : ? ? ? ? ? ? ? ? ? ?
>>>> >>> max value ? : ? ? ? ? ? ? ? ? ? ?
>>>> >>> xmin ? ? ? ?: -137.3312
>>>> >>> xmax ? ? ? ?: -62.11259
>>>> >>> ymin ? ? ? ?: 22.12693
>>>> >>> ymax ? ? ? ?: 57.35954
>>>> >>> xres ? ? ? ?: 0.1483602
>>>> >>> yres ? ? ? ?: 0.09896801
>>>> >>>
>>>> >>> > emitraster
>>>> >>> class ? ? ? : RasterBrick
>>>> >>> filename ? ?:
>>>> >>> flip.percap.vulcan.10k.dp.build.381.RES.EIAmy.96_05.this.latest.nc
>>>> >>> nlayers ? ? : 120
>>>> >>> nrow ? ? ? ?: 356
>>>> >>> ncol ? ? ? ?: 507
>>>> >>> ncell ? ? ? : 180492
>>>> >>> projection ?: +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0
>>>> >>> min value ? : ? ? ? ? ? ? ? ? ? ?
>>>> >>> max value ? : ? ? ? ? ? ? ? ? ? ?
>>>> >>> xmin ? ? ? ?: -137.3312
>>>> >>> xmax ? ? ? ?: -62.11259
>>>> >>> ymin ? ? ? ?: 22.12693
>>>> >>> ymax ? ? ? ?: 57.35954
>>>> >>> xres ? ? ? ?: 0.1483602
>>>> >>> yres ? ? ? ?: 0.09896801
>>>> >>>
>>>> >>> A getValues call shows a lot of NAs. Now, my original file does have
>>>> >>> a
>>>> >>> large
>>>> >>> number of missing values so that is why this should happen, but I
>>>> >>> suspect
>>>> >>> something is going wrong since the min and max values are not being
>>>> >>> displayed for either of these rasters. Is that the source of the
>>>> >>> problem
>>>> >>> in
>>>> >>> the "stack" function?
>>>> >>>
>>>> >>> Thanks,
>>>> >>>
>>>> >>> Advait
>>>> >>>
>>>> >>> On Tue, Nov 30, 2010 at 5:18 PM, Robert J. Hijmans
>>>> >>> <r.hijmans at gmail.com>wrote:
>>>> >>>
>>>> >>> > Advait,
>>>> >>> >
>>>> >>> > The is an error in the file, I think, see below:
>>>> >>> >
>>>> >>> > > library(ncdf)
>>>> >>> > > filename = "c:/downloads/regcm.cumul.hdd.10k.96_05.new.nc"
>>>> >>> > > nc <- open.ncdf(filename)
>>>> >>> > >
>>>> >>> > > zvar <- 'hdd'
>>>> >>> > > nc$var[[zvar]]$dim[[1]]$len
>>>> >>> > [1] 507
>>>> >>> > > nc$var[[zvar]]$dim[[2]]$len
>>>> >>> > [1] 356
>>>> >>> > >
>>>> >>> > > xx <- nc$var[[zvar]]$dim[[1]]$vals
>>>> >>> > > # should be a vector of 507 longitudes but:
>>>> >>> > > dim(xx)
>>>> >>> > [1] 507 356 120
>>>> >>> > >
>>>> >>> > > # works anyway
>>>> >>> > > xrange <- c(min(xx), max(xx))
>>>> >>> > > xrange
>>>> >>> > [1] -137.25705 ?-62.18677
>>>> >>> > >
>>>> >>> > > yy <- nc$var[[zvar]]$dim[[2]]$vals
>>>> >>> > > # should be a vector of 356 latitudes but:
>>>> >>> > > dim(yy)
>>>> >>> > [1] 507 356 120
>>>> >>> > >
>>>> >>> > > # this fails
>>>> >>> > > yrange <- c(min(yy), max(yy))
>>>> >>> > > yrange
>>>> >>> > [1] NaN NaN
>>>> >>> > > # and that is the only reason why raster failed.
>>>> >>> > >
>>>> >>> > > #OK
>>>> >>> > > yy[,,1][1:10,350:355]
>>>> >>> > ? ? ? ? ?[,1] ? ? [,2] ? ? [,3] ? ? [,4] ? ? [,5] ? ? [,6]
>>>> >>> > ?[1,] 51.49148 51.57122 51.65092 51.73055 51.81014 51.88967
>>>> >>> > ?[2,] 51.52888 51.60866 51.68839 51.76807 51.84769 51.92727
>>>> >>> > ?[3,] 51.56616 51.64598 51.72575 51.80547 51.88513 51.96474
>>>> >>> > ?[4,] 51.60332 51.68318 51.76299 51.84275 51.92245 52.00210
>>>> >>> > ?[5,] 51.64036 51.72026 51.80011 51.87991 51.95965 52.03934
>>>> >>> > ?[6,] 51.67728 51.75722 51.83711 51.91695 51.99673 52.07646
>>>> >>> > ?[7,] 51.71409 51.79407 51.87399 51.95387 52.03369 52.11345
>>>> >>> > ?[8,] 51.75077 51.83079 51.91076 51.99067 52.07053 52.15033
>>>> >>> > ?[9,] 51.78734 51.86739 51.94740 52.02735 52.10725 52.18709
>>>> >>> > [10,] 51.82378 51.90388 51.98392 52.06391 52.14385 52.22373
>>>> >>> > >
>>>> >>> > > #bad values here (and note the NaN):
>>>> >>> > > yy[,,120][1:10,350:355]
>>>> >>> > ? ? ? ? ? ? ? ?[,1] ? ? ? ? ? [,2] ? ? ? ? ? [,3] ? ? ? ? ? [,4]
>>>> >>> > ? ? [,5] ? ? ? ? ? [,6]
>>>> >>> > ?[1,] -1.313847e-229 -4.895880e-272 -7.553765e-266 ? 1.293814e+58
>>>> >>> > 9.551441e-293 ?-3.291580e-36
>>>> >>> > ?[2,] -5.321424e+272 -3.076997e-223 ?-1.515780e-33 -9.895836e+171
>>>> >>> > 3.115686e-149 ?-4.970539e+92
>>>> >>> > ?[3,] ?5.259277e-203 ? 5.980335e-56 ?2.893449e-212 ?2.974200e+274
>>>> >>> > 3.186547e-218 ?2.503689e+296
>>>> >>> > ?[4,] -3.977129e+225 -3.696719e-283 ? 1.284612e+42 ? 1.887923e+28
>>>> >>> > -2.322520e+268 ?5.005820e-108
>>>> >>> > ?[5,] ?-6.569744e+88 ? 1.824506e-74 ? 7.663356e+39 ?1.608759e-201
>>>> >>> > -1.433761e+110 -8.804183e-211
>>>> >>> > ?[6,] -4.237822e-162 ? ? ? ? ? ?NaN ?7.405904e-275 ?5.859877e-258
>>>> >>> > 1.339820e+110 ?1.631993e+229
>>>> >>> > ?[7,] ? 5.603325e-64 ? 4.188764e+37 -2.188887e+243 -4.657907e+280
>>>> >>> > 1.795268e-185 ?1.166057e-175
>>>> >>> > ?[8,] -2.112804e-229 ?4.536625e+137 ?2.910322e-278 ?4.407645e-274
>>>> >>> > 8.886205e-239 -1.913860e+238
>>>> >>> > ?[9,] ?-9.126350e+44 -1.866422e+177 -2.578975e+256 ?3.275379e+208
>>>> >>> > -2.657457e+75 ?-1.258259e-90
>>>> >>> > [10,] ?6.698325e+216 -2.958355e+137 -1.058748e-178 -1.776776e+215
>>>> >>> > -6.368807e+78 -5.337653e+299
>>>> >>> > >
>>>> >>> > > # this would have worked
>>>> >>> > > yrange <- c(min(yy[,,1]), max(yy[,,1]))
>>>> >>> > > yrange
>>>> >>> > [1] 22.17641 57.31006
>>>> >>> > >
>>>> >>> > > close.ncdf(nc)
>>>> >>> >
>>>> >>> >
>>>> >>> > Best, Robert
>>>> >>> >
>>>> >>> >
>>>> >>> > On Tue, Nov 30, 2010 at 10:37 AM, Advait Godbole
>>>> >>> > <advaitgodbole at gmail.com> wrote:
>>>> >>> > > Dear Robert,
>>>> >>> > > here is the link to the file:
>>>> >>> > >
>>>> >>> > > http://dl.dropbox.com/u/4030944/regcm.cumul.hdd.10k.96_05.new.nc. It
>>>> >>> > > is
>>>> >>> > a
>>>> >>> > > large file ~400 MB. Let me know if dropbox is not convenient and
>>>> >>> > > you
>>>> >>> > would
>>>> >>> > > rather do ftp - ?but our machines are down for maintenance and I
>>>> >>> > > may
>>>> >>> > > not
>>>> >>> > be
>>>> >>> > > immediately able to get access.
>>>> >>> > > I was going over the NCL code that processes the files but did
>>>> >>> > > not
>>>> >>> > > find
>>>> >>> > > anything glaringly amiss, so I will have to look at it in
>>>> >>> > > greater
>>>> >>> > > detail
>>>> >>> > > since it is clear that the number of entries in the variables is
>>>> >>> > > not
>>>> >>> > right
>>>> >>> > > as you've pointed out. There is a chance that I have not written
>>>> >>> > > out
>>>> >>> > > the
>>>> >>> > > co-ordinates properly.
>>>> >>> > > Thanks,
>>>> >>> > > Advait
>>>> >>> > > On Mon, Nov 29, 2010 at 1:14 PM, Robert J. Hijmans
>>>> >>> > > <r.hijmans at gmail.com>
>>>> >>> > > wrote:
>>>> >>> > >>
>>>> >>> > >> Advait,
>>>> >>> > >> I do not think I can help you further unless you send me your
>>>> >>> > >> file;
>>>> >>> > >> but this suggests that it is either not following the CF
>>>> >>> > >> standards,
>>>> >>> > >> or
>>>> >>> > >> something is wrong with the file, or that there is something I
>>>> >>> > >> have
>>>> >>> > >> not understood about these files.
>>>> >>> > >> You said you have 507 x 356 x 120 values. I would expect
>>>> >>> > >> length(frcm$dim[[1]]$vals) == 507 and
>>>> >>> > >> length(frcm$dim[[2]]$vals) ==
>>>> >>> > >> 356
>>>> >>> > >> Robert
>>>> >>> > >>
>>>> >>> > >> On Mon, Nov 29, 2010 at 6:11 AM, Advait Godbole <
>>>> >>> > advaitgodbole at gmail.com>
>>>> >>> > >> wrote:
>>>> >>> > >> > sorry to disrupt the flow of the conversation, but after
>>>> >>> > >> > doing what
>>>> >>> > >> > Robert
>>>> >>> > >> > suggested, this is what was returned:
>>>> >>> > >> >> length(frcm$dim[[1]]$vals)
>>>> >>> > >> > [1] 21659040
>>>> >>> > >> >> length(frcm$dim[[2]]$vals)
>>>> >>> > >> > [1] 21659040
>>>> >>> > >> > the other two functions return the latitude and longitude
>>>> >>> > >> > arrays
>>>> >>> > >> > not
>>>> >>> > >> > populated with NAs/missing values. I havent reproduced them
>>>> >>> > >> > here
>>>> >>> > because
>>>> >>> > >> > of
>>>> >>> > >> > their number.
>>>> >>> > >> > Regards,
>>>> >>> > >> > advait
>>>> >>> > >> > On Sat, Nov 27, 2010 at 3:48 PM, Robert J. Hijmans <
>>>> >>> > r.hijmans at gmail.com>
>>>> >>> > >> > wrote:
>>>> >>> > >> >>
>>>> >>> > >> >> Advait,
>>>> >>> > >> >>
>>>> >>> > >> >> That suggests that you have missing values in the lon or lat
>>>> >>> > >> >> dimensions. Is that true? That would be awkward, but perhaps
>>>> >>> > something
>>>> >>> > >> >> else is going on. Can you send me your file? If not can you
>>>> >>> > >> >> send
>>>> >>> > >> >> the
>>>> >>> > >> >> results of this:
>>>> >>> > >> >>
>>>> >>> > >> >> filename <- "regcm.cumul.hdd.10k.96_05.new.nc"
>>>> >>> > >> >> nc <- open.ncdf(filename)
>>>> >>> > >> >> length(nc$dim[[1]]$vals)
>>>> >>> > >> >> length(nc$dim[[2]]$vals)
>>>> >>> > >> >> nc$dim[[1]]$vals
>>>> >>> > >> >> nc$dim[[2]]$vals
>>>> >>> > >> >> close.ncdf(nc)
>>>> >>> > >> >>
>>>> >>> > >> >> Thanks, Robert
>>>> >>> > >> >>
>>>> >>> > >> >> On Sat, Nov 27, 2010 at 8:36 AM, Advait Godbole
>>>> >>> > >> >> <advaitgodbole at gmail.com>
>>>> >>> > >> >> wrote:
>>>> >>> > >> >> > Thanks everyone for these leads..However, I am running
>>>> >>> > >> >> > into
>>>> >>> > problems
>>>> >>> > >> >> > with
>>>> >>> > >> >> > data handling. I used ncdf to extract the two variables
>>>> >>> > >> >> > (507 x
>>>> >>> > >> >> > 356
>>>> >>> > x
>>>> >>> > >> >> > 120
>>>> >>> > >> >> > -
>>>> >>> > >> >> > lon,lat,time) and converted them into array objects. The
>>>> >>> > suggestions
>>>> >>> > >> >> > provided all utilize the raster package, but using "brick"
>>>> >>> > >> >> > on
>>>> >>> > >> >> > the
>>>> >>> > >> >> > file
>>>> >>> > >> >> > returns this error: "rcmraster <-
>>>> >>> > >> >> > brick("regcm.cumul.hdd.10k.96_05.new.nc")
>>>> >>> > >> >> > Error in if (e at xmin > -400 & e at xmax < 400 & e at ymin > -90.1
>>>> >>> > >> >> > &
>>>> >>> > e at ymax <
>>>> >>> > >> >> > ?:
>>>> >>> > >> >> > missing value where TRUE/FALSE needed"
>>>> >>> > >> >> >
>>>> >>> > >> >> > I have a fair number of NAs (all missing values in the
>>>> >>> > >> >> > original
>>>> >>> > >> >> > variables).
>>>> >>> > >> >> > Is there a way to set a flag for that? Or any other
>>>> >>> > >> >> > workaround?
>>>> >>> > >> >> > Thanks much,
>>>> >>> > >> >> > advait
>>>> >>> > >> >> > On Fri, Nov 26, 2010 at 6:25 PM, Robert J. Hijmans
>>>> >>> > >> >> > <r.hijmans at gmail.com>
>>>> >>> > >> >> > wrote:
>>>> >>> > >> >> >>
>>>> >>> > >> >> >> There are some difference in the behavior of 'calc'
>>>> >>> > >> >> >> between
>>>> >>> > >> >> >> functions,
>>>> >>> > >> >> >> because of attempts to accommodate different functions &
>>>> >>> > intentions.
>>>> >>> > >> >> >> But in 'raster' 1.7-4 (available from R-Forge in ~ 24
>>>> >>> > >> >> >> hrs; and
>>>> >>> > from
>>>> >>> > >> >> >> CRAN soon), the below will work:
>>>> >>> > >> >> >>
>>>> >>> > >> >> >> library(raster)
>>>> >>> > >> >> >> #creating some data
>>>> >>> > >> >> >> r <- raster(nrow=10, ncol=10)
>>>> >>> > >> >> >> s1 <- s2<- list()
>>>> >>> > >> >> >> for (i in 1:12) {
>>>> >>> > >> >> >> ? ? ? ?s1[i] <- setValues(r, rnorm(ncell(r), i, 3) )
>>>> >>> > >> >> >> ? ? ? ?s2[i] <- setValues(r, rnorm(ncell(r), i, 3) )
>>>> >>> > >> >> >> }
>>>> >>> > >> >> >> s1 <- stack(s1)
>>>> >>> > >> >> >> s2 <- stack(s2)
>>>> >>> > >> >> >>
>>>> >>> > >> >> >> # regression of values in one brick (or stack) with
>>>> >>> > >> >> >> another
>>>> >>> > (Jacob's
>>>> >>> > >> >> >> suggestion)
>>>> >>> > >> >> >> s <- stack(s1, s2)
>>>> >>> > >> >> >> # s1 and s2 have 12 layers
>>>> >>> > >> >> >> fun <- function(x) { lm(x[1:12] ~
>>>> >>> > >> >> >> x[13:24])$coefficients[2] }
>>>> >>> > >> >> >> x1 <- calc(s, fun)
>>>> >>> > >> >> >>
>>>> >>> > >> >> >> # regression of values in one brick (or stack) with
>>>> >>> > >> >> >> 'time'
>>>> >>> > >> >> >> time <- 1:nlayers(s)
>>>> >>> > >> >> >> fun <- function(x) { lm(x ~ time)$coefficients[2] }
>>>> >>> > >> >> >> x2 <- calc(s, fun)
>>>> >>> > >> >> >>
>>>> >>> > >> >> >> # get multiple layers, e.g. the slope _and_ intercept
>>>> >>> > >> >> >> fun <- function(x) { lm(x ~ time)$coefficients }
>>>> >>> > >> >> >> x3 <- calc(s, fun)
>>>> >>> > >> >> >>
>>>> >>> > >> >> >> If this does not work in your version, you can use apply(
>>>> >>> > >> >> >> ) as
>>>> >>> > >> >> >> in
>>>> >>> > >> >> >> what
>>>> >>> > >> >> >> I send earlier.
>>>> >>> > >> >> >>
>>>> >>> > >> >> >> Robert
>>>> >>> > >> >> >>
>>>> >>> > >> >> >> On Fri, Nov 26, 2010 at 2:56 PM, Robert J. Hijmans
>>>> >>> > >> >> >> <r.hijmans at gmail.com>
>>>> >>> > >> >> >> wrote:
>>>> >>> > >> >> >> > It seems that 'calc' does not like this (any more;
>>>> >>> > >> >> >> > another
>>>> >>> > >> >> >> > thing
>>>> >>> > >> >> >> > to
>>>> >>> > >> >> >> > fix) . If your rasters are not very large you can use
>>>> >>> > >> >> >> > apply,
>>>> >>> > which
>>>> >>> > >> >> >> > makes it much faster:
>>>> >>> > >> >> >> >
>>>> >>> > >> >> >> > library(raster)
>>>> >>> > >> >> >> > #creating some data
>>>> >>> > >> >> >> > r <- raster(nrow=10, ncol=10)
>>>> >>> > >> >> >> > s <- list()
>>>> >>> > >> >> >> > for (i in 1:25) { s[i] <- setValues(r, rnorm(ncell(r),
>>>> >>> > >> >> >> > i, 3)
>>>> >>> > >> >> >> > ) }
>>>> >>> > >> >> >> > s <- stack(s)
>>>> >>> > >> >> >> >
>>>> >>> > >> >> >> > # regression
>>>> >>> > >> >> >> > time <- 1:nlayers(s)
>>>> >>> > >> >> >> > fun <- function(x) { lm(x ~ time)$coefficients[2] }
>>>> >>> > >> >> >> > r[] <- apply(getValues(s), 1, fun)
>>>> >>> > >> >> >> >
>>>> >>> > >> >> >> > Robert
>>>> >>> > >> >> >> >
>>>> >>> > >> >> >> >
>>>> >>> > >> >> >> >
>>>> >>> > >> >> >> > On Fri, Nov 26, 2010 at 2:51 PM, Jacob van Etten
>>>> >>> > >> >> >> > <jacobvanetten at yahoo.com> wrote:
>>>> >>> > >> >> >> >> you could try this approach (use calc whenever you
>>>> >>> > >> >> >> >> can):
>>>> >>> > >> >> >> >>
>>>> >>> > >> >> >> >> (supposing your bricks have 12 layers)
>>>> >>> > >> >> >> >>
>>>> >>> > >> >> >> >> br3 <- stack(brick1, brick2)
>>>> >>> > >> >> >> >> lmS <- function(x) lm(x[1:12] ~
>>>> >>> > >> >> >> >> x[13:24)$coefficients[2]
>>>> >>> > >> >> >> >> r <- calc(br3, lmS)
>>>> >>> > >> >> >> >>
>>>> >>> > >> >> >> >> Jacob.
>>>> >>> > >> >> >> >>
>>>> >>> > >> >> >> >> --- On Fri, 26/11/10, steven mosher
>>>> >>> > >> >> >> >> <moshersteven at gmail.com>
>>>> >>> > >> >> >> >> wrote:
>>>> >>> > >> >> >> >>
>>>> >>> > >> >> >> >> From: steven mosher <moshersteven at gmail.com>
>>>> >>> > >> >> >> >> Subject: Re: [R-sig-Geo] gridded time series analysis
>>>> >>> > >> >> >> >> To: "Martin" <martin_brandt at gmx.net>
>>>> >>> > >> >> >> >> Cc: r-sig-geo at stat.math.ethz.ch
>>>> >>> > >> >> >> >> Date: Friday, 26 November, 2010, 23:33
>>>> >>> > >> >> >> >>
>>>> >>> > >> >> >> >> that's cool, I'm also interested in a similar problem
>>>> >>> > >> >> >> >> but
>>>> >>> > >> >> >> >> just
>>>> >>> > >> >> >> >> with
>>>> >>> > >> >> >> >> one
>>>> >>> > >> >> >> >> brick ending up with a slope raster as the output. It
>>>> >>> > >> >> >> >> may be
>>>> >>> > >> >> >> >> possible
>>>> >>> > >> >> >> >> with
>>>> >>> > >> >> >> >> stackApply(). have a look. or maybe robert will chime
>>>> >>> > >> >> >> >> in
>>>> >>> > >> >> >> >>
>>>> >>> > >> >> >> >>
>>>> >>> > >> >> >> >>
>>>> >>> > >> >> >> >> On Fri, Nov 26, 2010 at 1:35 PM, Martin
>>>> >>> > >> >> >> >> <martin_brandt at gmx.net
>>>> >>> > >
>>>> >>> > >> >> >> >> wrote:
>>>> >>> > >> >> >> >>
>>>> >>> > >> >> >> >>>
>>>> >>> > >> >> >> >>> this is what I did to perform a regression between
>>>> >>> > >> >> >> >>> two
>>>> >>> > >> >> >> >>> bricks
>>>> >>> > >> >> >> >>> (each
>>>> >>> > >> >> >> >>> brick
>>>> >>> > >> >> >> >>> represent a time series):
>>>> >>> > >> >> >> >>>
>>>> >>> > >> >> >> >>> r <- raster(brick1)
>>>> >>> > >> >> >> >>> for (i in 1:ncell(r)) {
>>>> >>> > >> >> >> >>> r[i] = lm(as.ts(cellValues(brick1, i)) ~
>>>> >>> > >> >> >> >>> as.ts(cellValues(brick2,
>>>> >>> > >> >> >> >>> i)))$coefficients[2]
>>>> >>> > >> >> >> >>> }
>>>> >>> > >> >> >> >>>
>>>> >>> > >> >> >> >>> The result will be a slope raster, but it really
>>>> >>> > >> >> >> >>> takes a
>>>> >>> > >> >> >> >>> lot
>>>> >>> > of
>>>> >>> > >> >> >> >>> time,
>>>> >>> > >> >> >> >>> so
>>>> >>> > >> >> >> >>> maybe there is a better solution..
>>>> >>> > >> >> >> >>>
>>>> >>> > >> >> >> >>>
>>>> >>> > >> >> >> >>> --
>>>> >>> > >> >> >> >>> View this message in context:
>>>> >>> > >> >> >> >>>
>>>> >>> > >> >> >> >>>
>>>> >>> > >> >> >> >>>
>>>> >>> > >> >> >> >>>
>>>> >>> >
>>>> >>> >
>>>> >>> > http://r-sig-geo.2731867.n2.nabble.com/gridded-time-series-analysis-tp5775651p5778472.html
>>>> >>> > >> >> >> >>> Sent from the R-sig-geo mailing list archive at
>>>> >>> > >> >> >> >>> Nabble.com.
>>>> >>> > >> >> >> >>>
>>>> >>> > >> >> >> >>> _______________________________________________
>>>> >>> > >> >> >> >>> R-sig-Geo mailing list
>>>> >>> > >> >> >> >>> R-sig-Geo at stat.math.ethz.ch
>>>> >>> > >> >> >> >>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>> >>> > >> >> >> >>>
>>>> >>> > >> >> >> >>
>>>> >>> > >> >> >> >> ? ? [[alternative HTML version deleted]]
>>>> >>> > >> >> >> >>
>>>> >>> > >> >> >> >> _______________________________________________
>>>> >>> > >> >> >> >> R-sig-Geo mailing list
>>>> >>> > >> >> >> >> R-sig-Geo at stat.math.ethz.ch
>>>> >>> > >> >> >> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>> >>> > >> >> >> >>
>>>> >>> > >> >> >> >>
>>>> >>> > >> >> >> >>
>>>> >>> > >> >> >> >>
>>>> >>> > >> >> >> >> ? ? ? ?[[alternative HTML version deleted]]
>>>> >>> > >> >> >> >>
>>>> >>> > >> >> >> >>
>>>> >>> > >> >> >> >> _______________________________________________
>>>> >>> > >> >> >> >> R-sig-Geo mailing list
>>>> >>> > >> >> >> >> R-sig-Geo at stat.math.ethz.ch
>>>> >>> > >> >> >> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>> >>> > >> >> >> >>
>>>> >>> > >> >> >> >>
>>>> >>> > >> >> >> >
>>>> >>> > >> >> >>
>>>> >>> > >> >> >> _______________________________________________
>>>> >>> > >> >> >> R-sig-Geo mailing list
>>>> >>> > >> >> >> R-sig-Geo at stat.math.ethz.ch
>>>> >>> > >> >> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>> >>> > >> >> >
>>>> >>> > >> >> >
>>>> >>> > >> >> >
>>>> >>> > >> >> > --
>>>> >>> > >> >> > advait godbole
>>>> >>> > >> >> >
>>>> >>> > >> >
>>>> >>> > >> >
>>>> >>> > >> >
>>>> >>> > >> > --
>>>> >>> > >> > advait godbole
>>>> >>> > >> >
>>>> >>> > >
>>>> >>> > >
>>>> >>> > >
>>>> >>> > > --
>>>> >>> > > advait godbole
>>>> >>> > >
>>>> >>> >
>>>> >>>
>>>> >>>
>>>> >>>
>>>> >>> --
>>>> >>> advait godbole
>>>> >>>
>>>> >>> ? ? ? ?[[alternative HTML version deleted]]
>>>> >>>
>>>> >>> _______________________________________________
>>>> >>> R-sig-Geo mailing list
>>>> >>> R-sig-Geo at r-project.org
>>>> >>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>> >>
>>>> >>
>>>> >
>>>
>>>
>>>
>>> --
>>> advait godbole
>>
>>
>>
>> --
>> advait godbole
>
>


From r.hijmans at gmail.com  Fri Dec  3 20:59:57 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Fri, 3 Dec 2010 11:59:57 -0800
Subject: [R-sig-Geo] new function predict, package raster
In-Reply-To: <AANLkTi=ez4w1dnc3kM00jTL482JAy1MQtyAkhpPBR+dn@mail.gmail.com>
References: <AANLkTikU1d4LrvtOCsVUb3FOVWV+NMcL2cpjvC8Bw8OC@mail.gmail.com>
	<AANLkTim4_1NH-sJE1OkUAgari22wy1_V=AHf8F5MB3v=@mail.gmail.com>
	<AANLkTi=ez4w1dnc3kM00jTL482JAy1MQtyAkhpPBR+dn@mail.gmail.com>
Message-ID: <AANLkTinLzNRz2CocwHbZ3xyWgMg_zhCSpozJhZXD=99O@mail.gmail.com>

Dear Isabelle,

Thanks for the detailed report. So it is a bug after all. This is
probably fixed in raster 1.7-8 (on CRAN for win and lin now).
At least the below works for me (model with 2 variables, one is a factor).

Robert

library(raster)
# create a RasterStack (a set of predictor rasters)
logo <- stack(system.file("external/rlogo.grd", package="raster"))
presence <- matrix(c(48, 48, 48, 53, 50, 46, 54, 70, 84, 85, 74, 84,
95, 85, 66, 42, 26, 4, 19, 17, 7, 14, 26, 29, 39, 45, 51, 56, 46, 38,
31, 22, 34, 60, 70, 73, 63, 46, 43, 28), ncol=2)
background <- cbind(runif(250)*(xmax(logo)-xmin(logo))+xmin(logo),
runif(250)*(ymax(logo)-ymin(logo))+ymin(logo))

xy <- rbind(cbind(1, presence), cbind(0, background))
v <- cbind(xy[,1], extract(logo, xy[,2:3]))
colnames(v)[1] <- 'presback'
v=data.frame(v[,1:3])
v[,3] <- as.factor(v[,3])

model <- glm(formula=presback~., data=v)
r <- predict(logo, model, progress='text')




On Fri, Dec 3, 2010 at 3:26 AM, isabelle boulangeat
<isabelle.boulangeat at gmail.com> wrote:
> Hi,
>
> Thanks for all these explanations. I misunderstood the use of the "const".
> In my case, I just need to deal with an explicative variable that is
> spatially explicit but categorial.
> I should use a raster with numbers that correspond to my factor's levels.
> However, I still have some problems to predict using the categorial variable
> (raster package, version 1.7-7)
>
> my code : predict(rasStack, model=model_fac)
> Error message : Erreur dans v[cells, ] <- predv :
>
> Here are details on the raster Stack and the data.frame containing
> explicative variables to fit the model (expl).
>
> rasStack
> class?????? : RasterStack
> nlayers???? : 2
> nrow??????? : 3137
> ncol??????? : 1951
> ncell?????? : 6120287
> projection? : +proj=lcc +lat_1=45.89891888888889 +lat_2=47.69601444444444
> +lat_0=46.8 +lon_0=2.337229166666667 +x_0=600000 +y_0=2200000 +ellps=WGS84
> +datum=WGS84 +units=m +no_defs +towgs84=0,0,0
> min value?? : -1280???? 1
> max value?? : 462?? 7
> extent????? : 784300, 979400, 1858800, 2172500? (xmin, xmax, ymin, ymax)
> resolution? : 100, 100? (x, y)
>
> layerNames(rasStack)
> [1] "temp"?? "corine"
>
> unique(getValues(rasStack[[2]]))
> [1] NA? 6? 5? 1? 7? 4? 2? 3
>
> str(expl)
> 'data.frame':?? 11396 obs. of? 2 variables:
> ?$ temp? : num? -78.4 -282.9 -172.1 -173.6 -83.2 ...
> ?$ corine: Factor w/ 7 levels "1","2","3","4",..: 6 4 3 4 5 6 6 4 5 6 ...
>
> unique(expl$corine)
> [1] 6 4 3 5 7 2 1
> Levels: 1 2 3 4 5 6 7
>
> model_fac <- glm(resp ~ ., data=expl, family="binomial")
>
>
> Any idea?
>
> 2010/12/2 Robert J. Hijmans <r.hijmans at gmail.com>
>>
>> Isabelle,
>>
>> If you use a factor that is represented by numbers on a grid you can
>> just fit the model (with the factor variable as factor), and the
>> predict function will then make a factor from the predictor layers
>> (i.e. there is nothing else you need to do). Where this can go wrong
>> is if you have factor levels on your raster that were not in the data
>> used to fit the model. You can get something like:
>> Error in model.frame.default(Terms, newdata, na.action = na.action,
>> xlev = object$xlevels) :
>> ?factor 'x' has new level(s): ?2, 3, 4, 5,
>> Which means that you first need to remove those levels (set to NA)
>> from your predictor raster. (I will try to automate that problem away,
>> in raster::predict, eventually)
>>
>> The argument "const" is for factor type variables for which you do not
>> have spatial data. Hence they could be considered 'constant' in some
>> contexts. For example, with fish observation data you might have a
>> model that predicts abundance from a number of variables including the
>> method used to catch the fish. Say a factor variable "method" with
>> levels "A" or "B". You can then do something like
>> method = factor("A")
>> predict(raster, model, const=method)
>>
>> Robert
>>
>> On Thu, Dec 2, 2010 at 9:02 AM, isabelle boulangeat
>> <isabelle.boulangeat at gmail.com> wrote:
>> > Hello,
>> >
>> > I am trying to use the recently updated function "predict" from the
>> > package
>> > raster. I would like to use the field "const", as one of my variable is
>> > categorial.
>> > I have an error message but I can't find where is the problem.
>> >
>> > Error message : Erreur dans `[.data.frame`(blockvals, , f[i]) :
>> > undefined
>> > columns selected
>> >
>> > code : Pred_fac <- predict(rasStack, model=model_fac,
>> > predict=predict.glm,
>> > progress='text', const=factorDF)
>> >
>> > rasStack is a RasterStack and contains only one layer with one
>> > explicative
>> > variable. the layer name is the same as in the model.
>> > factorDF is a data.frame and contains only one column with one
>> > explicative
>> > variable. the column name is the same as in the model.
>> >
>> > the dimensions are the same : the number of rows in the data frame
>> > correspond to the number of cells in the raster.
>> >
>> > Does someone succeed to use this function with the new field "const" ?
>> >
>> > Thanks for help,
>> >
>> > Cheers,
>> >
>> > Isabelle.
>> >
>> > --
>> > Isabelle Boulangeat, PhD student
>> > Ecosystem dynamics and plant traits
>> >
>> > Bureau 203, +33 (0) 476 635 733
>> >
>> > Laboratoire d'?cologie Alpine (LECA)
>> > Grenoble, France
>> > lab' s website : http://www-leca.ujf-grenoble.fr/
>> > my website : http://j.boulangeat.free.fr/
>> >
>> > ? ? ? ?[[alternative HTML version deleted]]
>> >
>> >
>> > _______________________________________________
>> > R-sig-Geo mailing list
>> > R-sig-Geo at r-project.org
>> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> >
>> >
>
>
>
> --
> Isabelle Boulangeat, PhD student
> Ecosystem dynamics and plant traits
>
> Bureau 203, +33 (0) 476 635 733
>
> Laboratoire d'?cologie Alpine (LECA)
> Grenoble, France
> lab' s website : http://www-leca.ujf-grenoble.fr/
> my website : http://j.boulangeat.free.fr/
>


From sadz_a1000 at yahoo.co.uk  Fri Dec  3 21:52:06 2010
From: sadz_a1000 at yahoo.co.uk (Sadz A)
Date: Fri, 3 Dec 2010 20:52:06 +0000 (GMT)
Subject: [R-sig-Geo] Building a graph/network matrix
Message-ID: <396712.76215.qm@web24612.mail.ird.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101203/a91c896e/attachment.pl>

From eac16 at psu.edu  Sat Dec  4 06:04:21 2010
From: eac16 at psu.edu (Elizabeth Crisfield)
Date: Sat, 4 Dec 2010 00:04:21 -0500
Subject: [R-sig-Geo] kohonen package using netcdf data
Message-ID: <AANLkTikev46w=W6KAJ7JSoxz-xYnE1Nzj2Nekaf3Twq5@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101204/ef879779/attachment.pl>

From lubinbin220 at gmail.com  Sat Dec  4 15:09:38 2010
From: lubinbin220 at gmail.com (binbin lu)
Date: Sat, 4 Dec 2010 22:09:38 +0800
Subject: [R-sig-Geo] Building a graph/network matrix
In-Reply-To: <396712.76215.qm@web24612.mail.ird.yahoo.com>
References: <396712.76215.qm@web24612.mail.ird.yahoo.com>
Message-ID: <AANLkTinnOZj9LxG7f1+yLGZNWr=Y+mJaERT0RG55FPx9@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101204/23a8f576/attachment.pl>

From b.rowlingson at lancaster.ac.uk  Sat Dec  4 21:29:33 2010
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Sat, 4 Dec 2010 20:29:33 +0000
Subject: [R-sig-Geo] SaTScan in R
In-Reply-To: <4CF946E4.6050403@cirad.fr>
References: <156428.51956.qm@web36306.mail.mud.yahoo.com>
	<AANLkTikgJ609qU2vkVmrj4xKX=GkcyWNSyAqSXM_sO+v@mail.gmail.com>
	<4CF946E4.6050403@cirad.fr>
Message-ID: <AANLkTinTHJT-ty_jWqzyhSit5jzO5=_PJGorbAGt_ri1@mail.gmail.com>

Although there's no specific scan statistic functions in it, the
'surveillance' package has lots of functions for doing space-time
outbreak detection:

http://surveillance.r-forge.r-project.org/


Barry


From advaitgodbole at gmail.com  Sat Dec  4 22:50:39 2010
From: advaitgodbole at gmail.com (Advait Godbole)
Date: Sat, 4 Dec 2010 16:50:39 -0500
Subject: [R-sig-Geo] gridded time series analysis
In-Reply-To: <AANLkTikSowU_SFiCmZyE3TKEa_UesH_SDQdPP63i+ERY@mail.gmail.com>
References: <AANLkTimTdxzoDCfJQOB8bgQRhjLy3YzSbtGtMdijk9sQ@mail.gmail.com>
	<771411.8321.qm@web29709.mail.ird.yahoo.com>
	<AANLkTin2DYocWNOAR-LfGoBP4+gCtA7eVDHmoaQ6wriR@mail.gmail.com>
	<AANLkTimFw1zMH75s+TG+SFkBHfXzpURm2WXskAa8Kp=m@mail.gmail.com>
	<AANLkTim9dBnVkZ0tjvoa1YRpPRr156jJ9zcezMDrtzhX@mail.gmail.com>
	<AANLkTi=vW6NXYXKGNa0gcTfZ8ezEjvegdxU3Dt5SPA4F@mail.gmail.com>
	<AANLkTikqNmC62Pv-n9Dxd1w7fTHJPx8cR72U6YEtWMTV@mail.gmail.com>
	<AANLkTikQsL9opzu1i0mWxtJA6YmcgBbGdbihXFOwPRho@mail.gmail.com>
	<AANLkTinY5+3JbpZfWnriDZNOdmcfic0628Qi0=NDZghK@mail.gmail.com>
	<AANLkTikd-PJKWZdWUL2+S9VYAq1QJ4LPwG2==erEs2+Q@mail.gmail.com>
	<AANLkTi=eZL0Rq5EyoRA29fdnN2VL-Xt6hcGN4DnZgCKk@mail.gmail.com>
	<AANLkTikVto4GD=vO=5YKwKXL7y+Ze4ADn2KXpsw1AFVA@mail.gmail.com>
	<AANLkTinUvhmDLP2YSWuqb5=G0YKX=sWp6yMOj9KPAgdA@mail.gmail.com>
	<AANLkTi=P5HNFjEsaapUBF7vSAFAsekU_4bYJqXnW=gbu@mail.gmail.com>
	<AANLkTikwWainpBBeSr8xnNNq8uoFXdU2n_34y2-u6K5J@mail.gmail.com>
	<AANLkTin5-hV=b8yxQnvviF_4w-uPfsSJ9X82pmbi=WQo@mail.gmail.com>
	<AANLkTikmPMvBRuu6RvjXsd8LdJc38FP+tAiF9iAc31Ks@mail.gmail.com>
	<AANLkTikSowU_SFiCmZyE3TKEa_UesH_SDQdPP63i+ERY@mail.gmail.com>
Message-ID: <AANLkTi=p+LbmQ96GSJFuYyw-HLcCxJgYqaK4n2pBZcbG@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101204/6dab4742/attachment.pl>

From matzke at berkeley.edu  Sun Dec  5 02:50:35 2010
From: matzke at berkeley.edu (Nick Matzke)
Date: Sat, 04 Dec 2010 17:50:35 -0800
Subject: [R-sig-Geo] satellite imagery
Message-ID: <4CFAEFEB.6090808@berkeley.edu>

Hi all,

I would like to do some somewhat simple satellite image 
analysis, ideally with an R package.  Basically, I need to:

* load a .img file (a subset of a 6-channel Landsat image)
* classify the pixels
* extract some statistics

Is there an R package people would recommend for this kind 
of thing?

I'm working with macs, basically, I know some of the free 
GIS stuff is windows-based...

Any advice appreciated.  Cheers!
Nick


-- 
====================================================
Nicholas J. Matzke
Ph.D. Candidate, Graduate Student Researcher
Huelsenbeck Lab
Center for Theoretical Evolutionary Genomics
4151 VLSB (Valley Life Sciences Building)
Department of Integrative Biology
University of California, Berkeley

Graduate Student Instructor, IB200A
Principles of Phylogenetics: Systematics
http://ib.berkeley.edu/courses/ib200a/index.shtml

Lab websites:
http://ib.berkeley.edu/people/lab_detail.php?lab=54
http://fisher.berkeley.edu/cteg/hlab.html
Dept. personal page: 
http://ib.berkeley.edu/people/students/person_detail.php?person=370
Lab personal page: 
http://fisher.berkeley.edu/cteg/members/matzke.html
Lab phone: 510-643-6299
Dept. fax: 510-643-6264
Cell phone: 510-301-0179
Email: matzke at berkeley.edu

Mailing address:
Department of Integrative Biology
3060 VLSB #3140
Berkeley, CA 94720-3140

-----------------------------------------------------
"[W]hen people thought the earth was flat, they were wrong. 
When people thought the earth was spherical, they were 
wrong. But if you think that thinking the earth is spherical 
is just as wrong as thinking the earth is flat, then your 
view is wronger than both of them put together."

Isaac Asimov (1989). "The Relativity of Wrong." The 
Skeptical Inquirer, 14(1), 35-44. Fall 1989.
http://chem.tufts.edu/AnswersInScience/RelativityofWrong.htm


From v8extra at gmail.com  Sun Dec  5 07:00:50 2010
From: v8extra at gmail.com (=?iso-8859-1?Q?S=E9bastien_Durand?=)
Date: Sun, 5 Dec 2010 01:00:50 -0500
Subject: [R-sig-Geo] Polygon dissolution or union issue
Message-ID: <067839EE-C45D-4088-8CDA-D76DA6424A7E@gmail.com>


Hello, 

Could somebody find me the solution to this issue!

I cannot manage to merge or dissolve all the polygon  generated in the object "pol" 

Here is my example: 

library(akima)
library(maptools)
library(raster)

data(akima)
# define de dimension of grid
dimgrid=50

# Interpolate to regular grid
ak.li=interp(akima$x, akima$y, akima$z, xo=seq(min(akima$x), max(akima$x), length = dimgrid),yo=seq(min(akima$y), max(akima$y), length = dimgrid),linear = TRUE, extrap=FALSE, duplicate = "mean")

# Show interpolation
image(ak.li)
points(akima)
with(akima, text(x, y, formatC(z,dig=2), adj = -0.1))

# Create a raster with the data
r <- raster(ak.li)
plot(r)
pol <- rasterToPolygons(r, fun=function(x){x>20 & x<25})
plot(pol, add=T, col='red')

r <- raster(nrow=length(ak.li$y), ncol=length(ak.li$x), crs=NA)
tmp=ak.li$z
tmp=apply(tmp, 1, rev)
r[] <- tmp

# Show the raster
plot(r)

# Convert the data found between ]20 and 25[ into polygons
pol <- rasterToPolygons(r, fun=function(x){x>20 & x<25})

# Show the polygons
plot(pol, add=T, col='red')

# Attempt to merge similar adjacent into one polygon
union = unionSpatialPolygons(pol, ID=rep(1,
times=length(pol at polygons)))

# Show
plot(union, add=TRUE, col="red")

I beleive all polygons should be merged by that point but obviously I must have done something wrong.  All polygons were not merged into a single one and I don't know how to fix that!

Any other solutions 

Help?

From r.hijmans at gmail.com  Sun Dec  5 08:41:09 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Sat, 4 Dec 2010 23:41:09 -0800
Subject: [R-sig-Geo] Polygon dissolution or union issue
In-Reply-To: <067839EE-C45D-4088-8CDA-D76DA6424A7E@gmail.com>
References: <067839EE-C45D-4088-8CDA-D76DA6424A7E@gmail.com>
Message-ID: <AANLkTi=+KP7RvG47kvPHiuiUkrxd7c2iot=MBp1XKV8K@mail.gmail.com>

S?bastien,

You can fix this by rounding the coordinates of the polygons first:

library(akima)
library(maptools)
gpclibPermit()
library(raster)
data(akima)
dimgrid <- 50
ak.li <- interp(akima$x, akima$y, akima$z, xo=seq(min(akima$x),
max(akima$x), length = dimgrid),yo=seq(min(akima$y), max(akima$y),
length = dimgrid),linear = TRUE, extrap=FALSE, duplicate = "mean")
r <- raster(ak.li)
pol <- rasterToPolygons(r, fun=function(x){x>20 & x<25})

### new code
digits <- 6
for (i in 1:length(pol at polygons)) {
# simple case with no multi-polygons
	pol at polygons[[i]]@Polygons[[1]]@coords <-
round(pol at polygons[[i]]@Polygons[[1]]@coords, digits)
}
###

union <- unionSpatialPolygons(pol, ID=rep(1, times=length(pol at polygons)))
plot(r)
plot(union, add=T)


Robert

On Sat, Dec 4, 2010 at 10:00 PM, S?bastien Durand <v8extra at gmail.com> wrote:
>
> Hello,
>
> Could somebody find me the solution to this issue!
>
> I cannot manage to merge or dissolve all the polygon ?generated in the object "pol"
>
> Here is my example:
>
> library(akima)
> library(maptools)
> library(raster)
>
> data(akima)
> # define de dimension of grid
> dimgrid=50
>
> # Interpolate to regular grid
> ak.li=interp(akima$x, akima$y, akima$z, xo=seq(min(akima$x), max(akima$x), length = dimgrid),yo=seq(min(akima$y), max(akima$y), length = dimgrid),linear = TRUE, extrap=FALSE, duplicate = "mean")
>
> # Show interpolation
> image(ak.li)
> points(akima)
> with(akima, text(x, y, formatC(z,dig=2), adj = -0.1))
>
> # Create a raster with the data
> r <- raster(ak.li)
> plot(r)
> pol <- rasterToPolygons(r, fun=function(x){x>20 & x<25})
> plot(pol, add=T, col='red')
>
> r <- raster(nrow=length(ak.li$y), ncol=length(ak.li$x), crs=NA)
> tmp=ak.li$z
> tmp=apply(tmp, 1, rev)
> r[] <- tmp
>
> # Show the raster
> plot(r)
>
> # Convert the data found between ]20 and 25[ into polygons
> pol <- rasterToPolygons(r, fun=function(x){x>20 & x<25})
>
> # Show the polygons
> plot(pol, add=T, col='red')
>
> # Attempt to merge similar adjacent into one polygon
> union = unionSpatialPolygons(pol, ID=rep(1,
> times=length(pol at polygons)))
>
> # Show
> plot(union, add=TRUE, col="red")
>
> I beleive all polygons should be merged by that point but obviously I must have done something wrong. ?All polygons were not merged into a single one and I don't know how to fix that!
>
> Any other solutions
>
> Help?
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From Roger.Bivand at nhh.no  Sun Dec  5 19:59:09 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sun, 5 Dec 2010 19:59:09 +0100 (CET)
Subject: [R-sig-Geo] Polygon dissolution or union issue
In-Reply-To: <AANLkTi=+KP7RvG47kvPHiuiUkrxd7c2iot=MBp1XKV8K@mail.gmail.com>
References: <067839EE-C45D-4088-8CDA-D76DA6424A7E@gmail.com>
	<AANLkTi=+KP7RvG47kvPHiuiUkrxd7c2iot=MBp1XKV8K@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.1012051954390.16860@reclus.nhh.no>

On Sat, 4 Dec 2010, Robert J. Hijmans wrote:

> S?bastien,
>
> You can fix this by rounding the coordinates of the polygons first:
>
> library(akima)
> library(maptools)
> gpclibPermit()

Please note that both akima and gpclib have restricted licenses (excluding 
research for paying clients), so that this should not be suggested as a 
general solution. The equivalent unionSpatialPolygons() in the as yet 
unreleased maptools on R-forge will use rgeos (also on R-forge) instead - 
rgeos should reach CRAN this month. Replacing akima remains an open 
question, any offers?

Roger


> library(raster)
> data(akima)
> dimgrid <- 50
> ak.li <- interp(akima$x, akima$y, akima$z, xo=seq(min(akima$x),
> max(akima$x), length = dimgrid),yo=seq(min(akima$y), max(akima$y),
> length = dimgrid),linear = TRUE, extrap=FALSE, duplicate = "mean")
> r <- raster(ak.li)
> pol <- rasterToPolygons(r, fun=function(x){x>20 & x<25})
>
> ### new code
> digits <- 6
> for (i in 1:length(pol at polygons)) {
> # simple case with no multi-polygons
> 	pol at polygons[[i]]@Polygons[[1]]@coords <-
> round(pol at polygons[[i]]@Polygons[[1]]@coords, digits)
> }
> ###
>
> union <- unionSpatialPolygons(pol, ID=rep(1, times=length(pol at polygons)))
> plot(r)
> plot(union, add=T)
>
>
> Robert
>
> On Sat, Dec 4, 2010 at 10:00 PM, S?bastien Durand <v8extra at gmail.com> wrote:
>>
>> Hello,
>>
>> Could somebody find me the solution to this issue!
>>
>> I cannot manage to merge or dissolve all the polygon ?generated in the object "pol"
>>
>> Here is my example:
>>
>> library(akima)
>> library(maptools)
>> library(raster)
>>
>> data(akima)
>> # define de dimension of grid
>> dimgrid=50
>>
>> # Interpolate to regular grid
>> ak.li=interp(akima$x, akima$y, akima$z, xo=seq(min(akima$x), max(akima$x), length = dimgrid),yo=seq(min(akima$y), max(akima$y), length = dimgrid),linear = TRUE, extrap=FALSE, duplicate = "mean")
>>
>> # Show interpolation
>> image(ak.li)
>> points(akima)
>> with(akima, text(x, y, formatC(z,dig=2), adj = -0.1))
>>
>> # Create a raster with the data
>> r <- raster(ak.li)
>> plot(r)
>> pol <- rasterToPolygons(r, fun=function(x){x>20 & x<25})
>> plot(pol, add=T, col='red')
>>
>> r <- raster(nrow=length(ak.li$y), ncol=length(ak.li$x), crs=NA)
>> tmp=ak.li$z
>> tmp=apply(tmp, 1, rev)
>> r[] <- tmp
>>
>> # Show the raster
>> plot(r)
>>
>> # Convert the data found between ]20 and 25[ into polygons
>> pol <- rasterToPolygons(r, fun=function(x){x>20 & x<25})
>>
>> # Show the polygons
>> plot(pol, add=T, col='red')
>>
>> # Attempt to merge similar adjacent into one polygon
>> union = unionSpatialPolygons(pol, ID=rep(1,
>> times=length(pol at polygons)))
>>
>> # Show
>> plot(union, add=TRUE, col="red")
>>
>> I beleive all polygons should be merged by that point but obviously I must have done something wrong. ?All polygons were not merged into a single one and I don't know how to fix that!
>>
>> Any other solutions
>>
>> Help?
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From r.hijmans at gmail.com  Sun Dec  5 23:05:12 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Sun, 5 Dec 2010 14:05:12 -0800
Subject: [R-sig-Geo] Polygon dissolution or union issue
In-Reply-To: <alpine.LRH.2.00.1012051954390.16860@reclus.nhh.no>
References: <067839EE-C45D-4088-8CDA-D76DA6424A7E@gmail.com>
	<AANLkTi=+KP7RvG47kvPHiuiUkrxd7c2iot=MBp1XKV8K@mail.gmail.com>
	<alpine.LRH.2.00.1012051954390.16860@reclus.nhh.no>
Message-ID: <AANLkTim+kJfPk-nqepXfesJjiXPkWYNc7B7+P_xKA=xP@mail.gmail.com>

What is the value of the interp function in Akima? I have noticed on
this list that people use it, but I do not why. Is the Tps (thin-plate
spline) method in Fields a sufficient (or better) alternative? In a
comparison using these data (sampling only a few points to 'train' the
interpolator, to make it non-trivial), Tps does _much_ better than
interp in Akima. But perhaps that is different with different
settings. or with different data. Or is interp more efficient with
large datasets? Or?

library(akima)
library(maptools)
gpclibPermit()
library(raster)
library(fields)

data(akima)
akimadf <- data.frame(x=akima$x, y=akima$y, z=akima$z)
dimgrid <- 50

tpcor=akcor=list()

for (i in 1:10) {
  s <- sample(50, 40)
  train <- akimadf[-s,]
  test <- akimadf[s,]
  ak.li <- interp(train$x, train$y, train$z, xo=seq(min(akima$x),
max(akima$x), length = dimgrid), yo=seq(min(akima$y), max(akima$y),
length = dimgrid),linear=FALSE, extrap=TRUE, duplicate = "mean")
  r <- raster(ak.li)
  tps <- Tps(train[,1:2], train[,'z'])
  p <- interpolate(r, tps)
  ak <- extract(r, test[,1:2])
  tp <- extract(p, test[,1:2])
  # correlation between predicted and withheld values
  akcor[i] <- cor(ak, test[,3])
  tpcor[i] <- cor(tp, test[,3])
}
mean(unlist(akcor))  # akima:interp
mean(unlist(tpcor))   # fields::Tps


A typical result:
> mean(unlist(akcor))
[1] 0.3952623
> mean(unlist(tpcor))
[1] 0.9307129
>



On Sun, Dec 5, 2010 at 10:59 AM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
> On Sat, 4 Dec 2010, Robert J. Hijmans wrote:
>
>> S?bastien,
>>
>> You can fix this by rounding the coordinates of the polygons first:
>>
>> library(akima)
>> library(maptools)
>> gpclibPermit()
>
> Please note that both akima and gpclib have restricted licenses (excluding
> research for paying clients), so that this should not be suggested as a
> general solution. The equivalent unionSpatialPolygons() in the as yet
> unreleased maptools on R-forge will use rgeos (also on R-forge) instead -
> rgeos should reach CRAN this month. Replacing akima remains an open
> question, any offers?
>
> Roger
>
>
>> library(raster)
>> data(akima)
>> dimgrid <- 50
>> ak.li <- interp(akima$x, akima$y, akima$z, xo=seq(min(akima$x),
>> max(akima$x), length = dimgrid),yo=seq(min(akima$y), max(akima$y),
>> length = dimgrid),linear = TRUE, extrap=FALSE, duplicate = "mean")
>> r <- raster(ak.li)
>> pol <- rasterToPolygons(r, fun=function(x){x>20 & x<25})
>>
>> ### new code
>> digits <- 6
>> for (i in 1:length(pol at polygons)) {
>> # simple case with no multi-polygons
>> ? ? ? ?pol at polygons[[i]]@Polygons[[1]]@coords <-
>> round(pol at polygons[[i]]@Polygons[[1]]@coords, digits)
>> }
>> ###
>>
>> union <- unionSpatialPolygons(pol, ID=rep(1, times=length(pol at polygons)))
>> plot(r)
>> plot(union, add=T)
>>
>>
>> Robert
>>
>> On Sat, Dec 4, 2010 at 10:00 PM, S?bastien Durand <v8extra at gmail.com>
>> wrote:
>>>
>>> Hello,
>>>
>>> Could somebody find me the solution to this issue!
>>>
>>> I cannot manage to merge or dissolve all the polygon ?generated in the
>>> object "pol"
>>>
>>> Here is my example:
>>>
>>> library(akima)
>>> library(maptools)
>>> library(raster)
>>>
>>> data(akima)
>>> # define de dimension of grid
>>> dimgrid=50
>>>
>>> # Interpolate to regular grid
>>> ak.li=interp(akima$x, akima$y, akima$z, xo=seq(min(akima$x),
>>> max(akima$x), length = dimgrid),yo=seq(min(akima$y), max(akima$y), length =
>>> dimgrid),linear = TRUE, extrap=FALSE, duplicate = "mean")
>>>
>>> # Show interpolation
>>> image(ak.li)
>>> points(akima)
>>> with(akima, text(x, y, formatC(z,dig=2), adj = -0.1))
>>>
>>> # Create a raster with the data
>>> r <- raster(ak.li)
>>> plot(r)
>>> pol <- rasterToPolygons(r, fun=function(x){x>20 & x<25})
>>> plot(pol, add=T, col='red')
>>>
>>> r <- raster(nrow=length(ak.li$y), ncol=length(ak.li$x), crs=NA)
>>> tmp=ak.li$z
>>> tmp=apply(tmp, 1, rev)
>>> r[] <- tmp
>>>
>>> # Show the raster
>>> plot(r)
>>>
>>> # Convert the data found between ]20 and 25[ into polygons
>>> pol <- rasterToPolygons(r, fun=function(x){x>20 & x<25})
>>>
>>> # Show the polygons
>>> plot(pol, add=T, col='red')
>>>
>>> # Attempt to merge similar adjacent into one polygon
>>> union = unionSpatialPolygons(pol, ID=rep(1,
>>> times=length(pol at polygons)))
>>>
>>> # Show
>>> plot(union, add=TRUE, col="red")
>>>
>>> I beleive all polygons should be merged by that point but obviously I
>>> must have done something wrong. ?All polygons were not merged into a single
>>> one and I don't know how to fix that!
>>>
>>> Any other solutions
>>>
>>> Help?
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> --
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no


From r.hijmans at gmail.com  Sun Dec  5 23:29:06 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Sun, 5 Dec 2010 14:29:06 -0800
Subject: [R-sig-Geo] gridded time series analysis
In-Reply-To: <AANLkTi=p+LbmQ96GSJFuYyw-HLcCxJgYqaK4n2pBZcbG@mail.gmail.com>
References: <AANLkTimTdxzoDCfJQOB8bgQRhjLy3YzSbtGtMdijk9sQ@mail.gmail.com>
	<771411.8321.qm@web29709.mail.ird.yahoo.com>
	<AANLkTin2DYocWNOAR-LfGoBP4+gCtA7eVDHmoaQ6wriR@mail.gmail.com>
	<AANLkTimFw1zMH75s+TG+SFkBHfXzpURm2WXskAa8Kp=m@mail.gmail.com>
	<AANLkTim9dBnVkZ0tjvoa1YRpPRr156jJ9zcezMDrtzhX@mail.gmail.com>
	<AANLkTi=vW6NXYXKGNa0gcTfZ8ezEjvegdxU3Dt5SPA4F@mail.gmail.com>
	<AANLkTikqNmC62Pv-n9Dxd1w7fTHJPx8cR72U6YEtWMTV@mail.gmail.com>
	<AANLkTikQsL9opzu1i0mWxtJA6YmcgBbGdbihXFOwPRho@mail.gmail.com>
	<AANLkTinY5+3JbpZfWnriDZNOdmcfic0628Qi0=NDZghK@mail.gmail.com>
	<AANLkTikd-PJKWZdWUL2+S9VYAq1QJ4LPwG2==erEs2+Q@mail.gmail.com>
	<AANLkTi=eZL0Rq5EyoRA29fdnN2VL-Xt6hcGN4DnZgCKk@mail.gmail.com>
	<AANLkTikVto4GD=vO=5YKwKXL7y+Ze4ADn2KXpsw1AFVA@mail.gmail.com>
	<AANLkTinUvhmDLP2YSWuqb5=G0YKX=sWp6yMOj9KPAgdA@mail.gmail.com>
	<AANLkTi=P5HNFjEsaapUBF7vSAFAsekU_4bYJqXnW=gbu@mail.gmail.com>
	<AANLkTikwWainpBBeSr8xnNNq8uoFXdU2n_34y2-u6K5J@mail.gmail.com>
	<AANLkTin5-hV=b8yxQnvviF_4w-uPfsSJ9X82pmbi=WQo@mail.gmail.com>
	<AANLkTikmPMvBRuu6RvjXsd8LdJc38FP+tAiF9iAc31Ks@mail.gmail.com>
	<AANLkTikSowU_SFiCmZyE3TKEa_UesH_SDQdPP63i+ERY@mail.gmail.com>
	<AANLkTi=p+LbmQ96GSJFuYyw-HLcCxJgYqaK4n2pBZcbG@mail.gmail.com>
Message-ID: <AANLkTinvp-k47MHyV2s+hje_P0VXHvTmOKPFf8q5btAO@mail.gmail.com>

>If so, should I use a for loop instead?
No, that is the point of the calc function, that you do not do that.
Internally, calc uses apply as in
apply(values, 1, fun)


On Sat, Dec 4, 2010 at 1:50 PM, Advait Godbole <advaitgodbole at gmail.com> wrote:
> Roger, that fix worked, its there in the latest version. Thanks much.
> I am running into the problem that Martin mentioned earlier in the thread:
> Error in lm.fit(x, y, offset = offset, singular.ok = singular.ok, ...) :
> ?0 (non-NA) cases
>
> For which you suggested this:
> #you could catch this in your function and do something like:
>
>> fun=function(x) { if (is.na(x[1])){ NA } else {
>> lm(x[1]~x[2])$coefficients[2] }}
>> fun(c(NA,NA))
> [1] NA
>
> and then:
> calc(s, fun=fun)
>
> What I am confused is that my stack "s" that I will pass via calc is of
> dimensions 356 x 507 x 240, and therefore is.na?will act on the entire array
> and therefore still fail at those points where it is not NA. Is that right?
> If so, should I use a for loop instead?
> Thanks,
> Advait
> On Fri, Dec 3, 2010 at 2:58 PM, Robert J. Hijmans <r.hijmans at gmail.com>
> wrote:
>>
>> It may have been fixed. Please try this again in raster 1.7-8 (now on
>> CRAN for windows and linux, mac in a day or so). Robert
>>
>> On Fri, Dec 3, 2010 at 11:54 AM, steven mosher <moshersteven at gmail.com>
>> wrote:
>> > Well,
>> > ??I need some more information.
>> > ?before you create the stack do this and report the results
>> > test1 <- layerNames(rcmraster)
>> > test2 <- layerNames(emitraster)
>> > str(test1)
>> > str(test2)
>> > Its a bit of a hack but ?you can try to copy the layerNames out of the
>> > invidual stacks.
>> > Then set them to ? ?""
>> > then create one big stack
>> > then set the layerNames.
>> > ( I recall having to do that once in the past after a stackApply())
>> > I know in the past, I've had some similar issues, but I thought that
>> > they
>> > ?had been fixed.
>> > I'll try to take a look at the code ?in a bit, but if there is a bug,
>> > either
>> > robert or Jacob would have to fix it.
>> >
>> > On Fri, Dec 3, 2010 at 4:28 AM, Advait Godbole <advaitgodbole at gmail.com>
>> > wrote:
>> >>
>> >> With Robert being away until the 15th, can someone else help out with
>> >> this
>> >> issue? To recap, I have read in two 507 x ?356 x 120 (lon,lat,time)
>> >> netCDF
>> >> files into R using the "brick" function. I get the following error when
>> >> I
>> >> use "stack" to clump these two multi layer rasters together.
>> >> > s <- stack(rcmraster,emitraster)
>> >> Error in function (classes, fdef, mtable) ?:
>> >> ??unable to find an inherited method for function "trim", for signature
>> >> "integer"
>> >> Robert suggested that it is because of the layerNames being numeric,
>> >> annd
>> >> that layerNames() <- layerNames() would solve it but it did not help,
>> >> even
>> >> though layerNames() is now of type character.
>> >> Thanks much!
>> >> adv
>> >> On Fri, Dec 3, 2010 at 7:13 AM, Advait Godbole
>> >> <advaitgodbole at gmail.com>
>> >> wrote:
>> >>>
>> >>> the setMinMax() function worked. Thanks Steve and Robert..
>> >>> the work around did not work - I still get the trim() error..
>> >>> adv
>> >>>
>> >>> On Thu, Dec 2, 2010 at 1:43 PM, Robert J. Hijmans
>> >>> <r.hijmans at gmail.com>
>> >>> wrote:
>> >>>>
>> >>>> This is the work around:
>> >>>>
>> >>>> layerNames(rcmraster) <- layerNames(rcmraster)
>> >>>>
>> >>>>
>> >>>> On Thu, Dec 2, 2010 at 10:43 AM, Robert J. Hijmans
>> >>>> <r.hijmans at gmail.com>
>> >>>> wrote:
>> >>>> > The question marks indicate that the min and max values are not
>> >>>> > known
>> >>>> > to the object (because the file type does not store them, and it is
>> >>>> > too 'expensive' to determine them on the fly). setMinMax if you
>> >>>> > really
>> >>>> > need to know.
>> >>>> > The error on trim seems to be a problem with layerNames being
>> >>>> > numeric.
>> >>>> > I'll fix that. This may be a work-around
>> >>>> >
>> >>>> >
>> >>>> >
>> >>>> >
>> >>>> >
>> >>>> >
>> >>>> > On Thu, Dec 2, 2010 at 10:23 AM, steven mosher
>> >>>> > <moshersteven at gmail.com> wrote:
>> >>>> >> ?see the setMinMax()
>> >>>> >>
>> >>>> >> ?for the error on trim() I'm not sure.
>> >>>> >>
>> >>>> >> On Thu, Dec 2, 2010 at 5:16 AM, Advait Godbole
>> >>>> >> <advaitgodbole at gmail.com>
>> >>>> >> wrote:
>> >>>> >>>
>> >>>> >>> That worked perfectly. Thanks for pointing this out. I changed
>> >>>> >>> the
>> >>>> >>> way my
>> >>>> >>> variables were being written to the netCDF and now "brick" works.
>> >>>> >>> However,
>> >>>> >>> I
>> >>>> >>> am getting an error while using the stack function, like so:
>> >>>> >>>
>> >>>> >>> "Error in function (classes, fdef, mtable) ?:
>> >>>> >>> ?unable to find an inherited method for function "trim", for
>> >>>> >>> signature
>> >>>> >>> "integer"
>> >>>> >>>
>> >>>> >>> The two rasters show the following:
>> >>>> >>> > rcmraster
>> >>>> >>> class ? ? ? : RasterBrick
>> >>>> >>> filename ? ?: regcm.cumul.hdd.10k.96_05.fixed.latlonvars.nc
>> >>>> >>> nlayers ? ? : 120
>> >>>> >>> nrow ? ? ? ?: 356
>> >>>> >>> ncol ? ? ? ?: 507
>> >>>> >>> ncell ? ? ? : 180492
>> >>>> >>> projection ?: +proj=longlat +datum=WGS84 +ellps=WGS84
>> >>>> >>> +towgs84=0,0,0
>> >>>> >>> min value ? : ? ? ? ? ? ? ? ? ? ?
>> >>>> >>> max value ? : ? ? ? ? ? ? ? ? ? ?
>> >>>> >>> xmin ? ? ? ?: -137.3312
>> >>>> >>> xmax ? ? ? ?: -62.11259
>> >>>> >>> ymin ? ? ? ?: 22.12693
>> >>>> >>> ymax ? ? ? ?: 57.35954
>> >>>> >>> xres ? ? ? ?: 0.1483602
>> >>>> >>> yres ? ? ? ?: 0.09896801
>> >>>> >>>
>> >>>> >>> > emitraster
>> >>>> >>> class ? ? ? : RasterBrick
>> >>>> >>> filename ? ?:
>> >>>> >>>
>> >>>> >>> flip.percap.vulcan.10k.dp.build.381.RES.EIAmy.96_05.this.latest.nc
>> >>>> >>> nlayers ? ? : 120
>> >>>> >>> nrow ? ? ? ?: 356
>> >>>> >>> ncol ? ? ? ?: 507
>> >>>> >>> ncell ? ? ? : 180492
>> >>>> >>> projection ?: +proj=longlat +datum=WGS84 +ellps=WGS84
>> >>>> >>> +towgs84=0,0,0
>> >>>> >>> min value ? : ? ? ? ? ? ? ? ? ? ?
>> >>>> >>> max value ? : ? ? ? ? ? ? ? ? ? ?
>> >>>> >>> xmin ? ? ? ?: -137.3312
>> >>>> >>> xmax ? ? ? ?: -62.11259
>> >>>> >>> ymin ? ? ? ?: 22.12693
>> >>>> >>> ymax ? ? ? ?: 57.35954
>> >>>> >>> xres ? ? ? ?: 0.1483602
>> >>>> >>> yres ? ? ? ?: 0.09896801
>> >>>> >>>
>> >>>> >>> A getValues call shows a lot of NAs. Now, my original file does
>> >>>> >>> have
>> >>>> >>> a
>> >>>> >>> large
>> >>>> >>> number of missing values so that is why this should happen, but I
>> >>>> >>> suspect
>> >>>> >>> something is going wrong since the min and max values are not
>> >>>> >>> being
>> >>>> >>> displayed for either of these rasters. Is that the source of the
>> >>>> >>> problem
>> >>>> >>> in
>> >>>> >>> the "stack" function?
>> >>>> >>>
>> >>>> >>> Thanks,
>> >>>> >>>
>> >>>> >>> Advait
>> >>>> >>>
>> >>>> >>> On Tue, Nov 30, 2010 at 5:18 PM, Robert J. Hijmans
>> >>>> >>> <r.hijmans at gmail.com>wrote:
>> >>>> >>>
>> >>>> >>> > Advait,
>> >>>> >>> >
>> >>>> >>> > The is an error in the file, I think, see below:
>> >>>> >>> >
>> >>>> >>> > > library(ncdf)
>> >>>> >>> > > filename = "c:/downloads/regcm.cumul.hdd.10k.96_05.new.nc"
>> >>>> >>> > > nc <- open.ncdf(filename)
>> >>>> >>> > >
>> >>>> >>> > > zvar <- 'hdd'
>> >>>> >>> > > nc$var[[zvar]]$dim[[1]]$len
>> >>>> >>> > [1] 507
>> >>>> >>> > > nc$var[[zvar]]$dim[[2]]$len
>> >>>> >>> > [1] 356
>> >>>> >>> > >
>> >>>> >>> > > xx <- nc$var[[zvar]]$dim[[1]]$vals
>> >>>> >>> > > # should be a vector of 507 longitudes but:
>> >>>> >>> > > dim(xx)
>> >>>> >>> > [1] 507 356 120
>> >>>> >>> > >
>> >>>> >>> > > # works anyway
>> >>>> >>> > > xrange <- c(min(xx), max(xx))
>> >>>> >>> > > xrange
>> >>>> >>> > [1] -137.25705 ?-62.18677
>> >>>> >>> > >
>> >>>> >>> > > yy <- nc$var[[zvar]]$dim[[2]]$vals
>> >>>> >>> > > # should be a vector of 356 latitudes but:
>> >>>> >>> > > dim(yy)
>> >>>> >>> > [1] 507 356 120
>> >>>> >>> > >
>> >>>> >>> > > # this fails
>> >>>> >>> > > yrange <- c(min(yy), max(yy))
>> >>>> >>> > > yrange
>> >>>> >>> > [1] NaN NaN
>> >>>> >>> > > # and that is the only reason why raster failed.
>> >>>> >>> > >
>> >>>> >>> > > #OK
>> >>>> >>> > > yy[,,1][1:10,350:355]
>> >>>> >>> > ? ? ? ? ?[,1] ? ? [,2] ? ? [,3] ? ? [,4] ? ? [,5] ? ? [,6]
>> >>>> >>> > ?[1,] 51.49148 51.57122 51.65092 51.73055 51.81014 51.88967
>> >>>> >>> > ?[2,] 51.52888 51.60866 51.68839 51.76807 51.84769 51.92727
>> >>>> >>> > ?[3,] 51.56616 51.64598 51.72575 51.80547 51.88513 51.96474
>> >>>> >>> > ?[4,] 51.60332 51.68318 51.76299 51.84275 51.92245 52.00210
>> >>>> >>> > ?[5,] 51.64036 51.72026 51.80011 51.87991 51.95965 52.03934
>> >>>> >>> > ?[6,] 51.67728 51.75722 51.83711 51.91695 51.99673 52.07646
>> >>>> >>> > ?[7,] 51.71409 51.79407 51.87399 51.95387 52.03369 52.11345
>> >>>> >>> > ?[8,] 51.75077 51.83079 51.91076 51.99067 52.07053 52.15033
>> >>>> >>> > ?[9,] 51.78734 51.86739 51.94740 52.02735 52.10725 52.18709
>> >>>> >>> > [10,] 51.82378 51.90388 51.98392 52.06391 52.14385 52.22373
>> >>>> >>> > >
>> >>>> >>> > > #bad values here (and note the NaN):
>> >>>> >>> > > yy[,,120][1:10,350:355]
>> >>>> >>> > ? ? ? ? ? ? ? ?[,1] ? ? ? ? ? [,2] ? ? ? ? ? [,3]
>> >>>> >>> > [,4]
>> >>>> >>> > ? ? [,5] ? ? ? ? ? [,6]
>> >>>> >>> > ?[1,] -1.313847e-229 -4.895880e-272 -7.553765e-266
>> >>>> >>> > 1.293814e+58
>> >>>> >>> > 9.551441e-293 ?-3.291580e-36
>> >>>> >>> > ?[2,] -5.321424e+272 -3.076997e-223 ?-1.515780e-33
>> >>>> >>> > -9.895836e+171
>> >>>> >>> > 3.115686e-149 ?-4.970539e+92
>> >>>> >>> > ?[3,] ?5.259277e-203 ? 5.980335e-56 ?2.893449e-212
>> >>>> >>> > ?2.974200e+274
>> >>>> >>> > 3.186547e-218 ?2.503689e+296
>> >>>> >>> > ?[4,] -3.977129e+225 -3.696719e-283 ? 1.284612e+42
>> >>>> >>> > 1.887923e+28
>> >>>> >>> > -2.322520e+268 ?5.005820e-108
>> >>>> >>> > ?[5,] ?-6.569744e+88 ? 1.824506e-74 ? 7.663356e+39
>> >>>> >>> > ?1.608759e-201
>> >>>> >>> > -1.433761e+110 -8.804183e-211
>> >>>> >>> > ?[6,] -4.237822e-162 ? ? ? ? ? ?NaN ?7.405904e-275
>> >>>> >>> > ?5.859877e-258
>> >>>> >>> > 1.339820e+110 ?1.631993e+229
>> >>>> >>> > ?[7,] ? 5.603325e-64 ? 4.188764e+37 -2.188887e+243
>> >>>> >>> > -4.657907e+280
>> >>>> >>> > 1.795268e-185 ?1.166057e-175
>> >>>> >>> > ?[8,] -2.112804e-229 ?4.536625e+137 ?2.910322e-278
>> >>>> >>> > ?4.407645e-274
>> >>>> >>> > 8.886205e-239 -1.913860e+238
>> >>>> >>> > ?[9,] ?-9.126350e+44 -1.866422e+177 -2.578975e+256
>> >>>> >>> > ?3.275379e+208
>> >>>> >>> > -2.657457e+75 ?-1.258259e-90
>> >>>> >>> > [10,] ?6.698325e+216 -2.958355e+137 -1.058748e-178
>> >>>> >>> > -1.776776e+215
>> >>>> >>> > -6.368807e+78 -5.337653e+299
>> >>>> >>> > >
>> >>>> >>> > > # this would have worked
>> >>>> >>> > > yrange <- c(min(yy[,,1]), max(yy[,,1]))
>> >>>> >>> > > yrange
>> >>>> >>> > [1] 22.17641 57.31006
>> >>>> >>> > >
>> >>>> >>> > > close.ncdf(nc)
>> >>>> >>> >
>> >>>> >>> >
>> >>>> >>> > Best, Robert
>> >>>> >>> >
>> >>>> >>> >
>> >>>> >>> > On Tue, Nov 30, 2010 at 10:37 AM, Advait Godbole
>> >>>> >>> > <advaitgodbole at gmail.com> wrote:
>> >>>> >>> > > Dear Robert,
>> >>>> >>> > > here is the link to the file:
>> >>>> >>> > >
>> >>>> >>> > >
>> >>>> >>> > > http://dl.dropbox.com/u/4030944/regcm.cumul.hdd.10k.96_05.new.nc. It
>> >>>> >>> > > is
>> >>>> >>> > a
>> >>>> >>> > > large file ~400 MB. Let me know if dropbox is not convenient
>> >>>> >>> > > and
>> >>>> >>> > > you
>> >>>> >>> > would
>> >>>> >>> > > rather do ftp - ?but our machines are down for maintenance
>> >>>> >>> > > and I
>> >>>> >>> > > may
>> >>>> >>> > > not
>> >>>> >>> > be
>> >>>> >>> > > immediately able to get access.
>> >>>> >>> > > I was going over the NCL code that processes the files but
>> >>>> >>> > > did
>> >>>> >>> > > not
>> >>>> >>> > > find
>> >>>> >>> > > anything glaringly amiss, so I will have to look at it in
>> >>>> >>> > > greater
>> >>>> >>> > > detail
>> >>>> >>> > > since it is clear that the number of entries in the variables
>> >>>> >>> > > is
>> >>>> >>> > > not
>> >>>> >>> > right
>> >>>> >>> > > as you've pointed out. There is a chance that I have not
>> >>>> >>> > > written
>> >>>> >>> > > out
>> >>>> >>> > > the
>> >>>> >>> > > co-ordinates properly.
>> >>>> >>> > > Thanks,
>> >>>> >>> > > Advait
>> >>>> >>> > > On Mon, Nov 29, 2010 at 1:14 PM, Robert J. Hijmans
>> >>>> >>> > > <r.hijmans at gmail.com>
>> >>>> >>> > > wrote:
>> >>>> >>> > >>
>> >>>> >>> > >> Advait,
>> >>>> >>> > >> I do not think I can help you further unless you send me
>> >>>> >>> > >> your
>> >>>> >>> > >> file;
>> >>>> >>> > >> but this suggests that it is either not following the CF
>> >>>> >>> > >> standards,
>> >>>> >>> > >> or
>> >>>> >>> > >> something is wrong with the file, or that there is something
>> >>>> >>> > >> I
>> >>>> >>> > >> have
>> >>>> >>> > >> not understood about these files.
>> >>>> >>> > >> You said you have 507 x 356 x 120 values. I would expect
>> >>>> >>> > >> length(frcm$dim[[1]]$vals) == 507 and
>> >>>> >>> > >> length(frcm$dim[[2]]$vals) ==
>> >>>> >>> > >> 356
>> >>>> >>> > >> Robert
>> >>>> >>> > >>
>> >>>> >>> > >> On Mon, Nov 29, 2010 at 6:11 AM, Advait Godbole <
>> >>>> >>> > advaitgodbole at gmail.com>
>> >>>> >>> > >> wrote:
>> >>>> >>> > >> > sorry to disrupt the flow of the conversation, but after
>> >>>> >>> > >> > doing what
>> >>>> >>> > >> > Robert
>> >>>> >>> > >> > suggested, this is what was returned:
>> >>>> >>> > >> >> length(frcm$dim[[1]]$vals)
>> >>>> >>> > >> > [1] 21659040
>> >>>> >>> > >> >> length(frcm$dim[[2]]$vals)
>> >>>> >>> > >> > [1] 21659040
>> >>>> >>> > >> > the other two functions return the latitude and longitude
>> >>>> >>> > >> > arrays
>> >>>> >>> > >> > not
>> >>>> >>> > >> > populated with NAs/missing values. I havent reproduced
>> >>>> >>> > >> > them
>> >>>> >>> > >> > here
>> >>>> >>> > because
>> >>>> >>> > >> > of
>> >>>> >>> > >> > their number.
>> >>>> >>> > >> > Regards,
>> >>>> >>> > >> > advait
>> >>>> >>> > >> > On Sat, Nov 27, 2010 at 3:48 PM, Robert J. Hijmans <
>> >>>> >>> > r.hijmans at gmail.com>
>> >>>> >>> > >> > wrote:
>> >>>> >>> > >> >>
>> >>>> >>> > >> >> Advait,
>> >>>> >>> > >> >>
>> >>>> >>> > >> >> That suggests that you have missing values in the lon or
>> >>>> >>> > >> >> lat
>> >>>> >>> > >> >> dimensions. Is that true? That would be awkward, but
>> >>>> >>> > >> >> perhaps
>> >>>> >>> > something
>> >>>> >>> > >> >> else is going on. Can you send me your file? If not can
>> >>>> >>> > >> >> you
>> >>>> >>> > >> >> send
>> >>>> >>> > >> >> the
>> >>>> >>> > >> >> results of this:
>> >>>> >>> > >> >>
>> >>>> >>> > >> >> filename <- "regcm.cumul.hdd.10k.96_05.new.nc"
>> >>>> >>> > >> >> nc <- open.ncdf(filename)
>> >>>> >>> > >> >> length(nc$dim[[1]]$vals)
>> >>>> >>> > >> >> length(nc$dim[[2]]$vals)
>> >>>> >>> > >> >> nc$dim[[1]]$vals
>> >>>> >>> > >> >> nc$dim[[2]]$vals
>> >>>> >>> > >> >> close.ncdf(nc)
>> >>>> >>> > >> >>
>> >>>> >>> > >> >> Thanks, Robert
>> >>>> >>> > >> >>
>> >>>> >>> > >> >> On Sat, Nov 27, 2010 at 8:36 AM, Advait Godbole
>> >>>> >>> > >> >> <advaitgodbole at gmail.com>
>> >>>> >>> > >> >> wrote:
>> >>>> >>> > >> >> > Thanks everyone for these leads..However, I am running
>> >>>> >>> > >> >> > into
>> >>>> >>> > problems
>> >>>> >>> > >> >> > with
>> >>>> >>> > >> >> > data handling. I used ncdf to extract the two variables
>> >>>> >>> > >> >> > (507 x
>> >>>> >>> > >> >> > 356
>> >>>> >>> > x
>> >>>> >>> > >> >> > 120
>> >>>> >>> > >> >> > -
>> >>>> >>> > >> >> > lon,lat,time) and converted them into array objects.
>> >>>> >>> > >> >> > The
>> >>>> >>> > suggestions
>> >>>> >>> > >> >> > provided all utilize the raster package, but using
>> >>>> >>> > >> >> > "brick"
>> >>>> >>> > >> >> > on
>> >>>> >>> > >> >> > the
>> >>>> >>> > >> >> > file
>> >>>> >>> > >> >> > returns this error: "rcmraster <-
>> >>>> >>> > >> >> > brick("regcm.cumul.hdd.10k.96_05.new.nc")
>> >>>> >>> > >> >> > Error in if (e at xmin > -400 & e at xmax < 400 & e at ymin >
>> >>>> >>> > >> >> > -90.1
>> >>>> >>> > >> >> > &
>> >>>> >>> > e at ymax <
>> >>>> >>> > >> >> > ?:
>> >>>> >>> > >> >> > missing value where TRUE/FALSE needed"
>> >>>> >>> > >> >> >
>> >>>> >>> > >> >> > I have a fair number of NAs (all missing values in the
>> >>>> >>> > >> >> > original
>> >>>> >>> > >> >> > variables).
>> >>>> >>> > >> >> > Is there a way to set a flag for that? Or any other
>> >>>> >>> > >> >> > workaround?
>> >>>> >>> > >> >> > Thanks much,
>> >>>> >>> > >> >> > advait
>> >>>> >>> > >> >> > On Fri, Nov 26, 2010 at 6:25 PM, Robert J. Hijmans
>> >>>> >>> > >> >> > <r.hijmans at gmail.com>
>> >>>> >>> > >> >> > wrote:
>> >>>> >>> > >> >> >>
>> >>>> >>> > >> >> >> There are some difference in the behavior of 'calc'
>> >>>> >>> > >> >> >> between
>> >>>> >>> > >> >> >> functions,
>> >>>> >>> > >> >> >> because of attempts to accommodate different functions
>> >>>> >>> > >> >> >> &
>> >>>> >>> > intentions.
>> >>>> >>> > >> >> >> But in 'raster' 1.7-4 (available from R-Forge in ~ 24
>> >>>> >>> > >> >> >> hrs; and
>> >>>> >>> > from
>> >>>> >>> > >> >> >> CRAN soon), the below will work:
>> >>>> >>> > >> >> >>
>> >>>> >>> > >> >> >> library(raster)
>> >>>> >>> > >> >> >> #creating some data
>> >>>> >>> > >> >> >> r <- raster(nrow=10, ncol=10)
>> >>>> >>> > >> >> >> s1 <- s2<- list()
>> >>>> >>> > >> >> >> for (i in 1:12) {
>> >>>> >>> > >> >> >> ? ? ? ?s1[i] <- setValues(r, rnorm(ncell(r), i, 3) )
>> >>>> >>> > >> >> >> ? ? ? ?s2[i] <- setValues(r, rnorm(ncell(r), i, 3) )
>> >>>> >>> > >> >> >> }
>> >>>> >>> > >> >> >> s1 <- stack(s1)
>> >>>> >>> > >> >> >> s2 <- stack(s2)
>> >>>> >>> > >> >> >>
>> >>>> >>> > >> >> >> # regression of values in one brick (or stack) with
>> >>>> >>> > >> >> >> another
>> >>>> >>> > (Jacob's
>> >>>> >>> > >> >> >> suggestion)
>> >>>> >>> > >> >> >> s <- stack(s1, s2)
>> >>>> >>> > >> >> >> # s1 and s2 have 12 layers
>> >>>> >>> > >> >> >> fun <- function(x) { lm(x[1:12] ~
>> >>>> >>> > >> >> >> x[13:24])$coefficients[2] }
>> >>>> >>> > >> >> >> x1 <- calc(s, fun)
>> >>>> >>> > >> >> >>
>> >>>> >>> > >> >> >> # regression of values in one brick (or stack) with
>> >>>> >>> > >> >> >> 'time'
>> >>>> >>> > >> >> >> time <- 1:nlayers(s)
>> >>>> >>> > >> >> >> fun <- function(x) { lm(x ~ time)$coefficients[2] }
>> >>>> >>> > >> >> >> x2 <- calc(s, fun)
>> >>>> >>> > >> >> >>
>> >>>> >>> > >> >> >> # get multiple layers, e.g. the slope _and_ intercept
>> >>>> >>> > >> >> >> fun <- function(x) { lm(x ~ time)$coefficients }
>> >>>> >>> > >> >> >> x3 <- calc(s, fun)
>> >>>> >>> > >> >> >>
>> >>>> >>> > >> >> >> If this does not work in your version, you can use
>> >>>> >>> > >> >> >> apply(
>> >>>> >>> > >> >> >> ) as
>> >>>> >>> > >> >> >> in
>> >>>> >>> > >> >> >> what
>> >>>> >>> > >> >> >> I send earlier.
>> >>>> >>> > >> >> >>
>> >>>> >>> > >> >> >> Robert
>> >>>> >>> > >> >> >>
>> >>>> >>> > >> >> >> On Fri, Nov 26, 2010 at 2:56 PM, Robert J. Hijmans
>> >>>> >>> > >> >> >> <r.hijmans at gmail.com>
>> >>>> >>> > >> >> >> wrote:
>> >>>> >>> > >> >> >> > It seems that 'calc' does not like this (any more;
>> >>>> >>> > >> >> >> > another
>> >>>> >>> > >> >> >> > thing
>> >>>> >>> > >> >> >> > to
>> >>>> >>> > >> >> >> > fix) . If your rasters are not very large you can
>> >>>> >>> > >> >> >> > use
>> >>>> >>> > >> >> >> > apply,
>> >>>> >>> > which
>> >>>> >>> > >> >> >> > makes it much faster:
>> >>>> >>> > >> >> >> >
>> >>>> >>> > >> >> >> > library(raster)
>> >>>> >>> > >> >> >> > #creating some data
>> >>>> >>> > >> >> >> > r <- raster(nrow=10, ncol=10)
>> >>>> >>> > >> >> >> > s <- list()
>> >>>> >>> > >> >> >> > for (i in 1:25) { s[i] <- setValues(r,
>> >>>> >>> > >> >> >> > rnorm(ncell(r),
>> >>>> >>> > >> >> >> > i, 3)
>> >>>> >>> > >> >> >> > ) }
>> >>>> >>> > >> >> >> > s <- stack(s)
>> >>>> >>> > >> >> >> >
>> >>>> >>> > >> >> >> > # regression
>> >>>> >>> > >> >> >> > time <- 1:nlayers(s)
>> >>>> >>> > >> >> >> > fun <- function(x) { lm(x ~ time)$coefficients[2] }
>> >>>> >>> > >> >> >> > r[] <- apply(getValues(s), 1, fun)
>> >>>> >>> > >> >> >> >
>> >>>> >>> > >> >> >> > Robert
>> >>>> >>> > >> >> >> >
>> >>>> >>> > >> >> >> >
>> >>>> >>> > >> >> >> >
>> >>>> >>> > >> >> >> > On Fri, Nov 26, 2010 at 2:51 PM, Jacob van Etten
>> >>>> >>> > >> >> >> > <jacobvanetten at yahoo.com> wrote:
>> >>>> >>> > >> >> >> >> you could try this approach (use calc whenever you
>> >>>> >>> > >> >> >> >> can):
>> >>>> >>> > >> >> >> >>
>> >>>> >>> > >> >> >> >> (supposing your bricks have 12 layers)
>> >>>> >>> > >> >> >> >>
>> >>>> >>> > >> >> >> >> br3 <- stack(brick1, brick2)
>> >>>> >>> > >> >> >> >> lmS <- function(x) lm(x[1:12] ~
>> >>>> >>> > >> >> >> >> x[13:24)$coefficients[2]
>> >>>> >>> > >> >> >> >> r <- calc(br3, lmS)
>> >>>> >>> > >> >> >> >>
>> >>>> >>> > >> >> >> >> Jacob.
>> >>>> >>> > >> >> >> >>
>> >>>> >>> > >> >> >> >> --- On Fri, 26/11/10, steven mosher
>> >>>> >>> > >> >> >> >> <moshersteven at gmail.com>
>> >>>> >>> > >> >> >> >> wrote:
>> >>>> >>> > >> >> >> >>
>> >>>> >>> > >> >> >> >> From: steven mosher <moshersteven at gmail.com>
>> >>>> >>> > >> >> >> >> Subject: Re: [R-sig-Geo] gridded time series
>> >>>> >>> > >> >> >> >> analysis
>> >>>> >>> > >> >> >> >> To: "Martin" <martin_brandt at gmx.net>
>> >>>> >>> > >> >> >> >> Cc: r-sig-geo at stat.math.ethz.ch
>> >>>> >>> > >> >> >> >> Date: Friday, 26 November, 2010, 23:33
>> >>>> >>> > >> >> >> >>
>> >>>> >>> > >> >> >> >> that's cool, I'm also interested in a similar
>> >>>> >>> > >> >> >> >> problem
>> >>>> >>> > >> >> >> >> but
>> >>>> >>> > >> >> >> >> just
>> >>>> >>> > >> >> >> >> with
>> >>>> >>> > >> >> >> >> one
>> >>>> >>> > >> >> >> >> brick ending up with a slope raster as the output.
>> >>>> >>> > >> >> >> >> It
>> >>>> >>> > >> >> >> >> may be
>> >>>> >>> > >> >> >> >> possible
>> >>>> >>> > >> >> >> >> with
>> >>>> >>> > >> >> >> >> stackApply(). have a look. or maybe robert will
>> >>>> >>> > >> >> >> >> chime
>> >>>> >>> > >> >> >> >> in
>> >>>> >>> > >> >> >> >>
>> >>>> >>> > >> >> >> >>
>> >>>> >>> > >> >> >> >>
>> >>>> >>> > >> >> >> >> On Fri, Nov 26, 2010 at 1:35 PM, Martin
>> >>>> >>> > >> >> >> >> <martin_brandt at gmx.net
>> >>>> >>> > >
>> >>>> >>> > >> >> >> >> wrote:
>> >>>> >>> > >> >> >> >>
>> >>>> >>> > >> >> >> >>>
>> >>>> >>> > >> >> >> >>> this is what I did to perform a regression between
>> >>>> >>> > >> >> >> >>> two
>> >>>> >>> > >> >> >> >>> bricks
>> >>>> >>> > >> >> >> >>> (each
>> >>>> >>> > >> >> >> >>> brick
>> >>>> >>> > >> >> >> >>> represent a time series):
>> >>>> >>> > >> >> >> >>>
>> >>>> >>> > >> >> >> >>> r <- raster(brick1)
>> >>>> >>> > >> >> >> >>> for (i in 1:ncell(r)) {
>> >>>> >>> > >> >> >> >>> r[i] = lm(as.ts(cellValues(brick1, i)) ~
>> >>>> >>> > >> >> >> >>> as.ts(cellValues(brick2,
>> >>>> >>> > >> >> >> >>> i)))$coefficients[2]
>> >>>> >>> > >> >> >> >>> }
>> >>>> >>> > >> >> >> >>>
>> >>>> >>> > >> >> >> >>> The result will be a slope raster, but it really
>> >>>> >>> > >> >> >> >>> takes a
>> >>>> >>> > >> >> >> >>> lot
>> >>>> >>> > of
>> >>>> >>> > >> >> >> >>> time,
>> >>>> >>> > >> >> >> >>> so
>> >>>> >>> > >> >> >> >>> maybe there is a better solution..
>> >>>> >>> > >> >> >> >>>
>> >>>> >>> > >> >> >> >>>
>> >>>> >>> > >> >> >> >>> --
>> >>>> >>> > >> >> >> >>> View this message in context:
>> >>>> >>> > >> >> >> >>>
>> >>>> >>> > >> >> >> >>>
>> >>>> >>> > >> >> >> >>>
>> >>>> >>> > >> >> >> >>>
>> >>>> >>> >
>> >>>> >>> >
>> >>>> >>> >
>> >>>> >>> > http://r-sig-geo.2731867.n2.nabble.com/gridded-time-series-analysis-tp5775651p5778472.html
>> >>>> >>> > >> >> >> >>> Sent from the R-sig-geo mailing list archive at
>> >>>> >>> > >> >> >> >>> Nabble.com.
>> >>>> >>> > >> >> >> >>>
>> >>>> >>> > >> >> >> >>> _______________________________________________
>> >>>> >>> > >> >> >> >>> R-sig-Geo mailing list
>> >>>> >>> > >> >> >> >>> R-sig-Geo at stat.math.ethz.ch
>> >>>> >>> > >> >> >> >>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> >>>> >>> > >> >> >> >>>
>> >>>> >>> > >> >> >> >>
>> >>>> >>> > >> >> >> >> ? ? [[alternative HTML version deleted]]
>> >>>> >>> > >> >> >> >>
>> >>>> >>> > >> >> >> >> _______________________________________________
>> >>>> >>> > >> >> >> >> R-sig-Geo mailing list
>> >>>> >>> > >> >> >> >> R-sig-Geo at stat.math.ethz.ch
>> >>>> >>> > >> >> >> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> >>>> >>> > >> >> >> >>
>> >>>> >>> > >> >> >> >>
>> >>>> >>> > >> >> >> >>
>> >>>> >>> > >> >> >> >>
>> >>>> >>> > >> >> >> >> ? ? ? ?[[alternative HTML version deleted]]
>> >>>> >>> > >> >> >> >>
>> >>>> >>> > >> >> >> >>
>> >>>> >>> > >> >> >> >> _______________________________________________
>> >>>> >>> > >> >> >> >> R-sig-Geo mailing list
>> >>>> >>> > >> >> >> >> R-sig-Geo at stat.math.ethz.ch
>> >>>> >>> > >> >> >> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> >>>> >>> > >> >> >> >>
>> >>>> >>> > >> >> >> >>
>> >>>> >>> > >> >> >> >
>> >>>> >>> > >> >> >>
>> >>>> >>> > >> >> >> _______________________________________________
>> >>>> >>> > >> >> >> R-sig-Geo mailing list
>> >>>> >>> > >> >> >> R-sig-Geo at stat.math.ethz.ch
>> >>>> >>> > >> >> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> >>>> >>> > >> >> >
>> >>>> >>> > >> >> >
>> >>>> >>> > >> >> >
>> >>>> >>> > >> >> > --
>> >>>> >>> > >> >> > advait godbole
>> >>>> >>> > >> >> >
>> >>>> >>> > >> >
>> >>>> >>> > >> >
>> >>>> >>> > >> >
>> >>>> >>> > >> > --
>> >>>> >>> > >> > advait godbole
>> >>>> >>> > >> >
>> >>>> >>> > >
>> >>>> >>> > >
>> >>>> >>> > >
>> >>>> >>> > > --
>> >>>> >>> > > advait godbole
>> >>>> >>> > >
>> >>>> >>> >
>> >>>> >>>
>> >>>> >>>
>> >>>> >>>
>> >>>> >>> --
>> >>>> >>> advait godbole
>> >>>> >>>
>> >>>> >>> ? ? ? ?[[alternative HTML version deleted]]
>> >>>> >>>
>> >>>> >>> _______________________________________________
>> >>>> >>> R-sig-Geo mailing list
>> >>>> >>> R-sig-Geo at r-project.org
>> >>>> >>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> >>>> >>
>> >>>> >>
>> >>>> >
>> >>>
>> >>>
>> >>>
>> >>> --
>> >>> advait godbole
>> >>
>> >>
>> >>
>> >> --
>> >> advait godbole
>> >
>> >
>
>
>
> --
> advait godbole
>


From v8extra at gmail.com  Mon Dec  6 00:13:22 2010
From: v8extra at gmail.com (=?iso-8859-1?Q?S=E9bastien_Durand?=)
Date: Sun, 5 Dec 2010 18:13:22 -0500
Subject: [R-sig-Geo] Polygon dissolution or union issue
In-Reply-To: <alpine.LRH.2.00.1012051954390.16860@reclus.nhh.no>
References: <067839EE-C45D-4088-8CDA-D76DA6424A7E@gmail.com>
	<AANLkTi=+KP7RvG47kvPHiuiUkrxd7c2iot=MBp1XKV8K@mail.gmail.com>
	<alpine.LRH.2.00.1012051954390.16860@reclus.nhh.no>
Message-ID: <60E00188-4814-4DB6-8BED-317C03D43CA3@gmail.com>

Hello,

First of all thanks a lot for the answers.

Now regarding the package Akima, I will have to change it then. 

So now that you speak about Tps, and the field package I will look into it, it sure looks interesting

The main reason why I used the package Akima was simply because I was asked to used a linear interpolation basde on delaunay triangulation. And the interp linear interpolation is used in the triangles bounded by data points, a way that is to me similar to Delaunay triangulations, but my understanding of all this is limited. 

There is better interpolation methods there for sure, and I would be very happy to hear about the tools that you prefer using for doing such task.

Thanks a lot


Le 2010-12-05 ? 13:59, Roger Bivand a ?crit :

> On Sat, 4 Dec 2010, Robert J. Hijmans wrote:
> 
>> S?bastien,
>> 
>> You can fix this by rounding the coordinates of the polygons first:
>> 
>> library(akima)
>> library(maptools)
>> gpclibPermit()
> 
> Please note that both akima and gpclib have restricted licenses (excluding research for paying clients), so that this should not be suggested as a general solution. The equivalent unionSpatialPolygons() in the as yet unreleased maptools on R-forge will use rgeos (also on R-forge) instead - rgeos should reach CRAN this month. Replacing akima remains an open question, any offers?
> 
> Roger
> 
> 
>> library(raster)
>> data(akima)
>> dimgrid <- 50
>> ak.li <- interp(akima$x, akima$y, akima$z, xo=seq(min(akima$x),
>> max(akima$x), length = dimgrid),yo=seq(min(akima$y), max(akima$y),
>> length = dimgrid),linear = TRUE, extrap=FALSE, duplicate = "mean")
>> r <- raster(ak.li)
>> pol <- rasterToPolygons(r, fun=function(x){x>20 & x<25})
>> 
>> ### new code
>> digits <- 6
>> for (i in 1:length(pol at polygons)) {
>> # simple case with no multi-polygons
>> 	pol at polygons[[i]]@Polygons[[1]]@coords <-
>> round(pol at polygons[[i]]@Polygons[[1]]@coords, digits)
>> }
>> ###
>> 
>> union <- unionSpatialPolygons(pol, ID=rep(1, times=length(pol at polygons)))
>> plot(r)
>> plot(union, add=T)
>> 
>> 
>> Robert
>> 
>> On Sat, Dec 4, 2010 at 10:00 PM, S?bastien Durand <v8extra at gmail.com> wrote:
>>> 
>>> Hello,
>>> 
>>> Could somebody find me the solution to this issue!
>>> 
>>> I cannot manage to merge or dissolve all the polygon  generated in the object "pol"
>>> 
>>> Here is my example:
>>> 
>>> library(akima)
>>> library(maptools)
>>> library(raster)
>>> 
>>> data(akima)
>>> # define de dimension of grid
>>> dimgrid=50
>>> 
>>> # Interpolate to regular grid
>>> ak.li=interp(akima$x, akima$y, akima$z, xo=seq(min(akima$x), max(akima$x), length = dimgrid),yo=seq(min(akima$y), max(akima$y), length = dimgrid),linear = TRUE, extrap=FALSE, duplicate = "mean")
>>> 
>>> # Show interpolation
>>> image(ak.li)
>>> points(akima)
>>> with(akima, text(x, y, formatC(z,dig=2), adj = -0.1))
>>> 
>>> # Create a raster with the data
>>> r <- raster(ak.li)
>>> plot(r)
>>> pol <- rasterToPolygons(r, fun=function(x){x>20 & x<25})
>>> plot(pol, add=T, col='red')
>>> 
>>> r <- raster(nrow=length(ak.li$y), ncol=length(ak.li$x), crs=NA)
>>> tmp=ak.li$z
>>> tmp=apply(tmp, 1, rev)
>>> r[] <- tmp
>>> 
>>> # Show the raster
>>> plot(r)
>>> 
>>> # Convert the data found between ]20 and 25[ into polygons
>>> pol <- rasterToPolygons(r, fun=function(x){x>20 & x<25})
>>> 
>>> # Show the polygons
>>> plot(pol, add=T, col='red')
>>> 
>>> # Attempt to merge similar adjacent into one polygon
>>> union = unionSpatialPolygons(pol, ID=rep(1,
>>> times=length(pol at polygons)))
>>> 
>>> # Show
>>> plot(union, add=TRUE, col="red")
>>> 
>>> I beleive all polygons should be merged by that point but obviously I must have done something wrong.  All polygons were not merged into a single one and I don't know how to fix that!
>>> 
>>> Any other solutions
>>> 
>>> Help?
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>> 
>> 
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> 
> 
> -- 
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no


From advaitgodbole at gmail.com  Mon Dec  6 00:14:47 2010
From: advaitgodbole at gmail.com (Advait Godbole)
Date: Sun, 5 Dec 2010 18:14:47 -0500
Subject: [R-sig-Geo] gridded time series analysis
In-Reply-To: <AANLkTinvp-k47MHyV2s+hje_P0VXHvTmOKPFf8q5btAO@mail.gmail.com>
References: <AANLkTimTdxzoDCfJQOB8bgQRhjLy3YzSbtGtMdijk9sQ@mail.gmail.com>
	<771411.8321.qm@web29709.mail.ird.yahoo.com>
	<AANLkTin2DYocWNOAR-LfGoBP4+gCtA7eVDHmoaQ6wriR@mail.gmail.com>
	<AANLkTimFw1zMH75s+TG+SFkBHfXzpURm2WXskAa8Kp=m@mail.gmail.com>
	<AANLkTim9dBnVkZ0tjvoa1YRpPRr156jJ9zcezMDrtzhX@mail.gmail.com>
	<AANLkTi=vW6NXYXKGNa0gcTfZ8ezEjvegdxU3Dt5SPA4F@mail.gmail.com>
	<AANLkTikqNmC62Pv-n9Dxd1w7fTHJPx8cR72U6YEtWMTV@mail.gmail.com>
	<AANLkTikQsL9opzu1i0mWxtJA6YmcgBbGdbihXFOwPRho@mail.gmail.com>
	<AANLkTinY5+3JbpZfWnriDZNOdmcfic0628Qi0=NDZghK@mail.gmail.com>
	<AANLkTikd-PJKWZdWUL2+S9VYAq1QJ4LPwG2==erEs2+Q@mail.gmail.com>
	<AANLkTi=eZL0Rq5EyoRA29fdnN2VL-Xt6hcGN4DnZgCKk@mail.gmail.com>
	<AANLkTikVto4GD=vO=5YKwKXL7y+Ze4ADn2KXpsw1AFVA@mail.gmail.com>
	<AANLkTinUvhmDLP2YSWuqb5=G0YKX=sWp6yMOj9KPAgdA@mail.gmail.com>
	<AANLkTi=P5HNFjEsaapUBF7vSAFAsekU_4bYJqXnW=gbu@mail.gmail.com>
	<AANLkTikwWainpBBeSr8xnNNq8uoFXdU2n_34y2-u6K5J@mail.gmail.com>
	<AANLkTin5-hV=b8yxQnvviF_4w-uPfsSJ9X82pmbi=WQo@mail.gmail.com>
	<AANLkTikmPMvBRuu6RvjXsd8LdJc38FP+tAiF9iAc31Ks@mail.gmail.com>
	<AANLkTikSowU_SFiCmZyE3TKEa_UesH_SDQdPP63i+ERY@mail.gmail.com>
	<AANLkTi=p+LbmQ96GSJFuYyw-HLcCxJgYqaK4n2pBZcbG@mail.gmail.com>
	<AANLkTinvp-k47MHyV2s+hje_P0VXHvTmOKPFf8q5btAO@mail.gmail.com>
Message-ID: <AANLkTi=S8tY50xzS2PFS7LvUEMT4cb4TFME-kT7DkmS0@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101205/0ba93ccf/attachment.pl>

From r.hijmans at gmail.com  Mon Dec  6 00:29:45 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Sun, 5 Dec 2010 15:29:45 -0800
Subject: [R-sig-Geo] gridded time series analysis
In-Reply-To: <AANLkTi=S8tY50xzS2PFS7LvUEMT4cb4TFME-kT7DkmS0@mail.gmail.com>
References: <AANLkTimTdxzoDCfJQOB8bgQRhjLy3YzSbtGtMdijk9sQ@mail.gmail.com>
	<771411.8321.qm@web29709.mail.ird.yahoo.com>
	<AANLkTin2DYocWNOAR-LfGoBP4+gCtA7eVDHmoaQ6wriR@mail.gmail.com>
	<AANLkTimFw1zMH75s+TG+SFkBHfXzpURm2WXskAa8Kp=m@mail.gmail.com>
	<AANLkTim9dBnVkZ0tjvoa1YRpPRr156jJ9zcezMDrtzhX@mail.gmail.com>
	<AANLkTi=vW6NXYXKGNa0gcTfZ8ezEjvegdxU3Dt5SPA4F@mail.gmail.com>
	<AANLkTikqNmC62Pv-n9Dxd1w7fTHJPx8cR72U6YEtWMTV@mail.gmail.com>
	<AANLkTikQsL9opzu1i0mWxtJA6YmcgBbGdbihXFOwPRho@mail.gmail.com>
	<AANLkTinY5+3JbpZfWnriDZNOdmcfic0628Qi0=NDZghK@mail.gmail.com>
	<AANLkTikd-PJKWZdWUL2+S9VYAq1QJ4LPwG2==erEs2+Q@mail.gmail.com>
	<AANLkTi=eZL0Rq5EyoRA29fdnN2VL-Xt6hcGN4DnZgCKk@mail.gmail.com>
	<AANLkTikVto4GD=vO=5YKwKXL7y+Ze4ADn2KXpsw1AFVA@mail.gmail.com>
	<AANLkTinUvhmDLP2YSWuqb5=G0YKX=sWp6yMOj9KPAgdA@mail.gmail.com>
	<AANLkTi=P5HNFjEsaapUBF7vSAFAsekU_4bYJqXnW=gbu@mail.gmail.com>
	<AANLkTikwWainpBBeSr8xnNNq8uoFXdU2n_34y2-u6K5J@mail.gmail.com>
	<AANLkTin5-hV=b8yxQnvviF_4w-uPfsSJ9X82pmbi=WQo@mail.gmail.com>
	<AANLkTikmPMvBRuu6RvjXsd8LdJc38FP+tAiF9iAc31Ks@mail.gmail.com>
	<AANLkTikSowU_SFiCmZyE3TKEa_UesH_SDQdPP63i+ERY@mail.gmail.com>
	<AANLkTi=p+LbmQ96GSJFuYyw-HLcCxJgYqaK4n2pBZcbG@mail.gmail.com>
	<AANLkTinvp-k47MHyV2s+hje_P0VXHvTmOKPFf8q5btAO@mail.gmail.com>
	<AANLkTi=S8tY50xzS2PFS7LvUEMT4cb4TFME-kT7DkmS0@mail.gmail.com>
Message-ID: <AANLkTims2FyRBiLdmtZzR8wwvrBSyMuepVe0_Li-B6nU@mail.gmail.com>

Advait,
It is just an example. In this case the function only checks the first
time-slice for all cells. That often works because oftentimes either
all values are NA, or none. Also, I think lm works when not all values
are NA. If your data is different, you may need a different solution.
The best thing might be to try it out with a small dataset (you can
use crop to create one).
Robert

On Sun, Dec 5, 2010 at 3:14 PM, Advait Godbole <advaitgodbole at gmail.com> wrote:
> Earlier in the threade you had mentioned that for two 120 layer bricks, this
> is what I should do:
> # regression of values in one brick (or stack) with another (Jacob's
> suggestion)
> s <- stack(s1, s2)
> # s1 and s2 have 120 layers
> fun <- function(x) { lm(x[1:120] ~ x[121:240])$coefficients[2] }
> x1 <- calc(s, fun)
> So if I have to check for NAs for the multi layered raster, I would need to
> do something like
> fun <- function (x) { if(is.na(x[1:120])) {NA} else
> {lm(x[1:120]~x[121:240])$coefficients[2]}}
> calc(s,fun=fun)
> That does not seem intuitively right to me although I am not very conversant
> with how is.na handles 3D variables to go much further. Also, should I not
> check the other brick for NAs too?
> Advait
> On Sun, Dec 5, 2010 at 5:29 PM, Robert J. Hijmans <r.hijmans at gmail.com>
> wrote:
>>
>> >If so, should I use a for loop instead?
>> No, that is the point of the calc function, that you do not do that.
>> Internally, calc uses apply as in
>> apply(values, 1, fun)
>>
>>
>> On Sat, Dec 4, 2010 at 1:50 PM, Advait Godbole <advaitgodbole at gmail.com>
>> wrote:
>> > Roger, that fix worked, its there in the latest version. Thanks much.
>> > I am running into the problem that Martin mentioned earlier in the
>> > thread:
>> > Error in lm.fit(x, y, offset = offset, singular.ok = singular.ok, ...) :
>> > ?0 (non-NA) cases
>> >
>> > For which you suggested this:
>> > #you could catch this in your function and do something like:
>> >
>> >> fun=function(x) { if (is.na(x[1])){ NA } else {
>> >> lm(x[1]~x[2])$coefficients[2] }}
>> >> fun(c(NA,NA))
>> > [1] NA
>> >
>> > and then:
>> > calc(s, fun=fun)
>> >
>> > What I am confused is that my stack "s" that I will pass via calc is of
>> > dimensions 356 x 507 x 240, and therefore is.na?will act on the entire
>> > array
>> > and therefore still fail at those points where it is not NA. Is that
>> > right?
>> > If so, should I use a for loop instead?
>> > Thanks,
>> > Advait
>> > On Fri, Dec 3, 2010 at 2:58 PM, Robert J. Hijmans <r.hijmans at gmail.com>
>> > wrote:
>> >>
>> >> It may have been fixed. Please try this again in raster 1.7-8 (now on
>> >> CRAN for windows and linux, mac in a day or so). Robert
>> >>
>> >> On Fri, Dec 3, 2010 at 11:54 AM, steven mosher <moshersteven at gmail.com>
>> >> wrote:
>> >> > Well,
>> >> > ??I need some more information.
>> >> > ?before you create the stack do this and report the results
>> >> > test1 <- layerNames(rcmraster)
>> >> > test2 <- layerNames(emitraster)
>> >> > str(test1)
>> >> > str(test2)
>> >> > Its a bit of a hack but ?you can try to copy the layerNames out of
>> >> > the
>> >> > invidual stacks.
>> >> > Then set them to ? ?""
>> >> > then create one big stack
>> >> > then set the layerNames.
>> >> > ( I recall having to do that once in the past after a stackApply())
>> >> > I know in the past, I've had some similar issues, but I thought that
>> >> > they
>> >> > ?had been fixed.
>> >> > I'll try to take a look at the code ?in a bit, but if there is a bug,
>> >> > either
>> >> > robert or Jacob would have to fix it.
>> >> >
>> >> > On Fri, Dec 3, 2010 at 4:28 AM, Advait Godbole
>> >> > <advaitgodbole at gmail.com>
>> >> > wrote:
>> >> >>
>> >> >> With Robert being away until the 15th, can someone else help out
>> >> >> with
>> >> >> this
>> >> >> issue? To recap, I have read in two 507 x ?356 x 120 (lon,lat,time)
>> >> >> netCDF
>> >> >> files into R using the "brick" function. I get the following error
>> >> >> when
>> >> >> I
>> >> >> use "stack" to clump these two multi layer rasters together.
>> >> >> > s <- stack(rcmraster,emitraster)
>> >> >> Error in function (classes, fdef, mtable) ?:
>> >> >> ??unable to find an inherited method for function "trim", for
>> >> >> signature
>> >> >> "integer"
>> >> >> Robert suggested that it is because of the layerNames being numeric,
>> >> >> annd
>> >> >> that layerNames() <- layerNames() would solve it but it did not
>> >> >> help,
>> >> >> even
>> >> >> though layerNames() is now of type character.
>> >> >> Thanks much!
>> >> >> adv
>> >> >> On Fri, Dec 3, 2010 at 7:13 AM, Advait Godbole
>> >> >> <advaitgodbole at gmail.com>
>> >> >> wrote:
>> >> >>>
>> >> >>> the setMinMax() function worked. Thanks Steve and Robert..
>> >> >>> the work around did not work - I still get the trim() error..
>> >> >>> adv
>> >> >>>
>> >> >>> On Thu, Dec 2, 2010 at 1:43 PM, Robert J. Hijmans
>> >> >>> <r.hijmans at gmail.com>
>> >> >>> wrote:
>> >> >>>>
>> >> >>>> This is the work around:
>> >> >>>>
>> >> >>>> layerNames(rcmraster) <- layerNames(rcmraster)
>> >> >>>>
>> >> >>>>
>> >> >>>> On Thu, Dec 2, 2010 at 10:43 AM, Robert J. Hijmans
>> >> >>>> <r.hijmans at gmail.com>
>> >> >>>> wrote:
>> >> >>>> > The question marks indicate that the min and max values are not
>> >> >>>> > known
>> >> >>>> > to the object (because the file type does not store them, and it
>> >> >>>> > is
>> >> >>>> > too 'expensive' to determine them on the fly). setMinMax if you
>> >> >>>> > really
>> >> >>>> > need to know.
>> >> >>>> > The error on trim seems to be a problem with layerNames being
>> >> >>>> > numeric.
>> >> >>>> > I'll fix that. This may be a work-around
>> >> >>>> >
>> >> >>>> >
>> >> >>>> >
>> >> >>>> >
>> >> >>>> >
>> >> >>>> >
>> >> >>>> > On Thu, Dec 2, 2010 at 10:23 AM, steven mosher
>> >> >>>> > <moshersteven at gmail.com> wrote:
>> >> >>>> >> ?see the setMinMax()
>> >> >>>> >>
>> >> >>>> >> ?for the error on trim() I'm not sure.
>> >> >>>> >>
>> >> >>>> >> On Thu, Dec 2, 2010 at 5:16 AM, Advait Godbole
>> >> >>>> >> <advaitgodbole at gmail.com>
>> >> >>>> >> wrote:
>> >> >>>> >>>
>> >> >>>> >>> That worked perfectly. Thanks for pointing this out. I changed
>> >> >>>> >>> the
>> >> >>>> >>> way my
>> >> >>>> >>> variables were being written to the netCDF and now "brick"
>> >> >>>> >>> works.
>> >> >>>> >>> However,
>> >> >>>> >>> I
>> >> >>>> >>> am getting an error while using the stack function, like so:
>> >> >>>> >>>
>> >> >>>> >>> "Error in function (classes, fdef, mtable) ?:
>> >> >>>> >>> ?unable to find an inherited method for function "trim", for
>> >> >>>> >>> signature
>> >> >>>> >>> "integer"
>> >> >>>> >>>
>> >> >>>> >>> The two rasters show the following:
>> >> >>>> >>> > rcmraster
>> >> >>>> >>> class ? ? ? : RasterBrick
>> >> >>>> >>> filename ? ?: regcm.cumul.hdd.10k.96_05.fixed.latlonvars.nc
>> >> >>>> >>> nlayers ? ? : 120
>> >> >>>> >>> nrow ? ? ? ?: 356
>> >> >>>> >>> ncol ? ? ? ?: 507
>> >> >>>> >>> ncell ? ? ? : 180492
>> >> >>>> >>> projection ?: +proj=longlat +datum=WGS84 +ellps=WGS84
>> >> >>>> >>> +towgs84=0,0,0
>> >> >>>> >>> min value ? : ? ? ? ? ? ? ? ? ? ?
>> >> >>>> >>> max value ? : ? ? ? ? ? ? ? ? ? ?
>> >> >>>> >>> xmin ? ? ? ?: -137.3312
>> >> >>>> >>> xmax ? ? ? ?: -62.11259
>> >> >>>> >>> ymin ? ? ? ?: 22.12693
>> >> >>>> >>> ymax ? ? ? ?: 57.35954
>> >> >>>> >>> xres ? ? ? ?: 0.1483602
>> >> >>>> >>> yres ? ? ? ?: 0.09896801
>> >> >>>> >>>
>> >> >>>> >>> > emitraster
>> >> >>>> >>> class ? ? ? : RasterBrick
>> >> >>>> >>> filename ? ?:
>> >> >>>> >>>
>> >> >>>> >>>
>> >> >>>> >>> flip.percap.vulcan.10k.dp.build.381.RES.EIAmy.96_05.this.latest.nc
>> >> >>>> >>> nlayers ? ? : 120
>> >> >>>> >>> nrow ? ? ? ?: 356
>> >> >>>> >>> ncol ? ? ? ?: 507
>> >> >>>> >>> ncell ? ? ? : 180492
>> >> >>>> >>> projection ?: +proj=longlat +datum=WGS84 +ellps=WGS84
>> >> >>>> >>> +towgs84=0,0,0
>> >> >>>> >>> min value ? : ? ? ? ? ? ? ? ? ? ?
>> >> >>>> >>> max value ? : ? ? ? ? ? ? ? ? ? ?
>> >> >>>> >>> xmin ? ? ? ?: -137.3312
>> >> >>>> >>> xmax ? ? ? ?: -62.11259
>> >> >>>> >>> ymin ? ? ? ?: 22.12693
>> >> >>>> >>> ymax ? ? ? ?: 57.35954
>> >> >>>> >>> xres ? ? ? ?: 0.1483602
>> >> >>>> >>> yres ? ? ? ?: 0.09896801
>> >> >>>> >>>
>> >> >>>> >>> A getValues call shows a lot of NAs. Now, my original file
>> >> >>>> >>> does
>> >> >>>> >>> have
>> >> >>>> >>> a
>> >> >>>> >>> large
>> >> >>>> >>> number of missing values so that is why this should happen,
>> >> >>>> >>> but I
>> >> >>>> >>> suspect
>> >> >>>> >>> something is going wrong since the min and max values are not
>> >> >>>> >>> being
>> >> >>>> >>> displayed for either of these rasters. Is that the source of
>> >> >>>> >>> the
>> >> >>>> >>> problem
>> >> >>>> >>> in
>> >> >>>> >>> the "stack" function?
>> >> >>>> >>>
>> >> >>>> >>> Thanks,
>> >> >>>> >>>
>> >> >>>> >>> Advait
>> >> >>>> >>>
>> >> >>>> >>> On Tue, Nov 30, 2010 at 5:18 PM, Robert J. Hijmans
>> >> >>>> >>> <r.hijmans at gmail.com>wrote:
>> >> >>>> >>>
>> >> >>>> >>> > Advait,
>> >> >>>> >>> >
>> >> >>>> >>> > The is an error in the file, I think, see below:
>> >> >>>> >>> >
>> >> >>>> >>> > > library(ncdf)
>> >> >>>> >>> > > filename = "c:/downloads/regcm.cumul.hdd.10k.96_05.new.nc"
>> >> >>>> >>> > > nc <- open.ncdf(filename)
>> >> >>>> >>> > >
>> >> >>>> >>> > > zvar <- 'hdd'
>> >> >>>> >>> > > nc$var[[zvar]]$dim[[1]]$len
>> >> >>>> >>> > [1] 507
>> >> >>>> >>> > > nc$var[[zvar]]$dim[[2]]$len
>> >> >>>> >>> > [1] 356
>> >> >>>> >>> > >
>> >> >>>> >>> > > xx <- nc$var[[zvar]]$dim[[1]]$vals
>> >> >>>> >>> > > # should be a vector of 507 longitudes but:
>> >> >>>> >>> > > dim(xx)
>> >> >>>> >>> > [1] 507 356 120
>> >> >>>> >>> > >
>> >> >>>> >>> > > # works anyway
>> >> >>>> >>> > > xrange <- c(min(xx), max(xx))
>> >> >>>> >>> > > xrange
>> >> >>>> >>> > [1] -137.25705 ?-62.18677
>> >> >>>> >>> > >
>> >> >>>> >>> > > yy <- nc$var[[zvar]]$dim[[2]]$vals
>> >> >>>> >>> > > # should be a vector of 356 latitudes but:
>> >> >>>> >>> > > dim(yy)
>> >> >>>> >>> > [1] 507 356 120
>> >> >>>> >>> > >
>> >> >>>> >>> > > # this fails
>> >> >>>> >>> > > yrange <- c(min(yy), max(yy))
>> >> >>>> >>> > > yrange
>> >> >>>> >>> > [1] NaN NaN
>> >> >>>> >>> > > # and that is the only reason why raster failed.
>> >> >>>> >>> > >
>> >> >>>> >>> > > #OK
>> >> >>>> >>> > > yy[,,1][1:10,350:355]
>> >> >>>> >>> > ? ? ? ? ?[,1] ? ? [,2] ? ? [,3] ? ? [,4] ? ? [,5] ? ? [,6]
>> >> >>>> >>> > ?[1,] 51.49148 51.57122 51.65092 51.73055 51.81014 51.88967
>> >> >>>> >>> > ?[2,] 51.52888 51.60866 51.68839 51.76807 51.84769 51.92727
>> >> >>>> >>> > ?[3,] 51.56616 51.64598 51.72575 51.80547 51.88513 51.96474
>> >> >>>> >>> > ?[4,] 51.60332 51.68318 51.76299 51.84275 51.92245 52.00210
>> >> >>>> >>> > ?[5,] 51.64036 51.72026 51.80011 51.87991 51.95965 52.03934
>> >> >>>> >>> > ?[6,] 51.67728 51.75722 51.83711 51.91695 51.99673 52.07646
>> >> >>>> >>> > ?[7,] 51.71409 51.79407 51.87399 51.95387 52.03369 52.11345
>> >> >>>> >>> > ?[8,] 51.75077 51.83079 51.91076 51.99067 52.07053 52.15033
>> >> >>>> >>> > ?[9,] 51.78734 51.86739 51.94740 52.02735 52.10725 52.18709
>> >> >>>> >>> > [10,] 51.82378 51.90388 51.98392 52.06391 52.14385 52.22373
>> >> >>>> >>> > >
>> >> >>>> >>> > > #bad values here (and note the NaN):
>> >> >>>> >>> > > yy[,,120][1:10,350:355]
>> >> >>>> >>> > ? ? ? ? ? ? ? ?[,1] ? ? ? ? ? [,2] ? ? ? ? ? [,3]
>> >> >>>> >>> > [,4]
>> >> >>>> >>> > ? ? [,5] ? ? ? ? ? [,6]
>> >> >>>> >>> > ?[1,] -1.313847e-229 -4.895880e-272 -7.553765e-266
>> >> >>>> >>> > 1.293814e+58
>> >> >>>> >>> > 9.551441e-293 ?-3.291580e-36
>> >> >>>> >>> > ?[2,] -5.321424e+272 -3.076997e-223 ?-1.515780e-33
>> >> >>>> >>> > -9.895836e+171
>> >> >>>> >>> > 3.115686e-149 ?-4.970539e+92
>> >> >>>> >>> > ?[3,] ?5.259277e-203 ? 5.980335e-56 ?2.893449e-212
>> >> >>>> >>> > ?2.974200e+274
>> >> >>>> >>> > 3.186547e-218 ?2.503689e+296
>> >> >>>> >>> > ?[4,] -3.977129e+225 -3.696719e-283 ? 1.284612e+42
>> >> >>>> >>> > 1.887923e+28
>> >> >>>> >>> > -2.322520e+268 ?5.005820e-108
>> >> >>>> >>> > ?[5,] ?-6.569744e+88 ? 1.824506e-74 ? 7.663356e+39
>> >> >>>> >>> > ?1.608759e-201
>> >> >>>> >>> > -1.433761e+110 -8.804183e-211
>> >> >>>> >>> > ?[6,] -4.237822e-162 ? ? ? ? ? ?NaN ?7.405904e-275
>> >> >>>> >>> > ?5.859877e-258
>> >> >>>> >>> > 1.339820e+110 ?1.631993e+229
>> >> >>>> >>> > ?[7,] ? 5.603325e-64 ? 4.188764e+37 -2.188887e+243
>> >> >>>> >>> > -4.657907e+280
>> >> >>>> >>> > 1.795268e-185 ?1.166057e-175
>> >> >>>> >>> > ?[8,] -2.112804e-229 ?4.536625e+137 ?2.910322e-278
>> >> >>>> >>> > ?4.407645e-274
>> >> >>>> >>> > 8.886205e-239 -1.913860e+238
>> >> >>>> >>> > ?[9,] ?-9.126350e+44 -1.866422e+177 -2.578975e+256
>> >> >>>> >>> > ?3.275379e+208
>> >> >>>> >>> > -2.657457e+75 ?-1.258259e-90
>> >> >>>> >>> > [10,] ?6.698325e+216 -2.958355e+137 -1.058748e-178
>> >> >>>> >>> > -1.776776e+215
>> >> >>>> >>> > -6.368807e+78 -5.337653e+299
>> >> >>>> >>> > >
>> >> >>>> >>> > > # this would have worked
>> >> >>>> >>> > > yrange <- c(min(yy[,,1]), max(yy[,,1]))
>> >> >>>> >>> > > yrange
>> >> >>>> >>> > [1] 22.17641 57.31006
>> >> >>>> >>> > >
>> >> >>>> >>> > > close.ncdf(nc)
>> >> >>>> >>> >
>> >> >>>> >>> >
>> >> >>>> >>> > Best, Robert
>> >> >>>> >>> >
>> >> >>>> >>> >
>> >> >>>> >>> > On Tue, Nov 30, 2010 at 10:37 AM, Advait Godbole
>> >> >>>> >>> > <advaitgodbole at gmail.com> wrote:
>> >> >>>> >>> > > Dear Robert,
>> >> >>>> >>> > > here is the link to the file:
>> >> >>>> >>> > >
>> >> >>>> >>> > >
>> >> >>>> >>> > >
>> >> >>>> >>> > > http://dl.dropbox.com/u/4030944/regcm.cumul.hdd.10k.96_05.new.nc. It
>> >> >>>> >>> > > is
>> >> >>>> >>> > a
>> >> >>>> >>> > > large file ~400 MB. Let me know if dropbox is not
>> >> >>>> >>> > > convenient
>> >> >>>> >>> > > and
>> >> >>>> >>> > > you
>> >> >>>> >>> > would
>> >> >>>> >>> > > rather do ftp - ?but our machines are down for maintenance
>> >> >>>> >>> > > and I
>> >> >>>> >>> > > may
>> >> >>>> >>> > > not
>> >> >>>> >>> > be
>> >> >>>> >>> > > immediately able to get access.
>> >> >>>> >>> > > I was going over the NCL code that processes the files but
>> >> >>>> >>> > > did
>> >> >>>> >>> > > not
>> >> >>>> >>> > > find
>> >> >>>> >>> > > anything glaringly amiss, so I will have to look at it in
>> >> >>>> >>> > > greater
>> >> >>>> >>> > > detail
>> >> >>>> >>> > > since it is clear that the number of entries in the
>> >> >>>> >>> > > variables
>> >> >>>> >>> > > is
>> >> >>>> >>> > > not
>> >> >>>> >>> > right
>> >> >>>> >>> > > as you've pointed out. There is a chance that I have not
>> >> >>>> >>> > > written
>> >> >>>> >>> > > out
>> >> >>>> >>> > > the
>> >> >>>> >>> > > co-ordinates properly.
>> >> >>>> >>> > > Thanks,
>> >> >>>> >>> > > Advait
>> >> >>>> >>> > > On Mon, Nov 29, 2010 at 1:14 PM, Robert J. Hijmans
>> >> >>>> >>> > > <r.hijmans at gmail.com>
>> >> >>>> >>> > > wrote:
>> >> >>>> >>> > >>
>> >> >>>> >>> > >> Advait,
>> >> >>>> >>> > >> I do not think I can help you further unless you send me
>> >> >>>> >>> > >> your
>> >> >>>> >>> > >> file;
>> >> >>>> >>> > >> but this suggests that it is either not following the CF
>> >> >>>> >>> > >> standards,
>> >> >>>> >>> > >> or
>> >> >>>> >>> > >> something is wrong with the file, or that there is
>> >> >>>> >>> > >> something
>> >> >>>> >>> > >> I
>> >> >>>> >>> > >> have
>> >> >>>> >>> > >> not understood about these files.
>> >> >>>> >>> > >> You said you have 507 x 356 x 120 values. I would expect
>> >> >>>> >>> > >> length(frcm$dim[[1]]$vals) == 507 and
>> >> >>>> >>> > >> length(frcm$dim[[2]]$vals) ==
>> >> >>>> >>> > >> 356
>> >> >>>> >>> > >> Robert
>> >> >>>> >>> > >>
>> >> >>>> >>> > >> On Mon, Nov 29, 2010 at 6:11 AM, Advait Godbole <
>> >> >>>> >>> > advaitgodbole at gmail.com>
>> >> >>>> >>> > >> wrote:
>> >> >>>> >>> > >> > sorry to disrupt the flow of the conversation, but
>> >> >>>> >>> > >> > after
>> >> >>>> >>> > >> > doing what
>> >> >>>> >>> > >> > Robert
>> >> >>>> >>> > >> > suggested, this is what was returned:
>> >> >>>> >>> > >> >> length(frcm$dim[[1]]$vals)
>> >> >>>> >>> > >> > [1] 21659040
>> >> >>>> >>> > >> >> length(frcm$dim[[2]]$vals)
>> >> >>>> >>> > >> > [1] 21659040
>> >> >>>> >>> > >> > the other two functions return the latitude and
>> >> >>>> >>> > >> > longitude
>> >> >>>> >>> > >> > arrays
>> >> >>>> >>> > >> > not
>> >> >>>> >>> > >> > populated with NAs/missing values. I havent reproduced
>> >> >>>> >>> > >> > them
>> >> >>>> >>> > >> > here
>> >> >>>> >>> > because
>> >> >>>> >>> > >> > of
>> >> >>>> >>> > >> > their number.
>> >> >>>> >>> > >> > Regards,
>> >> >>>> >>> > >> > advait
>> >> >>>> >>> > >> > On Sat, Nov 27, 2010 at 3:48 PM, Robert J. Hijmans <
>> >> >>>> >>> > r.hijmans at gmail.com>
>> >> >>>> >>> > >> > wrote:
>> >> >>>> >>> > >> >>
>> >> >>>> >>> > >> >> Advait,
>> >> >>>> >>> > >> >>
>> >> >>>> >>> > >> >> That suggests that you have missing values in the lon
>> >> >>>> >>> > >> >> or
>> >> >>>> >>> > >> >> lat
>> >> >>>> >>> > >> >> dimensions. Is that true? That would be awkward, but
>> >> >>>> >>> > >> >> perhaps
>> >> >>>> >>> > something
>> >> >>>> >>> > >> >> else is going on. Can you send me your file? If not
>> >> >>>> >>> > >> >> can
>> >> >>>> >>> > >> >> you
>> >> >>>> >>> > >> >> send
>> >> >>>> >>> > >> >> the
>> >> >>>> >>> > >> >> results of this:
>> >> >>>> >>> > >> >>
>> >> >>>> >>> > >> >> filename <- "regcm.cumul.hdd.10k.96_05.new.nc"
>> >> >>>> >>> > >> >> nc <- open.ncdf(filename)
>> >> >>>> >>> > >> >> length(nc$dim[[1]]$vals)
>> >> >>>> >>> > >> >> length(nc$dim[[2]]$vals)
>> >> >>>> >>> > >> >> nc$dim[[1]]$vals
>> >> >>>> >>> > >> >> nc$dim[[2]]$vals
>> >> >>>> >>> > >> >> close.ncdf(nc)
>> >> >>>> >>> > >> >>
>> >> >>>> >>> > >> >> Thanks, Robert
>> >> >>>> >>> > >> >>
>> >> >>>> >>> > >> >> On Sat, Nov 27, 2010 at 8:36 AM, Advait Godbole
>> >> >>>> >>> > >> >> <advaitgodbole at gmail.com>
>> >> >>>> >>> > >> >> wrote:
>> >> >>>> >>> > >> >> > Thanks everyone for these leads..However, I am
>> >> >>>> >>> > >> >> > running
>> >> >>>> >>> > >> >> > into
>> >> >>>> >>> > problems
>> >> >>>> >>> > >> >> > with
>> >> >>>> >>> > >> >> > data handling. I used ncdf to extract the two
>> >> >>>> >>> > >> >> > variables
>> >> >>>> >>> > >> >> > (507 x
>> >> >>>> >>> > >> >> > 356
>> >> >>>> >>> > x
>> >> >>>> >>> > >> >> > 120
>> >> >>>> >>> > >> >> > -
>> >> >>>> >>> > >> >> > lon,lat,time) and converted them into array objects.
>> >> >>>> >>> > >> >> > The
>> >> >>>> >>> > suggestions
>> >> >>>> >>> > >> >> > provided all utilize the raster package, but using
>> >> >>>> >>> > >> >> > "brick"
>> >> >>>> >>> > >> >> > on
>> >> >>>> >>> > >> >> > the
>> >> >>>> >>> > >> >> > file
>> >> >>>> >>> > >> >> > returns this error: "rcmraster <-
>> >> >>>> >>> > >> >> > brick("regcm.cumul.hdd.10k.96_05.new.nc")
>> >> >>>> >>> > >> >> > Error in if (e at xmin > -400 & e at xmax < 400 & e at ymin >
>> >> >>>> >>> > >> >> > -90.1
>> >> >>>> >>> > >> >> > &
>> >> >>>> >>> > e at ymax <
>> >> >>>> >>> > >> >> > ?:
>> >> >>>> >>> > >> >> > missing value where TRUE/FALSE needed"
>> >> >>>> >>> > >> >> >
>> >> >>>> >>> > >> >> > I have a fair number of NAs (all missing values in
>> >> >>>> >>> > >> >> > the
>> >> >>>> >>> > >> >> > original
>> >> >>>> >>> > >> >> > variables).
>> >> >>>> >>> > >> >> > Is there a way to set a flag for that? Or any other
>> >> >>>> >>> > >> >> > workaround?
>> >> >>>> >>> > >> >> > Thanks much,
>> >> >>>> >>> > >> >> > advait
>> >> >>>> >>> > >> >> > On Fri, Nov 26, 2010 at 6:25 PM, Robert J. Hijmans
>> >> >>>> >>> > >> >> > <r.hijmans at gmail.com>
>> >> >>>> >>> > >> >> > wrote:
>> >> >>>> >>> > >> >> >>
>> >> >>>> >>> > >> >> >> There are some difference in the behavior of 'calc'
>> >> >>>> >>> > >> >> >> between
>> >> >>>> >>> > >> >> >> functions,
>> >> >>>> >>> > >> >> >> because of attempts to accommodate different
>> >> >>>> >>> > >> >> >> functions
>> >> >>>> >>> > >> >> >> &
>> >> >>>> >>> > intentions.
>> >> >>>> >>> > >> >> >> But in 'raster' 1.7-4 (available from R-Forge in ~
>> >> >>>> >>> > >> >> >> 24
>> >> >>>> >>> > >> >> >> hrs; and
>> >> >>>> >>> > from
>> >> >>>> >>> > >> >> >> CRAN soon), the below will work:
>> >> >>>> >>> > >> >> >>
>> >> >>>> >>> > >> >> >> library(raster)
>> >> >>>> >>> > >> >> >> #creating some data
>> >> >>>> >>> > >> >> >> r <- raster(nrow=10, ncol=10)
>> >> >>>> >>> > >> >> >> s1 <- s2<- list()
>> >> >>>> >>> > >> >> >> for (i in 1:12) {
>> >> >>>> >>> > >> >> >> ? ? ? ?s1[i] <- setValues(r, rnorm(ncell(r), i, 3)
>> >> >>>> >>> > >> >> >> )
>> >> >>>> >>> > >> >> >> ? ? ? ?s2[i] <- setValues(r, rnorm(ncell(r), i, 3)
>> >> >>>> >>> > >> >> >> )
>> >> >>>> >>> > >> >> >> }
>> >> >>>> >>> > >> >> >> s1 <- stack(s1)
>> >> >>>> >>> > >> >> >> s2 <- stack(s2)
>> >> >>>> >>> > >> >> >>
>> >> >>>> >>> > >> >> >> # regression of values in one brick (or stack) with
>> >> >>>> >>> > >> >> >> another
>> >> >>>> >>> > (Jacob's
>> >> >>>> >>> > >> >> >> suggestion)
>> >> >>>> >>> > >> >> >> s <- stack(s1, s2)
>> >> >>>> >>> > >> >> >> # s1 and s2 have 12 layers
>> >> >>>> >>> > >> >> >> fun <- function(x) { lm(x[1:12] ~
>> >> >>>> >>> > >> >> >> x[13:24])$coefficients[2] }
>> >> >>>> >>> > >> >> >> x1 <- calc(s, fun)
>> >> >>>> >>> > >> >> >>
>> >> >>>> >>> > >> >> >> # regression of values in one brick (or stack) with
>> >> >>>> >>> > >> >> >> 'time'
>> >> >>>> >>> > >> >> >> time <- 1:nlayers(s)
>> >> >>>> >>> > >> >> >> fun <- function(x) { lm(x ~ time)$coefficients[2] }
>> >> >>>> >>> > >> >> >> x2 <- calc(s, fun)
>> >> >>>> >>> > >> >> >>
>> >> >>>> >>> > >> >> >> # get multiple layers, e.g. the slope _and_
>> >> >>>> >>> > >> >> >> intercept
>> >> >>>> >>> > >> >> >> fun <- function(x) { lm(x ~ time)$coefficients }
>> >> >>>> >>> > >> >> >> x3 <- calc(s, fun)
>> >> >>>> >>> > >> >> >>
>> >> >>>> >>> > >> >> >> If this does not work in your version, you can use
>> >> >>>> >>> > >> >> >> apply(
>> >> >>>> >>> > >> >> >> ) as
>> >> >>>> >>> > >> >> >> in
>> >> >>>> >>> > >> >> >> what
>> >> >>>> >>> > >> >> >> I send earlier.
>> >> >>>> >>> > >> >> >>
>> >> >>>> >>> > >> >> >> Robert
>> >> >>>> >>> > >> >> >>
>> >> >>>> >>> > >> >> >> On Fri, Nov 26, 2010 at 2:56 PM, Robert J. Hijmans
>> >> >>>> >>> > >> >> >> <r.hijmans at gmail.com>
>> >> >>>> >>> > >> >> >> wrote:
>> >> >>>> >>> > >> >> >> > It seems that 'calc' does not like this (any
>> >> >>>> >>> > >> >> >> > more;
>> >> >>>> >>> > >> >> >> > another
>> >> >>>> >>> > >> >> >> > thing
>> >> >>>> >>> > >> >> >> > to
>> >> >>>> >>> > >> >> >> > fix) . If your rasters are not very large you can
>> >> >>>> >>> > >> >> >> > use
>> >> >>>> >>> > >> >> >> > apply,
>> >> >>>> >>> > which
>> >> >>>> >>> > >> >> >> > makes it much faster:
>> >> >>>> >>> > >> >> >> >
>> >> >>>> >>> > >> >> >> > library(raster)
>> >> >>>> >>> > >> >> >> > #creating some data
>> >> >>>> >>> > >> >> >> > r <- raster(nrow=10, ncol=10)
>> >> >>>> >>> > >> >> >> > s <- list()
>> >> >>>> >>> > >> >> >> > for (i in 1:25) { s[i] <- setValues(r,
>> >> >>>> >>> > >> >> >> > rnorm(ncell(r),
>> >> >>>> >>> > >> >> >> > i, 3)
>> >> >>>> >>> > >> >> >> > ) }
>> >> >>>> >>> > >> >> >> > s <- stack(s)
>> >> >>>> >>> > >> >> >> >
>> >> >>>> >>> > >> >> >> > # regression
>> >> >>>> >>> > >> >> >> > time <- 1:nlayers(s)
>> >> >>>> >>> > >> >> >> > fun <- function(x) { lm(x ~ time)$coefficients[2]
>> >> >>>> >>> > >> >> >> > }
>> >> >>>> >>> > >> >> >> > r[] <- apply(getValues(s), 1, fun)
>> >> >>>> >>> > >> >> >> >
>> >> >>>> >>> > >> >> >> > Robert
>> >> >>>> >>> > >> >> >> >
>> >> >>>> >>> > >> >> >> >
>> >> >>>> >>> > >> >> >> >
>> >> >>>> >>> > >> >> >> > On Fri, Nov 26, 2010 at 2:51 PM, Jacob van Etten
>> >> >>>> >>> > >> >> >> > <jacobvanetten at yahoo.com> wrote:
>> >> >>>> >>> > >> >> >> >> you could try this approach (use calc whenever
>> >> >>>> >>> > >> >> >> >> you
>> >> >>>> >>> > >> >> >> >> can):
>> >> >>>> >>> > >> >> >> >>
>> >> >>>> >>> > >> >> >> >> (supposing your bricks have 12 layers)
>> >> >>>> >>> > >> >> >> >>
>> >> >>>> >>> > >> >> >> >> br3 <- stack(brick1, brick2)
>> >> >>>> >>> > >> >> >> >> lmS <- function(x) lm(x[1:12] ~
>> >> >>>> >>> > >> >> >> >> x[13:24)$coefficients[2]
>> >> >>>> >>> > >> >> >> >> r <- calc(br3, lmS)
>> >> >>>> >>> > >> >> >> >>
>> >> >>>> >>> > >> >> >> >> Jacob.
>> >> >>>> >>> > >> >> >> >>
>> >> >>>> >>> > >> >> >> >> --- On Fri, 26/11/10, steven mosher
>> >> >>>> >>> > >> >> >> >> <moshersteven at gmail.com>
>> >> >>>> >>> > >> >> >> >> wrote:
>> >> >>>> >>> > >> >> >> >>
>> >> >>>> >>> > >> >> >> >> From: steven mosher <moshersteven at gmail.com>
>> >> >>>> >>> > >> >> >> >> Subject: Re: [R-sig-Geo] gridded time series
>> >> >>>> >>> > >> >> >> >> analysis
>> >> >>>> >>> > >> >> >> >> To: "Martin" <martin_brandt at gmx.net>
>> >> >>>> >>> > >> >> >> >> Cc: r-sig-geo at stat.math.ethz.ch
>> >> >>>> >>> > >> >> >> >> Date: Friday, 26 November, 2010, 23:33
>> >> >>>> >>> > >> >> >> >>
>> >> >>>> >>> > >> >> >> >> that's cool, I'm also interested in a similar
>> >> >>>> >>> > >> >> >> >> problem
>> >> >>>> >>> > >> >> >> >> but
>> >> >>>> >>> > >> >> >> >> just
>> >> >>>> >>> > >> >> >> >> with
>> >> >>>> >>> > >> >> >> >> one
>> >> >>>> >>> > >> >> >> >> brick ending up with a slope raster as the
>> >> >>>> >>> > >> >> >> >> output.
>> >> >>>> >>> > >> >> >> >> It
>> >> >>>> >>> > >> >> >> >> may be
>> >> >>>> >>> > >> >> >> >> possible
>> >> >>>> >>> > >> >> >> >> with
>> >> >>>> >>> > >> >> >> >> stackApply(). have a look. or maybe robert will
>> >> >>>> >>> > >> >> >> >> chime
>> >> >>>> >>> > >> >> >> >> in
>> >> >>>> >>> > >> >> >> >>
>> >> >>>> >>> > >> >> >> >>
>> >> >>>> >>> > >> >> >> >>
>> >> >>>> >>> > >> >> >> >> On Fri, Nov 26, 2010 at 1:35 PM, Martin
>> >> >>>> >>> > >> >> >> >> <martin_brandt at gmx.net
>> >> >>>> >>> > >
>> >> >>>> >>> > >> >> >> >> wrote:
>> >> >>>> >>> > >> >> >> >>
>> >> >>>> >>> > >> >> >> >>>
>> >> >>>> >>> > >> >> >> >>> this is what I did to perform a regression
>> >> >>>> >>> > >> >> >> >>> between
>> >> >>>> >>> > >> >> >> >>> two
>> >> >>>> >>> > >> >> >> >>> bricks
>> >> >>>> >>> > >> >> >> >>> (each
>> >> >>>> >>> > >> >> >> >>> brick
>> >> >>>> >>> > >> >> >> >>> represent a time series):
>> >> >>>> >>> > >> >> >> >>>
>> >> >>>> >>> > >> >> >> >>> r <- raster(brick1)
>> >> >>>> >>> > >> >> >> >>> for (i in 1:ncell(r)) {
>> >> >>>> >>> > >> >> >> >>> r[i] = lm(as.ts(cellValues(brick1, i)) ~
>> >> >>>> >>> > >> >> >> >>> as.ts(cellValues(brick2,
>> >> >>>> >>> > >> >> >> >>> i)))$coefficients[2]
>> >> >>>> >>> > >> >> >> >>> }
>> >> >>>> >>> > >> >> >> >>>
>> >> >>>> >>> > >> >> >> >>> The result will be a slope raster, but it
>> >> >>>> >>> > >> >> >> >>> really
>> >> >>>> >>> > >> >> >> >>> takes a
>> >> >>>> >>> > >> >> >> >>> lot
>> >> >>>> >>> > of
>> >> >>>> >>> > >> >> >> >>> time,
>> >> >>>> >>> > >> >> >> >>> so
>> >> >>>> >>> > >> >> >> >>> maybe there is a better solution..
>> >> >>>> >>> > >> >> >> >>>
>> >> >>>> >>> > >> >> >> >>>
>> >> >>>> >>> > >> >> >> >>> --
>> >> >>>> >>> > >> >> >> >>> View this message in context:
>> >> >>>> >>> > >> >> >> >>>
>> >> >>>> >>> > >> >> >> >>>
>> >> >>>> >>> > >> >> >> >>>
>> >> >>>> >>> > >> >> >> >>>
>> >> >>>> >>> >
>> >> >>>> >>> >
>> >> >>>> >>> >
>> >> >>>> >>> >
>> >> >>>> >>> > http://r-sig-geo.2731867.n2.nabble.com/gridded-time-series-analysis-tp5775651p5778472.html
>> >> >>>> >>> > >> >> >> >>> Sent from the R-sig-geo mailing list archive at
>> >> >>>> >>> > >> >> >> >>> Nabble.com.
>> >> >>>> >>> > >> >> >> >>>
>> >> >>>> >>> > >> >> >> >>> _______________________________________________
>> >> >>>> >>> > >> >> >> >>> R-sig-Geo mailing list
>> >> >>>> >>> > >> >> >> >>> R-sig-Geo at stat.math.ethz.ch
>> >> >>>> >>> > >> >> >> >>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> >> >>>> >>> > >> >> >> >>>
>> >> >>>> >>> > >> >> >> >>
>> >> >>>> >>> > >> >> >> >> ? ? [[alternative HTML version deleted]]
>> >> >>>> >>> > >> >> >> >>
>> >> >>>> >>> > >> >> >> >> _______________________________________________
>> >> >>>> >>> > >> >> >> >> R-sig-Geo mailing list
>> >> >>>> >>> > >> >> >> >> R-sig-Geo at stat.math.ethz.ch
>> >> >>>> >>> > >> >> >> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> >> >>>> >>> > >> >> >> >>
>> >> >>>> >>> > >> >> >> >>
>> >> >>>> >>> > >> >> >> >>
>> >> >>>> >>> > >> >> >> >>
>> >> >>>> >>> > >> >> >> >> ? ? ? ?[[alternative HTML version deleted]]
>> >> >>>> >>> > >> >> >> >>
>> >> >>>> >>> > >> >> >> >>
>> >> >>>> >>> > >> >> >> >> _______________________________________________
>> >> >>>> >>> > >> >> >> >> R-sig-Geo mailing list
>> >> >>>> >>> > >> >> >> >> R-sig-Geo at stat.math.ethz.ch
>> >> >>>> >>> > >> >> >> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> >> >>>> >>> > >> >> >> >>
>> >> >>>> >>> > >> >> >> >>
>> >> >>>> >>> > >> >> >> >
>> >> >>>> >>> > >> >> >>
>> >> >>>> >>> > >> >> >> _______________________________________________
>> >> >>>> >>> > >> >> >> R-sig-Geo mailing list
>> >> >>>> >>> > >> >> >> R-sig-Geo at stat.math.ethz.ch
>> >> >>>> >>> > >> >> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> >> >>>> >>> > >> >> >
>> >> >>>> >>> > >> >> >
>> >> >>>> >>> > >> >> >
>> >> >>>> >>> > >> >> > --
>> >> >>>> >>> > >> >> > advait godbole
>> >> >>>> >>> > >> >> >
>> >> >>>> >>> > >> >
>> >> >>>> >>> > >> >
>> >> >>>> >>> > >> >
>> >> >>>> >>> > >> > --
>> >> >>>> >>> > >> > advait godbole
>> >> >>>> >>> > >> >
>> >> >>>> >>> > >
>> >> >>>> >>> > >
>> >> >>>> >>> > >
>> >> >>>> >>> > > --
>> >> >>>> >>> > > advait godbole
>> >> >>>> >>> > >
>> >> >>>> >>> >
>> >> >>>> >>>
>> >> >>>> >>>
>> >> >>>> >>>
>> >> >>>> >>> --
>> >> >>>> >>> advait godbole
>> >> >>>> >>>
>> >> >>>> >>> ? ? ? ?[[alternative HTML version deleted]]
>> >> >>>> >>>
>> >> >>>> >>> _______________________________________________
>> >> >>>> >>> R-sig-Geo mailing list
>> >> >>>> >>> R-sig-Geo at r-project.org
>> >> >>>> >>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> >> >>>> >>
>> >> >>>> >>
>> >> >>>> >
>> >> >>>
>> >> >>>
>> >> >>>
>> >> >>> --
>> >> >>> advait godbole
>> >> >>
>> >> >>
>> >> >>
>> >> >> --
>> >> >> advait godbole
>> >> >
>> >> >
>> >
>> >
>> >
>> > --
>> > advait godbole
>> >
>
>
>
> --
> advait godbole
>


From v8extra at gmail.com  Mon Dec  6 02:13:41 2010
From: v8extra at gmail.com (=?iso-8859-1?Q?S=E9bastien_Durand?=)
Date: Sun, 5 Dec 2010 20:13:41 -0500
Subject: [R-sig-Geo] Polygon edge smoothing
Message-ID: <38944653-3DFC-47A5-8354-898358F999C3@gmail.com>

Hello to all,

Is there an elegent way or an already exisiting function that would allow to smooth out the edge of a polygons (an object of class SpatialPolygons "SP") 

In my case I have a polygon edge made out of stair cases...  so if would appear much better smoothed...

Thanks to all.

S.

From horning at amnh.org  Mon Dec  6 02:18:14 2010
From: horning at amnh.org (Ned Horning)
Date: Sun, 05 Dec 2010 20:18:14 -0500
Subject: [R-sig-Geo] satellite imagery
In-Reply-To: <4CFAEFEB.6090808@berkeley.edu>
References: <4CFAEFEB.6090808@berkeley.edu>
Message-ID: <4CFC39D6.2040000@amnh.org>

Hi Nick,

The Raster package has been my key to working with images in R. 
Leveraging the Raster package you can use just about any classification 
engine or statistics queries you want. I've been quite impress with the 
RandomForest package (among others) for image classification. I'm happy 
to share the script I use and a guide with instructions if you're 
interested.

All the best,

Ned

On 12/04/2010 08:50 PM, Nick Matzke wrote:
> Hi all,
>
> I would like to do some somewhat simple satellite image analysis, 
> ideally with an R package.  Basically, I need to:
>
> * load a .img file (a subset of a 6-channel Landsat image)
> * classify the pixels
> * extract some statistics
>
> Is there an R package people would recommend for this kind of thing?
>
> I'm working with macs, basically, I know some of the free GIS stuff is 
> windows-based...
>
> Any advice appreciated.  Cheers!
> Nick
>
>


From v8extra at gmail.com  Mon Dec  6 02:55:22 2010
From: v8extra at gmail.com (=?iso-8859-1?Q?S=E9bastien_Durand?=)
Date: Sun, 5 Dec 2010 20:55:22 -0500
Subject: [R-sig-Geo]  Polygon edge smoothing
Message-ID: <D67111C4-6C94-4A1D-B9E5-7AC536C95663@gmail.com>

Here is what I found as a temporary solution:

Here is my example: 


library(akima)
library(maptools)
library(zoo)
gpclibPermit()
library(raster)
data(akima)

# define de dimension of grid
dimgrid <- 50

# Interpolate to regular grid
ak.li <- interp(akima$x, akima$y, akima$z, xo=seq(min(akima$x),
max(akima$x), length = dimgrid),yo=seq(min(akima$y), max(akima$y),
length = dimgrid),linear = TRUE, extrap=FALSE, duplicate = "mean")

# Show interpolation
image(ak.li)
points(akima)
with(akima, text(x, y, formatC(z,dig=2), adj = -0.1))

r <- raster(ak.li)
plot(r)

pol <- rasterToPolygons(r, fun=function(x){x>20 & x<25})

# Show the polygons
plot(pol, add=T, col='red')

### new code
digits <- 6
for (i in 1:length(pol at polygons)) {
	for (j in 1:length(pol at polygons[[i]]@Polygons)) {
			pol at polygons[[i]]@Polygons[[j]]@coords <-
			round(pol at polygons[[i]]@Polygons[[j]]@coords, digits)
	}
}


# Attempt to merge similar adjacent into one polygon
union = unionSpatialPolygons(pol, ID=rep(1, times=length(pol at polygons)))

# Show
plot(union, add=TRUE, col="white")

# Nombre de vertices
crds=union at polygons[[1]]@Polygons[[1]]@coords
tmp=length(crds[,1])

nexCoordX= rollmean(c(crds[tmp,1], crds[,1], crds[1,1]), k=2)
nexCoordY= rollmean(c(crds[tmp,2], crds[,2], crds[1,2]), k=2)
lines(nexCoordX, nexCoordY, col="yellow", lwd=2)


If you have any knowledge of a function that would do something similar, I would be happy to ear about it!

Thanks a lot!

S?bastien

From zou.mono at gmail.com  Mon Dec  6 03:37:39 2010
From: zou.mono at gmail.com (=?gb2312?B?1966o8/o?=)
Date: Mon, 6 Dec 2010 10:37:39 +0800
Subject: [R-sig-Geo] Spatial-temporal variogram and covariance models
Message-ID: <201012061037336564654@gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101206/60879eb8/attachment.pl>

From pierre.roudier at gmail.com  Mon Dec  6 03:41:08 2010
From: pierre.roudier at gmail.com (Pierre Roudier)
Date: Mon, 6 Dec 2010 15:41:08 +1300
Subject: [R-sig-Geo] Parallelized kriging in R (gstat/intamap)
Message-ID: <AANLkTi=ZckG1EHGQhcrYYcea5BJQcgST_DbC3SWeuoyG@mail.gmail.com>

Dear list,

I've been wanting to parallelize kriging using R - on a cluster.

I am not aware of any parallelized method in gstat (which I'm an avid
and happy user), and I'm just discovering the intamap package (which
looks awesome) which seems to have that sort of capability (using the
nclus parameter). However, I don't really get how to use it.

Any pointers?

Cheers,

Pierre

.


From kji2080 at gmail.com  Mon Dec  6 03:53:48 2010
From: kji2080 at gmail.com (Jooil Kim)
Date: Mon, 6 Dec 2010 11:53:48 +0900
Subject: [R-sig-Geo] Strategies for modifying country-specific grids from a
 global gridded dataset in simple matrix form?
Message-ID: <AANLkTinDNeLAzbPCV8AHrwKseVeUmwN_fBynXtwk84qV@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101206/e76abc0a/attachment.pl>

From pierre.roudier at gmail.com  Mon Dec  6 07:00:45 2010
From: pierre.roudier at gmail.com (Pierre Roudier)
Date: Mon, 6 Dec 2010 19:00:45 +1300
Subject: [R-sig-Geo] Polygon edge smoothing
In-Reply-To: <D67111C4-6C94-4A1D-B9E5-7AC536C95663@gmail.com>
References: <D67111C4-6C94-4A1D-B9E5-7AC536C95663@gmail.com>
Message-ID: <AANLkTi=mY-J-NtmmtnyaOs9YE47W+pjPY_1e=O=swZpL@mail.gmail.com>

Hi S?bastien,

Maybe you should have a look to the rgeos package. It offers bindings
for the GEOS C++ lib. Note that unlike the gpclib, it is really
open-source (beware of the gpclib licence terms - they are very
restricted). However, it is not (AFAIK) on CRAN yet. You have to
install it from r-forge:

install.packages("rgeos", repos="http://R-Forge.R-project.org")

The function you want is probably gSimplify(). I never used that
functionality so I unfortunately can't help you more on that!

HTH,

Pierre

2010/12/6 S?bastien Durand <v8extra at gmail.com>:
> Here is what I found as a temporary solution:
>
> Here is my example:
>
>
> library(akima)
> library(maptools)
> library(zoo)
> gpclibPermit()
> library(raster)
> data(akima)
>
> # define de dimension of grid
> dimgrid <- 50
>
> # Interpolate to regular grid
> ak.li <- interp(akima$x, akima$y, akima$z, xo=seq(min(akima$x),
> max(akima$x), length = dimgrid),yo=seq(min(akima$y), max(akima$y),
> length = dimgrid),linear = TRUE, extrap=FALSE, duplicate = "mean")
>
> # Show interpolation
> image(ak.li)
> points(akima)
> with(akima, text(x, y, formatC(z,dig=2), adj = -0.1))
>
> r <- raster(ak.li)
> plot(r)
>
> pol <- rasterToPolygons(r, fun=function(x){x>20 & x<25})
>
> # Show the polygons
> plot(pol, add=T, col='red')
>
> ### new code
> digits <- 6
> for (i in 1:length(pol at polygons)) {
> ? ? ? ?for (j in 1:length(pol at polygons[[i]]@Polygons)) {
> ? ? ? ? ? ? ? ? ? ? ? ?pol at polygons[[i]]@Polygons[[j]]@coords <-
> ? ? ? ? ? ? ? ? ? ? ? ?round(pol at polygons[[i]]@Polygons[[j]]@coords, digits)
> ? ? ? ?}
> }
>
>
> # Attempt to merge similar adjacent into one polygon
> union = unionSpatialPolygons(pol, ID=rep(1, times=length(pol at polygons)))
>
> # Show
> plot(union, add=TRUE, col="white")
>
> # Nombre de vertices
> crds=union at polygons[[1]]@Polygons[[1]]@coords
> tmp=length(crds[,1])
>
> nexCoordX= rollmean(c(crds[tmp,1], crds[,1], crds[1,1]), k=2)
> nexCoordY= rollmean(c(crds[tmp,2], crds[,2], crds[1,2]), k=2)
> lines(nexCoordX, nexCoordY, col="yellow", lwd=2)
>
>
> If you have any knowledge of a function that would do something similar, I would be happy to ear about it!
>
> Thanks a lot!
>
> S?bastien
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From villers.alexandre at gmail.com  Mon Dec  6 07:42:11 2010
From: villers.alexandre at gmail.com (Alexandre Villers)
Date: Mon, 06 Dec 2010 08:42:11 +0200
Subject: [R-sig-Geo] Polygon edge smoothing
In-Reply-To: <D67111C4-6C94-4A1D-B9E5-7AC536C95663@gmail.com>
References: <D67111C4-6C94-4A1D-B9E5-7AC536C95663@gmail.com>
Message-ID: <4CFC85C3.7050401@gmail.com>

Le 06/12/2010 03:55, S?bastien Durand a ?crit :
> Here is what I found as a temporary solution:
>
> Here is my example:
>
>
> library(akima)
> library(maptools)
> library(zoo)
> gpclibPermit()
> library(raster)
> data(akima)
>
> # define de dimension of grid
> dimgrid<- 50
>
> # Interpolate to regular grid
> ak.li<- interp(akima$x, akima$y, akima$z, xo=seq(min(akima$x),
> max(akima$x), length = dimgrid),yo=seq(min(akima$y), max(akima$y),
> length = dimgrid),linear = TRUE, extrap=FALSE, duplicate = "mean")
>
> # Show interpolation
> image(ak.li)
> points(akima)
> with(akima, text(x, y, formatC(z,dig=2), adj = -0.1))
>
> r<- raster(ak.li)
> plot(r)
>
> pol<- rasterToPolygons(r, fun=function(x){x>20&  x<25})
>
> # Show the polygons
> plot(pol, add=T, col='red')
>
> ### new code
> digits<- 6
> for (i in 1:length(pol at polygons)) {
> 	for (j in 1:length(pol at polygons[[i]]@Polygons)) {
> 			pol at polygons[[i]]@Polygons[[j]]@coords<-
> 			round(pol at polygons[[i]]@Polygons[[j]]@coords, digits)
> 	}
> }
>
>
> # Attempt to merge similar adjacent into one polygon
> union = unionSpatialPolygons(pol, ID=rep(1, times=length(pol at polygons)))
>
> # Show
> plot(union, add=TRUE, col="white")
>
> # Nombre de vertices
> crds=union at polygons[[1]]@Polygons[[1]]@coords
> tmp=length(crds[,1])
>
> nexCoordX= rollmean(c(crds[tmp,1], crds[,1], crds[1,1]), k=2)
> nexCoordY= rollmean(c(crds[tmp,2], crds[,2], crds[1,2]), k=2)
> lines(nexCoordX, nexCoordY, col="yellow", lwd=2)
>
>
> If you have any knowledge of a function that would do something similar, I would be happy to ear about it!
>
> Thanks a lot!
>
> S?bastien
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>    
Hey,

Hey,

You can also have a look at the spatstat package and the simplify.owin() 
function. Maptools package provides function to convert objects between 
sp and spatstat formats.
HTH

Alex

-- 
Alexandre Villers, PhD.
Postdoc researcher
Spatial Ecology & Population Dynamics
Section of Ecology, Department of Biology
University of Turku
FIN-20014 Turku
Finland

@mail: alexandre.villers at utu.fi
phone: 00358 (0)2 333 5039

Skype You can skype me (but think of using Ekiga instead !) 
<skype:aquila06?call>


*Use open source and free softwares*
<http://cran.r-project.org/> <http://grass.itc.it/> 
<http://www.qgis.org/> <http://fr.openoffice.org/> 
<http://www.mozilla-europe.org/fr/> <http://www.mozilla-europe.org/fr/>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101206/4b802d57/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Rlogo.jpg
Type: image/jpeg
Size: 1753 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101206/4b802d57/attachment.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: GRASSlogo.png
Type: image/png
Size: 3277 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101206/4b802d57/attachment.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: QGIS.png
Type: image/png
Size: 4144 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101206/4b802d57/attachment-0001.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: OOlogo.gif
Type: image/gif
Size: 4246 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101206/4b802d57/attachment.gif>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: TBlogo.jpg
Type: image/jpeg
Size: 1385 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101206/4b802d57/attachment-0001.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: FFlogo.jpg
Type: image/jpeg
Size: 1686 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101206/4b802d57/attachment-0002.jpg>

From jon.skoien at jrc.ec.europa.eu  Mon Dec  6 11:31:14 2010
From: jon.skoien at jrc.ec.europa.eu (Jon Olav Skoien)
Date: Mon, 06 Dec 2010 11:31:14 +0100
Subject: [R-sig-Geo] Parallelized kriging in R (gstat/intamap)
In-Reply-To: <AANLkTi=ZckG1EHGQhcrYYcea5BJQcgST_DbC3SWeuoyG@mail.gmail.com>
References: <AANLkTi=ZckG1EHGQhcrYYcea5BJQcgST_DbC3SWeuoyG@mail.gmail.com>
Message-ID: <4CFCBB72.3050303@jrc.ec.europa.eu>

Pierre,

There are different ways to call the kriging routines in intamap. The 
simplest is to call interpolate with the necessary data. To see the 
effect of parallelization, you can look at the example below. This uses 
the zinc observations of the Meuse data set, interpolates to 100000 
points on a grid using automap (which uses gstat for fitting and 
interpolation). The speed up effect from parallelization depends on the 
problem, my computer spends half the time using 4 clusters instead of 1 
on the example below.


loadMeuse()
meusegrid = spsample(meuse, 100000, "regular")
system.time(x <- interpolate(meuse, meusegrid, list(mean=TRUE, 
variance=TRUE),
     optList = list(formulaString = zinc~1, nclus = 1), methodName = 
"automap"))

system.time(x <- interpolate(meuse, meusegrid, list(mean=TRUE, 
variance=TRUE),
     optList = list(formulaString = zinc~1, nclus = 4), methodName = 
"automap"))

If you have more specific questions about the use, I will try to answer 
them.

Cheers,
Jon


On 12/6/2010 3:41 AM, Pierre Roudier wrote:
> Dear list,
>
> I've been wanting to parallelize kriging using R - on a cluster.
>
> I am not aware of any parallelized method in gstat (which I'm an avid
> and happy user), and I'm just discovering the intamap package (which
> looks awesome) which seems to have that sort of capability (using the
> nclus parameter). However, I don't really get how to use it.
>
> Any pointers?
>
> Cheers,
>
> Pierre
>
> .
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From edzer.pebesma at uni-muenster.de  Mon Dec  6 11:41:09 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Mon, 06 Dec 2010 11:41:09 +0100
Subject: [R-sig-Geo] Parallelized kriging in R (gstat/intamap)
In-Reply-To: <AANLkTi=ZckG1EHGQhcrYYcea5BJQcgST_DbC3SWeuoyG@mail.gmail.com>
References: <AANLkTi=ZckG1EHGQhcrYYcea5BJQcgST_DbC3SWeuoyG@mail.gmail.com>
Message-ID: <4CFCBDC5.9070002@uni-muenster.de>

The documentation for package intamap suggest that you first download
and load package doSNOW from CRAN, and then pass the nclus parameter
with a number larger than 1, as argument:

interpolate(..., optList=list(nclus=2))

Looking at the code, it tries to set up nodes on localhost, so for
distributing load over a cluster composed of different machines, you (or
we) would have to modify the code.

Package gstat has a demo script, demo(snow), that shows how to
distribute predictions over multiple hosts.

On 12/06/2010 03:41 AM, Pierre Roudier wrote:
> Dear list,
> 
> I've been wanting to parallelize kriging using R - on a cluster.
> 
> I am not aware of any parallelized method in gstat (which I'm an avid
> and happy user), and I'm just discovering the intamap package (which
> looks awesome) which seems to have that sort of capability (using the
> nclus parameter). However, I don't really get how to use it.
> 
> Any pointers?
> 
> Cheers,
> 
> Pierre
> 
> .
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From jgarcia at ija.csic.es  Mon Dec  6 11:59:53 2010
From: jgarcia at ija.csic.es (jgarcia at ija.csic.es)
Date: Mon, 6 Dec 2010 11:59:53 +0100 (CET)
Subject: [R-sig-Geo] satellite imagery
In-Reply-To: <4CFC39D6.2040000@amnh.org>
References: <4CFAEFEB.6090808@berkeley.edu> <4CFC39D6.2040000@amnh.org>
Message-ID: <52813.78.147.235.120.1291633193.squirrel@paleo.ija.csic.es>

Hi Ned,
I'm an a quite similar situation than Ned's, regarding Landsat. Could you
spare this script? It seems likely that it will illustrative about this.
Thanks in advance,
Javier
---
> Hi Nick,
>
> The Raster package has been my key to working with images in R.
> Leveraging the Raster package you can use just about any classification
> engine or statistics queries you want. I've been quite impress with the
> RandomForest package (among others) for image classification. I'm happy
> to share the script I use and a guide with instructions if you're
> interested.
>
> All the best,
>
> Ned
>
> On 12/04/2010 08:50 PM, Nick Matzke wrote:
>> Hi all,
>>
>> I would like to do some somewhat simple satellite image analysis,
>> ideally with an R package.  Basically, I need to:
>>
>> * load a .img file (a subset of a 6-channel Landsat image)
>> * classify the pixels
>> * extract some statistics
>>
>> Is there an R package people would recommend for this kind of thing?
>>
>> I'm working with macs, basically, I know some of the free GIS stuff is
>> windows-based...
>>
>> Any advice appreciated.  Cheers!
>> Nick
>>
>>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From tewksjj at gmail.com  Mon Dec  6 14:41:07 2010
From: tewksjj at gmail.com (Josh Tewksbury)
Date: Mon, 6 Dec 2010 05:41:07 -0800
Subject: [R-sig-Geo] looking up country names from lat long
Message-ID: <AANLkTinpSKz0BwrEjoVKQk7oFAcFEPfDaYm6KowQwYxf@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101206/f8f4cee1/attachment.pl>

From paulojus at c3sl.ufpr.br  Mon Dec  6 15:08:44 2010
From: paulojus at c3sl.ufpr.br (Paulo Justiniano Ribeiro Jr)
Date: Mon, 6 Dec 2010 12:08:44 -0200 (BRST)
Subject: [R-sig-Geo] Spatial-temporal variogram and covariance models
In-Reply-To: <201012061037336564654@gmail.com>
References: <201012061037336564654@gmail.com>
Message-ID: <alpine.DEB.2.00.1012061208080.19852@macalan.c3sl.ufpr.br>

Package RandomFields implements procedures based on spatial-temporal 
covariance models

Paulo Justiniano Ribeiro Jr
LEG (Laboratorio de Estatistica e Geoinformacao)
Universidade Federal do Parana
Caixa Postal 19.081
CEP 81.531-990
Curitiba, PR  -  Brasil
Tel: (+55) 41 3361 3573
VOIP: (+55) (41) (3361 3600) 1053 1066
Fax: (+55) 41 3361 3141
e-mail: paulojus AT  ufpr  br
http://www.leg.ufpr.br/~paulojus

On Mon, 6 Dec 2010, ??? wrote:

> Dear Researchers,
>
>   As far as I know, spatial-temporal variogram and covariance models are hot research fields in statistics for spatial data. For example, Cesare et.al achieved many programs about them in FORTRAN (FORTRAN programs for space-time
> modeling (2002), Computers & Geosciences, vol.28, pp.205-212). But I am not familiar with FORTRAN. Now I'm wondering are there packages in R that can achieve them?
>
>    Thanks for help!
>
> 2010-12-06
>
>
>
> Zou haixiang, Ph.D student
> School of Remote Sensing and Information Engineering,Wuhan University
> Transportation Research Center(TRC),Wuhan University
> E-mail:zou.mono at gmail.com
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From b.rowlingson at lancaster.ac.uk  Mon Dec  6 15:19:27 2010
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Mon, 6 Dec 2010 14:19:27 +0000
Subject: [R-sig-Geo] looking up country names from lat long
In-Reply-To: <AANLkTinpSKz0BwrEjoVKQk7oFAcFEPfDaYm6KowQwYxf@mail.gmail.com>
References: <AANLkTinpSKz0BwrEjoVKQk7oFAcFEPfDaYm6KowQwYxf@mail.gmail.com>
Message-ID: <AANLkTinNVs8Fjzh2KOsMcnE+J_dq4kYDZX=E_ohWiRNH@mail.gmail.com>

On Mon, Dec 6, 2010 at 1:41 PM, Josh Tewksbury <tewksjj at gmail.com> wrote:
> Hello - here is what I am sure is a quick question from someone new to R in
> spatial stats. I have a long list of lat long coordinates and I would like
> to do a location country check to extrapolate a country name from each
> lat/long point.
>
> so, for example, my data look like
>
> lat, long
> 14.42, -89.92
> 14.42, -89.75
> 14.42, -89.58
> 14.42, -89.42
> 14.42, -89.25
>
> continued for the terrestrial surface of the earth.
>
> If I want to add country names, so I can use those names as tags to merge in
> other data, is there an easy lookup that will allow me to do that, so I end
> up with:
>
> lat, long, country
> 14.42, -89.92, Guatemala
> 14.42, -89.75, Guatemala
> 14.42, -89.58, Guatemala
> 14.42, -89.42, El Salvador
> 14.42, -89.25, Honduras

 My 'geonames' package (on CRAN) can do lookups via the geonames.org
web service:

> GNcountryCode(lat=14.24,lng=-89.92)
$distance
[1] 0

$countryName
[1] "Guatemala"

$countryCode
[1] "GT"

 its being very slow at the moment though. You might have speedier responses.

 It can only look up one at a time, so you'll have to loop through
your data frame with the usual R loop/apply-type patterns.

Barry


From isabelle.boulangeat at gmail.com  Mon Dec  6 16:47:19 2010
From: isabelle.boulangeat at gmail.com (isabelle boulangeat)
Date: Mon, 6 Dec 2010 16:47:19 +0100
Subject: [R-sig-Geo] new function predict, package raster
In-Reply-To: <AANLkTinLzNRz2CocwHbZ3xyWgMg_zhCSpozJhZXD=99O@mail.gmail.com>
References: <AANLkTikU1d4LrvtOCsVUb3FOVWV+NMcL2cpjvC8Bw8OC@mail.gmail.com>
	<AANLkTim4_1NH-sJE1OkUAgari22wy1_V=AHf8F5MB3v=@mail.gmail.com>
	<AANLkTi=ez4w1dnc3kM00jTL482JAy1MQtyAkhpPBR+dn@mail.gmail.com>
	<AANLkTinLzNRz2CocwHbZ3xyWgMg_zhCSpozJhZXD=99O@mail.gmail.com>
Message-ID: <AANLkTim7K-m6Ebv2_rrv9CBx2uHxOAFGT4MtZ0YLR+7q@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101206/1df4acf2/attachment.pl>

From advaitgodbole at gmail.com  Mon Dec  6 17:30:06 2010
From: advaitgodbole at gmail.com (Advait Godbole)
Date: Mon, 6 Dec 2010 11:30:06 -0500
Subject: [R-sig-Geo] gridded time series analysis
In-Reply-To: <AANLkTims2FyRBiLdmtZzR8wwvrBSyMuepVe0_Li-B6nU@mail.gmail.com>
References: <AANLkTimTdxzoDCfJQOB8bgQRhjLy3YzSbtGtMdijk9sQ@mail.gmail.com>
	<771411.8321.qm@web29709.mail.ird.yahoo.com>
	<AANLkTin2DYocWNOAR-LfGoBP4+gCtA7eVDHmoaQ6wriR@mail.gmail.com>
	<AANLkTimFw1zMH75s+TG+SFkBHfXzpURm2WXskAa8Kp=m@mail.gmail.com>
	<AANLkTim9dBnVkZ0tjvoa1YRpPRr156jJ9zcezMDrtzhX@mail.gmail.com>
	<AANLkTi=vW6NXYXKGNa0gcTfZ8ezEjvegdxU3Dt5SPA4F@mail.gmail.com>
	<AANLkTikqNmC62Pv-n9Dxd1w7fTHJPx8cR72U6YEtWMTV@mail.gmail.com>
	<AANLkTikQsL9opzu1i0mWxtJA6YmcgBbGdbihXFOwPRho@mail.gmail.com>
	<AANLkTinY5+3JbpZfWnriDZNOdmcfic0628Qi0=NDZghK@mail.gmail.com>
	<AANLkTikd-PJKWZdWUL2+S9VYAq1QJ4LPwG2==erEs2+Q@mail.gmail.com>
	<AANLkTi=eZL0Rq5EyoRA29fdnN2VL-Xt6hcGN4DnZgCKk@mail.gmail.com>
	<AANLkTikVto4GD=vO=5YKwKXL7y+Ze4ADn2KXpsw1AFVA@mail.gmail.com>
	<AANLkTinUvhmDLP2YSWuqb5=G0YKX=sWp6yMOj9KPAgdA@mail.gmail.com>
	<AANLkTi=P5HNFjEsaapUBF7vSAFAsekU_4bYJqXnW=gbu@mail.gmail.com>
	<AANLkTikwWainpBBeSr8xnNNq8uoFXdU2n_34y2-u6K5J@mail.gmail.com>
	<AANLkTin5-hV=b8yxQnvviF_4w-uPfsSJ9X82pmbi=WQo@mail.gmail.com>
	<AANLkTikmPMvBRuu6RvjXsd8LdJc38FP+tAiF9iAc31Ks@mail.gmail.com>
	<AANLkTikSowU_SFiCmZyE3TKEa_UesH_SDQdPP63i+ERY@mail.gmail.com>
	<AANLkTi=p+LbmQ96GSJFuYyw-HLcCxJgYqaK4n2pBZcbG@mail.gmail.com>
	<AANLkTinvp-k47MHyV2s+hje_P0VXHvTmOKPFf8q5btAO@mail.gmail.com>
	<AANLkTi=S8tY50xzS2PFS7LvUEMT4cb4TFME-kT7DkmS0@mail.gmail.com>
	<AANLkTims2FyRBiLdmtZzR8wwvrBSyMuepVe0_Li-B6nU@mail.gmail.com>
Message-ID: <AANLkTinzLPLDhoLwpcRkJ4twJ+FFd=ukOYpHh220S2mE@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101206/593b4167/attachment.pl>

From jeremy.raw at dot.gov  Mon Dec  6 17:49:21 2010
From: jeremy.raw at dot.gov (jeremy.raw at dot.gov)
Date: Mon, 6 Dec 2010 11:49:21 -0500
Subject: [R-sig-Geo] Building a graph/network matrix
In-Reply-To: <396712.76215.qm@web24612.mail.ird.yahoo.com>
References: <396712.76215.qm@web24612.mail.ird.yahoo.com>
Message-ID: <B3C9A56C0E6FBF48A7D3ED79E9A7A9C003C08F70@OSTMAIL03VS3.ad.dot.gov>

See details below ====

-----Original Message-----
From: r-sig-geo-bounces at r-project.org
[mailto:r-sig-geo-bounces at r-project.org] On Behalf Of Sadz A
Sent: Friday, December 03, 2010 3:52 PM
To: r-sig-geo at r-project.org
Subject: [R-sig-Geo] Building a graph/network matrix

I have some networks in GIS shape file (vector) format, the data I have
are road 
maps that I digitised from satellite images in ArcGIS. (I can change
them to 
raster or Ascii), is there a way to convert them into matrix that can be
loaded 
and analysed with igraph in R?

==== Details Follow

I think the only difficult part in your project will be identifying the
appropriate points in your input files -- my experience with digitized
maps is that line segments don't always end at logical places,
particularly when you're interested in right angle turns on a single
otherwise continuous segment.  It would probably make sense to spend
some time simplifying the network before launching into igraph-type
analysis.

It's also desirable to have "single part" features (so you don't have
one feature with spatially disjoint parts); that's not often an issue
with digitized maps, however. Assuming you can break up the features at
the necessary places (so all the points you are interested in occur at
the "ends" of features), you can easily create a list of edges which can
then be loaded into igraph.

Here are some hints about steps you can take in that direction:

The goal for getting this into igraph is to make an edgelist (which is,
not coincidentally, equally suitable for building a sparse matrix
showing which nodes are connected).

Read the shapefile into R using rgdal or maptools.  That will give you a
spatial object (specifically a SpatialLinesDataFrame) with a list of
features from which you can extract coordinates.  I'll call that
"my.network" in the code fragment below.

Here are a few lines of code that illustrate the rest of the procedure
(note that this presumes you have simple features, with a single
connected set of vertices for each feature as noted above):

# First build a data.frame of network segment end point coordinates
# That first line is the hardest part, and there may be a much easier
way to do it (e.g. in ArcGIS if you have
# access to that; but it's nice to have a 'pure R' solution...)

c<-t(sapply(unlist(coordinates(my.network),recursive=FALSE),FUN=function
(x) cbind(x[1,],x[nrow(x),])))
c<-as.data.frame(c)
names(c)<-c("From.x","From.y","To.x","To.y")

# Then complete the vertex table

n2 <- cbind(my.network,c)
v<-unique(rbind(
data.frame(X=n2$From.x,Y=n2$From.y),data.frame(X=n2$To.x,Y=n2$To.y)))
v$ID <- 1:nrow(v)

# Then match back to the original network coordinates to assign vertex
IDs to each feature end point

n3<-merge(n2,data.frame(From=v$ID,From.x=v$X,From.y=v$Y),by=c("From.x","
From.y"))
n4<-merge(n3,data.frame(To=v$ID,To.x=v$X,To.y=v$Y),by=c("To.x","To.y"))

# Then make an igraph
# remember igraph indices are 0-based (although if you don't, you'll
just end up with one unconnected vertex labeled 0)

library(igraph)
edge.list <-
cbind(n4[,c("From","To")],n4[,grep("^(From|To)$",names(n4),invert=TRUE)]
)
edge.list$From <- edgelist$From-1    # 0-based conversion
edge.list$To <- edgelist$To-1
g <- graph.data.frame(edge.list,directed=FALSE) # All the shapefile
attributes are now edge attributes

# At this point, you can take your questions back to the igraph list :-)

# Alternatively, make a sparse matrix showing which vertices are
directly connected
# Warning: N^2 matrix where N is the number of vertices in the network,
so sparseMatrix is your friend
# Also, this code assumes FID != 0 for any feature

library(Matrix)
m <- sparseMatrix( i=n4$From, j=n4$To, x=n4$FID )

I hope that helps!

Jeremy Raw, P.E., AICP
FHWA Office of Planning
jeremy.raw at dot.gov
(202) 366-0986


From f.veronesi at cranfield.ac.uk  Mon Dec  6 18:39:56 2010
From: f.veronesi at cranfield.ac.uk (Veronesi, Fabio)
Date: Mon, 6 Dec 2010 17:39:56 +0000
Subject: [R-sig-Geo] GSTAT: Zonal Anisotropy
Message-ID: <6E3C09D338C1BB46AD3778BB99012D6005EAE7955B@CCEXCHSTORE-2.central.cranfield.ac.uk>


Suppose I have a dataset with a zonal anisotropy, by which there are two variogram models for two different directions.
For assessing this anisotropy in GSTAT is it sufficient to use, in the kriging, a variogram model fitted with an alpha factor equal to the two directions?
Many thanks,
Fabio


Fabio Veronesi
Ph.D Student
Cranfield University


From edzer.pebesma at uni-muenster.de  Mon Dec  6 21:16:37 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Mon, 06 Dec 2010 21:16:37 +0100
Subject: [R-sig-Geo] GSTAT: Zonal Anisotropy
In-Reply-To: <6E3C09D338C1BB46AD3778BB99012D6005EAE7955B@CCEXCHSTORE-2.central.cranfield.ac.uk>
References: <6E3C09D338C1BB46AD3778BB99012D6005EAE7955B@CCEXCHSTORE-2.central.cranfield.ac.uk>
Message-ID: <4CFD44A5.3060809@uni-muenster.de>



On 12/06/2010 06:39 PM, Veronesi, Fabio wrote:
> 
> Suppose I have a dataset with a zonal anisotropy, by which there are two variogram models for two different directions.
> For assessing this anisotropy in GSTAT is it sufficient to use, in the kriging, a variogram model fitted with an alpha factor equal to the two directions?
> Many thanks,
> Fabio

Fabio, the alpha parameter value should be set to one of these two
directions, but the tol.hor parameter should be very small, close to
zero, to really obtain the information for this direction. This works,
in practice, only for regularly organized (e.g. gridded) data.

I would, in practice, always look at multiple directions to check
whether the data indeed reveal zonal anisotropy.

> 
> 
> Fabio Veronesi
> Ph.D Student
> Cranfield University
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From agnes.kaczmarczyk at gmail.com  Mon Dec  6 22:33:01 2010
From: agnes.kaczmarczyk at gmail.com (Agnieszka Kaczmarczyk)
Date: Mon, 6 Dec 2010 22:33:01 +0100
Subject: [R-sig-Geo] grids
Message-ID: <AANLkTikv419fXuEg2dRuaUPe4UECgCtwideB7u-sJuNK@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101206/b363ef07/attachment.pl>

From r.hijmans at gmail.com  Mon Dec  6 22:57:01 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Mon, 6 Dec 2010 13:57:01 -0800
Subject: [R-sig-Geo] gridded time series analysis
In-Reply-To: <AANLkTinzLPLDhoLwpcRkJ4twJ+FFd=ukOYpHh220S2mE@mail.gmail.com>
References: <AANLkTimTdxzoDCfJQOB8bgQRhjLy3YzSbtGtMdijk9sQ@mail.gmail.com>
	<771411.8321.qm@web29709.mail.ird.yahoo.com>
	<AANLkTin2DYocWNOAR-LfGoBP4+gCtA7eVDHmoaQ6wriR@mail.gmail.com>
	<AANLkTimFw1zMH75s+TG+SFkBHfXzpURm2WXskAa8Kp=m@mail.gmail.com>
	<AANLkTim9dBnVkZ0tjvoa1YRpPRr156jJ9zcezMDrtzhX@mail.gmail.com>
	<AANLkTi=vW6NXYXKGNa0gcTfZ8ezEjvegdxU3Dt5SPA4F@mail.gmail.com>
	<AANLkTikqNmC62Pv-n9Dxd1w7fTHJPx8cR72U6YEtWMTV@mail.gmail.com>
	<AANLkTikQsL9opzu1i0mWxtJA6YmcgBbGdbihXFOwPRho@mail.gmail.com>
	<AANLkTinY5+3JbpZfWnriDZNOdmcfic0628Qi0=NDZghK@mail.gmail.com>
	<AANLkTikd-PJKWZdWUL2+S9VYAq1QJ4LPwG2==erEs2+Q@mail.gmail.com>
	<AANLkTi=eZL0Rq5EyoRA29fdnN2VL-Xt6hcGN4DnZgCKk@mail.gmail.com>
	<AANLkTikVto4GD=vO=5YKwKXL7y+Ze4ADn2KXpsw1AFVA@mail.gmail.com>
	<AANLkTinUvhmDLP2YSWuqb5=G0YKX=sWp6yMOj9KPAgdA@mail.gmail.com>
	<AANLkTi=P5HNFjEsaapUBF7vSAFAsekU_4bYJqXnW=gbu@mail.gmail.com>
	<AANLkTikwWainpBBeSr8xnNNq8uoFXdU2n_34y2-u6K5J@mail.gmail.com>
	<AANLkTin5-hV=b8yxQnvviF_4w-uPfsSJ9X82pmbi=WQo@mail.gmail.com>
	<AANLkTikmPMvBRuu6RvjXsd8LdJc38FP+tAiF9iAc31Ks@mail.gmail.com>
	<AANLkTikSowU_SFiCmZyE3TKEa_UesH_SDQdPP63i+ERY@mail.gmail.com>
	<AANLkTi=p+LbmQ96GSJFuYyw-HLcCxJgYqaK4n2pBZcbG@mail.gmail.com>
	<AANLkTinvp-k47MHyV2s+hje_P0VXHvTmOKPFf8q5btAO@mail.gmail.com>
	<AANLkTi=S8tY50xzS2PFS7LvUEMT4cb4TFME-kT7DkmS0@mail.gmail.com>
	<AANLkTims2FyRBiLdmtZzR8wwvrBSyMuepVe0_Li-B6nU@mail.gmail.com>
	<AANLkTinzLPLDhoLwpcRkJ4twJ+FFd=ukOYpHh220S2mE@mail.gmail.com>
Message-ID: <AANLkTikmm6QvAC69cPG7i4bT6wmWVBfwpO-4mHZ7JEvL@mail.gmail.com>

Dear Advait,

> What I dont understand is:
> 1) How can each slope be the same (values of x1)

Apparently the values in these cells are all the same (not that you
only use the first 8 time steps, not all 120)

Here is an example with random values in which the slopes are all different

b <- brick(ncol=4, nrow=4, nl=120)
b <- setValues(b, matrix(runif(prod(dim(b))), ncol=120))
fun = function(x) { if(is.na(x[1])) { NA } else { lm(x[1:60] ~
x[61:120])$coefficients[2] } }
x <- calc(b, fun)
plot(x)
as.matrix(x)


> 2) The raster layers are of dimensions 4 x 4 x 120
> but?dim(getValues(rcmraster_crop))
> [1] ?16 120. Why is that? This must have implications for the way that the
> regressions for the brick are handled wouldnt it?
No

> Or is it specific to the
> way "getValues" handles things?

Yes. rows are cells (4*4=16), columns are layers.

> Also, does anyone have any pointers of how to accomplish the NA testing and
See an example above, assuming that if the first time step is NA, they
all are. You could also do things like
if (sum(is.na(x)) > 60)
depends on your context.


Best, Robert

On Mon, Dec 6, 2010 at 8:30 AM, Advait Godbole <advaitgodbole at gmail.com> wrote:
> Dear Members,
> To recap, I initially had trouble reading in two 3D netCDFs in to R using
> the raster "brick" function. Each brick is a 356 x 507 x 120 (lat, lon,
> time) raster. With that resolved (thanks Robert!) I have the following code
> to perform regressions between the ?two time series (at each grid-cell)
> # read the netCDFs
> rcmraster <- brick("regcm.cumul.hdd.10k.96_05.fixed.latlonvars.nc", varname
> = "hdd")
> emitraster <-
> brick("flip.percap.vulcan.10k.dp.build.381.RES.EIAmy.96_05.this.latest.nc",varname="emitpercap")
> # crop subset of above rasters to test
> lim <- extent(rcmraster,180,185,300,305) ?# createss a 4 x 4 x 120 brick
> rcmraster_crop <- crop(rcmraster,lim)
> emitraster_crop <- crop(emitraster,lim)
> #regressions
> s_crop <- stack(emitraster_crop,rcmraster_crop)
> func <- function(x) { lm(x[1:4] ~ x[5:8])$coefficients[2] } ? #regression
> for emit* VS rcm*
> x1 <- calc(s_crop, func)
> While the above regressions run, I have to ultimately do the same ?for the
> ?entire domain (356 x 507 cells) and therefore need to check for NAs at all
> time steps for each grid cell for both the bricks, and then have lm?run. To
> that ?end,, I ran the following diagnostics on the cropped dataset:
>> dim(rcmraster_crop)
> [1] ? 4 ? 4 120
>> dim(emitraster_crop)
> [1] ? 4 ? 4 120
>> dim(x1)
> [1] 4 4
>> getValues(x1)
> ?[1] 3.968207 3.968207 3.968207 3.968207 3.968207 3.968207 3.968207 3.968207
> 3.968207 3.968207 3.968207
> [12] 3.968207 3.968207 3.968207 3.968207 3.968207
>
> What I dont understand is:
> 1) How can each slope be the same (values of x1)
> 2) The raster layers are of dimensions 4 x 4 x 120
> but?dim(getValues(rcmraster_crop))
> [1] ?16 120. Why is that? This must have implications for the way that the
> regressions for the brick are handled wouldnt it? Or is it specific to the
> way "getValues" handles things?
> Also, does anyone have any pointers of how to accomplish the NA testing and
> regressions ?
> Thanks,
> Advait
>
> On Sun, Dec 5, 2010 at 6:29 PM, Robert J. Hijmans <r.hijmans at gmail.com>
> wrote:
>>
>> Advait,
>> It is just an example. In this case the function only checks the first
>> time-slice for all cells. That often works because oftentimes either
>> all values are NA, or none. Also, I think lm works when not all values
>> are NA. If your data is different, you may need a different solution.
>> The best thing might be to try it out with a small dataset (you can
>> use crop to create one).
>> Robert
>>
>> On Sun, Dec 5, 2010 at 3:14 PM, Advait Godbole <advaitgodbole at gmail.com>
>> wrote:
>> > Earlier in the threade you had mentioned that for two 120 layer bricks,
>> > this
>> > is what I should do:
>> > # regression of values in one brick (or stack) with another (Jacob's
>> > suggestion)
>> > s <- stack(s1, s2)
>> > # s1 and s2 have 120 layers
>> > fun <- function(x) { lm(x[1:120] ~ x[121:240])$coefficients[2] }
>> > x1 <- calc(s, fun)
>> > So if I have to check for NAs for the multi layered raster, I would need
>> > to
>> > do something like
>> > fun <- function (x) { if(is.na(x[1:120])) {NA} else
>> > {lm(x[1:120]~x[121:240])$coefficients[2]}}
>> > calc(s,fun=fun)
>> > That does not seem intuitively right to me although I am not very
>> > conversant
>> > with how is.na handles 3D variables to go much further. Also, should I
>> > not
>> > check the other brick for NAs too?
>> > Advait
>> > On Sun, Dec 5, 2010 at 5:29 PM, Robert J. Hijmans <r.hijmans at gmail.com>
>> > wrote:
>> >>
>> >> >If so, should I use a for loop instead?
>> >> No, that is the point of the calc function, that you do not do that.
>> >> Internally, calc uses apply as in
>> >> apply(values, 1, fun)
>> >>
>> >>
>> >> On Sat, Dec 4, 2010 at 1:50 PM, Advait Godbole
>> >> <advaitgodbole at gmail.com>
>> >> wrote:
>> >> > Roger, that fix worked, its there in the latest version. Thanks much.
>> >> > I am running into the problem that Martin mentioned earlier in the
>> >> > thread:
>> >> > Error in lm.fit(x, y, offset = offset, singular.ok = singular.ok,
>> >> > ...) :
>> >> > ?0 (non-NA) cases
>> >> >
>> >> > For which you suggested this:
>> >> > #you could catch this in your function and do something like:
>> >> >
>> >> >> fun=function(x) { if (is.na(x[1])){ NA } else {
>> >> >> lm(x[1]~x[2])$coefficients[2] }}
>> >> >> fun(c(NA,NA))
>> >> > [1] NA
>> >> >
>> >> > and then:
>> >> > calc(s, fun=fun)
>> >> >
>> >> > What I am confused is that my stack "s" that I will pass via calc is
>> >> > of
>> >> > dimensions 356 x 507 x 240, and therefore is.na?will act on the
>> >> > entire
>> >> > array
>> >> > and therefore still fail at those points where it is not NA. Is that
>> >> > right?
>> >> > If so, should I use a for loop instead?
>> >> > Thanks,
>> >> > Advait
>> >> > On Fri, Dec 3, 2010 at 2:58 PM, Robert J. Hijmans
>> >> > <r.hijmans at gmail.com>
>> >> > wrote:
>> >> >>
>> >> >> It may have been fixed. Please try this again in raster 1.7-8 (now
>> >> >> on
>> >> >> CRAN for windows and linux, mac in a day or so). Robert
>> >> >>
>> >> >> On Fri, Dec 3, 2010 at 11:54 AM, steven mosher
>> >> >> <moshersteven at gmail.com>
>> >> >> wrote:
>> >> >> > Well,
>> >> >> > ??I need some more information.
>> >> >> > ?before you create the stack do this and report the results
>> >> >> > test1 <- layerNames(rcmraster)
>> >> >> > test2 <- layerNames(emitraster)
>> >> >> > str(test1)
>> >> >> > str(test2)
>> >> >> > Its a bit of a hack but ?you can try to copy the layerNames out of
>> >> >> > the
>> >> >> > invidual stacks.
>> >> >> > Then set them to ? ?""
>> >> >> > then create one big stack
>> >> >> > then set the layerNames.
>> >> >> > ( I recall having to do that once in the past after a
>> >> >> > stackApply())
>> >> >> > I know in the past, I've had some similar issues, but I thought
>> >> >> > that
>> >> >> > they
>> >> >> > ?had been fixed.
>> >> >> > I'll try to take a look at the code ?in a bit, but if there is a
>> >> >> > bug,
>> >> >> > either
>> >> >> > robert or Jacob would have to fix it.
>> >> >> >
>> >> >> > On Fri, Dec 3, 2010 at 4:28 AM, Advait Godbole
>> >> >> > <advaitgodbole at gmail.com>
>> >> >> > wrote:
>> >> >> >>
>> >> >> >> With Robert being away until the 15th, can someone else help out
>> >> >> >> with
>> >> >> >> this
>> >> >> >> issue? To recap, I have read in two 507 x ?356 x 120
>> >> >> >> (lon,lat,time)
>> >> >> >> netCDF
>> >> >> >> files into R using the "brick" function. I get the following
>> >> >> >> error
>> >> >> >> when
>> >> >> >> I
>> >> >> >> use "stack" to clump these two multi layer rasters together.
>> >> >> >> > s <- stack(rcmraster,emitraster)
>> >> >> >> Error in function (classes, fdef, mtable) ?:
>> >> >> >> ??unable to find an inherited method for function "trim", for
>> >> >> >> signature
>> >> >> >> "integer"
>> >> >> >> Robert suggested that it is because of the layerNames being
>> >> >> >> numeric,
>> >> >> >> annd
>> >> >> >> that layerNames() <- layerNames() would solve it but it did not
>> >> >> >> help,
>> >> >> >> even
>> >> >> >> though layerNames() is now of type character.
>> >> >> >> Thanks much!
>> >> >> >> adv
>> >> >> >> On Fri, Dec 3, 2010 at 7:13 AM, Advait Godbole
>> >> >> >> <advaitgodbole at gmail.com>
>> >> >> >> wrote:
>> >> >> >>>
>> >> >> >>> the setMinMax() function worked. Thanks Steve and Robert..
>> >> >> >>> the work around did not work - I still get the trim() error..
>> >> >> >>> adv
>> >> >> >>>
>> >> >> >>> On Thu, Dec 2, 2010 at 1:43 PM, Robert J. Hijmans
>> >> >> >>> <r.hijmans at gmail.com>
>> >> >> >>> wrote:
>> >> >> >>>>
>> >> >> >>>> This is the work around:
>> >> >> >>>>
>> >> >> >>>> layerNames(rcmraster) <- layerNames(rcmraster)
>> >> >> >>>>
>> >> >> >>>>
>> >> >> >>>> On Thu, Dec 2, 2010 at 10:43 AM, Robert J. Hijmans
>> >> >> >>>> <r.hijmans at gmail.com>
>> >> >> >>>> wrote:
>> >> >> >>>> > The question marks indicate that the min and max values are
>> >> >> >>>> > not
>> >> >> >>>> > known
>> >> >> >>>> > to the object (because the file type does not store them, and
>> >> >> >>>> > it
>> >> >> >>>> > is
>> >> >> >>>> > too 'expensive' to determine them on the fly). setMinMax if
>> >> >> >>>> > you
>> >> >> >>>> > really
>> >> >> >>>> > need to know.
>> >> >> >>>> > The error on trim seems to be a problem with layerNames being
>> >> >> >>>> > numeric.
>> >> >> >>>> > I'll fix that. This may be a work-around
>> >> >> >>>> >
>> >> >> >>>> >
>> >> >> >>>> >
>> >> >> >>>> >
>> >> >> >>>> >
>> >> >> >>>> >
>> >> >> >>>> > On Thu, Dec 2, 2010 at 10:23 AM, steven mosher
>> >> >> >>>> > <moshersteven at gmail.com> wrote:
>> >> >> >>>> >> ?see the setMinMax()
>> >> >> >>>> >>
>> >> >> >>>> >> ?for the error on trim() I'm not sure.
>> >> >> >>>> >>
>> >> >> >>>> >> On Thu, Dec 2, 2010 at 5:16 AM, Advait Godbole
>> >> >> >>>> >> <advaitgodbole at gmail.com>
>> >> >> >>>> >> wrote:
>> >> >> >>>> >>>
>> >> >> >>>> >>> That worked perfectly. Thanks for pointing this out. I
>> >> >> >>>> >>> changed
>> >> >> >>>> >>> the
>> >> >> >>>> >>> way my
>> >> >> >>>> >>> variables were being written to the netCDF and now "brick"
>> >> >> >>>> >>> works.
>> >> >> >>>> >>> However,
>> >> >> >>>> >>> I
>> >> >> >>>> >>> am getting an error while using the stack function, like
>> >> >> >>>> >>> so:
>> >> >> >>>> >>>
>> >> >> >>>> >>> "Error in function (classes, fdef, mtable) ?:
>> >> >> >>>> >>> ?unable to find an inherited method for function "trim",
>> >> >> >>>> >>> for
>> >> >> >>>> >>> signature
>> >> >> >>>> >>> "integer"
>> >> >> >>>> >>>
>> >> >> >>>> >>> The two rasters show the following:
>> >> >> >>>> >>> > rcmraster
>> >> >> >>>> >>> class ? ? ? : RasterBrick
>> >> >> >>>> >>> filename ? ?: regcm.cumul.hdd.10k.96_05.fixed.latlonvars.nc
>> >> >> >>>> >>> nlayers ? ? : 120
>> >> >> >>>> >>> nrow ? ? ? ?: 356
>> >> >> >>>> >>> ncol ? ? ? ?: 507
>> >> >> >>>> >>> ncell ? ? ? : 180492
>> >> >> >>>> >>> projection ?: +proj=longlat +datum=WGS84 +ellps=WGS84
>> >> >> >>>> >>> +towgs84=0,0,0
>> >> >> >>>> >>> min value ? : ? ? ? ? ? ? ? ? ? ?
>> >> >> >>>> >>> max value ? : ? ? ? ? ? ? ? ? ? ?
>> >> >> >>>> >>> xmin ? ? ? ?: -137.3312
>> >> >> >>>> >>> xmax ? ? ? ?: -62.11259
>> >> >> >>>> >>> ymin ? ? ? ?: 22.12693
>> >> >> >>>> >>> ymax ? ? ? ?: 57.35954
>> >> >> >>>> >>> xres ? ? ? ?: 0.1483602
>> >> >> >>>> >>> yres ? ? ? ?: 0.09896801
>> >> >> >>>> >>>
>> >> >> >>>> >>> > emitraster
>> >> >> >>>> >>> class ? ? ? : RasterBrick
>> >> >> >>>> >>> filename ? ?:
>> >> >> >>>> >>>
>> >> >> >>>> >>>
>> >> >> >>>> >>>
>> >> >> >>>> >>> flip.percap.vulcan.10k.dp.build.381.RES.EIAmy.96_05.this.latest.nc
>> >> >> >>>> >>> nlayers ? ? : 120
>> >> >> >>>> >>> nrow ? ? ? ?: 356
>> >> >> >>>> >>> ncol ? ? ? ?: 507
>> >> >> >>>> >>> ncell ? ? ? : 180492
>> >> >> >>>> >>> projection ?: +proj=longlat +datum=WGS84 +ellps=WGS84
>> >> >> >>>> >>> +towgs84=0,0,0
>> >> >> >>>> >>> min value ? : ? ? ? ? ? ? ? ? ? ?
>> >> >> >>>> >>> max value ? : ? ? ? ? ? ? ? ? ? ?
>> >> >> >>>> >>> xmin ? ? ? ?: -137.3312
>> >> >> >>>> >>> xmax ? ? ? ?: -62.11259
>> >> >> >>>> >>> ymin ? ? ? ?: 22.12693
>> >> >> >>>> >>> ymax ? ? ? ?: 57.35954
>> >> >> >>>> >>> xres ? ? ? ?: 0.1483602
>> >> >> >>>> >>> yres ? ? ? ?: 0.09896801
>> >> >> >>>> >>>
>> >> >> >>>> >>> A getValues call shows a lot of NAs. Now, my original file
>> >> >> >>>> >>> does
>> >> >> >>>> >>> have
>> >> >> >>>> >>> a
>> >> >> >>>> >>> large
>> >> >> >>>> >>> number of missing values so that is why this should happen,
>> >> >> >>>> >>> but I
>> >> >> >>>> >>> suspect
>> >> >> >>>> >>> something is going wrong since the min and max values are
>> >> >> >>>> >>> not
>> >> >> >>>> >>> being
>> >> >> >>>> >>> displayed for either of these rasters. Is that the source
>> >> >> >>>> >>> of
>> >> >> >>>> >>> the
>> >> >> >>>> >>> problem
>> >> >> >>>> >>> in
>> >> >> >>>> >>> the "stack" function?
>> >> >> >>>> >>>
>> >> >> >>>> >>> Thanks,
>> >> >> >>>> >>>
>> >> >> >>>> >>> Advait
>> >> >> >>>> >>>
>> >> >> >>>> >>> On Tue, Nov 30, 2010 at 5:18 PM, Robert J. Hijmans
>> >> >> >>>> >>> <r.hijmans at gmail.com>wrote:
>> >> >> >>>> >>>
>> >> >> >>>> >>> > Advait,
>> >> >> >>>> >>> >
>> >> >> >>>> >>> > The is an error in the file, I think, see below:
>> >> >> >>>> >>> >
>> >> >> >>>> >>> > > library(ncdf)
>> >> >> >>>> >>> > > filename =
>> >> >> >>>> >>> > > "c:/downloads/regcm.cumul.hdd.10k.96_05.new.nc"
>> >> >> >>>> >>> > > nc <- open.ncdf(filename)
>> >> >> >>>> >>> > >
>> >> >> >>>> >>> > > zvar <- 'hdd'
>> >> >> >>>> >>> > > nc$var[[zvar]]$dim[[1]]$len
>> >> >> >>>> >>> > [1] 507
>> >> >> >>>> >>> > > nc$var[[zvar]]$dim[[2]]$len
>> >> >> >>>> >>> > [1] 356
>> >> >> >>>> >>> > >
>> >> >> >>>> >>> > > xx <- nc$var[[zvar]]$dim[[1]]$vals
>> >> >> >>>> >>> > > # should be a vector of 507 longitudes but:
>> >> >> >>>> >>> > > dim(xx)
>> >> >> >>>> >>> > [1] 507 356 120
>> >> >> >>>> >>> > >
>> >> >> >>>> >>> > > # works anyway
>> >> >> >>>> >>> > > xrange <- c(min(xx), max(xx))
>> >> >> >>>> >>> > > xrange
>> >> >> >>>> >>> > [1] -137.25705 ?-62.18677
>> >> >> >>>> >>> > >
>> >> >> >>>> >>> > > yy <- nc$var[[zvar]]$dim[[2]]$vals
>> >> >> >>>> >>> > > # should be a vector of 356 latitudes but:
>> >> >> >>>> >>> > > dim(yy)
>> >> >> >>>> >>> > [1] 507 356 120
>> >> >> >>>> >>> > >
>> >> >> >>>> >>> > > # this fails
>> >> >> >>>> >>> > > yrange <- c(min(yy), max(yy))
>> >> >> >>>> >>> > > yrange
>> >> >> >>>> >>> > [1] NaN NaN
>> >> >> >>>> >>> > > # and that is the only reason why raster failed.
>> >> >> >>>> >>> > >
>> >> >> >>>> >>> > > #OK
>> >> >> >>>> >>> > > yy[,,1][1:10,350:355]
>> >> >> >>>> >>> > ? ? ? ? ?[,1] ? ? [,2] ? ? [,3] ? ? [,4] ? ? [,5]
>> >> >> >>>> >>> > [,6]
>> >> >> >>>> >>> > ?[1,] 51.49148 51.57122 51.65092 51.73055 51.81014
>> >> >> >>>> >>> > 51.88967
>> >> >> >>>> >>> > ?[2,] 51.52888 51.60866 51.68839 51.76807 51.84769
>> >> >> >>>> >>> > 51.92727
>> >> >> >>>> >>> > ?[3,] 51.56616 51.64598 51.72575 51.80547 51.88513
>> >> >> >>>> >>> > 51.96474
>> >> >> >>>> >>> > ?[4,] 51.60332 51.68318 51.76299 51.84275 51.92245
>> >> >> >>>> >>> > 52.00210
>> >> >> >>>> >>> > ?[5,] 51.64036 51.72026 51.80011 51.87991 51.95965
>> >> >> >>>> >>> > 52.03934
>> >> >> >>>> >>> > ?[6,] 51.67728 51.75722 51.83711 51.91695 51.99673
>> >> >> >>>> >>> > 52.07646
>> >> >> >>>> >>> > ?[7,] 51.71409 51.79407 51.87399 51.95387 52.03369
>> >> >> >>>> >>> > 52.11345
>> >> >> >>>> >>> > ?[8,] 51.75077 51.83079 51.91076 51.99067 52.07053
>> >> >> >>>> >>> > 52.15033
>> >> >> >>>> >>> > ?[9,] 51.78734 51.86739 51.94740 52.02735 52.10725
>> >> >> >>>> >>> > 52.18709
>> >> >> >>>> >>> > [10,] 51.82378 51.90388 51.98392 52.06391 52.14385
>> >> >> >>>> >>> > 52.22373
>> >> >> >>>> >>> > >
>> >> >> >>>> >>> > > #bad values here (and note the NaN):
>> >> >> >>>> >>> > > yy[,,120][1:10,350:355]
>> >> >> >>>> >>> > ? ? ? ? ? ? ? ?[,1] ? ? ? ? ? [,2] ? ? ? ? ? [,3]
>> >> >> >>>> >>> > [,4]
>> >> >> >>>> >>> > ? ? [,5] ? ? ? ? ? [,6]
>> >> >> >>>> >>> > ?[1,] -1.313847e-229 -4.895880e-272 -7.553765e-266
>> >> >> >>>> >>> > 1.293814e+58
>> >> >> >>>> >>> > 9.551441e-293 ?-3.291580e-36
>> >> >> >>>> >>> > ?[2,] -5.321424e+272 -3.076997e-223 ?-1.515780e-33
>> >> >> >>>> >>> > -9.895836e+171
>> >> >> >>>> >>> > 3.115686e-149 ?-4.970539e+92
>> >> >> >>>> >>> > ?[3,] ?5.259277e-203 ? 5.980335e-56 ?2.893449e-212
>> >> >> >>>> >>> > ?2.974200e+274
>> >> >> >>>> >>> > 3.186547e-218 ?2.503689e+296
>> >> >> >>>> >>> > ?[4,] -3.977129e+225 -3.696719e-283 ? 1.284612e+42
>> >> >> >>>> >>> > 1.887923e+28
>> >> >> >>>> >>> > -2.322520e+268 ?5.005820e-108
>> >> >> >>>> >>> > ?[5,] ?-6.569744e+88 ? 1.824506e-74 ? 7.663356e+39
>> >> >> >>>> >>> > ?1.608759e-201
>> >> >> >>>> >>> > -1.433761e+110 -8.804183e-211
>> >> >> >>>> >>> > ?[6,] -4.237822e-162 ? ? ? ? ? ?NaN ?7.405904e-275
>> >> >> >>>> >>> > ?5.859877e-258
>> >> >> >>>> >>> > 1.339820e+110 ?1.631993e+229
>> >> >> >>>> >>> > ?[7,] ? 5.603325e-64 ? 4.188764e+37 -2.188887e+243
>> >> >> >>>> >>> > -4.657907e+280
>> >> >> >>>> >>> > 1.795268e-185 ?1.166057e-175
>> >> >> >>>> >>> > ?[8,] -2.112804e-229 ?4.536625e+137 ?2.910322e-278
>> >> >> >>>> >>> > ?4.407645e-274
>> >> >> >>>> >>> > 8.886205e-239 -1.913860e+238
>> >> >> >>>> >>> > ?[9,] ?-9.126350e+44 -1.866422e+177 -2.578975e+256
>> >> >> >>>> >>> > ?3.275379e+208
>> >> >> >>>> >>> > -2.657457e+75 ?-1.258259e-90
>> >> >> >>>> >>> > [10,] ?6.698325e+216 -2.958355e+137 -1.058748e-178
>> >> >> >>>> >>> > -1.776776e+215
>> >> >> >>>> >>> > -6.368807e+78 -5.337653e+299
>> >> >> >>>> >>> > >
>> >> >> >>>> >>> > > # this would have worked
>> >> >> >>>> >>> > > yrange <- c(min(yy[,,1]), max(yy[,,1]))
>> >> >> >>>> >>> > > yrange
>> >> >> >>>> >>> > [1] 22.17641 57.31006
>> >> >> >>>> >>> > >
>> >> >> >>>> >>> > > close.ncdf(nc)
>> >> >> >>>> >>> >
>> >> >> >>>> >>> >
>> >> >> >>>> >>> > Best, Robert
>> >> >> >>>> >>> >
>> >> >> >>>> >>> >
>> >> >> >>>> >>> > On Tue, Nov 30, 2010 at 10:37 AM, Advait Godbole
>> >> >> >>>> >>> > <advaitgodbole at gmail.com> wrote:
>> >> >> >>>> >>> > > Dear Robert,
>> >> >> >>>> >>> > > here is the link to the file:
>> >> >> >>>> >>> > >
>> >> >> >>>> >>> > >
>> >> >> >>>> >>> > >
>> >> >> >>>> >>> > >
>> >> >> >>>> >>> > > http://dl.dropbox.com/u/4030944/regcm.cumul.hdd.10k.96_05.new.nc. It
>> >> >> >>>> >>> > > is
>> >> >> >>>> >>> > a
>> >> >> >>>> >>> > > large file ~400 MB. Let me know if dropbox is not
>> >> >> >>>> >>> > > convenient
>> >> >> >>>> >>> > > and
>> >> >> >>>> >>> > > you
>> >> >> >>>> >>> > would
>> >> >> >>>> >>> > > rather do ftp - ?but our machines are down for
>> >> >> >>>> >>> > > maintenance
>> >> >> >>>> >>> > > and I
>> >> >> >>>> >>> > > may
>> >> >> >>>> >>> > > not
>> >> >> >>>> >>> > be
>> >> >> >>>> >>> > > immediately able to get access.
>> >> >> >>>> >>> > > I was going over the NCL code that processes the files
>> >> >> >>>> >>> > > but
>> >> >> >>>> >>> > > did
>> >> >> >>>> >>> > > not
>> >> >> >>>> >>> > > find
>> >> >> >>>> >>> > > anything glaringly amiss, so I will have to look at it
>> >> >> >>>> >>> > > in
>> >> >> >>>> >>> > > greater
>> >> >> >>>> >>> > > detail
>> >> >> >>>> >>> > > since it is clear that the number of entries in the
>> >> >> >>>> >>> > > variables
>> >> >> >>>> >>> > > is
>> >> >> >>>> >>> > > not
>> >> >> >>>> >>> > right
>> >> >> >>>> >>> > > as you've pointed out. There is a chance that I have
>> >> >> >>>> >>> > > not
>> >> >> >>>> >>> > > written
>> >> >> >>>> >>> > > out
>> >> >> >>>> >>> > > the
>> >> >> >>>> >>> > > co-ordinates properly.
>> >> >> >>>> >>> > > Thanks,
>> >> >> >>>> >>> > > Advait
>> >> >> >>>> >>> > > On Mon, Nov 29, 2010 at 1:14 PM, Robert J. Hijmans
>> >> >> >>>> >>> > > <r.hijmans at gmail.com>
>> >> >> >>>> >>> > > wrote:
>> >> >> >>>> >>> > >>
>> >> >> >>>> >>> > >> Advait,
>> >> >> >>>> >>> > >> I do not think I can help you further unless you send
>> >> >> >>>> >>> > >> me
>> >> >> >>>> >>> > >> your
>> >> >> >>>> >>> > >> file;
>> >> >> >>>> >>> > >> but this suggests that it is either not following the
>> >> >> >>>> >>> > >> CF
>> >> >> >>>> >>> > >> standards,
>> >> >> >>>> >>> > >> or
>> >> >> >>>> >>> > >> something is wrong with the file, or that there is
>> >> >> >>>> >>> > >> something
>> >> >> >>>> >>> > >> I
>> >> >> >>>> >>> > >> have
>> >> >> >>>> >>> > >> not understood about these files.
>> >> >> >>>> >>> > >> You said you have 507 x 356 x 120 values. I would
>> >> >> >>>> >>> > >> expect
>> >> >> >>>> >>> > >> length(frcm$dim[[1]]$vals) == 507 and
>> >> >> >>>> >>> > >> length(frcm$dim[[2]]$vals) ==
>> >> >> >>>> >>> > >> 356
>> >> >> >>>> >>> > >> Robert
>> >> >> >>>> >>> > >>
>> >> >> >>>> >>> > >> On Mon, Nov 29, 2010 at 6:11 AM, Advait Godbole <
>> >> >> >>>> >>> > advaitgodbole at gmail.com>
>> >> >> >>>> >>> > >> wrote:
>> >> >> >>>> >>> > >> > sorry to disrupt the flow of the conversation, but
>> >> >> >>>> >>> > >> > after
>> >> >> >>>> >>> > >> > doing what
>> >> >> >>>> >>> > >> > Robert
>> >> >> >>>> >>> > >> > suggested, this is what was returned:
>> >> >> >>>> >>> > >> >> length(frcm$dim[[1]]$vals)
>> >> >> >>>> >>> > >> > [1] 21659040
>> >> >> >>>> >>> > >> >> length(frcm$dim[[2]]$vals)
>> >> >> >>>> >>> > >> > [1] 21659040
>> >> >> >>>> >>> > >> > the other two functions return the latitude and
>> >> >> >>>> >>> > >> > longitude
>> >> >> >>>> >>> > >> > arrays
>> >> >> >>>> >>> > >> > not
>> >> >> >>>> >>> > >> > populated with NAs/missing values. I havent
>> >> >> >>>> >>> > >> > reproduced
>> >> >> >>>> >>> > >> > them
>> >> >> >>>> >>> > >> > here
>> >> >> >>>> >>> > because
>> >> >> >>>> >>> > >> > of
>> >> >> >>>> >>> > >> > their number.
>> >> >> >>>> >>> > >> > Regards,
>> >> >> >>>> >>> > >> > advait
>> >> >> >>>> >>> > >> > On Sat, Nov 27, 2010 at 3:48 PM, Robert J. Hijmans <
>> >> >> >>>> >>> > r.hijmans at gmail.com>
>> >> >> >>>> >>> > >> > wrote:
>> >> >> >>>> >>> > >> >>
>> >> >> >>>> >>> > >> >> Advait,
>> >> >> >>>> >>> > >> >>
>> >> >> >>>> >>> > >> >> That suggests that you have missing values in the
>> >> >> >>>> >>> > >> >> lon
>> >> >> >>>> >>> > >> >> or
>> >> >> >>>> >>> > >> >> lat
>> >> >> >>>> >>> > >> >> dimensions. Is that true? That would be awkward,
>> >> >> >>>> >>> > >> >> but
>> >> >> >>>> >>> > >> >> perhaps
>> >> >> >>>> >>> > something
>> >> >> >>>> >>> > >> >> else is going on. Can you send me your file? If not
>> >> >> >>>> >>> > >> >> can
>> >> >> >>>> >>> > >> >> you
>> >> >> >>>> >>> > >> >> send
>> >> >> >>>> >>> > >> >> the
>> >> >> >>>> >>> > >> >> results of this:
>> >> >> >>>> >>> > >> >>
>> >> >> >>>> >>> > >> >> filename <- "regcm.cumul.hdd.10k.96_05.new.nc"
>> >> >> >>>> >>> > >> >> nc <- open.ncdf(filename)
>> >> >> >>>> >>> > >> >> length(nc$dim[[1]]$vals)
>> >> >> >>>> >>> > >> >> length(nc$dim[[2]]$vals)
>> >> >> >>>> >>> > >> >> nc$dim[[1]]$vals
>> >> >> >>>> >>> > >> >> nc$dim[[2]]$vals
>> >> >> >>>> >>> > >> >> close.ncdf(nc)
>> >> >> >>>> >>> > >> >>
>> >> >> >>>> >>> > >> >> Thanks, Robert
>> >> >> >>>> >>> > >> >>
>> >> >> >>>> >>> > >> >> On Sat, Nov 27, 2010 at 8:36 AM, Advait Godbole
>> >> >> >>>> >>> > >> >> <advaitgodbole at gmail.com>
>> >> >> >>>> >>> > >> >> wrote:
>> >> >> >>>> >>> > >> >> > Thanks everyone for these leads..However, I am
>> >> >> >>>> >>> > >> >> > running
>> >> >> >>>> >>> > >> >> > into
>> >> >> >>>> >>> > problems
>> >> >> >>>> >>> > >> >> > with
>> >> >> >>>> >>> > >> >> > data handling. I used ncdf to extract the two
>> >> >> >>>> >>> > >> >> > variables
>> >> >> >>>> >>> > >> >> > (507 x
>> >> >> >>>> >>> > >> >> > 356
>> >> >> >>>> >>> > x
>> >> >> >>>> >>> > >> >> > 120
>> >> >> >>>> >>> > >> >> > -
>> >> >> >>>> >>> > >> >> > lon,lat,time) and converted them into array
>> >> >> >>>> >>> > >> >> > objects.
>> >> >> >>>> >>> > >> >> > The
>> >> >> >>>> >>> > suggestions
>> >> >> >>>> >>> > >> >> > provided all utilize the raster package, but
>> >> >> >>>> >>> > >> >> > using
>> >> >> >>>> >>> > >> >> > "brick"
>> >> >> >>>> >>> > >> >> > on
>> >> >> >>>> >>> > >> >> > the
>> >> >> >>>> >>> > >> >> > file
>> >> >> >>>> >>> > >> >> > returns this error: "rcmraster <-
>> >> >> >>>> >>> > >> >> > brick("regcm.cumul.hdd.10k.96_05.new.nc")
>> >> >> >>>> >>> > >> >> > Error in if (e at xmin > -400 & e at xmax < 400 &
>> >> >> >>>> >>> > >> >> > e at ymin >
>> >> >> >>>> >>> > >> >> > -90.1
>> >> >> >>>> >>> > >> >> > &
>> >> >> >>>> >>> > e at ymax <
>> >> >> >>>> >>> > >> >> > ?:
>> >> >> >>>> >>> > >> >> > missing value where TRUE/FALSE needed"
>> >> >> >>>> >>> > >> >> >
>> >> >> >>>> >>> > >> >> > I have a fair number of NAs (all missing values
>> >> >> >>>> >>> > >> >> > in
>> >> >> >>>> >>> > >> >> > the
>> >> >> >>>> >>> > >> >> > original
>> >> >> >>>> >>> > >> >> > variables).
>> >> >> >>>> >>> > >> >> > Is there a way to set a flag for that? Or any
>> >> >> >>>> >>> > >> >> > other
>> >> >> >>>> >>> > >> >> > workaround?
>> >> >> >>>> >>> > >> >> > Thanks much,
>> >> >> >>>> >>> > >> >> > advait
>> >> >> >>>> >>> > >> >> > On Fri, Nov 26, 2010 at 6:25 PM, Robert J.
>> >> >> >>>> >>> > >> >> > Hijmans
>> >> >> >>>> >>> > >> >> > <r.hijmans at gmail.com>
>> >> >> >>>> >>> > >> >> > wrote:
>> >> >> >>>> >>> > >> >> >>
>> >> >> >>>> >>> > >> >> >> There are some difference in the behavior of
>> >> >> >>>> >>> > >> >> >> 'calc'
>> >> >> >>>> >>> > >> >> >> between
>> >> >> >>>> >>> > >> >> >> functions,
>> >> >> >>>> >>> > >> >> >> because of attempts to accommodate different
>> >> >> >>>> >>> > >> >> >> functions
>> >> >> >>>> >>> > >> >> >> &
>> >> >> >>>> >>> > intentions.
>> >> >> >>>> >>> > >> >> >> But in 'raster' 1.7-4 (available from R-Forge in
>> >> >> >>>> >>> > >> >> >> ~
>> >> >> >>>> >>> > >> >> >> 24
>> >> >> >>>> >>> > >> >> >> hrs; and
>> >> >> >>>> >>> > from
>> >> >> >>>> >>> > >> >> >> CRAN soon), the below will work:
>> >> >> >>>> >>> > >> >> >>
>> >> >> >>>> >>> > >> >> >> library(raster)
>> >> >> >>>> >>> > >> >> >> #creating some data
>> >> >> >>>> >>> > >> >> >> r <- raster(nrow=10, ncol=10)
>> >> >> >>>> >>> > >> >> >> s1 <- s2<- list()
>> >> >> >>>> >>> > >> >> >> for (i in 1:12) {
>> >> >> >>>> >>> > >> >> >> ? ? ? ?s1[i] <- setValues(r, rnorm(ncell(r), i,
>> >> >> >>>> >>> > >> >> >> 3)
>> >> >> >>>> >>> > >> >> >> )
>> >> >> >>>> >>> > >> >> >> ? ? ? ?s2[i] <- setValues(r, rnorm(ncell(r), i,
>> >> >> >>>> >>> > >> >> >> 3)
>> >> >> >>>> >>> > >> >> >> )
>> >> >> >>>> >>> > >> >> >> }
>> >> >> >>>> >>> > >> >> >> s1 <- stack(s1)
>> >> >> >>>> >>> > >> >> >> s2 <- stack(s2)
>> >> >> >>>> >>> > >> >> >>
>> >> >> >>>> >>> > >> >> >> # regression of values in one brick (or stack)
>> >> >> >>>> >>> > >> >> >> with
>> >> >> >>>> >>> > >> >> >> another
>> >> >> >>>> >>> > (Jacob's
>> >> >> >>>> >>> > >> >> >> suggestion)
>> >> >> >>>> >>> > >> >> >> s <- stack(s1, s2)
>> >> >> >>>> >>> > >> >> >> # s1 and s2 have 12 layers
>> >> >> >>>> >>> > >> >> >> fun <- function(x) { lm(x[1:12] ~
>> >> >> >>>> >>> > >> >> >> x[13:24])$coefficients[2] }
>> >> >> >>>> >>> > >> >> >> x1 <- calc(s, fun)
>> >> >> >>>> >>> > >> >> >>
>> >> >> >>>> >>> > >> >> >> # regression of values in one brick (or stack)
>> >> >> >>>> >>> > >> >> >> with
>> >> >> >>>> >>> > >> >> >> 'time'
>> >> >> >>>> >>> > >> >> >> time <- 1:nlayers(s)
>> >> >> >>>> >>> > >> >> >> fun <- function(x) { lm(x ~
>> >> >> >>>> >>> > >> >> >> time)$coefficients[2] }
>> >> >> >>>> >>> > >> >> >> x2 <- calc(s, fun)
>> >> >> >>>> >>> > >> >> >>
>> >> >> >>>> >>> > >> >> >> # get multiple layers, e.g. the slope _and_
>> >> >> >>>> >>> > >> >> >> intercept
>> >> >> >>>> >>> > >> >> >> fun <- function(x) { lm(x ~ time)$coefficients }
>> >> >> >>>> >>> > >> >> >> x3 <- calc(s, fun)
>> >> >> >>>> >>> > >> >> >>
>> >> >> >>>> >>> > >> >> >> If this does not work in your version, you can
>> >> >> >>>> >>> > >> >> >> use
>> >> >> >>>> >>> > >> >> >> apply(
>> >> >> >>>> >>> > >> >> >> ) as
>> >> >> >>>> >>> > >> >> >> in
>> >> >> >>>> >>> > >> >> >> what
>> >> >> >>>> >>> > >> >> >> I send earlier.
>> >> >> >>>> >>> > >> >> >>
>> >> >> >>>> >>> > >> >> >> Robert
>> >> >> >>>> >>> > >> >> >>
>> >> >> >>>> >>> > >> >> >> On Fri, Nov 26, 2010 at 2:56 PM, Robert J.
>> >> >> >>>> >>> > >> >> >> Hijmans
>> >> >> >>>> >>> > >> >> >> <r.hijmans at gmail.com>
>> >> >> >>>> >>> > >> >> >> wrote:
>> >> >> >>>> >>> > >> >> >> > It seems that 'calc' does not like this (any
>> >> >> >>>> >>> > >> >> >> > more;
>> >> >> >>>> >>> > >> >> >> > another
>> >> >> >>>> >>> > >> >> >> > thing
>> >> >> >>>> >>> > >> >> >> > to
>> >> >> >>>> >>> > >> >> >> > fix) . If your rasters are not very large you
>> >> >> >>>> >>> > >> >> >> > can
>> >> >> >>>> >>> > >> >> >> > use
>> >> >> >>>> >>> > >> >> >> > apply,
>> >> >> >>>> >>> > which
>> >> >> >>>> >>> > >> >> >> > makes it much faster:
>> >> >> >>>> >>> > >> >> >> >
>> >> >> >>>> >>> > >> >> >> > library(raster)
>> >> >> >>>> >>> > >> >> >> > #creating some data
>> >> >> >>>> >>> > >> >> >> > r <- raster(nrow=10, ncol=10)
>> >> >> >>>> >>> > >> >> >> > s <- list()
>> >> >> >>>> >>> > >> >> >> > for (i in 1:25) { s[i] <- setValues(r,
>> >> >> >>>> >>> > >> >> >> > rnorm(ncell(r),
>> >> >> >>>> >>> > >> >> >> > i, 3)
>> >> >> >>>> >>> > >> >> >> > ) }
>> >> >> >>>> >>> > >> >> >> > s <- stack(s)
>> >> >> >>>> >>> > >> >> >> >
>> >> >> >>>> >>> > >> >> >> > # regression
>> >> >> >>>> >>> > >> >> >> > time <- 1:nlayers(s)
>> >> >> >>>> >>> > >> >> >> > fun <- function(x) { lm(x ~
>> >> >> >>>> >>> > >> >> >> > time)$coefficients[2]
>> >> >> >>>> >>> > >> >> >> > }
>> >> >> >>>> >>> > >> >> >> > r[] <- apply(getValues(s), 1, fun)
>> >> >> >>>> >>> > >> >> >> >
>> >> >> >>>> >>> > >> >> >> > Robert
>> >> >> >>>> >>> > >> >> >> >
>> >> >> >>>> >>> > >> >> >> >
>> >> >> >>>> >>> > >> >> >> >
>> >> >> >>>> >>> > >> >> >> > On Fri, Nov 26, 2010 at 2:51 PM, Jacob van
>> >> >> >>>> >>> > >> >> >> > Etten
>> >> >> >>>> >>> > >> >> >> > <jacobvanetten at yahoo.com> wrote:
>> >> >> >>>> >>> > >> >> >> >> you could try this approach (use calc
>> >> >> >>>> >>> > >> >> >> >> whenever
>> >> >> >>>> >>> > >> >> >> >> you
>> >> >> >>>> >>> > >> >> >> >> can):
>> >> >> >>>> >>> > >> >> >> >>
>> >> >> >>>> >>> > >> >> >> >> (supposing your bricks have 12 layers)
>> >> >> >>>> >>> > >> >> >> >>
>> >> >> >>>> >>> > >> >> >> >> br3 <- stack(brick1, brick2)
>> >> >> >>>> >>> > >> >> >> >> lmS <- function(x) lm(x[1:12] ~
>> >> >> >>>> >>> > >> >> >> >> x[13:24)$coefficients[2]
>> >> >> >>>> >>> > >> >> >> >> r <- calc(br3, lmS)
>> >> >> >>>> >>> > >> >> >> >>
>> >> >> >>>> >>> > >> >> >> >> Jacob.
>> >> >> >>>> >>> > >> >> >> >>
>> >> >> >>>> >>> > >> >> >> >> --- On Fri, 26/11/10, steven mosher
>> >> >> >>>> >>> > >> >> >> >> <moshersteven at gmail.com>
>> >> >> >>>> >>> > >> >> >> >> wrote:
>> >> >> >>>> >>> > >> >> >> >>
>> >> >> >>>> >>> > >> >> >> >> From: steven mosher <moshersteven at gmail.com>
>> >> >> >>>> >>> > >> >> >> >> Subject: Re: [R-sig-Geo] gridded time series
>> >> >> >>>> >>> > >> >> >> >> analysis
>> >> >> >>>> >>> > >> >> >> >> To: "Martin" <martin_brandt at gmx.net>
>> >> >> >>>> >>> > >> >> >> >> Cc: r-sig-geo at stat.math.ethz.ch
>> >> >> >>>> >>> > >> >> >> >> Date: Friday, 26 November, 2010, 23:33
>> >> >> >>>> >>> > >> >> >> >>
>> >> >> >>>> >>> > >> >> >> >> that's cool, I'm also interested in a similar
>> >> >> >>>> >>> > >> >> >> >> problem
>> >> >> >>>> >>> > >> >> >> >> but
>> >> >> >>>> >>> > >> >> >> >> just
>> >> >> >>>> >>> > >> >> >> >> with
>> >> >> >>>> >>> > >> >> >> >> one
>> >> >> >>>> >>> > >> >> >> >> brick ending up with a slope raster as the
>> >> >> >>>> >>> > >> >> >> >> output.
>> >> >> >>>> >>> > >> >> >> >> It
>> >> >> >>>> >>> > >> >> >> >> may be
>> >> >> >>>> >>> > >> >> >> >> possible
>> >> >> >>>> >>> > >> >> >> >> with
>> >> >> >>>> >>> > >> >> >> >> stackApply(). have a look. or maybe robert
>> >> >> >>>> >>> > >> >> >> >> will
>> >> >> >>>> >>> > >> >> >> >> chime
>> >> >> >>>> >>> > >> >> >> >> in
>> >> >> >>>> >>> > >> >> >> >>
>> >> >> >>>> >>> > >> >> >> >>
>> >> >> >>>> >>> > >> >> >> >>
>> >> >> >>>> >>> > >> >> >> >> On Fri, Nov 26, 2010 at 1:35 PM, Martin
>> >> >> >>>> >>> > >> >> >> >> <martin_brandt at gmx.net
>> >> >> >>>> >>> > >
>> >> >> >>>> >>> > >> >> >> >> wrote:
>> >> >> >>>> >>> > >> >> >> >>
>> >> >> >>>> >>> > >> >> >> >>>
>> >> >> >>>> >>> > >> >> >> >>> this is what I did to perform a regression
>> >> >> >>>> >>> > >> >> >> >>> between
>> >> >> >>>> >>> > >> >> >> >>> two
>> >> >> >>>> >>> > >> >> >> >>> bricks
>> >> >> >>>> >>> > >> >> >> >>> (each
>> >> >> >>>> >>> > >> >> >> >>> brick
>> >> >> >>>> >>> > >> >> >> >>> represent a time series):
>> >> >> >>>> >>> > >> >> >> >>>
>> >> >> >>>> >>> > >> >> >> >>> r <- raster(brick1)
>> >> >> >>>> >>> > >> >> >> >>> for (i in 1:ncell(r)) {
>> >> >> >>>> >>> > >> >> >> >>> r[i] = lm(as.ts(cellValues(brick1, i)) ~
>> >> >> >>>> >>> > >> >> >> >>> as.ts(cellValues(brick2,
>> >> >> >>>> >>> > >> >> >> >>> i)))$coefficients[2]
>> >> >> >>>> >>> > >> >> >> >>> }
>> >> >> >>>> >>> > >> >> >> >>>
>> >> >> >>>> >>> > >> >> >> >>> The result will be a slope raster, but it
>> >> >> >>>> >>> > >> >> >> >>> really
>> >> >> >>>> >>> > >> >> >> >>> takes a
>> >> >> >>>> >>> > >> >> >> >>> lot
>> >> >> >>>> >>> > of
>> >> >> >>>> >>> > >> >> >> >>> time,
>> >> >> >>>> >>> > >> >> >> >>> so
>> >> >> >>>> >>> > >> >> >> >>> maybe there is a better solution..
>> >> >> >>>> >>> > >> >> >> >>>
>> >> >> >>>> >>> > >> >> >> >>>
>> >> >> >>>> >>> > >> >> >> >>> --
>> >> >> >>>> >>> > >> >> >> >>> View this message in context:
>> >> >> >>>> >>> > >> >> >> >>>
>> >> >> >>>> >>> > >> >> >> >>>
>> >> >> >>>> >>> > >> >> >> >>>
>> >> >> >>>> >>> > >> >> >> >>>
>> >> >> >>>> >>> >
>> >> >> >>>> >>> >
>> >> >> >>>> >>> >
>> >> >> >>>> >>> >
>> >> >> >>>> >>> >
>> >> >> >>>> >>> > http://r-sig-geo.2731867.n2.nabble.com/gridded-time-series-analysis-tp5775651p5778472.html
>> >> >> >>>> >>> > >> >> >> >>> Sent from the R-sig-geo mailing list archive
>> >> >> >>>> >>> > >> >> >> >>> at
>> >> >> >>>> >>> > >> >> >> >>> Nabble.com.
>> >> >> >>>> >>> > >> >> >> >>>
>> >> >> >>>> >>> > >> >> >> >>>
>> >> >> >>>> >>> > >> >> >> >>> _______________________________________________
>> >> >> >>>> >>> > >> >> >> >>> R-sig-Geo mailing list
>> >> >> >>>> >>> > >> >> >> >>> R-sig-Geo at stat.math.ethz.ch
>> >> >> >>>> >>> > >> >> >> >>>
>> >> >> >>>> >>> > >> >> >> >>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> >> >> >>>> >>> > >> >> >> >>>
>> >> >> >>>> >>> > >> >> >> >>
>> >> >> >>>> >>> > >> >> >> >> ? ? [[alternative HTML version deleted]]
>> >> >> >>>> >>> > >> >> >> >>
>> >> >> >>>> >>> > >> >> >> >>
>> >> >> >>>> >>> > >> >> >> >> _______________________________________________
>> >> >> >>>> >>> > >> >> >> >> R-sig-Geo mailing list
>> >> >> >>>> >>> > >> >> >> >> R-sig-Geo at stat.math.ethz.ch
>> >> >> >>>> >>> > >> >> >> >>
>> >> >> >>>> >>> > >> >> >> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> >> >> >>>> >>> > >> >> >> >>
>> >> >> >>>> >>> > >> >> >> >>
>> >> >> >>>> >>> > >> >> >> >>
>> >> >> >>>> >>> > >> >> >> >>
>> >> >> >>>> >>> > >> >> >> >> ? ? ? ?[[alternative HTML version deleted]]
>> >> >> >>>> >>> > >> >> >> >>
>> >> >> >>>> >>> > >> >> >> >>
>> >> >> >>>> >>> > >> >> >> >>
>> >> >> >>>> >>> > >> >> >> >> _______________________________________________
>> >> >> >>>> >>> > >> >> >> >> R-sig-Geo mailing list
>> >> >> >>>> >>> > >> >> >> >> R-sig-Geo at stat.math.ethz.ch
>> >> >> >>>> >>> > >> >> >> >>
>> >> >> >>>> >>> > >> >> >> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> >> >> >>>> >>> > >> >> >> >>
>> >> >> >>>> >>> > >> >> >> >>
>> >> >> >>>> >>> > >> >> >> >
>> >> >> >>>> >>> > >> >> >>
>> >> >> >>>> >>> > >> >> >> _______________________________________________
>> >> >> >>>> >>> > >> >> >> R-sig-Geo mailing list
>> >> >> >>>> >>> > >> >> >> R-sig-Geo at stat.math.ethz.ch
>> >> >> >>>> >>> > >> >> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> >> >> >>>> >>> > >> >> >
>> >> >> >>>> >>> > >> >> >
>> >> >> >>>> >>> > >> >> >
>> >> >> >>>> >>> > >> >> > --
>> >> >> >>>> >>> > >> >> > advait godbole
>> >> >> >>>> >>> > >> >> >
>> >> >> >>>> >>> > >> >
>> >> >> >>>> >>> > >> >
>> >> >> >>>> >>> > >> >
>> >> >> >>>> >>> > >> > --
>> >> >> >>>> >>> > >> > advait godbole
>> >> >> >>>> >>> > >> >
>> >> >> >>>> >>> > >
>> >> >> >>>> >>> > >
>> >> >> >>>> >>> > >
>> >> >> >>>> >>> > > --
>> >> >> >>>> >>> > > advait godbole
>> >> >> >>>> >>> > >
>> >> >> >>>> >>> >
>> >> >> >>>> >>>
>> >> >> >>>> >>>
>> >> >> >>>> >>>
>> >> >> >>>> >>> --
>> >> >> >>>> >>> advait godbole
>> >> >> >>>> >>>
>> >> >> >>>> >>> ? ? ? ?[[alternative HTML version deleted]]
>> >> >> >>>> >>>
>> >> >> >>>> >>> _______________________________________________
>> >> >> >>>> >>> R-sig-Geo mailing list
>> >> >> >>>> >>> R-sig-Geo at r-project.org
>> >> >> >>>> >>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> >> >> >>>> >>
>> >> >> >>>> >>
>> >> >> >>>> >
>> >> >> >>>
>> >> >> >>>
>> >> >> >>>
>> >> >> >>> --
>> >> >> >>> advait godbole
>> >> >> >>
>> >> >> >>
>> >> >> >>
>> >> >> >> --
>> >> >> >> advait godbole
>> >> >> >
>> >> >> >
>> >> >
>> >> >
>> >> >
>> >> > --
>> >> > advait godbole
>> >> >
>> >
>> >
>> >
>> > --
>> > advait godbole
>> >
>
>
>
> --
> advait godbole
>


From lists at remoteinformation.com.au  Tue Dec  7 03:05:45 2010
From: lists at remoteinformation.com.au (Ben Madin)
Date: Tue, 7 Dec 2010 13:05:45 +1100
Subject: [R-sig-Geo] Confidence intervals for non-poisson distributed SMR's
Message-ID: <1A29305F-ED36-46CC-A0D4-F2958247E96E@remoteinformation.com.au>

G'day all,

I have run into a bit of a problem. In the ASDAR book it shows a method for calculating Confidence Intervals for Standardised Morbidity Ratios using the epitools pois.exact function - but my data is overdispersed. 

Is there a similar function that anyone knows of for negative binomial?

cheers

Ben


From wongwatana at gmail.com  Tue Dec  7 05:14:10 2010
From: wongwatana at gmail.com (Wongwatana Sombunying)
Date: Tue, 7 Dec 2010 11:14:10 +0700
Subject: [R-sig-Geo] Error in Modis mosaic tool
Message-ID: <AANLkTik3cqs6grUw8x0BK4PNN=knkbeOyY0ktN9iwTK1@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101207/d424cad1/attachment.pl>

From jacobvanetten at yahoo.com  Tue Dec  7 06:41:06 2010
From: jacobvanetten at yahoo.com (Jacob van Etten)
Date: Tue, 7 Dec 2010 05:41:06 +0000 (GMT)
Subject: [R-sig-Geo] Polygon dissolution or union issue
In-Reply-To: <AANLkTim+kJfPk-nqepXfesJjiXPkWYNc7B7+P_xKA=xP@mail.gmail.com>
Message-ID: <799903.89326.qm@web29712.mail.ird.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101207/4700daea/attachment.pl>

From jacobvanetten at yahoo.com  Tue Dec  7 06:36:48 2010
From: jacobvanetten at yahoo.com (Jacob van Etten)
Date: Tue, 7 Dec 2010 05:36:48 +0000 (GMT)
Subject: [R-sig-Geo] Polygon dissolution or union issue
In-Reply-To: <AANLkTim+kJfPk-nqepXfesJjiXPkWYNc7B7+P_xKA=xP@mail.gmail.com>
Message-ID: <420740.23139.qm@web29707.mail.ird.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101207/e1079291/attachment.pl>

From Roger.Bivand at nhh.no  Tue Dec  7 10:17:18 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 7 Dec 2010 10:17:18 +0100 (CET)
Subject: [R-sig-Geo] grids
In-Reply-To: <AANLkTikv419fXuEg2dRuaUPe4UECgCtwideB7u-sJuNK@mail.gmail.com>
References: <AANLkTikv419fXuEg2dRuaUPe4UECgCtwideB7u-sJuNK@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.1012071010300.23097@reclus.nhh.no>

On Mon, 6 Dec 2010, Agnieszka Kaczmarczyk wrote:

> Hello.
> I make grids and Object of class SpatialPixels not are atrributes?
> Pozdrawiam
> Agnieszka
> #data
> setwd("/home/agnieszka/
> Pulpit/dane1")
>> alu <- read.csv("cooral.csv", header = TRUE, sep = ",")
>> coordinates(alu) = ~x+y
>> attributes(alu) = al
> Error: object 'al' not found

You have two problems - one that assigning through attributes() is 
absolutely wrong - it assigns to arbitrary old-style class attributes:

m <- "whatever"
attributes(m)
attributes(m) <- list(class="rubbish")
attributes(m)
class(m)

and the second is that there is no object called "al" in your workspace.

It probably doesn't matter, though, as here:

>> alu.sp = spsample(alu, type = "regular", cellsize = c(50,50))
>> gridded(alu.sp) = TRUE
>> summary(alu.sp)

you are creating a SpatialPixels object covering the input point data.

Ask your question again using the built-in meuse data set, please, and 
try to let us know what you are trying to do.

Roger


> Object of class SpatialPixels
> Coordinates:
>       min     max
> x1 4384052 4393102
> x2 5569919 5579319
> Is projected: NA
> proj4string : [NA]
> Number of points: 34028
> Grid attributes:
>   cellcentre.offset cellsize cells.dim
> x1           4384077       50       181
> x2           5569944       50       188
>>  # promote to SpatialPixelsDataFrame
>> gridded(alu.sp) <- TRUE
>> # creates the full grid
>> alu.sg = as(alu.sp, "SpatialGridDataFrame")
>> summary(alu.sg)
> Error in .subset2(x, i, exact = exact) : subscript out of bounds
> Error in summary(object at data[[1]]) :
>  error in evaluating the argument 'object' in selecting a method for
> function 'summary'
>> class(alu.sg)
> [1] "SpatialGridDataFrame"
> attr(,"package")
> [1] "sp"
>>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From thi_veloso at yahoo.com.br  Tue Dec  7 15:20:19 2010
From: thi_veloso at yahoo.com.br (Thiago Veloso)
Date: Tue, 7 Dec 2010 06:20:19 -0800 (PST)
Subject: [R-sig-Geo] Performing CCA and plotting spatial patterns
Message-ID: <78090.31808.qm@web54302.mail.re2.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101207/52ded793/attachment.pl>

From calesso at fca.unl.edu.ar  Tue Dec  7 15:43:05 2010
From: calesso at fca.unl.edu.ar (Ing. Agr. =?ISO-8859-1?Q?Agust=EDn?= Alesso)
Date: Tue, 07 Dec 2010 11:43:05 -0300
Subject: [R-sig-Geo] spatial correlation structure for GLS (nlme)
Message-ID: <1291732985.15565.20.camel@agustin-Studio14>

Hello,

I'm trying to include a spatial correlation structure to an ANOVA
one-way GLS model. First, I fitted a simple model asuming uncorrelated
errors and plot the residuals variogram which verified the spatial
autocorrelation.
The corStructure seems to be a mixture between to spherical structures
(2 ranges). So, before adding complexity to the model, I tried to fit a
few models with basic predefined corStructures and then looking at their
residuals variograms. Including correlation results in smallers AICs
than without asuming correlation, but the variograms still showing
spatial correlation of residuals. 

How can I bluid a spatial correlation structure including this
sphericals features?

Thanks in advance,


Agustin


From francoisrousseu at hotmail.com  Tue Dec  7 17:57:24 2010
From: francoisrousseu at hotmail.com (Francois Rousseu)
Date: Tue, 7 Dec 2010 11:57:24 -0500
Subject: [R-sig-Geo] time zones overwater?
Message-ID: <BLU149-W33ACD9AE6063D5B3BF9E99BA2C0@phx.gbl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101207/3556d697/attachment.pl>

From b.rowlingson at lancaster.ac.uk  Tue Dec  7 18:58:32 2010
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Tue, 7 Dec 2010 17:58:32 +0000
Subject: [R-sig-Geo] time zones overwater?
In-Reply-To: <BLU149-W33ACD9AE6063D5B3BF9E99BA2C0@phx.gbl>
References: <BLU149-W33ACD9AE6063D5B3BF9E99BA2C0@phx.gbl>
Message-ID: <AANLkTin+NzJkt0Dvp=jgTTi9iu7KyCCSYu30wG1AiyQm@mail.gmail.com>

On Tue, Dec 7, 2010 at 4:57 PM, Francois Rousseu
<francoisrousseu at hotmail.com> wrote:
>
> Hello
>
> I need to determine time zone location (eg. America/Montreal) for several latlon coordinates mostly in North America. I found some freely available .shp files giving polygons for the various time zones, but the polygons exclude most large bodies of water. For example, coordinates falling in the Great Lakes or between islands in the canadian arctic are not associated with any time zone. Does anybody know of some freely available .shp files or any other way to obtain an ID for these zones to be able to get the correct time?

 www.geonames.org can help, my geonames package can query it from R,
and you can get timezone offsets:

> library(geonames)
Loading required package: rjson

> GNtimezone(lng=37,lat=0)
             time countryName           sunset rawOffset dstOffset countryCode
1 2010-12-07 20:57       Kenya 2010-12-07 18:27         3         3          KE
 gmtOffset lng          sunrise     timezoneId lat
1         3  37 2010-12-07 06:19 Africa/Nairobi   0

Barry


From moshersteven at gmail.com  Tue Dec  7 19:17:18 2010
From: moshersteven at gmail.com (steven mosher)
Date: Tue, 7 Dec 2010 10:17:18 -0800
Subject: [R-sig-Geo] satellite imagery
In-Reply-To: <4CFC39D6.2040000@amnh.org>
References: <4CFAEFEB.6090808@berkeley.edu> <4CFC39D6.2040000@amnh.org>
Message-ID: <AANLkTimewywq+xGvW=fU6g53ZcWMHs73SikjmCLp6-R7@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101207/829653e2/attachment.pl>

From pierre.roudier at gmail.com  Tue Dec  7 20:36:44 2010
From: pierre.roudier at gmail.com (Pierre Roudier)
Date: Wed, 8 Dec 2010 08:36:44 +1300
Subject: [R-sig-Geo] Parallelized kriging in R (gstat/intamap)
In-Reply-To: <4CFCBDC5.9070002@uni-muenster.de>
References: <AANLkTi=ZckG1EHGQhcrYYcea5BJQcgST_DbC3SWeuoyG@mail.gmail.com>
	<4CFCBDC5.9070002@uni-muenster.de>
Message-ID: <AANLkTi=Dfm0Cn7N=kQ0OGPHCb4Zteh5KvqM2kr82oPen@mail.gmail.com>

Jon and Edzer,

Sorry, I was a bit confused with how to specify the nclus option in
the intamap methods. This is clearer now.

Edzer, for some reason I thought it was not possible to parallelize
kriging in gstat so simply. Thanks for the pointer, I modified the
demo snow.R and adapted it to suit my needs.

Thank you both for the work on intamap - it really looks good.

Pierre

2010/12/6 Edzer Pebesma <edzer.pebesma at uni-muenster.de>:
> The documentation for package intamap suggest that you first download
> and load package doSNOW from CRAN, and then pass the nclus parameter
> with a number larger than 1, as argument:
>
> interpolate(..., optList=list(nclus=2))
>
> Looking at the code, it tries to set up nodes on localhost, so for
> distributing load over a cluster composed of different machines, you (or
> we) would have to modify the code.
>
> Package gstat has a demo script, demo(snow), that shows how to
> distribute predictions over multiple hosts.
>
> On 12/06/2010 03:41 AM, Pierre Roudier wrote:
>> Dear list,
>>
>> I've been wanting to parallelize kriging using R - on a cluster.
>>
>> I am not aware of any parallelized method in gstat (which I'm an avid
>> and happy user), and I'm just discovering the intamap package (which
>> looks awesome) which seems to have that sort of capability (using the
>> nclus parameter). However, I don't really get how to use it.
>>
>> Any pointers?
>>
>> Cheers,
>>
>> Pierre
>>
>> .
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> --
> Edzer Pebesma
> Institute for Geoinformatics (ifgi), University of M?nster
> Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
> 8333081, Fax: +49 251 8339763 ?http://ifgi.uni-muenster.de
> http://www.52north.org/geostatistics ? ? ?e.pebesma at wwu.de
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From Virgilio.Gomez at uclm.es  Tue Dec  7 20:53:43 2010
From: Virgilio.Gomez at uclm.es (Virgilio Gomez Rubio)
Date: Tue, 07 Dec 2010 20:53:43 +0100
Subject: [R-sig-Geo] Confidence intervals for non-poisson distributed
 SMR's
In-Reply-To: <1A29305F-ED36-46CC-A0D4-F2958247E96E@remoteinformation.com.au>
References: <1A29305F-ED36-46CC-A0D4-F2958247E96E@remoteinformation.com.au>
Message-ID: <1291751623.2264.22.camel@Virgilio-Gomez>

Dear Ben,


> I have run into a bit of a problem. In the ASDAR book it shows a method for 
> calculating Confidence Intervals for Standardised Morbidity Ratios using the 
> epitools pois.exact function - but my data is overdispersed. 

The example based on the Poisson-Gamma model will provide credible
intervals (because it is a Bayesian model) of the relative risks for
over-dispersed data. It is also in the chapter on disease mapping in
ASDAR.

Hope this helps,

Virgilio


From moshersteven at gmail.com  Tue Dec  7 21:37:52 2010
From: moshersteven at gmail.com (steven mosher)
Date: Tue, 7 Dec 2010 12:37:52 -0800
Subject: [R-sig-Geo] Performing CCA and plotting spatial patterns
In-Reply-To: <78090.31808.qm@web54302.mail.re2.yahoo.com>
References: <78090.31808.qm@web54302.mail.re2.yahoo.com>
Message-ID: <AANLkTikwjzZmSDycPdTPkTgCU8NEyG7S0-OkWMV6CURw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101207/36533316/attachment.pl>

From francoisrousseu at hotmail.com  Tue Dec  7 21:59:38 2010
From: francoisrousseu at hotmail.com (Francois Rousseu)
Date: Tue, 7 Dec 2010 15:59:38 -0500
Subject: [R-sig-Geo] time zones overwater?
In-Reply-To: <AANLkTin+NzJkt0Dvp=jgTTi9iu7KyCCSYu30wG1AiyQm@mail.gmail.com>
References: <BLU149-W33ACD9AE6063D5B3BF9E99BA2C0@phx.gbl>,
	<AANLkTin+NzJkt0Dvp=jgTTi9iu7KyCCSYu30wG1AiyQm@mail.gmail.com>
Message-ID: <BLU149-W1931D473E99F85148D90A4BA2C0@phx.gbl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101207/992e66e9/attachment.pl>

From b.rowlingson at lancaster.ac.uk  Wed Dec  8 11:53:59 2010
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Wed, 8 Dec 2010 10:53:59 +0000
Subject: [R-sig-Geo] time zones overwater?
In-Reply-To: <BLU149-W1931D473E99F85148D90A4BA2C0@phx.gbl>
References: <BLU149-W33ACD9AE6063D5B3BF9E99BA2C0@phx.gbl>
	<AANLkTin+NzJkt0Dvp=jgTTi9iu7KyCCSYu30wG1AiyQm@mail.gmail.com>
	<BLU149-W1931D473E99F85148D90A4BA2C0@phx.gbl>
Message-ID: <AANLkTi=phr4jA9yiU6qeyV6ZNH-O3=xd9a=eJoc0aKoV@mail.gmail.com>

On Tue, Dec 7, 2010 at 8:59 PM, Francois Rousseu
<francoisrousseu at hotmail.com> wrote:
>
> Thanks. Although, the timezoneId is not given (or doesn't exists?) when the coordinates are in the water, I was able to determine the closest timezoneId by using the geonames url with the radius option. I would suggest adding the radius argument in the GNtimezone function.

 Ooh, I'd not seen that before. So you get the difference between
(note my method of constructing geonames URLS):

 > as.data.frame(geonames:::getJson("timezoneJSON",list(lat=0,lng=-40)))
 rawOffset dstOffset gmtOffset lng lat
   1        -3         0        -3 -40   0

 > as.data.frame(geonames:::getJson("timezoneJSON",list(lat=0,lng=-40,radius=200)))
              time countryName           sunset rawOffset dstOffset countryCode
1 2010-12-08 07:49      Brazil 2010-12-08 17:35        -3        -3          BR
  gmtOffset lng          sunrise        timezoneId lat
1        -3 -40 2010-12-08 05:28 America/Fortaleza   0

I think if I just have a radius=0 default that should suffice. Thanks!

Barry


From edzer.pebesma at uni-muenster.de  Wed Dec  8 16:19:10 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Wed, 08 Dec 2010 16:19:10 +0100
Subject: [R-sig-Geo] spacetime package;
 Workshop on handling and analyzing spatio-temporal data in R, 21-22
 Mar 2011
Message-ID: <4CFFA1EE.8070106@uni-muenster.de>

As we earlier announced here:

http://www.mail-archive.com/r-sig-geo at stat.math.ethz.ch/msg08473.html

we're organizing a two-day workshop on handling spatio-temporal data in
R. We're targeting a small(ish) group, to avoid loosing all the time on
presentation, and to have some time for doing things. The deadline for
application is Dec 15. In case the workshop is not full by then, we will
accept further applications on a case-by-case basis.

The workshop will be free of charge; my institute will offer lunch and
coffee, participants need to pay travel, hotel, and evening diners.

I was asked to give an invited lecture about the topic during the
geoinfo 2010 conference (mostly geoinformaticians, relatively few
statisticians) last week, and have put up the slides here:

http://ifgi.uni-muenster.de/~epebe_01/inpe.pdf

While at INPE I spoke quite extensively with the TerraLib team; in the
next TerraLib release, integrating spatio-temporal data across all kind
of different data types is high on their agenda. To avoid duplicating
existing analysis tools, they want to integrate with R from the start.
We hope that some researchers from the team will attend the workshop.

Some of the prototypical work I did to try things out is found in the
spacetime package on cran; see

http://cran.r-project.org/package=spacetime

If you want to take a look, please do look at the vignette; everything I
tried is in the vignette, there are no examples in the documentation.
While developing package sp five years ago, we restarted from scratch
about three times before things worked the way we liked. Package
spacetime is currently more meant as a start for a discussion than
anything else. I would welcome any reactions on this list.

With best regards,

Katharina
Daniel
Edzer

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From isabelle.boulangeat at gmail.com  Wed Dec  8 17:55:42 2010
From: isabelle.boulangeat at gmail.com (isabelle boulangeat)
Date: Wed, 8 Dec 2010 17:55:42 +0100
Subject: [R-sig-Geo] new function predict, package raster
In-Reply-To: <AANLkTim7K-m6Ebv2_rrv9CBx2uHxOAFGT4MtZ0YLR+7q@mail.gmail.com>
References: <AANLkTikU1d4LrvtOCsVUb3FOVWV+NMcL2cpjvC8Bw8OC@mail.gmail.com>
	<AANLkTim4_1NH-sJE1OkUAgari22wy1_V=AHf8F5MB3v=@mail.gmail.com>
	<AANLkTi=ez4w1dnc3kM00jTL482JAy1MQtyAkhpPBR+dn@mail.gmail.com>
	<AANLkTinLzNRz2CocwHbZ3xyWgMg_zhCSpozJhZXD=99O@mail.gmail.com>
	<AANLkTim7K-m6Ebv2_rrv9CBx2uHxOAFGT4MtZ0YLR+7q@mail.gmail.com>
Message-ID: <AANLkTimd0oOu_DwNrfeHF8GPRqeP6pXQZ94+iG6gjj91@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101208/e50081eb/attachment.pl>

From f.veronesi at cranfield.ac.uk  Wed Dec  8 18:25:38 2010
From: f.veronesi at cranfield.ac.uk (Veronesi, Fabio)
Date: Wed, 8 Dec 2010 17:25:38 +0000
Subject: [R-sig-Geo] Color Scale with Stard and End values
Message-ID: <6E3C09D338C1BB46AD3778BB99012D6005EC3EEAC8@CCEXCHSTORE-2.central.cranfield.ac.uk>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101208/e6ec9a2c/attachment.pl>

From landis at isciences.com  Wed Dec  8 18:58:11 2010
From: landis at isciences.com (Matthew Landis)
Date: Wed, 08 Dec 2010 12:58:11 -0500
Subject: [R-sig-Geo] Color Scale with Stard and End values
In-Reply-To: <6E3C09D338C1BB46AD3778BB99012D6005EC3EEAC8@CCEXCHSTORE-2.central.cranfield.ac.uk>
References: <6E3C09D338C1BB46AD3778BB99012D6005EC3EEAC8@CCEXCHSTORE-2.central.cranfield.ac.uk>
Message-ID: <4CFFC733.7090604@isciences.com>

Fabio,
There are two ways to do it (see ?image):

You can specify min max for all of your images using the zlim argument, 
e.g. zlim = c(min(x), max(x))

Or you can use the breaks argument to control where the colors change.  
Note that I specify large values to catch values outside the desired 
min. and max. and also that there has to be 1 more break than colors.

E.g. image(x, col = terrain.colors(50), breaks = c( -1e99, seq(min(x), 
max(x), length = (51-2), 1e99)).


Matt

On 12/8/2010 12:25 PM, Veronesi, Fabio wrote:
> Hi,
> I'm creating a series of images slicing a 3D dataset and I'm using the option for the function image: col=terrain.colors(50).
> My problem is that, because I have a loop that subset the dataset based on the depth, each image have a slight different range of values of the main variable. Therefore, the color scale changes slightly for each image.
> Is it possible to create a color scale with terrain colors in which I fiz the starting value and the end value?
> So basically I need to say to the program to assign to the color green the data value x.xx (which will be the minimum of my data) and to the value white the maximum of my data.
> Green and white are the two end color of the terrain color scale.
> Many thanks,
> Fabio
>
>
> Mr. Fabio Veronesi
> Ph.D. student
>
> Cranfield University
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
~~~~~~~~~~~~~~~~~~~~~~~~~~
Matthew Landis, Ph.D.
Research Scientist
ISciences, LLC
61 Main St. Suite 200
Burlington VT 05401
802.864.2999
~~~~~~~~~~~~~~~~~~~~~~~~~~


From andy.a.wilson at gmail.com  Wed Dec  8 19:55:33 2010
From: andy.a.wilson at gmail.com (Andy Wilson)
Date: Wed, 08 Dec 2010 18:55:33 +0000
Subject: [R-sig-Geo] R, raster & SAGA
Message-ID: <4CFFD4A5.3090100@googlemail.com>

Hi all,
I'm new to R (and SAGA) and hope you can help resolve a problem which is 
perplexing me. As part of my project i would like to use the 
ta_morphometry module in the RSAGA library to calculate curvatures for a 
DEM. I've cut back my code to the basics below: read the DEM, write this 
into a SAGA format (I think I need to do this to make use of the SAGA 
functions), call the RSAGA function which outputs the data in SAGA 
format and finally read that data file (curve.sdat) into a raster 
object. It seems to work (no errors thrown), but when I try to do 
anything with the curve raster (including just plot it) I get the error 
message "Error in endrow - nrow : non-numeric argument to binary operator".

This all works fine within the SAGA GUI, including plotting the curve 
data, but I still cant read the output data file into R using raster. 
Instead I have to export from SAGA as another format (eg Surfer) in 
order to be able to read the data into a raster object. However I'd like 
to be able to script the process without resorting to using the GUI to 
change the file format.

Many thanks for your advice,
Andy Wilson

library (rgdal)
library (RSAGA)
library(raster)

r_elev <- raster("C:/Dissertation/DEMs/DEM.IMG")

#set environment for SAGA
myenv <- rsaga.env(workspace="C:/Dissertation/SAGA")
#output the DEM raster into a SAGA readable format
writeRaster(r_elev, filename="C:/Dissertation/SAGA/elev.sgrd", 
format="SAGA", overwrite=TRUE)
# call the module function using geoprocessor
rsaga.geoprocessor("ta_morphometry", 0, 
list(ELEVATION="elev.sgrd",SLOPE="slope",ASPECT="aspect", 
CURV="curve",METHOD=5),env=myenv)
#create a raster from the curve data file
r_curve <- raster("C:/Dissertation/SAGA/curve.sgrd")
#plot the curve data
plot(r_curve)


From r.hijmans at gmail.com  Wed Dec  8 22:00:02 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Wed, 8 Dec 2010 13:00:02 -0800
Subject: [R-sig-Geo] R, raster & SAGA
In-Reply-To: <4CFFD4A5.3090100@googlemail.com>
References: <4CFFD4A5.3090100@googlemail.com>
Message-ID: <AANLkTimKeSSVP1AaSGNyE4A+tCzv9aRdXjsRskh1Wkx4@mail.gmail.com>

Andy,
I think I fixed this in raster 1.7-11. Should be available from
R-Forge in 24 hrs. It would be helpful if you could send me the file.
Robert

On Wed, Dec 8, 2010 at 10:55 AM, Andy Wilson <andy.a.wilson at gmail.com> wrote:
> Hi all,
> I'm new to R (and SAGA) and hope you can help resolve a problem which is
> perplexing me. As part of my project i would like to use the ta_morphometry
> module in the RSAGA library to calculate curvatures for a DEM. I've cut back
> my code to the basics below: read the DEM, write this into a SAGA format (I
> think I need to do this to make use of the SAGA functions), call the RSAGA
> function which outputs the data in SAGA format and finally read that data
> file (curve.sdat) into a raster object. It seems to work (no errors thrown),
> but when I try to do anything with the curve raster (including just plot it)
> I get the error message "Error in endrow - nrow : non-numeric argument to
> binary operator".
>
> This all works fine within the SAGA GUI, including plotting the curve data,
> but I still cant read the output data file into R using raster. Instead I
> have to export from SAGA as another format (eg Surfer) in order to be able
> to read the data into a raster object. However I'd like to be able to script
> the process without resorting to using the GUI to change the file format.
>
> Many thanks for your advice,
> Andy Wilson
>
> library (rgdal)
> library (RSAGA)
> library(raster)
>
> r_elev <- raster("C:/Dissertation/DEMs/DEM.IMG")
>
> #set environment for SAGA
> myenv <- rsaga.env(workspace="C:/Dissertation/SAGA")
> #output the DEM raster into a SAGA readable format
> writeRaster(r_elev, filename="C:/Dissertation/SAGA/elev.sgrd",
> format="SAGA", overwrite=TRUE)
> # call the module function using geoprocessor
> rsaga.geoprocessor("ta_morphometry", 0,
> list(ELEVATION="elev.sgrd",SLOPE="slope",ASPECT="aspect",
> CURV="curve",METHOD=5),env=myenv)
> #create a raster from the curve data file
> r_curve <- raster("C:/Dissertation/SAGA/curve.sgrd")
> #plot the curve data
> plot(r_curve)
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From r.hijmans at gmail.com  Wed Dec  8 22:02:08 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Wed, 8 Dec 2010 13:02:08 -0800
Subject: [R-sig-Geo] new function predict, package raster
In-Reply-To: <AANLkTimd0oOu_DwNrfeHF8GPRqeP6pXQZ94+iG6gjj91@mail.gmail.com>
References: <AANLkTikU1d4LrvtOCsVUb3FOVWV+NMcL2cpjvC8Bw8OC@mail.gmail.com>
	<AANLkTim4_1NH-sJE1OkUAgari22wy1_V=AHf8F5MB3v=@mail.gmail.com>
	<AANLkTi=ez4w1dnc3kM00jTL482JAy1MQtyAkhpPBR+dn@mail.gmail.com>
	<AANLkTinLzNRz2CocwHbZ3xyWgMg_zhCSpozJhZXD=99O@mail.gmail.com>
	<AANLkTim7K-m6Ebv2_rrv9CBx2uHxOAFGT4MtZ0YLR+7q@mail.gmail.com>
	<AANLkTimd0oOu_DwNrfeHF8GPRqeP6pXQZ94+iG6gjj91@mail.gmail.com>
Message-ID: <AANLkTimHsO-kqUN0W3U6BkGx51uWuD+W+3oOO1Nk5i57@mail.gmail.com>

Isabelle, I think I fixed this in raster 1.7-11. Robert

On Wed, Dec 8, 2010 at 8:55 AM, isabelle boulangeat
<isabelle.boulangeat at gmail.com> wrote:
> Dear Robert,
>
> I am afraid this doesn't work with a "randomForest" model type (package
> randomForest), although there is no problem without categorical variables.
>
> To be continued...
>
> Isabelle.
>
> 2010/12/6 isabelle boulangeat <isabelle.boulangeat at gmail.com>
>>
>> Dear Robert,
>>
>> I tested today my script with the package 1.7-9 and it works!
>>
>> Pred_fac <- predict(rasStack, model=model_fac, predict = predict.glm,
>> type="response", progress='text')
>>
>> Thanks a lot.
>>
>> Isabelle.
>>
>> 2010/12/3 Robert J. Hijmans <r.hijmans at gmail.com>
>>>
>>> Dear Isabelle,
>>>
>>> Thanks for the detailed report. So it is a bug after all. This is
>>> probably fixed in raster 1.7-8 (on CRAN for win and lin now).
>>> At least the below works for me (model with 2 variables, one is a
>>> factor).
>>>
>>> Robert
>>>
>>> library(raster)
>>> # create a RasterStack (a set of predictor rasters)
>>> logo <- stack(system.file("external/rlogo.grd", package="raster"))
>>> presence <- matrix(c(48, 48, 48, 53, 50, 46, 54, 70, 84, 85, 74, 84,
>>> 95, 85, 66, 42, 26, 4, 19, 17, 7, 14, 26, 29, 39, 45, 51, 56, 46, 38,
>>> 31, 22, 34, 60, 70, 73, 63, 46, 43, 28), ncol=2)
>>> background <- cbind(runif(250)*(xmax(logo)-xmin(logo))+xmin(logo),
>>> runif(250)*(ymax(logo)-ymin(logo))+ymin(logo))
>>>
>>> xy <- rbind(cbind(1, presence), cbind(0, background))
>>> v <- cbind(xy[,1], extract(logo, xy[,2:3]))
>>> colnames(v)[1] <- 'presback'
>>> v=data.frame(v[,1:3])
>>> v[,3] <- as.factor(v[,3])
>>>
>>> model <- glm(formula=presback~., data=v)
>>> r <- predict(logo, model, progress='text')
>>>
>>>
>>>
>>>
>>> On Fri, Dec 3, 2010 at 3:26 AM, isabelle boulangeat
>>> <isabelle.boulangeat at gmail.com> wrote:
>>> > Hi,
>>> >
>>> > Thanks for all these explanations. I misunderstood the use of the
>>> > "const".
>>> > In my case, I just need to deal with an explicative variable that is
>>> > spatially explicit but categorial.
>>> > I should use a raster with numbers that correspond to my factor's
>>> > levels.
>>> > However, I still have some problems to predict using the categorial
>>> > variable
>>> > (raster package, version 1.7-7)
>>> >
>>> > my code : predict(rasStack, model=model_fac)
>>> > Error message : Erreur dans v[cells, ] <- predv :
>>> >
>>> > Here are details on the raster Stack and the data.frame containing
>>> > explicative variables to fit the model (expl).
>>> >
>>> > rasStack
>>> > class?????? : RasterStack
>>> > nlayers???? : 2
>>> > nrow??????? : 3137
>>> > ncol??????? : 1951
>>> > ncell?????? : 6120287
>>> > projection? : +proj=lcc +lat_1=45.89891888888889
>>> > +lat_2=47.69601444444444
>>> > +lat_0=46.8 +lon_0=2.337229166666667 +x_0=600000 +y_0=2200000
>>> > +ellps=WGS84
>>> > +datum=WGS84 +units=m +no_defs +towgs84=0,0,0
>>> > min value?? : -1280???? 1
>>> > max value?? : 462?? 7
>>> > extent????? : 784300, 979400, 1858800, 2172500? (xmin, xmax, ymin,
>>> > ymax)
>>> > resolution? : 100, 100? (x, y)
>>> >
>>> > layerNames(rasStack)
>>> > [1] "temp"?? "corine"
>>> >
>>> > unique(getValues(rasStack[[2]]))
>>> > [1] NA? 6? 5? 1? 7? 4? 2? 3
>>> >
>>> > str(expl)
>>> > 'data.frame':?? 11396 obs. of? 2 variables:
>>> > ?$ temp? : num? -78.4 -282.9 -172.1 -173.6 -83.2 ...
>>> > ?$ corine: Factor w/ 7 levels "1","2","3","4",..: 6 4 3 4 5 6 6 4 5 6
>>> > ...
>>> >
>>> > unique(expl$corine)
>>> > [1] 6 4 3 5 7 2 1
>>> > Levels: 1 2 3 4 5 6 7
>>> >
>>> > model_fac <- glm(resp ~ ., data=expl, family="binomial")
>>> >
>>> >
>>> > Any idea?
>>> >
>>> > 2010/12/2 Robert J. Hijmans <r.hijmans at gmail.com>
>>> >>
>>> >> Isabelle,
>>> >>
>>> >> If you use a factor that is represented by numbers on a grid you can
>>> >> just fit the model (with the factor variable as factor), and the
>>> >> predict function will then make a factor from the predictor layers
>>> >> (i.e. there is nothing else you need to do). Where this can go wrong
>>> >> is if you have factor levels on your raster that were not in the data
>>> >> used to fit the model. You can get something like:
>>> >> Error in model.frame.default(Terms, newdata, na.action = na.action,
>>> >> xlev = object$xlevels) :
>>> >> ?factor 'x' has new level(s): ?2, 3, 4, 5,
>>> >> Which means that you first need to remove those levels (set to NA)
>>> >> from your predictor raster. (I will try to automate that problem away,
>>> >> in raster::predict, eventually)
>>> >>
>>> >> The argument "const" is for factor type variables for which you do not
>>> >> have spatial data. Hence they could be considered 'constant' in some
>>> >> contexts. For example, with fish observation data you might have a
>>> >> model that predicts abundance from a number of variables including the
>>> >> method used to catch the fish. Say a factor variable "method" with
>>> >> levels "A" or "B". You can then do something like
>>> >> method = factor("A")
>>> >> predict(raster, model, const=method)
>>> >>
>>> >> Robert
>>> >>
>>> >> On Thu, Dec 2, 2010 at 9:02 AM, isabelle boulangeat
>>> >> <isabelle.boulangeat at gmail.com> wrote:
>>> >> > Hello,
>>> >> >
>>> >> > I am trying to use the recently updated function "predict" from the
>>> >> > package
>>> >> > raster. I would like to use the field "const", as one of my variable
>>> >> > is
>>> >> > categorial.
>>> >> > I have an error message but I can't find where is the problem.
>>> >> >
>>> >> > Error message : Erreur dans `[.data.frame`(blockvals, , f[i]) :
>>> >> > undefined
>>> >> > columns selected
>>> >> >
>>> >> > code : Pred_fac <- predict(rasStack, model=model_fac,
>>> >> > predict=predict.glm,
>>> >> > progress='text', const=factorDF)
>>> >> >
>>> >> > rasStack is a RasterStack and contains only one layer with one
>>> >> > explicative
>>> >> > variable. the layer name is the same as in the model.
>>> >> > factorDF is a data.frame and contains only one column with one
>>> >> > explicative
>>> >> > variable. the column name is the same as in the model.
>>> >> >
>>> >> > the dimensions are the same : the number of rows in the data frame
>>> >> > correspond to the number of cells in the raster.
>>> >> >
>>> >> > Does someone succeed to use this function with the new field "const"
>>> >> > ?
>>> >> >
>>> >> > Thanks for help,
>>> >> >
>>> >> > Cheers,
>>> >> >
>>> >> > Isabelle.
>>> >> >
>>> >> > --
>>> >> > Isabelle Boulangeat, PhD student
>>> >> > Ecosystem dynamics and plant traits
>>> >> >
>>> >> > Bureau 203, +33 (0) 476 635 733
>>> >> >
>>> >> > Laboratoire d'?cologie Alpine (LECA)
>>> >> > Grenoble, France
>>> >> > lab' s website : http://www-leca.ujf-grenoble.fr/
>>> >> > my website : http://j.boulangeat.free.fr/
>>> >> >
>>> >> > ? ? ? ?[[alternative HTML version deleted]]
>>> >> >
>>> >> >
>>> >> > _______________________________________________
>>> >> > R-sig-Geo mailing list
>>> >> > R-sig-Geo at r-project.org
>>> >> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>> >> >
>>> >> >
>>> >
>>> >
>>> >
>>> > --
>>> > Isabelle Boulangeat, PhD student
>>> > Ecosystem dynamics and plant traits
>>> >
>>> > Bureau 203, +33 (0) 476 635 733
>>> >
>>> > Laboratoire d'?cologie Alpine (LECA)
>>> > Grenoble, France
>>> > lab' s website : http://www-leca.ujf-grenoble.fr/
>>> > my website : http://j.boulangeat.free.fr/
>>> >
>>
>>
>>
>> --
>> Isabelle Boulangeat, PhD student
>> Ecosystem dynamics and plant traits
>>
>> Bureau 203, +33 (0) 476 635 733
>>
>> Laboratoire d'?cologie Alpine (LECA)
>> Grenoble, France
>> lab' s website : http://www-leca.ujf-grenoble.fr/
>> my website : http://j.boulangeat.free.fr/
>
>
>
> --
> Isabelle Boulangeat, PhD student
> Ecosystem dynamics and plant traits
>
> Bureau 203, +33 (0) 476 635 733
>
> Laboratoire d'?cologie Alpine (LECA)
> Grenoble, France
> lab' s website : http://www-leca.ujf-grenoble.fr/
> my website : http://j.boulangeat.free.fr/
>


From rhurlin at gwdg.de  Wed Dec  8 22:11:09 2010
From: rhurlin at gwdg.de (Rainer Hurling)
Date: Wed, 08 Dec 2010 22:11:09 +0100
Subject: [R-sig-Geo] R, raster & SAGA
In-Reply-To: <4CFFD4A5.3090100@googlemail.com>
References: <4CFFD4A5.3090100@googlemail.com>
Message-ID: <4CFFF46D.7050802@gwdg.de>

On 08.12.2010 19:55 (UTC+1), Andy Wilson wrote:
> Hi all,
> I'm new to R (and SAGA) and hope you can help resolve a problem which is
> perplexing me. As part of my project i would like to use the
> ta_morphometry module in the RSAGA library to calculate curvatures for a
> DEM. I've cut back my code to the basics below: read the DEM, write this
> into a SAGA format (I think I need to do this to make use of the SAGA
> functions), call the RSAGA function which outputs the data in SAGA
> format and finally read that data file (curve.sdat) into a raster
> object. It seems to work (no errors thrown), but when I try to do
> anything with the curve raster (including just plot it) I get the error
> message "Error in endrow - nrow : non-numeric argument to binary operator".
>
> This all works fine within the SAGA GUI, including plotting the curve
> data, but I still cant read the output data file into R using raster.
> Instead I have to export from SAGA as another format (eg Surfer) in
> order to be able to read the data into a raster object. However I'd like
> to be able to script the process without resorting to using the GUI to
> change the file format.
>
> Many thanks for your advice,
> Andy Wilson
>
> library (rgdal)
> library (RSAGA)
> library(raster)
>
> r_elev <- raster("C:/Dissertation/DEMs/DEM.IMG")
>
> #set environment for SAGA
> myenv <- rsaga.env(workspace="C:/Dissertation/SAGA")
> #output the DEM raster into a SAGA readable format
> writeRaster(r_elev, filename="C:/Dissertation/SAGA/elev.sgrd",
> format="SAGA", overwrite=TRUE)
> # call the module function using geoprocessor
> rsaga.geoprocessor("ta_morphometry", 0,
> list(ELEVATION="elev.sgrd",SLOPE="slope",ASPECT="aspect",
> CURV="curve",METHOD=5),env=myenv)
> #create a raster from the curve data file
> r_curve <- raster("C:/Dissertation/SAGA/curve.sgrd")

As a workaround until raster 1.7-11 is available the following step 
should work (note that you have to use '.sdat' instead of '.sgrd' with 
rgdal):

r_curve <- raster(readGDAL("C:/Dissertation/SAGA/curve.sdat"))

Hope this helps,
Rainer Hurling


> #plot the curve data
> plot(r_curve)


From agnes.kaczmarczyk at gmail.com  Thu Dec  9 00:10:11 2010
From: agnes.kaczmarczyk at gmail.com (Agnieszka Kaczmarczyk)
Date: Thu, 9 Dec 2010 00:10:11 +0100
Subject: [R-sig-Geo] problem with gridded
Message-ID: <AANLkTi=KhX_rbuJ9wXOJf7_Gm-nOoG3TdjMv_-Dz1hAZ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101209/dec36359/attachment.pl>

From josh.london at noaa.gov  Thu Dec  9 01:21:31 2010
From: josh.london at noaa.gov (Josh London)
Date: Wed, 08 Dec 2010 16:21:31 -0800
Subject: [R-sig-Geo] graticules for projected data
Message-ID: <7413BB3B-8C84-4860-866E-F9EFDD7D1058@noaa.gov>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101208/ba706f4c/attachment.pl>

From thi_veloso at yahoo.com.br  Thu Dec  9 02:41:15 2010
From: thi_veloso at yahoo.com.br (Thiago Veloso)
Date: Wed, 8 Dec 2010 17:41:15 -0800 (PST)
Subject: [R-sig-Geo] Performing CCA and plotting spatial patterns
In-Reply-To: <AANLkTikwjzZmSDycPdTPkTgCU8NEyG7S0-OkWMV6CURw@mail.gmail.com>
Message-ID: <431131.69834.qm@web54302.mail.re2.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101208/1cca549b/attachment.pl>

From ted.rosenbaum at yale.edu  Thu Dec  9 05:25:24 2010
From: ted.rosenbaum at yale.edu (Ted Rosenbaum)
Date: Wed, 8 Dec 2010 23:25:24 -0500
Subject: [R-sig-Geo] missing counties in maps package
In-Reply-To: <AANLkTimUU+KhLVBQxA6COT1JHPn2LUUOruDA-_Yw2mG7@mail.gmail.com>
References: <AANLkTimUU+KhLVBQxA6COT1JHPn2LUUOruDA-_Yw2mG7@mail.gmail.com>
Message-ID: <AANLkTi=EhXVSebB5Dr_tgDdcZ5Ou+jr=RmPFhmfhcuYJ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101208/9bf5da3f/attachment.pl>

From pierre.roudier at gmail.com  Thu Dec  9 06:28:38 2010
From: pierre.roudier at gmail.com (Pierre Roudier)
Date: Thu, 9 Dec 2010 18:28:38 +1300
Subject: [R-sig-Geo] problem with gridded
In-Reply-To: <AANLkTi=KhX_rbuJ9wXOJf7_Gm-nOoG3TdjMv_-Dz1hAZ@mail.gmail.com>
References: <AANLkTi=KhX_rbuJ9wXOJf7_Gm-nOoG3TdjMv_-Dz1hAZ@mail.gmail.com>
Message-ID: <AANLkTinbjB6_etSxcr3Vi4ogMA244-szDRMXvXXPc7=9@mail.gmail.com>

Hi Agnieszka,

This question is not easy to answer because unfortunately you gave
very few details. I assume you want to use the function gridded() on
your dataset alu.

First thing you have to do is to make your dataset a Spatial object.
This is done using the coordinates() function:

library(sp)
coordinates(alu) <- ~x+y # Again, I'm just guessing x and y are the
spatial coordinates
class(alu)

The class of alu should be "SpatialDataFrame"

If your data set is on a *regular* grid, you may want to use the
gridded() function to make alu a Grid:

gridded(alu) <- TRUE

At this point, you may have the following error:
suggested tolerance minimum: 0.142857142857143
Error in points2grid(points, tolerance, round, fuzz.tol) :
  dimension 1 : coordinate intervals are not constant

This means your data set is not regularly gridded. You may want to use
the points2grid function, which has a tolerance parameter.
If your dataset is not gridded, and you need to generate a prediction
grid (eg for kriging), I advise you to use the spsample function (see
?spsample).

hope this helps,

Pierre


2010/12/9 Agnieszka Kaczmarczyk <agnes.kaczmarczyk at gmail.com>:
> Hello,
> I have to gridded my data alu:
> class(alu)
> [1] "data.frame"
> alu[1:3,1:3]
> ? ? ? ?x ? ? ? y ? al
> 1 4384104 5570084 0.20
> 2 4384068 5570297 0.15
> 3 4384111 5570551 0.08
> I use function: gridded(), spsample(),points2grid(),GridTopology(),
> expand.grid() ect.
> I read The meuse data set: a tutorial for the gstat R package and other
> tutorial for R. I can't solve this problem. I'm interesting geostatistic
> simulation. Can you help me with my problem?
> With best regards,
> Agnieszka
>
> ? ? ? ?[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From alobolistas at gmail.com  Thu Dec  9 09:56:50 2010
From: alobolistas at gmail.com (Agustin Lobo)
Date: Thu, 9 Dec 2010 09:56:50 +0100
Subject: [R-sig-Geo] Suggestion: option overwrite=T for writeOGR()
Message-ID: <AANLkTi=D5_u6K67jCtwSafxOpNZ34rJHfSCnGQSSLpOs@mail.gmail.com>

Hi!

Could an option overwrite=T (default overwrite=F) be included in writeOGR()?
Thanks!

Agus


From jim at bitwrit.com.au  Thu Dec  9 10:12:36 2010
From: jim at bitwrit.com.au (Jim Lemon)
Date: Thu, 09 Dec 2010 20:12:36 +1100
Subject: [R-sig-Geo] Color Scale with Stard and End values
In-Reply-To: <6E3C09D338C1BB46AD3778BB99012D6005EC3EEAC8@CCEXCHSTORE-2.central.cranfield.ac.uk>
References: <6E3C09D338C1BB46AD3778BB99012D6005EC3EEAC8@CCEXCHSTORE-2.central.cranfield.ac.uk>
Message-ID: <4D009D84.9040902@bitwrit.com.au>

On 12/09/2010 04:25 AM, Veronesi, Fabio wrote:
> Hi,
> I'm creating a series of images slicing a 3D dataset and I'm using the option for the function image: col=terrain.colors(50).
> My problem is that, because I have a loop that subset the dataset based on the depth, each image have a slight different range of values of the main variable. Therefore, the color scale changes slightly for each image.
> Is it possible to create a color scale with terrain colors in which I fiz the starting value and the end value?
> So basically I need to say to the program to assign to the color green the data value x.xx (which will be the minimum of my data) and to the value white the maximum of my data.
> Green and white are the two end color of the terrain color scale.

Hi Fabio,
If you just want the colors to change linearly with the values in a 
numeric scale that extends beyond the observed values, look at the 
second example for the barp function in the plotrix package. color.scale 
is not the only way to do this, but the method used there will work with 
other color scaling functions.
Jim


From educheyne at avia-gis.be  Thu Dec  9 11:06:20 2010
From: educheyne at avia-gis.be (Els Ducheyne)
Date: Thu, 9 Dec 2010 11:06:20 +0100
Subject: [R-sig-Geo] !SPAM: row.names of data and coords do not match
Message-ID: <35A52E73-3F78-499B-B085-FE55BD86729E@avia-gis.be>

Dear list
I am using gstat version 0.9-69 and sp 0.9-65 in R 2.11.1 Leopard build 32-bit

I am kriging a surface from point observations. The kriged surface is generated without problems. However when I try to crossvalidate I get the following error:
ph.ok .cv<- krige.cv(AVE_MEAN~1,ph,vt.fit)
Error in SpatialPointsDataFrame(coordinates(data), data.frame(matrix(as.numeric(NA),  : 
 row.names of data and coords do not match

where ph a SpatialPointsDataFrame, AVE_MEAN is the parameter to krige and a column in ph, and vt.fit is the fitted variogram
> summary(ph)
Object of class SpatialPointsDataFrame
Coordinates:
              min      max
coords.x1  2.62289  6.13355
coords.x2 49.74510 51.50510
Is projected: FALSE 
proj4string :
[+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs +towgs84=0,0,0]
Number of points: 67
Data attributes:
   MAX_MEAN       MIN_MEAN        AVE_MEAN       predicted     
Min.   :2005   Min.   :7.147   Min.   :7.066   Min.   : 7.096  
1st Qu.:2007   1st Qu.:7.738   1st Qu.:7.640   1st Qu.: 7.601  
Median :2008   Median :7.885   Median :7.740   Median : 7.729  
Mean   :2007   Mean   :7.888   Mean   :7.748   Mean   : 7.741  
3rd Qu.:2008   3rd Qu.:8.069   3rd Qu.:7.857   3rd Qu.: 7.876  
Max.   :2008   Max.   :8.560   Max.   :8.528   Max.   : 8.333  
                                               NA's   :19.000 



I have come across a message where it was stated that the locations should be coerced into a separate object but i have not idea how to implement this
Any ideas
Thanks in advance
Els


From ageel_bushara at yahoo.com  Thu Dec  9 11:16:28 2010
From: ageel_bushara at yahoo.com (Ageel Ibrahim Bushara)
Date: Thu, 9 Dec 2010 02:16:28 -0800 (PST)
Subject: [R-sig-Geo] !SPAM: row.names of data and coords do not match
Message-ID: <490343.58283.qm@web35802.mail.mud.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101209/65aef17d/attachment.pl>

From b.rowlingson at lancaster.ac.uk  Thu Dec  9 11:17:00 2010
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Thu, 9 Dec 2010 10:17:00 +0000
Subject: [R-sig-Geo] Suggestion: option overwrite=T for writeOGR()
In-Reply-To: <AANLkTi=D5_u6K67jCtwSafxOpNZ34rJHfSCnGQSSLpOs@mail.gmail.com>
References: <AANLkTi=D5_u6K67jCtwSafxOpNZ34rJHfSCnGQSSLpOs@mail.gmail.com>
Message-ID: <AANLkTi=YfZOgvP_75+skqZvTxmZ_bVMZfXN7SMfCsQRb@mail.gmail.com>

On Thu, Dec 9, 2010 at 8:56 AM, Agustin Lobo <alobolistas at gmail.com> wrote:
> Hi!
>
> Could an option overwrite=T (default overwrite=F) be included in writeOGR()?
> Thanks!

Submit a Feature Request here:

http://sourceforge.net/tracker/?group_id=84716&atid=573625

 It looks like it just needs to be a wrapper around OGR's delete layer function.

Barry


From pierre.roudier at gmail.com  Thu Dec  9 21:22:19 2010
From: pierre.roudier at gmail.com (Pierre Roudier)
Date: Fri, 10 Dec 2010 09:22:19 +1300
Subject: [R-sig-Geo] graticules for projected data
In-Reply-To: <7413BB3B-8C84-4860-866E-F9EFDD7D1058@noaa.gov>
References: <7413BB3B-8C84-4860-866E-F9EFDD7D1058@noaa.gov>
Message-ID: <AANLkTi=tkFAOqTC3oy24iX94puik0rJdj02oJFm55pgR@mail.gmail.com>

That really is a neat piece of code. Very interested - the result
looks very much like a ggplot2 plot, which I'm a big fan.

Cheers,

Pierre

2010/12/9 Josh London <josh.london at noaa.gov>:
> Hello
>
> One of the features I often find myself wanting within spplot is the ability to produce graticules (with corresponding axis labels) that represent latitude/longitude lines for projected data. I often find myself searching the R archives and google for examples and methods for accomplishing this, but have always come up empty.
>
> This has been partially possible by using the gridlines() function within sp and then projecting those spatial lines to the desired projection. There are two drawbacks to this solution:
>
> 1) Often the extent of the projected gridlines is smaller than the data of interest so the lines stop short of the plot borders
>
> 2) There is no documented method I've found for producing the axis labels with degree units for each of the gridlines. gridat() is close but only supports unprojected data
>
> So, I ventured forth and pulled together a few functions that attempt to provide a generalized solution in the hopes that a) there's not some existing, obvious, solution my endless searching has overlooked and b) other folks could take advantage of it and maybe expand/improve on it.
>
> I've pulled everything together in a draft package, ProjectedGridlines, and it is available on GitHub (https://github.com/jmlondon/ProjectedGridlines). I've got some basic draft documentation in there for those interested.
>
> I make no claims to the code being elegant or an approach that will work for everyone. The main purpose here was to get something that works and distribute it.
>
> Below, I include the three functions and a reproducible example based on the north carolina dataset included with the maptools package. I've copied over some of the roxygen documentation, but those interested in more details should check the files on GitHub.
>
> Cheers
> Josh
>
> GetGratLines<-function(spobj,proj_str,exp_deg,ndisc=500,...){
> ? ? ? ?spobj at bbox[1,1]<-spobj at bbox[1,1]+exp_deg$l
> ? ? ? ?spobj at bbox[1,2]<-spobj at bbox[1,2]+exp_deg$r
> ? ? ? ?spobj at bbox[2,1]<-spobj at bbox[2,1]+exp_deg$b
> ? ? ? ?spobj at bbox[2,2]<-spobj at bbox[2,2]+exp_deg$t
> ? ? ? ?gl<-spTransform(gridlines(spobj,ndisc=ndisc,...),CRS(proj_str))
> ? ? ? ?return(gl)
> }
>
> #' @param spobj an unrpojected sp object that is the basis of the final projected outcome
> #' @param proj_str a proj4 string specifying the desired projection
> #' @param exp_deg is a named list with values l,r,b,t specifying the amount in decimal
> #' degrees each side (left, right, bottom, top) should be expanded to account for differences
> #' in extent between the projected gridlines and the final projected extent of spobj
> #' @param ... passing of parameters relevant to gridlines()
>
> GetDegreeLabels<-function(spobj){
> ? ? ? ?ewl<-coordinates(gridlines(spobj)["EW"]@lines[[1]])
> ? ? ? ?nsl<-coordinates(gridlines(spobj)["NS"]@lines[[1]])
> ? ? ? ?ewLabels<-lapply(ewl,function(x) {return(x[1,1])})
> ? ? ? ?nsLabels<-lapply(nsl,function(x) {return(x[1,2])})
> ? ? ? ?return(list(EW_Labels=unlist(ewLabels),NS_Labels=unlist(nsLabels)))
> }
>
> #' @param spobj an unrpojected sp object that is the basis of the final projected outcome
>
> GetLabelCoords<-function(gl,offset=list(ew=0,ns=0)){
> ? ? ? ?ewc<-coordinates(gl["EW"]@lines[[1]])
> ? ? ? ?nsc<-coordinates(gl["NS"]@lines[[1]])
> ? ? ? ?ewCoords<-lapply(ewc,function(x) {return(x[1,1])})
> ? ? ? ?nsCoords<-lapply(nsc,function(x) {return(x[1,2])})
> ? ? ? ?ewCoords<-lapply(ewCoords,function(x) {return(x+offset$ew)})
> ? ? ? ?nsCoords<-lapply(nsCoords,function(x) {return(x+offset$ns)})
> ? ? ? ?return(list(EW_Coords=unlist(ewCoords),NS_Coords=unlist(nsCoords)))
> }
>
> #' @param gl the SpatialLines object returned from GetGratLines
> #' @param offset a named list with values ew and ns specifying an offset for all labels on the axis
>
> And an example:
>
> library(sp)
> library(rgdal)
> library(maptools)
> library(RColorBrewer)
>
> #read in the maptools north carolina shapefile, unprojected
> d <- readShapePoly(system.file("shapes/sids.shp", package="maptools")[1], proj4string=CRS("+proj=longlat +datum=NAD27"))
>
> # create a dummy factor variable, with equal labels:
> set.seed(31)
> d$f = factor(sample(1:5,100,replace=T),labels=letters[1:5])
>
> #specify a custom Albers equal centered on the coordinate data
> #this works for points and polygons, but lines need to be converted to points
> med.lat <- round(median(coordinates(d)[,2]))
> med.lon <- round(median(coordinates(d)[,1]))
> lat1<-bbox(d)[2,1]+diff(range(bbox(d)[2,]))/3
> lat2<-bbox(d)[2,2]-diff(range(bbox(d)[2,]))/3
>
> myProj <- paste("+proj=aea +lat_1=",lat1," +lat_2=",lat2," +lat_0=",med.lat,
> ? ? ? ? ? ? ? ?" +lon_0=", med.lon, "+x_0=0 +y_0=0 +ellps=GRS80 +datum=NAD83 +units=m",sep="")
>
> #project the data, the graticule lines. note the gridlines function calls the unprojected data
> d.proj <- spTransform(d,CRS(myProj))
> #grat.lines<-spTransform(gridlines(d,ndisc=500),CRS(myProj))
> g<-GetGratLines(d,myProj,list(t=0.25,b=-0.25,l=-0.25,r=0.25))
> #create the sp.layout component for the graticule lines
> grat.plot<-list("sp.lines",g,lwd="1.5",col="white",first=TRUE)
>
> x_grat_at<-GetLabelCoords(g,offset=list(ew=0))$EW_Coords
>
> y_grat_at<-GetLabelCoords(g,offset=list(ns=0))$NS_Coords
>
> x_grat<-list(draw=TRUE,
> ? ? ? ? ? ? ? ?at=x_grat_at,
> ? ? ? ? ? ? ? ?labels=as.character(GetDegreeLabels(d)$EW_Labels),
> ? ? ? ? ? ? ? ?tck=c(0,0),
> ? ? ? ? ? ? ? ?cex=0.75)
>
> y_grat<-list(draw=TRUE,
> ? ? ? ? ? ? ? ?at=y_grat_at,
> ? ? ? ? ? ? ? ?labels=as.character(GetDegreeLabels(d)$NS_Labels),
> ? ? ? ? ? ? ? ?rot=90,
> ? ? ? ? ? ? ? ?tck=c(0,0),
> ? ? ? ? ? ? ? ?cex=0.75)
>
> spplot(d.proj, c("f"),
> ? ? ? ? ? ? ? ?panel=function(...){
> ? ? ? ? ? ? ? ? ? ? ? ?panel.fill(col="gray90")
> ? ? ? ? ? ? ? ? ? ? ? ?panel.polygonsplot(...)
> ? ? ? ? ? ? ? ?},
> ? ? ? ? ? ? ? ?sp.layout=list(grat.plot),
> ? ? ? ? ? ? ? ?col.regions=brewer.pal(5, "Set3"),scales=list(x=x_grat,y=y_grat))
>
>
>
>
>
> ? ? ? ?[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From pierre.roudier at gmail.com  Thu Dec  9 22:02:30 2010
From: pierre.roudier at gmail.com (Pierre Roudier)
Date: Fri, 10 Dec 2010 10:02:30 +1300
Subject: [R-sig-Geo] suggestion for spgrass6 - temp file in readVECT6
Message-ID: <AANLkTimqaOuLM46-N6=aYjKA6NotAt8hXjSK2hj2P3HX@mail.gmail.com>

Dear all,

I got a suggestion for spgrass6. As far as I understand it, a
temporary ESRI shapefile is written on the disk when using
readVECT6('foo'), I guess then R is using rgdal to read that shapefile
back in memory. Considering the various limitations of the ESRI
shapefile format that does not occur with the GRASS internal format,
could it be possible to add an option to choose the OGR format used in
that process?

Also got a question for Roger I guess: I'm using now the grass7 svn
trunk, should I expect any problems using the spgrass6 interface (I
mean problems due to structural differences that appears in grass7
that would not be handled by spgrass6, not problems due to grass7
itself).

Thanks,

Pierre


From debeaudette at ucdavis.edu  Thu Dec  9 22:31:44 2010
From: debeaudette at ucdavis.edu (Dylan Beaudette)
Date: Thu, 9 Dec 2010 13:31:44 -0800
Subject: [R-sig-Geo] suggestion for spgrass6 - temp file in readVECT6
In-Reply-To: <AANLkTimqaOuLM46-N6=aYjKA6NotAt8hXjSK2hj2P3HX@mail.gmail.com>
References: <AANLkTimqaOuLM46-N6=aYjKA6NotAt8hXjSK2hj2P3HX@mail.gmail.com>
Message-ID: <201012091331.45055.dylan.beaudette@gmail.com>

On Thursday, December 09, 2010, Pierre Roudier wrote:
> Dear all,
> 
> I got a suggestion for spgrass6. As far as I understand it, a
> temporary ESRI shapefile is written on the disk when using
> readVECT6('foo'), I guess then R is using rgdal to read that shapefile
> back in memory. Considering the various limitations of the ESRI
> shapefile format that does not occur with the GRASS internal format,
> could it be possible to add an option to choose the OGR format used in
> that process?
> 
> Also got a question for Roger I guess: I'm using now the grass7 svn
> trunk, should I expect any problems using the spgrass6 interface (I
> mean problems due to structural differences that appears in grass7
> that would not be handled by spgrass6, not problems due to grass7
> itself).
> 
> Thanks,
> 
> Pierre
> 

This is an excellent point Pierre, and something that has caused significant 
pain the past-- in terms of column names and NULL value handling. Not 
everyone's GDAL/OGR will be configured in the same way-- so I don't know if 
altering the default behavior would be wise. However, adding an option (as you 
suggested) to use some other format, such as SQLite, would give power users a 
nice alternative to SHP format. SQLite would allow for longer field names, 
proper support for NULL data, and probably some other 'good things'.

Dylan



-- 
Dylan Beaudette
Soil Resource Laboratory
http://casoilresource.lawr.ucdavis.edu/
University of California at Davis
530.754.7341


From haileyeckstrand at gmail.com  Fri Dec 10 00:10:48 2010
From: haileyeckstrand at gmail.com (Hailey Eckstrand)
Date: Thu, 9 Dec 2010 15:10:48 -0800
Subject: [R-sig-Geo] polygon intersecting with point question
Message-ID: <AANLkTimeSgwt_fFf8pijjAOCi7N7CsmOuqF3AoxwC5=P@mail.gmail.com>

Hello,
I have 2 spatial objects, a SpatialPointsDataFrame objects with 4 points,
and a SpatialPolygons object with 3 polygons.

I created the SpatialPolygons object by using the gBuffer function from the
rgeos package.
What I am trying to do is find a function that will return a count or a
subset of the SpatialPolygons object that intersects with the points.
In this example, it should return the count of 3 polygons, or a
SpatialPolygons object with all 3 polygons in it. Since there are 2 points
within one polygon, it would be alright if it returned the same polygon
twice, so then the expected output would be a SpatialPolygons objects with 4
polygons in it & 2 would be duplicates.

If there is no function that will do what I am requesting.. then I could
iterate through the polygons, and use an overlay statement. So then the
other question would be, how does one iterate through the polygons within a
SpatialPolygons object.
Thanks!

I have included an image of the points & polygons and I have also including
the structures:
str(my.pts)
Formal class 'SpatialPointsDataFrame' [package "sp"] with 5 slots
  ..@ data       :'data.frame': 4 obs. of  3 variables:
  .. ..$ Agency    : chr [1:4] "EC-Surface Wx" "EC-Surface Wx" "EC-Daily
Climat" "EC-Daily Climat"
  .. ..$ Station_Co: chr [1:4] "1018620" "1018598" "1022571" "1012573"
  .. ..$ id        : int [1:4] 1 2 3 4
  ..@ coords.nrs : num(0)
  ..@ coords     : num [1:4, 1:2] 1189982 1199727 1164557 1167413 406887 ...
  .. ..- attr(*, "dimnames")=List of 2
  .. .. ..$ : NULL
  .. .. ..$ : chr [1:2] "coords.x1" "coords.x2"
  ..@ bbox       : num [1:2, 1:2] 1164557 386154 1199727 418120
  .. ..- attr(*, "dimnames")=List of 2
  .. .. ..$ : chr [1:2] "coords.x1" "coords.x2"
  .. .. ..$ : chr [1:2] "min" "max"
  ..@ proj4string:Formal class 'CRS' [package "sp"] with 1 slots
  .. .. ..@ projargs: chr " +init=epsg:3005 +proj=aea +lat_1=50 +lat_2=58.5
+lat_0=45 +lon_0=-126 +x_0=1000000 +y_0=0 +ellps=GRS80 +datum=NAD83 +units=m
+"| __truncated__

str(my.poly)
Formal class 'SpatialPolygons' [package "sp"] with 4 slots
  ..@ polygons   :List of 1
  .. ..$ :Formal class 'Polygons' [package "sp"] with 5 slots
  .. .. .. ..@ Polygons :List of 3
  .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
  .. .. .. .. .. .. ..@ labpt  : num [1:2] 1188981 385285
  .. .. .. .. .. .. ..@ area   : num 7.06e+08
  .. .. .. .. .. .. ..@ hole   : logi FALSE
  .. .. .. .. .. .. ..@ ringDir: int 1
  .. .. .. .. .. .. ..@ coords : num [1:39, 1:2] 1177292 1178815 1181603
1184693 1187783 ...
  .. .. .. .. .. .. .. ..- attr(*, "dimnames")=List of 2
  .. .. .. .. .. .. .. .. ..$ : NULL
  .. .. .. .. .. .. .. .. ..$ : chr [1:2] "x" "y"
  .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
  .. .. .. .. .. .. ..@ labpt  : num [1:2] 1189982 406887
  .. .. .. .. .. .. ..@ area   : num 3.09e+08
  .. .. .. .. .. .. ..@ hole   : logi FALSE
  .. .. .. .. .. .. ..@ ringDir: int 1
  .. .. .. .. .. .. ..@ coords : num [1:21, 1:2] 1199982 1199493 1198072
1195860 1193072 ...
  .. .. .. .. .. .. .. ..- attr(*, "dimnames")=List of 2
  .. .. .. .. .. .. .. .. ..$ : NULL
  .. .. .. .. .. .. .. .. ..$ : chr [1:2] "x" "y"
  .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
  .. .. .. .. .. .. ..@ labpt  : num [1:2] 1165985 416992
  .. .. .. .. .. .. ..@ area   : num 3.81e+08
  .. .. .. .. .. .. ..@ hole   : logi FALSE
  .. .. .. .. .. .. ..@ ringDir: int 1
  .. .. .. .. .. .. ..@ coords : num [1:25, 1:2] 1159904 1158679 1156466
1155046 1154557 ...
  .. .. .. .. .. .. .. ..- attr(*, "dimnames")=List of 2
  .. .. .. .. .. .. .. .. ..$ : NULL
  .. .. .. .. .. .. .. .. ..$ : chr [1:2] "x" "y"
  .. .. .. ..@ plotOrder: int [1:3] 1 3 2
  .. .. .. ..@ labpt    : num [1:2] 1188981 385285
  .. .. .. ..@ ID       : chr "buffer"
  .. .. .. ..@ area     : num 1.40e+09
  ..@ plotOrder  : int 1
  ..@ bbox       : num [1:2, 1:2] 1154557 373171 1209727 428120
  .. ..- attr(*, "dimnames")=List of 2
  .. .. ..$ : chr [1:2] "x" "y"
  .. .. ..$ : chr [1:2] "min" "max"
  ..@ proj4string:Formal class 'CRS' [package "sp"] with 1 slots
  .. .. ..@ projargs: chr " +init=epsg:3005 +proj=aea +lat_1=50 +lat_2=58.5
+lat_0=45 +lon_0=-126 +x_0=1000000 +y_0=0 +ellps=GRS80 +datum=NAD83 +units=m
+"| __truncated__
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101209/6a2f5df3/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: clusters_pts.TIF
Type: image/tiff
Size: 41232 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101209/6a2f5df3/attachment.tiff>

From hadley at rice.edu  Fri Dec 10 00:36:23 2010
From: hadley at rice.edu (Hadley Wickham)
Date: Thu, 9 Dec 2010 17:36:23 -0600
Subject: [R-sig-Geo] graticules for projected data
In-Reply-To: <AANLkTi=tkFAOqTC3oy24iX94puik0rJdj02oJFm55pgR@mail.gmail.com>
References: <7413BB3B-8C84-4860-866E-F9EFDD7D1058@noaa.gov>
	<AANLkTi=tkFAOqTC3oy24iX94puik0rJdj02oJFm55pgR@mail.gmail.com>
Message-ID: <AANLkTimdgR8UuFyqbUmZfC=M_=_i6QWO9XZ1XydkCA=x@mail.gmail.com>

ggplot2 + coord_map() already does graticules in a similar manner, as
far as I can tell.

Hadley

On Thu, Dec 9, 2010 at 2:22 PM, Pierre Roudier <pierre.roudier at gmail.com> wrote:
> That really is a neat piece of code. Very interested - the result
> looks very much like a ggplot2 plot, which I'm a big fan.
>
> Cheers,
>
> Pierre
>
> 2010/12/9 Josh London <josh.london at noaa.gov>:
>> Hello
>>
>> One of the features I often find myself wanting within spplot is the ability to produce graticules (with corresponding axis labels) that represent latitude/longitude lines for projected data. I often find myself searching the R archives and google for examples and methods for accomplishing this, but have always come up empty.
>>
>> This has been partially possible by using the gridlines() function within sp and then projecting those spatial lines to the desired projection. There are two drawbacks to this solution:
>>
>> 1) Often the extent of the projected gridlines is smaller than the data of interest so the lines stop short of the plot borders
>>
>> 2) There is no documented method I've found for producing the axis labels with degree units for each of the gridlines. gridat() is close but only supports unprojected data
>>
>> So, I ventured forth and pulled together a few functions that attempt to provide a generalized solution in the hopes that a) there's not some existing, obvious, solution my endless searching has overlooked and b) other folks could take advantage of it and maybe expand/improve on it.
>>
>> I've pulled everything together in a draft package, ProjectedGridlines, and it is available on GitHub (https://github.com/jmlondon/ProjectedGridlines). I've got some basic draft documentation in there for those interested.
>>
>> I make no claims to the code being elegant or an approach that will work for everyone. The main purpose here was to get something that works and distribute it.
>>
>> Below, I include the three functions and a reproducible example based on the north carolina dataset included with the maptools package. I've copied over some of the roxygen documentation, but those interested in more details should check the files on GitHub.
>>
>> Cheers
>> Josh
>>
>> GetGratLines<-function(spobj,proj_str,exp_deg,ndisc=500,...){
>> ? ? ? ?spobj at bbox[1,1]<-spobj at bbox[1,1]+exp_deg$l
>> ? ? ? ?spobj at bbox[1,2]<-spobj at bbox[1,2]+exp_deg$r
>> ? ? ? ?spobj at bbox[2,1]<-spobj at bbox[2,1]+exp_deg$b
>> ? ? ? ?spobj at bbox[2,2]<-spobj at bbox[2,2]+exp_deg$t
>> ? ? ? ?gl<-spTransform(gridlines(spobj,ndisc=ndisc,...),CRS(proj_str))
>> ? ? ? ?return(gl)
>> }
>>
>> #' @param spobj an unrpojected sp object that is the basis of the final projected outcome
>> #' @param proj_str a proj4 string specifying the desired projection
>> #' @param exp_deg is a named list with values l,r,b,t specifying the amount in decimal
>> #' degrees each side (left, right, bottom, top) should be expanded to account for differences
>> #' in extent between the projected gridlines and the final projected extent of spobj
>> #' @param ... passing of parameters relevant to gridlines()
>>
>> GetDegreeLabels<-function(spobj){
>> ? ? ? ?ewl<-coordinates(gridlines(spobj)["EW"]@lines[[1]])
>> ? ? ? ?nsl<-coordinates(gridlines(spobj)["NS"]@lines[[1]])
>> ? ? ? ?ewLabels<-lapply(ewl,function(x) {return(x[1,1])})
>> ? ? ? ?nsLabels<-lapply(nsl,function(x) {return(x[1,2])})
>> ? ? ? ?return(list(EW_Labels=unlist(ewLabels),NS_Labels=unlist(nsLabels)))
>> }
>>
>> #' @param spobj an unrpojected sp object that is the basis of the final projected outcome
>>
>> GetLabelCoords<-function(gl,offset=list(ew=0,ns=0)){
>> ? ? ? ?ewc<-coordinates(gl["EW"]@lines[[1]])
>> ? ? ? ?nsc<-coordinates(gl["NS"]@lines[[1]])
>> ? ? ? ?ewCoords<-lapply(ewc,function(x) {return(x[1,1])})
>> ? ? ? ?nsCoords<-lapply(nsc,function(x) {return(x[1,2])})
>> ? ? ? ?ewCoords<-lapply(ewCoords,function(x) {return(x+offset$ew)})
>> ? ? ? ?nsCoords<-lapply(nsCoords,function(x) {return(x+offset$ns)})
>> ? ? ? ?return(list(EW_Coords=unlist(ewCoords),NS_Coords=unlist(nsCoords)))
>> }
>>
>> #' @param gl the SpatialLines object returned from GetGratLines
>> #' @param offset a named list with values ew and ns specifying an offset for all labels on the axis
>>
>> And an example:
>>
>> library(sp)
>> library(rgdal)
>> library(maptools)
>> library(RColorBrewer)
>>
>> #read in the maptools north carolina shapefile, unprojected
>> d <- readShapePoly(system.file("shapes/sids.shp", package="maptools")[1], proj4string=CRS("+proj=longlat +datum=NAD27"))
>>
>> # create a dummy factor variable, with equal labels:
>> set.seed(31)
>> d$f = factor(sample(1:5,100,replace=T),labels=letters[1:5])
>>
>> #specify a custom Albers equal centered on the coordinate data
>> #this works for points and polygons, but lines need to be converted to points
>> med.lat <- round(median(coordinates(d)[,2]))
>> med.lon <- round(median(coordinates(d)[,1]))
>> lat1<-bbox(d)[2,1]+diff(range(bbox(d)[2,]))/3
>> lat2<-bbox(d)[2,2]-diff(range(bbox(d)[2,]))/3
>>
>> myProj <- paste("+proj=aea +lat_1=",lat1," +lat_2=",lat2," +lat_0=",med.lat,
>> ? ? ? ? ? ? ? ?" +lon_0=", med.lon, "+x_0=0 +y_0=0 +ellps=GRS80 +datum=NAD83 +units=m",sep="")
>>
>> #project the data, the graticule lines. note the gridlines function calls the unprojected data
>> d.proj <- spTransform(d,CRS(myProj))
>> #grat.lines<-spTransform(gridlines(d,ndisc=500),CRS(myProj))
>> g<-GetGratLines(d,myProj,list(t=0.25,b=-0.25,l=-0.25,r=0.25))
>> #create the sp.layout component for the graticule lines
>> grat.plot<-list("sp.lines",g,lwd="1.5",col="white",first=TRUE)
>>
>> x_grat_at<-GetLabelCoords(g,offset=list(ew=0))$EW_Coords
>>
>> y_grat_at<-GetLabelCoords(g,offset=list(ns=0))$NS_Coords
>>
>> x_grat<-list(draw=TRUE,
>> ? ? ? ? ? ? ? ?at=x_grat_at,
>> ? ? ? ? ? ? ? ?labels=as.character(GetDegreeLabels(d)$EW_Labels),
>> ? ? ? ? ? ? ? ?tck=c(0,0),
>> ? ? ? ? ? ? ? ?cex=0.75)
>>
>> y_grat<-list(draw=TRUE,
>> ? ? ? ? ? ? ? ?at=y_grat_at,
>> ? ? ? ? ? ? ? ?labels=as.character(GetDegreeLabels(d)$NS_Labels),
>> ? ? ? ? ? ? ? ?rot=90,
>> ? ? ? ? ? ? ? ?tck=c(0,0),
>> ? ? ? ? ? ? ? ?cex=0.75)
>>
>> spplot(d.proj, c("f"),
>> ? ? ? ? ? ? ? ?panel=function(...){
>> ? ? ? ? ? ? ? ? ? ? ? ?panel.fill(col="gray90")
>> ? ? ? ? ? ? ? ? ? ? ? ?panel.polygonsplot(...)
>> ? ? ? ? ? ? ? ?},
>> ? ? ? ? ? ? ? ?sp.layout=list(grat.plot),
>> ? ? ? ? ? ? ? ?col.regions=brewer.pal(5, "Set3"),scales=list(x=x_grat,y=y_grat))
>>
>>
>>
>>
>>
>> ? ? ? ?[[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



-- 
Assistant Professor / Dobelman Family Junior Chair
Department of Statistics / Rice University
http://had.co.nz/


From roman.lustrik at gmail.com  Fri Dec 10 01:24:03 2010
From: roman.lustrik at gmail.com (=?UTF-8?Q?Roman_Lu=C5=A1trik?=)
Date: Fri, 10 Dec 2010 01:24:03 +0100
Subject: [R-sig-Geo] polygon intersecting with point question
In-Reply-To: <AANLkTimeSgwt_fFf8pijjAOCi7N7CsmOuqF3AoxwC5=P@mail.gmail.com>
References: <AANLkTimeSgwt_fFf8pijjAOCi7N7CsmOuqF3AoxwC5=P@mail.gmail.com>
Message-ID: <AANLkTi=91rhCtp+0P5FvLhyE45hWiZUUwWgV-Gqf4LZ0@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101210/452171ca/attachment.pl>

From pierre.roudier at gmail.com  Fri Dec 10 06:04:59 2010
From: pierre.roudier at gmail.com (Pierre Roudier)
Date: Fri, 10 Dec 2010 18:04:59 +1300
Subject: [R-sig-Geo] graticules for projected data
In-Reply-To: <AANLkTimdgR8UuFyqbUmZfC=M_=_i6QWO9XZ1XydkCA=x@mail.gmail.com>
References: <7413BB3B-8C84-4860-866E-F9EFDD7D1058@noaa.gov>
	<AANLkTi=tkFAOqTC3oy24iX94puik0rJdj02oJFm55pgR@mail.gmail.com>
	<AANLkTimdgR8UuFyqbUmZfC=M_=_i6QWO9XZ1XydkCA=x@mail.gmail.com>
Message-ID: <AANLkTikAuxJ97U=4aSy2DzunYvy=hQ-QwLbRwU=5N8pe@mail.gmail.com>

Harley,

In ggplot2 however, is there a way to plot shapefiles without gpclib?
Its licence is a problem for any externaly-founded research
unfortunately.

Cheers,

Pierre

2010/12/10 Hadley Wickham <hadley at rice.edu>:
> ggplot2 + coord_map() already does graticules in a similar manner, as
> far as I can tell.
>
> Hadley
>
> On Thu, Dec 9, 2010 at 2:22 PM, Pierre Roudier <pierre.roudier at gmail.com> wrote:
>> That really is a neat piece of code. Very interested - the result
>> looks very much like a ggplot2 plot, which I'm a big fan.
>>
>> Cheers,
>>
>> Pierre
>>
>> 2010/12/9 Josh London <josh.london at noaa.gov>:
>>> Hello
>>>
>>> One of the features I often find myself wanting within spplot is the ability to produce graticules (with corresponding axis labels) that represent latitude/longitude lines for projected data. I often find myself searching the R archives and google for examples and methods for accomplishing this, but have always come up empty.
>>>
>>> This has been partially possible by using the gridlines() function within sp and then projecting those spatial lines to the desired projection. There are two drawbacks to this solution:
>>>
>>> 1) Often the extent of the projected gridlines is smaller than the data of interest so the lines stop short of the plot borders
>>>
>>> 2) There is no documented method I've found for producing the axis labels with degree units for each of the gridlines. gridat() is close but only supports unprojected data
>>>
>>> So, I ventured forth and pulled together a few functions that attempt to provide a generalized solution in the hopes that a) there's not some existing, obvious, solution my endless searching has overlooked and b) other folks could take advantage of it and maybe expand/improve on it.
>>>
>>> I've pulled everything together in a draft package, ProjectedGridlines, and it is available on GitHub (https://github.com/jmlondon/ProjectedGridlines). I've got some basic draft documentation in there for those interested.
>>>
>>> I make no claims to the code being elegant or an approach that will work for everyone. The main purpose here was to get something that works and distribute it.
>>>
>>> Below, I include the three functions and a reproducible example based on the north carolina dataset included with the maptools package. I've copied over some of the roxygen documentation, but those interested in more details should check the files on GitHub.
>>>
>>> Cheers
>>> Josh
>>>
>>> GetGratLines<-function(spobj,proj_str,exp_deg,ndisc=500,...){
>>> ? ? ? ?spobj at bbox[1,1]<-spobj at bbox[1,1]+exp_deg$l
>>> ? ? ? ?spobj at bbox[1,2]<-spobj at bbox[1,2]+exp_deg$r
>>> ? ? ? ?spobj at bbox[2,1]<-spobj at bbox[2,1]+exp_deg$b
>>> ? ? ? ?spobj at bbox[2,2]<-spobj at bbox[2,2]+exp_deg$t
>>> ? ? ? ?gl<-spTransform(gridlines(spobj,ndisc=ndisc,...),CRS(proj_str))
>>> ? ? ? ?return(gl)
>>> }
>>>
>>> #' @param spobj an unrpojected sp object that is the basis of the final projected outcome
>>> #' @param proj_str a proj4 string specifying the desired projection
>>> #' @param exp_deg is a named list with values l,r,b,t specifying the amount in decimal
>>> #' degrees each side (left, right, bottom, top) should be expanded to account for differences
>>> #' in extent between the projected gridlines and the final projected extent of spobj
>>> #' @param ... passing of parameters relevant to gridlines()
>>>
>>> GetDegreeLabels<-function(spobj){
>>> ? ? ? ?ewl<-coordinates(gridlines(spobj)["EW"]@lines[[1]])
>>> ? ? ? ?nsl<-coordinates(gridlines(spobj)["NS"]@lines[[1]])
>>> ? ? ? ?ewLabels<-lapply(ewl,function(x) {return(x[1,1])})
>>> ? ? ? ?nsLabels<-lapply(nsl,function(x) {return(x[1,2])})
>>> ? ? ? ?return(list(EW_Labels=unlist(ewLabels),NS_Labels=unlist(nsLabels)))
>>> }
>>>
>>> #' @param spobj an unrpojected sp object that is the basis of the final projected outcome
>>>
>>> GetLabelCoords<-function(gl,offset=list(ew=0,ns=0)){
>>> ? ? ? ?ewc<-coordinates(gl["EW"]@lines[[1]])
>>> ? ? ? ?nsc<-coordinates(gl["NS"]@lines[[1]])
>>> ? ? ? ?ewCoords<-lapply(ewc,function(x) {return(x[1,1])})
>>> ? ? ? ?nsCoords<-lapply(nsc,function(x) {return(x[1,2])})
>>> ? ? ? ?ewCoords<-lapply(ewCoords,function(x) {return(x+offset$ew)})
>>> ? ? ? ?nsCoords<-lapply(nsCoords,function(x) {return(x+offset$ns)})
>>> ? ? ? ?return(list(EW_Coords=unlist(ewCoords),NS_Coords=unlist(nsCoords)))
>>> }
>>>
>>> #' @param gl the SpatialLines object returned from GetGratLines
>>> #' @param offset a named list with values ew and ns specifying an offset for all labels on the axis
>>>
>>> And an example:
>>>
>>> library(sp)
>>> library(rgdal)
>>> library(maptools)
>>> library(RColorBrewer)
>>>
>>> #read in the maptools north carolina shapefile, unprojected
>>> d <- readShapePoly(system.file("shapes/sids.shp", package="maptools")[1], proj4string=CRS("+proj=longlat +datum=NAD27"))
>>>
>>> # create a dummy factor variable, with equal labels:
>>> set.seed(31)
>>> d$f = factor(sample(1:5,100,replace=T),labels=letters[1:5])
>>>
>>> #specify a custom Albers equal centered on the coordinate data
>>> #this works for points and polygons, but lines need to be converted to points
>>> med.lat <- round(median(coordinates(d)[,2]))
>>> med.lon <- round(median(coordinates(d)[,1]))
>>> lat1<-bbox(d)[2,1]+diff(range(bbox(d)[2,]))/3
>>> lat2<-bbox(d)[2,2]-diff(range(bbox(d)[2,]))/3
>>>
>>> myProj <- paste("+proj=aea +lat_1=",lat1," +lat_2=",lat2," +lat_0=",med.lat,
>>> ? ? ? ? ? ? ? ?" +lon_0=", med.lon, "+x_0=0 +y_0=0 +ellps=GRS80 +datum=NAD83 +units=m",sep="")
>>>
>>> #project the data, the graticule lines. note the gridlines function calls the unprojected data
>>> d.proj <- spTransform(d,CRS(myProj))
>>> #grat.lines<-spTransform(gridlines(d,ndisc=500),CRS(myProj))
>>> g<-GetGratLines(d,myProj,list(t=0.25,b=-0.25,l=-0.25,r=0.25))
>>> #create the sp.layout component for the graticule lines
>>> grat.plot<-list("sp.lines",g,lwd="1.5",col="white",first=TRUE)
>>>
>>> x_grat_at<-GetLabelCoords(g,offset=list(ew=0))$EW_Coords
>>>
>>> y_grat_at<-GetLabelCoords(g,offset=list(ns=0))$NS_Coords
>>>
>>> x_grat<-list(draw=TRUE,
>>> ? ? ? ? ? ? ? ?at=x_grat_at,
>>> ? ? ? ? ? ? ? ?labels=as.character(GetDegreeLabels(d)$EW_Labels),
>>> ? ? ? ? ? ? ? ?tck=c(0,0),
>>> ? ? ? ? ? ? ? ?cex=0.75)
>>>
>>> y_grat<-list(draw=TRUE,
>>> ? ? ? ? ? ? ? ?at=y_grat_at,
>>> ? ? ? ? ? ? ? ?labels=as.character(GetDegreeLabels(d)$NS_Labels),
>>> ? ? ? ? ? ? ? ?rot=90,
>>> ? ? ? ? ? ? ? ?tck=c(0,0),
>>> ? ? ? ? ? ? ? ?cex=0.75)
>>>
>>> spplot(d.proj, c("f"),
>>> ? ? ? ? ? ? ? ?panel=function(...){
>>> ? ? ? ? ? ? ? ? ? ? ? ?panel.fill(col="gray90")
>>> ? ? ? ? ? ? ? ? ? ? ? ?panel.polygonsplot(...)
>>> ? ? ? ? ? ? ? ?},
>>> ? ? ? ? ? ? ? ?sp.layout=list(grat.plot),
>>> ? ? ? ? ? ? ? ?col.regions=brewer.pal(5, "Set3"),scales=list(x=x_grat,y=y_grat))
>>>
>>>
>>>
>>>
>>>
>>> ? ? ? ?[[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>
>
> --
> Assistant Professor / Dobelman Family Junior Chair
> Department of Statistics / Rice University
> http://had.co.nz/
>


From Tim.Haering at lwf.bayern.de  Fri Dec 10 11:20:12 2010
From: Tim.Haering at lwf.bayern.de (Tim.Haering at lwf.bayern.de)
Date: Fri, 10 Dec 2010 11:20:12 +0100
Subject: [R-sig-Geo] RGB in image()
Message-ID: <70FC67C4A585D1489E66225A4E0238BAC4DD74@RZS-EXC-CL06.rz-sued.bayern.de>

Hello,

I would like to plot a SpatialGridDataFrame using the image() function, but have problems with the colors. I want to create a transparent rgb image using three bands as red, green and blue and want to control the transparency with the alpha parameter.
I have a matrix "dist" containing my rgb values:
> head(dist)
          [,1]      [,2]      [,3]
[1,] 0.1895978 0.5196565 0.2907457
[2,] 0.2292516 0.5269284 0.2438200
[3,] 0.1514392 0.4990144 0.3495464
...
### create a color vector using rgb()
> cols <- apply(dist, 1, function(x) rgb(x[1], x[2], x[3], alpha = .2))

### rescale rgb values to c(0,255)
> red <- as.integer(RESCALE(dist[,1],0,255,min(dist[,1]), max(dist[,1])))
> green <- as.integer(RESCALE(dist[,2],0,255,min(dist[,2]), max(dist[,2])))
> blue <- as.integer(RESCALE(dist[,3],0,255,min(dist[,3]), max(dist[,3])))

### create a SGDF
> pd <- data.frame(RW = p$RW, HW = p$HW, red=red, green=green, blue=blue, cols)
> gridded(pd) = ~RW+HW
> pd <- as(pd, "SpatialGridDataFrame")

### using the red, green and blue parameters my image looks fine except that
### my colors aren`t transparent
> image(pd, red="red", green="green", blue="blue")

### If I use my color vector (containing transparent colors) the image looks
### speckled. 
> image(pd, col = cols)

Can somebody help me? Is there another way to make the color transparent?

TIM


------------------------------------- 
Tim H?ring
Bavarian State Institute of Forestry
Department of Forest Ecology
Hans-Carl-von-Carlowitz-Platz 1
D-85354 Freising


From Roger.Bivand at nhh.no  Fri Dec 10 11:34:37 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 10 Dec 2010 11:34:37 +0100 (CET)
Subject: [R-sig-Geo] suggestion for spgrass6 - temp file in readVECT6
In-Reply-To: <201012091331.45055.dylan.beaudette@gmail.com>
References: <AANLkTimqaOuLM46-N6=aYjKA6NotAt8hXjSK2hj2P3HX@mail.gmail.com>
	<201012091331.45055.dylan.beaudette@gmail.com>
Message-ID: <alpine.LRH.2.00.1012101120540.6560@reclus.nhh.no>

On Thu, 9 Dec 2010, Dylan Beaudette wrote:

> On Thursday, December 09, 2010, Pierre Roudier wrote:
>> Dear all,
>>
>> I got a suggestion for spgrass6. As far as I understand it, a
>> temporary ESRI shapefile is written on the disk when using
>> readVECT6('foo'), I guess then R is using rgdal to read that shapefile
>> back in memory. Considering the various limitations of the ESRI
>> shapefile format that does not occur with the GRASS internal format,
>> could it be possible to add an option to choose the OGR format used in
>> that process?
>>
>> Also got a question for Roger I guess: I'm using now the grass7 svn
>> trunk, should I expect any problems using the spgrass6 interface (I
>> mean problems due to structural differences that appears in grass7
>> that would not be handled by spgrass6, not problems due to grass7
>> itself).
>>
>> Thanks,
>>
>> Pierre
>>
>
> This is an excellent point Pierre, and something that has caused 
> significant pain the past-- in terms of column names and NULL value 
> handling. Not everyone's GDAL/OGR will be configured in the same way-- 
> so I don't know if altering the default behavior would be wise. However, 
> adding an option (as you suggested) to use some other format, such as 
> SQLite, would give power users a nice alternative to SHP format. SQLite 
> would allow for longer field names, proper support for NULL data, and 
> probably some other 'good things'.

SQLite is an extra OGR driver that will be dependent on the OGR being used 
on the platform in question. The OGR used by GRASS may be the same as that 
used by rgdal, but may not be (R binary rgdal packages for Windows and 
OSX, which have minimal driver sets).

I'll attempt to add a driver= argument to readVECT6() and writeVECT6(), 
and drivername= readRAST6() and writeRAST6() for the temporary files.

Typically, for reading native GRASS data, users build GRASS plugins for 
OGR/GDAL. readVECT6() and readRAST6() both by default check for the 
presence of the plugin, and use it if present, avoiding any intermediate 
files being created.

The recently released revision of spgrass6 (0.6-23) does work with GRASS > 
6.3, including GRASS 7. This is signalled by the use of "GRASS 6+" rather 
than just "GRASS 6" in its title and short description.

Hope this helps,

Roger

>
> Dylan
>
>
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From edzer.pebesma at uni-muenster.de  Fri Dec 10 12:45:18 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Fri, 10 Dec 2010 12:45:18 +0100
Subject: [R-sig-Geo] polygon intersecting with point question
In-Reply-To: <AANLkTimeSgwt_fFf8pijjAOCi7N7CsmOuqF3AoxwC5=P@mail.gmail.com>
References: <AANLkTimeSgwt_fFf8pijjAOCi7N7CsmOuqF3AoxwC5=P@mail.gmail.com>
Message-ID: <4D0212CE.5040605@uni-muenster.de>

Dear Haily, please update to the latest sp version and do

library(sp)
vignette("over")

I worked on a new overlay version ("over") that does a better job than
overlay; the vignette explains things. Please let me know if it solves
your problem.

Right now it doesn't do things like line-line, line-polygon and
polygon-polygon overlay, as that will require rgeos to be more widely
available (and needs work on the sp side!)

Best regards,
--
Edzer

On 12/10/2010 12:10 AM, Hailey Eckstrand wrote:
> Hello,
> I have 2 spatial objects, a SpatialPointsDataFrame objects with 4 points,
> and a SpatialPolygons object with 3 polygons.
> 
> I created the SpatialPolygons object by using the gBuffer function from the
> rgeos package.
> What I am trying to do is find a function that will return a count or a
> subset of the SpatialPolygons object that intersects with the points.
> In this example, it should return the count of 3 polygons, or a
> SpatialPolygons object with all 3 polygons in it. Since there are 2 points
> within one polygon, it would be alright if it returned the same polygon
> twice, so then the expected output would be a SpatialPolygons objects with 4
> polygons in it & 2 would be duplicates.
> 
> If there is no function that will do what I am requesting.. then I could
> iterate through the polygons, and use an overlay statement. So then the
> other question would be, how does one iterate through the polygons within a
> SpatialPolygons object.
> Thanks!
> 
> I have included an image of the points & polygons and I have also including
> the structures:
> str(my.pts)
> Formal class 'SpatialPointsDataFrame' [package "sp"] with 5 slots
>   ..@ data       :'data.frame': 4 obs. of  3 variables:
>   .. ..$ Agency    : chr [1:4] "EC-Surface Wx" "EC-Surface Wx" "EC-Daily
> Climat" "EC-Daily Climat"
>   .. ..$ Station_Co: chr [1:4] "1018620" "1018598" "1022571" "1012573"
>   .. ..$ id        : int [1:4] 1 2 3 4
>   ..@ coords.nrs : num(0)
>   ..@ coords     : num [1:4, 1:2] 1189982 1199727 1164557 1167413 406887 ...
>   .. ..- attr(*, "dimnames")=List of 2
>   .. .. ..$ : NULL
>   .. .. ..$ : chr [1:2] "coords.x1" "coords.x2"
>   ..@ bbox       : num [1:2, 1:2] 1164557 386154 1199727 418120
>   .. ..- attr(*, "dimnames")=List of 2
>   .. .. ..$ : chr [1:2] "coords.x1" "coords.x2"
>   .. .. ..$ : chr [1:2] "min" "max"
>   ..@ proj4string:Formal class 'CRS' [package "sp"] with 1 slots
>   .. .. ..@ projargs: chr " +init=epsg:3005 +proj=aea +lat_1=50 +lat_2=58.5
> +lat_0=45 +lon_0=-126 +x_0=1000000 +y_0=0 +ellps=GRS80 +datum=NAD83 +units=m
> +"| __truncated__
> 
> str(my.poly)
> Formal class 'SpatialPolygons' [package "sp"] with 4 slots
>   ..@ polygons   :List of 1
>   .. ..$ :Formal class 'Polygons' [package "sp"] with 5 slots
>   .. .. .. ..@ Polygons :List of 3
>   .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
>   .. .. .. .. .. .. ..@ labpt  : num [1:2] 1188981 385285
>   .. .. .. .. .. .. ..@ area   : num 7.06e+08
>   .. .. .. .. .. .. ..@ hole   : logi FALSE
>   .. .. .. .. .. .. ..@ ringDir: int 1
>   .. .. .. .. .. .. ..@ coords : num [1:39, 1:2] 1177292 1178815 1181603
> 1184693 1187783 ...
>   .. .. .. .. .. .. .. ..- attr(*, "dimnames")=List of 2
>   .. .. .. .. .. .. .. .. ..$ : NULL
>   .. .. .. .. .. .. .. .. ..$ : chr [1:2] "x" "y"
>   .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
>   .. .. .. .. .. .. ..@ labpt  : num [1:2] 1189982 406887
>   .. .. .. .. .. .. ..@ area   : num 3.09e+08
>   .. .. .. .. .. .. ..@ hole   : logi FALSE
>   .. .. .. .. .. .. ..@ ringDir: int 1
>   .. .. .. .. .. .. ..@ coords : num [1:21, 1:2] 1199982 1199493 1198072
> 1195860 1193072 ...
>   .. .. .. .. .. .. .. ..- attr(*, "dimnames")=List of 2
>   .. .. .. .. .. .. .. .. ..$ : NULL
>   .. .. .. .. .. .. .. .. ..$ : chr [1:2] "x" "y"
>   .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
>   .. .. .. .. .. .. ..@ labpt  : num [1:2] 1165985 416992
>   .. .. .. .. .. .. ..@ area   : num 3.81e+08
>   .. .. .. .. .. .. ..@ hole   : logi FALSE
>   .. .. .. .. .. .. ..@ ringDir: int 1
>   .. .. .. .. .. .. ..@ coords : num [1:25, 1:2] 1159904 1158679 1156466
> 1155046 1154557 ...
>   .. .. .. .. .. .. .. ..- attr(*, "dimnames")=List of 2
>   .. .. .. .. .. .. .. .. ..$ : NULL
>   .. .. .. .. .. .. .. .. ..$ : chr [1:2] "x" "y"
>   .. .. .. ..@ plotOrder: int [1:3] 1 3 2
>   .. .. .. ..@ labpt    : num [1:2] 1188981 385285
>   .. .. .. ..@ ID       : chr "buffer"
>   .. .. .. ..@ area     : num 1.40e+09
>   ..@ plotOrder  : int 1
>   ..@ bbox       : num [1:2, 1:2] 1154557 373171 1209727 428120
>   .. ..- attr(*, "dimnames")=List of 2
>   .. .. ..$ : chr [1:2] "x" "y"
>   .. .. ..$ : chr [1:2] "min" "max"
>   ..@ proj4string:Formal class 'CRS' [package "sp"] with 1 slots
>   .. .. ..@ projargs: chr " +init=epsg:3005 +proj=aea +lat_1=50 +lat_2=58.5
> +lat_0=45 +lon_0=-126 +x_0=1000000 +y_0=0 +ellps=GRS80 +datum=NAD83 +units=m
> +"| __truncated__
> 
> 
> 
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From Roger.Bivand at nhh.no  Fri Dec 10 13:34:01 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 10 Dec 2010 13:34:01 +0100 (CET)
Subject: [R-sig-Geo] Suggestion: option overwrite=T for writeOGR()
In-Reply-To: <AANLkTi=YfZOgvP_75+skqZvTxmZ_bVMZfXN7SMfCsQRb@mail.gmail.com>
References: <AANLkTi=D5_u6K67jCtwSafxOpNZ34rJHfSCnGQSSLpOs@mail.gmail.com>
	<AANLkTi=YfZOgvP_75+skqZvTxmZ_bVMZfXN7SMfCsQRb@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.1012101320330.6560@reclus.nhh.no>

On Thu, 9 Dec 2010, Barry Rowlingson wrote:

> On Thu, Dec 9, 2010 at 8:56 AM, Agustin Lobo <alobolistas at gmail.com> wrote:
>> Hi!
>>
>> Could an option overwrite=T (default overwrite=F) be included in writeOGR()?
>> Thanks!
>
> Submit a Feature Request here:
>
> http://sourceforge.net/tracker/?group_id=84716&atid=573625

No, rgdal is on R-Forge, and a list called rgdal-devel will be available 
from tomorrow.

>
> It looks like it just needs to be a wrapper around OGR's delete layer 
> function.

Contributions welcome. Note that the facility is present for rasters, 
which I fould out by accidentally deleting GRASS database objects (for 
which of course I did not have backups). Is this really needed - which 
drivers do not already overwrite without complaint? These do not complain 
for me: driver="ESRI Shapefile"; driver="KML"; driver="MapInfo File"; 
driver="MapInfo File", dataset_options="FORMAT=MIF".

Hope this helps,

Roger

>
> Barry
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From b.rowlingson at lancaster.ac.uk  Fri Dec 10 13:35:01 2010
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Fri, 10 Dec 2010 12:35:01 +0000
Subject: [R-sig-Geo] OSgeo live DVD
Message-ID: <AANLkTi=ERAQJzj1GdLg+R94cEWXgQiAohQeowncXA63N@mail.gmail.com>

Hi All,

 I had an email from the OSGeo Live DVD maintainer today requesting
updates for R on the next release of the DVD. It seems I put my name
down to help out with it a while back. Actually, the named contacts
are:

Ned Horning, Barry Rowlingson, Massimo di Steffano, Alex Mandel

 Just wondered if anyone else was interested in helping with it? The
task is mostly just writing some docs and specifying versions, but its
a good opportunity to get spatial data handling in R out to the rest
of the world. Some nice examples wouldn't go amiss to go into the
'quickstart' document for R (which currently doesnt exist).

SVN of the doc tree is here:

https://svn.osgeo.org/osgeo/livedvd/gisvm/trunk/doc/

Barry


From edzer.pebesma at uni-muenster.de  Fri Dec 10 13:41:01 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Fri, 10 Dec 2010 13:41:01 +0100
Subject: [R-sig-Geo] OSgeo live DVD
In-Reply-To: <AANLkTi=ERAQJzj1GdLg+R94cEWXgQiAohQeowncXA63N@mail.gmail.com>
References: <AANLkTi=ERAQJzj1GdLg+R94cEWXgQiAohQeowncXA63N@mail.gmail.com>
Message-ID: <4D021FDD.9030001@uni-muenster.de>

What would someone wanting a "quickstart" through R-spatial like to do?

On 12/10/2010 01:35 PM, Barry Rowlingson wrote:
> Hi All,
> 
>  I had an email from the OSGeo Live DVD maintainer today requesting
> updates for R on the next release of the DVD. It seems I put my name
> down to help out with it a while back. Actually, the named contacts
> are:
> 
> Ned Horning, Barry Rowlingson, Massimo di Steffano, Alex Mandel
> 
>  Just wondered if anyone else was interested in helping with it? The
> task is mostly just writing some docs and specifying versions, but its
> a good opportunity to get spatial data handling in R out to the rest
> of the world. Some nice examples wouldn't go amiss to go into the
> 'quickstart' document for R (which currently doesnt exist).
> 
> SVN of the doc tree is here:
> 
> https://svn.osgeo.org/osgeo/livedvd/gisvm/trunk/doc/
> 
> Barry
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From b.rowlingson at lancaster.ac.uk  Fri Dec 10 13:49:13 2010
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Fri, 10 Dec 2010 12:49:13 +0000
Subject: [R-sig-Geo] OSgeo live DVD
In-Reply-To: <4D021FDD.9030001@uni-muenster.de>
References: <AANLkTi=ERAQJzj1GdLg+R94cEWXgQiAohQeowncXA63N@mail.gmail.com>
	<4D021FDD.9030001@uni-muenster.de>
Message-ID: <AANLkTi=6HcSAUMoFMHdkfmO1KKxhr9S5FD0bBwhSDUum@mail.gmail.com>

On Fri, Dec 10, 2010 at 12:41 PM, Edzer Pebesma
<edzer.pebesma at uni-muenster.de> wrote:
> What would someone wanting a "quickstart" through R-spatial like to do?

I would step through some of the standard analyses in the examples of
the various R-spatial packages - some maps, a bit of kriging,
import/export via rgdal, that sort of thing.

Barry


From massimodisasha at gmail.com  Fri Dec 10 14:46:31 2010
From: massimodisasha at gmail.com (Massimo Di Stefano)
Date: Fri, 10 Dec 2010 08:46:31 -0500
Subject: [R-sig-Geo] OSgeo live DVD
In-Reply-To: <AANLkTi=6HcSAUMoFMHdkfmO1KKxhr9S5FD0bBwhSDUum@mail.gmail.com>
References: <AANLkTi=ERAQJzj1GdLg+R94cEWXgQiAohQeowncXA63N@mail.gmail.com>
	<4D021FDD.9030001@uni-muenster.de>
	<AANLkTi=6HcSAUMoFMHdkfmO1KKxhr9S5FD0bBwhSDUum@mail.gmail.com>
Message-ID: <E51727D3-F7F3-4D70-8857-8D3EF76B650F@gmail.com>

Hello All,


the R packages installed on the Osgeo-Live are :

https://svn.osgeo.org/osgeo/livedvd/gisvm/trunk/app-conf/R/installRpackages.r

packagelist is what actually is installed

while packagelist2 is commented out (more complete list)

Can you point me to which package we need to add/delete from the list ?

i will be happy to help,
reserved to you the choice for which kind of example you would like to see on the live,
if you point me to example code/description i can put them in the .rst file to build the documentation.

thank you,

Massimo.


Il giorno 10/dic/2010, alle ore 07.49, Barry Rowlingson ha scritto:

> On Fri, Dec 10, 2010 at 12:41 PM, Edzer Pebesma
> <edzer.pebesma at uni-muenster.de> wrote:
>> What would someone wanting a "quickstart" through R-spatial like to do?
> 
> I would step through some of the standard analyses in the examples of
> the various R-spatial packages - some maps, a bit of kriging,
> import/export via rgdal, that sort of thing.
> 
> Barry
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From alobolistas at gmail.com  Fri Dec 10 14:52:32 2010
From: alobolistas at gmail.com (Agustin Lobo)
Date: Fri, 10 Dec 2010 14:52:32 +0100
Subject: [R-sig-Geo] Suggestion: option overwrite=T for writeOGR()
In-Reply-To: <alpine.LRH.2.00.1012101320330.6560@reclus.nhh.no>
References: <AANLkTi=D5_u6K67jCtwSafxOpNZ34rJHfSCnGQSSLpOs@mail.gmail.com>
	<AANLkTi=YfZOgvP_75+skqZvTxmZ_bVMZfXN7SMfCsQRb@mail.gmail.com>
	<alpine.LRH.2.00.1012101320330.6560@reclus.nhh.no>
Message-ID: <AANLkTinMcoacpjRgSEair0ph+tYqTWk8jFFiBgFxgMT5@mail.gmail.com>

Roger,

It does not for me. The error is solved by deleting files xygcatLO.* ,
while directory xygcatLO may continue to exist.

Also, I've found that with this version the below command does not
save the files within
the folder indicated by dsn, but outside. This was not the case in the
past, but do not know if this is
because of a change in rgdal, gdal or ubuntu 10.04 (I've changed all 3
since the last time I used writeOGR()).

> writeOGR(xygcatLO,dsn="xygcatLO",layer="xygcatLO", driver="ESRI Shapefile")
Error in writeOGR(xygcatLO, dsn = "xygcatLO", layer = "xygcatLO",
driver = "ESRI Shapefile") :

	GDAL Error 1: Layer 'xygcatLO' already exists
Calls: writeOGR -> .Call

> sessionInfo()
R version 2.12.0 (2010-10-15)
Platform: x86_64-pc-linux-gnu (64-bit)

locale:
 [1] LC_CTYPE=en_US.utf8          LC_NUMERIC=C
 [3] LC_TIME=en_US.utf8           LC_COLLATE=en_US.utf8
 [5] LC_MONETARY=en_US.utf8       LC_MESSAGES=en_US.utf8
 [7] LC_PAPER=en_US.utf8          LC_NAME=en_US.utf8
 [9] LC_ADDRESS=en_US.utf8        LC_TELEPHONE=en_US.utf8
[11] LC_MEASUREMENT=en_US.utf8    LC_IDENTIFICATION=en_US.utf8

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] RANN_2.1.2      outliers_0.13-3 rgdal_0.6-30    raster_1.7-2
[5] sp_0.9-73       rkward_0.5.4

loaded via a namespace (and not attached):
[1] grid_2.12.0     lattice_0.19-13 tools_2.12.0
2010/12/10 Roger Bivand <Roger.Bivand at nhh.no>:
> On Thu, 9 Dec 2010, Barry Rowlingson wrote:
>
>> On Thu, Dec 9, 2010 at 8:56 AM, Agustin Lobo <alobolistas at gmail.com>
>> wrote:
>>>
>>> Hi!
>>>
>>> Could an option overwrite=T (default overwrite=F) be included in
>>> writeOGR()?
>>> Thanks!
>>
>> Submit a Feature Request here:
>>
>> http://sourceforge.net/tracker/?group_id=84716&atid=573625
>
> No, rgdal is on R-Forge, and a list called rgdal-devel will be available
> from tomorrow.
>
>>
>> It looks like it just needs to be a wrapper around OGR's delete layer
>> function.
>
> Contributions welcome. Note that the facility is present for rasters, which
> I fould out by accidentally deleting GRASS database objects (for which of
> course I did not have backups). Is this really needed - which drivers do not
> already overwrite without complaint? These do not complain for me:
> driver="ESRI Shapefile"; driver="KML"; driver="MapInfo File";
> driver="MapInfo File", dataset_options="FORMAT=MIF".
>
> Hope this helps,
>
> Roger
>
>>
>> Barry
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> --
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From Roger.Bivand at nhh.no  Fri Dec 10 15:18:06 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 10 Dec 2010 15:18:06 +0100 (CET)
Subject: [R-sig-Geo] Suggestion: option overwrite=T for writeOGR()
In-Reply-To: <AANLkTinMcoacpjRgSEair0ph+tYqTWk8jFFiBgFxgMT5@mail.gmail.com>
References: <AANLkTi=D5_u6K67jCtwSafxOpNZ34rJHfSCnGQSSLpOs@mail.gmail.com>
	<AANLkTi=YfZOgvP_75+skqZvTxmZ_bVMZfXN7SMfCsQRb@mail.gmail.com>
	<alpine.LRH.2.00.1012101320330.6560@reclus.nhh.no>
	<AANLkTinMcoacpjRgSEair0ph+tYqTWk8jFFiBgFxgMT5@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.1012101516480.9170@reclus.nhh.no>

On Fri, 10 Dec 2010, Agustin Lobo wrote:

> Roger,
>
> It does not for me. The error is solved by deleting files xygcatLO.* ,
> while directory xygcatLO may continue to exist.

Agus,

With which drivers, OGR version (in header when rgdal loads)? If I cannot 
reproduce this, I cannot readily help.

Roger

>
> Also, I've found that with this version the below command does not
> save the files within
> the folder indicated by dsn, but outside. This was not the case in the
> past, but do not know if this is
> because of a change in rgdal, gdal or ubuntu 10.04 (I've changed all 3
> since the last time I used writeOGR()).
>
>> writeOGR(xygcatLO,dsn="xygcatLO",layer="xygcatLO", driver="ESRI Shapefile")
> Error in writeOGR(xygcatLO, dsn = "xygcatLO", layer = "xygcatLO",
> driver = "ESRI Shapefile") :
>
> 	GDAL Error 1: Layer 'xygcatLO' already exists
> Calls: writeOGR -> .Call
>
>> sessionInfo()
> R version 2.12.0 (2010-10-15)
> Platform: x86_64-pc-linux-gnu (64-bit)
>
> locale:
> [1] LC_CTYPE=en_US.utf8          LC_NUMERIC=C
> [3] LC_TIME=en_US.utf8           LC_COLLATE=en_US.utf8
> [5] LC_MONETARY=en_US.utf8       LC_MESSAGES=en_US.utf8
> [7] LC_PAPER=en_US.utf8          LC_NAME=en_US.utf8
> [9] LC_ADDRESS=en_US.utf8        LC_TELEPHONE=en_US.utf8
> [11] LC_MEASUREMENT=en_US.utf8    LC_IDENTIFICATION=en_US.utf8
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> other attached packages:
> [1] RANN_2.1.2      outliers_0.13-3 rgdal_0.6-30    raster_1.7-2
> [5] sp_0.9-73       rkward_0.5.4
>
> loaded via a namespace (and not attached):
> [1] grid_2.12.0     lattice_0.19-13 tools_2.12.0
> 2010/12/10 Roger Bivand <Roger.Bivand at nhh.no>:
>> On Thu, 9 Dec 2010, Barry Rowlingson wrote:
>>
>>> On Thu, Dec 9, 2010 at 8:56 AM, Agustin Lobo <alobolistas at gmail.com>
>>> wrote:
>>>>
>>>> Hi!
>>>>
>>>> Could an option overwrite=T (default overwrite=F) be included in
>>>> writeOGR()?
>>>> Thanks!
>>>
>>> Submit a Feature Request here:
>>>
>>> http://sourceforge.net/tracker/?group_id=84716&atid=573625
>>
>> No, rgdal is on R-Forge, and a list called rgdal-devel will be available
>> from tomorrow.
>>
>>>
>>> It looks like it just needs to be a wrapper around OGR's delete layer
>>> function.
>>
>> Contributions welcome. Note that the facility is present for rasters, which
>> I fould out by accidentally deleting GRASS database objects (for which of
>> course I did not have backups). Is this really needed - which drivers do not
>> already overwrite without complaint? These do not complain for me:
>> driver="ESRI Shapefile"; driver="KML"; driver="MapInfo File";
>> driver="MapInfo File", dataset_options="FORMAT=MIF".
>>
>> Hope this helps,
>>
>> Roger
>>
>>>
>>> Barry
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>> --
>> Roger Bivand
>> Economic Geography Section, Department of Economics, Norwegian School of
>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>> e-mail: Roger.Bivand at nhh.no
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From alobolistas at gmail.com  Fri Dec 10 15:32:48 2010
From: alobolistas at gmail.com (Agustin Lobo)
Date: Fri, 10 Dec 2010 15:32:48 +0100
Subject: [R-sig-Geo] Suggestion: option overwrite=T for writeOGR()
In-Reply-To: <alpine.LRH.2.00.1012101516480.9170@reclus.nhh.no>
References: <AANLkTi=D5_u6K67jCtwSafxOpNZ34rJHfSCnGQSSLpOs@mail.gmail.com>
	<AANLkTi=YfZOgvP_75+skqZvTxmZ_bVMZfXN7SMfCsQRb@mail.gmail.com>
	<alpine.LRH.2.00.1012101320330.6560@reclus.nhh.no>
	<AANLkTinMcoacpjRgSEair0ph+tYqTWk8jFFiBgFxgMT5@mail.gmail.com>
	<alpine.LRH.2.00.1012101516480.9170@reclus.nhh.no>
Message-ID: <AANLkTinbhGxeRbCK1DJvE8yQQTSozBTUY-C=WFjpmfry@mail.gmail.com>

Roger,

is this all you need? I thought sessionInfo was providing everything
needed. The driver is
"ESRI Shapefile" as stated in the command, have not tested any other
(it does work for
raster though, as you mention):

> require(rgdal)
Loading required package: rgdal
Geospatial Data Abstraction Library extensions to R successfully loaded
Loaded GDAL runtime: GDAL 1.8dev, released 2010/01/19
Path to GDAL shared files: /usr/local/share/gdal
Loaded PROJ.4 runtime: Rel. 4.7.1, 23 September 2009
Path to PROJ.4 shared files: (autodetected)

Thanks

Agus

2010/12/10 Roger Bivand <Roger.Bivand at nhh.no>:
> On Fri, 10 Dec 2010, Agustin Lobo wrote:
>
>> Roger,
>>
>> It does not for me. The error is solved by deleting files xygcatLO.* ,
>> while directory xygcatLO may continue to exist.
>
> Agus,
>
> With which drivers, OGR version (in header when rgdal loads)? If I cannot
> reproduce this, I cannot readily help.
>
> Roger
>
>>
>> Also, I've found that with this version the below command does not
>> save the files within
>> the folder indicated by dsn, but outside. This was not the case in the
>> past, but do not know if this is
>> because of a change in rgdal, gdal or ubuntu 10.04 (I've changed all 3
>> since the last time I used writeOGR()).
>>
>>> writeOGR(xygcatLO,dsn="xygcatLO",layer="xygcatLO", driver="ESRI
>>> Shapefile")
>>
>> Error in writeOGR(xygcatLO, dsn = "xygcatLO", layer = "xygcatLO",
>> driver = "ESRI Shapefile") :
>>
>> ? ? ? ?GDAL Error 1: Layer 'xygcatLO' already exists
>> Calls: writeOGR -> .Call
>>
>>> sessionInfo()
>>
>> R version 2.12.0 (2010-10-15)
>> Platform: x86_64-pc-linux-gnu (64-bit)
>>
>> locale:
>> [1] LC_CTYPE=en_US.utf8 ? ? ? ? ?LC_NUMERIC=C
>> [3] LC_TIME=en_US.utf8 ? ? ? ? ? LC_COLLATE=en_US.utf8
>> [5] LC_MONETARY=en_US.utf8 ? ? ? LC_MESSAGES=en_US.utf8
>> [7] LC_PAPER=en_US.utf8 ? ? ? ? ?LC_NAME=en_US.utf8
>> [9] LC_ADDRESS=en_US.utf8 ? ? ? ?LC_TELEPHONE=en_US.utf8
>> [11] LC_MEASUREMENT=en_US.utf8 ? ?LC_IDENTIFICATION=en_US.utf8
>>
>> attached base packages:
>> [1] stats ? ? graphics ?grDevices utils ? ? datasets ?methods ? base
>>
>> other attached packages:
>> [1] RANN_2.1.2 ? ? ?outliers_0.13-3 rgdal_0.6-30 ? ?raster_1.7-2
>> [5] sp_0.9-73 ? ? ? rkward_0.5.4
>>
>> loaded via a namespace (and not attached):
>> [1] grid_2.12.0 ? ? lattice_0.19-13 tools_2.12.0
>> 2010/12/10 Roger Bivand <Roger.Bivand at nhh.no>:
>>>
>>> On Thu, 9 Dec 2010, Barry Rowlingson wrote:
>>>
>>>> On Thu, Dec 9, 2010 at 8:56 AM, Agustin Lobo <alobolistas at gmail.com>
>>>> wrote:
>>>>>
>>>>> Hi!
>>>>>
>>>>> Could an option overwrite=T (default overwrite=F) be included in
>>>>> writeOGR()?
>>>>> Thanks!
>>>>
>>>> Submit a Feature Request here:
>>>>
>>>> http://sourceforge.net/tracker/?group_id=84716&atid=573625
>>>
>>> No, rgdal is on R-Forge, and a list called rgdal-devel will be available
>>> from tomorrow.
>>>
>>>>
>>>> It looks like it just needs to be a wrapper around OGR's delete layer
>>>> function.
>>>
>>> Contributions welcome. Note that the facility is present for rasters,
>>> which
>>> I fould out by accidentally deleting GRASS database objects (for which of
>>> course I did not have backups). Is this really needed - which drivers do
>>> not
>>> already overwrite without complaint? These do not complain for me:
>>> driver="ESRI Shapefile"; driver="KML"; driver="MapInfo File";
>>> driver="MapInfo File", dataset_options="FORMAT=MIF".
>>>
>>> Hope this helps,
>>>
>>> Roger
>>>
>>>>
>>>> Barry
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at r-project.org
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>
>>> --
>>> Roger Bivand
>>> Economic Geography Section, Department of Economics, Norwegian School of
>>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>>> e-mail: Roger.Bivand at nhh.no
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>
> --
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From Roger.Bivand at nhh.no  Fri Dec 10 18:37:53 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 10 Dec 2010 18:37:53 +0100 (CET)
Subject: [R-sig-Geo] Suggestion: option overwrite=T for writeOGR()
In-Reply-To: <AANLkTinbhGxeRbCK1DJvE8yQQTSozBTUY-C=WFjpmfry@mail.gmail.com>
References: <AANLkTi=D5_u6K67jCtwSafxOpNZ34rJHfSCnGQSSLpOs@mail.gmail.com>
	<AANLkTi=YfZOgvP_75+skqZvTxmZ_bVMZfXN7SMfCsQRb@mail.gmail.com>
	<alpine.LRH.2.00.1012101320330.6560@reclus.nhh.no>
	<AANLkTinMcoacpjRgSEair0ph+tYqTWk8jFFiBgFxgMT5@mail.gmail.com>
	<alpine.LRH.2.00.1012101516480.9170@reclus.nhh.no>
	<AANLkTinbhGxeRbCK1DJvE8yQQTSozBTUY-C=WFjpmfry@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.1012101831190.9628@reclus.nhh.no>

On Fri, 10 Dec 2010, Agustin Lobo wrote:

> Roger,
>
> is this all you need? I thought sessionInfo was providing everything
> needed.

You had given sessionInfo() but that does not report which GDAL you are 
using. The report unfortunately does not give an svn revision, maybe 
gdal-config --version does? I develop using 1.7.* GDAL. Your 1.8dev is 
pretty old, certainly older that released 1.7.3. I can try to build a 
current GDAL trunk from source next week, if I get time, but this looks 
like something in your setup (development GDAL that is now stale?).

> The driver is "ESRI Shapefile" as stated in the command, have not tested 
> any other (it does work for raster though, as you mention):

I mentioned four variants of vector drivers, not raster.

Roger

>
>> require(rgdal)
> Loading required package: rgdal
> Geospatial Data Abstraction Library extensions to R successfully loaded
> Loaded GDAL runtime: GDAL 1.8dev, released 2010/01/19
> Path to GDAL shared files: /usr/local/share/gdal
> Loaded PROJ.4 runtime: Rel. 4.7.1, 23 September 2009
> Path to PROJ.4 shared files: (autodetected)
>
> Thanks
>
> Agus
>
> 2010/12/10 Roger Bivand <Roger.Bivand at nhh.no>:
>> On Fri, 10 Dec 2010, Agustin Lobo wrote:
>>
>>> Roger,
>>>
>>> It does not for me. The error is solved by deleting files xygcatLO.* ,
>>> while directory xygcatLO may continue to exist.
>>
>> Agus,
>>
>> With which drivers, OGR version (in header when rgdal loads)? If I cannot
>> reproduce this, I cannot readily help.
>>
>> Roger
>>
>>>
>>> Also, I've found that with this version the below command does not
>>> save the files within
>>> the folder indicated by dsn, but outside. This was not the case in the
>>> past, but do not know if this is
>>> because of a change in rgdal, gdal or ubuntu 10.04 (I've changed all 3
>>> since the last time I used writeOGR()).
>>>
>>>> writeOGR(xygcatLO,dsn="xygcatLO",layer="xygcatLO", driver="ESRI
>>>> Shapefile")
>>>
>>> Error in writeOGR(xygcatLO, dsn = "xygcatLO", layer = "xygcatLO",
>>> driver = "ESRI Shapefile") :
>>>
>>> ? ? ? ?GDAL Error 1: Layer 'xygcatLO' already exists
>>> Calls: writeOGR -> .Call
>>>
>>>> sessionInfo()
>>>
>>> R version 2.12.0 (2010-10-15)
>>> Platform: x86_64-pc-linux-gnu (64-bit)
>>>
>>> locale:
>>> [1] LC_CTYPE=en_US.utf8 ? ? ? ? ?LC_NUMERIC=C
>>> [3] LC_TIME=en_US.utf8 ? ? ? ? ? LC_COLLATE=en_US.utf8
>>> [5] LC_MONETARY=en_US.utf8 ? ? ? LC_MESSAGES=en_US.utf8
>>> [7] LC_PAPER=en_US.utf8 ? ? ? ? ?LC_NAME=en_US.utf8
>>> [9] LC_ADDRESS=en_US.utf8 ? ? ? ?LC_TELEPHONE=en_US.utf8
>>> [11] LC_MEASUREMENT=en_US.utf8 ? ?LC_IDENTIFICATION=en_US.utf8
>>>
>>> attached base packages:
>>> [1] stats ? ? graphics ?grDevices utils ? ? datasets ?methods ? base
>>>
>>> other attached packages:
>>> [1] RANN_2.1.2 ? ? ?outliers_0.13-3 rgdal_0.6-30 ? ?raster_1.7-2
>>> [5] sp_0.9-73 ? ? ? rkward_0.5.4
>>>
>>> loaded via a namespace (and not attached):
>>> [1] grid_2.12.0 ? ? lattice_0.19-13 tools_2.12.0
>>> 2010/12/10 Roger Bivand <Roger.Bivand at nhh.no>:
>>>>
>>>> On Thu, 9 Dec 2010, Barry Rowlingson wrote:
>>>>
>>>>> On Thu, Dec 9, 2010 at 8:56 AM, Agustin Lobo <alobolistas at gmail.com>
>>>>> wrote:
>>>>>>
>>>>>> Hi!
>>>>>>
>>>>>> Could an option overwrite=T (default overwrite=F) be included in
>>>>>> writeOGR()?
>>>>>> Thanks!
>>>>>
>>>>> Submit a Feature Request here:
>>>>>
>>>>> http://sourceforge.net/tracker/?group_id=84716&atid=573625
>>>>
>>>> No, rgdal is on R-Forge, and a list called rgdal-devel will be available
>>>> from tomorrow.
>>>>
>>>>>
>>>>> It looks like it just needs to be a wrapper around OGR's delete layer
>>>>> function.
>>>>
>>>> Contributions welcome. Note that the facility is present for rasters,
>>>> which
>>>> I fould out by accidentally deleting GRASS database objects (for which of
>>>> course I did not have backups). Is this really needed - which drivers do
>>>> not
>>>> already overwrite without complaint? These do not complain for me:
>>>> driver="ESRI Shapefile"; driver="KML"; driver="MapInfo File";
>>>> driver="MapInfo File", dataset_options="FORMAT=MIF".
>>>>
>>>> Hope this helps,
>>>>
>>>> Roger
>>>>
>>>>>
>>>>> Barry
>>>>>
>>>>> _______________________________________________
>>>>> R-sig-Geo mailing list
>>>>> R-sig-Geo at r-project.org
>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>
>>>>
>>>> --
>>>> Roger Bivand
>>>> Economic Geography Section, Department of Economics, Norwegian School of
>>>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>>>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>>>> e-mail: Roger.Bivand at nhh.no
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at r-project.org
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>
>>
>> --
>> Roger Bivand
>> Economic Geography Section, Department of Economics, Norwegian School of
>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>> e-mail: Roger.Bivand at nhh.no
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From alobolistas at gmail.com  Fri Dec 10 18:39:15 2010
From: alobolistas at gmail.com (Agustin Lobo)
Date: Fri, 10 Dec 2010 18:39:15 +0100
Subject: [R-sig-Geo] Suggestion: option overwrite=T for writeOGR()
In-Reply-To: <AANLkTinbhGxeRbCK1DJvE8yQQTSozBTUY-C=WFjpmfry@mail.gmail.com>
References: <AANLkTi=D5_u6K67jCtwSafxOpNZ34rJHfSCnGQSSLpOs@mail.gmail.com>
	<AANLkTi=YfZOgvP_75+skqZvTxmZ_bVMZfXN7SMfCsQRb@mail.gmail.com>
	<alpine.LRH.2.00.1012101320330.6560@reclus.nhh.no>
	<AANLkTinMcoacpjRgSEair0ph+tYqTWk8jFFiBgFxgMT5@mail.gmail.com>
	<alpine.LRH.2.00.1012101516480.9170@reclus.nhh.no>
	<AANLkTinbhGxeRbCK1DJvE8yQQTSozBTUY-C=WFjpmfry@mail.gmail.com>
Message-ID: <AANLkTik6vAdhuXQVuDLc0mQUF7Q4SxxvLC5AuasY+D-w@mail.gmail.com>

Roger,

it works fine on another computer:

> require(rgdal)
Loading required package: rgdal
Geospatial Data Abstraction Library extensions to R successfully loaded
Loaded GDAL runtime: GDAL 1.7.2, released 2010/04/23
Path to GDAL shared files: /usr/share/gdal17
Loaded PROJ.4 runtime: Rel. 4.7.1, 23 September 2009
Path to PROJ.4 shared files: (autodetected)

> writeOGR(xygcatLO,dsn="xygcatLO",layer="xygcatLO", driver="ESRI Shapefile")
> sessionInfo()
R version 2.12.0 (2010-10-15)
Platform: i486-pc-linux-gnu (32-bit)

locale:
 [1] LC_CTYPE=en_US.UTF-8          LC_NUMERIC=C
LC_TIME=en_US.UTF-8
 [4] LC_COLLATE=en_US.UTF-8        LC_MONETARY=en_US.UTF-8
LC_MESSAGES=en_US.UTF-8
 [7] LC_PAPER=en_US.UTF-8          LC_NAME=en_US.UTF-8
LC_ADDRESS=en_US.UTF-8
[10] LC_TELEPHONE=en_US.UTF-8      LC_MEASUREMENT=en_US.UTF-8
LC_IDENTIFICATION=en_US.UTF-8

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] rgdal_0.6-27  raster_1.6-22 sp_0.9-72     rkward_0.5.4

loaded via a namespace (and not attached):
[1] grid_2.12.0     lattice_0.19-13 tools_2.12.0

Agus


2010/12/10 Agustin Lobo <alobolistas at gmail.com>:
> Roger,
>
> is this all you need? I thought sessionInfo was providing everything
> needed. The driver is
> "ESRI Shapefile" as stated in the command, have not tested any other
> (it does work for
> raster though, as you mention):
>
>> require(rgdal)
> Loading required package: rgdal
> Geospatial Data Abstraction Library extensions to R successfully loaded
> Loaded GDAL runtime: GDAL 1.8dev, released 2010/01/19
> Path to GDAL shared files: /usr/local/share/gdal
> Loaded PROJ.4 runtime: Rel. 4.7.1, 23 September 2009
> Path to PROJ.4 shared files: (autodetected)
>
> Thanks
>
> Agus
>
> 2010/12/10 Roger Bivand <Roger.Bivand at nhh.no>:
>> On Fri, 10 Dec 2010, Agustin Lobo wrote:
>>
>>> Roger,
>>>
>>> It does not for me. The error is solved by deleting files xygcatLO.* ,
>>> while directory xygcatLO may continue to exist.
>>
>> Agus,
>>
>> With which drivers, OGR version (in header when rgdal loads)? If I cannot
>> reproduce this, I cannot readily help.
>>
>> Roger
>>
>>>
>>> Also, I've found that with this version the below command does not
>>> save the files within
>>> the folder indicated by dsn, but outside. This was not the case in the
>>> past, but do not know if this is
>>> because of a change in rgdal, gdal or ubuntu 10.04 (I've changed all 3
>>> since the last time I used writeOGR()).
>>>
>>>> writeOGR(xygcatLO,dsn="xygcatLO",layer="xygcatLO", driver="ESRI
>>>> Shapefile")
>>>
>>> Error in writeOGR(xygcatLO, dsn = "xygcatLO", layer = "xygcatLO",
>>> driver = "ESRI Shapefile") :
>>>
>>> ? ? ? ?GDAL Error 1: Layer 'xygcatLO' already exists
>>> Calls: writeOGR -> .Call
>>>
>>>> sessionInfo()
>>>
>>> R version 2.12.0 (2010-10-15)
>>> Platform: x86_64-pc-linux-gnu (64-bit)
>>>
>>> locale:
>>> [1] LC_CTYPE=en_US.utf8 ? ? ? ? ?LC_NUMERIC=C
>>> [3] LC_TIME=en_US.utf8 ? ? ? ? ? LC_COLLATE=en_US.utf8
>>> [5] LC_MONETARY=en_US.utf8 ? ? ? LC_MESSAGES=en_US.utf8
>>> [7] LC_PAPER=en_US.utf8 ? ? ? ? ?LC_NAME=en_US.utf8
>>> [9] LC_ADDRESS=en_US.utf8 ? ? ? ?LC_TELEPHONE=en_US.utf8
>>> [11] LC_MEASUREMENT=en_US.utf8 ? ?LC_IDENTIFICATION=en_US.utf8
>>>
>>> attached base packages:
>>> [1] stats ? ? graphics ?grDevices utils ? ? datasets ?methods ? base
>>>
>>> other attached packages:
>>> [1] RANN_2.1.2 ? ? ?outliers_0.13-3 rgdal_0.6-30 ? ?raster_1.7-2
>>> [5] sp_0.9-73 ? ? ? rkward_0.5.4
>>>
>>> loaded via a namespace (and not attached):
>>> [1] grid_2.12.0 ? ? lattice_0.19-13 tools_2.12.0
>>> 2010/12/10 Roger Bivand <Roger.Bivand at nhh.no>:
>>>>
>>>> On Thu, 9 Dec 2010, Barry Rowlingson wrote:
>>>>
>>>>> On Thu, Dec 9, 2010 at 8:56 AM, Agustin Lobo <alobolistas at gmail.com>
>>>>> wrote:
>>>>>>
>>>>>> Hi!
>>>>>>
>>>>>> Could an option overwrite=T (default overwrite=F) be included in
>>>>>> writeOGR()?
>>>>>> Thanks!
>>>>>
>>>>> Submit a Feature Request here:
>>>>>
>>>>> http://sourceforge.net/tracker/?group_id=84716&atid=573625
>>>>
>>>> No, rgdal is on R-Forge, and a list called rgdal-devel will be available
>>>> from tomorrow.
>>>>
>>>>>
>>>>> It looks like it just needs to be a wrapper around OGR's delete layer
>>>>> function.
>>>>
>>>> Contributions welcome. Note that the facility is present for rasters,
>>>> which
>>>> I fould out by accidentally deleting GRASS database objects (for which of
>>>> course I did not have backups). Is this really needed - which drivers do
>>>> not
>>>> already overwrite without complaint? These do not complain for me:
>>>> driver="ESRI Shapefile"; driver="KML"; driver="MapInfo File";
>>>> driver="MapInfo File", dataset_options="FORMAT=MIF".
>>>>
>>>> Hope this helps,
>>>>
>>>> Roger
>>>>
>>>>>
>>>>> Barry
>>>>>
>>>>> _______________________________________________
>>>>> R-sig-Geo mailing list
>>>>> R-sig-Geo at r-project.org
>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>
>>>>
>>>> --
>>>> Roger Bivand
>>>> Economic Geography Section, Department of Economics, Norwegian School of
>>>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>>>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>>>> e-mail: Roger.Bivand at nhh.no
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at r-project.org
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>
>>
>> --
>> Roger Bivand
>> Economic Geography Section, Department of Economics, Norwegian School of
>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>> e-mail: Roger.Bivand at nhh.no
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>


From alobolistas at gmail.com  Fri Dec 10 18:49:22 2010
From: alobolistas at gmail.com (Agustin Lobo)
Date: Fri, 10 Dec 2010 18:49:22 +0100
Subject: [R-sig-Geo] Suggestion: option overwrite=T for writeOGR()
In-Reply-To: <alpine.LRH.2.00.1012101831190.9628@reclus.nhh.no>
References: <AANLkTi=D5_u6K67jCtwSafxOpNZ34rJHfSCnGQSSLpOs@mail.gmail.com>
	<AANLkTi=YfZOgvP_75+skqZvTxmZ_bVMZfXN7SMfCsQRb@mail.gmail.com>
	<alpine.LRH.2.00.1012101320330.6560@reclus.nhh.no>
	<AANLkTinMcoacpjRgSEair0ph+tYqTWk8jFFiBgFxgMT5@mail.gmail.com>
	<alpine.LRH.2.00.1012101516480.9170@reclus.nhh.no>
	<AANLkTinbhGxeRbCK1DJvE8yQQTSozBTUY-C=WFjpmfry@mail.gmail.com>
	<alpine.LRH.2.00.1012101831190.9628@reclus.nhh.no>
Message-ID: <AANLkTikLWczW0AWneragJz2NFyM_fgtqifa6Hk++1hAE@mail.gmail.com>

Roger,

I was not aware that 1.8dev is actually older than 1.7.2
I'll check why I have that gdal on the other machine and will try
to fix that on my side on Monday. But perhaps this problem will come up
again for future stable versions of 1.8.* ? Anyway, 1.8dev is clearly not a good
choice and I have to change it.

Thanks

Agus

2010/12/10 Roger Bivand <Roger.Bivand at nhh.no>:
> On Fri, 10 Dec 2010, Agustin Lobo wrote:
>
>> Roger,
>>
>> is this all you need? I thought sessionInfo was providing everything
>> needed.
>
> You had given sessionInfo() but that does not report which GDAL you are
> using. The report unfortunately does not give an svn revision, maybe
> gdal-config --version does? I develop using 1.7.* GDAL. Your 1.8dev is
> pretty old, certainly older that released 1.7.3. I can try to build a
> current GDAL trunk from source next week, if I get time, but this looks like
> something in your setup (development GDAL that is now stale?).
>
>> The driver is "ESRI Shapefile" as stated in the command, have not tested
>> any other (it does work for raster though, as you mention):
>
> I mentioned four variants of vector drivers, not raster.
>
> Roger
>
>>
>>> require(rgdal)
>>
>> Loading required package: rgdal
>> Geospatial Data Abstraction Library extensions to R successfully loaded
>> Loaded GDAL runtime: GDAL 1.8dev, released 2010/01/19
>> Path to GDAL shared files: /usr/local/share/gdal
>> Loaded PROJ.4 runtime: Rel. 4.7.1, 23 September 2009
>> Path to PROJ.4 shared files: (autodetected)
>>
>> Thanks
>>
>> Agus
>>
>> 2010/12/10 Roger Bivand <Roger.Bivand at nhh.no>:
>>>
>>> On Fri, 10 Dec 2010, Agustin Lobo wrote:
>>>
>>>> Roger,
>>>>
>>>> It does not for me. The error is solved by deleting files xygcatLO.* ,
>>>> while directory xygcatLO may continue to exist.
>>>
>>> Agus,
>>>
>>> With which drivers, OGR version (in header when rgdal loads)? If I cannot
>>> reproduce this, I cannot readily help.
>>>
>>> Roger
>>>
>>>>
>>>> Also, I've found that with this version the below command does not
>>>> save the files within
>>>> the folder indicated by dsn, but outside. This was not the case in the
>>>> past, but do not know if this is
>>>> because of a change in rgdal, gdal or ubuntu 10.04 (I've changed all 3
>>>> since the last time I used writeOGR()).
>>>>
>>>>> writeOGR(xygcatLO,dsn="xygcatLO",layer="xygcatLO", driver="ESRI
>>>>> Shapefile")
>>>>
>>>> Error in writeOGR(xygcatLO, dsn = "xygcatLO", layer = "xygcatLO",
>>>> driver = "ESRI Shapefile") :
>>>>
>>>> ? ? ? ?GDAL Error 1: Layer 'xygcatLO' already exists
>>>> Calls: writeOGR -> .Call
>>>>
>>>>> sessionInfo()
>>>>
>>>> R version 2.12.0 (2010-10-15)
>>>> Platform: x86_64-pc-linux-gnu (64-bit)
>>>>
>>>> locale:
>>>> [1] LC_CTYPE=en_US.utf8 ? ? ? ? ?LC_NUMERIC=C
>>>> [3] LC_TIME=en_US.utf8 ? ? ? ? ? LC_COLLATE=en_US.utf8
>>>> [5] LC_MONETARY=en_US.utf8 ? ? ? LC_MESSAGES=en_US.utf8
>>>> [7] LC_PAPER=en_US.utf8 ? ? ? ? ?LC_NAME=en_US.utf8
>>>> [9] LC_ADDRESS=en_US.utf8 ? ? ? ?LC_TELEPHONE=en_US.utf8
>>>> [11] LC_MEASUREMENT=en_US.utf8 ? ?LC_IDENTIFICATION=en_US.utf8
>>>>
>>>> attached base packages:
>>>> [1] stats ? ? graphics ?grDevices utils ? ? datasets ?methods ? base
>>>>
>>>> other attached packages:
>>>> [1] RANN_2.1.2 ? ? ?outliers_0.13-3 rgdal_0.6-30 ? ?raster_1.7-2
>>>> [5] sp_0.9-73 ? ? ? rkward_0.5.4
>>>>
>>>> loaded via a namespace (and not attached):
>>>> [1] grid_2.12.0 ? ? lattice_0.19-13 tools_2.12.0
>>>> 2010/12/10 Roger Bivand <Roger.Bivand at nhh.no>:
>>>>>
>>>>> On Thu, 9 Dec 2010, Barry Rowlingson wrote:
>>>>>
>>>>>> On Thu, Dec 9, 2010 at 8:56 AM, Agustin Lobo <alobolistas at gmail.com>
>>>>>> wrote:
>>>>>>>
>>>>>>> Hi!
>>>>>>>
>>>>>>> Could an option overwrite=T (default overwrite=F) be included in
>>>>>>> writeOGR()?
>>>>>>> Thanks!
>>>>>>
>>>>>> Submit a Feature Request here:
>>>>>>
>>>>>> http://sourceforge.net/tracker/?group_id=84716&atid=573625
>>>>>
>>>>> No, rgdal is on R-Forge, and a list called rgdal-devel will be
>>>>> available
>>>>> from tomorrow.
>>>>>
>>>>>>
>>>>>> It looks like it just needs to be a wrapper around OGR's delete layer
>>>>>> function.
>>>>>
>>>>> Contributions welcome. Note that the facility is present for rasters,
>>>>> which
>>>>> I fould out by accidentally deleting GRASS database objects (for which
>>>>> of
>>>>> course I did not have backups). Is this really needed - which drivers
>>>>> do
>>>>> not
>>>>> already overwrite without complaint? These do not complain for me:
>>>>> driver="ESRI Shapefile"; driver="KML"; driver="MapInfo File";
>>>>> driver="MapInfo File", dataset_options="FORMAT=MIF".
>>>>>
>>>>> Hope this helps,
>>>>>
>>>>> Roger
>>>>>
>>>>>>
>>>>>> Barry
>>>>>>
>>>>>> _______________________________________________
>>>>>> R-sig-Geo mailing list
>>>>>> R-sig-Geo at r-project.org
>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>>
>>>>>
>>>>> --
>>>>> Roger Bivand
>>>>> Economic Geography Section, Department of Economics, Norwegian School
>>>>> of
>>>>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>>>>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>>>>> e-mail: Roger.Bivand at nhh.no
>>>>>
>>>>> _______________________________________________
>>>>> R-sig-Geo mailing list
>>>>> R-sig-Geo at r-project.org
>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>
>>>>
>>>
>>> --
>>> Roger Bivand
>>> Economic Geography Section, Department of Economics, Norwegian School of
>>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>>> e-mail: Roger.Bivand at nhh.no
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>
> --
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>


From haileyeckstrand at gmail.com  Fri Dec 10 20:02:32 2010
From: haileyeckstrand at gmail.com (Hailey Eckstrand)
Date: Fri, 10 Dec 2010 11:02:32 -0800
Subject: [R-sig-Geo] polygon intersecting with point question
In-Reply-To: <AANLkTi=91rhCtp+0P5FvLhyE45hWiZUUwWgV-Gqf4LZ0@mail.gmail.com>
References: <AANLkTimeSgwt_fFf8pijjAOCi7N7CsmOuqF3AoxwC5=P@mail.gmail.com>
	<AANLkTi=91rhCtp+0P5FvLhyE45hWiZUUwWgV-Gqf4LZ0@mail.gmail.com>
Message-ID: <AANLkTimAAAvdGhq2gLELoxG+1o6s-+6EUgKvec22tp1h@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101210/c4d44cda/attachment.pl>

From dorina.lazar at econ.ubbcluj.ro  Fri Dec 10 20:41:55 2010
From: dorina.lazar at econ.ubbcluj.ro (dorina.lazar)
Date: Fri, 10 Dec 2010 21:41:55 +0200
Subject: [R-sig-Geo] Clusters of countries
Message-ID: <a7cd94d51a1dcd182e718e686cd68fbc@econ.ubbcluj.ro>

Dear all,

I am looking for a clustering method usefull to classify the countries in 
some clusters taking account of: a) the geographical distance (in km)
between countries  and b) of some macroeconomic indicators (gdp, life
expectancy...). 
Are there some packages in R usefull for this? 

Thanks a lot for your help,
Dorina


From basille at ase-research.org  Fri Dec 10 20:57:06 2010
From: basille at ase-research.org (Mathieu Basille)
Date: Fri, 10 Dec 2010 14:57:06 -0500
Subject: [R-sig-Geo] Step characteristics on raster maps
In-Reply-To: <4CA4869E.8000405@ase-research.org>
References: <4CA4869E.8000405@ase-research.org>
Message-ID: <4D028612.2050403@ase-research.org>

Dear list members,

Sorry if I didn't replied earlier, but here is the solution I finally
used. Thanks to Pierre Racine who helped us, I installed a PostgreSQL
data base, with PostGIS and WKTRaster [1]. WKTRaster allows to handle
raster maps in addition to all vector classes already supported by PostGIS.

In the end, after the import of trajectories within the db (via ltraj >
SpatialLinesDataFrame > Shapefile > DB, but there might be easier
solutions), it is relatively easy to get the overlay of the trajectory
with raster maps, after some SQL learning. With this approach, it is
actually possible to split each segment into smaller segments according
to the underneath pixels. In the end, it is thus possible to get the
exact proportion of each segment regarding the underlying map. And the
process is incredibly fast (compared to pure R code or ArcGIS).

The only current drawback is that WKTRaster can handle only integer
maps. The workaround for continuous maps is to scale it, e.g., between 0
and 100 to get enough information with the integer part of it. WKTRaster
is still under heavy development, and this should be fixed in the future.

Hope this helps other people interested!
Mathieu Basille.


[1] http://trac.osgeo.org/postgis/wiki/WKTRaster



Le 30/09/2010 08:46, Mathieu Basille a ?crit :
> Dear list members,
>
> I'm trying to compute characteristics along steps (i.e. segments between
> two points), based on underlying raster maps. The steps originally come
> from radiotracking data, converted to ltraj objects (adehabitat). The
> idea is to compute (for example) the habitat composition corresponding
> to each step instead of each points, as we are interesting in the
> movement path.
>
> I tried different solutions, as I would like to do it with R. I did not
> find any solution using adehabitat (or the development versions
> adehabitatMA/LS); 'join' only works for point characteristics, not
> steps. I also tried using sp and SpatialLinesDataFrame, but overlay does
> not seem to work with SpatialLines(DataFrame) and SpatialPixelsDataFrame:
>
> Error in function (classes, fdef, mtable) :
> unable to find an inherited method for function "overlay", for signature
> "SpatialPixelsDataFrame", "SpatialLinesDataFrame"
>
> I also investigated packages raster, trip, and rgeos, without success.
> Maybe the low level functions of rgeos could be used, but it seems a bit
> out of my skills (and time available) at the moment.
>
> Another solution might be to use spgrass6 in conjunction with GRASS, but
> I'm not familiar enough with GRASS to judge if it is a viable
> alternative...
>
> I'd welcome any hints/thoughts on this question.
> Sincerely,
> Mathieu Basille.
>
>

-- 

~$ whoami
Mathieu Basille, Post-Doc

~$ locate
Laboratoire d'?cologie Comportementale et de Conservation de la Faune
+ Centre d'?tude de la For?t
D?partement de Biologie
Universit? Laval, Qu?bec

~$ info
http://ase-research.org/basille

~$ fortune
``If you can't win by reason, go for volume.''
Calvin, by Bill Watterson.


From rundel at gmail.com  Sat Dec 11 06:52:26 2010
From: rundel at gmail.com (rundel)
Date: Fri, 10 Dec 2010 21:52:26 -0800 (PST)
Subject: [R-sig-Geo] polygon intersecting with point question
In-Reply-To: <AANLkTimeSgwt_fFf8pijjAOCi7N7CsmOuqF3AoxwC5=P@mail.gmail.com>
References: <AANLkTimeSgwt_fFf8pijjAOCi7N7CsmOuqF3AoxwC5=P@mail.gmail.com>
Message-ID: <1292046746350-5825458.post@n2.nabble.com>


One quick suggestion I have is when you use the gBuffer function use
byid=TRUE as this will result in three separate polygons and not one
multipolygon. This is true for all of the rgeos functions, byid indicates if
the input object should be treated as a geometry collection (when FALSE) or
as a multigeometry (when TRUE).

In order to get the number of point intersections with each geometry you can
also use rgeos and the gIntersects function. An example of something
similar:

library(rgeos)
pts = SpatialPoints(data.frame(x=c(1,1,2,2),y=c(1,2,1,2)))
polys = gBuffer(pts,byid=TRUE,width=0.45,quadsegs=10)


plot(c(0,3),c(0,3),type='n')
plot(polys)
plot(pts,pch=names(polys),add=T) #Label polygons

set.seed(0)
x=runif(25,0,3)
y=runif(25,0,3)
rand.pts = SpatialPoints(data.frame(x=x,y=y))

plot(rand.pts,add=T)

# this is a logical matrix indicating which polygons intersect with which
points
its = gIntersects(polys,rand.pts,byid=TRUE) 

# summing over the columns gives us the number of points that intersect with
each polygon
apply(its,2,sum) 



-Colin
-- 
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/polygon-intersecting-with-point-question-tp5821233p5825458.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From Roger.Bivand at nhh.no  Sat Dec 11 18:49:54 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sat, 11 Dec 2010 18:49:54 +0100 (CET)
Subject: [R-sig-Geo] Suggestion: option overwrite=T for writeOGR()
In-Reply-To: <AANLkTikLWczW0AWneragJz2NFyM_fgtqifa6Hk++1hAE@mail.gmail.com>
References: <AANLkTi=D5_u6K67jCtwSafxOpNZ34rJHfSCnGQSSLpOs@mail.gmail.com>
	<AANLkTi=YfZOgvP_75+skqZvTxmZ_bVMZfXN7SMfCsQRb@mail.gmail.com>
	<alpine.LRH.2.00.1012101320330.6560@reclus.nhh.no>
	<AANLkTinMcoacpjRgSEair0ph+tYqTWk8jFFiBgFxgMT5@mail.gmail.com>
	<alpine.LRH.2.00.1012101516480.9170@reclus.nhh.no>
	<AANLkTinbhGxeRbCK1DJvE8yQQTSozBTUY-C=WFjpmfry@mail.gmail.com>
	<alpine.LRH.2.00.1012101831190.9628@reclus.nhh.no>
	<AANLkTikLWczW0AWneragJz2NFyM_fgtqifa6Hk++1hAE@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.1012111828090.13472@reclus.nhh.no>

On Fri, 10 Dec 2010, Agustin Lobo wrote:

> Roger,
>
> I was not aware that 1.8dev is actually older than 1.7.2 I'll check why 
> I have that gdal on the other machine and will try to fix that on my 
> side on Monday. But perhaps this problem will come up again for future 
> stable versions of 1.8.* ? Anyway, 1.8dev is clearly not a good choice 
> and I have to change it.

As of GDAL 1.8.0 SVN revision 21234, the problem exists. I'll fix this in 
rgdal for the drivers I am familiar with before 1.8.0 is released.

Roger

>
> Thanks
>
> Agus
>
> 2010/12/10 Roger Bivand <Roger.Bivand at nhh.no>:
>> On Fri, 10 Dec 2010, Agustin Lobo wrote:
>>
>>> Roger,
>>>
>>> is this all you need? I thought sessionInfo was providing everything
>>> needed.
>>
>> You had given sessionInfo() but that does not report which GDAL you are
>> using. The report unfortunately does not give an svn revision, maybe
>> gdal-config --version does? I develop using 1.7.* GDAL. Your 1.8dev is
>> pretty old, certainly older that released 1.7.3. I can try to build a
>> current GDAL trunk from source next week, if I get time, but this looks like
>> something in your setup (development GDAL that is now stale?).
>>
>>> The driver is "ESRI Shapefile" as stated in the command, have not tested
>>> any other (it does work for raster though, as you mention):
>>
>> I mentioned four variants of vector drivers, not raster.
>>
>> Roger
>>
>>>
>>>> require(rgdal)
>>>
>>> Loading required package: rgdal
>>> Geospatial Data Abstraction Library extensions to R successfully loaded
>>> Loaded GDAL runtime: GDAL 1.8dev, released 2010/01/19
>>> Path to GDAL shared files: /usr/local/share/gdal
>>> Loaded PROJ.4 runtime: Rel. 4.7.1, 23 September 2009
>>> Path to PROJ.4 shared files: (autodetected)
>>>
>>> Thanks
>>>
>>> Agus
>>>
>>> 2010/12/10 Roger Bivand <Roger.Bivand at nhh.no>:
>>>>
>>>> On Fri, 10 Dec 2010, Agustin Lobo wrote:
>>>>
>>>>> Roger,
>>>>>
>>>>> It does not for me. The error is solved by deleting files xygcatLO.* ,
>>>>> while directory xygcatLO may continue to exist.
>>>>
>>>> Agus,
>>>>
>>>> With which drivers, OGR version (in header when rgdal loads)? If I cannot
>>>> reproduce this, I cannot readily help.
>>>>
>>>> Roger
>>>>
>>>>>
>>>>> Also, I've found that with this version the below command does not
>>>>> save the files within
>>>>> the folder indicated by dsn, but outside. This was not the case in the
>>>>> past, but do not know if this is
>>>>> because of a change in rgdal, gdal or ubuntu 10.04 (I've changed all 3
>>>>> since the last time I used writeOGR()).
>>>>>
>>>>>> writeOGR(xygcatLO,dsn="xygcatLO",layer="xygcatLO", driver="ESRI
>>>>>> Shapefile")
>>>>>
>>>>> Error in writeOGR(xygcatLO, dsn = "xygcatLO", layer = "xygcatLO",
>>>>> driver = "ESRI Shapefile") :
>>>>>
>>>>> ? ? ? ?GDAL Error 1: Layer 'xygcatLO' already exists
>>>>> Calls: writeOGR -> .Call
>>>>>
>>>>>> sessionInfo()
>>>>>
>>>>> R version 2.12.0 (2010-10-15)
>>>>> Platform: x86_64-pc-linux-gnu (64-bit)
>>>>>
>>>>> locale:
>>>>> [1] LC_CTYPE=en_US.utf8 ? ? ? ? ?LC_NUMERIC=C
>>>>> [3] LC_TIME=en_US.utf8 ? ? ? ? ? LC_COLLATE=en_US.utf8
>>>>> [5] LC_MONETARY=en_US.utf8 ? ? ? LC_MESSAGES=en_US.utf8
>>>>> [7] LC_PAPER=en_US.utf8 ? ? ? ? ?LC_NAME=en_US.utf8
>>>>> [9] LC_ADDRESS=en_US.utf8 ? ? ? ?LC_TELEPHONE=en_US.utf8
>>>>> [11] LC_MEASUREMENT=en_US.utf8 ? ?LC_IDENTIFICATION=en_US.utf8
>>>>>
>>>>> attached base packages:
>>>>> [1] stats ? ? graphics ?grDevices utils ? ? datasets ?methods ? base
>>>>>
>>>>> other attached packages:
>>>>> [1] RANN_2.1.2 ? ? ?outliers_0.13-3 rgdal_0.6-30 ? ?raster_1.7-2
>>>>> [5] sp_0.9-73 ? ? ? rkward_0.5.4
>>>>>
>>>>> loaded via a namespace (and not attached):
>>>>> [1] grid_2.12.0 ? ? lattice_0.19-13 tools_2.12.0
>>>>> 2010/12/10 Roger Bivand <Roger.Bivand at nhh.no>:
>>>>>>
>>>>>> On Thu, 9 Dec 2010, Barry Rowlingson wrote:
>>>>>>
>>>>>>> On Thu, Dec 9, 2010 at 8:56 AM, Agustin Lobo <alobolistas at gmail.com>
>>>>>>> wrote:
>>>>>>>>
>>>>>>>> Hi!
>>>>>>>>
>>>>>>>> Could an option overwrite=T (default overwrite=F) be included in
>>>>>>>> writeOGR()?
>>>>>>>> Thanks!
>>>>>>>
>>>>>>> Submit a Feature Request here:
>>>>>>>
>>>>>>> http://sourceforge.net/tracker/?group_id=84716&atid=573625
>>>>>>
>>>>>> No, rgdal is on R-Forge, and a list called rgdal-devel will be
>>>>>> available
>>>>>> from tomorrow.
>>>>>>
>>>>>>>
>>>>>>> It looks like it just needs to be a wrapper around OGR's delete layer
>>>>>>> function.
>>>>>>
>>>>>> Contributions welcome. Note that the facility is present for rasters,
>>>>>> which
>>>>>> I fould out by accidentally deleting GRASS database objects (for which
>>>>>> of
>>>>>> course I did not have backups). Is this really needed - which drivers
>>>>>> do
>>>>>> not
>>>>>> already overwrite without complaint? These do not complain for me:
>>>>>> driver="ESRI Shapefile"; driver="KML"; driver="MapInfo File";
>>>>>> driver="MapInfo File", dataset_options="FORMAT=MIF".
>>>>>>
>>>>>> Hope this helps,
>>>>>>
>>>>>> Roger
>>>>>>
>>>>>>>
>>>>>>> Barry
>>>>>>>
>>>>>>> _______________________________________________
>>>>>>> R-sig-Geo mailing list
>>>>>>> R-sig-Geo at r-project.org
>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>>>
>>>>>>
>>>>>> --
>>>>>> Roger Bivand
>>>>>> Economic Geography Section, Department of Economics, Norwegian School
>>>>>> of
>>>>>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>>>>>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>>>>>> e-mail: Roger.Bivand at nhh.no
>>>>>>
>>>>>> _______________________________________________
>>>>>> R-sig-Geo mailing list
>>>>>> R-sig-Geo at r-project.org
>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>>
>>>>>
>>>>
>>>> --
>>>> Roger Bivand
>>>> Economic Geography Section, Department of Economics, Norwegian School of
>>>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>>>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>>>> e-mail: Roger.Bivand at nhh.no
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at r-project.org
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>
>>
>> --
>> Roger Bivand
>> Economic Geography Section, Department of Economics, Norwegian School of
>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>> e-mail: Roger.Bivand at nhh.no
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From mdsumner at gmail.com  Sun Dec 12 00:09:34 2010
From: mdsumner at gmail.com (Michael Sumner)
Date: Sun, 12 Dec 2010 10:09:34 +1100
Subject: [R-sig-Geo] RGB in image()
In-Reply-To: <70FC67C4A585D1489E66225A4E0238BAC4DD74@RZS-EXC-CL06.rz-sued.bayern.de>
References: <70FC67C4A585D1489E66225A4E0238BAC4DD74@RZS-EXC-CL06.rz-sued.bayern.de>
Message-ID: <AANLkTik6rq+bp-Yv3+EFEDhUjvYqy_7xZM_bdRgmR_d7@mail.gmail.com>

You need to generate an index on the grid and a colour table to use.
See ?SGDF2PCT in the rgdal package, and the following should work:



   cols <- SGDF2PCT(pd)
     pd$idx <- cols$idx
   image(pd, col = cols$ct)

Also, this question is more appropriate for the R-Sig-Geo mailing list.

Cheers, Mike.

On Fri, Dec 10, 2010 at 9:20 PM,  <Tim.Haering at lwf.bayern.de> wrote:
> Hello,
>
> I would like to plot a SpatialGridDataFrame using the image() function, but have problems with the colors. I want to create a transparent rgb image using three bands as red, green and blue and want to control the transparency with the alpha parameter.
> I have a matrix "dist" containing my rgb values:
>> head(dist)
> ? ? ? ? ?[,1] ? ? ?[,2] ? ? ?[,3]
> [1,] 0.1895978 0.5196565 0.2907457
> [2,] 0.2292516 0.5269284 0.2438200
> [3,] 0.1514392 0.4990144 0.3495464
> ...
> ### create a color vector using rgb()
>> cols <- apply(dist, 1, function(x) rgb(x[1], x[2], x[3], alpha = .2))
>
> ### rescale rgb values to c(0,255)
>> red <- as.integer(RESCALE(dist[,1],0,255,min(dist[,1]), max(dist[,1])))
>> green <- as.integer(RESCALE(dist[,2],0,255,min(dist[,2]), max(dist[,2])))
>> blue <- as.integer(RESCALE(dist[,3],0,255,min(dist[,3]), max(dist[,3])))
>
> ### create a SGDF
>> pd <- data.frame(RW = p$RW, HW = p$HW, red=red, green=green, blue=blue, cols)
>> gridded(pd) = ~RW+HW
>> pd <- as(pd, "SpatialGridDataFrame")
>
> ### using the red, green and blue parameters my image looks fine except that
> ### my colors aren`t transparent
>> image(pd, red="red", green="green", blue="blue")
>
> ### If I use my color vector (containing transparent colors) the image looks
> ### speckled.
>> image(pd, col = cols)
>
> Can somebody help me? Is there another way to make the color transparent?
>
> TIM
>
>
> -------------------------------------
> Tim H?ring
> Bavarian State Institute of Forestry
> Department of Forest Ecology
> Hans-Carl-von-Carlowitz-Platz 1
> D-85354 Freising
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



-- 
Michael Sumner
Institute for Marine and Antarctic Studies, University of Tasmania
Hobart, Australia
e-mail: mdsumner at gmail.com


From mdsumner at gmail.com  Sun Dec 12 02:50:40 2010
From: mdsumner at gmail.com (Michael Sumner)
Date: Sun, 12 Dec 2010 12:50:40 +1100
Subject: [R-sig-Geo] RGB in image()
In-Reply-To: <AANLkTik6rq+bp-Yv3+EFEDhUjvYqy_7xZM_bdRgmR_d7@mail.gmail.com>
References: <70FC67C4A585D1489E66225A4E0238BAC4DD74@RZS-EXC-CL06.rz-sued.bayern.de>
	<AANLkTik6rq+bp-Yv3+EFEDhUjvYqy_7xZM_bdRgmR_d7@mail.gmail.com>
Message-ID: <AANLkTin=53MG0q2bc+ba0Nby_-CpnuYfKPsmYZLg-GF4@mail.gmail.com>

I forgot about alpha, you'll need to modify the colours in ct to suit:

SGlogo <- readGDAL(logo)

cols <- SGDF2PCT(SGlogo)

cola <- rbind(col2rgb(cols$ct[170:200]), alpha = 150)

cols$ct[170:200] <- rgb(cola[1,], cola[2,], cola[3,], cola[4,],
maxColorValue = 255)
SGlogo$idx <- cols$idx
image(SGlogo, "idx", col=cols$ct)


Whether the transparency is supported will depend on the device, I
used windows().

Cheers, Mike.


On Sun, Dec 12, 2010 at 10:09 AM, Michael Sumner <mdsumner at gmail.com> wrote:
> You need to generate an index on the grid and a colour table to use.
> See ?SGDF2PCT in the rgdal package, and the following should work:
>
>
>
> ? cols <- SGDF2PCT(pd)
> ? ? pd$idx <- cols$idx
> ? image(pd, col = cols$ct)
>
> Also, this question is more appropriate for the R-Sig-Geo mailing list.
>
> Cheers, Mike.
>
> On Fri, Dec 10, 2010 at 9:20 PM, ?<Tim.Haering at lwf.bayern.de> wrote:
>> Hello,
>>
>> I would like to plot a SpatialGridDataFrame using the image() function, but have problems with the colors. I want to create a transparent rgb image using three bands as red, green and blue and want to control the transparency with the alpha parameter.
>> I have a matrix "dist" containing my rgb values:
>>> head(dist)
>> ? ? ? ? ?[,1] ? ? ?[,2] ? ? ?[,3]
>> [1,] 0.1895978 0.5196565 0.2907457
>> [2,] 0.2292516 0.5269284 0.2438200
>> [3,] 0.1514392 0.4990144 0.3495464
>> ...
>> ### create a color vector using rgb()
>>> cols <- apply(dist, 1, function(x) rgb(x[1], x[2], x[3], alpha = .2))
>>
>> ### rescale rgb values to c(0,255)
>>> red <- as.integer(RESCALE(dist[,1],0,255,min(dist[,1]), max(dist[,1])))
>>> green <- as.integer(RESCALE(dist[,2],0,255,min(dist[,2]), max(dist[,2])))
>>> blue <- as.integer(RESCALE(dist[,3],0,255,min(dist[,3]), max(dist[,3])))
>>
>> ### create a SGDF
>>> pd <- data.frame(RW = p$RW, HW = p$HW, red=red, green=green, blue=blue, cols)
>>> gridded(pd) = ~RW+HW
>>> pd <- as(pd, "SpatialGridDataFrame")
>>
>> ### using the red, green and blue parameters my image looks fine except that
>> ### my colors aren`t transparent
>>> image(pd, red="red", green="green", blue="blue")
>>
>> ### If I use my color vector (containing transparent colors) the image looks
>> ### speckled.
>>> image(pd, col = cols)
>>
>> Can somebody help me? Is there another way to make the color transparent?
>>
>> TIM
>>
>>
>> -------------------------------------
>> Tim H?ring
>> Bavarian State Institute of Forestry
>> Department of Forest Ecology
>> Hans-Carl-von-Carlowitz-Platz 1
>> D-85354 Freising
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>
>
> --
> Michael Sumner
> Institute for Marine and Antarctic Studies, University of Tasmania
> Hobart, Australia
> e-mail: mdsumner at gmail.com
>



-- 
Michael Sumner
Institute for Marine and Antarctic Studies, University of Tasmania
Hobart, Australia
e-mail: mdsumner at gmail.com


From advaitgodbole at gmail.com  Sun Dec 12 06:44:41 2010
From: advaitgodbole at gmail.com (Advait Godbole)
Date: Sun, 12 Dec 2010 00:44:41 -0500
Subject: [R-sig-Geo] getting rasters to match
Message-ID: <AANLkTimh_NmPmxa+nZZnL2P6Wxy7bhaZK4RgKmFvMoVX@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101212/58b3a49a/attachment.pl>

From nkkroy3 at gmail.com  Sun Dec 12 08:48:09 2010
From: nkkroy3 at gmail.com (Nikki roy)
Date: Sun, 12 Dec 2010 08:48:09 +0100
Subject: [R-sig-Geo] kriging function
Message-ID: <AANLkTinzRnN6a7pOYDE_+hp6R2tKqRRXAy9n3foY0ut9@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101212/021c12cd/attachment.pl>

From edzer.pebesma at uni-muenster.de  Sun Dec 12 19:07:31 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Sun, 12 Dec 2010 19:07:31 +0100
Subject: [R-sig-Geo] kriging function
In-Reply-To: <AANLkTinzRnN6a7pOYDE_+hp6R2tKqRRXAy9n3foY0ut9@mail.gmail.com>
References: <AANLkTinzRnN6a7pOYDE_+hp6R2tKqRRXAy9n3foY0ut9@mail.gmail.com>
Message-ID: <4D050F63.9060407@uni-muenster.de>

On 12/12/2010 08:48 AM, Nikki roy wrote:

> "
> any suggestions?
> 

Yes, provide us with an example that we can reproduce, ideally based on
the meuse + meuse.grid data set, where you could introduce some missing
values.
-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From valcu at orn.mpg.de  Sun Dec 12 21:29:08 2010
From: valcu at orn.mpg.de (Mihai Valcu)
Date: Sun, 12 Dec 2010 21:29:08 +0100
Subject: [R-sig-Geo] looking up country names from lat long
In-Reply-To: <AANLkTinNVs8Fjzh2KOsMcnE+J_dq4kYDZX=E_ohWiRNH@mail.gmail.com>
References: <AANLkTinpSKz0BwrEjoVKQk7oFAcFEPfDaYm6KowQwYxf@mail.gmail.com>
	<AANLkTinNVs8Fjzh2KOsMcnE+J_dq4kYDZX=E_ohWiRNH@mail.gmail.com>
Message-ID: <4D053094.7070907@orn.mpg.de>


An offline country map + overlay should work pretty fast.

##########
require(rgdal)
setwd(tempdir())
download.file("http://www.naturalearthdata.com/http//www.naturalearthdata.com/download/110m/cultural/110m-admin-0-countries.zip",destfile 
= "temp")
unzip(zipfile = "temp")
w = readOGR(tempdir(), '110m_admin_0_countries')
# some random points of interest
poi = SpatialPointsDataFrame(spsample(w, 10, "random"), data = 
data.frame(id = 1:10))
poi at data$cntry =  w at data[overlay(poi, w), "NAME"]
plot(w)
plot(poi, add = T, col = 2)
text(poi, labels = poi$cntry, col = 2, cex = 1)
##########

Best wishes
Mihai

On 12/6/2010 3:19 PM, Barry Rowlingson wrote:
> On Mon, Dec 6, 2010 at 1:41 PM, Josh Tewksbury<tewksjj at gmail.com>  wrote:
>> Hello - here is what I am sure is a quick question from someone new to R in
>> spatial stats. I have a long list of lat long coordinates and I would like
>> to do a location country check to extrapolate a country name from each
>> lat/long point.
>>
>> so, for example, my data look like
>>
>> lat, long
>> 14.42, -89.92
>> 14.42, -89.75
>> 14.42, -89.58
>> 14.42, -89.42
>> 14.42, -89.25
>>
>> continued for the terrestrial surface of the earth.
>>
>> If I want to add country names, so I can use those names as tags to merge in
>> other data, is there an easy lookup that will allow me to do that, so I end
>> up with:
>>
>> lat, long, country
>> 14.42, -89.92, Guatemala
>> 14.42, -89.75, Guatemala
>> 14.42, -89.58, Guatemala
>> 14.42, -89.42, El Salvador
>> 14.42, -89.25, Honduras
>   My 'geonames' package (on CRAN) can do lookups via the geonames.org
> web service:
>
>> GNcountryCode(lat=14.24,lng=-89.92)
> $distance
> [1] 0
>
> $countryName
> [1] "Guatemala"
>
> $countryCode
> [1] "GT"
>
>   its being very slow at the moment though. You might have speedier responses.
>
>   It can only look up one at a time, so you'll have to loop through
> your data frame with the usual R loop/apply-type patterns.
>
> Barry
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>

-- 
| Mihai Valcu
| Max Planck Institute for Ornithology
| Behavioural Ecology and Evolutionary Genetics
| Eberhard-Gwinner-Stra?e 7
| D-82319 Starnberg (Seewiesen)
| Phone: +49 (0)8157-932-343
| Fax:   +49-(0)8157-932-400
| http://orn.mpg.de/mitarbeiter/valcu.html


From r.hijmans at gmail.com  Sun Dec 12 22:37:57 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Sun, 12 Dec 2010 13:37:57 -0800
Subject: [R-sig-Geo] getting rasters to match
In-Reply-To: <AANLkTimh_NmPmxa+nZZnL2P6Wxy7bhaZK4RgKmFvMoVX@mail.gmail.com>
References: <AANLkTimh_NmPmxa+nZZnL2P6Wxy7bhaZK4RgKmFvMoVX@mail.gmail.com>
Message-ID: <AANLkTimrxEUfHPKkfK7NNmZKZhDq_rhUiWZdf6i23w-j@mail.gmail.com>

Advait,

When I do what you did with some example data, a clear error warning
message results, saying that your crs is not valid.

> library(raster)
Loading required package: sp
raster version 1.7-12 (9-December-2010)
> futurehdr <- raster(ncol=10, nrow=10)
> futurehdr[] <- 1
> fhdrcrs <- "+proj=lcc +datum=NAD83 +ellps=GRS80 +units=m, xmn=-2736000, xmx=2334000, ymn=-1608000, ymx=1952000"
> projection(futurehdr) <- fhdrcrs
> x <- writeRaster(futurehdr,"mask.regcm.2040-49.climatol.annsum.HDR.future.tif", overwrite=TRUE)
Geospatial Data Abstraction Library extensions to R successfully loaded
Loaded GDAL runtime: GDAL 1.7.2, released 2010/04/23
Path to GDAL shared files: C:/soft/R/R-2.12.0/library/rgdal/gdal
Loaded PROJ.4 runtime: Rel. 4.7.1, 23 September 2009
Path to PROJ.4 shared files: C:/soft/R/R-2.12.0/library/rgdal/proj
Warning message:
In .newCRS(value) :
  +proj=lcc +datum=NAD83 +ellps=GRS80 +units=m, xmn=-2736000,
xmx=2334000, ymn=-1608000, ymx=1952000 is not a valid proj4 CRS string
>


This can be easily fixed:


> crs <- "+proj=lcc +datum=NAD83 +ellps=GRS80 +units=m"
> projection(futurehdr) <- crs
> x <- writeRaster(futurehdr,"mask.regcm.2040-49.climatol.annsum.HDR.future.tif", overwrite=TRUE)
> x
class       : RasterLayer
filename    : C:/Documents and Settings/rhijmans/My
Documents/mask.regcm.2040-49.climatol.annsum.HDR.future.tif
dimensions  : 10, 10 (nrow, ncol)
ncell       : 100
min value   : 1
max value   : 1
projection  : +proj=lcc +lat_1=33 +lat_2=45 +lat_0=0 +lon_0=0 +x_0=0
+y_0=0 +ellps=GRS80 +datum=NAD83 +units=m +no_defs +towgs84=0,0,0
extent      : -180, 180, -90, 90  (xmin, xmax, ymin, ymax)
resolution  : 36, 18  (x, y)


Do note that

projection(x) <-

_sets_ (defines) the crs (projection) of an object. It does _not_
change it from one projection to another. You need to use
projectRaster for that.


so perhaps you want something like:

r <- raster(vulcan.10k.dp.build.387.RES.ann1.vulcproj.img)
# if necessary
# projection(r) <- crs
res <- projectRaster(futurehdr, r)

Robert



On Sat, Dec 11, 2010 at 9:44 PM, Advait Godbole <advaitgodbole at gmail.com> wrote:
> Dear List,
>
> I have a raster layer:
> http://dl.dropbox.com/u/4030944/vulcan.10k.dp.build.387.RES.ann1.vulcproj.img
> which
> is 356 x 507, and I want the projection and extents of this netcdf file:
> http://dl.dropbox.com/u/4030944/mask.regcm.2040-49.climatol.annsum.HDR.future.ncto
> match that.
>
> I tried doing the following:
>
> futurehdr <- raster("mask.regcm.2040-49.climatol.annsum.HDR.future.nc")
> fhdrcrs <- "+proj=lcc +datum=NAD83 +ellps=GRS80 +units=m, xmn=-2736000,
> xmx=2334000, ymn=-1608000, ymx=1952000"
> projection(futurehdr) <- fhdrcrs
> writeRaster(futurehdr,"mask.regcm.2040-49.climatol.annsum.HDR.future.tif")
>
> but it does not seem to have worked.
>
>> vulcemitres <- raster("vulcan.10k.dp.build.387.RES.ann1.vulcproj.img")
>> rcmtest <- raster("mask.regcm.2040-49.climatol.annsum.HDR.future.tif")
>> vulcemitres
> class ? ? ? : RasterLayer
> filename ? ?:
> C:/Work/13Mar.research.bkup/MS_Thesis/work.data.analysis/time.series.analysis/vulcan.10k.dp.build.387.RES.ann1.vulcproj.img
> nrow ? ? ? ?: 356
> ncol ? ? ? ?: 507
> ncell ? ? ? : 180492
> min value ? : 0
> max value ? : 1207978
> projection ?: +proj=lcc +lat_1=33 +lat_2=45 +lat_0=40 +lon_0=-97 +x_0=0
> +y_0=0 +ellps=GRS80 +datum=NAD83 +units=m +no_defs +towgs84=0,0,0
> extent ? ? ?: -2735999, 2334001, -1608001, 1951999 ?(xmin, xmax, ymin, ymax)
> resolution ?: 10000, 10000 ?(x, y)
>
>> rcmtest
> class ? ? ? : RasterLayer
> filename ? ?:
> C:/Work/13Mar.research.bkup/MS_Thesis/work.data.analysis/time.series.analysis/mask.regcm.2040-49.climatol.annsum.HDR.future.tif
> nrow ? ? ? ?: 356
> ncol ? ? ? ?: 507
> ncell ? ? ? : 180492
> min value ? : ?
> max value ? : ?
> projection ?: NA
> extent ? ? ?: -137.3312, -62.11259, 22.12693, 57.35954 ?(xmin, xmax, ymin,
> ymax)
> resolution ?: 0.1483602, 0.09896801 ?(x, y)
>
> How can this be accomplished?
>
> Thanks,
>
> --
> advait godbole
>
> ? ? ? ?[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From pierre.roudier at gmail.com  Mon Dec 13 02:23:15 2010
From: pierre.roudier at gmail.com (Pierre Roudier)
Date: Mon, 13 Dec 2010 14:23:15 +1300
Subject: [R-sig-Geo] Fail to load a vector layer using spgrass6
Message-ID: <AANLkTiksyumt7bKWXJ5QQbLn+YMgY7Q97HPv1YNAJpvB@mail.gmail.com>

Dear list,

I'm using R from GRASS using the great spgrass6 connector. For some
reason, I can't manage to load a GRASS vector layer into my R session.
I'm just beginning with GRASS, and I really have no clue here...
I hope this is a good place to ask (being on the borderline I hesitaed
to ask the question to the GRASS-user mailing list).

First here's the rror message in the R session:
> ph <- readVECT6('ph_cl', type='area')
Error in ogrInfo(dsn = dsn, layer = layer, input_field_name_encoding =
input_field_name_encoding) :
  Cannot open layer

I tried to play with the different options but I did not succeed>
Here's more info about my data and platform:

Here is the output of v.info for the data I want to load:
GRASS 7.0.svn (NZTM2000):~ > v.info ph_cl
 +----------------------------------------------------------------------------+
 | Name:            ph_cl                                                     |
 | Mapset:          nitrif_inhib                                              |
 | Location:        NZTM2000                                                  |
 | Database:        /home/roudierp/Documents/GRASSDATA                        |
 | Title:                                                                     |
 | Map scale:       1:1                                                       |
 | Map format:      native                                                    |
 | Name of creator: roudierp                                                  |
 | Organization:                                                              |
 | Source date:     Mon Dec 13 11:30:11 2010                                  |
 |----------------------------------------------------------------------------|
 |   Type of map: vector (level: 2)                                           |
 |                                                                            |
 |   Number of points:       0               Number of centroids:  236847     |
 |   Number of lines:        0               Number of boundaries: 892041     |
 |   Number of areas:        355021          Number of islands:    79124      |
 |                                                                            |
 |   Map is 3D:              No                                               |
 |   Number of dblinks:      1                                                |
 |                                                                            |
 |   Projection: Transverse Mercator                                          |
 |                                                                            |
 |               N:  6190887.80270169    S:  4823266.04395524                 |
 |               E:  2091804.65744429    W:   1170289.3071784                 |
 |                                                                            |
 |   Digitization threshold: 0                                                |
 |   Comment:                                                                 |
 |                                                                            |
 +----------------------------------------------------------------------------+

And finally some metadata about the software packages I used:

here's the sessionInfo():

> sessionInfo()
R version 2.12.0 (2010-10-15)
Platform: x86_64-unknown-linux-gnu (64-bit)

locale:
 [1] LC_CTYPE=en_GB.UTF-8       LC_NUMERIC=C
 [3] LC_TIME=en_GB.UTF-8        LC_COLLATE=en_GB.UTF-8
 [5] LC_MONETARY=C              LC_MESSAGES=en_GB.UTF-8
 [7] LC_PAPER=en_GB.UTF-8       LC_NAME=C
 [9] LC_ADDRESS=C               LC_TELEPHONE=C
[11] LC_MEASUREMENT=en_GB.UTF-8 LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] spgrass6_0.6-21 XML_3.2-0       rgdal_0.6-31    sp_0.9-74

loaded via a namespace (and not attached):
[1] grid_2.12.0     lattice_0.19-13

> library(spgrass6)
Loading required package: sp
Loading required package: rgdal
Geospatial Data Abstraction Library extensions to R successfully loaded
Loaded GDAL runtime: GDAL 1.7.1, released 2010/02/08
Path to GDAL shared files: /usr/share/gdal
Loaded PROJ.4 runtime: Rel. 4.7.1, 23 September 2009
Path to PROJ.4 shared files: /usr/share/proj/
Loading required package: XML
GRASS GIS interface loaded with GRASS version: 7.0.svn
and location: NZTM2000

I got the last CRAN version of sp.

This runs on a linux machine:
GRASS 7.0.svn (NZTM2000):~ > uname -a
Linux A208_RoudierP 2.6.34.7-0.5-xen #1 SMP 2010-10-25 08:40:12 +0200
x86_64 x86_64 x86_64 GNU/Linux


Cheers,

Pierre


From Roger.Bivand at nhh.no  Mon Dec 13 08:06:25 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 13 Dec 2010 08:06:25 +0100 (CET)
Subject: [R-sig-Geo] Fail to load a vector layer using spgrass6
In-Reply-To: <AANLkTiksyumt7bKWXJ5QQbLn+YMgY7Q97HPv1YNAJpvB@mail.gmail.com>
References: <AANLkTiksyumt7bKWXJ5QQbLn+YMgY7Q97HPv1YNAJpvB@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.1012130800030.24826@reclus.nhh.no>

On Mon, 13 Dec 2010, Pierre Roudier wrote:

> Dear list,
>
> I'm using R from GRASS using the great spgrass6 connector. For some
> reason, I can't manage to load a GRASS vector layer into my R session.
> I'm just beginning with GRASS, and I really have no clue here...
> I hope this is a good place to ask (being on the borderline I hesitaed
> to ask the question to the GRASS-user mailing list).
>
> First here's the rror message in the R session:
>> ph <- readVECT6('ph_cl', type='area')
> Error in ogrInfo(dsn = dsn, layer = layer, input_field_name_encoding =
> input_field_name_encoding) :
>  Cannot open layer

Because there are two routes used depending on the setting of the plugin= 
argument, could you look at ogrDrivers() and see if you have an OGR GRASS 
vector driver, and if so, try to set plugin= manually to TRUE and FALSE?

Note that GRASS 7.0svn is the development version, snd is very much a 
moving target - do you have to use this version? And GDAL 1.7.1 is not the 
current version, which is 1.7.3. Did you install GDAL and/or GRASS from 
source, or from binaries (in my experience, installing from source ensures 
more consistency, and the GDAL/OGR GRASS plugins are often the source of 
problems because of version mismatch).

Roger

PS. The best list is probably:

http://grass.osgeo.org/statsgrass/index.php

as it is more specific, and also seen by GRASS developers.

>
> I tried to play with the different options but I did not succeed>
> Here's more info about my data and platform:
>
> Here is the output of v.info for the data I want to load:
> GRASS 7.0.svn (NZTM2000):~ > v.info ph_cl
> +----------------------------------------------------------------------------+
> | Name:            ph_cl                                                     |
> | Mapset:          nitrif_inhib                                              |
> | Location:        NZTM2000                                                  |
> | Database:        /home/roudierp/Documents/GRASSDATA                        |
> | Title:                                                                     |
> | Map scale:       1:1                                                       |
> | Map format:      native                                                    |
> | Name of creator: roudierp                                                  |
> | Organization:                                                              |
> | Source date:     Mon Dec 13 11:30:11 2010                                  |
> |----------------------------------------------------------------------------|
> |   Type of map: vector (level: 2)                                           |
> |                                                                            |
> |   Number of points:       0               Number of centroids:  236847     |
> |   Number of lines:        0               Number of boundaries: 892041     |
> |   Number of areas:        355021          Number of islands:    79124      |
> |                                                                            |
> |   Map is 3D:              No                                               |
> |   Number of dblinks:      1                                                |
> |                                                                            |
> |   Projection: Transverse Mercator                                          |
> |                                                                            |
> |               N:  6190887.80270169    S:  4823266.04395524                 |
> |               E:  2091804.65744429    W:   1170289.3071784                 |
> |                                                                            |
> |   Digitization threshold: 0                                                |
> |   Comment:                                                                 |
> |                                                                            |
> +----------------------------------------------------------------------------+
>
> And finally some metadata about the software packages I used:
>
> here's the sessionInfo():
>
>> sessionInfo()
> R version 2.12.0 (2010-10-15)
> Platform: x86_64-unknown-linux-gnu (64-bit)
>
> locale:
> [1] LC_CTYPE=en_GB.UTF-8       LC_NUMERIC=C
> [3] LC_TIME=en_GB.UTF-8        LC_COLLATE=en_GB.UTF-8
> [5] LC_MONETARY=C              LC_MESSAGES=en_GB.UTF-8
> [7] LC_PAPER=en_GB.UTF-8       LC_NAME=C
> [9] LC_ADDRESS=C               LC_TELEPHONE=C
> [11] LC_MEASUREMENT=en_GB.UTF-8 LC_IDENTIFICATION=C
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> other attached packages:
> [1] spgrass6_0.6-21 XML_3.2-0       rgdal_0.6-31    sp_0.9-74
>
> loaded via a namespace (and not attached):
> [1] grid_2.12.0     lattice_0.19-13
>
>> library(spgrass6)
> Loading required package: sp
> Loading required package: rgdal
> Geospatial Data Abstraction Library extensions to R successfully loaded
> Loaded GDAL runtime: GDAL 1.7.1, released 2010/02/08
> Path to GDAL shared files: /usr/share/gdal
> Loaded PROJ.4 runtime: Rel. 4.7.1, 23 September 2009
> Path to PROJ.4 shared files: /usr/share/proj/
> Loading required package: XML
> GRASS GIS interface loaded with GRASS version: 7.0.svn
> and location: NZTM2000
>
> I got the last CRAN version of sp.
>
> This runs on a linux machine:
> GRASS 7.0.svn (NZTM2000):~ > uname -a
> Linux A208_RoudierP 2.6.34.7-0.5-xen #1 SMP 2010-10-25 08:40:12 +0200
> x86_64 x86_64 x86_64 GNU/Linux
>
>
> Cheers,
>
> Pierre
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From Tim.Haering at lwf.bayern.de  Mon Dec 13 10:49:45 2010
From: Tim.Haering at lwf.bayern.de (Tim.Haering at lwf.bayern.de)
Date: Mon, 13 Dec 2010 10:49:45 +0100
Subject: [R-sig-Geo] SGDF with NA values - SGDF2PCT()
Message-ID: <70FC67C4A585D1489E66225A4E0238BAC4DF6A@RZS-EXC-CL06.rz-sued.bayern.de>

Hello,

I want to convert my three-band SGDF into a single color vector using the SGDF2PCT() function in rgdal. Unfortunately my SGDF contains NA values. To plot it with image() this is no problem, because NAs were fully transparent, but if I want to convert my three bands with SGDF2PCT() I get an error message.
I guess there is an easy way to handle NA values in SpatialGridDataFrame. Can someone please help me?

Here an example:
> logo <- system.file("pictures/Rlogo.jpg", package="rgdal")[1]
> SGlogo <- readGDAL(logo)
> cols <- SGDF2PCT(SGlogo) ### works fine

### now introduce some NA values
> band3 <- SGlogo$band3
> band3[band3==0] <- NA
> SGlogo$band3 <- band3
> summary(SGlogo)
> cols <- SGDF2PCT(SGlogo)
Error in if (bmax == bmin) bmax <- bmin + ncolors : 
  missing value where TRUE/FALSE needed

Thank you.
TIM

----------------------------------------------------------------------------------- 
Tim H?ring
Bavarian State Institute of Forest Research 
Department of Forest Ecology
Hans-Carl-von-Carlowitz-Platz 1
D-85354 Freising


From mdsumner at gmail.com  Mon Dec 13 11:45:54 2010
From: mdsumner at gmail.com (Michael Sumner)
Date: Mon, 13 Dec 2010 21:45:54 +1100
Subject: [R-sig-Geo] SGDF with NA values - SGDF2PCT()
In-Reply-To: <70FC67C4A585D1489E66225A4E0238BAC4DF6A@RZS-EXC-CL06.rz-sued.bayern.de>
References: <70FC67C4A585D1489E66225A4E0238BAC4DF6A@RZS-EXC-CL06.rz-sued.bayern.de>
Message-ID: <AANLkTiktBZukBqX-ZfLu2_EjCOkjennfU_taTN2804Sc@mail.gmail.com>

There seems to be at least one bug in SGDF2PCT, in that min/max on
band should check for NAs, but also when have_NAs is true, the default
ncolors is increased by 1 (to 257) which causes RGB2PCT to error -
I've not explored enough to see why yet.

Roger?  If I modify this in SGDF2PCT to use na.rm = TRUE, I can then
avoid the error with ncolors = 255:

      if (adjust.bands) {
            bmax <- max(band, na.rm = TRUE)
            bmin <- min(band, na.rm = TRUE)

Otherwise, a workaround like this might help Tim for now.

library(rgdal)

logo <- system.file("pictures/Rlogo.jpg", package="rgdal")[1]
SGlogo <- readGDAL(logo)
cols <- SGDF2PCT(SGlogo) ### works fine

### now introduce some NA values
##band3 <- SGlogo$band3
SGlogo$band3[SGlogo$band3==0] <- NA
##SGlogo$band3 <- band3

## see which are NA
image(SGlogo, "band3")

## detect NAs
NAs <- is.na(SGlogo$band3)  ## may need to combine this with NAs in other bands

## set the missing values to something valid
SGlogo$band3[NAs] <- 0

## which indices match those that were NA
widx <- unique(cols$idx[NAs])

## recreate those colours as fully transparent, of any old colour
if(length(widx) > 0) cols$ct[widx] <- rgb(0, 0, 0, 0)

SGlogo$idx <- cols$idx

image(SGlogo, "idx", col = cols$ct)


## recreate those colours as partially transparent, with red
if(length(widx) > 0) cols$ct[widx] <- rgb(1, 0, 0, 0.5)

image(SGlogo, "idx", col = cols$ct)

Cheers, Mike.

On Mon, Dec 13, 2010 at 8:49 PM,  <Tim.Haering at lwf.bayern.de> wrote:
> Hello,
>
> I want to convert my three-band SGDF into a single color vector using the SGDF2PCT() function in rgdal. Unfortunately my SGDF contains NA values. To plot it with image() this is no problem, because NAs were fully transparent, but if I want to convert my three bands with SGDF2PCT() I get an error message.
> I guess there is an easy way to handle NA values in SpatialGridDataFrame. Can someone please help me?
>
> Here an example:
>> logo <- system.file("pictures/Rlogo.jpg", package="rgdal")[1]
>> SGlogo <- readGDAL(logo)
>> cols <- SGDF2PCT(SGlogo) ### works fine
>
> ### now introduce some NA values
>> band3 <- SGlogo$band3
>> band3[band3==0] <- NA
>> SGlogo$band3 <- band3
>> summary(SGlogo)
>> cols <- SGDF2PCT(SGlogo)
> Error in if (bmax == bmin) bmax <- bmin + ncolors :
> ?missing value where TRUE/FALSE needed
>
> Thank you.
> TIM
>
> -----------------------------------------------------------------------------------
> Tim H?ring
> Bavarian State Institute of Forest Research
> Department of Forest Ecology
> Hans-Carl-von-Carlowitz-Platz 1
> D-85354 Freising
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



-- 
Michael Sumner
Institute for Marine and Antarctic Studies, University of Tasmania
Hobart, Australia
e-mail: mdsumner at gmail.com


From eric.boeker at gmail.com  Mon Dec 13 11:46:03 2010
From: eric.boeker at gmail.com (Eric Boeker)
Date: Mon, 13 Dec 2010 11:46:03 +0100
Subject: [R-sig-Geo] Difficulties handling objects of class "psp"
Message-ID: <AANLkTinHUDGH5dRTafOQv5MJX0orzDe1EGaPjcDOJGgz@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101213/f8cc8eae/attachment.pl>

From mdsumner at gmail.com  Mon Dec 13 11:54:06 2010
From: mdsumner at gmail.com (Michael Sumner)
Date: Mon, 13 Dec 2010 21:54:06 +1100
Subject: [R-sig-Geo] Difficulties handling objects of class "psp"
In-Reply-To: <AANLkTinHUDGH5dRTafOQv5MJX0orzDe1EGaPjcDOJGgz@mail.gmail.com>
References: <AANLkTinHUDGH5dRTafOQv5MJX0orzDe1EGaPjcDOJGgz@mail.gmail.com>
Message-ID: <AANLkTimQDSDOP2_qxe7T63LC8qaDxf=+us6oAc__dNw8@mail.gmail.com>

I think you simply neglect to replace the original object with the
converted one.

This does not modify "x", it converts and then prints out that result:

as.psp(x)

We need to assign it to a new (or a replacement) object so we can use
it further:

x <- as.psp(x)

Here's a concrete example with the maptools and spatstat packages:


x <- readShapeSpatial(system.file("shapes/fylk-val.shp",
       package="maptools")[1], proj4string=CRS("+proj=utm +zone=33
+datum=WGS84"))
 class(x)
##[1] "SpatialLinesDataFrame"

library(spatstat)
x <- as.psp(x) ###store the fractures as a single object of class psp
##Warning message:
##In as.psp.SpatialLinesDataFrame(x) : 9 columns of data frame discarded
head(lengths.psp(x))
##[1] 1429.48681   33.56846 7282.03901   54.00531 4272.47990 6721.92176

(The warning about discarded attributes is expected).

Cheers, Mike.



On Mon, Dec 13, 2010 at 9:46 PM, Eric Boeker <eric.boeker at gmail.com> wrote:
> Dear list members,
>
>
>
> I want to use some spatstat facilities for handling my geological faults
> shapefile data.
>
>
> First step I read my data into spatstat
>
> (Thanks for the vignette of Adrian Baddeley ?Handling shapefiles in the
> spatsat?
> http://cran.r-project.org/web/packages/spatstat/vignettes/shapefiles.pdf ).
>
>
> Then I convert them either into a single object of class ?psp? or into a
> list of object of class ?psp?.
>
> But after those transformations, I still cannot use the facilities of
> spatstat for handling my fracture line segment list of class ?psp?.
>
> For example by using angles.psp or crossing.psp facilities I keep receiving
> the error message = Error in verifyclass(x, "psp") : argument 'x' is not of
> class 'psp'. What am I doing wrong!!!
>
> I'd welcome any hints on this question. Does anyone have experience with
> this or possibly an idea on how I might solve the issue?
> Below some commands and results used so far.
>
>
> ?Sincerely
>
>
>
> x<-readShapeSpatial("fractureshp.shp")
>
>> class(x)
>
> [1] "SpatialLinesDataFrame"
>
> attr(,"package")
>
> [1] "sp"
>
>> as.psp(x) ###store the fractures as a single object of class psp
>
> planar line segment pattern: 6 line segments
>
> window: rectangle = [234027.52, 235479.43] x [1700993, 1702270.7] units
>
> Marks vector of type 'integer'
>
> plot(x) # #### plot of the fractures =>>ok
>
> lengths.psp(x) ##### ? Error in verifyclass(x, "psp") : argument 'x' is not
> of class 'psp'
>
>
>
> #######To convert the SpatialLinesDataFrame to psp:
>
> ydata<-slot(x,"data")
>
> yl<-as(x,"SpatialLines")
>
> ycurves<-slot(yl,"lines")
>
> ycurves<-lapply(ycurves,function(x){SpatialLines(list(x))} )
>
> ypatterns<-lapply(ycurves,as.psp)
>
>> class(ypatterns)
>
> [1] "list"
>
>> summary(ypatterns)
>
> ? ? Length Class Mode
>
> [1,] 4 ? ? ?psp ? list
>
> [2,] 4 ? ? ?psp ? list
>
> [3,] 4 ? ? ?psp ? list
>
> [4,] 4 ? ? ?psp ? list
>
> [5,] 4 ? ? ?psp ? list
>
> [6,] 4 ? ? ?psp ? list
>
> lengths.psp(ypatterns) ##### ? Error in verifyclass(x, "psp") : argument 'x'
> is not of class 'psp'
>
> --
> Mit freundlichen Gr??en / Kind regards / Meilleures Salutations
>
>
> Eric B?ker
>
> Hydrog?ologue
> Chef Projet PMRE
> Hippodrome
> Rue 326, Porte 21
> BP 701 BAMAKO (MALI)
> Cell: (00223) 766 87 477
> e-mail: eric.boeker at gmail.com
>
> ? ? ? ?[[alternative HTML version deleted]]
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>



-- 
Michael Sumner
Institute for Marine and Antarctic Studies, University of Tasmania
Hobart, Australia
e-mail: mdsumner at gmail.com


From christian.kamenik at giub.unibe.ch  Mon Dec 13 12:30:08 2010
From: christian.kamenik at giub.unibe.ch (Christian Kamenik)
Date: Mon, 13 Dec 2010 12:30:08 +0100
Subject: [R-sig-Geo] Spatial mean
Message-ID: <4D0603C0.3010505@giub.unibe.ch>

Dear all,

I would like to calculate the spatial mean and its standard error 
(taking into account spatial autocorrelation) from a subset of data 
stored in a RasterBrick (multi-layer raster) object (Package: raster). I 
was browsing the web for quite a while. The only available R functions I 
could find were in Package 'spcosa'. But these functions provide way 
more functionality than I need, since they do spatial re-sampling, which 
is not necessary in my case.

Does anybody know of any functions I could use?

Many thanks in advance, Christian

-- 
-----------------------------------------------
Oeschger Centre for Climate Change Research, Institute of Geography&  Institute of Plant Sciences
University of Bern

http://www.stomatocysts.unibe.ch/kamenik
mailto: christian.kamenik at giub.unibe.ch

Postal address:
Dr. Christian Kamenik
Institute of Geography
Erlachstrasse 9a, Trakt 3
3012 Bern, Switzerland

Tel. +41 (0)31 631 5091
Fax +41 (0)31 631 43 38


From rue.stmalo at cegetel.net  Mon Dec 13 13:14:43 2010
From: rue.stmalo at cegetel.net (rue.stmalo at cegetel.net)
Date: Mon, 13 Dec 2010 13:14:43 +0100 (CET)
Subject: [R-sig-Geo] Weight in krigeage
Message-ID: <12329636.129911292242483808.JavaMail.www@wsfrf1136>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101213/6869aeea/attachment.pl>

From alobolistas at gmail.com  Mon Dec 13 13:45:48 2010
From: alobolistas at gmail.com (Agustin Lobo)
Date: Mon, 13 Dec 2010 13:45:48 +0100
Subject: [R-sig-Geo] Fwd:  Suggestion: option overwrite=T for writeOGR()
In-Reply-To: <AANLkTinhg4-U5PRXreJNuY=6v7dHP9dga223-Whr8Smq@mail.gmail.com>
References: <AANLkTi=D5_u6K67jCtwSafxOpNZ34rJHfSCnGQSSLpOs@mail.gmail.com>
	<AANLkTi=YfZOgvP_75+skqZvTxmZ_bVMZfXN7SMfCsQRb@mail.gmail.com>
	<alpine.LRH.2.00.1012101320330.6560@reclus.nhh.no>
	<AANLkTinMcoacpjRgSEair0ph+tYqTWk8jFFiBgFxgMT5@mail.gmail.com>
	<alpine.LRH.2.00.1012101516480.9170@reclus.nhh.no>
	<AANLkTinbhGxeRbCK1DJvE8yQQTSozBTUY-C=WFjpmfry@mail.gmail.com>
	<alpine.LRH.2.00.1012101831190.9628@reclus.nhh.no>
	<AANLkTikLWczW0AWneragJz2NFyM_fgtqifa6Hk++1hAE@mail.gmail.com>
	<alpine.LRH.2.00.1012111828090.13472@reclus.nhh.no>
	<AANLkTinhg4-U5PRXreJNuY=6v7dHP9dga223-Whr8Smq@mail.gmail.com>
Message-ID: <AANLkTinTRV86eyU_oM=eW6wF_iaYB2o9Sh8t3dRH1QFv@mail.gmail.com>

---------- Forwarded message ----------
From: Agustin Lobo <alobolistas at gmail.com>
Date: 2010/12/13
Subject: Re: [R-sig-Geo] Suggestion: option overwrite=T for writeOGR()
To: Roger.Bivand at nhh.no


Roger,

According to Synaptic, my gdal is 1.7.3,
I do not understand where the reported
GDAL runtime: GDAL 1.8dev
comes from. Could it have been installed by rgdal?

I've searched my disk and find gdal16 and gdal17 but not gdal18
Do you know if it is possible to tell rgdal which gdal should be used?

Thanks

Agus



2010/12/11 Roger Bivand <Roger.Bivand at nhh.no>:
> On Fri, 10 Dec 2010, Agustin Lobo wrote:
>
>> Roger,
>>
>> I was not aware that 1.8dev is actually older than 1.7.2 I'll check why I
>> have that gdal on the other machine and will try to fix that on my side on
>> Monday. But perhaps this problem will come up again for future stable
>> versions of 1.8.* ? Anyway, 1.8dev is clearly not a good choice and I have
>> to change it.
>
> As of GDAL 1.8.0 SVN revision 21234, the problem exists. I'll fix this in
> rgdal for the drivers I am familiar with before 1.8.0 is released.
>
> Roger
>
>>
>> Thanks
>>
>> Agus
>>
>> 2010/12/10 Roger Bivand <Roger.Bivand at nhh.no>:
>>>
>>> On Fri, 10 Dec 2010, Agustin Lobo wrote:
>>>
>>>> Roger,
>>>>
>>>> is this all you need? I thought sessionInfo was providing everything
>>>> needed.
>>>
>>> You had given sessionInfo() but that does not report which GDAL you are
>>> using. The report unfortunately does not give an svn revision, maybe
>>> gdal-config --version does? I develop using 1.7.* GDAL. Your 1.8dev is
>>> pretty old, certainly older that released 1.7.3. I can try to build a
>>> current GDAL trunk from source next week, if I get time, but this looks
>>> like
>>> something in your setup (development GDAL that is now stale?).
>>>
>>>> The driver is "ESRI Shapefile" as stated in the command, have not tested
>>>> any other (it does work for raster though, as you mention):
>>>
>>> I mentioned four variants of vector drivers, not raster.
>>>
>>> Roger
>>>
>>>>
>>>>> require(rgdal)
>>>>
>>>> Loading required package: rgdal
>>>> Geospatial Data Abstraction Library extensions to R successfully loaded
>>>> Loaded GDAL runtime: GDAL 1.8dev, released 2010/01/19
>>>> Path to GDAL shared files: /usr/local/share/gdal
>>>> Loaded PROJ.4 runtime: Rel. 4.7.1, 23 September 2009
>>>> Path to PROJ.4 shared files: (autodetected)
>>>>
>>>> Thanks
>>>>
>>>> Agus
>>>>
>>>> 2010/12/10 Roger Bivand <Roger.Bivand at nhh.no>:
>>>>>
>>>>> On Fri, 10 Dec 2010, Agustin Lobo wrote:
>>>>>
>>>>>> Roger,
>>>>>>
>>>>>> It does not for me. The error is solved by deleting files xygcatLO.* ,
>>>>>> while directory xygcatLO may continue to exist.
>>>>>
>>>>> Agus,
>>>>>
>>>>> With which drivers, OGR version (in header when rgdal loads)? If I
>>>>> cannot
>>>>> reproduce this, I cannot readily help.
>>>>>
>>>>> Roger
>>>>>
>>>>>>
>>>>>> Also, I've found that with this version the below command does not
>>>>>> save the files within
>>>>>> the folder indicated by dsn, but outside. This was not the case in the
>>>>>> past, but do not know if this is
>>>>>> because of a change in rgdal, gdal or ubuntu 10.04 (I've changed all 3
>>>>>> since the last time I used writeOGR()).
>>>>>>
>>>>>>> writeOGR(xygcatLO,dsn="xygcatLO",layer="xygcatLO", driver="ESRI
>>>>>>> Shapefile")
>>>>>>
>>>>>> Error in writeOGR(xygcatLO, dsn = "xygcatLO", layer = "xygcatLO",
>>>>>> driver = "ESRI Shapefile") :
>>>>>>
>>>>>> ? ? ? ?GDAL Error 1: Layer 'xygcatLO' already exists
>>>>>> Calls: writeOGR -> .Call
>>>>>>
>>>>>>> sessionInfo()
>>>>>>
>>>>>> R version 2.12.0 (2010-10-15)
>>>>>> Platform: x86_64-pc-linux-gnu (64-bit)
>>>>>>
>>>>>> locale:
>>>>>> [1] LC_CTYPE=en_US.utf8 ? ? ? ? ?LC_NUMERIC=C
>>>>>> [3] LC_TIME=en_US.utf8 ? ? ? ? ? LC_COLLATE=en_US.utf8
>>>>>> [5] LC_MONETARY=en_US.utf8 ? ? ? LC_MESSAGES=en_US.utf8
>>>>>> [7] LC_PAPER=en_US.utf8 ? ? ? ? ?LC_NAME=en_US.utf8
>>>>>> [9] LC_ADDRESS=en_US.utf8 ? ? ? ?LC_TELEPHONE=en_US.utf8
>>>>>> [11] LC_MEASUREMENT=en_US.utf8 ? ?LC_IDENTIFICATION=en_US.utf8
>>>>>>
>>>>>> attached base packages:
>>>>>> [1] stats ? ? graphics ?grDevices utils ? ? datasets ?methods ? base
>>>>>>
>>>>>> other attached packages:
>>>>>> [1] RANN_2.1.2 ? ? ?outliers_0.13-3 rgdal_0.6-30 ? ?raster_1.7-2
>>>>>> [5] sp_0.9-73 ? ? ? rkward_0.5.4
>>>>>>
>>>>>> loaded via a namespace (and not attached):
>>>>>> [1] grid_2.12.0 ? ? lattice_0.19-13 tools_2.12.0
>>>>>> 2010/12/10 Roger Bivand <Roger.Bivand at nhh.no>:
>>>>>>>
>>>>>>> On Thu, 9 Dec 2010, Barry Rowlingson wrote:
>>>>>>>
>>>>>>>> On Thu, Dec 9, 2010 at 8:56 AM, Agustin Lobo <alobolistas at gmail.com>
>>>>>>>> wrote:
>>>>>>>>>
>>>>>>>>> Hi!
>>>>>>>>>
>>>>>>>>> Could an option overwrite=T (default overwrite=F) be included in
>>>>>>>>> writeOGR()?
>>>>>>>>> Thanks!
>>>>>>>>
>>>>>>>> Submit a Feature Request here:
>>>>>>>>
>>>>>>>> http://sourceforge.net/tracker/?group_id=84716&atid=573625
>>>>>>>
>>>>>>> No, rgdal is on R-Forge, and a list called rgdal-devel will be
>>>>>>> available
>>>>>>> from tomorrow.
>>>>>>>
>>>>>>>>
>>>>>>>> It looks like it just needs to be a wrapper around OGR's delete
>>>>>>>> layer
>>>>>>>> function.
>>>>>>>
>>>>>>> Contributions welcome. Note that the facility is present for rasters,
>>>>>>> which
>>>>>>> I fould out by accidentally deleting GRASS database objects (for
>>>>>>> which
>>>>>>> of
>>>>>>> course I did not have backups). Is this really needed - which drivers
>>>>>>> do
>>>>>>> not
>>>>>>> already overwrite without complaint? These do not complain for me:
>>>>>>> driver="ESRI Shapefile"; driver="KML"; driver="MapInfo File";
>>>>>>> driver="MapInfo File", dataset_options="FORMAT=MIF".
>>>>>>>
>>>>>>> Hope this helps,
>>>>>>>
>>>>>>> Roger
>>>>>>>
>>>>>>>>
>>>>>>>> Barry
>>>>>>>>
>>>>>>>> _______________________________________________
>>>>>>>> R-sig-Geo mailing list
>>>>>>>> R-sig-Geo at r-project.org
>>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>>>>
>>>>>>>
>>>>>>> --
>>>>>>> Roger Bivand
>>>>>>> Economic Geography Section, Department of Economics, Norwegian School
>>>>>>> of
>>>>>>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>>>>>>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>>>>>>> e-mail: Roger.Bivand at nhh.no
>>>>>>>
>>>>>>> _______________________________________________
>>>>>>> R-sig-Geo mailing list
>>>>>>> R-sig-Geo at r-project.org
>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>>>
>>>>>>
>>>>>
>>>>> --
>>>>> Roger Bivand
>>>>> Economic Geography Section, Department of Economics, Norwegian School
>>>>> of
>>>>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>>>>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>>>>> e-mail: Roger.Bivand at nhh.no
>>>>>
>>>>> _______________________________________________
>>>>> R-sig-Geo mailing list
>>>>> R-sig-Geo at r-project.org
>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>
>>>>
>>>
>>> --
>>> Roger Bivand
>>> Economic Geography Section, Department of Economics, Norwegian School of
>>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>>> e-mail: Roger.Bivand at nhh.no
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>>
>>
>
> --
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>


From southandy at gmail.com  Mon Dec 13 13:50:31 2010
From: southandy at gmail.com (andy south)
Date: Mon, 13 Dec 2010 12:50:31 +0000
Subject: [R-sig-Geo] Strategies for modifying country-specific grids
 from a global gridded dataset in simple matrix form?
Message-ID: <AANLkTi=59C-nDHQ+8OBLXfoSBrc9YW=3LhHfsgCMu90V@mail.gmail.com>

Hi Jooil,
The code below should help with your query about identifying the
countrys that grid cells fall in using rworldmap.
All the best,
Andy


#testing identifying the country of grid cells of any resolution (centroids)
#plus aggregating a grid of any dimension to countries

library(rworldmap)

#creating a toy 1 degree grid
gridTopology <- GridTopology(c(-180,-90), c(1,1), c(360,180))
gridVals <- data.frame(att=c(1:64800))
sGDF <- SpatialGridDataFrame(gridTopology,data=gridVals)
#test plotting the grid
mapDevice()
mapGriddedData(sGDF)

#get the country map from rworldmap
sPDF <- getMap()
str(sPDF at data)

#overlay the country map on the grid
#gives a vector for each grid cell giving the index of the country in the sPDF
#int [1:64800]
countryIndexPerGrid <- overlay(sGDF,sPDF)
#to get the UN country code per grid cell
codeUNPerGrid <- sPDF$UN[ countryIndexPerGrid ]
#add that on to the sGDF
sGDF$UN <- codeUNPerGrid

#to manipulate one countries cells in the grid
#(following query 20101207)
#UN country code for China is 156
sGDF$att[which(sGDF$UN == 156)] <- 0

#to show that grid values for China have been replaced by 0
mapDevice()
mapGriddedData(sGDF)

#note that you can also then aggregate all of the gridded data to a
country level

#aggregate cells by UN countrycode (into a column called x)
dFbyCountry <- aggregate(sGDF$att
                     , by=list(UN = sGDF$UN)
                     , FUN = 'mean'
                     , na.rm=TRUE )

#join aggregated data to the country map
sPDF2 <- joinCountryData2Map(dFbyCountry
              , joinCode = "UN"
              , nameJoinColumn = "UN")

#plots the country map and does show that countries further south get
higher values
mapDevice()
mapCountryData(sPDF2,nameColumnToPlot='x')

Message: 12
Date: Mon, 6 Dec 2010 11:53:48 +0900
From: Jooil Kim <kji2080 at gmail.com>
To: r-sig-geo at r-project.org
Subject: [R-sig-Geo] Strategies for modifying country-specific grids
       from a global gridded dataset in simple matrix form?
Message-ID:
       <AANLkTinDNeLAzbPCV8AHrwKseVeUmwN_fBynXtwk84qV at mail.gmail.com>
Content-Type: text/plain

Hello all,

I've just started working with gridded data in R, mostly in using the
"rworldmap" package.

So far I have been able to make ASCIIgrid files of global datasets that I
imported into R as simple matrices (ex. 360x180 matrix with data values
corresponding to each of the 1x1 grid), and draw them with functions
included in "rworldmap".

My problem now is in manipulating parts of these datasets, specifically with
regards to country.

For example, from the global matrix I want to subset just the grids that
belong to China and multiply a factor to those Chinese grids, or maybe make
them all 0s.

Selecting all the grids that belong to a country seems straightforward in
theory, but being the novice that I am, I can't figure out an effective way
to do this.

I've also been thinking that I should probably switch over my simple
matrices to sp dataframes, so that the spatial aspects of my dataset can be
better handled within R, but so far have been hesitant to do so because the
benefits of such a change have not been apparent.


Can I get some suggestions or help on how I should proceed?

Thanks in advance,

Jooil

--
#############################################
Jooil Kim
Graduate Student
School of Earth and Environmental Sciences,
Seoul National University
Gwanak Gu Shillim 9 Dong San 56-1
Seoul National Univ. Bld#501, Rm 503
Seoul, Rep. of Korea 151-742
kji2080 at gmail.com
tel) 82-2-877-6741
fax) 82-2-885-7164
#############################################


From Roger.Bivand at nhh.no  Mon Dec 13 14:07:22 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 13 Dec 2010 14:07:22 +0100 (CET)
Subject: [R-sig-Geo] Fwd: Suggestion: option overwrite=T for writeOGR()
In-Reply-To: <AANLkTinTRV86eyU_oM=eW6wF_iaYB2o9Sh8t3dRH1QFv@mail.gmail.com>
References: <AANLkTi=D5_u6K67jCtwSafxOpNZ34rJHfSCnGQSSLpOs@mail.gmail.com>
	<AANLkTi=YfZOgvP_75+skqZvTxmZ_bVMZfXN7SMfCsQRb@mail.gmail.com>
	<alpine.LRH.2.00.1012101320330.6560@reclus.nhh.no>
	<AANLkTinMcoacpjRgSEair0ph+tYqTWk8jFFiBgFxgMT5@mail.gmail.com>
	<alpine.LRH.2.00.1012101516480.9170@reclus.nhh.no>
	<AANLkTinbhGxeRbCK1DJvE8yQQTSozBTUY-C=WFjpmfry@mail.gmail.com>
	<alpine.LRH.2.00.1012101831190.9628@reclus.nhh.no>
	<AANLkTikLWczW0AWneragJz2NFyM_fgtqifa6Hk++1hAE@mail.gmail.com>
	<alpine.LRH.2.00.1012111828090.13472@reclus.nhh.no>
	<AANLkTinhg4-U5PRXreJNuY=6v7dHP9dga223-Whr8Smq@mail.gmail.com>
	<AANLkTinTRV86eyU_oM=eW6wF_iaYB2o9Sh8t3dRH1QFv@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.1012131356110.26497@reclus.nhh.no>

On Mon, 13 Dec 2010, Agustin Lobo wrote:

> ---------- Forwarded message ----------
> From: Agustin Lobo <alobolistas at gmail.com>
> Date: 2010/12/13
> Subject: Re: [R-sig-Geo] Suggestion: option overwrite=T for writeOGR()
> To: Roger.Bivand at nhh.no
>
>
> Roger,
>
> According to Synaptic, my gdal is 1.7.3,
> I do not understand where the reported
> GDAL runtime: GDAL 1.8dev
> comes from. Could it have been installed by rgdal?

rgdal package binaries from CRAN for Windows are built static against 
GDAL, so include GDAL but not as a shared object. For OSX on CRAN extras, 
I'm not sure whether the binary rgdal package is built static or not, but 
GDAL is included.

You are on Linux, so you provide GDAL yourself. If it declares on query 
(asking the shared object what version it is, which is what rgdal does on 
startup) that it is 1.8.0dev, then that is what it is. Be aware that 
downstream packagers may also mistake the version numbers, so asking the 
shared object is authoritative (unless the releasers of the original 
source enter the wrong string, as with the current PROJ.4, which declares 
that it is an as yet unreleased version, these things happen).

Either revert properly to GDAL 1.7.*, or wait for me to fix this for 
1.8.*, please. I'll post in this thread when I'm ready, and then you can 
check the rgdal source from R-Forge, OK?

Roger

>
> I've searched my disk and find gdal16 and gdal17 but not gdal18
> Do you know if it is possible to tell rgdal which gdal should be used?
>
> Thanks
>
> Agus
>
>
>
> 2010/12/11 Roger Bivand <Roger.Bivand at nhh.no>:
>> On Fri, 10 Dec 2010, Agustin Lobo wrote:
>>
>>> Roger,
>>>
>>> I was not aware that 1.8dev is actually older than 1.7.2 I'll check why I
>>> have that gdal on the other machine and will try to fix that on my side on
>>> Monday. But perhaps this problem will come up again for future stable
>>> versions of 1.8.* ? Anyway, 1.8dev is clearly not a good choice and I have
>>> to change it.
>>
>> As of GDAL 1.8.0 SVN revision 21234, the problem exists. I'll fix this in
>> rgdal for the drivers I am familiar with before 1.8.0 is released.
>>
>> Roger
>>
>>>
>>> Thanks
>>>
>>> Agus
>>>
>>> 2010/12/10 Roger Bivand <Roger.Bivand at nhh.no>:
>>>>
>>>> On Fri, 10 Dec 2010, Agustin Lobo wrote:
>>>>
>>>>> Roger,
>>>>>
>>>>> is this all you need? I thought sessionInfo was providing everything
>>>>> needed.
>>>>
>>>> You had given sessionInfo() but that does not report which GDAL you are
>>>> using. The report unfortunately does not give an svn revision, maybe
>>>> gdal-config --version does? I develop using 1.7.* GDAL. Your 1.8dev is
>>>> pretty old, certainly older that released 1.7.3. I can try to build a
>>>> current GDAL trunk from source next week, if I get time, but this looks
>>>> like
>>>> something in your setup (development GDAL that is now stale?).
>>>>
>>>>> The driver is "ESRI Shapefile" as stated in the command, have not tested
>>>>> any other (it does work for raster though, as you mention):
>>>>
>>>> I mentioned four variants of vector drivers, not raster.
>>>>
>>>> Roger
>>>>
>>>>>
>>>>>> require(rgdal)
>>>>>
>>>>> Loading required package: rgdal
>>>>> Geospatial Data Abstraction Library extensions to R successfully loaded
>>>>> Loaded GDAL runtime: GDAL 1.8dev, released 2010/01/19
>>>>> Path to GDAL shared files: /usr/local/share/gdal
>>>>> Loaded PROJ.4 runtime: Rel. 4.7.1, 23 September 2009
>>>>> Path to PROJ.4 shared files: (autodetected)
>>>>>
>>>>> Thanks
>>>>>
>>>>> Agus
>>>>>
>>>>> 2010/12/10 Roger Bivand <Roger.Bivand at nhh.no>:
>>>>>>
>>>>>> On Fri, 10 Dec 2010, Agustin Lobo wrote:
>>>>>>
>>>>>>> Roger,
>>>>>>>
>>>>>>> It does not for me. The error is solved by deleting files xygcatLO.* ,
>>>>>>> while directory xygcatLO may continue to exist.
>>>>>>
>>>>>> Agus,
>>>>>>
>>>>>> With which drivers, OGR version (in header when rgdal loads)? If I
>>>>>> cannot
>>>>>> reproduce this, I cannot readily help.
>>>>>>
>>>>>> Roger
>>>>>>
>>>>>>>
>>>>>>> Also, I've found that with this version the below command does not
>>>>>>> save the files within
>>>>>>> the folder indicated by dsn, but outside. This was not the case in the
>>>>>>> past, but do not know if this is
>>>>>>> because of a change in rgdal, gdal or ubuntu 10.04 (I've changed all 3
>>>>>>> since the last time I used writeOGR()).
>>>>>>>
>>>>>>>> writeOGR(xygcatLO,dsn="xygcatLO",layer="xygcatLO", driver="ESRI
>>>>>>>> Shapefile")
>>>>>>>
>>>>>>> Error in writeOGR(xygcatLO, dsn = "xygcatLO", layer = "xygcatLO",
>>>>>>> driver = "ESRI Shapefile") :
>>>>>>>
>>>>>>> ? ? ? ?GDAL Error 1: Layer 'xygcatLO' already exists
>>>>>>> Calls: writeOGR -> .Call
>>>>>>>
>>>>>>>> sessionInfo()
>>>>>>>
>>>>>>> R version 2.12.0 (2010-10-15)
>>>>>>> Platform: x86_64-pc-linux-gnu (64-bit)
>>>>>>>
>>>>>>> locale:
>>>>>>> [1] LC_CTYPE=en_US.utf8 ? ? ? ? ?LC_NUMERIC=C
>>>>>>> [3] LC_TIME=en_US.utf8 ? ? ? ? ? LC_COLLATE=en_US.utf8
>>>>>>> [5] LC_MONETARY=en_US.utf8 ? ? ? LC_MESSAGES=en_US.utf8
>>>>>>> [7] LC_PAPER=en_US.utf8 ? ? ? ? ?LC_NAME=en_US.utf8
>>>>>>> [9] LC_ADDRESS=en_US.utf8 ? ? ? ?LC_TELEPHONE=en_US.utf8
>>>>>>> [11] LC_MEASUREMENT=en_US.utf8 ? ?LC_IDENTIFICATION=en_US.utf8
>>>>>>>
>>>>>>> attached base packages:
>>>>>>> [1] stats ? ? graphics ?grDevices utils ? ? datasets ?methods ? base
>>>>>>>
>>>>>>> other attached packages:
>>>>>>> [1] RANN_2.1.2 ? ? ?outliers_0.13-3 rgdal_0.6-30 ? ?raster_1.7-2
>>>>>>> [5] sp_0.9-73 ? ? ? rkward_0.5.4
>>>>>>>
>>>>>>> loaded via a namespace (and not attached):
>>>>>>> [1] grid_2.12.0 ? ? lattice_0.19-13 tools_2.12.0
>>>>>>> 2010/12/10 Roger Bivand <Roger.Bivand at nhh.no>:
>>>>>>>>
>>>>>>>> On Thu, 9 Dec 2010, Barry Rowlingson wrote:
>>>>>>>>
>>>>>>>>> On Thu, Dec 9, 2010 at 8:56 AM, Agustin Lobo <alobolistas at gmail.com>
>>>>>>>>> wrote:
>>>>>>>>>>
>>>>>>>>>> Hi!
>>>>>>>>>>
>>>>>>>>>> Could an option overwrite=T (default overwrite=F) be included in
>>>>>>>>>> writeOGR()?
>>>>>>>>>> Thanks!
>>>>>>>>>
>>>>>>>>> Submit a Feature Request here:
>>>>>>>>>
>>>>>>>>> http://sourceforge.net/tracker/?group_id=84716&atid=573625
>>>>>>>>
>>>>>>>> No, rgdal is on R-Forge, and a list called rgdal-devel will be
>>>>>>>> available
>>>>>>>> from tomorrow.
>>>>>>>>
>>>>>>>>>
>>>>>>>>> It looks like it just needs to be a wrapper around OGR's delete
>>>>>>>>> layer
>>>>>>>>> function.
>>>>>>>>
>>>>>>>> Contributions welcome. Note that the facility is present for rasters,
>>>>>>>> which
>>>>>>>> I fould out by accidentally deleting GRASS database objects (for
>>>>>>>> which
>>>>>>>> of
>>>>>>>> course I did not have backups). Is this really needed - which drivers
>>>>>>>> do
>>>>>>>> not
>>>>>>>> already overwrite without complaint? These do not complain for me:
>>>>>>>> driver="ESRI Shapefile"; driver="KML"; driver="MapInfo File";
>>>>>>>> driver="MapInfo File", dataset_options="FORMAT=MIF".
>>>>>>>>
>>>>>>>> Hope this helps,
>>>>>>>>
>>>>>>>> Roger
>>>>>>>>
>>>>>>>>>
>>>>>>>>> Barry
>>>>>>>>>
>>>>>>>>> _______________________________________________
>>>>>>>>> R-sig-Geo mailing list
>>>>>>>>> R-sig-Geo at r-project.org
>>>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>>>>>
>>>>>>>>
>>>>>>>> --
>>>>>>>> Roger Bivand
>>>>>>>> Economic Geography Section, Department of Economics, Norwegian School
>>>>>>>> of
>>>>>>>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>>>>>>>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>>>>>>>> e-mail: Roger.Bivand at nhh.no
>>>>>>>>
>>>>>>>> _______________________________________________
>>>>>>>> R-sig-Geo mailing list
>>>>>>>> R-sig-Geo at r-project.org
>>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>>>>
>>>>>>>
>>>>>>
>>>>>> --
>>>>>> Roger Bivand
>>>>>> Economic Geography Section, Department of Economics, Norwegian School
>>>>>> of
>>>>>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>>>>>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>>>>>> e-mail: Roger.Bivand at nhh.no
>>>>>>
>>>>>> _______________________________________________
>>>>>> R-sig-Geo mailing list
>>>>>> R-sig-Geo at r-project.org
>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>>
>>>>>
>>>>
>>>> --
>>>> Roger Bivand
>>>> Economic Geography Section, Department of Economics, Norwegian School of
>>>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>>>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>>>> e-mail: Roger.Bivand at nhh.no
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at r-project.org
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>>
>>>
>>
>> --
>> Roger Bivand
>> Economic Geography Section, Department of Economics, Norwegian School of
>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>> e-mail: Roger.Bivand at nhh.no
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From isabelle.boulangeat at gmail.com  Mon Dec 13 14:38:49 2010
From: isabelle.boulangeat at gmail.com (isabelle boulangeat)
Date: Mon, 13 Dec 2010 14:38:49 +0100
Subject: [R-sig-Geo] new function predict, package raster
In-Reply-To: <AANLkTimHsO-kqUN0W3U6BkGx51uWuD+W+3oOO1Nk5i57@mail.gmail.com>
References: <AANLkTikU1d4LrvtOCsVUb3FOVWV+NMcL2cpjvC8Bw8OC@mail.gmail.com>
	<AANLkTim4_1NH-sJE1OkUAgari22wy1_V=AHf8F5MB3v=@mail.gmail.com>
	<AANLkTi=ez4w1dnc3kM00jTL482JAy1MQtyAkhpPBR+dn@mail.gmail.com>
	<AANLkTinLzNRz2CocwHbZ3xyWgMg_zhCSpozJhZXD=99O@mail.gmail.com>
	<AANLkTim7K-m6Ebv2_rrv9CBx2uHxOAFGT4MtZ0YLR+7q@mail.gmail.com>
	<AANLkTimd0oOu_DwNrfeHF8GPRqeP6pXQZ94+iG6gjj91@mail.gmail.com>
	<AANLkTimHsO-kqUN0W3U6BkGx51uWuD+W+3oOO1Nk5i57@mail.gmail.com>
Message-ID: <AANLkTi=8WVdp2xyoXQ_D1BGhPhmJ=ufcxs51i4TKTRiR@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101213/0ab4ad08/attachment.pl>

From kji2080 at gmail.com  Mon Dec 13 15:34:03 2010
From: kji2080 at gmail.com (Jooil Kim)
Date: Mon, 13 Dec 2010 23:34:03 +0900
Subject: [R-sig-Geo] Strategies for modifying country-specific grids
 from a global gridded dataset in simple matrix form?
In-Reply-To: <AANLkTi=59C-nDHQ+8OBLXfoSBrc9YW=3LhHfsgCMu90V@mail.gmail.com>
References: <AANLkTi=59C-nDHQ+8OBLXfoSBrc9YW=3LhHfsgCMu90V@mail.gmail.com>
Message-ID: <AANLkTinqssXpkE40GRx4+dLO_kO5yvrfD8DChDL=EFzD@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101213/4b863c15/attachment.pl>

From kmcoulib at gmail.com  Mon Dec 13 19:15:45 2010
From: kmcoulib at gmail.com (kapo coulibaly)
Date: Mon, 13 Dec 2010 13:15:45 -0500
Subject: [R-sig-Geo] selective kriging
Message-ID: <AANLkTi=wpyJHWkZWcnb9U4CRRz7BDK=aYZ=ChCnWTcFq@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101213/36ef312a/attachment.pl>

From hadley at rice.edu  Mon Dec 13 19:45:31 2010
From: hadley at rice.edu (Hadley Wickham)
Date: Mon, 13 Dec 2010 12:45:31 -0600
Subject: [R-sig-Geo] graticules for projected data
In-Reply-To: <AANLkTikAuxJ97U=4aSy2DzunYvy=hQ-QwLbRwU=5N8pe@mail.gmail.com>
References: <7413BB3B-8C84-4860-866E-F9EFDD7D1058@noaa.gov>
	<AANLkTi=tkFAOqTC3oy24iX94puik0rJdj02oJFm55pgR@mail.gmail.com>
	<AANLkTimdgR8UuFyqbUmZfC=M_=_i6QWO9XZ1XydkCA=x@mail.gmail.com>
	<AANLkTikAuxJ97U=4aSy2DzunYvy=hQ-QwLbRwU=5N8pe@mail.gmail.com>
Message-ID: <AANLkTi=W92gdzDMvL-nzJAeFL4V_jQsU==cRY0_fTTPJ@mail.gmail.com>

It should be possible to use RGEOS instead, but I'm not sure how far
along that is.
Hadley

On Thu, Dec 9, 2010 at 11:04 PM, Pierre Roudier
<pierre.roudier at gmail.com> wrote:
> Harley,
>
> In ggplot2 however, is there a way to plot shapefiles without gpclib?
> Its licence is a problem for any externaly-founded research
> unfortunately.
>
> Cheers,
>
> Pierre
>
> 2010/12/10 Hadley Wickham <hadley at rice.edu>:
>> ggplot2 + coord_map() already does graticules in a similar manner, as
>> far as I can tell.
>>
>> Hadley
>>
>> On Thu, Dec 9, 2010 at 2:22 PM, Pierre Roudier <pierre.roudier at gmail.com> wrote:
>>> That really is a neat piece of code. Very interested - the result
>>> looks very much like a ggplot2 plot, which I'm a big fan.
>>>
>>> Cheers,
>>>
>>> Pierre
>>>
>>> 2010/12/9 Josh London <josh.london at noaa.gov>:
>>>> Hello
>>>>
>>>> One of the features I often find myself wanting within spplot is the ability to produce graticules (with corresponding axis labels) that represent latitude/longitude lines for projected data. I often find myself searching the R archives and google for examples and methods for accomplishing this, but have always come up empty.
>>>>
>>>> This has been partially possible by using the gridlines() function within sp and then projecting those spatial lines to the desired projection. There are two drawbacks to this solution:
>>>>
>>>> 1) Often the extent of the projected gridlines is smaller than the data of interest so the lines stop short of the plot borders
>>>>
>>>> 2) There is no documented method I've found for producing the axis labels with degree units for each of the gridlines. gridat() is close but only supports unprojected data
>>>>
>>>> So, I ventured forth and pulled together a few functions that attempt to provide a generalized solution in the hopes that a) there's not some existing, obvious, solution my endless searching has overlooked and b) other folks could take advantage of it and maybe expand/improve on it.
>>>>
>>>> I've pulled everything together in a draft package, ProjectedGridlines, and it is available on GitHub (https://github.com/jmlondon/ProjectedGridlines). I've got some basic draft documentation in there for those interested.
>>>>
>>>> I make no claims to the code being elegant or an approach that will work for everyone. The main purpose here was to get something that works and distribute it.
>>>>
>>>> Below, I include the three functions and a reproducible example based on the north carolina dataset included with the maptools package. I've copied over some of the roxygen documentation, but those interested in more details should check the files on GitHub.
>>>>
>>>> Cheers
>>>> Josh
>>>>
>>>> GetGratLines<-function(spobj,proj_str,exp_deg,ndisc=500,...){
>>>> ? ? ? ?spobj at bbox[1,1]<-spobj at bbox[1,1]+exp_deg$l
>>>> ? ? ? ?spobj at bbox[1,2]<-spobj at bbox[1,2]+exp_deg$r
>>>> ? ? ? ?spobj at bbox[2,1]<-spobj at bbox[2,1]+exp_deg$b
>>>> ? ? ? ?spobj at bbox[2,2]<-spobj at bbox[2,2]+exp_deg$t
>>>> ? ? ? ?gl<-spTransform(gridlines(spobj,ndisc=ndisc,...),CRS(proj_str))
>>>> ? ? ? ?return(gl)
>>>> }
>>>>
>>>> #' @param spobj an unrpojected sp object that is the basis of the final projected outcome
>>>> #' @param proj_str a proj4 string specifying the desired projection
>>>> #' @param exp_deg is a named list with values l,r,b,t specifying the amount in decimal
>>>> #' degrees each side (left, right, bottom, top) should be expanded to account for differences
>>>> #' in extent between the projected gridlines and the final projected extent of spobj
>>>> #' @param ... passing of parameters relevant to gridlines()
>>>>
>>>> GetDegreeLabels<-function(spobj){
>>>> ? ? ? ?ewl<-coordinates(gridlines(spobj)["EW"]@lines[[1]])
>>>> ? ? ? ?nsl<-coordinates(gridlines(spobj)["NS"]@lines[[1]])
>>>> ? ? ? ?ewLabels<-lapply(ewl,function(x) {return(x[1,1])})
>>>> ? ? ? ?nsLabels<-lapply(nsl,function(x) {return(x[1,2])})
>>>> ? ? ? ?return(list(EW_Labels=unlist(ewLabels),NS_Labels=unlist(nsLabels)))
>>>> }
>>>>
>>>> #' @param spobj an unrpojected sp object that is the basis of the final projected outcome
>>>>
>>>> GetLabelCoords<-function(gl,offset=list(ew=0,ns=0)){
>>>> ? ? ? ?ewc<-coordinates(gl["EW"]@lines[[1]])
>>>> ? ? ? ?nsc<-coordinates(gl["NS"]@lines[[1]])
>>>> ? ? ? ?ewCoords<-lapply(ewc,function(x) {return(x[1,1])})
>>>> ? ? ? ?nsCoords<-lapply(nsc,function(x) {return(x[1,2])})
>>>> ? ? ? ?ewCoords<-lapply(ewCoords,function(x) {return(x+offset$ew)})
>>>> ? ? ? ?nsCoords<-lapply(nsCoords,function(x) {return(x+offset$ns)})
>>>> ? ? ? ?return(list(EW_Coords=unlist(ewCoords),NS_Coords=unlist(nsCoords)))
>>>> }
>>>>
>>>> #' @param gl the SpatialLines object returned from GetGratLines
>>>> #' @param offset a named list with values ew and ns specifying an offset for all labels on the axis
>>>>
>>>> And an example:
>>>>
>>>> library(sp)
>>>> library(rgdal)
>>>> library(maptools)
>>>> library(RColorBrewer)
>>>>
>>>> #read in the maptools north carolina shapefile, unprojected
>>>> d <- readShapePoly(system.file("shapes/sids.shp", package="maptools")[1], proj4string=CRS("+proj=longlat +datum=NAD27"))
>>>>
>>>> # create a dummy factor variable, with equal labels:
>>>> set.seed(31)
>>>> d$f = factor(sample(1:5,100,replace=T),labels=letters[1:5])
>>>>
>>>> #specify a custom Albers equal centered on the coordinate data
>>>> #this works for points and polygons, but lines need to be converted to points
>>>> med.lat <- round(median(coordinates(d)[,2]))
>>>> med.lon <- round(median(coordinates(d)[,1]))
>>>> lat1<-bbox(d)[2,1]+diff(range(bbox(d)[2,]))/3
>>>> lat2<-bbox(d)[2,2]-diff(range(bbox(d)[2,]))/3
>>>>
>>>> myProj <- paste("+proj=aea +lat_1=",lat1," +lat_2=",lat2," +lat_0=",med.lat,
>>>> ? ? ? ? ? ? ? ?" +lon_0=", med.lon, "+x_0=0 +y_0=0 +ellps=GRS80 +datum=NAD83 +units=m",sep="")
>>>>
>>>> #project the data, the graticule lines. note the gridlines function calls the unprojected data
>>>> d.proj <- spTransform(d,CRS(myProj))
>>>> #grat.lines<-spTransform(gridlines(d,ndisc=500),CRS(myProj))
>>>> g<-GetGratLines(d,myProj,list(t=0.25,b=-0.25,l=-0.25,r=0.25))
>>>> #create the sp.layout component for the graticule lines
>>>> grat.plot<-list("sp.lines",g,lwd="1.5",col="white",first=TRUE)
>>>>
>>>> x_grat_at<-GetLabelCoords(g,offset=list(ew=0))$EW_Coords
>>>>
>>>> y_grat_at<-GetLabelCoords(g,offset=list(ns=0))$NS_Coords
>>>>
>>>> x_grat<-list(draw=TRUE,
>>>> ? ? ? ? ? ? ? ?at=x_grat_at,
>>>> ? ? ? ? ? ? ? ?labels=as.character(GetDegreeLabels(d)$EW_Labels),
>>>> ? ? ? ? ? ? ? ?tck=c(0,0),
>>>> ? ? ? ? ? ? ? ?cex=0.75)
>>>>
>>>> y_grat<-list(draw=TRUE,
>>>> ? ? ? ? ? ? ? ?at=y_grat_at,
>>>> ? ? ? ? ? ? ? ?labels=as.character(GetDegreeLabels(d)$NS_Labels),
>>>> ? ? ? ? ? ? ? ?rot=90,
>>>> ? ? ? ? ? ? ? ?tck=c(0,0),
>>>> ? ? ? ? ? ? ? ?cex=0.75)
>>>>
>>>> spplot(d.proj, c("f"),
>>>> ? ? ? ? ? ? ? ?panel=function(...){
>>>> ? ? ? ? ? ? ? ? ? ? ? ?panel.fill(col="gray90")
>>>> ? ? ? ? ? ? ? ? ? ? ? ?panel.polygonsplot(...)
>>>> ? ? ? ? ? ? ? ?},
>>>> ? ? ? ? ? ? ? ?sp.layout=list(grat.plot),
>>>> ? ? ? ? ? ? ? ?col.regions=brewer.pal(5, "Set3"),scales=list(x=x_grat,y=y_grat))
>>>>
>>>>
>>>>
>>>>
>>>>
>>>> ? ? ? ?[[alternative HTML version deleted]]
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at r-project.org
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>>
>>
>> --
>> Assistant Professor / Dobelman Family Junior Chair
>> Department of Statistics / Rice University
>> http://had.co.nz/
>>
>
>



-- 
Assistant Professor / Dobelman Family Junior Chair
Department of Statistics / Rice University
http://had.co.nz/


From gianni.lavaredo at gmail.com  Mon Dec 13 20:03:21 2010
From: gianni.lavaredo at gmail.com (gianni lavaredo)
Date: Mon, 13 Dec 2010 20:03:21 +0100
Subject: [R-sig-Geo] help to select files in a foulder
Message-ID: <AANLkTimD_BG5b3E+wtqr+UqHQo4wkLtC-TAY0NBoymdi@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101213/91ba0472/attachment.pl>

From roman.lustrik at gmail.com  Mon Dec 13 20:30:47 2010
From: roman.lustrik at gmail.com (=?UTF-8?Q?Roman_Lu=C5=A1trik?=)
Date: Mon, 13 Dec 2010 20:30:47 +0100
Subject: [R-sig-Geo] help to select files in a foulder
In-Reply-To: <AANLkTimD_BG5b3E+wtqr+UqHQo4wkLtC-TAY0NBoymdi@mail.gmail.com>
References: <AANLkTimD_BG5b3E+wtqr+UqHQo4wkLtC-TAY0NBoymdi@mail.gmail.com>
Message-ID: <AANLkTi=8ukLENG0NTCrOXPE2uV4oiEBGJ4BhegP+wpyR@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101213/d43c1c30/attachment.pl>

From josh.london at noaa.gov  Mon Dec 13 21:02:38 2010
From: josh.london at noaa.gov (Josh London)
Date: Mon, 13 Dec 2010 12:02:38 -0800
Subject: [R-sig-Geo] graticules for projected data
In-Reply-To: <AANLkTimdgR8UuFyqbUmZfC=M_=_i6QWO9XZ1XydkCA=x@mail.gmail.com>
References: <7413BB3B-8C84-4860-866E-F9EFDD7D1058@noaa.gov>
	<AANLkTi=tkFAOqTC3oy24iX94puik0rJdj02oJFm55pgR@mail.gmail.com>
	<AANLkTimdgR8UuFyqbUmZfC=M_=_i6QWO9XZ1XydkCA=x@mail.gmail.com>
Message-ID: <2A8CACA2-6E10-41B3-A63C-286538B0878E@noaa.gov>

Hadley

As you can tell from the final example, I really appreciate the look and feel of ggplot2 and use it for most of my non-map plots. However, I have, maybe wrongly, presumed fortify only works for spatial polygons and lines. I often have a need to map spatial points, pixels or grids and so have stuck with spplot for most of my mapping.

cheers
Josh
 
On Dec 9, 2010, at 3:36 PM, Hadley Wickham wrote:

> ggplot2 + coord_map() already does graticules in a similar manner, as
> far as I can tell.
> 
> Hadley
> 
> On Thu, Dec 9, 2010 at 2:22 PM, Pierre Roudier <pierre.roudier at gmail.com> wrote:
>> That really is a neat piece of code. Very interested - the result
>> looks very much like a ggplot2 plot, which I'm a big fan.
>> 
>> Cheers,
>> 
>> Pierre
>> 
>> 2010/12/9 Josh London <josh.london at noaa.gov>:
>>> Hello
>>> 
>>> One of the features I often find myself wanting within spplot is the ability to produce graticules (with corresponding axis labels) that represent latitude/longitude lines for projected data. I often find myself searching the R archives and google for examples and methods for accomplishing this, but have always come up empty.
>>> 
>>> This has been partially possible by using the gridlines() function within sp and then projecting those spatial lines to the desired projection. There are two drawbacks to this solution:
>>> 
>>> 1) Often the extent of the projected gridlines is smaller than the data of interest so the lines stop short of the plot borders
>>> 
>>> 2) There is no documented method I've found for producing the axis labels with degree units for each of the gridlines. gridat() is close but only supports unprojected data
>>> 
>>> So, I ventured forth and pulled together a few functions that attempt to provide a generalized solution in the hopes that a) there's not some existing, obvious, solution my endless searching has overlooked and b) other folks could take advantage of it and maybe expand/improve on it.
>>> 
>>> I've pulled everything together in a draft package, ProjectedGridlines, and it is available on GitHub (https://github.com/jmlondon/ProjectedGridlines). I've got some basic draft documentation in there for those interested.
>>> 
>>> I make no claims to the code being elegant or an approach that will work for everyone. The main purpose here was to get something that works and distribute it.
>>> 
>>> Below, I include the three functions and a reproducible example based on the north carolina dataset included with the maptools package. I've copied over some of the roxygen documentation, but those interested in more details should check the files on GitHub.
>>> 
>>> Cheers
>>> Josh
>>> 
>>> GetGratLines<-function(spobj,proj_str,exp_deg,ndisc=500,...){
>>>        spobj at bbox[1,1]<-spobj at bbox[1,1]+exp_deg$l
>>>        spobj at bbox[1,2]<-spobj at bbox[1,2]+exp_deg$r
>>>        spobj at bbox[2,1]<-spobj at bbox[2,1]+exp_deg$b
>>>        spobj at bbox[2,2]<-spobj at bbox[2,2]+exp_deg$t
>>>        gl<-spTransform(gridlines(spobj,ndisc=ndisc,...),CRS(proj_str))
>>>        return(gl)
>>> }
>>> 
>>> #' @param spobj an unrpojected sp object that is the basis of the final projected outcome
>>> #' @param proj_str a proj4 string specifying the desired projection
>>> #' @param exp_deg is a named list with values l,r,b,t specifying the amount in decimal
>>> #' degrees each side (left, right, bottom, top) should be expanded to account for differences
>>> #' in extent between the projected gridlines and the final projected extent of spobj
>>> #' @param ... passing of parameters relevant to gridlines()
>>> 
>>> GetDegreeLabels<-function(spobj){
>>>        ewl<-coordinates(gridlines(spobj)["EW"]@lines[[1]])
>>>        nsl<-coordinates(gridlines(spobj)["NS"]@lines[[1]])
>>>        ewLabels<-lapply(ewl,function(x) {return(x[1,1])})
>>>        nsLabels<-lapply(nsl,function(x) {return(x[1,2])})
>>>        return(list(EW_Labels=unlist(ewLabels),NS_Labels=unlist(nsLabels)))
>>> }
>>> 
>>> #' @param spobj an unrpojected sp object that is the basis of the final projected outcome
>>> 
>>> GetLabelCoords<-function(gl,offset=list(ew=0,ns=0)){
>>>        ewc<-coordinates(gl["EW"]@lines[[1]])
>>>        nsc<-coordinates(gl["NS"]@lines[[1]])
>>>        ewCoords<-lapply(ewc,function(x) {return(x[1,1])})
>>>        nsCoords<-lapply(nsc,function(x) {return(x[1,2])})
>>>        ewCoords<-lapply(ewCoords,function(x) {return(x+offset$ew)})
>>>        nsCoords<-lapply(nsCoords,function(x) {return(x+offset$ns)})
>>>        return(list(EW_Coords=unlist(ewCoords),NS_Coords=unlist(nsCoords)))
>>> }
>>> 
>>> #' @param gl the SpatialLines object returned from GetGratLines
>>> #' @param offset a named list with values ew and ns specifying an offset for all labels on the axis
>>> 
>>> And an example:
>>> 
>>> library(sp)
>>> library(rgdal)
>>> library(maptools)
>>> library(RColorBrewer)
>>> 
>>> #read in the maptools north carolina shapefile, unprojected
>>> d <- readShapePoly(system.file("shapes/sids.shp", package="maptools")[1], proj4string=CRS("+proj=longlat +datum=NAD27"))
>>> 
>>> # create a dummy factor variable, with equal labels:
>>> set.seed(31)
>>> d$f = factor(sample(1:5,100,replace=T),labels=letters[1:5])
>>> 
>>> #specify a custom Albers equal centered on the coordinate data
>>> #this works for points and polygons, but lines need to be converted to points
>>> med.lat <- round(median(coordinates(d)[,2]))
>>> med.lon <- round(median(coordinates(d)[,1]))
>>> lat1<-bbox(d)[2,1]+diff(range(bbox(d)[2,]))/3
>>> lat2<-bbox(d)[2,2]-diff(range(bbox(d)[2,]))/3
>>> 
>>> myProj <- paste("+proj=aea +lat_1=",lat1," +lat_2=",lat2," +lat_0=",med.lat,
>>>                " +lon_0=", med.lon, "+x_0=0 +y_0=0 +ellps=GRS80 +datum=NAD83 +units=m",sep="")
>>> 
>>> #project the data, the graticule lines. note the gridlines function calls the unprojected data
>>> d.proj <- spTransform(d,CRS(myProj))
>>> #grat.lines<-spTransform(gridlines(d,ndisc=500),CRS(myProj))
>>> g<-GetGratLines(d,myProj,list(t=0.25,b=-0.25,l=-0.25,r=0.25))
>>> #create the sp.layout component for the graticule lines
>>> grat.plot<-list("sp.lines",g,lwd="1.5",col="white",first=TRUE)
>>> 
>>> x_grat_at<-GetLabelCoords(g,offset=list(ew=0))$EW_Coords
>>> 
>>> y_grat_at<-GetLabelCoords(g,offset=list(ns=0))$NS_Coords
>>> 
>>> x_grat<-list(draw=TRUE,
>>>                at=x_grat_at,
>>>                labels=as.character(GetDegreeLabels(d)$EW_Labels),
>>>                tck=c(0,0),
>>>                cex=0.75)
>>> 
>>> y_grat<-list(draw=TRUE,
>>>                at=y_grat_at,
>>>                labels=as.character(GetDegreeLabels(d)$NS_Labels),
>>>                rot=90,
>>>                tck=c(0,0),
>>>                cex=0.75)
>>> 
>>> spplot(d.proj, c("f"),
>>>                panel=function(...){
>>>                        panel.fill(col="gray90")
>>>                        panel.polygonsplot(...)
>>>                },
>>>                sp.layout=list(grat.plot),
>>>                col.regions=brewer.pal(5, "Set3"),scales=list(x=x_grat,y=y_grat))
>>> 
>>> 
>>> 
>>> 
>>> 
>>>        [[alternative HTML version deleted]]
>>> 
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>> 
>> 
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> 
> 
> 
> 
> -- 
> Assistant Professor / Dobelman Family Junior Chair
> Department of Statistics / Rice University
> http://had.co.nz/


From hadley at rice.edu  Mon Dec 13 21:44:33 2010
From: hadley at rice.edu (Hadley Wickham)
Date: Mon, 13 Dec 2010 14:44:33 -0600
Subject: [R-sig-Geo] graticules for projected data
In-Reply-To: <2A8CACA2-6E10-41B3-A63C-286538B0878E@noaa.gov>
References: <7413BB3B-8C84-4860-866E-F9EFDD7D1058@noaa.gov>
	<AANLkTi=tkFAOqTC3oy24iX94puik0rJdj02oJFm55pgR@mail.gmail.com>
	<AANLkTimdgR8UuFyqbUmZfC=M_=_i6QWO9XZ1XydkCA=x@mail.gmail.com>
	<2A8CACA2-6E10-41B3-A63C-286538B0878E@noaa.gov>
Message-ID: <AANLkTi=9dVY0qxdHqmhOv7=sjH83RDVOwBuEe7Zh629P@mail.gmail.com>

> As you can tell from the final example, I really appreciate the look and feel of ggplot2 and use it for most of my non-map plots. However, I have, maybe wrongly, presumed fortify only works for spatial polygons and lines. I often have a need to map spatial points, pixels or grids and so have stuck with spplot for most of my mapping.

Those are (fairly) easily added - but I don't have any test cases and
no one has asked for them before...

Hadley

-- 
Assistant Professor / Dobelman Family Junior Chair
Department of Statistics / Rice University
http://had.co.nz/


From edzer.pebesma at uni-muenster.de  Mon Dec 13 22:08:11 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Mon, 13 Dec 2010 22:08:11 +0100
Subject: [R-sig-Geo] looking up country names from lat long
In-Reply-To: <4D053094.7070907@orn.mpg.de>
References: <AANLkTinpSKz0BwrEjoVKQk7oFAcFEPfDaYm6KowQwYxf@mail.gmail.com>	<AANLkTinNVs8Fjzh2KOsMcnE+J_dq4kYDZX=E_ohWiRNH@mail.gmail.com>
	<4D053094.7070907@orn.mpg.de>
Message-ID: <4D068B3B.2040906@uni-muenster.de>



On 12/12/2010 09:29 PM, Mihai Valcu wrote:
> 
> An offline country map + overlay should work pretty fast.
> 
> ##########
> require(rgdal)
> setwd(tempdir())
> download.file("http://www.naturalearthdata.com/http//www.naturalearthdata.com/download/110m/cultural/110m-admin-0-countries.zip",destfile
> = "temp")
> unzip(zipfile = "temp")
> w = readOGR(tempdir(), '110m_admin_0_countries')
> # some random points of interest
> poi = SpatialPointsDataFrame(spsample(w, 10, "random"), data =
> data.frame(id = 1:10))
> poi at data$cntry =  w at data[overlay(poi, w), "NAME"]

# in principle, both "@data" can be taken out;
# a alternative way would use over:

poi$cntry = over(poi, w)$NAME

> plot(w)
> plot(poi, add = T, col = 2)
> text(poi, labels = poi$cntry, col = 2, cex = 1)
> ##########
> 
> Best wishes
> Mihai
> 
> On 12/6/2010 3:19 PM, Barry Rowlingson wrote:
>> On Mon, Dec 6, 2010 at 1:41 PM, Josh Tewksbury<tewksjj at gmail.com>  wrote:
>>> Hello - here is what I am sure is a quick question from someone new
>>> to R in
>>> spatial stats. I have a long list of lat long coordinates and I would
>>> like
>>> to do a location country check to extrapolate a country name from each
>>> lat/long point.
>>>
>>> so, for example, my data look like
>>>
>>> lat, long
>>> 14.42, -89.92
>>> 14.42, -89.75
>>> 14.42, -89.58
>>> 14.42, -89.42
>>> 14.42, -89.25
>>>
>>> continued for the terrestrial surface of the earth.
>>>
>>> If I want to add country names, so I can use those names as tags to
>>> merge in
>>> other data, is there an easy lookup that will allow me to do that, so
>>> I end
>>> up with:
>>>
>>> lat, long, country
>>> 14.42, -89.92, Guatemala
>>> 14.42, -89.75, Guatemala
>>> 14.42, -89.58, Guatemala
>>> 14.42, -89.42, El Salvador
>>> 14.42, -89.25, Honduras
>>   My 'geonames' package (on CRAN) can do lookups via the geonames.org
>> web service:
>>
>>> GNcountryCode(lat=14.24,lng=-89.92)
>> $distance
>> [1] 0
>>
>> $countryName
>> [1] "Guatemala"
>>
>> $countryCode
>> [1] "GT"
>>
>>   its being very slow at the moment though. You might have speedier
>> responses.
>>
>>   It can only look up one at a time, so you'll have to loop through
>> your data frame with the usual R loop/apply-type patterns.
>>
>> Barry
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From pierre.roudier at gmail.com  Mon Dec 13 22:59:54 2010
From: pierre.roudier at gmail.com (Pierre Roudier)
Date: Tue, 14 Dec 2010 10:59:54 +1300
Subject: [R-sig-Geo] graticules for projected data
In-Reply-To: <2A8CACA2-6E10-41B3-A63C-286538B0878E@noaa.gov>
References: <7413BB3B-8C84-4860-866E-F9EFDD7D1058@noaa.gov>
	<AANLkTi=tkFAOqTC3oy24iX94puik0rJdj02oJFm55pgR@mail.gmail.com>
	<AANLkTimdgR8UuFyqbUmZfC=M_=_i6QWO9XZ1XydkCA=x@mail.gmail.com>
	<2A8CACA2-6E10-41B3-A63C-286538B0878E@noaa.gov>
Message-ID: <AANLkTi=dRODjAi7YwNAqA3V7bMsPRDu_YWY6g712JpfJ@mail.gmail.com>

For SpatialPoints* and SpatialPixels* I'm using ggplot2:

library(sp)
library(ggplot2)

data(meuse)
data(meuse.grid)
coordinates(meuse) <- ~x+y
coordinates(meuse.grid) <- ~x+y

# ... some spatial processing

plot_meuse <- ggplot(as.data.frame(meuse)) + geom_point(aes(x,y,
colour=zinc)) + coord_equal()
plot_meuse.grid <- ggplot(as.data.frame(meuse.grid)) +
geom_tile(aes(x,y, fill=dist)) + coord_equal()

# You can alo combine both geoms
plot_combined <- ggplot() + geom_tile(data=as.data.frame(meuse.grid),
aes(x,y, fill=factor(soil))) + geom_point(data=as.data.frame(meuse),
aes(x,y, colour=zinc))  + coord_equal()

HTH,

Pierre

2010/12/14 Josh London <josh.london at noaa.gov>:
> Hadley
>
> As you can tell from the final example, I really appreciate the look and feel of ggplot2 and use it for most of my non-map plots. However, I have, maybe wrongly, presumed fortify only works for spatial polygons and lines. I often have a need to map spatial points, pixels or grids and so have stuck with spplot for most of my mapping.
>
> cheers
> Josh
>
> On Dec 9, 2010, at 3:36 PM, Hadley Wickham wrote:
>
>> ggplot2 + coord_map() already does graticules in a similar manner, as
>> far as I can tell.
>>
>> Hadley
>>
>> On Thu, Dec 9, 2010 at 2:22 PM, Pierre Roudier <pierre.roudier at gmail.com> wrote:
>>> That really is a neat piece of code. Very interested - the result
>>> looks very much like a ggplot2 plot, which I'm a big fan.
>>>
>>> Cheers,
>>>
>>> Pierre
>>>
>>> 2010/12/9 Josh London <josh.london at noaa.gov>:
>>>> Hello
>>>>
>>>> One of the features I often find myself wanting within spplot is the ability to produce graticules (with corresponding axis labels) that represent latitude/longitude lines for projected data. I often find myself searching the R archives and google for examples and methods for accomplishing this, but have always come up empty.
>>>>
>>>> This has been partially possible by using the gridlines() function within sp and then projecting those spatial lines to the desired projection. There are two drawbacks to this solution:
>>>>
>>>> 1) Often the extent of the projected gridlines is smaller than the data of interest so the lines stop short of the plot borders
>>>>
>>>> 2) There is no documented method I've found for producing the axis labels with degree units for each of the gridlines. gridat() is close but only supports unprojected data
>>>>
>>>> So, I ventured forth and pulled together a few functions that attempt to provide a generalized solution in the hopes that a) there's not some existing, obvious, solution my endless searching has overlooked and b) other folks could take advantage of it and maybe expand/improve on it.
>>>>
>>>> I've pulled everything together in a draft package, ProjectedGridlines, and it is available on GitHub (https://github.com/jmlondon/ProjectedGridlines). I've got some basic draft documentation in there for those interested.
>>>>
>>>> I make no claims to the code being elegant or an approach that will work for everyone. The main purpose here was to get something that works and distribute it.
>>>>
>>>> Below, I include the three functions and a reproducible example based on the north carolina dataset included with the maptools package. I've copied over some of the roxygen documentation, but those interested in more details should check the files on GitHub.
>>>>
>>>> Cheers
>>>> Josh
>>>>
>>>> GetGratLines<-function(spobj,proj_str,exp_deg,ndisc=500,...){
>>>> ? ? ? ?spobj at bbox[1,1]<-spobj at bbox[1,1]+exp_deg$l
>>>> ? ? ? ?spobj at bbox[1,2]<-spobj at bbox[1,2]+exp_deg$r
>>>> ? ? ? ?spobj at bbox[2,1]<-spobj at bbox[2,1]+exp_deg$b
>>>> ? ? ? ?spobj at bbox[2,2]<-spobj at bbox[2,2]+exp_deg$t
>>>> ? ? ? ?gl<-spTransform(gridlines(spobj,ndisc=ndisc,...),CRS(proj_str))
>>>> ? ? ? ?return(gl)
>>>> }
>>>>
>>>> #' @param spobj an unrpojected sp object that is the basis of the final projected outcome
>>>> #' @param proj_str a proj4 string specifying the desired projection
>>>> #' @param exp_deg is a named list with values l,r,b,t specifying the amount in decimal
>>>> #' degrees each side (left, right, bottom, top) should be expanded to account for differences
>>>> #' in extent between the projected gridlines and the final projected extent of spobj
>>>> #' @param ... passing of parameters relevant to gridlines()
>>>>
>>>> GetDegreeLabels<-function(spobj){
>>>> ? ? ? ?ewl<-coordinates(gridlines(spobj)["EW"]@lines[[1]])
>>>> ? ? ? ?nsl<-coordinates(gridlines(spobj)["NS"]@lines[[1]])
>>>> ? ? ? ?ewLabels<-lapply(ewl,function(x) {return(x[1,1])})
>>>> ? ? ? ?nsLabels<-lapply(nsl,function(x) {return(x[1,2])})
>>>> ? ? ? ?return(list(EW_Labels=unlist(ewLabels),NS_Labels=unlist(nsLabels)))
>>>> }
>>>>
>>>> #' @param spobj an unrpojected sp object that is the basis of the final projected outcome
>>>>
>>>> GetLabelCoords<-function(gl,offset=list(ew=0,ns=0)){
>>>> ? ? ? ?ewc<-coordinates(gl["EW"]@lines[[1]])
>>>> ? ? ? ?nsc<-coordinates(gl["NS"]@lines[[1]])
>>>> ? ? ? ?ewCoords<-lapply(ewc,function(x) {return(x[1,1])})
>>>> ? ? ? ?nsCoords<-lapply(nsc,function(x) {return(x[1,2])})
>>>> ? ? ? ?ewCoords<-lapply(ewCoords,function(x) {return(x+offset$ew)})
>>>> ? ? ? ?nsCoords<-lapply(nsCoords,function(x) {return(x+offset$ns)})
>>>> ? ? ? ?return(list(EW_Coords=unlist(ewCoords),NS_Coords=unlist(nsCoords)))
>>>> }
>>>>
>>>> #' @param gl the SpatialLines object returned from GetGratLines
>>>> #' @param offset a named list with values ew and ns specifying an offset for all labels on the axis
>>>>
>>>> And an example:
>>>>
>>>> library(sp)
>>>> library(rgdal)
>>>> library(maptools)
>>>> library(RColorBrewer)
>>>>
>>>> #read in the maptools north carolina shapefile, unprojected
>>>> d <- readShapePoly(system.file("shapes/sids.shp", package="maptools")[1], proj4string=CRS("+proj=longlat +datum=NAD27"))
>>>>
>>>> # create a dummy factor variable, with equal labels:
>>>> set.seed(31)
>>>> d$f = factor(sample(1:5,100,replace=T),labels=letters[1:5])
>>>>
>>>> #specify a custom Albers equal centered on the coordinate data
>>>> #this works for points and polygons, but lines need to be converted to points
>>>> med.lat <- round(median(coordinates(d)[,2]))
>>>> med.lon <- round(median(coordinates(d)[,1]))
>>>> lat1<-bbox(d)[2,1]+diff(range(bbox(d)[2,]))/3
>>>> lat2<-bbox(d)[2,2]-diff(range(bbox(d)[2,]))/3
>>>>
>>>> myProj <- paste("+proj=aea +lat_1=",lat1," +lat_2=",lat2," +lat_0=",med.lat,
>>>> ? ? ? ? ? ? ? ?" +lon_0=", med.lon, "+x_0=0 +y_0=0 +ellps=GRS80 +datum=NAD83 +units=m",sep="")
>>>>
>>>> #project the data, the graticule lines. note the gridlines function calls the unprojected data
>>>> d.proj <- spTransform(d,CRS(myProj))
>>>> #grat.lines<-spTransform(gridlines(d,ndisc=500),CRS(myProj))
>>>> g<-GetGratLines(d,myProj,list(t=0.25,b=-0.25,l=-0.25,r=0.25))
>>>> #create the sp.layout component for the graticule lines
>>>> grat.plot<-list("sp.lines",g,lwd="1.5",col="white",first=TRUE)
>>>>
>>>> x_grat_at<-GetLabelCoords(g,offset=list(ew=0))$EW_Coords
>>>>
>>>> y_grat_at<-GetLabelCoords(g,offset=list(ns=0))$NS_Coords
>>>>
>>>> x_grat<-list(draw=TRUE,
>>>> ? ? ? ? ? ? ? ?at=x_grat_at,
>>>> ? ? ? ? ? ? ? ?labels=as.character(GetDegreeLabels(d)$EW_Labels),
>>>> ? ? ? ? ? ? ? ?tck=c(0,0),
>>>> ? ? ? ? ? ? ? ?cex=0.75)
>>>>
>>>> y_grat<-list(draw=TRUE,
>>>> ? ? ? ? ? ? ? ?at=y_grat_at,
>>>> ? ? ? ? ? ? ? ?labels=as.character(GetDegreeLabels(d)$NS_Labels),
>>>> ? ? ? ? ? ? ? ?rot=90,
>>>> ? ? ? ? ? ? ? ?tck=c(0,0),
>>>> ? ? ? ? ? ? ? ?cex=0.75)
>>>>
>>>> spplot(d.proj, c("f"),
>>>> ? ? ? ? ? ? ? ?panel=function(...){
>>>> ? ? ? ? ? ? ? ? ? ? ? ?panel.fill(col="gray90")
>>>> ? ? ? ? ? ? ? ? ? ? ? ?panel.polygonsplot(...)
>>>> ? ? ? ? ? ? ? ?},
>>>> ? ? ? ? ? ? ? ?sp.layout=list(grat.plot),
>>>> ? ? ? ? ? ? ? ?col.regions=brewer.pal(5, "Set3"),scales=list(x=x_grat,y=y_grat))
>>>>
>>>>
>>>>
>>>>
>>>>
>>>> ? ? ? ?[[alternative HTML version deleted]]
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at r-project.org
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>>
>>
>> --
>> Assistant Professor / Dobelman Family Junior Chair
>> Department of Statistics / Rice University
>> http://had.co.nz/
>
>


From pierre.roudier at gmail.com  Mon Dec 13 23:26:52 2010
From: pierre.roudier at gmail.com (Pierre Roudier)
Date: Tue, 14 Dec 2010 11:26:52 +1300
Subject: [R-sig-Geo] Fail to load a vector layer using spgrass6
In-Reply-To: <alpine.LRH.2.00.1012130800030.24826@reclus.nhh.no>
References: <AANLkTiksyumt7bKWXJ5QQbLn+YMgY7Q97HPv1YNAJpvB@mail.gmail.com>
	<alpine.LRH.2.00.1012130800030.24826@reclus.nhh.no>
Message-ID: <AANLkTimbuZBrXE=OphJHVb+ysyLXt6OW1OZaG-OybYOG@mail.gmail.com>

Thank you for your answer Roger,

> Because there are two routes used depending on the setting of the plugin=
> argument, could you look at ogrDrivers() and see if you have an OGR GRASS
> vector driver, and if so, try to set plugin= manually to TRUE and FALSE?

The output of ogrDrivers() shows that I do not have the GRASS driver
(tagged as FALSE).

> Note that GRASS 7.0svn is the development version, snd is very much a moving
> target - do you have to use this version?

No, I do not have to use it, it is plein curiosity/testing of new
features. However I reproduced the problem on the 6.4 version.

> And GDAL 1.7.1 is not the current
> version, which is 1.7.3. Did you install GDAL and/or GRASS from source, or
> from binaries (in my experience, installing from source ensures more
> consistency, and the GDAL/OGR GRASS plugins are often the source of problems
> because of version mismatch).

I installed both GRASS 6.4 and GDAL/OGR from binaries, yes.

> PS. The best list is probably:
>
> http://grass.osgeo.org/statsgrass/index.php

OK. I am sending that message to that list, and keep R-sig-geo for
consistency. Sorry for cross-posting.

Thanks again,

Pierre

>
> Roger
>
>
> as it is more specific, and also seen by GRASS developers.
>
>>
>> I tried to play with the different options but I did not succeed>
>> Here's more info about my data and platform:
>>
>> Here is the output of v.info for the data I want to load:
>> GRASS 7.0.svn (NZTM2000):~ > v.info ph_cl
>>
>> +----------------------------------------------------------------------------+
>> | Name: ? ? ? ? ? ?ph_cl
>> ? |
>> | Mapset: ? ? ? ? ?nitrif_inhib
>> ? ?|
>> | Location: ? ? ? ?NZTM2000
>> ? ?|
>> | Database: ? ? ? ?/home/roudierp/Documents/GRASSDATA
>> ? ?|
>> | Title:
>> ? |
>> | Map scale: ? ? ? 1:1
>> ? |
>> | Map format: ? ? ?native
>> ? ?|
>> | Name of creator: roudierp
>> ? ?|
>> | Organization:
>> ? ?|
>> | Source date: ? ? Mon Dec 13 11:30:11 2010
>> ? ?|
>>
>> |----------------------------------------------------------------------------|
>> | ? Type of map: vector (level: 2)
>> ? |
>> |
>> ? ?|
>> | ? Number of points: ? ? ? 0 ? ? ? ? ? ? ? Number of centroids: ?236847
>> ? |
>> | ? Number of lines: ? ? ? ?0 ? ? ? ? ? ? ? Number of boundaries: 892041
>> ? |
>> | ? Number of areas: ? ? ? ?355021 ? ? ? ? ?Number of islands: ? ?79124
>> ? ?|
>> |
>> ? ?|
>> | ? Map is 3D: ? ? ? ? ? ? ?No
>> ? |
>> | ? Number of dblinks: ? ? ?1
>> ? ?|
>> |
>> ? ?|
>> | ? Projection: Transverse Mercator
>> ? ?|
>> |
>> ? ?|
>> | ? ? ? ? ? ? ? N: ?6190887.80270169 ? ?S: ?4823266.04395524
>> ? |
>> | ? ? ? ? ? ? ? E: ?2091804.65744429 ? ?W: ? 1170289.3071784
>> ? |
>> |
>> ? ?|
>> | ? Digitization threshold: 0
>> ? ?|
>> | ? Comment:
>> ? |
>> |
>> ? ?|
>>
>> +----------------------------------------------------------------------------+
>>
>> And finally some metadata about the software packages I used:
>>
>> here's the sessionInfo():
>>
>>> sessionInfo()
>>
>> R version 2.12.0 (2010-10-15)
>> Platform: x86_64-unknown-linux-gnu (64-bit)
>>
>> locale:
>> [1] LC_CTYPE=en_GB.UTF-8 ? ? ? LC_NUMERIC=C
>> [3] LC_TIME=en_GB.UTF-8 ? ? ? ?LC_COLLATE=en_GB.UTF-8
>> [5] LC_MONETARY=C ? ? ? ? ? ? ?LC_MESSAGES=en_GB.UTF-8
>> [7] LC_PAPER=en_GB.UTF-8 ? ? ? LC_NAME=C
>> [9] LC_ADDRESS=C ? ? ? ? ? ? ? LC_TELEPHONE=C
>> [11] LC_MEASUREMENT=en_GB.UTF-8 LC_IDENTIFICATION=C
>>
>> attached base packages:
>> [1] stats ? ? graphics ?grDevices utils ? ? datasets ?methods ? base
>>
>> other attached packages:
>> [1] spgrass6_0.6-21 XML_3.2-0 ? ? ? rgdal_0.6-31 ? ?sp_0.9-74
>>
>> loaded via a namespace (and not attached):
>> [1] grid_2.12.0 ? ? lattice_0.19-13
>>
>>> library(spgrass6)
>>
>> Loading required package: sp
>> Loading required package: rgdal
>> Geospatial Data Abstraction Library extensions to R successfully loaded
>> Loaded GDAL runtime: GDAL 1.7.1, released 2010/02/08
>> Path to GDAL shared files: /usr/share/gdal
>> Loaded PROJ.4 runtime: Rel. 4.7.1, 23 September 2009
>> Path to PROJ.4 shared files: /usr/share/proj/
>> Loading required package: XML
>> GRASS GIS interface loaded with GRASS version: 7.0.svn
>> and location: NZTM2000
>>
>> I got the last CRAN version of sp.
>>
>> This runs on a linux machine:
>> GRASS 7.0.svn (NZTM2000):~ > uname -a
>> Linux A208_RoudierP 2.6.34.7-0.5-xen #1 SMP 2010-10-25 08:40:12 +0200
>> x86_64 x86_64 x86_64 GNU/Linux
>>
>>
>> Cheers,
>>
>> Pierre
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> --
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>
>


From aruminat at gmail.com  Tue Dec 14 06:11:37 2010
From: aruminat at gmail.com (Susumu Tanimura)
Date: Tue, 14 Dec 2010 14:11:37 +0900
Subject: [R-sig-Geo] SaTScan in R
In-Reply-To: <156428.51956.qm@web36306.mail.mud.yahoo.com>
References: <156428.51956.qm@web36306.mail.mud.yahoo.com>
Message-ID: <20101214141137.df6e478b.aruminat@gmail.com>

You may find R codes for space-time cluster detection in Tango's
"Statistical Methods for Disease Clustering"
(http://www.amazon.com/dp/1441915710/). I do not write here the
downloadable url of these R functions written in the book because I am
not sure it can be disclosed to public. So, what I can advise to you
is that you may read the book.

I hope it can help you.

--
Susumu

On Fri, 3 Dec 2010 00:25:40 -0800 (PST)
Kitty Lee <lee.kitty at yahoo.com> wrote:

> I'm wondering is there a package in R that has similar functions as
> SaTscan? In particular, I'm looking for space-time cluster detection.
> The D-cluster package doesn't appear to have a function for space-time
> detection (please correct me if I'm wrong).
> 
> Any ideas would be highly appreciated!
> 
> 
> K.
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From lists at remoteinformation.com.au  Tue Dec 14 07:10:45 2010
From: lists at remoteinformation.com.au (Ben Madin)
Date: Tue, 14 Dec 2010 17:10:45 +1100
Subject: [R-sig-Geo] SaTScan in R
In-Reply-To: <156428.51956.qm@web36306.mail.mud.yahoo.com>
References: <156428.51956.qm@web36306.mail.mud.yahoo.com>
Message-ID: <B29EF6F4-87D1-4B13-9D92-FC23B2F7580F@remoteinformation.com.au>

Kitty,

You might want to try SpatialEpi (although I think it only has Spatial, not Spatio-Temporal detection)

cheers

Ben


On 03/12/2010, at 7:25 PM, Kitty Lee wrote:

> I'm wondering is there a package in R that has similar functions as SaTscan? In particular, I'm looking for space-time cluster detection. The D-cluster package doesn't appear to have a function for space-time detection (please correct me if I'm wrong).
> 
> Any ideas would be highly appreciated!
> 
> 
> K.
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From Roger.Bivand at nhh.no  Tue Dec 14 10:01:11 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 14 Dec 2010 10:01:11 +0100 (CET)
Subject: [R-sig-Geo] Fail to load a vector layer using spgrass6
In-Reply-To: <AANLkTimbuZBrXE=OphJHVb+ysyLXt6OW1OZaG-OybYOG@mail.gmail.com>
References: <AANLkTiksyumt7bKWXJ5QQbLn+YMgY7Q97HPv1YNAJpvB@mail.gmail.com>
	<alpine.LRH.2.00.1012130800030.24826@reclus.nhh.no>
	<AANLkTimbuZBrXE=OphJHVb+ysyLXt6OW1OZaG-OybYOG@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.1012140938510.29835@reclus.nhh.no>

On Tue, 14 Dec 2010, Pierre Roudier wrote:

> Thank you for your answer Roger,
>
>> Because there are two routes used depending on the setting of the plugin=
>> argument, could you look at ogrDrivers() and see if you have an OGR GRASS
>> vector driver, and if so, try to set plugin= manually to TRUE and FALSE?
>
> The output of ogrDrivers() shows that I do not have the GRASS driver
> (tagged as FALSE).
>
>> Note that GRASS 7.0svn is the development version, snd is very much a moving
>> target - do you have to use this version?
>
> No, I do not have to use it, it is plein curiosity/testing of new
> features. However I reproduced the problem on the 6.4 version.

I suspect that for some reason v.out.ogr is failing, so the file is not 
written. Next, ogrInfo() fails to find it.

The latest (0.6-23) spgrass6 has a fix for a specific problem in the layer 
parameter of v.out.ogr in GRASS7 - I see that you are using the previous 
spgrass6. Could you try updating spgrass6?

If that doesn't work, please move thread only to grass-stats, and try 
using v.out.ogr to export the vector to the GRASS mapset temporary 
directory manually - use g.tempfile to find out what the path to that 
directory is. If v.out.ogr appears to complete without problems, do check 
the temporary directory to be sure.

Roger

>
>> And GDAL 1.7.1 is not the current
>> version, which is 1.7.3. Did you install GDAL and/or GRASS from source, or
>> from binaries (in my experience, installing from source ensures more
>> consistency, and the GDAL/OGR GRASS plugins are often the source of problems
>> because of version mismatch).
>
> I installed both GRASS 6.4 and GDAL/OGR from binaries, yes.
>
>> PS. The best list is probably:
>>
>> http://grass.osgeo.org/statsgrass/index.php
>
> OK. I am sending that message to that list, and keep R-sig-geo for
> consistency. Sorry for cross-posting.
>
> Thanks again,
>
> Pierre
>
>>
>> Roger
>>
>>
>> as it is more specific, and also seen by GRASS developers.
>>
>>>
>>> I tried to play with the different options but I did not succeed>
>>> Here's more info about my data and platform:
>>>
>>> Here is the output of v.info for the data I want to load:
>>> GRASS 7.0.svn (NZTM2000):~ > v.info ph_cl
>>>
>>> +----------------------------------------------------------------------------+
>>> | Name: ? ? ? ? ? ?ph_cl
>>> ? |
>>> | Mapset: ? ? ? ? ?nitrif_inhib
>>> ? ?|
>>> | Location: ? ? ? ?NZTM2000
>>> ? ?|
>>> | Database: ? ? ? ?/home/roudierp/Documents/GRASSDATA
>>> ? ?|
>>> | Title:
>>> ? |
>>> | Map scale: ? ? ? 1:1
>>> ? |
>>> | Map format: ? ? ?native
>>> ? ?|
>>> | Name of creator: roudierp
>>> ? ?|
>>> | Organization:
>>> ? ?|
>>> | Source date: ? ? Mon Dec 13 11:30:11 2010
>>> ? ?|
>>>
>>> |----------------------------------------------------------------------------|
>>> | ? Type of map: vector (level: 2)
>>> ? |
>>> |
>>> ? ?|
>>> | ? Number of points: ? ? ? 0 ? ? ? ? ? ? ? Number of centroids: ?236847
>>> ? |
>>> | ? Number of lines: ? ? ? ?0 ? ? ? ? ? ? ? Number of boundaries: 892041
>>> ? |
>>> | ? Number of areas: ? ? ? ?355021 ? ? ? ? ?Number of islands: ? ?79124
>>> ? ?|
>>> |
>>> ? ?|
>>> | ? Map is 3D: ? ? ? ? ? ? ?No
>>> ? |
>>> | ? Number of dblinks: ? ? ?1
>>> ? ?|
>>> |
>>> ? ?|
>>> | ? Projection: Transverse Mercator
>>> ? ?|
>>> |
>>> ? ?|
>>> | ? ? ? ? ? ? ? N: ?6190887.80270169 ? ?S: ?4823266.04395524
>>> ? |
>>> | ? ? ? ? ? ? ? E: ?2091804.65744429 ? ?W: ? 1170289.3071784
>>> ? |
>>> |
>>> ? ?|
>>> | ? Digitization threshold: 0
>>> ? ?|
>>> | ? Comment:
>>> ? |
>>> |
>>> ? ?|
>>>
>>> +----------------------------------------------------------------------------+
>>>
>>> And finally some metadata about the software packages I used:
>>>
>>> here's the sessionInfo():
>>>
>>>> sessionInfo()
>>>
>>> R version 2.12.0 (2010-10-15)
>>> Platform: x86_64-unknown-linux-gnu (64-bit)
>>>
>>> locale:
>>> [1] LC_CTYPE=en_GB.UTF-8 ? ? ? LC_NUMERIC=C
>>> [3] LC_TIME=en_GB.UTF-8 ? ? ? ?LC_COLLATE=en_GB.UTF-8
>>> [5] LC_MONETARY=C ? ? ? ? ? ? ?LC_MESSAGES=en_GB.UTF-8
>>> [7] LC_PAPER=en_GB.UTF-8 ? ? ? LC_NAME=C
>>> [9] LC_ADDRESS=C ? ? ? ? ? ? ? LC_TELEPHONE=C
>>> [11] LC_MEASUREMENT=en_GB.UTF-8 LC_IDENTIFICATION=C
>>>
>>> attached base packages:
>>> [1] stats ? ? graphics ?grDevices utils ? ? datasets ?methods ? base
>>>
>>> other attached packages:
>>> [1] spgrass6_0.6-21 XML_3.2-0 ? ? ? rgdal_0.6-31 ? ?sp_0.9-74
>>>
>>> loaded via a namespace (and not attached):
>>> [1] grid_2.12.0 ? ? lattice_0.19-13
>>>
>>>> library(spgrass6)
>>>
>>> Loading required package: sp
>>> Loading required package: rgdal
>>> Geospatial Data Abstraction Library extensions to R successfully loaded
>>> Loaded GDAL runtime: GDAL 1.7.1, released 2010/02/08
>>> Path to GDAL shared files: /usr/share/gdal
>>> Loaded PROJ.4 runtime: Rel. 4.7.1, 23 September 2009
>>> Path to PROJ.4 shared files: /usr/share/proj/
>>> Loading required package: XML
>>> GRASS GIS interface loaded with GRASS version: 7.0.svn
>>> and location: NZTM2000
>>>
>>> I got the last CRAN version of sp.
>>>
>>> This runs on a linux machine:
>>> GRASS 7.0.svn (NZTM2000):~ > uname -a
>>> Linux A208_RoudierP 2.6.34.7-0.5-xen #1 SMP 2010-10-25 08:40:12 +0200
>>> x86_64 x86_64 x86_64 GNU/Linux
>>>
>>>
>>> Cheers,
>>>
>>> Pierre
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>> --
>> Roger Bivand
>> Economic Geography Section, Department of Economics, Norwegian School of
>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>> e-mail: Roger.Bivand at nhh.no
>>
>>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From Adrian.Baddeley at csiro.au  Tue Dec 14 10:31:40 2010
From: Adrian.Baddeley at csiro.au (Adrian Baddeley)
Date: Tue, 14 Dec 2010 17:31:40 +0800
Subject: [R-sig-Geo] SaTScan / cluster detection
Message-ID: <4D07397C.9020204@csiro.au>

Kitty Lee<lee.kitty at yahoo.com>  wrote:

> I'm wondering is there a package in R that has similar functions as SaTscan? In particular, I'm looking for space-time cluster detection.
Scan statistics for spatial (and space-time) point pattern data are currently under development in 'spatstat'. The code should be released early in the New Year.

regards
Adrian Baddeley


From p.hiemstra at geo.uu.nl  Tue Dec 14 10:29:36 2010
From: p.hiemstra at geo.uu.nl (Paul Hiemstra)
Date: Tue, 14 Dec 2010 10:29:36 +0100
Subject: [R-sig-Geo] Spatial interpolation possibilities
In-Reply-To: <AANLkTi=DM-WQO7yFK+mkai2sZ2mvKFkwGSKTxUBq-06r@mail.gmail.com>
References: <AANLkTi=DM-WQO7yFK+mkai2sZ2mvKFkwGSKTxUBq-06r@mail.gmail.com>
Message-ID: <4D073900.20102@geo.uu.nl>

On 12/03/2010 03:38 PM, Arnaud Mosnier wrote:
> Dear GeoUseRs,
>
> > From the large number of methods that can be used to spatially interpolate
> data, we tried several of them (Inverse Distance Weighted, Natural
> Neighbour, Spline, Kriging, Co-Kriging) on our dataset. We used ArcGIS to
> apply the first three and R for kriging and test possibilities of
> co-kriging.
>
>   We do not have external independent data to test results of interpolations.
> The solution is probably to do a kind of cross-validation but doing it into
> ArcGIS seems difficult to implement.
> I know that I can do Inverse distance weighted interpolation in R but ...
>
> - Is it possible to do Natural Neighbour and Spline interpolation in R ? And
> if yes how ?
>    
Hi Arnaud,

Spline is possible, look at the Tps function from the fields package. 
I'm not sure on Natural Neighbor, but voronoi tessalations are available 
in R.
> ArcGIS tools propose to consider "barriers" when using Inverse Distance
> Weighted and Spline tools. Thus, for example, interpolation occurring North
> from an island do not consider information located South of this island ...
> a quite important thing in our case.
>
> - I wondering if it is possible to do the same with gstat or another package
> ?
>    
You could split up the dataset in two regions and interpolate them 
seperately.

Finally, if you want to cross-validate, look at the compare.cv function 
from the automap package. It provides statistics and some spatial plots 
of the cross-validation residuals which I found very useful (I wrote 
them myself ;)). When cross-validating non-gstat interpolations you need 
to make sure that the output of the cross-validation is compatible (i.e. 
a SpatialPointsDataFrame with a few specific attributes). I have an 
example of how to do this with Tps, which can serve as inspiration. If 
you are interested I can send the code off list.

Paul
> Thanks for your help !
>
> Arnaud
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>    


-- 
Paul Hiemstra, MSc
Department of Physical Geography
Faculty of Geosciences
University of Utrecht
Heidelberglaan 2
P.O. Box 80.115
3508 TC Utrecht
Phone:  +3130 253 5773
http://intamap.geo.uu.nl/~paul
http://nl.linkedin.com/pub/paul-hiemstra/20/30b/770

currently @ KNMI
paul.hiemstra_AT_knmi.nl


From piero.campa at gmail.com  Tue Dec 14 10:42:40 2010
From: piero.campa at gmail.com (piero campa)
Date: Tue, 14 Dec 2010 01:42:40 -0800 (PST)
Subject: [R-sig-Geo] nugget in variogram
In-Reply-To: <4CA9A487.3060604@uni-muenster.de>
References: <SNT127-W33D24FEFADC71E914CE391CE680@phx.gbl>
	<4CA4BD3A.1030304@uni-muenster.de>
	<SNT127-W42799CCFF61A2FD5709C0FCE6C0@phx.gbl>
	<4CA9A487.3060604@uni-muenster.de>
Message-ID: <1292319760643-5833937.post@n2.nabble.com>


Hi,
I am trying to fit my first variograms.
I'm however noticing some weird behaviour I cannot explain.
I'm a 100% newbie.

- without setting a nugget element (so that it should be implicitly 0, isn't
it? In fact the resulting variogram has 0 nugget), the psill and range of
the fitted variogram don't change on different psill inputs.
- If I explicitly set a nugget to 0, then actually the nugget is no more 0,
but higher.
- I tried also setting the fit.sills booleans to TRUE or FALSE to see what
would change, but the output does not really care about it.

Does someone have any hint about this?

Thank you.
Regards,
Piero 
-- 
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/nugget-in-variogram-tp5587929p5833937.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From p.hiemstra at geo.uu.nl  Tue Dec 14 10:48:45 2010
From: p.hiemstra at geo.uu.nl (Paul Hiemstra)
Date: Tue, 14 Dec 2010 10:48:45 +0100
Subject: [R-sig-Geo] Cross-validating across spatial interpolation packages
Message-ID: <4D073D7D.2030900@geo.uu.nl>

Dear list,

In a project I'm currently working I compare a number of interpolation 
methods for interpolation of evaporation. In addition to the methods 
available in gstat/automap (krige, idw) I use a number of non-gstat 
interpolation methods. To perform cross-validation I wanted to be able 
to use all methods (gstat and non-gstat) and end with the 
cross-validation result in the same format. This is particularly useful 
in combination with the compare.cv() function in automap, which provides 
summary cross-validation statistics and a spatial plot of the 
cross-validation residuals. The following example illustrates how I 
solved this for the Tps function from the fields pacakge and Nearest 
neighbor interpolation (idw with nmax == 1). First a few function 
definitions (plus Roxygen documentation) and then an example with the 
meuse dataset:

#' Provides a krige (gstat) like interface to Tps (fields)
#'
#' @param formula A formula to define the dependent and the independent 
variables, see the documentation of krige.
#' @param data The input data, should be a spatial object which supports 
coordinates extracting through coordinates()
#' @param newdata A spatial object with the prediction locations.
#' @param ... parameters that are passed on to Tps
#' @return The function returns a spatial object with the same class as 
\code{newdata} with the prediction and the variance (NA in this case). 
The names of the columns match the outcome of the krige function.
#' @author Paul Hiemstra, \email{p.h.hiemstra at gmail.com}
#' @export
#' @examples
#' data(meuse)
#' coordinates(meuse) = ~x+y
#' data(meuse.grid)
#' gridded(meuse.grid) = ~x+y
#'
#' meuse_tps = doTps(zinc~dist, meuse, meuse.grid)
#' meuse_tps = doTps(zinc~1, meuse, meuse.grid)
#'
doTps = function(formula, data, newdata, ..., debug.level = 1) {
   require(fields, quietly = TRUE)
   if(debug.level > 0) cat("[using thin plate splines (from fields)]\n")
   f = as.character(formula)
   dependent = f[2]
   independent = f[3] ## Meerdere covariates zou moeten kunnen
   if(independent == "1") {
     fit = Tps(x = coordinates(data), Y = data[[dependent]], ...)
     newdata$var1.pred = as.numeric(predict(fit, coordinates(newdata)))
     newdata$var1.var = NA
   } else {
     fit = Tps(x = coordinates(data), Y = data[[dependent]], Z = 
data[[independent]], ...)
     newdata$var1.pred = as.numeric(predict(fit, coordinates(newdata), Z 
= newdata[[independent]]))
     newdata$var1.var = NA
   }
   newdata$var1.stdev = sqrt(newdata$var1.var)
   return(newdata[c("var1.pred", "var1.var")])
}

#' Performs nearest neighbor interpolation
#'
#' @param formula A formula to define the dependent and the independent 
variables, see the documentation of krige.
#'                Note that nearest neighbor does not support 
independent variables. Therefor, the formula should always
#'                have the form dependent~1.
#' @param data The input data, should be a spatial object which supports 
coordinates extracting through coordinates()
#' @param newdata A spatial object with the prediction locations.
#' @param ... parameters that are passed on to Tps
#' @note This functions uses idw with 'nmax' set to 1 to perform nearest 
neighbor interpolation.
#' @return The function returns a spatial object with the same class as 
\code{newdata} with the prediction and the
#'          variance (NA in this case). The names of the columns match 
the outcome of the krige function.
#' @author Paul Hiemstra, \email{p.h.hiemstra at gmail.com}
#' @export
#' @examples
#' data(meuse)
#' coordinates(meuse) = ~x+y
#' data(meuse.grid)
#' gridded(meuse.grid) = ~x+y
#'
#' meuse_nn = doNearestNeighbor(zinc~1, meuse, meuse.grid)
#'
doNearestNeighbor = function(formula, data, newdata, debug.level = 1) {
   require(gstat, quietly = TRUE)
   if(debug.level > 0) cat("[using nearest neighbor]\n")
   f = as.character(formula)
   dependent = f[2]
   independent = f[3] ## Meerdere covariates zou moeten kunnen
   if(independent != "1") stop("Nearest neighbor does not support 
independent variables, please formula to 'dependent~1'.")
   newdata = idw(formula, data, newdata, nmax = 1, debug.level = 0)
   newdata$var1.stdev = sqrt(newdata$var1.var)
   return(newdata)
}

# Creates an empty crossvalidation result object from 'obj'
createCvObjFromSpatialObj = function(obj) {
   cv_obj = obj
   cv_obj$observed = NA
   cv_obj$var1.pred = NA
   cv_obj$var1.var = NA
   cv_obj$residual = NA
   cv_obj$zscore = NA
   return(cv_obj[c("var1.pred","var1.var","observed", "residual", 
"zscore")])
}

#' This function performs crossvalidation in the style of krige.cv
#'
#' In addition to supporting kriging and idw, it also supports
#' thin plate splines (through Tps (fields)).
#'
#' @param formula A formula to define the dependent and the independent 
variables, see the documentation of krige.
#' @param data The input data, should be a spatial object which supports 
coordinates extracting through coordinates()
#' @param func The function which should be used for cross-validation, 
possibilities are "krige", "idw", "doNearestNeighbor"
#'              and "doTps".
#' @param ... parameters that are passed on to 'func'
#' @return The function returns a spatial object with the class of 
'data'. The format
#'         in which the cross-validation results are presented is equal 
to that of krige.cv.
#' @note At this stage only leave-one-out cross-validation is supported. 
In addition, the formula supports only a limit
#'       syntax, i.e. log(zinc) or sqrt(dist) are not possible in the 
formula. Instead, create a new column in the object,
#'       e.g. meuse$log_zinc = log(meuse$zinc).
#' @author Paul Hiemstra, \email{p.h.hiemstra at gmail.com}
#' @export
#' @examples
#' data(meuse)
#' coordinates(meuse) = ~x+y
#' data(meuse.grid)
#' gridded(meuse.grid) = ~x+y
#'
#' regres_cv = crossvalidate(zinc~dist, meuse, func = "krige", 
debug.level = 0)
#' nearestneighbor_cv = crossvalidate(zinc~1, meuse, func = 
"doNearestNeighbor")
#' idw2_cv = crossvalidate(zinc~1, meuse, func = "idw", debug.level = 0)
#' idw4_cv = crossvalidate(zinc~1, meuse, func = "idw", debug.level = 0, 
idp = 4)
#' idw05_cv = crossvalidate(zinc~1, meuse, func = "idw", debug.level = 
0, idp = 0.5)
#' ked_cv = crossvalidate(zinc~dist, meuse, func = "krige",
#'         model = autofitVariogram(zinc~dist, meuse, model = 
"Ste")$var_model, debug.level = 0)
#' tps_cv = crossvalidate(zinc~1, meuse, func = "doTps", debug.level = 0)
#' tpsdist_cv = crossvalidate(zinc~dist, meuse, func = "doTps", 
debug.level = 0)
#'
#' compare.cv(regres_cv, idw2_cv, idw4_cv, idw05_cv, tps_cv, tpsdist_cv, 
ked_cv)
#'
#' # Use log(zinc) as dependent variable
#'
#' meuse$log_zinc = log(meuse$zinc)
#' kedlog_cv = crossvalidate(log_zinc~dist, meuse, func = "krige",
#'         model = autofitVariogram(zinc~dist, meuse, model = 
"Ste")$var_model, debug.level = 0)
#'
#'# Test if crossvalidate matches krige.cv
#' dum = krige.cv(zinc~dist, meuse, model = m)
#' all.equal(bla$residual, ked_cv$residual)
#'
crossvalidate = function(formula, data, func = "doTps", ...) {
   pb = txtProgressBar(1, nrow(data), 1, style = 3)
   dependent = as.character(formula)[2]
   cv_obj = createCvObjFromSpatialObj(data)
   for(i in 1:nrow(data)) {
     setTxtProgressBar(pb, i)
     newdata = data[i,]
     cv_data = data[-i,]
     cv_pred = do.call(func, list(formula, cv_data, newdata, ...))
     cv_obj at data[i,"var1.pred"] <- cv_pred$var1.pred
     cv_obj at data[i,"var1.var"] <- cv_pred$var1.var
     cv_obj at data[i,"observed"] <- data[i,][[dependent]]
   }
   cv_obj$residual = cv_obj$observed - cv_obj$var1.pred
   cat("\n")
   return(cv_obj)
}

# Example code
library(automap)
library(fields)
data(meuse)
coordinates(meuse) = ~x+y
data(meuse.grid)
gridded(meuse.grid) = ~x+y

regres_cv = crossvalidate(zinc~dist, meuse, func = "krige", debug.level = 0)
nearestneighbor_cv = crossvalidate(zinc~1, meuse, func = 
"doNearestNeighbor", debug.level = 0)
idw2_cv = crossvalidate(zinc~1, meuse, func = "idw", debug.level = 0)
idw4_cv = crossvalidate(zinc~1, meuse, func = "idw", debug.level = 0, 
idp = 4)
idw05_cv = crossvalidate(zinc~1, meuse, func = "idw", debug.level = 0, 
idp = 0.5)
ked_cv = crossvalidate(zinc~dist, meuse, func = "krige",
         model = autofitVariogram(zinc~dist, meuse, model = 
"Ste")$var_model, debug.level = 0)
tps_cv = crossvalidate(zinc~1, meuse, func = "doTps", debug.level = 0)

compare.cv(regres_cv, idw2_cv, idw4_cv, idw05_cv, tps_cv, ked_cv)

Would it be worthwile to the R-sig-geo community to expand this code 
into a crossvalidate package? This package could provide an easy means 
of crossvalidating across the different interpolation packages. People 
could write interface functions such as I did for the Tps function.

So, what do you guys think?

cheers,
Paul

-- 
Paul Hiemstra, MSc
Department of Physical Geography
Faculty of Geosciences
University of Utrecht
Heidelberglaan 2
P.O. Box 80.115
3508 TC Utrecht
Phone:  +3130 253 5773
http://intamap.geo.uu.nl/~paul
http://nl.linkedin.com/pub/paul-hiemstra/20/30b/770

currently @ KNMI
paul.hiemstra_AT_knmi.nl


From wmconnol at ncsu.edu  Tue Dec 14 11:32:44 2010
From: wmconnol at ncsu.edu (Mark Connolly)
Date: Tue, 14 Dec 2010 05:32:44 -0500
Subject: [R-sig-Geo] Cross-validating across spatial interpolation
	packages
In-Reply-To: <4D073D7D.2030900@geo.uu.nl>
References: <4D073D7D.2030900@geo.uu.nl>
Message-ID: <4D0747CC.1080107@ncsu.edu>

I would find it useful.

On 12/14/2010 04:48 AM, Paul Hiemstra wrote:
> Dear list,
>
> In a project I'm currently working I compare a number of interpolation 
> methods for interpolation of evaporation. In addition to the methods 
> available in gstat/automap (krige, idw) I use a number of non-gstat 
> interpolation methods. To perform cross-validation I wanted to be able 
> to use all methods (gstat and non-gstat) and end with the 
> cross-validation result in the same format. This is particularly 
> useful in combination with the compare.cv() function in automap, which 
> provides summary cross-validation statistics and a spatial plot of the 
> cross-validation residuals. The following example illustrates how I 
> solved this for the Tps function from the fields pacakge and Nearest 
> neighbor interpolation (idw with nmax == 1). First a few function 
> definitions (plus Roxygen documentation) and then an example with the 
> meuse dataset:
>
> #' Provides a krige (gstat) like interface to Tps (fields)
> #'
> #' @param formula A formula to define the dependent and the 
> independent variables, see the documentation of krige.
> #' @param data The input data, should be a spatial object which 
> supports coordinates extracting through coordinates()
> #' @param newdata A spatial object with the prediction locations.
> #' @param ... parameters that are passed on to Tps
> #' @return The function returns a spatial object with the same class 
> as \code{newdata} with the prediction and the variance (NA in this 
> case). The names of the columns match the outcome of the krige function.
> #' @author Paul Hiemstra, \email{p.h.hiemstra at gmail.com}
> #' @export
> #' @examples
> #' data(meuse)
> #' coordinates(meuse) = ~x+y
> #' data(meuse.grid)
> #' gridded(meuse.grid) = ~x+y
> #'
> #' meuse_tps = doTps(zinc~dist, meuse, meuse.grid)
> #' meuse_tps = doTps(zinc~1, meuse, meuse.grid)
> #'
> doTps = function(formula, data, newdata, ..., debug.level = 1) {
>   require(fields, quietly = TRUE)
>   if(debug.level > 0) cat("[using thin plate splines (from fields)]\n")
>   f = as.character(formula)
>   dependent = f[2]
>   independent = f[3] ## Meerdere covariates zou moeten kunnen
>   if(independent == "1") {
>     fit = Tps(x = coordinates(data), Y = data[[dependent]], ...)
>     newdata$var1.pred = as.numeric(predict(fit, coordinates(newdata)))
>     newdata$var1.var = NA
>   } else {
>     fit = Tps(x = coordinates(data), Y = data[[dependent]], Z = 
> data[[independent]], ...)
>     newdata$var1.pred = as.numeric(predict(fit, coordinates(newdata), 
> Z = newdata[[independent]]))
>     newdata$var1.var = NA
>   }
>   newdata$var1.stdev = sqrt(newdata$var1.var)
>   return(newdata[c("var1.pred", "var1.var")])
> }
>
> #' Performs nearest neighbor interpolation
> #'
> #' @param formula A formula to define the dependent and the 
> independent variables, see the documentation of krige.
> #'                Note that nearest neighbor does not support 
> independent variables. Therefor, the formula should always
> #'                have the form dependent~1.
> #' @param data The input data, should be a spatial object which 
> supports coordinates extracting through coordinates()
> #' @param newdata A spatial object with the prediction locations.
> #' @param ... parameters that are passed on to Tps
> #' @note This functions uses idw with 'nmax' set to 1 to perform 
> nearest neighbor interpolation.
> #' @return The function returns a spatial object with the same class 
> as \code{newdata} with the prediction and the
> #'          variance (NA in this case). The names of the columns match 
> the outcome of the krige function.
> #' @author Paul Hiemstra, \email{p.h.hiemstra at gmail.com}
> #' @export
> #' @examples
> #' data(meuse)
> #' coordinates(meuse) = ~x+y
> #' data(meuse.grid)
> #' gridded(meuse.grid) = ~x+y
> #'
> #' meuse_nn = doNearestNeighbor(zinc~1, meuse, meuse.grid)
> #'
> doNearestNeighbor = function(formula, data, newdata, debug.level = 1) {
>   require(gstat, quietly = TRUE)
>   if(debug.level > 0) cat("[using nearest neighbor]\n")
>   f = as.character(formula)
>   dependent = f[2]
>   independent = f[3] ## Meerdere covariates zou moeten kunnen
>   if(independent != "1") stop("Nearest neighbor does not support 
> independent variables, please formula to 'dependent~1'.")
>   newdata = idw(formula, data, newdata, nmax = 1, debug.level = 0)
>   newdata$var1.stdev = sqrt(newdata$var1.var)
>   return(newdata)
> }
>
> # Creates an empty crossvalidation result object from 'obj'
> createCvObjFromSpatialObj = function(obj) {
>   cv_obj = obj
>   cv_obj$observed = NA
>   cv_obj$var1.pred = NA
>   cv_obj$var1.var = NA
>   cv_obj$residual = NA
>   cv_obj$zscore = NA
>   return(cv_obj[c("var1.pred","var1.var","observed", "residual", 
> "zscore")])
> }
>
> #' This function performs crossvalidation in the style of krige.cv
> #'
> #' In addition to supporting kriging and idw, it also supports
> #' thin plate splines (through Tps (fields)).
> #'
> #' @param formula A formula to define the dependent and the 
> independent variables, see the documentation of krige.
> #' @param data The input data, should be a spatial object which 
> supports coordinates extracting through coordinates()
> #' @param func The function which should be used for cross-validation, 
> possibilities are "krige", "idw", "doNearestNeighbor"
> #'              and "doTps".
> #' @param ... parameters that are passed on to 'func'
> #' @return The function returns a spatial object with the class of 
> 'data'. The format
> #'         in which the cross-validation results are presented is 
> equal to that of krige.cv.
> #' @note At this stage only leave-one-out cross-validation is 
> supported. In addition, the formula supports only a limit
> #'       syntax, i.e. log(zinc) or sqrt(dist) are not possible in the 
> formula. Instead, create a new column in the object,
> #'       e.g. meuse$log_zinc = log(meuse$zinc).
> #' @author Paul Hiemstra, \email{p.h.hiemstra at gmail.com}
> #' @export
> #' @examples
> #' data(meuse)
> #' coordinates(meuse) = ~x+y
> #' data(meuse.grid)
> #' gridded(meuse.grid) = ~x+y
> #'
> #' regres_cv = crossvalidate(zinc~dist, meuse, func = "krige", 
> debug.level = 0)
> #' nearestneighbor_cv = crossvalidate(zinc~1, meuse, func = 
> "doNearestNeighbor")
> #' idw2_cv = crossvalidate(zinc~1, meuse, func = "idw", debug.level = 0)
> #' idw4_cv = crossvalidate(zinc~1, meuse, func = "idw", debug.level = 
> 0, idp = 4)
> #' idw05_cv = crossvalidate(zinc~1, meuse, func = "idw", debug.level = 
> 0, idp = 0.5)
> #' ked_cv = crossvalidate(zinc~dist, meuse, func = "krige",
> #'         model = autofitVariogram(zinc~dist, meuse, model = 
> "Ste")$var_model, debug.level = 0)
> #' tps_cv = crossvalidate(zinc~1, meuse, func = "doTps", debug.level = 0)
> #' tpsdist_cv = crossvalidate(zinc~dist, meuse, func = "doTps", 
> debug.level = 0)
> #'
> #' compare.cv(regres_cv, idw2_cv, idw4_cv, idw05_cv, tps_cv, 
> tpsdist_cv, ked_cv)
> #'
> #' # Use log(zinc) as dependent variable
> #'
> #' meuse$log_zinc = log(meuse$zinc)
> #' kedlog_cv = crossvalidate(log_zinc~dist, meuse, func = "krige",
> #'         model = autofitVariogram(zinc~dist, meuse, model = 
> "Ste")$var_model, debug.level = 0)
> #'
> #'# Test if crossvalidate matches krige.cv
> #' dum = krige.cv(zinc~dist, meuse, model = m)
> #' all.equal(bla$residual, ked_cv$residual)
> #'
> crossvalidate = function(formula, data, func = "doTps", ...) {
>   pb = txtProgressBar(1, nrow(data), 1, style = 3)
>   dependent = as.character(formula)[2]
>   cv_obj = createCvObjFromSpatialObj(data)
>   for(i in 1:nrow(data)) {
>     setTxtProgressBar(pb, i)
>     newdata = data[i,]
>     cv_data = data[-i,]
>     cv_pred = do.call(func, list(formula, cv_data, newdata, ...))
>     cv_obj at data[i,"var1.pred"] <- cv_pred$var1.pred
>     cv_obj at data[i,"var1.var"] <- cv_pred$var1.var
>     cv_obj at data[i,"observed"] <- data[i,][[dependent]]
>   }
>   cv_obj$residual = cv_obj$observed - cv_obj$var1.pred
>   cat("\n")
>   return(cv_obj)
> }
>
> # Example code
> library(automap)
> library(fields)
> data(meuse)
> coordinates(meuse) = ~x+y
> data(meuse.grid)
> gridded(meuse.grid) = ~x+y
>
> regres_cv = crossvalidate(zinc~dist, meuse, func = "krige", 
> debug.level = 0)
> nearestneighbor_cv = crossvalidate(zinc~1, meuse, func = 
> "doNearestNeighbor", debug.level = 0)
> idw2_cv = crossvalidate(zinc~1, meuse, func = "idw", debug.level = 0)
> idw4_cv = crossvalidate(zinc~1, meuse, func = "idw", debug.level = 0, 
> idp = 4)
> idw05_cv = crossvalidate(zinc~1, meuse, func = "idw", debug.level = 0, 
> idp = 0.5)
> ked_cv = crossvalidate(zinc~dist, meuse, func = "krige",
>         model = autofitVariogram(zinc~dist, meuse, model = 
> "Ste")$var_model, debug.level = 0)
> tps_cv = crossvalidate(zinc~1, meuse, func = "doTps", debug.level = 0)
>
> compare.cv(regres_cv, idw2_cv, idw4_cv, idw05_cv, tps_cv, ked_cv)
>
> Would it be worthwile to the R-sig-geo community to expand this code 
> into a crossvalidate package? This package could provide an easy means 
> of crossvalidating across the different interpolation packages. People 
> could write interface functions such as I did for the Tps function.
>
> So, what do you guys think?
>
> cheers,
> Paul
>


From tom.gottfried at wzw.tum.de  Tue Dec 14 12:38:31 2010
From: tom.gottfried at wzw.tum.de (Tom Gottfried)
Date: Tue, 14 Dec 2010 12:38:31 +0100
Subject: [R-sig-Geo] Weight in krigeage
Message-ID: <4D075737.70305@wzw.tum.de>

Hi Manu,

calling krige with debug.level=32 might be what you want. See ?predict.gstat.

Tom
-- 
Technische Universit?t M?nchen
Department f?r Pflanzenwissenschaften
Lehrstuhl f?r Gr?nlandlehre
Alte Akademie 12
85350 Freising / Germany
Phone: ++49 (0)8161 715324
Fax:   ++49 (0)8161 713243
email: tom.gottfried at wzw.tum.de
http://www.wzw.tum.de/gruenland


From edzer.pebesma at uni-muenster.de  Tue Dec 14 13:20:33 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Tue, 14 Dec 2010 13:20:33 +0100
Subject: [R-sig-Geo] Weight in krigeage
In-Reply-To: <4D075737.70305@wzw.tum.de>
References: <4D075737.70305@wzw.tum.de>
Message-ID: <4D076111.5050104@uni-muenster.de>

Alternatively,

library(gstat)
demo(weight)

Highly inefficient, but might do the job.

On 12/14/2010 12:38 PM, Tom Gottfried wrote:
> Hi Manu,
> 
> calling krige with debug.level=32 might be what you want. See
> ?predict.gstat.
> 
> Tom

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From edzer.pebesma at uni-muenster.de  Tue Dec 14 13:26:58 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Tue, 14 Dec 2010 13:26:58 +0100
Subject: [R-sig-Geo] Cross-validating across spatial
	interpolation	packages
In-Reply-To: <4D0747CC.1080107@ncsu.edu>
References: <4D073D7D.2030900@geo.uu.nl> <4D0747CC.1080107@ncsu.edu>
Message-ID: <4D076292.2030903@uni-muenster.de>

Sounds useful indeed. I remember having used package ipred to repeat a
classification problem through a wide range of classifiers, all using
the same interface. Might be worth looking at.

Bests,

On 12/14/2010 11:32 AM, Mark Connolly wrote:
> I would find it useful.
> 
> On 12/14/2010 04:48 AM, Paul Hiemstra wrote:
>> Dear list,
>>
>> In a project I'm currently working I compare a number of interpolation
>> methods for interpolation of evaporation. In addition to the methods
>> available in gstat/automap (krige, idw) I use a number of non-gstat
>> interpolation methods. To perform cross-validation I wanted to be able
>> to use all methods (gstat and non-gstat) and end with the
>> cross-validation result in the same format. This is particularly
>> useful in combination with the compare.cv() function in automap, which
>> provides summary cross-validation statistics and a spatial plot of the
>> cross-validation residuals. The following example illustrates how I
>> solved this for the Tps function from the fields pacakge and Nearest
>> neighbor interpolation (idw with nmax == 1). First a few function
>> definitions (plus Roxygen documentation) and then an example with the
>> meuse dataset:
>>
>> #' Provides a krige (gstat) like interface to Tps (fields)
>> #'
>> #' @param formula A formula to define the dependent and the
>> independent variables, see the documentation of krige.
>> #' @param data The input data, should be a spatial object which
>> supports coordinates extracting through coordinates()
>> #' @param newdata A spatial object with the prediction locations.
>> #' @param ... parameters that are passed on to Tps
>> #' @return The function returns a spatial object with the same class
>> as \code{newdata} with the prediction and the variance (NA in this
>> case). The names of the columns match the outcome of the krige function.
>> #' @author Paul Hiemstra, \email{p.h.hiemstra at gmail.com}
>> #' @export
>> #' @examples
>> #' data(meuse)
>> #' coordinates(meuse) = ~x+y
>> #' data(meuse.grid)
>> #' gridded(meuse.grid) = ~x+y
>> #'
>> #' meuse_tps = doTps(zinc~dist, meuse, meuse.grid)
>> #' meuse_tps = doTps(zinc~1, meuse, meuse.grid)
>> #'
>> doTps = function(formula, data, newdata, ..., debug.level = 1) {
>>   require(fields, quietly = TRUE)
>>   if(debug.level > 0) cat("[using thin plate splines (from fields)]\n")
>>   f = as.character(formula)
>>   dependent = f[2]
>>   independent = f[3] ## Meerdere covariates zou moeten kunnen
>>   if(independent == "1") {
>>     fit = Tps(x = coordinates(data), Y = data[[dependent]], ...)
>>     newdata$var1.pred = as.numeric(predict(fit, coordinates(newdata)))
>>     newdata$var1.var = NA
>>   } else {
>>     fit = Tps(x = coordinates(data), Y = data[[dependent]], Z =
>> data[[independent]], ...)
>>     newdata$var1.pred = as.numeric(predict(fit, coordinates(newdata),
>> Z = newdata[[independent]]))
>>     newdata$var1.var = NA
>>   }
>>   newdata$var1.stdev = sqrt(newdata$var1.var)
>>   return(newdata[c("var1.pred", "var1.var")])
>> }
>>
>> #' Performs nearest neighbor interpolation
>> #'
>> #' @param formula A formula to define the dependent and the
>> independent variables, see the documentation of krige.
>> #'                Note that nearest neighbor does not support
>> independent variables. Therefor, the formula should always
>> #'                have the form dependent~1.
>> #' @param data The input data, should be a spatial object which
>> supports coordinates extracting through coordinates()
>> #' @param newdata A spatial object with the prediction locations.
>> #' @param ... parameters that are passed on to Tps
>> #' @note This functions uses idw with 'nmax' set to 1 to perform
>> nearest neighbor interpolation.
>> #' @return The function returns a spatial object with the same class
>> as \code{newdata} with the prediction and the
>> #'          variance (NA in this case). The names of the columns match
>> the outcome of the krige function.
>> #' @author Paul Hiemstra, \email{p.h.hiemstra at gmail.com}
>> #' @export
>> #' @examples
>> #' data(meuse)
>> #' coordinates(meuse) = ~x+y
>> #' data(meuse.grid)
>> #' gridded(meuse.grid) = ~x+y
>> #'
>> #' meuse_nn = doNearestNeighbor(zinc~1, meuse, meuse.grid)
>> #'
>> doNearestNeighbor = function(formula, data, newdata, debug.level = 1) {
>>   require(gstat, quietly = TRUE)
>>   if(debug.level > 0) cat("[using nearest neighbor]\n")
>>   f = as.character(formula)
>>   dependent = f[2]
>>   independent = f[3] ## Meerdere covariates zou moeten kunnen
>>   if(independent != "1") stop("Nearest neighbor does not support
>> independent variables, please formula to 'dependent~1'.")
>>   newdata = idw(formula, data, newdata, nmax = 1, debug.level = 0)
>>   newdata$var1.stdev = sqrt(newdata$var1.var)
>>   return(newdata)
>> }
>>
>> # Creates an empty crossvalidation result object from 'obj'
>> createCvObjFromSpatialObj = function(obj) {
>>   cv_obj = obj
>>   cv_obj$observed = NA
>>   cv_obj$var1.pred = NA
>>   cv_obj$var1.var = NA
>>   cv_obj$residual = NA
>>   cv_obj$zscore = NA
>>   return(cv_obj[c("var1.pred","var1.var","observed", "residual",
>> "zscore")])
>> }
>>
>> #' This function performs crossvalidation in the style of krige.cv
>> #'
>> #' In addition to supporting kriging and idw, it also supports
>> #' thin plate splines (through Tps (fields)).
>> #'
>> #' @param formula A formula to define the dependent and the
>> independent variables, see the documentation of krige.
>> #' @param data The input data, should be a spatial object which
>> supports coordinates extracting through coordinates()
>> #' @param func The function which should be used for cross-validation,
>> possibilities are "krige", "idw", "doNearestNeighbor"
>> #'              and "doTps".
>> #' @param ... parameters that are passed on to 'func'
>> #' @return The function returns a spatial object with the class of
>> 'data'. The format
>> #'         in which the cross-validation results are presented is
>> equal to that of krige.cv.
>> #' @note At this stage only leave-one-out cross-validation is
>> supported. In addition, the formula supports only a limit
>> #'       syntax, i.e. log(zinc) or sqrt(dist) are not possible in the
>> formula. Instead, create a new column in the object,
>> #'       e.g. meuse$log_zinc = log(meuse$zinc).
>> #' @author Paul Hiemstra, \email{p.h.hiemstra at gmail.com}
>> #' @export
>> #' @examples
>> #' data(meuse)
>> #' coordinates(meuse) = ~x+y
>> #' data(meuse.grid)
>> #' gridded(meuse.grid) = ~x+y
>> #'
>> #' regres_cv = crossvalidate(zinc~dist, meuse, func = "krige",
>> debug.level = 0)
>> #' nearestneighbor_cv = crossvalidate(zinc~1, meuse, func =
>> "doNearestNeighbor")
>> #' idw2_cv = crossvalidate(zinc~1, meuse, func = "idw", debug.level = 0)
>> #' idw4_cv = crossvalidate(zinc~1, meuse, func = "idw", debug.level =
>> 0, idp = 4)
>> #' idw05_cv = crossvalidate(zinc~1, meuse, func = "idw", debug.level =
>> 0, idp = 0.5)
>> #' ked_cv = crossvalidate(zinc~dist, meuse, func = "krige",
>> #'         model = autofitVariogram(zinc~dist, meuse, model =
>> "Ste")$var_model, debug.level = 0)
>> #' tps_cv = crossvalidate(zinc~1, meuse, func = "doTps", debug.level = 0)
>> #' tpsdist_cv = crossvalidate(zinc~dist, meuse, func = "doTps",
>> debug.level = 0)
>> #'
>> #' compare.cv(regres_cv, idw2_cv, idw4_cv, idw05_cv, tps_cv,
>> tpsdist_cv, ked_cv)
>> #'
>> #' # Use log(zinc) as dependent variable
>> #'
>> #' meuse$log_zinc = log(meuse$zinc)
>> #' kedlog_cv = crossvalidate(log_zinc~dist, meuse, func = "krige",
>> #'         model = autofitVariogram(zinc~dist, meuse, model =
>> "Ste")$var_model, debug.level = 0)
>> #'
>> #'# Test if crossvalidate matches krige.cv
>> #' dum = krige.cv(zinc~dist, meuse, model = m)
>> #' all.equal(bla$residual, ked_cv$residual)
>> #'
>> crossvalidate = function(formula, data, func = "doTps", ...) {
>>   pb = txtProgressBar(1, nrow(data), 1, style = 3)
>>   dependent = as.character(formula)[2]
>>   cv_obj = createCvObjFromSpatialObj(data)
>>   for(i in 1:nrow(data)) {
>>     setTxtProgressBar(pb, i)
>>     newdata = data[i,]
>>     cv_data = data[-i,]
>>     cv_pred = do.call(func, list(formula, cv_data, newdata, ...))
>>     cv_obj at data[i,"var1.pred"] <- cv_pred$var1.pred
>>     cv_obj at data[i,"var1.var"] <- cv_pred$var1.var
>>     cv_obj at data[i,"observed"] <- data[i,][[dependent]]
>>   }
>>   cv_obj$residual = cv_obj$observed - cv_obj$var1.pred
>>   cat("\n")
>>   return(cv_obj)
>> }
>>
>> # Example code
>> library(automap)
>> library(fields)
>> data(meuse)
>> coordinates(meuse) = ~x+y
>> data(meuse.grid)
>> gridded(meuse.grid) = ~x+y
>>
>> regres_cv = crossvalidate(zinc~dist, meuse, func = "krige",
>> debug.level = 0)
>> nearestneighbor_cv = crossvalidate(zinc~1, meuse, func =
>> "doNearestNeighbor", debug.level = 0)
>> idw2_cv = crossvalidate(zinc~1, meuse, func = "idw", debug.level = 0)
>> idw4_cv = crossvalidate(zinc~1, meuse, func = "idw", debug.level = 0,
>> idp = 4)
>> idw05_cv = crossvalidate(zinc~1, meuse, func = "idw", debug.level = 0,
>> idp = 0.5)
>> ked_cv = crossvalidate(zinc~dist, meuse, func = "krige",
>>         model = autofitVariogram(zinc~dist, meuse, model =
>> "Ste")$var_model, debug.level = 0)
>> tps_cv = crossvalidate(zinc~1, meuse, func = "doTps", debug.level = 0)
>>
>> compare.cv(regres_cv, idw2_cv, idw4_cv, idw05_cv, tps_cv, ked_cv)
>>
>> Would it be worthwile to the R-sig-geo community to expand this code
>> into a crossvalidate package? This package could provide an easy means
>> of crossvalidating across the different interpolation packages. People
>> could write interface functions such as I did for the Tps function.
>>
>> So, what do you guys think?
>>
>> cheers,
>> Paul
>>
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From Michael.Hoehle at stat.uni-muenchen.de  Tue Dec 14 13:27:37 2010
From: Michael.Hoehle at stat.uni-muenchen.de (=?ISO-8859-15?Q?Michael_H=F6hle?=)
Date: Tue, 14 Dec 2010 13:27:37 +0100
Subject: [R-sig-Geo] SaTScan in R
Message-ID: <4D0762B9.5030205@stat.uni-muenchen.de>

> I'm wondering is there a package in R that has similar functions as SaTscan? In particular, I'm looking for space-time cluster detection. The D-cluster package doesn't appear to have a function for space-time detection (please correct me if I'm wrong).
> 

As already mentioned by Barry Rowlingson the R package "surveillance" contains some functionality 
to perform space-time outbreak detection.

The appropriate method depends a bit on your data structure: if you have point referenced data then the 
function stcd by Assuncao & Correa could apply (see lit ref in the package). There is no specific SatScan functionality for area data,
but you might add some cluster detection on the algo.hhh function for multivariate time series of counts
or follow the approach by Raubertas (1989, Stats in Med, 8(3), 267-271) by monitoring several CUSUM aggregations
of spatial units using, e.g., function algo.glrnb/glrnb

As presented on the IBC2010 last week, we are also working on some further ideas on doing model based spatio-temporal cluster detection,
but unfortunately there is no schedule on how/when something like this is going to appear in the package.

As an aside: Should anyone have some available R code for such spatio-temporal cluster detection I'd be 
happy to integrate it in the surveillance package as I think there is definitely some need for open-source code
on this matter. Maybe this issue would be fun to discuss at the spacetime workshop in March...
I'll certainly be looking forward to the newest spatstat developments.

Best regards,

Michael


From Roger.Bivand at nhh.no  Tue Dec 14 13:48:51 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 14 Dec 2010 13:48:51 +0100 (CET)
Subject: [R-sig-Geo] suggestion for spgrass6 - temp file in readVECT6
In-Reply-To: <alpine.LRH.2.00.1012101120540.6560@reclus.nhh.no>
References: <AANLkTimqaOuLM46-N6=aYjKA6NotAt8hXjSK2hj2P3HX@mail.gmail.com>
	<201012091331.45055.dylan.beaudette@gmail.com>
	<alpine.LRH.2.00.1012101120540.6560@reclus.nhh.no>
Message-ID: <alpine.LRH.2.00.1012141345490.30157@reclus.nhh.no>

On Fri, 10 Dec 2010, Roger Bivand wrote:

> On Thu, 9 Dec 2010, Dylan Beaudette wrote:
>
>> On Thursday, December 09, 2010, Pierre Roudier wrote:
>>> Dear all,
>>> 
>>> I got a suggestion for spgrass6. As far as I understand it, a
>>> temporary ESRI shapefile is written on the disk when using
>>> readVECT6('foo'), I guess then R is using rgdal to read that shapefile
>>> back in memory. Considering the various limitations of the ESRI
>>> shapefile format that does not occur with the GRASS internal format,
>>> could it be possible to add an option to choose the OGR format used in
>>> that process?
>>> 
>>> Also got a question for Roger I guess: I'm using now the grass7 svn
>>> trunk, should I expect any problems using the spgrass6 interface (I
>>> mean problems due to structural differences that appears in grass7
>>> that would not be handled by spgrass6, not problems due to grass7
>>> itself).
>>> 
>>> Thanks,
>>> 
>>> Pierre
>>> 
>> 
>> This is an excellent point Pierre, and something that has caused 
>> significant pain the past-- in terms of column names and NULL value 
>> handling. Not everyone's GDAL/OGR will be configured in the same way-- so I 
>> don't know if altering the default behavior would be wise. However, adding 
>> an option (as you suggested) to use some other format, such as SQLite, 
>> would give power users a nice alternative to SHP format. SQLite would allow 
>> for longer field names, proper support for NULL data, and probably some 
>> other 'good things'.
>
> SQLite is an extra OGR driver that will be dependent on the OGR being used on 
> the platform in question. The OGR used by GRASS may be the same as that used 
> by rgdal, but may not be (R binary rgdal packages for Windows and OSX, which 
> have minimal driver sets).
>
> I'll attempt to add a driver= argument to readVECT6() and writeVECT6(), and 
> drivername= readRAST6() and writeRAST6() for the temporary files.

Could either of you, or others who may be interested, please try the draft 
version by anonymous checkout fot the spgrass6 module from the sourceforge 
r-spatial project, or using the source package at:

http://spatial.nhh.no/R/Devel/spgrass6_0.6-24.tar.gz

If you report back that it suits your needs, I'll submit it to CRAN; if 
you need further changes, please let me know.

Roger

>
> Typically, for reading native GRASS data, users build GRASS plugins for 
> OGR/GDAL. readVECT6() and readRAST6() both by default check for the presence 
> of the plugin, and use it if present, avoiding any intermediate files being 
> created.
>
> The recently released revision of spgrass6 (0.6-23) does work with GRASS > 
> 6.3, including GRASS 7. This is signalled by the use of "GRASS 6+" rather 
> than just "GRASS 6" in its title and short description.
>
> Hope this helps,
>
> Roger
>
>> 
>> Dylan
>> 
>> 
>> 
>> 
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From Roger.Bivand at nhh.no  Tue Dec 14 13:51:39 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 14 Dec 2010 13:51:39 +0100 (CET)
Subject: [R-sig-Geo] Fwd: Suggestion: option overwrite=T for writeOGR()
In-Reply-To: <alpine.LRH.2.00.1012131356110.26497@reclus.nhh.no>
References: <AANLkTi=D5_u6K67jCtwSafxOpNZ34rJHfSCnGQSSLpOs@mail.gmail.com>
	<AANLkTi=YfZOgvP_75+skqZvTxmZ_bVMZfXN7SMfCsQRb@mail.gmail.com>
	<alpine.LRH.2.00.1012101320330.6560@reclus.nhh.no>
	<AANLkTinMcoacpjRgSEair0ph+tYqTWk8jFFiBgFxgMT5@mail.gmail.com>
	<alpine.LRH.2.00.1012101516480.9170@reclus.nhh.no>
	<AANLkTinbhGxeRbCK1DJvE8yQQTSozBTUY-C=WFjpmfry@mail.gmail.com>
	<alpine.LRH.2.00.1012101831190.9628@reclus.nhh.no>
	<AANLkTikLWczW0AWneragJz2NFyM_fgtqifa6Hk++1hAE@mail.gmail.com>
	<alpine.LRH.2.00.1012111828090.13472@reclus.nhh.no>
	<AANLkTinhg4-U5PRXreJNuY=6v7dHP9dga223-Whr8Smq@mail.gmail.com>
	<AANLkTinTRV86eyU_oM=eW6wF_iaYB2o9Sh8t3dRH1QFv@mail.gmail.com>
	<alpine.LRH.2.00.1012131356110.26497@reclus.nhh.no>
Message-ID: <alpine.LRH.2.00.1012141349290.30157@reclus.nhh.no>

On Mon, 13 Dec 2010, Roger Bivand wrote:

> On Mon, 13 Dec 2010, Agustin Lobo wrote:
>
>> ---------- Forwarded message ----------
>> From: Agustin Lobo <alobolistas at gmail.com>
>> Date: 2010/12/13
>> Subject: Re: [R-sig-Geo] Suggestion: option overwrite=T for writeOGR()
>> To: Roger.Bivand at nhh.no
>> 
>> 
>> Roger,
>> 
>> According to Synaptic, my gdal is 1.7.3,
>> I do not understand where the reported
>> GDAL runtime: GDAL 1.8dev
>> comes from. Could it have been installed by rgdal?
>
> rgdal package binaries from CRAN for Windows are built static against GDAL, 
> so include GDAL but not as a shared object. For OSX on CRAN extras, I'm not 
> sure whether the binary rgdal package is built static or not, but GDAL is 
> included.
>
> You are on Linux, so you provide GDAL yourself. If it declares on query 
> (asking the shared object what version it is, which is what rgdal does on 
> startup) that it is 1.8.0dev, then that is what it is. Be aware that 
> downstream packagers may also mistake the version numbers, so asking the 
> shared object is authoritative (unless the releasers of the original source 
> enter the wrong string, as with the current PROJ.4, which declares that it is 
> an as yet unreleased version, these things happen).
>
> Either revert properly to GDAL 1.7.*, or wait for me to fix this for 1.8.*, 
> please. I'll post in this thread when I'm ready, and then you can check the 
> rgdal source from R-Forge, OK?

Could you, or others who may be interested, please try the draft version 
by anonymous checkout from the R-forge rgdal project, or using the source 
package at:

http://spatial.nhh.no/R/Devel/rgdal_0.6-32.tar.gz

If you report back that it suits your needs, I'll submit it to CRAN; if 
you need further changes, please let me know.

Roger


>
> Roger
>
>> 
>> I've searched my disk and find gdal16 and gdal17 but not gdal18
>> Do you know if it is possible to tell rgdal which gdal should be used?
>> 
>> Thanks
>> 
>> Agus
>> 
>> 
>> 
>> 2010/12/11 Roger Bivand <Roger.Bivand at nhh.no>:
>>> On Fri, 10 Dec 2010, Agustin Lobo wrote:
>>> 
>>>> Roger,
>>>> 
>>>> I was not aware that 1.8dev is actually older than 1.7.2 I'll check why I
>>>> have that gdal on the other machine and will try to fix that on my side 
>>>> on
>>>> Monday. But perhaps this problem will come up again for future stable
>>>> versions of 1.8.* ? Anyway, 1.8dev is clearly not a good choice and I 
>>>> have
>>>> to change it.
>>> 
>>> As of GDAL 1.8.0 SVN revision 21234, the problem exists. I'll fix this in
>>> rgdal for the drivers I am familiar with before 1.8.0 is released.
>>> 
>>> Roger
>>> 
>>>> 
>>>> Thanks
>>>> 
>>>> Agus
>>>> 
>>>> 2010/12/10 Roger Bivand <Roger.Bivand at nhh.no>:
>>>>> 
>>>>> On Fri, 10 Dec 2010, Agustin Lobo wrote:
>>>>> 
>>>>>> Roger,
>>>>>> 
>>>>>> is this all you need? I thought sessionInfo was providing everything
>>>>>> needed.
>>>>> 
>>>>> You had given sessionInfo() but that does not report which GDAL you are
>>>>> using. The report unfortunately does not give an svn revision, maybe
>>>>> gdal-config --version does? I develop using 1.7.* GDAL. Your 1.8dev is
>>>>> pretty old, certainly older that released 1.7.3. I can try to build a
>>>>> current GDAL trunk from source next week, if I get time, but this looks
>>>>> like
>>>>> something in your setup (development GDAL that is now stale?).
>>>>> 
>>>>>> The driver is "ESRI Shapefile" as stated in the command, have not 
>>>>>> tested
>>>>>> any other (it does work for raster though, as you mention):
>>>>> 
>>>>> I mentioned four variants of vector drivers, not raster.
>>>>> 
>>>>> Roger
>>>>> 
>>>>>> 
>>>>>>> require(rgdal)
>>>>>> 
>>>>>> Loading required package: rgdal
>>>>>> Geospatial Data Abstraction Library extensions to R successfully loaded
>>>>>> Loaded GDAL runtime: GDAL 1.8dev, released 2010/01/19
>>>>>> Path to GDAL shared files: /usr/local/share/gdal
>>>>>> Loaded PROJ.4 runtime: Rel. 4.7.1, 23 September 2009
>>>>>> Path to PROJ.4 shared files: (autodetected)
>>>>>> 
>>>>>> Thanks
>>>>>> 
>>>>>> Agus
>>>>>> 
>>>>>> 2010/12/10 Roger Bivand <Roger.Bivand at nhh.no>:
>>>>>>> 
>>>>>>> On Fri, 10 Dec 2010, Agustin Lobo wrote:
>>>>>>> 
>>>>>>>> Roger,
>>>>>>>> 
>>>>>>>> It does not for me. The error is solved by deleting files xygcatLO.* 
>>>>>>>> ,
>>>>>>>> while directory xygcatLO may continue to exist.
>>>>>>> 
>>>>>>> Agus,
>>>>>>> 
>>>>>>> With which drivers, OGR version (in header when rgdal loads)? If I
>>>>>>> cannot
>>>>>>> reproduce this, I cannot readily help.
>>>>>>> 
>>>>>>> Roger
>>>>>>> 
>>>>>>>> 
>>>>>>>> Also, I've found that with this version the below command does not
>>>>>>>> save the files within
>>>>>>>> the folder indicated by dsn, but outside. This was not the case in 
>>>>>>>> the
>>>>>>>> past, but do not know if this is
>>>>>>>> because of a change in rgdal, gdal or ubuntu 10.04 (I've changed all 
>>>>>>>> 3
>>>>>>>> since the last time I used writeOGR()).
>>>>>>>> 
>>>>>>>>> writeOGR(xygcatLO,dsn="xygcatLO",layer="xygcatLO", driver="ESRI
>>>>>>>>> Shapefile")
>>>>>>>> 
>>>>>>>> Error in writeOGR(xygcatLO, dsn = "xygcatLO", layer = "xygcatLO",
>>>>>>>> driver = "ESRI Shapefile") :
>>>>>>>> 
>>>>>>>> ? ? ? ?GDAL Error 1: Layer 'xygcatLO' already exists
>>>>>>>> Calls: writeOGR -> .Call
>>>>>>>> 
>>>>>>>>> sessionInfo()
>>>>>>>> 
>>>>>>>> R version 2.12.0 (2010-10-15)
>>>>>>>> Platform: x86_64-pc-linux-gnu (64-bit)
>>>>>>>> 
>>>>>>>> locale:
>>>>>>>> [1] LC_CTYPE=en_US.utf8 ? ? ? ? ?LC_NUMERIC=C
>>>>>>>> [3] LC_TIME=en_US.utf8 ? ? ? ? ? LC_COLLATE=en_US.utf8
>>>>>>>> [5] LC_MONETARY=en_US.utf8 ? ? ? LC_MESSAGES=en_US.utf8
>>>>>>>> [7] LC_PAPER=en_US.utf8 ? ? ? ? ?LC_NAME=en_US.utf8
>>>>>>>> [9] LC_ADDRESS=en_US.utf8 ? ? ? ?LC_TELEPHONE=en_US.utf8
>>>>>>>> [11] LC_MEASUREMENT=en_US.utf8 ? ?LC_IDENTIFICATION=en_US.utf8
>>>>>>>> 
>>>>>>>> attached base packages:
>>>>>>>> [1] stats ? ? graphics ?grDevices utils ? ? datasets ?methods ? base
>>>>>>>> 
>>>>>>>> other attached packages:
>>>>>>>> [1] RANN_2.1.2 ? ? ?outliers_0.13-3 rgdal_0.6-30 ? ?raster_1.7-2
>>>>>>>> [5] sp_0.9-73 ? ? ? rkward_0.5.4
>>>>>>>> 
>>>>>>>> loaded via a namespace (and not attached):
>>>>>>>> [1] grid_2.12.0 ? ? lattice_0.19-13 tools_2.12.0
>>>>>>>> 2010/12/10 Roger Bivand <Roger.Bivand at nhh.no>:
>>>>>>>>> 
>>>>>>>>> On Thu, 9 Dec 2010, Barry Rowlingson wrote:
>>>>>>>>> 
>>>>>>>>>> On Thu, Dec 9, 2010 at 8:56 AM, Agustin Lobo 
>>>>>>>>>> <alobolistas at gmail.com>
>>>>>>>>>> wrote:
>>>>>>>>>>> 
>>>>>>>>>>> Hi!
>>>>>>>>>>> 
>>>>>>>>>>> Could an option overwrite=T (default overwrite=F) be included in
>>>>>>>>>>> writeOGR()?
>>>>>>>>>>> Thanks!
>>>>>>>>>> 
>>>>>>>>>> Submit a Feature Request here:
>>>>>>>>>> 
>>>>>>>>>> http://sourceforge.net/tracker/?group_id=84716&atid=573625
>>>>>>>>> 
>>>>>>>>> No, rgdal is on R-Forge, and a list called rgdal-devel will be
>>>>>>>>> available
>>>>>>>>> from tomorrow.
>>>>>>>>> 
>>>>>>>>>> 
>>>>>>>>>> It looks like it just needs to be a wrapper around OGR's delete
>>>>>>>>>> layer
>>>>>>>>>> function.
>>>>>>>>> 
>>>>>>>>> Contributions welcome. Note that the facility is present for 
>>>>>>>>> rasters,
>>>>>>>>> which
>>>>>>>>> I fould out by accidentally deleting GRASS database objects (for
>>>>>>>>> which
>>>>>>>>> of
>>>>>>>>> course I did not have backups). Is this really needed - which 
>>>>>>>>> drivers
>>>>>>>>> do
>>>>>>>>> not
>>>>>>>>> already overwrite without complaint? These do not complain for me:
>>>>>>>>> driver="ESRI Shapefile"; driver="KML"; driver="MapInfo File";
>>>>>>>>> driver="MapInfo File", dataset_options="FORMAT=MIF".
>>>>>>>>> 
>>>>>>>>> Hope this helps,
>>>>>>>>> 
>>>>>>>>> Roger
>>>>>>>>> 
>>>>>>>>>> 
>>>>>>>>>> Barry
>>>>>>>>>> 
>>>>>>>>>> _______________________________________________
>>>>>>>>>> R-sig-Geo mailing list
>>>>>>>>>> R-sig-Geo at r-project.org
>>>>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>>>>>> 
>>>>>>>>> 
>>>>>>>>> --
>>>>>>>>> Roger Bivand
>>>>>>>>> Economic Geography Section, Department of Economics, Norwegian 
>>>>>>>>> School
>>>>>>>>> of
>>>>>>>>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>>>>>>>>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>>>>>>>>> e-mail: Roger.Bivand at nhh.no
>>>>>>>>> 
>>>>>>>>> _______________________________________________
>>>>>>>>> R-sig-Geo mailing list
>>>>>>>>> R-sig-Geo at r-project.org
>>>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>>>>> 
>>>>>>>> 
>>>>>>> 
>>>>>>> --
>>>>>>> Roger Bivand
>>>>>>> Economic Geography Section, Department of Economics, Norwegian School
>>>>>>> of
>>>>>>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>>>>>>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>>>>>>> e-mail: Roger.Bivand at nhh.no
>>>>>>> 
>>>>>>> _______________________________________________
>>>>>>> R-sig-Geo mailing list
>>>>>>> R-sig-Geo at r-project.org
>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>>> 
>>>>>> 
>>>>> 
>>>>> --
>>>>> Roger Bivand
>>>>> Economic Geography Section, Department of Economics, Norwegian School of
>>>>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>>>>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>>>>> e-mail: Roger.Bivand at nhh.no
>>>>> 
>>>>> _______________________________________________
>>>>> R-sig-Geo mailing list
>>>>> R-sig-Geo at r-project.org
>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>> 
>>>>> 
>>>> 
>>> 
>>> --
>>> Roger Bivand
>>> Economic Geography Section, Department of Economics, Norwegian School of
>>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>>> e-mail: Roger.Bivand at nhh.no
>>> 
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>> 
>>> 
>> 
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> 
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From kmcoulib at gmail.com  Tue Dec 14 14:42:29 2010
From: kmcoulib at gmail.com (kapo coulibaly)
Date: Tue, 14 Dec 2010 08:42:29 -0500
Subject: [R-sig-Geo] nugget in variogram
In-Reply-To: <1292319760643-5833937.post@n2.nabble.com>
References: <SNT127-W33D24FEFADC71E914CE391CE680@phx.gbl>
	<4CA4BD3A.1030304@uni-muenster.de>
	<SNT127-W42799CCFF61A2FD5709C0FCE6C0@phx.gbl>
	<4CA9A487.3060604@uni-muenster.de>
	<1292319760643-5833937.post@n2.nabble.com>
Message-ID: <AANLkTikLeKyyn0_UT537j+cTFgzmS6FPa=gNMpbKLk9d@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101214/3e3197f1/attachment.pl>

From a.mosnier at gmail.com  Tue Dec 14 15:55:17 2010
From: a.mosnier at gmail.com (Arnaud Mosnier)
Date: Tue, 14 Dec 2010 09:55:17 -0500
Subject: [R-sig-Geo] Cross-Validation package
Message-ID: <AANLkTimLuTXZ1uYbFy1orQLLh81ujcnsEZE_sP6ec5SB@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101214/cc777578/attachment.pl>

From piero.campa at gmail.com  Tue Dec 14 18:09:25 2010
From: piero.campa at gmail.com (Piero Campalani)
Date: Tue, 14 Dec 2010 18:09:25 +0100
Subject: [R-sig-Geo] nugget in variogram
In-Reply-To: <AANLkTikLeKyyn0_UT537j+cTFgzmS6FPa=gNMpbKLk9d@mail.gmail.com>
References: <SNT127-W33D24FEFADC71E914CE391CE680@phx.gbl>
	<4CA4BD3A.1030304@uni-muenster.de>
	<SNT127-W42799CCFF61A2FD5709C0FCE6C0@phx.gbl>
	<4CA9A487.3060604@uni-muenster.de>
	<1292319760643-5833937.post@n2.nabble.com>
	<AANLkTikLeKyyn0_UT537j+cTFgzmS6FPa=gNMpbKLk9d@mail.gmail.com>
Message-ID: <AANLkTimH8W72Q75wGwVrZ36Mu3K09e+SAM7rgVoSK92w@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101214/c37b775b/attachment.pl>

From kmcoulib at gmail.com  Tue Dec 14 19:24:12 2010
From: kmcoulib at gmail.com (kapo coulibaly)
Date: Tue, 14 Dec 2010 13:24:12 -0500
Subject: [R-sig-Geo] Selective Kriging error
Message-ID: <AANLkTim0Z6mLjeoUfT+Y8dsou+RVd2wJyMr0co6GRXRB@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101214/eec457db/attachment.pl>

From kmcoulib at gmail.com  Tue Dec 14 19:31:38 2010
From: kmcoulib at gmail.com (kapo coulibaly)
Date: Tue, 14 Dec 2010 13:31:38 -0500
Subject: [R-sig-Geo] nugget in variogram
In-Reply-To: <AANLkTimH8W72Q75wGwVrZ36Mu3K09e+SAM7rgVoSK92w@mail.gmail.com>
References: <SNT127-W33D24FEFADC71E914CE391CE680@phx.gbl>
	<4CA4BD3A.1030304@uni-muenster.de>
	<SNT127-W42799CCFF61A2FD5709C0FCE6C0@phx.gbl>
	<4CA9A487.3060604@uni-muenster.de>
	<1292319760643-5833937.post@n2.nabble.com>
	<AANLkTikLeKyyn0_UT537j+cTFgzmS6FPa=gNMpbKLk9d@mail.gmail.com>
	<AANLkTimH8W72Q75wGwVrZ36Mu3K09e+SAM7rgVoSK92w@mail.gmail.com>
Message-ID: <AANLkTin2L8LrPQtyiBZ1BD4NFVAXVrhVBVkukBywg3K6@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101214/150ac093/attachment.pl>

From massimodisasha at gmail.com  Tue Dec 14 21:34:24 2010
From: massimodisasha at gmail.com (Massimo Di Stefano)
Date: Tue, 14 Dec 2010 15:34:24 -0500
Subject: [R-sig-Geo] help with Ordinary Kriging with R (singular matrix
	error)
Message-ID: <1292358864.10902.19.camel@stereo1>

Hello All,

I'm tring to perfotm an ordinary Kriging interpolation on aset of data.
It's my 'first real attempt' with R and Kriging, so please apologize my
mistake ... i'm slowly tring to learn it.

The dataset i'm working on is a shp file, for convenience (to better
follow the notes i find on [1] ) i converted it to sc.csv (attached
there [2]).


I tried using the following code in R :




"""
library(gstat)
d <- read.csv('sc.csv')
e <- na.omit(d)
coordinates(e) <- ~ x+y
bubble(e, zcol='scallop_co', fill=FALSE, do.sqrt=FALSE, maxsize=2)
x.range <- as.integer(range(e at coords[,1]))
y.range <- as.integer(range(e at coords[,2]))
grd <- expand.grid(x=seq(from=x.range[1], to=x.range[2], by=500),
y=seq(from=y.range[1], to=y.range[2], by=500) )
coordinates(grd) <- ~ x+y
gridded(grd) <- TRUE
plot(grd, cex=0.5)
points(e, pch=1, col='red', cex=0.7)
title("Interpolation Grid and Sample Points")

g <- gstat(id="elev", formula=scallop_co ~ 1, data=e)
plot(variogram(g, map=TRUE, cutoff=4000, width=200), threshold=10)
v <- variogram(g, alpha=c(0,45,90,135))
v.fit <- fit.variogram(v, model=vgm(model='Lin' , anis=c(0, 0.5)))
plot(v, model=v.fit, as.table=TRUE)
g <- gstat(g, id="scallop_co", model=v.fit )

## perform ordinary kriging prediction:
p <- predict(g, model=v.fit, newdata=grd)
"""

It gived me the error :

> p <- predict(g, model=v.fit, newdata=grd)
[using ordinary kriging]

"chfactor.c", line 130: singular matrix in function LDLfactor()
Error in predict.gstat(g, model = v.fit, newdata = grd) : LDLfactor


it is probably that i have to change some parameters in the previouse
code, i'm tring to learn but i've not yet any clue on how to fix it.


i tried to add more value in when i create the directional variogram :

"""
v <- variogram(g, alpha=c(0,10,20,30,40,45,50,60,70,80,90,100,110,135))

"""
the results is attached at [3]
 
my sessionInfo is :

"""
> sessionInfo()
R version 2.12.0 (2010-10-15)
Platform: x86_64-pc-linux-gnu (64-bit)

locale:
 [1] LC_CTYPE=en_US.utf8       LC_NUMERIC=C             
 [3] LC_TIME=en_US.utf8        LC_COLLATE=en_US.utf8    
 [5] LC_MONETARY=C             LC_MESSAGES=en_US.utf8   
 [7] LC_PAPER=en_US.utf8       LC_NAME=C                
 [9] LC_ADDRESS=C              LC_TELEPHONE=C           
[11] LC_MEASUREMENT=en_US.utf8 LC_IDENTIFICATION=C      

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods
base     

other attached packages:
[1] gstat_0.9-74 sp_0.9-74   

loaded via a namespace (and not attached):
[1] grid_2.12.0     lattice_0.19-13
> 
"""

thankyou a lot for any help!

thanks,

Massimo.



[1] http://casoilresource.lawr.ucdavis.edu/drupal/node/442
[2] http://www.geofemengineering.it/data/sc.csv
[3] http://www.geofemengineering.it/data/sc_variogram.png


From pierre.roudier at gmail.com  Tue Dec 14 22:50:40 2010
From: pierre.roudier at gmail.com (Pierre Roudier)
Date: Wed, 15 Dec 2010 10:50:40 +1300
Subject: [R-sig-Geo] suggestion for spgrass6 - temp file in readVECT6
In-Reply-To: <alpine.LRH.2.00.1012141345490.30157@reclus.nhh.no>
References: <AANLkTimqaOuLM46-N6=aYjKA6NotAt8hXjSK2hj2P3HX@mail.gmail.com>
	<201012091331.45055.dylan.beaudette@gmail.com>
	<alpine.LRH.2.00.1012101120540.6560@reclus.nhh.no>
	<alpine.LRH.2.00.1012141345490.30157@reclus.nhh.no>
Message-ID: <AANLkTim6KYosbO6egQ3JL1=jjt0-sq67QLtpx1dK4LYm@mail.gmail.com>

Hi Roger,

Thanks for the patch. Unfortunately it does not work on my box, but I
suspect that to be related with my readVECT6() problem.

foo <- readVECT6('bar', driver='GML')
Error in ogrInfo(dsn = dsn, layer = layer, input_field_name_encoding =
input_field_name_encoding) :
  Cannot open layer

writeVECT6(foo, 'deletethis', driver='GML')
Available OGR Drivers:
Error in writeOGR(SDF, dsn = rtmpfl1, layer = shname, driver = driver) :

        GDAL Error 4: Failed to create GML file
/home/roudierp/Documents/GRASSDATA/NZMG/bh/.tmp/A208_RoudierP.

So I guess I'd better fix that problem first>

Sorry I can't provide better testing for now,

Cheers,

Pierre

2010/12/15 Roger Bivand <Roger.Bivand at nhh.no>:
> On Fri, 10 Dec 2010, Roger Bivand wrote:
>
>> On Thu, 9 Dec 2010, Dylan Beaudette wrote:
>>
>>> On Thursday, December 09, 2010, Pierre Roudier wrote:
>>>>
>>>> Dear all,
>>>>
>>>> I got a suggestion for spgrass6. As far as I understand it, a
>>>> temporary ESRI shapefile is written on the disk when using
>>>> readVECT6('foo'), I guess then R is using rgdal to read that shapefile
>>>> back in memory. Considering the various limitations of the ESRI
>>>> shapefile format that does not occur with the GRASS internal format,
>>>> could it be possible to add an option to choose the OGR format used in
>>>> that process?
>>>>
>>>> Also got a question for Roger I guess: I'm using now the grass7 svn
>>>> trunk, should I expect any problems using the spgrass6 interface (I
>>>> mean problems due to structural differences that appears in grass7
>>>> that would not be handled by spgrass6, not problems due to grass7
>>>> itself).
>>>>
>>>> Thanks,
>>>>
>>>> Pierre
>>>>
>>>
>>> This is an excellent point Pierre, and something that has caused
>>> significant pain the past-- in terms of column names and NULL value
>>> handling. Not everyone's GDAL/OGR will be configured in the same way-- so I
>>> don't know if altering the default behavior would be wise. However, adding
>>> an option (as you suggested) to use some other format, such as SQLite, would
>>> give power users a nice alternative to SHP format. SQLite would allow for
>>> longer field names, proper support for NULL data, and probably some other
>>> 'good things'.
>>
>> SQLite is an extra OGR driver that will be dependent on the OGR being used
>> on the platform in question. The OGR used by GRASS may be the same as that
>> used by rgdal, but may not be (R binary rgdal packages for Windows and OSX,
>> which have minimal driver sets).
>>
>> I'll attempt to add a driver= argument to readVECT6() and writeVECT6(),
>> and drivername= readRAST6() and writeRAST6() for the temporary files.
>
> Could either of you, or others who may be interested, please try the draft
> version by anonymous checkout fot the spgrass6 module from the sourceforge
> r-spatial project, or using the source package at:
>
> http://spatial.nhh.no/R/Devel/spgrass6_0.6-24.tar.gz
>
> If you report back that it suits your needs, I'll submit it to CRAN; if you
> need further changes, please let me know.
>
> Roger
>
>>
>> Typically, for reading native GRASS data, users build GRASS plugins for
>> OGR/GDAL. readVECT6() and readRAST6() both by default check for the presence
>> of the plugin, and use it if present, avoiding any intermediate files being
>> created.
>>
>> The recently released revision of spgrass6 (0.6-23) does work with GRASS >
>> 6.3, including GRASS 7. This is signalled by the use of "GRASS 6+" rather
>> than just "GRASS 6" in its title and short description.
>>
>> Hope this helps,
>>
>> Roger
>>
>>>
>>> Dylan
>>>
>>>
>>>
>>>
>>
>>
>
> --
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From kevinwang at kpmg.com.au  Wed Dec 15 07:01:42 2010
From: kevinwang at kpmg.com.au (Wang, Kevin (SYD))
Date: Wed, 15 Dec 2010 17:01:42 +1100
Subject: [R-sig-Geo] Drawing Maps
Message-ID: <378EB90FD48A9E47A49222E07DF06BAA01BBCF83@AUSYDEXC37.au.kworld.kpmg.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101215/727e1786/attachment.pl>

From mdsumner at gmail.com  Wed Dec 15 07:17:55 2010
From: mdsumner at gmail.com (Michael Sumner)
Date: Wed, 15 Dec 2010 17:17:55 +1100
Subject: [R-sig-Geo] Drawing Maps
In-Reply-To: <378EB90FD48A9E47A49222E07DF06BAA01BBCF83@AUSYDEXC37.au.kworld.kpmg.com>
References: <378EB90FD48A9E47A49222E07DF06BAA01BBCF83@AUSYDEXC37.au.kworld.kpmg.com>
Message-ID: <AANLkTimMNMR8T_LWPOEw0YP4fCKiXuA6rdZqrfNPxYmE@mail.gmail.com>

You need to quote the layer  since R is looking for a variable of that name:

foo <- readOGR(dsn = "D:/Documents and Settings/kevinwang/My
Documents/SMS/ASGC", layer = "LGA10aAust")

That's what "object 'LGA10aAust' not found" means.

Compare:

print(v.unlikely.name)

with

v.name <- "quoted text"
print(v.name)

So, you otherwise could do this:

layername <- "LGA10aAust"

foo <- readOGR(dsn = "D:/Documents and Settings/kevinwang/My
Documents/SMS/ASGC", layer = layername)

This is basic R understanding so work on some familiarity with text
strings and objects first if you get bogged down in fairly specialist
functions like these ones.

Good luck!


On Wed, Dec 15, 2010 at 5:01 PM, Wang, Kevin (SYD)
<kevinwang at kpmg.com.au> wrote:
> Hi,
>
> I'm just starting to learn map drawing, so I do apologise if the
> questions are very simple.
>
> I've downloaded
> ? ? ? ?Local Government Area ASGC Ed 2010 Digital Boundaries in MapInfo
> Interchange Format
> ? ? ? ?Local Government Area ASGC Ed 2010 Digital Boundaries in ESRI
> Shapefile Format
>
> From
> http://www.abs.gov.au/AUSSTATS/abs at .nsf/DetailsPage/1259.0.30.001July%20
> 2010?OpenDocument , and unzipped them into a directory. ?I then tried:
> ? ? ? ?> library(rgdal)
> ? ? ? ?> foo <- readOGR(dsn = "D:/Documents and Settings/kevinwang/My
> Documents/SMS/ASGC", layer = LGA10aAust)
> ? ? ? ?Error in nchar(layer) : object 'LGA10aAust' not found
>
> Unfortunately I don't quite understand what the error message means.
>
> My questions:
> * ? ? ? Does anyone know a good reference where I can learn the basics
> of mappings in general (e.g. what's a shapefile? ?Difference bewteen
> MapInfo and ESRI...etc)
> * ? ? ? Is R better at handling MapInfo or ESRI?
> * ? ? ? Is there a good reference (book or online article) on drawing
> maps in R? ?I found http://medipe.psu.ac.th/~edward/R/MapTools.pdf but
> can't seem to see the read.shape() function in maptools package.
>
> Thanks in advance for the help! ?I'm looking forward to do some maps in
> R :).
>
> Cheers
> Kevin
>
>
>
> Kevin Wang
> Senior Adviser, Government Advisory Services
> Advisory
>
> KPMG
> 10 Shelley Street
> Sydney ?NSW ?2000 ?Australia
>
> Tel ? ? +61 2 9335 8282
> Fax ? ? +61 2 9335 7001
> Mob ? ? 0404 518 301
> kevinwang at kpmg.com.au <mailto:kevinwang at kpmg.com.au >
>
> kpmg.com.au <http://kpmg.com.au/>
>
> Best Accounting Firm - BRW Client Choice Awards 2010
>
> Protect the environment: please think before you print
>
>
>
>
> ? ? ? ?[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



-- 
Michael Sumner
Institute for Marine and Antarctic Studies, University of Tasmania
Hobart, Australia
e-mail: mdsumner at gmail.com


From edzer.pebesma at uni-muenster.de  Wed Dec 15 07:45:42 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Wed, 15 Dec 2010 07:45:42 +0100
Subject: [R-sig-Geo] nugget in variogram
In-Reply-To: <AANLkTimH8W72Q75wGwVrZ36Mu3K09e+SAM7rgVoSK92w@mail.gmail.com>
References: <SNT127-W33D24FEFADC71E914CE391CE680@phx.gbl>	<4CA4BD3A.1030304@uni-muenster.de>	<SNT127-W42799CCFF61A2FD5709C0FCE6C0@phx.gbl>	<4CA9A487.3060604@uni-muenster.de>	<1292319760643-5833937.post@n2.nabble.com>	<AANLkTikLeKyyn0_UT537j+cTFgzmS6FPa=gNMpbKLk9d@mail.gmail.com>
	<AANLkTimH8W72Q75wGwVrZ36Mu3K09e+SAM7rgVoSK92w@mail.gmail.com>
Message-ID: <4D086416.3000907@uni-muenster.de>

> vgm(1, "Exp", 300)
  model psill range
1   Exp     1   300

and

> vgm(1, "Exp", 300, 0)
  model psill range
1   Nug     0     0
2   Exp     1   300

are definitions of exactly the same variogram, with zero nugget --
passing either to krige() will yield identical results. If they are
passed to fit.variogram, in the first case no nugget will be fitted, but
in the second case a (zero or positive) nugget will be fitted.

Hth,

On 12/14/2010 06:09 PM, Piero Campalani wrote:
> Of course, I forgot actually to say I'm using the gstat package, and its
> variogram and vgm functions.
> 
> Piero
> 
> On 14 December 2010 14:42, kapo coulibaly <kmcoulib at gmail.com> wrote:
> 
>> Which packages and which commands are you using? A little bit of background
>> on how you did it would help.
>>
>>
>> On Tue, Dec 14, 2010 at 4:42 AM, piero campa <piero.campa at gmail.com>wrote:
>>
>>>
>>> Hi,
>>> I am trying to fit my first variograms.
>>> I'm however noticing some weird behaviour I cannot explain.
>>> I'm a 100% newbie.
>>>
>>> - without setting a nugget element (so that it should be implicitly 0,
>>> isn't
>>> it? In fact the resulting variogram has 0 nugget), the psill and range of
>>> the fitted variogram don't change on different psill inputs.
>>> - If I explicitly set a nugget to 0, then actually the nugget is no more
>>> 0,
>>> but higher.
>>> - I tried also setting the fit.sills booleans to TRUE or FALSE to see what
>>> would change, but the output does not really care about it.
>>>
>>> Does someone have any hint about this?
>>>
>>> Thank you.
>>> Regards,
>>> Piero
>>> --
>>> View this message in context:
>>> http://r-sig-geo.2731867.n2.nabble.com/nugget-in-variogram-tp5587929p5833937.html
>>> Sent from the R-sig-geo mailing list archive at Nabble.com.
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>>
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From dylan.beaudette at gmail.com  Wed Dec 15 08:32:47 2010
From: dylan.beaudette at gmail.com (Dylan Beaudette)
Date: Tue, 14 Dec 2010 23:32:47 -0800
Subject: [R-sig-Geo] suggestion for sp.grid()
Message-ID: <AANLkTi=Rb9AYeJiWHLxumcMNAN0PEw_QwXdoVx1gkVZr@mail.gmail.com>

Hi,

I was tinkering around with some of the new functions from the
latticeExtra package, and thought of a (messy) hack for plotting
multiple grids. However, due to the way sp.grid() is currently coded,
there is no way to define both grid fill color _and_ outline color:

gp = gpar(fill = col, col = NULL, alpha = alpha)

if this line is changed to...

gp = gpar(fill = col, col = NA, alpha = alpha)

then outlines will default to no color... It might be nice to add a
new parameter to sp.grid() to allow the user to set the outline color
of the rectangles produced by grid.rect(). If the above line is
changed so that col=NA, then it is possible to overlay two grids (kind
of) like this:


library(gstat)
library(latticeExtra)
library(grid)

# load example data
data(meuse.grid)
coordinates(meuse.grid) <- ~ x + y
gridded(meuse.grid) <- TRUE

# hacked version of sp.grid()
sp.grid <- function (obj, col = 1, alpha = 1, ...)
{
    if (is.character(obj))
        obj = get(obj)
    xy = coordinates(obj)
    if (length(col) != 1 && length(col) != nrow(xy)) {
    }
    gt = as(getGridTopology(obj), "data.frame")
    grid.rect(x = xy[, 1], y = xy[, 2], width = gt$cellsize[1],
        height = gt$cellsize[2], default.units = "native", gp =
gpar(fill = col, col = NA, alpha = alpha))
}


# nice colors
trellis.par.set(regions=custom.theme()$regions,
superpose.polygon=list(col='black', alpha=0.25))

# first grid covers entire extent
p3 <- spplot(meuse.grid, 'dist', colorkey=list(space='bottom',
width=1, height=0.5, tick.number=3)

# overlay partially transparent, kind of a hack...
p3 <- p3 + layer(sp.grid(meuse.grid[meuse.grid$soil == 'A', ],
col='black', alpha=0.25))

# add a new key
p3 <- update(p3, key=simpleKey('Bad Stuff', points=FALSE, lines=FALSE,
rect=TRUE, columns=1, space='top'))

print(p3)

Note that I am using an older version of gstat, version 0.9-63. Maybe
this code has been updated since then. If not, what do you think? Are
there any better ways to overlay a couple grids?

Cheers,
Dylan


From p.hiemstra at geo.uu.nl  Wed Dec 15 08:58:57 2010
From: p.hiemstra at geo.uu.nl (Paul Hiemstra)
Date: Wed, 15 Dec 2010 08:58:57 +0100
Subject: [R-sig-Geo] Adding a scale bar and north arrow to a ggplot
In-Reply-To: <4CE588C9.9090100@geo.uu.nl>
References: <4CE588C9.9090100@geo.uu.nl>
Message-ID: <4D087541.6050509@geo.uu.nl>

Hi people,

I posted a similar question to the ggplot2 mailing list and with their 
help and a lot of tinkering I got a well working function to add a 
scalebar to a ggplot plot. I could add the function to automap, but is 
there another package which would be more appropraite, e.g. sp (Roger?)?

cheers,
Paul

ps: new version of code here:

makeNiceNumber = function(num, num.pretty = 1) {
   # Rounding provided by code from Maarten Plieger
   return((round(num/10^(round(log10(num))-1))*(10^(round(log10(num))-1))))
}

createBoxPolygon = function(llcorner, width, height) {
   relativeCoords = data.frame(c(0, 0, width, width, 0), c(0, height, 
height, 0, 0))
   names(relativeCoords) = names(llcorner)
   return(t(apply(relativeCoords, 1, function(x) llcorner + x)))
}

addScaleBar = function(ggplot_obj, spatial_obj, attribute, addParams = 
list()) {
   addParamsDefaults = list(noBins = 5, xname = "x", yname = "y", unit = 
"m", placement = "bottomright",
                            sbLengthPct = 0.3, sbHeightvsWidth = 1/14)
   addParams = modifyList(addParamsDefaults, addParams)

   range_x = max(spatial_obj[[addParams[["xname"]]]]) - 
min(spatial_obj[[addParams[["xname"]]]])
   range_y = max(spatial_obj[[addParams[["yname"]]]]) - 
min(spatial_obj[[addParams[["yname"]]]])
   lengthScalebar = addParams[["sbLengthPct"]] * range_x
   ## OPTION: use pretty() instead
   widthBin = makeNiceNumber(lengthScalebar / addParams[["noBins"]])
   heightBin = lengthScalebar * addParams[["sbHeightvsWidth"]]
   lowerLeftCornerScaleBar = c(x = 
max(spatial_obj[[addParams[["xname"]]]]) - (widthBin * 
addParams[["noBins"]]),
                               y = min(spatial_obj[[addParams[["yname"]]]]))

   scaleBarPolygon = do.call("rbind", lapply(0:(addParams[["noBins"]] - 
1), function(n) {
     dum = data.frame(createBoxPolygon(lowerLeftCornerScaleBar + c((n * 
widthBin), 0), widthBin, heightBin))
     if(!(n + 1) %% 2 == 0) dum$cat = "odd" else dum$cat = "even"
     return(dum)
   }))
   scaleBarPolygon[[attribute]] = min(spatial_obj[[attribute]])
   textScaleBar = data.frame(x = 
lowerLeftCornerScaleBar[[addParams[["xname"]]]] + 
(c(0:(addParams[["noBins"]])) * widthBin),
                             y = 
lowerLeftCornerScaleBar[[addParams[["yname"]]]],
                             label = 
as.character(0:(addParams[["noBins"]]) * widthBin))
   textScaleBar[[attribute]] = min(spatial_obj[[attribute]])

   return(ggplot_obj +
     geom_polygon(data = subset(scaleBarPolygon, cat == "odd"), fill = 
"black", color = "black", legend = FALSE) +
     geom_polygon(data = subset(scaleBarPolygon, cat == "even"), fill = 
"white", color = "black", legend = FALSE) +
     geom_text(aes(label = label), color = "black", size = 6, data = 
textScaleBar, hjust = 0.5, vjust = 1.2, legend = FALSE))
}

library(ggplot2)
library(sp)

data(meuse)
data(meuse.grid)
ggobj = ggplot(aes(x = x, y = y, color = zinc), data = meuse) + geom_point()
# Make sure to increase the graphic device a bit
addScaleBar(ggobj, meuse, "zinc", addParams = list(noBins = 5))


On 11/18/2010 09:12 PM, Paul Hiemstra wrote:
> Dear list,
>
> A common addition to any spatial plot are a north arrow and a scale 
> bar. I've searched online for a straightforward way to add those to a 
> ggplot plot. I then decided to give a go myself. A crude first attempt 
> for an automatic scalebar addition function is listed below. The 
> example works for the meuse dataset, but a second with a different 
> dataset did yield good results.
>
> My question to you is: is there anyone who has some good tips / 
> example code to add a north arrow and a scalebar to a ggplot image. 
> Any expansions on the code below are also welcome.
>
> cheers,
> Paul
>
> ps Some info on my system is listed at the very bottom
>
> library(sp)
> library(ggplot2)
>
> data(meuse)
> data(meuse.grid)
>
> string.length = function(s) {
> #  browser()
>   if(!is.character(s)) s = as.character(s)
>   length(strsplit(s, "")[[1]])
> }
>
> makeNiceNumber = function(num, num.pretty = 1) {
>   noNumbers = string.length(as.character(round(num)))
>   return(round(num / 10^(noNumbers - num.pretty)) * 10^(noNumbers - 
> num.pretty))
> }
>
> makeScaleBar = function(obj, plotname, xname = "x", yname = "y", unit 
> = "m", placement = "bottomright") {
> #     browser()
>   range_x = max(obj[[xname]]) - min(obj[[xname]])
>   range_y = max(obj[[yname]]) - min(obj[[yname]])
>   if(placement == "bottomright") {
>     xcoor.max = makeNiceNumber(max(obj[[xname]]) - (0.05 *range_x ), 
> string.length(round(max(obj[[xname]]))) - string.length(round(0.3 * 
> range_x)))
>     xcoor.min = makeNiceNumber(max(obj[[xname]]) - (0.5 *range_x ), 
> string.length(round(max(obj[[xname]]))) - string.length(round(0.3 * 
> range_x)))
>     ycoor = min(obj[[yname]]) + (0.05 * range_y)
>   } else {
>     xcoor.min = makeNiceNumber(max(obj[[xname]]) - (0.95 *range_x ), 
> string.length(round(max(obj[[xname]]))) - string.length(round(0.3 * 
> range_x)))
>     xcoor.max = makeNiceNumber(max(obj[[xname]]) - (0.5 *range_x ), 
> string.length(round(max(obj[[xname]]))) - string.length(round(0.3 * 
> range_x)))
>     ycoor = min(obj[[yname]]) + (0.95 * range_y)
>   }
>   scalebar.data = data.frame(x = c(xcoor.max, xcoor.min), y = ycoor, 
> lbl = c(paste(xcoor.max - xcoor.min, unit), 0))
>   scalebar.data[[plotname]] = min(obj[[plotname]])
>   return(list(geom_path(aes(x = x, y = y), data = scalebar.data, lwd = 
> 2, color = "black"),
>           geom_text(aes(x = x, y = y, label = lbl), data = 
> scalebar.data, vjust = 1.3)))
> }
>
> sb = makeScaleBar(meuse.grid, "dist", placement = "topright")
> ggplot(aes(x  = x, y = y, fill = dist), data = meuse.grid) + 
> geom_tile() + sb[[1]] + sb[[2]]
>
> R version 2.12.0 (2010-10-15)
> Platform: i486-pc-linux-gnu (32-bit)
>
> locale:
>  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
>  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
>  [5] LC_MONETARY=C              LC_MESSAGES=en_US.UTF-8
>  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C
>  [9] LC_ADDRESS=C               LC_TELEPHONE=C
> [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C
>
> attached base packages:
> [1] grid      stats     graphics  grDevices utils     datasets  methods
> [8] base
>
> other attached packages:
> [1] ggplot2_0.8.7 digest_0.4.2  reshape_0.8.3 plyr_0.1.9    proto_0.3-8
> [6] sp_0.9-62
>
> loaded via a namespace (and not attached):
> [1] lattice_0.19-13
>
> hiemstra at fg-113:~$ uname -a
> Linux fg-113 2.6.32-21-generic #32-Ubuntu SMP Fri Apr 16 08:10:02 UTC 
> 2010 i686 GNU/Linux
>


-- 
Paul Hiemstra, MSc
Department of Physical Geography
Faculty of Geosciences
University of Utrecht
Heidelberglaan 2
P.O. Box 80.115
3508 TC Utrecht
Phone:  +3130 253 5773
http://intamap.geo.uu.nl/~paul
http://nl.linkedin.com/pub/paul-hiemstra/20/30b/770

currently @ KNMI
paul.hiemstra_AT_knmi.nl


From Roger.Bivand at nhh.no  Wed Dec 15 09:53:38 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 15 Dec 2010 09:53:38 +0100 (CET)
Subject: [R-sig-Geo] Adding a scale bar and north arrow to a ggplot
In-Reply-To: <4D087541.6050509@geo.uu.nl>
References: <4CE588C9.9090100@geo.uu.nl> <4D087541.6050509@geo.uu.nl>
Message-ID: <alpine.LRH.2.00.1012150941460.1355@reclus.nhh.no>

On Wed, 15 Dec 2010, Paul Hiemstra wrote:

> Hi people,
>
> I posted a similar question to the ggplot2 mailing list and with their help 
> and a lot of tinkering I got a well working function to add a scalebar to a 
> ggplot plot. I could add the function to automap, but is there another 
> package which would be more appropraite, e.g. sp (Roger?)?

Paul,

If it was added to sp, sp would depend on ggplot2 and its dependencies, 
which are quite extensive, and include a circularity, because ggplot2 
suggests maptools, which in turn depends on sp. Consequently, sp is not a 
good idea. It might even make sense to split sp into sp with just classes 
and methods, and spViz for vizualisation methods, but changing things now 
is a bit late!

It will be cleaner to try to establish the mapping functionality that uses 
ggplot2 and sp as a separate package. Maybe Hadley would see this as a 
sensible development. There are already two supplements to ggplot2 on 
R-forge, but both moribund, I think, which suggests that this needs 
thinking through.

Roger

>
> cheers,
> Paul
>
> ps: new version of code here:
>
> makeNiceNumber = function(num, num.pretty = 1) {
>  # Rounding provided by code from Maarten Plieger
>  return((round(num/10^(round(log10(num))-1))*(10^(round(log10(num))-1))))
> }
>
> createBoxPolygon = function(llcorner, width, height) {
>  relativeCoords = data.frame(c(0, 0, width, width, 0), c(0, height, height, 
> 0, 0))
>  names(relativeCoords) = names(llcorner)
>  return(t(apply(relativeCoords, 1, function(x) llcorner + x)))
> }
>
> addScaleBar = function(ggplot_obj, spatial_obj, attribute, addParams = 
> list()) {
>  addParamsDefaults = list(noBins = 5, xname = "x", yname = "y", unit = "m", 
> placement = "bottomright",
>                           sbLengthPct = 0.3, sbHeightvsWidth = 1/14)
>  addParams = modifyList(addParamsDefaults, addParams)
>
>  range_x = max(spatial_obj[[addParams[["xname"]]]]) - 
> min(spatial_obj[[addParams[["xname"]]]])
>  range_y = max(spatial_obj[[addParams[["yname"]]]]) - 
> min(spatial_obj[[addParams[["yname"]]]])
>  lengthScalebar = addParams[["sbLengthPct"]] * range_x
>  ## OPTION: use pretty() instead
>  widthBin = makeNiceNumber(lengthScalebar / addParams[["noBins"]])
>  heightBin = lengthScalebar * addParams[["sbHeightvsWidth"]]
>  lowerLeftCornerScaleBar = c(x = max(spatial_obj[[addParams[["xname"]]]]) - 
> (widthBin * addParams[["noBins"]]),
>                              y = min(spatial_obj[[addParams[["yname"]]]]))
>
>  scaleBarPolygon = do.call("rbind", lapply(0:(addParams[["noBins"]] - 1), 
> function(n) {
>    dum = data.frame(createBoxPolygon(lowerLeftCornerScaleBar + c((n * 
> widthBin), 0), widthBin, heightBin))
>    if(!(n + 1) %% 2 == 0) dum$cat = "odd" else dum$cat = "even"
>    return(dum)
>  }))
>  scaleBarPolygon[[attribute]] = min(spatial_obj[[attribute]])
>  textScaleBar = data.frame(x = 
> lowerLeftCornerScaleBar[[addParams[["xname"]]]] + 
> (c(0:(addParams[["noBins"]])) * widthBin),
>                            y = 
> lowerLeftCornerScaleBar[[addParams[["yname"]]]],
>                            label = as.character(0:(addParams[["noBins"]]) * 
> widthBin))
>  textScaleBar[[attribute]] = min(spatial_obj[[attribute]])
>
>  return(ggplot_obj +
>    geom_polygon(data = subset(scaleBarPolygon, cat == "odd"), fill = 
> "black", color = "black", legend = FALSE) +
>    geom_polygon(data = subset(scaleBarPolygon, cat == "even"), fill = 
> "white", color = "black", legend = FALSE) +
>    geom_text(aes(label = label), color = "black", size = 6, data = 
> textScaleBar, hjust = 0.5, vjust = 1.2, legend = FALSE))
> }
>
> library(ggplot2)
> library(sp)
>
> data(meuse)
> data(meuse.grid)
> ggobj = ggplot(aes(x = x, y = y, color = zinc), data = meuse) + geom_point()
> # Make sure to increase the graphic device a bit
> addScaleBar(ggobj, meuse, "zinc", addParams = list(noBins = 5))
>
>
> On 11/18/2010 09:12 PM, Paul Hiemstra wrote:
>> Dear list,
>> 
>> A common addition to any spatial plot are a north arrow and a scale bar. 
>> I've searched online for a straightforward way to add those to a ggplot 
>> plot. I then decided to give a go myself. A crude first attempt for an 
>> automatic scalebar addition function is listed below. The example works for 
>> the meuse dataset, but a second with a different dataset did yield good 
>> results.
>> 
>> My question to you is: is there anyone who has some good tips / example 
>> code to add a north arrow and a scalebar to a ggplot image. Any expansions 
>> on the code below are also welcome.
>> 
>> cheers,
>> Paul
>> 
>> ps Some info on my system is listed at the very bottom
>> 
>> library(sp)
>> library(ggplot2)
>> 
>> data(meuse)
>> data(meuse.grid)
>> 
>> string.length = function(s) {
>> #  browser()
>>   if(!is.character(s)) s = as.character(s)
>>   length(strsplit(s, "")[[1]])
>> }
>> 
>> makeNiceNumber = function(num, num.pretty = 1) {
>>   noNumbers = string.length(as.character(round(num)))
>>   return(round(num / 10^(noNumbers - num.pretty)) * 10^(noNumbers - 
>> num.pretty))
>> }
>> 
>> makeScaleBar = function(obj, plotname, xname = "x", yname = "y", unit = 
>> "m", placement = "bottomright") {
>> #     browser()
>>   range_x = max(obj[[xname]]) - min(obj[[xname]])
>>   range_y = max(obj[[yname]]) - min(obj[[yname]])
>>   if(placement == "bottomright") {
>>     xcoor.max = makeNiceNumber(max(obj[[xname]]) - (0.05 *range_x ), 
>> string.length(round(max(obj[[xname]]))) - string.length(round(0.3 * 
>> range_x)))
>>     xcoor.min = makeNiceNumber(max(obj[[xname]]) - (0.5 *range_x ), 
>> string.length(round(max(obj[[xname]]))) - string.length(round(0.3 * 
>> range_x)))
>>     ycoor = min(obj[[yname]]) + (0.05 * range_y)
>>   } else {
>>     xcoor.min = makeNiceNumber(max(obj[[xname]]) - (0.95 *range_x ), 
>> string.length(round(max(obj[[xname]]))) - string.length(round(0.3 * 
>> range_x)))
>>     xcoor.max = makeNiceNumber(max(obj[[xname]]) - (0.5 *range_x ), 
>> string.length(round(max(obj[[xname]]))) - string.length(round(0.3 * 
>> range_x)))
>>     ycoor = min(obj[[yname]]) + (0.95 * range_y)
>>   }
>>   scalebar.data = data.frame(x = c(xcoor.max, xcoor.min), y = ycoor, lbl = 
>> c(paste(xcoor.max - xcoor.min, unit), 0))
>>   scalebar.data[[plotname]] = min(obj[[plotname]])
>>   return(list(geom_path(aes(x = x, y = y), data = scalebar.data, lwd = 2, 
>> color = "black"),
>>           geom_text(aes(x = x, y = y, label = lbl), data = scalebar.data, 
>> vjust = 1.3)))
>> }
>> 
>> sb = makeScaleBar(meuse.grid, "dist", placement = "topright")
>> ggplot(aes(x  = x, y = y, fill = dist), data = meuse.grid) + geom_tile() + 
>> sb[[1]] + sb[[2]]
>> 
>> R version 2.12.0 (2010-10-15)
>> Platform: i486-pc-linux-gnu (32-bit)
>> 
>> locale:
>>  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
>>  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
>>  [5] LC_MONETARY=C              LC_MESSAGES=en_US.UTF-8
>>  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C
>>  [9] LC_ADDRESS=C               LC_TELEPHONE=C
>> [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C
>> 
>> attached base packages:
>> [1] grid      stats     graphics  grDevices utils     datasets  methods
>> [8] base
>> 
>> other attached packages:
>> [1] ggplot2_0.8.7 digest_0.4.2  reshape_0.8.3 plyr_0.1.9    proto_0.3-8
>> [6] sp_0.9-62
>> 
>> loaded via a namespace (and not attached):
>> [1] lattice_0.19-13
>> 
>> hiemstra at fg-113:~$ uname -a
>> Linux fg-113 2.6.32-21-generic #32-Ubuntu SMP Fri Apr 16 08:10:02 UTC 2010 
>> i686 GNU/Linux
>> 
>
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From p.hiemstra at geo.uu.nl  Wed Dec 15 10:21:28 2010
From: p.hiemstra at geo.uu.nl (Paul Hiemstra)
Date: Wed, 15 Dec 2010 10:21:28 +0100
Subject: [R-sig-Geo] Adding a scale bar and north arrow to a ggplot
In-Reply-To: <alpine.LRH.2.00.1012150941460.1355@reclus.nhh.no>
References: <4CE588C9.9090100@geo.uu.nl> <4D087541.6050509@geo.uu.nl>
	<alpine.LRH.2.00.1012150941460.1355@reclus.nhh.no>
Message-ID: <4D088898.7040701@geo.uu.nl>

On 12/15/2010 09:53 AM, Roger Bivand wrote:
> On Wed, 15 Dec 2010, Paul Hiemstra wrote:
>
>> Hi people,
>>
>> I posted a similar question to the ggplot2 mailing list and with 
>> their help and a lot of tinkering I got a well working function to 
>> add a scalebar to a ggplot plot. I could add the function to automap, 
>> but is there another package which would be more appropraite, e.g. sp 
>> (Roger?)?
>
> Paul,
>
> If it was added to sp, sp would depend on ggplot2 and its 
> dependencies, which are quite extensive, and include a circularity, 
> because ggplot2 suggests maptools, which in turn depends on sp. 
> Consequently, sp is not a good idea. It might even make sense to split 
> sp into sp with just classes and methods, and spViz for vizualisation 
> methods, but changing things now is a bit late!
>
> It will be cleaner to try to establish the mapping functionality that 
> uses ggplot2 and sp as a separate package. Maybe Hadley would see this 
> as a sensible development. 

Or make a new geom_scalebar :). An alternative could be an sp-contrib 
package where any additional code relevant to sp can be put.

Paul

> There are already two supplements to ggplot2 on R-forge, but both 
> moribund, I think, which suggests that this needs thinking through.
>
> Roger
>
>>
>> cheers,
>> Paul
>>
>> ps: new version of code here:
>>
>> makeNiceNumber = function(num, num.pretty = 1) {
>>  # Rounding provided by code from Maarten Plieger
>>  return((round(num/10^(round(log10(num))-1))*(10^(round(log10(num))-1)))) 
>>
>> }
>>
>> createBoxPolygon = function(llcorner, width, height) {
>>  relativeCoords = data.frame(c(0, 0, width, width, 0), c(0, height, 
>> height, 0, 0))
>>  names(relativeCoords) = names(llcorner)
>>  return(t(apply(relativeCoords, 1, function(x) llcorner + x)))
>> }
>>
>> addScaleBar = function(ggplot_obj, spatial_obj, attribute, addParams 
>> = list()) {
>>  addParamsDefaults = list(noBins = 5, xname = "x", yname = "y", unit 
>> = "m", placement = "bottomright",
>>                           sbLengthPct = 0.3, sbHeightvsWidth = 1/14)
>>  addParams = modifyList(addParamsDefaults, addParams)
>>
>>  range_x = max(spatial_obj[[addParams[["xname"]]]]) - 
>> min(spatial_obj[[addParams[["xname"]]]])
>>  range_y = max(spatial_obj[[addParams[["yname"]]]]) - 
>> min(spatial_obj[[addParams[["yname"]]]])
>>  lengthScalebar = addParams[["sbLengthPct"]] * range_x
>>  ## OPTION: use pretty() instead
>>  widthBin = makeNiceNumber(lengthScalebar / addParams[["noBins"]])
>>  heightBin = lengthScalebar * addParams[["sbHeightvsWidth"]]
>>  lowerLeftCornerScaleBar = c(x = 
>> max(spatial_obj[[addParams[["xname"]]]]) - (widthBin * 
>> addParams[["noBins"]]),
>>                              y = 
>> min(spatial_obj[[addParams[["yname"]]]]))
>>
>>  scaleBarPolygon = do.call("rbind", lapply(0:(addParams[["noBins"]] - 
>> 1), function(n) {
>>    dum = data.frame(createBoxPolygon(lowerLeftCornerScaleBar + c((n * 
>> widthBin), 0), widthBin, heightBin))
>>    if(!(n + 1) %% 2 == 0) dum$cat = "odd" else dum$cat = "even"
>>    return(dum)
>>  }))
>>  scaleBarPolygon[[attribute]] = min(spatial_obj[[attribute]])
>>  textScaleBar = data.frame(x = 
>> lowerLeftCornerScaleBar[[addParams[["xname"]]]] + 
>> (c(0:(addParams[["noBins"]])) * widthBin),
>>                            y = 
>> lowerLeftCornerScaleBar[[addParams[["yname"]]]],
>>                            label = 
>> as.character(0:(addParams[["noBins"]]) * widthBin))
>>  textScaleBar[[attribute]] = min(spatial_obj[[attribute]])
>>
>>  return(ggplot_obj +
>>    geom_polygon(data = subset(scaleBarPolygon, cat == "odd"), fill = 
>> "black", color = "black", legend = FALSE) +
>>    geom_polygon(data = subset(scaleBarPolygon, cat == "even"), fill = 
>> "white", color = "black", legend = FALSE) +
>>    geom_text(aes(label = label), color = "black", size = 6, data = 
>> textScaleBar, hjust = 0.5, vjust = 1.2, legend = FALSE))
>> }
>>
>> library(ggplot2)
>> library(sp)
>>
>> data(meuse)
>> data(meuse.grid)
>> ggobj = ggplot(aes(x = x, y = y, color = zinc), data = meuse) + 
>> geom_point()
>> # Make sure to increase the graphic device a bit
>> addScaleBar(ggobj, meuse, "zinc", addParams = list(noBins = 5))
>>
>>
>> On 11/18/2010 09:12 PM, Paul Hiemstra wrote:
>>> Dear list,
>>>
>>> A common addition to any spatial plot are a north arrow and a scale 
>>> bar. I've searched online for a straightforward way to add those to 
>>> a ggplot plot. I then decided to give a go myself. A crude first 
>>> attempt for an automatic scalebar addition function is listed below. 
>>> The example works for the meuse dataset, but a second with a 
>>> different dataset did yield good results.
>>>
>>> My question to you is: is there anyone who has some good tips / 
>>> example code to add a north arrow and a scalebar to a ggplot image. 
>>> Any expansions on the code below are also welcome.
>>>
>>> cheers,
>>> Paul
>>>
>>> ps Some info on my system is listed at the very bottom
>>>
>>> library(sp)
>>> library(ggplot2)
>>>
>>> data(meuse)
>>> data(meuse.grid)
>>>
>>> string.length = function(s) {
>>> #  browser()
>>>   if(!is.character(s)) s = as.character(s)
>>>   length(strsplit(s, "")[[1]])
>>> }
>>>
>>> makeNiceNumber = function(num, num.pretty = 1) {
>>>   noNumbers = string.length(as.character(round(num)))
>>>   return(round(num / 10^(noNumbers - num.pretty)) * 10^(noNumbers - 
>>> num.pretty))
>>> }
>>>
>>> makeScaleBar = function(obj, plotname, xname = "x", yname = "y", 
>>> unit = "m", placement = "bottomright") {
>>> #     browser()
>>>   range_x = max(obj[[xname]]) - min(obj[[xname]])
>>>   range_y = max(obj[[yname]]) - min(obj[[yname]])
>>>   if(placement == "bottomright") {
>>>     xcoor.max = makeNiceNumber(max(obj[[xname]]) - (0.05 *range_x ), 
>>> string.length(round(max(obj[[xname]]))) - string.length(round(0.3 * 
>>> range_x)))
>>>     xcoor.min = makeNiceNumber(max(obj[[xname]]) - (0.5 *range_x ), 
>>> string.length(round(max(obj[[xname]]))) - string.length(round(0.3 * 
>>> range_x)))
>>>     ycoor = min(obj[[yname]]) + (0.05 * range_y)
>>>   } else {
>>>     xcoor.min = makeNiceNumber(max(obj[[xname]]) - (0.95 *range_x ), 
>>> string.length(round(max(obj[[xname]]))) - string.length(round(0.3 * 
>>> range_x)))
>>>     xcoor.max = makeNiceNumber(max(obj[[xname]]) - (0.5 *range_x ), 
>>> string.length(round(max(obj[[xname]]))) - string.length(round(0.3 * 
>>> range_x)))
>>>     ycoor = min(obj[[yname]]) + (0.95 * range_y)
>>>   }
>>>   scalebar.data = data.frame(x = c(xcoor.max, xcoor.min), y = ycoor, 
>>> lbl = c(paste(xcoor.max - xcoor.min, unit), 0))
>>>   scalebar.data[[plotname]] = min(obj[[plotname]])
>>>   return(list(geom_path(aes(x = x, y = y), data = scalebar.data, lwd 
>>> = 2, color = "black"),
>>>           geom_text(aes(x = x, y = y, label = lbl), data = 
>>> scalebar.data, vjust = 1.3)))
>>> }
>>>
>>> sb = makeScaleBar(meuse.grid, "dist", placement = "topright")
>>> ggplot(aes(x  = x, y = y, fill = dist), data = meuse.grid) + 
>>> geom_tile() + sb[[1]] + sb[[2]]
>>>
>>> R version 2.12.0 (2010-10-15)
>>> Platform: i486-pc-linux-gnu (32-bit)
>>>
>>> locale:
>>>  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
>>>  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
>>>  [5] LC_MONETARY=C              LC_MESSAGES=en_US.UTF-8
>>>  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C
>>>  [9] LC_ADDRESS=C               LC_TELEPHONE=C
>>> [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C
>>>
>>> attached base packages:
>>> [1] grid      stats     graphics  grDevices utils     datasets  methods
>>> [8] base
>>>
>>> other attached packages:
>>> [1] ggplot2_0.8.7 digest_0.4.2  reshape_0.8.3 plyr_0.1.9    proto_0.3-8
>>> [6] sp_0.9-62
>>>
>>> loaded via a namespace (and not attached):
>>> [1] lattice_0.19-13
>>>
>>> hiemstra at fg-113:~$ uname -a
>>> Linux fg-113 2.6.32-21-generic #32-Ubuntu SMP Fri Apr 16 08:10:02 
>>> UTC 2010 i686 GNU/Linux
>>>
>>
>>
>>
>


-- 
Paul Hiemstra, MSc
Department of Physical Geography
Faculty of Geosciences
University of Utrecht
Heidelberglaan 2
P.O. Box 80.115
3508 TC Utrecht
Phone:  +3130 253 5773
http://intamap.geo.uu.nl/~paul
http://nl.linkedin.com/pub/paul-hiemstra/20/30b/770

currently @ KNMI
paul.hiemstra_AT_knmi.nl


From Roger.Bivand at nhh.no  Wed Dec 15 10:35:23 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 15 Dec 2010 10:35:23 +0100 (CET)
Subject: [R-sig-Geo] suggestion for spgrass6 - temp file in readVECT6
In-Reply-To: <AANLkTim6KYosbO6egQ3JL1=jjt0-sq67QLtpx1dK4LYm@mail.gmail.com>
References: <AANLkTimqaOuLM46-N6=aYjKA6NotAt8hXjSK2hj2P3HX@mail.gmail.com>
	<201012091331.45055.dylan.beaudette@gmail.com>
	<alpine.LRH.2.00.1012101120540.6560@reclus.nhh.no>
	<alpine.LRH.2.00.1012141345490.30157@reclus.nhh.no>
	<AANLkTim6KYosbO6egQ3JL1=jjt0-sq67QLtpx1dK4LYm@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.1012151030320.1355@reclus.nhh.no>

On Wed, 15 Dec 2010, Pierre Roudier wrote:

> Hi Roger,
>
> Thanks for the patch. Unfortunately it does not work on my box, but I
> suspect that to be related with my readVECT6() problem.
>
> foo <- readVECT6('bar', driver='GML')
> Error in ogrInfo(dsn = dsn, layer = layer, input_field_name_encoding =
> input_field_name_encoding) :
>  Cannot open layer
>
> writeVECT6(foo, 'deletethis', driver='GML')
> Available OGR Drivers:
> Error in writeOGR(SDF, dsn = rtmpfl1, layer = shname, driver = driver) :
>
>        GDAL Error 4: Failed to create GML file
> /home/roudierp/Documents/GRASSDATA/NZMG/bh/.tmp/A208_RoudierP.
>
> So I guess I'd better fix that problem first>
>
> Sorry I can't provide better testing for now,

This thread continues on the grass-stats list. The driver= argument to the 
interface is not a good idea, as the dsn/olayer strings needed by the 
drivers differ greatly, and providing for many combinations is not a 
robust solution. Pierre's problems are compounded by trying to transfer an 
enormous data set, which may also challenge the file size limit for 
shapes, among other things. Using the GML driver is also problematic, as 
it is using WKT text, creating an even larger file.

Roger

>
> Cheers,
>
> Pierre
>
> 2010/12/15 Roger Bivand <Roger.Bivand at nhh.no>:
>> On Fri, 10 Dec 2010, Roger Bivand wrote:
>>
>>> On Thu, 9 Dec 2010, Dylan Beaudette wrote:
>>>
>>>> On Thursday, December 09, 2010, Pierre Roudier wrote:
>>>>>
>>>>> Dear all,
>>>>>
>>>>> I got a suggestion for spgrass6. As far as I understand it, a
>>>>> temporary ESRI shapefile is written on the disk when using
>>>>> readVECT6('foo'), I guess then R is using rgdal to read that shapefile
>>>>> back in memory. Considering the various limitations of the ESRI
>>>>> shapefile format that does not occur with the GRASS internal format,
>>>>> could it be possible to add an option to choose the OGR format used in
>>>>> that process?
>>>>>
>>>>> Also got a question for Roger I guess: I'm using now the grass7 svn
>>>>> trunk, should I expect any problems using the spgrass6 interface (I
>>>>> mean problems due to structural differences that appears in grass7
>>>>> that would not be handled by spgrass6, not problems due to grass7
>>>>> itself).
>>>>>
>>>>> Thanks,
>>>>>
>>>>> Pierre
>>>>>
>>>>
>>>> This is an excellent point Pierre, and something that has caused
>>>> significant pain the past-- in terms of column names and NULL value
>>>> handling. Not everyone's GDAL/OGR will be configured in the same way-- so I
>>>> don't know if altering the default behavior would be wise. However, adding
>>>> an option (as you suggested) to use some other format, such as SQLite, would
>>>> give power users a nice alternative to SHP format. SQLite would allow for
>>>> longer field names, proper support for NULL data, and probably some other
>>>> 'good things'.
>>>
>>> SQLite is an extra OGR driver that will be dependent on the OGR being used
>>> on the platform in question. The OGR used by GRASS may be the same as that
>>> used by rgdal, but may not be (R binary rgdal packages for Windows and OSX,
>>> which have minimal driver sets).
>>>
>>> I'll attempt to add a driver= argument to readVECT6() and writeVECT6(),
>>> and drivername= readRAST6() and writeRAST6() for the temporary files.
>>
>> Could either of you, or others who may be interested, please try the draft
>> version by anonymous checkout fot the spgrass6 module from the sourceforge
>> r-spatial project, or using the source package at:
>>
>> http://spatial.nhh.no/R/Devel/spgrass6_0.6-24.tar.gz
>>
>> If you report back that it suits your needs, I'll submit it to CRAN; if you
>> need further changes, please let me know.
>>
>> Roger
>>
>>>
>>> Typically, for reading native GRASS data, users build GRASS plugins for
>>> OGR/GDAL. readVECT6() and readRAST6() both by default check for the presence
>>> of the plugin, and use it if present, avoiding any intermediate files being
>>> created.
>>>
>>> The recently released revision of spgrass6 (0.6-23) does work with GRASS >
>>> 6.3, including GRASS 7. This is signalled by the use of "GRASS 6+" rather
>>> than just "GRASS 6" in its title and short description.
>>>
>>> Hope this helps,
>>>
>>> Roger
>>>
>>>>
>>>> Dylan
>>>>
>>>>
>>>>
>>>>
>>>
>>>
>>
>> --
>> Roger Bivand
>> Economic Geography Section, Department of Economics, Norwegian School of
>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>> e-mail: Roger.Bivand at nhh.no
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From lists at remoteinformation.com.au  Wed Dec 15 10:55:58 2010
From: lists at remoteinformation.com.au (Ben Madin)
Date: Wed, 15 Dec 2010 20:55:58 +1100
Subject: [R-sig-Geo] Drawing Maps
In-Reply-To: <378EB90FD48A9E47A49222E07DF06BAA01BBCF83@AUSYDEXC37.au.kworld.kpmg.com>
References: <378EB90FD48A9E47A49222E07DF06BAA01BBCF83@AUSYDEXC37.au.kworld.kpmg.com>
Message-ID: <F7155C9D-D21B-44E6-96DE-08D4B77F85D1@remoteinformation.com.au>

Kevin,

On 15/12/2010, at 5:01 PM, Wang, Kevin (SYD) wrote:

> My questions:
> *	Does anyone know a good reference where I can learn the basics
> of mappings in general (e.g. what's a shapefile?  Difference bewteen
> MapInfo and ESRI...etc)

This is a big topic - and it will depend a great deal on what you want to do. Get a handle on R first (look at the R website for intro to R etc.) otherwise try Wikipedia and look at the references list. It is an iterative process, like most learning.

> *	Is R better at handling MapInfo or ESRI?

Either / or - Shapefiles are a defacto standard, but it is lacking in some features. readOGR can read both - once they are imported properly into R, I think it is immaterial.

> *	Is there a good reference (book or online article) on drawing
> maps in R?  I found http://medipe.psu.ac.th/~edward/R/MapTools.pdf but
> can't seem to see the read.shape() function in maptools package.

It depends how far you want to go - if you just want to draw maps, you might be better with a GIS package like QGIS or uDig. 

If you have some (not necessarily much) background in statistics and R,  "Applied Spatial Data Analysis with R" is worth every cent. It has code available on line, and is an excellent introduction into the sp package and associated tools.

cheers

Ben


From hadley at rice.edu  Wed Dec 15 14:07:29 2010
From: hadley at rice.edu (Hadley Wickham)
Date: Wed, 15 Dec 2010 07:07:29 -0600
Subject: [R-sig-Geo] Adding a scale bar and north arrow to a ggplot
In-Reply-To: <4D087541.6050509@geo.uu.nl>
References: <4CE588C9.9090100@geo.uu.nl>
	<4D087541.6050509@geo.uu.nl>
Message-ID: <AANLkTi=Vp+i-gby8KpPAREaXO5e-K_7hx1+WwFgVP839@mail.gmail.com>

I have a student who is interested in working on more spatial features
for ggplot2 this summer. That work is likely to involve separating out
all spatial features from ggplot2 into their own package and that
would be a good place for this.

Hadley

On Wednesday, December 15, 2010, Paul Hiemstra <p.hiemstra at geo.uu.nl> wrote:
> Hi people,
>
> I posted a similar question to the ggplot2 mailing list and with their help and a lot of tinkering I got a well working function to add a scalebar to a ggplot plot. I could add the function to automap, but is there another package which would be more appropraite, e.g. sp (Roger?)?
>
> cheers,
> Paul
>
> ps: new version of code here:
>
> makeNiceNumber = function(num, num.pretty = 1) {
>  ?# Rounding provided by code from Maarten Plieger
>  ?return((round(num/10^(round(log10(num))-1))*(10^(round(log10(num))-1))))
> }
>
> createBoxPolygon = function(llcorner, width, height) {
>  ?relativeCoords = data.frame(c(0, 0, width, width, 0), c(0, height, height, 0, 0))
>  ?names(relativeCoords) = names(llcorner)
>  ?return(t(apply(relativeCoords, 1, function(x) llcorner + x)))
> }
>
> addScaleBar = function(ggplot_obj, spatial_obj, attribute, addParams = list()) {
>  ?addParamsDefaults = list(noBins = 5, xname = "x", yname = "y", unit = "m", placement = "bottomright",
>  ? ? ? ? ? ? ? ? ? ? ? ? ? sbLengthPct = 0.3, sbHeightvsWidth = 1/14)
>  ?addParams = modifyList(addParamsDefaults, addParams)
>
>  ?range_x = max(spatial_obj[[addParams[["xname"]]]]) - min(spatial_obj[[addParams[["xname"]]]])
>  ?range_y = max(spatial_obj[[addParams[["yname"]]]]) - min(spatial_obj[[addParams[["yname"]]]])
>  ?lengthScalebar = addParams[["sbLengthPct"]] * range_x
>  ?## OPTION: use pretty() instead
>  ?widthBin = makeNiceNumber(lengthScalebar / addParams[["noBins"]])
>  ?heightBin = lengthScalebar * addParams[["sbHeightvsWidth"]]
>  ?lowerLeftCornerScaleBar = c(x = max(spatial_obj[[addParams[["xname"]]]]) - (widthBin * addParams[["noBins"]]),
>  ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?y = min(spatial_obj[[addParams[["yname"]]]]))
>
>  ?scaleBarPolygon = do.call("rbind", lapply(0:(addParams[["noBins"]] - 1), function(n) {
>  ? ?dum = data.frame(createBoxPolygon(lowerLeftCornerScaleBar + c((n * widthBin), 0), widthBin, heightBin))
>  ? ?if(!(n + 1) %% 2 == 0) dum$cat = "odd" else dum$cat = "even"
>  ? ?return(dum)
>  ?}))
>  ?scaleBarPolygon[[attribute]] = min(spatial_obj[[attribute]])
>  ?textScaleBar = data.frame(x = lowerLeftCornerScaleBar[[addParams[["xname"]]]] + (c(0:(addParams[["noBins"]])) * widthBin),
>  ? ? ? ? ? ? ? ? ? ? ? ? ? ?y = lowerLeftCornerScaleBar[[addParams[["yname"]]]],
>  ? ? ? ? ? ? ? ? ? ? ? ? ? ?label = as.character(0:(addParams[["noBins"]]) * widthBin))
>  ?textScaleBar[[attribute]] = min(spatial_obj[[attribute]])
>
>  ?return(ggplot_obj +
>  ? ?geom_polygon(data = subset(scaleBarPolygon, cat == "odd"), fill = "black", color = "black", legend = FALSE) +
>  ? ?geom_polygon(data = subset(scaleBarPolygon, cat == "even"), fill = "white", color = "black", legend = FALSE) +
>  ? ?geom_text(aes(label = label), color = "black", size = 6, data = textScaleBar, hjust = 0.5, vjust = 1.2, legend = FALSE))
> }
>
> library(ggplot2)
> library(sp)
>
> data(meuse)
> data(meuse.grid)
> ggobj = ggplot(aes(x = x, y = y, color = zinc), data = meuse) + geom_point()
> # Make sure to increase the graphic device a bit
> addScaleBar(ggobj, meuse, "zinc", addParams = list(noBins = 5))
>
>
> On 11/18/2010 09:12 PM, Paul Hiemstra wrote:
>
> Dear list,
>
> A common addition to any spatial plot are a north arrow and a scale bar. I've searched online for a straightforward way to add those to a ggplot plot. I then decided to give a go myself. A crude first attempt for an automatic scalebar addition function is listed below. The example works for the meuse dataset, but a second with a different dataset did yield good results.
>
> My question to you is: is there anyone who has some good tips / example code to add a north arrow and a scalebar to a ggplot image. Any expansions on the code below are also welcome.
>
> cheers,
> Paul
>
> ps Some info on my system is listed at the very bottom
>
> library(sp)
> library(ggplot2)
>
> data(meuse)
> data(meuse.grid)
>
> string.length = function(s) {
> # ?browser()
>  ?if(!is.character(s)) s = as.character(s)
>  ?length(strsplit(s, "")[[1]])
> }
>
> makeNiceNumber = function(num, num.pretty = 1) {
>  ?noNumbers = string.length(as.character(round(num)))
>  ?return(round(num / 10^(noNumbers - num.pretty)) * 10^(noNumbers - num.pretty))
> }
>
> makeScaleBar = function(obj, plotname, xname = "x", yname = "y", unit = "m", placement = "bottomright") {
> # ? ? browser()
>  ?range_x = max(obj[[xname]]) - min(obj[[xname]])
>  ?range_y = max(obj[[yname]]) - min(obj[[yname]])
>  ?if(placement == "bottomright") {
>  ? ?xcoor.max = makeNiceNumber(max(obj[[xname]]) - (0.05 *range_x ), string.length(round(max(obj[[xname]]))) - string.length(round(0.3 * range_x)))
>  ? ?xcoor.min = makeNiceNumber(max(obj[[xname]]) - (0.5 *range_x ), string.length(round(max(obj[[xname]]))) - string.length(round(0.3 * range_x)))
>  ? ?ycoor = min(obj[[yname]]) + (0.05 * range_y)
>  ?} else {
>  ? ?xcoor.min = makeNiceNumber(max(obj[[xname]]) - (0.95 *range_x ), string.length(round(max(obj[[xname]]))) - string.length(round(0.3 * range_x)))
>  ? ?xcoor.max = makeNiceNumber(max(obj[[xname]]) - (0.5 *range_x ), string.length(round(max(obj[[xname]]))) - string.length(round(0.3 * range_x)))
>  ? ?ycoor = min(obj[[yname]]) + (0.95 * range_y)
>  ?}
>  ?scalebar.data = data.frame(x = c(xcoor.max, xcoor.min), y = ycoor, lbl = c(paste(xcoor.max - xcoor.min, unit), 0))
>  ?scalebar.data[[plotname]] = min(obj[[plotname]])
>  ?return(list(geom_path(aes(x = x, y = y), data = scalebar.data, lwd = 2, color = "black"),
>  ? ? ? ? ?geom_text(aes(x = x, y = y, label = lbl), data = scalebar.data, vjust = 1.3)))
> }
>
> sb = makeScaleBar(meuse.grid, "dist", placement = "topright")
> ggplot(aes(x ?= x, y = y, fill = dist), data = meuse.grid) + geom_tile() + sb[[1]] + sb[[2]]
>
> R version 2.12.0 (2010-10-15)
> Platform: i486-pc-linux-gnu (32-bit)
>
> locale:
> ?[1] LC_CTYPE=en_US.UTF-8 ? ? ? LC_NUMERIC=C
> ?[3] LC_TIME=en_US.UTF-8 ? ? ? ?LC_COLLATE=en_US.UTF-8
> ?[5] LC_MONETARY=C ? ? ? ? ? ? ?LC_MESSAGES=en_US.UTF-8
> ?[7] LC_PAPER=en_US.UTF-8 ? ? ? LC_NAME=C
> ?[9] LC_ADDRESS=C ? ? ? ? ? ? ? LC_TELEPHONE=C
> [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C
>
> attached base packages:
> [1] grid ? ? ?stats ? ? graphics ?grDevices utils ? ? datasets ?methods
> [8] base
>
> other attached packages:
> [1] ggplot2_0.8.7 digest_0.4.2 ?reshape_0.8.3 plyr_0.1.9 ? ?proto_0.3-8
> [6] sp_0.9-62
>
> loaded via a namespace (and not attached):
> [1] lattice_0.19-13
>
> hiemstra at fg-113:~$ uname -a
> Linux fg-113 2.6.32-21-generic #32-Ubuntu SMP Fri Apr 16 08:10:02 UTC 2010 i686 GNU/Linux
>
>
>
>
> --
> Paul Hiemstra, MSc
> Department of Physical Geography
> Faculty of Geosciences
> University of Utrecht
> Heidelberglaan 2
> P.O. Box 80.115
> 3508 TC Utrecht
> Phone: ?+3130 253 5773
> http://intamap.geo.uu.nl/~paul
> http://nl.linkedin.com/pub/paul-hiemstra/20/30b/770
>
> currently @ KNMI
> paul.hiemstra_AT_knmi.nl
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Assistant Professor / Dobelman Family Junior Chair
Department of Statistics / Rice University
http://had.co.nz/


From gianni.lavaredo at gmail.com  Wed Dec 15 14:41:21 2010
From: gianni.lavaredo at gmail.com (gianni lavaredo)
Date: Wed, 15 Dec 2010 14:41:21 +0100
Subject: [R-sig-Geo] problem to use "perimeter" in RASTER Library
Message-ID: <AANLkTikKqqD=18YLqZv8dmAp+24hkcykpxf_PjMUny8z@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101215/eedc0690/attachment.pl>

From kmcoulib at gmail.com  Wed Dec 15 14:59:22 2010
From: kmcoulib at gmail.com (kapo coulibaly)
Date: Wed, 15 Dec 2010 08:59:22 -0500
Subject: [R-sig-Geo] Selective Kriging error
In-Reply-To: <4D0862D6.80604@uni-muenster.de>
References: <AANLkTim0Z6mLjeoUfT+Y8dsou+RVd2wJyMr0co6GRXRB@mail.gmail.com>
	<4D0862D6.80604@uni-muenster.de>
Message-ID: <AANLkTim_7UV-ipF3ke6VuYqzdQts2Bd7ADQeqcKwRCjg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101215/0ad8f3fb/attachment.pl>

From Tim.Haering at lwf.bayern.de  Wed Dec 15 15:46:57 2010
From: Tim.Haering at lwf.bayern.de (=?UTF-8?B?SMOkcmluZywgVGltIChMV0Yp?=)
Date: Wed, 15 Dec 2010 15:46:57 +0100
Subject: [R-sig-Geo] SGDF with NA values - SGDF2PCT()
In-Reply-To: <AANLkTiktBZukBqX-ZfLu2_EjCOkjennfU_taTN2804Sc@mail.gmail.com>
References: <70FC67C4A585D1489E66225A4E0238BAC4DF6A@RZS-EXC-CL06.rz-sued.bayern.de>
	<AANLkTiktBZukBqX-ZfLu2_EjCOkjennfU_taTN2804Sc@mail.gmail.com>
Message-ID: <70FC67C4A585D1489E66225A4E0238BAC4E64D@RZS-EXC-CL06.rz-sued.bayern.de>

Thank you Michael, your workaround gave me the right hint.
Even though your example didn`t work for me I solved the problem.

# first, I create a colour vector, where dist is a data.frame with red, green, and blue values.
cols <- rgb(dist[,1],dist[,2], dist[,3],alpha=.7)
ind <- data.frame(cols=unique(cols), ix=c(1:length(unique(cols))))

# create a df with coordinate values
pd <- data.frame(x = p$RW, y = p$HW, cols)
# add color-index values to df
pd <- merge(pd, ind, by.x="cols", by.y="cols", all.x=TRUE)

# geoformat
gridded(pd) = ~x+y
pd <- as(pd, "SpatialGridDataFrame")

### plot
g <- grey(0:250/250)
image(hillshade, col=g, axes = TRUE)
image(pd, "ix", col=ind$cols, add=TRUE)

Thanks again.

TIM

 --------------------------------------------
 Tim H?ring
 Bavarian State Institute of Forestry
 Department of Forest Ecology
 Hans-Carl-von-Carlowitz-Platz 1
 D-85354 Freising



From edzer.pebesma at uni-muenster.de  Wed Dec 15 17:38:49 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Wed, 15 Dec 2010 17:38:49 +0100
Subject: [R-sig-Geo] Selective Kriging error
In-Reply-To: <AANLkTim_7UV-ipF3ke6VuYqzdQts2Bd7ADQeqcKwRCjg@mail.gmail.com>
References: <AANLkTim0Z6mLjeoUfT+Y8dsou+RVd2wJyMr0co6GRXRB@mail.gmail.com>	<4D0862D6.80604@uni-muenster.de>
	<AANLkTim_7UV-ipF3ke6VuYqzdQts2Bd7ADQeqcKwRCjg@mail.gmail.com>
Message-ID: <4D08EF19.7050801@uni-muenster.de>

Thanks for forwarding my off-list answer back to the list.

Do a

library(gstat)
demo(examples)

and look at the Stratified ordinary kriging example.

meuse[meuse$part.a == 0,]

is passed to the krige function, meaning a subset of the full meuse
dataset. In your case this would be something like

yourdata[yourdata$measurementerror == 0,]

On 12/15/2010 02:59 PM, kapo coulibaly wrote:
> Great! But i meant which package and how?
> 
> Thanks
> 
> On Wed, Dec 15, 2010 at 1:40 AM, Edzer Pebesma <
> edzer.pebesma at uni-muenster.de> wrote:
> 
>> Yes, you can.
>>
>> On 12/14/2010 07:24 PM, kapo coulibaly wrote:
>>> I'm doing some interpolations and i would like to know if it is possible
>>> with any of R's geostatistical packages to selectively pick a few points
>>> where I know measurements are "perfect" while the rest of them exhibit
>>> measurement errors?
>>>
>>>       [[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>> --
>> Edzer Pebesma
>> Institute for Geoinformatics (ifgi), University of M?nster
>> Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
>> 8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
>> http://www.52north.org/geostatistics      e.pebesma at wwu.de
>>
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From r.hijmans at gmail.com  Wed Dec 15 17:47:27 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Wed, 15 Dec 2010 08:47:27 -0800
Subject: [R-sig-Geo] problem to use "perimeter" in RASTER Library
In-Reply-To: <AANLkTikKqqD=18YLqZv8dmAp+24hkcykpxf_PjMUny8z@mail.gmail.com>
References: <AANLkTikKqqD=18YLqZv8dmAp+24hkcykpxf_PjMUny8z@mail.gmail.com>
Message-ID: <AANLkTikrqRNnzbOKtHGpRp6=+q13+x9HrvEY=4f-CqCL@mail.gmail.com>

Dear Gianni,

perimeter is a function in the geosphere package.

You found a bug in the test whether this is a closed polygon.  (It
should be if  (isTRUE(all.equal(x[1, ], x[nrow(x), ])))  rather than
if (all.equal(x[1, ], x[nrow(x), ]))  ). Thanks for reporting it, it
is fixed in version 1.2-16.

The easy work-around would be

xy <- rbind(c(579471.4,6757500),c(581081.3,6757500),c(579471.4,6761301),c(581081.3,6761301))
xy <- rbind(xy, xy[1,])

perimeter(xy)

But then you get another error, with these data, because these are not
longitude/latitude coordinates. geosphere only does spherical
(lon/lat) computations, not computations with (the easier case of)
planar coordinates .

With these coordinates you can compute the perimeter like this:

library(raster)
x <- rbind(c(579471.4,6757500),c(581081.3,6757500),c(579471.4,6761301),c(581081.3,6761301))
y <- rbind(x[-1,], x[1,])
d <- pointDistance(x, y, lonlat=FALSE)
perimeter <- sum(d)

Robert

> On Wed, Dec 15, 2010 at 5:41 AM, gianni lavaredo <gianni.lavaredo at gmail.com> wrote:
> dera researchers,
>
> I wish to get the value of perimeter in my own area (mywindow), but I have
> the following problem
>
> xy <-
> rbind(c(mywindow$xrange[[1]],mywindow$yrange[[1]]),c(mywindow$xrange[[2]],mywindow$yrange[[1]]),c(mywindow$xrange[[1]],mywindow$yrange[[2]]),c(mywindow$xrange[[2]],mywindow$yrange[[2]]))
> perimeter(xy)
> Error in if (all.equal(x[1, ], x[nrow(x), ])) { :
> ?the argument is not logic
>
> xy <-
> rbind(c(579471.4,6757500),c(581081.3,6757500),c(579471.4,6761301),c(581081.3,6761301))
> plot(xy)
> perimeter(xy)
>
> same error
>
> thanks for attention
> Gianni
>
> ? ? ? ?[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From dylan.beaudette at gmail.com  Wed Dec 15 17:57:38 2010
From: dylan.beaudette at gmail.com (Dylan Beaudette)
Date: Wed, 15 Dec 2010 08:57:38 -0800
Subject: [R-sig-Geo] suggestion for sp.grid()
In-Reply-To: <AANLkTi=Rb9AYeJiWHLxumcMNAN0PEw_QwXdoVx1gkVZr@mail.gmail.com>
References: <AANLkTi=Rb9AYeJiWHLxumcMNAN0PEw_QwXdoVx1gkVZr@mail.gmail.com>
Message-ID: <AANLkTinyCfFQRsqVFz2XzL-Gx7p-_meLvrdqHWPYqyQ1@mail.gmail.com>

Shouldn't be posting questions late into the night. I realized that my
example was not reproducible.

One more time:

# setup environment
library(gstat)
library(latticeExtra)
library(grid)

# load example data
data(meuse.grid)

coordinates(meuse.grid) <- ~ x + y
gridded(meuse.grid) <- TRUE
meuse.grid$soil <- factor(meuse.grid$soil, labels=c('A','B','C'))


# hacked version of sp.grid()
sp.grid <- function (obj, col = 1, alpha = 1, ...)
{
    if (is.character(obj))
        obj = get(obj)
    xy = coordinates(obj)
    if (length(col) != 1 && length(col) != nrow(xy)) {
    }
    gt = as(getGridTopology(obj), "data.frame")
    grid.rect(x = xy[, 1], y = xy[, 2], width = gt$cellsize[1],
        height = gt$cellsize[2], default.units = "native", gp =
gpar(fill = col, col = NA, alpha = alpha))
}


trellis.par.set(regions=custom.theme()$regions,
superpose.polygon=list(col='black', alpha=0.25))

# first grid covers entire extent
p3 <- spplot(meuse.grid, 'dist', colorkey=list(space='bottom',
width=1, height=0.5, tick.number=3))

# overlay partially transparent, kind of a hack...
p3 <- p3 + layer(sp.grid(meuse.grid[meuse.grid$soil == 'A', ],
col='black', alpha=0.25))

p3 <- update(p3, key=simpleKey('Shaded Region', points=FALSE,
lines=FALSE, rect=TRUE, columns=1, space='top'))

p3




On Tue, Dec 14, 2010 at 11:32 PM, Dylan Beaudette
<dylan.beaudette at gmail.com> wrote:
> Hi,
>
> I was tinkering around with some of the new functions from the
> latticeExtra package, and thought of a (messy) hack for plotting
> multiple grids. However, due to the way sp.grid() is currently coded,
> there is no way to define both grid fill color _and_ outline color:
>
> gp = gpar(fill = col, col = NULL, alpha = alpha)
>
> if this line is changed to...
>
> gp = gpar(fill = col, col = NA, alpha = alpha)
>
> then outlines will default to no color... It might be nice to add a
> new parameter to sp.grid() to allow the user to set the outline color
> of the rectangles produced by grid.rect(). If the above line is
> changed so that col=NA, then it is possible to overlay two grids (kind
> of) like this:
>
>
> library(gstat)
> library(latticeExtra)
> library(grid)
>
> # load example data
> data(meuse.grid)
> coordinates(meuse.grid) <- ~ x + y
> gridded(meuse.grid) <- TRUE
>
> # hacked version of sp.grid()
> sp.grid <- function (obj, col = 1, alpha = 1, ...)
> {
> ? ?if (is.character(obj))
> ? ? ? ?obj = get(obj)
> ? ?xy = coordinates(obj)
> ? ?if (length(col) != 1 && length(col) != nrow(xy)) {
> ? ?}
> ? ?gt = as(getGridTopology(obj), "data.frame")
> ? ?grid.rect(x = xy[, 1], y = xy[, 2], width = gt$cellsize[1],
> ? ? ? ?height = gt$cellsize[2], default.units = "native", gp =
> gpar(fill = col, col = NA, alpha = alpha))
> }
>
>
> # nice colors
> trellis.par.set(regions=custom.theme()$regions,
> superpose.polygon=list(col='black', alpha=0.25))
>
> # first grid covers entire extent
> p3 <- spplot(meuse.grid, 'dist', colorkey=list(space='bottom',
> width=1, height=0.5, tick.number=3)
>
> # overlay partially transparent, kind of a hack...
> p3 <- p3 + layer(sp.grid(meuse.grid[meuse.grid$soil == 'A', ],
> col='black', alpha=0.25))
>
> # add a new key
> p3 <- update(p3, key=simpleKey('Bad Stuff', points=FALSE, lines=FALSE,
> rect=TRUE, columns=1, space='top'))
>
> print(p3)
>
> Note that I am using an older version of gstat, version 0.9-63. Maybe
> this code has been updated since then. If not, what do you think? Are
> there any better ways to overlay a couple grids?
>
> Cheers,
> Dylan
>


From edzer.pebesma at uni-muenster.de  Wed Dec 15 17:58:04 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Wed, 15 Dec 2010 17:58:04 +0100
Subject: [R-sig-Geo] Adding a scale bar and north arrow to a ggplot
In-Reply-To: <AANLkTi=Vp+i-gby8KpPAREaXO5e-K_7hx1+WwFgVP839@mail.gmail.com>
References: <4CE588C9.9090100@geo.uu.nl>	<4D087541.6050509@geo.uu.nl>
	<AANLkTi=Vp+i-gby8KpPAREaXO5e-K_7hx1+WwFgVP839@mail.gmail.com>
Message-ID: <4D08F39C.3040504@uni-muenster.de>

I think both packages have good reasons to not want to depend on
eachother, as integrating this in one of them would imply. Your solution
seems a reasonable one to me.

On 12/15/2010 02:07 PM, Hadley Wickham wrote:
> I have a student who is interested in working on more spatial features
> for ggplot2 this summer. That work is likely to involve separating out
> all spatial features from ggplot2 into their own package and that
> would be a good place for this.
> 
> Hadley
> 
> On Wednesday, December 15, 2010, Paul Hiemstra <p.hiemstra at geo.uu.nl> wrote:
>> Hi people,
>>
>> I posted a similar question to the ggplot2 mailing list and with their help and a lot of tinkering I got a well working function to add a scalebar to a ggplot plot. I could add the function to automap, but is there another package which would be more appropraite, e.g. sp (Roger?)?
>>
>> cheers,
>> Paul
>>
>> ps: new version of code here:
>>
>> makeNiceNumber = function(num, num.pretty = 1) {
>>   # Rounding provided by code from Maarten Plieger
>>   return((round(num/10^(round(log10(num))-1))*(10^(round(log10(num))-1))))
>> }
>>
>> createBoxPolygon = function(llcorner, width, height) {
>>   relativeCoords = data.frame(c(0, 0, width, width, 0), c(0, height, height, 0, 0))
>>   names(relativeCoords) = names(llcorner)
>>   return(t(apply(relativeCoords, 1, function(x) llcorner + x)))
>> }
>>
>> addScaleBar = function(ggplot_obj, spatial_obj, attribute, addParams = list()) {
>>   addParamsDefaults = list(noBins = 5, xname = "x", yname = "y", unit = "m", placement = "bottomright",
>>                            sbLengthPct = 0.3, sbHeightvsWidth = 1/14)
>>   addParams = modifyList(addParamsDefaults, addParams)
>>
>>   range_x = max(spatial_obj[[addParams[["xname"]]]]) - min(spatial_obj[[addParams[["xname"]]]])
>>   range_y = max(spatial_obj[[addParams[["yname"]]]]) - min(spatial_obj[[addParams[["yname"]]]])
>>   lengthScalebar = addParams[["sbLengthPct"]] * range_x
>>   ## OPTION: use pretty() instead
>>   widthBin = makeNiceNumber(lengthScalebar / addParams[["noBins"]])
>>   heightBin = lengthScalebar * addParams[["sbHeightvsWidth"]]
>>   lowerLeftCornerScaleBar = c(x = max(spatial_obj[[addParams[["xname"]]]]) - (widthBin * addParams[["noBins"]]),
>>                               y = min(spatial_obj[[addParams[["yname"]]]]))
>>
>>   scaleBarPolygon = do.call("rbind", lapply(0:(addParams[["noBins"]] - 1), function(n) {
>>     dum = data.frame(createBoxPolygon(lowerLeftCornerScaleBar + c((n * widthBin), 0), widthBin, heightBin))
>>     if(!(n + 1) %% 2 == 0) dum$cat = "odd" else dum$cat = "even"
>>     return(dum)
>>   }))
>>   scaleBarPolygon[[attribute]] = min(spatial_obj[[attribute]])
>>   textScaleBar = data.frame(x = lowerLeftCornerScaleBar[[addParams[["xname"]]]] + (c(0:(addParams[["noBins"]])) * widthBin),
>>                             y = lowerLeftCornerScaleBar[[addParams[["yname"]]]],
>>                             label = as.character(0:(addParams[["noBins"]]) * widthBin))
>>   textScaleBar[[attribute]] = min(spatial_obj[[attribute]])
>>
>>   return(ggplot_obj +
>>     geom_polygon(data = subset(scaleBarPolygon, cat == "odd"), fill = "black", color = "black", legend = FALSE) +
>>     geom_polygon(data = subset(scaleBarPolygon, cat == "even"), fill = "white", color = "black", legend = FALSE) +
>>     geom_text(aes(label = label), color = "black", size = 6, data = textScaleBar, hjust = 0.5, vjust = 1.2, legend = FALSE))
>> }
>>
>> library(ggplot2)
>> library(sp)
>>
>> data(meuse)
>> data(meuse.grid)
>> ggobj = ggplot(aes(x = x, y = y, color = zinc), data = meuse) + geom_point()
>> # Make sure to increase the graphic device a bit
>> addScaleBar(ggobj, meuse, "zinc", addParams = list(noBins = 5))
>>
>>
>> On 11/18/2010 09:12 PM, Paul Hiemstra wrote:
>>
>> Dear list,
>>
>> A common addition to any spatial plot are a north arrow and a scale bar. I've searched online for a straightforward way to add those to a ggplot plot. I then decided to give a go myself. A crude first attempt for an automatic scalebar addition function is listed below. The example works for the meuse dataset, but a second with a different dataset did yield good results.
>>
>> My question to you is: is there anyone who has some good tips / example code to add a north arrow and a scalebar to a ggplot image. Any expansions on the code below are also welcome.
>>
>> cheers,
>> Paul
>>
>> ps Some info on my system is listed at the very bottom
>>
>> library(sp)
>> library(ggplot2)
>>
>> data(meuse)
>> data(meuse.grid)
>>
>> string.length = function(s) {
>> #  browser()
>>   if(!is.character(s)) s = as.character(s)
>>   length(strsplit(s, "")[[1]])
>> }
>>
>> makeNiceNumber = function(num, num.pretty = 1) {
>>   noNumbers = string.length(as.character(round(num)))
>>   return(round(num / 10^(noNumbers - num.pretty)) * 10^(noNumbers - num.pretty))
>> }
>>
>> makeScaleBar = function(obj, plotname, xname = "x", yname = "y", unit = "m", placement = "bottomright") {
>> #     browser()
>>   range_x = max(obj[[xname]]) - min(obj[[xname]])
>>   range_y = max(obj[[yname]]) - min(obj[[yname]])
>>   if(placement == "bottomright") {
>>     xcoor.max = makeNiceNumber(max(obj[[xname]]) - (0.05 *range_x ), string.length(round(max(obj[[xname]]))) - string.length(round(0.3 * range_x)))
>>     xcoor.min = makeNiceNumber(max(obj[[xname]]) - (0.5 *range_x ), string.length(round(max(obj[[xname]]))) - string.length(round(0.3 * range_x)))
>>     ycoor = min(obj[[yname]]) + (0.05 * range_y)
>>   } else {
>>     xcoor.min = makeNiceNumber(max(obj[[xname]]) - (0.95 *range_x ), string.length(round(max(obj[[xname]]))) - string.length(round(0.3 * range_x)))
>>     xcoor.max = makeNiceNumber(max(obj[[xname]]) - (0.5 *range_x ), string.length(round(max(obj[[xname]]))) - string.length(round(0.3 * range_x)))
>>     ycoor = min(obj[[yname]]) + (0.95 * range_y)
>>   }
>>   scalebar.data = data.frame(x = c(xcoor.max, xcoor.min), y = ycoor, lbl = c(paste(xcoor.max - xcoor.min, unit), 0))
>>   scalebar.data[[plotname]] = min(obj[[plotname]])
>>   return(list(geom_path(aes(x = x, y = y), data = scalebar.data, lwd = 2, color = "black"),
>>           geom_text(aes(x = x, y = y, label = lbl), data = scalebar.data, vjust = 1.3)))
>> }
>>
>> sb = makeScaleBar(meuse.grid, "dist", placement = "topright")
>> ggplot(aes(x  = x, y = y, fill = dist), data = meuse.grid) + geom_tile() + sb[[1]] + sb[[2]]
>>
>> R version 2.12.0 (2010-10-15)
>> Platform: i486-pc-linux-gnu (32-bit)
>>
>> locale:
>>  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
>>  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
>>  [5] LC_MONETARY=C              LC_MESSAGES=en_US.UTF-8
>>  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C
>>  [9] LC_ADDRESS=C               LC_TELEPHONE=C
>> [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C
>>
>> attached base packages:
>> [1] grid      stats     graphics  grDevices utils     datasets  methods
>> [8] base
>>
>> other attached packages:
>> [1] ggplot2_0.8.7 digest_0.4.2  reshape_0.8.3 plyr_0.1.9    proto_0.3-8
>> [6] sp_0.9-62
>>
>> loaded via a namespace (and not attached):
>> [1] lattice_0.19-13
>>
>> hiemstra at fg-113:~$ uname -a
>> Linux fg-113 2.6.32-21-generic #32-Ubuntu SMP Fri Apr 16 08:10:02 UTC 2010 i686 GNU/Linux
>>
>>
>>
>>
>> --
>> Paul Hiemstra, MSc
>> Department of Physical Geography
>> Faculty of Geosciences
>> University of Utrecht
>> Heidelberglaan 2
>> P.O. Box 80.115
>> 3508 TC Utrecht
>> Phone:  +3130 253 5773
>> http://intamap.geo.uu.nl/~paul
>> http://nl.linkedin.com/pub/paul-hiemstra/20/30b/770
>>
>> currently @ KNMI
>> paul.hiemstra_AT_knmi.nl
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From Colin.bleay at bristol.ac.uk  Wed Dec 15 17:59:00 2010
From: Colin.bleay at bristol.ac.uk (Colin Bleay)
Date: Wed, 15 Dec 2010 16:59:00 +0000
Subject: [R-sig-Geo] assertion failure on call to r.cost & v.what.rast
Message-ID: <4D08F3D4.9010108@Bristol.ac.uk>

I am running a script in R that calls functions in grass from a 
iterative loop.

This works fine but every so often I get an assertion failure.

This does not appear to be a function of the data I am sending to the 
grass executable.

The assertion failure throws up a window allowing me to 'abort', 'retry' 
or 'ignore'.

If i 'retry' it then asks me to close the program (the grass executable) 
and then the R script carries on as usual. i.e. the retry works and I 
will end up with all my data.

The problem i have is that I wish to let this r script run over night 
but i cannot as I have to be there to supervise it, to 'retry' the commands.

so my questions are:

1. Does any body have any idea why these assertion failures are occuring?
2. Does anybody have any idea how I might be able to catch these 
failures so that I can get R to retry the grass executable rather than 
myself.

the error the grass executable throws is:

"Assertion failed!
Program: C\GRASS_64\bin\RCOST~1.EXE
File:r:\pismere\athena\auth\krb5\scr\li..\g_initialize.c
Line:76

Expression: (&(&g_mechListLock)->os)->is_locked==1"




-- 
********************************************************************************** 
********************************************************************************** 
Dr Colin Bleay Station d'Ecologie Experimentale du CNRS, 09200 Moulis, 
France. Tel: +33 5 61 04 03 61 Fax: +33 5 61 96 08 51 email: 
Colin.Bleay at EcoEx-Moulis.cnrs.fr Webpage: 
http://www.ecoex-moulis.cnrs.fr/Staffpages/ColinBleay.htm


From edzer.pebesma at uni-muenster.de  Wed Dec 15 18:13:05 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Wed, 15 Dec 2010 18:13:05 +0100
Subject: [R-sig-Geo] suggestion for sp.grid()
In-Reply-To: <AANLkTinyCfFQRsqVFz2XzL-Gx7p-_meLvrdqHWPYqyQ1@mail.gmail.com>
References: <AANLkTi=Rb9AYeJiWHLxumcMNAN0PEw_QwXdoVx1gkVZr@mail.gmail.com>
	<AANLkTinyCfFQRsqVFz2XzL-Gx7p-_meLvrdqHWPYqyQ1@mail.gmail.com>
Message-ID: <4D08F721.10002@uni-muenster.de>

Thanks for the clear example, Dylan. I made this change, and it will be
in the next version of sp.

On 12/15/2010 05:57 PM, Dylan Beaudette wrote:
> Shouldn't be posting questions late into the night. I realized that my
> example was not reproducible.
> 
> One more time:
> 
> # setup environment
> library(gstat)
> library(latticeExtra)
> library(grid)
> 
> # load example data
> data(meuse.grid)
> 
> coordinates(meuse.grid) <- ~ x + y
> gridded(meuse.grid) <- TRUE
> meuse.grid$soil <- factor(meuse.grid$soil, labels=c('A','B','C'))
> 
> 
> # hacked version of sp.grid()
> sp.grid <- function (obj, col = 1, alpha = 1, ...)
> {
>     if (is.character(obj))
>         obj = get(obj)
>     xy = coordinates(obj)
>     if (length(col) != 1 && length(col) != nrow(xy)) {
>     }
>     gt = as(getGridTopology(obj), "data.frame")
>     grid.rect(x = xy[, 1], y = xy[, 2], width = gt$cellsize[1],
>         height = gt$cellsize[2], default.units = "native", gp =
> gpar(fill = col, col = NA, alpha = alpha))
> }
> 
> 
> trellis.par.set(regions=custom.theme()$regions,
> superpose.polygon=list(col='black', alpha=0.25))
> 
> # first grid covers entire extent
> p3 <- spplot(meuse.grid, 'dist', colorkey=list(space='bottom',
> width=1, height=0.5, tick.number=3))
> 
> # overlay partially transparent, kind of a hack...
> p3 <- p3 + layer(sp.grid(meuse.grid[meuse.grid$soil == 'A', ],
> col='black', alpha=0.25))
> 
> p3 <- update(p3, key=simpleKey('Shaded Region', points=FALSE,
> lines=FALSE, rect=TRUE, columns=1, space='top'))
> 
> p3
> 
> 
> 
> 
> On Tue, Dec 14, 2010 at 11:32 PM, Dylan Beaudette
> <dylan.beaudette at gmail.com> wrote:
>> Hi,
>>
>> I was tinkering around with some of the new functions from the
>> latticeExtra package, and thought of a (messy) hack for plotting
>> multiple grids. However, due to the way sp.grid() is currently coded,
>> there is no way to define both grid fill color _and_ outline color:
>>
>> gp = gpar(fill = col, col = NULL, alpha = alpha)
>>
>> if this line is changed to...
>>
>> gp = gpar(fill = col, col = NA, alpha = alpha)
>>
>> then outlines will default to no color... It might be nice to add a
>> new parameter to sp.grid() to allow the user to set the outline color
>> of the rectangles produced by grid.rect(). If the above line is
>> changed so that col=NA, then it is possible to overlay two grids (kind
>> of) like this:
>>
>>
>> library(gstat)
>> library(latticeExtra)
>> library(grid)
>>
>> # load example data
>> data(meuse.grid)
>> coordinates(meuse.grid) <- ~ x + y
>> gridded(meuse.grid) <- TRUE
>>
>> # hacked version of sp.grid()
>> sp.grid <- function (obj, col = 1, alpha = 1, ...)
>> {
>>    if (is.character(obj))
>>        obj = get(obj)
>>    xy = coordinates(obj)
>>    if (length(col) != 1 && length(col) != nrow(xy)) {
>>    }
>>    gt = as(getGridTopology(obj), "data.frame")
>>    grid.rect(x = xy[, 1], y = xy[, 2], width = gt$cellsize[1],
>>        height = gt$cellsize[2], default.units = "native", gp =
>> gpar(fill = col, col = NA, alpha = alpha))
>> }
>>
>>
>> # nice colors
>> trellis.par.set(regions=custom.theme()$regions,
>> superpose.polygon=list(col='black', alpha=0.25))
>>
>> # first grid covers entire extent
>> p3 <- spplot(meuse.grid, 'dist', colorkey=list(space='bottom',
>> width=1, height=0.5, tick.number=3)
>>
>> # overlay partially transparent, kind of a hack...
>> p3 <- p3 + layer(sp.grid(meuse.grid[meuse.grid$soil == 'A', ],
>> col='black', alpha=0.25))
>>
>> # add a new key
>> p3 <- update(p3, key=simpleKey('Bad Stuff', points=FALSE, lines=FALSE,
>> rect=TRUE, columns=1, space='top'))
>>
>> print(p3)
>>
>> Note that I am using an older version of gstat, version 0.9-63. Maybe
>> this code has been updated since then. If not, what do you think? Are
>> there any better ways to overlay a couple grids?
>>
>> Cheers,
>> Dylan
>>
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From dylan.beaudette at gmail.com  Wed Dec 15 18:24:41 2010
From: dylan.beaudette at gmail.com (Dylan Beaudette)
Date: Wed, 15 Dec 2010 09:24:41 -0800
Subject: [R-sig-Geo] suggestion for sp.grid()
In-Reply-To: <4D08F721.10002@uni-muenster.de>
References: <AANLkTi=Rb9AYeJiWHLxumcMNAN0PEw_QwXdoVx1gkVZr@mail.gmail.com>
	<AANLkTinyCfFQRsqVFz2XzL-Gx7p-_meLvrdqHWPYqyQ1@mail.gmail.com>
	<4D08F721.10002@uni-muenster.de>
Message-ID: <AANLkTikU6yCaHtairF38AnuszePAmScPPd-RzH4xpn+C@mail.gmail.com>

Thanks Edzer. It seems like there is increasing interest in the use of
ggplot2 functions for plotting spatial data-- possibly due to the
complexity of lattice graphics. However, I think that the latticeExtra
package [1] may have some exciting new functionality that could make
spplot() a much more attractive option for making maps. I spent a
little time last night tinkering with spplot and legend placement [2].
When I have some more time, I'll see about working up some more
examples using latticeExtra functions.

Cheers,
Dylan

1. http://latticeextra.r-forge.r-project.org/
2. http://casoilresource.lawr.ucdavis.edu/drupal/node/962

On Wed, Dec 15, 2010 at 9:13 AM, Edzer Pebesma
<edzer.pebesma at uni-muenster.de> wrote:
> Thanks for the clear example, Dylan. I made this change, and it will be
> in the next version of sp.
>
> On 12/15/2010 05:57 PM, Dylan Beaudette wrote:
>> Shouldn't be posting questions late into the night. I realized that my
>> example was not reproducible.
>>
>> One more time:
>>
>> # setup environment
>> library(gstat)
>> library(latticeExtra)
>> library(grid)
>>
>> # load example data
>> data(meuse.grid)
>>
>> coordinates(meuse.grid) <- ~ x + y
>> gridded(meuse.grid) <- TRUE
>> meuse.grid$soil <- factor(meuse.grid$soil, labels=c('A','B','C'))
>>
>>
>> # hacked version of sp.grid()
>> sp.grid <- function (obj, col = 1, alpha = 1, ...)
>> {
>> ? ? if (is.character(obj))
>> ? ? ? ? obj = get(obj)
>> ? ? xy = coordinates(obj)
>> ? ? if (length(col) != 1 && length(col) != nrow(xy)) {
>> ? ? }
>> ? ? gt = as(getGridTopology(obj), "data.frame")
>> ? ? grid.rect(x = xy[, 1], y = xy[, 2], width = gt$cellsize[1],
>> ? ? ? ? height = gt$cellsize[2], default.units = "native", gp =
>> gpar(fill = col, col = NA, alpha = alpha))
>> }
>>
>>
>> trellis.par.set(regions=custom.theme()$regions,
>> superpose.polygon=list(col='black', alpha=0.25))
>>
>> # first grid covers entire extent
>> p3 <- spplot(meuse.grid, 'dist', colorkey=list(space='bottom',
>> width=1, height=0.5, tick.number=3))
>>
>> # overlay partially transparent, kind of a hack...
>> p3 <- p3 + layer(sp.grid(meuse.grid[meuse.grid$soil == 'A', ],
>> col='black', alpha=0.25))
>>
>> p3 <- update(p3, key=simpleKey('Shaded Region', points=FALSE,
>> lines=FALSE, rect=TRUE, columns=1, space='top'))
>>
>> p3
>>
>>
>>
>>
>> On Tue, Dec 14, 2010 at 11:32 PM, Dylan Beaudette
>> <dylan.beaudette at gmail.com> wrote:
>>> Hi,
>>>
>>> I was tinkering around with some of the new functions from the
>>> latticeExtra package, and thought of a (messy) hack for plotting
>>> multiple grids. However, due to the way sp.grid() is currently coded,
>>> there is no way to define both grid fill color _and_ outline color:
>>>
>>> gp = gpar(fill = col, col = NULL, alpha = alpha)
>>>
>>> if this line is changed to...
>>>
>>> gp = gpar(fill = col, col = NA, alpha = alpha)
>>>
>>> then outlines will default to no color... It might be nice to add a
>>> new parameter to sp.grid() to allow the user to set the outline color
>>> of the rectangles produced by grid.rect(). If the above line is
>>> changed so that col=NA, then it is possible to overlay two grids (kind
>>> of) like this:
>>>
>>>
>>> library(gstat)
>>> library(latticeExtra)
>>> library(grid)
>>>
>>> # load example data
>>> data(meuse.grid)
>>> coordinates(meuse.grid) <- ~ x + y
>>> gridded(meuse.grid) <- TRUE
>>>
>>> # hacked version of sp.grid()
>>> sp.grid <- function (obj, col = 1, alpha = 1, ...)
>>> {
>>> ? ?if (is.character(obj))
>>> ? ? ? ?obj = get(obj)
>>> ? ?xy = coordinates(obj)
>>> ? ?if (length(col) != 1 && length(col) != nrow(xy)) {
>>> ? ?}
>>> ? ?gt = as(getGridTopology(obj), "data.frame")
>>> ? ?grid.rect(x = xy[, 1], y = xy[, 2], width = gt$cellsize[1],
>>> ? ? ? ?height = gt$cellsize[2], default.units = "native", gp =
>>> gpar(fill = col, col = NA, alpha = alpha))
>>> }
>>>
>>>
>>> # nice colors
>>> trellis.par.set(regions=custom.theme()$regions,
>>> superpose.polygon=list(col='black', alpha=0.25))
>>>
>>> # first grid covers entire extent
>>> p3 <- spplot(meuse.grid, 'dist', colorkey=list(space='bottom',
>>> width=1, height=0.5, tick.number=3)
>>>
>>> # overlay partially transparent, kind of a hack...
>>> p3 <- p3 + layer(sp.grid(meuse.grid[meuse.grid$soil == 'A', ],
>>> col='black', alpha=0.25))
>>>
>>> # add a new key
>>> p3 <- update(p3, key=simpleKey('Bad Stuff', points=FALSE, lines=FALSE,
>>> rect=TRUE, columns=1, space='top'))
>>>
>>> print(p3)
>>>
>>> Note that I am using an older version of gstat, version 0.9-63. Maybe
>>> this code has been updated since then. If not, what do you think? Are
>>> there any better ways to overlay a couple grids?
>>>
>>> Cheers,
>>> Dylan
>>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> --
> Edzer Pebesma
> Institute for Geoinformatics (ifgi), University of M?nster
> Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
> 8333081, Fax: +49 251 8339763 ?http://ifgi.uni-muenster.de
> http://www.52north.org/geostatistics ? ? ?e.pebesma at wwu.de
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From Roger.Bivand at nhh.no  Wed Dec 15 18:42:07 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 15 Dec 2010 18:42:07 +0100 (CET)
Subject: [R-sig-Geo] assertion failure on call to r.cost & v.what.rast
In-Reply-To: <4D08F3D4.9010108@Bristol.ac.uk>
References: <4D08F3D4.9010108@Bristol.ac.uk>
Message-ID: <alpine.LRH.2.00.1012151827261.1355@reclus.nhh.no>

On Wed, 15 Dec 2010, Colin Bleay wrote:

> I am running a script in R that calls functions in grass from a iterative 
> loop.
>
> This works fine but every so often I get an assertion failure.
>
> This does not appear to be a function of the data I am sending to the grass 
> executable.

Colin,

Please repost this on grass-stats:

http://grass.osgeo.org/statsgrass/index.php

as it is only marginally an R question. You may be able to put your 
execGRASS() calls in a try(), but I suspect that because it is running 
through system(), the answer is perhaps on the GRASS side, and may not be 
practical or easy. It may well be that the GRASS program is trying to use 
resources on your computer that Kerberos has locked - the g_mechListLock 
variable does not seem to be used in GRASS, and the g_initialize.c file 
seems to be part of Kerberos, not GRASS. How this works on Windows is not 
for regular humans to know about, I'm afraid.

Is your machine running under a tight security regime, perhaps? Can you 
try out your script on a different computer not using networked disk 
drives? It could also be a function of the environment in which the GRASS 
Windows binaries were built. Can you try having the repeated calls to 
execGRASS() separated by pauses, or have it do something else to let 
Kerberos recover its posture?

Roger

>
> The assertion failure throws up a window allowing me to 'abort', 'retry' or 
> 'ignore'.
>
> If i 'retry' it then asks me to close the program (the grass executable) and 
> then the R script carries on as usual. i.e. the retry works and I will end up 
> with all my data.
>
> The problem i have is that I wish to let this r script run over night but i 
> cannot as I have to be there to supervise it, to 'retry' the commands.
>
> so my questions are:
>
> 1. Does any body have any idea why these assertion failures are occuring?
> 2. Does anybody have any idea how I might be able to catch these failures so 
> that I can get R to retry the grass executable rather than myself.
>
> the error the grass executable throws is:
>
> "Assertion failed!
> Program: C\GRASS_64\bin\RCOST~1.EXE
> File:r:\pismere\athena\auth\krb5\scr\li..\g_initialize.c
> Line:76
>
> Expression: (&(&g_mechListLock)->os)->is_locked==1"
>
>
>
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From Colin.bleay at bristol.ac.uk  Wed Dec 15 19:00:05 2010
From: Colin.bleay at bristol.ac.uk (Colin Bleay)
Date: Wed, 15 Dec 2010 18:00:05 +0000
Subject: [R-sig-Geo] assertion failure on call to r.cost & v.what.rast
In-Reply-To: <alpine.LRH.2.00.1012151827261.1355@reclus.nhh.no>
References: <4D08F3D4.9010108@Bristol.ac.uk>
	<alpine.LRH.2.00.1012151827261.1355@reclus.nhh.no>
Message-ID: <4D090225.2000803@Bristol.ac.uk>

Roger,

thanks for the response. i will repost on grass-stats.

but to awnser you questions.

There is no security issue, and i have tried pausing with Sys.sleep() 
and using withRestarts () (although i confess I am not confident that i 
have coded this appropriatly).

colin

On 15/12/2010 17:42, Roger Bivand wrote:
> On Wed, 15 Dec 2010, Colin Bleay wrote:
>
>> I am running a script in R that calls functions in grass from a 
>> iterative loop.
>>
>> This works fine but every so often I get an assertion failure.
>>
>> This does not appear to be a function of the data I am sending to the 
>> grass executable.
>
> Colin,
>
> Please repost this on grass-stats:
>
> http://grass.osgeo.org/statsgrass/index.php
>
> as it is only marginally an R question. You may be able to put your 
> execGRASS() calls in a try(), but I suspect that because it is running 
> through system(), the answer is perhaps on the GRASS side, and may not 
> be practical or easy. It may well be that the GRASS program is trying 
> to use resources on your computer that Kerberos has locked - the 
> g_mechListLock variable does not seem to be used in GRASS, and the 
> g_initialize.c file seems to be part of Kerberos, not GRASS. How this 
> works on Windows is not for regular humans to know about, I'm afraid.
>
> Is your machine running under a tight security regime, perhaps? Can 
> you try out your script on a different computer not using networked 
> disk drives? It could also be a function of the environment in which 
> the GRASS Windows binaries were built. Can you try having the repeated 
> calls to execGRASS() separated by pauses, or have it do something else 
> to let Kerberos recover its posture?
>
> Roger
>
>>
>> The assertion failure throws up a window allowing me to 'abort', 
>> 'retry' or 'ignore'.
>>
>> If i 'retry' it then asks me to close the program (the grass 
>> executable) and then the R script carries on as usual. i.e. the retry 
>> works and I will end up with all my data.
>>
>> The problem i have is that I wish to let this r script run over night 
>> but i cannot as I have to be there to supervise it, to 'retry' the 
>> commands.
>>
>> so my questions are:
>>
>> 1. Does any body have any idea why these assertion failures are 
>> occuring?
>> 2. Does anybody have any idea how I might be able to catch these 
>> failures so that I can get R to retry the grass executable rather 
>> than myself.
>>
>> the error the grass executable throws is:
>>
>> "Assertion failed!
>> Program: C\GRASS_64\bin\RCOST~1.EXE
>> File:r:\pismere\athena\auth\krb5\scr\li..\g_initialize.c
>> Line:76
>>
>> Expression: (&(&g_mechListLock)->os)->is_locked==1"
>>
>>
>>
>>
>>
>

-- 
**********************************************************************************
**********************************************************************************

Dr Colin Bleay
Station d'Ecologie Experimentale du CNRS,
09200 Moulis,
France.

Tel: +33 5 61 04 03 61
Fax: +33 5 61 96 08 51
email: Colin.Bleay at EcoEx-Moulis.cnrs.fr
Webpage: http://www.ecoex-moulis.cnrs.fr/Staffpages/ColinBleay.htm


From edzer.pebesma at uni-muenster.de  Wed Dec 15 20:09:08 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Wed, 15 Dec 2010 20:09:08 +0100
Subject: [R-sig-Geo] suggestion for sp.grid()
In-Reply-To: <AANLkTikU6yCaHtairF38AnuszePAmScPPd-RzH4xpn+C@mail.gmail.com>
References: <AANLkTi=Rb9AYeJiWHLxumcMNAN0PEw_QwXdoVx1gkVZr@mail.gmail.com>	<AANLkTinyCfFQRsqVFz2XzL-Gx7p-_meLvrdqHWPYqyQ1@mail.gmail.com>	<4D08F721.10002@uni-muenster.de>
	<AANLkTikU6yCaHtairF38AnuszePAmScPPd-RzH4xpn+C@mail.gmail.com>
Message-ID: <4D091254.3090202@uni-muenster.de>

I just looked a long time at a comparison between both at:

http://learnr.wordpress.com/2009/08/26/ggplot2-version-of-figures-in-lattice-multivariate-data-visualization-with-r-final-part/

Your inline example, and that in your [2] below are good illustrations
of the enhanced usability (readability) of lattice/latticeExtra syntax -
thanks!

On 12/15/2010 06:24 PM, Dylan Beaudette wrote:
> Thanks Edzer. It seems like there is increasing interest in the use of
> ggplot2 functions for plotting spatial data-- possibly due to the
> complexity of lattice graphics. However, I think that the latticeExtra
> package [1] may have some exciting new functionality that could make
> spplot() a much more attractive option for making maps. I spent a
> little time last night tinkering with spplot and legend placement [2].
> When I have some more time, I'll see about working up some more
> examples using latticeExtra functions.
> 
> Cheers,
> Dylan
> 
> 1. http://latticeextra.r-forge.r-project.org/
> 2. http://casoilresource.lawr.ucdavis.edu/drupal/node/962
> 
> On Wed, Dec 15, 2010 at 9:13 AM, Edzer Pebesma
> <edzer.pebesma at uni-muenster.de> wrote:
>> Thanks for the clear example, Dylan. I made this change, and it will be
>> in the next version of sp.
>>
>> On 12/15/2010 05:57 PM, Dylan Beaudette wrote:
>>> Shouldn't be posting questions late into the night. I realized that my
>>> example was not reproducible.
>>>
>>> One more time:
>>>
>>> # setup environment
>>> library(gstat)
>>> library(latticeExtra)
>>> library(grid)
>>>
>>> # load example data
>>> data(meuse.grid)
>>>
>>> coordinates(meuse.grid) <- ~ x + y
>>> gridded(meuse.grid) <- TRUE
>>> meuse.grid$soil <- factor(meuse.grid$soil, labels=c('A','B','C'))
>>>
>>>
>>> # hacked version of sp.grid()
>>> sp.grid <- function (obj, col = 1, alpha = 1, ...)
>>> {
>>>     if (is.character(obj))
>>>         obj = get(obj)
>>>     xy = coordinates(obj)
>>>     if (length(col) != 1 && length(col) != nrow(xy)) {
>>>     }
>>>     gt = as(getGridTopology(obj), "data.frame")
>>>     grid.rect(x = xy[, 1], y = xy[, 2], width = gt$cellsize[1],
>>>         height = gt$cellsize[2], default.units = "native", gp =
>>> gpar(fill = col, col = NA, alpha = alpha))
>>> }
>>>
>>>
>>> trellis.par.set(regions=custom.theme()$regions,
>>> superpose.polygon=list(col='black', alpha=0.25))
>>>
>>> # first grid covers entire extent
>>> p3 <- spplot(meuse.grid, 'dist', colorkey=list(space='bottom',
>>> width=1, height=0.5, tick.number=3))
>>>
>>> # overlay partially transparent, kind of a hack...
>>> p3 <- p3 + layer(sp.grid(meuse.grid[meuse.grid$soil == 'A', ],
>>> col='black', alpha=0.25))
>>>
>>> p3 <- update(p3, key=simpleKey('Shaded Region', points=FALSE,
>>> lines=FALSE, rect=TRUE, columns=1, space='top'))
>>>
>>> p3
>>>
>>>
>>>
>>>
>>> On Tue, Dec 14, 2010 at 11:32 PM, Dylan Beaudette
>>> <dylan.beaudette at gmail.com> wrote:
>>>> Hi,
>>>>
>>>> I was tinkering around with some of the new functions from the
>>>> latticeExtra package, and thought of a (messy) hack for plotting
>>>> multiple grids. However, due to the way sp.grid() is currently coded,
>>>> there is no way to define both grid fill color _and_ outline color:
>>>>
>>>> gp = gpar(fill = col, col = NULL, alpha = alpha)
>>>>
>>>> if this line is changed to...
>>>>
>>>> gp = gpar(fill = col, col = NA, alpha = alpha)
>>>>
>>>> then outlines will default to no color... It might be nice to add a
>>>> new parameter to sp.grid() to allow the user to set the outline color
>>>> of the rectangles produced by grid.rect(). If the above line is
>>>> changed so that col=NA, then it is possible to overlay two grids (kind
>>>> of) like this:
>>>>
>>>>
>>>> library(gstat)
>>>> library(latticeExtra)
>>>> library(grid)
>>>>
>>>> # load example data
>>>> data(meuse.grid)
>>>> coordinates(meuse.grid) <- ~ x + y
>>>> gridded(meuse.grid) <- TRUE
>>>>
>>>> # hacked version of sp.grid()
>>>> sp.grid <- function (obj, col = 1, alpha = 1, ...)
>>>> {
>>>>    if (is.character(obj))
>>>>        obj = get(obj)
>>>>    xy = coordinates(obj)
>>>>    if (length(col) != 1 && length(col) != nrow(xy)) {
>>>>    }
>>>>    gt = as(getGridTopology(obj), "data.frame")
>>>>    grid.rect(x = xy[, 1], y = xy[, 2], width = gt$cellsize[1],
>>>>        height = gt$cellsize[2], default.units = "native", gp =
>>>> gpar(fill = col, col = NA, alpha = alpha))
>>>> }
>>>>
>>>>
>>>> # nice colors
>>>> trellis.par.set(regions=custom.theme()$regions,
>>>> superpose.polygon=list(col='black', alpha=0.25))
>>>>
>>>> # first grid covers entire extent
>>>> p3 <- spplot(meuse.grid, 'dist', colorkey=list(space='bottom',
>>>> width=1, height=0.5, tick.number=3)
>>>>
>>>> # overlay partially transparent, kind of a hack...
>>>> p3 <- p3 + layer(sp.grid(meuse.grid[meuse.grid$soil == 'A', ],
>>>> col='black', alpha=0.25))
>>>>
>>>> # add a new key
>>>> p3 <- update(p3, key=simpleKey('Bad Stuff', points=FALSE, lines=FALSE,
>>>> rect=TRUE, columns=1, space='top'))
>>>>
>>>> print(p3)
>>>>
>>>> Note that I am using an older version of gstat, version 0.9-63. Maybe
>>>> this code has been updated since then. If not, what do you think? Are
>>>> there any better ways to overlay a couple grids?
>>>>
>>>> Cheers,
>>>> Dylan
>>>>
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>> --
>> Edzer Pebesma
>> Institute for Geoinformatics (ifgi), University of M?nster
>> Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
>> 8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
>> http://www.52north.org/geostatistics      e.pebesma at wwu.de
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From massimodisasha at gmail.com  Wed Dec 15 20:58:30 2010
From: massimodisasha at gmail.com (Massimo Di Stefano)
Date: Wed, 15 Dec 2010 14:58:30 -0500
Subject: [R-sig-Geo] help with Ordinary Kriging with R (singular matrix
	error)
In-Reply-To: <1292358864.10902.19.camel@stereo1>
References: <1292358864.10902.19.camel@stereo1>
Message-ID: <1292443110.32144.28.camel@stereo1>

I tried to go ahead to fix my problem with R and Kriging ..

as the example i tried produce a bad varuiogram fitting (maybe my fault)
i tried the package automap using the following sintax :



d <- read.csv('/home/habcam/scl.csv')
e <- na.omit(d)
coordinates(e) <- ~ x+y
variogram = autofitVariogram(scallop_de~1,e)
plot(variogram)
x.range <- as.integer(range(e at coords[,1]))
y.range <- as.integer(range(e at coords[,2]))
grd <- expand.grid(x=seq(from=x.range[1], to=x.range[2], by=300),
y=seq(from=y.range[1], to=y.range[2], by=300) )
gridded(grd) =~ x+y

kriging_result = autoKrige(scallop_de ~ 1, e, grd)
Warning in autoKrige(scallop_de ~ 1, e, grd) :
  Removed 2018 duplicate observation(s) in input_data:
              coordinates   cat scallop_de
2       (677919, 4546180)     2       2.05
20      (678847, 4545330)    20       2.02
59      (682175, 4541480)    59       0.81
...
...
...
21808   (684423, 4591090) 21808       1.35
21810   (684417, 4591090) 21810       1.71
21815   (684396, 4591090) 21815       1.53
21821   (684346, 4591090) 21821       1.06
21827   (684249, 4591090) 21827       2.66
21948   (699146, 4595160) 21948       1.42
[using ordinary kriging]




but R start to think ... and nver ends, after more than 1 hour i killed
the process :-( 

have you any suggestion on how can i "krige" my data [1] ?

 [1] files.me.com/epiesasha/ynl85n



i also tried a different approach using :

mydata <- read.csv("file.csv")
library(sp)
coordinates(mydata) <- c("x","y")
library(rgdal)
writeOGR(obj=mydata,driver="ESRI Shapefile",dsn=".",layer="mydata")


library(gstat)
library(rgdal)
mydata <- readOGR(dsn=".",layer="mydata")
plot(variogram(mydata at data$scallop_de~1,mydata, cloud=TRUE))

the last line produce an R crash ... after freezed the computer.


are 25000 points too mutch data for R ?



On Tue, 2010-12-14 at 15:34 -0500, Massimo Di Stefano wrote:
> Hello All,
> 
> I'm tring to perfotm an ordinary Kriging interpolation on aset of data.
> It's my 'first real attempt' with R and Kriging, so please apologize my
> mistake ... i'm slowly tring to learn it.
> 
> The dataset i'm working on is a shp file, for convenience (to better
> follow the notes i find on [1] ) i converted it to sc.csv (attached
> there [2]).
> 
> 
> I tried using the following code in R :
> 
> 
> 
> 
> """
> library(gstat)
> d <- read.csv('sc.csv')
> e <- na.omit(d)
> coordinates(e) <- ~ x+y
> bubble(e, zcol='scallop_co', fill=FALSE, do.sqrt=FALSE, maxsize=2)
> x.range <- as.integer(range(e at coords[,1]))
> y.range <- as.integer(range(e at coords[,2]))
> grd <- expand.grid(x=seq(from=x.range[1], to=x.range[2], by=500),
> y=seq(from=y.range[1], to=y.range[2], by=500) )
> coordinates(grd) <- ~ x+y
> gridded(grd) <- TRUE
> plot(grd, cex=0.5)
> points(e, pch=1, col='red', cex=0.7)
> title("Interpolation Grid and Sample Points")
> 
> g <- gstat(id="elev", formula=scallop_co ~ 1, data=e)
> plot(variogram(g, map=TRUE, cutoff=4000, width=200), threshold=10)
> v <- variogram(g, alpha=c(0,45,90,135))
> v.fit <- fit.variogram(v, model=vgm(model='Lin' , anis=c(0, 0.5)))
> plot(v, model=v.fit, as.table=TRUE)
> g <- gstat(g, id="scallop_co", model=v.fit )
> 
> ## perform ordinary kriging prediction:
> p <- predict(g, model=v.fit, newdata=grd)
> """
> 
> It gived me the error :
> 
> > p <- predict(g, model=v.fit, newdata=grd)
> [using ordinary kriging]
> 
> "chfactor.c", line 130: singular matrix in function LDLfactor()
> Error in predict.gstat(g, model = v.fit, newdata = grd) : LDLfactor
> 
> 
> it is probably that i have to change some parameters in the previouse
> code, i'm tring to learn but i've not yet any clue on how to fix it.
> 
> 
> i tried to add more value in when i create the directional variogram :
> 
> """
> v <- variogram(g, alpha=c(0,10,20,30,40,45,50,60,70,80,90,100,110,135))
> 
> """
> the results is attached at [3]
>  
> my sessionInfo is :
> 
> """
> > sessionInfo()
> R version 2.12.0 (2010-10-15)
> Platform: x86_64-pc-linux-gnu (64-bit)
> 
> locale:
>  [1] LC_CTYPE=en_US.utf8       LC_NUMERIC=C             
>  [3] LC_TIME=en_US.utf8        LC_COLLATE=en_US.utf8    
>  [5] LC_MONETARY=C             LC_MESSAGES=en_US.utf8   
>  [7] LC_PAPER=en_US.utf8       LC_NAME=C                
>  [9] LC_ADDRESS=C              LC_TELEPHONE=C           
> [11] LC_MEASUREMENT=en_US.utf8 LC_IDENTIFICATION=C      
> 
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods
> base     
> 
> other attached packages:
> [1] gstat_0.9-74 sp_0.9-74   
> 
> loaded via a namespace (and not attached):
> [1] grid_2.12.0     lattice_0.19-13
> > 
> """
> 
> thankyou a lot for any help!
> 
> thanks,
> 
> Massimo.
> 
> 
> 
> [1] http://casoilresource.lawr.ucdavis.edu/drupal/node/442
> [2] http://www.geofemengineering.it/data/sc.csv
> [3] http://www.geofemengineering.it/data/sc_variogram.png
> 
> 
>


From pierre.roudier at gmail.com  Wed Dec 15 21:27:28 2010
From: pierre.roudier at gmail.com (Pierre Roudier)
Date: Thu, 16 Dec 2010 09:27:28 +1300
Subject: [R-sig-Geo] Adding a scale bar and north arrow to a ggplot
In-Reply-To: <alpine.LRH.2.00.1012150941460.1355@reclus.nhh.no>
References: <4CE588C9.9090100@geo.uu.nl> <4D087541.6050509@geo.uu.nl>
	<alpine.LRH.2.00.1012150941460.1355@reclus.nhh.no>
Message-ID: <AANLkTimnfhf8mdfD6hrzkT2Tr5XLaFv5qWbg+=NkatSd@mail.gmail.com>

I'd love to see a separate, dedicated package bringing spatial
functionalities to ggplot2 - this is such a great tool. However, it
seems to me that a significant problem when using ggplot2 is the lack
of geom dedicated to raster data.

My experience is you can't really deal with big rasters using
geom_tile, it takes too much memory. I guess the development of a
geom_raster is necessary to fully mimic spplot() functionalities - no
idea how demanding an effort would that be.

Pierre

2010/12/15 Roger Bivand <Roger.Bivand at nhh.no>:
> On Wed, 15 Dec 2010, Paul Hiemstra wrote:
>
>> Hi people,
>>
>> I posted a similar question to the ggplot2 mailing list and with their
>> help and a lot of tinkering I got a well working function to add a scalebar
>> to a ggplot plot. I could add the function to automap, but is there another
>> package which would be more appropraite, e.g. sp (Roger?)?
>
> Paul,
>
> If it was added to sp, sp would depend on ggplot2 and its dependencies,
> which are quite extensive, and include a circularity, because ggplot2
> suggests maptools, which in turn depends on sp. Consequently, sp is not a
> good idea. It might even make sense to split sp into sp with just classes
> and methods, and spViz for vizualisation methods, but changing things now is
> a bit late!
>
> It will be cleaner to try to establish the mapping functionality that uses
> ggplot2 and sp as a separate package. Maybe Hadley would see this as a
> sensible development. There are already two supplements to ggplot2 on
> R-forge, but both moribund, I think, which suggests that this needs thinking
> through.
>
> Roger
>
>>
>> cheers,
>> Paul
>>
>> ps: new version of code here:
>>
>> makeNiceNumber = function(num, num.pretty = 1) {
>> ?# Rounding provided by code from Maarten Plieger
>> ?return((round(num/10^(round(log10(num))-1))*(10^(round(log10(num))-1))))
>> }
>>
>> createBoxPolygon = function(llcorner, width, height) {
>> ?relativeCoords = data.frame(c(0, 0, width, width, 0), c(0, height,
>> height, 0, 0))
>> ?names(relativeCoords) = names(llcorner)
>> ?return(t(apply(relativeCoords, 1, function(x) llcorner + x)))
>> }
>>
>> addScaleBar = function(ggplot_obj, spatial_obj, attribute, addParams =
>> list()) {
>> ?addParamsDefaults = list(noBins = 5, xname = "x", yname = "y", unit =
>> "m", placement = "bottomright",
>> ? ? ? ? ? ? ? ? ? ? ? ? ?sbLengthPct = 0.3, sbHeightvsWidth = 1/14)
>> ?addParams = modifyList(addParamsDefaults, addParams)
>>
>> ?range_x = max(spatial_obj[[addParams[["xname"]]]]) -
>> min(spatial_obj[[addParams[["xname"]]]])
>> ?range_y = max(spatial_obj[[addParams[["yname"]]]]) -
>> min(spatial_obj[[addParams[["yname"]]]])
>> ?lengthScalebar = addParams[["sbLengthPct"]] * range_x
>> ?## OPTION: use pretty() instead
>> ?widthBin = makeNiceNumber(lengthScalebar / addParams[["noBins"]])
>> ?heightBin = lengthScalebar * addParams[["sbHeightvsWidth"]]
>> ?lowerLeftCornerScaleBar = c(x = max(spatial_obj[[addParams[["xname"]]]])
>> - (widthBin * addParams[["noBins"]]),
>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? y = min(spatial_obj[[addParams[["yname"]]]]))
>>
>> ?scaleBarPolygon = do.call("rbind", lapply(0:(addParams[["noBins"]] - 1),
>> function(n) {
>> ? dum = data.frame(createBoxPolygon(lowerLeftCornerScaleBar + c((n *
>> widthBin), 0), widthBin, heightBin))
>> ? if(!(n + 1) %% 2 == 0) dum$cat = "odd" else dum$cat = "even"
>> ? return(dum)
>> ?}))
>> ?scaleBarPolygon[[attribute]] = min(spatial_obj[[attribute]])
>> ?textScaleBar = data.frame(x =
>> lowerLeftCornerScaleBar[[addParams[["xname"]]]] +
>> (c(0:(addParams[["noBins"]])) * widthBin),
>> ? ? ? ? ? ? ? ? ? ? ? ? ? y =
>> lowerLeftCornerScaleBar[[addParams[["yname"]]]],
>> ? ? ? ? ? ? ? ? ? ? ? ? ? label = as.character(0:(addParams[["noBins"]]) *
>> widthBin))
>> ?textScaleBar[[attribute]] = min(spatial_obj[[attribute]])
>>
>> ?return(ggplot_obj +
>> ? geom_polygon(data = subset(scaleBarPolygon, cat == "odd"), fill =
>> "black", color = "black", legend = FALSE) +
>> ? geom_polygon(data = subset(scaleBarPolygon, cat == "even"), fill =
>> "white", color = "black", legend = FALSE) +
>> ? geom_text(aes(label = label), color = "black", size = 6, data =
>> textScaleBar, hjust = 0.5, vjust = 1.2, legend = FALSE))
>> }
>>
>> library(ggplot2)
>> library(sp)
>>
>> data(meuse)
>> data(meuse.grid)
>> ggobj = ggplot(aes(x = x, y = y, color = zinc), data = meuse) +
>> geom_point()
>> # Make sure to increase the graphic device a bit
>> addScaleBar(ggobj, meuse, "zinc", addParams = list(noBins = 5))
>>
>>
>> On 11/18/2010 09:12 PM, Paul Hiemstra wrote:
>>>
>>> Dear list,
>>>
>>> A common addition to any spatial plot are a north arrow and a scale bar.
>>> I've searched online for a straightforward way to add those to a ggplot
>>> plot. I then decided to give a go myself. A crude first attempt for an
>>> automatic scalebar addition function is listed below. The example works for
>>> the meuse dataset, but a second with a different dataset did yield good
>>> results.
>>>
>>> My question to you is: is there anyone who has some good tips / example
>>> code to add a north arrow and a scalebar to a ggplot image. Any expansions
>>> on the code below are also welcome.
>>>
>>> cheers,
>>> Paul
>>>
>>> ps Some info on my system is listed at the very bottom
>>>
>>> library(sp)
>>> library(ggplot2)
>>>
>>> data(meuse)
>>> data(meuse.grid)
>>>
>>> string.length = function(s) {
>>> # ?browser()
>>> ?if(!is.character(s)) s = as.character(s)
>>> ?length(strsplit(s, "")[[1]])
>>> }
>>>
>>> makeNiceNumber = function(num, num.pretty = 1) {
>>> ?noNumbers = string.length(as.character(round(num)))
>>> ?return(round(num / 10^(noNumbers - num.pretty)) * 10^(noNumbers -
>>> num.pretty))
>>> }
>>>
>>> makeScaleBar = function(obj, plotname, xname = "x", yname = "y", unit =
>>> "m", placement = "bottomright") {
>>> # ? ? browser()
>>> ?range_x = max(obj[[xname]]) - min(obj[[xname]])
>>> ?range_y = max(obj[[yname]]) - min(obj[[yname]])
>>> ?if(placement == "bottomright") {
>>> ? ?xcoor.max = makeNiceNumber(max(obj[[xname]]) - (0.05 *range_x ),
>>> string.length(round(max(obj[[xname]]))) - string.length(round(0.3 *
>>> range_x)))
>>> ? ?xcoor.min = makeNiceNumber(max(obj[[xname]]) - (0.5 *range_x ),
>>> string.length(round(max(obj[[xname]]))) - string.length(round(0.3 *
>>> range_x)))
>>> ? ?ycoor = min(obj[[yname]]) + (0.05 * range_y)
>>> ?} else {
>>> ? ?xcoor.min = makeNiceNumber(max(obj[[xname]]) - (0.95 *range_x ),
>>> string.length(round(max(obj[[xname]]))) - string.length(round(0.3 *
>>> range_x)))
>>> ? ?xcoor.max = makeNiceNumber(max(obj[[xname]]) - (0.5 *range_x ),
>>> string.length(round(max(obj[[xname]]))) - string.length(round(0.3 *
>>> range_x)))
>>> ? ?ycoor = min(obj[[yname]]) + (0.95 * range_y)
>>> ?}
>>> ?scalebar.data = data.frame(x = c(xcoor.max, xcoor.min), y = ycoor, lbl =
>>> c(paste(xcoor.max - xcoor.min, unit), 0))
>>> ?scalebar.data[[plotname]] = min(obj[[plotname]])
>>> ?return(list(geom_path(aes(x = x, y = y), data = scalebar.data, lwd = 2,
>>> color = "black"),
>>> ? ? ? ? ?geom_text(aes(x = x, y = y, label = lbl), data = scalebar.data,
>>> vjust = 1.3)))
>>> }
>>>
>>> sb = makeScaleBar(meuse.grid, "dist", placement = "topright")
>>> ggplot(aes(x ?= x, y = y, fill = dist), data = meuse.grid) + geom_tile()
>>> + sb[[1]] + sb[[2]]
>>>
>>> R version 2.12.0 (2010-10-15)
>>> Platform: i486-pc-linux-gnu (32-bit)
>>>
>>> locale:
>>> ?[1] LC_CTYPE=en_US.UTF-8 ? ? ? LC_NUMERIC=C
>>> ?[3] LC_TIME=en_US.UTF-8 ? ? ? ?LC_COLLATE=en_US.UTF-8
>>> ?[5] LC_MONETARY=C ? ? ? ? ? ? ?LC_MESSAGES=en_US.UTF-8
>>> ?[7] LC_PAPER=en_US.UTF-8 ? ? ? LC_NAME=C
>>> ?[9] LC_ADDRESS=C ? ? ? ? ? ? ? LC_TELEPHONE=C
>>> [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C
>>>
>>> attached base packages:
>>> [1] grid ? ? ?stats ? ? graphics ?grDevices utils ? ? datasets ?methods
>>> [8] base
>>>
>>> other attached packages:
>>> [1] ggplot2_0.8.7 digest_0.4.2 ?reshape_0.8.3 plyr_0.1.9 ? ?proto_0.3-8
>>> [6] sp_0.9-62
>>>
>>> loaded via a namespace (and not attached):
>>> [1] lattice_0.19-13
>>>
>>> hiemstra at fg-113:~$ uname -a
>>> Linux fg-113 2.6.32-21-generic #32-Ubuntu SMP Fri Apr 16 08:10:02 UTC
>>> 2010 i686 GNU/Linux
>>>
>>
>>
>>
>
> --
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From edzer.pebesma at uni-muenster.de  Wed Dec 15 21:32:29 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Wed, 15 Dec 2010 21:32:29 +0100
Subject: [R-sig-Geo] help with Ordinary Kriging with R (singular matrix
 error)
In-Reply-To: <1292443110.32144.28.camel@stereo1>
References: <1292358864.10902.19.camel@stereo1>
	<1292443110.32144.28.camel@stereo1>
Message-ID: <4D0925DD.6020300@uni-muenster.de>

The default is global kriging, meaning it wants to solve a system of
25000 x 25000. To avoid that, specify nmax to autokrige:

autokrige(..., nmax = 100) # or so

On 12/15/2010 08:58 PM, Massimo Di Stefano wrote:
> I tried to go ahead to fix my problem with R and Kriging ..
> 
> as the example i tried produce a bad varuiogram fitting (maybe my fault)
> i tried the package automap using the following sintax :
> 
> 
> 
> d <- read.csv('/home/habcam/scl.csv')
> e <- na.omit(d)
> coordinates(e) <- ~ x+y
> variogram = autofitVariogram(scallop_de~1,e)
> plot(variogram)
> x.range <- as.integer(range(e at coords[,1]))
> y.range <- as.integer(range(e at coords[,2]))
> grd <- expand.grid(x=seq(from=x.range[1], to=x.range[2], by=300),
> y=seq(from=y.range[1], to=y.range[2], by=300) )
> gridded(grd) =~ x+y
> 
> kriging_result = autoKrige(scallop_de ~ 1, e, grd)
> Warning in autoKrige(scallop_de ~ 1, e, grd) :
>   Removed 2018 duplicate observation(s) in input_data:
>               coordinates   cat scallop_de
> 2       (677919, 4546180)     2       2.05
> 20      (678847, 4545330)    20       2.02
> 59      (682175, 4541480)    59       0.81
> ...
> ...
> ...
> 21808   (684423, 4591090) 21808       1.35
> 21810   (684417, 4591090) 21810       1.71
> 21815   (684396, 4591090) 21815       1.53
> 21821   (684346, 4591090) 21821       1.06
> 21827   (684249, 4591090) 21827       2.66
> 21948   (699146, 4595160) 21948       1.42
> [using ordinary kriging]
> 
> 
> 
> 
> but R start to think ... and nver ends, after more than 1 hour i killed
> the process :-( 
> 
> have you any suggestion on how can i "krige" my data [1] ?
> 
>  [1] files.me.com/epiesasha/ynl85n
> 
> 
> 
> i also tried a different approach using :
> 
> mydata <- read.csv("file.csv")
> library(sp)
> coordinates(mydata) <- c("x","y")
> library(rgdal)
> writeOGR(obj=mydata,driver="ESRI Shapefile",dsn=".",layer="mydata")
> 
> 
> library(gstat)
> library(rgdal)
> mydata <- readOGR(dsn=".",layer="mydata")
> plot(variogram(mydata at data$scallop_de~1,mydata, cloud=TRUE))
> 
> the last line produce an R crash ... after freezed the computer.
> 
> 
> are 25000 points too mutch data for R ?
> 
> 
> 
> On Tue, 2010-12-14 at 15:34 -0500, Massimo Di Stefano wrote:
>> Hello All,
>>
>> I'm tring to perfotm an ordinary Kriging interpolation on aset of data.
>> It's my 'first real attempt' with R and Kriging, so please apologize my
>> mistake ... i'm slowly tring to learn it.
>>
>> The dataset i'm working on is a shp file, for convenience (to better
>> follow the notes i find on [1] ) i converted it to sc.csv (attached
>> there [2]).
>>
>>
>> I tried using the following code in R :
>>
>>
>>
>>
>> """
>> library(gstat)
>> d <- read.csv('sc.csv')
>> e <- na.omit(d)
>> coordinates(e) <- ~ x+y
>> bubble(e, zcol='scallop_co', fill=FALSE, do.sqrt=FALSE, maxsize=2)
>> x.range <- as.integer(range(e at coords[,1]))
>> y.range <- as.integer(range(e at coords[,2]))
>> grd <- expand.grid(x=seq(from=x.range[1], to=x.range[2], by=500),
>> y=seq(from=y.range[1], to=y.range[2], by=500) )
>> coordinates(grd) <- ~ x+y
>> gridded(grd) <- TRUE
>> plot(grd, cex=0.5)
>> points(e, pch=1, col='red', cex=0.7)
>> title("Interpolation Grid and Sample Points")
>>
>> g <- gstat(id="elev", formula=scallop_co ~ 1, data=e)
>> plot(variogram(g, map=TRUE, cutoff=4000, width=200), threshold=10)
>> v <- variogram(g, alpha=c(0,45,90,135))
>> v.fit <- fit.variogram(v, model=vgm(model='Lin' , anis=c(0, 0.5)))
>> plot(v, model=v.fit, as.table=TRUE)
>> g <- gstat(g, id="scallop_co", model=v.fit )
>>
>> ## perform ordinary kriging prediction:
>> p <- predict(g, model=v.fit, newdata=grd)
>> """
>>
>> It gived me the error :
>>
>>> p <- predict(g, model=v.fit, newdata=grd)
>> [using ordinary kriging]
>>
>> "chfactor.c", line 130: singular matrix in function LDLfactor()
>> Error in predict.gstat(g, model = v.fit, newdata = grd) : LDLfactor
>>
>>
>> it is probably that i have to change some parameters in the previouse
>> code, i'm tring to learn but i've not yet any clue on how to fix it.
>>
>>
>> i tried to add more value in when i create the directional variogram :
>>
>> """
>> v <- variogram(g, alpha=c(0,10,20,30,40,45,50,60,70,80,90,100,110,135))
>>
>> """
>> the results is attached at [3]
>>  
>> my sessionInfo is :
>>
>> """
>>> sessionInfo()
>> R version 2.12.0 (2010-10-15)
>> Platform: x86_64-pc-linux-gnu (64-bit)
>>
>> locale:
>>  [1] LC_CTYPE=en_US.utf8       LC_NUMERIC=C             
>>  [3] LC_TIME=en_US.utf8        LC_COLLATE=en_US.utf8    
>>  [5] LC_MONETARY=C             LC_MESSAGES=en_US.utf8   
>>  [7] LC_PAPER=en_US.utf8       LC_NAME=C                
>>  [9] LC_ADDRESS=C              LC_TELEPHONE=C           
>> [11] LC_MEASUREMENT=en_US.utf8 LC_IDENTIFICATION=C      
>>
>> attached base packages:
>> [1] stats     graphics  grDevices utils     datasets  methods
>> base     
>>
>> other attached packages:
>> [1] gstat_0.9-74 sp_0.9-74   
>>
>> loaded via a namespace (and not attached):
>> [1] grid_2.12.0     lattice_0.19-13
>>>
>> """
>>
>> thankyou a lot for any help!
>>
>> thanks,
>>
>> Massimo.
>>
>>
>>
>> [1] http://casoilresource.lawr.ucdavis.edu/drupal/node/442
>> [2] http://www.geofemengineering.it/data/sc.csv
>> [3] http://www.geofemengineering.it/data/sc_variogram.png
>>
>>
>>
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From pierre.roudier at gmail.com  Wed Dec 15 22:03:49 2010
From: pierre.roudier at gmail.com (Pierre Roudier)
Date: Thu, 16 Dec 2010 10:03:49 +1300
Subject: [R-sig-Geo] problem with gridded
In-Reply-To: <AANLkTimY871Tz-8Cn9Sh_AHauyJU0+jLaXT=F4AF4Eny@mail.gmail.com>
References: <AANLkTi=KhX_rbuJ9wXOJf7_Gm-nOoG3TdjMv_-Dz1hAZ@mail.gmail.com>
	<AANLkTinbjB6_etSxcr3Vi4ogMA244-szDRMXvXXPc7=9@mail.gmail.com>
	<AANLkTi=ET0J5HuMBz0H5ZSo2UrTQ8z-XcHBvWOnPkqeu@mail.gmail.com>
	<AANLkTi=-_kKP=3Nb+un4XqgBNVrV9GcfmoSZzJVqOUQR@mail.gmail.com>
	<AANLkTimY871Tz-8Cn9Sh_AHauyJU0+jLaXT=F4AF4Eny@mail.gmail.com>
Message-ID: <AANLkTikTexW4pE--RacD7JfUHoRaDed2r4xyWW=K03ea@mail.gmail.com>

Hi Agnieszka,

I do not understand your question, do you have an example?

Is the problem related to the color ramp of your plot?

2010/12/14 Agnieszka Kaczmarczyk <agnes.kaczmarczyk at gmail.com>:
> Pierre,
> Tkank You for help. I solve problem whit gridded.
> I have next question. How make to fit legend(scale) of plot? I use function
> points().
> Cheers,
> Agnieszka
>
> 2010/12/9 Pierre Roudier <pierre.roudier at gmail.com>
>>
>> Agnieszka,
>>
>> In your code, alu.sp as no attribute because it is an output of the
>> spsample function - it samples spatial locations, not the data itslef.
>> If you look at the class of your objects, alu is a
>> SpatialPointsDataFrame when alu.sp is a SpatialPoints, which means it
>> is just a set of spatial locations, without any attached data frame.
>>
>> Things will be much clearer if:
>> - you give us what exactly you want to achieve. What exactly do you
>> use this spsample function for?
>> - you use an embbeded data set like meuse, as I do not have your alu
>> data set and therefore can't reproduce your code. Just load it like
>> that:
>> data(meuse)
>> coordinates(meuse) <- ~x+y
>>
>> Cheers,
>>
>> Pierre
>>
>> 2010/12/10 Agnieszka Kaczmarczyk <agnes.kaczmarczyk at gmail.com>:
>> > Hello Pierre,
>> > Thank You for answer. It is full code? that I use;
>> > class(alu)
>> > names(alu)
>> > coordinates(alu) = ~x+y
>> > class(alu)
>> > summary(alu)
>> > Object of class SpatialPointsDataFrame
>> > Coordinates:
>> > ????? min???? max
>> > x 4384068 4393091
>> > y 5569911 5579336
>> > Is projected: NA
>> > proj4string : [NA]
>> > Number of points: 1393
>> > Data attributes:
>> > ?? Min. 1st Qu.? Median??? Mean 3rd Qu.??? Max.
>> > ?0.0300? 0.1400? 0.3100? 0.3799? 0.5800? 1.5000
>> > names(alu)
>> > [1] "al"
>> > dimensions(alu)
>> > (alu)[1:2,]
>> > ??? coordinates?? al
>> > 1 (4384100, 5570080) 0.20
>> > 2 (4384070, 5570300) 0.15
>> > it is ok.
>> > alu.sp = spsample(alu, type = "regular", cellsize = c(50,50))
>> > summary(alu.sp)
>> > Object of class SpatialPoints
>> > Coordinates:
>> > ?????? min???? max
>> > x1 4384069 4393069
>> > x2 5569950 5579300
>> > Is projected: NA
>> > proj4string : [NA]
>> > Number of points: 34028
>> > Here atrributes is missing.
>> > I use functions;
>> > ?gridded(alu) = TRUE
>> > Error in points2grid(points, tolerance, round, fuzz.tol) :
>> > ? dimension 1 : coordinate intervals are not constant after allowing for
>> > numeric fuzz
>> > In addition: Warning message:
>> > In points2grid(points, tolerance, round, fuzz.tol) :
>> > ? grid has empty column/rows in dimension 1
>> > ?I can't solve this problem. I change to parameter function and nothing.
>> > I tried other funciton and scheme. It Is my frist problem in R.
>> > Agnieszka
>> >
>> > 2010/12/9 Pierre Roudier <pierre.roudier at gmail.com>
>> >>
>> >> Hi Agnieszka,
>> >>
>> >> This question is not easy to answer because unfortunately you gave
>> >> very few details. I assume you want to use the function gridded() on
>> >> your dataset alu.
>> >>
>> >> First thing you have to do is to make your dataset a Spatial object.
>> >> This is done using the coordinates() function:
>> >>
>> >> library(sp)
>> >> coordinates(alu) <- ~x+y # Again, I'm just guessing x and y are the
>> >> spatial coordinates
>> >> class(alu)
>> >>
>> >> The class of alu should be "SpatialDataFrame"
>> >>
>> >> If your data set is on a *regular* grid, you may want to use the
>> >> gridded() function to make alu a Grid:
>> >>
>> >> gridded(alu) <- TRUE
>> >>
>> >> At this point, you may have the following error:
>> >> suggested tolerance minimum: 0.142857142857143
>> >> Error in points2grid(points, tolerance, round, fuzz.tol) :
>> >> ?dimension 1 : coordinate intervals are not constant
>> >>
>> >> This means your data set is not regularly gridded. You may want to use
>> >> the points2grid function, which has a tolerance parameter.
>> >> If your dataset is not gridded, and you need to generate a prediction
>> >> grid (eg for kriging), I advise you to use the spsample function (see
>> >> ?spsample).
>> >>
>> >> hope this helps,
>> >>
>> >> Pierre
>> >>
>> >>
>> >> 2010/12/9 Agnieszka Kaczmarczyk <agnes.kaczmarczyk at gmail.com>:
>> >> > Hello,
>> >> > I have to gridded my data alu:
>> >> > class(alu)
>> >> > [1] "data.frame"
>> >> > alu[1:3,1:3]
>> >> > ? ? ? ?x ? ? ? y ? al
>> >> > 1 4384104 5570084 0.20
>> >> > 2 4384068 5570297 0.15
>> >> > 3 4384111 5570551 0.08
>> >> > I use function: gridded(), spsample(),points2grid(),GridTopology(),
>> >> > expand.grid() ect.
>> >> > I read The meuse data set: a tutorial for the gstat R package and
>> >> > other
>> >> > tutorial for R. I can't solve this problem. I'm interesting
>> >> > geostatistic
>> >> > simulation. Can you help me with my problem?
>> >> > With best regards,
>> >> > Agnieszka
>> >> >
>> >> > ? ? ? ?[[alternative HTML version deleted]]
>> >> >
>> >> > _______________________________________________
>> >> > R-sig-Geo mailing list
>> >> > R-sig-Geo at r-project.org
>> >> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> >> >
>> >
>> >
>
>


From hadley at rice.edu  Wed Dec 15 22:20:42 2010
From: hadley at rice.edu (Hadley Wickham)
Date: Wed, 15 Dec 2010 15:20:42 -0600
Subject: [R-sig-Geo] Adding a scale bar and north arrow to a ggplot
In-Reply-To: <AANLkTimnfhf8mdfD6hrzkT2Tr5XLaFv5qWbg+=NkatSd@mail.gmail.com>
References: <4CE588C9.9090100@geo.uu.nl> <4D087541.6050509@geo.uu.nl>
	<alpine.LRH.2.00.1012150941460.1355@reclus.nhh.no>
	<AANLkTimnfhf8mdfD6hrzkT2Tr5XLaFv5qWbg+=NkatSd@mail.gmail.com>
Message-ID: <AANLkTinMTSuwFJduj3W+DMgtkR5T8k5VLE=aRcewK=wG@mail.gmail.com>

This is something that I hope the student would explore over summer.

Hadley

On Wed, Dec 15, 2010 at 2:27 PM, Pierre Roudier
<pierre.roudier at gmail.com> wrote:
> I'd love to see a separate, dedicated package bringing spatial
> functionalities to ggplot2 - this is such a great tool. However, it
> seems to me that a significant problem when using ggplot2 is the lack
> of geom dedicated to raster data.
>
> My experience is you can't really deal with big rasters using
> geom_tile, it takes too much memory. I guess the development of a
> geom_raster is necessary to fully mimic spplot() functionalities - no
> idea how demanding an effort would that be.
>
> Pierre
>
> 2010/12/15 Roger Bivand <Roger.Bivand at nhh.no>:
>> On Wed, 15 Dec 2010, Paul Hiemstra wrote:
>>
>>> Hi people,
>>>
>>> I posted a similar question to the ggplot2 mailing list and with their
>>> help and a lot of tinkering I got a well working function to add a scalebar
>>> to a ggplot plot. I could add the function to automap, but is there another
>>> package which would be more appropraite, e.g. sp (Roger?)?
>>
>> Paul,
>>
>> If it was added to sp, sp would depend on ggplot2 and its dependencies,
>> which are quite extensive, and include a circularity, because ggplot2
>> suggests maptools, which in turn depends on sp. Consequently, sp is not a
>> good idea. It might even make sense to split sp into sp with just classes
>> and methods, and spViz for vizualisation methods, but changing things now is
>> a bit late!
>>
>> It will be cleaner to try to establish the mapping functionality that uses
>> ggplot2 and sp as a separate package. Maybe Hadley would see this as a
>> sensible development. There are already two supplements to ggplot2 on
>> R-forge, but both moribund, I think, which suggests that this needs thinking
>> through.
>>
>> Roger
>>
>>>
>>> cheers,
>>> Paul
>>>
>>> ps: new version of code here:
>>>
>>> makeNiceNumber = function(num, num.pretty = 1) {
>>> ?# Rounding provided by code from Maarten Plieger
>>> ?return((round(num/10^(round(log10(num))-1))*(10^(round(log10(num))-1))))
>>> }
>>>
>>> createBoxPolygon = function(llcorner, width, height) {
>>> ?relativeCoords = data.frame(c(0, 0, width, width, 0), c(0, height,
>>> height, 0, 0))
>>> ?names(relativeCoords) = names(llcorner)
>>> ?return(t(apply(relativeCoords, 1, function(x) llcorner + x)))
>>> }
>>>
>>> addScaleBar = function(ggplot_obj, spatial_obj, attribute, addParams =
>>> list()) {
>>> ?addParamsDefaults = list(noBins = 5, xname = "x", yname = "y", unit =
>>> "m", placement = "bottomright",
>>> ? ? ? ? ? ? ? ? ? ? ? ? ?sbLengthPct = 0.3, sbHeightvsWidth = 1/14)
>>> ?addParams = modifyList(addParamsDefaults, addParams)
>>>
>>> ?range_x = max(spatial_obj[[addParams[["xname"]]]]) -
>>> min(spatial_obj[[addParams[["xname"]]]])
>>> ?range_y = max(spatial_obj[[addParams[["yname"]]]]) -
>>> min(spatial_obj[[addParams[["yname"]]]])
>>> ?lengthScalebar = addParams[["sbLengthPct"]] * range_x
>>> ?## OPTION: use pretty() instead
>>> ?widthBin = makeNiceNumber(lengthScalebar / addParams[["noBins"]])
>>> ?heightBin = lengthScalebar * addParams[["sbHeightvsWidth"]]
>>> ?lowerLeftCornerScaleBar = c(x = max(spatial_obj[[addParams[["xname"]]]])
>>> - (widthBin * addParams[["noBins"]]),
>>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? y = min(spatial_obj[[addParams[["yname"]]]]))
>>>
>>> ?scaleBarPolygon = do.call("rbind", lapply(0:(addParams[["noBins"]] - 1),
>>> function(n) {
>>> ? dum = data.frame(createBoxPolygon(lowerLeftCornerScaleBar + c((n *
>>> widthBin), 0), widthBin, heightBin))
>>> ? if(!(n + 1) %% 2 == 0) dum$cat = "odd" else dum$cat = "even"
>>> ? return(dum)
>>> ?}))
>>> ?scaleBarPolygon[[attribute]] = min(spatial_obj[[attribute]])
>>> ?textScaleBar = data.frame(x =
>>> lowerLeftCornerScaleBar[[addParams[["xname"]]]] +
>>> (c(0:(addParams[["noBins"]])) * widthBin),
>>> ? ? ? ? ? ? ? ? ? ? ? ? ? y =
>>> lowerLeftCornerScaleBar[[addParams[["yname"]]]],
>>> ? ? ? ? ? ? ? ? ? ? ? ? ? label = as.character(0:(addParams[["noBins"]]) *
>>> widthBin))
>>> ?textScaleBar[[attribute]] = min(spatial_obj[[attribute]])
>>>
>>> ?return(ggplot_obj +
>>> ? geom_polygon(data = subset(scaleBarPolygon, cat == "odd"), fill =
>>> "black", color = "black", legend = FALSE) +
>>> ? geom_polygon(data = subset(scaleBarPolygon, cat == "even"), fill =
>>> "white", color = "black", legend = FALSE) +
>>> ? geom_text(aes(label = label), color = "black", size = 6, data =
>>> textScaleBar, hjust = 0.5, vjust = 1.2, legend = FALSE))
>>> }
>>>
>>> library(ggplot2)
>>> library(sp)
>>>
>>> data(meuse)
>>> data(meuse.grid)
>>> ggobj = ggplot(aes(x = x, y = y, color = zinc), data = meuse) +
>>> geom_point()
>>> # Make sure to increase the graphic device a bit
>>> addScaleBar(ggobj, meuse, "zinc", addParams = list(noBins = 5))
>>>
>>>
>>> On 11/18/2010 09:12 PM, Paul Hiemstra wrote:
>>>>
>>>> Dear list,
>>>>
>>>> A common addition to any spatial plot are a north arrow and a scale bar.
>>>> I've searched online for a straightforward way to add those to a ggplot
>>>> plot. I then decided to give a go myself. A crude first attempt for an
>>>> automatic scalebar addition function is listed below. The example works for
>>>> the meuse dataset, but a second with a different dataset did yield good
>>>> results.
>>>>
>>>> My question to you is: is there anyone who has some good tips / example
>>>> code to add a north arrow and a scalebar to a ggplot image. Any expansions
>>>> on the code below are also welcome.
>>>>
>>>> cheers,
>>>> Paul
>>>>
>>>> ps Some info on my system is listed at the very bottom
>>>>
>>>> library(sp)
>>>> library(ggplot2)
>>>>
>>>> data(meuse)
>>>> data(meuse.grid)
>>>>
>>>> string.length = function(s) {
>>>> # ?browser()
>>>> ?if(!is.character(s)) s = as.character(s)
>>>> ?length(strsplit(s, "")[[1]])
>>>> }
>>>>
>>>> makeNiceNumber = function(num, num.pretty = 1) {
>>>> ?noNumbers = string.length(as.character(round(num)))
>>>> ?return(round(num / 10^(noNumbers - num.pretty)) * 10^(noNumbers -
>>>> num.pretty))
>>>> }
>>>>
>>>> makeScaleBar = function(obj, plotname, xname = "x", yname = "y", unit =
>>>> "m", placement = "bottomright") {
>>>> # ? ? browser()
>>>> ?range_x = max(obj[[xname]]) - min(obj[[xname]])
>>>> ?range_y = max(obj[[yname]]) - min(obj[[yname]])
>>>> ?if(placement == "bottomright") {
>>>> ? ?xcoor.max = makeNiceNumber(max(obj[[xname]]) - (0.05 *range_x ),
>>>> string.length(round(max(obj[[xname]]))) - string.length(round(0.3 *
>>>> range_x)))
>>>> ? ?xcoor.min = makeNiceNumber(max(obj[[xname]]) - (0.5 *range_x ),
>>>> string.length(round(max(obj[[xname]]))) - string.length(round(0.3 *
>>>> range_x)))
>>>> ? ?ycoor = min(obj[[yname]]) + (0.05 * range_y)
>>>> ?} else {
>>>> ? ?xcoor.min = makeNiceNumber(max(obj[[xname]]) - (0.95 *range_x ),
>>>> string.length(round(max(obj[[xname]]))) - string.length(round(0.3 *
>>>> range_x)))
>>>> ? ?xcoor.max = makeNiceNumber(max(obj[[xname]]) - (0.5 *range_x ),
>>>> string.length(round(max(obj[[xname]]))) - string.length(round(0.3 *
>>>> range_x)))
>>>> ? ?ycoor = min(obj[[yname]]) + (0.95 * range_y)
>>>> ?}
>>>> ?scalebar.data = data.frame(x = c(xcoor.max, xcoor.min), y = ycoor, lbl =
>>>> c(paste(xcoor.max - xcoor.min, unit), 0))
>>>> ?scalebar.data[[plotname]] = min(obj[[plotname]])
>>>> ?return(list(geom_path(aes(x = x, y = y), data = scalebar.data, lwd = 2,
>>>> color = "black"),
>>>> ? ? ? ? ?geom_text(aes(x = x, y = y, label = lbl), data = scalebar.data,
>>>> vjust = 1.3)))
>>>> }
>>>>
>>>> sb = makeScaleBar(meuse.grid, "dist", placement = "topright")
>>>> ggplot(aes(x ?= x, y = y, fill = dist), data = meuse.grid) + geom_tile()
>>>> + sb[[1]] + sb[[2]]
>>>>
>>>> R version 2.12.0 (2010-10-15)
>>>> Platform: i486-pc-linux-gnu (32-bit)
>>>>
>>>> locale:
>>>> ?[1] LC_CTYPE=en_US.UTF-8 ? ? ? LC_NUMERIC=C
>>>> ?[3] LC_TIME=en_US.UTF-8 ? ? ? ?LC_COLLATE=en_US.UTF-8
>>>> ?[5] LC_MONETARY=C ? ? ? ? ? ? ?LC_MESSAGES=en_US.UTF-8
>>>> ?[7] LC_PAPER=en_US.UTF-8 ? ? ? LC_NAME=C
>>>> ?[9] LC_ADDRESS=C ? ? ? ? ? ? ? LC_TELEPHONE=C
>>>> [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C
>>>>
>>>> attached base packages:
>>>> [1] grid ? ? ?stats ? ? graphics ?grDevices utils ? ? datasets ?methods
>>>> [8] base
>>>>
>>>> other attached packages:
>>>> [1] ggplot2_0.8.7 digest_0.4.2 ?reshape_0.8.3 plyr_0.1.9 ? ?proto_0.3-8
>>>> [6] sp_0.9-62
>>>>
>>>> loaded via a namespace (and not attached):
>>>> [1] lattice_0.19-13
>>>>
>>>> hiemstra at fg-113:~$ uname -a
>>>> Linux fg-113 2.6.32-21-generic #32-Ubuntu SMP Fri Apr 16 08:10:02 UTC
>>>> 2010 i686 GNU/Linux
>>>>
>>>
>>>
>>>
>>
>> --
>> Roger Bivand
>> Economic Geography Section, Department of Economics, Norwegian School of
>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>> e-mail: Roger.Bivand at nhh.no
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



-- 
Assistant Professor / Dobelman Family Junior Chair
Department of Statistics / Rice University
http://had.co.nz/


From bogdanstate at gmail.com  Wed Dec 15 22:43:30 2010
From: bogdanstate at gmail.com (Bogdan State)
Date: Wed, 15 Dec 2010 23:43:30 +0200
Subject: [R-sig-Geo] Spatial network plots?
Message-ID: <AANLkTimoaHswQwc2EpE_+xYoUNs6q+d=jR1XGLGdBdJw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101215/b7170b72/attachment.pl>

From edzer.pebesma at uni-muenster.de  Wed Dec 15 22:58:25 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Wed, 15 Dec 2010 22:58:25 +0100
Subject: [R-sig-Geo] Spatial network plots?
In-Reply-To: <AANLkTimoaHswQwc2EpE_+xYoUNs6q+d=jR1XGLGdBdJw@mail.gmail.com>
References: <AANLkTimoaHswQwc2EpE_+xYoUNs6q+d=jR1XGLGdBdJw@mail.gmail.com>
Message-ID: <4D093A01.7070609@uni-muenster.de>

Bogdan, you may also like this:

http://www.facebook.com/notes/facebook-engineering/visualizing-friendships/469716398919

Earlier this evening I tried to leave a note there to ask the author for
the script, but failed, it seems.

On 12/15/2010 10:43 PM, Bogdan State wrote:
> Hi everyone,
> 
> I hope I am posting on the right list. I have recently started analyzing
> some data that involves connections between people in various cities. I
> would be extremely grateful if someone could point me towards a solution for
> drawing "geographical networks" similar to the flight maps at the back of
> airline magazines (i.e. New York connects to L.A. etc.). I have looked at
> all the usual suspects so far: sp/maptools for GIS (mostly by using spplot)
> and igraph/statnet for social network analysis. None of the packages seems
> to do exactly what I need, but I hope I am wrong.
> 
> Thanks in advance,
> Bogdan State
> PhD Student
> Department of Sociology
> Stanford University
> 
> bstate at stanford.edu
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From francoisrousseu at hotmail.com  Wed Dec 15 23:09:38 2010
From: francoisrousseu at hotmail.com (Francois Rousseu)
Date: Wed, 15 Dec 2010 17:09:38 -0500
Subject: [R-sig-Geo] potential BUG in BBMM
Message-ID: <BLU149-W45EE2BF4CCEF924B0C92E4BA140@phx.gbl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101215/5b074f51/attachment.pl>

From lists at remoteinformation.com.au  Wed Dec 15 23:57:12 2010
From: lists at remoteinformation.com.au (Ben Madin)
Date: Thu, 16 Dec 2010 09:57:12 +1100
Subject: [R-sig-Geo] Spatial network plots?
In-Reply-To: <AANLkTimoaHswQwc2EpE_+xYoUNs6q+d=jR1XGLGdBdJw@mail.gmail.com>
References: <AANLkTimoaHswQwc2EpE_+xYoUNs6q+d=jR1XGLGdBdJw@mail.gmail.com>
Message-ID: <7EE2BF31-EE96-4424-A1DA-EDEC16BCFC65@remoteinformation.com.au>

Bogdan, 

I would suggest that you are on the right track - I am using network / sna / igraph packages for this and I am quite happy with the results. The 'geography' trick is realising that the various layout functions return a set of points - normally in a matrix. You can alternatively look these points up from a data frame of coordinates and use them instead.

Here is a completely non-reproducible example from a postgresql function using pl/r and rgdal / igraph packages

# match coordinates locations with network vertices

poss <- match(V(nlis.graph)$label, nlis.locations$shortcode)
V(nlis.graph)$long <- nlis.locations$longitude[poss]
V(nlis.graph)$lat <- nlis.locations$latitude[poss]
V(nlis.graph)$name <- nlis.locations$name[poss]

# create the layout matrix

latex <- matrix(c(V(nlis.graph)$long, V(nlis.graph)$lat), ncol=2)

# plot background map

plot(aust, xlim=c(110,150), ylim = c(-40, -10), border='dark green')

# plot graph - note the layout parameter and rescale = F - also edge.curved if you really want to look like the airline magazines

plot(nlis.graph, layout=latex, vertex.label.family='sans', vertex.size=v.size, vertex.label.cex=2/3, vertex.label.color='black', vertex.frame.color='black', vertex.color='white', edge.arrow.size=1/2, edge.color=gray(0.5), edge.curved=0, add=TRUE, rescale=FALSE)

The rest of the code is too embarrasing to show, but this might be along the lines of what you want. 

cheers

Ben


On 16/12/2010, at 8:43 AM, Bogdan State wrote:

> Hi everyone,
> 
> I hope I am posting on the right list. I have recently started analyzing
> some data that involves connections between people in various cities. I
> would be extremely grateful if someone could point me towards a solution for
> drawing "geographical networks" similar to the flight maps at the back of
> airline magazines (i.e. New York connects to L.A. etc.). I have looked at
> all the usual suspects so far: sp/maptools for GIS (mostly by using spplot)
> and igraph/statnet for social network analysis. None of the packages seems
> to do exactly what I need, but I hope I am wrong.
> 
> Thanks in advance,
> Bogdan State
> PhD Student
> Department of Sociology
> Stanford University
> 
> bstate at stanford.edu
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From r.hijmans at gmail.com  Thu Dec 16 00:03:51 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Wed, 15 Dec 2010 15:03:51 -0800
Subject: [R-sig-Geo] Spatial network plots?
In-Reply-To: <4D093A01.7070609@uni-muenster.de>
References: <AANLkTimoaHswQwc2EpE_+xYoUNs6q+d=jR1XGLGdBdJw@mail.gmail.com>
	<4D093A01.7070609@uni-muenster.de>
Message-ID: <AANLkTik=SF4GY34Qf=TSmWoYwmxSqzmJvM_in0aVdSys@mail.gmail.com>

Bogdan,

The function gcIntermediate  in geosphere can create such lines from
"from - to" sets of coordinates. Code partly inspired by T Hengl's air
routes script:  http://spatial-analyst.net/worldmaps/airroute.htm

library(geosphere)
library(sp)

n  <- 20
from <- data.frame(lon=runif(n)*-175, lat=runif(n)*80)
to <- data.frame(lon=runif(n)*175, lat=runif(n)*-80)

d <- distHaversine(from[,c('lon', 'lat')], to[,c('lon', 'lat')]) / 1000
npts <- pmax(1, round(sqrt(d)/sqrt(2), 0))  # based on T. Hengl's air
routes example
rts <- gcIntermediate(from[,c('lon', 'lat')], to[,c('lon', 'lat')],
npts, breakAtDateLine=TRUE, addStartEnd=TRUE, sp=TRUE)

library(maptools)
data(wrld_simpl)
plot(wrld_simpl)
plot(rts, col='red', add=T)
points(from, col='blue')
points(to, col='green')


# A next step could be to use the rasterize function in raster to
create a line-density raster.
# this takes a long time

library(raster)
r <- raster()
res(r) <- 5
r <- rasterize(rts, r, fun='count')

plot(r)
plot(wrld_simpl, add=T)
lines(rts, col='red')


Robert


On Wed, Dec 15, 2010 at 1:58 PM, Edzer Pebesma
<edzer.pebesma at uni-muenster.de> wrote:
> Bogdan, you may also like this:
>
> http://www.facebook.com/notes/facebook-engineering/visualizing-friendships/469716398919
>
> Earlier this evening I tried to leave a note there to ask the author for
> the script, but failed, it seems.
>
> On 12/15/2010 10:43 PM, Bogdan State wrote:
>> Hi everyone,
>>
>> I hope I am posting on the right list. I have recently started analyzing
>> some data that involves connections between people in various cities. I
>> would be extremely grateful if someone could point me towards a solution for
>> drawing "geographical networks" similar to the flight maps at the back of
>> airline magazines (i.e. New York connects to L.A. etc.). I have looked at
>> all the usual suspects so far: sp/maptools for GIS (mostly by using spplot)
>> and igraph/statnet for social network analysis. None of the packages seems
>> to do exactly what I need, but I hope I am wrong.
>>
>> Thanks in advance,
>> Bogdan State
>> PhD Student
>> Department of Sociology
>> Stanford University
>>
>> bstate at stanford.edu
>>
>> ? ? ? [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> --
> Edzer Pebesma
> Institute for Geoinformatics (ifgi), University of M?nster
> Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
> 8333081, Fax: +49 251 8339763 ?http://ifgi.uni-muenster.de
> http://www.52north.org/geostatistics ? ? ?e.pebesma at wwu.de
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From kjetil1001 at gmail.com  Thu Dec 16 00:56:18 2010
From: kjetil1001 at gmail.com (Kjetil brinchmann Halvorsen)
Date: Wed, 15 Dec 2010 20:56:18 -0300
Subject: [R-sig-Geo] Spatial network plots?
In-Reply-To: <4D093A01.7070609@uni-muenster.de>
References: <AANLkTimoaHswQwc2EpE_+xYoUNs6q+d=jR1XGLGdBdJw@mail.gmail.com>
	<4D093A01.7070609@uni-muenster.de>
Message-ID: <AANLkTi=7GUQzkGz+EsE2VGkrbqd+oFCpa8855ayKaaDQ@mail.gmail.com>

You could have a look at CRAN packages Rgraphviz ir igraph

kjetil

On Wed, Dec 15, 2010 at 18:58, Edzer Pebesma
<edzer.pebesma at uni-muenster.de> wrote:
> Bogdan, you may also like this:
>
> http://www.facebook.com/notes/facebook-engineering/visualizing-friendships/469716398919
>
> Earlier this evening I tried to leave a note there to ask the author for
> the script, but failed, it seems.
>
> On 12/15/2010 10:43 PM, Bogdan State wrote:
>> Hi everyone,
>>
>> I hope I am posting on the right list. I have recently started analyzing
>> some data that involves connections between people in various cities. I
>> would be extremely grateful if someone could point me towards a solution for
>> drawing "geographical networks" similar to the flight maps at the back of
>> airline magazines (i.e. New York connects to L.A. etc.). I have looked at
>> all the usual suspects so far: sp/maptools for GIS (mostly by using spplot)
>> and igraph/statnet for social network analysis. None of the packages seems
>> to do exactly what I need, but I hope I am wrong.
>>
>> Thanks in advance,
>> Bogdan State
>> PhD Student
>> Department of Sociology
>> Stanford University
>>
>> bstate at stanford.edu
>>
>> ? ? ? [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> --
> Edzer Pebesma
> Institute for Geoinformatics (ifgi), University of M?nster
> Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
> 8333081, Fax: +49 251 8339763 ?http://ifgi.uni-muenster.de
> http://www.52north.org/geostatistics ? ? ?e.pebesma at wwu.de
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



-- 
"If you want a picture of the future - imagine a boot stamping on the
human face - forever."

George Orwell (1984)


From kevinwang at kpmg.com.au  Thu Dec 16 02:16:44 2010
From: kevinwang at kpmg.com.au (Wang, Kevin (SYD))
Date: Thu, 16 Dec 2010 12:16:44 +1100
Subject: [R-sig-Geo] readShapePoly function and putting text on map
Message-ID: <378EB90FD48A9E47A49222E07DF06BAA01BEAD38@AUSYDEXC37.au.kworld.kpmg.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101216/eec8f094/attachment.pl>

From dorina.lazar at econ.ubbcluj.ro  Thu Dec 16 08:06:33 2010
From: dorina.lazar at econ.ubbcluj.ro (dorina.lazar)
Date: Thu, 16 Dec 2010 09:06:33 +0200
Subject: [R-sig-Geo] spatial clusters
Message-ID: <4ac12bb1bf8d163f4ac30bb9273382de@econ.ubbcluj.ro>


Dear all,

I try to use SKATER algorithm (from package spdep) to classify the
countries in clusters taking account of the geographical position and from
macroeconomic indicators.

How to create a shapefile including my data about some socio-demographic
indicators (7),  for about 30 countries around the world (to be read with
readShapePoly)? 

Would be useful to suggest some good introductory lectures in spatial
statistics (links or books).  

Thanks you for your help.
Dorina


PS. Roger, Georg,  thanks a lot for your suggestions.


From p.hiemstra at geo.uu.nl  Thu Dec 16 09:21:49 2010
From: p.hiemstra at geo.uu.nl (Paul Hiemstra)
Date: Thu, 16 Dec 2010 09:21:49 +0100
Subject: [R-sig-Geo] Adding a scale bar and north arrow to a ggplot
In-Reply-To: <AANLkTinMTSuwFJduj3W+DMgtkR5T8k5VLE=aRcewK=wG@mail.gmail.com>
References: <4CE588C9.9090100@geo.uu.nl>
	<4D087541.6050509@geo.uu.nl>	<alpine.LRH.2.00.1012150941460.1355@reclus.nhh.no>	<AANLkTimnfhf8mdfD6hrzkT2Tr5XLaFv5qWbg+=NkatSd@mail.gmail.com>
	<AANLkTinMTSuwFJduj3W+DMgtkR5T8k5VLE=aRcewK=wG@mail.gmail.com>
Message-ID: <4D09CC1D.8080005@geo.uu.nl>

Hi Hadley,

That would great if rasters could be printed more efficiently. Could you 
send me an e-mail, or post on the r-sig-geo list when you are ready to 
receive any contributed code?

Paul

On 12/15/2010 10:20 PM, Hadley Wickham wrote:
> This is something that I hope the student would explore over summer.
>
> Hadley
>
> On Wed, Dec 15, 2010 at 2:27 PM, Pierre Roudier
> <pierre.roudier at gmail.com>  wrote:
>    
>> I'd love to see a separate, dedicated package bringing spatial
>> functionalities to ggplot2 - this is such a great tool. However, it
>> seems to me that a significant problem when using ggplot2 is the lack
>> of geom dedicated to raster data.
>>
>> My experience is you can't really deal with big rasters using
>> geom_tile, it takes too much memory. I guess the development of a
>> geom_raster is necessary to fully mimic spplot() functionalities - no
>> idea how demanding an effort would that be.
>>
>> Pierre
>>
>> 2010/12/15 Roger Bivand<Roger.Bivand at nhh.no>:
>>      
>>> On Wed, 15 Dec 2010, Paul Hiemstra wrote:
>>>
>>>        
>>>> Hi people,
>>>>
>>>> I posted a similar question to the ggplot2 mailing list and with their
>>>> help and a lot of tinkering I got a well working function to add a scalebar
>>>> to a ggplot plot. I could add the function to automap, but is there another
>>>> package which would be more appropraite, e.g. sp (Roger?)?
>>>>          
>>> Paul,
>>>
>>> If it was added to sp, sp would depend on ggplot2 and its dependencies,
>>> which are quite extensive, and include a circularity, because ggplot2
>>> suggests maptools, which in turn depends on sp. Consequently, sp is not a
>>> good idea. It might even make sense to split sp into sp with just classes
>>> and methods, and spViz for vizualisation methods, but changing things now is
>>> a bit late!
>>>
>>> It will be cleaner to try to establish the mapping functionality that uses
>>> ggplot2 and sp as a separate package. Maybe Hadley would see this as a
>>> sensible development. There are already two supplements to ggplot2 on
>>> R-forge, but both moribund, I think, which suggests that this needs thinking
>>> through.
>>>
>>> Roger
>>>
>>>        
>>>> cheers,
>>>> Paul
>>>>
>>>> ps: new version of code here:
>>>>
>>>> makeNiceNumber = function(num, num.pretty = 1) {
>>>>   # Rounding provided by code from Maarten Plieger
>>>>   return((round(num/10^(round(log10(num))-1))*(10^(round(log10(num))-1))))
>>>> }
>>>>
>>>> createBoxPolygon = function(llcorner, width, height) {
>>>>   relativeCoords = data.frame(c(0, 0, width, width, 0), c(0, height,
>>>> height, 0, 0))
>>>>   names(relativeCoords) = names(llcorner)
>>>>   return(t(apply(relativeCoords, 1, function(x) llcorner + x)))
>>>> }
>>>>
>>>> addScaleBar = function(ggplot_obj, spatial_obj, attribute, addParams =
>>>> list()) {
>>>>   addParamsDefaults = list(noBins = 5, xname = "x", yname = "y", unit =
>>>> "m", placement = "bottomright",
>>>>                           sbLengthPct = 0.3, sbHeightvsWidth = 1/14)
>>>>   addParams = modifyList(addParamsDefaults, addParams)
>>>>
>>>>   range_x = max(spatial_obj[[addParams[["xname"]]]]) -
>>>> min(spatial_obj[[addParams[["xname"]]]])
>>>>   range_y = max(spatial_obj[[addParams[["yname"]]]]) -
>>>> min(spatial_obj[[addParams[["yname"]]]])
>>>>   lengthScalebar = addParams[["sbLengthPct"]] * range_x
>>>>   ## OPTION: use pretty() instead
>>>>   widthBin = makeNiceNumber(lengthScalebar / addParams[["noBins"]])
>>>>   heightBin = lengthScalebar * addParams[["sbHeightvsWidth"]]
>>>>   lowerLeftCornerScaleBar = c(x = max(spatial_obj[[addParams[["xname"]]]])
>>>> - (widthBin * addParams[["noBins"]]),
>>>>                              y = min(spatial_obj[[addParams[["yname"]]]]))
>>>>
>>>>   scaleBarPolygon = do.call("rbind", lapply(0:(addParams[["noBins"]] - 1),
>>>> function(n) {
>>>>    dum = data.frame(createBoxPolygon(lowerLeftCornerScaleBar + c((n *
>>>> widthBin), 0), widthBin, heightBin))
>>>>    if(!(n + 1) %% 2 == 0) dum$cat = "odd" else dum$cat = "even"
>>>>    return(dum)
>>>>   }))
>>>>   scaleBarPolygon[[attribute]] = min(spatial_obj[[attribute]])
>>>>   textScaleBar = data.frame(x =
>>>> lowerLeftCornerScaleBar[[addParams[["xname"]]]] +
>>>> (c(0:(addParams[["noBins"]])) * widthBin),
>>>>                            y =
>>>> lowerLeftCornerScaleBar[[addParams[["yname"]]]],
>>>>                            label = as.character(0:(addParams[["noBins"]]) *
>>>> widthBin))
>>>>   textScaleBar[[attribute]] = min(spatial_obj[[attribute]])
>>>>
>>>>   return(ggplot_obj +
>>>>    geom_polygon(data = subset(scaleBarPolygon, cat == "odd"), fill =
>>>> "black", color = "black", legend = FALSE) +
>>>>    geom_polygon(data = subset(scaleBarPolygon, cat == "even"), fill =
>>>> "white", color = "black", legend = FALSE) +
>>>>    geom_text(aes(label = label), color = "black", size = 6, data =
>>>> textScaleBar, hjust = 0.5, vjust = 1.2, legend = FALSE))
>>>> }
>>>>
>>>> library(ggplot2)
>>>> library(sp)
>>>>
>>>> data(meuse)
>>>> data(meuse.grid)
>>>> ggobj = ggplot(aes(x = x, y = y, color = zinc), data = meuse) +
>>>> geom_point()
>>>> # Make sure to increase the graphic device a bit
>>>> addScaleBar(ggobj, meuse, "zinc", addParams = list(noBins = 5))
>>>>
>>>>
>>>> On 11/18/2010 09:12 PM, Paul Hiemstra wrote:
>>>>          
>>>>> Dear list,
>>>>>
>>>>> A common addition to any spatial plot are a north arrow and a scale bar.
>>>>> I've searched online for a straightforward way to add those to a ggplot
>>>>> plot. I then decided to give a go myself. A crude first attempt for an
>>>>> automatic scalebar addition function is listed below. The example works for
>>>>> the meuse dataset, but a second with a different dataset did yield good
>>>>> results.
>>>>>
>>>>> My question to you is: is there anyone who has some good tips / example
>>>>> code to add a north arrow and a scalebar to a ggplot image. Any expansions
>>>>> on the code below are also welcome.
>>>>>
>>>>> cheers,
>>>>> Paul
>>>>>
>>>>> ps Some info on my system is listed at the very bottom
>>>>>
>>>>> library(sp)
>>>>> library(ggplot2)
>>>>>
>>>>> data(meuse)
>>>>> data(meuse.grid)
>>>>>
>>>>> string.length = function(s) {
>>>>> #  browser()
>>>>>   if(!is.character(s)) s = as.character(s)
>>>>>   length(strsplit(s, "")[[1]])
>>>>> }
>>>>>
>>>>> makeNiceNumber = function(num, num.pretty = 1) {
>>>>>   noNumbers = string.length(as.character(round(num)))
>>>>>   return(round(num / 10^(noNumbers - num.pretty)) * 10^(noNumbers -
>>>>> num.pretty))
>>>>> }
>>>>>
>>>>> makeScaleBar = function(obj, plotname, xname = "x", yname = "y", unit =
>>>>> "m", placement = "bottomright") {
>>>>> #     browser()
>>>>>   range_x = max(obj[[xname]]) - min(obj[[xname]])
>>>>>   range_y = max(obj[[yname]]) - min(obj[[yname]])
>>>>>   if(placement == "bottomright") {
>>>>>     xcoor.max = makeNiceNumber(max(obj[[xname]]) - (0.05 *range_x ),
>>>>> string.length(round(max(obj[[xname]]))) - string.length(round(0.3 *
>>>>> range_x)))
>>>>>     xcoor.min = makeNiceNumber(max(obj[[xname]]) - (0.5 *range_x ),
>>>>> string.length(round(max(obj[[xname]]))) - string.length(round(0.3 *
>>>>> range_x)))
>>>>>     ycoor = min(obj[[yname]]) + (0.05 * range_y)
>>>>>   } else {
>>>>>     xcoor.min = makeNiceNumber(max(obj[[xname]]) - (0.95 *range_x ),
>>>>> string.length(round(max(obj[[xname]]))) - string.length(round(0.3 *
>>>>> range_x)))
>>>>>     xcoor.max = makeNiceNumber(max(obj[[xname]]) - (0.5 *range_x ),
>>>>> string.length(round(max(obj[[xname]]))) - string.length(round(0.3 *
>>>>> range_x)))
>>>>>     ycoor = min(obj[[yname]]) + (0.95 * range_y)
>>>>>   }
>>>>>   scalebar.data = data.frame(x = c(xcoor.max, xcoor.min), y = ycoor, lbl =
>>>>> c(paste(xcoor.max - xcoor.min, unit), 0))
>>>>>   scalebar.data[[plotname]] = min(obj[[plotname]])
>>>>>   return(list(geom_path(aes(x = x, y = y), data = scalebar.data, lwd = 2,
>>>>> color = "black"),
>>>>>           geom_text(aes(x = x, y = y, label = lbl), data = scalebar.data,
>>>>> vjust = 1.3)))
>>>>> }
>>>>>
>>>>> sb = makeScaleBar(meuse.grid, "dist", placement = "topright")
>>>>> ggplot(aes(x  = x, y = y, fill = dist), data = meuse.grid) + geom_tile()
>>>>> + sb[[1]] + sb[[2]]
>>>>>
>>>>> R version 2.12.0 (2010-10-15)
>>>>> Platform: i486-pc-linux-gnu (32-bit)
>>>>>
>>>>> locale:
>>>>>   [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
>>>>>   [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
>>>>>   [5] LC_MONETARY=C              LC_MESSAGES=en_US.UTF-8
>>>>>   [7] LC_PAPER=en_US.UTF-8       LC_NAME=C
>>>>>   [9] LC_ADDRESS=C               LC_TELEPHONE=C
>>>>> [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C
>>>>>
>>>>> attached base packages:
>>>>> [1] grid      stats     graphics  grDevices utils     datasets  methods
>>>>> [8] base
>>>>>
>>>>> other attached packages:
>>>>> [1] ggplot2_0.8.7 digest_0.4.2  reshape_0.8.3 plyr_0.1.9    proto_0.3-8
>>>>> [6] sp_0.9-62
>>>>>
>>>>> loaded via a namespace (and not attached):
>>>>> [1] lattice_0.19-13
>>>>>
>>>>> hiemstra at fg-113:~$ uname -a
>>>>> Linux fg-113 2.6.32-21-generic #32-Ubuntu SMP Fri Apr 16 08:10:02 UTC
>>>>> 2010 i686 GNU/Linux
>>>>>
>>>>>            
>>>>
>>>>
>>>>          
>>> --
>>> Roger Bivand
>>> Economic Geography Section, Department of Economics, Norwegian School of
>>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>>> e-mail: Roger.Bivand at nhh.no
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>>        
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>      
>
>
>    


-- 
Paul Hiemstra, MSc
Department of Physical Geography
Faculty of Geosciences
University of Utrecht
Heidelberglaan 2
P.O. Box 80.115
3508 TC Utrecht
Phone:  +3130 253 5773
http://intamap.geo.uu.nl/~paul
http://nl.linkedin.com/pub/paul-hiemstra/20/30b/770

currently @ KNMI
paul.hiemstra_AT_knmi.nl


From research at georgruss.de  Thu Dec 16 09:41:55 2010
From: research at georgruss.de (Georg =?iso-8859-15?B?UnXf?=)
Date: Thu, 16 Dec 2010 09:41:55 +0100
Subject: [R-sig-Geo] spatial clusters
In-Reply-To: <4ac12bb1bf8d163f4ac30bb9273382de@econ.ubbcluj.ro>
References: <4ac12bb1bf8d163f4ac30bb9273382de@econ.ubbcluj.ro>
Message-ID: <20101216084154.GA31662@greode>

On 16/12/10 09:06:33, dorina.lazar wrote:
> How to create a shapefile including my data about some socio-demographic
> indicators (7),  for about 30 countries around the world (to be read with
> readShapePoly)?

Hi Dorina,

I'm not quite sure what you have and what you want.

I assume that you'd like to create a shapefile such that for every country
(which is represented as a polygon) there's a vector of seven attributes
attached to it:

country1:  attr1 attr2 attr3 attr4 attr5 attr6 attr7
country2:  attr1 attr2 attr3 attr4 attr5 attr6 attr7
...

Do you have your countries as spatial polygons in R (SpatialPolygons-
DataFrame or similar)? If yes, you should be able to add your socio-demo-
graphic indicators to this data frame (just as in normal data frames). In
this way you'd join the data you have inside R.

If you have the shapefile for the countries available and would like to
edit this directly to add the indicators, I'd suggest using a GIS like
GRASS http://grass.fbk.eu/ Afterwards, this can be easily read into R.

> Would be useful to suggest some good introductory lectures in spatial
> statistics (links or books).

I think the following is what Roger would suggest:

 author = {Bivand, Roger S. and Pebesma, Edzer J. and G?mez-Rubio, Virgilio},
 title = {Applied Spatial Data Analysis with R},
 series = {Use R},
 publisher = {Springer},

http://www.asdar-book.org/
http://www.springerlink.com/content/uw07v1/
(Depending on your login/institute you may have fulltext access, but the
book is definitely worth buying anyway.)

Regards,
Georg.
--
Research Assistant
Otto-von-Guericke-Universit?t Magdeburg
research at georgruss.de
http://research.georgruss.de


From jim at bitwrit.com.au  Thu Dec 16 09:52:45 2010
From: jim at bitwrit.com.au (Jim Lemon)
Date: Thu, 16 Dec 2010 19:52:45 +1100
Subject: [R-sig-Geo] [R] Drawing Maps of detailed Australian regions
In-Reply-To: <AANLkTimfUAkDArmiJgxv1dt=i7S+4LH43DJ3nHMZEX54@mail.gmail.com>
References: <378EB90FD48A9E47A49222E07DF06BAAA767B7@AUSYDEXC37.au.kworld.kpmg.com>	<AANLkTin2XwwKgf5=t+Re0+wqk4qv4VDfj8G3=K071Dc-@mail.gmail.com>	<4D088F94.1000503@bitwrit.com.au>
	<AANLkTimfUAkDArmiJgxv1dt=i7S+4LH43DJ3nHMZEX54@mail.gmail.com>
Message-ID: <4D09D35D.2080205@bitwrit.com.au>

On 12/15/2010 09:22 PM, Barry Rowlingson wrote:
>...
>   Ah okay - feel free to ask on the r-sig-geo mailing list. It should
> be trivial for Linux and Windows systems, I think there are some
> issues with Mac OS, but the boys on r-sig-geo will be helpful assuming
> you've had a go yourself first according to the instructions!
>
Hi Barry,
I found lots of messages on r-sig-geo with the same sad story. I then 
tried to install GDAL with yum (the generic Linux binary gave me

gdal-config: command not found

  and yum got me over that hurdle. Then I got the

"can't find libproj.a"

and in the desperation of a man up to his neck, I used yum to install

proj-devel.i686

just for the heck of it and _then_ I was able to install rgdal. I'm 
using Fedora 12 and R-2.10.1 if anyone else out there is having the same 
problem(s).

Jim


From alobolistas at gmail.com  Thu Dec 16 10:29:10 2010
From: alobolistas at gmail.com (Agustin Lobo)
Date: Thu, 16 Dec 2010 10:29:10 +0100
Subject: [R-sig-Geo] Fwd: Suggestion: option overwrite=T for writeOGR()
In-Reply-To: <alpine.LRH.2.00.1012141349290.30157@reclus.nhh.no>
References: <AANLkTi=D5_u6K67jCtwSafxOpNZ34rJHfSCnGQSSLpOs@mail.gmail.com>
	<AANLkTi=YfZOgvP_75+skqZvTxmZ_bVMZfXN7SMfCsQRb@mail.gmail.com>
	<alpine.LRH.2.00.1012101320330.6560@reclus.nhh.no>
	<AANLkTinMcoacpjRgSEair0ph+tYqTWk8jFFiBgFxgMT5@mail.gmail.com>
	<alpine.LRH.2.00.1012101516480.9170@reclus.nhh.no>
	<AANLkTinbhGxeRbCK1DJvE8yQQTSozBTUY-C=WFjpmfry@mail.gmail.com>
	<alpine.LRH.2.00.1012101831190.9628@reclus.nhh.no>
	<AANLkTikLWczW0AWneragJz2NFyM_fgtqifa6Hk++1hAE@mail.gmail.com>
	<alpine.LRH.2.00.1012111828090.13472@reclus.nhh.no>
	<AANLkTinhg4-U5PRXreJNuY=6v7dHP9dga223-Whr8Smq@mail.gmail.com>
	<AANLkTinTRV86eyU_oM=eW6wF_iaYB2o9Sh8t3dRH1QFv@mail.gmail.com>
	<alpine.LRH.2.00.1012131356110.26497@reclus.nhh.no>
	<alpine.LRH.2.00.1012141349290.30157@reclus.nhh.no>
Message-ID: <AANLkTinMEGGyLKsRvLgcn1SCb4fkhQtGgiMAkoJLegE-@mail.gmail.com>

Roger,

Your new rgdal version from rgdal_0.6-32.tar.gz works fine once I've
removed gdal1.8dev (using gdal1.7.3 now):
overwrite_layer=T works and the files go to the directory indicated by dsn

Thanks
Agus

> setwd ("/media/FREECOM_HDD/GRAVI")
> require(rgdal)
Loading required package: rgdal
Geospatial Data Abstraction Library extensions to R successfully loaded
Loaded GDAL runtime: GDAL 1.7.3, released 2010/11/10
Path to GDAL shared files: /usr/share/gdal17
Loaded PROJ.4 runtime: Rel. 4.7.1, 23 September 2009
Path to PROJ.4 shared files: (autodetected)

> writeOGR(xygcatLO,dsn="/media/FREECOM_HDD/GRAVI/xygcatLO",layer="xygcatLO", driver="ESRI Shapefile",overwrite_layer=T)
> writeOGR(xygcatLO,dsn="/media/FREECOM_HDD/GRAVI/xygcatLO",layer="xygcatLO", driver="ESRI Shapefile",overwrite_layer=T)
> writeOGR(xygcatLO,dsn="/media/FREECOM_HDD/GRAVI/xygcatLO",layer="xygcatLO", driver="ESRI Shapefile",overwrite_layer=T)
> sessionInfo()
R version 2.12.0 (2010-10-15)
Platform: x86_64-pc-linux-gnu (64-bit)

locale:
 [1] LC_CTYPE=en_US.utf8          LC_NUMERIC=C
 [3] LC_TIME=en_US.utf8           LC_COLLATE=en_US.utf8
 [5] LC_MONETARY=en_US.utf8       LC_MESSAGES=en_US.utf8
 [7] LC_PAPER=en_US.utf8          LC_NAME=en_US.utf8
 [9] LC_ADDRESS=en_US.utf8        LC_TELEPHONE=en_US.utf8
[11] LC_MEASUREMENT=en_US.utf8    LC_IDENTIFICATION=en_US.utf8

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] rgdal_0.6-32 raster_1.7-2 sp_0.9-74    rkward_0.5.4

loaded via a namespace (and not attached):
[1] grid_2.12.0     lattice_0.19-13 tools_2.12.0

2010/12/14 Roger Bivand <Roger.Bivand at nhh.no>:
> On Mon, 13 Dec 2010, Roger Bivand wrote:
>
>> On Mon, 13 Dec 2010, Agustin Lobo wrote:
>>
>>> ---------- Forwarded message ----------
>>> From: Agustin Lobo <alobolistas at gmail.com>
>>> Date: 2010/12/13
>>> Subject: Re: [R-sig-Geo] Suggestion: option overwrite=T for writeOGR()
>>> To: Roger.Bivand at nhh.no
>>>
>>>
>>> Roger,
>>>
>>> According to Synaptic, my gdal is 1.7.3,
>>> I do not understand where the reported
>>> GDAL runtime: GDAL 1.8dev
>>> comes from. Could it have been installed by rgdal?
>>
>> rgdal package binaries from CRAN for Windows are built static against
>> GDAL, so include GDAL but not as a shared object. For OSX on CRAN extras,
>> I'm not sure whether the binary rgdal package is built static or not, but
>> GDAL is included.
>>
>> You are on Linux, so you provide GDAL yourself. If it declares on query
>> (asking the shared object what version it is, which is what rgdal does on
>> startup) that it is 1.8.0dev, then that is what it is. Be aware that
>> downstream packagers may also mistake the version numbers, so asking the
>> shared object is authoritative (unless the releasers of the original source
>> enter the wrong string, as with the current PROJ.4, which declares that it
>> is an as yet unreleased version, these things happen).
>>
>> Either revert properly to GDAL 1.7.*, or wait for me to fix this for
>> 1.8.*, please. I'll post in this thread when I'm ready, and then you can
>> check the rgdal source from R-Forge, OK?
>
> Could you, or others who may be interested, please try the draft version by
> anonymous checkout from the R-forge rgdal project, or using the source
> package at:
>
> http://spatial.nhh.no/R/Devel/rgdal_0.6-32.tar.gz
>
> If you report back that it suits your needs, I'll submit it to CRAN; if you
> need further changes, please let me know.
>
> Roger
>
>
>>
>> Roger
>>
>>>
>>> I've searched my disk and find gdal16 and gdal17 but not gdal18
>>> Do you know if it is possible to tell rgdal which gdal should be used?
>>>
>>> Thanks
>>>
>>> Agus
>>>
>>>
>>>
>>> 2010/12/11 Roger Bivand <Roger.Bivand at nhh.no>:
>>>>
>>>> On Fri, 10 Dec 2010, Agustin Lobo wrote:
>>>>
>>>>> Roger,
>>>>>
>>>>> I was not aware that 1.8dev is actually older than 1.7.2 I'll check why
>>>>> I
>>>>> have that gdal on the other machine and will try to fix that on my side
>>>>> on
>>>>> Monday. But perhaps this problem will come up again for future stable
>>>>> versions of 1.8.* ? Anyway, 1.8dev is clearly not a good choice and I
>>>>> have
>>>>> to change it.
>>>>
>>>> As of GDAL 1.8.0 SVN revision 21234, the problem exists. I'll fix this
>>>> in
>>>> rgdal for the drivers I am familiar with before 1.8.0 is released.
>>>>
>>>> Roger
>>>>
>>>>>
>>>>> Thanks
>>>>>
>>>>> Agus
>>>>>
>>>>> 2010/12/10 Roger Bivand <Roger.Bivand at nhh.no>:
>>>>>>
>>>>>> On Fri, 10 Dec 2010, Agustin Lobo wrote:
>>>>>>
>>>>>>> Roger,
>>>>>>>
>>>>>>> is this all you need? I thought sessionInfo was providing everything
>>>>>>> needed.
>>>>>>
>>>>>> You had given sessionInfo() but that does not report which GDAL you
>>>>>> are
>>>>>> using. The report unfortunately does not give an svn revision, maybe
>>>>>> gdal-config --version does? I develop using 1.7.* GDAL. Your 1.8dev is
>>>>>> pretty old, certainly older that released 1.7.3. I can try to build a
>>>>>> current GDAL trunk from source next week, if I get time, but this
>>>>>> looks
>>>>>> like
>>>>>> something in your setup (development GDAL that is now stale?).
>>>>>>
>>>>>>> The driver is "ESRI Shapefile" as stated in the command, have not
>>>>>>> tested
>>>>>>> any other (it does work for raster though, as you mention):
>>>>>>
>>>>>> I mentioned four variants of vector drivers, not raster.
>>>>>>
>>>>>> Roger
>>>>>>
>>>>>>>
>>>>>>>> require(rgdal)
>>>>>>>
>>>>>>> Loading required package: rgdal
>>>>>>> Geospatial Data Abstraction Library extensions to R successfully
>>>>>>> loaded
>>>>>>> Loaded GDAL runtime: GDAL 1.8dev, released 2010/01/19
>>>>>>> Path to GDAL shared files: /usr/local/share/gdal
>>>>>>> Loaded PROJ.4 runtime: Rel. 4.7.1, 23 September 2009
>>>>>>> Path to PROJ.4 shared files: (autodetected)
>>>>>>>
>>>>>>> Thanks
>>>>>>>
>>>>>>> Agus
>>>>>>>
>>>>>>> 2010/12/10 Roger Bivand <Roger.Bivand at nhh.no>:
>>>>>>>>
>>>>>>>> On Fri, 10 Dec 2010, Agustin Lobo wrote:
>>>>>>>>
>>>>>>>>> Roger,
>>>>>>>>>
>>>>>>>>> It does not for me. The error is solved by deleting files
>>>>>>>>> xygcatLO.* ,
>>>>>>>>> while directory xygcatLO may continue to exist.
>>>>>>>>
>>>>>>>> Agus,
>>>>>>>>
>>>>>>>> With which drivers, OGR version (in header when rgdal loads)? If I
>>>>>>>> cannot
>>>>>>>> reproduce this, I cannot readily help.
>>>>>>>>
>>>>>>>> Roger
>>>>>>>>
>>>>>>>>>
>>>>>>>>> Also, I've found that with this version the below command does not
>>>>>>>>> save the files within
>>>>>>>>> the folder indicated by dsn, but outside. This was not the case in
>>>>>>>>> the
>>>>>>>>> past, but do not know if this is
>>>>>>>>> because of a change in rgdal, gdal or ubuntu 10.04 (I've changed
>>>>>>>>> all 3
>>>>>>>>> since the last time I used writeOGR()).
>>>>>>>>>
>>>>>>>>>> writeOGR(xygcatLO,dsn="xygcatLO",layer="xygcatLO", driver="ESRI
>>>>>>>>>> Shapefile")
>>>>>>>>>
>>>>>>>>> Error in writeOGR(xygcatLO, dsn = "xygcatLO", layer = "xygcatLO",
>>>>>>>>> driver = "ESRI Shapefile") :
>>>>>>>>>
>>>>>>>>> ? ? ? ?GDAL Error 1: Layer 'xygcatLO' already exists
>>>>>>>>> Calls: writeOGR -> .Call
>>>>>>>>>
>>>>>>>>>> sessionInfo()
>>>>>>>>>
>>>>>>>>> R version 2.12.0 (2010-10-15)
>>>>>>>>> Platform: x86_64-pc-linux-gnu (64-bit)
>>>>>>>>>
>>>>>>>>> locale:
>>>>>>>>> [1] LC_CTYPE=en_US.utf8 ? ? ? ? ?LC_NUMERIC=C
>>>>>>>>> [3] LC_TIME=en_US.utf8 ? ? ? ? ? LC_COLLATE=en_US.utf8
>>>>>>>>> [5] LC_MONETARY=en_US.utf8 ? ? ? LC_MESSAGES=en_US.utf8
>>>>>>>>> [7] LC_PAPER=en_US.utf8 ? ? ? ? ?LC_NAME=en_US.utf8
>>>>>>>>> [9] LC_ADDRESS=en_US.utf8 ? ? ? ?LC_TELEPHONE=en_US.utf8
>>>>>>>>> [11] LC_MEASUREMENT=en_US.utf8 ? ?LC_IDENTIFICATION=en_US.utf8
>>>>>>>>>
>>>>>>>>> attached base packages:
>>>>>>>>> [1] stats ? ? graphics ?grDevices utils ? ? datasets ?methods
>>>>>>>>> base
>>>>>>>>>
>>>>>>>>> other attached packages:
>>>>>>>>> [1] RANN_2.1.2 ? ? ?outliers_0.13-3 rgdal_0.6-30 ? ?raster_1.7-2
>>>>>>>>> [5] sp_0.9-73 ? ? ? rkward_0.5.4
>>>>>>>>>
>>>>>>>>> loaded via a namespace (and not attached):
>>>>>>>>> [1] grid_2.12.0 ? ? lattice_0.19-13 tools_2.12.0
>>>>>>>>> 2010/12/10 Roger Bivand <Roger.Bivand at nhh.no>:
>>>>>>>>>>
>>>>>>>>>> On Thu, 9 Dec 2010, Barry Rowlingson wrote:
>>>>>>>>>>
>>>>>>>>>>> On Thu, Dec 9, 2010 at 8:56 AM, Agustin Lobo
>>>>>>>>>>> <alobolistas at gmail.com>
>>>>>>>>>>> wrote:
>>>>>>>>>>>>
>>>>>>>>>>>> Hi!
>>>>>>>>>>>>
>>>>>>>>>>>> Could an option overwrite=T (default overwrite=F) be included in
>>>>>>>>>>>> writeOGR()?
>>>>>>>>>>>> Thanks!
>>>>>>>>>>>
>>>>>>>>>>> Submit a Feature Request here:
>>>>>>>>>>>
>>>>>>>>>>> http://sourceforge.net/tracker/?group_id=84716&atid=573625
>>>>>>>>>>
>>>>>>>>>> No, rgdal is on R-Forge, and a list called rgdal-devel will be
>>>>>>>>>> available
>>>>>>>>>> from tomorrow.
>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>> It looks like it just needs to be a wrapper around OGR's delete
>>>>>>>>>>> layer
>>>>>>>>>>> function.
>>>>>>>>>>
>>>>>>>>>> Contributions welcome. Note that the facility is present for
>>>>>>>>>> rasters,
>>>>>>>>>> which
>>>>>>>>>> I fould out by accidentally deleting GRASS database objects (for
>>>>>>>>>> which
>>>>>>>>>> of
>>>>>>>>>> course I did not have backups). Is this really needed - which
>>>>>>>>>> drivers
>>>>>>>>>> do
>>>>>>>>>> not
>>>>>>>>>> already overwrite without complaint? These do not complain for me:
>>>>>>>>>> driver="ESRI Shapefile"; driver="KML"; driver="MapInfo File";
>>>>>>>>>> driver="MapInfo File", dataset_options="FORMAT=MIF".
>>>>>>>>>>
>>>>>>>>>> Hope this helps,
>>>>>>>>>>
>>>>>>>>>> Roger
>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>> Barry
>>>>>>>>>>>
>>>>>>>>>>> _______________________________________________
>>>>>>>>>>> R-sig-Geo mailing list
>>>>>>>>>>> R-sig-Geo at r-project.org
>>>>>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>> --
>>>>>>>>>> Roger Bivand
>>>>>>>>>> Economic Geography Section, Department of Economics, Norwegian
>>>>>>>>>> School
>>>>>>>>>> of
>>>>>>>>>> Economics and Business Administration, Helleveien 30, N-5045
>>>>>>>>>> Bergen,
>>>>>>>>>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>>>>>>>>>> e-mail: Roger.Bivand at nhh.no
>>>>>>>>>>
>>>>>>>>>> _______________________________________________
>>>>>>>>>> R-sig-Geo mailing list
>>>>>>>>>> R-sig-Geo at r-project.org
>>>>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>>>>>>
>>>>>>>>>
>>>>>>>>
>>>>>>>> --
>>>>>>>> Roger Bivand
>>>>>>>> Economic Geography Section, Department of Economics, Norwegian
>>>>>>>> School
>>>>>>>> of
>>>>>>>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>>>>>>>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>>>>>>>> e-mail: Roger.Bivand at nhh.no
>>>>>>>>
>>>>>>>> _______________________________________________
>>>>>>>> R-sig-Geo mailing list
>>>>>>>> R-sig-Geo at r-project.org
>>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>>>>
>>>>>>>
>>>>>>
>>>>>> --
>>>>>> Roger Bivand
>>>>>> Economic Geography Section, Department of Economics, Norwegian School
>>>>>> of
>>>>>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>>>>>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>>>>>> e-mail: Roger.Bivand at nhh.no
>>>>>>
>>>>>> _______________________________________________
>>>>>> R-sig-Geo mailing list
>>>>>> R-sig-Geo at r-project.org
>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>>
>>>>>>
>>>>>
>>>>
>>>> --
>>>> Roger Bivand
>>>> Economic Geography Section, Department of Economics, Norwegian School of
>>>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>>>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>>>> e-mail: Roger.Bivand at nhh.no
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at r-project.org
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>>
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>>
>
> --
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>


From alobolistas at gmail.com  Thu Dec 16 10:52:33 2010
From: alobolistas at gmail.com (Agustin Lobo)
Date: Thu, 16 Dec 2010 10:52:33 +0100
Subject: [R-sig-Geo] Fwd: Problem with writing parameters in overlay()
In-Reply-To: <4D09E129.9000303@ija.csic.es>
References: <4CF0ED8A.1070800@ija.csic.es>
	<AANLkTinByx5Uj7SzQGKHB1O0R77FdnCnW0UAgDqUVKkw@mail.gmail.com>
	<AANLkTimn2Ng8TSGJ+51VXE46U=chPYpo0MxPKwpF0uTF@mail.gmail.com>
	<4D09E129.9000303@ija.csic.es>
Message-ID: <AANLkTingpmm73pf_s8q=bN1ZuPAj2_5=YwMz2c8+-nBj@mail.gmail.com>

---------- Forwarded message ----------
From: Agustin Lobo <Agustin.Lobo at ija.csic.es>
Date: 2010/12/16
Subject: Re: Problem with writing parameters in overlay()
To: "Robert J. Hijmans" <r.hijmans at gmail.com>, Roger.Bivand at nhh.no,
alobolistas at gmail.com


Robert,

The weird problem at writing raster layers in some cases is also
solved once I remove gdal1.8dev:
> require(rgdal)
Loading required package: rgdal
Geospatial Data Abstraction Library extensions to R successfully loaded
Loaded GDAL runtime: GDAL 1.7.3, released 2010/11/10
Path to GDAL shared files: /usr/share/gdal17
Loaded PROJ.4 runtime: Rel. 4.7.1, 23 September 2009
Path to PROJ.4 shared files: (autodetected)
?require(raster)

> bN3v2 <- overlay(bN3, bSM3, fun=fun1,filename="bN3v2",overwrite=TRUE,format="EHdr", NAflag=0)

works fine now.

Considering the bug fixed in gdal1.8 that I forwarded you, the problem
should also be solved even using the newest gdal1.8,
but I rather do not test until gdal1.8 is available in ubuntugis. You
might want to keep an eye on this, though.

Agus

On 11/28/2010 01:33 AM, Robert J. Hijmans wrote:
>
> Is it only with overlay, or do other functions have the same problem?
>
> ?a<- calc(r2, fun=function(x)x*2, filename="test2", format='GTiff',overwrite=T)
> ?a<- aggregate(r2, 10, filename="test2", format='GTiff',overwrite=T)
>
> Robert
>
> On Sat, Nov 27, 2010 at 12:34 PM, Robert J. Hijmans<r.hijmans at gmail.com> ?wrote:
>>
>> Hi Agus,
>>
>> This is very strange. Somehow the filetype and filename get mixed up.
>> I cannot reproduce this.
>> Does the below all work for you? (it does for me)
>>
>> library(raster)
>> r<- raster(ncol=10, nrow=10)
>> r<- writeStart(r, filename="test", format="GTiff", overwrite=TRUE)
>> filename(r)
>> r<- writeValues(r, 1:100, 1)
>> filename(r)
>> r<- writeStop(r)
>> filename(r)
>>
>> r<- raster(ncol=10, nrow=10)
>> r[]<- 1:100
>> r2<- r
>>
>> a<- overlay(r, r2, fun=sum, filename="test.tif", overwrite=TRUE, NAflag=0)
>> b<- overlay(r, r2, fun=sum, filename="test.img",overwrite=TRUE, NAflag=0)
>>
>> setOptions(todisk=TRUE)
>> a<- overlay(r, r2, fun=sum, filename="test1", format='GTiff',
>> overwrite=TRUE, NAflag=0)
>>
>> r<- writeRaster(r, filename='r1', overwrite=TRUE)
>> r2<- writeRaster(r2, filename='r1', overwrite=TRUE)
>> a<- overlay(r, r2, fun=sum, filename="test2", format='GTiff',
>> overwrite=TRUE, NAflag=0)
>> setOptions(todisk=FALSE)
>>
>>
>> Thanks for your help, Robert
>>
>>
>> On Sat, Nov 27, 2010 at 3:37 AM, Agustin Lobo<Agustin.Lobo at ija.csic.es> ?wrote:
>>>
>>> Robert,
>>>
>>> There is still this problem:
>>> These work:
>>>>
>>>> bN3v2<- overlay(bN3, bSM3, fun=fun1,filename="bN3v2",NAflag=0)
>>>> bN3v2<- overlay(bN3, bSM3,
>>>> fun=fun1,filename="bN3v2",overwrite=TRUE,NAflag=0)
>>>
>>> These do not work (is not a parsing problem?)
>>> (Not critical for me, just trying to help out testing):
>>>>
>>>> bN3v2<- overlay(bN3, bSM3, fun=fun1,filename="bN3v2",overwrite=TRUE,
>>>> format="EHdr", NAflag=0)
>>>
>>> Error in .rasterObjectFromFile(x, band = band, objecttype = "RasterLayer",
>>> ?:
>>> ?file: /home/alobo/EHdr does not exist
>>> Calls: overlay ... raster -> ?raster -> ?.local -> ?.rasterObjectFromFile
>>>
>>>> bN3v2<- overlay(bN3, bSM3, fun=fun1,filename="bN3v2", format="EHdr",
>>>> NAflag=0)
>>>
>>> Error in .rasterObjectFromFile(x, band = band, objecttype = "RasterLayer",
>>> ?:
>>> ?file: /home/alobo/EHdr does not exist
>>> Calls: overlay ... raster -> ?raster -> ?.local -> ?.rasterObjectFromFile
>>>
>>>> bN3v2<- overlay(bN3, bSM3, fun=fun1,filename="bN3v2",overwrite=TRUE,
>>>> format="EHdr", NAflag=0)
>>>
>>> Error in .rasterObjectFromFile(x, band = band, objecttype = "RasterLayer",
>>> ?:
>>> ?file: /home/alobo/EHdr does not exist
>>> Calls: overlay ... raster -> ?raster -> ?.local -> ?.rasterObjectFromFile
>>>
>>>> bN3v2<- overlay(bN3, bSM3, fun=fun1,filename="bN3v2", NAflag=0,
>>>> format="GTiff")
>>>
>>> Error in .rasterObjectFromFile(x, band = band, objecttype = "RasterLayer",
>>> ?:
>>> ?file: /home/alobo/GTiff does not exist
>>> Calls: overlay ... raster -> ?raster -> ?.local -> ?.rasterObjectFromFile
>>>
>>>
>>>
>>>> sessionInfo()
>>>
>>> R version 2.12.0 (2010-10-15)
>>> Platform: i486-pc-linux-gnu (32-bit)
>>>
>>> locale:
>>> ?[1] LC_CTYPE=en_US.UTF-8 ? ? ? ? ?LC_NUMERIC=C LC_TIME=en_US.UTF-8
>>> ?[4] LC_COLLATE=en_US.UTF-8 ? ? ? ?LC_MONETARY=en_US.UTF-8
>>> LC_MESSAGES=en_US.UTF-8
>>> ?[7] LC_PAPER=en_US.UTF-8 ? ? ? ? ?LC_NAME=en_US.UTF-8
>>> LC_ADDRESS=en_US.UTF-8
>>> [10] LC_TELEPHONE=en_US.UTF-8 ? ? ?LC_MEASUREMENT=en_US.UTF-8
>>> LC_IDENTIFICATION=en_US.UTF-8
>>>
>>> attached base packages:
>>> [1] stats ? ? graphics ?grDevices utils ? ? datasets ?methods ? base
>>>
>>> other attached packages:
>>> [1] rgdal_0.6-27 ?raster_1.6-22 sp_0.9-72 ? ? rkward_0.5.4
>>>
>>> loaded via a namespace (and not attached):
>>> [1] grid_2.12.0 ? ? lattice_0.19-13 tools_2.12.0
>>>
>>>
>>>
>>> Agus
>>> --
>>> Dr. Agustin Lobo
>>> Institut de Ciencies de la Terra "Jaume Almera" (CSIC)
>>> LLuis Sole Sabaris s/n
>>> 08028 Barcelona
>>> Spain
>>> Tel. 34 934095410
>>> Fax. 34 934110012
>>> email: Agustin.Lobo at ija.csic.es
>>> http://www.ija.csic.es/gt/obster
>>>


From Roger.Bivand at nhh.no  Thu Dec 16 11:20:39 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 16 Dec 2010 11:20:39 +0100 (CET)
Subject: [R-sig-Geo] readShapePoly function and putting text on map
In-Reply-To: <378EB90FD48A9E47A49222E07DF06BAA01BEAD38@AUSYDEXC37.au.kworld.kpmg.com>
References: <378EB90FD48A9E47A49222E07DF06BAA01BEAD38@AUSYDEXC37.au.kworld.kpmg.com>
Message-ID: <alpine.LRH.2.00.1012161104480.5146@reclus.nhh.no>

On Thu, 16 Dec 2010, Wang, Kevin (SYD) wrote:

> Hi all,
>
> I've managed to draw a map using the following code:
> 	lga1 <- readShapePoly("D:/Documents and Settings/kevinwang/My
> Documents/SMS/ASGC/LGA10aAust", IDvar = "LGA_CODE10")
> 	plot(lga1[lga1$STATE_CODE == 7,], border="blue")
> 	title(main = "NT LGA Division")
> 	text(coordinates(lga1[lga1$STATE_CODE == 7,]), labels =
> sapply(slot(lga1[lga1$STATE_CODE == 7,], "polygons"),
>
> function(i) slot(i, "ID")), cex=0.6)
>
> This gives me a map of Northern Territory (Australia), with local
> government division LGA and the code for the LGAs in each LGA.
>
> However, instead of the LGA code, I'm trying to use LGA names (which is
> in a variable called LGA_NAME10) instead.  But when I tried to change
> the IDvar I got:
> 	> lga1 <- readShapePoly("D:/Documents and Settings/kevinwang/My
> Documents/SMS/ASGC/LGA10aAust", IDvar = "LGA_NAME10")
> 	Error in `row.names<-.data.frame`(`*tmp*`, value = c("Albury
> (C)", "Armidale Dumaresq (A)",  :
> 	  duplicate 'row.names' are not allowed
> 	In addition: Warning message:
> 	non-unique value when setting 'row.names': 'Campbelltown (C)'
>
> My guess is that there are duplicated names in LGA_NAME10 variable.  So
> I'm wondering if it's possible to specify "LGA_NAME10" in the text()
> function instead?

Maybe:
         lga1_7 <- lga1[lga1$STATE_CODE == 7,]
         plot(lga1_7, border="blue")
         title(main = "NT LGA Division")
         text(coordinates(lga1_7),
             labels = as.character(lga1_7$LGA_NAME10), cex=0.6)

(above you could have said labels=rownames(lga1)[lga1$STATE_CODE == 7], 
the example on the help hasn't been updated, but will be now - thanks 
for reminding me).

Roger

>
> Thanks in advance for the help!
>
> Cheers
> Kevin
>
>
>
> Kevin Wang
> Senior Adviser, Government Advisory Services
> Advisory
>
> KPMG
> 10 Shelley Street
> Sydney  NSW  2000  Australia
>
> Tel 	+61 2 9335 8282
> Fax	+61 2 9335 7001
> Mob	0404 518 301
> kevinwang at kpmg.com.au <mailto:kevinwang at kpmg.com.au >
>
> kpmg.com.au <http://kpmg.com.au/>
>
> Best Accounting Firm - BRW Client Choice Awards 2010
>
> Protect the environment: please think before you print
>
>
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From kevinwang at kpmg.com.au  Thu Dec 16 11:31:11 2010
From: kevinwang at kpmg.com.au (Wang, Kevin (SYD))
Date: 16 Dec 2010 21:31:11 +1100
Subject: [R-sig-Geo] readShapePoly function and putting text on map
Message-ID: <aedf01cb9d0c$5bb016ef$4328d60a@au.kworld.kpmg.com>


Thanks, Roger,

Got it to work. 

Got another question, is it possible to "enlarge" the map either using the plot function, or another function?

Cheers

Kevin 

sent from my hTC Desire handset



----- Reply message -----
From: "Roger Bivand" <Roger.Bivand at nhh.no>
Date: Thu, Dec 16, 2010 9:22 pm
Subject: [R-sig-Geo] readShapePoly function and putting text on map
To: "Wang, Kevin (SYD)" <kevinwang at kpmg.com.au>
Cc: "r-sig-geo at r-project.org" <r-sig-geo at r-project.org>, "Kevin Wang" <wang.kevin at gmail.com>

On Thu, 16 Dec 2010, Wang, Kevin (SYD) wrote:

> Hi all,
>
> I've managed to draw a map using the following code:
> 	lga1 <- readShapePoly("D:/Documents and Settings/kevinwang/My
> Documents/SMS/ASGC/LGA10aAust", IDvar = "LGA_CODE10")
> 	plot(lga1[lga1$STATE_CODE == 7,], border="blue")
> 	title(main = "NT LGA Division")
> 	text(coordinates(lga1[lga1$STATE_CODE == 7,]), labels =
> sapply(slot(lga1[lga1$STATE_CODE == 7,], "polygons"),
>
> function(i) slot(i, "ID")), cex=0.6)
>
> This gives me a map of Northern Territory (Australia), with local
> government division LGA and the code for the LGAs in each LGA.
>
> However, instead of the LGA code, I'm trying to use LGA names (which is
> in a variable called LGA_NAME10) instead.  But when I tried to change
> the IDvar I got:
> 	> lga1 <- readShapePoly("D:/Documents and Settings/kevinwang/My
> Documents/SMS/ASGC/LGA10aAust", IDvar = "LGA_NAME10")
> 	Error in `row.names<-.data.frame`(`*tmp*`, value = c("Albury
> (C)", "Armidale Dumaresq (A)",  :
> 	  duplicate 'row.names' are not allowed
> 	In addition: Warning message:
> 	non-unique value when setting 'row.names': 'Campbelltown (C)'
>
> My guess is that there are duplicated names in LGA_NAME10 variable.  So
> I'm wondering if it's possible to specify "LGA_NAME10" in the text()
> function instead?

Maybe:
         lga1_7 <- lga1[lga1$STATE_CODE == 7,]
         plot(lga1_7, border="blue")
         title(main = "NT LGA Division")
         text(coordinates(lga1_7),
             labels = as.character(lga1_7$LGA_NAME10), cex=0.6)

(above you could have said labels=rownames(lga1)[lga1$STATE_CODE == 7], 
the example on the help hasn't been updated, but will be now - thanks 
for reminding me).

Roger

>
> Thanks in advance for the help!
>
> Cheers
> Kevin
>
>
>
> Kevin Wang
> Senior Adviser, Government Advisory Services
> Advisory
>
> KPMG
> 10 Shelley Street
> Sydney  NSW  2000  Australia
>
> Tel 	+61 2 9335 8282
> Fax	+61 2 9335 7001
> Mob	0404 518 301
> kevinwang at kpmg.com.au <mailto:kevinwang at kpmg.com.au >
>
> kpmg.com.au <http://kpmg.com.au/>
>
> Best Accounting Firm - BRW Client Choice Awards 2010
>
> Protect the environment: please think before you print
>
>
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

******************************************************************

The information in this e-mail is confidential and may be legally
privileged. It is intended solely for the addressee. Access to this
e-mail by anyone else is unauthorised. If you have received this
communication in error, please notify us immediately by return
e-mail with the subject heading "Received in error" or telephone
+61 2 93357000, then delete the email and destroy any copies of it.
If you are not the intended recipient, any disclosure, copying,
distribution or any action taken or omitted to be taken in reliance
on it, is prohibited and may be unlawful. Any opinions or advice
contained in this e-mail are subject to the terms and conditions
expressed in the governing KPMG client engagement letter. Opinions,
conclusions and other information in this e-mail and any
attachments that do not relate to the official business of the firm
are neither given nor endorsed by it. 

KPMG cannot guarantee that e-mail communications are secure or
error-free, as information could be intercepted, corrupted,
amended, lost, destroyed, arrive late or incomplete, or contain
viruses. 

KPMG, an Australian partnership and a member firm of the KPMG
network of independent member firms affiliated with KPMG
International Cooperative (?KPMG International?), a Swiss entity. 
KPMG International provides no services to clients.  

Liability limited by a scheme approved under Professional Standards
Legislation. 

*******************************

From Roger.Bivand at nhh.no  Thu Dec 16 11:40:02 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 16 Dec 2010 11:40:02 +0100 (CET)
Subject: [R-sig-Geo] readShapePoly function and putting text on map
In-Reply-To: <alpine.LRH.2.00.1012161104480.5146@reclus.nhh.no>
References: <378EB90FD48A9E47A49222E07DF06BAA01BEAD38@AUSYDEXC37.au.kworld.kpmg.com>
	<alpine.LRH.2.00.1012161104480.5146@reclus.nhh.no>
Message-ID: <alpine.LRH.2.00.1012161139030.5146@reclus.nhh.no>

On Thu, 16 Dec 2010, Roger Bivand wrote:

> On Thu, 16 Dec 2010, Wang, Kevin (SYD) wrote:
>
>> Hi all,
>> 
>> I've managed to draw a map using the following code:
>> 	lga1 <- readShapePoly("D:/Documents and Settings/kevinwang/My
>> Documents/SMS/ASGC/LGA10aAust", IDvar = "LGA_CODE10")
>> 	plot(lga1[lga1$STATE_CODE == 7,], border="blue")
>> 	title(main = "NT LGA Division")
>> 	text(coordinates(lga1[lga1$STATE_CODE == 7,]), labels =
>> sapply(slot(lga1[lga1$STATE_CODE == 7,], "polygons"),
>> 
>> function(i) slot(i, "ID")), cex=0.6)
>> 
>> This gives me a map of Northern Territory (Australia), with local
>> government division LGA and the code for the LGAs in each LGA.
>> 
>> However, instead of the LGA code, I'm trying to use LGA names (which is
>> in a variable called LGA_NAME10) instead.  But when I tried to change
>> the IDvar I got:
>> 	> lga1 <- readShapePoly("D:/Documents and Settings/kevinwang/My
>> Documents/SMS/ASGC/LGA10aAust", IDvar = "LGA_NAME10")
>> 	Error in `row.names<-.data.frame`(`*tmp*`, value = c("Albury
>> (C)", "Armidale Dumaresq (A)",  :
>> 	  duplicate 'row.names' are not allowed
>> 	In addition: Warning message:
>> 	non-unique value when setting 'row.names': 'Campbelltown (C)'
>> 
>> My guess is that there are duplicated names in LGA_NAME10 variable.  So
>> I'm wondering if it's possible to specify "LGA_NAME10" in the text()
>> function instead?
>
> Maybe:
>        lga1_7 <- lga1[lga1$STATE_CODE == 7,]
>        plot(lga1_7, border="blue")
>        title(main = "NT LGA Division")
>        text(coordinates(lga1_7),
>            labels = as.character(lga1_7$LGA_NAME10), cex=0.6)
>

Correction, sorry:

> (above you could have said labels=rownames(lga1)[lga1$STATE_CODE == 7], the
                                     ^^^^^^^^
                                     row.names

Roger

> example on the help hasn't been updated, but will be now - thanks for 
> reminding me).
>
> Roger
>
>> 
>> Thanks in advance for the help!
>> 
>> Cheers
>> Kevin
>> 
>> 
>> 
>> Kevin Wang
>> Senior Adviser, Government Advisory Services
>> Advisory
>> 
>> KPMG
>> 10 Shelley Street
>> Sydney  NSW  2000  Australia
>> 
>> Tel 	+61 2 9335 8282
>> Fax	+61 2 9335 7001
>> Mob	0404 518 301
>> kevinwang at kpmg.com.au <mailto:kevinwang at kpmg.com.au >
>> 
>> kpmg.com.au <http://kpmg.com.au/>
>> 
>> Best Accounting Firm - BRW Client Choice Awards 2010
>> 
>> Protect the environment: please think before you print
>> 
>> 
>> 
>>
>> 	[[alternative HTML version deleted]]
>> 
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> 
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From b.rowlingson at lancaster.ac.uk  Thu Dec 16 12:48:57 2010
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Thu, 16 Dec 2010 11:48:57 +0000
Subject: [R-sig-Geo] OSgeo live DVD
In-Reply-To: <E51727D3-F7F3-4D70-8857-8D3EF76B650F@gmail.com>
References: <AANLkTi=ERAQJzj1GdLg+R94cEWXgQiAohQeowncXA63N@mail.gmail.com>
	<4D021FDD.9030001@uni-muenster.de>
	<AANLkTi=6HcSAUMoFMHdkfmO1KKxhr9S5FD0bBwhSDUum@mail.gmail.com>
	<E51727D3-F7F3-4D70-8857-8D3EF76B650F@gmail.com>
Message-ID: <AANLkTimDhEiCAHTXfRaOTaFRNtB9Db1iSFGRMMnxv+OF@mail.gmail.com>

On Fri, Dec 10, 2010 at 1:46 PM, Massimo Di Stefano
<massimodisasha at gmail.com> wrote:

> the R packages installed on the Osgeo-Live are :
>
> https://svn.osgeo.org/osgeo/livedvd/gisvm/trunk/app-conf/R/installRpackages.r
>
> packagelist is what actually is installed
>
> while packagelist2 is commented out (more complete list)
>
> Can you point me to which package we need to add/delete from the list ?

 I suspect R-2.12.0 will be the one for the next OSgeo DVD, unless
there's a 2.12.1 fixup release due imminently.

Some problems installing the packages in the first list:

 Warning messages:
1: In getDependencies(pkgs, dependencies, available, lib) :
  package ?pkgDepTools? is not available

 ? What's that?

3: In getDependencies(pkgs, dependencies, available, lib) :
  package ?Rgraphviz? is not available

 Has this just not been updated for R-2.12 yet?

6: In getDependencies(pkgs, dependencies, available, lib) :
  package ?automaps? is not available

 There's 'automap' but not 'automaps' - is this a typo (or a rename?)
'automap' installs just fine.

 Errors 2, 4 and 5 were rgdal not installing because I hadn't got the
-dev package installed.

 I've not checked the packages in the packages2 list, but we might
consider adding the 'rworldmap' package to the main list, since this
is supposed to give newbie R users a simple interface to making global
maps.

Barry


From tarek.ben.amara at googlemail.com  Thu Dec 16 15:52:11 2010
From: tarek.ben.amara at googlemail.com (Tarek Benamara)
Date: Thu, 16 Dec 2010 15:52:11 +0100
Subject: [R-sig-Geo] Rgdal GeoTIFF
Message-ID: <AANLkTikNseNWqG3SAKCrTXc0GS8Pn7gJeGyAxiruXfwF@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101216/fe8acf88/attachment.pl>

From villers.alexandre at gmail.com  Thu Dec 16 16:09:18 2010
From: villers.alexandre at gmail.com (Alexandre Villers)
Date: Thu, 16 Dec 2010 17:09:18 +0200
Subject: [R-sig-Geo] Rgdal GeoTIFF
In-Reply-To: <AANLkTikNseNWqG3SAKCrTXc0GS8Pn7gJeGyAxiruXfwF@mail.gmail.com>
References: <AANLkTikNseNWqG3SAKCrTXc0GS8Pn7gJeGyAxiruXfwF@mail.gmail.com>
Message-ID: <4D0A2B9E.7060300@gmail.com>

Hey Tarek,

I guess you have this issue because the g object has two bands.... (the 
estimated mean and variance or sd of your kriging, someone will correct 
me). So your writeGDAL() should be

writeGDAL(g[,,"band1"], "ordinary_kriging_1.tif", drivername="GTiff", 
type="Byte")

HTH

Alex


On 16/12/2010 16:52, Tarek Benamara wrote:
> Hallo,
>
> I have used rgdal to generate a GeoTIFF for my krige Interpolation but the
> output image is a 2 Band image und without RGB Color, my Question is haw to
> give the RGB Color to my GeoTFF and how to increase resolution with rgdal.
>
> And this is my R-File
>
>
>
>
>   ## load some libraries first:
>
> library(gstat)
>
> library(RODBC)
>
> library(rgdal)
>
> library(grid)
>
> library(intamap)
>
> ## load data
>
> channel<- odbcConnect("postgis", "postgres", "postgres")
>
> table = sqlQuery(channel, "SELECT max(stat.gid) as oid,max(stat.the_geom) as
> the_geom,max(stat.station_latitude_d) as lat,max(stat.station_longitude_d)
> as lon,max(stick.wert) as wert FROM luft_messstationen_meta as
> stat,stickstoffdioxid as stick WHERE stat.gid=stick.station_id AND
> date='2010-11-20' group by stat.gid order by oid;")
>
> ## gstat does not like missing data, subset original data:
>
> e<- na.omit(table)
>
>
>   coordinates(e)<- ~ lon+lat
>
>
>
>   ## create a grid onto which we will interpolate:
>
> ## first get the range in data
>
> x.range<- range(e at coords[,1])
>
> y.range<- range(e at coords[,2])
>
> ## now expand to a grid with 500 meter spacing:
>
> grd<- expand.grid(x=seq(from=x.range[1], to=x.range[2], by=0.05),
> y=seq(from=y.range[1], to=y.range[2], by=0.05) )
>
>
>   ## convert to SpatialPixel class
>
> coordinates(grd)<- ~ x+y
>
> gridded(grd)<- TRUE
>
>
>
>   g<- krige(formula=wert ~1, e, grd,model=vgm(1,"Exp",300))
>
>
>
>   proj4string(g) = CRS("+init=epsg:4326")
>
> writeGDAL(g, "ordinary_kriging_1.tif", drivername="GTiff", type="Byte")
>
>
>
>   Thanks
>
> Tarek
>
>
>
>


-- 
Alexandre Villers, PhD.
Postdoc researcher
Spatial Ecology & Population Dynamics
Section of Ecology, Department of Biology
University of Turku
FIN-20014 Turku
Finland

@mail: alexandre.villers at utu.fi
phone: 00358 (0)2 333 5039

Skype You can skype me (but think of using Ekiga instead !) 
<skype:aquila06?call>


*Use open source and free softwares*
<http://cran.r-project.org/> <http://grass.itc.it/> 
<http://www.qgis.org/> <http://fr.openoffice.org/> 
<http://www.mozilla-europe.org/fr/> <http://www.mozilla-europe.org/fr/>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101216/bc05643c/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Skypelogo.jpg
Type: image/jpeg
Size: 5395 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101216/bc05643c/attachment.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Rlogo.jpg
Type: image/jpeg
Size: 1753 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101216/bc05643c/attachment-0001.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: GRASSlogo.png
Type: image/png
Size: 3277 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101216/bc05643c/attachment.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: QGIS.png
Type: image/png
Size: 4144 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101216/bc05643c/attachment-0001.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: OOlogo.gif
Type: image/gif
Size: 4246 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101216/bc05643c/attachment.gif>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: TBlogo.jpg
Type: image/jpeg
Size: 1385 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101216/bc05643c/attachment-0002.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: FFlogo.jpg
Type: image/jpeg
Size: 1686 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101216/bc05643c/attachment-0003.jpg>

From edzer.pebesma at uni-muenster.de  Thu Dec 16 16:20:58 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Thu, 16 Dec 2010 16:20:58 +0100
Subject: [R-sig-Geo] Rgdal GeoTIFF
In-Reply-To: <AANLkTikNseNWqG3SAKCrTXc0GS8Pn7gJeGyAxiruXfwF@mail.gmail.com>
References: <AANLkTikNseNWqG3SAKCrTXc0GS8Pn7gJeGyAxiruXfwF@mail.gmail.com>
Message-ID: <4D0A2E5A.9090101@uni-muenster.de>

Browsing through your script, another issue I noted is that you
interpolate in long/lat, but the software assumes Euclidian distances
make sense as a distance measure in this space. They don't.

Wbr,

On 12/16/2010 03:52 PM, Tarek Benamara wrote:
> Hallo,
> 
> I have used rgdal to generate a GeoTIFF for my krige Interpolation but the
> output image is a 2 Band image und without RGB Color, my Question is haw to
> give the RGB Color to my GeoTFF and how to increase resolution with rgdal.
> 
> And this is my R-File
> 
> 
> 
> 
>  ## load some libraries first:
> 
> library(gstat)
> 
> library(RODBC)
> 
> library(rgdal)
> 
> library(grid)
> 
> library(intamap)
> 
> ## load data
> 
> channel <- odbcConnect("postgis", "postgres", "postgres")
> 
> table = sqlQuery(channel, "SELECT max(stat.gid) as oid,max(stat.the_geom) as
> the_geom,max(stat.station_latitude_d) as lat,max(stat.station_longitude_d)
> as lon,max(stick.wert) as wert FROM luft_messstationen_meta as
> stat,stickstoffdioxid as stick WHERE stat.gid=stick.station_id AND
> date='2010-11-20' group by stat.gid order by oid;")
> 
> ## gstat does not like missing data, subset original data:
> 
> e <- na.omit(table)
> 
> 
>  coordinates(e) <- ~ lon+lat
> 
> 
> 
>  ## create a grid onto which we will interpolate:
> 
> ## first get the range in data
> 
> x.range <- range(e at coords[,1])
> 
> y.range <- range(e at coords[,2])
> 
> ## now expand to a grid with 500 meter spacing:
> 
> grd <- expand.grid(x=seq(from=x.range[1], to=x.range[2], by=0.05),
> y=seq(from=y.range[1], to=y.range[2], by=0.05) )
> 
> 
>  ## convert to SpatialPixel class
> 
> coordinates(grd) <- ~ x+y
> 
> gridded(grd) <- TRUE
> 
> 
> 
>  g <- krige(formula=wert ~1, e, grd,model=vgm(1,"Exp",300))
> 
> 
> 
>  proj4string(g) = CRS("+init=epsg:4326")
> 
> writeGDAL(g, "ordinary_kriging_1.tif", drivername="GTiff", type="Byte")
> 
> 
> 
>  Thanks
> 
> Tarek
> 
> 
> 
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From nikko at hailmail.net  Thu Dec 16 17:35:59 2010
From: nikko at hailmail.net (Nicholas Lewin-Koh)
Date: Thu, 16 Dec 2010 08:35:59 -0800
Subject: [R-sig-Geo] Spatial network plots? -- speeding up rasterization
In-Reply-To: <mailman.11.1292497203.19619.r-sig-geo@r-project.org>
References: <mailman.11.1292497203.19619.r-sig-geo@r-project.org>
Message-ID: <1292517359.27236.1410684931@webmail.messagingengine.com>

Hi Robert
Looking over your code, Wouldn't it be much faster
to use Rgooglemaps or something where the map is already rasterized?
The newer versions of R have the lowlevel raster function for plotting
images.
Also, even in base graphics you can use alpha blending so for your
network lines 
lines(rts, col=rgb(1,0,0,alpha=.2))
would look much nicer.

Nicholas

>
> ------------------------------
> 
> Message: 24
> Date: Wed, 15 Dec 2010 15:03:51 -0800
> From: "Robert J. Hijmans" <r.hijmans at gmail.com>
> To: r-sig-geo at r-project.org
> Subject: Re: [R-sig-Geo] Spatial network plots?
> Message-ID:
> 	<AANLkTik=SF4GY34Qf=TSmWoYwmxSqzmJvM_in0aVdSys at mail.gmail.com>
> Content-Type: text/plain; charset=ISO-8859-1
> 
> Bogdan,
> 
> The function gcIntermediate  in geosphere can create such lines from
> "from - to" sets of coordinates. Code partly inspired by T Hengl's air
> routes script:  http://spatial-analyst.net/worldmaps/airroute.htm
> 
> library(geosphere)
> library(sp)
> 
> n  <- 20
> from <- data.frame(lon=runif(n)*-175, lat=runif(n)*80)
> to <- data.frame(lon=runif(n)*175, lat=runif(n)*-80)
> 
> d <- distHaversine(from[,c('lon', 'lat')], to[,c('lon', 'lat')]) / 1000
> npts <- pmax(1, round(sqrt(d)/sqrt(2), 0))  # based on T. Hengl's air
> routes example
> rts <- gcIntermediate(from[,c('lon', 'lat')], to[,c('lon', 'lat')],
> npts, breakAtDateLine=TRUE, addStartEnd=TRUE, sp=TRUE)
> 
> library(maptools)
> data(wrld_simpl)
> plot(wrld_simpl)
> plot(rts, col='red', add=T)
> points(from, col='blue')
> points(to, col='green')
> 
> 
> # A next step could be to use the rasterize function in raster to
> create a line-density raster.
> # this takes a long time
> 
> library(raster)
> r <- raster()
> res(r) <- 5
> r <- rasterize(rts, r, fun='count')
> 
> plot(r)
> plot(wrld_simpl, add=T)
> lines(rts, col='red')
> 
> 
> Robert
> 
> 
> On Wed, Dec 15, 2010 at 1:58 PM, Edzer Pebesma
> <edzer.pebesma at uni-muenster.de> wrote:
> > Bogdan, you may also like this:
> >
> > http://www.facebook.com/notes/facebook-engineering/visualizing-friendships/469716398919
> >
> > Earlier this evening I tried to leave a note there to ask the author for
> > the script, but failed, it seems.
> >
> > On 12/15/2010 10:43 PM, Bogdan State wrote:
> >> Hi everyone,
> >>
> >> I hope I am posting on the right list. I have recently started analyzing
> >> some data that involves connections between people in various cities. I
> >> would be extremely grateful if someone could point me towards a solution for
> >> drawing "geographical networks" similar to the flight maps at the back of
> >> airline magazines (i.e. New York connects to L.A. etc.). I have looked at
> >> all the usual suspects so far: sp/maptools for GIS (mostly by using spplot)
> >> and igraph/statnet for social network analysis. None of the packages seems
> >> to do exactly what I need, but I hope I am wrong.
> >>
> >> Thanks in advance,
> >> Bogdan State
> >> PhD Student
> >> Department of Sociology
> >> Stanford University
> >>
> >> bstate at stanford.edu
> >>
> >> ? ? ? [[alternative HTML version deleted]]
> >>
> >> _______________________________________________
> >> R-sig-Geo mailing list
> >> R-sig-Geo at r-project.org
> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
> > --
> > Edzer Pebesma
> > Institute for Geoinformatics (ifgi), University of M?nster
> > Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
> > 8333081, Fax: +49 251 8339763 ?http://ifgi.uni-muenster.de
> > http://www.52north.org/geostatistics ? ? ?e.pebesma at wwu.de
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
> 
> 
>


From Roger.Bivand at nhh.no  Thu Dec 16 19:42:27 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 16 Dec 2010 19:42:27 +0100 (CET)
Subject: [R-sig-Geo] Fwd: Suggestion: option overwrite=T for writeOGR()
In-Reply-To: <AANLkTinMEGGyLKsRvLgcn1SCb4fkhQtGgiMAkoJLegE-@mail.gmail.com>
References: <AANLkTi=D5_u6K67jCtwSafxOpNZ34rJHfSCnGQSSLpOs@mail.gmail.com>
	<AANLkTi=YfZOgvP_75+skqZvTxmZ_bVMZfXN7SMfCsQRb@mail.gmail.com>
	<alpine.LRH.2.00.1012101320330.6560@reclus.nhh.no>
	<AANLkTinMcoacpjRgSEair0ph+tYqTWk8jFFiBgFxgMT5@mail.gmail.com>
	<alpine.LRH.2.00.1012101516480.9170@reclus.nhh.no>
	<AANLkTinbhGxeRbCK1DJvE8yQQTSozBTUY-C=WFjpmfry@mail.gmail.com>
	<alpine.LRH.2.00.1012101831190.9628@reclus.nhh.no>
	<AANLkTikLWczW0AWneragJz2NFyM_fgtqifa6Hk++1hAE@mail.gmail.com>
	<alpine.LRH.2.00.1012111828090.13472@reclus.nhh.no>
	<AANLkTinhg4-U5PRXreJNuY=6v7dHP9dga223-Whr8Smq@mail.gmail.com>
	<AANLkTinTRV86eyU_oM=eW6wF_iaYB2o9Sh8t3dRH1QFv@mail.gmail.com>
	<alpine.LRH.2.00.1012131356110.26497@reclus.nhh.no>
	<alpine.LRH.2.00.1012141349290.30157@reclus.nhh.no>
	<AANLkTinMEGGyLKsRvLgcn1SCb4fkhQtGgiMAkoJLegE-@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.1012161935420.28069@reclus.nhh.no>

On Thu, 16 Dec 2010, Agustin Lobo wrote:

> Roger,
>
> Your new rgdal version from rgdal_0.6-32.tar.gz works fine once I've
> removed gdal1.8dev (using gdal1.7.3 now):
> overwrite_layer=T works and the files go to the directory indicated by dsn

I've now released rgdal_0.6-33 to CRAN, so we ought to be ready when GDAL 
1.8.0 is released. Both the issues you raised - more protection of 
existing files when writing for some OGR drivers, and shapefiles with the 
same name as a folder not being created in the folder but alongside it, 
are not present in 1.7, and the shapefile writing alongside problem has 
now been resolved in GDAL SVN (thanks to Even Rouault for a very fast 
patch). So users of GDAL 1.7 (including Windows and OSX CRAN binary users) 
are not affected, but users of current 1.8dev may find some vector 
operations a little easier.

Roger

>
> Thanks
> Agus
>
>> setwd ("/media/FREECOM_HDD/GRAVI")
>> require(rgdal)
> Loading required package: rgdal
> Geospatial Data Abstraction Library extensions to R successfully loaded
> Loaded GDAL runtime: GDAL 1.7.3, released 2010/11/10
> Path to GDAL shared files: /usr/share/gdal17
> Loaded PROJ.4 runtime: Rel. 4.7.1, 23 September 2009
> Path to PROJ.4 shared files: (autodetected)
>
>> writeOGR(xygcatLO,dsn="/media/FREECOM_HDD/GRAVI/xygcatLO",layer="xygcatLO", driver="ESRI Shapefile",overwrite_layer=T)
>> writeOGR(xygcatLO,dsn="/media/FREECOM_HDD/GRAVI/xygcatLO",layer="xygcatLO", driver="ESRI Shapefile",overwrite_layer=T)
>> writeOGR(xygcatLO,dsn="/media/FREECOM_HDD/GRAVI/xygcatLO",layer="xygcatLO", driver="ESRI Shapefile",overwrite_layer=T)
>> sessionInfo()
> R version 2.12.0 (2010-10-15)
> Platform: x86_64-pc-linux-gnu (64-bit)
>
> locale:
> [1] LC_CTYPE=en_US.utf8          LC_NUMERIC=C
> [3] LC_TIME=en_US.utf8           LC_COLLATE=en_US.utf8
> [5] LC_MONETARY=en_US.utf8       LC_MESSAGES=en_US.utf8
> [7] LC_PAPER=en_US.utf8          LC_NAME=en_US.utf8
> [9] LC_ADDRESS=en_US.utf8        LC_TELEPHONE=en_US.utf8
> [11] LC_MEASUREMENT=en_US.utf8    LC_IDENTIFICATION=en_US.utf8
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> other attached packages:
> [1] rgdal_0.6-32 raster_1.7-2 sp_0.9-74    rkward_0.5.4
>
> loaded via a namespace (and not attached):
> [1] grid_2.12.0     lattice_0.19-13 tools_2.12.0
>
> 2010/12/14 Roger Bivand <Roger.Bivand at nhh.no>:
>> On Mon, 13 Dec 2010, Roger Bivand wrote:
>>
>>> On Mon, 13 Dec 2010, Agustin Lobo wrote:
>>>
>>>> ---------- Forwarded message ----------
>>>> From: Agustin Lobo <alobolistas at gmail.com>
>>>> Date: 2010/12/13
>>>> Subject: Re: [R-sig-Geo] Suggestion: option overwrite=T for writeOGR()
>>>> To: Roger.Bivand at nhh.no
>>>>
>>>>
>>>> Roger,
>>>>
>>>> According to Synaptic, my gdal is 1.7.3,
>>>> I do not understand where the reported
>>>> GDAL runtime: GDAL 1.8dev
>>>> comes from. Could it have been installed by rgdal?
>>>
>>> rgdal package binaries from CRAN for Windows are built static against
>>> GDAL, so include GDAL but not as a shared object. For OSX on CRAN extras,
>>> I'm not sure whether the binary rgdal package is built static or not, but
>>> GDAL is included.
>>>
>>> You are on Linux, so you provide GDAL yourself. If it declares on query
>>> (asking the shared object what version it is, which is what rgdal does on
>>> startup) that it is 1.8.0dev, then that is what it is. Be aware that
>>> downstream packagers may also mistake the version numbers, so asking the
>>> shared object is authoritative (unless the releasers of the original source
>>> enter the wrong string, as with the current PROJ.4, which declares that it
>>> is an as yet unreleased version, these things happen).
>>>
>>> Either revert properly to GDAL 1.7.*, or wait for me to fix this for
>>> 1.8.*, please. I'll post in this thread when I'm ready, and then you can
>>> check the rgdal source from R-Forge, OK?
>>
>> Could you, or others who may be interested, please try the draft version by
>> anonymous checkout from the R-forge rgdal project, or using the source
>> package at:
>>
>> http://spatial.nhh.no/R/Devel/rgdal_0.6-32.tar.gz
>>
>> If you report back that it suits your needs, I'll submit it to CRAN; if you
>> need further changes, please let me know.
>>
>> Roger
>>
>>
>>>
>>> Roger
>>>
>>>>
>>>> I've searched my disk and find gdal16 and gdal17 but not gdal18
>>>> Do you know if it is possible to tell rgdal which gdal should be used?
>>>>
>>>> Thanks
>>>>
>>>> Agus
>>>>
>>>>
>>>>
>>>> 2010/12/11 Roger Bivand <Roger.Bivand at nhh.no>:
>>>>>
>>>>> On Fri, 10 Dec 2010, Agustin Lobo wrote:
>>>>>
>>>>>> Roger,
>>>>>>
>>>>>> I was not aware that 1.8dev is actually older than 1.7.2 I'll check why
>>>>>> I
>>>>>> have that gdal on the other machine and will try to fix that on my side
>>>>>> on
>>>>>> Monday. But perhaps this problem will come up again for future stable
>>>>>> versions of 1.8.* ? Anyway, 1.8dev is clearly not a good choice and I
>>>>>> have
>>>>>> to change it.
>>>>>
>>>>> As of GDAL 1.8.0 SVN revision 21234, the problem exists. I'll fix this
>>>>> in
>>>>> rgdal for the drivers I am familiar with before 1.8.0 is released.
>>>>>
>>>>> Roger
>>>>>
>>>>>>
>>>>>> Thanks
>>>>>>
>>>>>> Agus
>>>>>>
>>>>>> 2010/12/10 Roger Bivand <Roger.Bivand at nhh.no>:
>>>>>>>
>>>>>>> On Fri, 10 Dec 2010, Agustin Lobo wrote:
>>>>>>>
>>>>>>>> Roger,
>>>>>>>>
>>>>>>>> is this all you need? I thought sessionInfo was providing everything
>>>>>>>> needed.
>>>>>>>
>>>>>>> You had given sessionInfo() but that does not report which GDAL you
>>>>>>> are
>>>>>>> using. The report unfortunately does not give an svn revision, maybe
>>>>>>> gdal-config --version does? I develop using 1.7.* GDAL. Your 1.8dev is
>>>>>>> pretty old, certainly older that released 1.7.3. I can try to build a
>>>>>>> current GDAL trunk from source next week, if I get time, but this
>>>>>>> looks
>>>>>>> like
>>>>>>> something in your setup (development GDAL that is now stale?).
>>>>>>>
>>>>>>>> The driver is "ESRI Shapefile" as stated in the command, have not
>>>>>>>> tested
>>>>>>>> any other (it does work for raster though, as you mention):
>>>>>>>
>>>>>>> I mentioned four variants of vector drivers, not raster.
>>>>>>>
>>>>>>> Roger
>>>>>>>
>>>>>>>>
>>>>>>>>> require(rgdal)
>>>>>>>>
>>>>>>>> Loading required package: rgdal
>>>>>>>> Geospatial Data Abstraction Library extensions to R successfully
>>>>>>>> loaded
>>>>>>>> Loaded GDAL runtime: GDAL 1.8dev, released 2010/01/19
>>>>>>>> Path to GDAL shared files: /usr/local/share/gdal
>>>>>>>> Loaded PROJ.4 runtime: Rel. 4.7.1, 23 September 2009
>>>>>>>> Path to PROJ.4 shared files: (autodetected)
>>>>>>>>
>>>>>>>> Thanks
>>>>>>>>
>>>>>>>> Agus
>>>>>>>>
>>>>>>>> 2010/12/10 Roger Bivand <Roger.Bivand at nhh.no>:
>>>>>>>>>
>>>>>>>>> On Fri, 10 Dec 2010, Agustin Lobo wrote:
>>>>>>>>>
>>>>>>>>>> Roger,
>>>>>>>>>>
>>>>>>>>>> It does not for me. The error is solved by deleting files
>>>>>>>>>> xygcatLO.* ,
>>>>>>>>>> while directory xygcatLO may continue to exist.
>>>>>>>>>
>>>>>>>>> Agus,
>>>>>>>>>
>>>>>>>>> With which drivers, OGR version (in header when rgdal loads)? If I
>>>>>>>>> cannot
>>>>>>>>> reproduce this, I cannot readily help.
>>>>>>>>>
>>>>>>>>> Roger
>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>> Also, I've found that with this version the below command does not
>>>>>>>>>> save the files within
>>>>>>>>>> the folder indicated by dsn, but outside. This was not the case in
>>>>>>>>>> the
>>>>>>>>>> past, but do not know if this is
>>>>>>>>>> because of a change in rgdal, gdal or ubuntu 10.04 (I've changed
>>>>>>>>>> all 3
>>>>>>>>>> since the last time I used writeOGR()).
>>>>>>>>>>
>>>>>>>>>>> writeOGR(xygcatLO,dsn="xygcatLO",layer="xygcatLO", driver="ESRI
>>>>>>>>>>> Shapefile")
>>>>>>>>>>
>>>>>>>>>> Error in writeOGR(xygcatLO, dsn = "xygcatLO", layer = "xygcatLO",
>>>>>>>>>> driver = "ESRI Shapefile") :
>>>>>>>>>>
>>>>>>>>>> ? ? ? ?GDAL Error 1: Layer 'xygcatLO' already exists
>>>>>>>>>> Calls: writeOGR -> .Call
>>>>>>>>>>
>>>>>>>>>>> sessionInfo()
>>>>>>>>>>
>>>>>>>>>> R version 2.12.0 (2010-10-15)
>>>>>>>>>> Platform: x86_64-pc-linux-gnu (64-bit)
>>>>>>>>>>
>>>>>>>>>> locale:
>>>>>>>>>> [1] LC_CTYPE=en_US.utf8 ? ? ? ? ?LC_NUMERIC=C
>>>>>>>>>> [3] LC_TIME=en_US.utf8 ? ? ? ? ? LC_COLLATE=en_US.utf8
>>>>>>>>>> [5] LC_MONETARY=en_US.utf8 ? ? ? LC_MESSAGES=en_US.utf8
>>>>>>>>>> [7] LC_PAPER=en_US.utf8 ? ? ? ? ?LC_NAME=en_US.utf8
>>>>>>>>>> [9] LC_ADDRESS=en_US.utf8 ? ? ? ?LC_TELEPHONE=en_US.utf8
>>>>>>>>>> [11] LC_MEASUREMENT=en_US.utf8 ? ?LC_IDENTIFICATION=en_US.utf8
>>>>>>>>>>
>>>>>>>>>> attached base packages:
>>>>>>>>>> [1] stats ? ? graphics ?grDevices utils ? ? datasets ?methods
>>>>>>>>>> base
>>>>>>>>>>
>>>>>>>>>> other attached packages:
>>>>>>>>>> [1] RANN_2.1.2 ? ? ?outliers_0.13-3 rgdal_0.6-30 ? ?raster_1.7-2
>>>>>>>>>> [5] sp_0.9-73 ? ? ? rkward_0.5.4
>>>>>>>>>>
>>>>>>>>>> loaded via a namespace (and not attached):
>>>>>>>>>> [1] grid_2.12.0 ? ? lattice_0.19-13 tools_2.12.0
>>>>>>>>>> 2010/12/10 Roger Bivand <Roger.Bivand at nhh.no>:
>>>>>>>>>>>
>>>>>>>>>>> On Thu, 9 Dec 2010, Barry Rowlingson wrote:
>>>>>>>>>>>
>>>>>>>>>>>> On Thu, Dec 9, 2010 at 8:56 AM, Agustin Lobo
>>>>>>>>>>>> <alobolistas at gmail.com>
>>>>>>>>>>>> wrote:
>>>>>>>>>>>>>
>>>>>>>>>>>>> Hi!
>>>>>>>>>>>>>
>>>>>>>>>>>>> Could an option overwrite=T (default overwrite=F) be included in
>>>>>>>>>>>>> writeOGR()?
>>>>>>>>>>>>> Thanks!
>>>>>>>>>>>>
>>>>>>>>>>>> Submit a Feature Request here:
>>>>>>>>>>>>
>>>>>>>>>>>> http://sourceforge.net/tracker/?group_id=84716&atid=573625
>>>>>>>>>>>
>>>>>>>>>>> No, rgdal is on R-Forge, and a list called rgdal-devel will be
>>>>>>>>>>> available
>>>>>>>>>>> from tomorrow.
>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>> It looks like it just needs to be a wrapper around OGR's delete
>>>>>>>>>>>> layer
>>>>>>>>>>>> function.
>>>>>>>>>>>
>>>>>>>>>>> Contributions welcome. Note that the facility is present for
>>>>>>>>>>> rasters,
>>>>>>>>>>> which
>>>>>>>>>>> I fould out by accidentally deleting GRASS database objects (for
>>>>>>>>>>> which
>>>>>>>>>>> of
>>>>>>>>>>> course I did not have backups). Is this really needed - which
>>>>>>>>>>> drivers
>>>>>>>>>>> do
>>>>>>>>>>> not
>>>>>>>>>>> already overwrite without complaint? These do not complain for me:
>>>>>>>>>>> driver="ESRI Shapefile"; driver="KML"; driver="MapInfo File";
>>>>>>>>>>> driver="MapInfo File", dataset_options="FORMAT=MIF".
>>>>>>>>>>>
>>>>>>>>>>> Hope this helps,
>>>>>>>>>>>
>>>>>>>>>>> Roger
>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>> Barry
>>>>>>>>>>>>
>>>>>>>>>>>> _______________________________________________
>>>>>>>>>>>> R-sig-Geo mailing list
>>>>>>>>>>>> R-sig-Geo at r-project.org
>>>>>>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>> --
>>>>>>>>>>> Roger Bivand
>>>>>>>>>>> Economic Geography Section, Department of Economics, Norwegian
>>>>>>>>>>> School
>>>>>>>>>>> of
>>>>>>>>>>> Economics and Business Administration, Helleveien 30, N-5045
>>>>>>>>>>> Bergen,
>>>>>>>>>>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>>>>>>>>>>> e-mail: Roger.Bivand at nhh.no
>>>>>>>>>>>
>>>>>>>>>>> _______________________________________________
>>>>>>>>>>> R-sig-Geo mailing list
>>>>>>>>>>> R-sig-Geo at r-project.org
>>>>>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>
>>>>>>>>> --
>>>>>>>>> Roger Bivand
>>>>>>>>> Economic Geography Section, Department of Economics, Norwegian
>>>>>>>>> School
>>>>>>>>> of
>>>>>>>>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>>>>>>>>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>>>>>>>>> e-mail: Roger.Bivand at nhh.no
>>>>>>>>>
>>>>>>>>> _______________________________________________
>>>>>>>>> R-sig-Geo mailing list
>>>>>>>>> R-sig-Geo at r-project.org
>>>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>>>>>
>>>>>>>>
>>>>>>>
>>>>>>> --
>>>>>>> Roger Bivand
>>>>>>> Economic Geography Section, Department of Economics, Norwegian School
>>>>>>> of
>>>>>>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>>>>>>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>>>>>>> e-mail: Roger.Bivand at nhh.no
>>>>>>>
>>>>>>> _______________________________________________
>>>>>>> R-sig-Geo mailing list
>>>>>>> R-sig-Geo at r-project.org
>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>>>
>>>>>>>
>>>>>>
>>>>>
>>>>> --
>>>>> Roger Bivand
>>>>> Economic Geography Section, Department of Economics, Norwegian School of
>>>>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>>>>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>>>>> e-mail: Roger.Bivand at nhh.no
>>>>>
>>>>> _______________________________________________
>>>>> R-sig-Geo mailing list
>>>>> R-sig-Geo at r-project.org
>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>
>>>>>
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at r-project.org
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>
>>>
>>
>> --
>> Roger Bivand
>> Economic Geography Section, Department of Economics, Norwegian School of
>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>> e-mail: Roger.Bivand at nhh.no
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From christian.kamenik at giub.unibe.ch  Thu Dec 16 21:26:15 2010
From: christian.kamenik at giub.unibe.ch (christian.kamenik at giub.unibe.ch)
Date: Thu, 16 Dec 2010 21:26:15 +0100
Subject: [R-sig-Geo] Converting array into raster brick
Message-ID: <20101216212615.14013deot59etvc7@mail.unibe.ch>

Dear all,

I needed to convert an array into a RasterBrick object. The output did  
not need to be written to memory, as assessed by canProcessInMemory().  
The only way to put the data into the RasterBrick that worked for me  
was layer by layer:

for (l in 1:nlayers(x)) x <-setValues(x,values=as.vector(t(xx[,,l])),layer=l)

This was quite complicated and slow. So I am wondering if there is a  
better way of doing this.

Many thanks, Christian


From r.hijmans at gmail.com  Thu Dec 16 23:15:58 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Thu, 16 Dec 2010 14:15:58 -0800
Subject: [R-sig-Geo] Converting array into raster brick
In-Reply-To: <20101216212615.14013deot59etvc7@mail.unibe.ch>
References: <20101216212615.14013deot59etvc7@mail.unibe.ch>
Message-ID: <AANLkTi=hC_CsXPsszhF5z0hxxMSV4sKv5X+3wjnP_sGT@mail.gmail.com>

Christian,

Could be quicker if you make a matrix out of the array (or, if
possible, avoid the array in the first place). See below

library(raster)

# create an array
m <- matrix(1:100, ncol=10, byrow=TRUE)
a <- array(list(m, m, m, m, m))

# empty RasterBrick
x <- brick(ncol=10, nrow=10)

# make matrix from array
v <- sapply(a, function(x) as.vector(t(x)))

x <- setValues(x, v)
plot(x)


Best, Robert

On Thu, Dec 16, 2010 at 12:26 PM,  <christian.kamenik at giub.unibe.ch> wrote:
> Dear all,
>
> I needed to convert an array into a RasterBrick object. The output did not
> need to be written to memory, as assessed by canProcessInMemory(). The only
> way to put the data into the RasterBrick that worked for me was layer by
> layer:
>
> for (l in 1:nlayers(x)) x
> <-setValues(x,values=as.vector(t(xx[,,l])),layer=l)
>
> This was quite complicated and slow. So I am wondering if there is a better
> way of doing this.
>
> Many thanks, Christian
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From andrewaduff at gmail.com  Fri Dec 17 02:23:01 2010
From: andrewaduff at gmail.com (andrewaduff)
Date: Thu, 16 Dec 2010 17:23:01 -0800 (PST)
Subject: [R-sig-Geo] potential BUG in BBMM
In-Reply-To: <BLU149-W45EE2BF4CCEF924B0C92E4BA140@phx.gbl>
References: <BLU149-W45EE2BF4CCEF924B0C92E4BA140@phx.gbl>
Message-ID: <1292548981204-5844166.post@n2.nabble.com>


see this link -
http://r-sig-geo.2731867.n2.nabble.com/potential-BUG-in-BBMM-td5289846.html
-- 
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Re-potential-BUG-in-BBMM-tp5840462p5844166.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From andrewaduff at gmail.com  Fri Dec 17 02:23:24 2010
From: andrewaduff at gmail.com (andrewaduff)
Date: Thu, 16 Dec 2010 17:23:24 -0800 (PST)
Subject: [R-sig-Geo] potential BUG in BBMM
In-Reply-To: <1291766145650-5813731.post@n2.nabble.com>
References: <AANLkTilXuL68E_9pvN9QwHjjm_F_hIRlTX4fmZmQN4Ts@mail.gmail.com>
	<1291766145650-5813731.post@n2.nabble.com>
Message-ID: <1292549004028-5844167.post@n2.nabble.com>


R-sig-geo group, 

I have found similar problems with the BBMM package in R.  I ran my datasets
through brownian bridge movement model as implemented in Animal Space Use,
http://www.cnr.uidaho.edu/population_ecology/animal_space_use.htm and the R
package adehabitat,
http://cran.r-project.org/web/packages/adehabitat/index.html (in adehabitat
with the help of Tyler, the original poster).  Both of the other programs
ran fine with similar outputs and the only problems I encountered were
dealing with the various formats needed for time, projections needed for
coordinates, and offsetting of discretized (rounded) sample points. 

When I ran the sample dataset included with the BBMM package, some of the
time the sample dataset would preform properly and sometimes I would get a
result returned with NaN for all probability values on both R 2.11.1 32-bit
and 64-bit.  The author was helpful in troubleshooting, I just choose to
implement the brownian bridge in adehabitat because of Tylers success with
the package and my short timeline for troubleshooting.  The Author of BBMM
had no problems with the sample dataset on his machine.  I speculate that
either data issues were causing problems and were masked by the routines in
BBMM and these errors did not halt calculation.  The raptor datasets I
worked with had problems like data discretion (rounding errors introduced by
Argos sattelite limitations) but those were dealt with by offseting routines
written in SAS.  My point clouds were somwhat dense with 1000-4000 points
per bird per year.   

I would be interested in any experiences others had with the package as we
might be able to provide insight to the author address the problems
encountered in this posting. 

Andrew Duff 

-- 
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/potential-BUG-in-BBMM-tp5289846p5844167.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From dustin.duncan at post.harvard.edu  Fri Dec 17 05:07:13 2010
From: dustin.duncan at post.harvard.edu (Dustin Duncan)
Date: Thu, 16 Dec 2010 23:07:13 -0500
Subject: [R-sig-Geo] KNN spatial weights matrix: asymmetric vs symmetric for
 spatial autoregressive models
Message-ID: <AANLkTi=M7+o5RJ0do2W1aTkRLAjbyF3zeE12OAPnd465@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101216/1ca58f81/attachment.pl>

From tarek.ben.amara at googlemail.com  Fri Dec 17 10:16:47 2010
From: tarek.ben.amara at googlemail.com (Tarek Benamara)
Date: Fri, 17 Dec 2010 10:16:47 +0100
Subject: [R-sig-Geo] INTAMAP--->GeoTIFF
Message-ID: <AANLkTikkMP48CrbpaAy1vgFGuDSdDDPojo5Yo=rj2w6x@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101217/c768a666/attachment.pl>

From jim at bitwrit.com.au  Fri Dec 17 10:36:32 2010
From: jim at bitwrit.com.au (Jim Lemon)
Date: Fri, 17 Dec 2010 20:36:32 +1100
Subject: [R-sig-Geo] [R] Drawing Maps of detailed Australian regions
In-Reply-To: <4D09D35D.2080205@bitwrit.com.au>
References: <378EB90FD48A9E47A49222E07DF06BAAA767B7@AUSYDEXC37.au.kworld.kpmg.com>	<AANLkTin2XwwKgf5=t+Re0+wqk4qv4VDfj8G3=K071Dc-@mail.gmail.com>	<4D088F94.1000503@bitwrit.com.au>
	<AANLkTimfUAkDArmiJgxv1dt=i7S+4LH43DJ3nHMZEX54@mail.gmail.com>
	<4D09D35D.2080205@bitwrit.com.au>
Message-ID: <4D0B2F20.8000408@bitwrit.com.au>

On 12/16/2010 07:52 PM, Jim Lemon wrote:
> ...
> just for the heck of it and _then_ I was able to install rgdal. I'm
> using Fedora 12 and R-2.10.1 if anyone else out there is having the same
> problem(s).
>
Hi again,
No, it didn't work. Although the rgdal package was installed, when I 
tried to load it:

 > library(rgdal)
Loading required package: sp
Error in dyn.load(file, DLLpath = DLLpath, ...) :
   unable to load shared library 
'/usr/local/lib/R/library/rgdal/libs/rgdal.so':
   libgdal.so: cannot open shared object file: No such file or directory
Error: package/namespace load failed for 'rgdal'

but when I looked:

  ls -l /usr/local/lib/R/library/rgdal/libs/rgdal.so
-rwxr-xr-x. 1 root root 261049 2010-12-16 19:42 
/usr/local/lib/R/library/rgdal/libs/rgdal.so

there it was. Back to the drawing board.

Jim


From jon.skoien at jrc.ec.europa.eu  Fri Dec 17 10:49:03 2010
From: jon.skoien at jrc.ec.europa.eu (Jon Olav Skoien)
Date: Fri, 17 Dec 2010 10:49:03 +0100
Subject: [R-sig-Geo] INTAMAP--->GeoTIFF
In-Reply-To: <AANLkTikkMP48CrbpaAy1vgFGuDSdDDPojo5Yo=rj2w6x@mail.gmail.com>
References: <AANLkTikkMP48CrbpaAy1vgFGuDSdDDPojo5Yo=rj2w6x@mail.gmail.com>
Message-ID: <4D0B320F.3000408@jrc.ec.europa.eu>

Hi Tarek,
> output = interpolate(observations = e,
> predictionLocations = grd,
> outputWhat = list(mean=T, variance=T, excprob = 7),
> maximumTime = 30,
> methodName = "automatic",
> optList = list() )
> plot(output)
> #how generate a GeoTIFF ?
You can generate the GeoTIFF with a call to writeGDAL with the results 
of the interpolation, which will be in output$predictions:
 > writeGDAL(output$predictions, fname = "result.tif", drivername = "GTiff")
You will then get a GeoTIFF with two bands - the interpolation and the 
kriging variance. If you are just interested in the interpolation 
result, you can instead call:
 > writeGDAL(output$predictions[,"var1.pred"], fname = "result.tif", 
drivername = "GTiff")


Cheers,
Jon


From villers.alexandre at gmail.com  Fri Dec 17 10:54:40 2010
From: villers.alexandre at gmail.com (Alexandre Villers)
Date: Fri, 17 Dec 2010 11:54:40 +0200
Subject: [R-sig-Geo] INTAMAP--->GeoTIFF
In-Reply-To: <AANLkTik5-zQm_MN7HjtztjgYqxgnTHOQwTpgkeG9LjEG@mail.gmail.com>
References: <AANLkTikkMP48CrbpaAy1vgFGuDSdDDPojo5Yo=rj2w6x@mail.gmail.com>	<4D0B2E0D.8010203@gmail.com>
	<AANLkTik5-zQm_MN7HjtztjgYqxgnTHOQwTpgkeG9LjEG@mail.gmail.com>
Message-ID: <4D0B3360.5080706@gmail.com>

Hey,

After checking the vignette of Intamap, you can find out from this 
example that

data(meuse)
coordinates(meuse) = ~x+y
meuse$value = meuse$zinc
data(meuse.grid)
gridded(meuse.grid) = ~x+y
x = interpolate(meuse, meuse.grid, list(mean=TRUE, variance=TRUE))

x$predictions is a SpatialPixelsDataFrame which can easily be writen 
into a Geotiff with writeGDAL

str(x$predictions)
Formal class 'SpatialPixelsDataFrame' [package "sp"] with 7 slots
   ..@ data       :'data.frame': 3103 obs. of  2 variables:
   .. ..$ var1.pred: num [1:3103] 855 918 831 745 988 ...
   .. ..$ var1.var : num [1:3103] 42417 32710 35528 38716 22472 ...
   ..@ coords.nrs : num(0)
   ..@ grid       :Formal class 'GridTopology' [package "sp"] with 3 slots
   .. .. ..@ cellcentre.offset: Named num [1:2] 178460 329620
   .. .. .. ..- attr(*, "names")= chr [1:2] "x" "y"
   .. .. ..@ cellsize         : Named num [1:2] 40 40
   .. .. .. ..- attr(*, "names")= chr [1:2] "x" "y"
   .. .. ..@ cells.dim        : Named int [1:2] 78 104
   .. .. .. ..- attr(*, "names")= chr [1:2] "x" "y"
   ..@ grid.index : int [1:3103] 69 146 147 148 223 224 225 226 300 301 ...
   ..@ coords     : num [1:3103, 1:2] 181180 181140 181180 181220 181100 ...
   .. ..- attr(*, "dimnames")=List of 2
   .. .. ..$ : NULL
   .. .. ..$ : chr [1:2] "x" "y"
   ..@ bbox       : num [1:2, 1:2] 178440 329600 181560 333760
   .. ..- attr(*, "dimnames")=List of 2
   .. .. ..$ : chr [1:2] "x" "y"
   .. .. ..$ : chr [1:2] "min" "max"
   ..@ proj4string:Formal class 'CRS' [package "sp"] with 1 slots
   .. .. ..@ projargs: chr NA

Watch out that the projection is not defined.
I guess that writeGDAL(x$predictions, ....) with appropriate file name 
and driver should do the trick

HTH

Alex


From Roger.Bivand at nhh.no  Fri Dec 17 10:56:40 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 17 Dec 2010 10:56:40 +0100 (CET)
Subject: [R-sig-Geo] KNN spatial weights matrix: asymmetric vs symmetric
 for spatial autoregressive models
In-Reply-To: <AANLkTi=M7+o5RJ0do2W1aTkRLAjbyF3zeE12OAPnd465@mail.gmail.com>
References: <AANLkTi=M7+o5RJ0do2W1aTkRLAjbyF3zeE12OAPnd465@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.1012171041320.30480@reclus.nhh.no>

On Thu, 16 Dec 2010, Dustin Duncan wrote:

> hi all,
>
> i have one question ***does it matter if the KNN spatial weights matrix is
> asymmetric or symmetric for linear spatial autoregressive models? *** i am
> getting slightly different findings depending on the weights matrix
> specification for the Lagrange multiplier diagnostic for spatial dependence.
> i am using Bivand's spdep package for these analysis. i've read that GeoDA
> can't fit KNN spatial models due to the asymmetry (for now), but that using
> KNN is legitimate for these spatial autoregresive models. however, i could
> use the asymmetric version or the symmetric one (though making KNN symmetric
> sounds a bit strange to me). any insight is greatly appreciated!!

The approximation to the Jacobian used in GeoDa requires that W be 
symmetric (or similar to symmetric, Ord, 1975). The MC approximation used 
in the Matlab toolbox does not. In spdep, you can use method="eigen" for 
smaller data sets, "LU" for exact Jacobian larger data sets, or "MC", with 
intrinsically asymmetric W. However, note that the differences between a 
symmetricised KNN W and the original one may not be large, as in SAR 
(simultaneous rather than CAR conditional) SSE terms, you do get W'W 
appearing, though its influence will vary. Try checking to see whether 
results vary enough to change your inferences:

library(spdep)
example(columbus)
knn4 <- knn2nb(knearneigh(coordinates(columbus), k=6))
knn4
knn4s <- make.sym.nb(knn4)
lw <- nb2listw(knn4)
lws <- nb2listw(knn4s)
summary(lagsarlm(CRIME ~ HOVAL + INC, data=columbus, listw=lw))
summary(lagsarlm(CRIME ~ HOVAL + INC, data=columbus, listw=lws))

So if you have to make the KNN weights symmetric to use - say - GeoDa, it 
may not matter that much in practice.

Hope this helps,

Roger

>
> thanks and happy holidays, dustin
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From b.rowlingson at lancaster.ac.uk  Fri Dec 17 11:45:05 2010
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Fri, 17 Dec 2010 10:45:05 +0000
Subject: [R-sig-Geo] [R] Drawing Maps of detailed Australian regions
In-Reply-To: <4D0B2F20.8000408@bitwrit.com.au>
References: <378EB90FD48A9E47A49222E07DF06BAAA767B7@AUSYDEXC37.au.kworld.kpmg.com>
	<AANLkTin2XwwKgf5=t+Re0+wqk4qv4VDfj8G3=K071Dc-@mail.gmail.com>
	<4D088F94.1000503@bitwrit.com.au>
	<AANLkTimfUAkDArmiJgxv1dt=i7S+4LH43DJ3nHMZEX54@mail.gmail.com>
	<4D09D35D.2080205@bitwrit.com.au> <4D0B2F20.8000408@bitwrit.com.au>
Message-ID: <AANLkTikMMQ+dccMhoFet8mGQG7mavk1-uZ1o=tMar5Ji@mail.gmail.com>

On Fri, Dec 17, 2010 at 9:36 AM, Jim Lemon <jim at bitwrit.com.au> wrote:
> On 12/16/2010 07:52 PM, Jim Lemon wrote:

> ?unable to load shared library
> '/usr/local/lib/R/library/rgdal/libs/rgdal.so':
> ?libgdal.so: cannot open shared object file: No such file or directory
> Error: package/namespace load failed for 'rgdal'
>
> but when I looked:
>
> ?ls -l /usr/local/lib/R/library/rgdal/libs/rgdal.so
> -rwxr-xr-x. 1 root root 261049 2010-12-16 19:42
> /usr/local/lib/R/library/rgdal/libs/rgdal.so
>

 The  error message is that libgdal.so cannot be found - this is the
GDAL C-level binary library, whereas
/usr/local/lib/R/library/rgdal/libs/rgdal.so is the R code that
interfaces to libgdal.so.

 R tries to load rgdal.so, rgdal.so tries to load libgdal.so, can't
find it, fails.

Sadly it doesn't say where it's looking for it. Can you find
libgdal.so anywhere?

Barry


From jim at bitwrit.com.au  Fri Dec 17 12:22:48 2010
From: jim at bitwrit.com.au (Jim Lemon)
Date: Fri, 17 Dec 2010 22:22:48 +1100
Subject: [R-sig-Geo] [R] Drawing Maps of detailed Australian regions
In-Reply-To: <AANLkTikMMQ+dccMhoFet8mGQG7mavk1-uZ1o=tMar5Ji@mail.gmail.com>
References: <378EB90FD48A9E47A49222E07DF06BAAA767B7@AUSYDEXC37.au.kworld.kpmg.com>	<AANLkTin2XwwKgf5=t+Re0+wqk4qv4VDfj8G3=K071Dc-@mail.gmail.com>	<4D088F94.1000503@bitwrit.com.au>	<AANLkTimfUAkDArmiJgxv1dt=i7S+4LH43DJ3nHMZEX54@mail.gmail.com>	<4D09D35D.2080205@bitwrit.com.au>	<4D0B2F20.8000408@bitwrit.com.au>
	<AANLkTikMMQ+dccMhoFet8mGQG7mavk1-uZ1o=tMar5Ji@mail.gmail.com>
Message-ID: <4D0B4808.5000605@bitwrit.com.au>

On 12/17/2010 09:45 PM, Barry Rowlingson wrote:
> ...
>   The  error message is that libgdal.so cannot be found - this is the
> GDAL C-level binary library, whereas
> /usr/local/lib/R/library/rgdal/libs/rgdal.so is the R code that
> interfaces to libgdal.so.
>
>   R tries to load rgdal.so, rgdal.so tries to load libgdal.so, can't
> find it, fails.
>
> Sadly it doesn't say where it's looking for it. Can you find
> libgdal.so anywhere?
>
Why of course:

/home/jim/Download/FWTools-2.0.6/lib/libgdal.so
/home/jim/Download/FWTools-2.0.6/lib/libgdal.so.1
/home/jim/Download/FWTools-2.0.6/lib/libgdal.so.1.6.0
/usr/lib/libgdal.so.1
/usr/lib/libgdal.so.1.13.1
/usr/lib/ogdi/libgdal.so

So I copied the file to the same directory:

cp /home/jim/Download/FWTools-2.0.6/lib/libgdal.so 
/usr/local/lib/R/library/rgdal/libs

and then got one step further:

library(rgdal)
Error in dyn.load(file, DLLpath = DLLpath, ...) :
   unable to load shared library 
'/usr/local/lib/R/library/rgdal/libs/rgdal.so':
   libstdc++.so.5: cannot open shared object file: No such file or directory
Error: package/namespace load failed for 'rgdal'

So I copied that file to the same directory:

cp /home/jim/Download/FWTools-2.0.6/lib/libstdc++.so.5 
/usr/local/lib/R/library/rgdal/libs

library(rgdal)
Error in dyn.load(file, DLLpath = DLLpath, ...) :
   unable to load shared library 
'/usr/local/lib/R/library/rgdal/libs/rgdal.so':
   libstdc++.so.5: cannot open shared object file: No such file or directory
Error: package/namespace load failed for 'rgdal'

and that's where I'm stuck. I really hope that it isn't this hard for 
everyone who tries to use this package.

Jim


From Roger.Bivand at nhh.no  Fri Dec 17 13:25:38 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 17 Dec 2010 13:25:38 +0100 (CET)
Subject: [R-sig-Geo] [R] Drawing Maps of detailed Australian regions
In-Reply-To: <4D0B4808.5000605@bitwrit.com.au>
References: <378EB90FD48A9E47A49222E07DF06BAAA767B7@AUSYDEXC37.au.kworld.kpmg.com>
	<AANLkTin2XwwKgf5=t+Re0+wqk4qv4VDfj8G3=K071Dc-@mail.gmail.com>
	<4D088F94.1000503@bitwrit.com.au>
	<AANLkTimfUAkDArmiJgxv1dt=i7S+4LH43DJ3nHMZEX54@mail.gmail.com>
	<4D09D35D.2080205@bitwrit.com.au> <4D0B2F20.8000408@bitwrit.com.au>
	<AANLkTikMMQ+dccMhoFet8mGQG7mavk1-uZ1o=tMar5Ji@mail.gmail.com>
	<4D0B4808.5000605@bitwrit.com.au>
Message-ID: <alpine.LRH.2.00.1012171253100.31321@reclus.nhh.no>

On Fri, 17 Dec 2010, Jim Lemon wrote:

> On 12/17/2010 09:45 PM, Barry Rowlingson wrote:
>> ...
>>   The  error message is that libgdal.so cannot be found - this is the
>> GDAL C-level binary library, whereas
>> /usr/local/lib/R/library/rgdal/libs/rgdal.so is the R code that
>> interfaces to libgdal.so.
>>
>>   R tries to load rgdal.so, rgdal.so tries to load libgdal.so, can't
>> find it, fails.
>> 
>> Sadly it doesn't say where it's looking for it. Can you find
>> libgdal.so anywhere?
>> 
> Why of course:

NO!

On Unix/Linux, please read up about ldconfig, and make sure that the 
shared object is in the correct path (once you have a good understanding 
of ldconfig). You seem to be using a Windows tactic of placing an 
apparently missing DLL in an apparently visible directory. Doing it right 
is really easy, and always works unless one scatters multiple *.so around. 
You have multiple libgdal.so installed. You need to establish which one 
was the one rgdal.so was build against, and ensure that it is in the path. 
Then all of the remaining dependencies will fulfill automatically.

If you want to see what your rgdal.so depends on, do:

ldd rgdal.so

Then make sure that that/those directories are included in the path 
established by ldconfig (most will be, but /usr/lib/ogdi and
/home/jim/Download/FWTools-2.0.6/lib will not), or in an environment 
variable (set for example in your .bashrc) LD_LIBRARY_PATH. In general, 
binary installs should run ldconfig themselves, but you are - below - 
probably missing a symbolic link in /usr/lib, and appear to not to have 
installed the binaries satisfactorily.

I'm not sure from the thread that you explained how you installed rgdal, 
or whether you subsequently changed any of the things it depends on. For a 
clean install, do:

R CMD check rgdal_*.tar.gz

Complete the dependencies until it passes. Once it passes, you are good to 
go:

R CMD INSTALL rgdal_*.tar.gz

I think that your GDAL and PROJ4 installs are wrong/insufficient - for yum 
I would look for gdal, gdal-devel, proj, proj-devel, proj-nad, and 
possibly proj-epsg (see inst/README in the source package). Installing 
PROJ.4 and GDAL from source is often less trouble than handling multiple 
binaries, unless you set environment variable LD_LIBRARY_PATH, or use 
ldconfig, consistently, so that rgdal.so can "see" what it depends on. But 
do try to check with the source package first, because then the checked 
dependency routes should remain valid (until something is changed).

It is always sensible to run at least:

gdal-config --version
gdalinfo --version
proj -l

from the command line, to check that GDAL and PROJ4 utility programs find 
their own shared objects, and that the two gdal* commands report the same 
version.

Hope this helps,

Roger

>
> /home/jim/Download/FWTools-2.0.6/lib/libgdal.so
> /home/jim/Download/FWTools-2.0.6/lib/libgdal.so.1
> /home/jim/Download/FWTools-2.0.6/lib/libgdal.so.1.6.0
> /usr/lib/libgdal.so.1
> /usr/lib/libgdal.so.1.13.1
> /usr/lib/ogdi/libgdal.so
>
> So I copied the file to the same directory:
>
> cp /home/jim/Download/FWTools-2.0.6/lib/libgdal.so 
> /usr/local/lib/R/library/rgdal/libs
>
> and then got one step further:
>
> library(rgdal)
> Error in dyn.load(file, DLLpath = DLLpath, ...) :
>  unable to load shared library 
> '/usr/local/lib/R/library/rgdal/libs/rgdal.so':
>  libstdc++.so.5: cannot open shared object file: No such file or directory
> Error: package/namespace load failed for 'rgdal'
>
> So I copied that file to the same directory:
>
> cp /home/jim/Download/FWTools-2.0.6/lib/libstdc++.so.5 
> /usr/local/lib/R/library/rgdal/libs
>
> library(rgdal)
> Error in dyn.load(file, DLLpath = DLLpath, ...) :
>  unable to load shared library 
> '/usr/local/lib/R/library/rgdal/libs/rgdal.so':
>  libstdc++.so.5: cannot open shared object file: No such file or directory
> Error: package/namespace load failed for 'rgdal'
>
> and that's where I'm stuck. I really hope that it isn't this hard for 
> everyone who tries to use this package.
>
> Jim
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From alobolistas at gmail.com  Fri Dec 17 13:38:15 2010
From: alobolistas at gmail.com (Agustin Lobo)
Date: Fri, 17 Dec 2010 13:38:15 +0100
Subject: [R-sig-Geo] sampleRandom
Message-ID: <AANLkTinv+zD9Nq6CKMxvVCDFBHBord+KLX_SwH0eOdbw@mail.gmail.com>

Robert,

Could you make the output of sampleRandom() to optionally be an
spatial points data frame with the raster values across bands in the
table?
(I know it can be done currently through cells=T etc, but it would be
handy having the sppdf directly)
BTW, having row,col in addition to cell number would be handy as well

Agus


From gianni.lavaredo at gmail.com  Fri Dec 17 14:57:27 2010
From: gianni.lavaredo at gmail.com (gianni lavaredo)
Date: Fri, 17 Dec 2010 14:57:27 +0100
Subject: [R-sig-Geo] help to select part of a data.frame column
Message-ID: <AANLkTik+E5Fp-r93d3jURQqHLbLi5G90NOn23J54oQiS@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101217/03720201/attachment.pl>

From roman.lustrik at gmail.com  Fri Dec 17 15:04:07 2010
From: roman.lustrik at gmail.com (=?UTF-8?Q?Roman_Lu=C5=A1trik?=)
Date: Fri, 17 Dec 2010 15:04:07 +0100
Subject: [R-sig-Geo] help to select part of a data.frame column
In-Reply-To: <AANLkTik+E5Fp-r93d3jURQqHLbLi5G90NOn23J54oQiS@mail.gmail.com>
References: <AANLkTik+E5Fp-r93d3jURQqHLbLi5G90NOn23J54oQiS@mail.gmail.com>
Message-ID: <AANLkTimAp26Y2maV3-EKGXFecEP766iVwApkKYme9fYh@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101217/a3c963c4/attachment.pl>

From roman.lustrik at gmail.com  Fri Dec 17 16:02:21 2010
From: roman.lustrik at gmail.com (=?UTF-8?Q?Roman_Lu=C5=A1trik?=)
Date: Fri, 17 Dec 2010 16:02:21 +0100
Subject: [R-sig-Geo] help to select part of a data.frame column
In-Reply-To: <AANLkTikwNqTtzn3Kvs4A0tjTf2sDvRc8mk=oBxCeN_Yg@mail.gmail.com>
References: <AANLkTik+E5Fp-r93d3jURQqHLbLi5G90NOn23J54oQiS@mail.gmail.com>
	<AANLkTimAp26Y2maV3-EKGXFecEP766iVwApkKYme9fYh@mail.gmail.com>
	<AANLkTikwNqTtzn3Kvs4A0tjTf2sDvRc8mk=oBxCeN_Yg@mail.gmail.com>
Message-ID: <AANLkTinhV1-=UPFtiXU=pnZbnpPabD_7-t+HAzqBWg+X@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101217/152db1e7/attachment.pl>

From karl at huftis.org  Fri Dec 17 16:15:28 2010
From: karl at huftis.org (Karl Ove Hufthammer)
Date: Fri, 17 Dec 2010 16:15:28 +0100
Subject: [R-sig-Geo] Plot mean of variable on a map
References: <AANLkTik2r3P5+m68BTORzgeDcAyshA06M-H74qZx9SZv@mail.gmail.com>
Message-ID: <iefuqg$jnk$1@dough.gmane.org>

Aleksandr Andreev wrote:

> I would like to plot the price on the map in a "heat" style plot. The
> natural way to do this by computing a local average price for a
> specified neighborhood around (Lat, Lon) (say, of 0.01 of a degree
> across -- I have enough data to make this as fine as I need).
> 
> Does anyone have suggestions on the best way to do this?

I had the same problems a few months ago. See 
http://thread.gmane.org/gmane.comp.lang.r.geo/9055
for some ideas on how to solve it.

-- 
Karl Ove Hufthammer


From dustin.duncan at post.harvard.edu  Fri Dec 17 21:57:19 2010
From: dustin.duncan at post.harvard.edu (Dustin Duncan)
Date: Fri, 17 Dec 2010 15:57:19 -0500
Subject: [R-sig-Geo] KNN spatial weights matrix: asymmetric vs symmetric
 for spatial autoregressive models
In-Reply-To: <alpine.LRH.2.00.1012171041320.30480@reclus.nhh.no>
References: <AANLkTi=M7+o5RJ0do2W1aTkRLAjbyF3zeE12OAPnd465@mail.gmail.com>
	<alpine.LRH.2.00.1012171041320.30480@reclus.nhh.no>
Message-ID: <AANLkTin1JFYwWopMH288wOtc-hBEHM_tYBChiU_hUaXb@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101217/b2ab5ea8/attachment.pl>

From alobolistas at gmail.com  Fri Dec 17 22:04:35 2010
From: alobolistas at gmail.com (Agustin Lobo)
Date: Fri, 17 Dec 2010 22:04:35 +0100
Subject: [R-sig-Geo] function parameters in overlay()
Message-ID: <AANLkTik4hZP=LdDsmsSOcMm5W7C4L4HdJyqUUPwX4zzb@mail.gmail.com>

Robert,

How can I define parameters in the functions within overlay() ?
For example:

> fun3 = function(x,y)
{a=-1.1867422
 s=1.0287373
 return((y-(a+s*x))/sqrt(s^2+1))}
> NmaxDev = overlay(bN1999max,bN2009max,fun=fun2,filename="NmaxDev",overwrite=TRUE,format="EHdr",datatype='FLT4S', NAflag=0)

want it to be something like:

> fun3 = function(x,y,a,b)
{return((y-(a+s*x))/sqrt(s^2+1))}
> NmaxDev = overlay(bN1999max,bN2009max,fun=fun2(a=-1.1867422,s=1.0287373),filename="NmaxDev",overwrite=TRUE,format="EHdr",datatype='FLT4S', NAflag=0)

Is it possible or should I redefine the function every time?

Agus


From arnold_salvacion at yahoo.com  Fri Dec 17 23:24:02 2010
From: arnold_salvacion at yahoo.com (Arnold Salvacion)
Date: Sat, 18 Dec 2010 06:24:02 +0800 (SGT)
Subject: [R-sig-Geo] Spatio-Temporal Analysis
Message-ID: <116873.42996.qm@web76903.mail.sg1.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101218/cda7706a/attachment.pl>

From edzer.pebesma at uni-muenster.de  Fri Dec 17 23:42:29 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Fri, 17 Dec 2010 23:42:29 +0100
Subject: [R-sig-Geo] Spatio-Temporal Analysis
In-Reply-To: <116873.42996.qm@web76903.mail.sg1.yahoo.com>
References: <116873.42996.qm@web76903.mail.sg1.yahoo.com>
Message-ID: <4D0BE755.9060800@uni-muenster.de>

Arnold, are the sample locations constant over time?

On 12/17/2010 11:24 PM, Arnold Salvacion wrote:
> Dear Colleagues,
> 
> Good day!
> 
> I
>  have this time series data (12 years)  of aflatoxin contamination in 
> several counties in US. I want to test if there is spatio-temporal 
> clustering of contamination and hopefully develop a spatio-temporal 
> model of contamination. I am new to spatio-temporal analysis and R. I 
> would be very much appreciate any help on this one.
> 
> Advance Merry Christmas!
> 
> 
> Arnold
>         	r-sig-geo at r-project.org
> 
> 
>       
> 	[[alternative HTML version deleted]]
> 
> 
> 
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From r.hijmans at gmail.com  Fri Dec 17 23:58:50 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Fri, 17 Dec 2010 14:58:50 -0800
Subject: [R-sig-Geo] function parameters in overlay()
In-Reply-To: <AANLkTik4hZP=LdDsmsSOcMm5W7C4L4HdJyqUUPwX4zzb@mail.gmail.com>
References: <AANLkTik4hZP=LdDsmsSOcMm5W7C4L4HdJyqUUPwX4zzb@mail.gmail.com>
Message-ID: <AANLkTi=pryb_HMt_gBqUUEt4AZUh+PzGDOQ8aj1JUC4u@mail.gmail.com>

Agus,

# self contained example...
library(raster)
r1 <- raster(nrow=10, ncol=10)
r1[] = 1:ncell(r1)
r2 <- r1

# base case
fun1 = function(x,y){ a=-1.1867422; s=1.0287373;
return((y-(a+s*x))/sqrt(s^2+1))}
x = overlay(r1, r2, fun=fun1 )

# changing a & s without changing fun2, perhaps clumsy
fun2 = function(x,y,a,s) {return((y-(a+s*x))/sqrt(s^2+1))}
x1 = overlay(r1, r2, fun=function(x,y){fun2 (x, y, a=-1.1867422,s=1.0287373)})
x2 = overlay(r1, r2, fun=function(...){fun2 (..., a=-1.1867422,s=1.0287373)})

# changing a & s without changing fun3, perhaps cleaner
# I believe this works because a and s are defined in the same
environment as fun3
fun3 = function(x,y) { return((y-(a+s*x))/sqrt(s^2+1)) }
a = -1.1867422
s = 1.0287373	
x3 = overlay(r1, r2, fun=fun3)

Best, Robert

On Fri, Dec 17, 2010 at 1:04 PM, Agustin Lobo <alobolistas at gmail.com> wrote:
> Robert,
>
> How can I define parameters in the functions within overlay() ?
> For example:
>
>> fun3 = function(x,y)
> {a=-1.1867422
> ?s=1.0287373
> ?return((y-(a+s*x))/sqrt(s^2+1))}
>> NmaxDev = overlay(bN1999max,bN2009max,fun=fun2,filename="NmaxDev",overwrite=TRUE,format="EHdr",datatype='FLT4S', NAflag=0)
>
> want it to be something like:
>
>> fun3 = function(x,y,a,b)
> {return((y-(a+s*x))/sqrt(s^2+1))}
>> NmaxDev = overlay(bN1999max,bN2009max,fun=fun2(a=-1.1867422,s=1.0287373),filename="NmaxDev",overwrite=TRUE,format="EHdr",datatype='FLT4S', NAflag=0)
>
> Is it possible or should I redefine the function every time?
>
> Agus
>


From jim at bitwrit.com.au  Sat Dec 18 02:01:07 2010
From: jim at bitwrit.com.au (Jim Lemon)
Date: Sat, 18 Dec 2010 12:01:07 +1100
Subject: [R-sig-Geo] [R] Drawing Maps of detailed Australian regions
In-Reply-To: <alpine.LRH.2.00.1012171253100.31321@reclus.nhh.no>
References: <378EB90FD48A9E47A49222E07DF06BAAA767B7@AUSYDEXC37.au.kworld.kpmg.com>
	<AANLkTin2XwwKgf5=t+Re0+wqk4qv4VDfj8G3=K071Dc-@mail.gmail.com>
	<4D088F94.1000503@bitwrit.com.au>
	<AANLkTimfUAkDArmiJgxv1dt=i7S+4LH43DJ3nHMZEX54@mail.gmail.com>
	<4D09D35D.2080205@bitwrit.com.au> <4D0B2F20.8000408@bitwrit.com.au>
	<AANLkTikMMQ+dccMhoFet8mGQG7mavk1-uZ1o=tMar5Ji@mail.gmail.com>
	<4D0B4808.5000605@bitwrit.com.au>
	<alpine.LRH.2.00.1012171253100.31321@reclus.nhh.no>
Message-ID: <4D0C07D3.10807@bitwrit.com.au>

On 12/17/2010 11:25 PM, Roger Bivand wrote:

First, thanks for taking the time to look at this and suggest something 
that has at least gotten me past the missing library problem. What I 
have done so far is to find what appeared to be a solution for each 
problem as it appeared and follow the instructions given.
> ...
> NO!
>
> On Unix/Linux, please read up about ldconfig, and make sure that the
> shared object is in the correct path (once you have a good understanding
> of ldconfig). You seem to be using a Windows tactic of placing an
> apparently missing DLL in an apparently visible directory. Doing it
> right is really easy, and always works unless one scatters multiple *.so
> around. You have multiple libgdal.so installed. You need to establish
> which one was the one rgdal.so was build against, and ensure that it is
> in the path. Then all of the remaining dependencies will fulfill
> automatically.
>
> If you want to see what your rgdal.so depends on, do:
>
> ldd rgdal.so
>
> Then make sure that that/those directories are included in the path
> established by ldconfig (most will be, but /usr/lib/ogdi and
> /home/jim/Download/FWTools-2.0.6/lib will not), or in an environment
> variable (set for example in your .bashrc) LD_LIBRARY_PATH. In general,
> binary installs should run ldconfig themselves, but you are - below -
> probably missing a symbolic link in /usr/lib, and appear to not to have
> installed the binaries satisfactorily.
>
This showed where the libraries should go, and after I had fixed all of 
the "not found" libraries, rgdal.so seems to be able to find them.

> I'm not sure from the thread that you explained how you installed rgdal,

I used "install.packages" which failed until I had installed all the 
GDAL stuff, then started reporting the "can't find" errors

> or whether you subsequently changed any of the things it depends on. For
> a clean install, do:
>
> R CMD check rgdal_*.tar.gz
>
> Complete the dependencies until it passes. Once it passes, you are good
> to go:
>
> R CMD INSTALL rgdal_*.tar.gz
>
> I think that your GDAL and PROJ4 installs are wrong/insufficient - for
> yum I would look for gdal, gdal-devel, proj, proj-devel, proj-nad, and
> possibly proj-epsg (see inst/README in the source package). Installing
> PROJ.4 and GDAL from source is often less trouble than handling multiple
> binaries, unless you set environment variable LD_LIBRARY_PATH, or use
> ldconfig, consistently, so that rgdal.so can "see" what it depends on.
> But do try to check with the source package first, because then the
> checked dependency routes should remain valid (until something is changed).
>
> It is always sensible to run at least:
>
> gdal-config --version
> gdalinfo --version
> proj -l
>
> from the command line, to check that GDAL and PROJ4 utility programs
> find their own shared objects, and that the two gdal* commands report
> the same version.
>
I have 1.6.0 for gdal-config and 1.6.1 for gdalinfo, and proj reports an 
immense amount of stuff, but gives no errors.

I really do appreciate your help, but I have wasted far too much of 
other people's time, so I am going to try to wipe everything and start 
again. If I succeed, I'll let you know.

Jim


From zenlines at gmail.com  Sat Dec 18 15:07:31 2010
From: zenlines at gmail.com (Brian Oney)
Date: Sat, 18 Dec 2010 15:07:31 +0100
Subject: [R-sig-Geo] Outline of Study area
Message-ID: <4D0CC023.6050602@gmail.com>

Hi List,
I am mosaicking several maps of different areas and I would like to make 
an outline of the different study areas for plotting etc.. I have played 
around extensively in GRASS and R and still don't have what I need. I 
would like to do it in R because, at the moment, I am a windows slave, 
and windows slaves are especially disadvantaged in GRASS.

# In R I have tried:
rast[!is.na(rast)] <- 1
rasterToPolygons(rast, function(x) !is.na(x)) # This just overwhelmed my 
computer and gave me lots of little polygons


#Trying the same after using aggregate also did not help speed.
#So say that I am satisfied with the product from raster to polygons.
#Then I use:
unionSpatialPolygons(polyrange, IDs=somethingsane) # And it takes an 
additional several hours time as well as excludes my islands.

Does anyone have suggestion to create an outline in a reasonable amount 
of time?
I would greatly appreciate it!

Regards,
Brian


From drnlazar at yahoo.com  Sat Dec 18 18:20:24 2010
From: drnlazar at yahoo.com (Dorina Lazar)
Date: Sat, 18 Dec 2010 09:20:24 -0800 (PST)
Subject: [R-sig-Geo] spatial clusters
In-Reply-To: <20101216084154.GA31662@greode>
Message-ID: <448722.67482.qm@web45212.mail.sp1.yahoo.com>

Georg,

Thanks for being very patient with me. 
 
I have not a shapefile for countries.

I have tried to obtain it. I have loaded a shapefile for Finland, GIS data, from  http://www.eea.europa.eu/data-and-maps/data/eea-reference-grids/zipped-shape-file-finland

and I tried to read the file FI_1K.shp
Fin<- readShapePoly(system.file("etc/shapes/ FI_1K.shp", package="spdep"))
but...
Error in getinfo.shape(filen) : Error opening SHP file

How can I obtain, for each country,  the shapefile spatial polygon in R (SpatialPolygons-DataFrame)?

Thanks again,
Dorina


--- On Thu, 12/16/10, Georg Ru? <research at georgruss.de> wrote:

> From: Georg Ru? <research at georgruss.de>
> Subject: Re: [R-sig-Geo] spatial clusters
> To: "Dorina Lazar" <dorina.lazar at econ.ubbcluj.ro>
> Cc: "R-sig-geo mailing list" <r-sig-geo at r-project.org>
> Date: Thursday, December 16, 2010, 10:41 AM
> On 16/12/10 09:06:33, dorina.lazar
> wrote:
> > How to create a shapefile including my data about some
> socio-demographic
> > indicators (7),? for about 30 countries around
> the world (to be read with
> > readShapePoly)?
> 
> Hi Dorina,
> 
> I'm not quite sure what you have and what you want.
> 
> I assume that you'd like to create a shapefile such that
> for every country
> (which is represented as a polygon) there's a vector of
> seven attributes
> attached to it:
> 
> country1:? attr1 attr2 attr3 attr4 attr5 attr6 attr7
> country2:? attr1 attr2 attr3 attr4 attr5 attr6 attr7
> ...
> 
> Do you have your countries as spatial polygons in R
> (SpatialPolygons-
> DataFrame or similar)? If yes, you should be able to add
> your socio-demo-
> graphic indicators to this data frame (just as in normal
> data frames). In
> this way you'd join the data you have inside R.
> 
> If you have the shapefile for the countries available and
> would like to
> edit this directly to add the indicators, I'd suggest using
> a GIS like
> GRASS http://grass.fbk.eu/ Afterwards, this can be easily
> read into R.
> 
> > Would be useful to suggest some good introductory
> lectures in spatial
> > statistics (links or books).
> 
> I think the following is what Roger would suggest:
> 
>  author = {Bivand, Roger S. and Pebesma, Edzer J. and
> G?mez-Rubio, Virgilio},
>  title = {Applied Spatial Data Analysis with R},
>  series = {Use R},
>  publisher = {Springer},
> 
> http://www.asdar-book.org/
> http://www.springerlink.com/content/uw07v1/
> (Depending on your login/institute you may have fulltext
> access, but the
> book is definitely worth buying anyway.)
> 
> Regards,
> Georg.
> --
> Research Assistant
> Otto-von-Guericke-Universit?t Magdeburg
> research at georgruss.de
> http://research.georgruss.de
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 





From roman.lustrik at gmail.com  Sat Dec 18 18:27:41 2010
From: roman.lustrik at gmail.com (=?UTF-8?Q?Roman_Lu=C5=A1trik?=)
Date: Sat, 18 Dec 2010 18:27:41 +0100
Subject: [R-sig-Geo] spatial clusters
In-Reply-To: <448722.67482.qm@web45212.mail.sp1.yahoo.com>
References: <20101216084154.GA31662@greode>
	<448722.67482.qm@web45212.mail.sp1.yahoo.com>
Message-ID: <AANLkTi=ja_ZoUxcYFR8-5tzYU2rwB1Lc=nqE8ZgnsXOT@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101218/7755b56f/attachment.pl>

From paulobrando at gmail.com  Sat Dec 18 18:39:53 2010
From: paulobrando at gmail.com (Paulo Brando)
Date: Sat, 18 Dec 2010 15:39:53 -0200
Subject: [R-sig-Geo] Changing pixel values in a stack file based on regular
	patterns
Message-ID: <AANLkTimsTg8AKiUm6S27ybw0bMwGo8yuMKD0Fwdp8XGY@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101218/7f039664/attachment.pl>

From Roger.Bivand at nhh.no  Sat Dec 18 18:42:35 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sat, 18 Dec 2010 18:42:35 +0100 (CET)
Subject: [R-sig-Geo] spatial clusters
In-Reply-To: <AANLkTi=ja_ZoUxcYFR8-5tzYU2rwB1Lc=nqE8ZgnsXOT@mail.gmail.com>
References: <20101216084154.GA31662@greode>
	<448722.67482.qm@web45212.mail.sp1.yahoo.com>
	<AANLkTi=ja_ZoUxcYFR8-5tzYU2rwB1Lc=nqE8ZgnsXOT@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.1012181836150.6558@reclus.nhh.no>

On Sat, 18 Dec 2010, Roman Lu?trik wrote:

> Perhaps you could follow the instructions from this
> exchange<http://r-sig-geo.2731867.n2.nabble.com/Guam-island-map-td4969467.html#a4972725>and
> see if you can extract the desired country (assuming the resolution
> suits you).
>

I don't think that we know which countries Dorina needs, or at which 
administrative level. If there are only 30 country observations, and the 
countries are not contiguous, then the whole exercise seems unnecessary. 
Can Dorina use the simplified world map in the maptools package:

library(maptools)
?wrld_simpl

adding the data using the ISO country names? If these are countries at 
some administrative division level, then maybe www.gadm.org will have what 
is needed, but the countries will have to be joined together, or the whole 
map subsetted. If these are say EU NUTS2 regions, then use can be made of 
GISCO shapefiles from Eurostat. But we don't know what boundaries are 
needed, and of course to use Skater for clustering, you need the 
boundaries.

Roger

>
> Cheers,
> Roman
>
>
>
> On Sat, Dec 18, 2010 at 6:20 PM, Dorina Lazar <drnlazar at yahoo.com> wrote:
>
>> Georg,
>>
>> Thanks for being very patient with me.
>>
>> I have not a shapefile for countries.
>>
>> I have tried to obtain it. I have loaded a shapefile for Finland, GIS data,
>> from
>> http://www.eea.europa.eu/data-and-maps/data/eea-reference-grids/zipped-shape-file-finland
>>
>> and I tried to read the file FI_1K.shp
>> Fin<- readShapePoly(system.file("etc/shapes/ FI_1K.shp", package="spdep"))
>> but...
>> Error in getinfo.shape(filen) : Error opening SHP file
>>
>> How can I obtain, for each country,  the shapefile spatial polygon in R
>> (SpatialPolygons-DataFrame)?
>>
>> Thanks again,
>> Dorina
>>
>>
>> --- On Thu, 12/16/10, Georg Ru? <research at georgruss.de> wrote:
>>
>>> From: Georg Ru? <research at georgruss.de>
>>> Subject: Re: [R-sig-Geo] spatial clusters
>>> To: "Dorina Lazar" <dorina.lazar at econ.ubbcluj.ro>
>>> Cc: "R-sig-geo mailing list" <r-sig-geo at r-project.org>
>>> Date: Thursday, December 16, 2010, 10:41 AM
>>> On 16/12/10 09:06:33, dorina.lazar
>>> wrote:
>>>> How to create a shapefile including my data about some
>>> socio-demographic
>>>> indicators (7),  for about 30 countries around
>>> the world (to be read with
>>>> readShapePoly)?
>>>
>>> Hi Dorina,
>>>
>>> I'm not quite sure what you have and what you want.
>>>
>>> I assume that you'd like to create a shapefile such that
>>> for every country
>>> (which is represented as a polygon) there's a vector of
>>> seven attributes
>>> attached to it:
>>>
>>> country1:  attr1 attr2 attr3 attr4 attr5 attr6 attr7
>>> country2:  attr1 attr2 attr3 attr4 attr5 attr6 attr7
>>> ...
>>>
>>> Do you have your countries as spatial polygons in R
>>> (SpatialPolygons-
>>> DataFrame or similar)? If yes, you should be able to add
>>> your socio-demo-
>>> graphic indicators to this data frame (just as in normal
>>> data frames). In
>>> this way you'd join the data you have inside R.
>>>
>>> If you have the shapefile for the countries available and
>>> would like to
>>> edit this directly to add the indicators, I'd suggest using
>>> a GIS like
>>> GRASS http://grass.fbk.eu/ Afterwards, this can be easily
>>> read into R.
>>>
>>>> Would be useful to suggest some good introductory
>>> lectures in spatial
>>>> statistics (links or books).
>>>
>>> I think the following is what Roger would suggest:
>>>
>>>  author = {Bivand, Roger S. and Pebesma, Edzer J. and
>>> G?mez-Rubio, Virgilio},
>>>  title = {Applied Spatial Data Analysis with R},
>>>  series = {Use R},
>>>  publisher = {Springer},
>>>
>>> http://www.asdar-book.org/
>>> http://www.springerlink.com/content/uw07v1/
>>> (Depending on your login/institute you may have fulltext
>>> access, but the
>>> book is definitely worth buying anyway.)
>>>
>>> Regards,
>>> Georg.
>>> --
>>> Research Assistant
>>> Otto-von-Guericke-Universit?t Magdeburg
>>> research at georgruss.de
>>> http://research.georgruss.de
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>>
>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From r.hijmans at gmail.com  Sat Dec 18 20:04:39 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Sat, 18 Dec 2010 11:04:39 -0800
Subject: [R-sig-Geo] Changing pixel values in a stack file based on
 regular patterns
In-Reply-To: <AANLkTimsTg8AKiUm6S27ybw0bMwGo8yuMKD0Fwdp8XGY@mail.gmail.com>
References: <AANLkTimsTg8AKiUm6S27ybw0bMwGo8yuMKD0Fwdp8XGY@mail.gmail.com>
Message-ID: <AANLkTikfLREKctB7eoBgxhCvDhguKOo4Ok1cuozib5AR@mail.gmail.com>

Dear Paulo,

I think your example works for me:

#function (very basic) -- sure can be improved...
f = function(x)
{
   if(any(x%in%1) & any(x%in%3))#if  land uses 1 and 3 are present in
that pixel over time...
   {
       r.0 =  grepl("3",x)#find the postion of LU3
       r.M1 = grepl("1",x[which(r.0)-1])#pixel yr-1 of LU3 with LU1
       r.P1 = grepl("1",x[which(r.0)+1])#pixel yr+1 of LU3 with LU1
       if(any(any(r.0)&any(r.M1&r.P1)))#if there is a LU3 somewhere
and LU1 before and after that
       {
           x[r.0]=1 #replace the LU3 by LU1
       }
   }
   return(x)
}

library(raster)
r <- r2 <- r3 <- r4 <- raster(ncol=5, nrow=5)
set.seed(23)
r[]  <- as.numeric(sample(rep(1:3,1000),25))
r2[] <- as.numeric(sample(rep(1:3,1000),25))
r3[] <- as.numeric(sample(rep(1:3,1000),25))
r4[] <- as.numeric(sample(rep(1:3,1000),25))

rr = stack(r,r2,r3,r4)
ee = calc(rr, fun=f)

rv <- getValues(rr)
ev <- getValues(ee)

# which rows have different values?
dif <- rv != ev
rows <- which(apply(dif, 1, sum) > 0)

> rv[rows,]
     layer1 layer2 layer3 layer4
[1,]      1      3      1      2
[2,]      1      3      1      3
[3,]      3      1      1      3
[4,]      1      3      1      1
> ev[rows,]

[1,] 1 1 1 2
[2,] 1 1 1 1
[3,] 1 1 1 1
[4,] 1 1 1 1

If this does not work for you, perhaps you need to update the raster package.

Here is an alternative formulation of your function that might be useful

f = function(x) {
	# changes 131  to 111, but does not touch 311 or 113
	a <- which(x == 3)
	a <- subset(a, a > 1 & a < length(x))
	b <- which(x[a-1] ==1 & x[a+1] == 1)
	x[a[b]] <- 1
	return(x)
}


Robert





On Sat, Dec 18, 2010 at 9:39 AM, Paulo Brando <paulobrando at gmail.com> wrote:
> Dear All,
>
> I'm trying to improve a land-use classification based on MODIS product from
> 2000-2010 (one map per year). Each pixel was classified into 0 (no class), 1
> (LU1), 2 (LU2), or 3 (LU3). The overall result of this classification is
> quite good, but there are some cases that do not make much sense. For
> example, some pixels have LU1 in year one, LU3 in year 2, and LU1 again in
> year 3, followed by LU1 during the remaining of the time-series.
>
> ? ? ? ?I wrote a ?simple function to deal with this problem, but haven't
> figured out why it is not working with calc.
>
> #function (very basic) -- sure can be improved...
> f = function(x)
> {
> ? ?if(any(x%in%1) & any(x%in%3))#if ?land uses 1 and 3 are present in that
> pixel over time...
> ? ?{
> ? ? ? ?r.0 = ?grepl("3",x)#find the postion of LU3
> ? ? ? ?r.M1 = grepl("1",x[which(r.0)-1])#pixel yr-1 of LU3 with LU1
> ? ? ? ?r.P1 = grepl("1",x[which(r.0)+1])#pixel yr+1 of LU3 with LU1
>
> ? ? ? ?if(any(any(r.0)&any(r.M1&r.P1)))#if there is a LU3 somewhere and LU1
> before and after that -- problematic when there are two 131 patterns...
> ? ? ? ?{
> ? ? ? ? ? ?x[r.0]=1#replace the LU3 by LU1
> ? ? ? ? ? ?return(x)}
> ? ? ? ?else{return(x)}
> ? ?}
> ? ?else{return(x)}
> }
>
> #testing the function:
> x = c(2,2,2,0,1,1,3,1,1,1)
> f(x)
> #[1] 2 2 2 0 1 1 1 1 1 1
>
> #it seems to work (at least when there is only one series of 1-3-1), but
> when I include it in the calc #function, something unexpected happens.
>
> #Example:
> library(raster)
>
> #creating rasters...
> r ?<- raster(ncol=5, nrow=5)
> r2 <- raster(ncol=5, nrow=5)
> r3 <- raster(ncol=5, nrow=5)
> r4 <- raster(ncol=5, nrow=5)
>
> set.seed(23)
> r[] ?<- as.numeric(sample(rep(1:3,1000),25))
> r2[] <- as.numeric(sample(rep(1:3,1000),25))
> r3[] <- as.numeric(sample(rep(1:3,1000),25))
> r4[] <- as.numeric(sample(rep(1:3,1000),25))
>
> rr = stack(r,r2,r3,r4)
>
> #############
> f = function(x)
> {
> ? ?if(any(x%in%1) & any(x%in%3))#if ?land uses 1 and 3 are present in that
> pixel over time...
> ? ?{
> ? ? ? ?r.0 = ?grepl("3",x)#find the postion of LU3
> ? ? ? ?r.M1 = grepl("1",x[which(r.0)-1])#pixel yr-1 of LU3 with LU1
> ? ? ? ?r.P1 = grepl("1",x[which(r.0)+1])#pixel yr+1 of LU3 with LU1
>
> ? ? ? ?if(any(any(r.0)&any(r.M1&r.P1)))#if there is a LU3 somewhere and LU1
> before and after that
> ? ? ? ?{
> ? ? ? ? ? ?x[r.0]=1#replace the LU3 by LU1
> ? ? ? ? ? ?return(x)}
> ? ? ? ?else{return(x)}
> ? ?}
> ? ?else{return(x)}
> }
>
> x = c(2,2,2,0,1,1,3,1,1,1)#example of land use over time for a single pixel
> (each value represents a yr)
>
> f(x)
>
> ############################
> ee = calc(rr, fun=f)
>
> ss = stack(rr,ee)
> plot(ss)
>
> #it removes all LU2?
>
> Thanks, Paulo
>
> ? ? ? ?[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From alobolistas at gmail.com  Sun Dec 19 12:16:53 2010
From: alobolistas at gmail.com (Agustin Lobo)
Date: Sun, 19 Dec 2010 12:16:53 +0100
Subject: [R-sig-Geo] function parameters in overlay()
In-Reply-To: <AANLkTi=pryb_HMt_gBqUUEt4AZUh+PzGDOQ8aj1JUC4u@mail.gmail.com>
References: <AANLkTik4hZP=LdDsmsSOcMm5W7C4L4HdJyqUUPwX4zzb@mail.gmail.com>
	<AANLkTi=pryb_HMt_gBqUUEt4AZUh+PzGDOQ8aj1JUC4u@mail.gmail.com>
Message-ID: <AANLkTikPjqQ-8jbS9rbJp6N7mi6CGB5KXRfeBthPMr9A@mail.gmail.com>

Robert,
if possible, a syntax more similar to apply() would be more familiar
to regular R users, i.e.,
x1 = overlay(r1, r2, fun=fun2,a=-1.1867422 s=1.0287373)

I personally would find more intuitive the following:
x1 = overlay(x=r1, y=r2, fun=fun2(x,y,a=-1.1867422 s=1.0287373))
but I recognize that would be quite not a regular R style.


Agus



2010/12/17 Robert J. Hijmans <r.hijmans at gmail.com>:
> Agus,
>
> # self contained example...
> library(raster)
> r1 <- raster(nrow=10, ncol=10)
> r1[] = 1:ncell(r1)
> r2 <- r1
>
> # base case
> fun1 = function(x,y){ a=-1.1867422; s=1.0287373;
> return((y-(a+s*x))/sqrt(s^2+1))}
> x = overlay(r1, r2, fun=fun1 )
>
> # changing a & s without changing fun2, perhaps clumsy
> fun2 = function(x,y,a,s) {return((y-(a+s*x))/sqrt(s^2+1))}
> x1 = overlay(r1, r2, fun=function(x,y){fun2 (x, y, a=-1.1867422,s=1.0287373)})
> x2 = overlay(r1, r2, fun=function(...){fun2 (..., a=-1.1867422,s=1.0287373)})
>
> # changing a & s without changing fun3, perhaps cleaner
> # I believe this works because a and s are defined in the same
> environment as fun3
> fun3 = function(x,y) { return((y-(a+s*x))/sqrt(s^2+1)) }
> a = -1.1867422
> s = 1.0287373
> x3 = overlay(r1, r2, fun=fun3)
>
> Best, Robert
>
> On Fri, Dec 17, 2010 at 1:04 PM, Agustin Lobo <alobolistas at gmail.com> wrote:
>> Robert,
>>
>> How can I define parameters in the functions within overlay() ?
>> For example:
>>
>>> fun3 = function(x,y)
>> {a=-1.1867422
>> ?s=1.0287373
>> ?return((y-(a+s*x))/sqrt(s^2+1))}
>>> NmaxDev = overlay(bN1999max,bN2009max,fun=fun2,filename="NmaxDev",overwrite=TRUE,format="EHdr",datatype='FLT4S', NAflag=0)
>>
>> want it to be something like:
>>
>>> fun3 = function(x,y,a,b)
>> {return((y-(a+s*x))/sqrt(s^2+1))}
>>> NmaxDev = overlay(bN1999max,bN2009max,fun=fun2(a=-1.1867422,s=1.0287373),filename="NmaxDev",overwrite=TRUE,format="EHdr",datatype='FLT4S', NAflag=0)
>>
>> Is it possible or should I redefine the function every time?
>>
>> Agus
>>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From alobolistas at gmail.com  Sun Dec 19 12:20:06 2010
From: alobolistas at gmail.com (Agustin Lobo)
Date: Sun, 19 Dec 2010 12:20:06 +0100
Subject: [R-sig-Geo] Converting array into raster brick
In-Reply-To: <AANLkTi=hC_CsXPsszhF5z0hxxMSV4sKv5X+3wjnP_sGT@mail.gmail.com>
References: <20101216212615.14013deot59etvc7@mail.unibe.ch>
	<AANLkTi=hC_CsXPsszhF5z0hxxMSV4sKv5X+3wjnP_sGT@mail.gmail.com>
Message-ID: <AANLkTi=5+xjc=cK_xzj7G_gUuX+94fLk5JNDE=YQWNBk@mail.gmail.com>

Robert,

Converting from a regular 3D array to brick is probably going to be
quite a  common operation,
perhaps you could consider a simpler syntax in the future, i,e:

r = as.brick(x)

where x would be a 3D array?

Agus

2010/12/16 Robert J. Hijmans <r.hijmans at gmail.com>:
> Christian,
>
> Could be quicker if you make a matrix out of the array (or, if
> possible, avoid the array in the first place). See below
>
> library(raster)
>
> # create an array
> m <- matrix(1:100, ncol=10, byrow=TRUE)
> a <- array(list(m, m, m, m, m))
>
> # empty RasterBrick
> x <- brick(ncol=10, nrow=10)
>
> # make matrix from array
> v <- sapply(a, function(x) as.vector(t(x)))
>
> x <- setValues(x, v)
> plot(x)
>
>
> Best, Robert
>
> On Thu, Dec 16, 2010 at 12:26 PM, ?<christian.kamenik at giub.unibe.ch> wrote:
>> Dear all,
>>
>> I needed to convert an array into a RasterBrick object. The output did not
>> need to be written to memory, as assessed by canProcessInMemory(). The only
>> way to put the data into the RasterBrick that worked for me was layer by
>> layer:
>>
>> for (l in 1:nlayers(x)) x
>> <-setValues(x,values=as.vector(t(xx[,,l])),layer=l)
>>
>> This was quite complicated and slow. So I am wondering if there is a better
>> way of doing this.
>>
>> Many thanks, Christian
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From elaine.kuo.tw at gmail.com  Sun Dec 19 12:33:15 2010
From: elaine.kuo.tw at gmail.com (elaine kuo)
Date: Sun, 19 Dec 2010 19:33:15 +0800
Subject: [R-sig-Geo] contradicting measures based on Log likelihood and AIC
	in spatial models
Message-ID: <AANLkTi=xvpSZ9CEtOcn8oxiXnCakfDcKT=b5f0dkPzqf@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101219/547bf34e/attachment.pl>

From Roger.Bivand at nhh.no  Sun Dec 19 14:18:10 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sun, 19 Dec 2010 14:18:10 +0100 (CET)
Subject: [R-sig-Geo] contradicting measures based on Log likelihood and
 AIC in spatial models
In-Reply-To: <AANLkTi=xvpSZ9CEtOcn8oxiXnCakfDcKT=b5f0dkPzqf@mail.gmail.com>
References: <AANLkTi=xvpSZ9CEtOcn8oxiXnCakfDcKT=b5f0dkPzqf@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.1012191341050.11886@reclus.nhh.no>

On Sun, 19 Dec 2010, elaine kuo wrote:

> Dear List,
>
>
>
> I am running generalized linear models considering spatial autocorrelation.
>
> (Moran? s I = 0.52)

Was this using lm.morantest() - it should have been?

>
> (sample size 4873, explanatory variable number: 6)
>
>
>
> After trying SAR and CAR in package spdep, the results are as followed.
>

Neither of the fits are credible, as the line search has terminated in 
both cases at its upper limit. These is something seriously wrong with 
your analysis. Which method= argument were you using, presumably in 
spautolm? You did not quote the exact way in which you called the 
functions used - this will be where your problems lie.

Are you using a weights matrix with very small values (and very small row 
sums), and a sparse matrix method? Do you get different outcomes if you 
set the search interval yourself - or accept the default and 
row-standardise the weights (style="W" in nb2listw)? Look at 
summary(sapply(listw$weights, sum)) where listw is your listw object. I'll 
add a warning to spautolm() to test whether the result is equal to a line 
search bound.

In reply to your question, had your analysis not been flawed, you could 
not judge between CAR and SAR in the way you suggest as the models are not 
strictly nested. Please see Ripley (1981) Spatial Statistics, Wiley, p. 
90, for a discussion of the relationship between SAR and CAR 
representations. Briefly, if we term the CAR weights matrix C and the SAR 
weights matrix S, then C = S + S' - S'S, and if LL' is the Cholesky 
decomposition of (I - C), S = I - L'. If you do the full analysis of this 
relationship, you may be able to proceed, but you also need to consider 
the interpretation of any results.

Hope this helps,

Roger

> I would like to learn which model was better fit.
>
> However, the measures based on log likelihood and AIC imply different
> contradictions.
>
> 1. log likehood
>
>  SAR is better than CAR (4919,629 > 3694.246)
>
> 2. AIC
>
>  CAR is better than SAR (-7370.5 > -9821.3)
>
> Please kindly instruct which criterion I should follow, and advice on any
> other measure will be highly appreciated.
>
> Elaine
>
> ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
>
> SAR
> Lambda: 0.999 LR test value: 13618 p-value: < 2.22e-16
> Log likelihood: 4919.629
> ML residual variance (sigma squared): 0.0075669, (sigma: 0.086988)
>
> Number of observations: 4873
>
> Number of parameters estimated: 9
>
> AIC: -9821.3
>
> Nagelkerke pseudo-R-squared: 1
>
>
>
> CAR
>
> Lambda: 0.999 LR test value: 11167 p-value: < 2.22e-16
>
>
>
> Log likelihood: 3694.246
>
> ML residual variance (sigma squared): 0.012682, (sigma: 0.11261)
>
> Number of observations: 4873
>
> Number of parameters estimated: 9
>
> AIC: -7370.5
>
> Nagelkerke pseudo-R-squared: 1
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From m.fairbrother at bristol.ac.uk  Sun Dec 19 15:06:01 2010
From: m.fairbrother at bristol.ac.uk (Malcolm Fairbrother)
Date: Sun, 19 Dec 2010 14:06:01 +0000
Subject: [R-sig-Geo] finding clusters of gridded points,
	distinguished by group
In-Reply-To: <mailman.9.1292756403.30792.r-sig-geo@r-project.org>
References: <mailman.9.1292756403.30792.r-sig-geo@r-project.org>
Message-ID: <02017FD6-9C73-4690-92D1-664E2C5D6605@bristol.ac.uk>

Dear all,

I have SpatialPointsDataFrame type data, with a few hundred observations scattered around the globe, and am trying to identify points that are both (a) neighbours, and (b) of the same group. In other words, within a group, there may be geographically non-contiguous clusters, and geographically contiguous clusters may contain one or more groups.

Here is a simple example to illustrate what I mean:

require(sp)
set.seed(1)
g <- SpatialPointsDataFrame(coords=expand.grid(x = 1:10, y = 1:10), data=data.frame(group=rep(LETTERS[10:1], each=10)))
g <- g[sample(1:100, size=30),]
plot(g, axes=T, pch=as.character(g$group))

I want to identify clusters of the *same* letter, where clusters are defined by *contiguity*.

I realise the following will get me a neighbours list:

dnearneigh(g, d1=0, d2=sqrt(2))

However, it's not clear to me how I might move from knowing about the properties of an individual point, to knowing about the identities of clusters containing variable numbers of points. And I have the added compication of wanting to parse out only neighbours that belong to the same group. Any assistance would be very much appreciated.

Thanks,
Malcolm


From r.hijmans at gmail.com  Sun Dec 19 17:06:21 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Sun, 19 Dec 2010 08:06:21 -0800
Subject: [R-sig-Geo] Converting array into raster brick
In-Reply-To: <AANLkTi=5+xjc=cK_xzj7G_gUuX+94fLk5JNDE=YQWNBk@mail.gmail.com>
References: <20101216212615.14013deot59etvc7@mail.unibe.ch>
	<AANLkTi=hC_CsXPsszhF5z0hxxMSV4sKv5X+3wjnP_sGT@mail.gmail.com>
	<AANLkTi=5+xjc=cK_xzj7G_gUuX+94fLk5JNDE=YQWNBk@mail.gmail.com>
Message-ID: <AANLkTikFt3eJHSpjB9ssMODU5P1kK5x5DVxugoVA=inf@mail.gmail.com>

Agus,

I have added an new method for 'brick', included below

library(raster)
# new method, included in raster 1.7-17
setMethod('brick', signature(x='array'),
	function(x, xmn=0, xmx=1, ymn=0, ymx=1, crs=NA) {
		dm <- dim(x)
		if (length(dm) != 3) {
			stop('array has wrong dimensions')
		}
		b <- brick(xmn=xmn, xmx=xmx, ymn=ymn, ymx=ymx, crs=crs)
		dim(b) <- dm
		setValues(b, matrix(sapply(x, as.vector), ncol=dm[3]))
	}
)

r = raster(nrow=5, ncol=5)
r[] = 1:25
s = stack(r,r*2,r*3)

a = as.array(s)
b = brick(a)
# values of b are the same as those of a
sum(getValues(s) != getValues(b))

Best, Robert
On Sun, Dec 19, 2010 at 3:20 AM, Agustin Lobo <alobolistas at gmail.com> wrote:
> Robert,
>
> Converting from a regular 3D array to brick is probably going to be
> quite a ?common operation,
> perhaps you could consider a simpler syntax in the future, i,e:
>
> r = as.brick(x)
>
> where x would be a 3D array?
>
> Agus
>
> 2010/12/16 Robert J. Hijmans <r.hijmans at gmail.com>:
>> Christian,
>>
>> Could be quicker if you make a matrix out of the array (or, if
>> possible, avoid the array in the first place). See below
>>
>> library(raster)
>>
>> # create an array
>> m <- matrix(1:100, ncol=10, byrow=TRUE)
>> a <- array(list(m, m, m, m, m))
>>
>> # empty RasterBrick
>> x <- brick(ncol=10, nrow=10)
>>
>> # make matrix from array
>> v <- sapply(a, function(x) as.vector(t(x)))
>>
>> x <- setValues(x, v)
>> plot(x)
>>
>>
>> Best, Robert
>>
>> On Thu, Dec 16, 2010 at 12:26 PM, ?<christian.kamenik at giub.unibe.ch> wrote:
>>> Dear all,
>>>
>>> I needed to convert an array into a RasterBrick object. The output did not
>>> need to be written to memory, as assessed by canProcessInMemory(). The only
>>> way to put the data into the RasterBrick that worked for me was layer by
>>> layer:
>>>
>>> for (l in 1:nlayers(x)) x
>>> <-setValues(x,values=as.vector(t(xx[,,l])),layer=l)
>>>
>>> This was quite complicated and slow. So I am wondering if there is a better
>>> way of doing this.
>>>
>>> Many thanks, Christian
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>


From r.hijmans at gmail.com  Sun Dec 19 17:50:50 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Sun, 19 Dec 2010 08:50:50 -0800
Subject: [R-sig-Geo] Converting array into raster brick
In-Reply-To: <AANLkTikFt3eJHSpjB9ssMODU5P1kK5x5DVxugoVA=inf@mail.gmail.com>
References: <20101216212615.14013deot59etvc7@mail.unibe.ch>
	<AANLkTi=hC_CsXPsszhF5z0hxxMSV4sKv5X+3wjnP_sGT@mail.gmail.com>
	<AANLkTi=5+xjc=cK_xzj7G_gUuX+94fLk5JNDE=YQWNBk@mail.gmail.com>
	<AANLkTikFt3eJHSpjB9ssMODU5P1kK5x5DVxugoVA=inf@mail.gmail.com>
Message-ID: <AANLkTikwhkDRTKM0PnjV-xt395OhD_gYx65a=hAXWHXe@mail.gmail.com>

updated function, without redundant  sapply. R

library(raster)
# new method, included in raster 1.7-17
setMethod('brick', signature(x='array'),
       function(x, xmn=0, xmx=1, ymn=0, ymx=1, crs=NA) {
               dm <- dim(x)
               if (length(dm) != 3) {
                       stop('array has wrong dimensions')
               }
               b <- brick(xmn=xmn, xmx=xmx, ymn=ymn, ymx=ymx, crs=crs)
               dim(b) <- dm
               setValues(b, matrix(as.vector(x), ncol=dm[3]))
       }
)

On Sun, Dec 19, 2010 at 8:06 AM, Robert J. Hijmans <r.hijmans at gmail.com> wrote:
> Agus,
>
> I have added an new method for 'brick', included below
>
> library(raster)
> # new method, included in raster 1.7-17
> setMethod('brick', signature(x='array'),
> ? ? ? ?function(x, xmn=0, xmx=1, ymn=0, ymx=1, crs=NA) {
> ? ? ? ? ? ? ? ?dm <- dim(x)
> ? ? ? ? ? ? ? ?if (length(dm) != 3) {
> ? ? ? ? ? ? ? ? ? ? ? ?stop('array has wrong dimensions')
> ? ? ? ? ? ? ? ?}
> ? ? ? ? ? ? ? ?b <- brick(xmn=xmn, xmx=xmx, ymn=ymn, ymx=ymx, crs=crs)
> ? ? ? ? ? ? ? ?dim(b) <- dm
> ? ? ? ? ? ? ? ?setValues(b, matrix(sapply(x, as.vector), ncol=dm[3]))
> ? ? ? ?}
> )
>
> r = raster(nrow=5, ncol=5)
> r[] = 1:25
> s = stack(r,r*2,r*3)
>
> a = as.array(s)
> b = brick(a)
> # values of b are the same as those of a
> sum(getValues(s) != getValues(b))
>
> Best, Robert
> On Sun, Dec 19, 2010 at 3:20 AM, Agustin Lobo <alobolistas at gmail.com> wrote:
>> Robert,
>>
>> Converting from a regular 3D array to brick is probably going to be
>> quite a ?common operation,
>> perhaps you could consider a simpler syntax in the future, i,e:
>>
>> r = as.brick(x)
>>
>> where x would be a 3D array?
>>
>> Agus
>>
>> 2010/12/16 Robert J. Hijmans <r.hijmans at gmail.com>:
>>> Christian,
>>>
>>> Could be quicker if you make a matrix out of the array (or, if
>>> possible, avoid the array in the first place). See below
>>>
>>> library(raster)
>>>
>>> # create an array
>>> m <- matrix(1:100, ncol=10, byrow=TRUE)
>>> a <- array(list(m, m, m, m, m))
>>>
>>> # empty RasterBrick
>>> x <- brick(ncol=10, nrow=10)
>>>
>>> # make matrix from array
>>> v <- sapply(a, function(x) as.vector(t(x)))
>>>
>>> x <- setValues(x, v)
>>> plot(x)
>>>
>>>
>>> Best, Robert
>>>
>>> On Thu, Dec 16, 2010 at 12:26 PM, ?<christian.kamenik at giub.unibe.ch> wrote:
>>>> Dear all,
>>>>
>>>> I needed to convert an array into a RasterBrick object. The output did not
>>>> need to be written to memory, as assessed by canProcessInMemory(). The only
>>>> way to put the data into the RasterBrick that worked for me was layer by
>>>> layer:
>>>>
>>>> for (l in 1:nlayers(x)) x
>>>> <-setValues(x,values=as.vector(t(xx[,,l])),layer=l)
>>>>
>>>> This was quite complicated and slow. So I am wondering if there is a better
>>>> way of doing this.
>>>>
>>>> Many thanks, Christian
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at r-project.org
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>


From stefan.duke at gmail.com  Sun Dec 19 18:54:38 2010
From: stefan.duke at gmail.com (stefan.duke at gmail.com)
Date: Sun, 19 Dec 2010 18:54:38 +0100
Subject: [R-sig-Geo] Generalized Hierarchical Multivariate CAR Models for
	Areal Data
Message-ID: <AANLkTi=5nrSV-xVrp9ys7YnfFyQF8XbuzGcX0mK-DKvs@mail.gmail.com>

Hello,

I have mortality data and I would like to analyze them using a
"Generalized Hierarchical Multivariate CAR Models for Areal Data" as
described by Jin, X., Carlin, B.P., and Banerjee, S. (2005). They
published also code in OpenBugs (which I think is very helpful of them
and should be standard).

But I  have no experience with OpenBugs and wonder if this (or a
similar) model can be estimated in R? I think the spBayes package does
something along those line but  not only for Point Referenced data and
not areal data (as I have it).

Thanks for any hint!
Best,
Stefan


From research at georgruss.de  Sun Dec 19 19:46:01 2010
From: research at georgruss.de (Georg =?iso-8859-15?B?UnXf?=)
Date: Sun, 19 Dec 2010 19:46:01 +0100
Subject: [R-sig-Geo] finding clusters of gridded points,
 distinguished by group
In-Reply-To: <02017FD6-9C73-4690-92D1-664E2C5D6605@bristol.ac.uk>
References: <mailman.9.1292756403.30792.r-sig-geo@r-project.org>
	<02017FD6-9C73-4690-92D1-664E2C5D6605@bristol.ac.uk>
Message-ID: <20101219184600.GE16970@greode>

On 19/12/10 14:06:01, Malcolm Fairbrother wrote:
> I have SpatialPointsDataFrame type data, with a few hundred observations
> scattered around the globe, and am trying to identify points that are
> both (a) neighbours, and (b) of the same group. In other words, within a
> group, there may be geographically non-contiguous clusters, and
> geographically contiguous clusters may contain one or more groups.

Hi Malcolm,

that sounds like an interesting task for something like spatial
clustering. I've been working on something similar in precision
agriculture and it seems that there was no existing algorithm which was
able to solve my problem. See [1], [2] for my publications on that
(fulltext under pdf icon), maybe the references and/or the figures given
in those articles are useful.

What I essentially did was something like multivariate region-growing or
merging clustering. You start with a few of the spatial data points, e.g.
those having different classes. Then you look into those points' spatial
neighbors and see whether there are points having the same class. If yes,
update that point/cluster and (!) update the neighbor list. Merging two or
more points with the same class gives you a larger cluster and a possibly
bigger neighbor list. Then you repeat the search. Once there's no more
spatially adjacent clusters/points of the same class, you're done.

You may have some points left, but I'm not sure about the special data or
points you're dealing with and I'm not quite clear what your expected
outcome is. But you're not dealing with multivariate data, as I understand
it, so some things could be easier to handle than in my approach.

[1]
http://fuzzy.cs.uni-magdeburg.de/aigaion/index.php/publications/show/772
[2]
http://fuzzy.cs.uni-magdeburg.de/aigaion/index.php/publications/show/773

> I realise the following will get me a neighbours list:
> dnearneigh(g, d1=0, d2=sqrt(2))

This requires > library("spdep"), btw. :-)

Regards,
Georg.
--
Research Assistant
Otto-von-Guericke-Universit?t Magdeburg
research at georgruss.de
http://research.georgruss.de


From zenlines at gmail.com  Sun Dec 19 20:16:45 2010
From: zenlines at gmail.com (Brian Oney)
Date: Sun, 19 Dec 2010 20:16:45 +0100
Subject: [R-sig-Geo] Outline of Study area
In-Reply-To: <4D0CC023.6050602@gmail.com>
References: <4D0CC023.6050602@gmail.com>
Message-ID: <4D0E5A1D.6010007@gmail.com>

Hello,
I guess questions without merit do not merit answers. So I missed one 
thing in the GRASS library. I didn't need to use r.thin before using 
r.to.vect.
This is how it works (so it hopefully doesn't have to be asked again):
# some raster
range[!is.na(range)] <- 1
writeRaster(range,paste(path,"range_template.asc", sep=""),overwrite=T)

initGRASS("C:/Program_Files_x86/GRASS-65-SVN", home=tempdir(), 
gisDbase=gisDbase, SG=sgdf,location=ssp, mapset="maps", override=T)

execGRASS("r.in.gdal", flags=c("e","o","overwrite"), parameters=list(
         input=paste(path,"range_template.asc", sep=""),
         output="mat"
         ))

execGRASS("r.to.vect", flags=c("s"), parameters=list(input="mat", 
output="rangepoly", feature="area"))
execGRASS("v.out.ogr", flags=c("e"), parameters=list(input="rangepoly", 
type="area",
     dsn=shpbase, olayer=paste("ssprange",sep=""), format="ESRI_Shapefile"))

Hope this is helpful in the future. It would be nice to have it is R but 
I guess we have this great interface to GRASS too. Thanks Roger!
Brian



On 12/18/2010 3:07 PM, Brian Oney wrote:
> Hi List,
> I am mosaicking several maps of different areas and I would like to 
> make an outline of the different study areas for plotting etc.. I have 
> played around extensively in GRASS and R and still don't have what I 
> need. I would like to do it in R because, at the moment, I am a 
> windows slave, and windows slaves are especially disadvantaged in GRASS.
>
> # In R I have tried:
> rast[!is.na(rast)] <- 1
> rasterToPolygons(rast, function(x) !is.na(x)) # This just overwhelmed 
> my computer and gave me lots of little polygons
>
>
> #Trying the same after using aggregate also did not help speed.
> #So say that I am satisfied with the product from raster to polygons.
> #Then I use:
> unionSpatialPolygons(polyrange, IDs=somethingsane) # And it takes an 
> additional several hours time as well as excludes my islands.
>
> Does anyone have suggestion to create an outline in a reasonable 
> amount of time?
> I would greatly appreciate it!
>
> Regards,
> Brian
>
>
>
>
>
>


From HodgessE at uhd.edu  Mon Dec 20 04:50:10 2010
From: HodgessE at uhd.edu (Hodgess, Erin)
Date: Sun, 19 Dec 2010 21:50:10 -0600
Subject: [R-sig-Geo] a complete newbie question
Message-ID: <586A4828D7AAA04CA9B258C50A28DA206DB243@BALI.uhd.campus>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101219/32939982/attachment.pl>

From roman.lustrik at gmail.com  Mon Dec 20 08:43:54 2010
From: roman.lustrik at gmail.com (=?UTF-8?Q?Roman_Lu=C5=A1trik?=)
Date: Mon, 20 Dec 2010 08:43:54 +0100
Subject: [R-sig-Geo] a complete newbie question
In-Reply-To: <586A4828D7AAA04CA9B258C50A28DA206DB243@BALI.uhd.campus>
References: <586A4828D7AAA04CA9B258C50A28DA206DB243@BALI.uhd.campus>
Message-ID: <AANLkTimA75fO+Wosh_ckWVmnmdy5YnzxUm3BwCbfYkpG@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101220/df7842fa/attachment.pl>

From dorina.lazar at econ.ubbcluj.ro  Mon Dec 20 10:29:48 2010
From: dorina.lazar at econ.ubbcluj.ro (dorina.lazar)
Date: Mon, 20 Dec 2010 11:29:48 +0200
Subject: [R-sig-Geo] spatial clusters
Message-ID: <eef95d9fa8d1c8a6350635788deab411@econ.ubbcluj.ro>


Dear all,

Finally, with your help, I make some progress to apply SKATER algorithm to
European countries. 

Here is the R code, following the example from  spdep package pdf: 

> country<-wrld_simpl[wrld_simpl$ISO3%in%c("AZE", "ALB", "ARM", "BIH",
"BGR", "CYP", "DNK", "IRL", "EST", "AUT", "CZE", "FIN",  "FRA", "GEO",
"DEU", "GRC", "HRV", "HUN", "ISL", "ITA", "LVA", "BLR", "LTU", "SVK",
"LIE", "MLT", "BEL", "AND",  "LUX", "MCO", "NLD", "NOR", "POL", "PRT",
"ROU", "MDA", "RUS", "SVN"),]
> ske<-spCbind(country, rclasif)
> ske at data
> de <- data.frame(scale(ske at data[13]))   #col 13 contains the health
indicator (from rclasif)
> nbe <- poly2nb(country)
> ce <- nbcosts(nbe, de)
> le <- nb2listw(nbe, ce, style="B", zero.policy=TRUE)
Error in nb2listw(nbe, ce, style = "B", zero.policy = TRUE) : 
neighbours and glist do not conform

I mention that: 
-	at "nbe", appears the message:  6 regions with no links: CYP DNK HRV ISL
MLT SWE
-	"ce" contain a lot of NA 
If you have some ideas about the cause of this Error, please help me to
finalize my exercise on SKATER algoritm.

Thanks a lot for your help,
Dorina 




On Sat, 18 Dec 2010 18:42:35 +0100 (CET), Roger Bivand
<Roger.Bivand at nhh.no> wrote:
> On Sat, 18 Dec 2010, Roman Lu?trik wrote:
> 
>> Perhaps you could follow the instructions from this
>>
exchange<http://r-sig-geo.2731867.n2.nabble.com/Guam-island-map-td4969467.html#a4972725>and
>> see if you can extract the desired country (assuming the resolution
>> suits you).
>>
> 
> I don't think that we know which countries Dorina needs, or at which 
> administrative level. If there are only 30 country observations, and the

> countries are not contiguous, then the whole exercise seems unnecessary.

> Can Dorina use the simplified world map in the maptools package:
> 
> library(maptools)
> ?wrld_simpl
> 
> adding the data using the ISO country names? If these are countries at 
> some administrative division level, then maybe www.gadm.org will have
what 
> is needed, but the countries will have to be joined together, or the
whole 
> map subsetted. If these are say EU NUTS2 regions, then use can be made
of 
> GISCO shapefiles from Eurostat. But we don't know what boundaries are 
> needed, and of course to use Skater for clustering, you need the 
> boundaries.
> 
> Roger
> 
>>
>> Cheers,
>> Roman
>>
>>
>>
>> On Sat, Dec 18, 2010 at 6:20 PM, Dorina Lazar <drnlazar at yahoo.com>
wrote:
>>
>>> Georg,
>>>
>>> Thanks for being very patient with me.
>>>
>>> I have not a shapefile for countries.
>>>
>>> I have tried to obtain it. I have loaded a shapefile for Finland, GIS
>>> data,
>>> from
>>>
http://www.eea.europa.eu/data-and-maps/data/eea-reference-grids/zipped-shape-file-finland
>>>
>>> and I tried to read the file FI_1K.shp
>>> Fin<- readShapePoly(system.file("etc/shapes/ FI_1K.shp",
>>> package="spdep"))
>>> but...
>>> Error in getinfo.shape(filen) : Error opening SHP file
>>>
>>> How can I obtain, for each country,  the shapefile spatial polygon in
R
>>> (SpatialPolygons-DataFrame)?
>>>
>>> Thanks again,
>>> Dorina
>>>
>>>
>>> --- On Thu, 12/16/10, Georg Ru? <research at georgruss.de> wrote:
>>>
>>>> From: Georg Ru? <research at georgruss.de>
>>>> Subject: Re: [R-sig-Geo] spatial clusters
>>>> To: "Dorina Lazar" <dorina.lazar at econ.ubbcluj.ro>
>>>> Cc: "R-sig-geo mailing list" <r-sig-geo at r-project.org>
>>>> Date: Thursday, December 16, 2010, 10:41 AM
>>>> On 16/12/10 09:06:33, dorina.lazar
>>>> wrote:
>>>>> How to create a shapefile including my data about some
>>>> socio-demographic
>>>>> indicators (7),  for about 30 countries around
>>>> the world (to be read with
>>>>> readShapePoly)?
>>>>
>>>> Hi Dorina,
>>>>
>>>> I'm not quite sure what you have and what you want.
>>>>
>>>> I assume that you'd like to create a shapefile such that
>>>> for every country
>>>> (which is represented as a polygon) there's a vector of
>>>> seven attributes
>>>> attached to it:
>>>>
>>>> country1:  attr1 attr2 attr3 attr4 attr5 attr6 attr7
>>>> country2:  attr1 attr2 attr3 attr4 attr5 attr6 attr7
>>>> ...
>>>>
>>>> Do you have your countries as spatial polygons in R
>>>> (SpatialPolygons-
>>>> DataFrame or similar)? If yes, you should be able to add
>>>> your socio-demo-
>>>> graphic indicators to this data frame (just as in normal
>>>> data frames). In
>>>> this way you'd join the data you have inside R.
>>>>
>>>> If you have the shapefile for the countries available and
>>>> would like to
>>>> edit this directly to add the indicators, I'd suggest using
>>>> a GIS like
>>>> GRASS http://grass.fbk.eu/ Afterwards, this can be easily
>>>> read into R.
>>>>
>>>>> Would be useful to suggest some good introductory
>>>> lectures in spatial
>>>>> statistics (links or books).
>>>>
>>>> I think the following is what Roger would suggest:
>>>>
>>>>  author = {Bivand, Roger S. and Pebesma, Edzer J. and
>>>> G?mez-Rubio, Virgilio},
>>>>  title = {Applied Spatial Data Analysis with R},
>>>>  series = {Use R},
>>>>  publisher = {Springer},
>>>>
>>>> http://www.asdar-book.org/
>>>> http://www.springerlink.com/content/uw07v1/
>>>> (Depending on your login/institute you may have fulltext
>>>> access, but the
>>>> book is definitely worth buying anyway.)
>>>>
>>>> Regards,
>>>> Georg.
>>>> --
>>>> Research Assistant
>>>> Otto-von-Guericke-Universit?t Magdeburg
>>>> research at georgruss.de
>>>> http://research.georgruss.de
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at r-project.org
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>
>>>
>>>
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>>
>>
>>


From dorina.lazar at econ.ubbcluj.ro  Mon Dec 20 11:43:36 2010
From: dorina.lazar at econ.ubbcluj.ro (dorina.lazar)
Date: Mon, 20 Dec 2010 12:43:36 +0200
Subject: [R-sig-Geo] Spatial clusters
Message-ID: <9e8345da9e351846351303ef14d0c183@econ.ubbcluj.ro>


A short correction to the previous email. The complete list of the
European countries is below, but the same error is done:
country<-wrld_simpl[wrld_simpl$ISO3%in%c("AZE",  "ALB" , "ARM",  "BIH", 
"BGR",  "CYP",  "DNK",  "IRL",  "EST",  "AUT",  "CZE",  "FIN",  "FRA", 
"GEO",  "DEU",  "GRC",  "HRV",  "HUN",  "ISL",  "ITA",  "LVA", "BLR", 
"LTU",  "SVK",  "LIE",  "MLT",  "BEL",  "AND",  "LUX",  "MCO",  "NLD", 
"NOR",  "POL",  "PRT", "ROU",  "MDA",  "RUS",  "SVN",  "ESP",  "SWE", 
"CHE",  "TUR",  "GBR",  "UKR",  "SMR",  "SRB"),]

Thanks,
Dorina


From elaine.kuo.tw at gmail.com  Mon Dec 20 14:14:34 2010
From: elaine.kuo.tw at gmail.com (elaine kuo)
Date: Mon, 20 Dec 2010 21:14:34 +0800
Subject: [R-sig-Geo] contradicting measures based on Log likelihood and
 AIC in spatial models
In-Reply-To: <alpine.LRH.2.00.1012191341050.11886@reclus.nhh.no>
References: <AANLkTi=xvpSZ9CEtOcn8oxiXnCakfDcKT=b5f0dkPzqf@mail.gmail.com>
	<alpine.LRH.2.00.1012191341050.11886@reclus.nhh.no>
Message-ID: <AANLkTimWsZ_dOpiZTaiEjOOrihAyoaPT=niwdJo43TVT@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101220/b910815b/attachment.pl>

From dmsilv at gmail.com  Mon Dec 20 15:12:23 2010
From: dmsilv at gmail.com (Daniel)
Date: Mon, 20 Dec 2010 12:12:23 -0200
Subject: [R-sig-Geo] RGDAL
Message-ID: <AANLkTimaFnMeM3aCZFyomam78Kpjzbj89c4tEqKg=Bn3@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101220/2ac00b5c/attachment.pl>

From Maxime.Pauwels at univ-lille1.fr  Mon Dec 20 18:02:39 2010
From: Maxime.Pauwels at univ-lille1.fr (Maxime Pauwels)
Date: Mon, 20 Dec 2010 18:02:39 +0100
Subject: [R-sig-Geo] export to .asc or .grd files
Message-ID: <4D0F8C2F.5050704@univ-lille1.fr>

Hi list,

I'm using the sp package to grid data. I'd now like to export the grid 
in either .asc or .grd files. Does anyone can give me the package and 
function that does it easily?

Thanks,

max

-- 
Maxime Pauwels
Researcher ID: http://www.researcherid.com/rid/A-1745-2009

Equipe G?n?tique&  ?volution de l'adaptation aux environnements pollu?s par les m?taux lourds
Laboratoire de G?n?tique et Evolution des Populations V?g?tales
FRE CNRS 3268
B?timent SN2
Universit? de Lille, USTL-Lille1
http://gepv.univ-lille1.fr
Tel  : +33 3 20 33 62 38
Fax  : +33 3 20 43 69 79


From pierre.roudier at gmail.com  Mon Dec 20 18:43:32 2010
From: pierre.roudier at gmail.com (Pierre Roudier)
Date: Mon, 20 Dec 2010 18:43:32 +0100
Subject: [R-sig-Geo] RGDAL
In-Reply-To: <AANLkTimaFnMeM3aCZFyomam78Kpjzbj89c4tEqKg=Bn3@mail.gmail.com>
References: <AANLkTimaFnMeM3aCZFyomam78Kpjzbj89c4tEqKg=Bn3@mail.gmail.com>
Message-ID: <AANLkTi=jBet4WdA_77bhK-R5dFWgxXvxxzHjtSD0MJnS@mail.gmail.com>

Hi Daniel,

Could you please send us your sessionInfo(), plus details on your
platform (I suspect you're on a Mac but I'm not too sure).

As the error message said, the package cannot find the gdal-config
file. How did you install GDAL?

Pierre

2010/12/20 Daniel <dmsilv at gmail.com>:
> Dears,
> Anybody knows how can I solve the following error.
>
> * installing *source* package ?rgdal? ...
> gdal-config: gdal-config
> ./configure: line 1311: gdal-config: command not found
> Error: gdal-config not found
> The gdal-config script distributed with GDAL could not be found.
> If you have not installed the GDAL libraries, you can
> download the source from ?http://www.gdal.org/
> If you have installed the GDAL libraries, then make sure that
> gdal-config is in your path. Try typing gdal-config at a
> shell prompt and see if it runs. If not, use:
> ?--configure-args='--with-gdal-config=/usr/local/bin/gdal-config' echo with
> appropriate values for your installation.
>
> ERROR: configuration failed for package ?rgdal?
> * removing ?/Users/dms/Library/R/2.12/library/rgdal?
> * restoring previous ?/Users/dms/Library/R/2.12/library/rgdal?
>
> The downloaded packages are in
> ?/private/var/folders/GU/GU-nsrKmGteghFv3YFf1C++++TI/-Tmp-/RtmpqkhOBF/downloaded_packages?
>
>
> I tried the following, but not worked:
>
> daniel-marcelinos-macbook-pro:~ dms$
> --configure-args='--with-gdal-config=/usr/local/bin/gdal-config'
> -bash: -s: command not found
>
>
>
> --
> Daniel Marcelino
> Skype: dmsilv
> http://marcelino.pbworks.com/
>
> ? ? ? ?[[alternative HTML version deleted]]
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>



-- 
Scientist
Landcare Research, New Zealand


From Lee.Hachadoorian+L at gmail.com  Mon Dec 20 22:00:59 2010
From: Lee.Hachadoorian+L at gmail.com (Lee Hachadoorian)
Date: Mon, 20 Dec 2010 16:00:59 -0500
Subject: [R-sig-Geo] Differing pch symbols for categorical data in spplot
Message-ID: <pan.2010.12.20.21.00.57.293000@gmail.com>

I managed to get something working here, but can't take it any further. I
would like to map points on top of polygons using spplot, and control the
pch symbols and colors used by the points, which represent categorical
data.

I was able to get this partially working. An example using data included
with the sp package is:

#LOAD LIBRARY
library(sp)

#CREATE SpatialPolygonsDataFrame OF RIVERBED
data(meuse.riv)
meuse.lst = list(Polygons(list(Polygon(meuse.riv)), "meusee.riv"))
spdfMeuse = SpatialPolygonsDataFrame(
	SpatialPolygons(meuse.lst),
	data.frame(anything = 1, row.names = "meusee.riv")
)

#CREATE SpatialPoints OF SOIL SAMPLES
data(meuse)
coordinates(meuse) = c("x", "y")

#PLOT
spplot(spdfMeuse,
	sp.layout = list(
		"sp.points", 
		meuse, 
		pch = as.integer(meuse$soil)
	)
)

Since I'm casting soil (a 3-level factor) to integer, I can pass it as an
argument to pch. But this gives me very limited control over the symbols
used. I can add an integer to get, for example, pch 15, 16, & 17, but what
if I want to use pch 5, 13, & 17? Also, I can set the color with col =
"whatever", but I haven't been able to figure out how to print three
different colors that are linked to the three factors.

Any suggestions on how to accomplish this or otherwise improve this call
to spplot would be greatly appreciated.

Regards,
Lee Hachadoorian
PhD Student, Geography
Program in Earth & Environmental Sciences
CUNY Graduate Center


From sarah.goslee at gmail.com  Mon Dec 20 22:12:27 2010
From: sarah.goslee at gmail.com (Sarah Goslee)
Date: Mon, 20 Dec 2010 16:12:27 -0500
Subject: [R-sig-Geo] Differing pch symbols for categorical data in spplot
In-Reply-To: <pan.2010.12.20.21.00.57.293000@gmail.com>
References: <pan.2010.12.20.21.00.57.293000@gmail.com>
Message-ID: <AANLkTi=xK9wD1tGB2pvAvgq28Z2wZzyjYB51J3ZTCq_y@mail.gmail.com>

Hi Lee,

Here's a neat way to do that (with fake data, since it doesn't actually have
anything to do with polygons):

pointclass <- c(1, 2, 1, 1, 3, 2)

classcol <- c("red", "blue", "green")
classpch <- c(5, 17, 3)

plot(1:6, 1:6, col=classcol[pointclass], pch=classpch[pointclass])

Sarah

On Mon, Dec 20, 2010 at 4:00 PM, Lee Hachadoorian
<Lee.Hachadoorian+L at gmail.com> wrote:
> I managed to get something working here, but can't take it any further. I
> would like to map points on top of polygons using spplot, and control the
> pch symbols and colors used by the points, which represent categorical
> data.
>
> I was able to get this partially working. An example using data included
> with the sp package is:
>
> #LOAD LIBRARY
> library(sp)
>
> #CREATE SpatialPolygonsDataFrame OF RIVERBED
> data(meuse.riv)
> meuse.lst = list(Polygons(list(Polygon(meuse.riv)), "meusee.riv"))
> spdfMeuse = SpatialPolygonsDataFrame(
> ? ? ? ?SpatialPolygons(meuse.lst),
> ? ? ? ?data.frame(anything = 1, row.names = "meusee.riv")
> )
>
> #CREATE SpatialPoints OF SOIL SAMPLES
> data(meuse)
> coordinates(meuse) = c("x", "y")
>
> #PLOT
> spplot(spdfMeuse,
> ? ? ? ?sp.layout = list(
> ? ? ? ? ? ? ? ?"sp.points",
> ? ? ? ? ? ? ? ?meuse,
> ? ? ? ? ? ? ? ?pch = as.integer(meuse$soil)
> ? ? ? ?)
> )
>
> Since I'm casting soil (a 3-level factor) to integer, I can pass it as an
> argument to pch. But this gives me very limited control over the symbols
> used. I can add an integer to get, for example, pch 15, 16, & 17, but what
> if I want to use pch 5, 13, & 17? Also, I can set the color with col =
> "whatever", but I haven't been able to figure out how to print three
> different colors that are linked to the three factors.
>
> Any suggestions on how to accomplish this or otherwise improve this call
> to spplot would be greatly appreciated.
>
> Regards,
> Lee Hachadoorian
> PhD Student, Geography
> Program in Earth & Environmental Sciences
> CUNY Graduate Center



-- 
Sarah Goslee
http://www.functionaldiversity.org


From dylan.beaudette at gmail.com  Mon Dec 20 22:09:43 2010
From: dylan.beaudette at gmail.com (Dylan Beaudette)
Date: Mon, 20 Dec 2010 13:09:43 -0800
Subject: [R-sig-Geo] Differing pch symbols for categorical data in spplot
In-Reply-To: <pan.2010.12.20.21.00.57.293000@gmail.com>
References: <pan.2010.12.20.21.00.57.293000@gmail.com>
Message-ID: <AANLkTiktzjTfFiZRSL=gt02dr_3ZUWWV3eOVsKpCNGx0@mail.gmail.com>

On Mon, Dec 20, 2010 at 1:00 PM, Lee Hachadoorian
<Lee.Hachadoorian+L at gmail.com> wrote:
> I managed to get something working here, but can't take it any further. I
> would like to map points on top of polygons using spplot, and control the
> pch symbols and colors used by the points, which represent categorical
> data.
>
> I was able to get this partially working. An example using data included
> with the sp package is:
>
> #LOAD LIBRARY
> library(sp)
>
> #CREATE SpatialPolygonsDataFrame OF RIVERBED
> data(meuse.riv)
> meuse.lst = list(Polygons(list(Polygon(meuse.riv)), "meusee.riv"))
> spdfMeuse = SpatialPolygonsDataFrame(
> ? ? ? ?SpatialPolygons(meuse.lst),
> ? ? ? ?data.frame(anything = 1, row.names = "meusee.riv")
> )
>
> #CREATE SpatialPoints OF SOIL SAMPLES
> data(meuse)
> coordinates(meuse) = c("x", "y")
>
> #PLOT
> spplot(spdfMeuse,
> ? ? ? ?sp.layout = list(
> ? ? ? ? ? ? ? ?"sp.points",
> ? ? ? ? ? ? ? ?meuse,
> ? ? ? ? ? ? ? ?pch = as.integer(meuse$soil)
> ? ? ? ?)
> )
>
> Since I'm casting soil (a 3-level factor) to integer, I can pass it as an
> argument to pch. But this gives me very limited control over the symbols
> used. I can add an integer to get, for example, pch 15, 16, & 17, but what
> if I want to use pch 5, 13, & 17? Also, I can set the color with col =
> "whatever", but I haven't been able to figure out how to print three
> different colors that are linked to the three factors.
>
> Any suggestions on how to accomplish this or otherwise improve this call
> to spplot would be greatly appreciated.
>

Hi Lee,

One of the tricks required to get lattice graphics to do what you want
is to master either the par.settings argument to lattice plotting
functions (e.g. spplot) or the trellis.par.set function.

Be sure to call trellis.par.set() each time you start a new device.

Here is a link to a document on this very topic (note shameless self-promotion):
http://casoilresource.lawr.ucdavis.edu/drupal/node/962

Cheers,
Dylan


From Lee.Hachadoorian+L at gmail.com  Mon Dec 20 23:28:49 2010
From: Lee.Hachadoorian+L at gmail.com (Lee Hachadoorian)
Date: Mon, 20 Dec 2010 17:28:49 -0500
Subject: [R-sig-Geo] Differing pch symbols for categorical data in spplot
References: <pan.2010.12.20.21.00.57.293000@gmail.com>
	<AANLkTiktzjTfFiZRSL=gt02dr_3ZUWWV3eOVsKpCNGx0@mail.gmail.com>
Message-ID: <pan.2010.12.20.22.28.49.222000@gmail.com>

Sarah, thank you, that worked great.

Dylan, thanks as well. I see you're using the same trick as Sarah in the
relevant argument. The rest of your blog will keep me busy for quite some
time.

Best,
Lee Hachadoorian
PhD Student, Geography
Program in Earth & Environmental Sciences
CUNY Graduate Center


From andrewaduff at gmail.com  Tue Dec 21 05:23:46 2010
From: andrewaduff at gmail.com (Andrew Duff)
Date: Mon, 20 Dec 2010 20:23:46 -0800
Subject: [R-sig-Geo] compare UD overlap of different home range methods for
	the same animal
Message-ID: <033701cba0c6$dd160e10$97422a30$@gmail.com>

I have what I think is a simple question for producing kerneloverlap indices
in the adehabitat package but I am having trouble with a solution.  The
basic problem is to use kernel overlap indices to compare different home
range techniques for a given animal.

 

I think the solution is in understanding how to create my own object of
khrud that contains UD's generated with different h parameters or home range
methods so that I can quantify how the different home range methods compare.
I have put together the following code from the samples using my own data,
but the solution for my problem seems to be in creating my own khrud object
containing UD's generated using different methods that I can feed into the
kerneloverlaphr function????  Maybe there is another solution?

 

Can anyone help?  I have provided a simple example to start.

 

Thanks,

 

Andy

 

#######################################################

library(adehabitat)

 

elk_tele_all <- read.table("ElkTelemetry_20100917_SPS_LE_660Feet_Final.txt",
header= TRUE, sep = ",")

elk_tele_all

names(elk_tele_all)

elk_tele_test <- subset(elk_tele_all, ElkName == 'Delores' | ElkName ==
'Gertrude' | ElkName == 'Clover' | ElkName == 'Eunice')

 

##Get the locations and animal names

loc <- elk_tele_test[, c("X_SPS", "Y_SPS")]

id <- elk_tele_test[, "ElkName"]

 

## Estimation of UD for the four animals

(ud <- kernelUD(loc, id, h = "href"))

image(ud) ## Note that the contours

 

## Example of estimation using LSCV

udbis <- kernelUD(loc, id, h = "LSCV")

image(udbis) ## Note that the contours

 

##This works to compare the four animals

kerneloverlap(loc, id,

grid=200, meth="VI", conditional=TRUE)

 

## Identical to

kud <- kernelUD(loc, id,

grid=200, same4all=TRUE)

kerneloverlaphr(kud, meth="VI", conditional=TRUE)

 

##But how do I compare the href and LSCV methods on a per animal basis?

##Once I can figure out this simple method, then I can work on more advanced
applications of CVh, BBMM, HPI, etc

???????

#######################################################

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101220/6765a163/attachment.html>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: ElkTelemetry_20100917_SPS_LE_660Feet_Final.txt
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101220/6765a163/attachment.txt>

From Roger.Bivand at nhh.no  Tue Dec 21 08:59:14 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 21 Dec 2010 08:59:14 +0100 (CET)
Subject: [R-sig-Geo] contradicting measures based on Log likelihood and
 AIC in spatial models
In-Reply-To: <AANLkTimWsZ_dOpiZTaiEjOOrihAyoaPT=niwdJo43TVT@mail.gmail.com>
References: <AANLkTi=xvpSZ9CEtOcn8oxiXnCakfDcKT=b5f0dkPzqf@mail.gmail.com>
	<alpine.LRH.2.00.1012191341050.11886@reclus.nhh.no>
	<AANLkTimWsZ_dOpiZTaiEjOOrihAyoaPT=niwdJo43TVT@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.1012210849150.19187@reclus.nhh.no>

On Mon, 20 Dec 2010, elaine kuo wrote:

> Dear Dr. Bivand,
>
> Thank you for the clear explanation.
> Your guess is right, and the missing code is pasted following each question.
> I will check the book you recommended and please advise for improvement of
> the code below.

Elaine,

There are a number of issues with your code; you have been ignoring a 
warning after running the CAR model too - the function should have 
reported:

Non-symmetric spatial weights in CAR model

which are not permitted, but may be valid if case weights are used too. 
You are also using na.omit, which suggests that your data is not complete 
- this may introduce additional problems.

I'm concerned that your distance based weights may also be incorrectly 
specified, as you are using distances on the plane, but I suspect that you 
should be using Great Circle distances.

Since this is a use case in which the spatial coefficients are hitting 
their upper bounds, I would be interested in seeing your data and script, 
if you can make then available, just in case there is something that ought 
to be fixed in the function. Could you please either attach 
Mig_ratio_20101214.csv to an offlist email reply, or if it is large, put 
it on a website and send the URL?

Best wishes,

Roger

>
> Thanks
>
> Elaine
>
>
>
>> (Moran? s I = 0.52)
>>>
>>
>> Was this using lm.morantest() - it should have been?
>
>   =>  Yes
>   # code
>      mig.moran<-lm.morantest(mig.std,nb8.w)
>       print(mig.moran)
>
>
>> (sample size 4873, explanatory variable number: 6)
>>
>>>
>>>
>>>
>>> After trying SAR and CAR in package spdep, the results are as followed.
>>>
>>>
>> Neither of the fits are credible, as the line search has terminated in both
>> cases at its upper limit. These is something seriously wrong with your
>> analysis. Which method= argument were you using, presumably in spautolm? You
>> did not quote the exact way in which you called the functions used - this
>> will be where your problems lie.
>>
>   => Yes, spautolm was used.
>
>    summary(sapply(listw$weights, sum)
>   => It shows
>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.
>      1       1       1       1       1       1
>
> # code
>>
>    datam <-read.csv("c:/migration/Mig_ratio_20101214.csv",header=T,
> row.names=1)
>    dim(datam)
>
>     library(ncf)
> library(spdep)
>
> # get the upper bound
>  up <- knearneigh(cbind(datam$lon,datam$lat))
>  upknn <- knn2nb(up)
>  updist1 <- nbdists(upknn,cbind(datam$lon,datam$lat))
>  updist1
>  updistvec <- unlist(updist1)
>  updistvec
>  upmaxd <- max(updistvec)
>  upmaxd  #the upper bound  (8.1124)
>
> #******************************************************************************************
> # spatial listw object
>
>    # Define coordinates, neighbours, and spatial weights
>      coords<-cbind(datam$lon,datam$lat)
>      coords<-as.matrix(coords)
>
>    # Define neighbourhood (here distance 8)
>      nb8<-dnearneigh(coords,0,8.12)
>      summary(nb8)
>
>      #length(nb8)
>      #sum(card(nb8))
>
>    # Spatial weights, illustrated with coding style "W" (row standardized)
>      nb8.w<-nb2listw(nb8, glist=NULL, style="W")
>
>    # regression
>
>    # std model
>       datam.sd<-scale(datam)
>       datam.std<-as.data.frame(datam.sd)
>       summary (datam.std)
>       mean(datam.std)
>
>    # obtain standard deviation
>      sd(datam.std)
>
>    # model
>    mig.std <-lm(SMB~t_r+e_r+p_e+a_r+
>    coast+Iso_1214,data=datam.std)
>
>    summary(mig.std)
>
>    # SAR of spautolm
>     mignb8.sar <- spautolm(SMB~t_r+e_r+p_e+a_r+
>    coast+Iso_1214,data=datam.std,
>     listw=nb8.w, na.action=na.omit, zero.policy=TRUE,
>     family="SAR", method="Matrix", verbose=TRUE)
>     summary(mignb8.sar,Nagelkerke = TRUE)
>
>
>   # CAR of spautolm
>     mignb8.car <- spautolm(SMB~t_r+e_r+p_e+a_r+
>    coast+Iso_1214,data=datam.std,
>     listw=nb8.w, na.action=na.omit, , zero.policy=TRUE,
>     family="CAR", method="Matrix", verbose=TRUE)
>     summary(mignb8.car,Nagelkerke = TRUE)
>
>
>> Are you using a weights matrix with very small values (and very small row
>> sums), and a sparse matrix method? Do you get different outcomes if you set
>> the search interval yourself - or accept the default and row-standardise the
>> weights (style="W" in nb2listw)? Look at summary(sapply(listw$weights, sum))
>> where listw is your listw object. I'll add a warning to spautolm() to test
>> whether the result is equal to a line search bound.
>>
>
>
>
>
>>
>> In reply to your question, had your analysis not been flawed, you could not
>> judge between CAR and SAR in the way you suggest as the models are not
>> strictly nested. Please see Ripley (1981) Spatial Statistics, Wiley, p. 90,
>> for a discussion of the relationship between SAR and CAR representations.
>> Briefly, if we term the CAR weights matrix C and the SAR weights matrix S,
>> then C = S + S' - S'S, and if LL' is the Cholesky decomposition of (I - C),
>> S = I - L'. If you do the full analysis of this relationship, you may be
>> able to proceed, but you also need to consider the interpretation of any
>> results.
>>
>> Hope this helps,
>>
>> Roger
>>
>>
>>  I would like to learn which model was better fit.
>>>
>>> However, the measures based on log likelihood and AIC imply different
>>> contradictions.
>>>
>>> 1. log likehood
>>>
>>>  SAR is better than CAR (4919,629 > 3694.246)
>>>
>>> 2. AIC
>>>
>>>  CAR is better than SAR (-7370.5 > -9821.3)
>>>
>>> Please kindly instruct which criterion I should follow, and advice on any
>>> other measure will be highly appreciated.
>>>
>>> Elaine
>>>
>>>
>>> ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
>>>
>>> SAR
>>> Lambda: 0.999 LR test value: 13618 p-value: < 2.22e-16
>>> Log likelihood: 4919.629
>>> ML residual variance (sigma squared): 0.0075669, (sigma: 0.086988)
>>>
>>> Number of observations: 4873
>>>
>>> Number of parameters estimated: 9
>>>
>>> AIC: -9821.3
>>>
>>> Nagelkerke pseudo-R-squared: 1
>>>
>>>
>>>
>>> CAR
>>>
>>> Lambda: 0.999 LR test value: 11167 p-value: < 2.22e-16
>>>
>>>
>>>
>>> Log likelihood: 3694.246
>>>
>>> ML residual variance (sigma squared): 0.012682, (sigma: 0.11261)
>>>
>>> Number of observations: 4873
>>>
>>> Number of parameters estimated: 9
>>>
>>> AIC: -7370.5
>>>
>>> Nagelkerke pseudo-R-squared: 1
>>>
>>>
>> --
>> Roger Bivand
>> Economic Geography Section, Department of Economics, Norwegian School of
>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>> e-mail: Roger.Bivand at nhh.no
>>
>>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From Roger.Bivand at nhh.no  Tue Dec 21 09:40:35 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 21 Dec 2010 09:40:35 +0100 (CET)
Subject: [R-sig-Geo] spatial clusters
In-Reply-To: <eef95d9fa8d1c8a6350635788deab411@econ.ubbcluj.ro>
References: <eef95d9fa8d1c8a6350635788deab411@econ.ubbcluj.ro>
Message-ID: <alpine.LRH.2.00.1012210919580.19187@reclus.nhh.no>

On Mon, 20 Dec 2010, dorina.lazar wrote:

>
> Dear all,
>
> Finally, with your help, I make some progress to apply SKATER algorithm to
> European countries.
>
> Here is the R code, following the example from  spdep package pdf:
>
>> country<-wrld_simpl[wrld_simpl$ISO3%in%c("AZE", "ALB", "ARM", "BIH",
> "BGR", "CYP", "DNK", "IRL", "EST", "AUT", "CZE", "FIN",  "FRA", "GEO",
> "DEU", "GRC", "HRV", "HUN", "ISL", "ITA", "LVA", "BLR", "LTU", "SVK",
> "LIE", "MLT", "BEL", "AND",  "LUX", "MCO", "NLD", "NOR", "POL", "PRT",
> "ROU", "MDA", "RUS", "SVN"),]
>> ske<-spCbind(country, rclasif)
>> ske at data
>> de <- data.frame(scale(ske at data[13]))   #col 13 contains the health
> indicator (from rclasif)
>> nbe <- poly2nb(country)
>> ce <- nbcosts(nbe, de)
>> le <- nb2listw(nbe, ce, style="B", zero.policy=TRUE)
> Error in nb2listw(nbe, ce, style = "B", zero.policy = TRUE) :
> neighbours and glist do not conform

Using your corrected list of countries, I see two/three problems:

1) some proximate polygons do not touch because of line generalisation in 
the simplification of the country polygons, use:

nbe <- poly2nb(country, snap=0.1)

to force neighbours to touch.

2) you are left with three real islands - Iceland, Cyprus, and Malta. To 
join them in, consider:

knn4 <- knn2nb(knearneigh(crds, 4, longlat=TRUE),
   row.names=row.names(country))
knn4s <- make.sym.nb(knn4)
nbe1 <- union.nb(nbe, knn4s)

3) nbcosts() does not like single-column data frames, as it is supposed to 
be for multivariate data, so:

de <- data.frame(rnorm(46))
ce <- nbcosts(nbe1, de)
which(sapply(ce, function(x) isTRUE(any(is.na(x)))))

gives an NA at the end of each line of cost distances, but:

de <- data.frame(rnorm(46), rnorm(46))
ce <- nbcosts(nbe1, de)
which(sapply(ce, function(x) isTRUE(any(is.na(x)))))
le <- nb2listw(nbe1, ce, style="B")

doesn't, nor does:

de <- data.frame(rnorm(46), rep(1, 46))
ce <- nbcosts(nbe1, de)
which(sapply(ce, function(x) isTRUE(any(is.na(x)))))
le <- nb2listw(nbe1, ce, style="B")

From there,

mst.bh <- mstree(le,5)
res1 <- skater(mst.bh[,1:2], de, 2)
plot(country, col=heat.colors(3)[res1$groups])

seem to work.

I think that it makes sense for nbcosts() to fail for non-connected 
observations, but perhaps it should explain why.

Hope this helps,

Roger


>
> I mention that:
> -	at "nbe", appears the message:  6 regions with no links: CYP DNK HRV ISL
> MLT SWE
> -	"ce" contain a lot of NA
> If you have some ideas about the cause of this Error, please help me to
> finalize my exercise on SKATER algoritm.
>
> Thanks a lot for your help,
> Dorina
>
>
>
>
> On Sat, 18 Dec 2010 18:42:35 +0100 (CET), Roger Bivand
> <Roger.Bivand at nhh.no> wrote:
>> On Sat, 18 Dec 2010, Roman Lu?trik wrote:
>>
>>> Perhaps you could follow the instructions from this
>>>
> exchange<http://r-sig-geo.2731867.n2.nabble.com/Guam-island-map-td4969467.html#a4972725>and
>>> see if you can extract the desired country (assuming the resolution
>>> suits you).
>>>
>>
>> I don't think that we know which countries Dorina needs, or at which
>> administrative level. If there are only 30 country observations, and the
>
>> countries are not contiguous, then the whole exercise seems unnecessary.
>
>> Can Dorina use the simplified world map in the maptools package:
>>
>> library(maptools)
>> ?wrld_simpl
>>
>> adding the data using the ISO country names? If these are countries at
>> some administrative division level, then maybe www.gadm.org will have
> what
>> is needed, but the countries will have to be joined together, or the
> whole
>> map subsetted. If these are say EU NUTS2 regions, then use can be made
> of
>> GISCO shapefiles from Eurostat. But we don't know what boundaries are
>> needed, and of course to use Skater for clustering, you need the
>> boundaries.
>>
>> Roger
>>
>>>
>>> Cheers,
>>> Roman
>>>
>>>
>>>
>>> On Sat, Dec 18, 2010 at 6:20 PM, Dorina Lazar <drnlazar at yahoo.com>
> wrote:
>>>
>>>> Georg,
>>>>
>>>> Thanks for being very patient with me.
>>>>
>>>> I have not a shapefile for countries.
>>>>
>>>> I have tried to obtain it. I have loaded a shapefile for Finland, GIS
>>>> data,
>>>> from
>>>>
> http://www.eea.europa.eu/data-and-maps/data/eea-reference-grids/zipped-shape-file-finland
>>>>
>>>> and I tried to read the file FI_1K.shp
>>>> Fin<- readShapePoly(system.file("etc/shapes/ FI_1K.shp",
>>>> package="spdep"))
>>>> but...
>>>> Error in getinfo.shape(filen) : Error opening SHP file
>>>>
>>>> How can I obtain, for each country,  the shapefile spatial polygon in
> R
>>>> (SpatialPolygons-DataFrame)?
>>>>
>>>> Thanks again,
>>>> Dorina
>>>>
>>>>
>>>> --- On Thu, 12/16/10, Georg Ru? <research at georgruss.de> wrote:
>>>>
>>>>> From: Georg Ru? <research at georgruss.de>
>>>>> Subject: Re: [R-sig-Geo] spatial clusters
>>>>> To: "Dorina Lazar" <dorina.lazar at econ.ubbcluj.ro>
>>>>> Cc: "R-sig-geo mailing list" <r-sig-geo at r-project.org>
>>>>> Date: Thursday, December 16, 2010, 10:41 AM
>>>>> On 16/12/10 09:06:33, dorina.lazar
>>>>> wrote:
>>>>>> How to create a shapefile including my data about some
>>>>> socio-demographic
>>>>>> indicators (7),  for about 30 countries around
>>>>> the world (to be read with
>>>>>> readShapePoly)?
>>>>>
>>>>> Hi Dorina,
>>>>>
>>>>> I'm not quite sure what you have and what you want.
>>>>>
>>>>> I assume that you'd like to create a shapefile such that
>>>>> for every country
>>>>> (which is represented as a polygon) there's a vector of
>>>>> seven attributes
>>>>> attached to it:
>>>>>
>>>>> country1:  attr1 attr2 attr3 attr4 attr5 attr6 attr7
>>>>> country2:  attr1 attr2 attr3 attr4 attr5 attr6 attr7
>>>>> ...
>>>>>
>>>>> Do you have your countries as spatial polygons in R
>>>>> (SpatialPolygons-
>>>>> DataFrame or similar)? If yes, you should be able to add
>>>>> your socio-demo-
>>>>> graphic indicators to this data frame (just as in normal
>>>>> data frames). In
>>>>> this way you'd join the data you have inside R.
>>>>>
>>>>> If you have the shapefile for the countries available and
>>>>> would like to
>>>>> edit this directly to add the indicators, I'd suggest using
>>>>> a GIS like
>>>>> GRASS http://grass.fbk.eu/ Afterwards, this can be easily
>>>>> read into R.
>>>>>
>>>>>> Would be useful to suggest some good introductory
>>>>> lectures in spatial
>>>>>> statistics (links or books).
>>>>>
>>>>> I think the following is what Roger would suggest:
>>>>>
>>>>>  author = {Bivand, Roger S. and Pebesma, Edzer J. and
>>>>> G?mez-Rubio, Virgilio},
>>>>>  title = {Applied Spatial Data Analysis with R},
>>>>>  series = {Use R},
>>>>>  publisher = {Springer},
>>>>>
>>>>> http://www.asdar-book.org/
>>>>> http://www.springerlink.com/content/uw07v1/
>>>>> (Depending on your login/institute you may have fulltext
>>>>> access, but the
>>>>> book is definitely worth buying anyway.)
>>>>>
>>>>> Regards,
>>>>> Georg.
>>>>> --
>>>>> Research Assistant
>>>>> Otto-von-Guericke-Universit?t Magdeburg
>>>>> research at georgruss.de
>>>>> http://research.georgruss.de
>>>>>
>>>>> _______________________________________________
>>>>> R-sig-Geo mailing list
>>>>> R-sig-Geo at r-project.org
>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>
>>>>
>>>>
>>>>
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at r-project.org
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>
>>>
>>>
>>>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From Maxime.Pauwels at univ-lille1.fr  Tue Dec 21 11:04:23 2010
From: Maxime.Pauwels at univ-lille1.fr (Maxime Pauwels)
Date: Tue, 21 Dec 2010 11:04:23 +0100
Subject: [R-sig-Geo] change cellsize in an object of class
	SpatialGridDataFrame
Message-ID: <4D107BA7.7030308@univ-lille1.fr>

Dear all,

I'd like to change size of cells in an object of class 
SpatialGridDataFrame. How can I do this?
The object I manipulate is summarized below. As you can see, size of 
cell lightly differ between latitude and longitude.

Many thanks for your help.

max


summary(CCSMpastgrd)
Object of class SpatialGridDataFrame
Coordinates:
            min      max
long -4.437526 29.97919
lat  40.062441 54.97922
Is projected: FALSE
proj4string : [+proj=longlat]
Number of points: 2
Grid attributes:
      cellcentre.offset   cellsize cells.dim
long         -4.416667 0.04171723       825
lat          40.083333 0.04178371       357
Data attributes:
       Min.    1st Qu.     Median       Mean    3rd Qu.       Max.       
NA's
3.7500e-08 8.8200e-06 3.8300e-05 5.3880e-04 1.9390e-04 4.5430e-02 
5.8586e+04

-- 
Maxime Pauwels
Researcher ID: http://www.researcherid.com/rid/A-1745-2009

Equipe G?n?tique&  ?volution de l'adaptation aux environnements pollu?s par les m?taux lourds
Laboratoire de G?n?tique et Evolution des Populations V?g?tales
FRE CNRS 3268
B?timent SN2
Universit? de Lille, USTL-Lille1
http://gepv.univ-lille1.fr
Tel  : +33 3 20 33 62 38
Fax  : +33 3 20 43 69 79


From carstennh at aol.com  Tue Dec 21 12:21:49 2010
From: carstennh at aol.com (Carsten Neumann)
Date: Tue, 21 Dec 2010 12:21:49 +0100
Subject: [R-sig-Geo] export to .asc or .grd files
In-Reply-To: <4D0F8C2F.5050704@univ-lille1.fr>
References: <4D0F8C2F.5050704@univ-lille1.fr>
Message-ID: <4D108DCD.60700@aol.com>

  Am 20.12.2010 18:02, schrieb Maxime Pauwels:
> Hi list,
>
> I'm using the sp package to grid data. I'd now like to export the grid 
> in either .asc or .grd files. Does anyone can give me the package and 
> function that does it easily?
>
> Thanks,
>
> max
>
Hi Max,

library(raster); use with function: writeRaster("raster object", "name", 
format="ascii"); format="raster" for *.grd files

library(rgdal); use with function: writeGDAL("rgdal object", 
fname="name", drivername="AAIGrid"); use gdalDrivers() to identify your 
preferred drivername for *.grd

you certainly have to change your grid object to a raster object when 
using raster package.

All the best!

Carsten


From senator at ecotoxicology.de  Tue Dec 21 12:54:38 2010
From: senator at ecotoxicology.de (=?iso-8859-1?Q?Ralf_Sch=E4fer?=)
Date: Tue, 21 Dec 2010 12:54:38 +0100
Subject: [R-sig-Geo] RGDAL
In-Reply-To: <6B591658-15F5-45E5-BD1C-BFD496220531@uni-landau.de>
References: <mailman.15.1292929203.28946.r-sig-geo@r-project.org>
	<6B591658-15F5-45E5-BD1C-BFD496220531@uni-landau.de>
Message-ID: <23752299-4343-49E4-9111-14B6835CFB98@ecotoxicology.de>

Hi Daniel,

try in R:
install.packages("rgdal", configure.args='--with-gdal-config=/Library/Frameworks/GDAL.Framework/Unix/bin/gdal-config --with-proj-include=/Library/Frameworks/PROJ.framework/unix/include-with-proj-lib=/Library/Frameworks/PROJ.framework/unix/lib/',dependencies=TRUE, type="source")

Of course you need to install the GDAL and PROJ framework before - if you install from kyngchaos they should be at the path given in the code above.

It works for me on 64-bit Macbook Pro and Mac Pro with R 2.12 

Beste Gr??e,

Best regards,

Ralf Sch?fer

------------------------------------------------------------

Prof. Dr. rer. nat. Ralf Bernhard Sch?fer
Juniorprofessor Quantitative Landscape Ecology
Environmental Scientist (M.Sc.)
Institute for Environmental Sciences
University Koblenz-Landau
Forststrasse 7
76829 Landau
Germany
Mail: schaefer-ralf at uni-landau.de
Phone: ++49 (0) 6341 280-31536
Web: http://tinyurl.com/37ot8xq

> 
>> ------------------------------
>> 
>> Message: 2
>> Date: Mon, 20 Dec 2010 12:12:23 -0200
>> From: Daniel <dmsilv at gmail.com>
>> To: r-sig-geo at stat.math.ethz.ch
>> Subject: [R-sig-Geo] RGDAL
>> Message-ID:
>> 	<AANLkTimaFnMeM3aCZFyomam78Kpjzbj89c4tEqKg=Bn3 at mail.gmail.com>
>> Content-Type: text/plain
>> 
>> Dears,
>> Anybody knows how can I solve the following error.
>> 
>> * installing *source* package ?rgdal? ...
>> gdal-config: gdal-config
>> ./configure: line 1311: gdal-config: command not found
>> Error: gdal-config not found
>> The gdal-config script distributed with GDAL could not be found.
>> If you have not installed the GDAL libraries, you can
>> download the source from  http://www.gdal.org/
>> If you have installed the GDAL libraries, then make sure that
>> gdal-config is in your path. Try typing gdal-config at a
>> shell prompt and see if it runs. If not, use:
>> --configure-args='--with-gdal-config=/usr/local/bin/gdal-config' echo with
>> appropriate values for your installation.
>> 
>> ERROR: configuration failed for package ?rgdal?
>> * removing ?/Users/dms/Library/R/2.12/library/rgdal?
>> * restoring previous ?/Users/dms/Library/R/2.12/library/rgdal?
>> 
>> The downloaded packages are in
>> ?/private/var/folders/GU/GU-nsrKmGteghFv3YFf1C++++TI/-Tmp-/RtmpqkhOBF/downloaded_packages?
>> 
>> 
>> I tried the following, but not worked:
>> 
>> daniel-marcelinos-macbook-pro:~ dms$
>> --configure-args='--with-gdal-config=/usr/local/bin/gdal-config'
>> -bash: -s: command not found
>> 
>> 
>> 
>> -- 
>> Daniel Marcelino
>> Skype: dmsilv
>> http://marcelino.pbworks.com/
>> 
>> 	[[alternative HTML version deleted]]
>> 
> 


From lists at remoteinformation.com.au  Tue Dec 21 13:11:34 2010
From: lists at remoteinformation.com.au (Ben Madin)
Date: Tue, 21 Dec 2010 23:11:34 +1100
Subject: [R-sig-Geo] RGDAL
In-Reply-To: <23752299-4343-49E4-9111-14B6835CFB98@ecotoxicology.de>
References: <mailman.15.1292929203.28946.r-sig-geo@r-project.org>
	<6B591658-15F5-45E5-BD1C-BFD496220531@uni-landau.de>
	<23752299-4343-49E4-9111-14B6835CFB98@ecotoxicology.de>
Message-ID: <DC121A03-5376-4D05-A728-BEC57EB4E6FE@remoteinformation.com.au>

Additionally, if you install GDAL and PROJ frameworks from kynchaos.com, there is also a rgdal package... very easy.

cheers

Ben


On 21/12/2010, at 10:54 PM, Ralf Sch?fer wrote:

> Hi Daniel,
> 
> try in R:
> install.packages("rgdal", configure.args='--with-gdal-config=/Library/Frameworks/GDAL.Framework/Unix/bin/gdal-config --with-proj-include=/Library/Frameworks/PROJ.framework/unix/include-with-proj-lib=/Library/Frameworks/PROJ.framework/unix/lib/',dependencies=TRUE, type="source")
> 
> Of course you need to install the GDAL and PROJ framework before - if you install from kyngchaos they should be at the path given in the code above.
> 
> It works for me on 64-bit Macbook Pro and Mac Pro with R 2.12 
> 
> Beste Gr??e,
> 
> Best regards,
> 
> Ralf Sch?fer
> 
> ------------------------------------------------------------
> 
> Prof. Dr. rer. nat. Ralf Bernhard Sch?fer
> Juniorprofessor Quantitative Landscape Ecology
> Environmental Scientist (M.Sc.)
> Institute for Environmental Sciences
> University Koblenz-Landau
> Forststrasse 7
> 76829 Landau
> Germany
> Mail: schaefer-ralf at uni-landau.de
> Phone: ++49 (0) 6341 280-31536
> Web: http://tinyurl.com/37ot8xq
> 
>> 
>>> ------------------------------
>>> 
>>> Message: 2
>>> Date: Mon, 20 Dec 2010 12:12:23 -0200
>>> From: Daniel <dmsilv at gmail.com>
>>> To: r-sig-geo at stat.math.ethz.ch
>>> Subject: [R-sig-Geo] RGDAL
>>> Message-ID:
>>> 	<AANLkTimaFnMeM3aCZFyomam78Kpjzbj89c4tEqKg=Bn3 at mail.gmail.com>
>>> Content-Type: text/plain
>>> 
>>> Dears,
>>> Anybody knows how can I solve the following error.
>>> 
>>> * installing *source* package ?rgdal? ...
>>> gdal-config: gdal-config
>>> ./configure: line 1311: gdal-config: command not found
>>> Error: gdal-config not found
>>> The gdal-config script distributed with GDAL could not be found.
>>> If you have not installed the GDAL libraries, you can
>>> download the source from  http://www.gdal.org/
>>> If you have installed the GDAL libraries, then make sure that
>>> gdal-config is in your path. Try typing gdal-config at a
>>> shell prompt and see if it runs. If not, use:
>>> --configure-args='--with-gdal-config=/usr/local/bin/gdal-config' echo with
>>> appropriate values for your installation.
>>> 
>>> ERROR: configuration failed for package ?rgdal?
>>> * removing ?/Users/dms/Library/R/2.12/library/rgdal?
>>> * restoring previous ?/Users/dms/Library/R/2.12/library/rgdal?
>>> 
>>> The downloaded packages are in
>>> ?/private/var/folders/GU/GU-nsrKmGteghFv3YFf1C++++TI/-Tmp-/RtmpqkhOBF/downloaded_packages?
>>> 
>>> 
>>> I tried the following, but not worked:
>>> 
>>> daniel-marcelinos-macbook-pro:~ dms$
>>> --configure-args='--with-gdal-config=/usr/local/bin/gdal-config'
>>> -bash: -s: command not found
>>> 
>>> 
>>> 
>>> -- 
>>> Daniel Marcelino
>>> Skype: dmsilv
>>> http://marcelino.pbworks.com/
>>> 
>>> 	[[alternative HTML version deleted]]
>>> 
>> 
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From piero.campa at gmail.com  Tue Dec 21 15:49:45 2010
From: piero.campa at gmail.com (piero campa)
Date: Tue, 21 Dec 2010 06:49:45 -0800 (PST)
Subject: [R-sig-Geo] Global or local variogram model
Message-ID: <1292942985883-5855544.post@n2.nabble.com>


Hi,
this is not a technical question, and maybe I shouldn't post it here.

Anyway, let's say you have several georeferenced datasets of a same variable
to be interpolated, each one representing different days, for example.
Is it better to compute "offline" a unique variogram model over the WHOLE
amount of data, or should I compute a different model for each dataset?

Thank you.
Cheers,
Piero
-- 
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Global-or-local-variogram-model-tp5855544p5855544.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From piero.campa at gmail.com  Tue Dec 21 16:00:22 2010
From: piero.campa at gmail.com (piero campa)
Date: Tue, 21 Dec 2010 07:00:22 -0800 (PST)
Subject: [R-sig-Geo] Continuous colorbar legend for a
	SpatialPointsDataFrame object
In-Reply-To: <e4178da61003261213n5953c494j1bf08dc0490fadc9@mail.gmail.com>
References: <e4178da61003261213n5953c494j1bf08dc0490fadc9@mail.gmail.com>
Message-ID: <1292943622540-5855549.post@n2.nabble.com>


I would submit the same question.
Piero

(Pierre, did you manage somehow then?)
-- 
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Continuous-colorbar-legend-for-a-SpatialPointsDataFrame-object-tp4805804p5855549.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From dmsilv at gmail.com  Tue Dec 21 17:52:29 2010
From: dmsilv at gmail.com (Daniel)
Date: Tue, 21 Dec 2010 14:52:29 -0200
Subject: [R-sig-Geo] RGDAL
In-Reply-To: <6B591658-15F5-45E5-BD1C-BFD496220531@uni-landau.de>
References: <mailman.15.1292929203.28946.r-sig-geo@r-project.org>
	<6B591658-15F5-45E5-BD1C-BFD496220531@uni-landau.de>
Message-ID: <AANLkTim_P7yr5O7sZe4-H-A6GnUGtmpaQDmsPbV_omdB@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101221/792294d2/attachment.pl>

From axs.seven at gmail.com  Tue Dec 21 22:09:48 2010
From: axs.seven at gmail.com (Axs Seven)
Date: Tue, 21 Dec 2010 23:09:48 +0200
Subject: [R-sig-Geo] Drawing lines on a map in R (a la airline routes)
Message-ID: <AANLkTin-YKkBGeGfcAR0kSTy1+YDDrJKue=OdtDMXhtW@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101221/6be17be0/attachment.pl>

From r.hijmans at gmail.com  Tue Dec 21 22:35:58 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Tue, 21 Dec 2010 13:35:58 -0800
Subject: [R-sig-Geo] Drawing lines on a map in R (a la airline routes)
In-Reply-To: <AANLkTin-YKkBGeGfcAR0kSTy1+YDDrJKue=OdtDMXhtW@mail.gmail.com>
References: <AANLkTin-YKkBGeGfcAR0kSTy1+YDDrJKue=OdtDMXhtW@mail.gmail.com>
Message-ID: <AANLkTi=cinNkdrEh22jCf6LpjNDLB8d-+T1mn-=8g5z_@mail.gmail.com>

https://stat.ethz.ch/pipermail/r-sig-geo/2010-December/010426.html


On Tue, Dec 21, 2010 at 1:09 PM, Axs Seven <axs.seven at gmail.com> wrote:
> Hi
>
> I would like to replicate the map of airline routes in R (such as
> http://openflights.org/demo/openflights-routedb-2048.png) , but I haven't
> managed to find any pointers or tutorials on how this can be achieved. I
> would greatly appreciate if someone could point me to the right direction.
>
> Axs
>
> ? ? ? ?[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From dmsilv at gmail.com  Tue Dec 21 23:08:34 2010
From: dmsilv at gmail.com (Daniel)
Date: Tue, 21 Dec 2010 20:08:34 -0200
Subject: [R-sig-Geo] RGDAL
In-Reply-To: <AANLkTim_P7yr5O7sZe4-H-A6GnUGtmpaQDmsPbV_omdB@mail.gmail.com>
References: <mailman.15.1292929203.28946.r-sig-geo@r-project.org>
	<6B591658-15F5-45E5-BD1C-BFD496220531@uni-landau.de>
	<AANLkTim_P7yr5O7sZe4-H-A6GnUGtmpaQDmsPbV_omdB@mail.gmail.com>
Message-ID: <AANLkTi=kz_qn74aH5UntZue-ENMMKya_7aSnmA5Zth8Z@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101221/f7fa8436/attachment.pl>

From govindas at msu.edu  Wed Dec 22 02:01:26 2010
From: govindas at msu.edu (govindas at msu.edu)
Date: Tue, 21 Dec 2010 20:01:26 -0500
Subject: [R-sig-Geo] matrix indexing in 'for' loop?
Message-ID: <20101221200126.76195oiucc8gjnja@mail.msu.edu>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101221/2b18680d/attachment.pl>

From Lee.Hachadoorian+L at gmail.com  Wed Dec 22 05:44:30 2010
From: Lee.Hachadoorian+L at gmail.com (Lee Hachadoorian)
Date: Wed, 22 Dec 2010 04:44:30 +0000 (UTC)
Subject: [R-sig-Geo] Multiple legends in spplot
Message-ID: <iervnd$e6i$1@dough.gmane.org>

Trying to produce spplot with a point layer on top of a polygon layer. 
Looks like this can be accomplished using plot() (see for example http://
www.asdar-book.org/code.php?chapter=2&figure=7), but I want to use spplot 
for the typical reasons (i.e, to produce several polygon maps showing 
related attributes using the same quantitative classes).

That problem statement might be enough to point me to an example 
somewhere, since I assume I'm not the first person who has wanted to do 
this, but I haven't been able to find anything in the help or the 
archives. Apologies if I'm missing something obvious.

More specifically, I would like something that looks like this figure 

http://r-spatial.sourceforge.net/gallery/#fig04.R

except instead of a north arrow, the right should have a colorkey for the 
polygon object. Using standard data:

library(sp)
library(lattice)

#CREATE SpatialPolygonsDataFrame OF RIVERBED
data(meuse.riv)
meuse.lst = list(Polygons(list(Polygon(meuse.riv)), "meusee.riv"))
spdfMeuse = SpatialPolygonsDataFrame(
	SpatialPolygons(meuse.lst),
	data.frame(anything = 1, row.names = "meusee.riv")
)

#CREATE SpatialPoints OF SOIL SAMPLES
data(meuse)
coordinates(meuse) = c("x", "y")

#THIS PLOTS POLYGONS AND POINTS WITH A colorkey FOR THE POLYGONS
spplot(spdfMeuse,
	sp.layout = list("sp.points", meuse, pch = as.integer(meuse$soil))
)

#THIS PLOTS POLYGONS AND POINTS WITH A LEGEND FOR THE POINTS
spplot(meuse, "soil", 
	key.space = list(x = 0.1, y = 0.93, corner = c(0,1)),
	sp.layout = list("sp.polygons", spdfMeuse, fill = "lightblue")
)

So I can combine both layers, but I haven't been able to figure out how 
to get both legends. Figure 4 from the R-spatial gallery (referenced 
above) uses the legend argument to add a North arrow. Since xyplot() 
specifies that the legend argument is necessary to produce multiple keys, 
I'm assuming the answer must make use of it. But trying to adapt the code 
for Figure 4 as:

spplot(spdfMeuse,
	sp.layout = list("sp.points", meuse, pch = as.integer(meuse
$soil)),
	legend = list(inside = list(fun = mapLegendGrob(meuse, "soil"), x 
= 1, y = 0.1, corner = c(0,0)))
)

yields:

Error in SpatialPolygons2Grob(obj, fill) : 
  object is not of class SpatialPolygons
Calls: spplot ... .local -> append -> mapLegendGrob -> 
SpatialPolygons2Grob

sessionInfo() below the sig.

Regards, 
Lee Hachadoorian
PhD Student, Geography
Program in Earth & Environmental Sciences
CUNY Graduate Center

> sessionInfo()
R version 2.12.1 (2010-12-16)
Platform: x86_64-pc-linux-gnu (64-bit)

locale:
 [1] LC_CTYPE=en_US.utf8          LC_NUMERIC=C                
 [3] LC_TIME=en_US.utf8           LC_COLLATE=en_US.utf8       
 [5] LC_MONETARY=en_US.utf8       LC_MESSAGES=en_US.utf8      
 [7] LC_PAPER=en_US.utf8          LC_NAME=en_US.utf8          
 [9] LC_ADDRESS=en_US.utf8        LC_TELEPHONE=en_US.utf8     
[11] LC_MEASUREMENT=en_US.utf8    LC_IDENTIFICATION=en_US.utf8

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
[1] lattice_0.19-13    RColorBrewer_1.0-2 RSQLite_0.9-2      
sp_0.9-66         
[5] RPostgreSQL_0.1-6  DBI_0.2-5          rkward_0.5.4      

loaded via a namespace (and not attached):
[1] grid_2.12.1  tools_2.12.1


From senator at ecotoxicology.de  Wed Dec 22 09:26:43 2010
From: senator at ecotoxicology.de (=?iso-8859-1?Q?Ralf_Sch=E4fer?=)
Date: Wed, 22 Dec 2010 09:26:43 +0100
Subject: [R-sig-Geo] RGDAL
In-Reply-To: <AANLkTi=kz_qn74aH5UntZue-ENMMKya_7aSnmA5Zth8Z@mail.gmail.com>
References: <mailman.15.1292929203.28946.r-sig-geo@r-project.org>
	<6B591658-15F5-45E5-BD1C-BFD496220531@uni-landau.de>
	<AANLkTim_P7yr5O7sZe4-H-A6GnUGtmpaQDmsPbV_omdB@mail.gmail.com>
	<AANLkTi=kz_qn74aH5UntZue-ENMMKya_7aSnmA5Zth8Z@mail.gmail.com>
Message-ID: <69521FFF-C9DF-466B-9941-7F2A8D8C2C70@ecotoxicology.de>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101222/56a351dc/attachment.pl>

From dorina.lazar at econ.ubbcluj.ro  Wed Dec 22 11:01:27 2010
From: dorina.lazar at econ.ubbcluj.ro (dorina.lazar)
Date: Wed, 22 Dec 2010 12:01:27 +0200
Subject: [R-sig-Geo] spatial clusters
In-Reply-To: <alpine.LRH.2.00.1012210919580.19187@reclus.nhh.no>
References: <eef95d9fa8d1c8a6350635788deab411@econ.ubbcluj.ro>
	<alpine.LRH.2.00.1012210919580.19187@reclus.nhh.no>
Message-ID: <46b879577c06b22cda658caecae9fc5c@econ.ubbcluj.ro>


Dear Roger,

Thanks, your suggestions was helpful. I think I exaggerated the questions,
but for all countries:  ?Error in mstree(le, 5): Graph is not
connected!?; taking only some samples of countries the graph is
connected. There is something to be done in this case?

All the best,
Dorina  



On Tue, 21 Dec 2010 09:40:35 +0100 (CET), Roger Bivand
<Roger.Bivand at nhh.no> wrote:
> On Mon, 20 Dec 2010, dorina.lazar wrote:
> 
>>
>> Dear all,
>>
>> Finally, with your help, I make some progress to apply SKATER algorithm
>> to
>> European countries.
>>
>> Here is the R code, following the example from  spdep package pdf:
>>
>>> country<-wrld_simpl[wrld_simpl$ISO3%in%c("AZE", "ALB", "ARM", "BIH",
>> "BGR", "CYP", "DNK", "IRL", "EST", "AUT", "CZE", "FIN",  "FRA", "GEO",
>> "DEU", "GRC", "HRV", "HUN", "ISL", "ITA", "LVA", "BLR", "LTU", "SVK",
>> "LIE", "MLT", "BEL", "AND",  "LUX", "MCO", "NLD", "NOR", "POL", "PRT",
>> "ROU", "MDA", "RUS", "SVN"),]
>>> ske<-spCbind(country, rclasif)
>>> ske at data
>>> de <- data.frame(scale(ske at data[13]))   #col 13 contains the health
>> indicator (from rclasif)
>>> nbe <- poly2nb(country)
>>> ce <- nbcosts(nbe, de)
>>> le <- nb2listw(nbe, ce, style="B", zero.policy=TRUE)
>> Error in nb2listw(nbe, ce, style = "B", zero.policy = TRUE) :
>> neighbours and glist do not conform
> 
> Using your corrected list of countries, I see two/three problems:
> 
> 1) some proximate polygons do not touch because of line generalisation
in 
> the simplification of the country polygons, use:
> 
> nbe <- poly2nb(country, snap=0.1)
> 
> to force neighbours to touch.
> 
> 2) you are left with three real islands - Iceland, Cyprus, and Malta. To

> join them in, consider:
> 
> knn4 <- knn2nb(knearneigh(crds, 4, longlat=TRUE),
>    row.names=row.names(country))
> knn4s <- make.sym.nb(knn4)
> nbe1 <- union.nb(nbe, knn4s)
> 
> 3) nbcosts() does not like single-column data frames, as it is supposed
to 
> be for multivariate data, so:
> 
> de <- data.frame(rnorm(46))
> ce <- nbcosts(nbe1, de)
> which(sapply(ce, function(x) isTRUE(any(is.na(x)))))
> 
> gives an NA at the end of each line of cost distances, but:
> 
> de <- data.frame(rnorm(46), rnorm(46))
> ce <- nbcosts(nbe1, de)
> which(sapply(ce, function(x) isTRUE(any(is.na(x)))))
> le <- nb2listw(nbe1, ce, style="B")
> 
> doesn't, nor does:
> 
> de <- data.frame(rnorm(46), rep(1, 46))
> ce <- nbcosts(nbe1, de)
> which(sapply(ce, function(x) isTRUE(any(is.na(x)))))
> le <- nb2listw(nbe1, ce, style="B")
> 
> From there,
> 
> mst.bh <- mstree(le,5)
> res1 <- skater(mst.bh[,1:2], de, 2)
> plot(country, col=heat.colors(3)[res1$groups])
> 
> seem to work.
> 
> I think that it makes sense for nbcosts() to fail for non-connected 
> observations, but perhaps it should explain why.
> 
> Hope this helps,
> 
> Roger
> 
> 
>>
>> I mention that:
>> -	at "nbe", appears the message:  6 regions with no links: CYP DNK HRV
>> ISL
>> MLT SWE
>> -	"ce" contain a lot of NA
>> If you have some ideas about the cause of this Error, please help me to
>> finalize my exercise on SKATER algoritm.
>>
>> Thanks a lot for your help,
>> Dorina
>>
>>
>>
>>
>> On Sat, 18 Dec 2010 18:42:35 +0100 (CET), Roger Bivand
>> <Roger.Bivand at nhh.no> wrote:
>>> On Sat, 18 Dec 2010, Roman Lu?trik wrote:
>>>
>>>> Perhaps you could follow the instructions from this
>>>>
>>
exchange<http://r-sig-geo.2731867.n2.nabble.com/Guam-island-map-td4969467.html#a4972725>and
>>>> see if you can extract the desired country (assuming the resolution
>>>> suits you).
>>>>
>>>
>>> I don't think that we know which countries Dorina needs, or at which
>>> administrative level. If there are only 30 country observations, and
the
>>
>>> countries are not contiguous, then the whole exercise seems
unnecessary.
>>
>>> Can Dorina use the simplified world map in the maptools package:
>>>
>>> library(maptools)
>>> ?wrld_simpl
>>>
>>> adding the data using the ISO country names? If these are countries at
>>> some administrative division level, then maybe www.gadm.org will have
>> what
>>> is needed, but the countries will have to be joined together, or the
>> whole
>>> map subsetted. If these are say EU NUTS2 regions, then use can be made
>> of
>>> GISCO shapefiles from Eurostat. But we don't know what boundaries are
>>> needed, and of course to use Skater for clustering, you need the
>>> boundaries.
>>>
>>> Roger
>>>
>>>>
>>>> Cheers,
>>>> Roman
>>>>
>>>>
>>>>
>>>> On Sat, Dec 18, 2010 at 6:20 PM, Dorina Lazar <drnlazar at yahoo.com>
>> wrote:
>>>>
>>>>> Georg,
>>>>>
>>>>> Thanks for being very patient with me.
>>>>>
>>>>> I have not a shapefile for countries.
>>>>>
>>>>> I have tried to obtain it. I have loaded a shapefile for Finland,
GIS
>>>>> data,
>>>>> from
>>>>>
>>
http://www.eea.europa.eu/data-and-maps/data/eea-reference-grids/zipped-shape-file-finland
>>>>>
>>>>> and I tried to read the file FI_1K.shp
>>>>> Fin<- readShapePoly(system.file("etc/shapes/ FI_1K.shp",
>>>>> package="spdep"))
>>>>> but...
>>>>> Error in getinfo.shape(filen) : Error opening SHP file
>>>>>
>>>>> How can I obtain, for each country,  the shapefile spatial polygon
in
>> R
>>>>> (SpatialPolygons-DataFrame)?
>>>>>
>>>>> Thanks again,
>>>>> Dorina
>>>>>
>>>>>
>>>>> --- On Thu, 12/16/10, Georg Ru? <research at georgruss.de> wrote:
>>>>>
>>>>>> From: Georg Ru? <research at georgruss.de>
>>>>>> Subject: Re: [R-sig-Geo] spatial clusters
>>>>>> To: "Dorina Lazar" <dorina.lazar at econ.ubbcluj.ro>
>>>>>> Cc: "R-sig-geo mailing list" <r-sig-geo at r-project.org>
>>>>>> Date: Thursday, December 16, 2010, 10:41 AM
>>>>>> On 16/12/10 09:06:33, dorina.lazar
>>>>>> wrote:
>>>>>>> How to create a shapefile including my data about some
>>>>>> socio-demographic
>>>>>>> indicators (7),  for about 30 countries around
>>>>>> the world (to be read with
>>>>>>> readShapePoly)?
>>>>>>
>>>>>> Hi Dorina,
>>>>>>
>>>>>> I'm not quite sure what you have and what you want.
>>>>>>
>>>>>> I assume that you'd like to create a shapefile such that
>>>>>> for every country
>>>>>> (which is represented as a polygon) there's a vector of
>>>>>> seven attributes
>>>>>> attached to it:
>>>>>>
>>>>>> country1:  attr1 attr2 attr3 attr4 attr5 attr6 attr7
>>>>>> country2:  attr1 attr2 attr3 attr4 attr5 attr6 attr7
>>>>>> ...
>>>>>>
>>>>>> Do you have your countries as spatial polygons in R
>>>>>> (SpatialPolygons-
>>>>>> DataFrame or similar)? If yes, you should be able to add
>>>>>> your socio-demo-
>>>>>> graphic indicators to this data frame (just as in normal
>>>>>> data frames). In
>>>>>> this way you'd join the data you have inside R.
>>>>>>
>>>>>> If you have the shapefile for the countries available and
>>>>>> would like to
>>>>>> edit this directly to add the indicators, I'd suggest using
>>>>>> a GIS like
>>>>>> GRASS http://grass.fbk.eu/ Afterwards, this can be easily
>>>>>> read into R.
>>>>>>
>>>>>>> Would be useful to suggest some good introductory
>>>>>> lectures in spatial
>>>>>>> statistics (links or books).
>>>>>>
>>>>>> I think the following is what Roger would suggest:
>>>>>>
>>>>>>  author = {Bivand, Roger S. and Pebesma, Edzer J. and
>>>>>> G?mez-Rubio, Virgilio},
>>>>>>  title = {Applied Spatial Data Analysis with R},
>>>>>>  series = {Use R},
>>>>>>  publisher = {Springer},
>>>>>>
>>>>>> http://www.asdar-book.org/
>>>>>> http://www.springerlink.com/content/uw07v1/
>>>>>> (Depending on your login/institute you may have fulltext
>>>>>> access, but the
>>>>>> book is definitely worth buying anyway.)
>>>>>>
>>>>>> Regards,
>>>>>> Georg.
>>>>>> --
>>>>>> Research Assistant
>>>>>> Otto-von-Guericke-Universit?t Magdeburg
>>>>>> research at georgruss.de
>>>>>> http://research.georgruss.de
>>>>>>
>>>>>> _______________________________________________
>>>>>> R-sig-Geo mailing list
>>>>>> R-sig-Geo at r-project.org
>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>>
>>>>>
>>>>>
>>>>>
>>>>>
>>>>> _______________________________________________
>>>>> R-sig-Geo mailing list
>>>>> R-sig-Geo at r-project.org
>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>
>>>>
>>>>
>>>>
>>>>
>>


From edzer.pebesma at uni-muenster.de  Wed Dec 22 12:01:50 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Wed, 22 Dec 2010 12:01:50 +0100
Subject: [R-sig-Geo] Multiple legends in spplot
In-Reply-To: <iervnd$e6i$1@dough.gmane.org>
References: <iervnd$e6i$1@dough.gmane.org>
Message-ID: <4D11DA9E.60108@uni-muenster.de>

Lee,

looking at sp:::SpatialPolygons2Grob, you can exactly see what this
function wants and does with it. As a (second) legend involves not only
polygons, but also points, symbols, and text, it will not do the job.

An ad-hoc solution to this would be, building on your well-prepared
example and the code present in package sp:

mapLegendGrob2 <- function(obj, widths = unit(1, "cm"), heights =
unit(1, "cm"), fill = "black", just = "right", labels) {
    grb1 = SpatialPointsLegend(obj, fill = fill)
    grb2 = TextLegend(labels)
    key.layout <- grid.layout(nrow = 1, ncol = 1, widths = widths,
                    heights = heights, respect = TRUE, just = just)
    key.gf <- frameGrob(layout = key.layout)
#   key.gf <- placeGrob(key.gf,
#                 rectGrob(gp = gpar(fill = "transparent", col = NULL)),
#                 row = NULL, col = NULL)
    key.gf <- placeGrob(key.gf, grb1, row = 1, col = 1)
    key.gf <- placeGrob(key.gf, grb2, row = 1, col = 1)
    key.gf
}

TextLegend = function(labels, dist = 0.5) {
    x = rep(dist, length(labels))
    y = 1:length(labels)
    textGrob(labels, x, y, just = "left")
}
SpatialPointsLegend = function(pch, fill) {
    x = rep(0, length(pch))
    y = 1:length(pch)
    pointsGrob(x=x, y=y, pch=pch, gp = gpar(fill = fill))
}
spplot(spdfMeuse,
    sp.layout = list("sp.points", meuse, pch = as.integer(meuse $soil)),
    legend = list(inside = list(fun = mapLegendGrob2(1:3, fill=1:3,

    labels=c("a","b","c")), x = 1, y = 0.1, corner = c(0,0)))
)

I'm not very familiar with the functions in package grid, so there might
be lots of room for improvement. A more generic solution would be very
welcome, but this might get you somewhat further.

On 12/22/2010 05:44 AM, Lee Hachadoorian wrote:
> Trying to produce spplot with a point layer on top of a polygon layer. 
> Looks like this can be accomplished using plot() (see for example http://
> www.asdar-book.org/code.php?chapter=2&figure=7), but I want to use spplot 
> for the typical reasons (i.e, to produce several polygon maps showing 
> related attributes using the same quantitative classes).
> 
> That problem statement might be enough to point me to an example 
> somewhere, since I assume I'm not the first person who has wanted to do 
> this, but I haven't been able to find anything in the help or the 
> archives. Apologies if I'm missing something obvious.
> 
> More specifically, I would like something that looks like this figure 
> 
> http://r-spatial.sourceforge.net/gallery/#fig04.R
> 
> except instead of a north arrow, the right should have a colorkey for the 
> polygon object. Using standard data:
> 
> library(sp)
> library(lattice)
> 
> #CREATE SpatialPolygonsDataFrame OF RIVERBED
> data(meuse.riv)
> meuse.lst = list(Polygons(list(Polygon(meuse.riv)), "meusee.riv"))
> spdfMeuse = SpatialPolygonsDataFrame(
> 	SpatialPolygons(meuse.lst),
> 	data.frame(anything = 1, row.names = "meusee.riv")
> )
> 
> #CREATE SpatialPoints OF SOIL SAMPLES
> data(meuse)
> coordinates(meuse) = c("x", "y")
> 
> #THIS PLOTS POLYGONS AND POINTS WITH A colorkey FOR THE POLYGONS
> spplot(spdfMeuse,
> 	sp.layout = list("sp.points", meuse, pch = as.integer(meuse$soil))
> )
> 
> #THIS PLOTS POLYGONS AND POINTS WITH A LEGEND FOR THE POINTS
> spplot(meuse, "soil", 
> 	key.space = list(x = 0.1, y = 0.93, corner = c(0,1)),
> 	sp.layout = list("sp.polygons", spdfMeuse, fill = "lightblue")
> )
> 
> So I can combine both layers, but I haven't been able to figure out how 
> to get both legends. Figure 4 from the R-spatial gallery (referenced 
> above) uses the legend argument to add a North arrow. Since xyplot() 
> specifies that the legend argument is necessary to produce multiple keys, 
> I'm assuming the answer must make use of it. But trying to adapt the code 
> for Figure 4 as:
> 
> spplot(spdfMeuse,
> 	sp.layout = list("sp.points", meuse, pch = as.integer(meuse
> $soil)),
> 	legend = list(inside = list(fun = mapLegendGrob(meuse, "soil"), x 
> = 1, y = 0.1, corner = c(0,0)))
> )
> 
> yields:
> 
> Error in SpatialPolygons2Grob(obj, fill) : 
>   object is not of class SpatialPolygons
> Calls: spplot ... .local -> append -> mapLegendGrob -> 
> SpatialPolygons2Grob
> 
> sessionInfo() below the sig.
> 
> Regards, 
> Lee Hachadoorian
> PhD Student, Geography
> Program in Earth & Environmental Sciences
> CUNY Graduate Center
> 
>> sessionInfo()
> R version 2.12.1 (2010-12-16)
> Platform: x86_64-pc-linux-gnu (64-bit)
> 
> locale:
>  [1] LC_CTYPE=en_US.utf8          LC_NUMERIC=C                
>  [3] LC_TIME=en_US.utf8           LC_COLLATE=en_US.utf8       
>  [5] LC_MONETARY=en_US.utf8       LC_MESSAGES=en_US.utf8      
>  [7] LC_PAPER=en_US.utf8          LC_NAME=en_US.utf8          
>  [9] LC_ADDRESS=en_US.utf8        LC_TELEPHONE=en_US.utf8     
> [11] LC_MEASUREMENT=en_US.utf8    LC_IDENTIFICATION=en_US.utf8
> 
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base     
> 
> other attached packages:
> [1] lattice_0.19-13    RColorBrewer_1.0-2 RSQLite_0.9-2      
> sp_0.9-66         
> [5] RPostgreSQL_0.1-6  DBI_0.2-5          rkward_0.5.4      
> 
> loaded via a namespace (and not attached):
> [1] grid_2.12.1  tools_2.12.1
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From christian.kamenik at giub.unibe.ch  Wed Dec 22 12:06:51 2010
From: christian.kamenik at giub.unibe.ch (Christian Kamenik)
Date: Wed, 22 Dec 2010 12:06:51 +0100
Subject: [R-sig-Geo] Converting array into raster brick
In-Reply-To: <AANLkTikwhkDRTKM0PnjV-xt395OhD_gYx65a=hAXWHXe@mail.gmail.com>
References: <20101216212615.14013deot59etvc7@mail.unibe.ch>	<AANLkTi=hC_CsXPsszhF5z0hxxMSV4sKv5X+3wjnP_sGT@mail.gmail.com>	<AANLkTi=5+xjc=cK_xzj7G_gUuX+94fLk5JNDE=YQWNBk@mail.gmail.com>	<AANLkTikFt3eJHSpjB9ssMODU5P1kK5x5DVxugoVA=inf@mail.gmail.com>
	<AANLkTikwhkDRTKM0PnjV-xt395OhD_gYx65a=hAXWHXe@mail.gmail.com>
Message-ID: <4D11DBCB.80604@giub.unibe.ch>

Dear all,

I replaced my layer-by-layer approach

for (l in 1:nlayers(x)) x
<-setValues(x,values=as.vector(t(xx[,,l])),layer=l)

with the new functionality of brick

out <- 
brick(xx,xmn=slot(extent(x),'xmin'),xmx=slot(extent(x),'xmax'),ymn=slot(extent(x),'ymin'),ymx=slot(extent(x),'ymax'),crs=projection(x))

where x is the original RasterBrick, xx is a three-dimensional array and 
out is the new RasterBrick.

It worked perfectly fine!

Many thanks, Christian

> updated function, without redundant  sapply. R
>
> library(raster)
> # new method, included in raster 1.7-17
> setMethod('brick', signature(x='array'),
>         function(x, xmn=0, xmx=1, ymn=0, ymx=1, crs=NA) {
>                 dm<- dim(x)
>                 if (length(dm) != 3) {
>                         stop('array has wrong dimensions')
>                 }
>                 b<- brick(xmn=xmn, xmx=xmx, ymn=ymn, ymx=ymx, crs=crs)
>                 dim(b)<- dm
>                 setValues(b, matrix(as.vector(x), ncol=dm[3]))
>         }
> )
>
> On Sun, Dec 19, 2010 at 8:06 AM, Robert J. Hijmans<r.hijmans at gmail.com>  wrote:
>> Agus,
>>
>> I have added an new method for 'brick', included below
>>
>> library(raster)
>> # new method, included in raster 1.7-17
>> setMethod('brick', signature(x='array'),
>>         function(x, xmn=0, xmx=1, ymn=0, ymx=1, crs=NA) {
>>                 dm<- dim(x)
>>                 if (length(dm) != 3) {
>>                         stop('array has wrong dimensions')
>>                 }
>>                 b<- brick(xmn=xmn, xmx=xmx, ymn=ymn, ymx=ymx, crs=crs)
>>                 dim(b)<- dm
>>                 setValues(b, matrix(sapply(x, as.vector), ncol=dm[3]))
>>         }
>> )
>>
>> r = raster(nrow=5, ncol=5)
>> r[] = 1:25
>> s = stack(r,r*2,r*3)
>>
>> a = as.array(s)
>> b = brick(a)
>> # values of b are the same as those of a
>> sum(getValues(s) != getValues(b))
>>
>> Best, Robert
>> On Sun, Dec 19, 2010 at 3:20 AM, Agustin Lobo<alobolistas at gmail.com>  wrote:
>>> Robert,
>>>
>>> Converting from a regular 3D array to brick is probably going to be
>>> quite a  common operation,
>>> perhaps you could consider a simpler syntax in the future, i,e:
>>>
>>> r = as.brick(x)
>>>
>>> where x would be a 3D array?
>>>
>>> Agus
>>>
>>> 2010/12/16 Robert J. Hijmans<r.hijmans at gmail.com>:
>>>> Christian,
>>>>
>>>> Could be quicker if you make a matrix out of the array (or, if
>>>> possible, avoid the array in the first place). See below
>>>>
>>>> library(raster)
>>>>
>>>> # create an array
>>>> m<- matrix(1:100, ncol=10, byrow=TRUE)
>>>> a<- array(list(m, m, m, m, m))
>>>>
>>>> # empty RasterBrick
>>>> x<- brick(ncol=10, nrow=10)
>>>>
>>>> # make matrix from array
>>>> v<- sapply(a, function(x) as.vector(t(x)))
>>>>
>>>> x<- setValues(x, v)
>>>> plot(x)
>>>>
>>>>
>>>> Best, Robert
>>>>
>>>> On Thu, Dec 16, 2010 at 12:26 PM,<christian.kamenik at giub.unibe.ch>  wrote:
>>>>> Dear all,
>>>>>
>>>>> I needed to convert an array into a RasterBrick object. The output did not
>>>>> need to be written to memory, as assessed by canProcessInMemory(). The only
>>>>> way to put the data into the RasterBrick that worked for me was layer by
>>>>> layer:
>>>>>
>>>>> for (l in 1:nlayers(x)) x
>>>>> <-setValues(x,values=as.vector(t(xx[,,l])),layer=l)
>>>>>
>>>>> This was quite complicated and slow. So I am wondering if there is a better
>>>>> way of doing this.
>>>>>
>>>>> Many thanks, Christian
>>>>>
>>>>> _______________________________________________
>>>>> R-sig-Geo mailing list
>>>>> R-sig-Geo at r-project.org
>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at r-project.org
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>


-- 
-----------------------------------------------
Oeschger Centre for Climate Change Research, Institute of Geography&  Institute of Plant Sciences
University of Bern

http://www.stomatocysts.unibe.ch/kamenik
mailto: christian.kamenik at giub.unibe.ch

Postal address:
Dr. Christian Kamenik
Institute of Geography
Erlachstrasse 9a, Trakt 3
3012 Bern, Switzerland

Tel. +41 (0)31 631 5091
Fax +41 (0)31 631 43 38


From Roger.Bivand at nhh.no  Wed Dec 22 13:16:55 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 22 Dec 2010 13:16:55 +0100 (CET)
Subject: [R-sig-Geo] spatial clusters
In-Reply-To: <46b879577c06b22cda658caecae9fc5c@econ.ubbcluj.ro>
References: <eef95d9fa8d1c8a6350635788deab411@econ.ubbcluj.ro>
	<alpine.LRH.2.00.1012210919580.19187@reclus.nhh.no>
	<46b879577c06b22cda658caecae9fc5c@econ.ubbcluj.ro>
Message-ID: <alpine.LRH.2.00.1012221312280.23637@reclus.nhh.no>

On Wed, 22 Dec 2010, dorina.lazar wrote:

>
> Dear Roger,
>
> Thanks, your suggestions was helpful. I think I exaggerated the questions,
> but for all countries:  ?Error in mstree(le, 5): Graph is not
> connected!?; taking only some samples of countries the graph is
> connected. There is something to be done in this case?

If I understand the approach used in SKATER correctly, there may only be 
one graph component, linking all the observations; check with:

n.comp.nb(nb)$nc

which I think must be 1. Otherwise it will not be able to divide the 
(single) graph into clusters, because the input object imposes its own 
subgraphs. Make sure that your samples meet the condition that:

n.comp.nb(nb)$nc == 1

Roger

>
> All the best,
> Dorina
>
>
>
> On Tue, 21 Dec 2010 09:40:35 +0100 (CET), Roger Bivand
> <Roger.Bivand at nhh.no> wrote:
>> On Mon, 20 Dec 2010, dorina.lazar wrote:
>>
>>>
>>> Dear all,
>>>
>>> Finally, with your help, I make some progress to apply SKATER algorithm
>>> to
>>> European countries.
>>>
>>> Here is the R code, following the example from  spdep package pdf:
>>>
>>>> country<-wrld_simpl[wrld_simpl$ISO3%in%c("AZE", "ALB", "ARM", "BIH",
>>> "BGR", "CYP", "DNK", "IRL", "EST", "AUT", "CZE", "FIN",  "FRA", "GEO",
>>> "DEU", "GRC", "HRV", "HUN", "ISL", "ITA", "LVA", "BLR", "LTU", "SVK",
>>> "LIE", "MLT", "BEL", "AND",  "LUX", "MCO", "NLD", "NOR", "POL", "PRT",
>>> "ROU", "MDA", "RUS", "SVN"),]
>>>> ske<-spCbind(country, rclasif)
>>>> ske at data
>>>> de <- data.frame(scale(ske at data[13]))   #col 13 contains the health
>>> indicator (from rclasif)
>>>> nbe <- poly2nb(country)
>>>> ce <- nbcosts(nbe, de)
>>>> le <- nb2listw(nbe, ce, style="B", zero.policy=TRUE)
>>> Error in nb2listw(nbe, ce, style = "B", zero.policy = TRUE) :
>>> neighbours and glist do not conform
>>
>> Using your corrected list of countries, I see two/three problems:
>>
>> 1) some proximate polygons do not touch because of line generalisation
> in
>> the simplification of the country polygons, use:
>>
>> nbe <- poly2nb(country, snap=0.1)
>>
>> to force neighbours to touch.
>>
>> 2) you are left with three real islands - Iceland, Cyprus, and Malta. To
>
>> join them in, consider:
>>
>> knn4 <- knn2nb(knearneigh(crds, 4, longlat=TRUE),
>>    row.names=row.names(country))
>> knn4s <- make.sym.nb(knn4)
>> nbe1 <- union.nb(nbe, knn4s)
>>
>> 3) nbcosts() does not like single-column data frames, as it is supposed
> to
>> be for multivariate data, so:
>>
>> de <- data.frame(rnorm(46))
>> ce <- nbcosts(nbe1, de)
>> which(sapply(ce, function(x) isTRUE(any(is.na(x)))))
>>
>> gives an NA at the end of each line of cost distances, but:
>>
>> de <- data.frame(rnorm(46), rnorm(46))
>> ce <- nbcosts(nbe1, de)
>> which(sapply(ce, function(x) isTRUE(any(is.na(x)))))
>> le <- nb2listw(nbe1, ce, style="B")
>>
>> doesn't, nor does:
>>
>> de <- data.frame(rnorm(46), rep(1, 46))
>> ce <- nbcosts(nbe1, de)
>> which(sapply(ce, function(x) isTRUE(any(is.na(x)))))
>> le <- nb2listw(nbe1, ce, style="B")
>>
>> From there,
>>
>> mst.bh <- mstree(le,5)
>> res1 <- skater(mst.bh[,1:2], de, 2)
>> plot(country, col=heat.colors(3)[res1$groups])
>>
>> seem to work.
>>
>> I think that it makes sense for nbcosts() to fail for non-connected
>> observations, but perhaps it should explain why.
>>
>> Hope this helps,
>>
>> Roger
>>
>>
>>>
>>> I mention that:
>>> -	at "nbe", appears the message:  6 regions with no links: CYP DNK HRV
>>> ISL
>>> MLT SWE
>>> -	"ce" contain a lot of NA
>>> If you have some ideas about the cause of this Error, please help me to
>>> finalize my exercise on SKATER algoritm.
>>>
>>> Thanks a lot for your help,
>>> Dorina
>>>
>>>
>>>
>>>
>>> On Sat, 18 Dec 2010 18:42:35 +0100 (CET), Roger Bivand
>>> <Roger.Bivand at nhh.no> wrote:
>>>> On Sat, 18 Dec 2010, Roman Lu?trik wrote:
>>>>
>>>>> Perhaps you could follow the instructions from this
>>>>>
>>>
> exchange<http://r-sig-geo.2731867.n2.nabble.com/Guam-island-map-td4969467.html#a4972725>and
>>>>> see if you can extract the desired country (assuming the resolution
>>>>> suits you).
>>>>>
>>>>
>>>> I don't think that we know which countries Dorina needs, or at which
>>>> administrative level. If there are only 30 country observations, and
> the
>>>
>>>> countries are not contiguous, then the whole exercise seems
> unnecessary.
>>>
>>>> Can Dorina use the simplified world map in the maptools package:
>>>>
>>>> library(maptools)
>>>> ?wrld_simpl
>>>>
>>>> adding the data using the ISO country names? If these are countries at
>>>> some administrative division level, then maybe www.gadm.org will have
>>> what
>>>> is needed, but the countries will have to be joined together, or the
>>> whole
>>>> map subsetted. If these are say EU NUTS2 regions, then use can be made
>>> of
>>>> GISCO shapefiles from Eurostat. But we don't know what boundaries are
>>>> needed, and of course to use Skater for clustering, you need the
>>>> boundaries.
>>>>
>>>> Roger
>>>>
>>>>>
>>>>> Cheers,
>>>>> Roman
>>>>>
>>>>>
>>>>>
>>>>> On Sat, Dec 18, 2010 at 6:20 PM, Dorina Lazar <drnlazar at yahoo.com>
>>> wrote:
>>>>>
>>>>>> Georg,
>>>>>>
>>>>>> Thanks for being very patient with me.
>>>>>>
>>>>>> I have not a shapefile for countries.
>>>>>>
>>>>>> I have tried to obtain it. I have loaded a shapefile for Finland,
> GIS
>>>>>> data,
>>>>>> from
>>>>>>
>>>
> http://www.eea.europa.eu/data-and-maps/data/eea-reference-grids/zipped-shape-file-finland
>>>>>>
>>>>>> and I tried to read the file FI_1K.shp
>>>>>> Fin<- readShapePoly(system.file("etc/shapes/ FI_1K.shp",
>>>>>> package="spdep"))
>>>>>> but...
>>>>>> Error in getinfo.shape(filen) : Error opening SHP file
>>>>>>
>>>>>> How can I obtain, for each country,  the shapefile spatial polygon
> in
>>> R
>>>>>> (SpatialPolygons-DataFrame)?
>>>>>>
>>>>>> Thanks again,
>>>>>> Dorina
>>>>>>
>>>>>>
>>>>>> --- On Thu, 12/16/10, Georg Ru? <research at georgruss.de> wrote:
>>>>>>
>>>>>>> From: Georg Ru? <research at georgruss.de>
>>>>>>> Subject: Re: [R-sig-Geo] spatial clusters
>>>>>>> To: "Dorina Lazar" <dorina.lazar at econ.ubbcluj.ro>
>>>>>>> Cc: "R-sig-geo mailing list" <r-sig-geo at r-project.org>
>>>>>>> Date: Thursday, December 16, 2010, 10:41 AM
>>>>>>> On 16/12/10 09:06:33, dorina.lazar
>>>>>>> wrote:
>>>>>>>> How to create a shapefile including my data about some
>>>>>>> socio-demographic
>>>>>>>> indicators (7),  for about 30 countries around
>>>>>>> the world (to be read with
>>>>>>>> readShapePoly)?
>>>>>>>
>>>>>>> Hi Dorina,
>>>>>>>
>>>>>>> I'm not quite sure what you have and what you want.
>>>>>>>
>>>>>>> I assume that you'd like to create a shapefile such that
>>>>>>> for every country
>>>>>>> (which is represented as a polygon) there's a vector of
>>>>>>> seven attributes
>>>>>>> attached to it:
>>>>>>>
>>>>>>> country1:  attr1 attr2 attr3 attr4 attr5 attr6 attr7
>>>>>>> country2:  attr1 attr2 attr3 attr4 attr5 attr6 attr7
>>>>>>> ...
>>>>>>>
>>>>>>> Do you have your countries as spatial polygons in R
>>>>>>> (SpatialPolygons-
>>>>>>> DataFrame or similar)? If yes, you should be able to add
>>>>>>> your socio-demo-
>>>>>>> graphic indicators to this data frame (just as in normal
>>>>>>> data frames). In
>>>>>>> this way you'd join the data you have inside R.
>>>>>>>
>>>>>>> If you have the shapefile for the countries available and
>>>>>>> would like to
>>>>>>> edit this directly to add the indicators, I'd suggest using
>>>>>>> a GIS like
>>>>>>> GRASS http://grass.fbk.eu/ Afterwards, this can be easily
>>>>>>> read into R.
>>>>>>>
>>>>>>>> Would be useful to suggest some good introductory
>>>>>>> lectures in spatial
>>>>>>>> statistics (links or books).
>>>>>>>
>>>>>>> I think the following is what Roger would suggest:
>>>>>>>
>>>>>>>  author = {Bivand, Roger S. and Pebesma, Edzer J. and
>>>>>>> G?mez-Rubio, Virgilio},
>>>>>>>  title = {Applied Spatial Data Analysis with R},
>>>>>>>  series = {Use R},
>>>>>>>  publisher = {Springer},
>>>>>>>
>>>>>>> http://www.asdar-book.org/
>>>>>>> http://www.springerlink.com/content/uw07v1/
>>>>>>> (Depending on your login/institute you may have fulltext
>>>>>>> access, but the
>>>>>>> book is definitely worth buying anyway.)
>>>>>>>
>>>>>>> Regards,
>>>>>>> Georg.
>>>>>>> --
>>>>>>> Research Assistant
>>>>>>> Otto-von-Guericke-Universit?t Magdeburg
>>>>>>> research at georgruss.de
>>>>>>> http://research.georgruss.de
>>>>>>>
>>>>>>> _______________________________________________
>>>>>>> R-sig-Geo mailing list
>>>>>>> R-sig-Geo at r-project.org
>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>>>
>>>>>>
>>>>>>
>>>>>>
>>>>>>
>>>>>> _______________________________________________
>>>>>> R-sig-Geo mailing list
>>>>>> R-sig-Geo at r-project.org
>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>>
>>>>>
>>>>>
>>>>>
>>>>>
>>>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From tom.gottfried at wzw.tum.de  Wed Dec 22 13:28:51 2010
From: tom.gottfried at wzw.tum.de (Tom Gottfried)
Date: Wed, 22 Dec 2010 13:28:51 +0100
Subject: [R-sig-Geo] matrix indexing in 'for' loop?
In-Reply-To: <20101221200126.76195oiucc8gjnja@mail.msu.edu>
References: <20101221200126.76195oiucc8gjnja@mail.msu.edu>
Message-ID: <4D11EF03.8040308@wzw.tum.de>

Hi Maha,

note that factors in your example is a character vector. So y is too. And then you try to retrieve 
the values in your matrix from y...
You could put your matrices in a list and then use list-indexing in your outer loop:

ts.m.dmi <- matrix(c(1:20), 4, 5)
ts.m.soi <- matrix(c(21:40), 4, 5)
ts.m.pe <- matrix(c(21:40), 4, 5)

factors <- list(ts.m.dmi, ts.m.soi)
for (j in 0:1){
	y <- factors[[j+1]]

	for (i in 1:5){

	cor.pe.y <- cor(ts.m.pe[,2], y[,i])
	ct.tst <- cor.test(ts.m.pe[,2], y[,i])
	}
}

Tom
-- 
Technische Universit?t M?nchen
Department f?r Pflanzenwissenschaften
Lehrstuhl f?r Gr?nlandlehre
Alte Akademie 12
85350 Freising / Germany
Phone: ++49 (0)8161 715324
Fax:   ++49 (0)8161 713243
email: tom.gottfried at wzw.tum.de
http://www.wzw.tum.de/gruenland


From Maxime.Pauwels at univ-lille1.fr  Wed Dec 22 15:34:07 2010
From: Maxime.Pauwels at univ-lille1.fr (Maxime Pauwels)
Date: Wed, 22 Dec 2010 15:34:07 +0100
Subject: [R-sig-Geo] export to .asc or .grd files
In-Reply-To: <4D108DCD.60700@aol.com>
References: <4D0F8C2F.5050704@univ-lille1.fr> <4D108DCD.60700@aol.com>
Message-ID: <4D120C5F.1050901@univ-lille1.fr>

Hi Carsten,

Thanks for your help. I never used rgdal before and therefore do not 
understand what drivername is.
When I try your proposition, I ve got the following error message:

Error in .local(.Object, ...) :
         GDAL Error 6: GDALDriver::Create() ... no create method 
implemented for this format.

Where am I wrong?

best regards,

max



Le 21/12/2010 12:21, Carsten Neumann a ?crit :
>  Am 20.12.2010 18:02, schrieb Maxime Pauwels:
>> Hi list,
>>
>> I'm using the sp package to grid data. I'd now like to export the 
>> grid in either .asc or .grd files. Does anyone can give me the 
>> package and function that does it easily?
>>
>> Thanks,
>>
>> max
>>
> Hi Max,
>
> library(raster); use with function: writeRaster("raster object", 
> "name", format="ascii"); format="raster" for *.grd files
>
> library(rgdal); use with function: writeGDAL("rgdal object", 
> fname="name", drivername="AAIGrid"); use gdalDrivers() to identify 
> your preferred drivername for *.grd
>
> you certainly have to change your grid object to a raster object when 
> using raster package.
>
> All the best!
>
> Carsten
>


-- 
Maxime Pauwels
Researcher ID: http://www.researcherid.com/rid/A-1745-2009

Equipe G?n?tique&  ?volution de l'adaptation aux environnements pollu?s par les m?taux lourds
Laboratoire de G?n?tique et Evolution des Populations V?g?tales
FRE CNRS 3268
B?timent SN2
Universit? de Lille, USTL-Lille1
http://gepv.univ-lille1.fr
Tel  : +33 3 20 33 62 38
Fax  : +33 3 20 43 69 79


From Maxime.Pauwels at univ-lille1.fr  Wed Dec 22 16:15:59 2010
From: Maxime.Pauwels at univ-lille1.fr (Maxime Pauwels)
Date: Wed, 22 Dec 2010 16:15:59 +0100
Subject: [R-sig-Geo] Error in validityMethod(object) using
	SpatialGridDataFrame
Message-ID: <4D12162F.2010907@univ-lille1.fr>

Dear list,

I try to create an object of class SpatialGridDataFrame-class and got 
the following error I do not understand.
Error in validityMethod(object) :
   unequal number of objects in full grid and data slot

There is the script I use. Does anyone could help me understanding where 
I am wrong?

Many thanks

max


rgrd <- GridTopology(cellcentre.offset=c(-4.5,40), cellsize=c(0.1674757, 
0.1674757), cells.dim=c(207, 90))
summary(rgrd)
#Grid topology:
#  cellcentre.offset  cellsize cells.dim
#1              -4.5 0.1674757       207
#2              40.0 0.1674757        90
rdata<-SpatialGridDataFrame(rgrd, data=read.table("rdataNssSF.txt", 
header=T), proj4string=CRS("+proj=longlat"))
#Error in validityMethod(object) :
#  unequal number of objects in full grid and data slot
#
#
#However
data=read.table("rdataNssSF.txt")
class(data)
#[1] "data.frame"
#and
coordinates(data)=~long+lat
gridded(data)=TRUE
summary(data)
#Object of class SpatialPixelsDataFrame
#Coordinates:
#           min      max
#long -4.583738 30.08374
#lat  39.915730 55.08427
#Is projected: NA
#proj4string : [NA]
#Number of points: 15267
#Grid attributes:
#     cellcentre.offset  cellsize cells.dim
#long              -4.5 0.1674757       207
#lat               40.0 0.1685393        90
#Data attributes:
#    Min.  1st Qu.   Median     Mean  3rd Qu.     Max.
#-0.75140 -0.15700  0.01150  0.03421  0.22100  0.85000



-- 
Maxime Pauwels
Researcher ID: http://www.researcherid.com/rid/A-1745-2009

Equipe G?n?tique&  ?volution de l'adaptation aux environnements pollu?s par les m?taux lourds
Laboratoire de G?n?tique et Evolution des Populations V?g?tales
FRE CNRS 3268
B?timent SN2
Universit? de Lille, USTL-Lille1
http://gepv.univ-lille1.fr
Tel  : +33 3 20 33 62 38
Fax  : +33 3 20 43 69 79


From edzer.pebesma at uni-muenster.de  Wed Dec 22 16:15:41 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Wed, 22 Dec 2010 16:15:41 +0100
Subject: [R-sig-Geo] Error in validityMethod(object)
	using	SpatialGridDataFrame
In-Reply-To: <4D12162F.2010907@univ-lille1.fr>
References: <4D12162F.2010907@univ-lille1.fr>
Message-ID: <4D12161D.105@uni-muenster.de>



On 12/22/2010 04:15 PM, Maxime Pauwels wrote:
> Dear list,
> 
> I try to create an object of class SpatialGridDataFrame-class and got
> the following error I do not understand.
> Error in validityMethod(object) :
>   unequal number of objects in full grid and data slot
> 
> There is the script I use. Does anyone could help me understanding where
> I am wrong?
> 
> Many thanks
> 
> max
> 
> 
> rgrd <- GridTopology(cellcentre.offset=c(-4.5,40), cellsize=c(0.1674757,
> 0.1674757), cells.dim=c(207, 90))
> summary(rgrd)
> #Grid topology:
> #  cellcentre.offset  cellsize cells.dim
> #1              -4.5 0.1674757       207
> #2              40.0 0.1674757        90
> rdata<-SpatialGridDataFrame(rgrd, data=read.table("rdataNssSF.txt",
> header=T), proj4string=CRS("+proj=longlat"))
> #Error in validityMethod(object) :
> #  unequal number of objects in full grid and data slot

Maybe some of the cells have missing values, and in the current setup
the constructor function SpatialGridDataFrame cannot figure out which --
it simply expects 207 x 90 records, in a particular order.

> #
> #
> #However
> data=read.table("rdataNssSF.txt")
> class(data)
> #[1] "data.frame"
> #and
> coordinates(data)=~long+lat
> gridded(data)=TRUE

then add here:

fullgrid(data) = TRUE

> summary(data)
> #Object of class SpatialPixelsDataFrame
> #Coordinates:
> #           min      max
> #long -4.583738 30.08374
> #lat  39.915730 55.08427
> #Is projected: NA
> #proj4string : [NA]
> #Number of points: 15267
> #Grid attributes:
> #     cellcentre.offset  cellsize cells.dim
> #long              -4.5 0.1674757       207
> #lat               40.0 0.1685393        90
> #Data attributes:
> #    Min.  1st Qu.   Median     Mean  3rd Qu.     Max.
> #-0.75140 -0.15700  0.01150  0.03421  0.22100  0.85000
> 
> 
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From Lee.Hachadoorian+L at gmail.com  Wed Dec 22 16:20:29 2010
From: Lee.Hachadoorian+L at gmail.com (Lee Hachadoorian)
Date: Wed, 22 Dec 2010 10:20:29 -0500
Subject: [R-sig-Geo] Multiple legends in spplot
References: <iervnd$e6i$1@dough.gmane.org> <4D11DA9E.60108@uni-muenster.de>
Message-ID: <pan.2010.12.22.15.20.28.116000@gmail.com>

On Wed, 22 Dec 2010 12:01:50 +0100, Edzer Pebesma wrote:

> Lee,
> 
> looking at sp:::SpatialPolygons2Grob, you can exactly see what this
> function wants and does with it. As a (second) legend involves not only
> polygons, but also points, symbols, and text, it will not do the job.

Edzer,

Thank you, working on implementing this right now.

I was unsure of what was going on with the call to SpatialPolygons2Grob()
as mapLegendGrob(obj, ...) supposedly takes any object of class extending
Spatial-class. I didn't even think to check the class of
layout.north.arrow(), used in the example I was working from. I just
checked and found that it works because layout.north.arrow() is of class
SpatialPolygons!

Thanks again for your generous assistance.

--Lee

Lee Hachadoorian
PhD Student, Geography
Program in Earth & Environmental Sciences 
CUNY Graduate Center


From carstennh at aol.com  Wed Dec 22 17:15:49 2010
From: carstennh at aol.com (Carsten Neumann)
Date: Wed, 22 Dec 2010 17:15:49 +0100
Subject: [R-sig-Geo] export to .asc or .grd files
In-Reply-To: <4D120C5F.1050901@univ-lille1.fr>
References: <4D0F8C2F.5050704@univ-lille1.fr> <4D108DCD.60700@aol.com>
	<4D120C5F.1050901@univ-lille1.fr>
Message-ID: <4D122435.7080009@aol.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101222/f036df07/attachment.pl>

From carstennh at aol.com  Wed Dec 22 18:18:28 2010
From: carstennh at aol.com (Carsten Neumann)
Date: Wed, 22 Dec 2010 18:18:28 +0100
Subject: [R-sig-Geo] export to .asc or .grd files
In-Reply-To: <4D122EFD.7010504@univ-lille1.fr>
References: <4D0F8C2F.5050704@univ-lille1.fr> <4D108DCD.60700@aol.com>
	<4D120C5F.1050901@univ-lille1.fr> <4D122435.7080009@aol.com>
	<4D122EFD.7010504@univ-lille1.fr>
Message-ID: <4D1232E4.5060401@aol.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101222/33d8a2e1/attachment.pl>

From eac16 at psu.edu  Wed Dec 22 18:43:58 2010
From: eac16 at psu.edu (Elizabeth Crisfield)
Date: Wed, 22 Dec 2010 12:43:58 -0500
Subject: [R-sig-Geo]  matrix indexing in 'for' loop?
Message-ID: <AANLkTi=08EmJXAW2Y5V+cx6KWKhU0g6eFDJy3O-SUG=N@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101222/c0d20f3a/attachment.pl>

From r.hijmans at gmail.com  Wed Dec 22 18:44:54 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Wed, 22 Dec 2010 09:44:54 -0800
Subject: [R-sig-Geo] Converting array into raster brick
In-Reply-To: <4D11DBCB.80604@giub.unibe.ch>
References: <20101216212615.14013deot59etvc7@mail.unibe.ch>
	<AANLkTi=hC_CsXPsszhF5z0hxxMSV4sKv5X+3wjnP_sGT@mail.gmail.com>
	<AANLkTi=5+xjc=cK_xzj7G_gUuX+94fLk5JNDE=YQWNBk@mail.gmail.com>
	<AANLkTikFt3eJHSpjB9ssMODU5P1kK5x5DVxugoVA=inf@mail.gmail.com>
	<AANLkTikwhkDRTKM0PnjV-xt395OhD_gYx65a=hAXWHXe@mail.gmail.com>
	<4D11DBCB.80604@giub.unibe.ch>
Message-ID: <AANLkTinOR=qye2UNu1QxsDxLZX7mvsyNf29dLRFHWq1g@mail.gmail.com>

Christian,

You should also be able to do this:

out <- setValues(x, xx)

(where x is a RasterBrick and xx a matching 3 dimensional array)

Robert

On Wed, Dec 22, 2010 at 3:06 AM, Christian Kamenik
<christian.kamenik at giub.unibe.ch> wrote:
> Dear all,
>
> I replaced my layer-by-layer approach
>
> for (l in 1:nlayers(x)) x
> <-setValues(x,values=as.vector(t(xx[,,l])),layer=l)
>
> with the new functionality of brick
>
> out <-
> brick(xx,xmn=slot(extent(x),'xmin'),xmx=slot(extent(x),'xmax'),ymn=slot(extent(x),'ymin'),ymx=slot(extent(x),'ymax'),crs=projection(x))
>
> where x is the original RasterBrick, xx is a three-dimensional array and out
> is the new RasterBrick.
>
> It worked perfectly fine!
>
> Many thanks, Christian
>
>> updated function, without redundant ?sapply. R
>>
>> library(raster)
>> # new method, included in raster 1.7-17
>> setMethod('brick', signature(x='array'),
>> ? ? ? ?function(x, xmn=0, xmx=1, ymn=0, ymx=1, crs=NA) {
>> ? ? ? ? ? ? ? ?dm<- dim(x)
>> ? ? ? ? ? ? ? ?if (length(dm) != 3) {
>> ? ? ? ? ? ? ? ? ? ? ? ?stop('array has wrong dimensions')
>> ? ? ? ? ? ? ? ?}
>> ? ? ? ? ? ? ? ?b<- brick(xmn=xmn, xmx=xmx, ymn=ymn, ymx=ymx, crs=crs)
>> ? ? ? ? ? ? ? ?dim(b)<- dm
>> ? ? ? ? ? ? ? ?setValues(b, matrix(as.vector(x), ncol=dm[3]))
>> ? ? ? ?}
>> )
>>
>> On Sun, Dec 19, 2010 at 8:06 AM, Robert J. Hijmans<r.hijmans at gmail.com>
>> ?wrote:
>>>
>>> Agus,
>>>
>>> I have added an new method for 'brick', included below
>>>
>>> library(raster)
>>> # new method, included in raster 1.7-17
>>> setMethod('brick', signature(x='array'),
>>> ? ? ? ?function(x, xmn=0, xmx=1, ymn=0, ymx=1, crs=NA) {
>>> ? ? ? ? ? ? ? ?dm<- dim(x)
>>> ? ? ? ? ? ? ? ?if (length(dm) != 3) {
>>> ? ? ? ? ? ? ? ? ? ? ? ?stop('array has wrong dimensions')
>>> ? ? ? ? ? ? ? ?}
>>> ? ? ? ? ? ? ? ?b<- brick(xmn=xmn, xmx=xmx, ymn=ymn, ymx=ymx, crs=crs)
>>> ? ? ? ? ? ? ? ?dim(b)<- dm
>>> ? ? ? ? ? ? ? ?setValues(b, matrix(sapply(x, as.vector), ncol=dm[3]))
>>> ? ? ? ?}
>>> )
>>>
>>> r = raster(nrow=5, ncol=5)
>>> r[] = 1:25
>>> s = stack(r,r*2,r*3)
>>>
>>> a = as.array(s)
>>> b = brick(a)
>>> # values of b are the same as those of a
>>> sum(getValues(s) != getValues(b))
>>>
>>> Best, Robert
>>> On Sun, Dec 19, 2010 at 3:20 AM, Agustin Lobo<alobolistas at gmail.com>
>>> ?wrote:
>>>>
>>>> Robert,
>>>>
>>>> Converting from a regular 3D array to brick is probably going to be
>>>> quite a ?common operation,
>>>> perhaps you could consider a simpler syntax in the future, i,e:
>>>>
>>>> r = as.brick(x)
>>>>
>>>> where x would be a 3D array?
>>>>
>>>> Agus
>>>>
>>>> 2010/12/16 Robert J. Hijmans<r.hijmans at gmail.com>:
>>>>>
>>>>> Christian,
>>>>>
>>>>> Could be quicker if you make a matrix out of the array (or, if
>>>>> possible, avoid the array in the first place). See below
>>>>>
>>>>> library(raster)
>>>>>
>>>>> # create an array
>>>>> m<- matrix(1:100, ncol=10, byrow=TRUE)
>>>>> a<- array(list(m, m, m, m, m))
>>>>>
>>>>> # empty RasterBrick
>>>>> x<- brick(ncol=10, nrow=10)
>>>>>
>>>>> # make matrix from array
>>>>> v<- sapply(a, function(x) as.vector(t(x)))
>>>>>
>>>>> x<- setValues(x, v)
>>>>> plot(x)
>>>>>
>>>>>
>>>>> Best, Robert
>>>>>
>>>>> On Thu, Dec 16, 2010 at 12:26 PM,<christian.kamenik at giub.unibe.ch>
>>>>> ?wrote:
>>>>>>
>>>>>> Dear all,
>>>>>>
>>>>>> I needed to convert an array into a RasterBrick object. The output did
>>>>>> not
>>>>>> need to be written to memory, as assessed by canProcessInMemory(). The
>>>>>> only
>>>>>> way to put the data into the RasterBrick that worked for me was layer
>>>>>> by
>>>>>> layer:
>>>>>>
>>>>>> for (l in 1:nlayers(x)) x
>>>>>> <-setValues(x,values=as.vector(t(xx[,,l])),layer=l)
>>>>>>
>>>>>> This was quite complicated and slow. So I am wondering if there is a
>>>>>> better
>>>>>> way of doing this.
>>>>>>
>>>>>> Many thanks, Christian
>>>>>>
>>>>>> _______________________________________________
>>>>>> R-sig-Geo mailing list
>>>>>> R-sig-Geo at r-project.org
>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>>
>>>>> _______________________________________________
>>>>> R-sig-Geo mailing list
>>>>> R-sig-Geo at r-project.org
>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>
>
>
> --
> -----------------------------------------------
> Oeschger Centre for Climate Change Research, Institute of Geography&
> ?Institute of Plant Sciences
> University of Bern
>
> http://www.stomatocysts.unibe.ch/kamenik
> mailto: christian.kamenik at giub.unibe.ch
>
> Postal address:
> Dr. Christian Kamenik
> Institute of Geography
> Erlachstrasse 9a, Trakt 3
> 3012 Bern, Switzerland
>
> Tel. +41 (0)31 631 5091
> Fax +41 (0)31 631 43 38
>
>


From advaitgodbole at gmail.com  Wed Dec 22 19:39:50 2010
From: advaitgodbole at gmail.com (Advait Godbole)
Date: Wed, 22 Dec 2010 13:39:50 -0500
Subject: [R-sig-Geo] gridded time series analysis
In-Reply-To: <AANLkTikmm6QvAC69cPG7i4bT6wmWVBfwpO-4mHZ7JEvL@mail.gmail.com>
References: <AANLkTimTdxzoDCfJQOB8bgQRhjLy3YzSbtGtMdijk9sQ@mail.gmail.com>
	<771411.8321.qm@web29709.mail.ird.yahoo.com>
	<AANLkTin2DYocWNOAR-LfGoBP4+gCtA7eVDHmoaQ6wriR@mail.gmail.com>
	<AANLkTimFw1zMH75s+TG+SFkBHfXzpURm2WXskAa8Kp=m@mail.gmail.com>
	<AANLkTim9dBnVkZ0tjvoa1YRpPRr156jJ9zcezMDrtzhX@mail.gmail.com>
	<AANLkTi=vW6NXYXKGNa0gcTfZ8ezEjvegdxU3Dt5SPA4F@mail.gmail.com>
	<AANLkTikqNmC62Pv-n9Dxd1w7fTHJPx8cR72U6YEtWMTV@mail.gmail.com>
	<AANLkTikQsL9opzu1i0mWxtJA6YmcgBbGdbihXFOwPRho@mail.gmail.com>
	<AANLkTinY5+3JbpZfWnriDZNOdmcfic0628Qi0=NDZghK@mail.gmail.com>
	<AANLkTikd-PJKWZdWUL2+S9VYAq1QJ4LPwG2==erEs2+Q@mail.gmail.com>
	<AANLkTi=eZL0Rq5EyoRA29fdnN2VL-Xt6hcGN4DnZgCKk@mail.gmail.com>
	<AANLkTikVto4GD=vO=5YKwKXL7y+Ze4ADn2KXpsw1AFVA@mail.gmail.com>
	<AANLkTinUvhmDLP2YSWuqb5=G0YKX=sWp6yMOj9KPAgdA@mail.gmail.com>
	<AANLkTi=P5HNFjEsaapUBF7vSAFAsekU_4bYJqXnW=gbu@mail.gmail.com>
	<AANLkTikwWainpBBeSr8xnNNq8uoFXdU2n_34y2-u6K5J@mail.gmail.com>
	<AANLkTin5-hV=b8yxQnvviF_4w-uPfsSJ9X82pmbi=WQo@mail.gmail.com>
	<AANLkTikmPMvBRuu6RvjXsd8LdJc38FP+tAiF9iAc31Ks@mail.gmail.com>
	<AANLkTikSowU_SFiCmZyE3TKEa_UesH_SDQdPP63i+ERY@mail.gmail.com>
	<AANLkTi=p+LbmQ96GSJFuYyw-HLcCxJgYqaK4n2pBZcbG@mail.gmail.com>
	<AANLkTinvp-k47MHyV2s+hje_P0VXHvTmOKPFf8q5btAO@mail.gmail.com>
	<AANLkTi=S8tY50xzS2PFS7LvUEMT4cb4TFME-kT7DkmS0@mail.gmail.com>
	<AANLkTims2FyRBiLdmtZzR8wwvrBSyMuepVe0_Li-B6nU@mail.gmail.com>
	<AANLkTinzLPLDhoLwpcRkJ4twJ+FFd=ukOYpHh220S2mE@mail.gmail.com>
	<AANLkTikmm6QvAC69cPG7i4bT6wmWVBfwpO-4mHZ7JEvL@mail.gmail.com>
Message-ID: <AANLkTikAMe3C=hQon56eh3nQd_G6gHJ=iQPh0JyJhqJ7@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101222/c3870d24/attachment.pl>

From matzke at berkeley.edu  Thu Dec 23 00:48:48 2010
From: matzke at berkeley.edu (Nick Matzke)
Date: Wed, 22 Dec 2010 15:48:48 -0800
Subject: [R-sig-Geo] Raster error
In-Reply-To: <AANLkTinOR=qye2UNu1QxsDxLZX7mvsyNf29dLRFHWq1g@mail.gmail.com>
References: <20101216212615.14013deot59etvc7@mail.unibe.ch>	<AANLkTi=hC_CsXPsszhF5z0hxxMSV4sKv5X+3wjnP_sGT@mail.gmail.com>	<AANLkTi=5+xjc=cK_xzj7G_gUuX+94fLk5JNDE=YQWNBk@mail.gmail.com>	<AANLkTikFt3eJHSpjB9ssMODU5P1kK5x5DVxugoVA=inf@mail.gmail.com>	<AANLkTikwhkDRTKM0PnjV-xt395OhD_gYx65a=hAXWHXe@mail.gmail.com>	<4D11DBCB.80604@giub.unibe.ch>
	<AANLkTinOR=qye2UNu1QxsDxLZX7mvsyNf29dLRFHWq1g@mail.gmail.com>
Message-ID: <4D128E60.3080109@berkeley.edu>

Hi all,

I've been beginning to use the raster package and it looks 
great.  But, any idea why I might be getting these errors?


1.
============
library(raster)

# Set working directory (you will need to change this)
directory = 
"/Users/nick/Desktop/__projects/2010-09_Erin_Meyer_snails/_imgs/"
setwd(directory)


fn = "clip_1.img"

r1 = raster(fn, band=1)
attr(r1, "data")@haveminmax = TRUE

r2 = raster(fn, band=2)
attr(r2, "data")@haveminmax = TRUE

r3 = raster(fn, band=3)
attr(r3, "data")@haveminmax = TRUE

r4 = raster(fn, band=4)
attr(r4, "data")@haveminmax = TRUE

r5 = raster(fn, band=5)
attr(r5, "data")@haveminmax = TRUE

r6 = raster(fn, band=6)
attr(r6, "data")@haveminmax = TRUE

s = stack(r1)
s = addLayer(s, c(r2, r3, r4, r5, r6))
r = raster(s)
plotRGB(s, r=4, g=3, b=2)
============

Gives:
============
Error in rgb(getValues(r), getValues(g), getValues(b), max = 
scale) :
   color intensity -2147483648, not in 0:255
============






2.
===========
plotRGB(r, r=4, g=3, b=2, scale=255)
===========

Gives:
=========
Error in function (classes, fdef, mtable)  :
   unable to find an inherited method for function 
"plotRGB", for signature "RasterLayer"
===========

...even though r is a RasterLayer object and the plotRGB 
help says it takes RasterLayer objects.





3.
==========
b = brick(fn)
plotRGB(b, r=4, g=3, b=2, scale=255)
==========


Gives:
==========
Error in rgb(getValues(r), getValues(g), getValues(b), max = 
scale) :
   color intensity -2147483648, not in 0:255
==========



Background:

All I have in the directory is:
==========
clip_1.rrd
clip_1.img
==========

...which were clipped out of a Landsat 7 image in ERDAS.


Properties for s, r, and b:

s
========
 > s
class       : RasterStack
filename    :
nlayers     : 6
nrow        : 666
ncol        : 996
ncell       : 663336
projection  : +proj=utm +zone=20 +ellps=WGS84 +datum=WGS84 
+units=m +no_defs +towgs84=0,0,0
min value   : 34 21 1 1 1 1
max value   : 255 255 255 255 255 254
xmin        : 319425
xmax        : 349305
ymin        : 3566415
ymax        : 3586395
xres        : 30
yres        : 30
========


r
========
class       : RasterLayer
filename    :
nrow        : 666
ncol        : 996
ncell       : 663336
min value   :
max value   :
projection  : +proj=utm +zone=20 +ellps=WGS84 +datum=WGS84 
+units=m +no_defs +towgs84=0,0,0
xmin        : 319425
xmax        : 349305
ymin        : 3566415
ymax        : 3586395
xres        : 30
yres        : 30
========



b
========
class       : RasterBrick
filename    : 
/Users/nick/Desktop/__projects/2010-09_Erin_Meyer_snails/_imgs/clip_1.img 

nlayers     : 6
nrow        : 666
ncol        : 996
ncell       : 663336
projection  : +proj=utm +zone=20 +ellps=WGS84 +datum=WGS84 
+units=m +no_defs +towgs84=0,0,0
min value   : 34 21 1 1 1 1
max value   : 255 255 255 255 255 254
xmin        : 319425
xmax        : 349305
ymin        : 3566415
ymax        : 3586395
xres        : 30
yres        : 30
========


Any help much appreciated!!
Thanks, Nick


From r.hijmans at gmail.com  Thu Dec 23 01:24:11 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Wed, 22 Dec 2010 16:24:11 -0800
Subject: [R-sig-Geo] Raster error
In-Reply-To: <4D128E60.3080109@berkeley.edu>
References: <20101216212615.14013deot59etvc7@mail.unibe.ch>
	<AANLkTi=hC_CsXPsszhF5z0hxxMSV4sKv5X+3wjnP_sGT@mail.gmail.com>
	<AANLkTi=5+xjc=cK_xzj7G_gUuX+94fLk5JNDE=YQWNBk@mail.gmail.com>
	<AANLkTikFt3eJHSpjB9ssMODU5P1kK5x5DVxugoVA=inf@mail.gmail.com>
	<AANLkTikwhkDRTKM0PnjV-xt395OhD_gYx65a=hAXWHXe@mail.gmail.com>
	<4D11DBCB.80604@giub.unibe.ch>
	<AANLkTinOR=qye2UNu1QxsDxLZX7mvsyNf29dLRFHWq1g@mail.gmail.com>
	<4D128E60.3080109@berkeley.edu>
Message-ID: <AANLkTincnHC60UBsW074VnbJzYBNGkX+69tL7XJnfEV+@mail.gmail.com>

Hi Nick,

Could you first update the raster package? It seems that you are using
a relatively old version; perhaps this is something that has been
fixed now. But who knows? List members, please supply the results of
"sessionInfo()" whenever you report something that might be a bug.

You should be able to do this:

fn <- "clip_1.img"
s <- stack(fn)
# or better: s <- brick(fn)
plotRGB(b, r=4, g=3, b=2)


If this does not solve it... The error message smells like it is
caused by a NA flag that is not recognized as such. Have you looked
at, e.g.,
plot(s, 1)

b <- brick(fn)
NAvalue(b) <- -2147483647
plotRGB(b, r=4, g=3, b=2)

If that does not work, could you then give me access to the file?

All the best, Robert


On Wed, Dec 22, 2010 at 3:48 PM, Nick Matzke <matzke at berkeley.edu> wrote:
> Hi all,
>
> I've been beginning to use the raster package and it looks great. ?But, any
> idea why I might be getting these errors?
>
>
> 1.
> ============
> library(raster)
>
> # Set working directory (you will need to change this)
> directory =
> "/Users/nick/Desktop/__projects/2010-09_Erin_Meyer_snails/_imgs/"
> setwd(directory)
>
>
> fn = "clip_1.img"
>
> r1 = raster(fn, band=1)
> attr(r1, "data")@haveminmax = TRUE
>
> r2 = raster(fn, band=2)
> attr(r2, "data")@haveminmax = TRUE
>
> r3 = raster(fn, band=3)
> attr(r3, "data")@haveminmax = TRUE
>
> r4 = raster(fn, band=4)
> attr(r4, "data")@haveminmax = TRUE
>
> r5 = raster(fn, band=5)
> attr(r5, "data")@haveminmax = TRUE
>
> r6 = raster(fn, band=6)
> attr(r6, "data")@haveminmax = TRUE
>
> s = stack(r1)
> s = addLayer(s, c(r2, r3, r4, r5, r6))
> r = raster(s)
> plotRGB(s, r=4, g=3, b=2)
> ============
>
> Gives:
> ============
> Error in rgb(getValues(r), getValues(g), getValues(b), max = scale) :
> ?color intensity -2147483648, not in 0:255
> ============
>
>
>
>
>
>
> 2.
> ===========
> plotRGB(r, r=4, g=3, b=2, scale=255)
> ===========
>
> Gives:
> =========
> Error in function (classes, fdef, mtable) ?:
> ?unable to find an inherited method for function "plotRGB", for signature
> "RasterLayer"
> ===========
>
> ...even though r is a RasterLayer object and the plotRGB help says it takes
> RasterLayer objects.
>
>
>
>
>
> 3.
> ==========
> b = brick(fn)
> plotRGB(b, r=4, g=3, b=2, scale=255)
> ==========
>
>
> Gives:
> ==========
> Error in rgb(getValues(r), getValues(g), getValues(b), max = scale) :
> ?color intensity -2147483648, not in 0:255
> ==========
>
>
>
> Background:
>
> All I have in the directory is:
> ==========
> clip_1.rrd
> clip_1.img
> ==========
>
> ...which were clipped out of a Landsat 7 image in ERDAS.
>
>
> Properties for s, r, and b:
>
> s
> ========
>> s
> class ? ? ? : RasterStack
> filename ? ?:
> nlayers ? ? : 6
> nrow ? ? ? ?: 666
> ncol ? ? ? ?: 996
> ncell ? ? ? : 663336
> projection ?: +proj=utm +zone=20 +ellps=WGS84 +datum=WGS84 +units=m +no_defs
> +towgs84=0,0,0
> min value ? : 34 21 1 1 1 1
> max value ? : 255 255 255 255 255 254
> xmin ? ? ? ?: 319425
> xmax ? ? ? ?: 349305
> ymin ? ? ? ?: 3566415
> ymax ? ? ? ?: 3586395
> xres ? ? ? ?: 30
> yres ? ? ? ?: 30
> ========
>
>
> r
> ========
> class ? ? ? : RasterLayer
> filename ? ?:
> nrow ? ? ? ?: 666
> ncol ? ? ? ?: 996
> ncell ? ? ? : 663336
> min value ? :
> max value ? :
> projection ?: +proj=utm +zone=20 +ellps=WGS84 +datum=WGS84 +units=m +no_defs
> +towgs84=0,0,0
> xmin ? ? ? ?: 319425
> xmax ? ? ? ?: 349305
> ymin ? ? ? ?: 3566415
> ymax ? ? ? ?: 3586395
> xres ? ? ? ?: 30
> yres ? ? ? ?: 30
> ========
>
>
>
> b
> ========
> class ? ? ? : RasterBrick
> filename ? ?:
> /Users/nick/Desktop/__projects/2010-09_Erin_Meyer_snails/_imgs/clip_1.img
> nlayers ? ? : 6
> nrow ? ? ? ?: 666
> ncol ? ? ? ?: 996
> ncell ? ? ? : 663336
> projection ?: +proj=utm +zone=20 +ellps=WGS84 +datum=WGS84 +units=m +no_defs
> +towgs84=0,0,0
> min value ? : 34 21 1 1 1 1
> max value ? : 255 255 255 255 255 254
> xmin ? ? ? ?: 319425
> xmax ? ? ? ?: 349305
> ymin ? ? ? ?: 3566415
> ymax ? ? ? ?: 3586395
> xres ? ? ? ?: 30
> yres ? ? ? ?: 30
> ========
>
>
> Any help much appreciated!!
> Thanks, Nick
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From r.hijmans at gmail.com  Thu Dec 23 01:26:37 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Wed, 22 Dec 2010 16:26:37 -0800
Subject: [R-sig-Geo] gridded time series analysis
In-Reply-To: <AANLkTikAMe3C=hQon56eh3nQd_G6gHJ=iQPh0JyJhqJ7@mail.gmail.com>
References: <AANLkTimTdxzoDCfJQOB8bgQRhjLy3YzSbtGtMdijk9sQ@mail.gmail.com>
	<771411.8321.qm@web29709.mail.ird.yahoo.com>
	<AANLkTin2DYocWNOAR-LfGoBP4+gCtA7eVDHmoaQ6wriR@mail.gmail.com>
	<AANLkTimFw1zMH75s+TG+SFkBHfXzpURm2WXskAa8Kp=m@mail.gmail.com>
	<AANLkTim9dBnVkZ0tjvoa1YRpPRr156jJ9zcezMDrtzhX@mail.gmail.com>
	<AANLkTi=vW6NXYXKGNa0gcTfZ8ezEjvegdxU3Dt5SPA4F@mail.gmail.com>
	<AANLkTikqNmC62Pv-n9Dxd1w7fTHJPx8cR72U6YEtWMTV@mail.gmail.com>
	<AANLkTikQsL9opzu1i0mWxtJA6YmcgBbGdbihXFOwPRho@mail.gmail.com>
	<AANLkTinY5+3JbpZfWnriDZNOdmcfic0628Qi0=NDZghK@mail.gmail.com>
	<AANLkTikd-PJKWZdWUL2+S9VYAq1QJ4LPwG2==erEs2+Q@mail.gmail.com>
	<AANLkTi=eZL0Rq5EyoRA29fdnN2VL-Xt6hcGN4DnZgCKk@mail.gmail.com>
	<AANLkTikVto4GD=vO=5YKwKXL7y+Ze4ADn2KXpsw1AFVA@mail.gmail.com>
	<AANLkTinUvhmDLP2YSWuqb5=G0YKX=sWp6yMOj9KPAgdA@mail.gmail.com>
	<AANLkTi=P5HNFjEsaapUBF7vSAFAsekU_4bYJqXnW=gbu@mail.gmail.com>
	<AANLkTikwWainpBBeSr8xnNNq8uoFXdU2n_34y2-u6K5J@mail.gmail.com>
	<AANLkTin5-hV=b8yxQnvviF_4w-uPfsSJ9X82pmbi=WQo@mail.gmail.com>
	<AANLkTikmPMvBRuu6RvjXsd8LdJc38FP+tAiF9iAc31Ks@mail.gmail.com>
	<AANLkTikSowU_SFiCmZyE3TKEa_UesH_SDQdPP63i+ERY@mail.gmail.com>
	<AANLkTi=p+LbmQ96GSJFuYyw-HLcCxJgYqaK4n2pBZcbG@mail.gmail.com>
	<AANLkTinvp-k47MHyV2s+hje_P0VXHvTmOKPFf8q5btAO@mail.gmail.com>
	<AANLkTi=S8tY50xzS2PFS7LvUEMT4cb4TFME-kT7DkmS0@mail.gmail.com>
	<AANLkTims2FyRBiLdmtZzR8wwvrBSyMuepVe0_Li-B6nU@mail.gmail.com>
	<AANLkTinzLPLDhoLwpcRkJ4twJ+FFd=ukOYpHh220S2mE@mail.gmail.com>
	<AANLkTikmm6QvAC69cPG7i4bT6wmWVBfwpO-4mHZ7JEvL@mail.gmail.com>
	<AANLkTikAMe3C=hQon56eh3nQd_G6gHJ=iQPh0JyJhqJ7@mail.gmail.com>
Message-ID: <AANLkTikrWWOzicMeLk4sEP_y9Dfo7fZk1gUmC5-6HRd5@mail.gmail.com>

Advait,

When asking for help, please provide a self-contained example whenever
possible, as below.

library(raster)
v1 <- matrix(rep(1:12, 16), nrow=16)
v2 <- matrix(rep(1:12, 16), nrow=16, byrow=TRUE)
b <- brick(ncol=4, nrow=4)
b1 <- setValues(b, v1)
b2 <- setValues(b, v2)
s <- stack(b1, b2)

fun <- function(x) {
    resp = x[1:12]
    expl = x[13:24]
    mdl = lm(resp ~ expl)
    res = c(mdl$coef[1] , mdl$coef[2])
    return(res)
}

# now do:
b2 <- calc(s, fun)

# as an alternative to the above you could do
# but I would not recommend this

datCoef = apply(getValues(s), 1, fun2)
b1 <- setValues(s, t(datCoef))

# I think you were complicating matters with plyr.
# But to get those values in a brick you could do something like
b1 <- setValues(s, as.matrix(datCoef)[,3:4])
# But I am not sure if you would get the values in the correct cells
# (the number matches, but perhaps not the order).

Best, Robert



On Wed, Dec 22, 2010 at 10:39 AM, Advait Godbole
<advaitgodbole at gmail.com> wrote:
> Dear Members,
> I was able to find a solution after some deliberation and posting it here
> for the benefit of forum members.
> To recap, my data was in the form of 2 netCDF files, each of dimension 356 x
> 507 x 120 (lat,lon,time). I wanted to perform regressions between the two
> variables on each grid point over time. I used "brick" to read in the
> netcdfs as raster layers and stack along with the "plyr"?package to perform
> these regressions on the grid.
> # create raster object from the netcdf
> rcmraster <- brick("regcm.cumul.hdd.10k.96_05.fixed.latlonvars.nc", varname
> = "hdd")
> emitraster <-
> brick("flip.percap.vulcan.10k.dp.build.381.RES.EIAmy.96_05.this.latest.nc",varname="emitpercap")
> # crop subset of above rasters, test method on subset which is 4 x 4 x 120
> lim <- extent(rcmraster,180,185,300,305)
> rcmraster_crop <- crop(rcmraster,lim)
> emitraster_crop <- crop(emitraster,lim)
> # do some plotting to check
> ?par(mfrow=c(1,2))
> ?plot(rcmraster_crop[[1]])
> ?plot(emitraster_crop[[1]])
> # test regressions for cropped subset
> s_crop <- stack(emitraster_crop,rcmraster_crop)
> # use of plyr (provides a more elegant alternative to lapply)
> # the data frame datCoef contains the slope and intercept for each point in
> the grid (denoted by X1 and X2)
> datCoef = adply( as.array(s_crop) , 1:2 ,
> ?? ? ? ? ? ? ?function(x ) {
> ?? ? ? ? ? ? ? ? ? ? ? ? ? ?resp = x[1:120]
> ?? ? ? ? ? ? ? ? ? ? ? ? ? ?expl = x[121:240]
> ?? ? ? ? ? ? ? ? ? ? ? ? ? ?mdl = lm(resp ~ expl)
> ?? ? ? ? ? ? ? ? ? ? ? ? ? ?res = c(mdl$coef[1] , mdl$coef[2])
> ?? ? ? ? ? ? ? ? ? ? ? ? ? ?return(res)
>
> ?? ? ? ? ? ? ? ? ? ? ? ? ?}
> ?? ? ? ? ? ? ? ? ? ? ? ? ?)
> Output of datCoef()
>> datCoef
> ?? X1 X2 ?(Intercept) ? ? ? ? expl
> 1 ? 1 ?1 0.0010523406 2.623927e-05
> 2 ? 2 ?1 0.0019401572 5.049197e-05
> 3 ? 3 ?1 0.0171326653 4.425026e-04
> 4 ? 4 ?1 0.0012244689 3.045755e-05
> 5 ? 1 ?2 0.0011454348 2.892668e-05
> 6 ? 2 ?2 0.0013920425 3.460922e-05
> 7 ? 3 ?2 0.0015973400 3.943349e-05
> 8 ? 4 ?2 0.0016494511 4.045801e-05
> 9 ? 1 ?3 0.0018757258 4.704107e-05
> 10 ?2 ?3 0.0038066075 9.378512e-05
> 11 ?3 ?3 0.0039669120 9.719391e-05
> 12 ?4 ?3 0.0038055524 9.246021e-05
> 13 ?1 ?4 0.0015700329 3.921758e-05
> 14 ?2 ?4 0.0003727142 9.156119e-06
> 15 ?3 ?4 0.0005315722 1.308365e-05
> 16 ?4 ?4 0.0005872930 1.539454e-05
> Now, what I want to do is for each of these X1,X2, get a "predicted" map
> based on a new X which is an array of dimensions 4 x 4 (same as the rasters.
> in the original dataset, it will be 356 x 507). This array has the following
> values:
>> futurehdda
> ?? ? ? ? [,1] ? ? [,2] ? ? [,3] ? ? [,4]
> [1,] 5707.575 5696.325 5692.960 5683.110
> [2,] 5680.303 5665.092 5660.790 5647.896
> [3,] 5656.163 5641.045 5638.886 5625.231
> [4,] 5634.604 5619.317 5620.226 5601.729
> How can I extract the slope and intercept from datCoef and use the above X
> to get a predicted Y with the same dimensions (4 x 4)?
> Thanks,
> Advait
> On Mon, Dec 6, 2010 at 4:57 PM, Robert J. Hijmans <r.hijmans at gmail.com>
> wrote:
>>
>> Dear Advait,
>>
>> > What I dont understand is:
>> > 1) How can each slope be the same (values of x1)
>>
>> Apparently the values in these cells are all the same (not that you
>> only use the first 8 time steps, not all 120)
>>
>> Here is an example with random values in which the slopes are all
>> different
>>
>> b <- brick(ncol=4, nrow=4, nl=120)
>> b <- setValues(b, matrix(runif(prod(dim(b))), ncol=120))
>> fun = function(x) { if(is.na(x[1])) { NA } else { lm(x[1:60] ~
>> x[61:120])$coefficients[2] } }
>> x <- calc(b, fun)
>> plot(x)
>> as.matrix(x)
>>
>>
>> > 2) The raster layers are of dimensions 4 x 4 x 120
>> > but?dim(getValues(rcmraster_crop))
>> > [1] ?16 120. Why is that? This must have implications for the way that
>> > the
>> > regressions for the brick are handled wouldnt it?
>> No
>>
>> > Or is it specific to the
>> > way "getValues" handles things?
>>
>> Yes. rows are cells (4*4=16), columns are layers.
>>
>> > Also, does anyone have any pointers of how to accomplish the NA testing
>> > and
>> See an example above, assuming that if the first time step is NA, they
>> all are. You could also do things like
>> if (sum(is.na(x)) > 60)
>> depends on your context.
>>
>>
>> Best, Robert
>>
>> On Mon, Dec 6, 2010 at 8:30 AM, Advait Godbole <advaitgodbole at gmail.com>
>> wrote:
>> > Dear Members,
>> > To recap, I initially had trouble reading in two 3D netCDFs in to R
>> > using
>> > the raster "brick" function. Each brick is a 356 x 507 x 120 (lat, lon,
>> > time) raster. With that resolved (thanks Robert!) I have the following
>> > code
>> > to perform regressions between the ?two time series (at each grid-cell)
>> > # read the netCDFs
>> > rcmraster <- brick("regcm.cumul.hdd.10k.96_05.fixed.latlonvars.nc",
>> > varname
>> > = "hdd")
>> > emitraster <-
>> >
>> > brick("flip.percap.vulcan.10k.dp.build.381.RES.EIAmy.96_05.this.latest.nc",varname="emitpercap")
>> > # crop subset of above rasters to test
>> > lim <- extent(rcmraster,180,185,300,305) ?# createss a 4 x 4 x 120 brick
>> > rcmraster_crop <- crop(rcmraster,lim)
>> > emitraster_crop <- crop(emitraster,lim)
>> > #regressions
>> > s_crop <- stack(emitraster_crop,rcmraster_crop)
>> > func <- function(x) { lm(x[1:4] ~ x[5:8])$coefficients[2] }
>> > #regression
>> > for emit* VS rcm*
>> > x1 <- calc(s_crop, func)
>> > While the above regressions run, I have to ultimately do the same ?for
>> > the
>> > ?entire domain (356 x 507 cells) and therefore need to check for NAs at
>> > all
>> > time steps for each grid cell for both the bricks, and then have lm?run.
>> > To
>> > that ?end,, I ran the following diagnostics on the cropped dataset:
>> >> dim(rcmraster_crop)
>> > [1] ? 4 ? 4 120
>> >> dim(emitraster_crop)
>> > [1] ? 4 ? 4 120
>> >> dim(x1)
>> > [1] 4 4
>> >> getValues(x1)
>> > ?[1] 3.968207 3.968207 3.968207 3.968207 3.968207 3.968207 3.968207
>> > 3.968207
>> > 3.968207 3.968207 3.968207
>> > [12] 3.968207 3.968207 3.968207 3.968207 3.968207
>> >
>> > What I dont understand is:
>> > 1) How can each slope be the same (values of x1)
>> > 2) The raster layers are of dimensions 4 x 4 x 120
>> > but?dim(getValues(rcmraster_crop))
>> > [1] ?16 120. Why is that? This must have implications for the way that
>> > the
>> > regressions for the brick are handled wouldnt it? Or is it specific to
>> > the
>> > way "getValues" handles things?
>> > Also, does anyone have any pointers of how to accomplish the NA testing
>> > and
>> > regressions ?
>> > Thanks,
>> > Advait
>> >
>> > On Sun, Dec 5, 2010 at 6:29 PM, Robert J. Hijmans <r.hijmans at gmail.com>
>> > wrote:
>> >>
>> >> Advait,
>> >> It is just an example. In this case the function only checks the first
>> >> time-slice for all cells. That often works because oftentimes either
>> >> all values are NA, or none. Also, I think lm works when not all values
>> >> are NA. If your data is different, you may need a different solution.
>> >> The best thing might be to try it out with a small dataset (you can
>> >> use crop to create one).
>> >> Robert
>> >>
>> >> On Sun, Dec 5, 2010 at 3:14 PM, Advait Godbole
>> >> <advaitgodbole at gmail.com>
>> >> wrote:
>> >> > Earlier in the threade you had mentioned that for two 120 layer
>> >> > bricks,
>> >> > this
>> >> > is what I should do:
>> >> > # regression of values in one brick (or stack) with another (Jacob's
>> >> > suggestion)
>> >> > s <- stack(s1, s2)
>> >> > # s1 and s2 have 120 layers
>> >> > fun <- function(x) { lm(x[1:120] ~ x[121:240])$coefficients[2] }
>> >> > x1 <- calc(s, fun)
>> >> > So if I have to check for NAs for the multi layered raster, I would
>> >> > need
>> >> > to
>> >> > do something like
>> >> > fun <- function (x) { if(is.na(x[1:120])) {NA} else
>> >> > {lm(x[1:120]~x[121:240])$coefficients[2]}}
>> >> > calc(s,fun=fun)
>> >> > That does not seem intuitively right to me although I am not very
>> >> > conversant
>> >> > with how is.na handles 3D variables to go much further. Also, should
>> >> > I
>> >> > not
>> >> > check the other brick for NAs too?
>> >> > Advait
>> >> > On Sun, Dec 5, 2010 at 5:29 PM, Robert J. Hijmans
>> >> > <r.hijmans at gmail.com>
>> >> > wrote:
>> >> >>
>> >> >> >If so, should I use a for loop instead?
>> >> >> No, that is the point of the calc function, that you do not do that.
>> >> >> Internally, calc uses apply as in
>> >> >> apply(values, 1, fun)
>> >> >>
>> >> >>
>> >> >> On Sat, Dec 4, 2010 at 1:50 PM, Advait Godbole
>> >> >> <advaitgodbole at gmail.com>
>> >> >> wrote:
>> >> >> > Roger, that fix worked, its there in the latest version. Thanks
>> >> >> > much.
>> >> >> > I am running into the problem that Martin mentioned earlier in the
>> >> >> > thread:
>> >> >> > Error in lm.fit(x, y, offset = offset, singular.ok = singular.ok,
>> >> >> > ...) :
>> >> >> > ?0 (non-NA) cases
>> >> >> >
>> >> >> > For which you suggested this:
>> >> >> > #you could catch this in your function and do something like:
>> >> >> >
>> >> >> >> fun=function(x) { if (is.na(x[1])){ NA } else {
>> >> >> >> lm(x[1]~x[2])$coefficients[2] }}
>> >> >> >> fun(c(NA,NA))
>> >> >> > [1] NA
>> >> >> >
>> >> >> > and then:
>> >> >> > calc(s, fun=fun)
>> >> >> >
>> >> >> > What I am confused is that my stack "s" that I will pass via calc
>> >> >> > is
>> >> >> > of
>> >> >> > dimensions 356 x 507 x 240, and therefore is.na?will act on the
>> >> >> > entire
>> >> >> > array
>> >> >> > and therefore still fail at those points where it is not NA. Is
>> >> >> > that
>> >> >> > right?
>> >> >> > If so, should I use a for loop instead?
>> >> >> > Thanks,
>> >> >> > Advait
>> >> >> > On Fri, Dec 3, 2010 at 2:58 PM, Robert J. Hijmans
>> >> >> > <r.hijmans at gmail.com>
>> >> >> > wrote:
>> >> >> >>
>> >> >> >> It may have been fixed. Please try this again in raster 1.7-8
>> >> >> >> (now
>> >> >> >> on
>> >> >> >> CRAN for windows and linux, mac in a day or so). Robert
>> >> >> >>
>> >> >> >> On Fri, Dec 3, 2010 at 11:54 AM, steven mosher
>> >> >> >> <moshersteven at gmail.com>
>> >> >> >> wrote:
>> >> >> >> > Well,
>> >> >> >> > ??I need some more information.
>> >> >> >> > ?before you create the stack do this and report the results
>> >> >> >> > test1 <- layerNames(rcmraster)
>> >> >> >> > test2 <- layerNames(emitraster)
>> >> >> >> > str(test1)
>> >> >> >> > str(test2)
>> >> >> >> > Its a bit of a hack but ?you can try to copy the layerNames out
>> >> >> >> > of
>> >> >> >> > the
>> >> >> >> > invidual stacks.
>> >> >> >> > Then set them to ? ?""
>> >> >> >> > then create one big stack
>> >> >> >> > then set the layerNames.
>> >> >> >> > ( I recall having to do that once in the past after a
>> >> >> >> > stackApply())
>> >> >> >> > I know in the past, I've had some similar issues, but I thought
>> >> >> >> > that
>> >> >> >> > they
>> >> >> >> > ?had been fixed.
>> >> >> >> > I'll try to take a look at the code ?in a bit, but if there is
>> >> >> >> > a
>> >> >> >> > bug,
>> >> >> >> > either
>> >> >> >> > robert or Jacob would have to fix it.
>> >> >> >> >
>> >> >> >> > On Fri, Dec 3, 2010 at 4:28 AM, Advait Godbole
>> >> >> >> > <advaitgodbole at gmail.com>
>> >> >> >> > wrote:
>> >> >> >> >>
>> >> >> >> >> With Robert being away until the 15th, can someone else help
>> >> >> >> >> out
>> >> >> >> >> with
>> >> >> >> >> this
>> >> >> >> >> issue? To recap, I have read in two 507 x ?356 x 120
>> >> >> >> >> (lon,lat,time)
>> >> >> >> >> netCDF
>> >> >> >> >> files into R using the "brick" function. I get the following
>> >> >> >> >> error
>> >> >> >> >> when
>> >> >> >> >> I
>> >> >> >> >> use "stack" to clump these two multi layer rasters together.
>> >> >> >> >> > s <- stack(rcmraster,emitraster)
>> >> >> >> >> Error in function (classes, fdef, mtable) ?:
>> >> >> >> >> ??unable to find an inherited method for function "trim", for
>> >> >> >> >> signature
>> >> >> >> >> "integer"
>> >> >> >> >> Robert suggested that it is because of the layerNames being
>> >> >> >> >> numeric,
>> >> >> >> >> annd
>> >> >> >> >> that layerNames() <- layerNames() would solve it but it did
>> >> >> >> >> not
>> >> >> >> >> help,
>> >> >> >> >> even
>> >> >> >> >> though layerNames() is now of type character.
>> >> >> >> >> Thanks much!
>> >> >> >> >> adv
>> >> >> >> >> On Fri, Dec 3, 2010 at 7:13 AM, Advait Godbole
>> >> >> >> >> <advaitgodbole at gmail.com>
>> >> >> >> >> wrote:
>> >> >> >> >>>
>> >> >> >> >>> the setMinMax() function worked. Thanks Steve and Robert..
>> >> >> >> >>> the work around did not work - I still get the trim() error..
>> >> >> >> >>> adv
>> >> >> >> >>>
>> >> >> >> >>> On Thu, Dec 2, 2010 at 1:43 PM, Robert J. Hijmans
>> >> >> >> >>> <r.hijmans at gmail.com>
>> >> >> >> >>> wrote:
>> >> >> >> >>>>
>> >> >> >> >>>> This is the work around:
>> >> >> >> >>>>
>> >> >> >> >>>> layerNames(rcmraster) <- layerNames(rcmraster)
>> >> >> >> >>>>
>> >> >> >> >>>>
>> >> >> >> >>>> On Thu, Dec 2, 2010 at 10:43 AM, Robert J. Hijmans
>> >> >> >> >>>> <r.hijmans at gmail.com>
>> >> >> >> >>>> wrote:
>> >> >> >> >>>> > The question marks indicate that the min and max values
>> >> >> >> >>>> > are
>> >> >> >> >>>> > not
>> >> >> >> >>>> > known
>> >> >> >> >>>> > to the object (because the file type does not store them,
>> >> >> >> >>>> > and
>> >> >> >> >>>> > it
>> >> >> >> >>>> > is
>> >> >> >> >>>> > too 'expensive' to determine them on the fly). setMinMax
>> >> >> >> >>>> > if
>> >> >> >> >>>> > you
>> >> >> >> >>>> > really
>> >> >> >> >>>> > need to know.
>> >> >> >> >>>> > The error on trim seems to be a problem with layerNames
>> >> >> >> >>>> > being
>> >> >> >> >>>> > numeric.
>> >> >> >> >>>> > I'll fix that. This may be a work-around
>> >> >> >> >>>> >
>> >> >> >> >>>> >
>> >> >> >> >>>> >
>> >> >> >> >>>> >
>> >> >> >> >>>> >
>> >> >> >> >>>> >
>> >> >> >> >>>> > On Thu, Dec 2, 2010 at 10:23 AM, steven mosher
>> >> >> >> >>>> > <moshersteven at gmail.com> wrote:
>> >> >> >> >>>> >> ?see the setMinMax()
>> >> >> >> >>>> >>
>> >> >> >> >>>> >> ?for the error on trim() I'm not sure.
>> >> >> >> >>>> >>
>> >> >> >> >>>> >> On Thu, Dec 2, 2010 at 5:16 AM, Advait Godbole
>> >> >> >> >>>> >> <advaitgodbole at gmail.com>
>> >> >> >> >>>> >> wrote:
>> >> >> >> >>>> >>>
>> >> >> >> >>>> >>> That worked perfectly. Thanks for pointing this out. I
>> >> >> >> >>>> >>> changed
>> >> >> >> >>>> >>> the
>> >> >> >> >>>> >>> way my
>> >> >> >> >>>> >>> variables were being written to the netCDF and now
>> >> >> >> >>>> >>> "brick"
>> >> >> >> >>>> >>> works.
>> >> >> >> >>>> >>> However,
>> >> >> >> >>>> >>> I
>> >> >> >> >>>> >>> am getting an error while using the stack function, like
>> >> >> >> >>>> >>> so:
>> >> >> >> >>>> >>>
>> >> >> >> >>>> >>> "Error in function (classes, fdef, mtable) ?:
>> >> >> >> >>>> >>> ?unable to find an inherited method for function "trim",
>> >> >> >> >>>> >>> for
>> >> >> >> >>>> >>> signature
>> >> >> >> >>>> >>> "integer"
>> >> >> >> >>>> >>>
>> >> >> >> >>>> >>> The two rasters show the following:
>> >> >> >> >>>> >>> > rcmraster
>> >> >> >> >>>> >>> class ? ? ? : RasterBrick
>> >> >> >> >>>> >>> filename ? ?:
>> >> >> >> >>>> >>> regcm.cumul.hdd.10k.96_05.fixed.latlonvars.nc
>> >> >> >> >>>> >>> nlayers ? ? : 120
>> >> >> >> >>>> >>> nrow ? ? ? ?: 356
>> >> >> >> >>>> >>> ncol ? ? ? ?: 507
>> >> >> >> >>>> >>> ncell ? ? ? : 180492
>> >> >> >> >>>> >>> projection ?: +proj=longlat +datum=WGS84 +ellps=WGS84
>> >> >> >> >>>> >>> +towgs84=0,0,0
>> >> >> >> >>>> >>> min value ? : ? ? ? ? ? ? ? ? ? ?
>> >> >> >> >>>> >>> max value ? : ? ? ? ? ? ? ? ? ? ?
>> >> >> >> >>>> >>> xmin ? ? ? ?: -137.3312
>> >> >> >> >>>> >>> xmax ? ? ? ?: -62.11259
>> >> >> >> >>>> >>> ymin ? ? ? ?: 22.12693
>> >> >> >> >>>> >>> ymax ? ? ? ?: 57.35954
>> >> >> >> >>>> >>> xres ? ? ? ?: 0.1483602
>> >> >> >> >>>> >>> yres ? ? ? ?: 0.09896801
>> >> >> >> >>>> >>>
>> >> >> >> >>>> >>> > emitraster
>> >> >> >> >>>> >>> class ? ? ? : RasterBrick
>> >> >> >> >>>> >>> filename ? ?:
>> >> >> >> >>>> >>>
>> >> >> >> >>>> >>>
>> >> >> >> >>>> >>>
>> >> >> >> >>>> >>>
>> >> >> >> >>>> >>> flip.percap.vulcan.10k.dp.build.381.RES.EIAmy.96_05.this.latest.nc
>> >> >> >> >>>> >>> nlayers ? ? : 120
>> >> >> >> >>>> >>> nrow ? ? ? ?: 356
>> >> >> >> >>>> >>> ncol ? ? ? ?: 507
>> >> >> >> >>>> >>> ncell ? ? ? : 180492
>> >> >> >> >>>> >>> projection ?: +proj=longlat +datum=WGS84 +ellps=WGS84
>> >> >> >> >>>> >>> +towgs84=0,0,0
>> >> >> >> >>>> >>> min value ? : ? ? ? ? ? ? ? ? ? ?
>> >> >> >> >>>> >>> max value ? : ? ? ? ? ? ? ? ? ? ?
>> >> >> >> >>>> >>> xmin ? ? ? ?: -137.3312
>> >> >> >> >>>> >>> xmax ? ? ? ?: -62.11259
>> >> >> >> >>>> >>> ymin ? ? ? ?: 22.12693
>> >> >> >> >>>> >>> ymax ? ? ? ?: 57.35954
>> >> >> >> >>>> >>> xres ? ? ? ?: 0.1483602
>> >> >> >> >>>> >>> yres ? ? ? ?: 0.09896801
>> >> >> >> >>>> >>>
>> >> >> >> >>>> >>> A getValues call shows a lot of NAs. Now, my original
>> >> >> >> >>>> >>> file
>> >> >> >> >>>> >>> does
>> >> >> >> >>>> >>> have
>> >> >> >> >>>> >>> a
>> >> >> >> >>>> >>> large
>> >> >> >> >>>> >>> number of missing values so that is why this should
>> >> >> >> >>>> >>> happen,
>> >> >> >> >>>> >>> but I
>> >> >> >> >>>> >>> suspect
>> >> >> >> >>>> >>> something is going wrong since the min and max values
>> >> >> >> >>>> >>> are
>> >> >> >> >>>> >>> not
>> >> >> >> >>>> >>> being
>> >> >> >> >>>> >>> displayed for either of these rasters. Is that the
>> >> >> >> >>>> >>> source
>> >> >> >> >>>> >>> of
>> >> >> >> >>>> >>> the
>> >> >> >> >>>> >>> problem
>> >> >> >> >>>> >>> in
>> >> >> >> >>>> >>> the "stack" function?
>> >> >> >> >>>> >>>
>> >> >> >> >>>> >>> Thanks,
>> >> >> >> >>>> >>>
>> >> >> >> >>>> >>> Advait
>> >> >> >> >>>> >>>
>> >> >> >> >>>> >>> On Tue, Nov 30, 2010 at 5:18 PM, Robert J. Hijmans
>> >> >> >> >>>> >>> <r.hijmans at gmail.com>wrote:
>> >> >> >> >>>> >>>
>> >> >> >> >>>> >>> > Advait,
>> >> >> >> >>>> >>> >
>> >> >> >> >>>> >>> > The is an error in the file, I think, see below:
>> >> >> >> >>>> >>> >
>> >> >> >> >>>> >>> > > library(ncdf)
>> >> >> >> >>>> >>> > > filename =
>> >> >> >> >>>> >>> > > "c:/downloads/regcm.cumul.hdd.10k.96_05.new.nc"
>> >> >> >> >>>> >>> > > nc <- open.ncdf(filename)
>> >> >> >> >>>> >>> > >
>> >> >> >> >>>> >>> > > zvar <- 'hdd'
>> >> >> >> >>>> >>> > > nc$var[[zvar]]$dim[[1]]$len
>> >> >> >> >>>> >>> > [1] 507
>> >> >> >> >>>> >>> > > nc$var[[zvar]]$dim[[2]]$len
>> >> >> >> >>>> >>> > [1] 356
>> >> >> >> >>>> >>> > >
>> >> >> >> >>>> >>> > > xx <- nc$var[[zvar]]$dim[[1]]$vals
>> >> >> >> >>>> >>> > > # should be a vector of 507 longitudes but:
>> >> >> >> >>>> >>> > > dim(xx)
>> >> >> >> >>>> >>> > [1] 507 356 120
>> >> >> >> >>>> >>> > >
>> >> >> >> >>>> >>> > > # works anyway
>> >> >> >> >>>> >>> > > xrange <- c(min(xx), max(xx))
>> >> >> >> >>>> >>> > > xrange
>> >> >> >> >>>> >>> > [1] -137.25705 ?-62.18677
>> >> >> >> >>>> >>> > >
>> >> >> >> >>>> >>> > > yy <- nc$var[[zvar]]$dim[[2]]$vals
>> >> >> >> >>>> >>> > > # should be a vector of 356 latitudes but:
>> >> >> >> >>>> >>> > > dim(yy)
>> >> >> >> >>>> >>> > [1] 507 356 120
>> >> >> >> >>>> >>> > >
>> >> >> >> >>>> >>> > > # this fails
>> >> >> >> >>>> >>> > > yrange <- c(min(yy), max(yy))
>> >> >> >> >>>> >>> > > yrange
>> >> >> >> >>>> >>> > [1] NaN NaN
>> >> >> >> >>>> >>> > > # and that is the only reason why raster failed.
>> >> >> >> >>>> >>> > >
>> >> >> >> >>>> >>> > > #OK
>> >> >> >> >>>> >>> > > yy[,,1][1:10,350:355]
>> >> >> >> >>>> >>> > ? ? ? ? ?[,1] ? ? [,2] ? ? [,3] ? ? [,4] ? ? [,5]
>> >> >> >> >>>> >>> > [,6]
>> >> >> >> >>>> >>> > ?[1,] 51.49148 51.57122 51.65092 51.73055 51.81014
>> >> >> >> >>>> >>> > 51.88967
>> >> >> >> >>>> >>> > ?[2,] 51.52888 51.60866 51.68839 51.76807 51.84769
>> >> >> >> >>>> >>> > 51.92727
>> >> >> >> >>>> >>> > ?[3,] 51.56616 51.64598 51.72575 51.80547 51.88513
>> >> >> >> >>>> >>> > 51.96474
>> >> >> >> >>>> >>> > ?[4,] 51.60332 51.68318 51.76299 51.84275 51.92245
>> >> >> >> >>>> >>> > 52.00210
>> >> >> >> >>>> >>> > ?[5,] 51.64036 51.72026 51.80011 51.87991 51.95965
>> >> >> >> >>>> >>> > 52.03934
>> >> >> >> >>>> >>> > ?[6,] 51.67728 51.75722 51.83711 51.91695 51.99673
>> >> >> >> >>>> >>> > 52.07646
>> >> >> >> >>>> >>> > ?[7,] 51.71409 51.79407 51.87399 51.95387 52.03369
>> >> >> >> >>>> >>> > 52.11345
>> >> >> >> >>>> >>> > ?[8,] 51.75077 51.83079 51.91076 51.99067 52.07053
>> >> >> >> >>>> >>> > 52.15033
>> >> >> >> >>>> >>> > ?[9,] 51.78734 51.86739 51.94740 52.02735 52.10725
>> >> >> >> >>>> >>> > 52.18709
>> >> >> >> >>>> >>> > [10,] 51.82378 51.90388 51.98392 52.06391 52.14385
>> >> >> >> >>>> >>> > 52.22373
>> >> >> >> >>>> >>> > >
>> >> >> >> >>>> >>> > > #bad values here (and note the NaN):
>> >> >> >> >>>> >>> > > yy[,,120][1:10,350:355]
>> >> >> >> >>>> >>> > ? ? ? ? ? ? ? ?[,1] ? ? ? ? ? [,2] ? ? ? ? ? [,3]
>> >> >> >> >>>> >>> > [,4]
>> >> >> >> >>>> >>> > ? ? [,5] ? ? ? ? ? [,6]
>> >> >> >> >>>> >>> > ?[1,] -1.313847e-229 -4.895880e-272 -7.553765e-266
>> >> >> >> >>>> >>> > 1.293814e+58
>> >> >> >> >>>> >>> > 9.551441e-293 ?-3.291580e-36
>> >> >> >> >>>> >>> > ?[2,] -5.321424e+272 -3.076997e-223 ?-1.515780e-33
>> >> >> >> >>>> >>> > -9.895836e+171
>> >> >> >> >>>> >>> > 3.115686e-149 ?-4.970539e+92
>> >> >> >> >>>> >>> > ?[3,] ?5.259277e-203 ? 5.980335e-56 ?2.893449e-212
>> >> >> >> >>>> >>> > ?2.974200e+274
>> >> >> >> >>>> >>> > 3.186547e-218 ?2.503689e+296
>> >> >> >> >>>> >>> > ?[4,] -3.977129e+225 -3.696719e-283 ? 1.284612e+42
>> >> >> >> >>>> >>> > 1.887923e+28
>> >> >> >> >>>> >>> > -2.322520e+268 ?5.005820e-108
>> >> >> >> >>>> >>> > ?[5,] ?-6.569744e+88 ? 1.824506e-74 ? 7.663356e+39
>> >> >> >> >>>> >>> > ?1.608759e-201
>> >> >> >> >>>> >>> > -1.433761e+110 -8.804183e-211
>> >> >> >> >>>> >>> > ?[6,] -4.237822e-162 ? ? ? ? ? ?NaN ?7.405904e-275
>> >> >> >> >>>> >>> > ?5.859877e-258
>> >> >> >> >>>> >>> > 1.339820e+110 ?1.631993e+229
>> >> >> >> >>>> >>> > ?[7,] ? 5.603325e-64 ? 4.188764e+37 -2.188887e+243
>> >> >> >> >>>> >>> > -4.657907e+280
>> >> >> >> >>>> >>> > 1.795268e-185 ?1.166057e-175
>> >> >> >> >>>> >>> > ?[8,] -2.112804e-229 ?4.536625e+137 ?2.910322e-278
>> >> >> >> >>>> >>> > ?4.407645e-274
>> >> >> >> >>>> >>> > 8.886205e-239 -1.913860e+238
>> >> >> >> >>>> >>> > ?[9,] ?-9.126350e+44 -1.866422e+177 -2.578975e+256
>> >> >> >> >>>> >>> > ?3.275379e+208
>> >> >> >> >>>> >>> > -2.657457e+75 ?-1.258259e-90
>> >> >> >> >>>> >>> > [10,] ?6.698325e+216 -2.958355e+137 -1.058748e-178
>> >> >> >> >>>> >>> > -1.776776e+215
>> >> >> >> >>>> >>> > -6.368807e+78 -5.337653e+299
>> >> >> >> >>>> >>> > >
>> >> >> >> >>>> >>> > > # this would have worked
>> >> >> >> >>>> >>> > > yrange <- c(min(yy[,,1]), max(yy[,,1]))
>> >> >> >> >>>> >>> > > yrange
>> >> >> >> >>>> >>> > [1] 22.17641 57.31006
>> >> >> >> >>>> >>> > >
>> >> >> >> >>>> >>> > > close.ncdf(nc)
>> >> >> >> >>>> >>> >
>> >> >> >> >>>> >>> >
>> >> >> >> >>>> >>> > Best, Robert
>> >> >> >> >>>> >>> >
>> >> >> >> >>>> >>> >
>> >> >> >> >>>> >>> > On Tue, Nov 30, 2010 at 10:37 AM, Advait Godbole
>> >> >> >> >>>> >>> > <advaitgodbole at gmail.com> wrote:
>> >> >> >> >>>> >>> > > Dear Robert,
>> >> >> >> >>>> >>> > > here is the link to the file:
>> >> >> >> >>>> >>> > >
>> >> >> >> >>>> >>> > >
>> >> >> >> >>>> >>> > >
>> >> >> >> >>>> >>> > >
>> >> >> >> >>>> >>> > >
>> >> >> >> >>>> >>> > > http://dl.dropbox.com/u/4030944/regcm.cumul.hdd.10k.96_05.new.nc. It
>> >> >> >> >>>> >>> > > is
>> >> >> >> >>>> >>> > a
>> >> >> >> >>>> >>> > > large file ~400 MB. Let me know if dropbox is not
>> >> >> >> >>>> >>> > > convenient
>> >> >> >> >>>> >>> > > and
>> >> >> >> >>>> >>> > > you
>> >> >> >> >>>> >>> > would
>> >> >> >> >>>> >>> > > rather do ftp - ?but our machines are down for
>> >> >> >> >>>> >>> > > maintenance
>> >> >> >> >>>> >>> > > and I
>> >> >> >> >>>> >>> > > may
>> >> >> >> >>>> >>> > > not
>> >> >> >> >>>> >>> > be
>> >> >> >> >>>> >>> > > immediately able to get access.
>> >> >> >> >>>> >>> > > I was going over the NCL code that processes the
>> >> >> >> >>>> >>> > > files
>> >> >> >> >>>> >>> > > but
>> >> >> >> >>>> >>> > > did
>> >> >> >> >>>> >>> > > not
>> >> >> >> >>>> >>> > > find
>> >> >> >> >>>> >>> > > anything glaringly amiss, so I will have to look at
>> >> >> >> >>>> >>> > > it
>> >> >> >> >>>> >>> > > in
>> >> >> >> >>>> >>> > > greater
>> >> >> >> >>>> >>> > > detail
>> >> >> >> >>>> >>> > > since it is clear that the number of entries in the
>> >> >> >> >>>> >>> > > variables
>> >> >> >> >>>> >>> > > is
>> >> >> >> >>>> >>> > > not
>> >> >> >> >>>> >>> > right
>> >> >> >> >>>> >>> > > as you've pointed out. There is a chance that I have
>> >> >> >> >>>> >>> > > not
>> >> >> >> >>>> >>> > > written
>> >> >> >> >>>> >>> > > out
>> >> >> >> >>>> >>> > > the
>> >> >> >> >>>> >>> > > co-ordinates properly.
>> >> >> >> >>>> >>> > > Thanks,
>> >> >> >> >>>> >>> > > Advait
>> >> >> >> >>>> >>> > > On Mon, Nov 29, 2010 at 1:14 PM, Robert J. Hijmans
>> >> >> >> >>>> >>> > > <r.hijmans at gmail.com>
>> >> >> >> >>>> >>> > > wrote:
>> >> >> >> >>>> >>> > >>
>> >> >> >> >>>> >>> > >> Advait,
>> >> >> >> >>>> >>> > >> I do not think I can help you further unless you
>> >> >> >> >>>> >>> > >> send
>> >> >> >> >>>> >>> > >> me
>> >> >> >> >>>> >>> > >> your
>> >> >> >> >>>> >>> > >> file;
>> >> >> >> >>>> >>> > >> but this suggests that it is either not following
>> >> >> >> >>>> >>> > >> the
>> >> >> >> >>>> >>> > >> CF
>> >> >> >> >>>> >>> > >> standards,
>> >> >> >> >>>> >>> > >> or
>> >> >> >> >>>> >>> > >> something is wrong with the file, or that there is
>> >> >> >> >>>> >>> > >> something
>> >> >> >> >>>> >>> > >> I
>> >> >> >> >>>> >>> > >> have
>> >> >> >> >>>> >>> > >> not understood about these files.
>> >> >> >> >>>> >>> > >> You said you have 507 x 356 x 120 values. I would
>> >> >> >> >>>> >>> > >> expect
>> >> >> >> >>>> >>> > >> length(frcm$dim[[1]]$vals) == 507 and
>> >> >> >> >>>> >>> > >> length(frcm$dim[[2]]$vals) ==
>> >> >> >> >>>> >>> > >> 356
>> >> >> >> >>>> >>> > >> Robert
>> >> >> >> >>>> >>> > >>
>> >> >> >> >>>> >>> > >> On Mon, Nov 29, 2010 at 6:11 AM, Advait Godbole <
>> >> >> >> >>>> >>> > advaitgodbole at gmail.com>
>> >> >> >> >>>> >>> > >> wrote:
>> >> >> >> >>>> >>> > >> > sorry to disrupt the flow of the conversation,
>> >> >> >> >>>> >>> > >> > but
>> >> >> >> >>>> >>> > >> > after
>> >> >> >> >>>> >>> > >> > doing what
>> >> >> >> >>>> >>> > >> > Robert
>> >> >> >> >>>> >>> > >> > suggested, this is what was returned:
>> >> >> >> >>>> >>> > >> >> length(frcm$dim[[1]]$vals)
>> >> >> >> >>>> >>> > >> > [1] 21659040
>> >> >> >> >>>> >>> > >> >> length(frcm$dim[[2]]$vals)
>> >> >> >> >>>> >>> > >> > [1] 21659040
>> >> >> >> >>>> >>> > >> > the other two functions return the latitude and
>> >> >> >> >>>> >>> > >> > longitude
>> >> >> >> >>>> >>> > >> > arrays
>> >> >> >> >>>> >>> > >> > not
>> >> >> >> >>>> >>> > >> > populated with NAs/missing values. I havent
>> >> >> >> >>>> >>> > >> > reproduced
>> >> >> >> >>>> >>> > >> > them
>> >> >> >> >>>> >>> > >> > here
>> >> >> >> >>>> >>> > because
>> >> >> >> >>>> >>> > >> > of
>> >> >> >> >>>> >>> > >> > their number.
>> >> >> >> >>>> >>> > >> > Regards,
>> >> >> >> >>>> >>> > >> > advait
>> >> >> >> >>>> >>> > >> > On Sat, Nov 27, 2010 at 3:48 PM, Robert J.
>> >> >> >> >>>> >>> > >> > Hijmans <
>> >> >> >> >>>> >>> > r.hijmans at gmail.com>
>> >> >> >> >>>> >>> > >> > wrote:
>> >> >> >> >>>> >>> > >> >>
>> >> >> >> >>>> >>> > >> >> Advait,
>> >> >> >> >>>> >>> > >> >>
>> >> >> >> >>>> >>> > >> >> That suggests that you have missing values in
>> >> >> >> >>>> >>> > >> >> the
>> >> >> >> >>>> >>> > >> >> lon
>> >> >> >> >>>> >>> > >> >> or
>> >> >> >> >>>> >>> > >> >> lat
>> >> >> >> >>>> >>> > >> >> dimensions. Is that true? That would be awkward,
>> >> >> >> >>>> >>> > >> >> but
>> >> >> >> >>>> >>> > >> >> perhaps
>> >> >> >> >>>> >>> > something
>> >> >> >> >>>> >>> > >> >> else is going on. Can you send me your file? If
>> >> >> >> >>>> >>> > >> >> not
>> >> >> >> >>>> >>> > >> >> can
>> >> >> >> >>>> >>> > >> >> you
>> >> >> >> >>>> >>> > >> >> send
>> >> >> >> >>>> >>> > >> >> the
>> >> >> >> >>>> >>> > >> >> results of this:
>> >> >> >> >>>> >>> > >> >>
>> >> >> >> >>>> >>> > >> >> filename <- "regcm.cumul.hdd.10k.96_05.new.nc"
>> >> >> >> >>>> >>> > >> >> nc <- open.ncdf(filename)
>> >> >> >> >>>> >>> > >> >> length(nc$dim[[1]]$vals)
>> >> >> >> >>>> >>> > >> >> length(nc$dim[[2]]$vals)
>> >> >> >> >>>> >>> > >> >> nc$dim[[1]]$vals
>> >> >> >> >>>> >>> > >> >> nc$dim[[2]]$vals
>> >> >> >> >>>> >>> > >> >> close.ncdf(nc)
>> >> >> >> >>>> >>> > >> >>
>> >> >> >> >>>> >>> > >> >> Thanks, Robert
>> >> >> >> >>>> >>> > >> >>
>> >> >> >> >>>> >>> > >> >> On Sat, Nov 27, 2010 at 8:36 AM, Advait Godbole
>> >> >> >> >>>> >>> > >> >> <advaitgodbole at gmail.com>
>> >> >> >> >>>> >>> > >> >> wrote:
>> >> >> >> >>>> >>> > >> >> > Thanks everyone for these leads..However, I am
>> >> >> >> >>>> >>> > >> >> > running
>> >> >> >> >>>> >>> > >> >> > into
>> >> >> >> >>>> >>> > problems
>> >> >> >> >>>> >>> > >> >> > with
>> >> >> >> >>>> >>> > >> >> > data handling. I used ncdf to extract the two
>> >> >> >> >>>> >>> > >> >> > variables
>> >> >> >> >>>> >>> > >> >> > (507 x
>> >> >> >> >>>> >>> > >> >> > 356
>> >> >> >> >>>> >>> > x
>> >> >> >> >>>> >>> > >> >> > 120
>> >> >> >> >>>> >>> > >> >> > -
>> >> >> >> >>>> >>> > >> >> > lon,lat,time) and converted them into array
>> >> >> >> >>>> >>> > >> >> > objects.
>> >> >> >> >>>> >>> > >> >> > The
>> >> >> >> >>>> >>> > suggestions
>> >> >> >> >>>> >>> > >> >> > provided all utilize the raster package, but
>> >> >> >> >>>> >>> > >> >> > using
>> >> >> >> >>>> >>> > >> >> > "brick"
>> >> >> >> >>>> >>> > >> >> > on
>> >> >> >> >>>> >>> > >> >> > the
>> >> >> >> >>>> >>> > >> >> > file
>> >> >> >> >>>> >>> > >> >> > returns this error: "rcmraster <-
>> >> >> >> >>>> >>> > >> >> > brick("regcm.cumul.hdd.10k.96_05.new.nc")
>> >> >> >> >>>> >>> > >> >> > Error in if (e at xmin > -400 & e at xmax < 400 &
>> >> >> >> >>>> >>> > >> >> > e at ymin >
>> >> >> >> >>>> >>> > >> >> > -90.1
>> >> >> >> >>>> >>> > >> >> > &
>> >> >> >> >>>> >>> > e at ymax <
>> >> >> >> >>>> >>> > >> >> > ?:
>> >> >> >> >>>> >>> > >> >> > missing value where TRUE/FALSE needed"
>> >> >> >> >>>> >>> > >> >> >
>> >> >> >> >>>> >>> > >> >> > I have a fair number of NAs (all missing
>> >> >> >> >>>> >>> > >> >> > values
>> >> >> >> >>>> >>> > >> >> > in
>> >> >> >> >>>> >>> > >> >> > the
>> >> >> >> >>>> >>> > >> >> > original
>> >> >> >> >>>> >>> > >> >> > variables).
>> >> >> >> >>>> >>> > >> >> > Is there a way to set a flag for that? Or any
>> >> >> >> >>>> >>> > >> >> > other
>> >> >> >> >>>> >>> > >> >> > workaround?
>> >> >> >> >>>> >>> > >> >> > Thanks much,
>> >> >> >> >>>> >>> > >> >> > advait
>> >> >> >> >>>> >>> > >> >> > On Fri, Nov 26, 2010 at 6:25 PM, Robert J.
>> >> >> >> >>>> >>> > >> >> > Hijmans
>> >> >> >> >>>> >>> > >> >> > <r.hijmans at gmail.com>
>> >> >> >> >>>> >>> > >> >> > wrote:
>> >> >> >> >>>> >>> > >> >> >>
>> >> >> >> >>>> >>> > >> >> >> There are some difference in the behavior of
>> >> >> >> >>>> >>> > >> >> >> 'calc'
>> >> >> >> >>>> >>> > >> >> >> between
>> >> >> >> >>>> >>> > >> >> >> functions,
>> >> >> >> >>>> >>> > >> >> >> because of attempts to accommodate different
>> >> >> >> >>>> >>> > >> >> >> functions
>> >> >> >> >>>> >>> > >> >> >> &
>> >> >> >> >>>> >>> > intentions.
>> >> >> >> >>>> >>> > >> >> >> But in 'raster' 1.7-4 (available from R-Forge
>> >> >> >> >>>> >>> > >> >> >> in
>> >> >> >> >>>> >>> > >> >> >> ~
>> >> >> >> >>>> >>> > >> >> >> 24
>> >> >> >> >>>> >>> > >> >> >> hrs; and
>> >> >> >> >>>> >>> > from
>> >> >> >> >>>> >>> > >> >> >> CRAN soon), the below will work:
>> >> >> >> >>>> >>> > >> >> >>
>> >> >> >> >>>> >>> > >> >> >> library(raster)
>> >> >> >> >>>> >>> > >> >> >> #creating some data
>> >> >> >> >>>> >>> > >> >> >> r <- raster(nrow=10, ncol=10)
>> >> >> >> >>>> >>> > >> >> >> s1 <- s2<- list()
>> >> >> >> >>>> >>> > >> >> >> for (i in 1:12) {
>> >> >> >> >>>> >>> > >> >> >> ? ? ? ?s1[i] <- setValues(r, rnorm(ncell(r),
>> >> >> >> >>>> >>> > >> >> >> i,
>> >> >> >> >>>> >>> > >> >> >> 3)
>> >> >> >> >>>> >>> > >> >> >> )
>> >> >> >> >>>> >>> > >> >> >> ? ? ? ?s2[i] <- setValues(r, rnorm(ncell(r),
>> >> >> >> >>>> >>> > >> >> >> i,
>> >> >> >> >>>> >>> > >> >> >> 3)
>> >> >> >> >>>> >>> > >> >> >> )
>> >> >> >> >>>> >>> > >> >> >> }
>> >> >> >> >>>> >>> > >> >> >> s1 <- stack(s1)
>> >> >> >> >>>> >>> > >> >> >> s2 <- stack(s2)
>> >> >> >> >>>> >>> > >> >> >>
>> >> >> >> >>>> >>> > >> >> >> # regression of values in one brick (or
>> >> >> >> >>>> >>> > >> >> >> stack)
>> >> >> >> >>>> >>> > >> >> >> with
>> >> >> >> >>>> >>> > >> >> >> another
>> >> >> >> >>>> >>> > (Jacob's
>> >> >> >> >>>> >>> > >> >> >> suggestion)
>> >> >> >> >>>> >>> > >> >> >> s <- stack(s1, s2)
>> >> >> >> >>>> >>> > >> >> >> # s1 and s2 have 12 layers
>> >> >> >> >>>> >>> > >> >> >> fun <- function(x) { lm(x[1:12] ~
>> >> >> >> >>>> >>> > >> >> >> x[13:24])$coefficients[2] }
>> >> >> >> >>>> >>> > >> >> >> x1 <- calc(s, fun)
>> >> >> >> >>>> >>> > >> >> >>
>> >> >> >> >>>> >>> > >> >> >> # regression of values in one brick (or
>> >> >> >> >>>> >>> > >> >> >> stack)
>> >> >> >> >>>> >>> > >> >> >> with
>> >> >> >> >>>> >>> > >> >> >> 'time'
>> >> >> >> >>>> >>> > >> >> >> time <- 1:nlayers(s)
>> >> >> >> >>>> >>> > >> >> >> fun <- function(x) { lm(x ~
>> >> >> >> >>>> >>> > >> >> >> time)$coefficients[2] }
>> >> >> >> >>>> >>> > >> >> >> x2 <- calc(s, fun)
>> >> >> >> >>>> >>> > >> >> >>
>> >> >> >> >>>> >>> > >> >> >> # get multiple layers, e.g. the slope _and_
>> >> >> >> >>>> >>> > >> >> >> intercept
>> >> >> >> >>>> >>> > >> >> >> fun <- function(x) { lm(x ~
>> >> >> >> >>>> >>> > >> >> >> time)$coefficients }
>> >> >> >> >>>> >>> > >> >> >> x3 <- calc(s, fun)
>> >> >> >> >>>> >>> > >> >> >>
>> >> >> >> >>>> >>> > >> >> >> If this does not work in your version, you
>> >> >> >> >>>> >>> > >> >> >> can
>> >> >> >> >>>> >>> > >> >> >> use
>> >> >> >> >>>> >>> > >> >> >> apply(
>> >> >> >> >>>> >>> > >> >> >> ) as
>> >> >> >> >>>> >>> > >> >> >> in
>> >> >> >> >>>> >>> > >> >> >> what
>> >> >> >> >>>> >>> > >> >> >> I send earlier.
>> >> >> >> >>>> >>> > >> >> >>
>> >> >> >> >>>> >>> > >> >> >> Robert
>> >> >> >> >>>> >>> > >> >> >>
>> >> >> >> >>>> >>> > >> >> >> On Fri, Nov 26, 2010 at 2:56 PM, Robert J.
>> >> >> >> >>>> >>> > >> >> >> Hijmans
>> >> >> >> >>>> >>> > >> >> >> <r.hijmans at gmail.com>
>> >> >> >> >>>> >>> > >> >> >> wrote:
>> >> >> >> >>>> >>> > >> >> >> > It seems that 'calc' does not like this
>> >> >> >> >>>> >>> > >> >> >> > (any
>> >> >> >> >>>> >>> > >> >> >> > more;
>> >> >> >> >>>> >>> > >> >> >> > another
>> >> >> >> >>>> >>> > >> >> >> > thing
>> >> >> >> >>>> >>> > >> >> >> > to
>> >> >> >> >>>> >>> > >> >> >> > fix) . If your rasters are not very large
>> >> >> >> >>>> >>> > >> >> >> > you
>> >> >> >> >>>> >>> > >> >> >> > can
>> >> >> >> >>>> >>> > >> >> >> > use
>> >> >> >> >>>> >>> > >> >> >> > apply,
>> >> >> >> >>>> >>> > which
>> >> >> >> >>>> >>> > >> >> >> > makes it much faster:
>> >> >> >> >>>> >>> > >> >> >> >
>> >> >> >> >>>> >>> > >> >> >> > library(raster)
>> >> >> >> >>>> >>> > >> >> >> > #creating some data
>> >> >> >> >>>> >>> > >> >> >> > r <- raster(nrow=10, ncol=10)
>> >> >> >> >>>> >>> > >> >> >> > s <- list()
>> >> >> >> >>>> >>> > >> >> >> > for (i in 1:25) { s[i] <- setValues(r,
>> >> >> >> >>>> >>> > >> >> >> > rnorm(ncell(r),
>> >> >> >> >>>> >>> > >> >> >> > i, 3)
>> >> >> >> >>>> >>> > >> >> >> > ) }
>> >> >> >> >>>> >>> > >> >> >> > s <- stack(s)
>> >> >> >> >>>> >>> > >> >> >> >
>> >> >> >> >>>> >>> > >> >> >> > # regression
>> >> >> >> >>>> >>> > >> >> >> > time <- 1:nlayers(s)
>> >> >> >> >>>> >>> > >> >> >> > fun <- function(x) { lm(x ~
>> >> >> >> >>>> >>> > >> >> >> > time)$coefficients[2]
>> >> >> >> >>>> >>> > >> >> >> > }
>> >> >> >> >>>> >>> > >> >> >> > r[] <- apply(getValues(s), 1, fun)
>> >> >> >> >>>> >>> > >> >> >> >
>> >> >> >> >>>> >>> > >> >> >> > Robert
>> >> >> >> >>>> >>> > >> >> >> >
>> >> >> >> >>>> >>> > >> >> >> >
>> >> >> >> >>>> >>> > >> >> >> >
>> >> >> >> >>>> >>> > >> >> >> > On Fri, Nov 26, 2010 at 2:51 PM, Jacob van
>> >> >> >> >>>> >>> > >> >> >> > Etten
>> >> >> >> >>>> >>> > >> >> >> > <jacobvanetten at yahoo.com> wrote:
>> >> >> >> >>>> >>> > >> >> >> >> you could try this approach (use calc
>> >> >> >> >>>> >>> > >> >> >> >> whenever
>> >> >> >> >>>> >>> > >> >> >> >> you
>> >> >> >> >>>> >>> > >> >> >> >> can):
>> >> >> >> >>>> >>> > >> >> >> >>
>> >> >> >> >>>> >>> > >> >> >> >> (supposing your bricks have 12 layers)
>> >> >> >> >>>> >>> > >> >> >> >>
>> >> >> >> >>>> >>> > >> >> >> >> br3 <- stack(brick1, brick2)
>> >> >> >> >>>> >>> > >> >> >> >> lmS <- function(x) lm(x[1:12] ~
>> >> >> >> >>>> >>> > >> >> >> >> x[13:24)$coefficients[2]
>> >> >> >> >>>> >>> > >> >> >> >> r <- calc(br3, lmS)
>> >> >> >> >>>> >>> > >> >> >> >>
>> >> >> >> >>>> >>> > >> >> >> >> Jacob.
>> >> >> >> >>>> >>> > >> >> >> >>
>> >> >> >> >>>> >>> > >> >> >> >> --- On Fri, 26/11/10, steven mosher
>> >> >> >> >>>> >>> > >> >> >> >> <moshersteven at gmail.com>
>> >> >> >> >>>> >>> > >> >> >> >> wrote:
>> >> >> >> >>>> >>> > >> >> >> >>
>> >> >> >> >>>> >>> > >> >> >> >> From: steven mosher
>> >> >> >> >>>> >>> > >> >> >> >> <moshersteven at gmail.com>
>> >> >> >> >>>> >>> > >> >> >> >> Subject: Re: [R-sig-Geo] gridded time
>> >> >> >> >>>> >>> > >> >> >> >> series
>> >> >> >> >>>> >>> > >> >> >> >> analysis
>> >> >> >> >>>> >>> > >> >> >> >> To: "Martin" <martin_brandt at gmx.net>
>> >> >> >> >>>> >>> > >> >> >> >> Cc: r-sig-geo at stat.math.ethz.ch
>> >> >> >> >>>> >>> > >> >> >> >> Date: Friday, 26 November, 2010, 23:33
>> >> >> >> >>>> >>> > >> >> >> >>
>> >> >> >> >>>> >>> > >> >> >> >> that's cool, I'm also interested in a
>> >> >> >> >>>> >>> > >> >> >> >> similar
>> >> >> >> >>>> >>> > >> >> >> >> problem
>> >> >> >> >>>> >>> > >> >> >> >> but
>> >> >> >> >>>> >>> > >> >> >> >> just
>> >> >> >> >>>> >>> > >> >> >> >> with
>> >> >> >> >>>> >>> > >> >> >> >> one
>> >> >> >> >>>> >>> > >> >> >> >> brick ending up with a slope raster as the
>> >> >> >> >>>> >>> > >> >> >> >> output.
>> >> >> >> >>>> >>> > >> >> >> >> It
>> >> >> >> >>>> >>> > >> >> >> >> may be
>> >> >> >> >>>> >>> > >> >> >> >> possible
>> >> >> >> >>>> >>> > >> >> >> >> with
>> >> >> >> >>>> >>> > >> >> >> >> stackApply(). have a look. or maybe robert
>> >> >> >> >>>> >>> > >> >> >> >> will
>> >> >> >> >>>> >>> > >> >> >> >> chime
>> >> >> >> >>>> >>> > >> >> >> >> in
>> >> >> >> >>>> >>> > >> >> >> >>
>> >> >> >> >>>> >>> > >> >> >> >>
>> >> >> >> >>>> >>> > >> >> >> >>
>> >> >> >> >>>> >>> > >> >> >> >> On Fri, Nov 26, 2010 at 1:35 PM, Martin
>> >> >> >> >>>> >>> > >> >> >> >> <martin_brandt at gmx.net
>> >> >> >> >>>> >>> > >
>> >> >> >> >>>> >>> > >> >> >> >> wrote:
>> >> >> >> >>>> >>> > >> >> >> >>
>> >> >> >> >>>> >>> > >> >> >> >>>
>> >> >> >> >>>> >>> > >> >> >> >>> this is what I did to perform a
>> >> >> >> >>>> >>> > >> >> >> >>> regression
>> >> >> >> >>>> >>> > >> >> >> >>> between
>> >> >> >> >>>> >>> > >> >> >> >>> two
>> >> >> >> >>>> >>> > >> >> >> >>> bricks
>> >> >> >> >>>> >>> > >> >> >> >>> (each
>> >> >> >> >>>> >>> > >> >> >> >>> brick
>> >> >> >> >>>> >>> > >> >> >> >>> represent a time series):
>> >> >> >> >>>> >>> > >> >> >> >>>
>> >> >> >> >>>> >>> > >> >> >> >>> r <- raster(brick1)
>> >> >> >> >>>> >>> > >> >> >> >>> for (i in 1:ncell(r)) {
>> >> >> >> >>>> >>> > >> >> >> >>> r[i] = lm(as.ts(cellValues(brick1, i)) ~
>> >> >> >> >>>> >>> > >> >> >> >>> as.ts(cellValues(brick2,
>> >> >> >> >>>> >>> > >> >> >> >>> i)))$coefficients[2]
>> >> >> >> >>>> >>> > >> >> >> >>> }
>> >> >> >> >>>> >>> > >> >> >> >>>
>> >> >> >> >>>> >>> > >> >> >> >>> The result will be a slope raster, but it
>> >> >> >> >>>> >>> > >> >> >> >>> really
>> >> >> >> >>>> >>> > >> >> >> >>> takes a
>> >> >> >> >>>> >>> > >> >> >> >>> lot
>> >> >> >> >>>> >>> > of
>> >> >> >> >>>> >>> > >> >> >> >>> time,
>> >> >> >> >>>> >>> > >> >> >> >>> so
>> >> >> >> >>>> >>> > >> >> >> >>> maybe there is a better solution..
>> >> >> >> >>>> >>> > >> >> >> >>>
>> >> >> >> >>>> >>> > >> >> >> >>>
>> >> >> >> >>>> >>> > >> >> >> >>> --
>> >> >> >> >>>> >>> > >> >> >> >>> View this message in context:
>> >> >> >> >>>> >>> > >> >> >> >>>
>> >> >> >> >>>> >>> > >> >> >> >>>
>> >> >> >> >>>> >>> > >> >> >> >>>
>> >> >> >> >>>> >>> > >> >> >> >>>
>> >> >> >> >>>> >>> >
>> >> >> >> >>>> >>> >
>> >> >> >> >>>> >>> >
>> >> >> >> >>>> >>> >
>> >> >> >> >>>> >>> >
>> >> >> >> >>>> >>> >
>> >> >> >> >>>> >>> > http://r-sig-geo.2731867.n2.nabble.com/gridded-time-series-analysis-tp5775651p5778472.html
>> >> >> >> >>>> >>> > >> >> >> >>> Sent from the R-sig-geo mailing list
>> >> >> >> >>>> >>> > >> >> >> >>> archive
>> >> >> >> >>>> >>> > >> >> >> >>> at
>> >> >> >> >>>> >>> > >> >> >> >>> Nabble.com.
>> >> >> >> >>>> >>> > >> >> >> >>>
>> >> >> >> >>>> >>> > >> >> >> >>>
>> >> >> >> >>>> >>> > >> >> >> >>>
>> >> >> >> >>>> >>> > >> >> >> >>> _______________________________________________
>> >> >> >> >>>> >>> > >> >> >> >>> R-sig-Geo mailing list
>> >> >> >> >>>> >>> > >> >> >> >>> R-sig-Geo at stat.math.ethz.ch
>> >> >> >> >>>> >>> > >> >> >> >>>
>> >> >> >> >>>> >>> > >> >> >> >>>
>> >> >> >> >>>> >>> > >> >> >> >>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> >> >> >> >>>> >>> > >> >> >> >>>
>> >> >> >> >>>> >>> > >> >> >> >>
>> >> >> >> >>>> >>> > >> >> >> >> ? ? [[alternative HTML version deleted]]
>> >> >> >> >>>> >>> > >> >> >> >>
>> >> >> >> >>>> >>> > >> >> >> >>
>> >> >> >> >>>> >>> > >> >> >> >>
>> >> >> >> >>>> >>> > >> >> >> >> _______________________________________________
>> >> >> >> >>>> >>> > >> >> >> >> R-sig-Geo mailing list
>> >> >> >> >>>> >>> > >> >> >> >> R-sig-Geo at stat.math.ethz.ch
>> >> >> >> >>>> >>> > >> >> >> >>
>> >> >> >> >>>> >>> > >> >> >> >>
>> >> >> >> >>>> >>> > >> >> >> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> >> >> >> >>>> >>> > >> >> >> >>
>> >> >> >> >>>> >>> > >> >> >> >>
>> >> >> >> >>>> >>> > >> >> >> >>
>> >> >> >> >>>> >>> > >> >> >> >>
>> >> >> >> >>>> >>> > >> >> >> >> ? ? ? ?[[alternative HTML version
>> >> >> >> >>>> >>> > >> >> >> >> deleted]]
>> >> >> >> >>>> >>> > >> >> >> >>
>> >> >> >> >>>> >>> > >> >> >> >>
>> >> >> >> >>>> >>> > >> >> >> >>
>> >> >> >> >>>> >>> > >> >> >> >>
>> >> >> >> >>>> >>> > >> >> >> >> _______________________________________________
>> >> >> >> >>>> >>> > >> >> >> >> R-sig-Geo mailing list
>> >> >> >> >>>> >>> > >> >> >> >> R-sig-Geo at stat.math.ethz.ch
>> >> >> >> >>>> >>> > >> >> >> >>
>> >> >> >> >>>> >>> > >> >> >> >>
>> >> >> >> >>>> >>> > >> >> >> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> >> >> >> >>>> >>> > >> >> >> >>
>> >> >> >> >>>> >>> > >> >> >> >>
>> >> >> >> >>>> >>> > >> >> >> >
>> >> >> >> >>>> >>> > >> >> >>
>> >> >> >> >>>> >>> > >> >> >>
>> >> >> >> >>>> >>> > >> >> >> _______________________________________________
>> >> >> >> >>>> >>> > >> >> >> R-sig-Geo mailing list
>> >> >> >> >>>> >>> > >> >> >> R-sig-Geo at stat.math.ethz.ch
>> >> >> >> >>>> >>> > >> >> >>
>> >> >> >> >>>> >>> > >> >> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> >> >> >> >>>> >>> > >> >> >
>> >> >> >> >>>> >>> > >> >> >
>> >> >> >> >>>> >>> > >> >> >
>> >> >> >> >>>> >>> > >> >> > --
>> >> >> >> >>>> >>> > >> >> > advait godbole
>> >> >> >> >>>> >>> > >> >> >
>> >> >> >> >>>> >>> > >> >
>> >> >> >> >>>> >>> > >> >
>> >> >> >> >>>> >>> > >> >
>> >> >> >> >>>> >>> > >> > --
>> >> >> >> >>>> >>> > >> > advait godbole
>> >> >> >> >>>> >>> > >> >
>> >> >> >> >>>> >>> > >
>> >> >> >> >>>> >>> > >
>> >> >> >> >>>> >>> > >
>> >> >> >> >>>> >>> > > --
>> >> >> >> >>>> >>> > > advait godbole
>> >> >> >> >>>> >>> > >
>> >> >> >> >>>> >>> >
>> >> >> >> >>>> >>>
>> >> >> >> >>>> >>>
>> >> >> >> >>>> >>>
>> >> >> >> >>>> >>> --
>> >> >> >> >>>> >>> advait godbole
>> >> >> >> >>>> >>>
>> >> >> >> >>>> >>> ? ? ? ?[[alternative HTML version deleted]]
>> >> >> >> >>>> >>>
>> >> >> >> >>>> >>> _______________________________________________
>> >> >> >> >>>> >>> R-sig-Geo mailing list
>> >> >> >> >>>> >>> R-sig-Geo at r-project.org
>> >> >> >> >>>> >>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> >> >> >> >>>> >>
>> >> >> >> >>>> >>
>> >> >> >> >>>> >
>> >> >> >> >>>
>> >> >> >> >>>
>> >> >> >> >>>
>> >> >> >> >>> --
>> >> >> >> >>> advait godbole
>> >> >> >> >>
>> >> >> >> >>
>> >> >> >> >>
>> >> >> >> >> --
>> >> >> >> >> advait godbole
>> >> >> >> >
>> >> >> >> >
>> >> >> >
>> >> >> >
>> >> >> >
>> >> >> > --
>> >> >> > advait godbole
>> >> >> >
>> >> >
>> >> >
>> >> >
>> >> > --
>> >> > advait godbole
>> >> >
>> >
>> >
>> >
>> > --
>> > advait godbole
>> >
>
>
>
> --
> advait godbole
>


From advaitgodbole at gmail.com  Thu Dec 23 02:17:46 2010
From: advaitgodbole at gmail.com (Advait Godbole)
Date: Wed, 22 Dec 2010 20:17:46 -0500
Subject: [R-sig-Geo] gridded time series analysis
In-Reply-To: <AANLkTikrWWOzicMeLk4sEP_y9Dfo7fZk1gUmC5-6HRd5@mail.gmail.com>
References: <AANLkTimTdxzoDCfJQOB8bgQRhjLy3YzSbtGtMdijk9sQ@mail.gmail.com>
	<771411.8321.qm@web29709.mail.ird.yahoo.com>
	<AANLkTin2DYocWNOAR-LfGoBP4+gCtA7eVDHmoaQ6wriR@mail.gmail.com>
	<AANLkTimFw1zMH75s+TG+SFkBHfXzpURm2WXskAa8Kp=m@mail.gmail.com>
	<AANLkTim9dBnVkZ0tjvoa1YRpPRr156jJ9zcezMDrtzhX@mail.gmail.com>
	<AANLkTi=vW6NXYXKGNa0gcTfZ8ezEjvegdxU3Dt5SPA4F@mail.gmail.com>
	<AANLkTikqNmC62Pv-n9Dxd1w7fTHJPx8cR72U6YEtWMTV@mail.gmail.com>
	<AANLkTikQsL9opzu1i0mWxtJA6YmcgBbGdbihXFOwPRho@mail.gmail.com>
	<AANLkTinY5+3JbpZfWnriDZNOdmcfic0628Qi0=NDZghK@mail.gmail.com>
	<AANLkTikd-PJKWZdWUL2+S9VYAq1QJ4LPwG2==erEs2+Q@mail.gmail.com>
	<AANLkTi=eZL0Rq5EyoRA29fdnN2VL-Xt6hcGN4DnZgCKk@mail.gmail.com>
	<AANLkTikVto4GD=vO=5YKwKXL7y+Ze4ADn2KXpsw1AFVA@mail.gmail.com>
	<AANLkTinUvhmDLP2YSWuqb5=G0YKX=sWp6yMOj9KPAgdA@mail.gmail.com>
	<AANLkTi=P5HNFjEsaapUBF7vSAFAsekU_4bYJqXnW=gbu@mail.gmail.com>
	<AANLkTikwWainpBBeSr8xnNNq8uoFXdU2n_34y2-u6K5J@mail.gmail.com>
	<AANLkTin5-hV=b8yxQnvviF_4w-uPfsSJ9X82pmbi=WQo@mail.gmail.com>
	<AANLkTikmPMvBRuu6RvjXsd8LdJc38FP+tAiF9iAc31Ks@mail.gmail.com>
	<AANLkTikSowU_SFiCmZyE3TKEa_UesH_SDQdPP63i+ERY@mail.gmail.com>
	<AANLkTi=p+LbmQ96GSJFuYyw-HLcCxJgYqaK4n2pBZcbG@mail.gmail.com>
	<AANLkTinvp-k47MHyV2s+hje_P0VXHvTmOKPFf8q5btAO@mail.gmail.com>
	<AANLkTi=S8tY50xzS2PFS7LvUEMT4cb4TFME-kT7DkmS0@mail.gmail.com>
	<AANLkTims2FyRBiLdmtZzR8wwvrBSyMuepVe0_Li-B6nU@mail.gmail.com>
	<AANLkTinzLPLDhoLwpcRkJ4twJ+FFd=ukOYpHh220S2mE@mail.gmail.com>
	<AANLkTikmm6QvAC69cPG7i4bT6wmWVBfwpO-4mHZ7JEvL@mail.gmail.com>
	<AANLkTikAMe3C=hQon56eh3nQd_G6gHJ=iQPh0JyJhqJ7@mail.gmail.com>
	<AANLkTikrWWOzicMeLk4sEP_y9Dfo7fZk1gUmC5-6HRd5@mail.gmail.com>
Message-ID: <AANLkTikXrGQSTKsey9u+rXFsnVtmszown6PV0i0ca7mQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101222/137bce80/attachment.pl>

From hadley at rice.edu  Thu Dec 23 02:36:26 2010
From: hadley at rice.edu (Hadley Wickham)
Date: Wed, 22 Dec 2010 19:36:26 -0600
Subject: [R-sig-Geo] gridded time series analysis
In-Reply-To: <AANLkTikAMe3C=hQon56eh3nQd_G6gHJ=iQPh0JyJhqJ7@mail.gmail.com>
References: <AANLkTimTdxzoDCfJQOB8bgQRhjLy3YzSbtGtMdijk9sQ@mail.gmail.com>
	<771411.8321.qm@web29709.mail.ird.yahoo.com>
	<AANLkTin2DYocWNOAR-LfGoBP4+gCtA7eVDHmoaQ6wriR@mail.gmail.com>
	<AANLkTimFw1zMH75s+TG+SFkBHfXzpURm2WXskAa8Kp=m@mail.gmail.com>
	<AANLkTim9dBnVkZ0tjvoa1YRpPRr156jJ9zcezMDrtzhX@mail.gmail.com>
	<AANLkTi=vW6NXYXKGNa0gcTfZ8ezEjvegdxU3Dt5SPA4F@mail.gmail.com>
	<AANLkTikqNmC62Pv-n9Dxd1w7fTHJPx8cR72U6YEtWMTV@mail.gmail.com>
	<AANLkTikQsL9opzu1i0mWxtJA6YmcgBbGdbihXFOwPRho@mail.gmail.com>
	<AANLkTinY5+3JbpZfWnriDZNOdmcfic0628Qi0=NDZghK@mail.gmail.com>
	<AANLkTikd-PJKWZdWUL2+S9VYAq1QJ4LPwG2==erEs2+Q@mail.gmail.com>
	<AANLkTi=eZL0Rq5EyoRA29fdnN2VL-Xt6hcGN4DnZgCKk@mail.gmail.com>
	<AANLkTikVto4GD=vO=5YKwKXL7y+Ze4ADn2KXpsw1AFVA@mail.gmail.com>
	<AANLkTinUvhmDLP2YSWuqb5=G0YKX=sWp6yMOj9KPAgdA@mail.gmail.com>
	<AANLkTi=P5HNFjEsaapUBF7vSAFAsekU_4bYJqXnW=gbu@mail.gmail.com>
	<AANLkTikwWainpBBeSr8xnNNq8uoFXdU2n_34y2-u6K5J@mail.gmail.com>
	<AANLkTin5-hV=b8yxQnvviF_4w-uPfsSJ9X82pmbi=WQo@mail.gmail.com>
	<AANLkTikmPMvBRuu6RvjXsd8LdJc38FP+tAiF9iAc31Ks@mail.gmail.com>
	<AANLkTikSowU_SFiCmZyE3TKEa_UesH_SDQdPP63i+ERY@mail.gmail.com>
	<AANLkTi=p+LbmQ96GSJFuYyw-HLcCxJgYqaK4n2pBZcbG@mail.gmail.com>
	<AANLkTinvp-k47MHyV2s+hje_P0VXHvTmOKPFf8q5btAO@mail.gmail.com>
	<AANLkTi=S8tY50xzS2PFS7LvUEMT4cb4TFME-kT7DkmS0@mail.gmail.com>
	<AANLkTims2FyRBiLdmtZzR8wwvrBSyMuepVe0_Li-B6nU@mail.gmail.com>
	<AANLkTinzLPLDhoLwpcRkJ4twJ+FFd=ukOYpHh220S2mE@mail.gmail.com>
	<AANLkTikmm6QvAC69cPG7i4bT6wmWVBfwpO-4mHZ7JEvL@mail.gmail.com>
	<AANLkTikAMe3C=hQon56eh3nQd_G6gHJ=iQPh0JyJhqJ7@mail.gmail.com>
Message-ID: <AANLkTimxb1cYYxZmJXnmMV2bnE=wiG_z_-2G1BFgSmMP@mail.gmail.com>

On Wed, Dec 22, 2010 at 12:39 PM, Advait Godbole
<advaitgodbole at gmail.com> wrote:
> Dear Members,
>
> I was able to find a solution after some deliberation and posting it here
> for the benefit of forum members.
>
> To recap, my data was in the form of 2 netCDF files, each of dimension 356 x
> 507 x 120 (lat,lon,time). I wanted to perform regressions between the two
> variables on each grid point *over time*. I used "brick" to read in the
> netcdfs as raster layers and stack along with the "*plyr"* package to
> perform these regressions on the grid.
>
> # create raster object from the netcdf
> rcmraster <- brick("regcm.cumul.hdd.10k.96_05.fixed.latlonvars.nc", varname
> = "hdd")
>
> emitraster <- brick("
> flip.percap.vulcan.10k.dp.build.381.RES.EIAmy.96_05.this.latest.nc
> ",varname="emitpercap")
>
> # crop subset of above rasters, test method on subset which is 4 x 4 x 120
> lim <- extent(rcmraster,180,185,300,305)
> rcmraster_crop <- crop(rcmraster,lim)
> emitraster_crop <- crop(emitraster,lim)
>
> # do some plotting to check
> ?par(mfrow=c(1,2))
> ?plot(rcmraster_crop[[1]])
> ?plot(emitraster_crop[[1]])
>
> # test regressions for cropped subset
> s_crop <- stack(emitraster_crop,rcmraster_crop)
>
> # use of plyr (provides a more elegant alternative to lapply)
> # the data frame datCoef contains the slope and intercept for each point in
> the grid (denoted by X1 and X2)
> datCoef = adply( as.array(s_crop) , 1:2 ,
> ? ? ? ? ? ? ?function(x ) {
> ? ? ? ? ? ? ? ? ? ? ? ? ? ?resp = x[1:120]
> ? ? ? ? ? ? ? ? ? ? ? ? ? ?expl = x[121:240]
> ? ? ? ? ? ? ? ? ? ? ? ? ? ?mdl = lm(resp ~ expl)
> ? ? ? ? ? ? ? ? ? ? ? ? ? ?res = c(mdl$coef[1] , mdl$coef[2])
> ? ? ? ? ? ? ? ? ? ? ? ? ? ?return(res)
>
> ? ? ? ? ? ? ? ? ? ? ? ? ?}
> ? ? ? ? ? ? ? ? ? ? ? ? ?)

I'd do this in two steps:

models <- alply( as.array(s_crop) , 1:2, function(x) {
  resp = x[1:120]
  expl = x[121:240]
  lm(resp ~ expl)
}

Then you can access coefficients with

 ldply(models, coef)

and predictions with

 laply(models, predict)

but I think you might need to manipulate the output of predict to get
the matrix shape that you are expecting.

Hadley

-- 
Assistant Professor / Dobelman Family Junior Chair
Department of Statistics / Rice University
http://had.co.nz/


From matzke at berkeley.edu  Thu Dec 23 02:54:36 2010
From: matzke at berkeley.edu (Nick Matzke)
Date: Wed, 22 Dec 2010 17:54:36 -0800
Subject: [R-sig-Geo] img file
In-Reply-To: <AANLkTikhehm28frNbMvrDBGz4s7=LLy=XG9L0ghraBD4@mail.gmail.com>
References: <4D129B98.1080807@berkeley.edu>
	<AANLkTikhehm28frNbMvrDBGz4s7=LLy=XG9L0ghraBD4@mail.gmail.com>
Message-ID: <4D12ABDC.1040807@berkeley.edu>

Thanks!!  I did an update of raster before our previous 
emails, but apaprently it didn't take, even after:

 > rm(list=ls(all=TRUE))
 >
 > Close R&  save workspace (answer = yes)

...what it took was (at Mac Terminal):

==========
   486  cd 
/Library/Frameworks/R.framework/Versions/2.10/Resources/library/
   487  ls
   488  cd raster
   489  ls
   490  cd ..
   491  rm -R raster
   492  ls
==========

(On Mac OS X, R.app gui)

And then in R.app gui:

========
rm(list=ls(all=TRUE))

Restart (save workspace = yes)

Packages --> Package Installer --> Local Source Package --> 
Install --> raster_1.7-18.tgz (downloaded manually from CRAN)
========

So now the below works.  Thanks!  I'm cross-posting to 
r-sig-geo for posterity.

Cheers!
Nick


On 12/22/10 5:17 PM, Robert J. Hijmans wrote:
> Hi Nick,
>
> r<- brick('clip_1.img')
> plotRGB(r)
>
> works all right for me.
>
> raster_1.1.7
>
> is very old. Did you just update? You should get 1.7-18. See
> http://cran.r-project.org/web/packages/raster/index.html
>
> Perhaps you need to close and open R first? Or else try:
>
> rm(list=ls(all=TRUE))
>
> Close R&  save workspace (answer = yes)
>
> open R and install raster again.
>
> Robert
>
>

-- 
====================================================
Nicholas J. Matzke
Ph.D. Candidate, Graduate Student Researcher
Huelsenbeck Lab
Center for Theoretical Evolutionary Genomics
4151 VLSB (Valley Life Sciences Building)
Department of Integrative Biology
University of California, Berkeley

Graduate Student Instructor, IB200A
Principles of Phylogenetics: Systematics
http://ib.berkeley.edu/courses/ib200a/index.shtml

Lab websites:
http://ib.berkeley.edu/people/lab_detail.php?lab=54
http://fisher.berkeley.edu/cteg/hlab.html
Dept. personal page: 
http://ib.berkeley.edu/people/students/person_detail.php?person=370
Lab personal page: 
http://fisher.berkeley.edu/cteg/members/matzke.html
Lab phone: 510-643-6299
Dept. fax: 510-643-6264
Cell phone: 510-301-0179
Email: matzke at berkeley.edu

Mailing address:
Department of Integrative Biology
3060 VLSB #3140
Berkeley, CA 94720-3140

-----------------------------------------------------
"[W]hen people thought the earth was flat, they were wrong. 
When people thought the earth was spherical, they were 
wrong. But if you think that thinking the earth is spherical 
is just as wrong as thinking the earth is flat, then your 
view is wronger than both of them put together."

Isaac Asimov (1989). "The Relativity of Wrong." The 
Skeptical Inquirer, 14(1), 35-44. Fall 1989.
http://chem.tufts.edu/AnswersInScience/RelativityofWrong.htm


From advaitgodbole at gmail.com  Thu Dec 23 03:40:39 2010
From: advaitgodbole at gmail.com (Advait Godbole)
Date: Wed, 22 Dec 2010 21:40:39 -0500
Subject: [R-sig-Geo] gridded time series analysis, using plyr
Message-ID: <AANLkTim9asjEDNNQ3+o6DDakLUDhS_7CDxC03irpXzc_@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101222/0324edfa/attachment.pl>

From advaitgodbole at gmail.com  Thu Dec 23 04:18:41 2010
From: advaitgodbole at gmail.com (Advait Godbole)
Date: Wed, 22 Dec 2010 22:18:41 -0500
Subject: [R-sig-Geo] gridded time series analysis
In-Reply-To: <AANLkTikXrGQSTKsey9u+rXFsnVtmszown6PV0i0ca7mQ@mail.gmail.com>
References: <AANLkTimTdxzoDCfJQOB8bgQRhjLy3YzSbtGtMdijk9sQ@mail.gmail.com>
	<771411.8321.qm@web29709.mail.ird.yahoo.com>
	<AANLkTin2DYocWNOAR-LfGoBP4+gCtA7eVDHmoaQ6wriR@mail.gmail.com>
	<AANLkTimFw1zMH75s+TG+SFkBHfXzpURm2WXskAa8Kp=m@mail.gmail.com>
	<AANLkTim9dBnVkZ0tjvoa1YRpPRr156jJ9zcezMDrtzhX@mail.gmail.com>
	<AANLkTi=vW6NXYXKGNa0gcTfZ8ezEjvegdxU3Dt5SPA4F@mail.gmail.com>
	<AANLkTikqNmC62Pv-n9Dxd1w7fTHJPx8cR72U6YEtWMTV@mail.gmail.com>
	<AANLkTikQsL9opzu1i0mWxtJA6YmcgBbGdbihXFOwPRho@mail.gmail.com>
	<AANLkTinY5+3JbpZfWnriDZNOdmcfic0628Qi0=NDZghK@mail.gmail.com>
	<AANLkTikd-PJKWZdWUL2+S9VYAq1QJ4LPwG2==erEs2+Q@mail.gmail.com>
	<AANLkTi=eZL0Rq5EyoRA29fdnN2VL-Xt6hcGN4DnZgCKk@mail.gmail.com>
	<AANLkTikVto4GD=vO=5YKwKXL7y+Ze4ADn2KXpsw1AFVA@mail.gmail.com>
	<AANLkTinUvhmDLP2YSWuqb5=G0YKX=sWp6yMOj9KPAgdA@mail.gmail.com>
	<AANLkTi=P5HNFjEsaapUBF7vSAFAsekU_4bYJqXnW=gbu@mail.gmail.com>
	<AANLkTikwWainpBBeSr8xnNNq8uoFXdU2n_34y2-u6K5J@mail.gmail.com>
	<AANLkTin5-hV=b8yxQnvviF_4w-uPfsSJ9X82pmbi=WQo@mail.gmail.com>
	<AANLkTikmPMvBRuu6RvjXsd8LdJc38FP+tAiF9iAc31Ks@mail.gmail.com>
	<AANLkTikSowU_SFiCmZyE3TKEa_UesH_SDQdPP63i+ERY@mail.gmail.com>
	<AANLkTi=p+LbmQ96GSJFuYyw-HLcCxJgYqaK4n2pBZcbG@mail.gmail.com>
	<AANLkTinvp-k47MHyV2s+hje_P0VXHvTmOKPFf8q5btAO@mail.gmail.com>
	<AANLkTi=S8tY50xzS2PFS7LvUEMT4cb4TFME-kT7DkmS0@mail.gmail.com>
	<AANLkTims2FyRBiLdmtZzR8wwvrBSyMuepVe0_Li-B6nU@mail.gmail.com>
	<AANLkTinzLPLDhoLwpcRkJ4twJ+FFd=ukOYpHh220S2mE@mail.gmail.com>
	<AANLkTikmm6QvAC69cPG7i4bT6wmWVBfwpO-4mHZ7JEvL@mail.gmail.com>
	<AANLkTikAMe3C=hQon56eh3nQd_G6gHJ=iQPh0JyJhqJ7@mail.gmail.com>
	<AANLkTikrWWOzicMeLk4sEP_y9Dfo7fZk1gUmC5-6HRd5@mail.gmail.com>
	<AANLkTikXrGQSTKsey9u+rXFsnVtmszown6PV0i0ca7mQ@mail.gmail.com>
Message-ID: <AANLkTimVUyCGiM_uYGXWZo8JBf=nOevTiDvkZ36RCvbB@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101222/311dde95/attachment.pl>

From alobolistas at gmail.com  Thu Dec 23 08:06:36 2010
From: alobolistas at gmail.com (Agustin Lobo)
Date: Thu, 23 Dec 2010 08:06:36 +0100
Subject: [R-sig-Geo] Help with rgdal on MACOS
Message-ID: <AANLkTi=uLUA29C-qJFZ4ZCSJyifLvLowisYaFOc25MBC@mail.gmail.com>

Dea all,

Quite a number of students will be using MAC for a course in which we
will make use
of rgdal and raster. As I do not have an easy access to MAC machines
and I've found quite
a number of different options, I'm seeking some clarifications.

Students will have gdal and other dependencies installed from
kyngchaos as they should have QGIS installed.
Under these circumstances, which alternative is better:

1. As suggested by Roger in
http://r-sig-geo.2731867.n2.nabble.com/rgdal-on-MAC-td5073766.html
> setRepositories(ind=1:2)
> install.packages('rgdal')

2. Install rgdal from source.
2.1. As stated at the end of
http://spatialanalysis.co.uk/2010/11/02/installing-rgdal-on-mac-os-x/
> R CMD INSTALL
 ?configure-args=??with-gdal-config=/Library/Frameworks/GDAL.framework/unix/bin/gdal-config
 ?with-proj-lib=/Library/Frameworks/PROJ.framework/unix/lib
 ?with-proj-include=/Library/Frameworks/PROJ.framework/unix/include?
rgdal_0.6-20.tar.gz
2.2. Using homebrew:
brew install gdal
R CMD INSTALL ?configure-args=??with-proj-include=/usr/local/lib?
rgdal_0.6-28.tar.gz
(in this case, is the brew command using the kyngchaos gdal?)

3. Other alternatives

Thanks

Agus


From christian.kamenik at giub.unibe.ch  Thu Dec 23 08:20:56 2010
From: christian.kamenik at giub.unibe.ch (Christian Kamenik)
Date: Thu, 23 Dec 2010 08:20:56 +0100
Subject: [R-sig-Geo] Converting array into raster brick
In-Reply-To: <AANLkTinOR=qye2UNu1QxsDxLZX7mvsyNf29dLRFHWq1g@mail.gmail.com>
References: <20101216212615.14013deot59etvc7@mail.unibe.ch>	<AANLkTi=hC_CsXPsszhF5z0hxxMSV4sKv5X+3wjnP_sGT@mail.gmail.com>	<AANLkTi=5+xjc=cK_xzj7G_gUuX+94fLk5JNDE=YQWNBk@mail.gmail.com>	<AANLkTikFt3eJHSpjB9ssMODU5P1kK5x5DVxugoVA=inf@mail.gmail.com>	<AANLkTikwhkDRTKM0PnjV-xt395OhD_gYx65a=hAXWHXe@mail.gmail.com>	<4D11DBCB.80604@giub.unibe.ch>
	<AANLkTinOR=qye2UNu1QxsDxLZX7mvsyNf29dLRFHWq1g@mail.gmail.com>
Message-ID: <4D12F858.1070400@giub.unibe.ch>

Works like a charm - awesome!

Many thanks, Christian


> Christian,
>
> You should also be able to do this:
>
> out<- setValues(x, xx)
>
> (where x is a RasterBrick and xx a matching 3 dimensional array)
>
> Robert
>
> On Wed, Dec 22, 2010 at 3:06 AM, Christian Kamenik
> <christian.kamenik at giub.unibe.ch>  wrote:
>> Dear all,
>>
>> I replaced my layer-by-layer approach
>>
>> for (l in 1:nlayers(x)) x
>> <-setValues(x,values=as.vector(t(xx[,,l])),layer=l)
>>
>> with the new functionality of brick
>>
>> out<-
>> brick(xx,xmn=slot(extent(x),'xmin'),xmx=slot(extent(x),'xmax'),ymn=slot(extent(x),'ymin'),ymx=slot(extent(x),'ymax'),crs=projection(x))
>>
>> where x is the original RasterBrick, xx is a three-dimensional array and out
>> is the new RasterBrick.
>>
>> It worked perfectly fine!
>>
>> Many thanks, Christian
>>
>>> updated function, without redundant  sapply. R
>>>
>>> library(raster)
>>> # new method, included in raster 1.7-17
>>> setMethod('brick', signature(x='array'),
>>>         function(x, xmn=0, xmx=1, ymn=0, ymx=1, crs=NA) {
>>>                 dm<- dim(x)
>>>                 if (length(dm) != 3) {
>>>                         stop('array has wrong dimensions')
>>>                 }
>>>                 b<- brick(xmn=xmn, xmx=xmx, ymn=ymn, ymx=ymx, crs=crs)
>>>                 dim(b)<- dm
>>>                 setValues(b, matrix(as.vector(x), ncol=dm[3]))
>>>         }
>>> )
>>>
>>> On Sun, Dec 19, 2010 at 8:06 AM, Robert J. Hijmans<r.hijmans at gmail.com>
>>>   wrote:
>>>> Agus,
>>>>
>>>> I have added an new method for 'brick', included below
>>>>
>>>> library(raster)
>>>> # new method, included in raster 1.7-17
>>>> setMethod('brick', signature(x='array'),
>>>>         function(x, xmn=0, xmx=1, ymn=0, ymx=1, crs=NA) {
>>>>                 dm<- dim(x)
>>>>                 if (length(dm) != 3) {
>>>>                         stop('array has wrong dimensions')
>>>>                 }
>>>>                 b<- brick(xmn=xmn, xmx=xmx, ymn=ymn, ymx=ymx, crs=crs)
>>>>                 dim(b)<- dm
>>>>                 setValues(b, matrix(sapply(x, as.vector), ncol=dm[3]))
>>>>         }
>>>> )
>>>>
>>>> r = raster(nrow=5, ncol=5)
>>>> r[] = 1:25
>>>> s = stack(r,r*2,r*3)
>>>>
>>>> a = as.array(s)
>>>> b = brick(a)
>>>> # values of b are the same as those of a
>>>> sum(getValues(s) != getValues(b))
>>>>
>>>> Best, Robert
>>>> On Sun, Dec 19, 2010 at 3:20 AM, Agustin Lobo<alobolistas at gmail.com>
>>>>   wrote:
>>>>> Robert,
>>>>>
>>>>> Converting from a regular 3D array to brick is probably going to be
>>>>> quite a  common operation,
>>>>> perhaps you could consider a simpler syntax in the future, i,e:
>>>>>
>>>>> r = as.brick(x)
>>>>>
>>>>> where x would be a 3D array?
>>>>>
>>>>> Agus
>>>>>
>>>>> 2010/12/16 Robert J. Hijmans<r.hijmans at gmail.com>:
>>>>>> Christian,
>>>>>>
>>>>>> Could be quicker if you make a matrix out of the array (or, if
>>>>>> possible, avoid the array in the first place). See below
>>>>>>
>>>>>> library(raster)
>>>>>>
>>>>>> # create an array
>>>>>> m<- matrix(1:100, ncol=10, byrow=TRUE)
>>>>>> a<- array(list(m, m, m, m, m))
>>>>>>
>>>>>> # empty RasterBrick
>>>>>> x<- brick(ncol=10, nrow=10)
>>>>>>
>>>>>> # make matrix from array
>>>>>> v<- sapply(a, function(x) as.vector(t(x)))
>>>>>>
>>>>>> x<- setValues(x, v)
>>>>>> plot(x)
>>>>>>
>>>>>>
>>>>>> Best, Robert
>>>>>>
>>>>>> On Thu, Dec 16, 2010 at 12:26 PM,<christian.kamenik at giub.unibe.ch>
>>>>>>   wrote:
>>>>>>> Dear all,
>>>>>>>
>>>>>>> I needed to convert an array into a RasterBrick object. The output did
>>>>>>> not
>>>>>>> need to be written to memory, as assessed by canProcessInMemory(). The
>>>>>>> only
>>>>>>> way to put the data into the RasterBrick that worked for me was layer
>>>>>>> by
>>>>>>> layer:
>>>>>>>
>>>>>>> for (l in 1:nlayers(x)) x
>>>>>>> <-setValues(x,values=as.vector(t(xx[,,l])),layer=l)
>>>>>>>
>>>>>>> This was quite complicated and slow. So I am wondering if there is a
>>>>>>> better
>>>>>>> way of doing this.
>>>>>>>
>>>>>>> Many thanks, Christian
>>>>>>>
>>>>>>> _______________________________________________
>>>>>>> R-sig-Geo mailing list
>>>>>>> R-sig-Geo at r-project.org
>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>>>
>>>>>> _______________________________________________
>>>>>> R-sig-Geo mailing list
>>>>>> R-sig-Geo at r-project.org
>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>>
>>
>> --
>> -----------------------------------------------
>> Oeschger Centre for Climate Change Research, Institute of Geography&
>>   Institute of Plant Sciences
>> University of Bern
>>
>> http://www.stomatocysts.unibe.ch/kamenik
>> mailto: christian.kamenik at giub.unibe.ch
>>
>> Postal address:
>> Dr. Christian Kamenik
>> Institute of Geography
>> Erlachstrasse 9a, Trakt 3
>> 3012 Bern, Switzerland
>>
>> Tel. +41 (0)31 631 5091
>> Fax +41 (0)31 631 43 38
>>
>>


-- 
-----------------------------------------------
Oeschger Centre for Climate Change Research, Institute of Geography&  Institute of Plant Sciences
University of Bern

http://www.stomatocysts.unibe.ch/kamenik
mailto: christian.kamenik at giub.unibe.ch

Postal address:
Dr. Christian Kamenik
Institute of Geography
Erlachstrasse 9a, Trakt 3
3012 Bern, Switzerland

Tel. +41 (0)31 631 5091
Fax +41 (0)31 631 43 38


From alobolistas at gmail.com  Thu Dec 23 08:36:35 2010
From: alobolistas at gmail.com (Agustin Lobo)
Date: Thu, 23 Dec 2010 08:36:35 +0100
Subject: [R-sig-Geo] Help with rgdal on MACOS
In-Reply-To: <AANLkTi=uLUA29C-qJFZ4ZCSJyifLvLowisYaFOc25MBC@mail.gmail.com>
References: <AANLkTi=uLUA29C-qJFZ4ZCSJyifLvLowisYaFOc25MBC@mail.gmail.com>
Message-ID: <AANLkTimhDymngrp5sbu9EDzRNk1cnKyzC6Zu85PjK4O=@mail.gmail.com>

Actually, more alternatives:

3. Suggested by Ralf Strasse:
Install Xcode tools from Apple (is recommended anyway for many
applications). This will install several compilers.Afterwards
installing from source should work fine.
http://developer.apple.com/technologies/tools/xcode.html
And also select on CRAN under Mac OS X installation "Tools" and
installe gfortran (and the other two - you may need them another
time).
install.packages("rgdal",
configure.args='--with-gdal-config=/Library/Frameworks/GDAL.Framework/Unix/bin/gdal-config
--with-proj-include=/Library/Frameworks/PROJ.framework/unix/include-with-proj-lib=/Library/Frameworks/PROJ.framework/unix/lib/',dependencies=TRUE,
type="source")

4. Downloading binary from kyngchaos
http://www.kyngchaos.com/software/frameworks?s[]=rgdal
and installing with
install.packages("~/Downloads/rgdal-0.6.29-1.zip")
(I'm guessing the directory, is this the downloading directory by
default in Macs?)

Any advice on which one is the best alternative?

Thanks

Agus

2010/12/23 Agustin Lobo <alobolistas at gmail.com>:
> Dea all,
>
> Quite a number of students will be using MAC for a course in which we
> will make use
> of rgdal and raster. As I do not have an easy access to MAC machines
> and I've found quite
> a number of different options, I'm seeking some clarifications.
>
> Students will have gdal and other dependencies installed from
> kyngchaos as they should have QGIS installed.
> Under these circumstances, which alternative is better:
>
> 1. As suggested by Roger in
> http://r-sig-geo.2731867.n2.nabble.com/rgdal-on-MAC-td5073766.html
>> setRepositories(ind=1:2)
>> install.packages('rgdal')
>
> 2. Install rgdal from source.
> 2.1. As stated at the end of
> http://spatialanalysis.co.uk/2010/11/02/installing-rgdal-on-mac-os-x/
>> R CMD INSTALL
> ??configure-args=??with-gdal-config=/Library/Frameworks/GDAL.framework/unix/bin/gdal-config
> ??with-proj-lib=/Library/Frameworks/PROJ.framework/unix/lib
> ??with-proj-include=/Library/Frameworks/PROJ.framework/unix/include?
> rgdal_0.6-20.tar.gz
> 2.2. Using homebrew:
> brew install gdal
> R CMD INSTALL ?configure-args=??with-proj-include=/usr/local/lib?
> rgdal_0.6-28.tar.gz
> (in this case, is the brew command using the kyngchaos gdal?)
>
> 3. Other alternatives
>
> Thanks
>
> Agus
>


From b.rowlingson at lancaster.ac.uk  Thu Dec 23 09:35:13 2010
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Thu, 23 Dec 2010 08:35:13 +0000
Subject: [R-sig-Geo] Help with rgdal on MACOS
In-Reply-To: <AANLkTimhDymngrp5sbu9EDzRNk1cnKyzC6Zu85PjK4O=@mail.gmail.com>
References: <AANLkTi=uLUA29C-qJFZ4ZCSJyifLvLowisYaFOc25MBC@mail.gmail.com>
	<AANLkTimhDymngrp5sbu9EDzRNk1cnKyzC6Zu85PjK4O=@mail.gmail.com>
Message-ID: <AANLkTi=K2EmR2yNLUEzaz7PzTS9JuCQs5rhuy5x5Vf9Y@mail.gmail.com>

On Thu, Dec 23, 2010 at 7:36 AM, Agustin Lobo <alobolistas at gmail.com> wrote:

> 4. Downloading binary from kyngchaos
> http://www.kyngchaos.com/software/frameworks?s[]=rgdal
> and installing with
> install.packages("~/Downloads/rgdal-0.6.29-1.zip")
> (I'm guessing the directory, is this the downloading directory by
> default in Macs?)
>
> Any advice on which one is the best alternative?
>

 I was recently asked by a new student with a Mac to sort out how to
read shapefiles into R for her. I know nothing about Mac packaging,
binaries, compilers etc, and she knew even less.

 After reading far too many confusing 'how to get rgdal working on a
Mac' mailing list messages, I got it working. What I think I did was:

 1. Download the kyngchaos GDAL Complete 'Framework':
http://www.kyngchaos.com/files/software/frameworks/GDAL_Complete-1.7.dmg
 2. Double click it, I think that opened it up and then somehow things
from that get installed. Wish I'd kept screenshots
 2.5 Wonder where in the .dmg file the rgdal binary is.
 3. Download the kyngchaos rgdal binary:
http://www.kyngchaos.com/files/software/frameworks/rgdal-0.6.29-1.zip
and did install.packages on that.

 - this is your method 4 spelt out!

I did get the fear that I was going to have to figure out what 'Xcode'
was, and that led me to the Apple developer page, and that seemed to
require an account - and a paid account at that - but then maybe Steve
Jobs thought I was going to try and write an iPhone app. I was at the
point of giving up and saying 'this is your laptop, you are the
superuser, you sort it out' when I spotted the rgdal binaries (which
weren't downloaded with the 'Framework', whatever one of those is).

 A walkthrough of installing rgdal for Mac with screenshots by this
method would be much appreciated. Too many non-techie people are
bringing Macs into the world and expecting techies with only Linux
(and a smidge of Windows) experience to fix them up. William
Kyngsbury's Mac resources are clearly a wonderful thing, but the
documentation for non Mac-heads is a bit sparse.

Barry


From dorina.lazar at econ.ubbcluj.ro  Thu Dec 23 09:56:29 2010
From: dorina.lazar at econ.ubbcluj.ro (dorina.lazar)
Date: Thu, 23 Dec 2010 10:56:29 +0200
Subject: [R-sig-Geo] spatial clusters
In-Reply-To: <alpine.LRH.2.00.1012221312280.23637@reclus.nhh.no>
References: <eef95d9fa8d1c8a6350635788deab411@econ.ubbcluj.ro>
	<alpine.LRH.2.00.1012210919580.19187@reclus.nhh.no>
	<46b879577c06b22cda658caecae9fc5c@econ.ubbcluj.ro>
	<alpine.LRH.2.00.1012221312280.23637@reclus.nhh.no>
Message-ID: <92de575f75ab3fedd413fe3f2228f0fe@econ.ubbcluj.ro>


Dear all,

Yes!!!   I succeed in my application related to SKATER algorithm; I begin
to find spatial statistics a very interesting field of research. 

Thanks a lot for your help, specially  to Roger and Georg.

I wish all of you A Merry Christmas and an Happy and Prosperous 2011! 
Dorina  


On Wed, 22 Dec 2010 13:16:55 +0100 (CET), Roger Bivand
<Roger.Bivand at nhh.no> wrote:
> On Wed, 22 Dec 2010, dorina.lazar wrote:
> 
>>
>> Dear Roger,
>>
>> Thanks, your suggestions was helpful. I think I exaggerated the
>> questions,
>> but for all countries:  ?Error in mstree(le, 5): Graph is not
>> connected!?; taking only some samples of countries the graph is
>> connected. There is something to be done in this case?
> 
> If I understand the approach used in SKATER correctly, there may only be

> one graph component, linking all the observations; check with:
> 
> n.comp.nb(nb)$nc
> 
> which I think must be 1. Otherwise it will not be able to divide the 
> (single) graph into clusters, because the input object imposes its own 
> subgraphs. Make sure that your samples meet the condition that:
> 
> n.comp.nb(nb)$nc == 1
> 
> Roger
> 
>>
>> All the best,
>> Dorina
>>
>>
>>
>> On Tue, 21 Dec 2010 09:40:35 +0100 (CET), Roger Bivand
>> <Roger.Bivand at nhh.no> wrote:
>>> On Mon, 20 Dec 2010, dorina.lazar wrote:
>>>
>>>>
>>>> Dear all,
>>>>
>>>> Finally, with your help, I make some progress to apply SKATER
algorithm
>>>> to
>>>> European countries.
>>>>
>>>> Here is the R code, following the example from  spdep package pdf:
>>>>
>>>>> country<-wrld_simpl[wrld_simpl$ISO3%in%c("AZE", "ALB", "ARM", "BIH",
>>>> "BGR", "CYP", "DNK", "IRL", "EST", "AUT", "CZE", "FIN",  "FRA",
"GEO",
>>>> "DEU", "GRC", "HRV", "HUN", "ISL", "ITA", "LVA", "BLR", "LTU", "SVK",
>>>> "LIE", "MLT", "BEL", "AND",  "LUX", "MCO", "NLD", "NOR", "POL",
"PRT",
>>>> "ROU", "MDA", "RUS", "SVN"),]
>>>>> ske<-spCbind(country, rclasif)
>>>>> ske at data
>>>>> de <- data.frame(scale(ske at data[13]))   #col 13 contains the health
>>>> indicator (from rclasif)
>>>>> nbe <- poly2nb(country)
>>>>> ce <- nbcosts(nbe, de)
>>>>> le <- nb2listw(nbe, ce, style="B", zero.policy=TRUE)
>>>> Error in nb2listw(nbe, ce, style = "B", zero.policy = TRUE) :
>>>> neighbours and glist do not conform
>>>
>>> Using your corrected list of countries, I see two/three problems:
>>>
>>> 1) some proximate polygons do not touch because of line generalisation
>> in
>>> the simplification of the country polygons, use:
>>>
>>> nbe <- poly2nb(country, snap=0.1)
>>>
>>> to force neighbours to touch.
>>>
>>> 2) you are left with three real islands - Iceland, Cyprus, and Malta.
To
>>
>>> join them in, consider:
>>>
>>> knn4 <- knn2nb(knearneigh(crds, 4, longlat=TRUE),
>>>    row.names=row.names(country))
>>> knn4s <- make.sym.nb(knn4)
>>> nbe1 <- union.nb(nbe, knn4s)
>>>
>>> 3) nbcosts() does not like single-column data frames, as it is
supposed
>> to
>>> be for multivariate data, so:
>>>
>>> de <- data.frame(rnorm(46))
>>> ce <- nbcosts(nbe1, de)
>>> which(sapply(ce, function(x) isTRUE(any(is.na(x)))))
>>>
>>> gives an NA at the end of each line of cost distances, but:
>>>
>>> de <- data.frame(rnorm(46), rnorm(46))
>>> ce <- nbcosts(nbe1, de)
>>> which(sapply(ce, function(x) isTRUE(any(is.na(x)))))
>>> le <- nb2listw(nbe1, ce, style="B")
>>>
>>> doesn't, nor does:
>>>
>>> de <- data.frame(rnorm(46), rep(1, 46))
>>> ce <- nbcosts(nbe1, de)
>>> which(sapply(ce, function(x) isTRUE(any(is.na(x)))))
>>> le <- nb2listw(nbe1, ce, style="B")
>>>
>>> From there,
>>>
>>> mst.bh <- mstree(le,5)
>>> res1 <- skater(mst.bh[,1:2], de, 2)
>>> plot(country, col=heat.colors(3)[res1$groups])
>>>
>>> seem to work.
>>>
>>> I think that it makes sense for nbcosts() to fail for non-connected
>>> observations, but perhaps it should explain why.
>>>
>>> Hope this helps,
>>>
>>> Roger
>>>
>>>
>>>>
>>>> I mention that:
>>>> -	at "nbe", appears the message:  6 regions with no links: CYP DNK
HRV
>>>> ISL
>>>> MLT SWE
>>>> -	"ce" contain a lot of NA
>>>> If you have some ideas about the cause of this Error, please help me
to
>>>> finalize my exercise on SKATER algoritm.
>>>>
>>>> Thanks a lot for your help,
>>>> Dorina
>>>>
>>>>
>>>>
>>>>
>>>> On Sat, 18 Dec 2010 18:42:35 +0100 (CET), Roger Bivand
>>>> <Roger.Bivand at nhh.no> wrote:
>>>>> On Sat, 18 Dec 2010, Roman Lu?trik wrote:
>>>>>
>>>>>> Perhaps you could follow the instructions from this
>>>>>>
>>>>
>>
exchange<http://r-sig-geo.2731867.n2.nabble.com/Guam-island-map-td4969467.html#a4972725>and
>>>>>> see if you can extract the desired country (assuming the resolution
>>>>>> suits you).
>>>>>>
>>>>>
>>>>> I don't think that we know which countries Dorina needs, or at which
>>>>> administrative level. If there are only 30 country observations, and
>> the
>>>>
>>>>> countries are not contiguous, then the whole exercise seems
>> unnecessary.
>>>>
>>>>> Can Dorina use the simplified world map in the maptools package:
>>>>>
>>>>> library(maptools)
>>>>> ?wrld_simpl
>>>>>
>>>>> adding the data using the ISO country names? If these are countries
at
>>>>> some administrative division level, then maybe www.gadm.org will
have
>>>> what
>>>>> is needed, but the countries will have to be joined together, or the
>>>> whole
>>>>> map subsetted. If these are say EU NUTS2 regions, then use can be
made
>>>> of
>>>>> GISCO shapefiles from Eurostat. But we don't know what boundaries
are
>>>>> needed, and of course to use Skater for clustering, you need the
>>>>> boundaries.
>>>>>
>>>>> Roger
>>>>>
>>>>>>
>>>>>> Cheers,
>>>>>> Roman
>>>>>>
>>>>>>
>>>>>>
>>>>>> On Sat, Dec 18, 2010 at 6:20 PM, Dorina Lazar <drnlazar at yahoo.com>
>>>> wrote:
>>>>>>
>>>>>>> Georg,
>>>>>>>
>>>>>>> Thanks for being very patient with me.
>>>>>>>
>>>>>>> I have not a shapefile for countries.
>>>>>>>
>>>>>>> I have tried to obtain it. I have loaded a shapefile for Finland,
>> GIS
>>>>>>> data,
>>>>>>> from
>>>>>>>
>>>>
>>
http://www.eea.europa.eu/data-and-maps/data/eea-reference-grids/zipped-shape-file-finland
>>>>>>>
>>>>>>> and I tried to read the file FI_1K.shp
>>>>>>> Fin<- readShapePoly(system.file("etc/shapes/ FI_1K.shp",
>>>>>>> package="spdep"))
>>>>>>> but...
>>>>>>> Error in getinfo.shape(filen) : Error opening SHP file
>>>>>>>
>>>>>>> How can I obtain, for each country,  the shapefile spatial polygon
>> in
>>>> R
>>>>>>> (SpatialPolygons-DataFrame)?
>>>>>>>
>>>>>>> Thanks again,
>>>>>>> Dorina
>>>>>>>
>>>>>>>
>>>>>>> --- On Thu, 12/16/10, Georg Ru? <research at georgruss.de> wrote:
>>>>>>>
>>>>>>>> From: Georg Ru? <research at georgruss.de>
>>>>>>>> Subject: Re: [R-sig-Geo] spatial clusters
>>>>>>>> To: "Dorina Lazar" <dorina.lazar at econ.ubbcluj.ro>
>>>>>>>> Cc: "R-sig-geo mailing list" <r-sig-geo at r-project.org>
>>>>>>>> Date: Thursday, December 16, 2010, 10:41 AM
>>>>>>>> On 16/12/10 09:06:33, dorina.lazar
>>>>>>>> wrote:
>>>>>>>>> How to create a shapefile including my data about some
>>>>>>>> socio-demographic
>>>>>>>>> indicators (7),  for about 30 countries around
>>>>>>>> the world (to be read with
>>>>>>>>> readShapePoly)?
>>>>>>>>
>>>>>>>> Hi Dorina,
>>>>>>>>
>>>>>>>> I'm not quite sure what you have and what you want.
>>>>>>>>
>>>>>>>> I assume that you'd like to create a shapefile such that
>>>>>>>> for every country
>>>>>>>> (which is represented as a polygon) there's a vector of
>>>>>>>> seven attributes
>>>>>>>> attached to it:
>>>>>>>>
>>>>>>>> country1:  attr1 attr2 attr3 attr4 attr5 attr6 attr7
>>>>>>>> country2:  attr1 attr2 attr3 attr4 attr5 attr6 attr7
>>>>>>>> ...
>>>>>>>>
>>>>>>>> Do you have your countries as spatial polygons in R
>>>>>>>> (SpatialPolygons-
>>>>>>>> DataFrame or similar)? If yes, you should be able to add
>>>>>>>> your socio-demo-
>>>>>>>> graphic indicators to this data frame (just as in normal
>>>>>>>> data frames). In
>>>>>>>> this way you'd join the data you have inside R.
>>>>>>>>
>>>>>>>> If you have the shapefile for the countries available and
>>>>>>>> would like to
>>>>>>>> edit this directly to add the indicators, I'd suggest using
>>>>>>>> a GIS like
>>>>>>>> GRASS http://grass.fbk.eu/ Afterwards, this can be easily
>>>>>>>> read into R.
>>>>>>>>
>>>>>>>>> Would be useful to suggest some good introductory
>>>>>>>> lectures in spatial
>>>>>>>>> statistics (links or books).
>>>>>>>>
>>>>>>>> I think the following is what Roger would suggest:
>>>>>>>>
>>>>>>>>  author = {Bivand, Roger S. and Pebesma, Edzer J. and
>>>>>>>> G?mez-Rubio, Virgilio},
>>>>>>>>  title = {Applied Spatial Data Analysis with R},
>>>>>>>>  series = {Use R},
>>>>>>>>  publisher = {Springer},
>>>>>>>>
>>>>>>>> http://www.asdar-book.org/
>>>>>>>> http://www.springerlink.com/content/uw07v1/
>>>>>>>> (Depending on your login/institute you may have fulltext
>>>>>>>> access, but the
>>>>>>>> book is definitely worth buying anyway.)
>>>>>>>>
>>>>>>>> Regards,
>>>>>>>> Georg.
>>>>>>>> --
>>>>>>>> Research Assistant
>>>>>>>> Otto-von-Guericke-Universit?t Magdeburg
>>>>>>>> research at georgruss.de
>>>>>>>> http://research.georgruss.de
>>>>>>>>
>>>>>>>> _______________________________________________
>>>>>>>> R-sig-Geo mailing list
>>>>>>>> R-sig-Geo at r-project.org
>>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>> _______________________________________________
>>>>>>> R-sig-Geo mailing list
>>>>>>> R-sig-Geo at r-project.org
>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>>>
>>>>>>
>>>>>>
>>>>>>
>>>>>>
>>>>
>>


From r.hijmans at gmail.com  Thu Dec 23 02:21:46 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Wed, 22 Dec 2010 17:21:46 -0800
Subject: [R-sig-Geo] gridded time series analysis
In-Reply-To: <AANLkTikXrGQSTKsey9u+rXFsnVtmszown6PV0i0ca7mQ@mail.gmail.com>
References: <AANLkTimTdxzoDCfJQOB8bgQRhjLy3YzSbtGtMdijk9sQ@mail.gmail.com>
	<771411.8321.qm@web29709.mail.ird.yahoo.com>
	<AANLkTin2DYocWNOAR-LfGoBP4+gCtA7eVDHmoaQ6wriR@mail.gmail.com>
	<AANLkTimFw1zMH75s+TG+SFkBHfXzpURm2WXskAa8Kp=m@mail.gmail.com>
	<AANLkTim9dBnVkZ0tjvoa1YRpPRr156jJ9zcezMDrtzhX@mail.gmail.com>
	<AANLkTi=vW6NXYXKGNa0gcTfZ8ezEjvegdxU3Dt5SPA4F@mail.gmail.com>
	<AANLkTikqNmC62Pv-n9Dxd1w7fTHJPx8cR72U6YEtWMTV@mail.gmail.com>
	<AANLkTikQsL9opzu1i0mWxtJA6YmcgBbGdbihXFOwPRho@mail.gmail.com>
	<AANLkTinY5+3JbpZfWnriDZNOdmcfic0628Qi0=NDZghK@mail.gmail.com>
	<AANLkTikd-PJKWZdWUL2+S9VYAq1QJ4LPwG2==erEs2+Q@mail.gmail.com>
	<AANLkTi=eZL0Rq5EyoRA29fdnN2VL-Xt6hcGN4DnZgCKk@mail.gmail.com>
	<AANLkTikVto4GD=vO=5YKwKXL7y+Ze4ADn2KXpsw1AFVA@mail.gmail.com>
	<AANLkTinUvhmDLP2YSWuqb5=G0YKX=sWp6yMOj9KPAgdA@mail.gmail.com>
	<AANLkTi=P5HNFjEsaapUBF7vSAFAsekU_4bYJqXnW=gbu@mail.gmail.com>
	<AANLkTikwWainpBBeSr8xnNNq8uoFXdU2n_34y2-u6K5J@mail.gmail.com>
	<AANLkTin5-hV=b8yxQnvviF_4w-uPfsSJ9X82pmbi=WQo@mail.gmail.com>
	<AANLkTikmPMvBRuu6RvjXsd8LdJc38FP+tAiF9iAc31Ks@mail.gmail.com>
	<AANLkTikSowU_SFiCmZyE3TKEa_UesH_SDQdPP63i+ERY@mail.gmail.com>
	<AANLkTi=p+LbmQ96GSJFuYyw-HLcCxJgYqaK4n2pBZcbG@mail.gmail.com>
	<AANLkTinvp-k47MHyV2s+hje_P0VXHvTmOKPFf8q5btAO@mail.gmail.com>
	<AANLkTi=S8tY50xzS2PFS7LvUEMT4cb4TFME-kT7DkmS0@mail.gmail.com>
	<AANLkTims2FyRBiLdmtZzR8wwvrBSyMuepVe0_Li-B6nU@mail.gmail.com>
	<AANLkTinzLPLDhoLwpcRkJ4twJ+FFd=ukOYpHh220S2mE@mail.gmail.com>
	<AANLkTikmm6QvAC69cPG7i4bT6wmWVBfwpO-4mHZ7JEvL@mail.gmail.com>
	<AANLkTikAMe3C=hQon56eh3nQd_G6gHJ=iQPh0JyJhqJ7@mail.gmail.com>
	<AANLkTikrWWOzicMeLk4sEP_y9Dfo7fZk1gUmC5-6HRd5@mail.gmail.com>
	<AANLkTikXrGQSTKsey9u+rXFsnVtmszown6PV0i0ca7mQ@mail.gmail.com>
Message-ID: <AANLkTimO-KOgdz4dugZmx5zeGPQH4XhRWOvgsY9346ks@mail.gmail.com>

Dear Advait,
See inline comments:

On Wed, Dec 22, 2010 at 5:17 PM, Advait Godbole <advaitgodbole at gmail.com> wrote:
> Dear Robert,
> Sorry about that - will incorporate an example in future. I tried the calc
> method and it is definitely much simpler! if "s_crop" is my raster stack for
> the following:
> s_crop <- stack(emitraster_crop,rcmraster_crop)
> fun <- function(x) {
> ?? resp = x[1:120]
> ?? expl = x[121:240]
> ?? mdl = lm(resp ~ expl)
> ?? res = c(mdl$coef[1] , mdl$coef[2])
> ?? return(res)
> }
> # now do:
> b2 <- calc(s_crop, fun)
> I looked at the output and it appears that b2[[1]] are the intercept and
> b2[[2]] are coefficients. Is that right? Also, for the later part:

b2[[1]] is mdl$coef[1], likewise for '2'

> datCoef = apply(getValues(s_crop), 1, fun)
> b1 <- setValues(s_crop, t(datCoef))
> I get:
> Error in function (classes, fdef, mtable) ?:
> ??unable to find an inherited method for function "setValues", for signature
> "RasterStack"

Oh, then that was not possible in your version of raster (it is now).
But you can do

b1 <- brick(s_crop, values=F)
b1 <- setValues(b1,  t(datCoef))

> Is this being done to create a new Raster object of slopes and intercepts?
> Also, I dont quite understand why setValues is being used here.

In this case you compute the values yourself. With setValues you
assign these to a Raster* object.

Best, Robert

> Thanks,
> Advait
> On Wed, Dec 22, 2010 at 7:26 PM, Robert J. Hijmans <r.hijmans at gmail.com>
> wrote:
>>
>> Advait,
>>
>> When asking for help, please provide a self-contained example whenever
>> possible, as below.
>>
>> library(raster)
>> v1 <- matrix(rep(1:12, 16), nrow=16)
>> v2 <- matrix(rep(1:12, 16), nrow=16, byrow=TRUE)
>> b <- brick(ncol=4, nrow=4)
>> b1 <- setValues(b, v1)
>> b2 <- setValues(b, v2)
>> s <- stack(b1, b2)
>>
>> fun <- function(x) {
>> ? ?resp = x[1:12]
>> ? ?expl = x[13:24]
>> ? ?mdl = lm(resp ~ expl)
>> ? ?res = c(mdl$coef[1] , mdl$coef[2])
>> ? ?return(res)
>> }
>>
>> # now do:
>> b2 <- calc(s, fun)
>>
>> # as an alternative to the above you could do
>> # but I would not recommend this
>>
>> datCoef = apply(getValues(s), 1, fun2)
>> b1 <- setValues(s, t(datCoef))
>>
>> # I think you were complicating matters with plyr.
>> # But to get those values in a brick you could do something like
>> b1 <- setValues(s, as.matrix(datCoef)[,3:4])
>> # But I am not sure if you would get the values in the correct cells
>> # (the number matches, but perhaps not the order).
>>
>> Best, Robert
>>
>>
>>
>> On Wed, Dec 22, 2010 at 10:39 AM, Advait Godbole
>> <advaitgodbole at gmail.com> wrote:
>> > Dear Members,
>> > I was able to find a solution after some deliberation and posting it
>> > here
>> > for the benefit of forum members.
>> > To recap, my data was in the form of 2 netCDF files, each of dimension
>> > 356 x
>> > 507 x 120 (lat,lon,time). I wanted to perform regressions between the
>> > two
>> > variables on each grid point over time. I used "brick" to read in the
>> > netcdfs as raster layers and stack along with the "plyr"?package to
>> > perform
>> > these regressions on the grid.
>> > # create raster object from the netcdf
>> > rcmraster <- brick("regcm.cumul.hdd.10k.96_05.fixed.latlonvars.nc",
>> > varname
>> > = "hdd")
>> > emitraster <-
>> >
>> > brick("flip.percap.vulcan.10k.dp.build.381.RES.EIAmy.96_05.this.latest.nc",varname="emitpercap")
>> > # crop subset of above rasters, test method on subset which is 4 x 4 x
>> > 120
>> > lim <- extent(rcmraster,180,185,300,305)
>> > rcmraster_crop <- crop(rcmraster,lim)
>> > emitraster_crop <- crop(emitraster,lim)
>> > # do some plotting to check
>> > ?par(mfrow=c(1,2))
>> > ?plot(rcmraster_crop[[1]])
>> > ?plot(emitraster_crop[[1]])
>> > # test regressions for cropped subset
>> > s_crop <- stack(emitraster_crop,rcmraster_crop)
>> > # use of plyr (provides a more elegant alternative to lapply)
>> > # the data frame datCoef contains the slope and intercept for each point
>> > in
>> > the grid (denoted by X1 and X2)
>> > datCoef = adply( as.array(s_crop) , 1:2 ,
>> > ?? ? ? ? ? ? ?function(x ) {
>> > ?? ? ? ? ? ? ? ? ? ? ? ? ? ?resp = x[1:120]
>> > ?? ? ? ? ? ? ? ? ? ? ? ? ? ?expl = x[121:240]
>> > ?? ? ? ? ? ? ? ? ? ? ? ? ? ?mdl = lm(resp ~ expl)
>> > ?? ? ? ? ? ? ? ? ? ? ? ? ? ?res = c(mdl$coef[1] , mdl$coef[2])
>> > ?? ? ? ? ? ? ? ? ? ? ? ? ? ?return(res)
>> >
>> > ?? ? ? ? ? ? ? ? ? ? ? ? ?}
>> > ?? ? ? ? ? ? ? ? ? ? ? ? ?)
>> > Output of datCoef()
>> >> datCoef
>> > ?? X1 X2 ?(Intercept) ? ? ? ? expl
>> > 1 ? 1 ?1 0.0010523406 2.623927e-05
>> > 2 ? 2 ?1 0.0019401572 5.049197e-05
>> > 3 ? 3 ?1 0.0171326653 4.425026e-04
>> > 4 ? 4 ?1 0.0012244689 3.045755e-05
>> > 5 ? 1 ?2 0.0011454348 2.892668e-05
>> > 6 ? 2 ?2 0.0013920425 3.460922e-05
>> > 7 ? 3 ?2 0.0015973400 3.943349e-05
>> > 8 ? 4 ?2 0.0016494511 4.045801e-05
>> > 9 ? 1 ?3 0.0018757258 4.704107e-05
>> > 10 ?2 ?3 0.0038066075 9.378512e-05
>> > 11 ?3 ?3 0.0039669120 9.719391e-05
>> > 12 ?4 ?3 0.0038055524 9.246021e-05
>> > 13 ?1 ?4 0.0015700329 3.921758e-05
>> > 14 ?2 ?4 0.0003727142 9.156119e-06
>> > 15 ?3 ?4 0.0005315722 1.308365e-05
>> > 16 ?4 ?4 0.0005872930 1.539454e-05
>> > Now, what I want to do is for each of these X1,X2, get a "predicted" map
>> > based on a new X which is an array of dimensions 4 x 4 (same as the
>> > rasters.
>> > in the original dataset, it will be 356 x 507). This array has the
>> > following
>> > values:
>> >> futurehdda
>> > ?? ? ? ? [,1] ? ? [,2] ? ? [,3] ? ? [,4]
>> > [1,] 5707.575 5696.325 5692.960 5683.110
>> > [2,] 5680.303 5665.092 5660.790 5647.896
>> > [3,] 5656.163 5641.045 5638.886 5625.231
>> > [4,] 5634.604 5619.317 5620.226 5601.729
>> > How can I extract the slope and intercept from datCoef and use the above
>> > X
>> > to get a predicted Y with the same dimensions (4 x 4)?
>> > Thanks,
>> > Advait
>> > On Mon, Dec 6, 2010 at 4:57 PM, Robert J. Hijmans <r.hijmans at gmail.com>
>> > wrote:
>> >>
>> >> Dear Advait,
>> >>
>> >> > What I dont understand is:
>> >> > 1) How can each slope be the same (values of x1)
>> >>
>> >> Apparently the values in these cells are all the same (not that you
>> >> only use the first 8 time steps, not all 120)
>> >>
>> >> Here is an example with random values in which the slopes are all
>> >> different
>> >>
>> >> b <- brick(ncol=4, nrow=4, nl=120)
>> >> b <- setValues(b, matrix(runif(prod(dim(b))), ncol=120))
>> >> fun = function(x) { if(is.na(x[1])) { NA } else { lm(x[1:60] ~
>> >> x[61:120])$coefficients[2] } }
>> >> x <- calc(b, fun)
>> >> plot(x)
>> >> as.matrix(x)
>> >>
>> >>
>> >> > 2) The raster layers are of dimensions 4 x 4 x 120
>> >> > but?dim(getValues(rcmraster_crop))
>> >> > [1] ?16 120. Why is that? This must have implications for the way
>> >> > that
>> >> > the
>> >> > regressions for the brick are handled wouldnt it?
>> >> No
>> >>
>> >> > Or is it specific to the
>> >> > way "getValues" handles things?
>> >>
>> >> Yes. rows are cells (4*4=16), columns are layers.
>> >>
>> >> > Also, does anyone have any pointers of how to accomplish the NA
>> >> > testing
>> >> > and
>> >> See an example above, assuming that if the first time step is NA, they
>> >> all are. You could also do things like
>> >> if (sum(is.na(x)) > 60)
>> >> depends on your context.
>> >>
>> >>
>> >> Best, Robert
>> >>
>> >> On Mon, Dec 6, 2010 at 8:30 AM, Advait Godbole
>> >> <advaitgodbole at gmail.com>
>> >> wrote:
>> >> > Dear Members,
>> >> > To recap, I initially had trouble reading in two 3D netCDFs in to R
>> >> > using
>> >> > the raster "brick" function. Each brick is a 356 x 507 x 120 (lat,
>> >> > lon,
>> >> > time) raster. With that resolved (thanks Robert!) I have the
>> >> > following
>> >> > code
>> >> > to perform regressions between the ?two time series (at each
>> >> > grid-cell)
>> >> > # read the netCDFs
>> >> > rcmraster <- brick("regcm.cumul.hdd.10k.96_05.fixed.latlonvars.nc",
>> >> > varname
>> >> > = "hdd")
>> >> > emitraster <-
>> >> >
>> >> >
>> >> > brick("flip.percap.vulcan.10k.dp.build.381.RES.EIAmy.96_05.this.latest.nc",varname="emitpercap")
>> >> > # crop subset of above rasters to test
>> >> > lim <- extent(rcmraster,180,185,300,305) ?# createss a 4 x 4 x 120
>> >> > brick
>> >> > rcmraster_crop <- crop(rcmraster,lim)
>> >> > emitraster_crop <- crop(emitraster,lim)
>> >> > #regressions
>> >> > s_crop <- stack(emitraster_crop,rcmraster_crop)
>> >> > func <- function(x) { lm(x[1:4] ~ x[5:8])$coefficients[2] }
>> >> > #regression
>> >> > for emit* VS rcm*
>> >> > x1 <- calc(s_crop, func)
>> >> > While the above regressions run, I have to ultimately do the same
>> >> > ?for
>> >> > the
>> >> > ?entire domain (356 x 507 cells) and therefore need to check for NAs
>> >> > at
>> >> > all
>> >> > time steps for each grid cell for both the bricks, and then have
>> >> > lm?run.
>> >> > To
>> >> > that ?end,, I ran the following diagnostics on the cropped dataset:
>> >> >> dim(rcmraster_crop)
>> >> > [1] ? 4 ? 4 120
>> >> >> dim(emitraster_crop)
>> >> > [1] ? 4 ? 4 120
>> >> >> dim(x1)
>> >> > [1] 4 4
>> >> >> getValues(x1)
>> >> > ?[1] 3.968207 3.968207 3.968207 3.968207 3.968207 3.968207 3.968207
>> >> > 3.968207
>> >> > 3.968207 3.968207 3.968207
>> >> > [12] 3.968207 3.968207 3.968207 3.968207 3.968207
>> >> >
>> >> > What I dont understand is:
>> >> > 1) How can each slope be the same (values of x1)
>> >> > 2) The raster layers are of dimensions 4 x 4 x 120
>> >> > but?dim(getValues(rcmraster_crop))
>> >> > [1] ?16 120. Why is that? This must have implications for the way
>> >> > that
>> >> > the
>> >> > regressions for the brick are handled wouldnt it? Or is it specific
>> >> > to
>> >> > the
>> >> > way "getValues" handles things?
>> >> > Also, does anyone have any pointers of how to accomplish the NA
>> >> > testing
>> >> > and
>> >> > regressions ?
>> >> > Thanks,
>> >> > Advait
>> >> >
>> >> > On Sun, Dec 5, 2010 at 6:29 PM, Robert J. Hijmans
>> >> > <r.hijmans at gmail.com>
>> >> > wrote:
>> >> >>
>> >> >> Advait,
>> >> >> It is just an example. In this case the function only checks the
>> >> >> first
>> >> >> time-slice for all cells. That often works because oftentimes either
>> >> >> all values are NA, or none. Also, I think lm works when not all
>> >> >> values
>> >> >> are NA. If your data is different, you may need a different
>> >> >> solution.
>> >> >> The best thing might be to try it out with a small dataset (you can
>> >> >> use crop to create one).
>> >> >> Robert
>> >> >>
>> >> >> On Sun, Dec 5, 2010 at 3:14 PM, Advait Godbole
>> >> >> <advaitgodbole at gmail.com>
>> >> >> wrote:
>> >> >> > Earlier in the threade you had mentioned that for two 120 layer
>> >> >> > bricks,
>> >> >> > this
>> >> >> > is what I should do:
>> >> >> > # regression of values in one brick (or stack) with another
>> >> >> > (Jacob's
>> >> >> > suggestion)
>> >> >> > s <- stack(s1, s2)
>> >> >> > # s1 and s2 have 120 layers
>> >> >> > fun <- function(x) { lm(x[1:120] ~ x[121:240])$coefficients[2] }
>> >> >> > x1 <- calc(s, fun)
>> >> >> > So if I have to check for NAs for the multi layered raster, I
>> >> >> > would
>> >> >> > need
>> >> >> > to
>> >> >> > do something like
>> >> >> > fun <- function (x) { if(is.na(x[1:120])) {NA} else
>> >> >> > {lm(x[1:120]~x[121:240])$coefficients[2]}}
>> >> >> > calc(s,fun=fun)
>> >> >> > That does not seem intuitively right to me although I am not very
>> >> >> > conversant
>> >> >> > with how is.na handles 3D variables to go much further. Also,
>> >> >> > should
>> >> >> > I
>> >> >> > not
>> >> >> > check the other brick for NAs too?
>> >> >> > Advait
>> >> >> > On Sun, Dec 5, 2010 at 5:29 PM, Robert J. Hijmans
>> >> >> > <r.hijmans at gmail.com>
>> >> >> > wrote:
>> >> >> >>
>> >> >> >> >If so, should I use a for loop instead?
>> >> >> >> No, that is the point of the calc function, that you do not do
>> >> >> >> that.
>> >> >> >> Internally, calc uses apply as in
>> >> >> >> apply(values, 1, fun)
>> >> >> >>
>> >> >> >>
>> >> >> >> On Sat, Dec 4, 2010 at 1:50 PM, Advait Godbole
>> >> >> >> <advaitgodbole at gmail.com>
>> >> >> >> wrote:
>> >> >> >> > Roger, that fix worked, its there in the latest version. Thanks
>> >> >> >> > much.
>> >> >> >> > I am running into the problem that Martin mentioned earlier in
>> >> >> >> > the
>> >> >> >> > thread:
>> >> >> >> > Error in lm.fit(x, y, offset = offset, singular.ok =
>> >> >> >> > singular.ok,
>> >> >> >> > ...) :
>> >> >> >> > ?0 (non-NA) cases
>> >> >> >> >
>> >> >> >> > For which you suggested this:
>> >> >> >> > #you could catch this in your function and do something like:
>> >> >> >> >
>> >> >> >> >> fun=function(x) { if (is.na(x[1])){ NA } else {
>> >> >> >> >> lm(x[1]~x[2])$coefficients[2] }}
>> >> >> >> >> fun(c(NA,NA))
>> >> >> >> > [1] NA
>> >> >> >> >
>> >> >> >> > and then:
>> >> >> >> > calc(s, fun=fun)
>> >> >> >> >
>> >> >> >> > What I am confused is that my stack "s" that I will pass via
>> >> >> >> > calc
>> >> >> >> > is
>> >> >> >> > of
>> >> >> >> > dimensions 356 x 507 x 240, and therefore is.na?will act on the
>> >> >> >> > entire
>> >> >> >> > array
>> >> >> >> > and therefore still fail at those points where it is not NA. Is
>> >> >> >> > that
>> >> >> >> > right?
>> >> >> >> > If so, should I use a for loop instead?
>> >> >> >> > Thanks,
>> >> >> >> > Advait
>> >> >> >> > On Fri, Dec 3, 2010 at 2:58 PM, Robert J. Hijmans
>> >> >> >> > <r.hijmans at gmail.com>
>> >> >> >> > wrote:
>> >> >> >> >>
>> >> >> >> >> It may have been fixed. Please try this again in raster 1.7-8
>> >> >> >> >> (now
>> >> >> >> >> on
>> >> >> >> >> CRAN for windows and linux, mac in a day or so). Robert
>> >> >> >> >>
>> >> >> >> >> On Fri, Dec 3, 2010 at 11:54 AM, steven mosher
>> >> >> >> >> <moshersteven at gmail.com>
>> >> >> >> >> wrote:
>> >> >> >> >> > Well,
>> >> >> >> >> > ??I need some more information.
>> >> >> >> >> > ?before you create the stack do this and report the results
>> >> >> >> >> > test1 <- layerNames(rcmraster)
>> >> >> >> >> > test2 <- layerNames(emitraster)
>> >> >> >> >> > str(test1)
>> >> >> >> >> > str(test2)
>> >> >> >> >> > Its a bit of a hack but ?you can try to copy the layerNames
>> >> >> >> >> > out
>> >> >> >> >> > of
>> >> >> >> >> > the
>> >> >> >> >> > invidual stacks.
>> >> >> >> >> > Then set them to ? ?""
>> >> >> >> >> > then create one big stack
>> >> >> >> >> > then set the layerNames.
>> >> >> >> >> > ( I recall having to do that once in the past after a
>> >> >> >> >> > stackApply())
>> >> >> >> >> > I know in the past, I've had some similar issues, but I
>> >> >> >> >> > thought
>> >> >> >> >> > that
>> >> >> >> >> > they
>> >> >> >> >> > ?had been fixed.
>> >> >> >> >> > I'll try to take a look at the code ?in a bit, but if there
>> >> >> >> >> > is
>> >> >> >> >> > a
>> >> >> >> >> > bug,
>> >> >> >> >> > either
>> >> >> >> >> > robert or Jacob would have to fix it.
>> >> >> >> >> >
>> >> >> >> >> > On Fri, Dec 3, 2010 at 4:28 AM, Advait Godbole
>> >> >> >> >> > <advaitgodbole at gmail.com>
>> >> >> >> >> > wrote:
>> >> >> >> >> >>
>> >> >> >> >> >> With Robert being away until the 15th, can someone else
>> >> >> >> >> >> help
>> >> >> >> >> >> out
>> >> >> >> >> >> with
>> >> >> >> >> >> this
>> >> >> >> >> >> issue? To recap, I have read in two 507 x ?356 x 120
>> >> >> >> >> >> (lon,lat,time)
>> >> >> >> >> >> netCDF
>> >> >> >> >> >> files into R using the "brick" function. I get the
>> >> >> >> >> >> following
>> >> >> >> >> >> error
>> >> >> >> >> >> when
>> >> >> >> >> >> I
>> >> >> >> >> >> use "stack" to clump these two multi layer rasters
>> >> >> >> >> >> together.
>> >> >> >> >> >> > s <- stack(rcmraster,emitraster)
>> >> >> >> >> >> Error in function (classes, fdef, mtable) ?:
>> >> >> >> >> >> ??unable to find an inherited method for function "trim",
>> >> >> >> >> >> for
>> >> >> >> >> >> signature
>> >> >> >> >> >> "integer"
>> >> >> >> >> >> Robert suggested that it is because of the layerNames being
>> >> >> >> >> >> numeric,
>> >> >> >> >> >> annd
>> >> >> >> >> >> that layerNames() <- layerNames() would solve it but it did
>> >> >> >> >> >> not
>> >> >> >> >> >> help,
>> >> >> >> >> >> even
>> >> >> >> >> >> though layerNames() is now of type character.
>> >> >> >> >> >> Thanks much!
>> >> >> >> >> >> adv
>> >> >> >> >> >> On Fri, Dec 3, 2010 at 7:13 AM, Advait Godbole
>> >> >> >> >> >> <advaitgodbole at gmail.com>
>> >> >> >> >> >> wrote:
>> >> >> >> >> >>>
>> >> >> >> >> >>> the setMinMax() function worked. Thanks Steve and Robert..
>> >> >> >> >> >>> the work around did not work - I still get the trim()
>> >> >> >> >> >>> error..
>> >> >> >> >> >>> adv
>> >> >> >> >> >>>
>> >> >> >> >> >>> On Thu, Dec 2, 2010 at 1:43 PM, Robert J. Hijmans
>> >> >> >> >> >>> <r.hijmans at gmail.com>
>> >> >> >> >> >>> wrote:
>> >> >> >> >> >>>>
>> >> >> >> >> >>>> This is the work around:
>> >> >> >> >> >>>>
>> >> >> >> >> >>>> layerNames(rcmraster) <- layerNames(rcmraster)
>> >> >> >> >> >>>>
>> >> >> >> >> >>>>
>> >> >> >> >> >>>> On Thu, Dec 2, 2010 at 10:43 AM, Robert J. Hijmans
>> >> >> >> >> >>>> <r.hijmans at gmail.com>
>> >> >> >> >> >>>> wrote:
>> >> >> >> >> >>>> > The question marks indicate that the min and max values
>> >> >> >> >> >>>> > are
>> >> >> >> >> >>>> > not
>> >> >> >> >> >>>> > known
>> >> >> >> >> >>>> > to the object (because the file type does not store
>> >> >> >> >> >>>> > them,
>> >> >> >> >> >>>> > and
>> >> >> >> >> >>>> > it
>> >> >> >> >> >>>> > is
>> >> >> >> >> >>>> > too 'expensive' to determine them on the fly).
>> >> >> >> >> >>>> > setMinMax
>> >> >> >> >> >>>> > if
>> >> >> >> >> >>>> > you
>> >> >> >> >> >>>> > really
>> >> >> >> >> >>>> > need to know.
>> >> >> >> >> >>>> > The error on trim seems to be a problem with layerNames
>> >> >> >> >> >>>> > being
>> >> >> >> >> >>>> > numeric.
>> >> >> >> >> >>>> > I'll fix that. This may be a work-around
>> >> >> >> >> >>>> >
>> >> >> >> >> >>>> >
>> >> >> >> >> >>>> >
>> >> >> >> >> >>>> >
>> >> >> >> >> >>>> >
>> >> >> >> >> >>>> >
>> >> >> >> >> >>>> > On Thu, Dec 2, 2010 at 10:23 AM, steven mosher
>> >> >> >> >> >>>> > <moshersteven at gmail.com> wrote:
>> >> >> >> >> >>>> >> ?see the setMinMax()
>> >> >> >> >> >>>> >>
>> >> >> >> >> >>>> >> ?for the error on trim() I'm not sure.
>> >> >> >> >> >>>> >>
>> >> >> >> >> >>>> >> On Thu, Dec 2, 2010 at 5:16 AM, Advait Godbole
>> >> >> >> >> >>>> >> <advaitgodbole at gmail.com>
>> >> >> >> >> >>>> >> wrote:
>> >> >> >> >> >>>> >>>
>> >> >> >> >> >>>> >>> That worked perfectly. Thanks for pointing this out.
>> >> >> >> >> >>>> >>> I
>> >> >> >> >> >>>> >>> changed
>> >> >> >> >> >>>> >>> the
>> >> >> >> >> >>>> >>> way my
>> >> >> >> >> >>>> >>> variables were being written to the netCDF and now
>> >> >> >> >> >>>> >>> "brick"
>> >> >> >> >> >>>> >>> works.
>> >> >> >> >> >>>> >>> However,
>> >> >> >> >> >>>> >>> I
>> >> >> >> >> >>>> >>> am getting an error while using the stack function,
>> >> >> >> >> >>>> >>> like
>> >> >> >> >> >>>> >>> so:
>> >> >> >> >> >>>> >>>
>> >> >> >> >> >>>> >>> "Error in function (classes, fdef, mtable) ?:
>> >> >> >> >> >>>> >>> ?unable to find an inherited method for function
>> >> >> >> >> >>>> >>> "trim",
>> >> >> >> >> >>>> >>> for
>> >> >> >> >> >>>> >>> signature
>> >> >> >> >> >>>> >>> "integer"
>> >> >> >> >> >>>> >>>
>> >> >> >> >> >>>> >>> The two rasters show the following:
>> >> >> >> >> >>>> >>> > rcmraster
>> >> >> >> >> >>>> >>> class ? ? ? : RasterBrick
>> >> >> >> >> >>>> >>> filename ? ?:
>> >> >> >> >> >>>> >>> regcm.cumul.hdd.10k.96_05.fixed.latlonvars.nc
>> >> >> >> >> >>>> >>> nlayers ? ? : 120
>> >> >> >> >> >>>> >>> nrow ? ? ? ?: 356
>> >> >> >> >> >>>> >>> ncol ? ? ? ?: 507
>> >> >> >> >> >>>> >>> ncell ? ? ? : 180492
>> >> >> >> >> >>>> >>> projection ?: +proj=longlat +datum=WGS84 +ellps=WGS84
>> >> >> >> >> >>>> >>> +towgs84=0,0,0
>> >> >> >> >> >>>> >>> min value ? : ? ? ? ? ? ? ? ? ? ?
>> >> >> >> >> >>>> >>> max value ? : ? ? ? ? ? ? ? ? ? ?
>> >> >> >> >> >>>> >>> xmin ? ? ? ?: -137.3312
>> >> >> >> >> >>>> >>> xmax ? ? ? ?: -62.11259
>> >> >> >> >> >>>> >>> ymin ? ? ? ?: 22.12693
>> >> >> >> >> >>>> >>> ymax ? ? ? ?: 57.35954
>> >> >> >> >> >>>> >>> xres ? ? ? ?: 0.1483602
>> >> >> >> >> >>>> >>> yres ? ? ? ?: 0.09896801
>> >> >> >> >> >>>> >>>
>> >> >> >> >> >>>> >>> > emitraster
>> >> >> >> >> >>>> >>> class ? ? ? : RasterBrick
>> >> >> >> >> >>>> >>> filename ? ?:
>> >> >> >> >> >>>> >>>
>> >> >> >> >> >>>> >>>
>> >> >> >> >> >>>> >>>
>> >> >> >> >> >>>> >>>
>> >> >> >> >> >>>> >>>
>> >> >> >> >> >>>> >>> flip.percap.vulcan.10k.dp.build.381.RES.EIAmy.96_05.this.latest.nc
>> >> >> >> >> >>>> >>> nlayers ? ? : 120
>> >> >> >> >> >>>> >>> nrow ? ? ? ?: 356
>> >> >> >> >> >>>> >>> ncol ? ? ? ?: 507
>> >> >> >> >> >>>> >>> ncell ? ? ? : 180492
>> >> >> >> >> >>>> >>> projection ?: +proj=longlat +datum=WGS84 +ellps=WGS84
>> >> >> >> >> >>>> >>> +towgs84=0,0,0
>> >> >> >> >> >>>> >>> min value ? : ? ? ? ? ? ? ? ? ? ?
>> >> >> >> >> >>>> >>> max value ? : ? ? ? ? ? ? ? ? ? ?
>> >> >> >> >> >>>> >>> xmin ? ? ? ?: -137.3312
>> >> >> >> >> >>>> >>> xmax ? ? ? ?: -62.11259
>> >> >> >> >> >>>> >>> ymin ? ? ? ?: 22.12693
>> >> >> >> >> >>>> >>> ymax ? ? ? ?: 57.35954
>> >> >> >> >> >>>> >>> xres ? ? ? ?: 0.1483602
>> >> >> >> >> >>>> >>> yres ? ? ? ?: 0.09896801
>> >> >> >> >> >>>> >>>
>> >> >> >> >> >>>> >>> A getValues call shows a lot of NAs. Now, my original
>> >> >> >> >> >>>> >>> file
>> >> >> >> >> >>>> >>> does
>> >> >> >> >> >>>> >>> have
>> >> >> >> >> >>>> >>> a
>> >> >> >> >> >>>> >>> large
>> >> >> >> >> >>>> >>> number of missing values so that is why this should
>> >> >> >> >> >>>> >>> happen,
>> >> >> >> >> >>>> >>> but I
>> >> >> >> >> >>>> >>> suspect
>> >> >> >> >> >>>> >>> something is going wrong since the min and max values
>> >> >> >> >> >>>> >>> are
>> >> >> >> >> >>>> >>> not
>> >> >> >> >> >>>> >>> being
>> >> >> >> >> >>>> >>> displayed for either of these rasters. Is that the
>> >> >> >> >> >>>> >>> source
>> >> >> >> >> >>>> >>> of
>> >> >> >> >> >>>> >>> the
>> >> >> >> >> >>>> >>> problem
>> >> >> >> >> >>>> >>> in
>> >> >> >> >> >>>> >>> the "stack" function?
>> >> >> >> >> >>>> >>>
>> >> >> >> >> >>>> >>> Thanks,
>> >> >> >> >> >>>> >>>
>> >> >> >> >> >>>> >>> Advait
>> >> >> >> >> >>>> >>>
>> >> >> >> >> >>>> >>> On Tue, Nov 30, 2010 at 5:18 PM, Robert J. Hijmans
>> >> >> >> >> >>>> >>> <r.hijmans at gmail.com>wrote:
>> >> >> >> >> >>>> >>>
>> >> >> >> >> >>>> >>> > Advait,
>> >> >> >> >> >>>> >>> >
>> >> >> >> >> >>>> >>> > The is an error in the file, I think, see below:
>> >> >> >> >> >>>> >>> >
>> >> >> >> >> >>>> >>> > > library(ncdf)
>> >> >> >> >> >>>> >>> > > filename =
>> >> >> >> >> >>>> >>> > > "c:/downloads/regcm.cumul.hdd.10k.96_05.new.nc"
>> >> >> >> >> >>>> >>> > > nc <- open.ncdf(filename)
>> >> >> >> >> >>>> >>> > >
>> >> >> >> >> >>>> >>> > > zvar <- 'hdd'
>> >> >> >> >> >>>> >>> > > nc$var[[zvar]]$dim[[1]]$len
>> >> >> >> >> >>>> >>> > [1] 507
>> >> >> >> >> >>>> >>> > > nc$var[[zvar]]$dim[[2]]$len
>> >> >> >> >> >>>> >>> > [1] 356
>> >> >> >> >> >>>> >>> > >
>> >> >> >> >> >>>> >>> > > xx <- nc$var[[zvar]]$dim[[1]]$vals
>> >> >> >> >> >>>> >>> > > # should be a vector of 507 longitudes but:
>> >> >> >> >> >>>> >>> > > dim(xx)
>> >> >> >> >> >>>> >>> > [1] 507 356 120
>> >> >> >> >> >>>> >>> > >
>> >> >> >> >> >>>> >>> > > # works anyway
>> >> >> >> >> >>>> >>> > > xrange <- c(min(xx), max(xx))
>> >> >> >> >> >>>> >>> > > xrange
>> >> >> >> >> >>>> >>> > [1] -137.25705 ?-62.18677
>> >> >> >> >> >>>> >>> > >
>> >> >> >> >> >>>> >>> > > yy <- nc$var[[zvar]]$dim[[2]]$vals
>> >> >> >> >> >>>> >>> > > # should be a vector of 356 latitudes but:
>> >> >> >> >> >>>> >>> > > dim(yy)
>> >> >> >> >> >>>> >>> > [1] 507 356 120
>> >> >> >> >> >>>> >>> > >
>> >> >> >> >> >>>> >>> > > # this fails
>> >> >> >> >> >>>> >>> > > yrange <- c(min(yy), max(yy))
>> >> >> >> >> >>>> >>> > > yrange
>> >> >> >> >> >>>> >>> > [1] NaN NaN
>> >> >> >> >> >>>> >>> > > # and that is the only reason why raster failed.
>> >> >> >> >> >>>> >>> > >
>> >> >> >> >> >>>> >>> > > #OK
>> >> >> >> >> >>>> >>> > > yy[,,1][1:10,350:355]
>> >> >> >> >> >>>> >>> > ? ? ? ? ?[,1] ? ? [,2] ? ? [,3] ? ? [,4] ? ? [,5]
>> >> >> >> >> >>>> >>> > [,6]
>> >> >> >> >> >>>> >>> > ?[1,] 51.49148 51.57122 51.65092 51.73055 51.81014
>> >> >> >> >> >>>> >>> > 51.88967
>> >> >> >> >> >>>> >>> > ?[2,] 51.52888 51.60866 51.68839 51.76807 51.84769
>> >> >> >> >> >>>> >>> > 51.92727
>> >> >> >> >> >>>> >>> > ?[3,] 51.56616 51.64598 51.72575 51.80547 51.88513
>> >> >> >> >> >>>> >>> > 51.96474
>> >> >> >> >> >>>> >>> > ?[4,] 51.60332 51.68318 51.76299 51.84275 51.92245
>> >> >> >> >> >>>> >>> > 52.00210
>> >> >> >> >> >>>> >>> > ?[5,] 51.64036 51.72026 51.80011 51.87991 51.95965
>> >> >> >> >> >>>> >>> > 52.03934
>> >> >> >> >> >>>> >>> > ?[6,] 51.67728 51.75722 51.83711 51.91695 51.99673
>> >> >> >> >> >>>> >>> > 52.07646
>> >> >> >> >> >>>> >>> > ?[7,] 51.71409 51.79407 51.87399 51.95387 52.03369
>> >> >> >> >> >>>> >>> > 52.11345
>> >> >> >> >> >>>> >>> > ?[8,] 51.75077 51.83079 51.91076 51.99067 52.07053
>> >> >> >> >> >>>> >>> > 52.15033
>> >> >> >> >> >>>> >>> > ?[9,] 51.78734 51.86739 51.94740 52.02735 52.10725
>> >> >> >> >> >>>> >>> > 52.18709
>> >> >> >> >> >>>> >>> > [10,] 51.82378 51.90388 51.98392 52.06391 52.14385
>> >> >> >> >> >>>> >>> > 52.22373
>> >> >> >> >> >>>> >>> > >
>> >> >> >> >> >>>> >>> > > #bad values here (and note the NaN):
>> >> >> >> >> >>>> >>> > > yy[,,120][1:10,350:355]
>> >> >> >> >> >>>> >>> > ? ? ? ? ? ? ? ?[,1] ? ? ? ? ? [,2] ? ? ? ? ? [,3]
>> >> >> >> >> >>>> >>> > [,4]
>> >> >> >> >> >>>> >>> > ? ? [,5] ? ? ? ? ? [,6]
>> >> >> >> >> >>>> >>> > ?[1,] -1.313847e-229 -4.895880e-272 -7.553765e-266
>> >> >> >> >> >>>> >>> > 1.293814e+58
>> >> >> >> >> >>>> >>> > 9.551441e-293 ?-3.291580e-36
>> >> >> >> >> >>>> >>> > ?[2,] -5.321424e+272 -3.076997e-223 ?-1.515780e-33
>> >> >> >> >> >>>> >>> > -9.895836e+171
>> >> >> >> >> >>>> >>> > 3.115686e-149 ?-4.970539e+92
>> >> >> >> >> >>>> >>> > ?[3,] ?5.259277e-203 ? 5.980335e-56 ?2.893449e-212
>> >> >> >> >> >>>> >>> > ?2.974200e+274
>> >> >> >> >> >>>> >>> > 3.186547e-218 ?2.503689e+296
>> >> >> >> >> >>>> >>> > ?[4,] -3.977129e+225 -3.696719e-283 ? 1.284612e+42
>> >> >> >> >> >>>> >>> > 1.887923e+28
>> >> >> >> >> >>>> >>> > -2.322520e+268 ?5.005820e-108
>> >> >> >> >> >>>> >>> > ?[5,] ?-6.569744e+88 ? 1.824506e-74 ? 7.663356e+39
>> >> >> >> >> >>>> >>> > ?1.608759e-201
>> >> >> >> >> >>>> >>> > -1.433761e+110 -8.804183e-211
>> >> >> >> >> >>>> >>> > ?[6,] -4.237822e-162 ? ? ? ? ? ?NaN ?7.405904e-275
>> >> >> >> >> >>>> >>> > ?5.859877e-258
>> >> >> >> >> >>>> >>> > 1.339820e+110 ?1.631993e+229
>> >> >> >> >> >>>> >>> > ?[7,] ? 5.603325e-64 ? 4.188764e+37 -2.188887e+243
>> >> >> >> >> >>>> >>> > -4.657907e+280
>> >> >> >> >> >>>> >>> > 1.795268e-185 ?1.166057e-175
>> >> >> >> >> >>>> >>> > ?[8,] -2.112804e-229 ?4.536625e+137 ?2.910322e-278
>> >> >> >> >> >>>> >>> > ?4.407645e-274
>> >> >> >> >> >>>> >>> > 8.886205e-239 -1.913860e+238
>> >> >> >> >> >>>> >>> > ?[9,] ?-9.126350e+44 -1.866422e+177 -2.578975e+256
>> >> >> >> >> >>>> >>> > ?3.275379e+208
>> >> >> >> >> >>>> >>> > -2.657457e+75 ?-1.258259e-90
>> >> >> >> >> >>>> >>> > [10,] ?6.698325e+216 -2.958355e+137 -1.058748e-178
>> >> >> >> >> >>>> >>> > -1.776776e+215
>> >> >> >> >> >>>> >>> > -6.368807e+78 -5.337653e+299
>> >> >> >> >> >>>> >>> > >
>> >> >> >> >> >>>> >>> > > # this would have worked
>> >> >> >> >> >>>> >>> > > yrange <- c(min(yy[,,1]), max(yy[,,1]))
>> >> >> >> >> >>>> >>> > > yrange
>> >> >> >> >> >>>> >>> > [1] 22.17641 57.31006
>> >> >> >> >> >>>> >>> > >
>> >> >> >> >> >>>> >>> > > close.ncdf(nc)
>> >> >> >> >> >>>> >>> >
>> >> >> >> >> >>>> >>> >
>> >> >> >> >> >>>> >>> > Best, Robert
>> >> >> >> >> >>>> >>> >
>> >> >> >> >> >>>> >>> >
>> >> >> >> >> >>>> >>> > On Tue, Nov 30, 2010 at 10:37 AM, Advait Godbole
>> >> >> >> >> >>>> >>> > <advaitgodbole at gmail.com> wrote:
>> >> >> >> >> >>>> >>> > > Dear Robert,
>> >> >> >> >> >>>> >>> > > here is the link to the file:
>> >> >> >> >> >>>> >>> > >
>> >> >> >> >> >>>> >>> > >
>> >> >> >> >> >>>> >>> > >
>> >> >> >> >> >>>> >>> > >
>> >> >> >> >> >>>> >>> > >
>> >> >> >> >> >>>> >>> > >
>> >> >> >> >> >>>> >>> > > http://dl.dropbox.com/u/4030944/regcm.cumul.hdd.10k.96_05.new.nc. It
>> >> >> >> >> >>>> >>> > > is
>> >> >> >> >> >>>> >>> > a
>> >> >> >> >> >>>> >>> > > large file ~400 MB. Let me know if dropbox is not
>> >> >> >> >> >>>> >>> > > convenient
>> >> >> >> >> >>>> >>> > > and
>> >> >> >> >> >>>> >>> > > you
>> >> >> >> >> >>>> >>> > would
>> >> >> >> >> >>>> >>> > > rather do ftp - ?but our machines are down for
>> >> >> >> >> >>>> >>> > > maintenance
>> >> >> >> >> >>>> >>> > > and I
>> >> >> >> >> >>>> >>> > > may
>> >> >> >> >> >>>> >>> > > not
>> >> >> >> >> >>>> >>> > be
>> >> >> >> >> >>>> >>> > > immediately able to get access.
>> >> >> >> >> >>>> >>> > > I was going over the NCL code that processes the
>> >> >> >> >> >>>> >>> > > files
>> >> >> >> >> >>>> >>> > > but
>> >> >> >> >> >>>> >>> > > did
>> >> >> >> >> >>>> >>> > > not
>> >> >> >> >> >>>> >>> > > find
>> >> >> >> >> >>>> >>> > > anything glaringly amiss, so I will have to look
>> >> >> >> >> >>>> >>> > > at
>> >> >> >> >> >>>> >>> > > it
>> >> >> >> >> >>>> >>> > > in
>> >> >> >> >> >>>> >>> > > greater
>> >> >> >> >> >>>> >>> > > detail
>> >> >> >> >> >>>> >>> > > since it is clear that the number of entries in
>> >> >> >> >> >>>> >>> > > the
>> >> >> >> >> >>>> >>> > > variables
>> >> >> >> >> >>>> >>> > > is
>> >> >> >> >> >>>> >>> > > not
>> >> >> >> >> >>>> >>> > right
>> >> >> >> >> >>>> >>> > > as you've pointed out. There is a chance that I
>> >> >> >> >> >>>> >>> > > have
>> >> >> >> >> >>>> >>> > > not
>> >> >> >> >> >>>> >>> > > written
>> >> >> >> >> >>>> >>> > > out
>> >> >> >> >> >>>> >>> > > the
>> >> >> >> >> >>>> >>> > > co-ordinates properly.
>> >> >> >> >> >>>> >>> > > Thanks,
>> >> >> >> >> >>>> >>> > > Advait
>> >> >> >> >> >>>> >>> > > On Mon, Nov 29, 2010 at 1:14 PM, Robert J.
>> >> >> >> >> >>>> >>> > > Hijmans
>> >> >> >> >> >>>> >>> > > <r.hijmans at gmail.com>
>> >> >> >> >> >>>> >>> > > wrote:
>> >> >> >> >> >>>> >>> > >>
>> >> >> >> >> >>>> >>> > >> Advait,
>> >> >> >> >> >>>> >>> > >> I do not think I can help you further unless you
>> >> >> >> >> >>>> >>> > >> send
>> >> >> >> >> >>>> >>> > >> me
>> >> >> >> >> >>>> >>> > >> your
>> >> >> >> >> >>>> >>> > >> file;
>> >> >> >> >> >>>> >>> > >> but this suggests that it is either not
>> >> >> >> >> >>>> >>> > >> following
>> >> >> >> >> >>>> >>> > >> the
>> >> >> >> >> >>>> >>> > >> CF
>> >> >> >> >> >>>> >>> > >> standards,
>> >> >> >> >> >>>> >>> > >> or
>> >> >> >> >> >>>> >>> > >> something is wrong with the file, or that there
>> >> >> >> >> >>>> >>> > >> is
>> >> >> >> >> >>>> >>> > >> something
>> >> >> >> >> >>>> >>> > >> I
>> >> >> >> >> >>>> >>> > >> have
>> >> >> >> >> >>>> >>> > >> not understood about these files.
>> >> >> >> >> >>>> >>> > >> You said you have 507 x 356 x 120 values. I
>> >> >> >> >> >>>> >>> > >> would
>> >> >> >> >> >>>> >>> > >> expect
>> >> >> >> >> >>>> >>> > >> length(frcm$dim[[1]]$vals) == 507 and
>> >> >> >> >> >>>> >>> > >> length(frcm$dim[[2]]$vals) ==
>> >> >> >> >> >>>> >>> > >> 356
>> >> >> >> >> >>>> >>> > >> Robert
>> >> >> >> >> >>>> >>> > >>
>> >> >> >> >> >>>> >>> > >> On Mon, Nov 29, 2010 at 6:11 AM, Advait Godbole
>> >> >> >> >> >>>> >>> > >> <
>> >> >> >> >> >>>> >>> > advaitgodbole at gmail.com>
>> >> >> >> >> >>>> >>> > >> wrote:
>> >> >> >> >> >>>> >>> > >> > sorry to disrupt the flow of the conversation,
>> >> >> >> >> >>>> >>> > >> > but
>> >> >> >> >> >>>> >>> > >> > after
>> >> >> >> >> >>>> >>> > >> > doing what
>> >> >> >> >> >>>> >>> > >> > Robert
>> >> >> >> >> >>>> >>> > >> > suggested, this is what was returned:
>> >> >> >> >> >>>> >>> > >> >> length(frcm$dim[[1]]$vals)
>> >> >> >> >> >>>> >>> > >> > [1] 21659040
>> >> >> >> >> >>>> >>> > >> >> length(frcm$dim[[2]]$vals)
>> >> >> >> >> >>>> >>> > >> > [1] 21659040
>> >> >> >> >> >>>> >>> > >> > the other two functions return the latitude
>> >> >> >> >> >>>> >>> > >> > and
>> >> >> >> >> >>>> >>> > >> > longitude
>> >> >> >> >> >>>> >>> > >> > arrays
>> >> >> >> >> >>>> >>> > >> > not
>> >> >> >> >> >>>> >>> > >> > populated with NAs/missing values. I havent
>> >> >> >> >> >>>> >>> > >> > reproduced
>> >> >> >> >> >>>> >>> > >> > them
>> >> >> >> >> >>>> >>> > >> > here
>> >> >> >> >> >>>> >>> > because
>> >> >> >> >> >>>> >>> > >> > of
>> >> >> >> >> >>>> >>> > >> > their number.
>> >> >> >> >> >>>> >>> > >> > Regards,
>> >> >> >> >> >>>> >>> > >> > advait
>> >> >> >> >> >>>> >>> > >> > On Sat, Nov 27, 2010 at 3:48 PM, Robert J.
>> >> >> >> >> >>>> >>> > >> > Hijmans <
>> >> >> >> >> >>>> >>> > r.hijmans at gmail.com>
>> >> >> >> >> >>>> >>> > >> > wrote:
>> >> >> >> >> >>>> >>> > >> >>
>> >> >> >> >> >>>> >>> > >> >> Advait,
>> >> >> >> >> >>>> >>> > >> >>
>> >> >> >> >> >>>> >>> > >> >> That suggests that you have missing values in
>> >> >> >> >> >>>> >>> > >> >> the
>> >> >> >> >> >>>> >>> > >> >> lon
>> >> >> >> >> >>>> >>> > >> >> or
>> >> >> >> >> >>>> >>> > >> >> lat
>> >> >> >> >> >>>> >>> > >> >> dimensions. Is that true? That would be
>> >> >> >> >> >>>> >>> > >> >> awkward,
>> >> >> >> >> >>>> >>> > >> >> but
>> >> >> >> >> >>>> >>> > >> >> perhaps
>> >> >> >> >> >>>> >>> > something
>> >> >> >> >> >>>> >>> > >> >> else is going on. Can you send me your file?
>> >> >> >> >> >>>> >>> > >> >> If
>> >> >> >> >> >>>> >>> > >> >> not
>> >> >> >> >> >>>> >>> > >> >> can
>> >> >> >> >> >>>> >>> > >> >> you
>> >> >> >> >> >>>> >>> > >> >> send
>> >> >> >> >> >>>> >>> > >> >> the
>> >> >> >> >> >>>> >>> > >> >> results of this:
>> >> >> >> >> >>>> >>> > >> >>
>> >> >> >> >> >>>> >>> > >> >> filename <-
>> >> >> >> >> >>>> >>> > >> >> "regcm.cumul.hdd.10k.96_05.new.nc"
>> >> >> >> >> >>>> >>> > >> >> nc <- open.ncdf(filename)
>> >> >> >> >> >>>> >>> > >> >> length(nc$dim[[1]]$vals)
>> >> >> >> >> >>>> >>> > >> >> length(nc$dim[[2]]$vals)
>> >> >> >> >> >>>> >>> > >> >> nc$dim[[1]]$vals
>> >> >> >> >> >>>> >>> > >> >> nc$dim[[2]]$vals
>> >> >> >> >> >>>> >>> > >> >> close.ncdf(nc)
>> >> >> >> >> >>>> >>> > >> >>
>> >> >> >> >> >>>> >>> > >> >> Thanks, Robert
>> >> >> >> >> >>>> >>> > >> >>
>> >> >> >> >> >>>> >>> > >> >> On Sat, Nov 27, 2010 at 8:36 AM, Advait
>> >> >> >> >> >>>> >>> > >> >> Godbole
>> >> >> >> >> >>>> >>> > >> >> <advaitgodbole at gmail.com>
>> >> >> >> >> >>>> >>> > >> >> wrote:
>> >> >> >> >> >>>> >>> > >> >> > Thanks everyone for these leads..However, I
>> >> >> >> >> >>>> >>> > >> >> > am
>> >> >> >> >> >>>> >>> > >> >> > running
>> >> >> >> >> >>>> >>> > >> >> > into
>> >> >> >> >> >>>> >>> > problems
>> >> >> >> >> >>>> >>> > >> >> > with
>> >> >> >> >> >>>> >>> > >> >> > data handling. I used ncdf to extract the
>> >> >> >> >> >>>> >>> > >> >> > two
>> >> >> >> >> >>>> >>> > >> >> > variables
>> >> >> >> >> >>>> >>> > >> >> > (507 x
>> >> >> >> >> >>>> >>> > >> >> > 356
>> >> >> >> >> >>>> >>> > x
>> >> >> >> >> >>>> >>> > >> >> > 120
>> >> >> >> >> >>>> >>> > >> >> > -
>> >> >> >> >> >>>> >>> > >> >> > lon,lat,time) and converted them into array
>> >> >> >> >> >>>> >>> > >> >> > objects.
>> >> >> >> >> >>>> >>> > >> >> > The
>> >> >> >> >> >>>> >>> > suggestions
>> >> >> >> >> >>>> >>> > >> >> > provided all utilize the raster package,
>> >> >> >> >> >>>> >>> > >> >> > but
>> >> >> >> >> >>>> >>> > >> >> > using
>> >> >> >> >> >>>> >>> > >> >> > "brick"
>> >> >> >> >> >>>> >>> > >> >> > on
>> >> >> >> >> >>>> >>> > >> >> > the
>> >> >> >> >> >>>> >>> > >> >> > file
>> >> >> >> >> >>>> >>> > >> >> > returns this error: "rcmraster <-
>> >> >> >> >> >>>> >>> > >> >> > brick("regcm.cumul.hdd.10k.96_05.new.nc")
>> >> >> >> >> >>>> >>> > >> >> > Error in if (e at xmin > -400 & e at xmax < 400 &
>> >> >> >> >> >>>> >>> > >> >> > e at ymin >
>> >> >> >> >> >>>> >>> > >> >> > -90.1
>> >> >> >> >> >>>> >>> > >> >> > &
>> >> >> >> >> >>>> >>> > e at ymax <
>> >> >> >> >> >>>> >>> > >> >> > ?:
>> >> >> >> >> >>>> >>> > >> >> > missing value where TRUE/FALSE needed"
>> >> >> >> >> >>>> >>> > >> >> >
>> >> >> >> >> >>>> >>> > >> >> > I have a fair number of NAs (all missing
>> >> >> >> >> >>>> >>> > >> >> > values
>> >> >> >> >> >>>> >>> > >> >> > in
>> >> >> >> >> >>>> >>> > >> >> > the
>> >> >> >> >> >>>> >>> > >> >> > original
>> >> >> >> >> >>>> >>> > >> >> > variables).
>> >> >> >> >> >>>> >>> > >> >> > Is there a way to set a flag for that? Or
>> >> >> >> >> >>>> >>> > >> >> > any
>> >> >> >> >> >>>> >>> > >> >> > other
>> >> >> >> >> >>>> >>> > >> >> > workaround?
>> >> >> >> >> >>>> >>> > >> >> > Thanks much,
>> >> >> >> >> >>>> >>> > >> >> > advait
>> >> >> >> >> >>>> >>> > >> >> > On Fri, Nov 26, 2010 at 6:25 PM, Robert J.
>> >> >> >> >> >>>> >>> > >> >> > Hijmans
>> >> >> >> >> >>>> >>> > >> >> > <r.hijmans at gmail.com>
>> >> >> >> >> >>>> >>> > >> >> > wrote:
>> >> >> >> >> >>>> >>> > >> >> >>
>> >> >> >> >> >>>> >>> > >> >> >> There are some difference in the behavior
>> >> >> >> >> >>>> >>> > >> >> >> of
>> >> >> >> >> >>>> >>> > >> >> >> 'calc'
>> >> >> >> >> >>>> >>> > >> >> >> between
>> >> >> >> >> >>>> >>> > >> >> >> functions,
>> >> >> >> >> >>>> >>> > >> >> >> because of attempts to accommodate
>> >> >> >> >> >>>> >>> > >> >> >> different
>> >> >> >> >> >>>> >>> > >> >> >> functions
>> >> >> >> >> >>>> >>> > >> >> >> &
>> >> >> >> >> >>>> >>> > intentions.
>> >> >> >> >> >>>> >>> > >> >> >> But in 'raster' 1.7-4 (available from
>> >> >> >> >> >>>> >>> > >> >> >> R-Forge
>> >> >> >> >> >>>> >>> > >> >> >> in
>> >> >> >> >> >>>> >>> > >> >> >> ~
>> >> >> >> >> >>>> >>> > >> >> >> 24
>> >> >> >> >> >>>> >>> > >> >> >> hrs; and
>> >> >> >> >> >>>> >>> > from
>> >> >> >> >> >>>> >>> > >> >> >> CRAN soon), the below will work:
>> >> >> >> >> >>>> >>> > >> >> >>
>> >> >> >> >> >>>> >>> > >> >> >> library(raster)
>> >> >> >> >> >>>> >>> > >> >> >> #creating some data
>> >> >> >> >> >>>> >>> > >> >> >> r <- raster(nrow=10, ncol=10)
>> >> >> >> >> >>>> >>> > >> >> >> s1 <- s2<- list()
>> >> >> >> >> >>>> >>> > >> >> >> for (i in 1:12) {
>> >> >> >> >> >>>> >>> > >> >> >> ? ? ? ?s1[i] <- setValues(r,
>> >> >> >> >> >>>> >>> > >> >> >> rnorm(ncell(r),
>> >> >> >> >> >>>> >>> > >> >> >> i,
>> >> >> >> >> >>>> >>> > >> >> >> 3)
>> >> >> >> >> >>>> >>> > >> >> >> )
>> >> >> >> >> >>>> >>> > >> >> >> ? ? ? ?s2[i] <- setValues(r,
>> >> >> >> >> >>>> >>> > >> >> >> rnorm(ncell(r),
>> >> >> >> >> >>>> >>> > >> >> >> i,
>> >> >> >> >> >>>> >>> > >> >> >> 3)
>> >> >> >> >> >>>> >>> > >> >> >> )
>> >> >> >> >> >>>> >>> > >> >> >> }
>> >> >> >> >> >>>> >>> > >> >> >> s1 <- stack(s1)
>> >> >> >> >> >>>> >>> > >> >> >> s2 <- stack(s2)
>> >> >> >> >> >>>> >>> > >> >> >>
>> >> >> >> >> >>>> >>> > >> >> >> # regression of values in one brick (or
>> >> >> >> >> >>>> >>> > >> >> >> stack)
>> >> >> >> >> >>>> >>> > >> >> >> with
>> >> >> >> >> >>>> >>> > >> >> >> another
>> >> >> >> >> >>>> >>> > (Jacob's
>> >> >> >> >> >>>> >>> > >> >> >> suggestion)
>> >> >> >> >> >>>> >>> > >> >> >> s <- stack(s1, s2)
>> >> >> >> >> >>>> >>> > >> >> >> # s1 and s2 have 12 layers
>> >> >> >> >> >>>> >>> > >> >> >> fun <- function(x) { lm(x[1:12] ~
>> >> >> >> >> >>>> >>> > >> >> >> x[13:24])$coefficients[2] }
>> >> >> >> >> >>>> >>> > >> >> >> x1 <- calc(s, fun)
>> >> >> >> >> >>>> >>> > >> >> >>
>> >> >> >> >> >>>> >>> > >> >> >> # regression of values in one brick (or
>> >> >> >> >> >>>> >>> > >> >> >> stack)
>> >> >> >> >> >>>> >>> > >> >> >> with
>> >> >> >> >> >>>> >>> > >> >> >> 'time'
>> >> >> >> >> >>>> >>> > >> >> >> time <- 1:nlayers(s)
>> >> >> >> >> >>>> >>> > >> >> >> fun <- function(x) { lm(x ~
>> >> >> >> >> >>>> >>> > >> >> >> time)$coefficients[2] }
>> >> >> >> >> >>>> >>> > >> >> >> x2 <- calc(s, fun)
>> >> >> >> >> >>>> >>> > >> >> >>
>> >> >> >> >> >>>> >>> > >> >> >> # get multiple layers, e.g. the slope
>> >> >> >> >> >>>> >>> > >> >> >> _and_
>> >> >> >> >> >>>> >>> > >> >> >> intercept
>> >> >> >> >> >>>> >>> > >> >> >> fun <- function(x) { lm(x ~
>> >> >> >> >> >>>> >>> > >> >> >> time)$coefficients }
>> >> >> >> >> >>>> >>> > >> >> >> x3 <- calc(s, fun)
>> >> >> >> >> >>>> >>> > >> >> >>
>> >> >> >> >> >>>> >>> > >> >> >> If this does not work in your version, you
>> >> >> >> >> >>>> >>> > >> >> >> can
>> >> >> >> >> >>>> >>> > >> >> >> use
>> >> >> >> >> >>>> >>> > >> >> >> apply(
>> >> >> >> >> >>>> >>> > >> >> >> ) as
>> >> >> >> >> >>>> >>> > >> >> >> in
>> >> >> >> >> >>>> >>> > >> >> >> what
>> >> >> >> >> >>>> >>> > >> >> >> I send earlier.
>> >> >> >> >> >>>> >>> > >> >> >>
>> >> >> >> >> >>>> >>> > >> >> >> Robert
>> >> >> >> >> >>>> >>> > >> >> >>
>> >> >> >> >> >>>> >>> > >> >> >> On Fri, Nov 26, 2010 at 2:56 PM, Robert J.
>> >> >> >> >> >>>> >>> > >> >> >> Hijmans
>> >> >> >> >> >>>> >>> > >> >> >> <r.hijmans at gmail.com>
>> >> >> >> >> >>>> >>> > >> >> >> wrote:
>> >> >> >> >> >>>> >>> > >> >> >> > It seems that 'calc' does not like this
>> >> >> >> >> >>>> >>> > >> >> >> > (any
>> >> >> >> >> >>>> >>> > >> >> >> > more;
>> >> >> >> >> >>>> >>> > >> >> >> > another
>> >> >> >> >> >>>> >>> > >> >> >> > thing
>> >> >> >> >> >>>> >>> > >> >> >> > to
>> >> >> >> >> >>>> >>> > >> >> >> > fix) . If your rasters are not very
>> >> >> >> >> >>>> >>> > >> >> >> > large
>> >> >> >> >> >>>> >>> > >> >> >> > you
>> >> >> >> >> >>>> >>> > >> >> >> > can
>> >> >> >> >> >>>> >>> > >> >> >> > use
>> >> >> >> >> >>>> >>> > >> >> >> > apply,
>> >> >> >> >> >>>> >>> > which
>> >> >> >> >> >>>> >>> > >> >> >> > makes it much faster:
>> >> >> >> >> >>>> >>> > >> >> >> >
>> >> >> >> >> >>>> >>> > >> >> >> > library(raster)
>> >> >> >> >> >>>> >>> > >> >> >> > #creating some data
>> >> >> >> >> >>>> >>> > >> >> >> > r <- raster(nrow=10, ncol=10)
>> >> >> >> >> >>>> >>> > >> >> >> > s <- list()
>> >> >> >> >> >>>> >>> > >> >> >> > for (i in 1:25) { s[i] <- setValues(r,
>> >> >> >> >> >>>> >>> > >> >> >> > rnorm(ncell(r),
>> >> >> >> >> >>>> >>> > >> >> >> > i, 3)
>> >> >> >> >> >>>> >>> > >> >> >> > ) }
>> >> >> >> >> >>>> >>> > >> >> >> > s <- stack(s)
>> >> >> >> >> >>>> >>> > >> >> >> >
>> >> >> >> >> >>>> >>> > >> >> >> > # regression
>> >> >> >> >> >>>> >>> > >> >> >> > time <- 1:nlayers(s)
>> >> >> >> >> >>>> >>> > >> >> >> > fun <- function(x) { lm(x ~
>> >> >> >> >> >>>> >>> > >> >> >> > time)$coefficients[2]
>> >> >> >> >> >>>> >>> > >> >> >> > }
>> >> >> >> >> >>>> >>> > >> >> >> > r[] <- apply(getValues(s), 1, fun)
>> >> >> >> >> >>>> >>> > >> >> >> >
>> >> >> >> >> >>>> >>> > >> >> >> > Robert
>> >> >> >> >> >>>> >>> > >> >> >> >
>> >> >> >> >> >>>> >>> > >> >> >> >
>> >> >> >> >> >>>> >>> > >> >> >> >
>> >> >> >> >> >>>> >>> > >> >> >> > On Fri, Nov 26, 2010 at 2:51 PM, Jacob
>> >> >> >> >> >>>> >>> > >> >> >> > van
>> >> >> >> >> >>>> >>> > >> >> >> > Etten
>> >> >> >> >> >>>> >>> > >> >> >> > <jacobvanetten at yahoo.com> wrote:
>> >> >> >> >> >>>> >>> > >> >> >> >> you could try this approach (use calc
>> >> >> >> >> >>>> >>> > >> >> >> >> whenever
>> >> >> >> >> >>>> >>> > >> >> >> >> you
>> >> >> >> >> >>>> >>> > >> >> >> >> can):
>> >> >> >> >> >>>> >>> > >> >> >> >>
>> >> >> >> >> >>>> >>> > >> >> >> >> (supposing your bricks have 12 layers)
>> >> >> >> >> >>>> >>> > >> >> >> >>
>> >> >> >> >> >>>> >>> > >> >> >> >> br3 <- stack(brick1, brick2)
>> >> >> >> >> >>>> >>> > >> >> >> >> lmS <- function(x) lm(x[1:12] ~
>> >> >> >> >> >>>> >>> > >> >> >> >> x[13:24)$coefficients[2]
>> >> >> >> >> >>>> >>> > >> >> >> >> r <- calc(br3, lmS)
>> >> >> >> >> >>>> >>> > >> >> >> >>
>> >> >> >> >> >>>> >>> > >> >> >> >> Jacob.
>> >> >> >> >> >>>> >>> > >> >> >> >>
>> >> >> >> >> >>>> >>> > >> >> >> >> --- On Fri, 26/11/10, steven mosher
>> >> >> >> >> >>>> >>> > >> >> >> >> <moshersteven at gmail.com>
>> >> >> >> >> >>>> >>> > >> >> >> >> wrote:
>> >> >> >> >> >>>> >>> > >> >> >> >>
>> >> >> >> >> >>>> >>> > >> >> >> >> From: steven mosher
>> >> >> >> >> >>>> >>> > >> >> >> >> <moshersteven at gmail.com>
>> >> >> >> >> >>>> >>> > >> >> >> >> Subject: Re: [R-sig-Geo] gridded time
>> >> >> >> >> >>>> >>> > >> >> >> >> series
>> >> >> >> >> >>>> >>> > >> >> >> >> analysis
>> >> >> >> >> >>>> >>> > >> >> >> >> To: "Martin" <martin_brandt at gmx.net>
>> >> >> >> >> >>>> >>> > >> >> >> >> Cc: r-sig-geo at stat.math.ethz.ch
>> >> >> >> >> >>>> >>> > >> >> >> >> Date: Friday, 26 November, 2010, 23:33
>> >> >> >> >> >>>> >>> > >> >> >> >>
>> >> >> >> >> >>>> >>> > >> >> >> >> that's cool, I'm also interested in a
>> >> >> >> >> >>>> >>> > >> >> >> >> similar
>> >> >> >> >> >>>> >>> > >> >> >> >> problem
>> >> >> >> >> >>>> >>> > >> >> >> >> but
>> >> >> >> >> >>>> >>> > >> >> >> >> just
>> >> >> >> >> >>>> >>> > >> >> >> >> with
>> >> >> >> >> >>>> >>> > >> >> >> >> one
>> >> >> >> >> >>>> >>> > >> >> >> >> brick ending up with a slope raster as
>> >> >> >> >> >>>> >>> > >> >> >> >> the
>> >> >> >> >> >>>> >>> > >> >> >> >> output.
>> >> >> >> >> >>>> >>> > >> >> >> >> It
>> >> >> >> >> >>>> >>> > >> >> >> >> may be
>> >> >> >> >> >>>> >>> > >> >> >> >> possible
>> >> >> >> >> >>>> >>> > >> >> >> >> with
>> >> >> >> >> >>>> >>> > >> >> >> >> stackApply(). have a look. or maybe
>> >> >> >> >> >>>> >>> > >> >> >> >> robert
>> >> >> >> >> >>>> >>> > >> >> >> >> will
>> >> >> >> >> >>>> >>> > >> >> >> >> chime
>> >> >> >> >> >>>> >>> > >> >> >> >> in
>> >> >> >> >> >>>> >>> > >> >> >> >>
>> >> >> >> >> >>>> >>> > >> >> >> >>
>> >> >> >> >> >>>> >>> > >> >> >> >>
>> >> >> >> >> >>>> >>> > >> >> >> >> On Fri, Nov 26, 2010 at 1:35 PM, Martin
>> >> >> >> >> >>>> >>> > >> >> >> >> <martin_brandt at gmx.net
>> >> >> >> >> >>>> >>> > >
>> >> >> >> >> >>>> >>> > >> >> >> >> wrote:
>> >> >> >> >> >>>> >>> > >> >> >> >>
>> >> >> >> >> >>>> >>> > >> >> >> >>>
>> >> >> >> >> >>>> >>> > >> >> >> >>> this is what I did to perform a
>> >> >> >> >> >>>> >>> > >> >> >> >>> regression
>> >> >> >> >> >>>> >>> > >> >> >> >>> between
>> >> >> >> >> >>>> >>> > >> >> >> >>> two
>> >> >> >> >> >>>> >>> > >> >> >> >>> bricks
>> >> >> >> >> >>>> >>> > >> >> >> >>> (each
>> >> >> >> >> >>>> >>> > >> >> >> >>> brick
>> >> >> >> >> >>>> >>> > >> >> >> >>> represent a time series):
>> >> >> >> >> >>>> >>> > >> >> >> >>>
>> >> >> >> >> >>>> >>> > >> >> >> >>> r <- raster(brick1)
>> >> >> >> >> >>>> >>> > >> >> >> >>> for (i in 1:ncell(r)) {
>> >> >> >> >> >>>> >>> > >> >> >> >>> r[i] = lm(as.ts(cellValues(brick1, i))
>> >> >> >> >> >>>> >>> > >> >> >> >>> ~
>> >> >> >> >> >>>> >>> > >> >> >> >>> as.ts(cellValues(brick2,
>> >> >> >> >> >>>> >>> > >> >> >> >>> i)))$coefficients[2]
>> >> >> >> >> >>>> >>> > >> >> >> >>> }
>> >> >> >> >> >>>> >>> > >> >> >> >>>
>> >> >> >> >> >>>> >>> > >> >> >> >>> The result will be a slope raster, but
>> >> >> >> >> >>>> >>> > >> >> >> >>> it
>> >> >> >> >> >>>> >>> > >> >> >> >>> really
>> >> >> >> >> >>>> >>> > >> >> >> >>> takes a
>> >> >> >> >> >>>> >>> > >> >> >> >>> lot
>> >> >> >> >> >>>> >>> > of
>> >> >> >> >> >>>> >>> > >> >> >> >>> time,
>> >> >> >> >> >>>> >>> > >> >> >> >>> so
>> >> >> >> >> >>>> >>> > >> >> >> >>> maybe there is a better solution..
>> >> >> >> >> >>>> >>> > >> >> >> >>>
>> >> >> >> >> >>>> >>> > >> >> >> >>>
>> >> >> >> >> >>>> >>> > >> >> >> >>> --
>> >> >> >> >> >>>> >>> > >> >> >> >>> View this message in context:
>> >> >> >> >> >>>> >>> > >> >> >> >>>
>> >> >> >> >> >>>> >>> > >> >> >> >>>
>> >> >> >> >> >>>> >>> > >> >> >> >>>
>> >> >> >> >> >>>> >>> > >> >> >> >>>
>> >> >> >> >> >>>> >>> >
>> >> >> >> >> >>>> >>> >
>> >> >> >> >> >>>> >>> >
>> >> >> >> >> >>>> >>> >
>> >> >> >> >> >>>> >>> >
>> >> >> >> >> >>>> >>> >
>> >> >> >> >> >>>> >>> >
>> >> >> >> >> >>>> >>> > http://r-sig-geo.2731867.n2.nabble.com/gridded-time-series-analysis-tp5775651p5778472.html
>> >> >> >> >> >>>> >>> > >> >> >> >>> Sent from the R-sig-geo mailing list
>> >> >> >> >> >>>> >>> > >> >> >> >>> archive
>> >> >> >> >> >>>> >>> > >> >> >> >>> at
>> >> >> >> >> >>>> >>> > >> >> >> >>> Nabble.com.
>> >> >> >> >> >>>> >>> > >> >> >> >>>
>> >> >> >> >> >>>> >>> > >> >> >> >>>
>> >> >> >> >> >>>> >>> > >> >> >> >>>
>> >> >> >> >> >>>> >>> > >> >> >> >>>
>> >> >> >> >> >>>> >>> > >> >> >> >>> _______________________________________________
>> >> >> >> >> >>>> >>> > >> >> >> >>> R-sig-Geo mailing list
>> >> >> >> >> >>>> >>> > >> >> >> >>> R-sig-Geo at stat.math.ethz.ch
>> >> >> >> >> >>>> >>> > >> >> >> >>>
>> >> >> >> >> >>>> >>> > >> >> >> >>>
>> >> >> >> >> >>>> >>> > >> >> >> >>>
>> >> >> >> >> >>>> >>> > >> >> >> >>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> >> >> >> >> >>>> >>> > >> >> >> >>>
>> >> >> >> >> >>>> >>> > >> >> >> >>
>> >> >> >> >> >>>> >>> > >> >> >> >> ? ? [[alternative HTML version
>> >> >> >> >> >>>> >>> > >> >> >> >> deleted]]
>> >> >> >> >> >>>> >>> > >> >> >> >>
>> >> >> >> >> >>>> >>> > >> >> >> >>
>> >> >> >> >> >>>> >>> > >> >> >> >>
>> >> >> >> >> >>>> >>> > >> >> >> >>
>> >> >> >> >> >>>> >>> > >> >> >> >> _______________________________________________
>> >> >> >> >> >>>> >>> > >> >> >> >> R-sig-Geo mailing list
>> >> >> >> >> >>>> >>> > >> >> >> >> R-sig-Geo at stat.math.ethz.ch
>> >> >> >> >> >>>> >>> > >> >> >> >>
>> >> >> >> >> >>>> >>> > >> >> >> >>
>> >> >> >> >> >>>> >>> > >> >> >> >>
>> >> >> >> >> >>>> >>> > >> >> >> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> >> >> >> >> >>>> >>> > >> >> >> >>
>> >> >> >> >> >>>> >>> > >> >> >> >>
>> >> >> >> >> >>>> >>> > >> >> >> >>
>> >> >> >> >> >>>> >>> > >> >> >> >>
>> >> >> >> >> >>>> >>> > >> >> >> >> ? ? ? ?[[alternative HTML version
>> >> >> >> >> >>>> >>> > >> >> >> >> deleted]]
>> >> >> >> >> >>>> >>> > >> >> >> >>
>> >> >> >> >> >>>> >>> > >> >> >> >>
>> >> >> >> >> >>>> >>> > >> >> >> >>
>> >> >> >> >> >>>> >>> > >> >> >> >>
>> >> >> >> >> >>>> >>> > >> >> >> >>
>> >> >> >> >> >>>> >>> > >> >> >> >> _______________________________________________
>> >> >> >> >> >>>> >>> > >> >> >> >> R-sig-Geo mailing list
>> >> >> >> >> >>>> >>> > >> >> >> >> R-sig-Geo at stat.math.ethz.ch
>> >> >> >> >> >>>> >>> > >> >> >> >>
>> >> >> >> >> >>>> >>> > >> >> >> >>
>> >> >> >> >> >>>> >>> > >> >> >> >>
>> >> >> >> >> >>>> >>> > >> >> >> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> >> >> >> >> >>>> >>> > >> >> >> >>
>> >> >> >> >> >>>> >>> > >> >> >> >>
>> >> >> >> >> >>>> >>> > >> >> >> >
>> >> >> >> >> >>>> >>> > >> >> >>
>> >> >> >> >> >>>> >>> > >> >> >>
>> >> >> >> >> >>>> >>> > >> >> >>
>> >> >> >> >> >>>> >>> > >> >> >> _______________________________________________
>> >> >> >> >> >>>> >>> > >> >> >> R-sig-Geo mailing list
>> >> >> >> >> >>>> >>> > >> >> >> R-sig-Geo at stat.math.ethz.ch
>> >> >> >> >> >>>> >>> > >> >> >>
>> >> >> >> >> >>>> >>> > >> >> >>
>> >> >> >> >> >>>> >>> > >> >> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> >> >> >> >> >>>> >>> > >> >> >
>> >> >> >> >> >>>> >>> > >> >> >
>> >> >> >> >> >>>> >>> > >> >> >
>> >> >> >> >> >>>> >>> > >> >> > --
>> >> >> >> >> >>>> >>> > >> >> > advait godbole
>> >> >> >> >> >>>> >>> > >> >> >
>> >> >> >> >> >>>> >>> > >> >
>> >> >> >> >> >>>> >>> > >> >
>> >> >> >> >> >>>> >>> > >> >
>> >> >> >> >> >>>> >>> > >> > --
>> >> >> >> >> >>>> >>> > >> > advait godbole
>> >> >> >> >> >>>> >>> > >> >
>> >> >> >> >> >>>> >>> > >
>> >> >> >> >> >>>> >>> > >
>> >> >> >> >> >>>> >>> > >
>> >> >> >> >> >>>> >>> > > --
>> >> >> >> >> >>>> >>> > > advait godbole
>> >> >> >> >> >>>> >>> > >
>> >> >> >> >> >>>> >>> >
>> >> >> >> >> >>>> >>>
>> >> >> >> >> >>>> >>>
>> >> >> >> >> >>>> >>>
>> >> >> >> >> >>>> >>> --
>> >> >> >> >> >>>> >>> advait godbole
>> >> >> >> >> >>>> >>>
>> >> >> >> >> >>>> >>> ? ? ? ?[[alternative HTML version deleted]]
>> >> >> >> >> >>>> >>>
>> >> >> >> >> >>>> >>> _______________________________________________
>> >> >> >> >> >>>> >>> R-sig-Geo mailing list
>> >> >> >> >> >>>> >>> R-sig-Geo at r-project.org
>> >> >> >> >> >>>> >>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> >> >> >> >> >>>> >>
>> >> >> >> >> >>>> >>
>> >> >> >> >> >>>> >
>> >> >> >> >> >>>
>> >> >> >> >> >>>
>> >> >> >> >> >>>
>> >> >> >> >> >>> --
>> >> >> >> >> >>> advait godbole
>> >> >> >> >> >>
>> >> >> >> >> >>
>> >> >> >> >> >>
>> >> >> >> >> >> --
>> >> >> >> >> >> advait godbole
>> >> >> >> >> >
>> >> >> >> >> >
>> >> >> >> >
>> >> >> >> >
>> >> >> >> >
>> >> >> >> > --
>> >> >> >> > advait godbole
>> >> >> >> >
>> >> >> >
>> >> >> >
>> >> >> >
>> >> >> > --
>> >> >> > advait godbole
>> >> >> >
>> >> >
>> >> >
>> >> >
>> >> > --
>> >> > advait godbole
>> >> >
>> >
>> >
>> >
>> > --
>> > advait godbole
>> >
>
>
>
> --
> advait godbole
>


From isabelle.boulangeat at gmail.com  Thu Dec 23 12:54:00 2010
From: isabelle.boulangeat at gmail.com (isabelle boulangeat)
Date: Thu, 23 Dec 2010 12:54:00 +0100
Subject: [R-sig-Geo] new function predict, package raster
In-Reply-To: <AANLkTi=8WVdp2xyoXQ_D1BGhPhmJ=ufcxs51i4TKTRiR@mail.gmail.com>
References: <AANLkTikU1d4LrvtOCsVUb3FOVWV+NMcL2cpjvC8Bw8OC@mail.gmail.com>
	<AANLkTim4_1NH-sJE1OkUAgari22wy1_V=AHf8F5MB3v=@mail.gmail.com>
	<AANLkTi=ez4w1dnc3kM00jTL482JAy1MQtyAkhpPBR+dn@mail.gmail.com>
	<AANLkTinLzNRz2CocwHbZ3xyWgMg_zhCSpozJhZXD=99O@mail.gmail.com>
	<AANLkTim7K-m6Ebv2_rrv9CBx2uHxOAFGT4MtZ0YLR+7q@mail.gmail.com>
	<AANLkTimd0oOu_DwNrfeHF8GPRqeP6pXQZ94+iG6gjj91@mail.gmail.com>
	<AANLkTimHsO-kqUN0W3U6BkGx51uWuD+W+3oOO1Nk5i57@mail.gmail.com>
	<AANLkTi=8WVdp2xyoXQ_D1BGhPhmJ=ufcxs51i4TKTRiR@mail.gmail.com>
Message-ID: <AANLkTimuN-nYQv8Cz9CyjmfXXrtVJ12o8GhrQXvriabp@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101223/799cf841/attachment.pl>

From senator at ecotoxicology.de  Thu Dec 23 13:13:42 2010
From: senator at ecotoxicology.de (=?iso-8859-1?Q?Ralf_Sch=E4fer?=)
Date: Thu, 23 Dec 2010 13:13:42 +0100
Subject: [R-sig-Geo] R-sig-Geo Digest, Vol 88, Issue 23
In-Reply-To: <mailman.9.1293102005.4036.r-sig-geo@r-project.org>
References: <mailman.9.1293102005.4036.r-sig-geo@r-project.org>
Message-ID: <33858649-82EB-4700-87AA-810D89491B42@ecotoxicology.de>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101223/975c1818/attachment.pl>

From b.rowlingson at lancaster.ac.uk  Thu Dec 23 15:33:17 2010
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Thu, 23 Dec 2010 14:33:17 +0000
Subject: [R-sig-Geo] R-sig-Geo Digest, Vol 88, Issue 23
In-Reply-To: <33858649-82EB-4700-87AA-810D89491B42@ecotoxicology.de>
References: <mailman.9.1293102005.4036.r-sig-geo@r-project.org>
	<33858649-82EB-4700-87AA-810D89491B42@ecotoxicology.de>
Message-ID: <AANLkTikiGuymT_x+KBs=01Xg=q3hVXpcCGA+t8C3PWgJ@mail.gmail.com>

2010/12/23 Ralf Sch?fer <senator at ecotoxicology.de>:

> BTW: "Linux Techies" ?should have no major probs with Mac, given that the
> Mac system commands are more or less the same as for Linux systems

 Yes, but try asking an average Mac user how to get a command line.
Here's the dialog:

Can I get a command line?

A what?

A terminal emulator.

A what?

A thing where you type stuff.

Like Word?

No, a command line interpreter.

A what?

A shell.

A what?

Like a DOS command box.

A what?

Is it called 'MacTerm'?

Dunno.

Or "Terminal"?

*shrug*

Eventually you trawl through a dozen wobbly-iconned shine-fests, into
the dusty, unexplored regions of the Mac UI until you do actually find
it. Of course even then files are in different places, the terminology
is different (what is a 'Framework'? what is 'Xcode'? Do I really have
to sign up and pay to get a C compiler?).

Barry


From alobolistas at gmail.com  Thu Dec 23 16:28:32 2010
From: alobolistas at gmail.com (Agustin Lobo)
Date: Thu, 23 Dec 2010 16:28:32 +0100
Subject: [R-sig-Geo] R-sig-Geo Digest, Vol 88, Issue 23
In-Reply-To: <33858649-82EB-4700-87AA-810D89491B42@ecotoxicology.de>
References: <mailman.9.1293102005.4036.r-sig-geo@r-project.org>
	<33858649-82EB-4700-87AA-810D89491B42@ecotoxicology.de>
Message-ID: <AANLkTim7Xohvemyam_RvH2+WruTYZaRdtDkPOgretjBA@mail.gmail.com>

Many thanks for your clarifications, Ralf.
But if
> Actually the 4 options more or less boil down to two if you check what is done in detail:
.../...

then  we are just discarding alternative 1 in my first post:
"> setRepositories(ind=1:2)
> install.packages('rgdal')
"
Also, what about homebrew? is this not a good way to make this type of
things easier on Macs?

Finally, where you say
> BTW: "Linux Techies"  should have no major probs with Mac, given that the Mac system commands are more or less the same as for Linux systems
The problem is that most mac users I've had as students are not
Techies on anything. Otherwise, Macs are wonderful machines.

Agus

2010/12/23 Ralf Sch?fer <senator at ecotoxicology.de>:
> Just a quick reply:
>
> Actually the 4 options more or less boil down to two if you check what is done in detail:
> 1) install from source and install external dependencies before.
> This option should always be mentioned in case binaries do not work on a specific system (Tiger, Panther, Leopard etc) - and apart from that it can take a bit after rgdal binaries are available on kyngchaos after R updates (and some people may not want to wait after future updates). In addition, the installed tools may also be necessary for the R commander GUI, GIMP and other programs or if you need to install other packages from source.
> So the way to go is:
> 1. Install GDAL Framework on kyngchaos GDAL 1.7 Complete
> 2. Install R AND all tools for Mac: Gfortran gfortran-4.2.3.dmg TclTk tcltk-8.5.5-x11.dmg Developer pack devpack4-darwin8-bin4.tar.gz
> 3. Install Xcode tools - either from DVD that ships with every mac or after free registration here http://developer.apple.com/programs/register/ (the Xcode tools are also recommended in the Mac OS X FAQ for R http://cran.r-project.org/bin/macosx/RMacOSX-FAQ.html)
> 4. Install rgdal as already outlined
> install.packages("rgdal",
> configure.args='--with-gdal-config=/Library/Frameworks/GDAL.Framework/Unix/bin/gdal-config
> --with-proj-include=/Library/Frameworks/PROJ.framework/unix/include-with-proj-lib=/Library/Frameworks/PROJ.framework/unix/lib/',dependencies=TRUE,
> type="source")
>
> 2) as outlined by Barry
>> 1. Download the kyngchaos GDAL Complete 'Framework':
>> http://www.kyngchaos.com/files/software/frameworks/GDAL_Complete-1.7.dmg
>> 2. Double click it, I think that opened it up and then somehow things
>> from that get installed. Wish I'd kept screenshots
>> 2.5 Wonder where in the .dmg file the rgdal binary is.
>> 3. Download the kyngchaos rgdal binary:
>> http://www.kyngchaos.com/files/software/frameworks/rgdal-0.6.29-1.zip
>> and did install.packages on that.
>
>
>
> In general option 2 ?is easiest - but on the long run option 1) will help you also with other packages (Can`t remember exactly but just installed a new Mac Pro and had to install a couple of R packages from source).
> BTW: "Linux Techies" ?should have no major probs with Mac, given that the Mac system commands are more or less the same as for Linux systems
>
> Have a nice Xmas
> Ralf
>
>
>> Date: Thu, 23 Dec 2010 08:35:13 +0000
>> From: Barry Rowlingson <b.rowlingson at lancaster.ac.uk>
>> To: Agustin.Lobo at ija.csic.es
>> Cc: r-sig-geo <r-sig-geo at stat.math.ethz.ch>
>> Subject: Re: [R-sig-Geo] Help with rgdal on MACOS
>> Message-ID:
>> ? ? ? <AANLkTi=K2EmR2yNLUEzaz7PzTS9JuCQs5rhuy5x5Vf9Y at mail.gmail.com>
>> Content-Type: text/plain; charset=ISO-8859-1
>>
>> On Thu, Dec 23, 2010 at 7:36 AM, Agustin Lobo <alobolistas at gmail.com> wrote:
>>
>>> 4. Downloading binary from kyngchaos
>>> http://www.kyngchaos.com/software/frameworks?s[]=rgdal
>>> and installing with
>>> install.packages("~/Downloads/rgdal-0.6.29-1.zip")
>>> (I'm guessing the directory, is this the downloading directory by
>>> default in Macs?)
>>>
>>> Any advice on which one is the best alternative?
>>>
>>
>> I was recently asked by a new student with a Mac to sort out how to
>> read shapefiles into R for her. I know nothing about Mac packaging,
>> binaries, compilers etc, and she knew even less.
>>
>> After reading far too many confusing 'how to get rgdal working on a
>> Mac' mailing list messages, I got it working. What I think I did was:
>>
>> 1. Download the kyngchaos GDAL Complete 'Framework':
>> http://www.kyngchaos.com/files/software/frameworks/GDAL_Complete-1.7.dmg
>> 2. Double click it, I think that opened it up and then somehow things
>> from that get installed. Wish I'd kept screenshots
>> 2.5 Wonder where in the .dmg file the rgdal binary is.
>> 3. Download the kyngchaos rgdal binary:
>> http://www.kyngchaos.com/files/software/frameworks/rgdal-0.6.29-1.zip
>> and did install.packages on that.
>>
>> - this is your method 4 spelt out!
>>
>> I did get the fear that I was going to have to figure out what 'Xcode'
>> was, and that led me to the Apple developer page, and that seemed to
>> require an account - and a paid account at that - but then maybe Steve
>> Jobs thought I was going to try and write an iPhone app. I was at the
>> point of giving up and saying 'this is your laptop, you are the
>> superuser, you sort it out' when I spotted the rgdal binaries (which
>> weren't downloaded with the 'Framework', whatever one of those is).
>>
>> A walkthrough of installing rgdal for Mac with screenshots by this
>> method would be much appreciated. Too many non-techie people are
>> bringing Macs into the world and expecting techies with only Linux
>> (and a smidge of Windows) experience to fix them up. William
>> Kyngsbury's Mac resources are clearly a wonderful thing, but the
>> documentation for non Mac-heads is a bit sparse.
>>
>> Barry
>
> ? ? ? ?[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From senator at ecotoxicology.de  Thu Dec 23 17:15:37 2010
From: senator at ecotoxicology.de (=?iso-8859-1?Q?Ralf_Sch=E4fer?=)
Date: Thu, 23 Dec 2010 17:15:37 +0100
Subject: [R-sig-Geo] R-sig-Geo Digest, Vol 88, Issue 23
In-Reply-To: <AANLkTim7Xohvemyam_RvH2+WruTYZaRdtDkPOgretjBA@mail.gmail.com>
References: <mailman.9.1293102005.4036.r-sig-geo@r-project.org>
	<33858649-82EB-4700-87AA-810D89491B42@ecotoxicology.de>
	<AANLkTim7Xohvemyam_RvH2+WruTYZaRdtDkPOgretjBA@mail.gmail.com>
Message-ID: <90E5C832-54EB-4997-A248-CF8DB00BADC3@ecotoxicology.de>

> Many thanks for your clarifications, Ralf.
> But if
>> Actually the 4 options more or less boil down to two if you check what is done in detail:
> .../...
> 
> then  we are just discarding alternative 1 in my first post:
> "> setRepositories(ind=1:2)
>> install.packages('rgdal')

Well, if the normal repository binary works, then there is no problem in the first place.
And I probably commented based on the discussion with Daniel on the R-sig geo list yesterday and from experiences that often problems occur.
But indeed - option 1 is certainly to use CRAN repositories after installing GDAL framework before.

So, in my courses I usually show them first how to install the kyngchaos binaries and if that fails on some machines how to install from source - and was successful so far.

> Also, what about homebrew? is this not a good way to make this type of
> things easier on Macs?

Well, in the example it only installs the binaries from kyngchaos, so it is basically the same as option 2 just uses command line and requiring prior installation of a package manager (you need homebrew, Xcode, type some command in Mac terminal etc.)
But this is probably splitting hairs now.

> Finally, where you say
>> BTW: "Linux Techies"  should have no major probs with Mac, given that the Mac system commands are more or less the same as for Linux systems
> The problem is that most mac users I've had as students are not
> Techies on anything. Otherwise, Macs are wonderful machines.

Comment was more targeted on "Macs into the world and expecting techies with only Linux
> 
>>> (and a smidge of Windows) experience to fix them up."
and just wanted to state that for a Linux techie the Mac command line is not too difficult.

But you actually do not need Shell command line to install packages from source anyway - all tools can be installed as binaries and the package can be built from within R.

Anyway, have a good xmas
Ralf


From jacobvanetten at yahoo.com  Thu Dec 23 18:37:18 2010
From: jacobvanetten at yahoo.com (Jacob van Etten)
Date: Thu, 23 Dec 2010 17:37:18 +0000 (GMT)
Subject: [R-sig-Geo] Help with rgdal on MACOS
In-Reply-To: <AANLkTi=K2EmR2yNLUEzaz7PzTS9JuCQs5rhuy5x5Vf9Y@mail.gmail.com>
Message-ID: <171555.86159.qm@web29712.mail.ird.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101223/acea1b72/attachment.pl>

From r.hijmans at gmail.com  Thu Dec 23 18:53:56 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Thu, 23 Dec 2010 09:53:56 -0800
Subject: [R-sig-Geo] new function predict, package raster
In-Reply-To: <AANLkTimuN-nYQv8Cz9CyjmfXXrtVJ12o8GhrQXvriabp@mail.gmail.com>
References: <AANLkTikU1d4LrvtOCsVUb3FOVWV+NMcL2cpjvC8Bw8OC@mail.gmail.com>
	<AANLkTim4_1NH-sJE1OkUAgari22wy1_V=AHf8F5MB3v=@mail.gmail.com>
	<AANLkTi=ez4w1dnc3kM00jTL482JAy1MQtyAkhpPBR+dn@mail.gmail.com>
	<AANLkTinLzNRz2CocwHbZ3xyWgMg_zhCSpozJhZXD=99O@mail.gmail.com>
	<AANLkTim7K-m6Ebv2_rrv9CBx2uHxOAFGT4MtZ0YLR+7q@mail.gmail.com>
	<AANLkTimd0oOu_DwNrfeHF8GPRqeP6pXQZ94+iG6gjj91@mail.gmail.com>
	<AANLkTimHsO-kqUN0W3U6BkGx51uWuD+W+3oOO1Nk5i57@mail.gmail.com>
	<AANLkTi=8WVdp2xyoXQ_D1BGhPhmJ=ufcxs51i4TKTRiR@mail.gmail.com>
	<AANLkTimuN-nYQv8Cz9CyjmfXXrtVJ12o8GhrQXvriabp@mail.gmail.com>
Message-ID: <AANLkTi=jwQgU1JfFM4mbi0PRDXtTDoYqVAVCuF4QjgNH@mail.gmail.com>

Isabelle, I think you nailed it. The function now sets the levels and
things seem to work well (version 1-7.19). Thanks! Robert

On Thu, Dec 23, 2010 at 3:54 AM, isabelle boulangeat
<isabelle.boulangeat at gmail.com> wrote:
> Dear Robert,
>
> I think the problem when using random Forest is that the variable "factor"
> is converted into factor inside the predict function and some levels are
> lost? if the levels are not all in the blockvals selection.
> Do you think it is possible to overcome this problem?
>
> Cheers,
>
> Isabelle.
>
> 2010/12/13 isabelle boulangeat <isabelle.boulangeat at gmail.com>
>>
>> Dear Robert,
>>
>> Today, with the version 1.7-12, there is again a problem with the function
>> "predict" and randomForest.
>> It works perfecly when I remove the categorial variable, but I got this
>> error when I add the categorial variable:
>>
>> Erreur dans predict.randomForest(model, blockvals, ...) :
>> ? Type of predictors in new data do not match that of the training data.
>>
>> I have a similar error using the package party:
>>
>> Erreur dans checkData(oldData, RET) :
>> ? Classes of new data do not match original data
>>
>> details:
>>
>> Pred_ras <- predict(regionalStack, model=rf2PA,? type="prob",? index=2)
>>
>> layerNames(regionalStack)
>> [1] "Mtc"??????? "prcpwin"??? "mind678"??? "sradyy"???? "ru"
>> "carbonSoil"
>> [7] "clc"
>>
>> rf2PA <- randomForest(as.factor(resp) ~ ., data=dat)
>>
>> > str(dat)
>> 'data.frame':?? 14029 obs. of? 8 variables:
>> ?$ resp????? : num? 1 0 0 0 1 0 0 0 0 0 ...
>> ?$ Mtc?????? : num? -194.4 -282.9 -168 -176.5 -53.3 ...
>> ?$ prcpwin?? : num? 478 603 720 724 572 ...
>> ?$ mind678?? : num? -655 -627 -780 -770 -643 ...
>> ?$ sradyy??? : num? 17219 19636 20471 20318 14564 ...
>> ?$ ru??????? : num? 89 89 75 75 74.4 ...
>> ?$ carbonSoil: num? 50 50 50 50 50 50 50 50 50 50 ...
>> ?$ clc?????? : Factor w/ 7 levels "1","2","3","4",..: 5
>>
>>
>> unique(dat$clc)
>> [1] 3 5 4 6 7 1 2
>> Levels: 1 2 3 4 5 6 7
>>
>> ?unique(subset(regionalStack, 7))
>> [1] 1 2 3 4 5 6 7
>>
>> Any idea?
>>
>> 2010/12/8 Robert J. Hijmans <r.hijmans at gmail.com>
>>>
>>> Isabelle, I think I fixed this in raster 1.7-11. Robert
>>>
>>> On Wed, Dec 8, 2010 at 8:55 AM, isabelle boulangeat
>>> <isabelle.boulangeat at gmail.com> wrote:
>>> > Dear Robert,
>>> >
>>> > I am afraid this doesn't work with a "randomForest" model type (package
>>> > randomForest), although there is no problem without categorical
>>> > variables.
>>> >
>>> > To be continued...
>>> >
>>> > Isabelle.
>>> >
>>> > 2010/12/6 isabelle boulangeat <isabelle.boulangeat at gmail.com>
>>> >>
>>> >> Dear Robert,
>>> >>
>>> >> I tested today my script with the package 1.7-9 and it works!
>>> >>
>>> >> Pred_fac <- predict(rasStack, model=model_fac, predict = predict.glm,
>>> >> type="response", progress='text')
>>> >>
>>> >> Thanks a lot.
>>> >>
>>> >> Isabelle.
>>> >>
>>> >> 2010/12/3 Robert J. Hijmans <r.hijmans at gmail.com>
>>> >>>
>>> >>> Dear Isabelle,
>>> >>>
>>> >>> Thanks for the detailed report. So it is a bug after all. This is
>>> >>> probably fixed in raster 1.7-8 (on CRAN for win and lin now).
>>> >>> At least the below works for me (model with 2 variables, one is a
>>> >>> factor).
>>> >>>
>>> >>> Robert
>>> >>>
>>> >>> library(raster)
>>> >>> # create a RasterStack (a set of predictor rasters)
>>> >>> logo <- stack(system.file("external/rlogo.grd", package="raster"))
>>> >>> presence <- matrix(c(48, 48, 48, 53, 50, 46, 54, 70, 84, 85, 74, 84,
>>> >>> 95, 85, 66, 42, 26, 4, 19, 17, 7, 14, 26, 29, 39, 45, 51, 56, 46, 38,
>>> >>> 31, 22, 34, 60, 70, 73, 63, 46, 43, 28), ncol=2)
>>> >>> background <- cbind(runif(250)*(xmax(logo)-xmin(logo))+xmin(logo),
>>> >>> runif(250)*(ymax(logo)-ymin(logo))+ymin(logo))
>>> >>>
>>> >>> xy <- rbind(cbind(1, presence), cbind(0, background))
>>> >>> v <- cbind(xy[,1], extract(logo, xy[,2:3]))
>>> >>> colnames(v)[1] <- 'presback'
>>> >>> v=data.frame(v[,1:3])
>>> >>> v[,3] <- as.factor(v[,3])
>>> >>>
>>> >>> model <- glm(formula=presback~., data=v)
>>> >>> r <- predict(logo, model, progress='text')
>>> >>>
>>> >>>
>>> >>>
>>> >>>
>>> >>> On Fri, Dec 3, 2010 at 3:26 AM, isabelle boulangeat
>>> >>> <isabelle.boulangeat at gmail.com> wrote:
>>> >>> > Hi,
>>> >>> >
>>> >>> > Thanks for all these explanations. I misunderstood the use of the
>>> >>> > "const".
>>> >>> > In my case, I just need to deal with an explicative variable that
>>> >>> > is
>>> >>> > spatially explicit but categorial.
>>> >>> > I should use a raster with numbers that correspond to my factor's
>>> >>> > levels.
>>> >>> > However, I still have some problems to predict using the categorial
>>> >>> > variable
>>> >>> > (raster package, version 1.7-7)
>>> >>> >
>>> >>> > my code : predict(rasStack, model=model_fac)
>>> >>> > Error message : Erreur dans v[cells, ] <- predv :
>>> >>> >
>>> >>> > Here are details on the raster Stack and the data.frame containing
>>> >>> > explicative variables to fit the model (expl).
>>> >>> >
>>> >>> > rasStack
>>> >>> > class?????? : RasterStack
>>> >>> > nlayers???? : 2
>>> >>> > nrow??????? : 3137
>>> >>> > ncol??????? : 1951
>>> >>> > ncell?????? : 6120287
>>> >>> > projection? : +proj=lcc +lat_1=45.89891888888889
>>> >>> > +lat_2=47.69601444444444
>>> >>> > +lat_0=46.8 +lon_0=2.337229166666667 +x_0=600000 +y_0=2200000
>>> >>> > +ellps=WGS84
>>> >>> > +datum=WGS84 +units=m +no_defs +towgs84=0,0,0
>>> >>> > min value?? : -1280???? 1
>>> >>> > max value?? : 462?? 7
>>> >>> > extent????? : 784300, 979400, 1858800, 2172500? (xmin, xmax, ymin,
>>> >>> > ymax)
>>> >>> > resolution? : 100, 100? (x, y)
>>> >>> >
>>> >>> > layerNames(rasStack)
>>> >>> > [1] "temp"?? "corine"
>>> >>> >
>>> >>> > unique(getValues(rasStack[[2]]))
>>> >>> > [1] NA? 6? 5? 1? 7? 4? 2? 3
>>> >>> >
>>> >>> > str(expl)
>>> >>> > 'data.frame':?? 11396 obs. of? 2 variables:
>>> >>> > ?$ temp? : num? -78.4 -282.9 -172.1 -173.6 -83.2 ...
>>> >>> > ?$ corine: Factor w/ 7 levels "1","2","3","4",..: 6 4 3 4 5 6 6 4 5
>>> >>> > 6
>>> >>> > ...
>>> >>> >
>>> >>> > unique(expl$corine)
>>> >>> > [1] 6 4 3 5 7 2 1
>>> >>> > Levels: 1 2 3 4 5 6 7
>>> >>> >
>>> >>> > model_fac <- glm(resp ~ ., data=expl, family="binomial")
>>> >>> >
>>> >>> >
>>> >>> > Any idea?
>>> >>> >
>>> >>> > 2010/12/2 Robert J. Hijmans <r.hijmans at gmail.com>
>>> >>> >>
>>> >>> >> Isabelle,
>>> >>> >>
>>> >>> >> If you use a factor that is represented by numbers on a grid you
>>> >>> >> can
>>> >>> >> just fit the model (with the factor variable as factor), and the
>>> >>> >> predict function will then make a factor from the predictor layers
>>> >>> >> (i.e. there is nothing else you need to do). Where this can go
>>> >>> >> wrong
>>> >>> >> is if you have factor levels on your raster that were not in the
>>> >>> >> data
>>> >>> >> used to fit the model. You can get something like:
>>> >>> >> Error in model.frame.default(Terms, newdata, na.action =
>>> >>> >> na.action,
>>> >>> >> xlev = object$xlevels) :
>>> >>> >> ?factor 'x' has new level(s): ?2, 3, 4, 5,
>>> >>> >> Which means that you first need to remove those levels (set to NA)
>>> >>> >> from your predictor raster. (I will try to automate that problem
>>> >>> >> away,
>>> >>> >> in raster::predict, eventually)
>>> >>> >>
>>> >>> >> The argument "const" is for factor type variables for which you do
>>> >>> >> not
>>> >>> >> have spatial data. Hence they could be considered 'constant' in
>>> >>> >> some
>>> >>> >> contexts. For example, with fish observation data you might have a
>>> >>> >> model that predicts abundance from a number of variables including
>>> >>> >> the
>>> >>> >> method used to catch the fish. Say a factor variable "method" with
>>> >>> >> levels "A" or "B". You can then do something like
>>> >>> >> method = factor("A")
>>> >>> >> predict(raster, model, const=method)
>>> >>> >>
>>> >>> >> Robert
>>> >>> >>
>>> >>> >> On Thu, Dec 2, 2010 at 9:02 AM, isabelle boulangeat
>>> >>> >> <isabelle.boulangeat at gmail.com> wrote:
>>> >>> >> > Hello,
>>> >>> >> >
>>> >>> >> > I am trying to use the recently updated function "predict" from
>>> >>> >> > the
>>> >>> >> > package
>>> >>> >> > raster. I would like to use the field "const", as one of my
>>> >>> >> > variable
>>> >>> >> > is
>>> >>> >> > categorial.
>>> >>> >> > I have an error message but I can't find where is the problem.
>>> >>> >> >
>>> >>> >> > Error message : Erreur dans `[.data.frame`(blockvals, , f[i]) :
>>> >>> >> > undefined
>>> >>> >> > columns selected
>>> >>> >> >
>>> >>> >> > code : Pred_fac <- predict(rasStack, model=model_fac,
>>> >>> >> > predict=predict.glm,
>>> >>> >> > progress='text', const=factorDF)
>>> >>> >> >
>>> >>> >> > rasStack is a RasterStack and contains only one layer with one
>>> >>> >> > explicative
>>> >>> >> > variable. the layer name is the same as in the model.
>>> >>> >> > factorDF is a data.frame and contains only one column with one
>>> >>> >> > explicative
>>> >>> >> > variable. the column name is the same as in the model.
>>> >>> >> >
>>> >>> >> > the dimensions are the same : the number of rows in the data
>>> >>> >> > frame
>>> >>> >> > correspond to the number of cells in the raster.
>>> >>> >> >
>>> >>> >> > Does someone succeed to use this function with the new field
>>> >>> >> > "const"
>>> >>> >> > ?
>>> >>> >> >
>>> >>> >> > Thanks for help,
>>> >>> >> >
>>> >>> >> > Cheers,
>>> >>> >> >
>>> >>> >> > Isabelle.
>>> >>> >> >
>>> >>> >> > --
>>> >>> >> > Isabelle Boulangeat, PhD student
>>> >>> >> > Ecosystem dynamics and plant traits
>>> >>> >> >
>>> >>> >> > Bureau 203, +33 (0) 476 635 733
>>> >>> >> >
>>> >>> >> > Laboratoire d'?cologie Alpine (LECA)
>>> >>> >> > Grenoble, France
>>> >>> >> > lab' s website : http://www-leca.ujf-grenoble.fr/
>>> >>> >> > my website : http://j.boulangeat.free.fr/
>>> >>> >> >
>>> >>> >> > ? ? ? ?[[alternative HTML version deleted]]
>>> >>> >> >
>>> >>> >> >
>>> >>> >> > _______________________________________________
>>> >>> >> > R-sig-Geo mailing list
>>> >>> >> > R-sig-Geo at r-project.org
>>> >>> >> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>> >>> >> >
>>> >>> >> >
>>> >>> >
>>> >>> >
>>> >>> >
>>> >>> > --
>>> >>> > Isabelle Boulangeat, PhD student
>>> >>> > Ecosystem dynamics and plant traits
>>> >>> >
>>> >>> > Bureau 203, +33 (0) 476 635 733
>>> >>> >
>>> >>> > Laboratoire d'?cologie Alpine (LECA)
>>> >>> > Grenoble, France
>>> >>> > lab' s website : http://www-leca.ujf-grenoble.fr/
>>> >>> > my website : http://j.boulangeat.free.fr/
>>> >>> >
>>> >>
>>> >>
>>> >>
>>> >> --
>>> >> Isabelle Boulangeat, PhD student
>>> >> Ecosystem dynamics and plant traits
>>> >>
>>> >> Bureau 203, +33 (0) 476 635 733
>>> >>
>>> >> Laboratoire d'?cologie Alpine (LECA)
>>> >> Grenoble, France
>>> >> lab' s website : http://www-leca.ujf-grenoble.fr/
>>> >> my website : http://j.boulangeat.free.fr/
>>> >
>>> >
>>> >
>>> > --
>>> > Isabelle Boulangeat, PhD student
>>> > Ecosystem dynamics and plant traits
>>> >
>>> > Bureau 203, +33 (0) 476 635 733
>>> >
>>> > Laboratoire d'?cologie Alpine (LECA)
>>> > Grenoble, France
>>> > lab' s website : http://www-leca.ujf-grenoble.fr/
>>> > my website : http://j.boulangeat.free.fr/
>>> >
>>
>>
>>
>> --
>> Isabelle Boulangeat, PhD student
>> Ecosystem dynamics and plant traits
>>
>> Bureau 203, +33 (0) 476 635 733
>>
>> Laboratoire d'?cologie Alpine (LECA)
>> Grenoble, France
>> lab' s website : http://www-leca.ujf-grenoble.fr/
>> my website : http://j.boulangeat.free.fr/
>
>
>
> --
> Isabelle Boulangeat, PhD student
> Ecosystem dynamics and plant traits
>
> Bureau 203, +33 (0) 476 635 733
>
> Laboratoire d'?cologie Alpine (LECA)
> Grenoble, France
> lab' s website : http://www-leca.ujf-grenoble.fr/
> my website : http://j.boulangeat.free.fr/
>


From r.hijmans at gmail.com  Thu Dec 23 18:58:28 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Thu, 23 Dec 2010 09:58:28 -0800
Subject: [R-sig-Geo] gridded time series analysis
In-Reply-To: <AANLkTimVUyCGiM_uYGXWZo8JBf=nOevTiDvkZ36RCvbB@mail.gmail.com>
References: <AANLkTimTdxzoDCfJQOB8bgQRhjLy3YzSbtGtMdijk9sQ@mail.gmail.com>
	<771411.8321.qm@web29709.mail.ird.yahoo.com>
	<AANLkTin2DYocWNOAR-LfGoBP4+gCtA7eVDHmoaQ6wriR@mail.gmail.com>
	<AANLkTimFw1zMH75s+TG+SFkBHfXzpURm2WXskAa8Kp=m@mail.gmail.com>
	<AANLkTim9dBnVkZ0tjvoa1YRpPRr156jJ9zcezMDrtzhX@mail.gmail.com>
	<AANLkTi=vW6NXYXKGNa0gcTfZ8ezEjvegdxU3Dt5SPA4F@mail.gmail.com>
	<AANLkTikqNmC62Pv-n9Dxd1w7fTHJPx8cR72U6YEtWMTV@mail.gmail.com>
	<AANLkTikQsL9opzu1i0mWxtJA6YmcgBbGdbihXFOwPRho@mail.gmail.com>
	<AANLkTinY5+3JbpZfWnriDZNOdmcfic0628Qi0=NDZghK@mail.gmail.com>
	<AANLkTikd-PJKWZdWUL2+S9VYAq1QJ4LPwG2==erEs2+Q@mail.gmail.com>
	<AANLkTi=eZL0Rq5EyoRA29fdnN2VL-Xt6hcGN4DnZgCKk@mail.gmail.com>
	<AANLkTikVto4GD=vO=5YKwKXL7y+Ze4ADn2KXpsw1AFVA@mail.gmail.com>
	<AANLkTinUvhmDLP2YSWuqb5=G0YKX=sWp6yMOj9KPAgdA@mail.gmail.com>
	<AANLkTi=P5HNFjEsaapUBF7vSAFAsekU_4bYJqXnW=gbu@mail.gmail.com>
	<AANLkTikwWainpBBeSr8xnNNq8uoFXdU2n_34y2-u6K5J@mail.gmail.com>
	<AANLkTin5-hV=b8yxQnvviF_4w-uPfsSJ9X82pmbi=WQo@mail.gmail.com>
	<AANLkTikmPMvBRuu6RvjXsd8LdJc38FP+tAiF9iAc31Ks@mail.gmail.com>
	<AANLkTikSowU_SFiCmZyE3TKEa_UesH_SDQdPP63i+ERY@mail.gmail.com>
	<AANLkTi=p+LbmQ96GSJFuYyw-HLcCxJgYqaK4n2pBZcbG@mail.gmail.com>
	<AANLkTinvp-k47MHyV2s+hje_P0VXHvTmOKPFf8q5btAO@mail.gmail.com>
	<AANLkTi=S8tY50xzS2PFS7LvUEMT4cb4TFME-kT7DkmS0@mail.gmail.com>
	<AANLkTims2FyRBiLdmtZzR8wwvrBSyMuepVe0_Li-B6nU@mail.gmail.com>
	<AANLkTinzLPLDhoLwpcRkJ4twJ+FFd=ukOYpHh220S2mE@mail.gmail.com>
	<AANLkTikmm6QvAC69cPG7i4bT6wmWVBfwpO-4mHZ7JEvL@mail.gmail.com>
	<AANLkTikAMe3C=hQon56eh3nQd_G6gHJ=iQPh0JyJhqJ7@mail.gmail.com>
	<AANLkTikrWWOzicMeLk4sEP_y9Dfo7fZk1gUmC5-6HRd5@mail.gmail.com>
	<AANLkTikXrGQSTKsey9u+rXFsnVtmszown6PV0i0ca7mQ@mail.gmail.com>
	<AANLkTimVUyCGiM_uYGXWZo8JBf=nOevTiDvkZ36RCvbB@mail.gmail.com>
Message-ID: <AANLkTikb-iu=V-vP7Lfvt=6WUzp3uVxv10OFX4rC81_r@mail.gmail.com>

The problem occurs because the function sometimes returns one value
(NA) and sometimes 2 (slope and intercept). You can easily fix this as
shown below and then it should work.

fun <- function(x) {
	if (sum(is.na(x[1:12]))) {
		return(c(NA, NA))
	} else {
		resp = x[1:12]
		expl = x[13:24]
		mdl = lm(resp ~ expl)
		res = c(mdl$coef[1] , mdl$coef[2])
		return(res)
	}
}

The error message is not very helpfu;; I'll look into that.

On Wed, Dec 22, 2010 at 7:18 PM, Advait Godbole <advaitgodbole at gmail.com> wrote:
> That works Robert, thanks. There is still the issue of NA values. some grid
> cells have all values in the time series as missing (these are cells over
> the ocean, to make physical sense). Is there a way to disregard them in the
> calculation entirely? lm does have a na.action argument but it does not seem
> to handle all missing values. You had initially suggested an if condition
> within the function definition and I did this:
> fun <- function(x) { if((sum(is.na(x[1:120]))==120) ||
> (sum(is.na(x[121:240]))==120)) {NA}
> ?? else {
> ?? resp = x[1:120]
> ?? expl = x[121:240]
> ?? mdl = lm(resp ~ expl)
> ?? res = c(mdl$coef[1] , mdl$coef[2])
> ?? return(res)
> ?? }
> }
> # now do:
> b2 <- calc(s_crop, fun)
> modintercept <- b2[[1]]
> modslope <- b2[[2]]
> This seems to have taken care of the NAs but returned this error:
>> b2 <- calc(s_crop, fun)
> Error in setValues(out, x) : values must be numeric, integer or logical.
> Is there a problem with the way the NA is being returned after checking the
> if condition?
> Thanks,
> advait
>
> On Wed, Dec 22, 2010 at 8:17 PM, Advait Godbole <advaitgodbole at gmail.com>
> wrote:
>>
>> Dear Robert,
>> Sorry about that - will incorporate an example in future. I tried the calc
>> method and it is definitely much simpler! if "s_crop" is my raster stack for
>> the following:
>> s_crop <- stack(emitraster_crop,rcmraster_crop)
>> fun <- function(x) {
>> ?? resp = x[1:120]
>> ?? expl = x[121:240]
>> ?? mdl = lm(resp ~ expl)
>> ?? res = c(mdl$coef[1] , mdl$coef[2])
>> ?? return(res)
>> }
>> # now do:
>> b2 <- calc(s_crop, fun)
>> I looked at the output and it appears that b2[[1]] are the intercept and
>> b2[[2]] are coefficients. Is that right? Also, for the later part:
>> datCoef = apply(getValues(s_crop), 1, fun)
>> b1 <- setValues(s_crop, t(datCoef))
>> I get:
>> Error in function (classes, fdef, mtable) ?:
>> ??unable to find an inherited method for function "setValues", for
>> signature "RasterStack"
>> Is this being done to create a new Raster object of slopes and
>> intercepts?
>> Also, I dont quite understand why setValues is being used here.
>> Thanks,
>> Advait
>> On Wed, Dec 22, 2010 at 7:26 PM, Robert J. Hijmans <r.hijmans at gmail.com>
>> wrote:
>>>
>>> Advait,
>>>
>>> When asking for help, please provide a self-contained example whenever
>>> possible, as below.
>>>
>>> library(raster)
>>> v1 <- matrix(rep(1:12, 16), nrow=16)
>>> v2 <- matrix(rep(1:12, 16), nrow=16, byrow=TRUE)
>>> b <- brick(ncol=4, nrow=4)
>>> b1 <- setValues(b, v1)
>>> b2 <- setValues(b, v2)
>>> s <- stack(b1, b2)
>>>
>>> fun <- function(x) {
>>> ? ?resp = x[1:12]
>>> ? ?expl = x[13:24]
>>> ? ?mdl = lm(resp ~ expl)
>>> ? ?res = c(mdl$coef[1] , mdl$coef[2])
>>> ? ?return(res)
>>> }
>>>
>>> # now do:
>>> b2 <- calc(s, fun)
>>>
>>> # as an alternative to the above you could do
>>> # but I would not recommend this
>>>
>>> datCoef = apply(getValues(s), 1, fun2)
>>> b1 <- setValues(s, t(datCoef))
>>>
>>> # I think you were complicating matters with plyr.
>>> # But to get those values in a brick you could do something like
>>> b1 <- setValues(s, as.matrix(datCoef)[,3:4])
>>> # But I am not sure if you would get the values in the correct cells
>>> # (the number matches, but perhaps not the order).
>>>
>>> Best, Robert
>>>
>>>
>>>
>>> On Wed, Dec 22, 2010 at 10:39 AM, Advait Godbole
>>> <advaitgodbole at gmail.com> wrote:
>>> > Dear Members,
>>> > I was able to find a solution after some deliberation and posting it
>>> > here
>>> > for the benefit of forum members.
>>> > To recap, my data was in the form of 2 netCDF files, each of dimension
>>> > 356 x
>>> > 507 x 120 (lat,lon,time). I wanted to perform regressions between the
>>> > two
>>> > variables on each grid point over time. I used "brick" to read in the
>>> > netcdfs as raster layers and stack along with the "plyr"?package to
>>> > perform
>>> > these regressions on the grid.
>>> > # create raster object from the netcdf
>>> > rcmraster <- brick("regcm.cumul.hdd.10k.96_05.fixed.latlonvars.nc",
>>> > varname
>>> > = "hdd")
>>> > emitraster <-
>>> >
>>> > brick("flip.percap.vulcan.10k.dp.build.381.RES.EIAmy.96_05.this.latest.nc",varname="emitpercap")
>>> > # crop subset of above rasters, test method on subset which is 4 x 4 x
>>> > 120
>>> > lim <- extent(rcmraster,180,185,300,305)
>>> > rcmraster_crop <- crop(rcmraster,lim)
>>> > emitraster_crop <- crop(emitraster,lim)
>>> > # do some plotting to check
>>> > ?par(mfrow=c(1,2))
>>> > ?plot(rcmraster_crop[[1]])
>>> > ?plot(emitraster_crop[[1]])
>>> > # test regressions for cropped subset
>>> > s_crop <- stack(emitraster_crop,rcmraster_crop)
>>> > # use of plyr (provides a more elegant alternative to lapply)
>>> > # the data frame datCoef contains the slope and intercept for each
>>> > point in
>>> > the grid (denoted by X1 and X2)
>>> > datCoef = adply( as.array(s_crop) , 1:2 ,
>>> > ?? ? ? ? ? ? ?function(x ) {
>>> > ?? ? ? ? ? ? ? ? ? ? ? ? ? ?resp = x[1:120]
>>> > ?? ? ? ? ? ? ? ? ? ? ? ? ? ?expl = x[121:240]
>>> > ?? ? ? ? ? ? ? ? ? ? ? ? ? ?mdl = lm(resp ~ expl)
>>> > ?? ? ? ? ? ? ? ? ? ? ? ? ? ?res = c(mdl$coef[1] , mdl$coef[2])
>>> > ?? ? ? ? ? ? ? ? ? ? ? ? ? ?return(res)
>>> >
>>> > ?? ? ? ? ? ? ? ? ? ? ? ? ?}
>>> > ?? ? ? ? ? ? ? ? ? ? ? ? ?)
>>> > Output of datCoef()
>>> >> datCoef
>>> > ?? X1 X2 ?(Intercept) ? ? ? ? expl
>>> > 1 ? 1 ?1 0.0010523406 2.623927e-05
>>> > 2 ? 2 ?1 0.0019401572 5.049197e-05
>>> > 3 ? 3 ?1 0.0171326653 4.425026e-04
>>> > 4 ? 4 ?1 0.0012244689 3.045755e-05
>>> > 5 ? 1 ?2 0.0011454348 2.892668e-05
>>> > 6 ? 2 ?2 0.0013920425 3.460922e-05
>>> > 7 ? 3 ?2 0.0015973400 3.943349e-05
>>> > 8 ? 4 ?2 0.0016494511 4.045801e-05
>>> > 9 ? 1 ?3 0.0018757258 4.704107e-05
>>> > 10 ?2 ?3 0.0038066075 9.378512e-05
>>> > 11 ?3 ?3 0.0039669120 9.719391e-05
>>> > 12 ?4 ?3 0.0038055524 9.246021e-05
>>> > 13 ?1 ?4 0.0015700329 3.921758e-05
>>> > 14 ?2 ?4 0.0003727142 9.156119e-06
>>> > 15 ?3 ?4 0.0005315722 1.308365e-05
>>> > 16 ?4 ?4 0.0005872930 1.539454e-05
>>> > Now, what I want to do is for each of these X1,X2, get a "predicted"
>>> > map
>>> > based on a new X which is an array of dimensions 4 x 4 (same as the
>>> > rasters.
>>> > in the original dataset, it will be 356 x 507). This array has the
>>> > following
>>> > values:
>>> >> futurehdda
>>> > ?? ? ? ? [,1] ? ? [,2] ? ? [,3] ? ? [,4]
>>> > [1,] 5707.575 5696.325 5692.960 5683.110
>>> > [2,] 5680.303 5665.092 5660.790 5647.896
>>> > [3,] 5656.163 5641.045 5638.886 5625.231
>>> > [4,] 5634.604 5619.317 5620.226 5601.729
>>> > How can I extract the slope and intercept from datCoef and use the
>>> > above X
>>> > to get a predicted Y with the same dimensions (4 x 4)?
>>> > Thanks,
>>> > Advait
>>> > On Mon, Dec 6, 2010 at 4:57 PM, Robert J. Hijmans <r.hijmans at gmail.com>
>>> > wrote:
>>> >>
>>> >> Dear Advait,
>>> >>
>>> >> > What I dont understand is:
>>> >> > 1) How can each slope be the same (values of x1)
>>> >>
>>> >> Apparently the values in these cells are all the same (not that you
>>> >> only use the first 8 time steps, not all 120)
>>> >>
>>> >> Here is an example with random values in which the slopes are all
>>> >> different
>>> >>
>>> >> b <- brick(ncol=4, nrow=4, nl=120)
>>> >> b <- setValues(b, matrix(runif(prod(dim(b))), ncol=120))
>>> >> fun = function(x) { if(is.na(x[1])) { NA } else { lm(x[1:60] ~
>>> >> x[61:120])$coefficients[2] } }
>>> >> x <- calc(b, fun)
>>> >> plot(x)
>>> >> as.matrix(x)
>>> >>
>>> >>
>>> >> > 2) The raster layers are of dimensions 4 x 4 x 120
>>> >> > but?dim(getValues(rcmraster_crop))
>>> >> > [1] ?16 120. Why is that? This must have implications for the way
>>> >> > that
>>> >> > the
>>> >> > regressions for the brick are handled wouldnt it?
>>> >> No
>>> >>
>>> >> > Or is it specific to the
>>> >> > way "getValues" handles things?
>>> >>
>>> >> Yes. rows are cells (4*4=16), columns are layers.
>>> >>
>>> >> > Also, does anyone have any pointers of how to accomplish the NA
>>> >> > testing
>>> >> > and
>>> >> See an example above, assuming that if the first time step is NA, they
>>> >> all are. You could also do things like
>>> >> if (sum(is.na(x)) > 60)
>>> >> depends on your context.
>>> >>
>


From tgriffin at uaex.edu  Thu Dec 23 19:36:22 2010
From: tgriffin at uaex.edu (Terry Griffin)
Date: Thu, 23 Dec 2010 12:36:22 -0600 (CST)
Subject: [R-sig-Geo] gridded time series analysis
Message-ID: <2070946482.8664691293129382315.JavaMail.root@zmail.uaex.edu>





-----Original Message-----
From: Robert J. Hijmans <r.hijmans at gmail.com>
Sent: Thursday, December 23, 2010 12:00 PM
To: Advait Godbole <advaitgodbole at gmail.com>
Cc: r-sig-geo <r-sig-geo at stat.math.ethz.ch>
Subject: Re: [R-sig-Geo] gridded time series analysis

The problem occurs because the function sometimes returns one value
(NA) and sometimes 2 (slope and intercept). You can easily fix this as
shown below and then it should work.

fun <- function(x) {
	if (sum(is.na(x[1:12]))) {
		return(c(NA, NA))
	} else {
		resp = x[1:12]
		expl = x[13:24]
		mdl = lm(resp ~ expl)
		res = c(mdl$coef[1] , mdl$coef[2])
		return(res)
	}
}

The error message is not very helpfu;; I'll look into that.

On Wed, Dec 22, 2010 at 7:18 PM, Advait Godbole <advaitgodbole at gmail.com> wrote:
> That works Robert, thanks. There is still the issue of NA values. some grid
> cells have all values in the time series as missing (these are cells over
> the ocean, to make physical sense). Is there a way to disregard them in the
> calculation entirely? lm does have a na.action argument but it does not seem
> to handle all missing values. You had initially suggested an if condition
> within the function definition and I did this:
> fun <- function(x) { if((sum(is.na(x[1:120]))==120) ||
> (sum(is.na(x[121:240]))==120)) {NA}
> ?? else {
> ?? resp = x[1:120]
> ?? expl = x[121:240]
> ?? mdl = lm(resp ~ expl)
> ?? res = c(mdl$coef[1] , mdl$coef[2])
> ?? return(res)
> ?? }
> }
> # now do:
> b2 <- calc(s_crop, fun)
> modintercept <- b2[[1]]
> modslope <- b2[[2]]
> This seems to have taken care of the NAs but returned this error:
>> b2 <- calc(s_crop, fun)
> Error in setValues(out, x) : values must be numeric, integer or logical.
> Is there a problem with the way the NA is being returned after checking the
> if condition?
> Thanks,
> advait
>
> On Wed, Dec 22, 2010 at 8:17 PM, Advait Godbole <advaitgodbole at gmail.com>
> wrote:
>>
>> Dear Robert,
>> Sorry about that - will incorporate an example in future. I tried the calc
>> method and it is definitely much simpler! if "s_crop" is my raster stack for
>> the following:
>> s_crop <- stack(emitraster_crop,rcmraster_crop)
>> fun <- function(x) {
>> ?? resp = x[1:120]
>> ?? expl = x[121:240]
>> ?? mdl = lm(resp ~ expl)
>> ?? res = c(mdl$coef[1] , mdl$coef[2])
>> ?? return(res)
>> }
>> # now do:
>> b2 <- calc(s_crop, fun)
>> I looked at the output and it appears that b2[[1]] are the intercept and
>> b2[[2]] are coefficients. Is that right? Also, for the later part:
>> datCoef = apply(getValues(s_crop), 1, fun)
>> b1 <- setValues(s_crop, t(datCoef))
>> I get:
>> Error in function (classes, fdef, mtable) ?:
>> ??unable to find an inherited method for function "setValues", for
>> signature "RasterStack"
>> Is this being done to create a new Raster object of slopes and
>> intercepts?
>> Also, I dont quite understand why setValues is being used here.
>> Thanks,
>> Advait
>> On Wed, Dec 22, 2010 at 7:26 PM, Robert J. Hijmans <r.hijmans at gmail.com>
>> wrote:
>>>
>>> Advait,
>>>
>>> When asking for help, please provide a self-contained example whenever
>>> possible, as below.
>>>
>>> library(raster)
>>> v1 <- matrix(rep(1:12, 16), nrow=16)
>>> v2 <- matrix(rep(1:12, 16), nrow=16, byrow=TRUE)
>>> b <- brick(ncol=4, nrow=4)
>>> b1 <- setValues(b, v1)
>>> b2 <- setValues(b, v2)
>>> s <- stack(b1, b2)
>>>
>>> fun <- function(x) {
>>> ? ?resp = x[1:12]
>>> ? ?expl = x[13:24]
>>> ? ?mdl = lm(resp ~ expl)
>>> ? ?res = c(mdl$coef[1] , mdl$coef[2])
>>> ? ?return(res)
>>> }
>>>
>>> # now do:
>>> b2 <- calc(s, fun)
>>>
>>> # as an alternative to the above you could do
>>> # but I would not recommend this
>>>
>>> datCoef = apply(getValues(s), 1, fun2)
>>> b1 <- setValues(s, t(datCoef))
>>>
>>> # I think you were complicating matters with plyr.
>>> # But to get those values in a brick you could do something like
>>> b1 <- setValues(s, as.matrix(datCoef)[,3:4])
>>> # But I am not sure if you would get the values in the correct cells
>>> # (the number matches, but perhaps not the order).
>>>
>>> Best, Robert
>>>
>>>
>>>
>>> On Wed, Dec 22, 2010 at 10:39 AM, Advait Godbole
>>> <advaitgodbole at gmail.com> wrote:
>>> > Dear Members,
>>> > I was able to find a solution after some deliberation and posting it
>>> > here
>>> > for the benefit of forum members.
>>> > To recap, my data was in the form of 2 netCDF files, each of dimension
>>> > 356 x
>>> > 507 x 120 (lat,lon,time). I wanted to perform regressions between the
>>> > two
>>> > variables on each grid point over time. I used "brick" to read in the
>>> > netcdfs as raster layers and stack along with the "plyr"?package to
>>> > perform
>>> > these regressions on the grid.
>>> > # create raster object from the netcdf
>>> > rcmraster <- brick("regcm.cumul.hdd.10k.96_05.fixed.latlonvars.nc",
>>> > varname
>>> > = "hdd")
>>> > emitraster <-
>>> >
>>> > brick("flip.percap.vulcan.10k.dp.build.381.RES.EIAmy.96_05.this.latest.nc",varname="emitpercap")
>>> > # crop subset of above rasters, test method on subset which is 4 x 4 x
>>> > 120
>>> > lim <- extent(rcmraster,180,185,300,305)
>>> > rcmraster_crop <- crop(rcmraster,lim)
>>> > emitraster_crop <- crop(emitraster,lim)
>>> > # do some plotting to check
>>> > ?par(mfrow=c(1,2))
>>> > ?plot(rcmraster_crop[[1]])
>>> > ?plot(emitraster_crop[[1]])
>>> > # test regressions for cropped subset
>>> > s_crop <- stack(emitraster_crop,rcmraster_crop)
>>> > # use of plyr (provides a more elegant alternative to lapply)
>>> > # the data frame datCoef contains the slope and intercept for each
>>> > point in
>>> > the grid (denoted by X1 and X2)
>>> > datCoef = adply( as.array(s_crop) , 1:2 ,
>>> > ?? ? ? ? ? ? ?function(x ) {
>>> > ?? ? ? ? ? ? ? ? ? ? ? ? ? ?resp = x[1:120]
>>> > ?? ? ? ? ? ? ? ? ? ? ? ? ? ?expl = x[121:240]
>>> > ?? ? ? ? ? ? ? ? ? ? ? ? ? ?mdl = lm(resp ~ expl)
>>> > ?? ? ? ? ? ? ? ? ? ? ? ? ? ?res = c(mdl$coef[1] , mdl$coef[2])
>>> > ?? ? ? ? ? ? ? ? ? ? ? ? ? ?return(res)
>>> >
>>> > ?? ? ? ? ? ? ? ? ? ? ? ? ?}
>>> > ?? ? ? ? ? ? ? ? ? ? ? ? ?)
>>> > Output of datCoef()
>>> >> datCoef
>>> > ?? X1 X2 ?(Intercept) ? ? ? ? expl
>>> > 1 ? 1 ?1 0.0010523406 2.623927e-05
>>> > 2 ? 2 ?1 0.0019401572 5.049197e-05
>>> > 3 ? 3 ?1 0.0171326653 4.425026e-04
>>> > 4 ? 4 ?1 0.0012244689 3.045755e-05
>>> > 5 ? 1 ?2 0.0011454348 2.892668e-05
>>> > 6 ? 2 ?2 0.0013920425 3.460922e-05
>>> > 7 ? 3 ?2 0.0015973400 3.943349e-05
>>> > 8 ? 4 ?2 0.0016494511 4.045801e-05
>>> > 9 ? 1 ?3 0.0018757258 4.704107e-05
>>> > 10 ?2 ?3 0.0038066075 9.378512e-05
>>> > 11 ?3 ?3 0.0039669120 9.719391e-05
>>> > 12 ?4 ?3 0.0038055524 9.246021e-05
>>> > 13 ?1 ?4 0.0015700329 3.921758e-05
>>> > 14 ?2 ?4 0.0003727142 9.156119e-06
>>> > 15 ?3 ?4 0.0005315722 1.308365e-05
>>> > 16 ?4 ?4 0.0005872930 1.539454e-05
>>> > Now, what I want to do is for each of these X1,X2, get a "predicted"
>>> > map
>>> > based on a new X which is an array of dimensions 4 x 4 (same as the
>>> > rasters.
>>> > in the original dataset, it will be 356 x 507). This array has the
>>> > following
>>> > values:
>>> >> futurehdda
>>> > ?? ? ? ? [,1] ? ? [,2] ? ? [,3] ? ? [,4]
>>> > [1,] 5707.575 5696.325 5692.960 5683.110
>>> > [2,] 5680.303 5665.092 5660.790 5647.896
>>> > [3,] 5656.163 5641.045 5638.886 5625.231
>>> > [4,] 5634.604 5619.317 5620.226 5601.729
>>> > How can I extract the slope and intercept from datCoef and use the
>>> > above X
>>> > to get a predicted Y with the same dimensions (4 x 4)?
>>> > Thanks,
>>> > Advait
>>> > On Mon, Dec 6, 2010 at 4:57 PM, Robert J. Hijmans <r.hijmans at gmail.com>
>>> > wrote:
>>> >>
>>> >> Dear Advait,
>>> >>
>>> >> > What I dont understand is:
>>> >> > 1) How can each slope be the same (values of x1)
>>> >>
>>> >> Apparently the values in these cells are all the same (not that you
>>> >> only use the first 8 time steps, not all 120)
>>> >>
>>> >> Here is an example with random values in which the slopes are all
>>> >> different
>>> >>
>>> >> b <- brick(ncol=4, nrow=4, nl=120)
>>> >> b <- setValues(b, matrix(runif(prod(dim(b))), ncol=120))
>>> >> fun = function(x) { if(is.na(x[1])) { NA } else { lm(x[1:60] ~
>>> >> x[61:120])$coefficients[2] } }
>>> >> x <- calc(b, fun)
>>> >> plot(x)
>>> >> as.matrix(x)
>>> >>
>>> >>
>>> >> > 2) The raster layers are of dimensions 4 x 4 x 120
>>> >> > but?dim(getValues(rcmraster_crop))
>>> >> > [1] ?16 120. Why is that? This must have implications for the way
>>> >> > that
>>> >> > the
>>> >> > regressions for the brick are handled wouldnt it?
>>> >> No
>>> >>
>>> >> > Or is it specific to the
>>> >> > way "getValues" handles things?
>>> >>
>>> >> Yes. rows are cells (4*4=16), columns are layers.
>>> >>
>>> >> > Also, does anyone have any pointers of how to accomplish the NA
>>> >> > testing
>>> >> > and
>>> >> See an example above, assuming that if the first time step is NA, they
>>> >> all are. You could also do things like
>>> >> if (sum(is.na(x)) > 60)
>>> >> depends on your context.
>>> >>
>

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From Roger.Bivand at nhh.no  Thu Dec 23 20:03:31 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 23 Dec 2010 20:03:31 +0100 (CET)
Subject: [R-sig-Geo] Installing rgdal on OSX (was digest ...)
In-Reply-To: <90E5C832-54EB-4997-A248-CF8DB00BADC3@ecotoxicology.de>
References: <mailman.9.1293102005.4036.r-sig-geo@r-project.org>
	<33858649-82EB-4700-87AA-810D89491B42@ecotoxicology.de>
	<AANLkTim7Xohvemyam_RvH2+WruTYZaRdtDkPOgretjBA@mail.gmail.com>
	<90E5C832-54EB-4997-A248-CF8DB00BADC3@ecotoxicology.de>
Message-ID: <alpine.LRH.2.00.1012231825250.7345@reclus.nhh.no>

On Thu, 23 Dec 2010, Ralf Sch?fer wrote:

>> Many thanks for your clarifications, Ralf.
>> But if
>>> Actually the 4 options more or less boil down to two if you check what is done in detail:
>> .../...
>>
>> then  we are just discarding alternative 1 in my first post:
>> "> setRepositories(ind=1:2)
>>> install.packages('rgdal')
>
> Well, if the normal repository binary works, then there is no problem in 
> the first place.

Exactly!!! Why do you think that Brian Ripley and others went to 
considerable trouble to provide it? Currently version 0.6-31 is available 
from CRAN extras for leopard on R 2.12, and rgdal 0.6-27 for leopard on R 
2.11. On Kyngchaos, rgdal 0.6-29 is available for R 2.12, 0.6-28 for R 
2.11. Kyngchaos may provide a wider range of drivers.

Neither of these require the user to install source building support with 
Xcode and other software is if the version of rgdal is not the one 
required, and/or if extra drivers are required. In addition, using CRAN 
extras and update.packages() will update rgdal if and when a newer version 
is produced.

That said, and I sympathise with Barry's observations of apparently 
clueless OSX users - it happens, installing from source is not hard[1], 
and the Kyngchaos Frameworks are probably the most convenient way to 
proceed, as they the "stack" with GRASS or QGIS, ensuring that all the 
OSGeo software in use is the same.

> And I probably commented based on the discussion with Daniel on the 
> R-sig geo list yesterday and from experiences that often problems occur.

Only if people do not think, really! If Daniel had read and understood 
what was output to his console, he would have know immediately what to do. 
Whether he didn't read it, or didn't understand, is uncertain, but posting 
verbating output saying:

"The gdal-config script distributed with GDAL could not be found.
If you have not installed the GDAL libraries, you can
download the source from  http://www.gdal.org/
If you have installed the GDAL libraries, then make sure that
gdal-config is in your path. Try typing gdal-config at a
shell prompt and see if it runs. If not, use:
--configure-args='--with-gdal-config=/usr/local/bin/gdal-config'
with appropriate values for your installation."

does not suggest reading and understanding.

Before any installation from source, please do run:

gdal-config --version
gdalinfo --version

at a console prompt; if you do not know what a console prompt is, within R 
use:

system("gdal-config --version")
system("gdalinfo --version")

and make sure that the versions reported are the same. If either throws an 
error, such as command not found, then GDAL is not installed correctly, 
and installing rgdal will surely fail.

Note that in the R world, OSX is treated as being close to Unix in user 
skill requirements, certainly more demanding than Windows, which is the 
suggested OS for users who are neither able nor willing to compile 
anything. For lab installs, do use CRAN/CRAN extras for binary contributed 
packages.

Hope this clarifies,

Roger

[1] Hard - that is, how much effort is required of the user in installing 
and using software compared to other tasks the user performs in data 
collection, collation, literature review, handling measurement tools, etc. 
Using a computer for scientific research is not the same as using it as a 
music player or telephone, because the user has to make reasoned choices, 
and should understand the tool well. If not, how on earth will the 
researcher understand the results?


> But indeed - option 1 is certainly to use CRAN repositories after 
> installing GDAL framework before.
>
> So, in my courses I usually show them first how to install the kyngchaos binaries and if that fails on some machines how to install from source - and was successful so far.
>
>> Also, what about homebrew? is this not a good way to make this type of
>> things easier on Macs?
>
> Well, in the example it only installs the binaries from kyngchaos, so it is basically the same as option 2 just uses command line and requiring prior installation of a package manager (you need homebrew, Xcode, type some command in Mac terminal etc.)
> But this is probably splitting hairs now.
>
>> Finally, where you say
>>> BTW: "Linux Techies"  should have no major probs with Mac, given that the Mac system commands are more or less the same as for Linux systems
>> The problem is that most mac users I've had as students are not
>> Techies on anything. Otherwise, Macs are wonderful machines.
>
> Comment was more targeted on "Macs into the world and expecting techies with only Linux
>>
>>>> (and a smidge of Windows) experience to fix them up."
> and just wanted to state that for a Linux techie the Mac command line is not too difficult.
>
> But you actually do not need Shell command line to install packages from source anyway - all tools can be installed as binaries and the package can be built from within R.
>
> Anyway, have a good xmas
> Ralf
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From alobolistas at gmail.com  Fri Dec 24 10:21:13 2010
From: alobolistas at gmail.com (Agustin Lobo)
Date: Fri, 24 Dec 2010 10:21:13 +0100
Subject: [R-sig-Geo] MACOSX: rgdal cannot find GDAL
Message-ID: <AANLkTinnmh3tmCcv92+kcTHE6fmUEP6SqdZnc99af+da@mail.gmail.com>

After having installed GDAL Complete from
http://www.kyngchaos.com/files/software/frameworks/GSL_Framework-1.14-1.dmg,

I try gdalinfo but:

imac-de-agustin-lobo:~ agustinlobo$ gdalinfo --version
-bash: gdalinfo: command not found

Also Spotlight cannot find but the uncompressed folder GDAL Complete,
or any of the installed
programs (i.e. gdalinfo or gdal-config)

imac-de-agustin-lobo:~ agustinlobo$ gdal-config-bash: gdal-config:
command not found

Obviously, rgdal cannot find GDAL

> setRepositories(ind=1:2)
> install.packages("rgdal")
--- Please select a CRAN mirror for use in this session ---
probando la URL
'http://www.stats.ox.ac.uk/pub/RWin/bin/macosx/leopard/contrib/2.12/rgdal_0.6-31.tgz'
Content type 'application/x-gzip' length 10203689 bytes (9.7 Mb)
URL abierta
==================================================
downloaded 9.7 Mb


The downloaded packages are in
	/var/folders/iR/iRxOvaG9F10viNoa7WceNU+++TI/-Tmp-//RtmpLu8kR8/downloaded_packages
> require(rgdal)
Loading required package: rgdal
Loading required package: sp
Error in dyn.load(file, DLLpath = DLLpath, ...) :
  unable to load shared object
'/Library/Frameworks/R.framework/Versions/2.12/Resources/library/rgdal/libs/i386/rgdal.so':
  dlopen(/Library/Frameworks/R.framework/Versions/2.12/Resources/library/rgdal/libs/i386/rgdal.so,
6): Library not loaded: libR.dylib
  Referenced from:
/Library/Frameworks/R.framework/Versions/2.12/Resources/library/rgdal/libs/i386/rgdal.so
  Reason: image not found


From alobolistas at gmail.com  Fri Dec 24 10:21:58 2010
From: alobolistas at gmail.com (Agustin Lobo)
Date: Fri, 24 Dec 2010 10:21:58 +0100
Subject: [R-sig-Geo] rgdal from kyngchaos: Error in get(Info[i, 1],
	envir = env) :
Message-ID: <AANLkTikUaN0o3vOz3njY=+Tsz9pV0kjiPEjaPA+a07hC@mail.gmail.com>

After having installed GDAL from
http://www.kyngchaos.com/files/software/frameworks/GDAL_Complete-1.7.dmg
and downloading
http://www.kyngchaos.com/files/software/frameworks/rgdal-0.6.29-1.zip
I install rgdal and get:

> install.packages("/Users/agustinlobo/Downloads/rgdal/rgdal_0.6-29.tgz")
inferring 'repos = NULL' from the file name
> require(rgdal)
Loading required package: rgdal
Error in get(Info[i, 1], envir = env) :
  no se puede asignar un bloque de memoria de tama?o 2.2 Gb

(== cannot assign a memory block of size 2.2 Gb)

Is this a particular problem in this computer? Any fix?

(BTW, cannot find how to get these messages in English)

Agus


From senator at ecotoxicology.de  Fri Dec 24 12:22:19 2010
From: senator at ecotoxicology.de (=?iso-8859-1?Q?Ralf_Sch=E4fer?=)
Date: Fri, 24 Dec 2010 12:22:19 +0100
Subject: [R-sig-Geo] MACOSX: rgdal cannot find GDAL
In-Reply-To: <mailman.9.1293188403.12303.r-sig-geo@r-project.org>
References: <mailman.9.1293188403.12303.r-sig-geo@r-project.org>
Message-ID: <3F1030F1-C0F6-4730-A31F-F9188DF990E6@ecotoxicology.de>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101224/106b8439/attachment.pl>

From adiez at uv.es  Fri Dec 24 14:03:22 2010
From: adiez at uv.es (Agustin Diez Castillo)
Date: Fri, 24 Dec 2010 14:03:22 +0100
Subject: [R-sig-Geo] rgdal from kyngchaos: Error in get(Info[i, 1],
	envir = env) :
In-Reply-To: <AANLkTikUaN0o3vOz3njY=+Tsz9pV0kjiPEjaPA+a07hC@mail.gmail.com>
References: <AANLkTikUaN0o3vOz3njY=+Tsz9pV0kjiPEjaPA+a07hC@mail.gmail.com>
Message-ID: <E56467A7-7D7C-4CA6-B9AC-DF0A36A7AB7C@uv.es>


On Dec 24, 2010, at 10:21 AM, Agustin Lobo wrote:

> After having installed GDAL from
> http://www.kyngchaos.com/files/software/frameworks/GDAL_Complete-1.7.dmg
> and downloading
> http://www.kyngchaos.com/files/software/frameworks/rgdal-0.6.29-1.zip
> I install rgdal and get:
> 
>> install.packages("/Users/agustinlobo/Downloads/rgdal/rgdal_0.6-29.tgz")
> inferring 'repos = NULL' from the file name
>> require(rgdal)
> Loading required package: rgdal
> Error in get(Info[i, 1], envir = env) :
>  no se puede asignar un bloque de memoria de tama?o 2.2 Gb
> 
> (== cannot assign a memory block of size 2.2 Gb)
> 
> Is this a particular problem in this computer? Any fix?
> 
> (BTW, cannot find how to get these messages in English)
defaults write org.R-project.R force.LANG en_US.UTF-8

> 
> Agus
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 


From advaitgodbole at gmail.com  Fri Dec 24 15:35:04 2010
From: advaitgodbole at gmail.com (Advait Godbole)
Date: Fri, 24 Dec 2010 09:35:04 -0500
Subject: [R-sig-Geo] gridded time series analysis
In-Reply-To: <AANLkTikb-iu=V-vP7Lfvt=6WUzp3uVxv10OFX4rC81_r@mail.gmail.com>
References: <AANLkTimTdxzoDCfJQOB8bgQRhjLy3YzSbtGtMdijk9sQ@mail.gmail.com>
	<771411.8321.qm@web29709.mail.ird.yahoo.com>
	<AANLkTin2DYocWNOAR-LfGoBP4+gCtA7eVDHmoaQ6wriR@mail.gmail.com>
	<AANLkTimFw1zMH75s+TG+SFkBHfXzpURm2WXskAa8Kp=m@mail.gmail.com>
	<AANLkTim9dBnVkZ0tjvoa1YRpPRr156jJ9zcezMDrtzhX@mail.gmail.com>
	<AANLkTi=vW6NXYXKGNa0gcTfZ8ezEjvegdxU3Dt5SPA4F@mail.gmail.com>
	<AANLkTikqNmC62Pv-n9Dxd1w7fTHJPx8cR72U6YEtWMTV@mail.gmail.com>
	<AANLkTikQsL9opzu1i0mWxtJA6YmcgBbGdbihXFOwPRho@mail.gmail.com>
	<AANLkTinY5+3JbpZfWnriDZNOdmcfic0628Qi0=NDZghK@mail.gmail.com>
	<AANLkTikd-PJKWZdWUL2+S9VYAq1QJ4LPwG2==erEs2+Q@mail.gmail.com>
	<AANLkTi=eZL0Rq5EyoRA29fdnN2VL-Xt6hcGN4DnZgCKk@mail.gmail.com>
	<AANLkTikVto4GD=vO=5YKwKXL7y+Ze4ADn2KXpsw1AFVA@mail.gmail.com>
	<AANLkTinUvhmDLP2YSWuqb5=G0YKX=sWp6yMOj9KPAgdA@mail.gmail.com>
	<AANLkTi=P5HNFjEsaapUBF7vSAFAsekU_4bYJqXnW=gbu@mail.gmail.com>
	<AANLkTikwWainpBBeSr8xnNNq8uoFXdU2n_34y2-u6K5J@mail.gmail.com>
	<AANLkTin5-hV=b8yxQnvviF_4w-uPfsSJ9X82pmbi=WQo@mail.gmail.com>
	<AANLkTikmPMvBRuu6RvjXsd8LdJc38FP+tAiF9iAc31Ks@mail.gmail.com>
	<AANLkTikSowU_SFiCmZyE3TKEa_UesH_SDQdPP63i+ERY@mail.gmail.com>
	<AANLkTi=p+LbmQ96GSJFuYyw-HLcCxJgYqaK4n2pBZcbG@mail.gmail.com>
	<AANLkTinvp-k47MHyV2s+hje_P0VXHvTmOKPFf8q5btAO@mail.gmail.com>
	<AANLkTi=S8tY50xzS2PFS7LvUEMT4cb4TFME-kT7DkmS0@mail.gmail.com>
	<AANLkTims2FyRBiLdmtZzR8wwvrBSyMuepVe0_Li-B6nU@mail.gmail.com>
	<AANLkTinzLPLDhoLwpcRkJ4twJ+FFd=ukOYpHh220S2mE@mail.gmail.com>
	<AANLkTikmm6QvAC69cPG7i4bT6wmWVBfwpO-4mHZ7JEvL@mail.gmail.com>
	<AANLkTikAMe3C=hQon56eh3nQd_G6gHJ=iQPh0JyJhqJ7@mail.gmail.com>
	<AANLkTikrWWOzicMeLk4sEP_y9Dfo7fZk1gUmC5-6HRd5@mail.gmail.com>
	<AANLkTikXrGQSTKsey9u+rXFsnVtmszown6PV0i0ca7mQ@mail.gmail.com>
	<AANLkTimVUyCGiM_uYGXWZo8JBf=nOevTiDvkZ36RCvbB@mail.gmail.com>
	<AANLkTikb-iu=V-vP7Lfvt=6WUzp3uVxv10OFX4rC81_r@mail.gmail.com>
Message-ID: <AANLkTikzhZ3fyxSaJoEn5TZJVx_spTrTnsp=2_rwwuQ8@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101224/095de2b3/attachment.pl>

From pierre.roudier at gmail.com  Fri Dec 24 16:03:30 2010
From: pierre.roudier at gmail.com (Pierre Roudier)
Date: Fri, 24 Dec 2010 16:03:30 +0100
Subject: [R-sig-Geo] Continuous colorbar legend for a
 SpatialPointsDataFrame object
In-Reply-To: <1292943622540-5855549.post@n2.nabble.com>
References: <e4178da61003261213n5953c494j1bf08dc0490fadc9@mail.gmail.com>
	<1292943622540-5855549.post@n2.nabble.com>
Message-ID: <AANLkTinc5+dZQXeGeTacEdBgeC6EfqhNs+929YsVYOpK@mail.gmail.com>

Hey Piero,

My solution was to use the ggplot2 package. See the example below.

Cheers,

Pierre

# I don't have any R install handy here - I hope this example will run...
library(sp)
library(ggplot2)

data(meuse)
coordinates(meuse) <- ~x+y
# some geospatial operations on meuse here

meuse.df <- as.data.frame(meuse)
my.plot <- ggplot(data=meuse.df, aes(x=x, y=y)) +
geom_point(aes(colour=log(zinc))) + coord_equal()
print(my.plot)

# you can play with the color ramp - the RColorBrewer package is handy for that
library(RColorBrewer)
my.plot <- my.plot + scale_colour_gradientn('name of the legend',
brewer.pal(n=5, 'OrRd'))
print(my.plot)

2010/12/21 piero campa <piero.campa at gmail.com>:
>
> I would submit the same question.
> Piero
>
> (Pierre, did you manage somehow then?)
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Continuous-colorbar-legend-for-a-SpatialPointsDataFrame-object-tp4805804p5855549.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



-- 
Scientist
Landcare Research, New Zealand


From gianni.lavaredo at gmail.com  Fri Dec 24 16:23:58 2010
From: gianni.lavaredo at gmail.com (gianni lavaredo)
Date: Fri, 24 Dec 2010 16:23:58 +0100
Subject: [R-sig-Geo] RASTER library: one idea to merge several file in a loop
Message-ID: <AANLkTi=gMoMtnRrJ_Nj=KF8GDjbasiFMpME+K42+sxde@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101224/bade6e01/attachment.pl>

From alexandru.dumitrescu at gmail.com  Sat Dec 25 14:55:47 2010
From: alexandru.dumitrescu at gmail.com (Alexandru Dumitrescu)
Date: Sat, 25 Dec 2010 15:55:47 +0200
Subject: [R-sig-Geo] when zero-inflated
Message-ID: <AANLkTikwqAXPUcLE5+xNYUAOm4oOdX4gB+CO=-Hv5Gzz@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101225/be34f751/attachment.pl>

From gianni.lavaredo at gmail.com  Sun Dec 26 18:02:45 2010
From: gianni.lavaredo at gmail.com (gianni lavaredo)
Date: Sun, 26 Dec 2010 18:02:45 +0100
Subject: [R-sig-Geo] help to convert a data.frame in a Class ppp
Message-ID: <AANLkTikbF5h1aQjgA1aiNFc4ye2W+FN1OUZ+FHNYjsui@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101226/ebfee420/attachment.pl>

From roman.lustrik at gmail.com  Sun Dec 26 18:08:16 2010
From: roman.lustrik at gmail.com (=?UTF-8?Q?Roman_Lu=C5=A1trik?=)
Date: Sun, 26 Dec 2010 18:08:16 +0100
Subject: [R-sig-Geo] help to convert a data.frame in a Class ppp
In-Reply-To: <AANLkTikbF5h1aQjgA1aiNFc4ye2W+FN1OUZ+FHNYjsui@mail.gmail.com>
References: <AANLkTikbF5h1aQjgA1aiNFc4ye2W+FN1OUZ+FHNYjsui@mail.gmail.com>
Message-ID: <AANLkTikdjdm+CGv8fpTYVr_GaXB5s33-J6PVqdShQt21@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101226/9cf5d4e2/attachment.pl>

From b.rowlingson at lancaster.ac.uk  Mon Dec 27 13:49:41 2010
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Mon, 27 Dec 2010 12:49:41 +0000
Subject: [R-sig-Geo] help to convert a data.frame in a Class ppp
In-Reply-To: <AANLkTikbF5h1aQjgA1aiNFc4ye2W+FN1OUZ+FHNYjsui@mail.gmail.com>
References: <AANLkTikbF5h1aQjgA1aiNFc4ye2W+FN1OUZ+FHNYjsui@mail.gmail.com>
Message-ID: <AANLkTi=+S1PS56H922HwGrvuQ9ScppvT6dxm65EMCVuW@mail.gmail.com>

On Sun, Dec 26, 2010 at 5:02 PM, gianni lavaredo
<gianni.lavaredo at gmail.com> wrote:
> Dear Researchers,
>
> I have a data.frame with tow columns (x and y) and I wish to convert in a
> ppp object
>
> point.df <-
> data.frame(x=c(749389.0,750000.0,750000.0,749389.0,750000.0,752500.0,752500.0,750000.0,752500.0,755000.0,755000.0,752500.0,755000.0,757500.0,757500.0,755000.0,757500.0,760000.0,760000.0),
> y=c(7275568,7275568,7277064,7277064,7275543,7275543,7277100,7277100,7275528,7275528,7277090,7277090,7275505,7275505,7277088,7277088,7275474,7275474,7277088))
>
> point.df
> plot(point.df$x,point.df$y)
>
>
> normally I use as.ppp but I don't undesrtand my error.
>
> thanks so much and sorry for destrub you in this period

 Your second error is not telling us what your first error was! -We
dont know how you were using as.ppp and if you were using it right.
You need to create a window (here I just take the bounds of your
points - the  true window is probably something different) and then
call as.ppp thus:

o=owin(range(point.df$x),range(point.df$y))
spat = as.ppp(point.df,o)
spat
> spat
 planar point pattern: 19 points
window: rectangle = [749390, 760000] x [7275500, 7277100] units

Barry


From gianni.lavaredo at gmail.com  Mon Dec 27 16:07:22 2010
From: gianni.lavaredo at gmail.com (gianni lavaredo)
Date: Mon, 27 Dec 2010 16:07:22 +0100
Subject: [R-sig-Geo] problem with disc ( ) in spatstat
Message-ID: <AANLkTinMTqoKOZ-d3Qp5iF0e8N_jptoP3b7i_v3GWFG_@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101227/27075909/attachment.pl>

From villers.alexandre at gmail.com  Mon Dec 27 16:20:45 2010
From: villers.alexandre at gmail.com (Alexandre Villers)
Date: Mon, 27 Dec 2010 16:20:45 +0100
Subject: [R-sig-Geo] problem with disc ( ) in spatstat
In-Reply-To: <AANLkTinMTqoKOZ-d3Qp5iF0e8N_jptoP3b7i_v3GWFG_@mail.gmail.com>
References: <AANLkTinMTqoKOZ-d3Qp5iF0e8N_jptoP3b7i_v3GWFG_@mail.gmail.com>
Message-ID: <4D18AECD.6090509@gmail.com>

Hey Gianni,

Be more specific: what is your exact problem, what does R return to you, 
on what type of system (a sessionInfo could help).
On my machine, it does work...

R version 2.12.0 (2010-10-15)
Platform: i486-pc-linux-gnu (32-bit)

locale:
  [1] LC_CTYPE=fr_FR.utf8          LC_NUMERIC=C
  [3] LC_TIME=fr_FR.utf8           LC_COLLATE=fr_FR.utf8
  [5] LC_MONETARY=fr_FR.utf8       LC_MESSAGES=fr_FR.utf8
  [7] LC_PAPER=fr_FR.utf8          LC_NAME=fr_FR.utf8
  [9] LC_ADDRESS=fr_FR.utf8        LC_TELEPHONE=fr_FR.utf8
[11] LC_MEASUREMENT=fr_FR.utf8    LC_IDENTIFICATION=fr_FR.utf8

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] spatstat_1.21-2 deldir_0.0-13   mgcv_1.7-2      rkward_0.5.4

loaded via a namespace (and not attached):
[1] grid_2.12.0        lattice_0.19-16    Matrix_0.999375-46 nlme_3.1-97
[5] tools_2.12.0


Le 27/12/2010 16:07, gianni lavaredo a ?crit :
> disc(radius=10, centre=c(774000.8,7249592.3), npoly=126)


-- 
Alexandre Villers, PhD.
Postdoc researcher
Spatial Ecology & Population Dynamics
Section of Ecology, Department of Biology
University of Turku
FIN-20014 Turku
Finland

@mail: alexandre.villers at utu.fi
phone: 00358 (0)2 333 5039

Skype You can skype me (but think of using Ekiga instead !) 
<skype:aquila06?call>


*Use open source and free softwares*
<http://cran.r-project.org/> <http://grass.itc.it/> 
<http://www.qgis.org/> <http://fr.openoffice.org/> 
<http://www.mozilla-europe.org/fr/> <http://www.mozilla-europe.org/fr/>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101227/36777b0c/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Rlogo.jpg
Type: image/jpeg
Size: 1753 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101227/36777b0c/attachment.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: GRASSlogo.png
Type: image/png
Size: 3277 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101227/36777b0c/attachment.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: QGIS.png
Type: image/png
Size: 4144 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101227/36777b0c/attachment-0001.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: OOlogo.gif
Type: image/gif
Size: 4246 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101227/36777b0c/attachment.gif>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: TBlogo.jpg
Type: image/jpeg
Size: 1385 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101227/36777b0c/attachment-0001.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: FFlogo.jpg
Type: image/jpeg
Size: 1686 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101227/36777b0c/attachment-0002.jpg>

From roman.lustrik at gmail.com  Mon Dec 27 16:25:47 2010
From: roman.lustrik at gmail.com (=?UTF-8?Q?Roman_Lu=C5=A1trik?=)
Date: Mon, 27 Dec 2010 16:25:47 +0100
Subject: [R-sig-Geo] problem with disc ( ) in spatstat
In-Reply-To: <AANLkTi=X_CZQvEerwkM6WyMX6zeNJW6Gv3EC3VPXK1S-@mail.gmail.com>
References: <AANLkTinMTqoKOZ-d3Qp5iF0e8N_jptoP3b7i_v3GWFG_@mail.gmail.com>
	<AANLkTikpjWGqz9xJZ5zNpuyLVofCSoZ2S7n-C6EBUKFR@mail.gmail.com>
	<AANLkTi=X_CZQvEerwkM6WyMX6zeNJW6Gv3EC3VPXK1S-@mail.gmail.com>
Message-ID: <AANLkTi=Ckb6+uNw9d6=gnUCZW+1HV5Jy3sa7-LSrLZUG@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101227/c0468128/attachment.pl>

From b.rowlingson at lancaster.ac.uk  Mon Dec 27 16:40:25 2010
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Mon, 27 Dec 2010 15:40:25 +0000
Subject: [R-sig-Geo] problem with disc ( ) in spatstat
In-Reply-To: <AANLkTinMTqoKOZ-d3Qp5iF0e8N_jptoP3b7i_v3GWFG_@mail.gmail.com>
References: <AANLkTinMTqoKOZ-d3Qp5iF0e8N_jptoP3b7i_v3GWFG_@mail.gmail.com>
Message-ID: <AANLkTiky3S-UyiODj5fm7h4OHFWStEz4eF8E+J77-EY0@mail.gmail.com>

On Mon, Dec 27, 2010 at 3:07 PM, gianni lavaredo
<gianni.lavaredo at gmail.com> wrote:
> Dear Researchers,
>
> is There some problem with DISC() in spatstat?
>
>
> disc = ?disc(radius=10, centre=c(774000.8,7249592.3), npoly=126)
>
> I am try also to run the example but I have always a problem

 Works for me - again you've not posted any error messages! Note its a
bad idea to call something by the same name as a function. Anyway,
here's how it goes for me - this creates and plots a nice disc called
'd':

 > library(spatstat)
Loading required package: mgcv
This is mgcv 1.6-1. For overview type `help("mgcv-package")'.
Loading required package: deldir
deldir 0.0-12

     Please note: The process for determining duplicated points
     has changed from that used in version 0.0-9 (and previously).

spatstat 1.20-3
Type ?help(spatstat)? for an overview of spatstat
     ?latest.news()? for news on latest version
     ?licence.polygons()? for licence information on polygon calculations
 > d =  disc(radius=10, centre=c(774000.8,7249592.3), npoly=126)
 > d
window: polygonal boundary
enclosing rectangle: [773990.8, 774010.8] x [7249582, 7249602] units
 > plot(d)

 - a disc appears!


From juanitachoo at gmail.com  Mon Dec 27 18:19:42 2010
From: juanitachoo at gmail.com (juanita choo)
Date: Mon, 27 Dec 2010 12:19:42 -0500
Subject: [R-sig-Geo] advice on spatial regression for interpolated data
Message-ID: <AANLkTimtG61s3=BeV1Jx-Gs2Fkv5zWxKCL4duzsyhbZp@mail.gmail.com>

Hi Everyone,

I am trying figure out the best method/R package for analyzing my
data. I am testing the hypothesis that seedling density data is
correlated with both adult tree densities and seed predation
intensities. I have mapped out the locations of all adult and
seedlings in a 150x150m plot, and have estimated predation intensities
at  72 locations in the plot. All variables are spatially
autocorrelated. I was planning running a spatial regression on the
interpolated values seedling densities (dependent variable) against
adult densities, and predation intensities. But I am not sure if this
is appropriate or if there is a better method. I was looking at the
spdep package was wondering whether the lagSARlm would work in this
setting. Thanks for your advice on this.

Juanita


From tgriffin at uaex.edu  Mon Dec 27 18:38:45 2010
From: tgriffin at uaex.edu (Terry Griffin)
Date: Mon, 27 Dec 2010 11:38:45 -0600 (CST)
Subject: [R-sig-Geo] advice on spatial regression for interpolated data
In-Reply-To: <24288334.101293471236656.JavaMail.SYSTEM@TGriffinLT>
Message-ID: <17644603.121293471521437.JavaMail.SYSTEM@TGriffinLT>





----- Original Message -----
From: "juanita choo" <juanitachoo at gmail.com>
To: r-sig-geo at r-project.org
Sent: Monday, December 27, 2010 11:19:42 AM GMT -06:00 US/Canada Central
Subject: [R-sig-Geo] advice on spatial regression for interpolated data

Hi Everyone,

I am trying figure out the best method/R package for analyzing my
data. I am testing the hypothesis that seedling density data is
correlated with both adult tree densities and seed predation
intensities. I have mapped out the locations of all adult and
seedlings in a 150x150m plot, and have estimated predation intensities
at  72 locations in the plot. All variables are spatially
autocorrelated. I was planning running a spatial regression on the
interpolated values seedling densities (dependent variable) against
adult densities, and predation intensities. But I am not sure if this
is appropriate or if there is a better method. I was looking at the
spdep package was wondering whether the lagSARlm would work in this
setting. Thanks for your advice on this.

Juanita

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


Hi Juanita,

A useful discussion of using spatially interpolated variables especially as independent variables is in:

Anselin, L. 2001. Spatial Effects in Econometric Practice in Environmental and Resource
Economics, American Journal of Agricultural Economics 83, 705-710.

Sometimes interpolation methods seem attractive to remedy the dilemma of spatially disparate spatial data layers; however, Anselin 2001 describes the systematic error that is introduced into the data, causing problems in deriving inference.

Terry Griffin, Ph.D.
Assistant Professor - Economics
University of Arkansas - Division of Agriculture
501.671.2182
tgriffin at uaex.edu


From r.hijmans at gmail.com  Mon Dec 27 19:06:53 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Mon, 27 Dec 2010 10:06:53 -0800
Subject: [R-sig-Geo] RASTER library: one idea to merge several file in a
	loop
In-Reply-To: <AANLkTi=gMoMtnRrJ_Nj=KF8GDjbasiFMpME+K42+sxde@mail.gmail.com>
References: <AANLkTi=gMoMtnRrJ_Nj=KF8GDjbasiFMpME+K42+sxde@mail.gmail.com>
Message-ID: <AANLkTi=ShaGpv+APEH8MmbgzAO5FW4_QcMPWZ9gdS2Nv@mail.gmail.com>

Gianni,

# make a list of file names, perhaps like this:
f <-list.files(pattern = ".asc")

# turn these into a list of RasterLayer objects
r <- lapply(f, raster)

# as you have the arguments as a list call 'merge' with 'do.call'
x <- do.call(merge, r)

Best, Robert

On Fri, Dec 24, 2010 at 7:23 AM, gianni lavaredo
<gianni.lavaredo at gmail.com> wrote:
> Dear Reserchers,
>
> MERRY CHRISTAMS
>
> I have several ASCII file and I wish to merge in a file with RASTER library
> "merge" function
>
> merge(x, y, ...)
>
>
> es: file1.asc, file2.asc, file3.asc, file4.asc, file5.asc
>
> my.list <-list("file1.asc", "file2.asc", "file3.asc", "file4.asc",
> "file5.asc")
>
>
> Dem.list <- list()
>
> for(m in 1:length(my.list)){
> dem <- raster(my.list[[m]])
> dem <- setMinMax(dem)
> Dem.list[[m]] <- dem
> }
>
> Now I have a list of DEM to merge with the function
>
> rm <- merge(Dem.list[[1]],Dem.list[[1]],Dem.list[[3]],Dem.list[[4]],Dem.list[[5]])
>
> I wish to use a loop with "merge" because I have more of 50 files and
> many areas to do this.
> Gianni
>
> ? ? ? ?[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From alobolistas at gmail.com  Mon Dec 27 20:32:22 2010
From: alobolistas at gmail.com (Agustin Lobo)
Date: Mon, 27 Dec 2010 20:32:22 +0100
Subject: [R-sig-Geo] MACOSX: rgdal cannot find GDAL
In-Reply-To: <3F1030F1-C0F6-4730-A31F-F9188DF990E6@ecotoxicology.de>
References: <mailman.9.1293188403.12303.r-sig-geo@r-project.org>
	<3F1030F1-C0F6-4730-A31F-F9188DF990E6@ecotoxicology.de>
Message-ID: <AANLkTi=1=YLD259OhU_ZaEdcnLcJYM_SNxbrbje-YkKN@mail.gmail.com>

Ralf,

2010/12/24 Ralf Sch?fer <senator at ecotoxicology.de>:
> Hello,
> your download link referred to ?another framework. Check whether you have
> really installed this one:
> GDAL 1.7 Complete
Sorry, my mistake, but  just at writing the link, I actually downloaded
the correct one:
http://www.kyngchaos.com/files/software/frameworks/GDAL_Complete-1.7.dmg

> Can you allocate the folder:
> /Library/Frameworks/GDAL.framework ????
Yes:
imac-de-agustin-lobo:Frameworks agustinlobo$ pwd
/Library/Frameworks
imac-de-agustin-lobo:Frameworks agustinlobo$ ls -l
total 0
drwxrwxrwx  5 root  wheel  170 10 sep  2008 Adobe AIR.framework
drwxrwxr-x  8 root  admin  272 21 dic 17:44 FreeType.framework
drwxrwxr-x  8 root  admin  272 24 dic 09:13 GDAL.framework
drwxrwxr-x  8 root  admin  272 24 dic 09:13 GEOS.framework
drwxrwxr-x  8 root  admin  272 21 dic 17:58 GSL.framework
drwxrwxr-x  8 root  admin  272 12 dic  2009 HPDeviceModel.framework
drwxrwxr-x  6 root  admin  204 12 dic  2009 HPPml.framework
drwxrwxr-x  7 root  admin  238 12 dic  2009 HPServicesInterface.framework
drwxrwxr-x  7 root  admin  238 12 dic  2009 HPSmartPrint.framework
drwxr-xr-x  5 1422  wheel  170 12 dic  2009 HPSmartX.framework
drwxr-xr-x  6 root  admin  204 27 ene  2010 MacFUSE.framework
drwxrwxr-x  8 root  admin  272 24 dic 09:13 PROJ.framework
drwxrwxr-x  8 root  admin  272 24 dic 08:59 R.framework
drwxrwxr-x  8 root  admin  272 24 dic 09:13 SQLite3.framework
drwxrwxr-x  8 root  admin  272 24 dic 09:13 UnixImageIO.framework
drwxrwxr-x  8 root  admin  272 21 dic 17:56 cairo.framework

This problem persists:
imac-de-agustin-lobo:GDAL.framework agustinlobo$ gdalinfo --version
-bash: gdalinfo: command not found

But actually, the R installation of rgdal works now. Could it be that
I needed to reboot after
installing GDAL? I'd like to clarify as I'm trying to write up directions:

> install.packages("/Users/agustinlobo/Downloads/rgdal/rgdal_0.6-29.tgz")
inferring 'repos = NULL' from the file name
> require(rgdal)
Loading required package: rgdal
Loading required package: sp
Geospatial Data Abstraction Library extensions to R successfully loaded
Loaded GDAL runtime: GDAL 1.7.3, released 2010/11/10
Path to GDAL shared files:
/Library/Frameworks/GDAL.framework/Versions/1.7/Resources/gdal
Loaded PROJ.4 runtime: Rel. 4.7.1, 23 September 2009
Path to PROJ.4 shared files: (autodetected)

>
> But you obviously fixed that already as I can read from the second post?!

No, those are different problems. The one I report here is the installation with
the rgdal provided in kyngchaos
http://www.kyngchaos.com/files/software/frameworks/rgdal-0.6.29-1.zip

The other one is the problem installing rgdal from CRAN repositories 1 and 2

I still do not know which one is to be preferred...

Agus



> Regards
> Ralf
>
>
>
> ------------------------------
>
> Message: 11
> Date: Fri, 24 Dec 2010 10:21:13 +0100
> From: Agustin Lobo <alobolistas at gmail.com>
> To: r-sig-geo <r-sig-geo at stat.math.ethz.ch>
> Subject: [R-sig-Geo] MACOSX: rgdal cannot find GDAL
> Message-ID:
> <AANLkTinnmh3tmCcv92+kcTHE6fmUEP6SqdZnc99af+da at mail.gmail.com>
> Content-Type: text/plain; charset=ISO-8859-1
>
> After having installed GDAL Complete from
> http://www.kyngchaos.com/files/software/frameworks/GSL_Framework-1.14-1.dmg,
>
> I try gdalinfo but:
>
> imac-de-agustin-lobo:~ agustinlobo$ gdalinfo --version
> -bash: gdalinfo: command not found
>
> Also Spotlight cannot find but the uncompressed folder GDAL Complete,
> or any of the installed
> programs (i.e. gdalinfo or gdal-config)
>
> imac-de-agustin-lobo:~ agustinlobo$ gdal-config-bash: gdal-config:
> command not found
>
> Obviously, rgdal cannot find GDAL
>
> setRepositories(ind=1:2)
>
> install.packages("rgdal")
>
> --- Please select a CRAN mirror for use in this session ---
> probando la URL
> 'http://www.stats.ox.ac.uk/pub/RWin/bin/macosx/leopard/contrib/2.12/rgdal_0.6-31.tgz'
> Content type 'application/x-gzip' length 10203689 bytes (9.7 Mb)
> URL abierta
> ==================================================
> downloaded 9.7 Mb
>
>
> The downloaded packages are in
> /var/folders/iR/iRxOvaG9F10viNoa7WceNU+++TI/-Tmp-//RtmpLu8kR8/downloaded_packages
>
> require(rgdal)
>
> Loading required package: rgdal
> Loading required package: sp
> Error in dyn.load(file, DLLpath = DLLpath, ...) :
> ?unable to load shared object
> '/Library/Frameworks/R.framework/Versions/2.12/Resources/library/rgdal/libs/i386/rgdal.so':
> ?dlopen(/Library/Frameworks/R.framework/Versions/2.12/Resources/library/rgdal/libs/i386/rgdal.so,
> 6): Library not loaded: libR.dylib
> ?Referenced from:
> /Library/Frameworks/R.framework/Versions/2.12/Resources/library/rgdal/libs/i386/rgdal.so
> ?Reason: image not found
>
>
>


From alobolistas at gmail.com  Mon Dec 27 21:27:01 2010
From: alobolistas at gmail.com (Agustin Lobo)
Date: Mon, 27 Dec 2010 21:27:01 +0100
Subject: [R-sig-Geo] rgdal from kyngchaos: Error in get(Info[i, 1],
	envir = env) :
In-Reply-To: <AANLkTikUaN0o3vOz3njY=+Tsz9pV0kjiPEjaPA+a07hC@mail.gmail.com>
References: <AANLkTikUaN0o3vOz3njY=+Tsz9pV0kjiPEjaPA+a07hC@mail.gmail.com>
Message-ID: <AANLkTimtx2aJqEAEaXMxLEzFzHpMLyp83+pkeG6hDG__@mail.gmail.com>

Sorry, I was mixing installations. The problem I report here is the
one with the
rgdal from CRAN repositories. This is the correct story:

After having installed GDAL from
http://www.kyngchaos.com/files/software/frameworks/GDAL_Complete-1.7.dmg

> remove.packages("rgdal")
Removing package(s) from ?/Library/Frameworks/R.framework/Resources/library?
(as ?lib? is unspecified)
Error en .find.package(pkgs, lib) : there is no package called 'rgdal'
> setRepositories(ind=1:2)
> install.packages("rgdal")
probando la URL
'http://www.stats.ox.ac.uk/pub/RWin/bin/macosx/leopard/contrib/2.12/rgdal_0.6-31.tgz'
Content type 'application/x-gzip' length 10203689 bytes (9.7 Mb)
URL abierta
==================================================
downloaded 9.7 Mb


The downloaded packages are in
	/var/folders/iR/iRxOvaG9F10viNoa7WceNU+++TI/-Tmp-//Rtmpx5JXhi/downloaded_packages
> require(rgdal)
Loading required package: rgdal
Error in dyn.load(file, DLLpath = DLLpath, ...) :
  unable to load shared object
'/Library/Frameworks/R.framework/Versions/2.12/Resources/library/rgdal/libs/i386/rgdal.so':
  dlopen(/Library/Frameworks/R.framework/Versions/2.12/Resources/library/rgdal/libs/i386/rgdal.so,
6): Library not loaded: libR.dylib
  Referenced from:
/Library/Frameworks/R.framework/Versions/2.12/Resources/library/rgdal/libs/i386/rgdal.so
  Reason: image not found

I do have rgdal.so in that directory:
imac-de-agustin-lobo:i386 agustinlobo$ pwd
/Library/Frameworks/R.framework/Versions/2.12/Resources/library/rgdal/libs/i386
imac-de-agustin-lobo:i386 agustinlobo$ ls -l
total 15088
-rwxr-xr-x  1 agustinlobo  admin  7722168  4 dic 15:57 rgdal.so


I can get rgdal running using the version from kyngchaos, but not with this one.

Thanks,

Agus


2010/12/24 Agustin Lobo <alobolistas at gmail.com>:
> After having installed GDAL from
> http://www.kyngchaos.com/files/software/frameworks/GDAL_Complete-1.7.dmg
> and downloading
> http://www.kyngchaos.com/files/software/frameworks/rgdal-0.6.29-1.zip
> I install rgdal and get:
>
>> install.packages("/Users/agustinlobo/Downloads/rgdal/rgdal_0.6-29.tgz")
> inferring 'repos = NULL' from the file name
>> require(rgdal)
> Loading required package: rgdal
> Error in get(Info[i, 1], envir = env) :
> ?no se puede asignar un bloque de memoria de tama?o 2.2 Gb
>
> (== cannot assign a memory block of size 2.2 Gb)
>
> Is this a particular problem in this computer? Any fix?
>
> (BTW, cannot find how to get these messages in English)
>
> Agus
>


From senator at ecotoxicology.de  Mon Dec 27 21:31:19 2010
From: senator at ecotoxicology.de (=?iso-8859-1?Q?Ralf_Sch=E4fer?=)
Date: Mon, 27 Dec 2010 21:31:19 +0100
Subject: [R-sig-Geo] MACOSX: rgdal cannot find GDAL
In-Reply-To: <AANLkTi=1=YLD259OhU_ZaEdcnLcJYM_SNxbrbje-YkKN@mail.gmail.com>
References: <mailman.9.1293188403.12303.r-sig-geo@r-project.org>
	<3F1030F1-C0F6-4730-A31F-F9188DF990E6@ecotoxicology.de>
	<AANLkTi=1=YLD259OhU_ZaEdcnLcJYM_SNxbrbje-YkKN@mail.gmail.com>
Message-ID: <6C423109-49AD-49F9-A21F-53C167083C81@ecotoxicology.de>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101227/8746ce33/attachment.pl>

From alobolistas at gmail.com  Tue Dec 28 10:28:27 2010
From: alobolistas at gmail.com (Agustin Lobo)
Date: Tue, 28 Dec 2010 10:28:27 +0100
Subject: [R-sig-Geo] MACOSX: rgdal cannot find GDAL
In-Reply-To: <6C423109-49AD-49F9-A21F-53C167083C81@ecotoxicology.de>
References: <mailman.9.1293188403.12303.r-sig-geo@r-project.org>
	<3F1030F1-C0F6-4730-A31F-F9188DF990E6@ecotoxicology.de>
	<AANLkTi=1=YLD259OhU_ZaEdcnLcJYM_SNxbrbje-YkKN@mail.gmail.com>
	<6C423109-49AD-49F9-A21F-53C167083C81@ecotoxicology.de>
Message-ID: <AANLkTikotHrDO-mnNmDo=NqgqQFpUn6BeU05pVXA3=PH@mail.gmail.com>

Ralf,

Setting the path as you indicate solves the problem of running gdalinfo:
imac-de-agustin-lobo:~ agustinlobo$ export
PATH=/Library/Frameworks/GDAL.framework/Programs:$PATH
imac-de-agustin-lobo:~ agustinlobo$ echo
$PATH/Library/Frameworks/GDAL.framework/Programs:/usr/bin:/bin:/usr/sbin:/sbin:/usr/local/bin:/usr/X11/bin
imac-de-agustin-lobo:~ agustinlobo$ gdalinfo --version
GDAL 1.7.3, released 2010/11/10

Therefore we can close this thread on installing GDAL and rgdal on
MACOSX from the kyngchaos server!
I'll be sending the link with directions for dummies shortly

Thank you all

Agus

2010/12/27 Ralf Sch?fer <senator at ecotoxicology.de>:
> Hi Agustin,
>
>>> Can you allocate the folder:
>>> /Library/Frameworks/GDAL.framework ????
>> Yes:
>> imac-de-agustin-lobo:Frameworks agustinlobo$ pwd
>> /Library/Frameworks
>> This problem persists:
>> imac-de-agustin-lobo:GDAL.framework agustinlobo$ gdalinfo --version
>> -bash: gdalinfo: command not found
>> But actually, the R installation of rgdal works now. Could it be that
>> I needed to reboot after
>> installing GDAL? I'd like to clarify as I'm trying to write up directions:
>
> I am not a Shell expert - but my guess would be that the GDAL commands are not in your PATH. So when you type the commands Shell does not find them.
> Try to include them in your Path:
> export PATH=/Library/Frameworks/GDAL.framework/Programs:$PATH
> I actually think that I had to do this as well...
>
> In case that works you can write this path to your profile so you have it for every terminal session - here is a short guide:
> http://www.macgasm.net/2008/04/10/adding-a-new-location-to-your-path-variable-within-terminal/
>
>>
>> The other one is the problem installing rgdal from CRAN repositories 1 and 2
>
> Unfortunately, I have no idea why this fails for you. In fact, I checked it as well, and did not work for me either. I get the same error even when I specify GDAL and Proj path:
> install.packages("rgdal", configure.args='--with-gdal-config=/Library/Frameworks/GDAL.Framework/unix/bin/gdal-config --with-proj-include=/Library/Frameworks/PROJ.framework/unix/include-with-proj-lib=/Library/Frameworks/PROJ.framework/unix/lib/')
>
> So that is why I also installed from source as outlined previously- and I noticed that on the CRAN source there is a later version of rgdal 0.6-33 instead of 0.6-31, may be this is the problem (I updated to R 2.12.1).
> I reckon other people can be of more help here.
>
>> I still do not know which one is to be preferred...
>
> Well, as Roger Bivand pointed out (24.12) ?Installing from CRAN/CRAN extra is certainly the best option. May be there is a fix to install the binary from CRAN/CRAN extra
> Otherwise certainly the kyngchaos binaries are the most convenient way (yet they are rgdal 0.6-29)
>
> Cheers
> Ralf
> ? ? ? ?[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From wtu at georgiasouthern.edu  Tue Dec 28 19:40:09 2010
From: wtu at georgiasouthern.edu (Wei Tu)
Date: Tue, 28 Dec 2010 13:40:09 -0500
Subject: [R-sig-Geo] Error in moran.test()
Message-ID: <AANLkTi=rPrfoEUB2uzbgFDWbNGQNTocXTz14tvc=4Qkz@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101228/0b881e09/attachment.pl>

From Roger.Bivand at nhh.no  Tue Dec 28 19:49:39 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 28 Dec 2010 19:49:39 +0100 (CET)
Subject: [R-sig-Geo] Error in moran.test()
In-Reply-To: <AANLkTi=rPrfoEUB2uzbgFDWbNGQNTocXTz14tvc=4Qkz@mail.gmail.com>
References: <AANLkTi=rPrfoEUB2uzbgFDWbNGQNTocXTz14tvc=4Qkz@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.1012281946130.30264@reclus.nhh.no>

On Tue, 28 Dec 2010, Wei Tu wrote:

> Hello,
>
> I got an error message after running the following R code:
>
> Error in moran.test(resid(mod.lm), ga159_mat) :  objects of different length
>
> # load data
> srm <- read.csv("srm.csv",sep=",",header=T)
> ga159.shp <- readShapeSpatial("srm.shp")
> data <- srm
>
> # create a weight matrix
> ga159w <- poly2nb(ga159.shp, queen=T)
> ga159w_mat <- nb2listw(ga159, style="B", zero.policy=TRUE)
>
> # Linear Model
> mod.lm <- lm(Rate_A ~ BlackZ + PopDenZ + MFIncomeZ + LanZ + Less9Z, data =
> data)
> summary(mod.lm)
> moran.test(resid(mod.lm),ga159w_mat)
>
> srm.shp is a shapefile including 159 counties in Georgia.

Had it occurred to you to check length(resid(mod.lm)) and length(ga159w)? 
They are not equal. In addition, unless you check carefully that srm and 
ga159.shp are in the same order - you almost certainly have some counties 
represented by multiple polygons in the shapefile - your results would be 
at severe risk of being meaningless. Use the FIPS in the shapefile and the 
data file to match correctly.

Hope this helps,

Roger

>
> Thanks!
>
> Wei
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From Jan.Quets at ua.ac.be  Wed Dec 29 10:47:07 2010
From: Jan.Quets at ua.ac.be (Quets Jan)
Date: Wed, 29 Dec 2010 10:47:07 +0100
Subject: [R-sig-Geo] which monte carlo envelope for the mark correlation
	function
Message-ID: <88D678F82D1A1447BD5C643160FFCBC20C16DA@xmail07.ad.ua.ac.be>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101229/f75eba55/attachment.pl>

From jim at bitwrit.com.au  Wed Dec 29 11:15:53 2010
From: jim at bitwrit.com.au (Jim Lemon)
Date: Wed, 29 Dec 2010 21:15:53 +1100
Subject: [R-sig-Geo] [R] Drawing Maps of detailed Australian regions
In-Reply-To: <alpine.LRH.2.00.1012171253100.31321@reclus.nhh.no>
References: <378EB90FD48A9E47A49222E07DF06BAAA767B7@AUSYDEXC37.au.kworld.kpmg.com>
	<AANLkTin2XwwKgf5=t+Re0+wqk4qv4VDfj8G3=K071Dc-@mail.gmail.com>
	<4D088F94.1000503@bitwrit.com.au>
	<AANLkTimfUAkDArmiJgxv1dt=i7S+4LH43DJ3nHMZEX54@mail.gmail.com>
	<4D09D35D.2080205@bitwrit.com.au> <4D0B2F20.8000408@bitwrit.com.au>
	<AANLkTikMMQ+dccMhoFet8mGQG7mavk1-uZ1o=tMar5Ji@mail.gmail.com>
	<4D0B4808.5000605@bitwrit.com.au>
	<alpine.LRH.2.00.1012171253100.31321@reclus.nhh.no>
Message-ID: <4D1B0A59.101@bitwrit.com.au>

Hi folks,
I'm finishing off this thread in case anyone finds themselves with the 
same problem. I'm pretty sure that the solution I have found will be 
specific to Fedora 12 and KDE.

I had a series of unsuccessful attempts to install the GDAL libraries in 
order to get the "rgdal" package to attach in R. If you haven't already 
read through the previous emails, the painful details are there. In the 
end, I wiped all the GDAL stuff from the system and started again.

I tried using KPackage (the KDE package manager), having previously used 
"yum" to install the GDAL libraries.

1) I searched for "gdal".

2) I selected:
	gdal - GIS file format library
	gdal-devel - Development libraries for the GDAL file format library
	gdal-static - Static Development libraries for the GDAL file format library
	pfstools-gdal - PFS tools using the GDAL library to handle GIS information

3) I let KPackage do its stuff.

4) library(rgdal)
Loading required package: sp
Geospatial Data Abstraction Library extensions to R successfully loaded
Loaded GDAL runtime: GDAL 1.6.1, released 2009/05/11
Path to GDAL shared files: /usr/share/gdal
Loaded PROJ.4 runtime: Rel. 4.6.1, 21 August 2008
Path to PROJ.4 shared files: (autodetected)

!!!!

Note that I may have installed more packages than I had to, but at least 
it is running. Thanks to all who responded to my requests. Now to find a 
tutorial to work out how to use the thing.

Jim


From alobolistas at gmail.com  Wed Dec 29 13:48:16 2010
From: alobolistas at gmail.com (Agustin Lobo)
Date: Wed, 29 Dec 2010 13:48:16 +0100
Subject: [R-sig-Geo] Installation of rgdal from CRAN on MACOSX does not work
Message-ID: <AANLkTikBcJ1DM=D=0_sB7kHjiYVjhv9+1gnLnj3MzZTJ@mail.gmail.com>

While the installation from
http://www.kyngchaos.com/files/software/frameworks/rgdal-0.6.29-1.zip
works fine
the installation of rgdal from CRAN on MACOSX does not work, despite
my previous message that this issue was solved as well
(my confusion was a consequence of mixing both installations in the
same session):

> setRepositories(ind=1:2)
> install.packages("rgdal")
--- Please select a CRAN mirror for use in this session ---
probando la URL
'http://www.stats.ox.ac.uk/pub/RWin/bin/macosx/leopard/contrib/2.12/rgdal_0.6-31.tgz'
Content type 'application/x-gzip' length 10203689 bytes (9.7 Mb)
URL abierta
==================================================
downloaded 9.7 Mb


The downloaded packages are in
	/var/folders/iR/iRxOvaG9F10viNoa7WceNU+++TI/-Tmp-//RtmpqIhqn9/downloaded_packages
> require(rgdal)
Loading required package: rgdal
Loading required package: sp
Error in dyn.load(file, DLLpath = DLLpath, ...) :
  unable to load shared object
'/Library/Frameworks/R.framework/Versions/2.12/Resources/library/rgdal/libs/i386/rgdal.so':
  dlopen(/Library/Frameworks/R.framework/Versions/2.12/Resources/library/rgdal/libs/i386/rgdal.so,
6): Library not loaded: libR.dylib
  Referenced from:
/Library/Frameworks/R.framework/Versions/2.12/Resources/library/rgdal/libs/i386/rgdal.so
  Reason: image not found
> sessionInfo()
R version 2.12.1 (2010-12-16)
Platform: i386-apple-darwin9.8.0/i386 (32-bit)

locale:
[1] es_ES.UTF-8/es_ES.UTF-8/C/C/es_ES.UTF-8/es_ES.UTF-8

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] sp_0.9-76

loaded via a namespace (and not attached):
[1] grid_2.12.1     lattice_0.19-13 tools_2.12.1

Note that rgdal.so is where it should be:

imac-de-agustin-lobo:~ agustinlobo$ ls -l
/Library/Frameworks/R.framework/Versions/2.12/Resources/library/rgdal/libs/i386/
total 15088
-rwxr-xr-x  1 agustinlobo  admin  7722168  4 dic 15:57 rgdal.so

This error is not solved by setting the GDAL path.

Agus


From Roger.Bivand at nhh.no  Wed Dec 29 16:02:01 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 29 Dec 2010 16:02:01 +0100 (CET)
Subject: [R-sig-Geo] Installation of rgdal from CRAN on MACOSX does not
	work
In-Reply-To: <AANLkTikBcJ1DM=D=0_sB7kHjiYVjhv9+1gnLnj3MzZTJ@mail.gmail.com>
References: <AANLkTikBcJ1DM=D=0_sB7kHjiYVjhv9+1gnLnj3MzZTJ@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.1012291519480.771@reclus.nhh.no>

On Wed, 29 Dec 2010, Agustin Lobo wrote:

> While the installation from
> http://www.kyngchaos.com/files/software/frameworks/rgdal-0.6.29-1.zip
> works fine
> the installation of rgdal from CRAN on MACOSX does not work, despite
> my previous message that this issue was solved as well

Please do read the error message:

>  unable to load shared object
> 
'/Library/Frameworks/R.framework/Versions/2.12/Resources/library/rgdal/libs/i$
> 
dlopen(/Library/Frameworks/R.framework/Versions/2.12/Resources/library/rgdal$
> 6): Library not loaded: libR.dylib
>  Referenced from:
> 
/Library/Frameworks/R.framework/Versions/2.12/Resources/library/rgdal/libs/i3$
>  Reason: image not found

The image that is not found is libR.dylib, the main R dylib against which 
rgdal.so is linked. So this is still an issue of your R installation, 
possibly a multi-architecture issue (is libR.dylib the i386 version, 
guessing - is libR64.dylib the 64-bit Intel version?).

Could any OSX users who are using CRAN extra rgdal please help Agus to 
resolve this - it could be that local path modifications are hiding 
libR.dylib, or that R was installed 64-bit only, and the INSTALL_opts= 
argument to install.packages() was not set correctly? I assume that the 
CRAN extras OSX rgdal binary is built against a standard R OSX Intel 
install, which is multi-architecture.

For a fully updated rgdal, the best combination remains installing the 
full GDAL framework from Kyngchaos, the full tools collection:

http://r.research.att.com/tools/
http://cran.r-project.org/bin/macosx/tools

and install from CRAN source. For a lab, the instructor would rather build 
a local OSX rgdal binary package using the tools collection on one 
development machine with all the correct path variables set (R CMD check 
rgdal; R CMD INSTALL --build rgdal), paying attention to 
multi-architectures, and distribute to lab machines from there. This means 
that the lab instructor can keep rgdal updated if need be, as both 
Kyngchaos and CRAN extras rgdal OSX binary packages typically lag CRAN 
source.

Please also note that there are very many very old GDAL binaries out there 
that users pick up and apply, missing all the subsequent bug-fixes and 
improvements - GDAL 1.8.0 release candidate 1 is now out, so we are 
looking at an upgrade to 1.8.0 during January, which Kyngchaos will most 
likely pick up quickly, probably with a current rgdal binary.

Roger


> (my confusion was a consequence of mixing both installations in the
> same session):
>
>> setRepositories(ind=1:2)
>> install.packages("rgdal")
> --- Please select a CRAN mirror for use in this session ---
> probando la URL
> 'http://www.stats.ox.ac.uk/pub/RWin/bin/macosx/leopard/contrib/2.12/rgdal_0.6-31.tgz'
> Content type 'application/x-gzip' length 10203689 bytes (9.7 Mb)
> URL abierta
> ==================================================
> downloaded 9.7 Mb
>
>
> The downloaded packages are in
> 	/var/folders/iR/iRxOvaG9F10viNoa7WceNU+++TI/-Tmp-//RtmpqIhqn9/downloaded_packages
>> require(rgdal)
> Loading required package: rgdal
> Loading required package: sp
> Error in dyn.load(file, DLLpath = DLLpath, ...) :
>  unable to load shared object
> '/Library/Frameworks/R.framework/Versions/2.12/Resources/library/rgdal/libs/i386/rgdal.so':
>  dlopen(/Library/Frameworks/R.framework/Versions/2.12/Resources/library/rgdal/libs/i386/rgdal.so,
> 6): Library not loaded: libR.dylib
>  Referenced from:
> /Library/Frameworks/R.framework/Versions/2.12/Resources/library/rgdal/libs/i386/rgdal.so
>  Reason: image not found
>> sessionInfo()
> R version 2.12.1 (2010-12-16)
> Platform: i386-apple-darwin9.8.0/i386 (32-bit)
>
> locale:
> [1] es_ES.UTF-8/es_ES.UTF-8/C/C/es_ES.UTF-8/es_ES.UTF-8
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> other attached packages:
> [1] sp_0.9-76
>
> loaded via a namespace (and not attached):
> [1] grid_2.12.1     lattice_0.19-13 tools_2.12.1
>
> Note that rgdal.so is where it should be:
>
> imac-de-agustin-lobo:~ agustinlobo$ ls -l
> /Library/Frameworks/R.framework/Versions/2.12/Resources/library/rgdal/libs/i386/
> total 15088
> -rwxr-xr-x  1 agustinlobo  admin  7722168  4 dic 15:57 rgdal.so
>
> This error is not solved by setting the GDAL path.
>
> Agus
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From marcia.n.macedo at gmail.com  Wed Dec 29 19:00:48 2010
From: marcia.n.macedo at gmail.com (Marcia Macedo)
Date: Wed, 29 Dec 2010 13:00:48 -0500
Subject: [R-sig-Geo] memory issues w/ raster processing
Message-ID: <AANLkTimXGaYoYu59ZBMvs+CjHtOkG21VDFJpqgyTecCv@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101229/a2d4bf1f/attachment.pl>

From alobolistas at gmail.com  Wed Dec 29 19:58:45 2010
From: alobolistas at gmail.com (Agustin Lobo)
Date: Wed, 29 Dec 2010 19:58:45 +0100
Subject: [R-sig-Geo] Installation of rgdal from CRAN on MACOSX does not
	work
In-Reply-To: <alpine.LRH.2.00.1012291519480.771@reclus.nhh.no>
References: <AANLkTikBcJ1DM=D=0_sB7kHjiYVjhv9+1gnLnj3MzZTJ@mail.gmail.com>
	<alpine.LRH.2.00.1012291519480.771@reclus.nhh.no>
Message-ID: <AANLkTi=utB+O8PPVmYtE8yuhMt+yRReiK6rUHpnCj9v3@mail.gmail.com>

Roger,

But
http://www.kyngchaos.com/files/software/frameworks/rgdal-0.6.29-1.zip
installs with no problems on the same machine and on the same R, would that not
discard the possibility of an
> issue of your R installation,
> possibly a multi-architecture issue

as you suggest?

Please note I'm not personally in a hurry any more as we can work with
the rgdal from kyngchaos. I just want to report the error to help
having an rgdal installation for MACOSX as
simple as for Windows.
I understand installing from source will always be a bit more
difficult on MACOSX than on linux as there are some basic tools and
libraries that are missing on regular MAC systems that must be
previously installed, but this is not my concern now as I'm focusing
on installations from binaries.

Thanks!

Agus



2010/12/29 Roger Bivand <Roger.Bivand at nhh.no>:
> On Wed, 29 Dec 2010, Agustin Lobo wrote:
>
>> While the installation from
>> http://www.kyngchaos.com/files/software/frameworks/rgdal-0.6.29-1.zip
>> works fine
>> the installation of rgdal from CRAN on MACOSX does not work, despite
>> my previous message that this issue was solved as well
>
> Please do read the error message:
>
>> ?unable to load shared object
>>
> '/Library/Frameworks/R.framework/Versions/2.12/Resources/library/rgdal/libs/i$
>>
> dlopen(/Library/Frameworks/R.framework/Versions/2.12/Resources/library/rgdal$
>>
>> 6): Library not loaded: libR.dylib
>> ?Referenced from:
>>
> /Library/Frameworks/R.framework/Versions/2.12/Resources/library/rgdal/libs/i3$
>>
>> ?Reason: image not found
>
> The image that is not found is libR.dylib, the main R dylib against which
> rgdal.so is linked. So this is still an issue of your R installation,
> possibly a multi-architecture issue (is libR.dylib the i386 version,
> guessing - is libR64.dylib the 64-bit Intel version?).
>
> Could any OSX users who are using CRAN extra rgdal please help Agus to
> resolve this - it could be that local path modifications are hiding
> libR.dylib, or that R was installed 64-bit only, and the INSTALL_opts=
> argument to install.packages() was not set correctly? I assume that the CRAN
> extras OSX rgdal binary is built against a standard R OSX Intel install,
> which is multi-architecture.
>
> For a fully updated rgdal, the best combination remains installing the full
> GDAL framework from Kyngchaos, the full tools collection:
>
> http://r.research.att.com/tools/
> http://cran.r-project.org/bin/macosx/tools
>
> and install from CRAN source. For a lab, the instructor would rather build a
> local OSX rgdal binary package using the tools collection on one development
> machine with all the correct path variables set (R CMD check rgdal; R CMD
> INSTALL --build rgdal), paying attention to multi-architectures, and
> distribute to lab machines from there. This means that the lab instructor
> can keep rgdal updated if need be, as both Kyngchaos and CRAN extras rgdal
> OSX binary packages typically lag CRAN source.
>
> Please also note that there are very many very old GDAL binaries out there
> that users pick up and apply, missing all the subsequent bug-fixes and
> improvements - GDAL 1.8.0 release candidate 1 is now out, so we are looking
> at an upgrade to 1.8.0 during January, which Kyngchaos will most likely pick
> up quickly, probably with a current rgdal binary.
>
> Roger
>
>
>> (my confusion was a consequence of mixing both installations in the
>> same session):
>>
>>> setRepositories(ind=1:2)
>>> install.packages("rgdal")
>>
>> --- Please select a CRAN mirror for use in this session ---
>> probando la URL
>>
>> 'http://www.stats.ox.ac.uk/pub/RWin/bin/macosx/leopard/contrib/2.12/rgdal_0.6-31.tgz'
>> Content type 'application/x-gzip' length 10203689 bytes (9.7 Mb)
>> URL abierta
>> ==================================================
>> downloaded 9.7 Mb
>>
>>
>> The downloaded packages are in
>>
>> ?/var/folders/iR/iRxOvaG9F10viNoa7WceNU+++TI/-Tmp-//RtmpqIhqn9/downloaded_packages
>>>
>>> require(rgdal)
>>
>> Loading required package: rgdal
>> Loading required package: sp
>> Error in dyn.load(file, DLLpath = DLLpath, ...) :
>> ?unable to load shared object
>>
>> '/Library/Frameworks/R.framework/Versions/2.12/Resources/library/rgdal/libs/i386/rgdal.so':
>>
>> ?dlopen(/Library/Frameworks/R.framework/Versions/2.12/Resources/library/rgdal/libs/i386/rgdal.so,
>> 6): Library not loaded: libR.dylib
>> ?Referenced from:
>>
>> /Library/Frameworks/R.framework/Versions/2.12/Resources/library/rgdal/libs/i386/rgdal.so
>> ?Reason: image not found
>>>
>>> sessionInfo()
>>
>> R version 2.12.1 (2010-12-16)
>> Platform: i386-apple-darwin9.8.0/i386 (32-bit)
>>
>> locale:
>> [1] es_ES.UTF-8/es_ES.UTF-8/C/C/es_ES.UTF-8/es_ES.UTF-8
>>
>> attached base packages:
>> [1] stats ? ? graphics ?grDevices utils ? ? datasets ?methods ? base
>>
>> other attached packages:
>> [1] sp_0.9-76
>>
>> loaded via a namespace (and not attached):
>> [1] grid_2.12.1 ? ? lattice_0.19-13 tools_2.12.1
>>
>> Note that rgdal.so is where it should be:
>>
>> imac-de-agustin-lobo:~ agustinlobo$ ls -l
>>
>> /Library/Frameworks/R.framework/Versions/2.12/Resources/library/rgdal/libs/i386/
>> total 15088
>> -rwxr-xr-x ?1 agustinlobo ?admin ?7722168 ?4 dic 15:57 rgdal.so
>>
>> This error is not solved by setting the GDAL path.
>>
>> Agus
>>
>
> --
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From jacobvanetten at yahoo.com  Wed Dec 29 22:11:25 2010
From: jacobvanetten at yahoo.com (Jacob van Etten)
Date: Wed, 29 Dec 2010 21:11:25 +0000 (GMT)
Subject: [R-sig-Geo] memory issues w/ raster processing
In-Reply-To: <AANLkTimXGaYoYu59ZBMvs+CjHtOkG21VDFJpqgyTecCv@mail.gmail.com>
Message-ID: <934810.78875.qm@web29705.mail.ird.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101229/088a2b7e/attachment.pl>

From Gericke.L.Cook at aphis.usda.gov  Thu Dec 30 00:03:13 2010
From: Gericke.L.Cook at aphis.usda.gov (Gericke.L.Cook at aphis.usda.gov)
Date: Wed, 29 Dec 2010 16:03:13 -0700
Subject: [R-sig-Geo] Gericke L Cook is on maternity leave
Message-ID: <OFE675E3B9.F6686BA4-ON87257808.007EA36D-87257808.007EA36E@aphis.usda.gov>


I will be out of the office starting  12/23/2010 and will not return until
02/18/2011.

Please contact my backup, Justin Shepard, if you are in need of GIS
assistance during my absence: Justin.H.Shepard at aphis.usda.gov
(970) 494-7534


From lists at remoteinformation.com.au  Thu Dec 30 00:48:19 2010
From: lists at remoteinformation.com.au (Ben Madin)
Date: Thu, 30 Dec 2010 10:48:19 +1100
Subject: [R-sig-Geo] [R] Drawing Maps of detailed Australian regions
In-Reply-To: <4D1B0A59.101@bitwrit.com.au>
References: <378EB90FD48A9E47A49222E07DF06BAAA767B7@AUSYDEXC37.au.kworld.kpmg.com>
	<AANLkTin2XwwKgf5=t+Re0+wqk4qv4VDfj8G3=K071Dc-@mail.gmail.com>
	<4D088F94.1000503@bitwrit.com.au>
	<AANLkTimfUAkDArmiJgxv1dt=i7S+4LH43DJ3nHMZEX54@mail.gmail.com>
	<4D09D35D.2080205@bitwrit.com.au> <4D0B2F20.8000408@bitwrit.com.au>
	<AANLkTikMMQ+dccMhoFet8mGQG7mavk1-uZ1o=tMar5Ji@mail.gmail.com>
	<4D0B4808.5000605@bitwrit.com.au>
	<alpine.LRH.2.00.1012171253100.31321@reclus.nhh.no>
	<4D1B0A59.101@bitwrit.com.au>
Message-ID: <58F2C8FF-9090-4BB7-9ACE-7E3359535649@remoteinformation.com.au>

Jim,

On 29/12/2010, at 9:15 PM, Jim Lemon wrote:

> Note that I may have installed more packages than I had to, but at least it is running. Thanks to all who responded to my requests. Now to find a tutorial to work out how to use the thing.

What you probably want is "ASDAR" - try bookdepository or amazon, or your local uni library.

Bivand, R., E. Pebesma, and V. Gomez-Rubio, Applied spatial data analysis with R. 1 ed. Use R!, ed. R. Gentleman, K. Hornik, and G. Parmigiani. 2008, New York: Springer. 374.

cheers

Ben


From jeff.hamann at forestinformatics.com  Thu Dec 30 02:41:03 2010
From: jeff.hamann at forestinformatics.com (Jeff Hamann)
Date: Wed, 29 Dec 2010 17:41:03 -0800
Subject: [R-sig-Geo] generating shapefile from scratch
Message-ID: <0C9AE9AA-1FDB-4D6B-AD78-EC264FA5BB0E@forestinformatics.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101229/b7ae801d/attachment.pl>

From odonnems at yahoo.com  Thu Dec 30 15:43:30 2010
From: odonnems at yahoo.com (Michael ODonnell)
Date: Thu, 30 Dec 2010 06:43:30 -0800 (PST)
Subject: [R-sig-Geo] How to Convert extract() results to 2D matrix
Message-ID: <233545.41035.qm@web58006.mail.re3.yahoo.com>

I am using the extract() function within the R raster package and I am trying to 
both understand the output as well as figure out how to convert the output to a 
2D matrix. So, I am using a SpatialPoints file and the method "buffer". The 
returned results represent rows, point location, and columns, pixel values 
extracted. Ultimately, I want to convert each record to a 2D matrix.

Questions:
How do I convert the extract() results, using the buffer method, to a 2D matrix 
for each point?

Does the buffer method return pixels that fall within a radius (circle), and is 
the buffer defining a 2D array? If extract returns pixels within a circle, does 
it assign NA to the pixels in the circle that fall outside the circle but reside 
within a 2D matrix (This is generally how most programs I work with handle 
this).

What happens when a point falls near the edge of a raster dataset and the buffer 
distance exceeds the distance between the point and the edge of the raster--Are 
NAs returned or do these result in a non-square 2D array?

Thank you for your help,
Mike


From Roger.Bivand at nhh.no  Thu Dec 30 15:59:38 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 30 Dec 2010 15:59:38 +0100 (CET)
Subject: [R-sig-Geo] Installation of rgdal from CRAN on MACOSX does not
 work
In-Reply-To: <AANLkTi=utB+O8PPVmYtE8yuhMt+yRReiK6rUHpnCj9v3@mail.gmail.com>
References: <AANLkTikBcJ1DM=D=0_sB7kHjiYVjhv9+1gnLnj3MzZTJ@mail.gmail.com>
	<alpine.LRH.2.00.1012291519480.771@reclus.nhh.no>
	<AANLkTi=utB+O8PPVmYtE8yuhMt+yRReiK6rUHpnCj9v3@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.1012301555250.4426@reclus.nhh.no>

On Wed, 29 Dec 2010, Agustin Lobo wrote:

> Roger,
>
> But
> http://www.kyngchaos.com/files/software/frameworks/rgdal-0.6.29-1.zip
> installs with no problems on the same machine and on the same R, would that not
> discard the possibility of an
>> issue of your R installation,
>> possibly a multi-architecture issue
>
> as you suggest?
>
> Please note I'm not personally in a hurry any more as we can work with
> the rgdal from kyngchaos.

I will have access to an OSX laptop in a little over a week, and will try 
out the CRAN rgdal binaries. Just one report of installation failure isn't 
enough. I think that maybe someone on R-sig-mac might know why rgdal.so is 
looking for libR.dylib; I don't use OSX, and don't have easy access to 
such a machine, which is why I asked for others to comment.

Roger

> I just want to report the error to help
> having an rgdal installation for MACOSX as
> simple as for Windows.
> I understand installing from source will always be a bit more
> difficult on MACOSX than on linux as there are some basic tools and
> libraries that are missing on regular MAC systems that must be
> previously installed, but this is not my concern now as I'm focusing
> on installations from binaries.
>
> Thanks!
>
> Agus
>
>
>
> 2010/12/29 Roger Bivand <Roger.Bivand at nhh.no>:
>> On Wed, 29 Dec 2010, Agustin Lobo wrote:
>>
>>> While the installation from
>>> http://www.kyngchaos.com/files/software/frameworks/rgdal-0.6.29-1.zip
>>> works fine
>>> the installation of rgdal from CRAN on MACOSX does not work, despite
>>> my previous message that this issue was solved as well
>>
>> Please do read the error message:
>>
>>> ?unable to load shared object
>>>
>> '/Library/Frameworks/R.framework/Versions/2.12/Resources/library/rgdal/libs/i$
>>>
>> dlopen(/Library/Frameworks/R.framework/Versions/2.12/Resources/library/rgdal$
>>>
>>> 6): Library not loaded: libR.dylib
>>> ?Referenced from:
>>>
>> /Library/Frameworks/R.framework/Versions/2.12/Resources/library/rgdal/libs/i3$
>>>
>>> ?Reason: image not found
>>
>> The image that is not found is libR.dylib, the main R dylib against which
>> rgdal.so is linked. So this is still an issue of your R installation,
>> possibly a multi-architecture issue (is libR.dylib the i386 version,
>> guessing - is libR64.dylib the 64-bit Intel version?).
>>
>> Could any OSX users who are using CRAN extra rgdal please help Agus to
>> resolve this - it could be that local path modifications are hiding
>> libR.dylib, or that R was installed 64-bit only, and the INSTALL_opts=
>> argument to install.packages() was not set correctly? I assume that the CRAN
>> extras OSX rgdal binary is built against a standard R OSX Intel install,
>> which is multi-architecture.
>>
>> For a fully updated rgdal, the best combination remains installing the full
>> GDAL framework from Kyngchaos, the full tools collection:
>>
>> http://r.research.att.com/tools/
>> http://cran.r-project.org/bin/macosx/tools
>>
>> and install from CRAN source. For a lab, the instructor would rather build a
>> local OSX rgdal binary package using the tools collection on one development
>> machine with all the correct path variables set (R CMD check rgdal; R CMD
>> INSTALL --build rgdal), paying attention to multi-architectures, and
>> distribute to lab machines from there. This means that the lab instructor
>> can keep rgdal updated if need be, as both Kyngchaos and CRAN extras rgdal
>> OSX binary packages typically lag CRAN source.
>>
>> Please also note that there are very many very old GDAL binaries out there
>> that users pick up and apply, missing all the subsequent bug-fixes and
>> improvements - GDAL 1.8.0 release candidate 1 is now out, so we are looking
>> at an upgrade to 1.8.0 during January, which Kyngchaos will most likely pick
>> up quickly, probably with a current rgdal binary.
>>
>> Roger
>>
>>
>>> (my confusion was a consequence of mixing both installations in the
>>> same session):
>>>
>>>> setRepositories(ind=1:2)
>>>> install.packages("rgdal")
>>>
>>> --- Please select a CRAN mirror for use in this session ---
>>> probando la URL
>>>
>>> 'http://www.stats.ox.ac.uk/pub/RWin/bin/macosx/leopard/contrib/2.12/rgdal_0.6-31.tgz'
>>> Content type 'application/x-gzip' length 10203689 bytes (9.7 Mb)
>>> URL abierta
>>> ==================================================
>>> downloaded 9.7 Mb
>>>
>>>
>>> The downloaded packages are in
>>>
>>> ?/var/folders/iR/iRxOvaG9F10viNoa7WceNU+++TI/-Tmp-//RtmpqIhqn9/downloaded_packages
>>>>
>>>> require(rgdal)
>>>
>>> Loading required package: rgdal
>>> Loading required package: sp
>>> Error in dyn.load(file, DLLpath = DLLpath, ...) :
>>> ?unable to load shared object
>>>
>>> '/Library/Frameworks/R.framework/Versions/2.12/Resources/library/rgdal/libs/i386/rgdal.so':
>>>
>>> ?dlopen(/Library/Frameworks/R.framework/Versions/2.12/Resources/library/rgdal/libs/i386/rgdal.so,
>>> 6): Library not loaded: libR.dylib
>>> ?Referenced from:
>>>
>>> /Library/Frameworks/R.framework/Versions/2.12/Resources/library/rgdal/libs/i386/rgdal.so
>>> ?Reason: image not found
>>>>
>>>> sessionInfo()
>>>
>>> R version 2.12.1 (2010-12-16)
>>> Platform: i386-apple-darwin9.8.0/i386 (32-bit)
>>>
>>> locale:
>>> [1] es_ES.UTF-8/es_ES.UTF-8/C/C/es_ES.UTF-8/es_ES.UTF-8
>>>
>>> attached base packages:
>>> [1] stats ? ? graphics ?grDevices utils ? ? datasets ?methods ? base
>>>
>>> other attached packages:
>>> [1] sp_0.9-76
>>>
>>> loaded via a namespace (and not attached):
>>> [1] grid_2.12.1 ? ? lattice_0.19-13 tools_2.12.1
>>>
>>> Note that rgdal.so is where it should be:
>>>
>>> imac-de-agustin-lobo:~ agustinlobo$ ls -l
>>>
>>> /Library/Frameworks/R.framework/Versions/2.12/Resources/library/rgdal/libs/i386/
>>> total 15088
>>> -rwxr-xr-x ?1 agustinlobo ?admin ?7722168 ?4 dic 15:57 rgdal.so
>>>
>>> This error is not solved by setting the GDAL path.
>>>
>>> Agus
>>>
>>
>> --
>> Roger Bivand
>> Economic Geography Section, Department of Economics, Norwegian School of
>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>> e-mail: Roger.Bivand at nhh.no
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From aruminat at gmail.com  Thu Dec 30 16:28:44 2010
From: aruminat at gmail.com (Susumu Tanimura)
Date: Fri, 31 Dec 2010 00:28:44 +0900
Subject: [R-sig-Geo] Installation of rgdal from CRAN on MACOSX does not
	work
In-Reply-To: <alpine.LRH.2.00.1012301555250.4426@reclus.nhh.no>
References: <AANLkTikBcJ1DM=D=0_sB7kHjiYVjhv9+1gnLnj3MzZTJ@mail.gmail.com>
	<alpine.LRH.2.00.1012291519480.771@reclus.nhh.no>
	<AANLkTi=utB+O8PPVmYtE8yuhMt+yRReiK6rUHpnCj9v3@mail.gmail.com>
	<alpine.LRH.2.00.1012301555250.4426@reclus.nhh.no>
Message-ID: <AANLkTinE1vMvrr-eFOjFst+Wiup8QXwMUJuZoro8A59p@mail.gmail.com>

Hi Agus,

I have just installed rgdal package on MacOSX 10.6.5 yesterday. It is
very simple.
What you should do is two steps.
1. install rgdal and proj
2. install rgdal as source

If you use MacPorts, you may just do the followings:
$ sudo port install gdal proj
then run 64-bit R. Inside R, you may execute the followings:
> args <- paste('--with-gdal-config=/opt/local/bin/gdal-config',
                '--with-proj-lib=/opt/local/lib')
> install.packages("rgdal", type = "source", configure.args = args)

If you run 32-bit R, you will fail because ports were complied as 64-bit.

Hope it helps you.



2010/12/30 Roger Bivand <Roger.Bivand at nhh.no>:
> On Wed, 29 Dec 2010, Agustin Lobo wrote:
>
>> Roger,
>>
>> But
>> http://www.kyngchaos.com/files/software/frameworks/rgdal-0.6.29-1.zip
>> installs with no problems on the same machine and on the same R, would
>> that not
>> discard the possibility of an
>>>
>>> issue of your R installation,
>>> possibly a multi-architecture issue
>>
>> as you suggest?
>>
>> Please note I'm not personally in a hurry any more as we can work with
>> the rgdal from kyngchaos.
>
> I will have access to an OSX laptop in a little over a week, and will try
> out the CRAN rgdal binaries. Just one report of installation failure isn't
> enough. I think that maybe someone on R-sig-mac might know why rgdal.so is
> looking for libR.dylib; I don't use OSX, and don't have easy access to such
> a machine, which is why I asked for others to comment.
>
> Roger
>
>> I just want to report the error to help
>> having an rgdal installation for MACOSX as
>> simple as for Windows.
>> I understand installing from source will always be a bit more
>> difficult on MACOSX than on linux as there are some basic tools and
>> libraries that are missing on regular MAC systems that must be
>> previously installed, but this is not my concern now as I'm focusing
>> on installations from binaries.
>>
>> Thanks!
>>
>> Agus
>>
>>
>>
>> 2010/12/29 Roger Bivand <Roger.Bivand at nhh.no>:
>>>
>>> On Wed, 29 Dec 2010, Agustin Lobo wrote:
>>>
>>>> While the installation from
>>>> http://www.kyngchaos.com/files/software/frameworks/rgdal-0.6.29-1.zip
>>>> works fine
>>>> the installation of rgdal from CRAN on MACOSX does not work, despite
>>>> my previous message that this issue was solved as well
>>>
>>> Please do read the error message:
>>>
>>>>  unable to load shared object
>>>>
>>>
>>> '/Library/Frameworks/R.framework/Versions/2.12/Resources/library/rgdal/libs/i$
>>>>
>>>
>>> dlopen(/Library/Frameworks/R.framework/Versions/2.12/Resources/library/rgdal$
>>>>
>>>> 6): Library not loaded: libR.dylib
>>>>  Referenced from:
>>>>
>>>
>>> /Library/Frameworks/R.framework/Versions/2.12/Resources/library/rgdal/libs/i3$
>>>>
>>>>  Reason: image not found
>>>
>>> The image that is not found is libR.dylib, the main R dylib against which
>>> rgdal.so is linked. So this is still an issue of your R installation,
>>> possibly a multi-architecture issue (is libR.dylib the i386 version,
>>> guessing - is libR64.dylib the 64-bit Intel version?).
>>>
>>> Could any OSX users who are using CRAN extra rgdal please help Agus to
>>> resolve this - it could be that local path modifications are hiding
>>> libR.dylib, or that R was installed 64-bit only, and the INSTALL_opts=
>>> argument to install.packages() was not set correctly? I assume that the
>>> CRAN
>>> extras OSX rgdal binary is built against a standard R OSX Intel install,
>>> which is multi-architecture.
>>>
>>> For a fully updated rgdal, the best combination remains installing the
>>> full
>>> GDAL framework from Kyngchaos, the full tools collection:
>>>
>>> http://r.research.att.com/tools/
>>> http://cran.r-project.org/bin/macosx/tools
>>>
>>> and install from CRAN source. For a lab, the instructor would rather
>>> build a
>>> local OSX rgdal binary package using the tools collection on one
>>> development
>>> machine with all the correct path variables set (R CMD check rgdal; R CMD
>>> INSTALL --build rgdal), paying attention to multi-architectures, and
>>> distribute to lab machines from there. This means that the lab instructor
>>> can keep rgdal updated if need be, as both Kyngchaos and CRAN extras
>>> rgdal
>>> OSX binary packages typically lag CRAN source.
>>>
>>> Please also note that there are very many very old GDAL binaries out
>>> there
>>> that users pick up and apply, missing all the subsequent bug-fixes and
>>> improvements - GDAL 1.8.0 release candidate 1 is now out, so we are
>>> looking
>>> at an upgrade to 1.8.0 during January, which Kyngchaos will most likely
>>> pick
>>> up quickly, probably with a current rgdal binary.
>>>
>>> Roger
>>>
>>>
>>>> (my confusion was a consequence of mixing both installations in the
>>>> same session):
>>>>
>>>>> setRepositories(ind=1:2)
>>>>> install.packages("rgdal")
>>>>
>>>> --- Please select a CRAN mirror for use in this session ---
>>>> probando la URL
>>>>
>>>>
>>>> 'http://www.stats.ox.ac.uk/pub/RWin/bin/macosx/leopard/contrib/2.12/rgdal_0.6-31.tgz'
>>>> Content type 'application/x-gzip' length 10203689 bytes (9.7 Mb)
>>>> URL abierta
>>>> ==================================================
>>>> downloaded 9.7 Mb
>>>>
>>>>
>>>> The downloaded packages are in
>>>>
>>>>
>>>>  /var/folders/iR/iRxOvaG9F10viNoa7WceNU+++TI/-Tmp-//RtmpqIhqn9/downloaded_packages
>>>>>
>>>>> require(rgdal)
>>>>
>>>> Loading required package: rgdal
>>>> Loading required package: sp
>>>> Error in dyn.load(file, DLLpath = DLLpath, ...) :
>>>>  unable to load shared object
>>>>
>>>>
>>>> '/Library/Frameworks/R.framework/Versions/2.12/Resources/library/rgdal/libs/i386/rgdal.so':
>>>>
>>>>
>>>>  dlopen(/Library/Frameworks/R.framework/Versions/2.12/Resources/library/rgdal/libs/i386/rgdal.so,
>>>> 6): Library not loaded: libR.dylib
>>>>  Referenced from:
>>>>
>>>>
>>>> /Library/Frameworks/R.framework/Versions/2.12/Resources/library/rgdal/libs/i386/rgdal.so
>>>>  Reason: image not found
>>>>>
>>>>> sessionInfo()
>>>>
>>>> R version 2.12.1 (2010-12-16)
>>>> Platform: i386-apple-darwin9.8.0/i386 (32-bit)
>>>>
>>>> locale:
>>>> [1] es_ES.UTF-8/es_ES.UTF-8/C/C/es_ES.UTF-8/es_ES.UTF-8
>>>>
>>>> attached base packages:
>>>> [1] stats     graphics  grDevices utils     datasets  methods   base
>>>>
>>>> other attached packages:
>>>> [1] sp_0.9-76
>>>>
>>>> loaded via a namespace (and not attached):
>>>> [1] grid_2.12.1     lattice_0.19-13 tools_2.12.1
>>>>
>>>> Note that rgdal.so is where it should be:
>>>>
>>>> imac-de-agustin-lobo:~ agustinlobo$ ls -l
>>>>
>>>>
>>>> /Library/Frameworks/R.framework/Versions/2.12/Resources/library/rgdal/libs/i386/
>>>> total 15088
>>>> -rwxr-xr-x  1 agustinlobo  admin  7722168  4 dic 15:57 rgdal.so
>>>>
>>>> This error is not solved by setting the GDAL path.
>>>>
>>>> Agus
>>>>
>>>
>>> --
>>> Roger Bivand
>>> Economic Geography Section, Department of Economics, Norwegian School of
>>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>>> e-mail: Roger.Bivand at nhh.no
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>
> --
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>



-- 
--
?? ? <aruminat at gmail.com>


From Roger.Bivand at nhh.no  Thu Dec 30 16:49:58 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 30 Dec 2010 16:49:58 +0100 (CET)
Subject: [R-sig-Geo] generating shapefile from scratch
In-Reply-To: <0C9AE9AA-1FDB-4D6B-AD78-EC264FA5BB0E@forestinformatics.com>
References: <0C9AE9AA-1FDB-4D6B-AD78-EC264FA5BB0E@forestinformatics.com>
Message-ID: <alpine.LRH.2.00.1012301639050.4426@reclus.nhh.no>

On Wed, 29 Dec 2010, Jeff Hamann wrote:

> I've excavated some old code for generating line shapefiles and it no 
> longer works (not atypical).
>
> I can't seem to get any traction searching to web on constructing an 
> object that can pass through maptools::write.linelistShape()
>
> The code went something like this:
>
> stands <- deldir( pts, rw=c(0,x.dim,0,y.dim) )
>
> RoadShapes <- vector( "list", nrow( stands$delsgs ) )
>
> for( i in 1:nrow( stands$delsgs ) ) {
>  RoadShapes[[i]] <- rbind( stands$delsgs[i,1:2], stands$delsgs[i,3:4])
> }
>
> write.linelistShape(RoadShapes, road.att.data, file="data/roads")
>

Please try to bring your code up to date:

library(deldir)
set.seed(1)
pts <- list(x=runif(50), y=runif(50))
x.dim <- y.dim <- 1
stands <- deldir( pts, rw=c(0,x.dim,0,y.dim) )
library(maptools)
RoadShapes <- vector( "list", nrow( stands$delsgs ) )
from <- integer(nrow( stands$delsgs ))
to <- integer(nrow( stands$delsgs ))
for( i in 1:nrow( stands$delsgs ) ) {
   crds <- rbind(stands$delsgs[i,1:2], stands$delsgs[i,3:4])
# make coordinate matrix as before
   RoadShapes[[i]] <- Lines(list(Line(crds)), ID=i)
# Make Lines object with single Line object member
   from[i] <- stands$delsgs[i,5]
   to[i] <- stands$delsgs[i,6]
# provide placeholder data from point indices
}
df <- data.frame(from, to)
SL <- SpatialLines(RoadShapes)
# create Spatial Lines object
SLDF <- SpatialLinesDataFrame(SL, df)
# create object matched with data.frame
writeSpatialShape(SLDF, "SLDF")
getinfo.shape("SLDF")

If your road.att.data has different row.names than 1:nrow(stands$delsgs), 
you'll need to update them to match those of the Lines objects being 
created in the loop - here I've just put from and to in the data.frame 
object, which has 1:nrows(self) as its default row.names. Something 
similar would apply to polygons.

Hope this helps,

Roger

>
>
>
> I can correctly generate polygon shapefiles, but for some reason, the errors I get when trying to write a line shapefile are:
>
>> write.linelistShape(RoadShapes, road.att.data, file="data/roads")
> Error in attr(x, "pstart")[[2]] : subscript out of bounds
> In addition: Warning messages:
> 1: use writeSpatialShape:
> objects other than Spatial objects defined in the sp package are deprecated
> 2: In write.linelistShape(RoadShapes, road.att.data, file = "data/roads") :
>  nParts changed to integer
> 3: In write.linelistShape(RoadShapes, road.att.data, file = "data/roads") :
>  pstart changed to integer
>
> Can anyone point me to an example where the geometry isn't already in a shapefile?
>
> I do (something) like this for generating polygon shapefiles:
>
> for( i in 1:stands$n.data ) {
>
>  Shapes[[i]]$Pstart <- 0
>  Shapes[[i]]$verts <- rbind( vert.list[[i]], vert.list[[i]][1,] )
>  Shapes[[i]]$shp.type <- 5
>  Shapes[[i]]$nVerts <- nrow( Shapes[[i]]$verts )
>  Shapes[[i]]$nParts <- 1
>  bb <- bbox( vert.list[[i]] )
>  Shapes[[i]]$bbox <- c(bb[1,1],bb[2,1],bb[1,2],bb[2,2] )
>  Shapes[[i]]$shpID <- i
>
>  attr( Shapes[[i]], "nVerts" ) <- Shapes[[i]]$nVerts
>  attr( Shapes[[i]], "nParts" ) <- Shapes[[i]]$nParts
>  attr( Shapes[[i]], "shp.type" ) <- Shapes[[i]]$shp.type
>  attr( Shapes[[i]], "bbox" ) <- Shapes[[i]]$bbox
>
> }
>
>
> Thanks,
> Jeff.
>
>
>
> Jeff Hamann, PhD
> PO Box 1421
> Corvallis, Oregon 97339-1421
> 541-754-2457
> jeff.hamann[at]forestinformatics[dot]com
> http://www.forestinformatics.com
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From matzke at berkeley.edu  Fri Dec 31 06:08:14 2010
From: matzke at berkeley.edu (Nick Matzke)
Date: Thu, 30 Dec 2010 21:08:14 -0800
Subject: [R-sig-Geo] image classification with GRASS
Message-ID: <4D1D653E.6040106@berkeley.edu>

Hi all,

I've got R (with spgrass6) and GRASS installed on my Mac OS 
X machine.

My goal is to load and classify a .img file that was clipped 
out of a Landsat 7 ETM image in ERDAS.

However, GRASS seems to have a huge learning curve to even 
get started.  Could I beg some GRASS wizard to post the very 
basic commands that one would typically use to:

1. load a .img file into GRASS
2. Display it
3. Conduct a classification of the pixels (any sort of 
classification would be fine, even a simple 2-class 
unsupervised classification).

Thanks *very much* if you are able to help!  Normally I'm 
pretty good at this sort of thing, but GRASS is 
extra-intimidating to newbies.

Thanks, and cheers!
Nick



-- 
====================================================
Nicholas J. Matzke
Ph.D. Candidate, Graduate Student Researcher
Huelsenbeck Lab
Center for Theoretical Evolutionary Genomics
4151 VLSB (Valley Life Sciences Building)
Department of Integrative Biology
University of California, Berkeley

Graduate Student Instructor, IB200A
Principles of Phylogenetics: Systematics
http://ib.berkeley.edu/courses/ib200a/index.shtml

Lab websites:
http://ib.berkeley.edu/people/lab_detail.php?lab=54
http://fisher.berkeley.edu/cteg/hlab.html
Dept. personal page: 
http://ib.berkeley.edu/people/students/person_detail.php?person=370
Lab personal page: 
http://fisher.berkeley.edu/cteg/members/matzke.html
Lab phone: 510-643-6299
Dept. fax: 510-643-6264
Cell phone: 510-301-0179
Email: matzke at berkeley.edu

Mailing address:
Department of Integrative Biology
3060 VLSB #3140
Berkeley, CA 94720-3140

-----------------------------------------------------
"[W]hen people thought the earth was flat, they were wrong. 
When people thought the earth was spherical, they were 
wrong. But if you think that thinking the earth is spherical 
is just as wrong as thinking the earth is flat, then your 
view is wronger than both of them put together."

Isaac Asimov (1989). "The Relativity of Wrong." The 
Skeptical Inquirer, 14(1), 35-44. Fall 1989.
http://chem.tufts.edu/AnswersInScience/RelativityofWrong.htm


From r.hijmans at gmail.com  Fri Dec 31 18:58:24 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Fri, 31 Dec 2010 09:58:24 -0800
Subject: [R-sig-Geo] How to Convert extract() results to 2D matrix
In-Reply-To: <233545.41035.qm@web58006.mail.re3.yahoo.com>
References: <233545.41035.qm@web58006.mail.re3.yahoo.com>
Message-ID: <AANLkTi=1Ck6-XXmrwKR6wXe-GXmbJ2SYu_jY6SEhOv8V@mail.gmail.com>

Michael,

> How do I convert the extract() results, using the buffer method, to a 2D matrix
> for each point?

One way to do this now is to extract the cell numbers from a raster
with those numbers and construct the matrices from that. See example
below. To make this easier in the future, I have added a "cellnumbers"
argument to version 1.7-20 (as in extract with polygons).

library(raster)
r <- raster(ncol=180, nrow=90)

rvals <- setValues(r, runif(ncell(r)))
rcell <- setValues(r, 1:ncell(r))
xy <- cbind(-50.5, seq(-40, 40, by=20))

v <- extract(rvals, xy, buffer=1000000)
cells <- extract(rcell, xy, buffer=1000000)

m <- list()
for (i in 1:length(cells)) {
	x <- rasterFromCells(r, cells[[i]])
	y <- data.frame(cells[[i]], v[[i]])
	m[[i]] <- as.matrix(subs(x,y))
}

m


On Thu, Dec 30, 2010 at 6:43 AM, Michael ODonnell <odonnems at yahoo.com> wrote:
> I am using the extract() function within the R raster package and I am trying to
> both understand the output as well as figure out how to convert the output to a
> 2D matrix. So, I am using a SpatialPoints file and the method "buffer". The
> returned results represent rows, point location, and columns, pixel values
> extracted. Ultimately, I want to convert each record to a 2D matrix.
>
> Questions:
> How do I convert the extract() results, using the buffer method, to a 2D matrix
> for each point?
>
> Does the buffer method return pixels that fall within a radius (circle),

Yes

> and is the buffer defining a 2D array?  If extract returns pixels within a circle, does
> it assign NA to the pixels in the circle that fall outside the circle but reside
> within a 2D matrix (This is generally how most programs I work with handle
> this).

Only pixels within the circle are returned.

> What happens when a point falls near the edge of a raster dataset and the buffer
> distance exceeds the distance between the point and the edge of the raster--Are
> NAs returned or do these result in a non-square 2D array?

NAs are not returned unless the entire buffer is  outside the raster,
in which case you get a single NA value.

>
> Thank you for your help,
> Mike
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From r.hijmans at gmail.com  Fri Dec 31 19:01:53 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Fri, 31 Dec 2010 10:01:53 -0800
Subject: [R-sig-Geo] memory issues w/ raster processing
In-Reply-To: <AANLkTimXGaYoYu59ZBMvs+CjHtOkG21VDFJpqgyTecCv@mail.gmail.com>
References: <AANLkTimXGaYoYu59ZBMvs+CjHtOkG21VDFJpqgyTecCv@mail.gmail.com>
Message-ID: <AANLkTinWnMTd4yAsc09==6SW55MoeHm7nzYDivZ2TETQ@mail.gmail.com>

Marcia,

If the problem persists you can try to force it to write to disk if it does not.

setOptions(todisk=TRUE)

If it still fails:

setOptions(chunksize=100000)


I would normally not recommend to use these options.

The below worked for me (also with your number of rows and columns,
but then it takes a while!)

library(raster)

s <- list()
r <- raster(ncol=26, nrow=29)
for (i in 1:10) {
	s[i] <- setValues(r, round(runif(ncell(r)+0.5) * 3))
}
s <- stack(s)

f.232 = function(x){
   # adapted from code by Robert Hijmans
   # changes 232  to 222, but does not touch 233 or 223
   a <- which(x == 3)
   a <- subset(a, a > 1 & a < length(x))
   b <- which(x[a-1] == 2 & x[a+1] == 2)
   x[a[b]] <- 2
   return(x)
}

x <- calc(s, f.232)


On Wed, Dec 29, 2010 at 10:00 AM, Marcia Macedo
<marcia.n.macedo at gmail.com> wrote:
> Dear List,
>
> I have been trying to run a simple function on a raster stack (dimensions
> are roughly 75 MB with 2600 samples x 2900 lines x 10 layers). The function
> (adapted from code that Robert posted last week) is as follows:
>
> f.232 = function(x){
> ? ?# adapted from code by Robert Hijmans
> ? ?# changes 232 ?to 222, but does not touch 233 or 223
>
> ? ?a <- which(x == 3)
> ? ?a <- subset(a, a > 1 & a < length(x))
> ? ?b <- which(x[a-1] == 2 & x[a+1] == 2)
> ? ?x[a[b]] <- 2
> ? ?return(x)
> }
>
> The problem is that the function takes a very long time to run and often
> crashes or gives me memory warnings like this one:
>
> Warning messages:
> 1: In dimnames(data) <- dimnames :
> ?Reached total allocation of 7854Mb: see help(memory.size)
> 2: In dimnames(data) <- dimnames :
> ?Reached total allocation of 7854Mb: see help(memory.size)
>
> I am confused because this data cube is not that large and I think my system
> should be able to handle it (see specs. below).
>
> *System specs:*
>
> R version 2.12.1 (2010-12-16)
> Platform: x86_64-pc-mingw32/x64 (64-bit)
> Installed memory (RAM): 8 GB
> Processor: Intel Core i3, 2.13 GHz
>
> I must admit that I don't really understand how the raster package manages
> memory, but I was imagining that it would be more efficient to write the
> results to file iteratively (in blocks) while running the calculations
> (rather than writing all results to memory and then writing to
> file)...However, my attempts to adapt the writeValues code in the package
> documentation have not worked (i.e. the output file gets created but never
> written to and the process crashes as described above).
>
> Any thoughts about what might be going on with the memory? I am very new to
> raster processing in R (was previously working with ENVI+IDL) so forgive me
> if this is a naive question!
>
> Thanks,
> Marcia
>
> ? ? ? ?[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


