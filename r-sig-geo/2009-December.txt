From Friederike.Gerschlauer at agrar.uni-giessen.de  Tue Dec  1 10:22:49 2009
From: Friederike.Gerschlauer at agrar.uni-giessen.de (Friederike.Gerschlauer at agrar.uni-giessen.de)
Date: Tue, 01 Dec 2009 10:22:49 +0100
Subject: [R-sig-Geo] missing values in gstat for R
Message-ID: <20091201102249.11346c5uifajvjoc@horde.hrz.uni-giessen.de>

Dear list,

I am having problems with dealing with missing values in gstat  
computing a semivariogram.

I am using R 2.9.1, gstat 0.9-64 on Windows Vista.

I get the following error message:

g <- gstat(id = "sm", formula = smoist.20.06.2005 ~ 1, data = soildmD79.sp)
g <- gstat(g, id = "bd", formula = BD ~ 1, data =  
soildmD79.sp[!is.na(soildmD79.sp$BD),])
g <- gstat(g, id = "S", formula = S ~ 1, data =  
soildmD79.sp[!is.na(soildmD79.sp$S),])
g <- gstat(g, id = "U", formula = U ~ 1, data =  
soildmD79.sp[!is.na(soildmD79.sp$U),])
g <- gstat(g, id = "T", formula = T ~ 1, data =  
soildmD79.sp[!is.na(soildmD79.sp$T),])
g <- gstat(g, id = "GMD", formula = GMD ~ 1, data =  
soildmD79.sp[!is.na(soildmD79.sp$GMD),])
g <- gstat(g, id = "vcover", formula = vcover ~ 1, data =  
soildmD79.sp[!is.na(soildmD79.sp$vcover),])
g <- gstat(g, id = "mean_C", formula = mean_C~ 1, data =  
soildmD79.sp[!is.na(soildmD79.sp$mean_C),])
g <- gstat(g, id = "biomass", formula = biomass  ~ 1, data =  
soildmD79.sp[!is.na(soildmD79.sp$biomass),])
png(file = "sm_soilparamter_cross_20-06-2005.png", width = 1400,  
height = 1000, bg = "white", res = 100)
plot(variogram(g), main = "Cross variograms Soil moisture and stable  
soil parameters", sub="20/06/2005")

Error: dimensions do not match: locations 200 and data 96

This message occurs due to 100 x,y coordinate pairs and 96 values for  
the variable soil moisture.
Even though the function contains already "data =  
soildmD79.sp[!is.na(soildmD79.sp$BD),]" the missing values still cause  
an error.

Thanks for any suggestions or comments,
Friederike


From j.skoien at geo.uu.nl  Tue Dec  1 11:51:38 2009
From: j.skoien at geo.uu.nl (Jon Olav Skoien)
Date: Tue, 01 Dec 2009 11:51:38 +0100
Subject: [R-sig-Geo] missing values in gstat for R
In-Reply-To: <20091201102249.11346c5uifajvjoc@horde.hrz.uni-giessen.de>
References: <20091201102249.11346c5uifajvjoc@horde.hrz.uni-giessen.de>
Message-ID: <4B14F53A.4060702@geo.uu.nl>

Hi Friederike,

For which variable do you have NAs? If soil moisture is sm, you are 
missing in the first line:
[!is.na(soildmD79.sp$smoist.20.06.2005),]

If that is not the problem, it would be helpful if you sent a 
reproducible example.

Cheers,
Jon

Friederike.Gerschlauer at agrar.uni-giessen.de wrote:
> Dear list,
>
> I am having problems with dealing with missing values in gstat 
> computing a semivariogram.
>
> I am using R 2.9.1, gstat 0.9-64 on Windows Vista.
>
> I get the following error message:
>
> g <- gstat(id = "sm", formula = smoist.20.06.2005 ~ 1, data = 
> soildmD79.sp)
> g <- gstat(g, id = "bd", formula = BD ~ 1, data = 
> soildmD79.sp[!is.na(soildmD79.sp$BD),])
> g <- gstat(g, id = "S", formula = S ~ 1, data = 
> soildmD79.sp[!is.na(soildmD79.sp$S),])
> g <- gstat(g, id = "U", formula = U ~ 1, data = 
> soildmD79.sp[!is.na(soildmD79.sp$U),])
> g <- gstat(g, id = "T", formula = T ~ 1, data = 
> soildmD79.sp[!is.na(soildmD79.sp$T),])
> g <- gstat(g, id = "GMD", formula = GMD ~ 1, data = 
> soildmD79.sp[!is.na(soildmD79.sp$GMD),])
> g <- gstat(g, id = "vcover", formula = vcover ~ 1, data = 
> soildmD79.sp[!is.na(soildmD79.sp$vcover),])
> g <- gstat(g, id = "mean_C", formula = mean_C~ 1, data = 
> soildmD79.sp[!is.na(soildmD79.sp$mean_C),])
> g <- gstat(g, id = "biomass", formula = biomass  ~ 1, data = 
> soildmD79.sp[!is.na(soildmD79.sp$biomass),])
> png(file = "sm_soilparamter_cross_20-06-2005.png", width = 1400, 
> height = 1000, bg = "white", res = 100)
> plot(variogram(g), main = "Cross variograms Soil moisture and stable 
> soil parameters", sub="20/06/2005")
>
> Error: dimensions do not match: locations 200 and data 96
>
> This message occurs due to 100 x,y coordinate pairs and 96 values for 
> the variable soil moisture.
> Even though the function contains already "data = 
> soildmD79.sp[!is.na(soildmD79.sp$BD),]" the missing values still cause 
> an error.
>
> Thanks for any suggestions or comments,
> Friederike
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From iuri at proxima.adm.br  Tue Dec  1 12:43:21 2009
From: iuri at proxima.adm.br (Iuri Gavronski)
Date: Tue, 1 Dec 2009 09:43:21 -0200
Subject: [R-sig-Geo] missing values in gstat for R
In-Reply-To: <4B14F53A.4060702@geo.uu.nl>
References: <20091201102249.11346c5uifajvjoc@horde.hrz.uni-giessen.de> 
	<4B14F53A.4060702@geo.uu.nl>
Message-ID: <1daa4e8d0912010343q3336c5cey11bab819f067493e@mail.gmail.com>

I would add (as a sincere question): wouldn't be the case of listwise
deletion or multiple imputation? How does pairwise deletion behave for
gstat?
See http://www.uvm.edu/~dhowell/StatPages/More_Stuff/Missing_Data/Missing.html

On Tue, Dec 1, 2009 at 8:51 AM, Jon Olav Skoien <j.skoien at geo.uu.nl> wrote:
> Hi Friederike,
>
> For which variable do you have NAs? If soil moisture is sm, you are missing
> in the first line:
> [!is.na(soildmD79.sp$smoist.20.06.2005),]
>
> If that is not the problem, it would be helpful if you sent a reproducible
> example.
>
> Cheers,
> Jon
>
> Friederike.Gerschlauer at agrar.uni-giessen.de wrote:
>>
>> Dear list,
>>
>> I am having problems with dealing with missing values in gstat computing a
>> semivariogram.
>>
>> I am using R 2.9.1, gstat 0.9-64 on Windows Vista.
>>
>> I get the following error message:
>>
>> g <- gstat(id = "sm", formula = smoist.20.06.2005 ~ 1, data =
>> soildmD79.sp)
>> g <- gstat(g, id = "bd", formula = BD ~ 1, data =
>> soildmD79.sp[!is.na(soildmD79.sp$BD),])
>> g <- gstat(g, id = "S", formula = S ~ 1, data =
>> soildmD79.sp[!is.na(soildmD79.sp$S),])
>> g <- gstat(g, id = "U", formula = U ~ 1, data =
>> soildmD79.sp[!is.na(soildmD79.sp$U),])
>> g <- gstat(g, id = "T", formula = T ~ 1, data =
>> soildmD79.sp[!is.na(soildmD79.sp$T),])
>> g <- gstat(g, id = "GMD", formula = GMD ~ 1, data =
>> soildmD79.sp[!is.na(soildmD79.sp$GMD),])
>> g <- gstat(g, id = "vcover", formula = vcover ~ 1, data =
>> soildmD79.sp[!is.na(soildmD79.sp$vcover),])
>> g <- gstat(g, id = "mean_C", formula = mean_C~ 1, data =
>> soildmD79.sp[!is.na(soildmD79.sp$mean_C),])
>> g <- gstat(g, id = "biomass", formula = biomass ?~ 1, data =
>> soildmD79.sp[!is.na(soildmD79.sp$biomass),])
>> png(file = "sm_soilparamter_cross_20-06-2005.png", width = 1400, height =
>> 1000, bg = "white", res = 100)
>> plot(variogram(g), main = "Cross variograms Soil moisture and stable soil
>> parameters", sub="20/06/2005")
>>
>> Error: dimensions do not match: locations 200 and data 96
>>
>> This message occurs due to 100 x,y coordinate pairs and 96 values for the
>> variable soil moisture.
>> Even though the function contains already "data =
>> soildmD79.sp[!is.na(soildmD79.sp$BD),]" the missing values still cause an
>> error.
>>
>> Thanks for any suggestions or comments,
>> Friederike
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From Friederike.Gerschlauer at agrar.uni-giessen.de  Tue Dec  1 12:53:40 2009
From: Friederike.Gerschlauer at agrar.uni-giessen.de (Friederike.Gerschlauer at agrar.uni-giessen.de)
Date: Tue, 01 Dec 2009 12:53:40 +0100
Subject: [R-sig-Geo] missing values in gstat for R
In-Reply-To: <4B14F53A.4060702@geo.uu.nl>
References: <20091201102249.11346c5uifajvjoc@horde.hrz.uni-giessen.de>
	<4B14F53A.4060702@geo.uu.nl>
Message-ID: <20091201125340.554748kk3sgh3m4g@horde.hrz.uni-giessen.de>

Hi Jon,

that's what I tried before, but unfortunately left the date out.

After adding
[!is.na(soildmD79.sp$smoist.20.06.2005),]
it is working now.

Thanks for your response.

Cheers
Friederike


Zitat von Jon Olav Skoien <j.skoien at geo.uu.nl>:

> Hi Friederike,
>
> For which variable do you have NAs? If soil moisture is sm, you are  
> missing in the first line:
> [!is.na(soildmD79.sp$smoist.20.06.2005),]
>
> If that is not the problem, it would be helpful if you sent a  
> reproducible example.
>
> Cheers,
> Jon
>
> Friederike.Gerschlauer at agrar.uni-giessen.de wrote:
>> Dear list,
>>
>> I am having problems with dealing with missing values in gstat  
>> computing a semivariogram.
>>
>> I am using R 2.9.1, gstat 0.9-64 on Windows Vista.
>>
>> I get the following error message:
>>
>> g <- gstat(id = "sm", formula = smoist.20.06.2005 ~ 1, data = soildmD79.sp)
>> g <- gstat(g, id = "bd", formula = BD ~ 1, data =  
>> soildmD79.sp[!is.na(soildmD79.sp$BD),])
>> g <- gstat(g, id = "S", formula = S ~ 1, data =  
>> soildmD79.sp[!is.na(soildmD79.sp$S),])
>> g <- gstat(g, id = "U", formula = U ~ 1, data =  
>> soildmD79.sp[!is.na(soildmD79.sp$U),])
>> g <- gstat(g, id = "T", formula = T ~ 1, data =  
>> soildmD79.sp[!is.na(soildmD79.sp$T),])
>> g <- gstat(g, id = "GMD", formula = GMD ~ 1, data =  
>> soildmD79.sp[!is.na(soildmD79.sp$GMD),])
>> g <- gstat(g, id = "vcover", formula = vcover ~ 1, data =  
>> soildmD79.sp[!is.na(soildmD79.sp$vcover),])
>> g <- gstat(g, id = "mean_C", formula = mean_C~ 1, data =  
>> soildmD79.sp[!is.na(soildmD79.sp$mean_C),])
>> g <- gstat(g, id = "biomass", formula = biomass  ~ 1, data =  
>> soildmD79.sp[!is.na(soildmD79.sp$biomass),])
>> png(file = "sm_soilparamter_cross_20-06-2005.png", width = 1400,  
>> height = 1000, bg = "white", res = 100)
>> plot(variogram(g), main = "Cross variograms Soil moisture and  
>> stable soil parameters", sub="20/06/2005")
>>
>> Error: dimensions do not match: locations 200 and data 96
>>
>> This message occurs due to 100 x,y coordinate pairs and 96 values  
>> for the variable soil moisture.
>> Even though the function contains already "data =  
>> soildmD79.sp[!is.na(soildmD79.sp$BD),]" the missing values still  
>> cause an error.
>>
>> Thanks for any suggestions or comments,
>> Friederike
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>


From karl at huftis.org  Tue Dec  1 13:11:28 2009
From: karl at huftis.org (Karl Ove Hufthammer)
Date: Tue, 1 Dec 2009 13:11:28 +0100
Subject: [R-sig-Geo] 'xyValues' from 'raster' package slow
Message-ID: <MPG.257f26584a2eaee69896bb@news.gmane.org>

Dear list members

I'm using the 'raster' package to load a rather large (~2 GB) file of 
bathymetry data. To extract elevation/depth data for various positions, 
I use the 'xyValues' function.

However, it turns that this operations is extremely slow for extracting 
a even moderately large number of values. Here is in essence my code:

r = raster("file.ers")
x = seq(0, 20, length = 100)
y = seq(55, 70, length = 100)
xy = expand.grid(x, y)
z = xyValues(r, xy)

Am I doing something wrong here? Using 'readBin' or 'readBinFragments' 
on the same file, to extract the same values, takes almost no time. But 
then I have to calculate the indices, positions &c. myself, which is 
tedious and easy get wrong (having to take into account half-pixel 
shifts and other details). 

Using Rprof indicates that a lot of 'self.time' is taken up by 'gc' (and 
'=='), which does sound a bit strange.

-- 
Karl Ove Hufthammer


From r.hijmans at gmail.com  Tue Dec  1 19:29:52 2009
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Tue, 1 Dec 2009 10:29:52 -0800
Subject: [R-sig-Geo] 'xyValues' from 'raster' package slow
In-Reply-To: <MPG.257f26584a2eaee69896bb@news.gmane.org>
References: <MPG.257f26584a2eaee69896bb@news.gmane.org>
Message-ID: <dc22b2570912011029q7fe2ba2cua8139b4425ae1cdc@mail.gmail.com>

Dear Karl,

I agree that xyValues is not very fast; I can probably speed it up a
bit (there can be a lot of '==' in there, I do not know where all the
gc()s comes from), but for now here are some suggestions:

# given
x = seq(0, 20, length = 100)
y = seq(55, 70, length = 100)
xy = expand.grid(x, y)

# reading all values into memory first will speed things up
# but this may not be feasible (memory wise):
r = raster("file.ers", values=TRUE)
z = xyValues(r, xy)

An alternative, assuming that what you want is all values for a
rectangular area (I cannot determine that from the example).
r = raster("file.ers")
sr <- rowFromY(r, min(x))
er <- rowFromY(r, max(x))
nr <- er-sr+1
sc <- colFromX(r, min(y))
ec <- colFromX(r, max(y))
r <- readBlock(r, sr, nr, sc, ec)
z <- values(r)

## Or this (same assumption; but much less verbose):
r = raster("file.ers")
rr <- crop(r, extent(min(x), max(x), min(y), max(y)))
z <- values(rr)

# If you do not want all the values for the rectangle, it could still be
# quicker to do the above,  followed by xyValues,
# under the assumption that rr is small enough to keep all values
# in memory while r was not.

r = raster("file.ers")
rr <- crop(r, extent(min(x), max(x), min(y), max(y)))
z = xyValues(rr, xy)


Hope this helps,
Robert

On Tue, Dec 1, 2009 at 4:11 AM, Karl Ove Hufthammer <karl at huftis.org> wrote:
> Dear list members
>
> I'm using the 'raster' package to load a rather large (~2 GB) file of
> bathymetry data. To extract elevation/depth data for various positions,
> I use the 'xyValues' function.
>
> However, it turns that this operations is extremely slow for extracting
> a even moderately large number of values. Here is in essence my code:
>
> r = raster("file.ers")
> x = seq(0, 20, length = 100)
> y = seq(55, 70, length = 100)
> xy = expand.grid(x, y)
> z = xyValues(r, xy)
>
> Am I doing something wrong here? Using 'readBin' or 'readBinFragments'
> on the same file, to extract the same values, takes almost no time. But
> then I have to calculate the indices, positions &c. myself, which is
> tedious and easy get wrong (having to take into account half-pixel
> shifts and other details).
>
> Using Rprof indicates that a lot of 'self.time' is taken up by 'gc' (and
> '=='), which does sound a bit strange.
>
> --
> Karl Ove Hufthammer
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From Greg.Snow at imail.org  Tue Dec  1 19:36:11 2009
From: Greg.Snow at imail.org (Greg Snow)
Date: Tue, 1 Dec 2009 11:36:11 -0700
Subject: [R-sig-Geo] plotting vector of direction magnitude
In-Reply-To: <4B12F65D.9070200@ucdavis.edu>
References: <4B12F65D.9070200@ucdavis.edu>
Message-ID: <B37C0A15B8FB3C468B5BC7EBC7DA14CC62F7109C07@LP-EXMBVS10.CO.IHC.COM>

You may find the my.symbols and ms.arrows functions in the TeachingDemos package useful.

-- 
Gregory (Greg) L. Snow Ph.D.
Statistical Data Center
Intermountain Healthcare
greg.snow at imail.org
801.408.8111


> -----Original Message-----
> From: r-sig-geo-bounces at stat.math.ethz.ch [mailto:r-sig-geo-
> bounces at stat.math.ethz.ch] On Behalf Of Sam Veloz
> Sent: Sunday, November 29, 2009 3:32 PM
> To: r-sig-geo at stat.math.ethz.ch
> Subject: [R-sig-Geo] plotting vector of direction magnitude
> 
> I have a file of points with x/y coordinates and columns for bearing
> and
> distance. I would like to make a plot where each point is depicted by
> an
> arrow and the direction the arrow points is based on the value of
> bearing and the length of the arrow is based on the value of distance.
> Any suggestions on how to do this would be greatly appreciated.
> Thanks,
> Sam
> 
> --
> ****************************************************
> Sam Veloz
> Postdoctoral Researcher
> Department of Environmental Science and Policy
> University of California, Davis
> sdveloz at ucdavis.edu
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From pierces1 at msu.edu  Tue Dec  1 20:15:37 2009
From: pierces1 at msu.edu (Steven J. Pierce)
Date: Tue, 1 Dec 2009 14:15:37 -0500
Subject: [R-sig-Geo] Analyzing large, longitudinal raster dataset
Message-ID: <25E9E50D09314CADB30697D6142CCFBD@TheVoid>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20091201/5d8a512b/attachment.pl>

From r.hijmans at gmail.com  Tue Dec  1 22:14:33 2009
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Tue, 1 Dec 2009 13:14:33 -0800
Subject: [R-sig-Geo] 'xyValues' from 'raster' package slow
In-Reply-To: <dc22b2570912011029q7fe2ba2cua8139b4425ae1cdc@mail.gmail.com>
References: <MPG.257f26584a2eaee69896bb@news.gmane.org>
	<dc22b2570912011029q7fe2ba2cua8139b4425ae1cdc@mail.gmail.com>
Message-ID: <dc22b2570912011314la5d727wed926f53f900d91b@mail.gmail.com>

Karl and others: There is a new version of xyValues (in raster version
0.9.8-31)  that --in a single test-- is 30 times faster then the
previous version (for files read with rgdal; I have not yet updated
the function for the 'native formats'). Robert

On Tue, Dec 1, 2009 at 10:29 AM, Robert J. Hijmans <r.hijmans at gmail.com> wrote:
> Dear Karl,
>
> I agree that xyValues is not very fast; I can probably speed it up a
> bit (there can be a lot of '==' in there, I do not know where all the
> gc()s comes from), but for now here are some suggestions:
>
> # given
> x = seq(0, 20, length = 100)
> y = seq(55, 70, length = 100)
> xy = expand.grid(x, y)
>
> # reading all values into memory first will speed things up
> # but this may not be feasible (memory wise):
> r = raster("file.ers", values=TRUE)
> z = xyValues(r, xy)
>
> An alternative, assuming that what you want is all values for a
> rectangular area (I cannot determine that from the example).
> r = raster("file.ers")
> sr <- rowFromY(r, min(x))
> er <- rowFromY(r, max(x))
> nr <- er-sr+1
> sc <- colFromX(r, min(y))
> ec <- colFromX(r, max(y))
> r <- readBlock(r, sr, nr, sc, ec)
> z <- values(r)
>
> ## Or this (same assumption; but much less verbose):
> r = raster("file.ers")
> rr <- crop(r, extent(min(x), max(x), min(y), max(y)))
> z <- values(rr)
>
> # If you do not want all the values for the rectangle, it could still be
> # quicker to do the above, ?followed by xyValues,
> # under the assumption that rr is small enough to keep all values
> # in memory while r was not.
>
> r = raster("file.ers")
> rr <- crop(r, extent(min(x), max(x), min(y), max(y)))
> z = xyValues(rr, xy)
>
>
> Hope this helps,
> Robert
>
> On Tue, Dec 1, 2009 at 4:11 AM, Karl Ove Hufthammer <karl at huftis.org> wrote:
>> Dear list members
>>
>> I'm using the 'raster' package to load a rather large (~2 GB) file of
>> bathymetry data. To extract elevation/depth data for various positions,
>> I use the 'xyValues' function.
>>
>> However, it turns that this operations is extremely slow for extracting
>> a even moderately large number of values. Here is in essence my code:
>>
>> r = raster("file.ers")
>> x = seq(0, 20, length = 100)
>> y = seq(55, 70, length = 100)
>> xy = expand.grid(x, y)
>> z = xyValues(r, xy)
>>
>> Am I doing something wrong here? Using 'readBin' or 'readBinFragments'
>> on the same file, to extract the same values, takes almost no time. But
>> then I have to calculate the indices, positions &c. myself, which is
>> tedious and easy get wrong (having to take into account half-pixel
>> shifts and other details).
>>
>> Using Rprof indicates that a lot of 'self.time' is taken up by 'gc' (and
>> '=='), which does sound a bit strange.
>>
>> --
>> Karl Ove Hufthammer
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>


From milton.ruser at gmail.com  Tue Dec  1 22:59:37 2009
From: milton.ruser at gmail.com (milton ruser)
Date: Tue, 1 Dec 2009 16:59:37 -0500
Subject: [R-sig-Geo] Analyzing large, longitudinal raster dataset
In-Reply-To: <25E9E50D09314CADB30697D6142CCFBD@TheVoid>
References: <25E9E50D09314CADB30697D6142CCFBD@TheVoid>
Message-ID: <3aaf1a030912011359i489f1381s50e1500c3db29cb6@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20091201/3f380a55/attachment.pl>

From j.skoien at geo.uu.nl  Wed Dec  2 09:54:27 2009
From: j.skoien at geo.uu.nl (Jon Olav Skoien)
Date: Wed, 02 Dec 2009 09:54:27 +0100
Subject: [R-sig-Geo] optimizeNetwork function in intamapInteractive
 package (how to use	auxiliary predictors)
In-Reply-To: <20091116104959.ift0004dcgs88gc4@spatial-analyst.net>
References: <20091116104959.ift0004dcgs88gc4@spatial-analyst.net>
Message-ID: <4B162B43.8090703@geo.uu.nl>

Hi Tom,

it is great that you like the intamap-packages!
The optimization function could not use auxiliary predictors properly in 
the version you tested, but there is now a new version on CRAN (it might 
take some time before it is distributed) where it is possible to do what 
you ask for.

Please note that there is an approximation in the function for 
estimating the optimization criteria. It is in this implementation 
necessary to know the auxiliary variables at the candidate locations, 
and these are estimated from the prediction grid. This should for most 
applications only have a minor effect.

There is an example in the documentation of optimizeNetwork.

Cheers,
Jon

Tomislav Hengl wrote:
>
> Dear Edzer, Jon, Stephanie, Olivier et al.,
>
> First, let me congratulate you on your new package intamap / 
> intamapInteractive that I feel will significantly advance practice of 
> geostatistical mapping. Really a great contribution (I knew about SSA 
> already in 2000, but was always lacking an operational tool).
>
> My interest at the moment are the sampling optimization algorithms and 
> their use in combination with universal kriging / regression-kriging. 
> I had no problems to run spatially simulated annealing with your 
> package (OK model), but could not grasp how to do the same thing using 
> a universal kriging model (auxiliary predictors). Here is the code:
>
>> library(gstat)
>> library(RSAGA)
>> library(maptools)
>> library(intamapInteractive)
>
> # load data:
>> data(meuse)
>> coordinates(meuse) <- ~x+y
>> data(meuse.grid)
>> coordinates(meuse.grid) <- ~x+y
>> gridded(meuse.grid) <- TRUE
>
> # estimate variograms (OK/UK):
>> vt.fit <- fit.variogram(variogram(log1p(zinc)~1, meuse), vgm(1, 
>> "Exp", 300, 1))
>> vr.fit <- fit.variogram(variogram(log1p(zinc)~sqrt(dist), meuse), 
>> vgm(1, "Exp", 300, 1))
>
> # study area of interest:
>> write.asciigrid(meuse.grid["mask"], "meuse_mask.asc")
>> rsaga.esri.to.sgrd(in.grids="meuse_mask.asc", 
>> out.sgrd="meuse_mask.sgrd", in.path=getwd())
> # raster to polygon conversion;
>> rsaga.geoprocessor(lib="shapes_grid", module=6, 
>> param=list(GRID="meuse_mask.sgrd", SHAPES="meuse_mask.shp", 
>> CLASS_ALL=1))
>> mask <- readShapePoly("meuse_mask.shp", 
>> proj4string=CRS(as.character(NA)), force_ring=T)
>
> # prepare observations / predGrid objects:
>> observations <- meuse["zinc"]
>> attr(observations at coords, "dimnames")[[2]] <- c("x", "y")
>> predGrid <- data.frame(meuse.grid["dist"])
>> predGrid$dist <- NULL  # predGrid has to be "SpatialPoints" type?
>> coordinates(predGrid) <- ~x+y
> windows()
> # add 20 more points assuming OK model (SSA method):
>> optim.ok <- optimizeNetwork(observations, predGrid, candidates=mask, 
>> method="ssa", action="add", nDiff=20, model=vt.fit, criterion="MUKV", 
>> plot=FALSE, nr_iterations=50, nmax=40)
>
> This works fine. But how do I now optimize samples using universal 
> kriging model (with auxiliary predictors e.g. "dist")? I simply could 
> not figure out from your examples. I also tried looking at the Package 
> source R functions, but could not get it running.
>
> It should be something like this:
>
>> observations <- pts.ov[c("zinc", "dist")]
>> predGrid <- data.frame(meuse.grid["dist"])
>> coordinates(predGrid) <- ~x+y
>> optim.rk <- optimizeNetwork(observations, predGrid, candidates=mask, 
>> method="ssa", action="add", nDiff=20, model=vr.fit, criterion="MUKV", 
>> plot=FALSE, nr_iterations=50, formula=log1p(zinc)~sqrt(dist), nmax=40)
>
>
> thanks!
>
> Tom Hengl
> http://home.medewerker.uva.nl/t.hengl/
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From alison.johnston at bto.org  Wed Dec  2 12:12:46 2009
From: alison.johnston at bto.org (Alison Johnston)
Date: Wed, 2 Dec 2009 11:12:46 -0000
Subject: [R-sig-Geo] grasp?
Message-ID: <9F3514086E47447592BAA256877D0A94@btodomain.bto.org>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20091202/4e4ef558/attachment.pl>

From andre.schuetzenmeister at uni-hohenheim.de  Wed Dec  2 12:32:31 2009
From: andre.schuetzenmeister at uni-hohenheim.de (=?iso-8859-1?Q?Andre_Sch=FCtzenmeister?=)
Date: Wed, 2 Dec 2009 12:32:31 +0100
Subject: [R-sig-Geo] geoR: error fitting a linear model
Message-ID: <003901ca7343$22a2d420$34882990@pflanzenbau.unihohenheim.de>

Hi All,

Does anybody know how to fit a linear model to an empirical semivariogram?
Something just does not work out.

I have tried this:

# generate data

> grid <- expand.grid(1:10,1:10)[,2:1]
> z <- grid[,1]*grid[,2]*rnorm(100,20,5)
> grid <- cbind(grid,z)
> colnames(grid) <- c("X","Y","Z")

# compute empirical semivariogram

> esvg <- variog(coords=grid[,c("X","Y")], data=grid[,"Z"],
breaks=seq(.5,10,.5) )

# fit exponential model to 'esvg'

> exp_mod <- variofit(esvg, cov.model="exp", ini.cov.pars=c(8e5,10),
nugget=1e5)

> exp_mod
variofit: model parameters estimated by WLS (weighted least squares):
covariance model is: exponential
parameter estimates:
      tausq     sigmasq         phi 
     0.0000 803538.4015     13.3603 
Practical Range with cor=0.05 for asymptotic range: 40.02385

variofit: minimised weighted sum of squares = 3.559216e+13

# fit linear model to 'esvg', and an error occurs

> exp_mod <- variofit(esvg, cov.model="lin", ini.cov.pars=c(8e5,0),
nugget=1e5)

Error in uniroot(findRange, interval = c(0, 50 * phi + 1), cm = cov.model,
: 
  f() values at end points not of opposite sign

I would appreciate any help. Thanks in advance.

Andre


From seanpor at acm.org  Wed Dec  2 15:56:51 2009
From: seanpor at acm.org (Sean O'Riordain)
Date: Wed, 2 Dec 2009 14:56:51 +0000
Subject: [R-sig-Geo] combining polygons from shapefiles...
Message-ID: <8ed68eed0912020656k913f174pa1d5f3ed69d6b57b@mail.gmail.com>

Good afternoon,

I've been making good progress in the last few weeks thanks to this
list, along with Roger and Adrians' books and some great geo-packages.

I'm trying to combine some shapefiles...

library(maptools)
CA <- readShapePoly('ca.shp')
LA <- readShapePoly('la.shp')

Now I want to combine these two into a bigger object...

I've searched the books and the internet and I've tried a number of
things... including...

> class(LA)
[1] "SpatialPolygonsDataFrame"
attr(,"package")
[1] "sp"
> class(CA)
[1] "SpatialPolygonsDataFrame"
attr(,"package")
[1] "sp"
>
>     S1 <- unionSpatialPolygons(CA, LA)
Loading required package: gpclib
General Polygon Clipper Library for R (version 1.4-4)
        Type 'class ? gpc.poly' for help

Error in unionSpatialPolygons(CA, LA) : input lengths differ
>
>
> S1 <- spRbind(CA, LA)
Error in spRbind(as(obj, "SpatialPolygons"), as(x, "SpatialPolygons")) :
  non-unique polygon IDs
>

Any ideas please?

Thanks in advance!
Sean


From Roger.Bivand at nhh.no  Wed Dec  2 16:07:58 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 2 Dec 2009 16:07:58 +0100 (CET)
Subject: [R-sig-Geo] combining polygons from shapefiles...
In-Reply-To: <8ed68eed0912020656k913f174pa1d5f3ed69d6b57b@mail.gmail.com>
References: <8ed68eed0912020656k913f174pa1d5f3ed69d6b57b@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.0912021559340.11432@reclus.nhh.no>

On Wed, 2 Dec 2009, Sean O'Riordain wrote:

> Good afternoon,
>
> I've been making good progress in the last few weeks thanks to this
> list, along with Roger and Adrians' books and some great geo-packages.
>
> I'm trying to combine some shapefiles...
>
> library(maptools)
> CA <- readShapePoly('ca.shp')
> LA <- readShapePoly('la.shp')
>
> Now I want to combine these two into a bigger object...
>
> I've searched the books and the internet and I've tried a number of
> things... including...
>
>> class(LA)
> [1] "SpatialPolygonsDataFrame"
> attr(,"package")
> [1] "sp"
>> class(CA)
> [1] "SpatialPolygonsDataFrame"
> attr(,"package")
> [1] "sp"
>>
>>     S1 <- unionSpatialPolygons(CA, LA)
> Loading required package: gpclib
> General Polygon Clipper Library for R (version 1.4-4)
>        Type 'class ? gpc.poly' for help
>
> Error in unionSpatialPolygons(CA, LA) : input lengths differ
>>
>>
>> S1 <- spRbind(CA, LA)
> Error in spRbind(as(obj, "SpatialPolygons"), as(x, "SpatialPolygons")) :
>  non-unique polygon IDs
>>

Correct. Look at row.names(CA) and row.names(LA). Do something of your 
choice to disambiguate them and re-assign with spChFIDs() - since you 
refer to the ASDAR book, there is an example in chapter 5, sections 5.4 & 
5.5, pp. 120-126. You'll also see that your reading of how to use 
unionSpatialPolygons() did not agree with that in the function, which is 
to dissolve Polygons objects within an existing SpatialPolygons object.

Hope this helps,

Roger

>
> Any ideas please?
>
> Thanks in advance!
> Sean
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From seanpor at acm.org  Wed Dec  2 16:18:44 2009
From: seanpor at acm.org (Sean O'Riordain)
Date: Wed, 2 Dec 2009 15:18:44 +0000
Subject: [R-sig-Geo] combining polygons from shapefiles...
In-Reply-To: <alpine.LRH.2.00.0912021559340.11432@reclus.nhh.no>
References: <8ed68eed0912020656k913f174pa1d5f3ed69d6b57b@mail.gmail.com>
	<alpine.LRH.2.00.0912021559340.11432@reclus.nhh.no>
Message-ID: <8ed68eed0912020718i42a5f104wcb1c29247df45d1a@mail.gmail.com>

Thanks Roger,

> head(row.names(LA))
[1] "0" "1" "2" "3" "4" "5"
> head(row.names(CA))
[1] "0" "1" "2" "3" "4" "5"
>

I'll have a look at these and get back with my results.

Kind regards,
Sean


On Wed, Dec 2, 2009 at 3:07 PM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
> On Wed, 2 Dec 2009, Sean O'Riordain wrote:
>
>> Good afternoon,
>>
>> I've been making good progress in the last few weeks thanks to this
>> list, along with Roger and Adrians' books and some great geo-packages.
>>
>> I'm trying to combine some shapefiles...
>>
>> library(maptools)
>> CA <- readShapePoly('ca.shp')
>> LA <- readShapePoly('la.shp')
>>
>> Now I want to combine these two into a bigger object...
>>
>> I've searched the books and the internet and I've tried a number of
>> things... including...
>>
>>> class(LA)
>>
>> [1] "SpatialPolygonsDataFrame"
>> attr(,"package")
>> [1] "sp"
>>>
>>> class(CA)
>>
>> [1] "SpatialPolygonsDataFrame"
>> attr(,"package")
>> [1] "sp"
>>>
>>> ? ?S1 <- unionSpatialPolygons(CA, LA)
>>
>> Loading required package: gpclib
>> General Polygon Clipper Library for R (version 1.4-4)
>> ? ? ? Type 'class ? gpc.poly' for help
>>
>> Error in unionSpatialPolygons(CA, LA) : input lengths differ
>>>
>>>
>>> S1 <- spRbind(CA, LA)
>>
>> Error in spRbind(as(obj, "SpatialPolygons"), as(x, "SpatialPolygons")) :
>> ?non-unique polygon IDs
>>>
>
> Correct. Look at row.names(CA) and row.names(LA). Do something of your
> choice to disambiguate them and re-assign with spChFIDs() - since you refer
> to the ASDAR book, there is an example in chapter 5, sections 5.4 & 5.5, pp.
> 120-126. You'll also see that your reading of how to use
> unionSpatialPolygons() did not agree with that in the function, which is to
> dissolve Polygons objects within an existing SpatialPolygons object.
>
> Hope this helps,
>
> Roger
>
>>
>> Any ideas please?
>>
>> Thanks in advance!
>> Sean
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> --
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>
>


From seanpor at acm.org  Wed Dec  2 17:55:45 2009
From: seanpor at acm.org (Sean O'Riordain)
Date: Wed, 2 Dec 2009 16:55:45 +0000
Subject: [R-sig-Geo] combining polygons from shapefiles...
In-Reply-To: <8ed68eed0912020718i42a5f104wcb1c29247df45d1a@mail.gmail.com>
References: <8ed68eed0912020656k913f174pa1d5f3ed69d6b57b@mail.gmail.com>
	<alpine.LRH.2.00.0912021559340.11432@reclus.nhh.no>
	<8ed68eed0912020718i42a5f104wcb1c29247df45d1a@mail.gmail.com>
Message-ID: <8ed68eed0912020855x3af8ccbev9d15def27154b7e3@mail.gmail.com>

Hello again,

I've tried
    new.refs.for.CA <-
as.character(seq(from=max(as.numeric(row.names(LA)))+1,length=nrow(CA)))
# which takes about 0.15 secs...
    ca1 <- spChFIDs(CA, new.refs.for.CA)
# has been running now for more than 48 minutes (or at least 48 mins
CPU on this winbox)  is this right?
# It was running for about 15minutes and then I tried restarting it in
a cleaner
# environment... but it's still taking *ages*
#
# it was my intention then of saying
    S1 <- spRbind(LA, ca1)

but both LA and CA have about 12,000 rows... and it's been running now
for quite a few minutes and I'm surprised it hasn't finished... is
this "normal" ?

Thanks,
Sean


On Wed, Dec 2, 2009 at 3:18 PM, Sean O'Riordain <seanpor at acm.org> wrote:
> Thanks Roger,
>
>> head(row.names(LA))
> [1] "0" "1" "2" "3" "4" "5"
>> head(row.names(CA))
> [1] "0" "1" "2" "3" "4" "5"
>>
>
> I'll have a look at these and get back with my results.
>
> Kind regards,
> Sean
>
>
> On Wed, Dec 2, 2009 at 3:07 PM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
>> On Wed, 2 Dec 2009, Sean O'Riordain wrote:
>>
>>> Good afternoon,
>>>
>>> I've been making good progress in the last few weeks thanks to this
>>> list, along with Roger and Adrians' books and some great geo-packages.
>>>
>>> I'm trying to combine some shapefiles...
>>>
>>> library(maptools)
>>> CA <- readShapePoly('ca.shp')
>>> LA <- readShapePoly('la.shp')
>>>
>>> Now I want to combine these two into a bigger object...
>>>
>>> I've searched the books and the internet and I've tried a number of
>>> things... including...
>>>
>>>> class(LA)
>>>
>>> [1] "SpatialPolygonsDataFrame"
>>> attr(,"package")
>>> [1] "sp"
>>>>
>>>> class(CA)
>>>
>>> [1] "SpatialPolygonsDataFrame"
>>> attr(,"package")
>>> [1] "sp"
>>>>
>>>> ? ?S1 <- unionSpatialPolygons(CA, LA)
>>>
>>> Loading required package: gpclib
>>> General Polygon Clipper Library for R (version 1.4-4)
>>> ? ? ? Type 'class ? gpc.poly' for help
>>>
>>> Error in unionSpatialPolygons(CA, LA) : input lengths differ
>>>>
>>>>
>>>> S1 <- spRbind(CA, LA)
>>>
>>> Error in spRbind(as(obj, "SpatialPolygons"), as(x, "SpatialPolygons")) :
>>> ?non-unique polygon IDs
>>>>
>>
>> Correct. Look at row.names(CA) and row.names(LA). Do something of your
>> choice to disambiguate them and re-assign with spChFIDs() - since you refer
>> to the ASDAR book, there is an example in chapter 5, sections 5.4 & 5.5, pp.
>> 120-126. You'll also see that your reading of how to use
>> unionSpatialPolygons() did not agree with that in the function, which is to
>> dissolve Polygons objects within an existing SpatialPolygons object.
>>
>> Hope this helps,
>>
>> Roger
>>
>>>
>>> Any ideas please?
>>>
>>> Thanks in advance!
>>> Sean
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>> --
>> Roger Bivand
>> Economic Geography Section, Department of Economics, Norwegian School of
>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>> e-mail: Roger.Bivand at nhh.no
>>
>>
>


From Roger.Bivand at nhh.no  Wed Dec  2 18:35:27 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 2 Dec 2009 18:35:27 +0100 (CET)
Subject: [R-sig-Geo] combining polygons from shapefiles...
In-Reply-To: <8ed68eed0912020855x3af8ccbev9d15def27154b7e3@mail.gmail.com>
References: <8ed68eed0912020656k913f174pa1d5f3ed69d6b57b@mail.gmail.com>
	<alpine.LRH.2.00.0912021559340.11432@reclus.nhh.no>
	<8ed68eed0912020718i42a5f104wcb1c29247df45d1a@mail.gmail.com>
	<8ed68eed0912020855x3af8ccbev9d15def27154b7e3@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.0912021823190.11432@reclus.nhh.no>

On Wed, 2 Dec 2009, Sean O'Riordain wrote:

> Hello again,
>
> I've tried
>    new.refs.for.CA <-
> as.character(seq(from=max(as.numeric(row.names(LA)))+1,length=nrow(CA)))
> # which takes about 0.15 secs...
>    ca1 <- spChFIDs(CA, new.refs.for.CA)
> # has been running now for more than 48 minutes (or at least 48 mins
> CPU on this winbox)  is this right?
> # It was running for about 15minutes and then I tried restarting it in
> a cleaner
> # environment... but it's still taking *ages*
> #
> # it was my intention then of saying
>    S1 <- spRbind(LA, ca1)
>
> but both LA and CA have about 12,000 rows... and it's been running now
> for quite a few minutes and I'm surprised it hasn't finished... is
> this "normal" ?

It is only coded as a for loop in R, and shapefiles used in typical 
applications in R have at most hundreds of entities, although this size 
is encountered without substantial trouble. Timings may vary depending on 
object sizes too, if copying is involved internally.

This goes on the TODO list for coding in C.

Roger

>
> Thanks,
> Sean
>
>
> On Wed, Dec 2, 2009 at 3:18 PM, Sean O'Riordain <seanpor at acm.org> wrote:
>> Thanks Roger,
>>
>>> head(row.names(LA))
>> [1] "0" "1" "2" "3" "4" "5"
>>> head(row.names(CA))
>> [1] "0" "1" "2" "3" "4" "5"
>>>
>>
>> I'll have a look at these and get back with my results.
>>
>> Kind regards,
>> Sean
>>
>>
>> On Wed, Dec 2, 2009 at 3:07 PM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
>>> On Wed, 2 Dec 2009, Sean O'Riordain wrote:
>>>
>>>> Good afternoon,
>>>>
>>>> I've been making good progress in the last few weeks thanks to this
>>>> list, along with Roger and Adrians' books and some great geo-packages.
>>>>
>>>> I'm trying to combine some shapefiles...
>>>>
>>>> library(maptools)
>>>> CA <- readShapePoly('ca.shp')
>>>> LA <- readShapePoly('la.shp')
>>>>
>>>> Now I want to combine these two into a bigger object...
>>>>
>>>> I've searched the books and the internet and I've tried a number of
>>>> things... including...
>>>>
>>>>> class(LA)
>>>>
>>>> [1] "SpatialPolygonsDataFrame"
>>>> attr(,"package")
>>>> [1] "sp"
>>>>>
>>>>> class(CA)
>>>>
>>>> [1] "SpatialPolygonsDataFrame"
>>>> attr(,"package")
>>>> [1] "sp"
>>>>>
>>>>> ? ?S1 <- unionSpatialPolygons(CA, LA)
>>>>
>>>> Loading required package: gpclib
>>>> General Polygon Clipper Library for R (version 1.4-4)
>>>> ? ? ? Type 'class ? gpc.poly' for help
>>>>
>>>> Error in unionSpatialPolygons(CA, LA) : input lengths differ
>>>>>
>>>>>
>>>>> S1 <- spRbind(CA, LA)
>>>>
>>>> Error in spRbind(as(obj, "SpatialPolygons"), as(x, "SpatialPolygons")) :
>>>> ?non-unique polygon IDs
>>>>>
>>>
>>> Correct. Look at row.names(CA) and row.names(LA). Do something of your
>>> choice to disambiguate them and re-assign with spChFIDs() - since you refer
>>> to the ASDAR book, there is an example in chapter 5, sections 5.4 & 5.5, pp.
>>> 120-126. You'll also see that your reading of how to use
>>> unionSpatialPolygons() did not agree with that in the function, which is to
>>> dissolve Polygons objects within an existing SpatialPolygons object.
>>>
>>> Hope this helps,
>>>
>>> Roger
>>>
>>>>
>>>> Any ideas please?
>>>>
>>>> Thanks in advance!
>>>> Sean
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at stat.math.ethz.ch
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>
>>> --
>>> Roger Bivand
>>> Economic Geography Section, Department of Economics, Norwegian School of
>>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>>> e-mail: Roger.Bivand at nhh.no
>>>
>>>
>>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From seanpor at acm.org  Wed Dec  2 19:11:00 2009
From: seanpor at acm.org (Sean O'Riordain)
Date: Wed, 2 Dec 2009 18:11:00 +0000
Subject: [R-sig-Geo] combining polygons from shapefiles...
In-Reply-To: <alpine.LRH.2.00.0912021823190.11432@reclus.nhh.no>
References: <8ed68eed0912020656k913f174pa1d5f3ed69d6b57b@mail.gmail.com>
	<alpine.LRH.2.00.0912021559340.11432@reclus.nhh.no>
	<8ed68eed0912020718i42a5f104wcb1c29247df45d1a@mail.gmail.com>
	<8ed68eed0912020855x3af8ccbev9d15def27154b7e3@mail.gmail.com>
	<alpine.LRH.2.00.0912021823190.11432@reclus.nhh.no>
Message-ID: <8ed68eed0912021011k812976bq926f05ce2c84467b@mail.gmail.com>

Thanks Roger,

The process was holding its' own in terms of process size - it seemed
to be about the same size for ages.

cheers,
Sean

On Wed, Dec 2, 2009 at 5:35 PM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
> On Wed, 2 Dec 2009, Sean O'Riordain wrote:
>
>> Hello again,
>>
>> I've tried
>> ? new.refs.for.CA <-
>> as.character(seq(from=max(as.numeric(row.names(LA)))+1,length=nrow(CA)))
>> # which takes about 0.15 secs...
>> ? ca1 <- spChFIDs(CA, new.refs.for.CA)
>> # has been running now for more than 48 minutes (or at least 48 mins
>> CPU on this winbox) ?is this right?
>> # It was running for about 15minutes and then I tried restarting it in
>> a cleaner
>> # environment... but it's still taking *ages*
>> #
>> # it was my intention then of saying
>> ? S1 <- spRbind(LA, ca1)
>>
>> but both LA and CA have about 12,000 rows... and it's been running now
>> for quite a few minutes and I'm surprised it hasn't finished... is
>> this "normal" ?
>
> It is only coded as a for loop in R, and shapefiles used in typical
> applications in R have at most hundreds of entities, although this size is
> encountered without substantial trouble. Timings may vary depending on
> object sizes too, if copying is involved internally.
>
> This goes on the TODO list for coding in C.
>
> Roger
>
>>
>> Thanks,
>> Sean
>>
>>
>> On Wed, Dec 2, 2009 at 3:18 PM, Sean O'Riordain <seanpor at acm.org> wrote:
>>>
>>> Thanks Roger,
>>>
>>>> head(row.names(LA))
>>>
>>> [1] "0" "1" "2" "3" "4" "5"
>>>>
>>>> head(row.names(CA))
>>>
>>> [1] "0" "1" "2" "3" "4" "5"
>>>>
>>>
>>> I'll have a look at these and get back with my results.
>>>
>>> Kind regards,
>>> Sean
>>>
>>>
>>> On Wed, Dec 2, 2009 at 3:07 PM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
>>>>
>>>> On Wed, 2 Dec 2009, Sean O'Riordain wrote:
>>>>
>>>>> Good afternoon,
>>>>>
>>>>> I've been making good progress in the last few weeks thanks to this
>>>>> list, along with Roger and Adrians' books and some great geo-packages.
>>>>>
>>>>> I'm trying to combine some shapefiles...
>>>>>
>>>>> library(maptools)
>>>>> CA <- readShapePoly('ca.shp')
>>>>> LA <- readShapePoly('la.shp')
>>>>>
>>>>> Now I want to combine these two into a bigger object...
>>>>>
>>>>> I've searched the books and the internet and I've tried a number of
>>>>> things... including...
>>>>>
>>>>>> class(LA)
>>>>>
>>>>> [1] "SpatialPolygonsDataFrame"
>>>>> attr(,"package")
>>>>> [1] "sp"
>>>>>>
>>>>>> class(CA)
>>>>>
>>>>> [1] "SpatialPolygonsDataFrame"
>>>>> attr(,"package")
>>>>> [1] "sp"
>>>>>>
>>>>>> ? ?S1 <- unionSpatialPolygons(CA, LA)
>>>>>
>>>>> Loading required package: gpclib
>>>>> General Polygon Clipper Library for R (version 1.4-4)
>>>>> ? ? ? Type 'class ? gpc.poly' for help
>>>>>
>>>>> Error in unionSpatialPolygons(CA, LA) : input lengths differ
>>>>>>
>>>>>>
>>>>>> S1 <- spRbind(CA, LA)
>>>>>
>>>>> Error in spRbind(as(obj, "SpatialPolygons"), as(x, "SpatialPolygons"))
>>>>> :
>>>>> ?non-unique polygon IDs
>>>>>>
>>>>
>>>> Correct. Look at row.names(CA) and row.names(LA). Do something of your
>>>> choice to disambiguate them and re-assign with spChFIDs() - since you
>>>> refer
>>>> to the ASDAR book, there is an example in chapter 5, sections 5.4 & 5.5,
>>>> pp.
>>>> 120-126. You'll also see that your reading of how to use
>>>> unionSpatialPolygons() did not agree with that in the function, which is
>>>> to
>>>> dissolve Polygons objects within an existing SpatialPolygons object.
>>>>
>>>> Hope this helps,
>>>>
>>>> Roger
>>>>
>>>>>
>>>>> Any ideas please?
>>>>>
>>>>> Thanks in advance!
>>>>> Sean
>>>>>
>>>>> _______________________________________________
>>>>> R-sig-Geo mailing list
>>>>> R-sig-Geo at stat.math.ethz.ch
>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>
>>>>
>>>> --
>>>> Roger Bivand
>>>> Economic Geography Section, Department of Economics, Norwegian School of
>>>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>>>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>>>> e-mail: Roger.Bivand at nhh.no
>>>>
>>>>
>>>
>>
>
> --
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>


From alobolistas at gmail.com  Wed Dec  2 22:38:44 2009
From: alobolistas at gmail.com (Agustin Lobo)
Date: Wed, 02 Dec 2009 22:38:44 +0100
Subject: [R-sig-Geo] raster() and projection
Message-ID: <4B16DE64.8070403@gmail.com>

Hi!

Why is it that when we "read" a raster i.e.
dem <- raster("/media/Transcend/MONTSENY2008/MONTSENY_GEODATA/mde10mny.tif")

(where the tif file is a geotif file with correct projection informatio)
we actually do not get the projection information?

 > projection(dem)
[1] "NA"

By now I solve it thanks to a SPDF:
 > delme <- 
readOGR(dsn="/media/Transcend/MONTSENY2008/MONTSENY_GEODATA/Limitparcplaespecial", 
layer="AmbitPlaEspecial")
 > projection(dem) <- projection(delme)

Am I doing something wrong?

Thanks

Agus


From r.hijmans at gmail.com  Wed Dec  2 22:55:04 2009
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Wed, 2 Dec 2009 13:55:04 -0800
Subject: [R-sig-Geo] raster() and projection
In-Reply-To: <4B16DE64.8070403@gmail.com>
References: <4B16DE64.8070403@gmail.com>
Message-ID: <dc22b2570912021355v4d6559dfl967af34ea30cb524@mail.gmail.com>

Hi Agus,

How do you know the tif file has correct information. It likely is not
something that gdal understands

Can you show:

raster("/media/Transcend/MONTSENY2008/MONTSENY_GEODATA/mde10mny.tif")

GDALinfo("/media/Transcend/MONTSENY2008/MONTSENY_GEODATA/mde10mny.tif")

and a command line gdalinfo to the same file?

Thanks, Robert


On Wed, Dec 2, 2009 at 1:38 PM, Agustin Lobo <alobolistas at gmail.com> wrote:
> Hi!
>
> Why is it that when we "read" a raster i.e.
> dem <- raster("/media/Transcend/MONTSENY2008/MONTSENY_GEODATA/mde10mny.tif")
>
> (where the tif file is a geotif file with correct projection informatio)
> we actually do not get the projection information?
>
>> projection(dem)
> [1] "NA"
>
> By now I solve it thanks to a SPDF:
>> delme <-
>> readOGR(dsn="/media/Transcend/MONTSENY2008/MONTSENY_GEODATA/Limitparcplaespecial",
>> layer="AmbitPlaEspecial")
>> projection(dem) <- projection(delme)
>
> Am I doing something wrong?
>
> Thanks
>
> Agus
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From horning at amnh.org  Thu Dec  3 17:54:11 2009
From: horning at amnh.org (Ned Horning)
Date: Thu, 03 Dec 2009 11:54:11 -0500
Subject: [R-sig-Geo] Problem using asc2spixdf in adehabitat package
Message-ID: <4B17ED33.4010602@amnh.org>

Hi - I have a script to calculate mahalanobis distance using the 
adehabitat package but I the output image is not the same size as the 
input image and I would like it to be the same. The georeferencing is 
fine so the input and output images line up when displayed in a GIS but 
the image dimensions of the output image are not the same. I use 
"sp_hsm_pard <- asc2spixdf(hsm_pard)" to convert an asc image object to 
a SpatialPixelsDataFrame object. When I type "str(hsm_pard) the result 
is: asc [1:900, 1:1650] but after running asc2spixdf the "sp_hsm_pard" 
object has cells.dim set to 769 1555 and I would expect it to be 900 
1650 since that is the dimension of the asc object.

I expect this is due to NAs in the input image but I haven't been able 
to figure out how create an output image with the same dimensions as the 
input image.

On a related topic, I tried to get information about the asc class using 
getClass("asc") but I get an error that "asc" is not a defined class. Is 
there another way to get information about a class?

Any insight would be appreciated.

All the best,

Ned


From ggl103 at psu.edu  Thu Dec  3 20:13:42 2009
From: ggl103 at psu.edu (GREGORY GERARD LUNA)
Date: Thu, 3 Dec 2009 14:13:42 -0500
Subject: [R-sig-Geo] Kriging
Message-ID: <1259867622l.786482l.0l@psu.edu>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20091203/ed267400/attachment.pl>

From alobolistas at gmail.com  Thu Dec  3 20:18:46 2009
From: alobolistas at gmail.com (Agustin Lobo)
Date: Thu, 03 Dec 2009 20:18:46 +0100
Subject: [R-sig-Geo] raster() and projection
In-Reply-To: <dc22b2570912021355v4d6559dfl967af34ea30cb524@mail.gmail.com>
References: <4B16DE64.8070403@gmail.com>
	<dc22b2570912021355v4d6559dfl967af34ea30cb524@mail.gmail.com>
Message-ID: <4B180F16.2020502@gmail.com>

You are right.
I was unjustifiably assuming that the projection info of the
raster was right just because I could display it in QGIS at
its right position, but...

$ gdalinfo -nomd mde10mny.tif
Driver: GTiff/GeoTIFF
Files: mde10mny.tif
        mde10mny.aux
        mde10mny.rrd
        mde10mny.tif.aux.xml
Size is 2788, 2333
Coordinate System is:
LOCAL_CS[" Geocoding information not available Projection Name = Unknown Units = 
other GeoTIFF Units = other",
     UNIT["unknown",1]]
Origin = (435926.940000000002328,4636392.540000000037253)
Pixel Size = (10.000000000000000,-10.000000000000000)
Corner Coordinates:
Upper Left  (  435926.940, 4636392.540)
Lower Left  (  435926.940, 4613062.540)
Upper Right (  463806.940, 4636392.540)
Lower Right (  463806.940, 4613062.540)
Center      (  449866.940, 4624727.540)
Band 1 Block=64x64 Type=Float32, ColorInterp=Gray
   Overviews: 697x584, 349x292, 175x146, 88x73, 44x37

Thanks

Agus

Robert J. Hijmans wrote:
> Hi Agus,
> 
> How do you know the tif file has correct information. It likely is not
> something that gdal understands
> 
> Can you show:
> 
> raster("/media/Transcend/MONTSENY2008/MONTSENY_GEODATA/mde10mny.tif")
> 
> GDALinfo("/media/Transcend/MONTSENY2008/MONTSENY_GEODATA/mde10mny.tif")
> 
> and a command line gdalinfo to the same file?
> 
> Thanks, Robert
> 
> 
> On Wed, Dec 2, 2009 at 1:38 PM, Agustin Lobo <alobolistas at gmail.com> wrote:
>> Hi!
>>
>> Why is it that when we "read" a raster i.e.
>> dem <- raster("/media/Transcend/MONTSENY2008/MONTSENY_GEODATA/mde10mny.tif")
>>
>> (where the tif file is a geotif file with correct projection informatio)
>> we actually do not get the projection information?
>>
>>> projection(dem)
>> [1] "NA"
>>
>> By now I solve it thanks to a SPDF:
>>> delme <-
>>> readOGR(dsn="/media/Transcend/MONTSENY2008/MONTSENY_GEODATA/Limitparcplaespecial",
>>> layer="AmbitPlaEspecial")
>>> projection(dem) <- projection(delme)
>> Am I doing something wrong?
>>
>> Thanks
>>
>> Agus
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>


From basille at biomserv.univ-lyon1.fr  Thu Dec  3 20:19:51 2009
From: basille at biomserv.univ-lyon1.fr (Mathieu Basille)
Date: Thu, 03 Dec 2009 14:19:51 -0500
Subject: [R-sig-Geo] Problem using asc2spixdf in adehabitat package
In-Reply-To: <4B17ED33.4010602@amnh.org>
References: <4B17ED33.4010602@amnh.org>
Message-ID: <4B180F57.3090405@biomserv.univ-lyon1.fr>

Hi Ned,

I'm not quite sure about your cell size problem. It appears to be quite
weird to me, and without the code and data, it's difficult to tell
(well, if I could tell anything at all with the code and data).

For the class 'asc', you can simply look at the help page (?asc), or
even better, to the pdf that comes with a typical installation of
adehabitat (somewhere in [packages folder]/adehabitat/doc/classes.pdf).
You will find all that you need on classes 'asc' and 'kasc', and many
other things about adehabitat.

Hope this helps a bit...
Mathieu.


Ned Horning a ?crit :
> Hi - I have a script to calculate mahalanobis distance using the
> adehabitat package but I the output image is not the same size as the
> input image and I would like it to be the same. The georeferencing is
> fine so the input and output images line up when displayed in a GIS but
> the image dimensions of the output image are not the same. I use
> "sp_hsm_pard <- asc2spixdf(hsm_pard)" to convert an asc image object to
> a SpatialPixelsDataFrame object. When I type "str(hsm_pard) the result
> is: asc [1:900, 1:1650] but after running asc2spixdf the "sp_hsm_pard"
> object has cells.dim set to 769 1555 and I would expect it to be 900
> 1650 since that is the dimension of the asc object.
> 
> I expect this is due to NAs in the input image but I haven't been able
> to figure out how create an output image with the same dimensions as the
> input image.
> 
> On a related topic, I tried to get information about the asc class using
> getClass("asc") but I get an error that "asc" is not a defined class. Is
> there another way to get information about a class?
> 
> Any insight would be appreciated.
> 
> All the best,
> 
> Ned
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 

~$ whoami
Mathieu Basille, Post-Doc

~$ locate
Laboratoire d'?cologie Comportementale et de Conservation de la Faune
+ Centre d'?tude de la For?t
D?partement de Biologie
Universit? Laval, Qu?bec

~$ info
http://ase-research.org/basille

~$ fortune
``If you can't win by reason, go for volume.''
Calvin, by Bill Watterson.


From j.skoien at geo.uu.nl  Fri Dec  4 11:26:05 2009
From: j.skoien at geo.uu.nl (Jon Olav Skoien)
Date: Fri, 04 Dec 2009 11:26:05 +0100
Subject: [R-sig-Geo] Kriging
In-Reply-To: <1259867622l.786482l.0l@psu.edu>
References: <1259867622l.786482l.0l@psu.edu>
Message-ID: <4B18E3BD.2060805@geo.uu.nl>

Hi Greg,

Variogram modelling is slower with large data sets, but 8-10.000 
observations should not be a problem, unless you need the results 
extremely fast. On my computer (3 years old) it takes about 4 seconds 
with 8.000 random observations, using the variogram function in gstat. 
Time increases approximately with the square of the number of observations:

data(meuse)
coordinates(meuse) = ~x+y

samp = 1000
for (i in 1:5) {
  samp = samp*2
  m2 = SpatialPointsDataFrame(spsample(meuse,samp,"random"),data = 
data.frame(value = rnorm(samp)))
  tvar = system.time(vario <-variogram(value~1,m2))
  print(paste(samp,tvar[1]))
}

What you could consider when you get to the kriging part, is to limit 
the number of neighbours to e.g. 50 (argument nmax). Otherwise you have 
to invert a matrix that is e.g. 10.000*10.000, which is slow, and can 
also get you close to the memory limit if you are using Windows.

Cheers,
Jon


GREGORY GERARD LUNA wrote:
> Hi, I have a very non-specific question about the number of sample points that
> can be used 
> for developing experimental variograms and kriging in R/gstat/etc. Does anyone
> have experience 
> using a very large number of data points in the kriging processes with R?  It
> has been a few 
> years since my last spatial stats course but I recall that I was limited in the
> number of data 
> points that R could handle.  I have a regional archaeological dataset with many
> data points.
> My sub-regions that I would like to use for kriging can contain 8,000-10,000
> data points.  Many 
> of these are zero values (not no data).  Am I going to have sample my sample if
> I want to 
> generate experimental variograms in R? Thanks in advance for any ideas, 
> Greg Luna
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From laura.poggio at gmail.com  Fri Dec  4 13:53:38 2009
From: laura.poggio at gmail.com (Laura Poggio)
Date: Fri, 4 Dec 2009 12:53:38 +0000
Subject: [R-sig-Geo] plotting 100 variograms on the same plot
Message-ID: <e027b8750912040453n393d8317s9eba93867b6a1b01@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20091204/c83e3a0d/attachment.pl>

From Mark.Trinder at rpsgroup.com  Fri Dec  4 14:52:24 2009
From: Mark.Trinder at rpsgroup.com (Mark Trinder)
Date: Fri, 4 Dec 2009 13:52:24 -0000
Subject: [R-sig-Geo] intersection coordinates of two polygons
Message-ID: <605F55D8070C094AA2E2A9CBA2767A3C067F9667@EXMB1.eur.rpsgroup.com>


Hi all

Is there a way to output the coordinates of the intersections of two
polygons? I did wonder if this could be extracted from the code used in
overlap.xypolygon, but I haven't been able to work out if this code
calculates intersection points.

Thanks
Mark


This e-mail message and any attached file is the property of the sender and is sent in confidence to the addressee only.
Internet communications are not secure and RPS is not responsible for their abuse by third parties, any alteration or corruption in transmission or for any loss or damage caused by a virus or by other means.
 
Any advice contained in this e-mail is for information purposes only.

RPS Planning and Development Limited, company number: 02947164 (England). Registered office: Centurion Court, 85 Milton Park Abingdon Oxfordshire OX14 4RY.
RPS Group Plc web link: <http://www.rpsgroup.com>


From p.hiemstra at geo.uu.nl  Fri Dec  4 15:42:55 2009
From: p.hiemstra at geo.uu.nl (Paul Hiemstra)
Date: Fri, 04 Dec 2009 15:42:55 +0100
Subject: [R-sig-Geo] plotting 100 variograms on the same plot
In-Reply-To: <e027b8750912040453n393d8317s9eba93867b6a1b01@mail.gmail.com>
References: <e027b8750912040453n393d8317s9eba93867b6a1b01@mail.gmail.com>
Message-ID: <4B191FEF.40107@geo.uu.nl>

Laura Poggio wrote:
> Dear all,
> I would like to plot 100 variograms on the same plot, possibly using a loop.
>
> At the moment I am using autofitVariogram in the package Automap to fit the
> variograms automatically.
> I found some code calling the lattice package (
> http://tolstoy.newcastle.edu.au/R/e7/help/09/06/0940.html), but it is giving
> some problems for high numbers of variograms.
>
> Thank you very much in advance!
>
> Laura
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>   
Hi Laura,

The trick is to organize your data, an example using the meuse dataset:

library(lattice)

# Make a dataset with 100 fitted variogram models
# Don't know how you've organized your 100 models,
# But I put them in a list.
data(meuse)
coordinates(meuse) =~ x+y
av_list = lapply(1:100, function(x) autofitVariogram(zinc~1, meuse))

# Now extract the sample variograms, add an extra
# identification column to them and rbind them together
sv_list = do.call("rbind", lapply(1:length(av_list), function(x) {
sv = av_list[[x]]$exp_var
sv$identification = as.character(x)
return(sv)
}))

# Make a list of fitted models
model_list = lapply(av_list, function(x) x$var_model)

# Make the plot, notice the formula part!
# I use panel.number(), the current panel number,
# to extract the appropriate variogram model
xyplot(gamma ~ dist | identification, sv_list,
panel = function(...) {
panel.xyplot(...) # points of the sample var
ret = variogramLine(model_list[[panel.number()]], maxdist = 
max(sv_list$dist))
llines(ret$dist, ret$gamma, col = "red")
})

cheers,
Paul

-- 
Drs. Paul Hiemstra
Department of Physical Geography
Faculty of Geosciences
University of Utrecht
Heidelberglaan 2
P.O. Box 80.115
3508 TC Utrecht
Phone:  +3130 274 3113 Mon-Tue
Phone:  +3130 253 5773 Wed-Fri
http://intamap.geo.uu.nl/~paul


From p.hiemstra at geo.uu.nl  Fri Dec  4 15:50:43 2009
From: p.hiemstra at geo.uu.nl (Paul Hiemstra)
Date: Fri, 04 Dec 2009 15:50:43 +0100
Subject: [R-sig-Geo] plotting 100 variograms on the same plot
In-Reply-To: <4B191FEF.40107@geo.uu.nl>
References: <e027b8750912040453n393d8317s9eba93867b6a1b01@mail.gmail.com>
	<4B191FEF.40107@geo.uu.nl>
Message-ID: <4B1921C3.10202@geo.uu.nl>

Paul Hiemstra wrote:
> Laura Poggio wrote:
>> Dear all,
>> I would like to plot 100 variograms on the same plot, possibly using 
>> a loop.
>>
>> At the moment I am using autofitVariogram in the package Automap to 
>> fit the
>> variograms automatically.
>> I found some code calling the lattice package (
>> http://tolstoy.newcastle.edu.au/R/e7/help/09/06/0940.html), but it is 
>> giving
>> some problems for high numbers of variograms.
>>
>> Thank you very much in advance!
>>
>> Laura
>>
>> [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> Hi Laura,
>
> The trick is to organize your data, an example using the meuse dataset:
>
> library(lattice)
...and ofcourse you need to do:

library(automap)
>
> # Make a dataset with 100 fitted variogram models
> # Don't know how you've organized your 100 models,
> # But I put them in a list.
> data(meuse)
> coordinates(meuse) =~ x+y
> av_list = lapply(1:100, function(x) autofitVariogram(zinc~1, meuse))
>
> # Now extract the sample variograms, add an extra
> # identification column to them and rbind them together
> sv_list = do.call("rbind", lapply(1:length(av_list), function(x) {
> sv = av_list[[x]]$exp_var
> sv$identification = as.character(x)
> return(sv)
> }))
>
> # Make a list of fitted models
> model_list = lapply(av_list, function(x) x$var_model)
>
> # Make the plot, notice the formula part!
> # I use panel.number(), the current panel number,
> # to extract the appropriate variogram model
> xyplot(gamma ~ dist | identification, sv_list,
> panel = function(...) {
> panel.xyplot(...) # points of the sample var
> ret = variogramLine(model_list[[panel.number()]], maxdist = 
> max(sv_list$dist))
> llines(ret$dist, ret$gamma, col = "red")
> })
>
> cheers,
> Paul
>


-- 
Drs. Paul Hiemstra
Department of Physical Geography
Faculty of Geosciences
University of Utrecht
Heidelberglaan 2
P.O. Box 80.115
3508 TC Utrecht
Phone:  +3130 274 3113 Mon-Tue
Phone:  +3130 253 5773 Wed-Fri
http://intamap.geo.uu.nl/~paul


From pazurrobert at gmail.com  Sat Dec  5 00:36:25 2009
From: pazurrobert at gmail.com (Robert Pazur)
Date: Sat, 5 Dec 2009 00:36:25 +0100
Subject: [R-sig-Geo] logistic GWR
Message-ID: <a4655df90912041536v7fbc5522hae70c092221bf417@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20091205/bde646d8/attachment.pl>

From laura.poggio at gmail.com  Sat Dec  5 12:37:09 2009
From: laura.poggio at gmail.com (Laura Poggio)
Date: Sat, 5 Dec 2009 11:37:09 +0000
Subject: [R-sig-Geo] plotting 100 variograms on the same plot
In-Reply-To: <4B1921C3.10202@geo.uu.nl>
References: <e027b8750912040453n393d8317s9eba93867b6a1b01@mail.gmail.com>
	<4B191FEF.40107@geo.uu.nl> <4B1921C3.10202@geo.uu.nl>
Message-ID: <e027b8750912050337q23fb772ar1612b20fcf4b56a5@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20091205/b426dbff/attachment.pl>

From patrick.giraudoux at univ-fcomte.fr  Sun Dec  6 09:50:51 2009
From: patrick.giraudoux at univ-fcomte.fr (Patrick Giraudoux)
Date: Sun, 06 Dec 2009 09:50:51 +0100
Subject: [R-sig-Geo] spgrass6 and initGRASS
Message-ID: <4B1B706B.505@univ-fcomte.fr>

Dear all,

I am trying to init a GRASS session from within R, using the function 
initGRASS from the package spgrass6. GRASS is installed in two ways on 
my computer (here, the OS is Windows XP): with QGIS metis (precompiled 
version including grass 6.3 (2008)) and grass 6.4.0svn, just freshly 
installed with the Osgeo4W installer.

In both cases I get the same result:

 > initGRASS("C:/Program Files/Quantum GIS/grass",home="U:/Documents and 
Settings/pgiraudo",override=T)
Error in Sys.setenv(GISRC = gisrc) : wrong length for argument

 > initGRASS("C:/OSGeo4W/bin",home="U:/Documents and 
Settings/pgiraudo",override=T)
Error in Sys.setenv(GISRC = gisrc) : wrong length for argument

Any idea about what happens ?

Patrick


From Roger.Bivand at nhh.no  Sun Dec  6 20:52:10 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sun, 6 Dec 2009 20:52:10 +0100 (CET)
Subject: [R-sig-Geo] spgrass6 and initGRASS
In-Reply-To: <4B1B706B.505@univ-fcomte.fr>
References: <4B1B706B.505@univ-fcomte.fr>
Message-ID: <alpine.LRH.2.00.0912062034470.26836@reclus.nhh.no>

On Sun, 6 Dec 2009, Patrick Giraudoux wrote:

> Dear all,
>
> I am trying to init a GRASS session from within R, using the function 
> initGRASS from the package spgrass6. GRASS is installed in two ways on my 
> computer (here, the OS is Windows XP): with QGIS metis (precompiled version 
> including grass 6.3 (2008)) and grass 6.4.0svn, just freshly installed with 
> the Osgeo4W installer.
>
> In both cases I get the same result:
>
>> initGRASS("C:/Program Files/Quantum GIS/grass",home="U:/Documents and 
> Settings/pgiraudo",override=T)
> Error in Sys.setenv(GISRC = gisrc) : wrong length for argument
>
>> initGRASS("C:/OSGeo4W/bin",home="U:/Documents and 
> Settings/pgiraudo",override=T)
> Error in Sys.setenv(GISRC = gisrc) : wrong length for argument
>
> Any idea about what happens ?

No, without the output of traceback(), it isn't obvious, although here 
traceback() might not help. Run under debug(initGRASS) to the step before, 
that is:

         gisrc <- system(paste("g.dirseps.exe -g",
             shQuote(Sys.getenv("WINGISRC"))), intern=TRUE)

then run:

Sys.getenv("WINGISRC")
shQuote(Sys.getenv("WINGISRC"))
gisrc

and try to see what is going on. At this stage, Sys.getenv("GISRC") should 
be "junk", assigned a couple of lines earlier.

Maybe the grass-stats list would have a higher proportion of users of both 
GRASS and R.

Hope this helps,

Roger

>
> Patrick
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From edalaze at gmail.com  Mon Dec  7 13:07:46 2009
From: edalaze at gmail.com (Eda Laze)
Date: Mon, 7 Dec 2009 13:07:46 +0100
Subject: [R-sig-Geo] local R2
In-Reply-To: <c7730d730912070356h4e3315a7m4800f1fc9bbae237@mail.gmail.com>
References: <c7730d730911270351l3277c05aga299180cb7506fe0@mail.gmail.com>
	<alpine.LRH.2.00.0911271307280.4373@reclus.nhh.no>
	<c7730d730912070356h4e3315a7m4800f1fc9bbae237@mail.gmail.com>
Message-ID: <c7730d730912070407h26dc28bwd62987deec041850@mail.gmail.com>

Hello,

Thank you very much Roger for your helpful answer. It worked pretty well.

When I run gwr with polygon data I get:

"Warning message:
In gwr(formula = AFCCH07HA ~ ALDRO12MEA + ALDRO1MEAN + ALHSETTMEA +  :
  data is Spatial* object, ignoring coords argument"

However, I may provide now two results in one of combinations of variables I
use. I use the same number of neighbors and variables in both cases,
the only change is as follows:

In case one I use longlat =TRUE and in case two I do not write longlat=TRUE.

case one (longlat=TRUE): local R2 values vary from 0.1651 to 0.5328
? ? gwr.e ? ? ? ? ? ? ? ?pred ? ? ? ? ? ? ? ? ? ?localR2
?Min. ? :-465.4243 ? Min. ? :-142.267 ? Min. ? :0.1651
?1st Qu.: -17.4693 ? 1st Qu.: ? 5.429 ? 1st Qu.:0.2461
?Median : ?-3.2120 ? Median : ?16.735 ? Median :0.2788
?Mean ? : ? 0.3215 ? Mean ? : ?17.798 ? Mean ? :0.2835
?3rd Qu.: ?16.0616 ? 3rd Qu.: ?29.726 ? 3rd Qu.:0.3181
?Max. ? : 321.4507 ? Max. ? : 162.569 ? Max. ? :0.5328
?sum.w
?Min. ? :33.40
?1st Qu.:56.47
?Median :62.22
?Mean ? :62.32
?Max. ? :91.10

case two (without longlat=TRUE): local R2 values vary from 0.06066 to 0.70522

? ? gwr.e ? ? ? ? ? ? ? ?pred ? ? ? ? ? ? localR2
?Min. ? :-323.5487 ? Min. ? :-244.457 ? Min. ? :0.06066
?1st Qu.: -13.4717 ? 1st Qu.: ?-1.223 ? 1st Qu.:0.32168
?Median : ?-1.2330 ? Median : ?14.144 ? Median :0.38511
?Mean ? : ? 0.9375 ? Mean ? : ?17.181 ? Mean ? :0.40192
?3rd Qu.: ? 9.5695 ? 3rd Qu.: ?38.060 ? 3rd Qu.:0.47538
?Max. ? : 320.2477 ? Max. ? : 176.522 ? Max. ? :0.70522

? ? ? ? ?sum.w
?Min. ? : 36.83
?1st Qu.: 50.90
?Median : 56.49
?Mean ? : 57.56
?3rd Qu.: 62.76
?Max. ? :120.35

I thought that adapt=0.01 (number of neighbors) could decide on
weights. Visualisation of map differs, map two is rather a "surface".
Does it mean that weights differ from case one to two due to
the fact that "longlat = TRUE uses distances on the ellipse with WGS84
parameters" as described in the spgwr manual updated in June 2009.

The polygon data are projected in:
Projected Coordinate System: ? ?WGS_1984_UTM_Zone_34N.
I would welcome very much an accurate response, despite my efforts to
get the answer these days by myself.

Thank you in advance

++++++++++++
On Fri, Nov 27, 2009 at 1:12 PM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
> On Fri, 27 Nov 2009, Eda Laze wrote:
>
>> Hello,
>>
>> I am currectly using gwr in R to get local R2. I have a shape file -
>> polygon data.
>> When I write codes as below: case 1 and 2, I get two different Local
>> R2 values and maps:
>>
>> case1.adpt<-gwr(FCHA~PAC1+PAC2+PAC6, data=filename,
>> coords=cbind(filename$X, filename$Y), adapt= 0.01, longlat=TRUE).
>> case2.adpt<-gwr(FCHA~PAC1+PAC2+PAC6, data=filename,
>> coords=cbind(filename$X, filename$Y), adapt= 0.01, hatmatrix = TRUE,
>> se.fit=TRUE). Local R2 have different values from case 1 and map is
>> different as well.
>
> In the second case, you are not using longlat=TRUE, which will give rather
> different weights. Please only give examples with available data sets, and
> include say the first 5 local R2 values, so that helpers know that they are
> looking at the same thing as you are. Always state the output of
> sessionInfo().
>
> Hope this helps,
>
> Roger
>
>>
>> Furthermore, when I visualize case 1: i.e., local R2 on map, each
>> polygon has a certain value and responding color while in case 2: map
>> shows clustering of Local R2 (values) similar to Georgia case study.
>> However, I wonder why this happen and which is the right way to get
>> local R2.
>>
>> I read spgwr manual and update. Though an accurate answer is very welcome.
>>
>> Thank you.
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> --
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>
>


From patrick.giraudoux at univ-fcomte.fr  Mon Dec  7 13:23:13 2009
From: patrick.giraudoux at univ-fcomte.fr (Patrick Giraudoux)
Date: Mon, 07 Dec 2009 13:23:13 +0100
Subject: [R-sig-Geo] spgrass6 and initGRASS
In-Reply-To: <alpine.LRH.2.00.0912062034470.26836@reclus.nhh.no>
References: <4B1B706B.505@univ-fcomte.fr>
	<alpine.LRH.2.00.0912062034470.26836@reclus.nhh.no>
Message-ID: <4B1CF3B1.4040209@univ-fcomte.fr>

Here is the result:

library(spgrass6)

debug(initGRASS)
 > initGRASS("C:/OSGeo4W/bin",home="U:/Documents and 
Settings/pgiraudo/",override=T)

(...)

Browse[2]>
debug: gisrc <- system(paste("g.dirseps.exe -g", 
shQuote(Sys.getenv("WINGISRC"))),
    intern = TRUE)
Browse[2]> Sys.getenv("WINGISRC")
                                        WINGISRC
"U:/Documents and Settings/pgiraudo/\\.grassrc6"
Browse[2]> shQuote(Sys.getenv("WINGISRC"))
[1] "\"U:/Documents and Settings/pgiraudo/\\.grassrc6\""
Browse[2]> gisrc
Error: object 'gisrc' not found

Beforehand, the first time I run 
initGRASS("C:/OSGeo4W/bin",home="U:/Documents and 
Settings/pgiraudo/",override=T), I got:

initGRASS("C:/OSGeo4W/bin",home="U:/Documents and 
Settings/pgiraudo/",override=T)
Error in system(paste("g.dirseps.exe -g", 
shQuote(Sys.getenv("WINGISRC"))),  :
  g.dirseps.exe not found

Then, if I try the same commande on QGIS Metis, I got:
initGRASS("C:/Program Files/Quantum GIS/grass",home="U:/Documents and 
Settings/pgiraudo",override=T)
Error in Sys.setenv(GISRC = gisrc) : wrong length for argument


Best,

Patrick







Roger Bivand a ?crit :
> On Sun, 6 Dec 2009, Patrick Giraudoux wrote:
>
>> Dear all,
>>
>> I am trying to init a GRASS session from within R, using the function 
>> initGRASS from the package spgrass6. GRASS is installed in two ways 
>> on my computer (here, the OS is Windows XP): with QGIS metis 
>> (precompiled version including grass 6.3 (2008)) and grass 6.4.0svn, 
>> just freshly installed with the Osgeo4W installer.
>>
>> In both cases I get the same result:
>>
>>> initGRASS("C:/Program Files/Quantum GIS/grass",home="U:/Documents and 
>> Settings/pgiraudo",override=T)
>> Error in Sys.setenv(GISRC = gisrc) : wrong length for argument
>>
>>> initGRASS("C:/OSGeo4W/bin",home="U:/Documents and 
>> Settings/pgiraudo",override=T)
>> Error in Sys.setenv(GISRC = gisrc) : wrong length for argument
>>
>> Any idea about what happens ?
>
> No, without the output of traceback(), it isn't obvious, although here 
> traceback() might not help. Run under debug(initGRASS) to the step 
> before, that is:
>
>         gisrc <- system(paste("g.dirseps.exe -g",
>             shQuote(Sys.getenv("WINGISRC"))), intern=TRUE)
>
> then run:
>
> Sys.getenv("WINGISRC")
> shQuote(Sys.getenv("WINGISRC"))
> gisrc
>
> and try to see what is going on. At this stage, Sys.getenv("GISRC") 
> should be "junk", assigned a couple of lines earlier.
>
> Maybe the grass-stats list would have a higher proportion of users of 
> both GRASS and R.
>
> Hope this helps,
>
> Roger
>
>>
>> Patrick
>>
>


From Roger.Bivand at nhh.no  Mon Dec  7 13:31:57 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 7 Dec 2009 13:31:57 +0100 (CET)
Subject: [R-sig-Geo] local R2
In-Reply-To: <c7730d730912070407h26dc28bwd62987deec041850@mail.gmail.com>
References: <c7730d730911270351l3277c05aga299180cb7506fe0@mail.gmail.com>
	<alpine.LRH.2.00.0911271307280.4373@reclus.nhh.no>
	<c7730d730912070356h4e3315a7m4800f1fc9bbae237@mail.gmail.com>
	<c7730d730912070407h26dc28bwd62987deec041850@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.0912071324460.20959@reclus.nhh.no>

On Mon, 7 Dec 2009, Eda Laze wrote:

> Hello,
>
> Thank you very much Roger for your helpful answer. It worked pretty well.
>
> When I run gwr with polygon data I get:
>
> "Warning message:
> In gwr(formula = AFCCH07HA ~ ALDRO12MEA + ALDRO1MEAN + ALHSETTMEA +  :
>  data is Spatial* object, ignoring coords argument"
>
> However, I may provide now two results in one of combinations of variables I
> use. I use the same number of neighbors and variables in both cases,
> the only change is as follows:
>
> In case one I use longlat =TRUE and in case two I do not write longlat=TRUE.
>
> case one (longlat=TRUE): local R2 values vary from 0.1651 to 0.5328
> ? ? gwr.e ? ? ? ? ? ? ? ?pred ? ? ? ? ? ? ? ? ? ?localR2
> ?Min. ? :-465.4243 ? Min. ? :-142.267 ? Min. ? :0.1651
> ?1st Qu.: -17.4693 ? 1st Qu.: ? 5.429 ? 1st Qu.:0.2461
> ?Median : ?-3.2120 ? Median : ?16.735 ? Median :0.2788
> ?Mean ? : ? 0.3215 ? Mean ? : ?17.798 ? Mean ? :0.2835
> ?3rd Qu.: ?16.0616 ? 3rd Qu.: ?29.726 ? 3rd Qu.:0.3181
> ?Max. ? : 321.4507 ? Max. ? : 162.569 ? Max. ? :0.5328
> ?sum.w
> ?Min. ? :33.40
> ?1st Qu.:56.47
> ?Median :62.22
> ?Mean ? :62.32
> ?Max. ? :91.10
>
> case two (without longlat=TRUE): local R2 values vary from 0.06066 to 0.70522
>
> ? ? gwr.e ? ? ? ? ? ? ? ?pred ? ? ? ? ? ? localR2
> ?Min. ? :-323.5487 ? Min. ? :-244.457 ? Min. ? :0.06066
> ?1st Qu.: -13.4717 ? 1st Qu.: ?-1.223 ? 1st Qu.:0.32168
> ?Median : ?-1.2330 ? Median : ?14.144 ? Median :0.38511
> ?Mean ? : ? 0.9375 ? Mean ? : ?17.181 ? Mean ? :0.40192
> ?3rd Qu.: ? 9.5695 ? 3rd Qu.: ?38.060 ? 3rd Qu.:0.47538
> ?Max. ? : 320.2477 ? Max. ? : 176.522 ? Max. ? :0.70522
>
> ? ? ? ? ?sum.w
> ?Min. ? : 36.83
> ?1st Qu.: 50.90
> ?Median : 56.49
> ?Mean ? : 57.56
> ?3rd Qu.: 62.76
> ?Max. ? :120.35
>
> I thought that adapt=0.01 (number of neighbors) could decide on
> weights. Visualisation of map differs, map two is rather a "surface".
> Does it mean that weights differ from case one to two due to
> the fact that "longlat = TRUE uses distances on the ellipse with WGS84
> parameters" as described in the spgwr manual updated in June 2009.
>
> The polygon data are projected in:
> Projected Coordinate System: ? ?WGS_1984_UTM_Zone_34N.
> I would welcome very much an accurate response, despite my efforts to
> get the answer these days by myself.

Since the data are projected, they are in UTM zone 34, use longlat=FALSE. 
As a sanity check, assign the projection to the object:

proj4string(obj) <- CRS("+proj=utm +zone=34 +datum=WGS84")

then inverse project to longlat:

library(rgdal)
obj_ll <- spTransform(obj, CRS("+proj=longlat +datum=WGS84"))

and rerun the analysis with longlat=TRUE (the bandwidth will be in km not 
m), and even do:

writeOGR(obj_ll, "obj.kml", "obj", driver="KML")

for the input object, displaying in Google Earth or similar.

Roger

>
> Thank you in advance
>
> ++++++++++++
> On Fri, Nov 27, 2009 at 1:12 PM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
>> On Fri, 27 Nov 2009, Eda Laze wrote:
>>
>>> Hello,
>>>
>>> I am currectly using gwr in R to get local R2. I have a shape file -
>>> polygon data.
>>> When I write codes as below: case 1 and 2, I get two different Local
>>> R2 values and maps:
>>>
>>> case1.adpt<-gwr(FCHA~PAC1+PAC2+PAC6, data=filename,
>>> coords=cbind(filename$X, filename$Y), adapt= 0.01, longlat=TRUE).
>>> case2.adpt<-gwr(FCHA~PAC1+PAC2+PAC6, data=filename,
>>> coords=cbind(filename$X, filename$Y), adapt= 0.01, hatmatrix = TRUE,
>>> se.fit=TRUE). Local R2 have different values from case 1 and map is
>>> different as well.
>>
>> In the second case, you are not using longlat=TRUE, which will give rather
>> different weights. Please only give examples with available data sets, and
>> include say the first 5 local R2 values, so that helpers know that they are
>> looking at the same thing as you are. Always state the output of
>> sessionInfo().
>>
>> Hope this helps,
>>
>> Roger
>>
>>>
>>> Furthermore, when I visualize case 1: i.e., local R2 on map, each
>>> polygon has a certain value and responding color while in case 2: map
>>> shows clustering of Local R2 (values) similar to Georgia case study.
>>> However, I wonder why this happen and which is the right way to get
>>> local R2.
>>>
>>> I read spgwr manual and update. Though an accurate answer is very welcome.
>>>
>>> Thank you.
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>> --
>> Roger Bivand
>> Economic Geography Section, Department of Economics, Norwegian School of
>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>> e-mail: Roger.Bivand at nhh.no
>>
>>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From Roger.Bivand at nhh.no  Mon Dec  7 13:38:37 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 7 Dec 2009 13:38:37 +0100 (CET)
Subject: [R-sig-Geo] spgrass6 and initGRASS
In-Reply-To: <4B1CF3B1.4040209@univ-fcomte.fr>
References: <4B1B706B.505@univ-fcomte.fr>
	<alpine.LRH.2.00.0912062034470.26836@reclus.nhh.no>
	<4B1CF3B1.4040209@univ-fcomte.fr>
Message-ID: <alpine.LRH.2.00.0912071335330.20959@reclus.nhh.no>

On Mon, 7 Dec 2009, Patrick Giraudoux wrote:

> Here is the result:
>
> library(spgrass6)
>
> debug(initGRASS)
>> initGRASS("C:/OSGeo4W/bin",home="U:/Documents and 
> Settings/pgiraudo/",override=T)
>
> (...)
>
> Browse[2]>
> debug: gisrc <- system(paste("g.dirseps.exe -g", 
> shQuote(Sys.getenv("WINGISRC"))),
>   intern = TRUE)
> Browse[2]> Sys.getenv("WINGISRC")
>                                       WINGISRC
> "U:/Documents and Settings/pgiraudo/\\.grassrc6"
> Browse[2]> shQuote(Sys.getenv("WINGISRC"))
> [1] "\"U:/Documents and Settings/pgiraudo/\\.grassrc6\""
> Browse[2]> gisrc
> Error: object 'gisrc' not found

Could you try both not setting home= (you get a temporary folder that is 
deleted when you exit R), or setting

home="U:\\Documents and Settings\\pgiraudo"

without the trailing forward slash?

This a problem connected to protecting spaces on the one hand and system 
specific directory separators on the other, I think.

Roger

>
> Beforehand, the first time I run 
> initGRASS("C:/OSGeo4W/bin",home="U:/Documents and 
> Settings/pgiraudo/",override=T), I got:
>
> initGRASS("C:/OSGeo4W/bin",home="U:/Documents and 
> Settings/pgiraudo/",override=T)
> Error in system(paste("g.dirseps.exe -g", shQuote(Sys.getenv("WINGISRC"))), 
> :
> g.dirseps.exe not found
>
> Then, if I try the same commande on QGIS Metis, I got:
> initGRASS("C:/Program Files/Quantum GIS/grass",home="U:/Documents and 
> Settings/pgiraudo",override=T)
> Error in Sys.setenv(GISRC = gisrc) : wrong length for argument
>
>
> Best,
>
> Patrick
>
>
>
>
>
>
>
> Roger Bivand a ?crit :
>> On Sun, 6 Dec 2009, Patrick Giraudoux wrote:
>> 
>>> Dear all,
>>> 
>>> I am trying to init a GRASS session from within R, using the function 
>>> initGRASS from the package spgrass6. GRASS is installed in two ways on my 
>>> computer (here, the OS is Windows XP): with QGIS metis (precompiled 
>>> version including grass 6.3 (2008)) and grass 6.4.0svn, just freshly 
>>> installed with the Osgeo4W installer.
>>> 
>>> In both cases I get the same result:
>>> 
>>>> initGRASS("C:/Program Files/Quantum GIS/grass",home="U:/Documents and 
>>> Settings/pgiraudo",override=T)
>>> Error in Sys.setenv(GISRC = gisrc) : wrong length for argument
>>> 
>>>> initGRASS("C:/OSGeo4W/bin",home="U:/Documents and 
>>> Settings/pgiraudo",override=T)
>>> Error in Sys.setenv(GISRC = gisrc) : wrong length for argument
>>> 
>>> Any idea about what happens ?
>> 
>> No, without the output of traceback(), it isn't obvious, although here 
>> traceback() might not help. Run under debug(initGRASS) to the step before, 
>> that is:
>>
>>         gisrc <- system(paste("g.dirseps.exe -g",
>>             shQuote(Sys.getenv("WINGISRC"))), intern=TRUE)
>> 
>> then run:
>> 
>> Sys.getenv("WINGISRC")
>> shQuote(Sys.getenv("WINGISRC"))
>> gisrc
>> 
>> and try to see what is going on. At this stage, Sys.getenv("GISRC") should 
>> be "junk", assigned a couple of lines earlier.
>> 
>> Maybe the grass-stats list would have a higher proportion of users of both 
>> GRASS and R.
>> 
>> Hope this helps,
>> 
>> Roger
>> 
>>> 
>>> Patrick
>>> 
>> 
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From patrick.giraudoux at univ-fcomte.fr  Mon Dec  7 13:48:48 2009
From: patrick.giraudoux at univ-fcomte.fr (Patrick Giraudoux)
Date: Mon, 07 Dec 2009 13:48:48 +0100
Subject: [R-sig-Geo] spgrass6 and initGRASS
In-Reply-To: <alpine.LRH.2.00.0912071335330.20959@reclus.nhh.no>
References: <4B1B706B.505@univ-fcomte.fr>
	<alpine.LRH.2.00.0912062034470.26836@reclus.nhh.no>
	<4B1CF3B1.4040209@univ-fcomte.fr>
	<alpine.LRH.2.00.0912071335330.20959@reclus.nhh.no>
Message-ID: <4B1CF9B0.8010003@univ-fcomte.fr>

Have tried the following:

initGRASS("C:\\OSGeo4W\\bin",home="U:\\Documents and 
Settings\\pgiraudo\\",override=T)
initGRASS("C:\\Program Files\\Quantum GIS\\grass",home="U:\\Documents 
and Settings\\pgiraudo",override=T)
initGRASS("C:\\OSGeo4W\\bin",override=T)

with the same results...

 > initGRASS("C:\\OSGeo4W\\bin",home="U:\\Documents and 
Settings\\pgiraudo\\",override=T)
Error in system(paste("g.dirseps.exe -g", 
shQuote(Sys.getenv("WINGISRC"))),  :
  g.dirseps.exe not found
 > initGRASS("C:\\Program Files\\Quantum GIS\\grass",home="U:\\Documents 
and Settings\\pgiraudo",override=T)
Error in Sys.setenv(GISRC = gisrc) : wrong length for argument
 > initGRASS("C:\\OSGeo4W\\bin",override=T)
Error in Sys.setenv(GISRC = gisrc) : wrong length for argument

Quite puzzling since g.dirseps does not give a message "unknown command" 
when tried within grass (thus it is suppose to be in the GRASS programme)

Patrick



Roger Bivand a ?crit :
> On Mon, 7 Dec 2009, Patrick Giraudoux wrote:
>
>> Here is the result:
>>
>> library(spgrass6)
>>
>> debug(initGRASS)
>>> initGRASS("C:/OSGeo4W/bin",home="U:/Documents and 
>> Settings/pgiraudo/",override=T)
>>
>> (...)
>>
>> Browse[2]>
>> debug: gisrc <- system(paste("g.dirseps.exe -g", 
>> shQuote(Sys.getenv("WINGISRC"))),
>>   intern = TRUE)
>> Browse[2]> Sys.getenv("WINGISRC")
>>                                       WINGISRC
>> "U:/Documents and Settings/pgiraudo/\\.grassrc6"
>> Browse[2]> shQuote(Sys.getenv("WINGISRC"))
>> [1] "\"U:/Documents and Settings/pgiraudo/\\.grassrc6\""
>> Browse[2]> gisrc
>> Error: object 'gisrc' not found
>
> Could you try both not setting home= (you get a temporary folder that 
> is deleted when you exit R), or setting
>
> home="U:\\Documents and Settings\\pgiraudo"
>
> without the trailing forward slash?
>
> This a problem connected to protecting spaces on the one hand and 
> system specific directory separators on the other, I think.
>
> Roger
>
>>
>> Beforehand, the first time I run 
>> initGRASS("C:/OSGeo4W/bin",home="U:/Documents and 
>> Settings/pgiraudo/",override=T), I got:
>>
>> initGRASS("C:/OSGeo4W/bin",home="U:/Documents and 
>> Settings/pgiraudo/",override=T)
>> Error in system(paste("g.dirseps.exe -g", 
>> shQuote(Sys.getenv("WINGISRC"))), :
>> g.dirseps.exe not found
>>
>> Then, if I try the same commande on QGIS Metis, I got:
>> initGRASS("C:/Program Files/Quantum GIS/grass",home="U:/Documents and 
>> Settings/pgiraudo",override=T)
>> Error in Sys.setenv(GISRC = gisrc) : wrong length for argument
>>
>>
>> Best,
>>
>> Patrick
>>
>>
>>
>>
>>
>>
>>
>> Roger Bivand a ?crit :
>>> On Sun, 6 Dec 2009, Patrick Giraudoux wrote:
>>>
>>>> Dear all,
>>>>
>>>> I am trying to init a GRASS session from within R, using the 
>>>> function initGRASS from the package spgrass6. GRASS is installed in 
>>>> two ways on my computer (here, the OS is Windows XP): with QGIS 
>>>> metis (precompiled version including grass 6.3 (2008)) and grass 
>>>> 6.4.0svn, just freshly installed with the Osgeo4W installer.
>>>>
>>>> In both cases I get the same result:
>>>>
>>>>> initGRASS("C:/Program Files/Quantum GIS/grass",home="U:/Documents and 
>>>> Settings/pgiraudo",override=T)
>>>> Error in Sys.setenv(GISRC = gisrc) : wrong length for argument
>>>>
>>>>> initGRASS("C:/OSGeo4W/bin",home="U:/Documents and 
>>>> Settings/pgiraudo",override=T)
>>>> Error in Sys.setenv(GISRC = gisrc) : wrong length for argument
>>>>
>>>> Any idea about what happens ?
>>>
>>> No, without the output of traceback(), it isn't obvious, although 
>>> here traceback() might not help. Run under debug(initGRASS) to the 
>>> step before, that is:
>>>
>>>         gisrc <- system(paste("g.dirseps.exe -g",
>>>             shQuote(Sys.getenv("WINGISRC"))), intern=TRUE)
>>>
>>> then run:
>>>
>>> Sys.getenv("WINGISRC")
>>> shQuote(Sys.getenv("WINGISRC"))
>>> gisrc
>>>
>>> and try to see what is going on. At this stage, Sys.getenv("GISRC") 
>>> should be "junk", assigned a couple of lines earlier.
>>>
>>> Maybe the grass-stats list would have a higher proportion of users 
>>> of both GRASS and R.
>>>
>>> Hope this helps,
>>>
>>> Roger
>>>
>>>>
>>>> Patrick
>>>>
>>>
>>
>>
>


From Roger.Bivand at nhh.no  Mon Dec  7 13:57:15 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 7 Dec 2009 13:57:15 +0100 (CET)
Subject: [R-sig-Geo] spgrass6 and initGRASS
In-Reply-To: <4B1CF9B0.8010003@univ-fcomte.fr>
References: <4B1B706B.505@univ-fcomte.fr>
	<alpine.LRH.2.00.0912062034470.26836@reclus.nhh.no>
	<4B1CF3B1.4040209@univ-fcomte.fr>
	<alpine.LRH.2.00.0912071335330.20959@reclus.nhh.no>
	<4B1CF9B0.8010003@univ-fcomte.fr>
Message-ID: <alpine.LRH.2.00.0912071350230.20959@reclus.nhh.no>

On Mon, 7 Dec 2009, Patrick Giraudoux wrote:

> Have tried the following:
>
> initGRASS("C:\\OSGeo4W\\bin",home="U:\\Documents and 
> Settings\\pgiraudo\\",override=T)
> initGRASS("C:\\Program Files\\Quantum GIS\\grass",home="U:\\Documents and 
> Settings\\pgiraudo",override=T)
> initGRASS("C:\\OSGeo4W\\bin",override=T)
>
> with the same results...
>
>> initGRASS("C:\\OSGeo4W\\bin",home="U:\\Documents and 
> Settings\\pgiraudo\\",override=T)
> Error in system(paste("g.dirseps.exe -g", shQuote(Sys.getenv("WINGISRC"))), 
> :
> g.dirseps.exe not found
>> initGRASS("C:\\Program Files\\Quantum GIS\\grass",home="U:\\Documents and 
> Settings\\pgiraudo",override=T)
> Error in Sys.setenv(GISRC = gisrc) : wrong length for argument
>> initGRASS("C:\\OSGeo4W\\bin",override=T)
> Error in Sys.setenv(GISRC = gisrc) : wrong length for argument
>
> Quite puzzling since g.dirseps does not give a message "unknown command" when 
> tried within grass (thus it is suppose to be in the GRASS programme)

That is because the GRASS environment variables have not been set at that 
point. Do you need to use GRASS in throw-away (initGRASS) mode, or with an 
existing location? If the latter, please use the interface in the regular 
way, starting R "within" GRASS. I'll try to reproduce the problem, but it 
is not easy to do, I'm afraid.

What is your sessionInfo()? Have you tried the WinGRASS stand-alone (I 
haven't trusted either QGIS GRASS used this way or OSGeo4W - I follow the 
bug-tracker for OSGEO4W, so stay away)?

Would you mind moving to the proper list - this is a GRASS question much 
more than an R one:

http://lists.osgeo.org/mailman/listinfo/grass-stats

Roger

>
> Patrick
>
>
>
> Roger Bivand a ?crit :
>> On Mon, 7 Dec 2009, Patrick Giraudoux wrote:
>> 
>>> Here is the result:
>>> 
>>> library(spgrass6)
>>> 
>>> debug(initGRASS)
>>>> initGRASS("C:/OSGeo4W/bin",home="U:/Documents and 
>>> Settings/pgiraudo/",override=T)
>>> 
>>> (...)
>>> 
>>> Browse[2]>
>>> debug: gisrc <- system(paste("g.dirseps.exe -g", 
>>> shQuote(Sys.getenv("WINGISRC"))),
>>>   intern = TRUE)
>>> Browse[2]> Sys.getenv("WINGISRC")
>>>                                       WINGISRC
>>> "U:/Documents and Settings/pgiraudo/\\.grassrc6"
>>> Browse[2]> shQuote(Sys.getenv("WINGISRC"))
>>> [1] "\"U:/Documents and Settings/pgiraudo/\\.grassrc6\""
>>> Browse[2]> gisrc
>>> Error: object 'gisrc' not found
>> 
>> Could you try both not setting home= (you get a temporary folder that is 
>> deleted when you exit R), or setting
>> 
>> home="U:\\Documents and Settings\\pgiraudo"
>> 
>> without the trailing forward slash?
>> 
>> This a problem connected to protecting spaces on the one hand and system 
>> specific directory separators on the other, I think.
>> 
>> Roger
>> 
>>> 
>>> Beforehand, the first time I run 
>>> initGRASS("C:/OSGeo4W/bin",home="U:/Documents and 
>>> Settings/pgiraudo/",override=T), I got:
>>> 
>>> initGRASS("C:/OSGeo4W/bin",home="U:/Documents and 
>>> Settings/pgiraudo/",override=T)
>>> Error in system(paste("g.dirseps.exe -g", 
>>> shQuote(Sys.getenv("WINGISRC"))), :
>>> g.dirseps.exe not found
>>> 
>>> Then, if I try the same commande on QGIS Metis, I got:
>>> initGRASS("C:/Program Files/Quantum GIS/grass",home="U:/Documents and 
>>> Settings/pgiraudo",override=T)
>>> Error in Sys.setenv(GISRC = gisrc) : wrong length for argument
>>> 
>>> 
>>> Best,
>>> 
>>> Patrick
>>> 
>>> 
>>> 
>>> 
>>> 
>>> 
>>> 
>>> Roger Bivand a ?crit :
>>>> On Sun, 6 Dec 2009, Patrick Giraudoux wrote:
>>>> 
>>>>> Dear all,
>>>>> 
>>>>> I am trying to init a GRASS session from within R, using the function 
>>>>> initGRASS from the package spgrass6. GRASS is installed in two ways on 
>>>>> my computer (here, the OS is Windows XP): with QGIS metis (precompiled 
>>>>> version including grass 6.3 (2008)) and grass 6.4.0svn, just freshly 
>>>>> installed with the Osgeo4W installer.
>>>>> 
>>>>> In both cases I get the same result:
>>>>> 
>>>>>> initGRASS("C:/Program Files/Quantum GIS/grass",home="U:/Documents and 
>>>>> Settings/pgiraudo",override=T)
>>>>> Error in Sys.setenv(GISRC = gisrc) : wrong length for argument
>>>>> 
>>>>>> initGRASS("C:/OSGeo4W/bin",home="U:/Documents and 
>>>>> Settings/pgiraudo",override=T)
>>>>> Error in Sys.setenv(GISRC = gisrc) : wrong length for argument
>>>>> 
>>>>> Any idea about what happens ?
>>>> 
>>>> No, without the output of traceback(), it isn't obvious, although here 
>>>> traceback() might not help. Run under debug(initGRASS) to the step 
>>>> before, that is:
>>>>
>>>>         gisrc <- system(paste("g.dirseps.exe -g",
>>>>             shQuote(Sys.getenv("WINGISRC"))), intern=TRUE)
>>>> 
>>>> then run:
>>>> 
>>>> Sys.getenv("WINGISRC")
>>>> shQuote(Sys.getenv("WINGISRC"))
>>>> gisrc
>>>> 
>>>> and try to see what is going on. At this stage, Sys.getenv("GISRC") 
>>>> should be "junk", assigned a couple of lines earlier.
>>>> 
>>>> Maybe the grass-stats list would have a higher proportion of users of 
>>>> both GRASS and R.
>>>> 
>>>> Hope this helps,
>>>> 
>>>> Roger
>>>> 
>>>>> 
>>>>> Patrick
>>>>> 
>>>> 
>>> 
>>> 
>> 
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From alexandre.villers at cebc.cnrs.fr  Mon Dec  7 15:09:17 2009
From: alexandre.villers at cebc.cnrs.fr (Alexandre VILLERS)
Date: Mon, 07 Dec 2009 15:09:17 +0100
Subject: [R-sig-Geo] problem saving spplot in a loop
Message-ID: <4B1D0C8D.2000807@cebc.cnrs.fr>

Hey,

I wrote a loop and want to save plots of multiple 
SpatialPolygonDataFrame objects with something like

png(paste("K:/Outarde/ADrien/FigTemp/PGR",l,"_",j,".png",sep=""), 
height=1000, width=2000,res=300)
b<-spplot(grTs[,c("PGRobs04","PGRobs48")], 
col.regions=palAb(30)            
dev.off()

and

png(paste("K:/Outarde/ADrien/FigTemp/Abondance",l,"_",j,".png",sep=""), 
height=1000, width=3000,res=300)
spplot(grTs[,c("ov2000","ov2004","ov2008")], 
col.regions=palAb(17),at=cutsAb)
dev.off()

When I run "manually" the code (specifying the l and j values for the 
loop), everything is fine and I get nice png files. When the code loops 
on its own, I get blank images. I suspect this is a problem of the time 
taken by spplot to build the image in time for saving in the loop.
Is this correct and how can I properly overcome this problem ?

Best regards

Alex

-- 
Alexandre Villers
PhD Candidate
AgriPop
Centre d'Etudes Biologiques de Chiz?-CNRS UPR1934
79360 Beauvoir sur Niort

Phone +33 (0)5 49 09 96 13
Fax   +33 (0)5 49 09 65 26




__________ Information from ESET Mail Security, version of virus signature database 4667 (20091207) __________

The message was checked by ESET Mail Security.
http://www.eset.com


From Henk.Sierdsema at sovon.nl  Mon Dec  7 15:15:31 2009
From: Henk.Sierdsema at sovon.nl (Henk Sierdsema)
Date: Mon, 7 Dec 2009 15:15:31 +0100
Subject: [R-sig-Geo] problem saving spplot in a loop
In-Reply-To: <4B1D0C8D.2000807@cebc.cnrs.fr>
Message-ID: <F7A3EE6B27F4D54B9CCAAB767F1B5AA3FDB993@mail.sovon.nl>

Hi Alex,

You have to assign the plot to a temporary variable (like tmp <- spplot(...)) and then use print(tmp1) to save it in the png-file

so somethink like:

tmp <- spplot(...)
png(filename=...)
print(tmp)
dev.off()


Succes!


Henk
-------------------------


Henk Sierdsema 

SOVON Vogelonderzoek Nederland / SOVON Dutch Centre for Field Ornithology 

Rijksstraatweg 178 
6573 DG Beek-Ubbergen 
The Netherlands 
tel: +31 (0)24 6848145 
fax: +31 (0)24 6848122 




-----Oorspronkelijk bericht-----
Van: r-sig-geo-bounces at stat.math.ethz.ch
[mailto:r-sig-geo-bounces at stat.math.ethz.ch]Namens Alexandre VILLERS
Verzonden: maandag 7 december 2009 15:09
Aan: Aide R SIG GEO
Onderwerp: [R-sig-Geo] problem saving spplot in a loop


Hey,

I wrote a loop and want to save plots of multiple 
SpatialPolygonDataFrame objects with something like

png(paste("K:/Outarde/ADrien/FigTemp/PGR",l,"_",j,".png",sep=""), 
height=1000, width=2000,res=300)
b<-spplot(grTs[,c("PGRobs04","PGRobs48")], 
col.regions=palAb(30)            
dev.off()

and

png(paste("K:/Outarde/ADrien/FigTemp/Abondance",l,"_",j,".png",sep=""), 
height=1000, width=3000,res=300)
spplot(grTs[,c("ov2000","ov2004","ov2008")], 
col.regions=palAb(17),at=cutsAb)
dev.off()

When I run "manually" the code (specifying the l and j values for the 
loop), everything is fine and I get nice png files. When the code loops 
on its own, I get blank images. I suspect this is a problem of the time 
taken by spplot to build the image in time for saving in the loop.
Is this correct and how can I properly overcome this problem ?

Best regards

Alex

-- 
Alexandre Villers
PhD Candidate
AgriPop
Centre d'Etudes Biologiques de Chiz?-CNRS UPR1934
79360 Beauvoir sur Niort

Phone +33 (0)5 49 09 96 13
Fax   +33 (0)5 49 09 65 26




__________ Information from ESET Mail Security, version of virus signature database 4667 (20091207) __________

The message was checked by ESET Mail Security.
http://www.eset.com

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at stat.math.ethz.ch
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From p.hiemstra at geo.uu.nl  Mon Dec  7 16:47:30 2009
From: p.hiemstra at geo.uu.nl (Paul Hiemstra)
Date: Mon, 07 Dec 2009 16:47:30 +0100
Subject: [R-sig-Geo] plotting 100 variograms on the same plot
In-Reply-To: <e027b8750912050337q23fb772ar1612b20fcf4b56a5@mail.gmail.com>
References: <e027b8750912040453n393d8317s9eba93867b6a1b01@mail.gmail.com>	
	<4B191FEF.40107@geo.uu.nl> <4B1921C3.10202@geo.uu.nl>
	<e027b8750912050337q23fb772ar1612b20fcf4b56a5@mail.gmail.com>
Message-ID: <4B1D2392.2050800@geo.uu.nl>

Hi,

I think the only thing you need to change is the call to xyplot:

# So instead of "| identification" use groups = identification
xyplot(gamma ~ dist, groups = identification, sv_list,
panel = function(...) {
panel.xyplot(...) # points of the sample var
ret = variogramLine(model_list[[panel.number()]], maxdist = 
max(sv_list$dist))
llines(ret$dist, ret$gamma, col = "red")
})

This example above doesn't illustrate this point clearly, but it should 
work. You can choose to not show the sample variogram but only the 
models, comment the line "panel.xyplot(...)" in the call to xyplot to do 
this.

# So instead of "| identification" use groups = identification
xyplot(gamma ~ dist, groups = identification, sv_list,
panel = function(...) {
#panel.xyplot(...) # points of the sample var
ret = variogramLine(model_list[[panel.number()]], maxdist = 
max(sv_list$dist))
llines(ret$dist, ret$gamma, col = "red")
})

cheers,
Paul


Laura Poggio schreef:
> Thank you very much for the code, that helped me a lot to organise my 
> variograms objects!
> Now what I am trying to get is a plot with all 100 variograms 
> overlapping, to show the spread due to simulations from a 
> distribution. Is this possible with the xyplot function?
>
> Thank you very much!
>
> Laura
>
>
>
> 2009/12/4 Paul Hiemstra <p.hiemstra at geo.uu.nl 
> <mailto:p.hiemstra at geo.uu.nl>>
>
>     Paul Hiemstra wrote:
>
>         Laura Poggio wrote:
>
>             Dear all,
>             I would like to plot 100 variograms on the same plot,
>             possibly using a loop.
>
>             At the moment I am using autofitVariogram in the package
>             Automap to fit the
>             variograms automatically.
>             I found some code calling the lattice package (
>             http://tolstoy.newcastle.edu.au/R/e7/help/09/06/0940.html),
>             but it is giving
>             some problems for high numbers of variograms.
>
>             Thank you very much in advance!
>
>             Laura
>
>             [[alternative HTML version deleted]]
>
>             _______________________________________________
>             R-sig-Geo mailing list
>             R-sig-Geo at stat.math.ethz.ch
>             <mailto:R-sig-Geo at stat.math.ethz.ch>
>             https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>         Hi Laura,
>
>         The trick is to organize your data, an example using the meuse
>         dataset:
>
>         library(lattice)
>
>     ...and ofcourse you need to do:
>
>     library(automap)
>
>
>         # Make a dataset with 100 fitted variogram models
>         # Don't know how you've organized your 100 models,
>         # But I put them in a list.
>         data(meuse)
>         coordinates(meuse) =~ x+y
>         av_list = lapply(1:100, function(x) autofitVariogram(zinc~1,
>         meuse))
>
>         # Now extract the sample variograms, add an extra
>         # identification column to them and rbind them together
>         sv_list = do.call("rbind", lapply(1:length(av_list), function(x) {
>         sv = av_list[[x]]$exp_var
>         sv$identification = as.character(x)
>         return(sv)
>         }))
>
>         # Make a list of fitted models
>         model_list = lapply(av_list, function(x) x$var_model)
>
>         # Make the plot, notice the formula part!
>         # I use panel.number(), the current panel number,
>         # to extract the appropriate variogram model
>         xyplot(gamma ~ dist | identification, sv_list,
>         panel = function(...) {
>         panel.xyplot(...) # points of the sample var
>         ret = variogramLine(model_list[[panel.number()]], maxdist =
>         max(sv_list$dist))
>         llines(ret$dist, ret$gamma, col = "red")
>         })
>
>         cheers,
>         Paul
>
>
>
>     -- 
>     Drs. Paul Hiemstra
>     Department of Physical Geography
>     Faculty of Geosciences
>     University of Utrecht
>     Heidelberglaan 2
>     P.O. Box 80.115
>     3508 TC Utrecht
>     Phone:  +3130 274 3113 Mon-Tue
>     Phone:  +3130 253 5773 Wed-Fri
>     http://intamap.geo.uu.nl/~paul <http://intamap.geo.uu.nl/%7Epaul>
>
>


From karl at huftis.org  Mon Dec  7 17:05:50 2009
From: karl at huftis.org (Karl Ove Hufthammer)
Date: Mon, 7 Dec 2009 17:05:50 +0100
Subject: [R-sig-Geo] 'xyValues' from 'raster' package slow
References: <MPG.257f26584a2eaee69896bb@news.gmane.org>
	<dc22b2570912011029q7fe2ba2cua8139b4425ae1cdc@mail.gmail.com>
	<dc22b2570912011314la5d727wed926f53f900d91b@mail.gmail.com>
Message-ID: <MPG.2587464ae63cd7c69896c0@news.gmane.org>

On Tue, 1 Dec 2009 13:14:33 -0800 Robert J. Hijmans 
<r.hijmans at gmail.com> wrote:
> Karl and others: There is a new version of xyValues (in raster version
> 0.9.8-31)  that --in a single test-- is 30 times faster then the
> previous version (for files read with rgdal; I have not yet updated
> the function for the 'native formats'). 

It is certainly faster for my data too (though still quite slow). 
Thanks.

(And regarding your last message: My data are not in a rectangular area, 
or inside a small rectangular area, so I have to use the slow method.)

-- 
Karl Ove Hufthammer


From p.hiemstra at geo.uu.nl  Mon Dec  7 17:48:52 2009
From: p.hiemstra at geo.uu.nl (Paul Hiemstra)
Date: Mon, 07 Dec 2009 17:48:52 +0100
Subject: [R-sig-Geo] problem saving spplot in a loop
In-Reply-To: <F7A3EE6B27F4D54B9CCAAB767F1B5AA3FDB993@mail.sovon.nl>
References: <F7A3EE6B27F4D54B9CCAAB767F1B5AA3FDB993@mail.sovon.nl>
Message-ID: <4B1D31F4.3060209@geo.uu.nl>

Hi,

This is a byproduct of the fact that under the hood spplot uses lattice 
commands (levelplot and xyplot) to make the plots. This behavior is a 
FAQ for lattice commands, and thus spplot. Even shorter than Henk's 
suggestion is to use:

png(filename=...)
print(spplot(...))
dev.off()

cheers,
Paul

Henk Sierdsema schreef:
> Hi Alex,
>
> You have to assign the plot to a temporary variable (like tmp <- spplot(...)) and then use print(tmp1) to save it in the png-file
>
> so somethink like:
>
> tmp <- spplot(...)
> png(filename=...)
> print(tmp)
> dev.off()
>
>
> Succes!
>
>
> Henk
> -------------------------
>
>
> Henk Sierdsema 
>
> SOVON Vogelonderzoek Nederland / SOVON Dutch Centre for Field Ornithology 
>
> Rijksstraatweg 178 
> 6573 DG Beek-Ubbergen 
> The Netherlands 
> tel: +31 (0)24 6848145 
> fax: +31 (0)24 6848122 
>
>
>
>
> -----Oorspronkelijk bericht-----
> Van: r-sig-geo-bounces at stat.math.ethz.ch
> [mailto:r-sig-geo-bounces at stat.math.ethz.ch]Namens Alexandre VILLERS
> Verzonden: maandag 7 december 2009 15:09
> Aan: Aide R SIG GEO
> Onderwerp: [R-sig-Geo] problem saving spplot in a loop
>
>
> Hey,
>
> I wrote a loop and want to save plots of multiple 
> SpatialPolygonDataFrame objects with something like
>
> png(paste("K:/Outarde/ADrien/FigTemp/PGR",l,"_",j,".png",sep=""), 
> height=1000, width=2000,res=300)
> b<-spplot(grTs[,c("PGRobs04","PGRobs48")], 
> col.regions=palAb(30)            
> dev.off()
>
> and
>
> png(paste("K:/Outarde/ADrien/FigTemp/Abondance",l,"_",j,".png",sep=""), 
> height=1000, width=3000,res=300)
> spplot(grTs[,c("ov2000","ov2004","ov2008")], 
> col.regions=palAb(17),at=cutsAb)
> dev.off()
>
> When I run "manually" the code (specifying the l and j values for the 
> loop), everything is fine and I get nice png files. When the code loops 
> on its own, I get blank images. I suspect this is a problem of the time 
> taken by spplot to build the image in time for saving in the loop.
> Is this correct and how can I properly overcome this problem ?
>
> Best regards
>
> Alex
>
>


From zua3 at cornell.edu  Mon Dec  7 19:36:48 2009
From: zua3 at cornell.edu (Zia Ahmed)
Date: Mon, 07 Dec 2009 13:36:48 -0500
Subject: [R-sig-Geo] Memory issue in R gstat:  Windows vs Linux (Ubuntu)
In-Reply-To: <MPG.2587464ae63cd7c69896c0@news.gmane.org>
References: <MPG.257f26584a2eaee69896bb@news.gmane.org>	<dc22b2570912011029q7fe2ba2cua8139b4425ae1cdc@mail.gmail.com>	<dc22b2570912011314la5d727wed926f53f900d91b@mail.gmail.com>
	<MPG.2587464ae63cd7c69896c0@news.gmane.org>
Message-ID: <4B1D4B40.7060709@cornell.edu>

If someone facing  problem to analyze large data set in gstat in Windows 
due to memory issue,  they can try in Ubuntu using  "R-gedit". It is 
very easy to install  Ubuntu  in  a Windows  machine (as a dual booting 
system- not as a guest OS!). After installing r with all necessary 
packages user need to update gedit with R-gedit.   R-gedit allows to a 
run r-script.  Here are the links for installation  instruction:  

_Installing Ubuntu in vista machine_

http://apcmag.com/how_to_dualboot_vista_with_linux_vista_installed_first.htm?page=2 


For R:

http://edtechdev.blogspot.com/2009/03/r-in-ubuntu-intrepid.html

For r-gedit:

http://sourceforge.net/projects/rgedit/



Zia
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20091207/95643ef7/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: zua3.vcf
Type: text/x-vcard
Size: 281 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20091207/95643ef7/attachment.vcf>

From mtb954 at gmail.com  Mon Dec  7 20:06:31 2009
From: mtb954 at gmail.com (Mark Na)
Date: Mon, 7 Dec 2009 13:06:31 -0600
Subject: [R-sig-Geo] Convert a list of N dataframes to N dataframes
Message-ID: <e40d78ce0912071106v5cb876f0sd1aed86a5cc8a183@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20091207/dc11f487/attachment.pl>

From h.wickham at gmail.com  Mon Dec  7 20:41:02 2009
From: h.wickham at gmail.com (hadley wickham)
Date: Mon, 7 Dec 2009 13:41:02 -0600
Subject: [R-sig-Geo] Convert a list of N dataframes to N dataframes
In-Reply-To: <e40d78ce0912071106v5cb876f0sd1aed86a5cc8a183@mail.gmail.com>
References: <e40d78ce0912071106v5cb876f0sd1aed86a5cc8a183@mail.gmail.com>
Message-ID: <f8e6ff050912071141w4d517a7eqca64b7cdea5e268e@mail.gmail.com>

On Mon, Dec 7, 2009 at 1:06 PM, Mark Na <mtb954 at gmail.com> wrote:
> Hello,
>
> I have used the following command:
>
> datalist<-list(data1,data2,data3,data4,data5,data6)
>
> to make a list of my dataframes, which I then manipulated with these
> commands:
>
> datalist<-llply(datalist,"LogDepth")
> datalist<-llply(datalist,"LogArea")
> datalist<-llply(datalist,"p")
> datalist<-llply(datalist,"Exp")
> datalist<-llply(datalist,"s")
>
> This worked very nicely (thanks for plyr, Hadley) but now I would like to
> "unlist" my list into the individual dataframes, preferably with their
> original names (data1, etc).
>
> I've tried to do this with:
>
>> ldply(datalist,unlist)

ldply(datalist)

should be adequate.

Hadley


-- 
http://had.co.nz/


From Adrian.Baddeley at csiro.au  Tue Dec  8 02:48:02 2009
From: Adrian.Baddeley at csiro.au (Adrian.Baddeley at csiro.au)
Date: Tue, 8 Dec 2009 09:48:02 +0800
Subject: [R-sig-Geo] intersection coordinates of two polygons
In-Reply-To: <mailman.11.1260010804.9422.r-sig-geo@stat.math.ethz.ch>
References: <mailman.11.1260010804.9422.r-sig-geo@stat.math.ethz.ch>
Message-ID: <57DC18C299094D4299F837570C5DF1C502D037C3C6@EXWA-MBX01.nexus.csiro.au>

Mark Trinder <Mark.Trinder at rpsgroup.com> writes:

> Is there a way to output the coordinates of the intersections of two
> polygons? 

In the 'spatstat' package, if A and B are two polygons (objects of class 'owin'
with type 'polygonal') then 
        crossing.psp(as.psp(A), as.psp(B))
returns a point pattern consisting of the intersection points between the edges of the
two polygons. 

Adrian Baddeley

From miguez at illinois.edu  Tue Dec  8 15:51:17 2009
From: miguez at illinois.edu (Fernando Miguez)
Date: Tue, 08 Dec 2009 09:51:17 -0500
Subject: [R-sig-Geo] Appending to ascii grid
Message-ID: <4B1E67E5.9080900@illinois.edu>

Hi all,

In write.asciigrid ... will pass arguments to write.table. I tried to 
append data (i.e. append=TRUE) and this didn't seem to have the desired 
effect. Is it possible to do this?

If not, does anybody have a suggestion for building a large raster (any 
format) from subsets of data?

Thank you,

Fernando

-- 
Fernando E. Miguez
Energy Biosciences Institute
https://netfiles.uiuc.edu/miguez/www/


From miguez at illinois.edu  Tue Dec  8 15:56:02 2009
From: miguez at illinois.edu (Fernando Miguez)
Date: Tue, 08 Dec 2009 09:56:02 -0500
Subject: [R-sig-Geo] Appending to ascii grid
In-Reply-To: <4B1E67E5.9080900@illinois.edu>
References: <4B1E67E5.9080900@illinois.edu>
Message-ID: <4B1E6902.40807@illinois.edu>

Answer to my self.

Is gdal_merge the best option?

Fernando Miguez wrote:
> Hi all,
> 
> In write.asciigrid ... will pass arguments to write.table. I tried to 
> append data (i.e. append=TRUE) and this didn't seem to have the desired 
> effect. Is it possible to do this?
> 
> If not, does anybody have a suggestion for building a large raster (any 
> format) from subsets of data?
> 
> Thank you,
> 
> Fernando
> 

-- 
Fernando E. Miguez
Energy Biosciences Institute
https://netfiles.uiuc.edu/miguez/www/


From tom.gottfried at wzw.tum.de  Tue Dec  8 16:18:59 2009
From: tom.gottfried at wzw.tum.de (Tom Gottfried)
Date: Tue, 08 Dec 2009 16:18:59 +0100
Subject: [R-sig-Geo] equations for cross variograms (Applied Spatial Data
 Analysis with R)
Message-ID: <4B1E6E63.4040909@wzw.tum.de>

Hi all,

two questions about the equations on page 206 of the ASDAR book:

1) is it possible, that in the first one, there is "1/2" missing before the expression of the
expected value? I looked in some books and papers and it's always there.


2) is there any literature that could help me understand the second equation (for non-collocated
data). Mostly the pseudo-cross semivariance is mentioned for use with non-collocated data and is
expressed as half the variance of differences such as

gamma_ij(h)=1/2 Var[Z_i(x+h) - Z_j(x)]

Is this the same as what is expressed by the second equation on page 206 of the ASDAR book and thus
what is calculated by gstat::variogram?

Thank you very much!

Tom


From zua3 at cornell.edu  Tue Dec  8 20:32:33 2009
From: zua3 at cornell.edu (Zia Ahmed)
Date: Tue, 08 Dec 2009 14:32:33 -0500
Subject: [R-sig-Geo] Moving window correlation
In-Reply-To: <4B16DE64.8070403@gmail.com>
References: <4B16DE64.8070403@gmail.com>
Message-ID: <4B1EA9D1.20602@cornell.edu>


I have two grid maps (100 m cell size). I want to a create another  
raster gird  of  correlation  coefficient ( r value) of  two maps using  
moving windows approach.  Has someone  any idea how to do it in R?

Thanks

Zia

-------------- next part --------------
A non-text attachment was scrubbed...
Name: zua3.vcf
Type: text/x-vcard
Size: 281 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20091208/09fd7de7/attachment.vcf>

From jaime.garcia at uni-bonn.de  Tue Dec  8 21:54:35 2009
From: jaime.garcia at uni-bonn.de (Jaime R. Garcia M.)
Date: Tue, 08 Dec 2009 21:54:35 +0100
Subject: [R-sig-Geo] Moving window correlation
In-Reply-To: <4B1EA9D1.20602@cornell.edu>
References: <4B16DE64.8070403@gmail.com>  <4B1EA9D1.20602@cornell.edu>
Message-ID: <1260305675.3311.34.camel@jaime>

On Tue, 2009-12-08 at 14:32 -0500, Zia Ahmed wrote:
> I have two grid maps (100 m cell size). I want to a create another  
> raster gird  of  correlation  coefficient ( r value) of  two maps using  
> moving windows approach.  Has someone  any idea how to do it in R?
> 
> Thanks
> 
> Zia
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

Dear Zia,

Some time ago I did exactly that and the script was based on a earlier
post by Prof. Roger Bivand in this list. (Sorry I couldn't find the link
anymore)

Suppose "G1" and "G2" are the two grid maps.
I assume they are "SpatialGridDataFrames" and have exactly the same
extent and number of columns and rows. Also that you have libraries (sp)
and (spdep) loaded

# Define the size of the moving window, for example (7*7) so you have
enough neighbors for reliable correlation estimation:

dist = sqrt(2*((100*3)^2))

# Create a list of neighbours for the distance criteria
nb <- dnearneigh(coordinates(G1),0, dist) 

# And then calculate correlations
v <- sapply(nb, function(i) cor(G1 at data, G2 at data))

# The result should be a matrix if I am not wrong, so I did transpose it
and converted it to a data frame

v = as.data.frame(t(v))

# And finally I created a new grid map:
coordinates(v) = coordinates(G1)
gridded(v) = TRUE
fullgrid(v) = TRUE

I did not run the script above...

Hope this helps,

Jaime -R.


From edzer.pebesma at uni-muenster.de  Wed Dec  9 00:02:45 2009
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Wed, 09 Dec 2009 00:02:45 +0100
Subject: [R-sig-Geo] equations for cross variograms (Applied Spatial
 Data Analysis with R)
In-Reply-To: <4B1E6E63.4040909@wzw.tum.de>
References: <4B1E6E63.4040909@wzw.tum.de>
Message-ID: <4B1EDB15.80906@uni-muenster.de>



Tom Gottfried wrote:
> Hi all,
>
> two questions about the equations on page 206 of the ASDAR book:
>
> 1) is it possible, that in the first one, there is "1/2" missing before the expression of the
> expected value? I looked in some books and papers and it's always there.
>   
Yes, it's missing. Luckily it's not missing in the software (I believe!)
>
> 2) is there any literature that could help me understand the second equation (for non-collocated
> data). Mostly the pseudo-cross semivariance is mentioned for use with non-collocated data and is
> expressed as half the variance of differences such as
>
> gamma_ij(h)=1/2 Var[Z_i(x+h) - Z_j(x)]
>
> Is this the same as what is expressed by the second equation on page 206 of the ASDAR book and thus
> what is calculated by gstat::variogram?
>   
No, you found another mistake in the book. The correct equation for
non-collocated data should be

gamma_ij(h) = 1/2 E(((Z_1(s) - m_1) - (Z_2(s+h) - m_2))^2)

which is equivalent with what you give, when Z_1 and Z_2 have constant
means m_1 and m_2 respectively. Again, this is what the software does.
> Thank you very much!
>   
Thank you, we'll update the Errata pages on www.asdar-book.org.
> Tom
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>   

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763 http://ifgi.uni-muenster.de/
http://www.springer.com/978-0-387-78170-9 e.pebesma at wwu.de


From rusers.sh at gmail.com  Wed Dec  9 02:22:25 2009
From: rusers.sh at gmail.com (rusers.sh)
Date: Tue, 8 Dec 2009 20:22:25 -0500
Subject: [R-sig-Geo] convert KML file into shape file or CSV file
Message-ID: <a835c81e0912081722o4d35b198y25d38ce41d9495a8@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20091208/4775a3de/attachment.pl>

From jaime.garcia at uni-bonn.de  Wed Dec  9 03:21:29 2009
From: jaime.garcia at uni-bonn.de (Jaime R. Garcia M.)
Date: Wed, 09 Dec 2009 03:21:29 +0100
Subject: [R-sig-Geo] Moving window correlation
In-Reply-To: <1260305675.3311.34.camel@jaime>
References: <4B16DE64.8070403@gmail.com>  <4B1EA9D1.20602@cornell.edu>
	<1260305675.3311.34.camel@jaime>
Message-ID: <1260325289.2631.27.camel@jaime>

On Tue, 2009-12-08 at 21:54 +0100, Jaime R. Garcia M. wrote:
> On Tue, 2009-12-08 at 14:32 -0500, Zia Ahmed wrote:
> > I have two grid maps (100 m cell size). I want to a create another  
> > raster gird  of  correlation  coefficient ( r value) of  two maps using  
> > moving windows approach.  Has someone  any idea how to do it in R?
> > 
> > Thanks
> > 
> > Zia
> > 
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at stat.math.ethz.ch
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 
> Dear Zia,
> 
> Some time ago I did exactly that and the script was based on a earlier
> post by Prof. Roger Bivand in this list. (Sorry I couldn't find the link
> anymore)
> 
> Suppose "G1" and "G2" are the two grid maps.
> I assume they are "SpatialGridDataFrames" and have exactly the same
> extent and number of columns and rows. Also that you have libraries (sp)
> and (spdep) loaded
> 
> # Define the size of the moving window, for example (7*7) so you have
> enough neighbors for reliable correlation estimation:
> 
> dist = sqrt(2*((100*3)^2))
> 
> # Create a list of neighbours for the distance criteria
> nb <- dnearneigh(coordinates(G1),0, dist) 
> 
> # And then calculate correlations
> v <- sapply(nb, function(i) cor(G1 at data, G2 at data))

# Small correction

v = sapply(nb, function(i) cor(G1 at data[i,], G2 at data[i,]))

#  And in this case the result should be a numeric vector

coordinates(v) = coordinates(G1)
gridded(v) = TRUE
fullgrid(v) = TRUE
_______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From tech_dev at wildintellect.com  Wed Dec  9 07:38:45 2009
From: tech_dev at wildintellect.com (Alex Mandel)
Date: Tue, 08 Dec 2009 22:38:45 -0800
Subject: [R-sig-Geo] convert KML file into shape file or CSV file
In-Reply-To: <a835c81e0912081722o4d35b198y25d38ce41d9495a8@mail.gmail.com>
References: <a835c81e0912081722o4d35b198y25d38ce41d9495a8@mail.gmail.com>
Message-ID: <4B1F45F5.7000608@wildintellect.com>

rusers.sh wrote:
> Hi all,
>   Does anybody know how to import a KML file in R and them save it as a
> shape or CSV file. Take the following KML file as an example,
> http://www.nature.com/nature/googleearth/avianflu1.kml
>   I have tried several extentions of
> ARCGIS,e.g.KML2Shape,KMLCSVConverter,KMLCSVConverter and XToolsPro, but
> unfortunately failed to do that. I didnot find a method to solve it in R.
>  If this cannot be done in R, i'd like to see your alternative method to do
> that.
>   Any help or suggestions are greatly appreciated.
> 

The way to do it in R is with the rgdal library (install.packages("rgdal")

-- psuedo code --
library(rgdal)
readOGR("pathtofile",layer.kml)
writeOGR("pathtooutput",driver="ESRI Shapefile",layer=output.shp)
-- end of fake code example --

but if you have the rgdal library that means you also have GDAL/OGR
installed and could just us the command line on your system:
ogr2ogr -f "ESRI Shapefile" nameof.shp file.kml

In this particular case, I tried with the file you linked. Turns out
it's not a valid KML file, at least according to OGC standards.
After failing to get any of my GIS tools to read it I checked it using
http://kmlvalidator.com/home.htm
It returns several Errors.

There's a good chance the file still works in Google Earth but nothing
else seems to be able to figure it out.

Alex


From cara.tobin at epfl.ch  Wed Dec  9 11:37:58 2009
From: cara.tobin at epfl.ch (Tobin Cara)
Date: Wed, 9 Dec 2009 11:37:58 +0100
Subject: [R-sig-Geo] zscore for krige.cv with IDW
Message-ID: <EDB94195DABE64488928DD39E53B8FC68BDFD3E921@REX2.intranet.epfl.ch>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20091209/de643ef8/attachment.pl>

From mark_connolly at acm.org  Wed Dec  9 14:10:48 2009
From: mark_connolly at acm.org (Mark Connolly)
Date: Wed, 09 Dec 2009 08:10:48 -0500
Subject: [R-sig-Geo] transforming a 3d SpatialGridDataFrame into a mesh of
	some kind
Message-ID: <4B1FA1D8.1040405@acm.org>

I have a 3d SpatialGridDataFrame I created using krige (IDW).  I am 
using rgl facilities to create an interactive plot of the points, but 
I'd really like to have something more volumetric than points.  My copy 
of the truly wonderful Applied Spatial Data Analysis with R (shameless 
pander) is pretty mute on 3d.  Any hints on where I might find something 
on transforming the points into a mesh?  Something I need to code for 
myself?


From b.rowlingson at lancaster.ac.uk  Wed Dec  9 14:32:40 2009
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Wed, 9 Dec 2009 13:32:40 +0000
Subject: [R-sig-Geo] convert KML file into shape file or CSV file
In-Reply-To: <a835c81e0912081722o4d35b198y25d38ce41d9495a8@mail.gmail.com>
References: <a835c81e0912081722o4d35b198y25d38ce41d9495a8@mail.gmail.com>
Message-ID: <d8ad40b50912090532h4693f581t6222ae8b7e9af8c2@mail.gmail.com>

On Wed, Dec 9, 2009 at 1:22 AM, rusers.sh <rusers.sh at gmail.com> wrote:
> Hi all,
> ?Does anybody know how to import a KML file in R and them save it as a
> shape or CSV file. Take the following KML file as an example,
> http://www.nature.com/nature/googleearth/avianflu1.kml
> ?I have tried several extentions of
> ARCGIS,e.g.KML2Shape,KMLCSVConverter,KMLCSVConverter and XToolsPro, but
> unfortunately failed to do that. I didnot find a method to solve it in R.
> ?If this cannot be done in R, i'd like to see your alternative method to do
> that.
> ?Any help or suggestions are greatly appreciated.
>

 As well as the validation problems reported by Alex Mandel, the
structure of this KML file isn't appropriate for straight conversion
to a shape or CSV file.

 It has several parts, some "NetworkLink" structures without URLs that
just provide some HTML info boxes, and some network link structures
that point to other kmz files. You can download these kmz files, unzip
them, and possibly convert them to other formats. For example, one of
the links is to:

http://www.declanbutler.info/Flumaps1/4_Human_cases/Maps_of_human_cases_by
period/Cases_by_period1.kmz

which when unzipped produces doc.kml and some png files for markers.
ogrinfo tells us:

$ ogrinfo doc.kml
Had to open data source read-only.
INFO: Open of `doc.kml'
      using driver `KML' successful.
1: Data (3D Point)
2: Data (3D Point)
3: Data (3D Point)
4: Data (3D Point)
5: Data (3D Point)
6: Data (3D Point)
7: Data (3D Point)
8: Data (3D Point)

 - which is a bit weird, 8 layers all called 'Data'. That makes it
hard to extract individual layers by name. So I edited the file and
renamed them Data to Data8....

 I can then read them in R:

> data2=readOGR("doc.kml","Data2")
> plot(data2)

 I can then use writeOGR to create shapefiles, but it's easier on the
command line:

$ mkdir shapefile
$ ogr2ogr -f "ESRI Shapefile" shapefile doc.kml

So there's umpteen things going on here, above and beyond any possible
structural problems with the KML in the first place:

1. The original KML file points to a bunch of KMZ files, and readOGR
isn't going to do all that work for you.
2. Even if it could do all that work, the KML is a complex structure
with all sorts of geographic and no-geographic entities and so it
can't bung it all into a simple shapefile
3. The individual KMZ files which do contain the data have multiple layers.
4. The layers within a KMZ file (or at least, the one I bothered to
look at) have identical names which breaks stuff.

Otherwise, it's easy! :)

Barry


From maikrenner at googlemail.com  Wed Dec  9 14:50:43 2009
From: maikrenner at googlemail.com (Maik Renner)
Date: Wed, 9 Dec 2009 14:50:43 +0100
Subject: [R-sig-Geo] Rshhs() import problem
Message-ID: <15789f2d0912090550l2d910e68h8d62ff559bf81fff@mail.gmail.com>

Dear R-Geographers,

I am trying to use the GSHHS shoreline data for annotating my maps.
I used Rgshhs() from the package maptools to import it into R as a
Spatial object.
However it seems that there is a problem due to the new version of
gshhs_2.0.zip.
In the help gshhs_1.11.zip is referred.

Here is my example:

>      NZx <- c(160,180)
>      NZy <- c(-50,-30)
> NZ <- Rgshhs("gshhs_c.b", xlim=NZx, ylim=NZy)
Error in Rgshhs("gshhs_c.b",  :
  Data not same version as software

Is this a bug in Rshhs() or do I need some external librarys?

Any suggestions welcome.
-- 
Maik Renner, Dipl. Hydrologist
TU Dresden Pienner Str. 23
 01737 Tharandt Germany
Tel.: +49 351 463-31341


From jthayn at ilstu.edu  Wed Dec  9 17:58:01 2009
From: jthayn at ilstu.edu (Jonathan Thayn)
Date: Wed, 9 Dec 2009 10:58:01 -0600
Subject: [R-sig-Geo] reading select values from a binary file
Message-ID: <FD872DE1-8372-4931-A626-A8376FF13612@ilstu.edu>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20091209/d820d3e1/attachment.pl>

From b.rowlingson at lancaster.ac.uk  Wed Dec  9 18:06:53 2009
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Wed, 9 Dec 2009 17:06:53 +0000
Subject: [R-sig-Geo] reading select values from a binary file
In-Reply-To: <FD872DE1-8372-4931-A626-A8376FF13612@ilstu.edu>
References: <FD872DE1-8372-4931-A626-A8376FF13612@ilstu.edu>
Message-ID: <d8ad40b50912090906r54d5a529m9343e721371eefde@mail.gmail.com>

On Wed, Dec 9, 2009 at 4:58 PM, Jonathan Thayn <jthayn at ilstu.edu> wrote:
> Hopefully there is a simple solution to this problem. I process really large satellite images in R and, in order to not offend the memory-limitation demi-gods, I open each row of the imagery one at a time, process it, write the results, and then open the next line. I use readBin() to open each line. ?For examaple, say I have the following file:
>
> writeBin(1:20,con="desktop/temp.bip",size=2,endian="big")
>
> which I can open using readBin():
>
> readBin("desktop/temp.bip","integer",size=2,endian="big",n=20)
>
> Now I want to open select values from the binary file, not a complete line. ?Say I want to read values 3, 7, and 10, process them, write the result, and then read values 4, 5, and 17. ?How do I direct readBin to those specific values? Thanks.

 You need to seek help. Or help(seek). Yes really.

Barry


-- 
blog: http://geospaced.blogspot.com/
web: http://www.maths.lancs.ac.uk/~rowlings
web: http://www.rowlingson.com/
twitter: http://twitter.com/geospacedman
pics: http://www.flickr.com/photos/spacedman


From r.hijmans at gmail.com  Wed Dec  9 18:20:34 2009
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Wed, 9 Dec 2009 09:20:34 -0800
Subject: [R-sig-Geo] transforming a 3d SpatialGridDataFrame into a mesh
	of some kind
In-Reply-To: <4B1FA1D8.1040405@acm.org>
References: <4B1FA1D8.1040405@acm.org>
Message-ID: <dc22b2570912090920y78fc13f6tdd48e6245ed0af85@mail.gmail.com>

Mark,

If spgdf is a SpatialGridDataFrame object

# install.packages("raster", repos="http://R-Forge.R-project.org")
library(raster)
plot3D(raster(spgdf))

Or you can have a look at the code:
getMethod("plot3D", 'RasterLayer')

Robert

On Wed, Dec 9, 2009 at 5:10 AM, Mark Connolly <mark_connolly at acm.org> wrote:
> I have a 3d SpatialGridDataFrame I created using krige (IDW). ?I am using
> rgl facilities to create an interactive plot of the points, but I'd really
> like to have something more volumetric than points. ?My copy of the truly
> wonderful Applied Spatial Data Analysis with R (shameless pander) is pretty
> mute on 3d. ?Any hints on where I might find something on transforming the
> points into a mesh? ?Something I need to code for myself?
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From michael.denslow at gmail.com  Wed Dec  9 18:27:15 2009
From: michael.denslow at gmail.com (Michael Denslow)
Date: Wed, 9 Dec 2009 12:27:15 -0500
Subject: [R-sig-Geo] Spatial R Courses
Message-ID: <b440a3f80912090927i63bd62d1m312c8b7b3d7eff09@mail.gmail.com>

Dear r-sig-geo,

I apologize if this is too off topic.

I am interested in taking a online or other distance learning course
in spatial analysis/programming.
An R course would be great, but I am also interested in other things
such as GRASS, Python or open web applications.

The only caveats are that it must be a graduate course in Geography
(or closely related field).

Thanks in advance for any ideas,

Michael

-- 
Michael Denslow

Graduate Student & Adjunct Instructor
I.W. Carpenter Jr. Herbarium [BOON]
Department of Biology
Appalachian State University
Boone, North Carolina U.S.A.
-- AND --
Communications Manager
Southeast Regional Network of Expertise and Collections
sernec.org

36.214177, -81.681480 +/- 3103 meters


From zua3 at cornell.edu  Wed Dec  9 18:48:13 2009
From: zua3 at cornell.edu (Zia Ahmed)
Date: Wed, 09 Dec 2009 12:48:13 -0500
Subject: [R-sig-Geo] Moving Windows Correlation----???
Message-ID: <4B1FE2DD.1030605@cornell.edu>

Dear Garcia,

Thank you so much! Before running my data, I have tested your code using 
"meuse" data. It works fine. But it produce following output like below 
from V1 to V3103. I do not understand what does the values in rows mean 
(1 to 4). Here is  the code that I used.  I have questions How do I plot 
r-values with coordinates. Is it possible to get p-value for each estimate?

Thanks again
Zia

*# R code:*
#----------
library(gstat)
library(sp)
library(spdep)

data(meuse)
data(meuse.grid)
coordinates(meuse) <- ~x + y
coordinates(meuse.grid) <- ~x + y
str(meuse.grid)

# GRID 1:
v1 <- variogram(log(zinc) ~ 1, meuse)
x1<-fit.variogram(v1, vgm(1, "Sph", 800, 1))
G1 <- krige(zinc ~ 1, meuse, meuse.grid, x1, nmax = 30)
gridded(G1)<-TRUE
# GRID-2:
v2 <- variogram(log(lead) ~ 1, meuse)
x2<-fit.variogram(v2, vgm(.1, "Sph", 1000, .6))
G2 <- krige(zinc ~ 1, meuse, meuse.grid, x2, nmax = 30)
gridded(G2)<-TRUE
# Mooving Windows Correlation
# Define the size of the moving window,
dist = sqrt(2*((40*3)^2))
# Create a list of neighbours for the distance criteria
nb <- dnearneigh(coordinates(G1),0, dist)
v = sapply(nb, function(i) cor(G1 at data[i,], G2 at data[i,]))

When I run following codes it shows error.

coordinates(v) = coordinates(G1)

Error in function (classes, fdef, mtable)  :
  unable to find an inherited method for function "coordinates<-", for 
signature "matrix"

gridded(v) = TRUE

Error in `gridded<-`(`*tmp*`, value = TRUE) :
  gridded<- only works for SpatialPoints[DataFrame] or 
SpatialGrid[DataFrame]

*
# Output #--------
*
       V1         V2         V3         V4         V5         V6          V7
1  0.9996752  0.9996896  0.9997172 0.99971074  0.9996085  0.9996784  
0.99972521
2 -0.3807374 -0.3576051 -0.2260482 0.05467783 -0.2882067 -0.2124191 
-0.08551635
3 -0.3943537 -0.3750882 -0.2435564 0.03511977 -0.3081105 -0.2300869 
-0.10426607
4  0.9999324  0.9999349  0.9999442 0.99994815  0.9999047  0.9999104  
0.99992347



Jaime R. Garcia M. wrote:
> On Tue, 2009-12-08 at 21:54 +0100, Jaime R. Garcia M. wrote:
>   
>> On Tue, 2009-12-08 at 14:32 -0500, Zia Ahmed wrote:
>>     
>>> I have two grid maps (100 m cell size). I want to a create another  
>>> raster gird  of  correlation  coefficient ( r value) of  two maps using  
>>> moving windows approach.  Has someone  any idea how to do it in R?
>>>
>>> Thanks
>>>
>>> Zia
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>       
>> Dear Zia,
>>
>> Some time ago I did exactly that and the script was based on a earlier
>> post by Prof. Roger Bivand in this list. (Sorry I couldn't find the link
>> anymore)
>>
>> Suppose "G1" and "G2" are the two grid maps.
>> I assume they are "SpatialGridDataFrames" and have exactly the same
>> extent and number of columns and rows. Also that you have libraries (sp)
>> and (spdep) loaded
>>
>> # Define the size of the moving window, for example (7*7) so you have
>> enough neighbors for reliable correlation estimation:
>>
>> dist = sqrt(2*((100*3)^2))
>>
>> # Create a list of neighbours for the distance criteria
>> nb <- dnearneigh(coordinates(G1),0, dist) 
>>
>> # And then calculate correlations
>> v <- sapply(nb, function(i) cor(G1 at data, G2 at data))
>>     
>
> # Small correction
>
> v = sapply(nb, function(i) cor(G1 at data[i,], G2 at data[i,]))
>
> #  And in this case the result should be a numeric vector
>
> coordinates(v) = coordinates(G1)
> gridded(v) = TRUE
> fullgrid(v) = TRUE
> _______________________________________________
>   
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>     
>
>
>   
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20091209/e6df660a/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: zua3.vcf
Type: text/x-vcard
Size: 281 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20091209/e6df660a/attachment.vcf>

From reeves at nceas.ucsb.edu  Wed Dec  9 19:20:53 2009
From: reeves at nceas.ucsb.edu (rick reeves)
Date: Wed, 09 Dec 2009 10:20:53 -0800
Subject: [R-sig-Geo] reading select values from a binary file
In-Reply-To: <d8ad40b50912090906r54d5a529m9343e721371eefde@mail.gmail.com>
References: <FD872DE1-8372-4931-A626-A8376FF13612@ilstu.edu>
	<d8ad40b50912090906r54d5a529m9343e721371eefde@mail.gmail.com>
Message-ID: <4B1FEA85.4060300@nceas.ucsb.edu>

Hello All:
Faced with a similar challenge, and NOT wanting to resort to writing a C 
language function
employing fseek(), I just used two readBin calls: One to read (and 
implicitly discard) data up
to the spot I actually wanted to read, and a second call to read the 
desired information.
here is a code sample:

                      fileCon = file(sTsFileName,"rb")
#
# Offset has been calculated above: number of NumericByte-sized elements 
preceeding
# the data of interest.
#
                      if (iOffset > 0)
                      
{                                                                                          

                         TestVec = readBin(fileCon,numeric(),size = 
iNumericBytes,n=iOffset)
                      
}                                                        
                      dTimeSeries = readBin(fileCon,numeric(),size = 
iNumericBytes,n=iNumElements) 
                      close(fileCon)

Crude, but effective. I WIS that we could add a seekBin() function that 
positions the file pointer
to the desired spot.

Hope this helps,
Rick R



Barry Rowlingson wrote:
> On Wed, Dec 9, 2009 at 4:58 PM, Jonathan Thayn <jthayn at ilstu.edu> wrote:
>   
>> Hopefully there is a simple solution to this problem. I process really large satellite images in R and, in order to not offend the memory-limitation demi-gods, I open each row of the imagery one at a time, process it, write the results, and then open the next line. I use readBin() to open each line.  For examaple, say I have the following file:
>>
>> writeBin(1:20,con="desktop/temp.bip",size=2,endian="big")
>>
>> which I can open using readBin():
>>
>> readBin("desktop/temp.bip","integer",size=2,endian="big",n=20)
>>
>> Now I want to open select values from the binary file, not a complete line.  Say I want to read values 3, 7, and 10, process them, write the result, and then read values 4, 5, and 17.  How do I direct readBin to those specific values? Thanks.
>>     
>
>  You need to seek help. Or help(seek). Yes really.
>
> Barry
>
>
>   


-- 
Rick Reeves
Scientific Programmer/Analyst and Data Manager
National Center for Ecological Analysis and Synthesis
UC Santa Barbara
www.nceas.ucsb.edu
805 892 2533


From mark_connolly at acm.org  Wed Dec  9 19:29:18 2009
From: mark_connolly at acm.org (Mark Connolly)
Date: Wed, 09 Dec 2009 13:29:18 -0500
Subject: [R-sig-Geo] transforming a 3d SpatialGridDataFrame into a mesh
 of some kind
In-Reply-To: <dc22b2570912090920y78fc13f6tdd48e6245ed0af85@mail.gmail.com>
References: <4B1FA1D8.1040405@acm.org>
	<dc22b2570912090920y78fc13f6tdd48e6245ed0af85@mail.gmail.com>
Message-ID: <4B1FEC7E.3070505@acm.org>

I _think_ raster may be solving a different problem.  I am looking for a 
voxel-type raster.  Let me know if I am wrong.

plot3d(raster(kriged_sp))
Error in as.double(x) :
  cannot coerce type 'S4' to vector of type 'double'

Let me describe the SpatialGridDataFrame a bit better.  The coordinates 
are position in volumetric space (x,y,depth_cm).  The value at each 
position is the predicted value from IDW (var1.pred).  So the structure is

summary(kriged_sp)
Object of class SpatialGridDataFrame
Coordinates:
              min      max
x        740317.2 740747.2
y        181326.1 181646.1
depth_cm    -90.0      0.0
Is projected: TRUE 
proj4string :
[+init=epsg:32119 +proj=lcc +lat_1=36.16666666666666
+lat_2=34.33333333333334 +lat_0=33.75 +lon_0=-79 +x_0=609601.22 +y_0=0
+ellps=GRS80 +datum=NAD83 +units=m +no_defs +towgs84=0,0,0]
Number of points: 2
Grid attributes:
         cellcentre.offset cellsize cells.dim
x                 740322.2       10        43
y                 181331.1       10        32
depth_cm             -87.5        5        18
Data attributes:
   var1.pred        var1.var    
 Min.   : 3.66   Min.   :   NA  
 1st Qu.:19.92   1st Qu.:   NA  
 Median :22.97   Median :   NA  
 Mean   :22.08   Mean   :  NaN  
 3rd Qu.:24.62   3rd Qu.:   NA  
 Max.   :44.26   Max.   :   NA  
                 NA's   :24768  




When I create a raster from this object, I get something that looks 
two-dimensional:

class       : RasterLayer 
filename    :  
nrow        : 32 
ncol        : 43 
ncells      : 1376 
min value   :  
max value   :  
projection  : +init=epsg:32119 +proj=lcc +lat_1=36.16666666666666 +lat_2=34.33333333333334 +lat_0=33.75 +lon_0=-79 +x_0=609601.22 +y_0=0 +ellps=GRS80 +datum=NAD83 +units=m +no_defs +towgs84=0,0,0 
xmin        : 740317.2 
xmax        : 740747.2 
ymin        : 181326.1 
ymax        : 181646.1 
xres        : 10 
yres        : 10 



Robert J. Hijmans wrote:
> Mark,
>
> If spgdf is a SpatialGridDataFrame object
>
> # install.packages("raster", repos="http://R-Forge.R-project.org")
> library(raster)
> plot3D(raster(spgdf))
>
> Or you can have a look at the code:
> getMethod("plot3D", 'RasterLayer')
>
> Robert
>
> On Wed, Dec 9, 2009 at 5:10 AM, Mark Connolly <mark_connolly at acm.org> wrote:
>   
>> I have a 3d SpatialGridDataFrame I created using krige (IDW).  I am using
>> rgl facilities to create an interactive plot of the points, but I'd really
>> like to have something more volumetric than points.  My copy of the truly
>> wonderful Applied Spatial Data Analysis with R (shameless pander) is pretty
>> mute on 3d.  Any hints on where I might find something on transforming the
>> points into a mesh?  Something I need to code for myself?
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>     
>
>


From b.rowlingson at lancaster.ac.uk  Wed Dec  9 19:33:20 2009
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Wed, 9 Dec 2009 18:33:20 +0000
Subject: [R-sig-Geo] reading select values from a binary file
In-Reply-To: <4B1FEA85.4060300@nceas.ucsb.edu>
References: <FD872DE1-8372-4931-A626-A8376FF13612@ilstu.edu>
	<d8ad40b50912090906r54d5a529m9343e721371eefde@mail.gmail.com>
	<4B1FEA85.4060300@nceas.ucsb.edu>
Message-ID: <d8ad40b50912091033g75f5832es9fb7419697308225@mail.gmail.com>

On Wed, Dec 9, 2009 at 6:20 PM, rick reeves <reeves at nceas.ucsb.edu> wrote:
> Hello All:
> Faced with a similar challenge, and NOT wanting to resort to writing a C
> language function
> employing fseek(), I just used two readBin calls: One to read (and
> implicitly discard) data up
> to the spot I actually wanted to read, and a second call to read the desired
> information.
> here is a code sample:
>
> ? ? ? ? ? ? ? ? ? ? fileCon = file(sTsFileName,"rb")
> #
> # Offset has been calculated above: number of NumericByte-sized elements
> preceeding
> # the data of interest.
> #
> ? ? ? ? ? ? ? ? ? ? if (iOffset > 0)
> ? ? ? ? ? ? ? ? ? ? {
>
> ? ? ? ? ? ? ? ? ? ? ? ?TestVec = readBin(fileCon,numeric(),size =
> iNumericBytes,n=iOffset)
> ? ? ? ? ? ? ? ? ? ? }
> ? ? ? ? ? ? ? ? ? ? ? dTimeSeries = readBin(fileCon,numeric(),size =
> iNumericBytes,n=iNumElements) ? ? ? ? ? ? ? ? ? ? close(fileCon)
>
> Crude, but effective. I WIS that we could add a seekBin() function that
> positions the file pointer
> to the desired spot.
>

 The R seek function does this. I hadn't tested it when I posted,
hoping the original poster would work it from my message. So I just
now tested it:

 I created a file with ascii a to z in, and then:

 > con = file("file.tst","rb")
 # jump to 13th letter:
 > seek(con,13)
 [1] 0
 # read it:
 > readBin(con,what="raw",n=1)
 [1] 6e     # thats ascii 'n'
 # jump back:
 > seek(con,1)
 [1] 14 # returns where we were, we've now moved...
 > readBin(con,what="raw",n=1)
 [1] 62  # ascii 'b'. Things start at zero....

 Is that what you are trying to do?

Barry


From Roger.Bivand at nhh.no  Wed Dec  9 20:01:38 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 9 Dec 2009 20:01:38 +0100 (CET)
Subject: [R-sig-Geo] Rshhs() import problem
In-Reply-To: <15789f2d0912090550l2d910e68h8d62ff559bf81fff@mail.gmail.com>
References: <15789f2d0912090550l2d910e68h8d62ff559bf81fff@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.0912091955160.892@reclus.nhh.no>

On Wed, 9 Dec 2009, Maik Renner wrote:

> Dear R-Geographers,
>
> I am trying to use the GSHHS shoreline data for annotating my maps.
> I used Rgshhs() from the package maptools to import it into R as a
> Spatial object.
> However it seems that there is a problem due to the new version of
> gshhs_2.0.zip.
> In the help gshhs_1.11.zip is referred.
>
> Here is my example:
>
>>      NZx <- c(160,180)
>>      NZy <- c(-50,-30)
>> NZ <- Rgshhs("gshhs_c.b", xlim=NZx, ylim=NZy)
> Error in Rgshhs("gshhs_c.b",  :
>  Data not same version as software
>
> Is this a bug in Rshhs() or do I need some external librarys?

Please use gshhs_1.11.zip until an update can be made. Maybe 
gshhs_1.12.zip will also work, but 2.0 will not, as the C struct 
definition has been changed.

Roger

>
> Any suggestions welcome.
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From hengl at spatial-analyst.net  Wed Dec  9 20:02:37 2009
From: hengl at spatial-analyst.net (Tomislav Hengl)
Date: Wed, 09 Dec 2009 20:02:37 +0100
Subject: [R-sig-Geo] Spatial R Courses
In-Reply-To: <b440a3f80912090927i63bd62d1m312c8b7b3d7eff09@mail.gmail.com>
References: <b440a3f80912090927i63bd62d1m312c8b7b3d7eff09@mail.gmail.com>
Message-ID: <4B1FF44D.6070705@spatial-analyst.net>


David Rossiter runs this excellent distance education course:

http://www.itc.nl/Pub/Study/Courses/C10-AES-DE-02
*Next one starts in 6 weeks!

We will run a 5-day trainig course in June (which is more affordable, 
but shorter):

27 June - 4 July 2010, GEOSTAT 2010 Summer School for PhD students, 
Plasencia, Spain (more info soon)

HTH

T. Hengl
http://home.medewerker.uva.nl/t.hengl/


Michael Denslow wrote:
> Dear r-sig-geo,
> 
> I apologize if this is too off topic.
> 
> I am interested in taking a online or other distance learning course
> in spatial analysis/programming.
> An R course would be great, but I am also interested in other things
> such as GRASS, Python or open web applications.
> 
> The only caveats are that it must be a graduate course in Geography
> (or closely related field).
> 
> Thanks in advance for any ideas,
> 
> Michael
>


From mdsumner at gmail.com  Wed Dec  9 20:59:48 2009
From: mdsumner at gmail.com (Michael Sumner)
Date: Thu, 10 Dec 2009 06:59:48 +1100
Subject: [R-sig-Geo] reading select values from a binary file
In-Reply-To: <d8ad40b50912091033g75f5832es9fb7419697308225@mail.gmail.com>
References: <FD872DE1-8372-4931-A626-A8376FF13612@ilstu.edu>
	<d8ad40b50912090906r54d5a529m9343e721371eefde@mail.gmail.com>
	<4B1FEA85.4060300@nceas.ucsb.edu>
	<d8ad40b50912091033g75f5832es9fb7419697308225@mail.gmail.com>
Message-ID: <522664f80912091159o11ab2ba4s76c665b33cdb9339@mail.gmail.com>

If you can read the whole file at once it might be better to push the
results into a matrix for indexing in R. This could also be useful for
reading chunks of the file, and processing in parts.  seek is fine but
if you are moving around for three values each read it will be slow.
If the arrangement complex,  R's "[" indexing can save you from making
simple errors.

BTW, what is the format of the file? If GDAL can read it the rgdal
package provides a simpler route.

Cheers, Mike.

On Thu, Dec 10, 2009 at 5:33 AM, Barry Rowlingson
<b.rowlingson at lancaster.ac.uk> wrote:
> On Wed, Dec 9, 2009 at 6:20 PM, rick reeves <reeves at nceas.ucsb.edu> wrote:
>> Hello All:
>> Faced with a similar challenge, and NOT wanting to resort to writing a C
>> language function
>> employing fseek(), I just used two readBin calls: One to read (and
>> implicitly discard) data up
>> to the spot I actually wanted to read, and a second call to read the desired
>> information.
>> here is a code sample:
>>
>> ? ? ? ? ? ? ? ? ? ? fileCon = file(sTsFileName,"rb")
>> #
>> # Offset has been calculated above: number of NumericByte-sized elements
>> preceeding
>> # the data of interest.
>> #
>> ? ? ? ? ? ? ? ? ? ? if (iOffset > 0)
>> ? ? ? ? ? ? ? ? ? ? {
>>
>> ? ? ? ? ? ? ? ? ? ? ? ?TestVec = readBin(fileCon,numeric(),size =
>> iNumericBytes,n=iOffset)
>> ? ? ? ? ? ? ? ? ? ? }
>> ? ? ? ? ? ? ? ? ? ? ? dTimeSeries = readBin(fileCon,numeric(),size =
>> iNumericBytes,n=iNumElements) ? ? ? ? ? ? ? ? ? ? close(fileCon)
>>
>> Crude, but effective. I WIS that we could add a seekBin() function that
>> positions the file pointer
>> to the desired spot.
>>
>
> ?The R seek function does this. I hadn't tested it when I posted,
> hoping the original poster would work it from my message. So I just
> now tested it:
>
> ?I created a file with ascii a to z in, and then:
>
> ?> con = file("file.tst","rb")
> ?# jump to 13th letter:
> ?> seek(con,13)
> ?[1] 0
> ?# read it:
> ?> readBin(con,what="raw",n=1)
> ?[1] 6e ? ? # thats ascii 'n'
> ?# jump back:
> ?> seek(con,1)
> ?[1] 14 # returns where we were, we've now moved...
> ?> readBin(con,what="raw",n=1)
> ?[1] 62 ?# ascii 'b'. Things start at zero....
>
> ?Is that what you are trying to do?
>
> Barry
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From rusers.sh at gmail.com  Wed Dec  9 21:33:50 2009
From: rusers.sh at gmail.com (rusers.sh)
Date: Wed, 9 Dec 2009 15:33:50 -0500
Subject: [R-sig-Geo] convert KML file into shape file or CSV file
In-Reply-To: <d8ad40b50912090532h4693f581t6222ae8b7e9af8c2@mail.gmail.com>
References: <a835c81e0912081722o4d35b198y25d38ce41d9495a8@mail.gmail.com>
	<d8ad40b50912090532h4693f581t6222ae8b7e9af8c2@mail.gmail.com>
Message-ID: <a835c81e0912091233y6bb41260haa0f6fe397a4a0b1@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20091209/8553e857/attachment.pl>

From tech_dev at wildintellect.com  Wed Dec  9 21:40:02 2009
From: tech_dev at wildintellect.com (Alex Mandel)
Date: Wed, 09 Dec 2009 12:40:02 -0800
Subject: [R-sig-Geo] convert KML file into shape file or CSV file
In-Reply-To: <a835c81e0912091233y6bb41260haa0f6fe397a4a0b1@mail.gmail.com>
References: <a835c81e0912081722o4d35b198y25d38ce41d9495a8@mail.gmail.com>	
	<d8ad40b50912090532h4693f581t6222ae8b7e9af8c2@mail.gmail.com>
	<a835c81e0912091233y6bb41260haa0f6fe397a4a0b1@mail.gmail.com>
Message-ID: <4B200B22.2000600@wildintellect.com>

Almost, in my sleepiness I left out an important part from that pseudo
code. You need to store the data in a variable/object and then write it out.
importeddata <- readOGR("pathtofile",layer.kml)
writeOGR(importeddata ,"pathtooutput",driver="ESRI
Shapefile",layer=output.shp)

Make sure to read the help for both of those commands to get them correct.

Also, unless you're going to do some manipulation in R between those
steps, it's really a indirect method compared to ogr2ogr.

Alex

rusers.sh wrote:
>   It is the problem of the file. I should have thought of this because i
> have tried several tools. Thanks.
>   Based on your replies, i think it is easy to convert the files between KML
> and SHP if the files are correct and have simple structure. We only
> need readOGR and writeOGR in rgdal package to do that. Something like the
> following arguments.
> #Convert KML to SHP
> readOGR("pathtofile",layer.kml)
> writeOGR("pathtooutput",driver="ESRI Shapefile",layer=output.shp)
> #Convert SHP to KML
> readOGR("pathtofile",layer.shp)
> writeOGR("pathtooutput",driver="KML",layer=output.kml)
>   Right?
>   Thanks a lot.
> 2009/12/9 Barry Rowlingson <b.rowlingson at lancaster.ac.uk>
> 
>> On Wed, Dec 9, 2009 at 1:22 AM, rusers.sh <rusers.sh at gmail.com> wrote:
>>> Hi all,
>>>  Does anybody know how to import a KML file in R and them save it as a
>>> shape or CSV file. Take the following KML file as an example,
>>> http://www.nature.com/nature/googleearth/avianflu1.kml
>>>  I have tried several extentions of
>>> ARCGIS,e.g.KML2Shape,KMLCSVConverter,KMLCSVConverter and XToolsPro, but
>>> unfortunately failed to do that. I didnot find a method to solve it in R.
>>>  If this cannot be done in R, i'd like to see your alternative method to
>> do
>>> that.
>>>  Any help or suggestions are greatly appreciated.
>>>
>>  As well as the validation problems reported by Alex Mandel, the
>> structure of this KML file isn't appropriate for straight conversion
>> to a shape or CSV file.
>>
>>  It has several parts, some "NetworkLink" structures without URLs that
>> just provide some HTML info boxes, and some network link structures
>> that point to other kmz files. You can download these kmz files, unzip
>> them, and possibly convert them to other formats. For example, one of
>> the links is to:
>>
>> http://www.declanbutler.info/Flumaps1/4_Human_cases/Maps_of_human_cases_by
>> period/Cases_by_period1.kmz
>>
>> which when unzipped produces doc.kml and some png files for markers.
>> ogrinfo tells us:
>>
>> $ ogrinfo doc.kml
>> Had to open data source read-only.
>> INFO: Open of `doc.kml'
>>      using driver `KML' successful.
>> 1: Data (3D Point)
>> 2: Data (3D Point)
>> 3: Data (3D Point)
>> 4: Data (3D Point)
>> 5: Data (3D Point)
>> 6: Data (3D Point)
>> 7: Data (3D Point)
>> 8: Data (3D Point)
>>
>>  - which is a bit weird, 8 layers all called 'Data'. That makes it
>> hard to extract individual layers by name. So I edited the file and
>> renamed them Data to Data8....
>>
>>  I can then read them in R:
>>
>>> data2=readOGR("doc.kml","Data2")
>>> plot(data2)
>>  I can then use writeOGR to create shapefiles, but it's easier on the
>> command line:
>>
>> $ mkdir shapefile
>> $ ogr2ogr -f "ESRI Shapefile" shapefile doc.kml
>>
>> So there's umpteen things going on here, above and beyond any possible
>> structural problems with the KML in the first place:
>>
>> 1. The original KML file points to a bunch of KMZ files, and readOGR
>> isn't going to do all that work for you.
>> 2. Even if it could do all that work, the KML is a complex structure
>> with all sorts of geographic and no-geographic entities and so it
>> can't bung it all into a simple shapefile
>> 3. The individual KMZ files which do contain the data have multiple layers.
>> 4. The layers within a KMZ file (or at least, the one I bothered to
>> look at) have identical names which breaks stuff.
>>
>> Otherwise, it's easy! :)
>>
>> Barry
>>
> 
> 
>


From jaime.garcia at uni-bonn.de  Wed Dec  9 22:27:53 2009
From: jaime.garcia at uni-bonn.de (Jaime R. Garcia M.)
Date: Wed, 09 Dec 2009 22:27:53 +0100
Subject: [R-sig-Geo] Moving window correlation- Further
In-Reply-To: <4B1FD44B.10204@cornell.edu>
References: <4B16DE64.8070403@gmail.com>  <4B1EA9D1.20602@cornell.edu>
	<1260305675.3311.34.camel@jaime> <1260325289.2631.27.camel@jaime>
	<4B1FD44B.10204@cornell.edu>
Message-ID: <1260394073.2622.34.camel@jaime>

On Wed, 2009-12-09 at 11:46 -0500, Zia Ahmed wrote:
> Thank you so much! Before running my data, I have tested your code
> using "meuse" data. It works fine. But it produce following output
> like below from V1 to V3103. I do not understand what does the values
> in rows mean (1 to 4). 
> Here is  the code that I used.  I have questions How do I plot
> r-values with coordinates. Is it possible to get p-value for each
> estimate?
> 
> Thanks again
> Zia
> 
> # R code:
> #----------
> library(gstat)
> library(sp)
> library(spdep)
> 
> data(meuse)
> data(meuse.grid)
> coordinates(meuse) <- ~x + y
> coordinates(meuse.grid) <- ~x + y
> str(meuse.grid)
> 
> # GRID 1:
> v1 <- variogram(log(zinc) ~ 1, meuse)
> x1<-fit.variogram(v1, vgm(1, "Sph", 800, 1))
> G1 <- krige(zinc ~ 1, meuse, meuse.grid, x1, nmax = 30)
> gridded(G1)<-TRUE
> # GRID-2:
> v2 <- variogram(log(lead) ~ 1, meuse)
> x2<-fit.variogram(v2, vgm(.1, "Sph", 1000, .6))
> G2 <- krige(zinc ~ 1, meuse, meuse.grid, x2, nmax = 30)
> gridded(G2)<-TRUE

names(G1)
names(G2)

Note that G1 and G2 consist each of two columns, the prediction
(var1.pred) and the variance of predictions (var1.var)

> # Mooving Windows Correlation
> # Define the size of the moving window,
> dist = sqrt(2*((40*3)^2))
> # Create a list of neighbours for the distance criteria
> nb <- dnearneigh(coordinates(G1),0, dist) 
> v = sapply(nb, function(i) cor(G1 at data[i,], G2 at data[i,]))
> 
if you run the line above as it is that means you are calculating the
correlation of all possible combination of the two G1 columns and the
two G2 columns. That is, 1) prediction G1 - prediction G2, 2) prediction
G1 - variance G2, 3) variance G1 - prediction G2 and 4) variance G1 -
variance G2, in that order.

If you want to leave the code like this you can do then

class(v)  # in this case a matrix
v = as.data.frame(t(v))
coordinates(v) = coordinates(G1)
gridded(v)=TRUE
spplot(v)

or you can calculate at once the correlation between both prediction:

v = sapply(nb, function(i) cor(G1 at data[i,1], G2 at data[i,1]))
class(v) # in this case is a numeric vector
v= as.data.frame(v)
coordinates(v) = coordinates(G1)
gridded(v) = TRUE
spplot(v)

Now you are interested in the p-value of each correlation!!!
Then I would calculate everything at one (correlation between
predictions and the p-value of each correlation)

v = sapply(nb, function(i) cor.test(G1 at data[i,1], G2 at data[i,1]))
# correlation coefficient:
c = unlist(v["estimate",])
c = as.data.frame(v)
coordinates(c) = coordinates(G1)
gridded(c) = TRUE
spplot(c)

# p-value
p = unlist(v["p.value",])
p = as.data.frame(v)
coordinates(p) = coordinates(G1)
gridded(p) = TRUE
spplot(p)

HTH,

Jaime -R.

> When I run following codes it shows error.
> 
> coordinates(v) = coordinates(G1)
> 
> Error in function (classes, fdef, mtable)  : 
>   unable to find an inherited method for function "coordinates<-", for
> signature "matrix"
> 
> gridded(v) = TRUE
> 
> Error in `gridded<-`(`*tmp*`, value = TRUE) : 
>   gridded<- only works for SpatialPoints[DataFrame] or
> SpatialGrid[DataFrame]
> 
> 
> # Output #--------
> 
>        V1         V2         V3         V4         V5         V6
> V7
> 1  0.9996752  0.9996896  0.9997172 0.99971074  0.9996085  0.9996784
> 0.99972521
> 2 -0.3807374 -0.3576051 -0.2260482 0.05467783 -0.2882067 -0.2124191
> -0.08551635
> 3 -0.3943537 -0.3750882 -0.2435564 0.03511977 -0.3081105 -0.2300869
> -0.10426607
> 4  0.9999324  0.9999349  0.9999442 0.99994815  0.9999047  0.9999104
> 0.99992347
> 
> 
> 
> Jaime R. Garcia M. wrote: 
> > On Tue, 2009-12-08 at 21:54 +0100, Jaime R. Garcia M. wrote:
> >   
> > > On Tue, 2009-12-08 at 14:32 -0500, Zia Ahmed wrote:
> > >     
> > > > I have two grid maps (100 m cell size). I want to a create another  
> > > > raster gird  of  correlation  coefficient ( r value) of  two maps using  
> > > > moving windows approach.  Has someone  any idea how to do it in R?
> > > > 
> > > > Thanks
> > > > 
> > > > Zia
> > > > 
> > > > _______________________________________________
> > > > R-sig-Geo mailing list
> > > > R-sig-Geo at stat.math.ethz.ch
> > > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > > >       
> > > Dear Zia,
> > > 
> > > Some time ago I did exactly that and the script was based on a earlier
> > > post by Prof. Roger Bivand in this list. (Sorry I couldn't find the link
> > > anymore)
> > > 
> > > Suppose "G1" and "G2" are the two grid maps.
> > > I assume they are "SpatialGridDataFrames" and have exactly the same
> > > extent and number of columns and rows. Also that you have libraries (sp)
> > > and (spdep) loaded
> > > 
> > > # Define the size of the moving window, for example (7*7) so you have
> > > enough neighbors for reliable correlation estimation:
> > > 
> > > dist = sqrt(2*((100*3)^2))
> > > 
> > > # Create a list of neighbours for the distance criteria
> > > nb <- dnearneigh(coordinates(G1),0, dist) 
> > > 
> > > # And then calculate correlations
> > > v <- sapply(nb, function(i) cor(G1 at data, G2 at data))
> > >     
> > 
> > # Small correction
> > 
> > v = sapply(nb, function(i) cor(G1 at data[i,], G2 at data[i,]))
> > 
> > #  And in this case the result should be a numeric vector
> > 
> > coordinates(v) = coordinates(G1)
> > gridded(v) = TRUE
> > fullgrid(v) = TRUE
> > _______________________________________________
> >   
> > > R-sig-Geo mailing list
> > > R-sig-Geo at stat.math.ethz.ch
> > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > >     
> > 
> > 
> >


From zua3 at cornell.edu  Wed Dec  9 17:46:03 2009
From: zua3 at cornell.edu (Zia Ahmed)
Date: Wed, 09 Dec 2009 11:46:03 -0500
Subject: [R-sig-Geo] Moving window correlation- Further
In-Reply-To: <1260325289.2631.27.camel@jaime>
References: <4B16DE64.8070403@gmail.com> <4B1EA9D1.20602@cornell.edu>	
	<1260305675.3311.34.camel@jaime> <1260325289.2631.27.camel@jaime>
Message-ID: <4B1FD44B.10204@cornell.edu>

Thank you so much! Before running my data, I have tested your code using 
"meuse" data. It works fine. But it produce following output like below 
from V1 to V3103. I do not understand what does the values in rows mean 
(1 to 4). Here is  the code that I used.  I have questions How do I plot 
r-values with coordinates. Is it possible to get p-value for each estimate?

Thanks again
Zia

*# R code:*
#----------
library(gstat)
library(sp)
library(spdep)

data(meuse)
data(meuse.grid)
coordinates(meuse) <- ~x + y
coordinates(meuse.grid) <- ~x + y
str(meuse.grid)

# GRID 1:
v1 <- variogram(log(zinc) ~ 1, meuse)
x1<-fit.variogram(v1, vgm(1, "Sph", 800, 1))
G1 <- krige(zinc ~ 1, meuse, meuse.grid, x1, nmax = 30)
gridded(G1)<-TRUE
# GRID-2:
v2 <- variogram(log(lead) ~ 1, meuse)
x2<-fit.variogram(v2, vgm(.1, "Sph", 1000, .6))
G2 <- krige(zinc ~ 1, meuse, meuse.grid, x2, nmax = 30)
gridded(G2)<-TRUE
# Mooving Windows Correlation
# Define the size of the moving window,
dist = sqrt(2*((40*3)^2))
# Create a list of neighbours for the distance criteria
nb <- dnearneigh(coordinates(G1),0, dist)
v = sapply(nb, function(i) cor(G1 at data[i,], G2 at data[i,]))

When I run following codes it shows error.

coordinates(v) = coordinates(G1)

Error in function (classes, fdef, mtable)  :
  unable to find an inherited method for function "coordinates<-", for 
signature "matrix"

gridded(v) = TRUE

Error in `gridded<-`(`*tmp*`, value = TRUE) :
  gridded<- only works for SpatialPoints[DataFrame] or 
SpatialGrid[DataFrame]

*
# Output #--------
*
       V1         V2         V3         V4         V5         V6          V7
1  0.9996752  0.9996896  0.9997172 0.99971074  0.9996085  0.9996784  
0.99972521
2 -0.3807374 -0.3576051 -0.2260482 0.05467783 -0.2882067 -0.2124191 
-0.08551635
3 -0.3943537 -0.3750882 -0.2435564 0.03511977 -0.3081105 -0.2300869 
-0.10426607
4  0.9999324  0.9999349  0.9999442 0.99994815  0.9999047  0.9999104  
0.99992347



Jaime R. Garcia M. wrote:
> On Tue, 2009-12-08 at 21:54 +0100, Jaime R. Garcia M. wrote:
>   
>> On Tue, 2009-12-08 at 14:32 -0500, Zia Ahmed wrote:
>>     
>>> I have two grid maps (100 m cell size). I want to a create another  
>>> raster gird  of  correlation  coefficient ( r value) of  two maps using  
>>> moving windows approach.  Has someone  any idea how to do it in R?
>>>
>>> Thanks
>>>
>>> Zia
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>       
>> Dear Zia,
>>
>> Some time ago I did exactly that and the script was based on a earlier
>> post by Prof. Roger Bivand in this list. (Sorry I couldn't find the link
>> anymore)
>>
>> Suppose "G1" and "G2" are the two grid maps.
>> I assume they are "SpatialGridDataFrames" and have exactly the same
>> extent and number of columns and rows. Also that you have libraries (sp)
>> and (spdep) loaded
>>
>> # Define the size of the moving window, for example (7*7) so you have
>> enough neighbors for reliable correlation estimation:
>>
>> dist = sqrt(2*((100*3)^2))
>>
>> # Create a list of neighbours for the distance criteria
>> nb <- dnearneigh(coordinates(G1),0, dist) 
>>
>> # And then calculate correlations
>> v <- sapply(nb, function(i) cor(G1 at data, G2 at data))
>>     
>
> # Small correction
>
> v = sapply(nb, function(i) cor(G1 at data[i,], G2 at data[i,]))
>
> #  And in this case the result should be a numeric vector
>
> coordinates(v) = coordinates(G1)
> gridded(v) = TRUE
> fullgrid(v) = TRUE
> _______________________________________________
>   
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>     
>
>
>   
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20091209/8df18492/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: zua3.vcf
Type: text/x-vcard
Size: 293 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20091209/8df18492/attachment.vcf>

From brwin338 at aol.com  Thu Dec 10 03:17:03 2009
From: brwin338 at aol.com (brwin338 at aol.com)
Date: Wed, 09 Dec 2009 21:17:03 -0500
Subject: [R-sig-Geo] converting grid objects to spatial polygon objects and
	export as shapefile
Message-ID: <8CC4755FF335DDD-29E4-A52E@webmail-d100.sysops.aol.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20091209/dee8e72d/attachment.pl>

From alexandre.villers at cebc.cnrs.fr  Thu Dec 10 07:50:30 2009
From: alexandre.villers at cebc.cnrs.fr (Alexandre VILLERS)
Date: Thu, 10 Dec 2009 07:50:30 +0100
Subject: [R-sig-Geo] creating cluster with between-points arbitrary distances
Message-ID: <4B209A36.3020101@cebc.cnrs.fr>

Good morning (and sorry for the cross posting on the R sig ecology),

I'm still working on the spatial distribution of an aggregated bird species. I would like to test different between birds distances to create clusters and thus identify groups of birds (leks). It would be "visually" quite easy to do it but I would like to repeat this clustering objectively for many years in order to characterize some biological processes. So I would like for example to group all the birds who share neighbours in less than 1000 meters in the same cluster. Thus, 3 birds lying on a straight line 700 meters from each other would belong to the same cluster (hope this is clear).

I can get groups of points whose distances are below a certain threshold with dnearneigh() from package "spdep" but this would still require to write an iterative function to group points. 
Is there an existing function that can do the whole trick? I know many packages are available for clustering with R but I haven't found one that I can parametrize in a such way yet.

Any link will be appreciated.
Thanks


Alex

P.S.: to get this visually

x<-c(0,700,1400, 3000)
y<-c(0,0,0,0)
plot(y~x, col=c("red","red", "red", "black"), pch=c(16,16,16,16)) # red points belong to the same cluster while the black doesn't


-- 
Alexandre Villers
PhD Candidate
AgriPop
Centre d'Etudes Biologiques de Chiz?-CNRS UPR1934
79360 Beauvoir sur Niort

Phone +33 (0)5 49 09 96 13
Fax   +33 (0)5 49 09 65 26




__________ Information from ESET Mail Security, version of virus signature database 4674 (20091209) __________

The message was checked by ESET Mail Security.
http://www.eset.com


From dan.putler at sauder.ubc.ca  Thu Dec 10 08:23:04 2009
From: dan.putler at sauder.ubc.ca (Dan Putler)
Date: Wed, 09 Dec 2009 23:23:04 -0800
Subject: [R-sig-Geo] creating cluster with between-points
	arbitrary	distances
In-Reply-To: <12897_1260427894_1260427894_4B209A36.3020101@cebc.cnrs.fr>
References: <12897_1260427894_1260427894_4B209A36.3020101@cebc.cnrs.fr>
Message-ID: <1260429784.6923.29.camel@whitebox>

Hi Alexandre,

Greetings from yesterday evening.

I think I know what you want, and I've been working on the same problem
in a very different substantive context. To make sure I understand the
question, you are basically stating that if the gap between "nearest"
birds of the same species exceeds 1000 meters, then the two birds cannot
be considered to be in the same cluster. Returning to your example of
birds along a straight line, assume the birds run from A to B to C, and
A and B are 700 meters apart, while B and C are 1001 meters apart, then
it is the case that A and B are in a cluster, but C is not a member of
that cluster.

Assuming what I said is correct, one thing you can do is create a
relative neighbor graph of your points, and then drop any edges from the
graph that exceed 1000 meters. This will create a set up unconnected
sub-graphs, and the points within each sub-graph constitutes a cluster.
I've written a function (using the spdens package) that removes the long
edges from the relative neighbor graph, there by creating the set of
clusters. I've pasted my function below (at some point I will create an
R package that includes this function, but it is likely a couple of
months away).

The function follows:

# dropLongLinks takes an nb (neighbor list) object, the original
coordinates,
# and a maximum distance, then removes links from the nb object for
links that
# exceed the maximum distance.

# Programer: Dan Putler
# Created: 08Feb09
# Modified: 08Feb09

dropLongLinks <- function(nb, coords, max.dist) {
    require(spdep)
    if(!is.matrix(coords)) coords <- as.matrix(coords)
    dists <- nbdists(nb, coords)
    nb.new <-
      lapply(1:length(nb), function(i) nb[[i]] <- nb[[i]][dists[[i]] <=
max.dist])
    class(nb.new) <- "nb"
    return(nb.new)
    }

On Thu, 2009-12-10 at 07:50 +0100, Alexandre VILLERS wrote:
> Good morning (and sorry for the cross posting on the R sig ecology),
> 
> I'm still working on the spatial distribution of an aggregated bird species. I would like to test different between birds distances to create clusters and thus identify groups of birds (leks). It would be "visually" quite easy to do it but I would like to repeat this clustering objectively for many years in order to characterize some biological processes. So I would like for example to group all the birds who share neighbours in less than 1000 meters in the same cluster. Thus, 3 birds lying on a straight line 700 meters from each other would belong to the same cluster (hope this is clear).
> 
> I can get groups of points whose distances are below a certain threshold with dnearneigh() from package "spdep" but this would still require to write an iterative function to group points. 
> Is there an existing function that can do the whole trick? I know many packages are available for clustering with R but I haven't found one that I can parametrize in a such way yet.
> 
> Any link will be appreciated.
> Thanks
> 
> 
> Alex
> 
> P.S.: to get this visually
> 
> x<-c(0,700,1400, 3000)
> y<-c(0,0,0,0)
> plot(y~x, col=c("red","red", "red", "black"), pch=c(16,16,16,16)) # red points belong to the same cluster while the black doesn't
> 
> 
-- 
Dan Putler
Sauder School of Business
University of British Columbia


From r.m.krug at gmail.com  Thu Dec 10 08:36:33 2009
From: r.m.krug at gmail.com (Rainer M Krug)
Date: Thu, 10 Dec 2009 09:36:33 +0200
Subject: [R-sig-Geo] creating cluster with between-points arbitrary
	distances
In-Reply-To: <1260429784.6923.29.camel@whitebox>
References: <12897_1260427894_1260427894_4B209A36.3020101@cebc.cnrs.fr>
	<1260429784.6923.29.camel@whitebox>
Message-ID: <fb7c7e870912092336v47ecd018m3f9d0ff2034d5284@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20091210/cc7325ae/attachment.pl>

From alexandre.villers at cebc.cnrs.fr  Thu Dec 10 08:42:58 2009
From: alexandre.villers at cebc.cnrs.fr (Alexandre VILLERS)
Date: Thu, 10 Dec 2009 08:42:58 +0100
Subject: [R-sig-Geo] creating cluster with between-points
	arbitrary	distances
In-Reply-To: <1260429784.6923.29.camel@whitebox>
References: <12897_1260427894_1260427894_4B209A36.3020101@cebc.cnrs.fr>
	<1260429784.6923.29.camel@whitebox>
Message-ID: <4B20A682.50908@cebc.cnrs.fr>

Dear Dan,

That's exactly that ! Thank you very much.
Rainer, thank you for the other approach. I had thought of something 
like that, and even if such loop is not too much complicated to write, 
before putting my hands into it, I wanted to make sure there was not an 
existing function hanging somewhere.

Best regards


Alex

Dan Putler a ?crit :
> Hi Alexandre,
>
> Greetings from yesterday evening.
>
> I think I know what you want, and I've been working on the same problem
> in a very different substantive context. To make sure I understand the
> question, you are basically stating that if the gap between "nearest"
> birds of the same species exceeds 1000 meters, then the two birds cannot
> be considered to be in the same cluster. Returning to your example of
> birds along a straight line, assume the birds run from A to B to C, and
> A and B are 700 meters apart, while B and C are 1001 meters apart, then
> it is the case that A and B are in a cluster, but C is not a member of
> that cluster.
>
> Assuming what I said is correct, one thing you can do is create a
> relative neighbor graph of your points, and then drop any edges from the
> graph that exceed 1000 meters. This will create a set up unconnected
> sub-graphs, and the points within each sub-graph constitutes a cluster.
> I've written a function (using the spdens package) that removes the long
> edges from the relative neighbor graph, there by creating the set of
> clusters. I've pasted my function below (at some point I will create an
> R package that includes this function, but it is likely a couple of
> months away).
>
> The function follows:
>
> # dropLongLinks takes an nb (neighbor list) object, the original
> coordinates,
> # and a maximum distance, then removes links from the nb object for
> links that
> # exceed the maximum distance.
>
> # Programer: Dan Putler
> # Created: 08Feb09
> # Modified: 08Feb09
>
> dropLongLinks <- function(nb, coords, max.dist) {
>     require(spdep)
>     if(!is.matrix(coords)) coords <- as.matrix(coords)
>     dists <- nbdists(nb, coords)
>     nb.new <-
>       lapply(1:length(nb), function(i) nb[[i]] <- nb[[i]][dists[[i]] <=
> max.dist])
>     class(nb.new) <- "nb"
>     return(nb.new)
>     }
>
> On Thu, 2009-12-10 at 07:50 +0100, Alexandre VILLERS wrote:
>   
>> Good morning (and sorry for the cross posting on the R sig ecology),
>>
>> I'm still working on the spatial distribution of an aggregated bird species. I would like to test different between birds distances to create clusters and thus identify groups of birds (leks). It would be "visually" quite easy to do it but I would like to repeat this clustering objectively for many years in order to characterize some biological processes. So I would like for example to group all the birds who share neighbours in less than 1000 meters in the same cluster. Thus, 3 birds lying on a straight line 700 meters from each other would belong to the same cluster (hope this is clear).
>>
>> I can get groups of points whose distances are below a certain threshold with dnearneigh() from package "spdep" but this would still require to write an iterative function to group points. 
>> Is there an existing function that can do the whole trick? I know many packages are available for clustering with R but I haven't found one that I can parametrize in a such way yet.
>>
>> Any link will be appreciated.
>> Thanks
>>
>>
>> Alex
>>
>> P.S.: to get this visually
>>
>> x<-c(0,700,1400, 3000)
>> y<-c(0,0,0,0)
>> plot(y~x, col=c("red","red", "red", "black"), pch=c(16,16,16,16)) # red points belong to the same cluster while the black doesn't
>>
>>
>>     

-- 
Alexandre Villers
PhD Candidate
AgriPop
Centre d'Etudes Biologiques de Chiz?-CNRS UPR1934
79360 Beauvoir sur Niort

Phone +33 (0)5 49 09 96 13
Fax   +33 (0)5 49 09 65 26




__________ Information from ESET Mail Security, version of virus signature database 4674 (20091209) __________

The message was checked by ESET Mail Security.
http://www.eset.com


From Roger.Bivand at nhh.no  Thu Dec 10 10:11:53 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 10 Dec 2009 10:11:53 +0100 (CET)
Subject: [R-sig-Geo] converting grid objects to spatial polygon objects
 and export as shapefile
In-Reply-To: <8CC4755FF335DDD-29E4-A52E@webmail-d100.sysops.aol.com>
References: <8CC4755FF335DDD-29E4-A52E@webmail-d100.sysops.aol.com>
Message-ID: <alpine.LRH.2.00.0912100952060.3176@reclus.nhh.no>

On Wed, 9 Dec 2009, brwin338 at aol.com wrote:

>
> Good Evening:
> I have been trying to figure this one out but just can't make it work yet.
>
> Is there a straightforward way to convert a grid object (such as an 
> earthwide or regional long-lat grid) generated using sp into a spatial 
> polygon object that I could then export as a shapefile.  I want to be 
> able to use the maptools overlay function to assign locations to a grid 
> and then color each grid area based upon mean or other characteristics 
> of the locations within each grid.  I also want to create a shapefile 
> with attributes from each polygon saved in the @data component.  Please 
> excuse me if this is a simple problem or has been addressed previously 
> by the list but I have not been able to find an answer in previous 
> posts.

Have you considered coercing to SpatialPixels, then to 
SpatialPolygons: as(as(grd, "SpatialPixels"), "SpatialPolygons")?

gt <- GridTopology(c(-177.5, -87.5), c(5, 5), c(72, 36))
grd <- SpatialGrid(gt, proj4string=CRS("+proj=longlat"))
spix <- as(grd, "SpatialPixels")
spol <- as(spix, "SpatialPolygons")

Whether the sp package overlay methods will be more efficient on which 
representation is a question that needs addressing. Then something like:

pts <- spsample(grd, n=50000, type="random")
spts <- SpatialPointsDataFrame(pts, data=data.frame(x=rnorm(50000)))
o <- overlay(spol, spts)
spdf <- SpatialPolygonsDataFrame(spol, data=data.frame(id=row.names(spol),
   row.names=row.names(spol)))
spdf$xbar <- aggregate(spts$x, list(o), mean)$x
spplot(spdf, "xbar")

but you might just as well use the SpatialGrid* or SpatialPixels* 
representation, maybe?

Hope this helps,

Roger

>
> Joe
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From karl at huftis.org  Thu Dec 10 10:39:50 2009
From: karl at huftis.org (Karl Ove Hufthammer)
Date: Thu, 10 Dec 2009 10:39:50 +0100
Subject: [R-sig-Geo] reading select values from a binary file
References: <FD872DE1-8372-4931-A626-A8376FF13612@ilstu.edu>
Message-ID: <MPG.258ae051ee6735369896c2@news.gmane.org>

On Wed, 9 Dec 2009 10:58:01 -0600 Jonathan Thayn <jthayn at ilstu.edu> 
wrote:
> Now I want to open select values from the binary file, not a complete 
> line. Say I want to read values 3, 7, and 10, process them, write the 
> result, and then read values 4, 5, and 17.  How do I direct readBin to 
> those specific values? Thanks.

You can use the 'readBinFragments' function in the 'R.utils' package.

Also, if your file is an a 'standard' format, the 'raster' package may 
be of use: http://raster.r-forge.r-project.org/

-- 
Karl Ove Hufthammer


From brwin338 at aol.com  Thu Dec 10 16:52:06 2009
From: brwin338 at aol.com (brwin338 at aol.com)
Date: Thu, 10 Dec 2009 10:52:06 -0500
Subject: [R-sig-Geo] converting grid objects to spatial polygon objects
 and export as shapefile
In-Reply-To: <alpine.LRH.2.00.0912100952060.3176@reclus.nhh.no>
References: <8CC4755FF335DDD-29E4-A52E@webmail-d100.sysops.aol.com>
	<alpine.LRH.2.00.0912100952060.3176@reclus.nhh.no>
Message-ID: <8CC47C7DBCC8AEC-31C4-2507@webmail-d033.sysops.aol.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20091210/2f195313/attachment.pl>

From AHINTERMEISTER at amica.com  Thu Dec 10 17:08:07 2009
From: AHINTERMEISTER at amica.com (HINTERMEISTER, ARTHUR W. (Artie))
Date: Thu, 10 Dec 2009 11:08:07 -0500
Subject: [R-sig-Geo] Spatial categories for risk data.
Message-ID: <82AC92D8044F584AA54B76B8A3DBD2D20A877705@hoex02.AMICA.COM>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20091210/ddf16f25/attachment.pl>

From bibiko at eva.mpg.de  Thu Dec 10 17:13:04 2009
From: bibiko at eva.mpg.de (=?iso-8859-1?Q?Hans-J=F6rg_Bibiko?=)
Date: Thu, 10 Dec 2009 17:13:04 +0100
Subject: [R-sig-Geo] How to draw a map as PDF which shows the exact given
	view port only and without any border (PDF crop)
Message-ID: <D003826C-C856-479C-B764-EE480F59EB00@eva.mpg.de>

Hi,

I tried to find an answer in the net but up to now without success.

A simple example made with:

R version 2.10.0 (2009-10-26) 
x86_64-apple-darwin9.8.0 

locale:
[1] C/en_US.UTF-8/C/C/C/C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     


My task is to draw a map as PDF of Portugal. My view port is given by the coordinates xlim <- c(-10, -6) and ylim <- c(36.9, 42.5). The width of the viewport has to be 5in (for a publication). Due to the ratio of xlim and ylim the height is 7in. OK.


I tried:

# ________________________________________

library(maptools)
data(wrld_simpl)

# my view port
xlim <- c(-10, -6)
ylim <- c(36.9, 42.5)

pdf(file = "map_1.pdf", width = 5, height = 7, bg = "azure2")
plot(wrld_simpl, xlim = xlim, ylim = ylim, col = "khaki")

# my actual view port as reference
rect(xlim[1], ylim[1], xlim[2], ylim[2], border = "red")

dev.off()

# ________________________________________


and ended up in Figure 1 (see attachment). My view port is shown as a red rectangle. As you can see the PDF contains more as I expected. 



After some empirical attempts I came up with a wrapper function "pdfNoBorder". Thus I tried it again with that function:

# ________________________________________

library(maptools)
data(wrld_simpl)

pdfNoBorder <- function(file, width, height, xlim, ylim, 
	asp = 1, ...) {
	if (missing(width) && missing(height)) {
		stop("At least width or height must be given")
	}
	if (missing(xlim) && missing(ylim)) {
		stop("xlim and ylim must be given")
	}
	if (missing(width)) {
		width = diff(xlim)/diff(ylim) * height
	}
	if (missing(height)) {
		height = width/(diff(xlim)/diff(ylim))
	}
	pdf(file = file, width = width, height = height, ...)
	par(mai = rep(0, 4))
	plot.new()
	par(fin = c(width * 1.08, height * 1.08), new = T) ### !!!!!
	plot.window(xlim = xlim, ylim = ylim, asp = asp)
}

# my view port
xlim <- c(-10, -6)
ylim <- c(36.9, 42.5)

pdfNoBorder(file = "map_2.pdf", width = 5, xlim = xlim, ylim = ylim, 
	bg = "azure2")
plot(wrld_simpl, add = TRUE, col = "khaki")
rect(xlim[1], ylim[1], xlim[2], ylim[2], border = "red")
dev.off()

# ________________________________________

and Figure 2 shows the result. So far so good, but if you look at the "pdfNoBorder" function I have to use "an empirical hack" namely the line:

par(fin = c(width * 1.08, height * 1.08), new = T)

The value 1.08 works "quite well" but I think that this value is a function of width, height, and the ratio width/height or similar and - of course - it's not precisely.


My question is now whether somebody could give my an hint how to draw a PDF map which shows ONLY my desired view port and without any border by using a "clean" way without any estimated values.


Many thanks in advance,

--Hans



Figure 1
-------------- next part --------------
A non-text attachment was scrubbed...
Name: map_1.pdf
Type: application/pdf
Size: 4482 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20091210/b44d96e4/attachment.pdf>
-------------- next part --------------


Figure 2
-------------- next part --------------
A non-text attachment was scrubbed...
Name: map_2.pdf
Type: application/pdf
Size: 4283 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20091210/b44d96e4/attachment-0001.pdf>
-------------- next part --------------





From rusers.sh at gmail.com  Thu Dec 10 21:17:21 2009
From: rusers.sh at gmail.com (rusers.sh)
Date: Thu, 10 Dec 2009 15:17:21 -0500
Subject: [R-sig-Geo] error for converting between KML and Shape file
Message-ID: <a835c81e0912101217o4e5cf0aax616cfe69ea72e6b5@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20091210/2291d35a/attachment.pl>

From b.rowlingson at lancaster.ac.uk  Thu Dec 10 21:41:33 2009
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Thu, 10 Dec 2009 20:41:33 +0000
Subject: [R-sig-Geo] error for converting between KML and Shape file
In-Reply-To: <a835c81e0912101217o4e5cf0aax616cfe69ea72e6b5@mail.gmail.com>
References: <a835c81e0912101217o4e5cf0aax616cfe69ea72e6b5@mail.gmail.com>
Message-ID: <d8ad40b50912101241q3d126345pfc39f65df886359c@mail.gmail.com>

On Thu, Dec 10, 2009 at 8:17 PM, rusers.sh <rusers.sh at gmail.com> wrote:
> Hi all,
> ?I try to use the readOGR and writeOGR in rgdal package to do the
> conversion KML and Shape files, but failed. Following is my codes for a
> simulated dataset.
> #library(rgdal);library(maptools);ogrDrivers()
> #generate a simulated point SHAPE file,its name is "pointexamle0" and save
> in "h:/example".
> x<-runif(5)*180;y<-runif(5)*90
> pointsam<-SpatialPoints(data.frame(x,y), proj4string=CRS("+proj=longlat
> +ellps=WGS84"))
> write.pointShape(coordinates(pointsam), df=as(pointsam, "data.frame"),
> file="h:/example/pointexamle0")
>
> #1. Conver SHAPE file to KML file
> importshp <- readOGR(dsn="h:/example",layer="pointexamle0") #correct
> proj4string(importshp)<-CRS("+proj=longlat +ellps=WGS84")
> writeOGR(obj=importshp,dsn="h:/example",driver="KML",layer="output")
> ?#????Errors
> #Error in writeOGR(obj = importshp, dsn = "h:/example", driver = "KML", ?:
> ? ? ? ? ?GDAL Error 4: Failed to create KML file h:/example.
>

 The devil, as we say, is in the details (which for some reason are truncated!):

Details:

    Working out which combination of dsn, layer, and driver (and
    option) values give the desired output takes time and care, and is
    constrained by the ability of drivers to write output; many ar

The parameters for writeOGR are:

writeOGR(object, fileName, layerName,driver="KML")

Here 'object' is your R Spatial Points/Poly/etc, 'fileName' is the
path (including filename) for your output KML, and 'layerName' is a
label that your layer will get in the KML - you'll see this in the
layer list in Google Earth, for example.

 Example:

writeOGR(myPoints,"/tmp/test.kml","TestLayer",driver="KML")


Barry
-- 
blog: http://geospaced.blogspot.com/
web: http://www.maths.lancs.ac.uk/~rowlings
web: http://www.rowlingson.com/
twitter: http://twitter.com/geospacedman
pics: http://www.flickr.com/photos/spacedman


From rusers.sh at gmail.com  Thu Dec 10 22:14:07 2009
From: rusers.sh at gmail.com (rusers.sh)
Date: Thu, 10 Dec 2009 16:14:07 -0500
Subject: [R-sig-Geo] error for converting between KML and Shape file
In-Reply-To: <d8ad40b50912101241q3d126345pfc39f65df886359c@mail.gmail.com>
References: <a835c81e0912101217o4e5cf0aax616cfe69ea72e6b5@mail.gmail.com>
	<d8ad40b50912101241q3d126345pfc39f65df886359c@mail.gmail.com>
Message-ID: <a835c81e0912101314k74bbf77fxa6c560094df2795b@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20091210/b6212065/attachment.pl>

From nitmithv at yahoo.com.cn  Fri Dec 11 06:59:42 2009
From: nitmithv at yahoo.com.cn (ZK)
Date: Fri, 11 Dec 2009 00:59:42 -0500
Subject: [R-sig-Geo] Is Co-Kriging useful for pollutant measurements at 8
	monitors?
Message-ID: <200912110059418034723@yahoo.com.cn>

Dear all,

I have daily pollutant measurements (CO, NO2, PM2.5 and Ozone) at different monitors from 2005 to 2008.  NO2 monitors have some overlapping with PM2.5 monitors. The maximum number of monitors for pollutant levels is 8.  NO2 has strong correlation with PM2.5. I am wondering if Co-Kriging between NO2 and PM2.5 are helpful because I am feeling that the total number of monitors are small.

I appreciate your response and best regards,
Kai


__________________________________________________
???????????????


From nitmithv at yahoo.com.cn  Fri Dec 11 07:00:01 2009
From: nitmithv at yahoo.com.cn (ZK)
Date: Fri, 11 Dec 2009 01:00:01 -0500
Subject: [R-sig-Geo] How to automatically fit variogram in gstat
Message-ID: <200912110100009590454@yahoo.com.cn>

Dear all,
I have daily pollutant measurements (CO, NO2, PM2.5 and Ozone) at 8 monitors from 2005 to 2008.  My purpose is to estimate daily exposures for studying subjects using Kriging for three years.  A common procedure is to plot experimental variogram and then to choose a theoretical model (e.g., exponential model or Gaussian model) with some adjustment on parameters.  However, this manual way is not appropriate for my application. I am wondering how I can fit variogram in gstat automatically. 

I appreciate your response and best regards,
Kai

	




__________________________________________________
???????????????


From p.hiemstra at geo.uu.nl  Fri Dec 11 10:22:58 2009
From: p.hiemstra at geo.uu.nl (Paul Hiemstra)
Date: Fri, 11 Dec 2009 10:22:58 +0100
Subject: [R-sig-Geo] How to automatically fit variogram in gstat
In-Reply-To: <200912110100009590454@yahoo.com.cn>
References: <200912110100009590454@yahoo.com.cn>
Message-ID: <4B220F72.2080409@geo.uu.nl>

Hi,

One option is to use the automap package, this provides the function
autofitVariogram and autoKrige. Automap is available on CRAN. An
alternative is to use the fit.variogram function from gstat (which
automap also does).

An additional comment, 8 stations is not a lot to base variogram models
on. Think carefully how you want to solve this problem. Maybe you can
make some kind of aggregated sample variogram that incorporates not only
the data from one day, but of one month. In this way you can increase
the amount of data you use to create the variogram. But still, just 8
stations looks to be quite a challenge.

good luck!
Paul

ZK wrote:
> Dear all,
> I have daily pollutant measurements (CO, NO2, PM2.5 and Ozone) at 8 monitors from 2005 to 2008.  My purpose is to estimate daily exposures for studying subjects using Kriging for three years.  A common procedure is to plot experimental variogram and then to choose a theoretical model (e.g., exponential model or Gaussian model) with some adjustment on parameters.  However, this manual way is not appropriate for my application. I am wondering how I can fit variogram in gstat automatically. 
>
> I appreciate your response and best regards,
> Kai
>
> 	
>
>
>
>
> __________________________________________________
> ???????????????
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>   


-- 
Drs. Paul Hiemstra
Department of Physical Geography
Faculty of Geosciences
University of Utrecht
Heidelberglaan 2
P.O. Box 80.115
3508 TC Utrecht
Phone:  +3130 274 3113 Mon-Tue
Phone:  +3130 253 5773 Wed-Fri
http://intamap.geo.uu.nl/~paul


From ageel_bushara at yahoo.com  Fri Dec 11 11:28:04 2009
From: ageel_bushara at yahoo.com (ageel bushara)
Date: Fri, 11 Dec 2009 02:28:04 -0800 (PST)
Subject: [R-sig-Geo] Cross validation for conditional Gaussian simulations
Message-ID: <734899.59679.qm@web35806.mail.mud.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20091211/119b5e59/attachment.pl>

From sa.cizmeli at usherbrooke.ca  Fri Dec 11 17:11:50 2009
From: sa.cizmeli at usherbrooke.ca (servet ahmet =?iso-8859-1?b?52l6bWVsaQ==?=)
Date: Fri, 11 Dec 2009 11:11:50 -0500
Subject: [R-sig-Geo] spplot : varying dots for multiple parameters
Message-ID: <1260547910.4b226f46e3f22@www.usherbrooke.ca>

Dear all,

I am new to R and sp. Thanks for your patience. I did several hours of research
in various places. This list is my last resort.

I am trying to plot on a spatial map the punctual measurements of the
data located in the file (https://opengeo.metu.edu.tr/test.csv). I'd like to do
that with the tools in the lattice package as I will add more parameters on the
same graph later. When I call spplot using the code given below, I get the
warning:

Warning messages:
1: In if (!x$aspect.fill) panel.height[[1]] <- x$aspect.ratio * panel.width[[1]]
:
  the condition has length > 1 and only the first element will be used
2: In if (layout.respect) { :
  the condition has length > 1 and only the first element will be used
3: In heights.x[pos.heights[["panel"]]] <- heights.settings[["panel"]] *  :
  number of items to replace is not a multiple of replacement length

Question 1 : I did several trials but could not eliminate this warning. Is this
serious?

Question 2 : Only the dots of the parameter "SPM" varies with its magnitude. How
to make the other parameters also have varying dot sizes?

Question 3 : I formed the code below by basing myself on an example given in the
book of Bivand et al. I then arbitrarily changed the "scale" parameter of the
scalebar so that it goes in a nice place. However, how could I now the real
length of the scale bar so that I can change the "1km" string which is false
right now.

Any ideas?
thanks a lot from advance
Servet

rm(list=ls())
library(sp)

Insitu = read.table("test.csv", skip=3,sep=",")
Header = read.table("test.csv", skip=1,sep=",",nrows=1)
names(Insitu)= as.character(as.matrix(Header))
CRS_4326 = CRS("+init=epsg:4326")

Insitu_sp <-
SpatialPointsDataFrame(cbind(Insitu[,"Boylam"],Insitu[,"Enlem"]),
data=Insitu, proj4string=CRS_4326)

idx = is.na(Insitu[,"SPM"])
ptsize = 20/(sqrt(Insitu[!idx,"SPM"])+1)

pts <- list("sp.points", Insitu_sp[!idx,"SPM"], pch = 4, col = "red",cex=ptsize)
north <- list("SpatialPolygonsRescale", layout.north.arrow(),
    offset = c(28.85, 36.735), scale = 0.02)
scale <- list("SpatialPolygonsRescale", layout.scale.bar(),
    offset = c(29, 36.735), scale = 0.1, fill = c("transparent",
        "black"))
txt1 <- list("sp.text", c(29, 36.745), "0")
txt2 <- list("sp.text", c(29.1, 36.745), "1 km")

my.layout <- list(txt1,txt2,scale,north)
spplot(Insitu_sp[!idx,c("SPM","Si","LUT","HEX")],cex=ptsize,sp.layout =
my.layout)


From Roger.Bivand at nhh.no  Sat Dec 12 11:39:52 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sat, 12 Dec 2009 11:39:52 +0100 (CET)
Subject: [R-sig-Geo] spplot : varying dots for multiple parameters
In-Reply-To: <1260547910.4b226f46e3f22@www.usherbrooke.ca>
References: <1260547910.4b226f46e3f22@www.usherbrooke.ca>
Message-ID: <alpine.LRH.2.00.0912121109040.21488@reclus.nhh.no>

On Fri, 11 Dec 2009, servet ahmet ?izmeli wrote:

> Dear all,
>
> I am new to R and sp. Thanks for your patience. I did several hours of research
> in various places. This list is my last resort.
>
> I am trying to plot on a spatial map the punctual measurements of the
> data located in the file (https://opengeo.metu.edu.tr/test.csv). I'd like to do
> that with the tools in the lattice package as I will add more parameters on the
> same graph later. When I call spplot using the code given below, I get the
> warning:
>
> Warning messages:
> 1: In if (!x$aspect.fill) panel.height[[1]] <- x$aspect.ratio * panel.width[[1]]
> :
>  the condition has length > 1 and only the first element will be used
> 2: In if (layout.respect) { :
>  the condition has length > 1 and only the first element will be used
> 3: In heights.x[pos.heights[["panel"]]] <- heights.settings[["panel"]] *  :
>  number of items to replace is not a multiple of replacement length
>
> Question 1 : I did several trials but could not eliminate this warning. Is this
> serious?

Thank you for providing both a sample data set and your code - this makes 
trying to help very much easier! Had you also added the output of 
sessionInfo(), I might have been able to answer this question. On Linux 
x86_64 with a Cairo graphics device and current sp, I cannot reproduce 
these warnings.

>
> Question 2 : Only the dots of the parameter "SPM" varies with its magnitude. How
> to make the other parameters also have varying dot sizes?
>

The values of Si, LUT and HEX all fall into the smallest class for SPM, 
which is why no variation is seen. Is it possible that you might rather 
use:

idx = is.na(Insitu$SPM)
bSPM <- bubble(Insitu_sp[!idx,], "SPM")
plot(bSPM, split=c(1,1,2,2), more=TRUE)
bSi <- bubble(Insitu_sp, "Si")
plot(bSi, split=c(1,2,2,2), more=TRUE)
# all LUT values are zero, so nothing to plot
idx = is.na(Insitu$HEX)
bHEX <- bubble(Insitu_sp[!idx,], "HEX")
plot(bHEX, split=c(2,2,2,2), more=FALSE)

The idea is to try to do things more simply first, and only make them 
complicated when as many as possible of the oddities of the input data 
have been taken into account (like NAs, all values zero, etc.). You can 
find that the area "jumps around", as does the scaling, with different idx 
values - this needs care:

xlim <- c(28.7, 29.3)
ylim <- c(36.6, 36.8)
idx = is.na(Insitu$SPM)
bSPM <- bubble(Insitu_sp[!idx,], "SPM", xlim=xlim, ylim=ylim)
plot(bSPM, split=c(1,1,1,3), more=TRUE)
bSi <- bubble(Insitu_sp, "Si", xlim=xlim, ylim=ylim)
plot(bSi, split=c(1,2,1,3), more=TRUE)
# all LUT values are zero, so nothing to plot
idx = is.na(Insitu$HEX)
bHEX <- bubble(Insitu_sp[!idx,], "HEX", xlim=xlim, ylim=ylim)
plot(bHEX, split=c(1,3,1,3), more=FALSE)

is a possibility.


> Question 3 : I formed the code below by basing myself on an example given in the
> book of Bivand et al. I then arbitrarily changed the "scale" parameter of the
> scalebar so that it goes in a nice place. However, how could I now the real
> length of the scale bar so that I can change the "1km" string which is false
> right now.

Please leave these decorations until everything else has been settled. 
Hint: use spDistsN1() to get a km distance to use in the scale.

Hope this helps,

Roger

>
> Any ideas?
> thanks a lot from advance
> Servet
>
> rm(list=ls())
> library(sp)
>
> Insitu = read.table("test.csv", skip=3,sep=",")
> Header = read.table("test.csv", skip=1,sep=",",nrows=1)
> names(Insitu)= as.character(as.matrix(Header))
> CRS_4326 = CRS("+init=epsg:4326")
>
> Insitu_sp <-
> SpatialPointsDataFrame(cbind(Insitu[,"Boylam"],Insitu[,"Enlem"]),
> data=Insitu, proj4string=CRS_4326)
>
> idx = is.na(Insitu[,"SPM"])
> ptsize = 20/(sqrt(Insitu[!idx,"SPM"])+1)
>
> pts <- list("sp.points", Insitu_sp[!idx,"SPM"], pch = 4, col = "red",cex=ptsize)
> north <- list("SpatialPolygonsRescale", layout.north.arrow(),
>    offset = c(28.85, 36.735), scale = 0.02)
> scale <- list("SpatialPolygonsRescale", layout.scale.bar(),
>    offset = c(29, 36.735), scale = 0.1, fill = c("transparent",
>        "black"))
> txt1 <- list("sp.text", c(29, 36.745), "0")
> txt2 <- list("sp.text", c(29.1, 36.745), "1 km")
>
> my.layout <- list(txt1,txt2,scale,north)
> spplot(Insitu_sp[!idx,c("SPM","Si","LUT","HEX")],cex=ptsize,sp.layout =
> my.layout)
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From hengl at spatial-analyst.net  Sun Dec 13 18:29:10 2009
From: hengl at spatial-analyst.net (Tomislav Hengl)
Date: Sun, 13 Dec 2009 18:29:10 +0100
Subject: [R-sig-Geo] Making web-repository of gridded maps: NetCDF or WKT
	Raster?
Message-ID: <4B252466.6090307@spatial-analyst.net>


Dear R-sig-geo,

As a part of our project (EcoGRID.nl) we have prepared some 60 thematic 
grids that we use as auxiliary predictors for species distribution 
modeling. At this stage, we would like to put the gridded maps (50/100 m 
base resolution) into some efficient sharable geo-database.

We will most probably put the data into the NetCDF format 
(http://www.unidata.ucar.edu/software/netcdf/) because it can handle 
any-dimensional array data, and because it has been in continuous 
development and widespread use for many years. NetCDF grids can be read 
relatively easy into R using the RNetCDF package (e.g. 
http://spatial-analyst.net/DATA/readNCDF.zip). Another alternative is to 
use PostGIS WKT Raster format 
(http://trac.osgeo.org/postgis/wiki/WKTRaster), but this seems to be 
still rather experimental (?).

Once we put the grids into NetCDF format. We plan to install OPeNDAP 
(http://www.opendap.org) server on top to make the files accessible 
through the web; then Geoserver (http://www.geoserver.org) or UMN 
Mapserver (http://mapserver.org) to feed a WMS from NetCDF files (raster 
data). Finally, we plan to add a simple OpenLayers interface on top of 
that (Geoserver has it built in) to allow direct browsing of the data 
and metadata (e.g. such as this one: http://africamap.harvard.edu/)

Just to be clear, we want to put the data on a server because we would 
like to run a number of operations directly on the server (via rgdal?):

1. Overlay some point data and get the values of grids (without a need 
to download the grids locally);
2. Subset/mask and resample gridded data of interest (for a given 
bounding box and proj4 string; again without a need to download the data 
locally);
3. Upscale the grids from 100 m to 250, 500 m and 1 km resolution (then 
download the upscaled grids).
4. Write/upload new grids to the database (e.g. using WebDAV).
5. Browse the grids (and metadata) via the OpenLayers.

These are only our wishes of course. We do not know if all this is 
really possible with the current software.

Any examples or comments/suggestions/experiences are welcome (before we 
start installing and testing the functionality).

Thanx!

Tomislav Hengl and Lourens Veen


From stefano at casalegno.net  Sun Dec 13 18:58:58 2009
From: stefano at casalegno.net (Stefano Casalegno)
Date: Sun, 13 Dec 2009 18:58:58 +0100
Subject: [R-sig-Geo] Making web-repository of gridded maps: NetCDF or
	WKT Raster?
In-Reply-To: <4B252466.6090307@spatial-analyst.net>
References: <4B252466.6090307@spatial-analyst.net>
Message-ID: <D4AC42F5-3142-4A62-8AD3-F496032BFAD7@casalegno.net>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20091213/807ccba7/attachment.pl>

From edzer.pebesma at uni-muenster.de  Sun Dec 13 21:04:49 2009
From: edzer.pebesma at uni-muenster.de (Edzer J. Pebesma)
Date: Sun, 13 Dec 2009 21:04:49 +0100
Subject: [R-sig-Geo] Making web-repository of gridded maps: NetCDF or
 WKT Raster?
In-Reply-To: <D4AC42F5-3142-4A62-8AD3-F496032BFAD7@casalegno.net>
References: <4B252466.6090307@spatial-analyst.net>
	<D4AC42F5-3142-4A62-8AD3-F496032BFAD7@casalegno.net>
Message-ID: <4B2548E1.1040706@uni-muenster.de>

Dear Tom,

as your grids are spatial grids, you may want to look into the web 
service standards of the OGC (www.opengeospatial.org) for them, WCS (for 
reading) and WCS-T (for writing) in particular. We're experimenting with 
this currently, using the recently open sourced rasdaman software 
(www.rasdaman.org), which uses a data base in the back end. I don't 
think OPeNDAP has special infrastructure for spatial grids; CFNetCDF 
does, but by choosing this you may limit integration with other software 
that does assume spatial data to be served over OGC standards. CFNetCDF 
is one of the possible formats to be served over WCS (and GeoTIFF etc) 
-- if I'm correctly informed.

Bests,
--
Edzer

Stefano Casalegno wrote:
> Dear Tom,
> my best acknowledgment for the Ecogrid challenging initiative.
> I guess the main limitation will be "time" and this is related to the  
> size of grids.
> What is the extent of the grids ?
> What tool you plan to use for point 1. Overlay some point data and  
> get the values of grids ?
>
> On a more theoretical basis,
> "distribution models should rely upon data that covers the whole  
> extent of the distribution of the biota under examination"
>
> Please consider forest data from
> http://forest.jrc.ec.europa.eu/climate-change
> as supplementary predictors variables within an European biodiversity  
> and nature conservation application.
>
> Cheers
> Stefano
>
>
> ________________________________
>
> Stefano Casalegno, Ph.D.
>
> via Greppi 16, 21021 Angera - Italy
> email: stefano at casalegno.net
> web: http://www.casalegno.net/stefano
> ________________________________
>
>
> On Dec 13, 2009, at 6:29 PM, Tomislav Hengl wrote:
>
>   
>> Dear R-sig-geo,
>>
>> As a part of our project (EcoGRID.nl) we have prepared some 60  
>> thematic grids that we use as auxiliary predictors for species  
>> distribution modeling. At this stage, we would like to put the  
>> gridded maps (50/100 m base resolution) into some efficient  
>> sharable geo-database.
>>
>> We will most probably put the data into the NetCDF format (http:// 
>> www.unidata.ucar.edu/software/netcdf/) because it can handle any- 
>> dimensional array data, and because it has been in continuous  
>> development and widespread use for many years. NetCDF grids can be  
>> read relatively easy into R using the RNetCDF package (e.g. http:// 
>> spatial-analyst.net/DATA/readNCDF.zip). Another alternative is to  
>> use PostGIS WKT Raster format (http://trac.osgeo.org/postgis/wiki/ 
>> WKTRaster), but this seems to be still rather experimental (?).
>>
>> Once we put the grids into NetCDF format. We plan to install  
>> OPeNDAP (http://www.opendap.org) server on top to make the files  
>> accessible through the web; then Geoserver (http:// 
>> www.geoserver.org) or UMN Mapserver (http://mapserver.org) to feed  
>> a WMS from NetCDF files (raster data). Finally, we plan to add a  
>> simple OpenLayers interface on top of that (Geoserver has it built  
>> in) to allow direct browsing of the data and metadata (e.g. such as  
>> this one: http://africamap.harvard.edu/)
>>
>> Just to be clear, we want to put the data on a server because we  
>> would like to run a number of operations directly on the server  
>> (via rgdal?):
>>
>> 1. Overlay some point data and get the values of grids (without a  
>> need to download the grids locally);
>> 2. Subset/mask and resample gridded data of interest (for a given  
>> bounding box and proj4 string; again without a need to download the  
>> data locally);
>> 3. Upscale the grids from 100 m to 250, 500 m and 1 km resolution  
>> (then download the upscaled grids).
>> 4. Write/upload new grids to the database (e.g. using WebDAV).
>> 5. Browse the grids (and metadata) via the OpenLayers.
>>
>> These are only our wishes of course. We do not know if all this is  
>> really possible with the current software.
>>
>> Any examples or comments/suggestions/experiences are welcome  
>> (before we start installing and testing the functionality).
>>
>> Thanx!
>>
>> Tomislav Hengl and Lourens Veen
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>     
>
>
>
>
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From nitmithv at yahoo.com.cn  Mon Dec 14 07:46:41 2009
From: nitmithv at yahoo.com.cn (Kai Zhang)
Date: Mon, 14 Dec 2009 01:46:41 -0500
Subject: [R-sig-Geo] Co-Kriging with huge data
Message-ID: <200912140146405621465@yahoo.com.cn>

Dear all,

I have temperature measurements at 17 monitors.  I have a secondary variable across the study area, which includes 230,000 points. I tried to conduct Co-Kring with this huge dataset and it appeared to be computationally intensive. Is there any way to run it except for running the program in a cluster?

I appreciate your response and best regards,
Kai

	




__________________________________________________
???????????????


From edzer.pebesma at uni-muenster.de  Mon Dec 14 08:02:24 2009
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Mon, 14 Dec 2009 08:02:24 +0100
Subject: [R-sig-Geo] spplot : varying dots for multiple parameters
In-Reply-To: <1260547910.4b226f46e3f22@www.usherbrooke.ca>
References: <1260547910.4b226f46e3f22@www.usherbrooke.ca>
Message-ID: <4B25E300.5050601@uni-muenster.de>



servet ahmet ?izmeli wrote:
> Dear all,
>
> I am new to R and sp. Thanks for your patience. I did several hours of research
> in various places. This list is my last resort.
>
> I am trying to plot on a spatial map the punctual measurements of the
> data located in the file (https://opengeo.metu.edu.tr/test.csv). I'd like to do
> that with the tools in the lattice package as I will add more parameters on the
> same graph later. When I call spplot using the code given below, I get the
> warning:
>
> Warning messages:
> 1: In if (!x$aspect.fill) panel.height[[1]] <- x$aspect.ratio * panel.width[[1]]
> :
>   the condition has length > 1 and only the first element will be used
> 2: In if (layout.respect) { :
>   the condition has length > 1 and only the first element will be used
> 3: In heights.x[pos.heights[["panel"]]] <- heights.settings[["panel"]] *  :
>   number of items to replace is not a multiple of replacement length
>
> Question 1 : I did several trials but could not eliminate this warning. Is this
> serious?
>   
I don't see them, maybe update the sp package helps?
> Question 2 : Only the dots of the parameter "SPM" varies with its magnitude. How
> to make the other parameters also have varying dot sizes?
>   
I don't think spplot allows this; you'd have to use lattice' function
xyplot, to which spplot (for points) is a rather thin wrapper.

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster 
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251 
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de 
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From edzer.pebesma at uni-muenster.de  Mon Dec 14 08:49:06 2009
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Mon, 14 Dec 2009 08:49:06 +0100
Subject: [R-sig-Geo] Co-Kriging with huge data
In-Reply-To: <200912140146405621465@yahoo.com.cn>
References: <200912140146405621465@yahoo.com.cn>
Message-ID: <4B25EDF2.3020000@uni-muenster.de>



Kai Zhang wrote:
> Dear all,
>
> I have temperature measurements at 17 monitors.  I have a secondary variable across the study area, which includes 230,000 points. I tried to conduct Co-Kring with this huge dataset and it appeared to be computationally intensive. Is there any way to run it except for running the program in a cluster?
>
> I appreciate your response and best regards,
> Kai
>   
One alternative would be to use co-kriging and to limit the search
neighbourhood for the secondary variable. The question is how much.
Maybe a cross validation with your 17 temperature monitors can give you
some idea on this. If someone knows about existing literature on this,
I'd be happy to hear.

Another possibility is to use universal kriging, with your secondary
variable treated as predictor. For this, you need the values of your
secondary variable to be known ath the 17 monitor sites, and the
prediction locations should coincide with (some of) the 230000 points.
It is not equivalent to the first approach, poorer in the sense that it
ignores the secondary variable at locations beyond the prediction
location, but assumes a linear relationship between the two as well.

-- 

Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster 
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251 
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de 
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From b.rowlingson at lancaster.ac.uk  Mon Dec 14 10:59:55 2009
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Mon, 14 Dec 2009 09:59:55 +0000
Subject: [R-sig-Geo] Making web-repository of gridded maps: NetCDF or
	WKT Raster?
In-Reply-To: <4B252466.6090307@spatial-analyst.net>
References: <4B252466.6090307@spatial-analyst.net>
Message-ID: <d8ad40b50912140159k7c671770l20c70404a69b844a@mail.gmail.com>

On Sun, Dec 13, 2009 at 5:29 PM, Tomislav Hengl
<hengl at spatial-analyst.net> wrote:
>
> Dear R-sig-geo,
>
> As a part of our project (EcoGRID.nl) we have prepared some 60 thematic
> grids that we use as auxiliary predictors for species distribution modeling.
> At this stage, we would like to put the gridded maps (50/100 m base
> resolution) into some efficient sharable geo-database.
>

One very random idea for this kind of thing would be to use the
software behind the IRI Data Library:

http://iridl.ldeo.columbia.edu/index.html

It has a built in processing language ('ingrid') for manipulating data
on the server before returning it to the client, supports multiple
output map formats, data selection, non-spatial data, high-dimensional
data etc etc. You can map stuff and download it:

http://iridl.ldeo.columbia.edu/SOURCES/.NASA/.GPCP/.V2p1/.AGPI/figviewer.html?plottype=colors

and it's apparently easy to write server-side processing modules to
provide add-on functionality by writing new ingrid functions.

The only problem is that the code behind it doesn't seem to be
available, which is a real shame...

Barry

-- 
blog: http://geospaced.blogspot.com/
web: http://www.maths.lancs.ac.uk/~rowlings
web: http://www.rowlingson.com/
twitter: http://twitter.com/geospacedman
pics: http://www.flickr.com/photos/spacedman


From p.hiemstra at geo.uu.nl  Mon Dec 14 11:06:38 2009
From: p.hiemstra at geo.uu.nl (Paul Hiemstra)
Date: Mon, 14 Dec 2009 11:06:38 +0100
Subject: [R-sig-Geo] How to automatically fit variogram in gstat
In-Reply-To: <200912121537411560606@yahoo.com.cn>
References: <200912110100009590454@yahoo.com.cn>,
	<4B220F72.2080409@geo.uu.nl> <200912121537411560606@yahoo.com.cn>
Message-ID: <4B260E2E.10605@geo.uu.nl>

Hi Kai,

If it improves depends on how you define improvement. If you want to use
IDW automatic you need to fit the distance power in some way. When you
fit the variogram automatically, you get this distance dependency of the
weights from the variogram. In regard to co-kriging, if there is a
strong correlation between the various pollutant measures (co-located)
co-kriging can be a good option.

cheers,
Paul

ps I included R-sig-geo again as a cc so the conversation is also on the
mailing list. It is best to use "Reply to all" when you reply to these
kind of e-mails.

ZK wrote:
> Hi Paul,
>
> Many thanks for your suggestion. You are right and I would expect to Kriging improves a little compared to inverse distance method. Btw, do you think co-kriging is useful for 8 monitors?
>
> Thanks,
> Kai
> 	
>
> ____________________________________________________
> Kai Zhang
> PhD Candidate, Environmental Health Sciences
> School of Public Health                        
> University of Michigan                         
> 109 S. Observatory                       
> Ann Arbor, MI 48109-2029         
> ____________________________________________________
>
> ======= 2009-12-11 04:23:11 You wrote =======
>
>   
>> Hi,
>>
>> One option is to use the automap package, this provides the function
>> autofitVariogram and autoKrige. Automap is available on CRAN. An
>> alternative is to use the fit.variogram function from gstat (which
>> automap also does).
>>
>> An additional comment, 8 stations is not a lot to base variogram models
>> on. Think carefully how you want to solve this problem. Maybe you can
>> make some kind of aggregated sample variogram that incorporates not only
>> the data from one day, but of one month. In this way you can increase
>> the amount of data you use to create the variogram. But still, just 8
>> stations looks to be quite a challenge.
>>
>> good luck!
>> Paul
>>
>> ZK wrote:
>>     
>>> Dear all,
>>> I have daily pollutant measurements (CO, NO2, PM2.5 and Ozone) at 8 monitors from 2005 to 2008.  My purpose is to estimate daily exposures for studying subjects using Kriging for three years.  A common procedure is to plot experimental variogram and then to choose a theoretical model (e.g., exponential model or Gaussian model) with some adjustment on parameters.  However, this manual way is not appropriate for my application. I am wondering how I can fit variogram in gstat automatically. 
>>>
>>> I appreciate your response and best regards,
>>> Kai
>>>
>>> 	
>>>
>>>
>>>
>>>
>>> __________________________________________________
>>> ?????????????????????????????
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>   
>>>       
>> -- 
>> Drs. Paul Hiemstra
>> Department of Physical Geography
>> Faculty of Geosciences
>> University of Utrecht
>> Heidelberglaan 2
>> P.O. Box 80.115
>> 3508 TC Utrecht
>> Phone:  +3130 274 3113 Mon-Tue
>> Phone:  +3130 253 5773 Wed-Fri
>> http://intamap.geo.uu.nl/~paul
>>
>>     
>
>
> ??i??'?????h??&


-- 
Drs. Paul Hiemstra
Department of Physical Geography
Faculty of Geosciences
University of Utrecht
Heidelberglaan 2
P.O. Box 80.115
3508 TC Utrecht
Phone:  +3130 274 3113 Mon-Tue
Phone:  +3130 253 5773 Wed-Fri
http://intamap.geo.uu.nl/~paul


From pslarson2 at gmail.com  Mon Dec 14 12:16:20 2009
From: pslarson2 at gmail.com (Pete Larson)
Date: Mon, 14 Dec 2009 06:16:20 -0500
Subject: [R-sig-Geo] MSE
In-Reply-To: <4B2548E1.1040706@uni-muenster.de>
References: <4B252466.6090307@spatial-analyst.net>	<D4AC42F5-3142-4A62-8AD3-F496032BFAD7@casalegno.net>
	<4B2548E1.1040706@uni-muenster.de>
Message-ID: <4B261E84.5070805@gmail.com>

Hello,

Is there any easy way to get the MSE from the gstat kriging fucntions? 
Or just the residuals at the measurement points?

Thanks,

Pete




Edzer J. Pebesma wrote:
> Dear Tom,
>
> as your grids are spatial grids, you may want to look into the web 
> service standards of the OGC (www.opengeospatial.org) for them, WCS 
> (for reading) and WCS-T (for writing) in particular. We're 
> experimenting with this currently, using the recently open sourced 
> rasdaman software (www.rasdaman.org), which uses a data base in the 
> back end. I don't think OPeNDAP has special infrastructure for spatial 
> grids; CFNetCDF does, but by choosing this you may limit integration 
> with other software that does assume spatial data to be served over 
> OGC standards. CFNetCDF is one of the possible formats to be served 
> over WCS (and GeoTIFF etc) -- if I'm correctly informed.
>
> Bests,
> -- 
> Edzer
>
> Stefano Casalegno wrote:
>> Dear Tom,
>> my best acknowledgment for the Ecogrid challenging initiative.
>> I guess the main limitation will be "time" and this is related to 
>> the  size of grids.
>> What is the extent of the grids ?
>> What tool you plan to use for point 1. Overlay some point data and  
>> get the values of grids ?
>>
>> On a more theoretical basis,
>> "distribution models should rely upon data that covers the whole  
>> extent of the distribution of the biota under examination"
>>
>> Please consider forest data from
>> http://forest.jrc.ec.europa.eu/climate-change
>> as supplementary predictors variables within an European 
>> biodiversity  and nature conservation application.
>>
>> Cheers
>> Stefano
>>
>>
>> ________________________________
>>
>> Stefano Casalegno, Ph.D.
>>
>> via Greppi 16, 21021 Angera - Italy
>> email: stefano at casalegno.net
>> web: http://www.casalegno.net/stefano
>> ________________________________
>>
>>
>> On Dec 13, 2009, at 6:29 PM, Tomislav Hengl wrote:
>>
>>  
>>> Dear R-sig-geo,
>>>
>>> As a part of our project (EcoGRID.nl) we have prepared some 60  
>>> thematic grids that we use as auxiliary predictors for species  
>>> distribution modeling. At this stage, we would like to put the  
>>> gridded maps (50/100 m base resolution) into some efficient  
>>> sharable geo-database.
>>>
>>> We will most probably put the data into the NetCDF format (http:// 
>>> www.unidata.ucar.edu/software/netcdf/) because it can handle any- 
>>> dimensional array data, and because it has been in continuous  
>>> development and widespread use for many years. NetCDF grids can be  
>>> read relatively easy into R using the RNetCDF package (e.g. http:// 
>>> spatial-analyst.net/DATA/readNCDF.zip). Another alternative is to  
>>> use PostGIS WKT Raster format (http://trac.osgeo.org/postgis/wiki/ 
>>> WKTRaster), but this seems to be still rather experimental (?).
>>>
>>> Once we put the grids into NetCDF format. We plan to install  
>>> OPeNDAP (http://www.opendap.org) server on top to make the files  
>>> accessible through the web; then Geoserver (http:// 
>>> www.geoserver.org) or UMN Mapserver (http://mapserver.org) to feed  
>>> a WMS from NetCDF files (raster data). Finally, we plan to add a  
>>> simple OpenLayers interface on top of that (Geoserver has it built  
>>> in) to allow direct browsing of the data and metadata (e.g. such as  
>>> this one: http://africamap.harvard.edu/)
>>>
>>> Just to be clear, we want to put the data on a server because we  
>>> would like to run a number of operations directly on the server  
>>> (via rgdal?):
>>>
>>> 1. Overlay some point data and get the values of grids (without a  
>>> need to download the grids locally);
>>> 2. Subset/mask and resample gridded data of interest (for a given  
>>> bounding box and proj4 string; again without a need to download the  
>>> data locally);
>>> 3. Upscale the grids from 100 m to 250, 500 m and 1 km resolution  
>>> (then download the upscaled grids).
>>> 4. Write/upload new grids to the database (e.g. using WebDAV).
>>> 5. Browse the grids (and metadata) via the OpenLayers.
>>>
>>> These are only our wishes of course. We do not know if all this is  
>>> really possible with the current software.
>>>
>>> Any examples or comments/suggestions/experiences are welcome  
>>> (before we start installing and testing the functionality).
>>>
>>> Thanx!
>>>
>>> Tomislav Hengl and Lourens Veen
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>>     
>>
>>
>>
>>
>>
>>
>>     [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From ashton at msu.edu  Mon Dec 14 17:25:32 2009
From: ashton at msu.edu (Ashton Shortridge)
Date: Mon, 14 Dec 2009 11:25:32 -0500
Subject: [R-sig-Geo] MSE
In-Reply-To: <4B261E84.5070805@gmail.com>
References: <4B252466.6090307@spatial-analyst.net>
	<4B2548E1.1040706@uni-muenster.de> <4B261E84.5070805@gmail.com>
Message-ID: <200912141125.32453.ashton@msu.edu>

Hi Tom,

There isn't any Mean Squared Error from kriging, assuming you are using all 
the points in the model, because there are no residuals. Kriging 'honors' the 
data. You can use do cross-validation (defaults to leave one out), but this is 
pretty intensive and slow, at least in the R version (krige.cv).

Gtsat Kriging does return a variance estimate for every prediction point, the 
square root of which is often called the kriging standard error, but this is a 
measure of uncertainty at that point, rather than actual error.

Or perhaps I've completely misunderstood your question!

Ashton


On Monday 14 December 2009 06:16:20 Pete Larson wrote:
> Hello,
> 
> Is there any easy way to get the MSE from the gstat kriging fucntions?
> Or just the residuals at the measurement points?
> 
> Thanks,
> 
> Pete
> 
> Edzer J. Pebesma wrote:
> > Dear Tom,
> >
> > as your grids are spatial grids, you may want to look into the web
> > service standards of the OGC (www.opengeospatial.org) for them, WCS
> > (for reading) and WCS-T (for writing) in particular. We're
> > experimenting with this currently, using the recently open sourced
> > rasdaman software (www.rasdaman.org), which uses a data base in the
> > back end. I don't think OPeNDAP has special infrastructure for spatial
> > grids; CFNetCDF does, but by choosing this you may limit integration
> > with other software that does assume spatial data to be served over
> > OGC standards. CFNetCDF is one of the possible formats to be served
> > over WCS (and GeoTIFF etc) -- if I'm correctly informed.
> >
> > Bests,
> >
> > Stefano Casalegno wrote:
> >> Dear Tom,
> >> my best acknowledgment for the Ecogrid challenging initiative.
> >> I guess the main limitation will be "time" and this is related to
> >> the  size of grids.
> >> What is the extent of the grids ?
> >> What tool you plan to use for point 1. Overlay some point data and
> >> get the values of grids ?
> >>
> >> On a more theoretical basis,
> >> "distribution models should rely upon data that covers the whole
> >> extent of the distribution of the biota under examination"
> >>
> >> Please consider forest data from
> >> http://forest.jrc.ec.europa.eu/climate-change
> >> as supplementary predictors variables within an European
> >> biodiversity  and nature conservation application.
> >>
> >> Cheers
> >> Stefano
> >>
> >>
> >> ________________________________
> >>
> >> Stefano Casalegno, Ph.D.
> >>
> >> via Greppi 16, 21021 Angera - Italy
> >> email: stefano at casalegno.net
> >> web: http://www.casalegno.net/stefano
> >> ________________________________
> >>
> >> On Dec 13, 2009, at 6:29 PM, Tomislav Hengl wrote:
> >>> Dear R-sig-geo,
> >>>
> >>> As a part of our project (EcoGRID.nl) we have prepared some 60
> >>> thematic grids that we use as auxiliary predictors for species
> >>> distribution modeling. At this stage, we would like to put the
> >>> gridded maps (50/100 m base resolution) into some efficient
> >>> sharable geo-database.
> >>>
> >>> We will most probably put the data into the NetCDF format (http://
> >>> www.unidata.ucar.edu/software/netcdf/) because it can handle any-
> >>> dimensional array data, and because it has been in continuous
> >>> development and widespread use for many years. NetCDF grids can be
> >>> read relatively easy into R using the RNetCDF package (e.g. http://
> >>> spatial-analyst.net/DATA/readNCDF.zip). Another alternative is to
> >>> use PostGIS WKT Raster format (http://trac.osgeo.org/postgis/wiki/
> >>> WKTRaster), but this seems to be still rather experimental (?).
> >>>
> >>> Once we put the grids into NetCDF format. We plan to install
> >>> OPeNDAP (http://www.opendap.org) server on top to make the files
> >>> accessible through the web; then Geoserver (http://
> >>> www.geoserver.org) or UMN Mapserver (http://mapserver.org) to feed
> >>> a WMS from NetCDF files (raster data). Finally, we plan to add a
> >>> simple OpenLayers interface on top of that (Geoserver has it built
> >>> in) to allow direct browsing of the data and metadata (e.g. such as
> >>> this one: http://africamap.harvard.edu/)
> >>>
> >>> Just to be clear, we want to put the data on a server because we
> >>> would like to run a number of operations directly on the server
> >>> (via rgdal?):
> >>>
> >>> 1. Overlay some point data and get the values of grids (without a
> >>> need to download the grids locally);
> >>> 2. Subset/mask and resample gridded data of interest (for a given
> >>> bounding box and proj4 string; again without a need to download the
> >>> data locally);
> >>> 3. Upscale the grids from 100 m to 250, 500 m and 1 km resolution
> >>> (then download the upscaled grids).
> >>> 4. Write/upload new grids to the database (e.g. using WebDAV).
> >>> 5. Browse the grids (and metadata) via the OpenLayers.
> >>>
> >>> These are only our wishes of course. We do not know if all this is
> >>> really possible with the current software.
> >>>
> >>> Any examples or comments/suggestions/experiences are welcome
> >>> (before we start installing and testing the functionality).
> >>>
> >>> Thanx!
> >>>
> >>> Tomislav Hengl and Lourens Veen
> >>>
> >>> _______________________________________________
> >>> R-sig-Geo mailing list
> >>> R-sig-Geo at stat.math.ethz.ch
> >>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >>
> >>     [[alternative HTML version deleted]]
> >>
> >> _______________________________________________
> >> R-sig-Geo mailing list
> >> R-sig-Geo at stat.math.ethz.ch
> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at stat.math.ethz.ch
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Ashton Shortridge
Associate Professor			ashton at msu.edu
Dept of Geography			http://www.msu.edu/~ashton
235 Geography Building		ph (517) 432-3561
Michigan State University		fx (517) 432-1671


From sa.cizmeli at usherbrooke.ca  Mon Dec 14 17:40:37 2009
From: sa.cizmeli at usherbrooke.ca (Servet Ahmet Cizmeli)
Date: Mon, 14 Dec 2009 11:40:37 -0500
Subject: [R-sig-Geo] spplot : varying dots for multiple parameters
Message-ID: <2f7966b21adc6941118242f4cc880f0e@courriel.usherbrooke.ca>

Dear Roger, Edzer,

Thanks a lot for your kindly help. I just switched to R from Matlab
after 12 years of Matlab experience. It is actually an agonizing
experience as R is indeed very different than Matlab. There are so many
different ways to perform one given task that I am completely at loss
right now. But I am not giving up ;o)

I just run the command install.packages("sp") which reinstalled the
latest version : sp_0.9-51.tar.gz. The Warning messages described in my
first message are still there, though. The output of sessionInfo() is
given at the end of the message for your convenience.

Thanks a lot Roger for your code. It indeed improves my graphs a lot. 

I have some other questions if you don't mind :

Question 1 : Wouldn't it help if the bubble function supported the
convenient rm.na option? 

Question 2 : Each bubble() plot is widely spaced one from the other.
There is a lot of waste of space. How can I adjust the margins so that
the maps are tightly placed just like in lattice? The bHEX object
returned by bubble() is of class "lattice" and I don't seem to find any
information explaining how to perform such a fine-tuning. I would
appreciate any guidance that would point me to the place where all this
is explained. I don't presently seem to look at the right place. 

There is also the 3rd plot box which is of different size than the rest in
Roger's code... 
How to make all the boxes aligned and of exactly the same size?


On Mon, 2009-12-14 at 08:02 +0100, Edzer Pebesma wrote: 
> I don't think spplot allows this; you'd have to use lattice' function
> xyplot, to which spplot (for points) is a rather thin wrapper.

Yes, I would like to learn better "lattice" tools as they seem to be very
powerful. 
That is why I was experimenting with spplot :

> xyplot(Insitu_sp[!idx,])
Error in UseMethod("xyplot") : 
no applicable method for 'xyplot' applied to an object of class
"SpatialPointsDataFrame"

Question 3 :
How to tell xyplot to create maps of georeferenced "sp" objects? There is
no mention of 
this in the help page of xyplot?

I would like to plot a legend by using the following code :

dataset = c("SPM","CHL_A")
for (AA in 1:length(dataset)) {

idx = as.logical(is.na(Insitu[dataset[AA]]))

tmp <- bubble(Insitu_sp[!idx,], dataset[AA], xlim=xlim, ylim=ylim,
sp.layout = my.layout, key.space=list(x=0.1,y=.95,corner=c(0,1)))
plot(tmp, split=c(1,AA,1,2), more=TRUE)
}

but no legend is drawn and the following warning is being displayed twice :
Warning messages:
1: In names(legend)[1] <- space :
number of items to replace is not a multiple of replacement length

Question 4 : 
How can I place a legend at a custom place?


best
Servet


Output of sessionInfo()
************************************************************************
R version 2.10.0 (2009-10-26) 
i486-pc-linux-gnu 

locale:
[1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              
[3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    
[5] LC_MONETARY=C              LC_MESSAGES=en_US.UTF-8   
[7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 
[9] LC_ADDRESS=C               LC_TELEPHONE=C            
[11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
[1] rgdal_0.6-23 sp_0.9-51   

loaded via a namespace (and not attached):
[1] grid_2.10.0     lattice_0.17-26 tools_2.10.0


From pslarson2 at gmail.com  Mon Dec 14 18:08:58 2009
From: pslarson2 at gmail.com (Pete Larson)
Date: Mon, 14 Dec 2009 12:08:58 -0500
Subject: [R-sig-Geo] MSE
In-Reply-To: <200912141125.32453.ashton@msu.edu>
References: <4B252466.6090307@spatial-analyst.net>
	<4B2548E1.1040706@uni-muenster.de> <4B261E84.5070805@gmail.com>
	<200912141125.32453.ashton@msu.edu>
Message-ID: <4B26712A.2090401@gmail.com>

Hello,

Thank you for your reply. I would like to do model comparison, but the 
cv function is just too slow for now.

Any other ideas?

Thanks,

Pete


Ashton Shortridge wrote:
> Hi Tom,
>
> There isn't any Mean Squared Error from kriging, assuming you are using all 
> the points in the model, because there are no residuals. Kriging 'honors' the 
> data. You can use do cross-validation (defaults to leave one out), but this is 
> pretty intensive and slow, at least in the R version (krige.cv).
>
> Gtsat Kriging does return a variance estimate for every prediction point, the 
> square root of which is often called the kriging standard error, but this is a 
> measure of uncertainty at that point, rather than actual error.
>
> Or perhaps I've completely misunderstood your question!
>
> Ashton
>
>
> On Monday 14 December 2009 06:16:20 Pete Larson wrote:
>   
>> Hello,
>>
>> Is there any easy way to get the MSE from the gstat kriging fucntions?
>> Or just the residuals at the measurement points?
>>
>> Thanks,
>>
>> Pete
>>
>> Edzer J. Pebesma wrote:
>>     
>>> Dear Tom,
>>>
>>> as your grids are spatial grids, you may want to look into the web
>>> service standards of the OGC (www.opengeospatial.org) for them, WCS
>>> (for reading) and WCS-T (for writing) in particular. We're
>>> experimenting with this currently, using the recently open sourced
>>> rasdaman software (www.rasdaman.org), which uses a data base in the
>>> back end. I don't think OPeNDAP has special infrastructure for spatial
>>> grids; CFNetCDF does, but by choosing this you may limit integration
>>> with other software that does assume spatial data to be served over
>>> OGC standards. CFNetCDF is one of the possible formats to be served
>>> over WCS (and GeoTIFF etc) -- if I'm correctly informed.
>>>
>>> Bests,
>>>
>>> Stefano Casalegno wrote:
>>>       
>>>> Dear Tom,
>>>> my best acknowledgment for the Ecogrid challenging initiative.
>>>> I guess the main limitation will be "time" and this is related to
>>>> the  size of grids.
>>>> What is the extent of the grids ?
>>>> What tool you plan to use for point 1. Overlay some point data and
>>>> get the values of grids ?
>>>>
>>>> On a more theoretical basis,
>>>> "distribution models should rely upon data that covers the whole
>>>> extent of the distribution of the biota under examination"
>>>>
>>>> Please consider forest data from
>>>> http://forest.jrc.ec.europa.eu/climate-change
>>>> as supplementary predictors variables within an European
>>>> biodiversity  and nature conservation application.
>>>>
>>>> Cheers
>>>> Stefano
>>>>
>>>>
>>>> ________________________________
>>>>
>>>> Stefano Casalegno, Ph.D.
>>>>
>>>> via Greppi 16, 21021 Angera - Italy
>>>> email: stefano at casalegno.net
>>>> web: http://www.casalegno.net/stefano
>>>> ________________________________
>>>>
>>>> On Dec 13, 2009, at 6:29 PM, Tomislav Hengl wrote:
>>>>         
>>>>> Dear R-sig-geo,
>>>>>
>>>>> As a part of our project (EcoGRID.nl) we have prepared some 60
>>>>> thematic grids that we use as auxiliary predictors for species
>>>>> distribution modeling. At this stage, we would like to put the
>>>>> gridded maps (50/100 m base resolution) into some efficient
>>>>> sharable geo-database.
>>>>>
>>>>> We will most probably put the data into the NetCDF format (http://
>>>>> www.unidata.ucar.edu/software/netcdf/) because it can handle any-
>>>>> dimensional array data, and because it has been in continuous
>>>>> development and widespread use for many years. NetCDF grids can be
>>>>> read relatively easy into R using the RNetCDF package (e.g. http://
>>>>> spatial-analyst.net/DATA/readNCDF.zip). Another alternative is to
>>>>> use PostGIS WKT Raster format (http://trac.osgeo.org/postgis/wiki/
>>>>> WKTRaster), but this seems to be still rather experimental (?).
>>>>>
>>>>> Once we put the grids into NetCDF format. We plan to install
>>>>> OPeNDAP (http://www.opendap.org) server on top to make the files
>>>>> accessible through the web; then Geoserver (http://
>>>>> www.geoserver.org) or UMN Mapserver (http://mapserver.org) to feed
>>>>> a WMS from NetCDF files (raster data). Finally, we plan to add a
>>>>> simple OpenLayers interface on top of that (Geoserver has it built
>>>>> in) to allow direct browsing of the data and metadata (e.g. such as
>>>>> this one: http://africamap.harvard.edu/)
>>>>>
>>>>> Just to be clear, we want to put the data on a server because we
>>>>> would like to run a number of operations directly on the server
>>>>> (via rgdal?):
>>>>>
>>>>> 1. Overlay some point data and get the values of grids (without a
>>>>> need to download the grids locally);
>>>>> 2. Subset/mask and resample gridded data of interest (for a given
>>>>> bounding box and proj4 string; again without a need to download the
>>>>> data locally);
>>>>> 3. Upscale the grids from 100 m to 250, 500 m and 1 km resolution
>>>>> (then download the upscaled grids).
>>>>> 4. Write/upload new grids to the database (e.g. using WebDAV).
>>>>> 5. Browse the grids (and metadata) via the OpenLayers.
>>>>>
>>>>> These are only our wishes of course. We do not know if all this is
>>>>> really possible with the current software.
>>>>>
>>>>> Any examples or comments/suggestions/experiences are welcome
>>>>> (before we start installing and testing the functionality).
>>>>>
>>>>> Thanx!
>>>>>
>>>>> Tomislav Hengl and Lourens Veen
>>>>>
>>>>> _______________________________________________
>>>>> R-sig-Geo mailing list
>>>>> R-sig-Geo at stat.math.ethz.ch
>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>           
>>>>     [[alternative HTML version deleted]]
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at stat.math.ethz.ch
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>         
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>       
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>     
>
>


From Roger.Bivand at nhh.no  Mon Dec 14 18:18:39 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 14 Dec 2009 18:18:39 +0100 (CET)
Subject: [R-sig-Geo] spplot : varying dots for multiple parameters
In-Reply-To: <2f7966b21adc6941118242f4cc880f0e@courriel.usherbrooke.ca>
References: <2f7966b21adc6941118242f4cc880f0e@courriel.usherbrooke.ca>
Message-ID: <alpine.LRH.2.00.0912141751370.12225@reclus.nhh.no>

On Mon, 14 Dec 2009, Servet Ahmet Cizmeli wrote:

> Dear Roger, Edzer,
>
> Thanks a lot for your kindly help. I just switched to R from Matlab
> after 12 years of Matlab experience. It is actually an agonizing
> experience as R is indeed very different than Matlab. There are so many
> different ways to perform one given task that I am completely at loss
> right now. But I am not giving up ;o)

Dear Servet,

Good, I expect that you will find some more similarities in time. Note 
that many more R functions return structured objects (usually lists with a 
class attribute). Looking at how lm() works:

args(lm)

will tell you a lot about lattice graphics, often a formula argument, a 
data argument, and maybe a grouping argument. If you have a chance to 
visit the R graphics gallery:

http://addictedtor.free.fr/graphiques

or, even better, get hold of Paul Murrell's R Graphics book and/or 
Deepayan Sarkar's Lattice graphics book (see the books links on the R web 
page), you may find it easier to see what corresponds to what. Very often 
the defaults (like empty space) are there for a reason - recall that the 
very similar Trellis graphics were written by Bill Cleveland at Bell Labs 
with John Chambers, the author of the S language and an important core 
contributor to R.

>
> I just run the command install.packages("sp") which reinstalled the
> latest version : sp_0.9-51.tar.gz. The Warning messages described in my
> first message are still there, though. The output of sessionInfo() is
> given at the end of the message for your convenience.
>
> Thanks a lot Roger for your code. It indeed improves my graphs a lot.
>
> I have some other questions if you don't mind :
>
> Question 1 : Wouldn't it help if the bubble function supported the
> convenient rm.na option?

Perhaps, but this might lead to unwanted subsetting too, so it isn't 
obvious.

>
> Question 2 : Each bubble() plot is widely spaced one from the other.
> There is a lot of waste of space. How can I adjust the margins so that
> the maps are tightly placed just like in lattice? The bHEX object
> returned by bubble() is of class "lattice" and I don't seem to find any
> information explaining how to perform such a fine-tuning. I would
> appreciate any guidance that would point me to the place where all this
> is explained. I don't presently seem to look at the right place.
>
> There is also the 3rd plot box which is of different size than the rest in
> Roger's code...
> How to make all the boxes aligned and of exactly the same size?
>

That is the subsetting problem. You overcome it by setting xlim and ylim 
arguments. The white space comes from dividing the default device up into 
four rectangles, the relative shapes of which most likely do not match the 
shapes of the data bounding boxes. Try changing the shape of the device 
(width and height arguments) if you need more control. Note that 
analytical and presentation graphics should be treated differently, as you 
can "eyeball" many displays without needing to polish to your presentation 
standards. If need be, that can be done afterwards.

>
> On Mon, 2009-12-14 at 08:02 +0100, Edzer Pebesma wrote:
>> I don't think spplot allows this; you'd have to use lattice' function
>> xyplot, to which spplot (for points) is a rather thin wrapper.
>
> Yes, I would like to learn better "lattice" tools as they seem to be very
> powerful.
> That is why I was experimenting with spplot :
>
>> xyplot(Insitu_sp[!idx,])
> Error in UseMethod("xyplot") :
> no applicable method for 'xyplot' applied to an object of class
> "SpatialPointsDataFrame"

See args(xyplot) - from the help page, you see that x is most often a 
formula, say y ~ x.

>
> Question 3 :
> How to tell xyplot to create maps of georeferenced "sp" objects? There is
> no mention of
> this in the help page of xyplot?

No, because it is a general method. Use spplot().

>
> I would like to plot a legend by using the following code :
>

Until you have control of the graphic itself, do not worry about 
decorations, they are not important.

Hope this helps,

Roger

> dataset = c("SPM","CHL_A")
> for (AA in 1:length(dataset)) {
>
> idx = as.logical(is.na(Insitu[dataset[AA]]))
>
> tmp <- bubble(Insitu_sp[!idx,], dataset[AA], xlim=xlim, ylim=ylim,
> sp.layout = my.layout, key.space=list(x=0.1,y=.95,corner=c(0,1)))
> plot(tmp, split=c(1,AA,1,2), more=TRUE)
> }
>
> but no legend is drawn and the following warning is being displayed twice :
> Warning messages:
> 1: In names(legend)[1] <- space :
> number of items to replace is not a multiple of replacement length
>
> Question 4 :
> How can I place a legend at a custom place?
>
>
> best
> Servet
>
>
> Output of sessionInfo()
> ************************************************************************
> R version 2.10.0 (2009-10-26)
> i486-pc-linux-gnu
>
> locale:
> [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
> [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
> [5] LC_MONETARY=C              LC_MESSAGES=en_US.UTF-8
> [7] LC_PAPER=en_US.UTF-8       LC_NAME=C
> [9] LC_ADDRESS=C               LC_TELEPHONE=C
> [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> other attached packages:
> [1] rgdal_0.6-23 sp_0.9-51
>
> loaded via a namespace (and not attached):
> [1] grid_2.10.0     lattice_0.17-26 tools_2.10.0
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From sa.cizmeli at usherbrooke.ca  Mon Dec 14 18:21:19 2009
From: sa.cizmeli at usherbrooke.ca (Servet Ahmet Cizmeli)
Date: Mon, 14 Dec 2009 12:21:19 -0500
Subject: [R-sig-Geo]
 =?utf-8?q?Making_web-repository_of_gridded_maps=3A_Ne?=
 =?utf-8?q?tCDF_or_WKT_Raster=3F?=
In-Reply-To: <4B252466.6090307@spatial-analyst.net>
References: <4B252466.6090307@spatial-analyst.net>
Message-ID: <f1426c40c187c08fe7301139ab351873@courriel.usherbrooke.ca>

Hello,

I had done a similar design in my head a while ago too. Looking at your
message, I don't quite get how you would place Geoserver (or Mapserver)
operating in parallel with OpenDAP. Is there a data format that is
supported by both? To my knowledge, no... If I am outdated, I would
definitely be interested in knowing more about it.

Opendap nicely supports n-dimensional arrays through netcdf. To my
knowledge, however, geoserver does not. So you may have to stick with
OpenDAP, but regretfully loose support for interoperability through OGC
standarts.

What is your target user profile? Scientists who will
visualize/get/process/update the data? Or simple GIS users who would only
visualize/query? I guess OpenDAP is more suitable for the former while
GEOSERVER, the latter type of users.

Assuming that my knowledge on the subject is up-to-date, possible solutions
would be to write an WMS/WFS output driver to OpenDAP and offer users a
full set of possible choices 

The server-side processing could always be performed by R who would somehow
accept input from web in an URL formed by the JavaScript OpenLayers client.
I am sure this is technically possible but I am not proficient enough in R
to be able to say how ;o(

I have always dreamt of an OpenDAP client for R (similar to the Matlab
client). If we had one, scientists on the client-side could ALSO get the
data from the R command-line and process it at their will. 

This is a very interesting subject. please keep us updated. 
Servet


From miguel.gil.biraud at ieee.org  Mon Dec 14 18:35:19 2009
From: miguel.gil.biraud at ieee.org (Miguel Eduardo Gil Biraud)
Date: Mon, 14 Dec 2009 18:35:19 +0100
Subject: [R-sig-Geo] Making web-repository of gridded maps: NetCDF or
	WKT Raster?
In-Reply-To: <f1426c40c187c08fe7301139ab351873@courriel.usherbrooke.ca>
References: <4B252466.6090307@spatial-analyst.net>
	<f1426c40c187c08fe7301139ab351873@courriel.usherbrooke.ca>
Message-ID: <bba7081f0912140935v5fbaf2bdufeebf9b81eb7e333@mail.gmail.com>

Hi,

not that I understand everything that you want to do, but I would
think that to define how the users access the processing capabilities
in the server you can use WPS from the OGC.

http://www.opengeospatial.org/standards/wps

My 2 cents,
Miguel

On Mon, Dec 14, 2009 at 18:21, Servet Ahmet Cizmeli
<sa.cizmeli at usherbrooke.ca> wrote:
> Hello,
>
> I had done a similar design in my head a while ago too. Looking at your
> message, I don't quite get how you would place Geoserver (or Mapserver)
> operating in parallel with OpenDAP. Is there a data format that is
> supported by both? To my knowledge, no... If I am outdated, I would
> definitely be interested in knowing more about it.
>
> Opendap nicely supports n-dimensional arrays through netcdf. To my
> knowledge, however, geoserver does not. So you may have to stick with
> OpenDAP, but regretfully loose support for interoperability through OGC
> standarts.
>
> What is your target user profile? Scientists who will
> visualize/get/process/update the data? Or simple GIS users who would only
> visualize/query? I guess OpenDAP is more suitable for the former while
> GEOSERVER, the latter type of users.
>
> Assuming that my knowledge on the subject is up-to-date, possible solutions
> would be to write an WMS/WFS output driver to OpenDAP and offer users a
> full set of possible choices
>
> The server-side processing could always be performed by R who would somehow
> accept input from web in an URL formed by the JavaScript OpenLayers client.
> I am sure this is technically possible but I am not proficient enough in R
> to be able to say how ;o(
>
> I have always dreamt of an OpenDAP client for R (similar to the Matlab
> client). If we had one, scientists on the client-side could ALSO get the
> data from the R command-line and process it at their will.
>
> This is a very interesting subject. please keep us updated.
> Servet
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



-- 
http://franchu.net


From ashton at msu.edu  Mon Dec 14 20:03:19 2009
From: ashton at msu.edu (Ashton Shortridge)
Date: Mon, 14 Dec 2009 14:03:19 -0500
Subject: [R-sig-Geo] MSE
In-Reply-To: <4B26712A.2090401@gmail.com>
References: <4B252466.6090307@spatial-analyst.net>
	<200912141125.32453.ashton@msu.edu> <4B26712A.2090401@gmail.com>
Message-ID: <200912141403.19134.ashton@msu.edu>

Hi Pete,

well, if you want to compare different model results at predicted locations 
(e.g. IDW vs krging, or ordinary kriging vs. kriging with a trend, or local vs 
global kriging, etc etc, you could use some kind of mean squared difference. 
Maybe something like this:

kr.thing1 <- krige(stuff)
kr.thing2 <- krige(stuff)

RMS.t1t2 <- sqrt(mean((kr.thing1$var1.pred - kr.thing2$var1.pred)^2))


would do what you want?

Ashton


On Monday 14 December 2009 12:08:58 Pete Larson wrote:
> Hello,
> 
> Thank you for your reply. I would like to do model comparison, but the
> cv function is just too slow for now.
> 
> Any other ideas?
> 
> Thanks,
> 
> Pete
> 
> Ashton Shortridge wrote:
> > Hi Tom,
> >
> > There isn't any Mean Squared Error from kriging, assuming you are using
> > all the points in the model, because there are no residuals. Kriging
> > 'honors' the data. You can use do cross-validation (defaults to leave one
> > out), but this is pretty intensive and slow, at least in the R version
> > (krige.cv).
> >
> > Gtsat Kriging does return a variance estimate for every prediction point,
> > the square root of which is often called the kriging standard error, but
> > this is a measure of uncertainty at that point, rather than actual error.
> >
> > Or perhaps I've completely misunderstood your question!
> >
> > Ashton
> >
> > On Monday 14 December 2009 06:16:20 Pete Larson wrote:
> >> Hello,
> >>
> >> Is there any easy way to get the MSE from the gstat kriging fucntions?
> >> Or just the residuals at the measurement points?
> >>
> >> Thanks,
> >>
> >> Pete
> >>
> >> Edzer J. Pebesma wrote:
> >>> Dear Tom,
> >>>
> >>> as your grids are spatial grids, you may want to look into the web
> >>> service standards of the OGC (www.opengeospatial.org) for them, WCS
> >>> (for reading) and WCS-T (for writing) in particular. We're
> >>> experimenting with this currently, using the recently open sourced
> >>> rasdaman software (www.rasdaman.org), which uses a data base in the
> >>> back end. I don't think OPeNDAP has special infrastructure for spatial
> >>> grids; CFNetCDF does, but by choosing this you may limit integration
> >>> with other software that does assume spatial data to be served over
> >>> OGC standards. CFNetCDF is one of the possible formats to be served
> >>> over WCS (and GeoTIFF etc) -- if I'm correctly informed.
> >>>
> >>> Bests,
> >>>
> >>> Stefano Casalegno wrote:
> >>>> Dear Tom,
> >>>> my best acknowledgment for the Ecogrid challenging initiative.
> >>>> I guess the main limitation will be "time" and this is related to
> >>>> the  size of grids.
> >>>> What is the extent of the grids ?
> >>>> What tool you plan to use for point 1. Overlay some point data and
> >>>> get the values of grids ?
> >>>>
> >>>> On a more theoretical basis,
> >>>> "distribution models should rely upon data that covers the whole
> >>>> extent of the distribution of the biota under examination"
> >>>>
> >>>> Please consider forest data from
> >>>> http://forest.jrc.ec.europa.eu/climate-change
> >>>> as supplementary predictors variables within an European
> >>>> biodiversity  and nature conservation application.
> >>>>
> >>>> Cheers
> >>>> Stefano
> >>>>
> >>>>
> >>>> ________________________________
> >>>>
> >>>> Stefano Casalegno, Ph.D.
> >>>>
> >>>> via Greppi 16, 21021 Angera - Italy
> >>>> email: stefano at casalegno.net
> >>>> web: http://www.casalegno.net/stefano
> >>>> ________________________________
> >>>>
> >>>> On Dec 13, 2009, at 6:29 PM, Tomislav Hengl wrote:
> >>>>> Dear R-sig-geo,
> >>>>>
> >>>>> As a part of our project (EcoGRID.nl) we have prepared some 60
> >>>>> thematic grids that we use as auxiliary predictors for species
> >>>>> distribution modeling. At this stage, we would like to put the
> >>>>> gridded maps (50/100 m base resolution) into some efficient
> >>>>> sharable geo-database.
> >>>>>
> >>>>> We will most probably put the data into the NetCDF format (http://
> >>>>> www.unidata.ucar.edu/software/netcdf/) because it can handle any-
> >>>>> dimensional array data, and because it has been in continuous
> >>>>> development and widespread use for many years. NetCDF grids can be
> >>>>> read relatively easy into R using the RNetCDF package (e.g. http://
> >>>>> spatial-analyst.net/DATA/readNCDF.zip). Another alternative is to
> >>>>> use PostGIS WKT Raster format (http://trac.osgeo.org/postgis/wiki/
> >>>>> WKTRaster), but this seems to be still rather experimental (?).
> >>>>>
> >>>>> Once we put the grids into NetCDF format. We plan to install
> >>>>> OPeNDAP (http://www.opendap.org) server on top to make the files
> >>>>> accessible through the web; then Geoserver (http://
> >>>>> www.geoserver.org) or UMN Mapserver (http://mapserver.org) to feed
> >>>>> a WMS from NetCDF files (raster data). Finally, we plan to add a
> >>>>> simple OpenLayers interface on top of that (Geoserver has it built
> >>>>> in) to allow direct browsing of the data and metadata (e.g. such as
> >>>>> this one: http://africamap.harvard.edu/)
> >>>>>
> >>>>> Just to be clear, we want to put the data on a server because we
> >>>>> would like to run a number of operations directly on the server
> >>>>> (via rgdal?):
> >>>>>
> >>>>> 1. Overlay some point data and get the values of grids (without a
> >>>>> need to download the grids locally);
> >>>>> 2. Subset/mask and resample gridded data of interest (for a given
> >>>>> bounding box and proj4 string; again without a need to download the
> >>>>> data locally);
> >>>>> 3. Upscale the grids from 100 m to 250, 500 m and 1 km resolution
> >>>>> (then download the upscaled grids).
> >>>>> 4. Write/upload new grids to the database (e.g. using WebDAV).
> >>>>> 5. Browse the grids (and metadata) via the OpenLayers.
> >>>>>
> >>>>> These are only our wishes of course. We do not know if all this is
> >>>>> really possible with the current software.
> >>>>>
> >>>>> Any examples or comments/suggestions/experiences are welcome
> >>>>> (before we start installing and testing the functionality).
> >>>>>
> >>>>> Thanx!
> >>>>>
> >>>>> Tomislav Hengl and Lourens Veen
> >>>>>
> >>>>> _______________________________________________
> >>>>> R-sig-Geo mailing list
> >>>>> R-sig-Geo at stat.math.ethz.ch
> >>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >>>>
> >>>>     [[alternative HTML version deleted]]
> >>>>
> >>>> _______________________________________________
> >>>> R-sig-Geo mailing list
> >>>> R-sig-Geo at stat.math.ethz.ch
> >>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >>>
> >>> _______________________________________________
> >>> R-sig-Geo mailing list
> >>> R-sig-Geo at stat.math.ethz.ch
> >>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >>
> >> _______________________________________________
> >> R-sig-Geo mailing list
> >> R-sig-Geo at stat.math.ethz.ch
> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Ashton Shortridge
Associate Professor			ashton at msu.edu
Dept of Geography			http://www.msu.edu/~ashton
235 Geography Building		ph (517) 432-3561
Michigan State University		fx (517) 432-1671


From coulmont at ens.fr  Mon Dec 14 20:41:02 2009
From: coulmont at ens.fr (Baptiste Coulmont)
Date: Mon, 14 Dec 2009 20:41:02 +0100
Subject: [R-sig-Geo] shp file with 2 types of bodies (water and forest)
Message-ID: <13b8559c0912141141j38cba79fu91c7d35956706e57@mail.gmail.com>

I would like to map the forests in green and the water bodies in blue :

summary(nature)

Object of class SpatialPolygonsDataFrame
Coordinates:
         min       max
r1  2.560776  6.403847
r2 49.493613 51.505419
Is projected: FALSE
proj4string : [+proj=longlat]
Data attributes:
                           NAME           TYPE
 Dijle                       :   43   forest:6830
 Schelde                     :   30   water :6564
 Ringselven                  :   17
 Albertkanaal                :   15
 Westelijke Rijkswaterleiding:   14
 (Other)                     :  990
 NA's                        :12285

How do I ask R to map, for example, only the forests ?

-- 
Baptiste   Coulmont
http://coulmont.com


From coulmont at gmail.com  Mon Dec 14 20:43:30 2009
From: coulmont at gmail.com (Baptiste Coulmont)
Date: Mon, 14 Dec 2009 20:43:30 +0100
Subject: [R-sig-Geo] shp file with 2 types of bodies (water and forest)
In-Reply-To: <13b8559c0912141141j38cba79fu91c7d35956706e57@mail.gmail.com>
References: <13b8559c0912141141j38cba79fu91c7d35956706e57@mail.gmail.com>
Message-ID: <13b8559c0912141143u2cc13fbdm419606186fac1d17@mail.gmail.com>

I would like to map the forests in green and the water bodies in blue :

summary(nature)

Object of class SpatialPolygonsDataFrame
Coordinates:
        min       max
r1  2.560776  6.403847
r2 49.493613 51.505419
Is projected: FALSE
proj4string : [+proj=longlat]
Data attributes:
                          NAME           TYPE
 Dijle                       :   43   forest:6830
 Schelde                     :   30   water :6564
 Ringselven                  :   17
 Albertkanaal                :   15
 Westelijke Rijkswaterleiding:   14
 (Other)                     :  990
 NA's                        :12285

How do I ask R to map, for example, only the forests ?


From ssefick at gmail.com  Mon Dec 14 20:43:43 2009
From: ssefick at gmail.com (stephen sefick)
Date: Mon, 14 Dec 2009 13:43:43 -0600
Subject: [R-sig-Geo] shp file with 2 types of bodies (water and forest)
In-Reply-To: <13b8559c0912141141j38cba79fu91c7d35956706e57@mail.gmail.com>
References: <13b8559c0912141141j38cba79fu91c7d35956706e57@mail.gmail.com>
Message-ID: <c502a9e10912141143y324764cbm6bdb437f7eaefea4@mail.gmail.com>

maybe try

?subset

On Mon, Dec 14, 2009 at 1:41 PM, Baptiste Coulmont <coulmont at ens.fr> wrote:
> I would like to map the forests in green and the water bodies in blue :
>
> summary(nature)
>
> Object of class SpatialPolygonsDataFrame
> Coordinates:
> ? ? ? ? min ? ? ? max
> r1 ?2.560776 ?6.403847
> r2 49.493613 51.505419
> Is projected: FALSE
> proj4string : [+proj=longlat]
> Data attributes:
> ? ? ? ? ? ? ? ? ? ? ? ? ? NAME ? ? ? ? ? TYPE
> ?Dijle ? ? ? ? ? ? ? ? ? ? ? : ? 43 ? forest:6830
> ?Schelde ? ? ? ? ? ? ? ? ? ? : ? 30 ? water :6564
> ?Ringselven ? ? ? ? ? ? ? ? ?: ? 17
> ?Albertkanaal ? ? ? ? ? ? ? ?: ? 15
> ?Westelijke Rijkswaterleiding: ? 14
> ?(Other) ? ? ? ? ? ? ? ? ? ? : ?990
> ?NA's ? ? ? ? ? ? ? ? ? ? ? ?:12285
>
> How do I ask R to map, for example, only the forests ?
>
> --
> Baptiste ? Coulmont
> http://coulmont.com
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



-- 
Stephen Sefick

Let's not spend our time and resources thinking about things that are
so little or so large that all they really do for us is puff us up and
make us feel like gods.  We are mammals, and have not exhausted the
annoying little problems of being mammals.

								-K. Mullis


From edzer.pebesma at uni-muenster.de  Mon Dec 14 21:47:43 2009
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Mon, 14 Dec 2009 21:47:43 +0100
Subject: [R-sig-Geo] shp file with 2 types of bodies (water and forest)
In-Reply-To: <c502a9e10912141143y324764cbm6bdb437f7eaefea4@mail.gmail.com>
References: <13b8559c0912141141j38cba79fu91c7d35956706e57@mail.gmail.com>
	<c502a9e10912141143y324764cbm6bdb437f7eaefea4@mail.gmail.com>
Message-ID: <4B26A46F.1040604@uni-muenster.de>

... or subset by [, e.g.

plot(nature[nature$TYPE == "forest", ])

stephen sefick wrote:
> maybe try
>
> ?subset
>
> On Mon, Dec 14, 2009 at 1:41 PM, Baptiste Coulmont <coulmont at ens.fr> wrote:
>   
>> I would like to map the forests in green and the water bodies in blue :
>>
>> summary(nature)
>>
>> Object of class SpatialPolygonsDataFrame
>> Coordinates:
>>         min       max
>> r1  2.560776  6.403847
>> r2 49.493613 51.505419
>> Is projected: FALSE
>> proj4string : [+proj=longlat]
>> Data attributes:
>>                           NAME           TYPE
>>  Dijle                       :   43   forest:6830
>>  Schelde                     :   30   water :6564
>>  Ringselven                  :   17
>>  Albertkanaal                :   15
>>  Westelijke Rijkswaterleiding:   14
>>  (Other)                     :  990
>>  NA's                        :12285
>>
>> How do I ask R to map, for example, only the forests ?
>>
>> --
>> Baptiste   Coulmont
>> http://coulmont.com
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>     
>
>
>
>   

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster 
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251 
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de 
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From joeliol at gmail.com  Mon Dec 14 22:04:14 2009
From: joeliol at gmail.com (Joel Thomas)
Date: Tue, 15 Dec 2009 10:04:14 +1300
Subject: [R-sig-Geo] Using cokriging to predict the probability of a binary
	variable
Message-ID: <a52d914b0912141304n4ed8a210pc495a22fdf8727f4@mail.gmail.com>

Hi,
I am trying to create a map showing the probability of the presence of
a binary variable. All of the data points I have are known locations
of what I'm trying to find with several topographic variables as
predictors. I could create a set of random points and populate their
attributes with the same predictors, but the problem is I can't assign
a probability of there being what I'm trying to find - its either Yes
or No. Is it possible to interpolate between points using cokriging on
some kind of false scale when the points I'm trying to interpolate
between all have the same target value, ie. Yes or 100% probability?

Thanks,
Joel


From elaine.kuo.tw at gmail.com  Tue Dec 15 06:09:49 2009
From: elaine.kuo.tw at gmail.com (elaine kuo)
Date: Tue, 15 Dec 2009 13:09:49 +0800
Subject: [R-sig-Geo] how to create locs and make a dataframce cover it and
	kasc
Message-ID: <c895d7a50912142109m46c3a118r1e3ed0cf15641e2d@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20091215/1993c652/attachment.pl>

From nitmithv at yahoo.com.cn  Tue Dec 15 07:43:06 2009
From: nitmithv at yahoo.com.cn (Kai Zhang)
Date: Tue, 15 Dec 2009 01:43:06 -0500
Subject: [R-sig-Geo] How to automatically fit variogram in gstat
References: <200912110100009590454@yahoo.com.cn>, <4B220F72.2080409@geo.uu.nl>,
	<200912121537411560606@yahoo.com.cn>, <4B260E2E.10605@geo.uu.nl>
Message-ID: <200912150143057183174@yahoo.com.cn>

Hi Paul,

Thanks for your reply. I have one more question on the fit.variogram function in gstat. Let's take an example from the gstat manual

fit.variogram(vgm1, vgm(1,"Sph",300,1))

My understanding is that the parameters like partial sill, range and nugget specified in vgm are just starting values and the key message is model type such as exponential model or spherical model. The fit.variogram function determines the optical parameters automatically. I am not sure if my understanding is right because I could not find the detailed description in the manual.

I appreciate your response and best regards,
Kai 	

____________________________________________________
Kai Zhang
PhD Candidate, Environmental Health Sciences
School of Public Health                        
University of Michigan                         
109 S. Observatory                       
Ann Arbor, MI 48109-2029         
____________________________________________________

======= 2009-12-14 05:07:05 You wrote =======

>Hi Kai,
>
>If it improves depends on how you define improvement. If you want to use
>IDW automatic you need to fit the distance power in some way. When you
>fit the variogram automatically, you get this distance dependency of the
>weights from the variogram. In regard to co-kriging, if there is a
>strong correlation between the various pollutant measures (co-located)
>co-kriging can be a good option.
>
>cheers,
>Paul
>
>ps I included R-sig-geo again as a cc so the conversation is also on the
>mailing list. It is best to use "Reply to all" when you reply to these
>kind of e-mails.
>
>ZK wrote:
>> Hi Paul,
>>
>> Many thanks for your suggestion. You are right and I would expect to Kriging improves a little compared to inverse distance method. Btw, do you think co-kriging is useful for 8 monitors?
>>
>> Thanks,
>> Kai
>> 	
>>
>> ____________________________________________________
>> Kai Zhang
>> PhD Candidate, Environmental Health Sciences
>> School of Public Health                        
>> University of Michigan                         
>> 109 S. Observatory                       
>> Ann Arbor, MI 48109-2029         
>> ____________________________________________________
>>
>> ======= 2009-12-11 04:23:11 You wrote =======
>>
>>   
>>> Hi,
>>>
>>> One option is to use the automap package, this provides the function
>>> autofitVariogram and autoKrige. Automap is available on CRAN. An
>>> alternative is to use the fit.variogram function from gstat (which
>>> automap also does).
>>>
>>> An additional comment, 8 stations is not a lot to base variogram models
>>> on. Think carefully how you want to solve this problem. Maybe you can
>>> make some kind of aggregated sample variogram that incorporates not only
>>> the data from one day, but of one month. In this way you can increase
>>> the amount of data you use to create the variogram. But still, just 8
>>> stations looks to be quite a challenge.
>>>
>>> good luck!
>>> Paul
>>>
>>> ZK wrote:
>>>     
>>>> Dear all,
>>>> I have daily pollutant measurements (CO, NO2, PM2.5 and Ozone) at 8 monitors from 2005 to 2008.  My purpose is to estimate daily exposures for studying subjects using Kriging for three years.  A common procedure is to plot experimental variogram and then to choose a theoretical model (e.g., exponential model or Gaussian model) with some adjustment on parameters.  However, this manual way is not appropriate for my application. I am wondering how I can fit variogram in gstat automatically. 
>>>>
>>>> I appreciate your response and best regards,
>>>> Kai
>>>>
>>>> 	
>>>>
>>>>
>>>>
>>>>
>>>> __________________________________________________
>>>> ?????????????????????????????
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at stat.math.ethz.ch
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>   
>>>>       
>>> -- 
>>> Drs. Paul Hiemstra
>>> Department of Physical Geography
>>> Faculty of Geosciences
>>> University of Utrecht
>>> Heidelberglaan 2
>>> P.O. Box 80.115
>>> 3508 TC Utrecht
>>> Phone:  +3130 274 3113 Mon-Tue
>>> Phone:  +3130 253 5773 Wed-Fri
>>> http://intamap.geo.uu.nl/~paul
>>>
>>>     
>>
>>
>> ??i??'?????h??&
>
>
>-- 
>Drs. Paul Hiemstra
>Department of Physical Geography
>Faculty of Geosciences
>University of Utrecht
>Heidelberglaan 2
>P.O. Box 80.115
>3508 TC Utrecht
>Phone:  +3130 274 3113 Mon-Tue
>Phone:  +3130 253 5773 Wed-Fri
>http://intamap.geo.uu.nl/~paul
>



From nitmithv at yahoo.com.cn  Tue Dec 15 07:59:30 2009
From: nitmithv at yahoo.com.cn (=?utf-8?B?S2FpIFpoYW5n?=)
Date: Tue, 15 Dec 2009 01:59:30 -0500
Subject: [R-sig-Geo] =?utf-8?q?Co-Kriging_with_huge_data?=
References: <200912140146405621465@yahoo.com.cn>,
	<4B25EDF2.3020000@uni-muenster.de>
Message-ID: <200912150159293121103@yahoo.com.cn>

Hi Edzer,

Thanks for your reply. I am not sure if I get your point -- "Maybe a cross validation with your 17 temperature monitors can give you
some idea on this". I am wondering if you mean sensitivity analysis of neighbor size using cross-validation. For example, based on 17 monitors, I could try the radius with 1 km, 2 km and so on using cross-validation and choose a neighbor size with smallest RMSE calculated from cross validation.

I appreciate your response and best regards,
Kai

____________________________________________________
Kai Zhang
PhD Candidate, Environmental Health Sciences
School of Public Health                        
University of Michigan                         
109 S. Observatory                       
Ann Arbor, MI 48109-2029         
____________________________________________________

======= 2009-12-14 02:49:22 You wrote =======

>
>
>Kai Zhang wrote:
>> Dear all,
>>
>> I have temperature measurements at 17 monitors.  I have a secondary variable across the study area, which includes 230,000 points. I tried to conduct Co-Kring with this huge dataset and it appeared to be computationally intensive. Is there any way to run it except for running the program in a cluster?
>>
>> I appreciate your response and best regards,
>> Kai
>>   
>One alternative would be to use co-kriging and to limit the search
>neighbourhood for the secondary variable. The question is how much.
>Maybe a cross validation with your 17 temperature monitors can give you
>some idea on this. If someone knows about existing literature on this,
>I'd be happy to hear.
>
>Another possibility is to use universal kriging, with your secondary
>variable treated as predictor. For this, you need the values of your
>secondary variable to be known ath the 17 monitor sites, and the
>prediction locations should coincide with (some of) the 230000 points.
>It is not equivalent to the first approach, poorer in the sense that it
>ignores the secondary variable at locations beyond the prediction
>location, but assumes a linear relationship between the two as well.
>
>-- 
>
>Edzer Pebesma
>Institute for Geoinformatics (ifgi), University of M?nster 
>Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251 
>8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de 
>http://www.52north.org/geostatistics      e.pebesma at wwu.de
>



From edzer.pebesma at uni-muenster.de  Tue Dec 15 08:29:28 2009
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Tue, 15 Dec 2009 08:29:28 +0100
Subject: [R-sig-Geo] Co-Kriging with huge data
In-Reply-To: <200912150159293121103@yahoo.com.cn>
References: <200912140146405621465@yahoo.com.cn>,
	<4B25EDF2.3020000@uni-muenster.de>
	<200912150159293121103@yahoo.com.cn>
Message-ID: <4B273AD8.60505@uni-muenster.de>



Kai Zhang wrote:
> Hi Edzer,
>
> Thanks for your reply. I am not sure if I get your point -- "Maybe a cross validation with your 17 temperature monitors can give you
> some idea on this". I am wondering if you mean sensitivity analysis of neighbor size using cross-validation. For example, based on 17 monitors, I could try the radius with 1 km, 2 km and so on using cross-validation and choose a neighbor size with smallest RMSE calculated from cross validation.
>   
Yes, that's what I meant.
> I appreciate your response and best regards,
> Kai
>
> ____________________________________________________
> Kai Zhang
> PhD Candidate, Environmental Health Sciences
> School of Public Health                        
> University of Michigan                         
> 109 S. Observatory                       
> Ann Arbor, MI 48109-2029         
> ____________________________________________________
>
> ======= 2009-12-14 02:49:22 You wrote =======
>
>   
>> Kai Zhang wrote:
>>     
>>> Dear all,
>>>
>>> I have temperature measurements at 17 monitors.  I have a secondary variable across the study area, which includes 230,000 points. I tried to conduct Co-Kring with this huge dataset and it appeared to be computationally intensive. Is there any way to run it except for running the program in a cluster?
>>>
>>> I appreciate your response and best regards,
>>> Kai
>>>   
>>>       
>> One alternative would be to use co-kriging and to limit the search
>> neighbourhood for the secondary variable. The question is how much.
>> Maybe a cross validation with your 17 temperature monitors can give you
>> some idea on this. If someone knows about existing literature on this,
>> I'd be happy to hear.
>>
>> Another possibility is to use universal kriging, with your secondary
>> variable treated as predictor. For this, you need the values of your
>> secondary variable to be known ath the 17 monitor sites, and the
>> prediction locations should coincide with (some of) the 230000 points.
>> It is not equivalent to the first approach, poorer in the sense that it
>> ignores the secondary variable at locations beyond the prediction
>> location, but assumes a linear relationship between the two as well.
>>
>> -- 
>>
>> Edzer Pebesma
>> Institute for Geoinformatics (ifgi), University of M?nster 
>> Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251 
>> 8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de 
>> http://www.52north.org/geostatistics      e.pebesma at wwu.de
>>
>>     
>
>
> ??i??'????h??&

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster 
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251 
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de 
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From p.hiemstra at geo.uu.nl  Tue Dec 15 09:34:59 2009
From: p.hiemstra at geo.uu.nl (Paul Hiemstra)
Date: Tue, 15 Dec 2009 09:34:59 +0100
Subject: [R-sig-Geo] How to automatically fit variogram in gstat
In-Reply-To: <200912150143057183174@yahoo.com.cn>
References: <200912110100009590454@yahoo.com.cn>, <4B220F72.2080409@geo.uu.nl>,
	<200912121537411560606@yahoo.com.cn>,
	<4B260E2E.10605@geo.uu.nl> <200912150143057183174@yahoo.com.cn>
Message-ID: <4B274A33.6060608@geo.uu.nl>

Hi Kai,

The note section of the documentation of fit.variogram (?fit.variogram)
tells you what is done in this function.

cheers,
Paul

Kai Zhang wrote:
> Hi Paul,
>
> Thanks for your reply. I have one more question on the fit.variogram function in gstat. Let's take an example from the gstat manual
>
> fit.variogram(vgm1, vgm(1,"Sph",300,1))
>
> My understanding is that the parameters like partial sill, range and nugget specified in vgm are just starting values and the key message is model type such as exponential model or spherical model. The fit.variogram function determines the optical parameters automatically. I am not sure if my understanding is right because I could not find the detailed description in the manual.
>
> I appreciate your response and best regards,
> Kai 	
>
> ____________________________________________________
> Kai Zhang
> PhD Candidate, Environmental Health Sciences
> School of Public Health                        
> University of Michigan                         
> 109 S. Observatory                       
> Ann Arbor, MI 48109-2029         
> ____________________________________________________
>
> ======= 2009-12-14 05:07:05 You wrote =======
>
>   
>> Hi Kai,
>>
>> If it improves depends on how you define improvement. If you want to use
>> IDW automatic you need to fit the distance power in some way. When you
>> fit the variogram automatically, you get this distance dependency of the
>> weights from the variogram. In regard to co-kriging, if there is a
>> strong correlation between the various pollutant measures (co-located)
>> co-kriging can be a good option.
>>
>> cheers,
>> Paul
>>
>> ps I included R-sig-geo again as a cc so the conversation is also on the
>> mailing list. It is best to use "Reply to all" when you reply to these
>> kind of e-mails.
>>
>> ZK wrote:
>>     
>>> Hi Paul,
>>>
>>> Many thanks for your suggestion. You are right and I would expect to Kriging improves a little compared to inverse distance method. Btw, do you think co-kriging is useful for 8 monitors?
>>>
>>> Thanks,
>>> Kai
>>> 	
>>>
>>> ____________________________________________________
>>> Kai Zhang
>>> PhD Candidate, Environmental Health Sciences
>>> School of Public Health                        
>>> University of Michigan                         
>>> 109 S. Observatory                       
>>> Ann Arbor, MI 48109-2029         
>>> ____________________________________________________
>>>
>>> ======= 2009-12-11 04:23:11 You wrote =======
>>>
>>>   
>>>       
>>>> Hi,
>>>>
>>>> One option is to use the automap package, this provides the function
>>>> autofitVariogram and autoKrige. Automap is available on CRAN. An
>>>> alternative is to use the fit.variogram function from gstat (which
>>>> automap also does).
>>>>
>>>> An additional comment, 8 stations is not a lot to base variogram models
>>>> on. Think carefully how you want to solve this problem. Maybe you can
>>>> make some kind of aggregated sample variogram that incorporates not only
>>>> the data from one day, but of one month. In this way you can increase
>>>> the amount of data you use to create the variogram. But still, just 8
>>>> stations looks to be quite a challenge.
>>>>
>>>> good luck!
>>>> Paul
>>>>
>>>> ZK wrote:
>>>>     
>>>>         
>>>>> Dear all,
>>>>> I have daily pollutant measurements (CO, NO2, PM2.5 and Ozone) at 8 monitors from 2005 to 2008.  My purpose is to estimate daily exposures for studying subjects using Kriging for three years.  A common procedure is to plot experimental variogram and then to choose a theoretical model (e.g., exponential model or Gaussian model) with some adjustment on parameters.  However, this manual way is not appropriate for my application. I am wondering how I can fit variogram in gstat automatically. 
>>>>>
>>>>> I appreciate your response and best regards,
>>>>> Kai
>>>>>
>>>>> 	
>>>>>
>>>>>
>>>>>
>>>>>
>>>>> __________________________________________________
>>>>> ?????????????????????????????
>>>>>
>>>>> _______________________________________________
>>>>> R-sig-Geo mailing list
>>>>> R-sig-Geo at stat.math.ethz.ch
>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>   
>>>>>       
>>>>>           
>>>> -- 
>>>> Drs. Paul Hiemstra
>>>> Department of Physical Geography
>>>> Faculty of Geosciences
>>>> University of Utrecht
>>>> Heidelberglaan 2
>>>> P.O. Box 80.115
>>>> 3508 TC Utrecht
>>>> Phone:  +3130 274 3113 Mon-Tue
>>>> Phone:  +3130 253 5773 Wed-Fri
>>>> http://intamap.geo.uu.nl/~paul
>>>>
>>>>     
>>>>         
>>> ??i??'?????h??&
>>>       
>> -- 
>> Drs. Paul Hiemstra
>> Department of Physical Geography
>> Faculty of Geosciences
>> University of Utrecht
>> Heidelberglaan 2
>> P.O. Box 80.115
>> 3508 TC Utrecht
>> Phone:  +3130 274 3113 Mon-Tue
>> Phone:  +3130 253 5773 Wed-Fri
>> http://intamap.geo.uu.nl/~paul
>>
>>     
>
>
> ??i??'?????h??&


-- 
Drs. Paul Hiemstra
Department of Physical Geography
Faculty of Geosciences
University of Utrecht
Heidelberglaan 2
P.O. Box 80.115
3508 TC Utrecht
Phone:  +3130 274 3113 Mon-Tue
Phone:  +3130 253 5773 Wed-Fri
http://intamap.geo.uu.nl/~paul


From hengl at spatial-analyst.net  Wed Dec 16 12:36:56 2009
From: hengl at spatial-analyst.net (Tomislav Hengl)
Date: Wed, 16 Dec 2009 12:36:56 +0100
Subject: [R-sig-Geo] Making web-repository of gridded maps: NetCDF or
	WKT Raster?
In-Reply-To: <4B2548E1.1040706@uni-muenster.de>
References: <4B252466.6090307@spatial-analyst.net><D4AC42F5-3142-4A62-8AD3-F496032BFAD7@casalegno.net>
	<4B2548E1.1040706@uni-muenster.de>
Message-ID: <22B3814CA95C4E0FBE3C379CA7208237@pcibed193>


Dear Edzer, Barry, Servet, and Miguel, 

Thank you for your tips and for sharing your experiences with us (R-sig-geo keeps on surprising me
considering the amount of support I get :).

I will dig into the links you have forwarded. Most probably, we will try to implement two/three
paths and then compare them to see which is 'better' (the main issue is that we want to do majority
of processing on the server):

(A) The rasdaman approach (http://kahlua.eecs.jacobs-university.de/trac/rasdaman/wiki/Rasdaman_8.0)
1. Install PostgreSQL support on server and download and install rasdaman File Set;
2. Create a database and put the grids in PostgreSQL database (raslib applications);
3. Test some examples with overlaying, subsetting, resampling, upscaling and visualizing data (WMS,
KML); 

(B) The OPeNDAP/NetCDF approach (http://www.unidata.ucar.edu/software/netcdf/software.html#GDAL)
1. Install OPeNDAP server and UMN Mapserver to serve data;
2. Put all grids into a single (CF)NetCDF file and upload (using WebDAV) to the server;
3. Test some examples (R + GDAL) with overlaying, subsetting, resampling, upscaling and visualizing
the data (WMS, KML);

I will keep you informed once we produce some live examples. We might first start testing a WCPS
with the worldmaps repository (http://spatial-analyst.net/worldmaps/); then develop some examples (R
code) and test flexibility/speed of both approaches. 
cheers,

T. Hengl
http://home.medewerker.uva.nl/t.hengl/


> -----Original Message-----
> From: r-sig-geo-bounces at stat.math.ethz.ch [mailto:r-sig-geo-bounces at stat.math.ethz.ch] On Behalf
> Of Edzer J. Pebesma
> Sent: Sunday, December 13, 2009 9:05 PM
> To: Stefano Casalegno
> Cc: r-sig-geo
> Subject: Re: [R-sig-Geo] Making web-repository of gridded maps: NetCDF or WKT Raster?
> 
> Dear Tom,
> 
> as your grids are spatial grids, you may want to look into the web
> service standards of the OGC (www.opengeospatial.org) for them, WCS (for
> reading) and WCS-T (for writing) in particular. We're experimenting with
> this currently, using the recently open sourced rasdaman software
> (www.rasdaman.org), which uses a data base in the back end. I don't
> think OPeNDAP has special infrastructure for spatial grids; CFNetCDF
> does, but by choosing this you may limit integration with other software
> that does assume spatial data to be served over OGC standards. CFNetCDF
> is one of the possible formats to be served over WCS (and GeoTIFF etc)
> -- if I'm correctly informed.
> 
> Bests,
> --
> Edzer
> 
> Stefano Casalegno wrote:
> > Dear Tom,
> > my best acknowledgment for the Ecogrid challenging initiative.
> > I guess the main limitation will be "time" and this is related to the
> > size of grids.
> > What is the extent of the grids ?
> > What tool you plan to use for point 1. Overlay some point data and
> > get the values of grids ?
> >
> > On a more theoretical basis,
> > "distribution models should rely upon data that covers the whole
> > extent of the distribution of the biota under examination"
> >
> > Please consider forest data from
> > http://forest.jrc.ec.europa.eu/climate-change
> > as supplementary predictors variables within an European biodiversity
> > and nature conservation application.
> >
> > Cheers
> > Stefano
> >
> >
> > ________________________________
> >
> > Stefano Casalegno, Ph.D.
> >
> > via Greppi 16, 21021 Angera - Italy
> > email: stefano at casalegno.net
> > web: http://www.casalegno.net/stefano
> > ________________________________
> >
> >
> > On Dec 13, 2009, at 6:29 PM, Tomislav Hengl wrote:
> >
> >
> >> Dear R-sig-geo,
> >>
> >> As a part of our project (EcoGRID.nl) we have prepared some 60
> >> thematic grids that we use as auxiliary predictors for species
> >> distribution modeling. At this stage, we would like to put the
> >> gridded maps (50/100 m base resolution) into some efficient
> >> sharable geo-database.
> >>
> >> We will most probably put the data into the NetCDF format (http://
> >> www.unidata.ucar.edu/software/netcdf/) because it can handle any-
> >> dimensional array data, and because it has been in continuous
> >> development and widespread use for many years. NetCDF grids can be
> >> read relatively easy into R using the RNetCDF package (e.g. http://
> >> spatial-analyst.net/DATA/readNCDF.zip). Another alternative is to
> >> use PostGIS WKT Raster format (http://trac.osgeo.org/postgis/wiki/
> >> WKTRaster), but this seems to be still rather experimental (?).
> >>
> >> Once we put the grids into NetCDF format. We plan to install
> >> OPeNDAP (http://www.opendap.org) server on top to make the files
> >> accessible through the web; then Geoserver (http://
> >> www.geoserver.org) or UMN Mapserver (http://mapserver.org) to feed
> >> a WMS from NetCDF files (raster data). Finally, we plan to add a
> >> simple OpenLayers interface on top of that (Geoserver has it built
> >> in) to allow direct browsing of the data and metadata (e.g. such as
> >> this one: http://africamap.harvard.edu/)
> >>
> >> Just to be clear, we want to put the data on a server because we
> >> would like to run a number of operations directly on the server
> >> (via rgdal?):
> >>
> >> 1. Overlay some point data and get the values of grids (without a
> >> need to download the grids locally);
> >> 2. Subset/mask and resample gridded data of interest (for a given
> >> bounding box and proj4 string; again without a need to download the
> >> data locally);
> >> 3. Upscale the grids from 100 m to 250, 500 m and 1 km resolution
> >> (then download the upscaled grids).
> >> 4. Write/upload new grids to the database (e.g. using WebDAV).
> >> 5. Browse the grids (and metadata) via the OpenLayers.
> >>
> >> These are only our wishes of course. We do not know if all this is
> >> really possible with the current software.
> >>
> >> Any examples or comments/suggestions/experiences are welcome
> >> (before we start installing and testing the functionality).
> >>
> >> Thanx!
> >>
> >> Tomislav Hengl and Lourens Veen
> >>
> >> _______________________________________________
> >> R-sig-Geo mailing list
> >> R-sig-Geo at stat.math.ethz.ch
> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >>
> >>
> >
> >
> >
> >
> >
> >
> > 	[[alternative HTML version deleted]]
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at stat.math.ethz.ch
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From sa.cizmeli at usherbrooke.ca  Wed Dec 16 13:23:38 2009
From: sa.cizmeli at usherbrooke.ca (servet ahmet =?iso-8859-1?b?52l6bWVsaQ==?=)
Date: Wed, 16 Dec 2009 07:23:38 -0500
Subject: [R-sig-Geo] spplot : varying dots for multiple parameters
In-Reply-To: <alpine.LRH.2.00.0912141751370.12225@reclus.nhh.no>
References: <2f7966b21adc6941118242f4cc880f0e@courriel.usherbrooke.ca>
	<alpine.LRH.2.00.0912141751370.12225@reclus.nhh.no>
Message-ID: <1260966218.4b28d14a5e3f2@www.usherbrooke.ca>

> Until you have control of the graphic itself, do not worry about
> decorations, they are not important.

Dear Roger,

As an educator, I understand your willingness to direct me to what you think is
essential in the learning of R and I appreciate it very much. However right now
I need to produce these maps and they need to be of very good quality as they
will go into an important scientific report whose deadline is very near. This
is why I am calling my actual experience in R "agonizing" right now!

I just want to make sure that I know very well how precious the time of each and
every one of this list so I would not ask a question just for sake of easy
learning. I ask questions when I really need something to be done (and I do it
only after I have tried every possible thing I could think of).

Anyway, many thanks again, Roger and everyone on the list for your kindly
support. Let us keep the good vibe. Right now I enjoy a lot reading and reading
in all kinds of R and R-spatial documentation and learning through
experimenting in a real project with a deadline ;o) ...

Servet


From torleif.lunde at cih.uib.no  Wed Dec 16 16:03:29 2009
From: torleif.lunde at cih.uib.no (Torleif Markussen Lunde)
Date: Wed, 16 Dec 2009 16:03:29 +0100
Subject: [R-sig-Geo] spplot : varying dots for multiple parameters
In-Reply-To: <1260966218.4b28d14a5e3f2@www.usherbrooke.ca>
References: <2f7966b21adc6941118242f4cc880f0e@courriel.usherbrooke.ca>
	<alpine.LRH.2.00.0912141751370.12225@reclus.nhh.no>
	<1260966218.4b28d14a5e3f2@www.usherbrooke.ca>
Message-ID: <200912161603.29191.torleif.lunde@cih.uib.no>

Hi

You could try  par.settings in combination with str(spplot(whatYouWantToPlot))

If I understand you correctly you want to do something like:

# read data
Insitu = read.table("test.csv", skip=3,sep=",", na.string = "NaN")
Header = read.table("test.csv", skip=1,sep=",",nrows=1)
names(Insitu)= as.character(as.matrix(Header))
# define projection
CRS_4326 = CRS("+init=epsg:4326")

# convert to sp
Insitu_sp <-
SpatialPointsDataFrame(cbind(Insitu[,"Boylam"],Insitu[,"Enlem"]),
data=Insitu, proj4string=CRS_4326)

# subset data
idx = is.na(Insitu[,"SPM"])
Insitu_sp <- Insitu_sp[!idx,c("SPM","Si","LUT","HEX")]

# if you want relative differences among group #
# will cause LUT not to be plotted since they are all 0 or NA
# Divide all columns by maximum value in column
# do not run if you want to plot all data. 
max.na <- function (x) max(x, na.rm = TRUE)
maxVal <- apply(slot(Insitu_sp, "data"), 2, max.na)
slot(Insitu_sp, "data") <- data.frame(t(apply(slot(Insitu_sp, "data"), 1, 
      function (x) x/maxVal)))
# End if you want relative differences among group #

# define the stuff you want
north <- list("SpatialPolygonsRescale", layout.north.arrow(),
    offset = c(28.85, 36.735), scale = 0.02)
scale <- list("SpatialPolygonsRescale", layout.scale.bar(),
    offset = c(29, 36.735), scale = 0.1, fill = c("transparent",
        "black"))
txt1 <- list("sp.text", c(29, 36.745), "0")
txt2 <- list("sp.text", c(29.1, 36.745), "1 km")

my.layout <- list(txt1,txt2,scale,north)

# define point size
# note that the breaks are set according to the max and min values 
# in all(!) columns. Therefore standardization might be an idea (above)
ptsize <- seq(.5, 1.5, 
	      length.out=
		length(levels(spplot(Insitu_sp)$panel.args.common$groups)))

# (sp)plot
spplot(Insitu_sp, pch = 16, 
         col.regions = "red", # set colors
	 par.settings = list(
	  superpose.symbol = list(
           cex = ptsize)), # set point size
	 sp.layout = my.layout,
	 key = list(text = 
		      list(levels(spplot(Insitu_sp 
			    )$panel.args.common$groups)), 
	    points = list(pch=16, cex = ptsize, col="red"))) # add legend



Best wishes
Torleif

Torleif Markussen Lunde
Research fellow
Centre for International Health/
Bjerknes Centre for Climate Research
University of Bergen
Norway






On Wednesday 16 December 2009 13:23:38 servet ahmet ?izmeli wrote:
> > Until you have control of the graphic itself, do not worry about
> > decorations, they are not important.
> 
> Dear Roger,
> 
> As an educator, I understand your willingness to direct me to what you
>  think is essential in the learning of R and I appreciate it very much.
>  However right now I need to produce these maps and they need to be of very
>  good quality as they will go into an important scientific report whose
>  deadline is very near. This is why I am calling my actual experience in R
>  "agonizing" right now!
> 
> I just want to make sure that I know very well how precious the time of
>  each and every one of this list so I would not ask a question just for
>  sake of easy learning. I ask questions when I really need something to be
>  done (and I do it only after I have tried every possible thing I could
>  think of).
> 
> Anyway, many thanks again, Roger and everyone on the list for your kindly
> support. Let us keep the good vibe. Right now I enjoy a lot reading and
>  reading in all kinds of R and R-spatial documentation and learning through
>  experimenting in a real project with a deadline ;o) ...
> 
> Servet
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 


From jthayn at ilstu.edu  Wed Dec 16 19:12:48 2009
From: jthayn at ilstu.edu (Jonathan Thayn)
Date: Wed, 16 Dec 2009 12:12:48 -0600
Subject: [R-sig-Geo] reading select values from a binary file
In-Reply-To: <d8ad40b50912091033g75f5832es9fb7419697308225@mail.gmail.com>
References: <FD872DE1-8372-4931-A626-A8376FF13612@ilstu.edu>
	<d8ad40b50912090906r54d5a529m9343e721371eefde@mail.gmail.com>
	<4B1FEA85.4060300@nceas.ucsb.edu>
	<d8ad40b50912091033g75f5832es9fb7419697308225@mail.gmail.com>
Message-ID: <FF215884-17BF-4457-A1B7-12837ED2E4D1@ilstu.edu>

I tried using the seek() function, but it did not work as I thought it would. Perhaps I have done something wrong:

> writeBin(1:20,"desktop/test.bip",size=2,endian="big")
> cc <- file("desktop/test.bip","rb")
> readBin(cc,"integer",n=1,size=2,endian="big")
[1] 1
> seek(cc,13)
[1] 2 
> readBin(cc,"integer",n=1,size=2,endian="big")
[1] 1792 #this is not correct
> seek(cc,0)
[1] 15
> readBin(cc,"integer",n=1,size=2,endian="big")
[1] 1 #the seek(cc,0) seems to have reset it
> flush(cc)
> seek(cc,6)
[1] 2
> readBin(cc,"integer",n=1,size=2,endian="big")
[1] 4 #this is not the sixth number
> readBin(cc,"integer",n=1,size=2,endian="big")
[1] 5
> flush(cc)
> seek(cc,12)
[1] 10
> readBin(cc,"integer",n=1,size=2,endian="big")
[1] 7 #this is not the twelfth number
> flush(cc)
> seek(cc,1)
[1] 14
> readBin(cc,"integer",n=1,size=2,endian="big")
[1] 256
> seek(cc,0)
[1] 3
> readBin(cc,"integer",n=1,size=2,endian="big")
[1] 1
> seek(cc,18)
[1] 2
> readBin(cc,"integer",n=1,size=2,endian="big")
[1] 10


I tried the readBinFragments() function in the R.utils package and it works, so long as I use a seek(cc,0) between calls:

readBinFragments(cc,"integer",idxs=c(2,6,7,13,19),size=2,endian="big")
[1]  2  6  7 13 19
> readBinFragments(cc,"integer",idxs=c(4,9,12),size=2,endian="big")
[1] 0 0 0
> flush(cc)
> readBinFragments(cc,"integer",idxs=c(4,9,12),size=2,endian="big")
[1] 0 0 0
> seek(cc,0)
[1] 52
> readBinFragments(cc,"integer",idxs=c(4,9,12),size=2,endian="big")
[1]  4  9 12


Am I using seek() incorrectly?



Jonathan B. Thayn




On Dec 9, 2009, at 12:33 PM, Barry Rowlingson wrote:

> On Wed, Dec 9, 2009 at 6:20 PM, rick reeves <reeves at nceas.ucsb.edu> wrote:
>> Hello All:
>> Faced with a similar challenge, and NOT wanting to resort to writing a C
>> language function
>> employing fseek(), I just used two readBin calls: One to read (and
>> implicitly discard) data up
>> to the spot I actually wanted to read, and a second call to read the desired
>> information.
>> here is a code sample:
>> 
>>                     fileCon = file(sTsFileName,"rb")
>> #
>> # Offset has been calculated above: number of NumericByte-sized elements
>> preceeding
>> # the data of interest.
>> #
>>                     if (iOffset > 0)
>>                     {
>> 
>>                        TestVec = readBin(fileCon,numeric(),size =
>> iNumericBytes,n=iOffset)
>>                     }
>>                       dTimeSeries = readBin(fileCon,numeric(),size =
>> iNumericBytes,n=iNumElements)                     close(fileCon)
>> 
>> Crude, but effective. I WIS that we could add a seekBin() function that
>> positions the file pointer
>> to the desired spot.
>> 
> 
> The R seek function does this. I hadn't tested it when I posted,
> hoping the original poster would work it from my message. So I just
> now tested it:
> 
> I created a file with ascii a to z in, and then:
> 
>> con = file("file.tst","rb")
> # jump to 13th letter:
>> seek(con,13)
> [1] 0
> # read it:
>> readBin(con,what="raw",n=1)
> [1] 6e     # thats ascii 'n'
> # jump back:
>> seek(con,1)
> [1] 14 # returns where we were, we've now moved...
>> readBin(con,what="raw",n=1)
> [1] 62  # ascii 'b'. Things start at zero....
> 
> Is that what you are trying to do?
> 
> Barry


From mdsumner at gmail.com  Wed Dec 16 20:07:16 2009
From: mdsumner at gmail.com (Michael Sumner)
Date: Thu, 17 Dec 2009 06:07:16 +1100
Subject: [R-sig-Geo] reading select values from a binary file
In-Reply-To: <FF215884-17BF-4457-A1B7-12837ED2E4D1@ilstu.edu>
References: <FD872DE1-8372-4931-A626-A8376FF13612@ilstu.edu>
	<d8ad40b50912090906r54d5a529m9343e721371eefde@mail.gmail.com>
	<4B1FEA85.4060300@nceas.ucsb.edu>
	<d8ad40b50912091033g75f5832es9fb7419697308225@mail.gmail.com>
	<FF215884-17BF-4457-A1B7-12837ED2E4D1@ilstu.edu>
Message-ID: <522664f80912161107v25e70f9euc178a5f3167328e3@mail.gmail.com>

?seek

The "where" argument is an offset in bytes, so you need to offet 2
bytes for each of your integers:

writeBin(1:20,"test.bip",size=2,endian="big")
cc <- file("test.bip","rb")
readBin(cc,"integer",n=1,size=2,endian="big")
seek(cc, 26)
readBin(cc,"integer",n=1,size=2,endian="big")
## [1] 14
close(cc)

Use seek(cc) to find the current offset on the connection.

HTH

On Thu, Dec 17, 2009 at 5:12 AM, Jonathan Thayn <jthayn at ilstu.edu> wrote:
> I tried using the seek() function, but it did not work as I thought it would. Perhaps I have done something wrong:
>
>> writeBin(1:20,"desktop/test.bip",size=2,endian="big")
>> cc <- file("desktop/test.bip","rb")
>> readBin(cc,"integer",n=1,size=2,endian="big")
> [1] 1
>> seek(cc,13)
> [1] 2
>> readBin(cc,"integer",n=1,size=2,endian="big")
> [1] 1792 #this is not correct
>> seek(cc,0)
> [1] 15
>> readBin(cc,"integer",n=1,size=2,endian="big")
> [1] 1 #the seek(cc,0) seems to have reset it
>> flush(cc)
>> seek(cc,6)
> [1] 2
>> readBin(cc,"integer",n=1,size=2,endian="big")
> [1] 4 #this is not the sixth number
>> readBin(cc,"integer",n=1,size=2,endian="big")
> [1] 5
>> flush(cc)
>> seek(cc,12)
> [1] 10
>> readBin(cc,"integer",n=1,size=2,endian="big")
> [1] 7 #this is not the twelfth number
>> flush(cc)
>> seek(cc,1)
> [1] 14
>> readBin(cc,"integer",n=1,size=2,endian="big")
> [1] 256
>> seek(cc,0)
> [1] 3
>> readBin(cc,"integer",n=1,size=2,endian="big")
> [1] 1
>> seek(cc,18)
> [1] 2
>> readBin(cc,"integer",n=1,size=2,endian="big")
> [1] 10
>
>
> I tried the readBinFragments() function in the R.utils package and it works, so long as I use a seek(cc,0) between calls:
>
> readBinFragments(cc,"integer",idxs=c(2,6,7,13,19),size=2,endian="big")
> [1] ?2 ?6 ?7 13 19
>> readBinFragments(cc,"integer",idxs=c(4,9,12),size=2,endian="big")
> [1] 0 0 0
>> flush(cc)
>> readBinFragments(cc,"integer",idxs=c(4,9,12),size=2,endian="big")
> [1] 0 0 0
>> seek(cc,0)
> [1] 52
>> readBinFragments(cc,"integer",idxs=c(4,9,12),size=2,endian="big")
> [1] ?4 ?9 12
>
>
> Am I using seek() incorrectly?
>
>
>
> Jonathan B. Thayn
>
>
>
>
> On Dec 9, 2009, at 12:33 PM, Barry Rowlingson wrote:
>
>> On Wed, Dec 9, 2009 at 6:20 PM, rick reeves <reeves at nceas.ucsb.edu> wrote:
>>> Hello All:
>>> Faced with a similar challenge, and NOT wanting to resort to writing a C
>>> language function
>>> employing fseek(), I just used two readBin calls: One to read (and
>>> implicitly discard) data up
>>> to the spot I actually wanted to read, and a second call to read the desired
>>> information.
>>> here is a code sample:
>>>
>>> ? ? ? ? ? ? ? ? ? ? fileCon = file(sTsFileName,"rb")
>>> #
>>> # Offset has been calculated above: number of NumericByte-sized elements
>>> preceeding
>>> # the data of interest.
>>> #
>>> ? ? ? ? ? ? ? ? ? ? if (iOffset > 0)
>>> ? ? ? ? ? ? ? ? ? ? {
>>>
>>> ? ? ? ? ? ? ? ? ? ? ? ?TestVec = readBin(fileCon,numeric(),size =
>>> iNumericBytes,n=iOffset)
>>> ? ? ? ? ? ? ? ? ? ? }
>>> ? ? ? ? ? ? ? ? ? ? ? dTimeSeries = readBin(fileCon,numeric(),size =
>>> iNumericBytes,n=iNumElements) ? ? ? ? ? ? ? ? ? ? close(fileCon)
>>>
>>> Crude, but effective. I WIS that we could add a seekBin() function that
>>> positions the file pointer
>>> to the desired spot.
>>>
>>
>> The R seek function does this. I hadn't tested it when I posted,
>> hoping the original poster would work it from my message. So I just
>> now tested it:
>>
>> I created a file with ascii a to z in, and then:
>>
>>> con = file("file.tst","rb")
>> # jump to 13th letter:
>>> seek(con,13)
>> [1] 0
>> # read it:
>>> readBin(con,what="raw",n=1)
>> [1] 6e ? ? # thats ascii 'n'
>> # jump back:
>>> seek(con,1)
>> [1] 14 # returns where we were, we've now moved...
>>> readBin(con,what="raw",n=1)
>> [1] 62 ?# ascii 'b'. Things start at zero....
>>
>> Is that what you are trying to do?
>>
>> Barry
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From zua3 at cornell.edu  Wed Dec 16 23:07:33 2009
From: zua3 at cornell.edu (Zia Ahmed)
Date: Wed, 16 Dec 2009 17:07:33 -0500
Subject: [R-sig-Geo] plot shape file using lattice xyplot
In-Reply-To: <522664f80912161107v25e70f9euc178a5f3167328e3@mail.gmail.com>
References: <FD872DE1-8372-4931-A626-A8376FF13612@ilstu.edu>	<d8ad40b50912090906r54d5a529m9343e721371eefde@mail.gmail.com>	<4B1FEA85.4060300@nceas.ucsb.edu>	<d8ad40b50912091033g75f5832es9fb7419697308225@mail.gmail.com>	<FF215884-17BF-4457-A1B7-12837ED2E4D1@ilstu.edu>
	<522664f80912161107v25e70f9euc178a5f3167328e3@mail.gmail.com>
Message-ID: <4B295A25.9060002@cornell.edu>

Hi,

I am trying to plot a shape file  in R. I can do  it easily using plot 
or spplot function.  But I want plot this map with  lattice xyplot 
function. Any one has any idea? I do not want use "maps" package.

Help will be appreciated...

Thanks

Zia

library(maptools)
library(lattice)
bound<-read.shape("Boundary.shp")
#OR
bound<-readShapePoly("Boundary.shp")
plot(bound)
spplot(bound)

# Or following way

bound<-Map2poly(bound)
xybd<-attr(bound,"maplim")

plot(xybd$x,xybd$y, type="n",asp=1, xlab="", ylab="")
for (i in 1:length(bound)) lines(bound[[i]]) # How do I apply this code 
in following  panel.function of  xyplot?


windows(width=5, height=5)
xyplot(y~x, as.data.frame(tala),pch=1, cex=.8,col="black",
       xlab=list("Easting (m)",cex=.9),ylab=list("Northing (m)",cex=.9),
       aspect = "iso",
       panel = function(...) {
              panel.xyplot(...)
              panel.abline(h = 0:4*5000 + 545000, v= 0:4*5000 + 2650000,
              col = "light grey")
              panel.points(coordinates(tala.nr),cex=.95,pch=20, col="black")
              panel.text(2671000, 563000, cex=1, " (a)")
              },
)


From felix at nfrac.org  Wed Dec 16 23:41:31 2009
From: felix at nfrac.org (Felix Andrews)
Date: Thu, 17 Dec 2009 09:41:31 +1100
Subject: [R-sig-Geo] plot shape file using lattice xyplot
In-Reply-To: <4B295A25.9060002@cornell.edu>
References: <FD872DE1-8372-4931-A626-A8376FF13612@ilstu.edu> 
	<d8ad40b50912090906r54d5a529m9343e721371eefde@mail.gmail.com> 
	<4B1FEA85.4060300@nceas.ucsb.edu>
	<d8ad40b50912091033g75f5832es9fb7419697308225@mail.gmail.com> 
	<FF215884-17BF-4457-A1B7-12837ED2E4D1@ilstu.edu>
	<522664f80912161107v25e70f9euc178a5f3167328e3@mail.gmail.com> 
	<4B295A25.9060002@cornell.edu>
Message-ID: <94730b8a0912161441y32e4122erdf037f979be83ee5@mail.gmail.com>

What's wrong with using spplot? It is based on xyplot anyway.

If you want to use xyplot, you can use the panel function that sp defines:
sp.polygons(shp)

You can read in the shapefile with the RGDAL package:
shp <- readOGR(...)


2009/12/17 Zia Ahmed <zua3 at cornell.edu>:
> Hi,
>
> I am trying to plot a shape file ?in R. I can do ?it easily using plot or
> spplot function. ?But I want plot this map with ?lattice xyplot function.
> Any one has any idea? I do not want use "maps" package.
>
> Help will be appreciated...
>
> Thanks
>
> Zia
>
> library(maptools)
> library(lattice)
> bound<-read.shape("Boundary.shp")
> #OR
> bound<-readShapePoly("Boundary.shp")
> plot(bound)
> spplot(bound)
>
> # Or following way
>
> bound<-Map2poly(bound)
> xybd<-attr(bound,"maplim")
>
> plot(xybd$x,xybd$y, type="n",asp=1, xlab="", ylab="")
> for (i in 1:length(bound)) lines(bound[[i]]) # How do I apply this code in
> following ?panel.function of ?xyplot?
>
>
> windows(width=5, height=5)
> xyplot(y~x, as.data.frame(tala),pch=1, cex=.8,col="black",
> ? ? ?xlab=list("Easting (m)",cex=.9),ylab=list("Northing (m)",cex=.9),
> ? ? ?aspect = "iso",
> ? ? ?panel = function(...) {
> ? ? ? ? ? ? panel.xyplot(...)
> ? ? ? ? ? ? panel.abline(h = 0:4*5000 + 545000, v= 0:4*5000 + 2650000,
> ? ? ? ? ? ? col = "light grey")
> ? ? ? ? ? ? panel.points(coordinates(tala.nr),cex=.95,pch=20, col="black")
> ? ? ? ? ? ? panel.text(2671000, 563000, cex=1, " (a)")
> ? ? ? ? ? ? },
> )
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



-- 
Felix Andrews / ???
Postdoctoral Fellow
Integrated Catchment Assessment and Management (iCAM) Centre
Fenner School of Environment and Society [Bldg 48a]
The Australian National University
Canberra ACT 0200 Australia
M: +61 410 400 963
T: + 61 2 6125 4670
E: felix.andrews at anu.edu.au
CRICOS Provider No. 00120C
-- 
http://www.neurofractal.org/felix/


From pslarson2 at gmail.com  Thu Dec 17 01:35:13 2009
From: pslarson2 at gmail.com (Pete Larson)
Date: Wed, 16 Dec 2009 19:35:13 -0500
Subject: [R-sig-Geo] plot shape file using lattice xyplot
In-Reply-To: <94730b8a0912161441y32e4122erdf037f979be83ee5@mail.gmail.com>
References: <FD872DE1-8372-4931-A626-A8376FF13612@ilstu.edu>
	<d8ad40b50912090906r54d5a529m9343e721371eefde@mail.gmail.com>
	<4B1FEA85.4060300@nceas.ucsb.edu>	<d8ad40b50912091033g75f5832es9fb7419697308225@mail.gmail.com>
	<FF215884-17BF-4457-A1B7-12837ED2E4D1@ilstu.edu>	<522664f80912161107v25e70f9euc178a5f3167328e3@mail.gmail.com>
	<4B295A25.9060002@cornell.edu>
	<94730b8a0912161441y32e4122erdf037f979be83ee5@mail.gmail.com>
Message-ID: <4B297CC1.2090306@gmail.com>

Hello all,

I have a data frame with lat and lon coordinates for some sample areas 
(not a grid) .

I was to create an nb object that I can use with spdep but am unsure as 
to how to convert it.

Does anybody have any ideas?


Thanks,

Pete


From zua3 at cornell.edu  Thu Dec 17 02:27:46 2009
From: zua3 at cornell.edu (Zia Ahmed)
Date: Wed, 16 Dec 2009 20:27:46 -0500
Subject: [R-sig-Geo] plot shape file using lattice xyplot
In-Reply-To: <94730b8a0912161441y32e4122erdf037f979be83ee5@mail.gmail.com>
References: <FD872DE1-8372-4931-A626-A8376FF13612@ilstu.edu>
	<d8ad40b50912090906r54d5a529m9343e721371eefde@mail.gmail.com>
	<4B1FEA85.4060300@nceas.ucsb.edu>
	<d8ad40b50912091033g75f5832es9fb7419697308225@mail.gmail.com>
	<FF215884-17BF-4457-A1B7-12837ED2E4D1@ilstu.edu>
	<522664f80912161107v25e70f9euc178a5f3167328e3@mail.gmail.com>
	<4B295A25.9060002@cornell.edu>
	<94730b8a0912161441y32e4122erdf037f979be83ee5@mail.gmail.com>
Message-ID: <4B298912.3020209@cornell.edu>

Thanks Andrews. It works fine. Nothing wrong with sp plot.  I need to 
plot boundary around of sampling locations. R-script I have  written, I 
used xyplot and levelplot.

Thanks  again

Zia

Felix Andrews wrote:
> What's wrong with using spplot? It is based on xyplot anyway.
>
> If you want to use xyplot, you can use the panel function that sp defines:
> sp.polygon
>
> You can read in the shapefile with the RGDAL package:
> shp <- readOGR(...)
>
>
> 2009/12/17 Zia Ahmed <zua3 at cornell.edu>:
>   
>> Hi,
>>
>> I am trying to plot a shape file  in R. I can do  it easily using plot or
>> spplot function.  But I want plot this map with  lattice xyplot function.
>> Any one has any idea? I do not want use "maps" package.
>>
>> Help will be appreciated...
>>
>> Thanks
>>
>> Zia
>>
>> library(maptools)
>> library(lattice)
>> bound<-read.shape("Boundary.shp")
>> #OR
>> bound<-readShapePoly("Boundary.shp")
>> plot(bound)
>> spplot(bound)
>>
>> # Or following way
>>
>> bound<-Map2poly(bound)
>> xybd<-attr(bound,"maplim")
>>
>> plot(xybd$x,xybd$y, type="n",asp=1, xlab="", ylab="")
>> for (i in 1:length(bound)) lines(bound[[i]]) # How do I apply this code in
>> following  panel.function of  xyplot?
>>
>>
>> windows(width=5, height=5)
>> xyplot(y~x, as.data.frame(tala),pch=1, cex=.8,col="black",
>>      xlab=list("Easting (m)",cex=.9),ylab=list("Northing (m)",cex=.9),
>>      aspect = "iso",
>>      panel = function(...) {
>>             panel.xyplot(...)
>>             panel.abline(h = 0:4*5000 + 545000, v= 0:4*5000 + 2650000,
>>             col = "light grey")
>>             panel.points(coordinates(tala.nr),cex=.95,pch=20, col="black")
>>             panel.text(2671000, 563000, cex=1, " (a)")
>>             },
>> )
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>     
>
>
>
>


From pslarson2 at gmail.com  Thu Dec 17 03:12:49 2009
From: pslarson2 at gmail.com (Pete Larson)
Date: Wed, 16 Dec 2009 21:12:49 -0500
Subject: [R-sig-Geo] create nb object
In-Reply-To: <4B297CC1.2090306@gmail.com>
References: <FD872DE1-8372-4931-A626-A8376FF13612@ilstu.edu>	<d8ad40b50912090906r54d5a529m9343e721371eefde@mail.gmail.com>	<4B1FEA85.4060300@nceas.ucsb.edu>	<d8ad40b50912091033g75f5832es9fb7419697308225@mail.gmail.com>	<FF215884-17BF-4457-A1B7-12837ED2E4D1@ilstu.edu>	<522664f80912161107v25e70f9euc178a5f3167328e3@mail.gmail.com>	<4B295A25.9060002@cornell.edu>	<94730b8a0912161441y32e4122erdf037f979be83ee5@mail.gmail.com>
	<4B297CC1.2090306@gmail.com>
Message-ID: <4B2993A1.4080704@gmail.com>

Hello all,

I have a data frame with lat and lon coordinates for some sample areas 
(not a grid) .

I was to create an nb object that I can use with spdep but am unsure as 
to how to convert it.

Does anybody have any ideas?

Thanks,


Pete
>
>


From Roger.Bivand at nhh.no  Thu Dec 17 08:20:35 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 17 Dec 2009 08:20:35 +0100 (CET)
Subject: [R-sig-Geo] plot shape file using lattice xyplot
In-Reply-To: <4B295A25.9060002@cornell.edu>
References: <FD872DE1-8372-4931-A626-A8376FF13612@ilstu.edu>
	<d8ad40b50912090906r54d5a529m9343e721371eefde@mail.gmail.com>
	<4B1FEA85.4060300@nceas.ucsb.edu>
	<d8ad40b50912091033g75f5832es9fb7419697308225@mail.gmail.com>
	<FF215884-17BF-4457-A1B7-12837ED2E4D1@ilstu.edu>
	<522664f80912161107v25e70f9euc178a5f3167328e3@mail.gmail.com>
	<4B295A25.9060002@cornell.edu>
Message-ID: <alpine.LRH.2.00.0912170815200.17211@reclus.nhh.no>

On Wed, 16 Dec 2009, Zia Ahmed wrote:

> Hi,
>
> I am trying to plot a shape file  in R. I can do  it easily using plot or 
> spplot function.  But I want plot this map with  lattice xyplot function. Any 
> one has any idea? I do not want use "maps" package.
>
> Help will be appreciated...
>
> Thanks
>
> Zia
>
> library(maptools)
> library(lattice)
> bound<-read.shape("Boundary.shp")

This is no longer possible in current maptools - read.shape() is no longer 
in the package namespace.

> #OR
> bound<-readShapePoly("Boundary.shp")
> plot(bound)
> spplot(bound)
>
> # Or following way
>
> bound<-Map2poly(bound)
> xybd<-attr(bound,"maplim")
>

Nor is this possible now - after years of deprecation, these S3 classes 
are now defunct and their methods not in the namespace of maptools. Only 
S4 sp classes are available. Retaining the antiquated older versions, and 
trying to help users who instist on not reading warnings about 
deprecation, has ceased to be worthwhile.

Everyone looking for advise in the archives will see messages mentioning 
read.shape() etc., this statement should suffice to indicate what is 
going on.

Roger

> plot(xybd$x,xybd$y, type="n",asp=1, xlab="", ylab="")
> for (i in 1:length(bound)) lines(bound[[i]]) # How do I apply this code in 
> following  panel.function of  xyplot?
>
>
> windows(width=5, height=5)
> xyplot(y~x, as.data.frame(tala),pch=1, cex=.8,col="black",
>      xlab=list("Easting (m)",cex=.9),ylab=list("Northing (m)",cex=.9),
>      aspect = "iso",
>      panel = function(...) {
>             panel.xyplot(...)
>             panel.abline(h = 0:4*5000 + 545000, v= 0:4*5000 + 2650000,
>             col = "light grey")
>             panel.points(coordinates(tala.nr),cex=.95,pch=20, col="black")
>             panel.text(2671000, 563000, cex=1, " (a)")
>             },
> )
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From Roger.Bivand at nhh.no  Thu Dec 17 09:05:01 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 17 Dec 2009 09:05:01 +0100 (CET)
Subject: [R-sig-Geo] plot shape file using lattice xyplot
In-Reply-To: <4B298912.3020209@cornell.edu>
References: <FD872DE1-8372-4931-A626-A8376FF13612@ilstu.edu>
	<d8ad40b50912090906r54d5a529m9343e721371eefde@mail.gmail.com>
	<4B1FEA85.4060300@nceas.ucsb.edu>
	<d8ad40b50912091033g75f5832es9fb7419697308225@mail.gmail.com>
	<FF215884-17BF-4457-A1B7-12837ED2E4D1@ilstu.edu>
	<522664f80912161107v25e70f9euc178a5f3167328e3@mail.gmail.com>
	<4B295A25.9060002@cornell.edu>
	<94730b8a0912161441y32e4122erdf037f979be83ee5@mail.gmail.com>
	<4B298912.3020209@cornell.edu>
Message-ID: <alpine.LRH.2.00.0912170820580.17211@reclus.nhh.no>

On Wed, 16 Dec 2009, Zia Ahmed wrote:

> Thanks Andrews. It works fine. Nothing wrong with sp plot.  I need to plot 
> boundary around of sampling locations. R-script I have  written, I used 
> xyplot and levelplot.

This look like a two-step question, assuming that you need a line 
representation of possible polygon boundaries from the shapefile. If it is 
a SpatialLines object, omit the first step (it will work on 
SpatialPolygons* objects with appropriate slot names, but the intention 
is to use lines, so make sure that they are):

library(sp)
library(maptools)
xx <- readShapeSpatial(system.file("shapes/sids.shp",
   package="maptools")[1])
proj4string(xx) <- CRS("+proj=longlat +ellps=clrk66")
# assigning geographical coordinates for this data set
class(xx)

lxx <- as(xx, "SpatialLines")
class(lxx)

lns <- slot(lxx, "lines")
olns <- lapply(lns, slot, "Lines")
ocrds <- matrix(nrow=0, ncol=2)
for (i in seq(along=olns)) {
   for (j in seq(along=olns[[i]])) {
     crds <- rbind(slot(olns[[i]][[j]], "coords"), c(NA, NA))
     ocrds <- rbind(ocrds, crds)
   }
}

plot(ocrds, type="l")
# sanity check

pts <- coordinates(spsample(xx, n=400, type="random"))

library(lattice)
xyplot(y~x, as.data.frame(pts), pch=1, cex=.8, col="black",
   xlab=list("Easting (m)",cex=.9), ylab=list("Northing (m)",cex=.9),
   aspect = mapasp(xx), # setting aspect for geographical coordinates
   panel = function(...) {
     panel.xyplot(...)
     panel.lines(ocrds)
   }
)

In summary: make an S-style coordinates matrix (lines separated by NA 
rows), then pass through panel.lines().

Hope this helps,

Roger

>
> Thanks  again
>
> Zia
>
> Felix Andrews wrote:
>> What's wrong with using spplot? It is based on xyplot anyway.
>> 
>> If you want to use xyplot, you can use the panel function that sp defines:
>> sp.polygon
>> 
>> You can read in the shapefile with the RGDAL package:
>> shp <- readOGR(...)
>> 
>> 
>> 2009/12/17 Zia Ahmed <zua3 at cornell.edu>:
>> 
>>> Hi,
>>> 
>>> I am trying to plot a shape file  in R. I can do  it easily using plot or
>>> spplot function.  But I want plot this map with  lattice xyplot function.
>>> Any one has any idea? I do not want use "maps" package.
>>> 
>>> Help will be appreciated...
>>> 
>>> Thanks
>>> 
>>> Zia
>>> 
>>> library(maptools)
>>> library(lattice)
>>> bound<-read.shape("Boundary.shp")
>>> #OR
>>> bound<-readShapePoly("Boundary.shp")
>>> plot(bound)
>>> spplot(bound)
>>> 
>>> # Or following way
>>> 
>>> bound<-Map2poly(bound)
>>> xybd<-attr(bound,"maplim")
>>> 
>>> plot(xybd$x,xybd$y, type="n",asp=1, xlab="", ylab="")
>>> for (i in 1:length(bound)) lines(bound[[i]]) # How do I apply this code in
>>> following  panel.function of  xyplot?
>>> 
>>> 
>>> windows(width=5, height=5)
>>> xyplot(y~x, as.data.frame(tala),pch=1, cex=.8,col="black",
>>>      xlab=list("Easting (m)",cex=.9),ylab=list("Northing (m)",cex=.9),
>>>      aspect = "iso",
>>>      panel = function(...) {
>>>             panel.xyplot(...)
>>>             panel.abline(h = 0:4*5000 + 545000, v= 0:4*5000 + 2650000,
>>>             col = "light grey")
>>>             panel.points(coordinates(tala.nr),cex=.95,pch=20, col="black")
>>>             panel.text(2671000, 563000, cex=1, " (a)")
>>>             },
>>> )
>>> 
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>> 
>> 
>> 
>> 
>> 
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From Roger.Bivand at nhh.no  Thu Dec 17 09:14:38 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 17 Dec 2009 09:14:38 +0100 (CET)
Subject: [R-sig-Geo] create nb object
In-Reply-To: <4B2993A1.4080704@gmail.com>
References: <FD872DE1-8372-4931-A626-A8376FF13612@ilstu.edu>
	<d8ad40b50912090906r54d5a529m9343e721371eefde@mail.gmail.com>
	<4B1FEA85.4060300@nceas.ucsb.edu>
	<d8ad40b50912091033g75f5832es9fb7419697308225@mail.gmail.com>
	<FF215884-17BF-4457-A1B7-12837ED2E4D1@ilstu.edu>
	<522664f80912161107v25e70f9euc178a5f3167328e3@mail.gmail.com>
	<4B295A25.9060002@cornell.edu>
	<94730b8a0912161441y32e4122erdf037f979be83ee5@mail.gmail.com>
	<4B297CC1.2090306@gmail.com> <4B2993A1.4080704@gmail.com>
Message-ID: <alpine.LRH.2.00.0912170905260.17211@reclus.nhh.no>

On Wed, 16 Dec 2009, Pete Larson wrote:

> Hello all,
>
> I have a data frame with lat and lon coordinates for some sample areas (not a 
> grid) .
>
> I was to create an nb object that I can use with spdep but am unsure as to 
> how to convert it.
>
> Does anybody have any ideas?

Create a matrix of coordinates, if not using sp classes, for example:

xy <- cbind(df$x, df$y)

or if your data frame is a SpatialPointsDataFrame, just:

xy <- coordinates(obj)

Then your choice of dnearneigh(), knn2nb(knearneigh()), graph2nb() with 
three graph variants, tri2nb() for a Delaunay triangulation. The first two 
of these also take a longlat= argument in case your coordinates are 
geographical, not projected. Triangulation and graph-based methods need 
planar coordinates, so you would have to project them first.

Hope this helps,

Roger

>
> Thanks,
>
>
> Pete
>> 
>> 
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From sa.cizmeli at usherbrooke.ca  Thu Dec 17 10:43:09 2009
From: sa.cizmeli at usherbrooke.ca (servet ahmet =?iso-8859-1?b?52l6bWVsaQ==?=)
Date: Thu, 17 Dec 2009 04:43:09 -0500
Subject: [R-sig-Geo] spplot : varying dots for multiple parameters
In-Reply-To: <200912161603.29191.torleif.lunde@cih.uib.no>
References: <2f7966b21adc6941118242f4cc880f0e@courriel.usherbrooke.ca>
	<alpine.LRH.2.00.0912141751370.12225@reclus.nhh.no>
	<1260966218.4b28d14a5e3f2@www.usherbrooke.ca>
	<200912161603.29191.torleif.lunde@cih.uib.no>
Message-ID: <1261042989.4b29fd2d3e182@www.usherbrooke.ca>

Wow this list is awesome. I have been in lists for a longtime but never saw such
a good intentioned support in any other place.

Thanks Torleif and everyone else for taking time and producing code for me.

Torleif's code creates maps that are close to what I seek to reproduce.  The
normalization performed in the code creates a visually nice look but it
unfortunately eliminates the absolute measurement units that I need to convey in
the maps.

So the only thing that is left to achieve here is to produce different dot sizes
(and accordingly different keys) for each panel. I am right now actively
looking in this direction. Earlier in the thread, Edzer had said I could
achieve this using using xyplot but Roger had replied it is not possible so I
am a bit perplex now. I am experimenting this with a call to sp.points via
sp.layout but no luck so far :

pts <- list("sp.points", Insitu_sp, pch = 4, col = "red")
my.layout <- list(pts)
spplot(Insitu_sp, dataset, pch = 16,
         sp.layout = my.layout)

Do you people think there is a way to achieve this using either of spplot or
xyplot? If the answer is no, I'll have to stick to bubble() and populate the
different panels manually.


From coulmont at gmail.com  Thu Dec 17 11:07:14 2009
From: coulmont at gmail.com (Baptiste Coulmont)
Date: Thu, 17 Dec 2009 11:07:14 +0100
Subject: [R-sig-Geo] How to crop a shapefile ?
Message-ID: <13b8559c0912170207i7084ec4cj86d634d8678bd786@mail.gmail.com>

Hi,

I'm working with R and various shapefiles created by the OpenStreetMap
project. Those shapefiles (the roads in particular) are quite big.

How can I crop (or "trim", or "prune" those objects -- once in a
SpatialLineDataFrame -- if I need to work not on a national level but
on a municipal level ?

Is it possible to create a subset of a smaller zone ?
Coordinates:
         min       max
r1  2.560776  6.403847
r2 49.493613 51.505419

Thansk,
B. Coulmont

-- 
Baptiste   Coulmont
http://coulmont.com/blog


From torleif.lunde at cih.uib.no  Thu Dec 17 11:21:54 2009
From: torleif.lunde at cih.uib.no (Torleif Markussen Lunde)
Date: Thu, 17 Dec 2009 11:21:54 +0100
Subject: [R-sig-Geo] spplot : varying dots for multiple parameters
In-Reply-To: <1261042989.4b29fd2d3e182@www.usherbrooke.ca>
References: <2f7966b21adc6941118242f4cc880f0e@courriel.usherbrooke.ca>
	<200912161603.29191.torleif.lunde@cih.uib.no>
	<1261042989.4b29fd2d3e182@www.usherbrooke.ca>
Message-ID: <200912171121.54444.torleif.lunde@cih.uib.no>

In that case I would produce:

pdf("filename.pdf")
print(spplot(Insitu_sp, "SPM", parameters as suggested earlier))
dev.off()

pdf("filename.pdf")
print(spplot(Insitu_sp, "Si", etc))
dev.off()

and edit (move legends etc) in Incscape or some other post editing software. 
That would be the fastest way to do this (and not trying to get a different 
legend for each plot). One of the good things about lattice is that it makes 
graphs comparable.

Best wishes
Torleif


On Thursday 17 December 2009 10:43:09 servet ahmet ?izmeli wrote:
> Wow this list is awesome. I have been in lists for a longtime but never saw
>  such a good intentioned support in any other place.
> 
> Thanks Torleif and everyone else for taking time and producing code for me.
> 
> Torleif's code creates maps that are close to what I seek to reproduce. 
>  The normalization performed in the code creates a visually nice look but
>  it unfortunately eliminates the absolute measurement units that I need to
>  convey in the maps.
> 
> So the only thing that is left to achieve here is to produce different dot
>  sizes (and accordingly different keys) for each panel. I am right now
>  actively looking in this direction. Earlier in the thread, Edzer had said
>  I could achieve this using using xyplot but Roger had replied it is not
>  possible so I am a bit perplex now. I am experimenting this with a call to
>  sp.points via sp.layout but no luck so far :
> 
> pts <- list("sp.points", Insitu_sp, pch = 4, col = "red")
> my.layout <- list(pts)
> spplot(Insitu_sp, dataset, pch = 16,
>          sp.layout = my.layout)
> 
> Do you people think there is a way to achieve this using either of spplot
>  or xyplot? If the answer is no, I'll have to stick to bubble() and
>  populate the different panels manually.
> 


From pslarson2 at gmail.com  Thu Dec 17 13:38:15 2009
From: pslarson2 at gmail.com (Pete Larson)
Date: Thu, 17 Dec 2009 07:38:15 -0500
Subject: [R-sig-Geo] create nb object
In-Reply-To: <alpine.LRH.2.00.0912170905260.17211@reclus.nhh.no>
References: <FD872DE1-8372-4931-A626-A8376FF13612@ilstu.edu>
	<d8ad40b50912090906r54d5a529m9343e721371eefde@mail.gmail.com>
	<4B1FEA85.4060300@nceas.ucsb.edu>
	<d8ad40b50912091033g75f5832es9fb7419697308225@mail.gmail.com>
	<FF215884-17BF-4457-A1B7-12837ED2E4D1@ilstu.edu>
	<522664f80912161107v25e70f9euc178a5f3167328e3@mail.gmail.com>
	<4B295A25.9060002@cornell.edu>
	<94730b8a0912161441y32e4122erdf037f979be83ee5@mail.gmail.com>
	<4B297CC1.2090306@gmail.com> <4B2993A1.4080704@gmail.com>
	<alpine.LRH.2.00.0912170905260.17211@reclus.nhh.no>
Message-ID: <4B2A2637.4050203@gmail.com>

Roger,

OK, I did what you indicated here:

xy<-coordinates(fish)
test<-knn2nb(knearneigh(xy))

with a summary:
summary(test)
Neighbour list object:
Number of regions: 341
Number of nonzero links: 341
Percentage nonzero weights: 0.2932551
Average number of links: 1
Non-symmetric neighbours list

Then I want to run a spatial regression like this:

spautolm(N.fish.spp ~ TEMPannual + Elevation, data=fish, 
family="SAR",listw=test, method="Matrix")

and I get this error:

Error in spautolm(N.fish.spp ~ TEMPannual + Elevation, data = fish, 
family = "SAR",  :
  No neighbourhood list

I thought that the "test" object WAS a neighborhood list?

Any help would be appreciated.

Pete



Roger Bivand wrote:
> On Wed, 16 Dec 2009, Pete Larson wrote:
>
>> Hello all,
>>
>> I have a data frame with lat and lon coordinates for some sample 
>> areas (not a grid) .
>>
>> I was to create an nb object that I can use with spdep but am unsure 
>> as to how to convert it.
>>
>> Does anybody have any ideas?
>
> Create a matrix of coordinates, if not using sp classes, for example:
>
> xy <- cbind(df$x, df$y)
>
> or if your data frame is a SpatialPointsDataFrame, just:
>
> xy <- coordinates(obj)
>
> Then your choice of dnearneigh(), knn2nb(knearneigh()), graph2nb() 
> with three graph variants, tri2nb() for a Delaunay triangulation. The 
> first two of these also take a longlat= argument in case your 
> coordinates are geographical, not projected. Triangulation and 
> graph-based methods need planar coordinates, so you would have to 
> project them first.
>
> Hope this helps,
>
> Roger
>
>>
>> Thanks,
>>
>>
>> Pete
>>>
>>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>


From Roger.Bivand at nhh.no  Thu Dec 17 13:45:36 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 17 Dec 2009 13:45:36 +0100 (CET)
Subject: [R-sig-Geo] create nb object
In-Reply-To: <4B2A2637.4050203@gmail.com>
References: <FD872DE1-8372-4931-A626-A8376FF13612@ilstu.edu>
	<d8ad40b50912090906r54d5a529m9343e721371eefde@mail.gmail.com>
	<4B1FEA85.4060300@nceas.ucsb.edu>
	<d8ad40b50912091033g75f5832es9fb7419697308225@mail.gmail.com>
	<FF215884-17BF-4457-A1B7-12837ED2E4D1@ilstu.edu>
	<522664f80912161107v25e70f9euc178a5f3167328e3@mail.gmail.com>
	<4B295A25.9060002@cornell.edu>
	<94730b8a0912161441y32e4122erdf037f979be83ee5@mail.gmail.com>
	<4B297CC1.2090306@gmail.com> <4B2993A1.4080704@gmail.com>
	<alpine.LRH.2.00.0912170905260.17211@reclus.nhh.no>
	<4B2A2637.4050203@gmail.com>
Message-ID: <alpine.LRH.2.00.0912171339300.17211@reclus.nhh.no>

On Thu, 17 Dec 2009, Pete Larson wrote:

> Roger,
>
> OK, I did what you indicated here:
>
> xy<-coordinates(fish)
> test<-knn2nb(knearneigh(xy))
>
> with a summary:
> summary(test)
> Neighbour list object:
> Number of regions: 341
> Number of nonzero links: 341
> Percentage nonzero weights: 0.2932551
> Average number of links: 1
> Non-symmetric neighbours list
>
> Then I want to run a spatial regression like this:
>
> spautolm(N.fish.spp ~ TEMPannual + Elevation, data=fish, 
> family="SAR",listw=test, method="Matrix")
>
> and I get this error:
>
> Error in spautolm(N.fish.spp ~ TEMPannual + Elevation, data = fish, family = 
> "SAR",  :
> No neighbourhood list
>
> I thought that the "test" object WAS a neighborhood list?

class(test)
?nb2listw

Neighbourhood "nb" just says that there is a link, not the weight to put 
on it. Use nb2listw() to make the weights "listw" object, after 
considering the options available. If the actual process doesn't match 
your guess, you may not be able to model it adequately. Is the choice of 
first nearest neighbour considered, as you see, the neighbour 
relationships are not symmetric? Are your points in geographical or 
projected coordinates - it does make a difference? Marine fish data are 
often in geographical coordinates (so use longlat=TRUE), but yours are 
fresh-water?

Roger

>
> Any help would be appreciated.
>
> Pete
>
>
>
> Roger Bivand wrote:
>> On Wed, 16 Dec 2009, Pete Larson wrote:
>> 
>>> Hello all,
>>> 
>>> I have a data frame with lat and lon coordinates for some sample areas 
>>> (not a grid) .
>>> 
>>> I was to create an nb object that I can use with spdep but am unsure as to 
>>> how to convert it.
>>> 
>>> Does anybody have any ideas?
>> 
>> Create a matrix of coordinates, if not using sp classes, for example:
>> 
>> xy <- cbind(df$x, df$y)
>> 
>> or if your data frame is a SpatialPointsDataFrame, just:
>> 
>> xy <- coordinates(obj)
>> 
>> Then your choice of dnearneigh(), knn2nb(knearneigh()), graph2nb() with 
>> three graph variants, tri2nb() for a Delaunay triangulation. The first two 
>> of these also take a longlat= argument in case your coordinates are 
>> geographical, not projected. Triangulation and graph-based methods need 
>> planar coordinates, so you would have to project them first.
>> 
>> Hope this helps,
>> 
>> Roger
>> 
>>> 
>>> Thanks,
>>> 
>>> 
>>> Pete
>>>> 
>>>> 
>>> 
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>> 
>> 
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From renaud.lancelot at cirad.fr  Thu Dec 17 18:47:05 2009
From: renaud.lancelot at cirad.fr (Renaud Lancelot)
Date: Thu, 17 Dec 2009 18:47:05 +0100
Subject: [R-sig-Geo] How to crop a shapefile ?
In-Reply-To: <13b8559c0912170207i7084ec4cj86d634d8678bd786@mail.gmail.com>
References: <13b8559c0912170207i7084ec4cj86d634d8678bd786@mail.gmail.com>
Message-ID: <4B2A6E99.1050605@cirad.fr>

Hi Baptiste,

I recently met a similar issue, and ended to the solution described here 
(unfortunately, it's in French :-)): 
ftp://ftp.cirad.fr/pub/group-r/groupe-r/Fiches/Foret.pdf

It uses point.in.polygon (package sp), and it is adapted to the special 
case of the shapefile containing polygons. Perhaps you can adapt it for 
polylines, possibly reversing the test (points of the lines falling into 
the area of interest for you).

I would be interested to hear about any alternative / better solution.

All the best,

Renaud

Baptiste Coulmont a ?crit :
> Hi,
> 
> I'm working with R and various shapefiles created by the OpenStreetMap
> project. Those shapefiles (the roads in particular) are quite big.
> 
> How can I crop (or "trim", or "prune" those objects -- once in a
> SpatialLineDataFrame -- if I need to work not on a national level but
> on a municipal level ?
> 
> Is it possible to create a subset of a smaller zone ?
> Coordinates:
>          min       max
> r1  2.560776  6.403847
> r2 49.493613 51.505419
> 
> Thansk,
> B. Coulmont
> 

-- 
Renaud Lancelot
EDEN Project, coordinator
http://www.eden-fp6project.net/
<< EDEN International Conference, Montpellier,  10-12 May 2010 >>
<<   http://international-conference2010.eden-fp6project.net/  >>

UMR CIRAD-INRA "Contr?le des maladies animales exotiques et ?mergentes"
Joint research unit "Control of emerging and exotic animal diseases"

CIRAD, Campus International de Baillarguet TA A-DIR / B
F34398 Montpellier
http://www.cirad.fr  http://bluetongue.cirad.fr/

Tel.  +33 4 67 59 37 17  -  Fax  +33 4 67 59 37 95
Secr. +33 4 67 59 37 37  - Cell. +33 6 77 52 08 69


From dan.putler at sauder.ubc.ca  Thu Dec 17 19:00:33 2009
From: dan.putler at sauder.ubc.ca (Dan Putler)
Date: Thu, 17 Dec 2009 10:00:33 -0800
Subject: [R-sig-Geo] How to crop a shapefile ?
In-Reply-To: <8876_1261044474_1261044474_13b8559c0912170207i7084ec4cj86d634d8678bd786@mail.gmail.com>
References: <8876_1261044474_1261044474_13b8559c0912170207i7084ec4cj86d634d8678bd786@mail.gmail.com>
Message-ID: <1261072833.6846.36.camel@whitebox>

Hi,

I have used the sp pacakge, along with several other tools, to do
exactly this (although using road network files from other sources). It
can be done entirely within R via sp, and I've written R only code to do
it, but found it very slow (someone else on the list may have an idea as
to how to make this more efficient).

Let me describe the method I use. One question I have is do you want the
road segments to fit within a bounding box, or do you want them to fit
into some other administrative area? If you have a polygon file of the
administrative area, you can use it to crop things even more precisely.

The steps to the approach follow:

1. Extract the the first ("from") and last ("to") point of each polyline
and append these two points to the SpatialLineDataFrame's data frame.
(Note: This is what I find to be slow doing in R via the sp package.
What I use to do this quickly is a C program I wrote using the shapelib
library. My guess is that one of the sp package authors can suggest ways
to speed this up).

2. Test to see whether either of the from or to points of each polyline
are within the bounding box of interest.

3. Create a new SpatialLineDataFrame object based on selecting only
those polylines that meet the bounding box test.

This approach will likely have some road segments that extend beyond the
bounding box, but have one of its endpoints in the bounding box. Most
road network files snap all polylines at intersections, but this is not
true with OSM "ways" (some of which are extremely long). As a result,
some of the "fuzz" polylines may extend well outside the bounding box.
In addition, long ways that run through the bounding box, but neither
begin or end within it, will not be selected.

Dan

On Thu, 2009-12-17 at 11:07 +0100, Baptiste Coulmont wrote:
> Hi,
> 
> I'm working with R and various shapefiles created by the OpenStreetMap
> project. Those shapefiles (the roads in particular) are quite big.
> 
> How can I crop (or "trim", or "prune" those objects -- once in a
> SpatialLineDataFrame -- if I need to work not on a national level but
> on a municipal level ?
> 
> Is it possible to create a subset of a smaller zone ?
> Coordinates:
>          min       max
> r1  2.560776  6.403847
> r2 49.493613 51.505419
> 
> Thansk,
> B. Coulmont
> 
-- 
Dan Putler
Sauder School of Business
University of British Columbia


From debeaudette at ucdavis.edu  Thu Dec 17 19:27:41 2009
From: debeaudette at ucdavis.edu (Dylan Beaudette)
Date: Thu, 17 Dec 2009 10:27:41 -0800
Subject: [R-sig-Geo] How to crop a shapefile ?
In-Reply-To: <1261072833.6846.36.camel@whitebox>
References: <8876_1261044474_1261044474_13b8559c0912170207i7084ec4cj86d634d8678bd786@mail.gmail.com>
	<1261072833.6846.36.camel@whitebox>
Message-ID: <200912171027.41916.dylan.beaudette@gmail.com>

> On Thu, 2009-12-17 at 11:07 +0100, Baptiste Coulmont wrote:
> > Hi,
> >
> > I'm working with R and various shapefiles created by the OpenStreetMap
> > project. Those shapefiles (the roads in particular) are quite big.
> >
> > How can I crop (or "trim", or "prune" those objects -- once in a
> > SpatialLineDataFrame -- if I need to work not on a national level but
> > on a municipal level ?
> >
> > Is it possible to create a subset of a smaller zone ?
> > Coordinates:
> >          min       max
> > r1  2.560776  6.403847
> > r2 49.493613 51.505419
> >
> > Thansk,
> > B. Coulmont

This type of work is most efficiently done in a standard GIS. I would suggest 
installing GRASS GIS or something like that. This is a standard vector 
operation, and should be very fast. For this GRASS approach, see the 
v.overlay command.

Cheers,
Dylan



-- 
Dylan Beaudette
Soil Resource Laboratory
http://casoilresource.lawr.ucdavis.edu/
University of California at Davis
530.754.7341


From Roger.Bivand at nhh.no  Thu Dec 17 19:35:11 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 17 Dec 2009 19:35:11 +0100 (CET)
Subject: [R-sig-Geo] Beta sp release 0.9-53 with C *Polygon* API
Message-ID: <alpine.LRH.2.00.0912171914300.19057@reclus.nhh.no>

Could I ask list participants who maintain packages depending on sp, or 
who use sp in intensive ways with *Polygon* objects to consider trying out 
the forthcoming release:

http://spatial.nhh.no/R/Devel/sp_0.9-53.tar.gz # source
http://spatial.nhh.no/R/Devel/sp_0.9-53.zip # R 2.10.1 Windows binary

and on the r-spatial sourceforge CVS repository.

The changes involve the creation of Polygon, Polygons, and SpatialPolygons 
objects in C rather than R code, and in the exposure of these C functions 
to other packages (less important for now). I see speedups of about four 
times in reading large polygon shapefiles in readOGR() in rgdal, and 
similarly in readShapeSpatial() in maptools (which remains slower), 
because the sp instantiation functions called there also call the C 
functions inside sp.

The next step is to use the C API in maptools, rgdal, and the forthcoming 
rgeos (on R-Forge).

But before releasing, I'd like to ask for reports on changes in behaviour, 
errors, etc., so that they can be addressed before the changes are 
submitted to CRAN.

The changes have been checked against the code in our book and as far as 
diff can tell (from the printed output), things look good. Running R CMD 
check with valgrind is also clean. Despite this, please treat the beta 
with appropriate caution.

Extension to *Line* objects is clearly possible and may follow soon, but 
*Polygon* were the most pressing.

Best wishes,

Roger

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From dan.putler at sauder.ubc.ca  Thu Dec 17 20:17:21 2009
From: dan.putler at sauder.ubc.ca (Dan Putler)
Date: Thu, 17 Dec 2009 11:17:21 -0800
Subject: [R-sig-Geo] How to crop a shapefile ?
In-Reply-To: <2721_1261074422_1261074422_200912171027.41916.dylan.beaudette@gmail.com>
References: <8876_1261044474_1261044474_13b8559c0912170207i7084ec4cj86d634d8678bd786@mail.gmail.com>
	<1261072833.6846.36.camel@whitebox>
	<2721_1261074422_1261074422_200912171027.41916.dylan.beaudette@gmail.com>
Message-ID: <1261077441.6951.11.camel@whitebox>

Hi all,

For this particular problem, Dylan Beaudette is probably exactly right.
However, I ran into problems using similar tools in OpenJump when we
wanted to create a shapefile of a region that we could postal address
geocode against (the way the boundary line segments were clipped was a
problem for the geocoder), which lead me to write tools in R to do it
(outlined in my earlier post). That code does not clip lines, rather it
enable the extraction of the original complete road segments. Since most
of the ways in OSM don't have the attribute information needed for
geocoding, the issue I was addressing won't be relevant here.

Besides GRASS (which can be a bit overwhelming at first), and OpenJump
(mentioned above), the Clip tool within the fTools plug-in for QGIS
should also work. Given the size of the OSM road network files, a
machine with a fair amount of memory will probably be needed to handle
the problem.

Dan

On Thu, 2009-12-17 at 10:27 -0800, Dylan Beaudette wrote: 
> > On Thu, 2009-12-17 at 11:07 +0100, Baptiste Coulmont wrote:
> > > Hi,
> > >
> > > I'm working with R and various shapefiles created by the OpenStreetMap
> > > project. Those shapefiles (the roads in particular) are quite big.
> > >
> > > How can I crop (or "trim", or "prune" those objects -- once in a
> > > SpatialLineDataFrame -- if I need to work not on a national level but
> > > on a municipal level ?
> > >
> > > Is it possible to create a subset of a smaller zone ?
> > > Coordinates:
> > >          min       max
> > > r1  2.560776  6.403847
> > > r2 49.493613 51.505419
> > >
> > > Thansk,
> > > B. Coulmont
> 
> This type of work is most efficiently done in a standard GIS. I would suggest 
> installing GRASS GIS or something like that. This is a standard vector 
> operation, and should be very fast. For this GRASS approach, see the 
> v.overlay command.
> 
> Cheers,
> Dylan
> 
> 
> 
-- 
Dan Putler
Sauder School of Business
University of British Columbia


From Roger.Bivand at nhh.no  Thu Dec 17 20:47:02 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 17 Dec 2009 20:47:02 +0100 (CET)
Subject: [R-sig-Geo] How to crop a shapefile ?
In-Reply-To: <1261077441.6951.11.camel@whitebox>
References: <8876_1261044474_1261044474_13b8559c0912170207i7084ec4cj86d634d8678bd786@mail.gmail.com>
	<1261072833.6846.36.camel@whitebox>
	<2721_1261074422_1261074422_200912171027.41916.dylan.beaudette@gmail.com>
	<1261077441.6951.11.camel@whitebox>
Message-ID: <alpine.LRH.2.00.0912172037130.19057@reclus.nhh.no>

On Thu, 17 Dec 2009, Dan Putler wrote:

> Hi all,
>
> For this particular problem, Dylan Beaudette is probably exactly right.
> However, I ran into problems using similar tools in OpenJump when we
> wanted to create a shapefile of a region that we could postal address
> geocode against (the way the boundary line segments were clipped was a
> problem for the geocoder), which lead me to write tools in R to do it
> (outlined in my earlier post). That code does not clip lines, rather it
> enable the extraction of the original complete road segments. Since most
> of the ways in OSM don't have the attribute information needed for
> geocoding, the issue I was addressing won't be relevant here.
>
> Besides GRASS (which can be a bit overwhelming at first), and OpenJump
> (mentioned above), the Clip tool within the fTools plug-in for QGIS
> should also work. Given the size of the OSM road network files, a
> machine with a fair amount of memory will probably be needed to handle
> the problem.

It also looks as though the clipping capabilities of ogr2ogr will increase 
when GDAL 1.7.0 arrives - the beta is already available:

http://www.gdal.org/ogr2ogr.html
http://download.osgeo.org/gdal/gdal-1.7.0b1.tar.gz

In addition, something like this might be a candidate for rgeos (on 
R-Forge) but would involve C coding in the GEOS C API.

Roger

>
> Dan
>
> On Thu, 2009-12-17 at 10:27 -0800, Dylan Beaudette wrote:
>>> On Thu, 2009-12-17 at 11:07 +0100, Baptiste Coulmont wrote:
>>>> Hi,
>>>>
>>>> I'm working with R and various shapefiles created by the OpenStreetMap
>>>> project. Those shapefiles (the roads in particular) are quite big.
>>>>
>>>> How can I crop (or "trim", or "prune" those objects -- once in a
>>>> SpatialLineDataFrame -- if I need to work not on a national level but
>>>> on a municipal level ?
>>>>
>>>> Is it possible to create a subset of a smaller zone ?
>>>> Coordinates:
>>>>          min       max
>>>> r1  2.560776  6.403847
>>>> r2 49.493613 51.505419
>>>>
>>>> Thansk,
>>>> B. Coulmont
>>
>> This type of work is most efficiently done in a standard GIS. I would suggest
>> installing GRASS GIS or something like that. This is a standard vector
>> operation, and should be very fast. For this GRASS approach, see the
>> v.overlay command.
>>
>> Cheers,
>> Dylan
>>
>>
>>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From maarten at vstrien.nl  Thu Dec 17 22:06:17 2009
From: maarten at vstrien.nl (Maarten van Strien)
Date: Thu, 17 Dec 2009 13:06:17 -0800 (PST)
Subject: [R-sig-Geo] RPyGeo Query -- probably easy
In-Reply-To: <49CBEB4F.4060905@zevross.com>
References: <49CBEB4F.4060905@zevross.com>
Message-ID: <1261083977117-4183466.post@n2.nabble.com>


Hi All,

I was wondering if anyone has found a solution to the mentioned problem, as
I have a similar problem with a query function in RPyGeo. 
I am trying to use the 'select_analysis' ArcGIS function that uses an sql
expression to select certain values/names from a field in an attribute
table. This is what the ArcGIS help mentions about the Python code for this
function:

# For shapefile expression, fields are double quoted (") and text values are
single quoted (')
gp.select_analysis("nfroads.shp", "paved.shp", ' "ROAD_CLASS" = \'PAVED\' ')

To create this Python output I type the following in R:

> rpygeo.geoprocessor("select_analysis", c("nfroads.shp", "paved.shp", '
> "ROAD_CLASS" = \'PAVED\' '), py.file= "rpygeo.py", working.directory =
> wrkspc, env = myenv, clean.up = FALSE)

However, the rpygeo.py file that is created contains the following line:

gp.select_analysis( "nfroads.shp", "paved.shp", " "ROAD_CLASS" = 'PAVED' " )

This code doesn't work, because "ROAD_CLASS" = 'PAVED' is surrounded by "
(double quotation marks). The code would work fine if "ROAD_CLASS" = 'PAVED'
would be surrounded by ' (single quotation mark). I have tried this by
manually editing the rpygeo.py file.

My question is if anyone knows how to get RPyGeo to output single quotation
marks (') around the select query? Thank you in advance!

Best, Maarten

-----------
Maarten van Strien
PhD Student
Swiss Federal Institute for Forest, Snow and Landscape Research WSL
Landscape Modelling
Z?rcherstrasse 111
8903 Birmensdorf, Switzerland 
-- 
View this message in context: http://n2.nabble.com/RPyGeo-Query-probably-easy-tp2766675p4183466.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From coulmont at gmail.com  Fri Dec 18 09:51:55 2009
From: coulmont at gmail.com (Baptiste Coulmont)
Date: Fri, 18 Dec 2009 09:51:55 +0100
Subject: [R-sig-Geo] How to crop a shapefile ?
In-Reply-To: <alpine.LRH.2.00.0912172037130.19057@reclus.nhh.no>
References: <8876_1261044474_1261044474_13b8559c0912170207i7084ec4cj86d634d8678bd786@mail.gmail.com>
	<1261072833.6846.36.camel@whitebox>
	<2721_1261074422_1261074422_200912171027.41916.dylan.beaudette@gmail.com>
	<1261077441.6951.11.camel@whitebox>
	<alpine.LRH.2.00.0912172037130.19057@reclus.nhh.no>
Message-ID: <13b8559c0912180051o3a98b84fn22508496e737cf2e@mail.gmail.com>

Many thanks to everyone !

On Thu, Dec 17, 2009 at 8:47 PM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
> On Thu, 17 Dec 2009, Dan Putler wrote:
>
>> Hi all,
>>
>> For this particular problem, Dylan Beaudette is probably exactly right.
>> However, I ran into problems using similar tools in OpenJump when we
>> wanted to create a shapefile of a region that we could postal address
>> geocode against (the way the boundary line segments were clipped was a
>> problem for the geocoder), which lead me to write tools in R to do it
>> (outlined in my earlier post). That code does not clip lines, rather it
>> enable the extraction of the original complete road segments. Since most
>> of the ways in OSM don't have the attribute information needed for
>> geocoding, the issue I was addressing won't be relevant here.
>>
>> Besides GRASS (which can be a bit overwhelming at first), and OpenJump
>> (mentioned above), the Clip tool within the fTools plug-in for QGIS
>> should also work. Given the size of the OSM road network files, a
>> machine with a fair amount of memory will probably be needed to handle
>> the problem.
>
> It also looks as though the clipping capabilities of ogr2ogr will increase
> when GDAL 1.7.0 arrives - the beta is already available:
>
> http://www.gdal.org/ogr2ogr.html
> http://download.osgeo.org/gdal/gdal-1.7.0b1.tar.gz
>
> In addition, something like this might be a candidate for rgeos (on R-Forge)
> but would involve C coding in the GEOS C API.
>
> Roger
>
>>
>> Dan
>>
>> On Thu, 2009-12-17 at 10:27 -0800, Dylan Beaudette wrote:
>>>>
>>>> On Thu, 2009-12-17 at 11:07 +0100, Baptiste Coulmont wrote:
>>>>>
>>>>> Hi,
>>>>>
>>>>> I'm working with R and various shapefiles created by the OpenStreetMap
>>>>> project. Those shapefiles (the roads in particular) are quite big.
>>>>>
>>>>> How can I crop (or "trim", or "prune" those objects -- once in a
>>>>> SpatialLineDataFrame -- if I need to work not on a national level but
>>>>> on a municipal level ?
>>>>>
>>>>> Is it possible to create a subset of a smaller zone ?
>>>>> Coordinates:
>>>>> ? ? ? ? min ? ? ? max
>>>>> r1 ?2.560776 ?6.403847
>>>>> r2 49.493613 51.505419
>>>>>
>>>>> Thansk,
>>>>> B. Coulmont
>>>
>>> This type of work is most efficiently done in a standard GIS. I would
>>> suggest
>>> installing GRASS GIS or something like that. This is a standard vector
>>> operation, and should be very fast. For this GRASS approach, see the
>>> v.overlay command.
>>>
>>> Cheers,
>>> Dylan
>>>
>>>
>>>
>>
>
> --
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>
>



-- 
Baptiste   Coulmont
http://coulmont.com


From a.crowe at lancaster.ac.uk  Fri Dec 18 10:59:53 2009
From: a.crowe at lancaster.ac.uk (Crowe, Andrew)
Date: Fri, 18 Dec 2009 09:59:53 -0000
Subject: [R-sig-Geo] RPyGeo Query -- probably easy
References: <49CBEB4F.4060905@zevross.com>
	<1261083977117-4183466.post@n2.nabble.com>
Message-ID: <BB501CE635E5144CA5E30956E5E32C5201A6F7CB@exchange-be5.lancs.local>

Maarten
 
I'm not sure about the single quotes but possibly you could add an extra special character break (the \ ) to indicate to python that the double quotes surrounding your field name are not the end of a string.  You could try the following code:
 
rpygeo.geoprocessor("select_analysis", c("nfroads.shp", "paved.shp", '
\\"ROAD_CLASS\\" = \'PAVED\' '), py.file= "rpygeo.py", working.directory =
 wrkspc, env = myenv, clean.up = FALSE)

 
Best Regards
 
Andrew
 
Dr Andrew Crowe
 
Lancaster Environment Centre
Lancaster University
Lancaster    LA1 4YQ
UK

________________________________

From: r-sig-geo-bounces at stat.math.ethz.ch on behalf of Maarten van Strien
Sent: Thu 17/12/2009 9:06 PM
To: r-sig-geo at stat.math.ethz.ch
Subject: Re: [R-sig-Geo] RPyGeo Query -- probably easy




Hi All,

I was wondering if anyone has found a solution to the mentioned problem, as
I have a similar problem with a query function in RPyGeo.
I am trying to use the 'select_analysis' ArcGIS function that uses an sql
expression to select certain values/names from a field in an attribute
table. This is what the ArcGIS help mentions about the Python code for this
function:

# For shapefile expression, fields are double quoted (") and text values are
single quoted (')
gp.select_analysis("nfroads.shp", "paved.shp", ' "ROAD_CLASS" = \'PAVED\' ')

To create this Python output I type the following in R:

> rpygeo.geoprocessor("select_analysis", c("nfroads.shp", "paved.shp", '
> "ROAD_CLASS" = \'PAVED\' '), py.file= "rpygeo.py", working.directory =
> wrkspc, env = myenv, clean.up = FALSE)

However, the rpygeo.py file that is created contains the following line:

gp.select_analysis( "nfroads.shp", "paved.shp", " "ROAD_CLASS" = 'PAVED' " )

This code doesn't work, because "ROAD_CLASS" = 'PAVED' is surrounded by "
(double quotation marks). The code would work fine if "ROAD_CLASS" = 'PAVED'
would be surrounded by ' (single quotation mark). I have tried this by
manually editing the rpygeo.py file.

My question is if anyone knows how to get RPyGeo to output single quotation
marks (') around the select query? Thank you in advance!

Best, Maarten

-----------
Maarten van Strien
PhD Student
Swiss Federal Institute for Forest, Snow and Landscape Research WSL
Landscape Modelling
Z?rcherstrasse 111
8903 Birmensdorf, Switzerland
--
View this message in context: http://n2.nabble.com/RPyGeo-Query-probably-easy-tp2766675p4183466.html
Sent from the R-sig-geo mailing list archive at Nabble.com.

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at stat.math.ethz.ch
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From maarten at vstrien.nl  Fri Dec 18 11:16:16 2009
From: maarten at vstrien.nl (Maarten van Strien)
Date: Fri, 18 Dec 2009 02:16:16 -0800 (PST)
Subject: [R-sig-Geo] RPyGeo Query -- probably easy
In-Reply-To: <BB501CE635E5144CA5E30956E5E32C5201A6F7CB@exchange-be5.lancs.local>
References: <49CBEB4F.4060905@zevross.com>
	<1261083977117-4183466.post@n2.nabble.com>
	<BB501CE635E5144CA5E30956E5E32C5201A6F7CB@exchange-be5.lancs.local>
Message-ID: <1261131376671-4185819.post@n2.nabble.com>


Andrew, thanks for your reply!
I tried exactly your command, but still the resulting rpygeo.py file
contains the following line:

gp.select_analysis( "nfroads.shp", "paved.shp", "\"ROAD_CLASS\" = 'PAVED' "
)

So the \"ROAD_CLASS\" = 'PAVED' is still surrounded by double quotes ("). I
have tried many different Python commands, but the only one working for me
is:

gp.select_analysis( "nfroads.shp", "paved.shp", ' "ROAD_CLASS" = \'PAVED\' '
)

Somehow I need to instruct RPyGeo to leave away the double quotes and
replace them by single quotes.

Kind regards, Maarten



Maarten
 
I'm not sure about the single quotes but possibly you could add an extra
special character break (the \ ) to indicate to python that the double
quotes surrounding your field name are not the end of a string.  You could
try the following code:
 
rpygeo.geoprocessor("select_analysis", c("nfroads.shp", "paved.shp", '
\\"ROAD_CLASS\\" = \'PAVED\' '), py.file= "rpygeo.py", working.directory =
 wrkspc, env = myenv, clean.up = FALSE)

 
Best Regards
 
Andrew
 
Dr Andrew Crowe
 
Lancaster Environment Centre
Lancaster University
Lancaster    LA1 4YQ
UK
-- 
View this message in context: http://n2.nabble.com/RPyGeo-Query-probably-easy-tp2766675p4185819.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From Thierry.ONKELINX at inbo.be  Fri Dec 18 11:53:03 2009
From: Thierry.ONKELINX at inbo.be (ONKELINX, Thierry)
Date: Fri, 18 Dec 2009 11:53:03 +0100
Subject: [R-sig-Geo] Spatial categories for risk data.
In-Reply-To: <82AC92D8044F584AA54B76B8A3DBD2D20A877705@hoex02.AMICA.COM>
References: <82AC92D8044F584AA54B76B8A3DBD2D20A877705@hoex02.AMICA.COM>
Message-ID: <2E9C414912813E4EB981326983E0A10406E48DD9@inboexch.inbo.be>

Dear Arthur,

I have not seen any responses, therefore I will have a go.

I would start to interpolate the continuous risk score using kriging
(e.g. krige in the gstat package). This will give you a continuous map.
Then you could categorise that map. Kriging requires that you have only
one value per location. In case of overlapping persons you could move
then slightly in a random fashion.

Kriging will not guarantee that the lines are somewhat straight. If you
insist on that, then I would rather use a linear model on the risk score
usin the coordinates as covariates.
 
HTH,

Thierry

------------------------------------------------------------------------
----
ir. Thierry Onkelinx
Instituut voor natuur- en bosonderzoek
team Biometrie & Kwaliteitszorg
Gaverstraat 4
9500 Geraardsbergen
Belgium

Research Institute for Nature and Forest
team Biometrics & Quality Assurance
Gaverstraat 4
9500 Geraardsbergen
Belgium

tel. + 32 54/436 185
Thierry.Onkelinx at inbo.be
www.inbo.be

To call in the statistician after the experiment is done may be no more
than asking him to perform a post-mortem examination: he may be able to
say what the experiment died of.
~ Sir Ronald Aylmer Fisher

The plural of anecdote is not data.
~ Roger Brinner

The combination of some data and an aching desire for an answer does not
ensure that a reasonable answer can be extracted from a given body of
data.
~ John Tukey

-----Oorspronkelijk bericht-----
Van: r-sig-geo-bounces at stat.math.ethz.ch
[mailto:r-sig-geo-bounces at stat.math.ethz.ch] Namens HINTERMEISTER,
ARTHUR W. (Artie)
Verzonden: donderdag 10 december 2009 17:08
Aan: r-sig-geo at stat.math.ethz.ch
Onderwerp: [R-sig-Geo] Spatial categories for risk data.

Hello,



I currently have a map that looks something like this:



-----------------------------------------

|   x           x    o   x    o     x   |

|  x     x         x       x     a o  a |

|      a       x       o      o    x    |

|  x      x       o      o     o     a  |

|  x  x      x      o       a   o   a  o|

|  x     x     o   x  o   x   a  a    a |

| x   x    o      o     a   a      a    |

-----------------------------------------

    

x = low risk

o = moderate risk

a = high risk



Each letter represents a person, and the entire map represents a state.
Each person's "risk score" is a continuous numeric value, but I have
categorized it into low, moderate, and high for visual simplicity. What
I'm hoping to do is draw lines that will divide out the categories. The
lines do not have to necessarily be straight, but I would like them to
be simple enough. I figure that I would have to account for any
overlapping or outlying persons. This is my initial idea of how the map
would turn out:



-----------------------------------------

|                  /             /      |

|                 /             /       |

|      x         /     o       /    a   |

|               /             /         |

|              /             /          |

|             /             /           |

|            /             /            |

-----------------------------------------    



I have downloaded and installed GRASS and R, but I am not sure what type
of spatial method or analysis to use. Could someone please offer me
advice on how to get started with this project? Thanks so much!





------------------------------------------------------

Arthur Hintermeister

ahintermeister at amica.com <mailto:ahintermeister at amica.com> 






	[[alternative HTML version deleted]]

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at stat.math.ethz.ch
https://stat.ethz.ch/mailman/listinfo/r-sig-geo

Druk dit bericht a.u.b. niet onnodig af.
Please do not print this message unnecessarily.

Dit bericht en eventuele bijlagen geven enkel de visie van de schrijver weer 
en binden het INBO onder geen enkel beding, zolang dit bericht niet bevestigd is
door een geldig ondertekend document. The views expressed in  this message 
and any annex are purely those of the writer and may not be regarded as stating 
an official position of INBO, as long as the message is not confirmed by a duly 
signed document.


From zua3 at cornell.edu  Fri Dec 18 17:00:51 2009
From: zua3 at cornell.edu (Zia Ahmed)
Date: Fri, 18 Dec 2009 11:00:51 -0500
Subject: [R-sig-Geo] Risk mapping: Parametric vs Non-Parametric Conditional
 Simulation approaches?
In-Reply-To: <d8ad40b50912101241q3d126345pfc39f65df886359c@mail.gmail.com>
References: <a835c81e0912101217o4e5cf0aax616cfe69ea72e6b5@mail.gmail.com>
	<d8ad40b50912101241q3d126345pfc39f65df886359c@mail.gmail.com>
Message-ID: <4B2BA733.8070606@cornell.edu>

Hi,
I like to compare  areas not exceeding of  particular threshold values 
between parametric and non-parametric approaches of 1000 realizations. 
For non-parametric approach, I did IK for 1000 realizations (conditional 
simulation) and  calculated the area not exceeding (0.5 probability) of 
the threshold value for each of 1000 realizations.  Now,  I want to 
compare these areas with areas calculated from parametric approach.  For 
this,   I  did  OK  conditional simulation  of 1000 realizations. My 
question is: Is it possible to  create probability maps not exceeding a 
threshold value of  each of 1000 realizations. I know, I need variance 
of each prediction location of each realization to get the probability. 
Please  consider my  limited knowledge about theory of geostatistics.   
Any suggestion will be appreciated.  

Thanks

Zia
-------------- next part --------------
A non-text attachment was scrubbed...
Name: zua3.vcf
Type: text/x-vcard
Size: 281 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20091218/42b3076b/attachment.vcf>

From brenning at uwaterloo.ca  Fri Dec 18 19:45:38 2009
From: brenning at uwaterloo.ca (Alexander Brenning)
Date: Fri, 18 Dec 2009 13:45:38 -0500
Subject: [R-sig-Geo] RPyGeo Query -- probably easy
In-Reply-To: <1261131376671-4185819.post@n2.nabble.com>
References: <49CBEB4F.4060905@zevross.com>	<1261083977117-4183466.post@n2.nabble.com>	<BB501CE635E5144CA5E30956E5E32C5201A6F7CB@exchange-be5.lancs.local>
	<1261131376671-4185819.post@n2.nabble.com>
Message-ID: <4B2BCDD2.2020706@uwaterloo.ca>

Hi,

yes, the quotes are indeed tricky... The challenge is to provide the 
correct mix of escaped and un-escaped single and double quotes to Python 
/ ArcGIS as in this Python example:

gp.select_analysis("nfroads.shp", "paved.shp",
     ' "ROAD_CLASS" = \'PAVED\' ')

In order to achieve this, the backslashes in \' have to be escaped 
themselves, otherwise R will interpret them as escape symbols. After 
all, \' ends up being coded as \\\' in R. Also, double double-quotes 
have to be avoided; the quote.args argument of rpygeo.geoprocessor can 
be used to suppress the outermost double quotes, single quotes can be 
used explicitly instead: " ' sqlquery ' "

So here are two solutions:


env = rpygeo.build.env( workspace = "C:/TEMP",
               overwriteoutput = TRUE )

rpygeo.geoprocessor("select_analysis",
     list( "nfroads.shp", "paved.shp",
           " ' \"ROAD_CLASS\" = \\\'PAVED\\\' ' "),
     clean.up = FALSE, quote.args = c(T,T,F),
     env = env)


# alternative:

rpygeo.geoprocessor("select_analysis('nfroads.shp','paved.shp','\"ROAD_CLASS\"=\\\'PAVED\\\'')",
      env = env, clean.up = FALSE)


I hope this helps...

Cheers
  Alex



Maarten van Strien wrote:
> Andrew, thanks for your reply!
> I tried exactly your command, but still the resulting rpygeo.py file
> contains the following line:
> 
> gp.select_analysis( "nfroads.shp", "paved.shp", "\"ROAD_CLASS\" = 'PAVED' "
> )
> 
> So the \"ROAD_CLASS\" = 'PAVED' is still surrounded by double quotes ("). I
> have tried many different Python commands, but the only one working for me
> is:
> 
> gp.select_analysis( "nfroads.shp", "paved.shp", ' "ROAD_CLASS" = \'PAVED\' '
> )
> 
> Somehow I need to instruct RPyGeo to leave away the double quotes and
> replace them by single quotes.
> 
> Kind regards, Maarten
> 
> 
> 
> Maarten
>  
> I'm not sure about the single quotes but possibly you could add an extra
> special character break (the \ ) to indicate to python that the double
> quotes surrounding your field name are not the end of a string.  You could
> try the following code:
>  
> rpygeo.geoprocessor("select_analysis", c("nfroads.shp", "paved.shp", '
> \\"ROAD_CLASS\\" = \'PAVED\' '), py.file= "rpygeo.py", working.directory =
>  wrkspc, env = myenv, clean.up = FALSE)
> 
>  
> Best Regards
>  
> Andrew
>  
> Dr Andrew Crowe
>  
> Lancaster Environment Centre
> Lancaster University
> Lancaster    LA1 4YQ
> UK

-- 
Alexander Brenning
brenning at uwaterloo.ca - T +1-519-888-4567 ext 35783
Department of Geography and Environmental Management
University of Waterloo
200 University Ave. W - Waterloo, ON - Canada N2L 3G1
http://www.fes.uwaterloo.ca/geography/faculty/brenning/


From cubarro at gmail.com  Fri Dec 18 21:05:18 2009
From: cubarro at gmail.com (cubarro at gmail.com)
Date: Fri, 18 Dec 2009 21:05:18 +0100
Subject: [R-sig-Geo] Spatial Variable selection
Message-ID: <30380ccf0912181205t772009abvb13f5ef0c163ebf9@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20091218/63648681/attachment.pl>

From mtb954 at gmail.com  Sun Dec 20 18:21:06 2009
From: mtb954 at gmail.com (Mark Na)
Date: Sun, 20 Dec 2009 11:21:06 -0600
Subject: [R-sig-Geo] How to write R dataframe to shapefile
Message-ID: <e40d78ce0912200921h6c3a3a1bp541ec87ca30e0d34@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20091220/9b9bbd1c/attachment.pl>

From dan.putler at sauder.ubc.ca  Sun Dec 20 19:30:25 2009
From: dan.putler at sauder.ubc.ca (Dan Putler)
Date: Sun, 20 Dec 2009 10:30:25 -0800
Subject: [R-sig-Geo] How to write R dataframe to shapefile
In-Reply-To: <10925_1261329710_1261329710_e40d78ce0912200921h6c3a3a1bp541ec87ca30e0d34@mail.gmail.com>
References: <10925_1261329710_1261329710_e40d78ce0912200921h6c3a3a1bp541ec87ca30e0d34@mail.gmail.com>
Message-ID: <1261333825.6873.10.camel@whitebox>

Hi Mark,

The easy way is a two step process, using the sp and rgdal packages.
Create a SpatialPointsDataFrame using the SpatialPointsDataFrame
function in sp, and then write it out using the writeOGR function in
rgdal. You can get things correct coordinate system by using
CRS("+init=epsg:4979") for the proj4string argument to
SpatialPointsDataFrame, although there are a number of other EPSG codes
that corresponds to WGS84 geographic coordinates.

Dan

On Sun, 2009-12-20 at 11:21 -0600, Mark Na wrote:
> Hello,
> 
> I have an R dataframe with four columns (lat, long, date and time); these
> data were imported from a .gpx and then manipulated. Now, I'd like to write
> these data to a shapefile, using lat and long to specify the spatial
> coordinates and specifying WGS 84 for the geographic coordinate system.
> 
> I'd appreciate any pointers, thank you.
> 
> Mark Na
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
-- 
Dan Putler
Sauder School of Business
University of British Columbia


From maarten at vstrien.nl  Mon Dec 21 12:40:56 2009
From: maarten at vstrien.nl (Maarten van Strien)
Date: Mon, 21 Dec 2009 03:40:56 -0800 (PST)
Subject: [R-sig-Geo] RPyGeo Query -- probably easy
In-Reply-To: <4B2BCDD2.2020706@uwaterloo.ca>
References: <49CBEB4F.4060905@zevross.com>
	<1261083977117-4183466.post@n2.nabble.com>
	<BB501CE635E5144CA5E30956E5E32C5201A6F7CB@exchange-be5.lancs.local>
	<1261131376671-4185819.post@n2.nabble.com>
	<4B2BCDD2.2020706@uwaterloo.ca>
Message-ID: <1261395656037-4197371.post@n2.nabble.com>


Hi,

Thank you Alexander, your solution seems to work!

Best, Maarten



Hi,

yes, the quotes are indeed tricky... The challenge is to provide the 
correct mix of escaped and un-escaped single and double quotes to Python 
/ ArcGIS as in this Python example:

gp.select_analysis("nfroads.shp", "paved.shp",
     ' "ROAD_CLASS" = \'PAVED\' ')

In order to achieve this, the backslashes in \' have to be escaped 
themselves, otherwise R will interpret them as escape symbols. After 
all, \' ends up being coded as \\\' in R. Also, double double-quotes 
have to be avoided; the quote.args argument of rpygeo.geoprocessor can 
be used to suppress the outermost double quotes, single quotes can be 
used explicitly instead: " ' sqlquery ' "

So here are two solutions:


env = rpygeo.build.env( workspace = "C:/TEMP",
               overwriteoutput = TRUE )

rpygeo.geoprocessor("select_analysis",
     list( "nfroads.shp", "paved.shp",
           " ' \"ROAD_CLASS\" = \\\'PAVED\\\' ' "),
     clean.up = FALSE, quote.args = c(T,T,F),
     env = env)


# alternative:

rpygeo.geoprocessor("select_analysis('nfroads.shp','paved.shp','\"ROAD_CLASS\"=\\\'PAVED\\\'')",
      env = env, clean.up = FALSE)


I hope this helps...

Cheers
  Alex
-- 
View this message in context: http://n2.nabble.com/RPyGeo-Query-probably-easy-tp2766675p4197371.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From Roger.Bivand at nhh.no  Mon Dec 21 13:53:11 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 21 Dec 2009 13:53:11 +0100 (CET)
Subject: [R-sig-Geo] Rshhs() import problem
In-Reply-To: <alpine.LRH.2.00.0912091955160.892@reclus.nhh.no>
References: <15789f2d0912090550l2d910e68h8d62ff559bf81fff@mail.gmail.com>
	<alpine.LRH.2.00.0912091955160.892@reclus.nhh.no>
Message-ID: <alpine.LRH.2.00.0912211351330.19546@reclus.nhh.no>

On Wed, 9 Dec 2009, Roger Bivand wrote:

> On Wed, 9 Dec 2009, Maik Renner wrote:
>
>> Dear R-Geographers,
>> 
>> I am trying to use the GSHHS shoreline data for annotating my maps.
>> I used Rgshhs() from the package maptools to import it into R as a
>> Spatial object.
>> However it seems that there is a problem due to the new version of
>> gshhs_2.0.zip.
>> In the help gshhs_1.11.zip is referred.
>> 
>> Here is my example:
>>
>>>      NZx <- c(160,180)
>>>      NZy <- c(-50,-30)
>>> NZ <- Rgshhs("gshhs_c.b", xlim=NZx, ylim=NZy)
>> Error in Rgshhs("gshhs_c.b",  :
>>  Data not same version as software
>> 
>> Is this a bug in Rshhs() or do I need some external librarys?
>
> Please use gshhs_1.11.zip until an update can be made. Maybe gshhs_1.12.zip 
> will also work, but 2.0 will not, as the C struct definition has been 
> changed.

maptools_0.7-29.tar.gz has been submitted to CRAN, and includes support 
for GSHHS 2.0 with the new headers - support for earlier formats has been 
dropped.

Roger


>
> Roger
>
>> 
>> Any suggestions welcome.
>> 
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From alexandre.villers at cebc.cnrs.fr  Mon Dec 21 14:09:58 2009
From: alexandre.villers at cebc.cnrs.fr (Alexandre VILLERS)
Date: Mon, 21 Dec 2009 14:09:58 +0100
Subject: [R-sig-Geo] ecw for rgdal package
Message-ID: <4B2F73A6.2040809@cebc.cnrs.fr>

Good afternoon,

I was wondering if the reading and creating of ecw files was planned for 
the rgdal library. I suppose it is a bit tricky to include this function 
because of the need for the ECW SDK library from ER mapper...

Best regards

Alex

-- 
Alexandre Villers
PhD Candidate
AgriPop
Centre d'Etudes Biologiques de Chiz?-CNRS UPR1934
79360 Beauvoir sur Niort

Phone +33 (0)5 49 09 96 13
Fax   +33 (0)5 49 09 65 26




__________ Information from ESET Mail Security, version of virus signature database 4705 (20091221) __________

The message was checked by ESET Mail Security.
http://www.eset.com


From Roger.Bivand at nhh.no  Mon Dec 21 15:33:22 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 21 Dec 2009 15:33:22 +0100 (CET)
Subject: [R-sig-Geo] ecw for rgdal package
In-Reply-To: <4B2F73A6.2040809@cebc.cnrs.fr>
References: <4B2F73A6.2040809@cebc.cnrs.fr>
Message-ID: <alpine.LRH.2.00.0912211525190.20489@reclus.nhh.no>

On Mon, 21 Dec 2009, Alexandre VILLERS wrote:

> Good afternoon,
>
> I was wondering if the reading and creating of ecw files was planned for the 
> rgdal library. I suppose it is a bit tricky to include this function because 
> of the need for the ECW SDK library from ER mapper...

Correct, we cannot distribute this library from CRAN. If you need this 
driver, you have to provide it yourself, on Windows using the instructions 
for the alternative build approach in:

file.show(system.file("README.windows", package="rgdal"))

You will have to improvise a little, as - for example - building R 
packages from source is easier now than it was in 2007.

Hope this helps,

Roger

>
> Best regards
>
> Alex
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From renaud.lancelot at cirad.fr  Tue Dec 22 10:36:17 2009
From: renaud.lancelot at cirad.fr (Renaud Lancelot)
Date: Tue, 22 Dec 2009 10:36:17 +0100
Subject: [R-sig-Geo] Overlay-ing two grids
In-Reply-To: <alpine.LRH.2.00.0912211525190.20489@reclus.nhh.no>
References: <4B2F73A6.2040809@cebc.cnrs.fr>
	<alpine.LRH.2.00.0912211525190.20489@reclus.nhh.no>
Message-ID: <4B309311.60605@cirad.fr>

Dear all,

I have two "nested" grids (SpatialGridDataFrame) looking like this:

prj <- "+proj=utm +zone=28 +ellps=WGS84 +datum=WGS84 +units=m +no_defs"
gt1 <- GridTopology(c(5, 5), c(10, 10), c(100, 100))
gt2 <- GridTopology(c(50, 50), c(100, 100), c(10, 10))
band1 <- sample(c(0, 1), replace = TRUE, size = 10000)
sgdf1 <- SpatialGridDataFrame(gt1, data.frame(band1), CRS(prj))
sgdf2 <- SpatialGridDataFrame(gt2, data.frame(band1=rep(0, 100)), CRS(prj))
## Graphic display
spplot(sgdf1, scales = list(draw = TRUE),
        panel = function(...){
            panel.gridplot(...)
            sp.grid(sgdf2, col = 0)
            })

I want to compute the mean (and other statistics) of sgdf1 at data$band1 
according to the cells defined in sgdf2. How can I do that ? I tried to 
use overlay, without success:

 > sgdf3 <- overlay(sgdf1, sgdf2, fn = mean)
 > sgdf3 at data$band1
   [1] 1 0 0 0 0 0 1 1 1 0 0 1 0 0 0 0 0 1 1 0 1 0 1 1 0 1 0 0 0 0
  [31] 0 0 1 0 1 1 1 0 0 0 0 0 0 1 0 1 1 0 0 0 1 0 1 0 1 0 1 1 0 0
  [61] 1 1 0 1 1 1 1 0 0 0 1 1 0 0 1 1 1 1 1 1 1 1 1 1 0 0 0 0 0 0
  [91] 1 0 1 1 1 0 1 0 1 0

All the best,

Renaud



-- 
Renaud Lancelot
EDEN Project, coordinator
http://www.eden-fp6project.net/
<< EDEN International Conference, Montpellier,  10-12 May 2010 >>
<<   http://international-conference2010.eden-fp6project.net/  >>

UMR CIRAD-INRA "Contr?le des maladies animales exotiques et ?mergentes"
Joint research unit "Control of emerging and exotic animal diseases"

CIRAD, Campus International de Baillarguet TA A-DIR / B
F34398 Montpellier
http://www.cirad.fr  http://bluetongue.cirad.fr/

Tel.  +33 4 67 59 37 17  -  Fax  +33 4 67 59 37 95
Secr. +33 4 67 59 37 37  - Cell. +33 6 77 52 08 69


From p.hiemstra at geo.uu.nl  Tue Dec 22 10:52:50 2009
From: p.hiemstra at geo.uu.nl (Paul Hiemstra)
Date: Tue, 22 Dec 2009 10:52:50 +0100
Subject: [R-sig-Geo] Overlay-ing two grids
In-Reply-To: <4B309311.60605@cirad.fr>
References: <4B2F73A6.2040809@cebc.cnrs.fr>	<alpine.LRH.2.00.0912211525190.20489@reclus.nhh.no>
	<4B309311.60605@cirad.fr>
Message-ID: <4B3096F2.1070308@geo.uu.nl>

Hi Renaud,

Take a look at the pointsToRaster() function in the raster package.

cheers,
Paul

Renaud Lancelot wrote:
> Dear all,
>
> I have two "nested" grids (SpatialGridDataFrame) looking like this:
>
> prj <- "+proj=utm +zone=28 +ellps=WGS84 +datum=WGS84 +units=m +no_defs"
> gt1 <- GridTopology(c(5, 5), c(10, 10), c(100, 100))
> gt2 <- GridTopology(c(50, 50), c(100, 100), c(10, 10))
> band1 <- sample(c(0, 1), replace = TRUE, size = 10000)
> sgdf1 <- SpatialGridDataFrame(gt1, data.frame(band1), CRS(prj))
> sgdf2 <- SpatialGridDataFrame(gt2, data.frame(band1=rep(0, 100)), 
> CRS(prj))
> ## Graphic display
> spplot(sgdf1, scales = list(draw = TRUE),
>        panel = function(...){
>            panel.gridplot(...)
>            sp.grid(sgdf2, col = 0)
>            })
>
> I want to compute the mean (and other statistics) of sgdf1 at data$band1 
> according to the cells defined in sgdf2. How can I do that ? I tried 
> to use overlay, without success:
>
> > sgdf3 <- overlay(sgdf1, sgdf2, fn = mean)
> > sgdf3 at data$band1
>   [1] 1 0 0 0 0 0 1 1 1 0 0 1 0 0 0 0 0 1 1 0 1 0 1 1 0 1 0 0 0 0
>  [31] 0 0 1 0 1 1 1 0 0 0 0 0 0 1 0 1 1 0 0 0 1 0 1 0 1 0 1 1 0 0
>  [61] 1 1 0 1 1 1 1 0 0 0 1 1 0 0 1 1 1 1 1 1 1 1 1 1 0 0 0 0 0 0
>  [91] 1 0 1 1 1 0 1 0 1 0
>
> All the best,
>
> Renaud
>
>
>


-- 
Drs. Paul Hiemstra
Department of Physical Geography
Faculty of Geosciences
University of Utrecht
Heidelberglaan 2
P.O. Box 80.115
3508 TC Utrecht
Phone:  +3130 274 3113 Mon-Tue
Phone:  +3130 253 5773 Wed-Fri
http://intamap.geo.uu.nl/~paul


From torleif.lunde at cih.uib.no  Tue Dec 22 11:07:51 2009
From: torleif.lunde at cih.uib.no (Torleif Markussen Lunde)
Date: Tue, 22 Dec 2009 11:07:51 +0100
Subject: [R-sig-Geo] Overlay-ing two grids
In-Reply-To: <4B3096F2.1070308@geo.uu.nl>
References: <4B2F73A6.2040809@cebc.cnrs.fr> <4B309311.60605@cirad.fr>
	<4B3096F2.1070308@geo.uu.nl>
Message-ID: <200912221107.51717.torleif.lunde@cih.uib.no>

Hi

I guess you could also try something like:

# First of all
showMethods(overlay)

# Than, one possibility:
ovrl <- overlay(as(sgdf2, "SpatialPixelsDataFrame"), 
		as(sgdf1, "SpatialPointsDataFrame"))

# aggregate by the ovrl index
aggMean <- aggregate(slot(sgdf1, "data"), 
		     by = list(ovrl), 
		     FUN = mean)$band1
# make a new SpatialGridDataFrame:
sgdf3 <- SpatialGridDataFrame(gt2, 
			      data.frame(band1=aggMean), 
			      CRS(prj))

Best wishes
Torleif


On Tuesday 22 December 2009 10:52:50 Paul Hiemstra wrote:
> Hi Renaud,
> 
> Take a look at the pointsToRaster() function in the raster package.
> 
> cheers,
> Paul
> 
> Renaud Lancelot wrote:
> > Dear all,
> >
> > I have two "nested" grids (SpatialGridDataFrame) looking like this:
> >
> > prj <- "+proj=utm +zone=28 +ellps=WGS84 +datum=WGS84 +units=m +no_defs"
> > gt1 <- GridTopology(c(5, 5), c(10, 10), c(100, 100))
> > gt2 <- GridTopology(c(50, 50), c(100, 100), c(10, 10))
> > band1 <- sample(c(0, 1), replace = TRUE, size = 10000)
> > sgdf1 <- SpatialGridDataFrame(gt1, data.frame(band1), CRS(prj))
> > sgdf2 <- SpatialGridDataFrame(gt2, data.frame(band1=rep(0, 100)),
> > CRS(prj))
> > ## Graphic display
> > spplot(sgdf1, scales = list(draw = TRUE),
> >        panel = function(...){
> >            panel.gridplot(...)
> >            sp.grid(sgdf2, col = 0)
> >            })
> >
> > I want to compute the mean (and other statistics) of sgdf1 at data$band1
> > according to the cells defined in sgdf2. How can I do that ? I tried
> >
> > to use overlay, without success:
> > > sgdf3 <- overlay(sgdf1, sgdf2, fn = mean)
> > > sgdf3 at data$band1
> >
> >   [1] 1 0 0 0 0 0 1 1 1 0 0 1 0 0 0 0 0 1 1 0 1 0 1 1 0 1 0 0 0 0
> >  [31] 0 0 1 0 1 1 1 0 0 0 0 0 0 1 0 1 1 0 0 0 1 0 1 0 1 0 1 1 0 0
> >  [61] 1 1 0 1 1 1 1 0 0 0 1 1 0 0 1 1 1 1 1 1 1 1 1 1 0 0 0 0 0 0
> >  [91] 1 0 1 1 1 0 1 0 1 0
> >
> > All the best,
> >
> > Renaud
>


From j.m.signer at gmail.com  Tue Dec 22 12:35:04 2009
From: j.m.signer at gmail.com (Johannes Signer)
Date: Tue, 22 Dec 2009 12:35:04 +0100
Subject: [R-sig-Geo] Intersect polygon with grid
Message-ID: <aa7630000912220335j3c7fe287u8769ef275bd8a262@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20091222/080365dc/attachment.pl>

From p.hiemstra at geo.uu.nl  Tue Dec 22 13:02:18 2009
From: p.hiemstra at geo.uu.nl (Paul Hiemstra)
Date: Tue, 22 Dec 2009 13:02:18 +0100
Subject: [R-sig-Geo] Intersect polygon with grid
In-Reply-To: <aa7630000912220335j3c7fe287u8769ef275bd8a262@mail.gmail.com>
References: <aa7630000912220335j3c7fe287u8769ef275bd8a262@mail.gmail.com>
Message-ID: <4B30B54A.8080308@geo.uu.nl>

Hi,

A simple approach would be the following:

1. Create a point dataset that comprises of the center points of the grid
2. Overlay the pointset with the polygon set using the overlay() command
3. Convert the pointset into a grid using the gridded() command

A problem could be that if your polygons are small in regard to the 
gridsize, only the center point of the gridcell determines the value of 
the gridcell. It does not look at how much area from several polygons is 
in a gridcell, and creating a weigted average by area. You could remedy 
this by making the pointset much denser, doing step 1-3 and then 
aggregating the dense grid into a coarser grid, calculating for example 
the mean. This can be done using the pointsToRaster() function from the 
raster package.

cheers,
Paul

Johannes Signer wrote:
> Dear List,
>
> I am trying to do the following:
> I have a shapefile, that I want to overlay with a raster and then assign
> each raster cell a value that represents the percentage covered by the shape
> file. I have found a way to do that with small data sets, but I am
> struggling with large datasets (1mio+ cells).
>
> My approach so far is:
>
> 1.) Create rectangular polygons (covering the whole area), that will be used
> for the grid afterwards.
> 2.) Intersect the each polygon with the shapefile and calculate the area.
> 3.) Create a grid from the rectangular polygons.
>
> Any suggestions are very welcome!
>
> Thanks in advance
>
> Johannes
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>   


-- 
Drs. Paul Hiemstra
Department of Physical Geography
Faculty of Geosciences
University of Utrecht
Heidelberglaan 2
P.O. Box 80.115
3508 TC Utrecht
Phone:  +3130 274 3113 Mon-Tue
Phone:  +3130 253 5773 Wed-Fri
http://intamap.geo.uu.nl/~paul


From r.hijmans at gmail.com  Tue Dec 22 19:47:51 2009
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Tue, 22 Dec 2009 10:47:51 -0800
Subject: [R-sig-Geo] Intersect polygon with grid
In-Reply-To: <4B30B54A.8080308@geo.uu.nl>
References: <aa7630000912220335j3c7fe287u8769ef275bd8a262@mail.gmail.com>
	<4B30B54A.8080308@geo.uu.nl>
Message-ID: <dc22b2570912221047p6a0d2d06l69e8e1e58387b2ab@mail.gmail.com>

Johannes,

Here is another approximation, based on the concept that Paul
suggested (first disaggregating, then aggregating the results):

library(raster)

# get some data
data(meuse.riv)
pol = SpatialPolygons(list(Polygons(list(Polygon(meuse.riv)),"meuse")))
data(meuse.grid)
coordinates(meuse.grid) = c("x", "y")
gridded(meuse.grid) = TRUE

# create a RasterLayer (in your case from file)
r <- raster(meuse.grid)

rr <- disaggregate(raster(r), 10)
pr <- polygonsToRaster(pol, rr, -1, progress='text')
ra <- aggregate(pr, 10, sum, progress='text')

plot(ra)
plot(pol, add=TRUE)

These should work on a raster of any size (and ample patience).

Robert



On Tue, Dec 22, 2009 at 4:02 AM, Paul Hiemstra <p.hiemstra at geo.uu.nl> wrote:
> Hi,
>
> A simple approach would be the following:
>
> 1. Create a point dataset that comprises of the center points of the grid
> 2. Overlay the pointset with the polygon set using the overlay() command
> 3. Convert the pointset into a grid using the gridded() command
>
> A problem could be that if your polygons are small in regard to the
> gridsize, only the center point of the gridcell determines the value of the
> gridcell. It does not look at how much area from several polygons is in a
> gridcell, and creating a weigted average by area. You could remedy this by
> making the pointset much denser, doing step 1-3 and then aggregating the
> dense grid into a coarser grid, calculating for example the mean. This can
> be done using the pointsToRaster() function from the raster package.
>
> cheers,
> Paul
>
> Johannes Signer wrote:
>>
>> Dear List,
>>
>> I am trying to do the following:
>> I have a shapefile, that I want to overlay with a raster and then assign
>> each raster cell a value that represents the percentage covered by the
>> shape
>> file. I have found a way to do that with small data sets, but I am
>> struggling with large datasets (1mio+ cells).
>>
>> My approach so far is:
>>
>> 1.) Create rectangular polygons (covering the whole area), that will be
>> used
>> for the grid afterwards.
>> 2.) Intersect the each polygon with the shapefile and calculate the area.
>> 3.) Create a grid from the rectangular polygons.
>>
>> Any suggestions are very welcome!
>>
>> Thanks in advance
>>
>> Johannes
>>
>> ? ? ? ?[[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>
> --
> Drs. Paul Hiemstra
> Department of Physical Geography
> Faculty of Geosciences
> University of Utrecht
> Heidelberglaan 2
> P.O. Box 80.115
> 3508 TC Utrecht
> Phone: ?+3130 274 3113 Mon-Tue
> Phone: ?+3130 253 5773 Wed-Fri
> http://intamap.geo.uu.nl/~paul
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From r.hijmans at gmail.com  Tue Dec 22 19:56:59 2009
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Tue, 22 Dec 2009 10:56:59 -0800
Subject: [R-sig-Geo] Overlay-ing two grids
In-Reply-To: <4B309311.60605@cirad.fr>
References: <4B2F73A6.2040809@cebc.cnrs.fr>
	<alpine.LRH.2.00.0912211525190.20489@reclus.nhh.no>
	<4B309311.60605@cirad.fr>
Message-ID: <dc22b2570912221056l1df51ee4jc6cb49586c2e1628@mail.gmail.com>

Renaud,
Here another way:

library(raster)
r <- raster(sgdf1, 1)
ra <- aggregate(r, 10, mean)
sgdf3 <- as(ra, 'SpatialGridDataFrame')

> values(ra)
  [1] 0.43 0.45 0.57 0.50 0.49 0.47 0.58 0.50 0.61 0.49 0.49 0.53 0.54
0.51 0.53 0.42 0.48 0.51 0.54 0.53 0.50
 [22] 0.52 0.39 0.52 0.52 0.62 0.53 0.48 0.52 0.48 0.52 0.45 0.50 0.48
0.43 0.47 0.52 0.49 0.43 0.59 0.54 0.52
 [43] 0.53 0.53 0.48 0.57 0.46 0.54 0.49 0.48 0.47 0.48 0.47 0.50 0.48
0.49 0.47 0.45 0.50 0.52 0.54 0.46 0.49
 [64] 0.52 0.54 0.50 0.46 0.43 0.49 0.46 0.55 0.52 0.52 0.47 0.41 0.51
0.56 0.40 0.56 0.50 0.47 0.48 0.55 0.44
 [85] 0.57 0.44 0.51 0.49 0.50 0.49 0.56 0.54 0.46 0.50 0.52 0.49 0.52
0.42 0.57 0.54
>

Robert

On Tue, Dec 22, 2009 at 1:36 AM, Renaud Lancelot
<renaud.lancelot at cirad.fr> wrote:
> Dear all,
>
> I have two "nested" grids (SpatialGridDataFrame) looking like this:
>
> prj <- "+proj=utm +zone=28 +ellps=WGS84 +datum=WGS84 +units=m +no_defs"
> gt1 <- GridTopology(c(5, 5), c(10, 10), c(100, 100))
> gt2 <- GridTopology(c(50, 50), c(100, 100), c(10, 10))
> band1 <- sample(c(0, 1), replace = TRUE, size = 10000)
> sgdf1 <- SpatialGridDataFrame(gt1, data.frame(band1), CRS(prj))
> sgdf2 <- SpatialGridDataFrame(gt2, data.frame(band1=rep(0, 100)), CRS(prj))
> ## Graphic display
> spplot(sgdf1, scales = list(draw = TRUE),
> ? ? ? panel = function(...){
> ? ? ? ? ? panel.gridplot(...)
> ? ? ? ? ? sp.grid(sgdf2, col = 0)
> ? ? ? ? ? })
>
> I want to compute the mean (and other statistics) of sgdf1 at data$band1
> according to the cells defined in sgdf2. How can I do that ? I tried to use
> overlay, without success:
>
>> sgdf3 <- overlay(sgdf1, sgdf2, fn = mean)
>> sgdf3 at data$band1
> ?[1] 1 0 0 0 0 0 1 1 1 0 0 1 0 0 0 0 0 1 1 0 1 0 1 1 0 1 0 0 0 0
> ?[31] 0 0 1 0 1 1 1 0 0 0 0 0 0 1 0 1 1 0 0 0 1 0 1 0 1 0 1 1 0 0
> ?[61] 1 1 0 1 1 1 1 0 0 0 1 1 0 0 1 1 1 1 1 1 1 1 1 1 0 0 0 0 0 0
> ?[91] 1 0 1 1 1 0 1 0 1 0
>
> All the best,
>
> Renaud
>
>
>
> --
> Renaud Lancelot
> EDEN Project, coordinator
> http://www.eden-fp6project.net/
> << EDEN International Conference, Montpellier, ?10-12 May 2010 >>
> << ? http://international-conference2010.eden-fp6project.net/ ?>>
>
> UMR CIRAD-INRA "Contr?le des maladies animales exotiques et ?mergentes"
> Joint research unit "Control of emerging and exotic animal diseases"
>
> CIRAD, Campus International de Baillarguet TA A-DIR / B
> F34398 Montpellier
> http://www.cirad.fr ?http://bluetongue.cirad.fr/
>
> Tel. ?+33 4 67 59 37 17 ?- ?Fax ?+33 4 67 59 37 95
> Secr. +33 4 67 59 37 37 ?- Cell. +33 6 77 52 08 69
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From j.m.signer at gmail.com  Tue Dec 22 22:42:05 2009
From: j.m.signer at gmail.com (Johannes Signer)
Date: Tue, 22 Dec 2009 22:42:05 +0100
Subject: [R-sig-Geo] Intersect polygon with grid
In-Reply-To: <dc22b2570912221047p6a0d2d06l69e8e1e58387b2ab@mail.gmail.com>
References: <aa7630000912220335j3c7fe287u8769ef275bd8a262@mail.gmail.com>
	<4B30B54A.8080308@geo.uu.nl>
	<dc22b2570912221047p6a0d2d06l69e8e1e58387b2ab@mail.gmail.com>
Message-ID: <aa7630000912221342m5defa8b2g892ae60859865851@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20091222/2631f30c/attachment.pl>

From renaud.lancelot at gmail.com  Tue Dec 22 22:01:02 2009
From: renaud.lancelot at gmail.com (Renaud Lancelot)
Date: Tue, 22 Dec 2009 22:01:02 +0100
Subject: [R-sig-Geo] Overlay-ing two grids
In-Reply-To: <dc22b2570912221056l1df51ee4jc6cb49586c2e1628@mail.gmail.com>
References: <4B2F73A6.2040809@cebc.cnrs.fr>
	<alpine.LRH.2.00.0912211525190.20489@reclus.nhh.no>
	<4B309311.60605@cirad.fr>
	<dc22b2570912221056l1df51ee4jc6cb49586c2e1628@mail.gmail.com>
Message-ID: <c2ee56800912221301k767b20ach43c44888c0aa7bd3@mail.gmail.com>

Thank you for the different solutions which all work fine.

Kind regards,

Renaud

2009/12/22, Robert J. Hijmans <r.hijmans at gmail.com>:
> Renaud,
> Here another way:
>
> library(raster)
> r <- raster(sgdf1, 1)
> ra <- aggregate(r, 10, mean)
> sgdf3 <- as(ra, 'SpatialGridDataFrame')
>
>> values(ra)
>   [1] 0.43 0.45 0.57 0.50 0.49 0.47 0.58 0.50 0.61 0.49 0.49 0.53 0.54
> 0.51 0.53 0.42 0.48 0.51 0.54 0.53 0.50
>  [22] 0.52 0.39 0.52 0.52 0.62 0.53 0.48 0.52 0.48 0.52 0.45 0.50 0.48
> 0.43 0.47 0.52 0.49 0.43 0.59 0.54 0.52
>  [43] 0.53 0.53 0.48 0.57 0.46 0.54 0.49 0.48 0.47 0.48 0.47 0.50 0.48
> 0.49 0.47 0.45 0.50 0.52 0.54 0.46 0.49
>  [64] 0.52 0.54 0.50 0.46 0.43 0.49 0.46 0.55 0.52 0.52 0.47 0.41 0.51
> 0.56 0.40 0.56 0.50 0.47 0.48 0.55 0.44
>  [85] 0.57 0.44 0.51 0.49 0.50 0.49 0.56 0.54 0.46 0.50 0.52 0.49 0.52
> 0.42 0.57 0.54
>>
>
> Robert
>
> On Tue, Dec 22, 2009 at 1:36 AM, Renaud Lancelot
> <renaud.lancelot at cirad.fr> wrote:
>> Dear all,
>>
>> I have two "nested" grids (SpatialGridDataFrame) looking like this:
>>
>> prj <- "+proj=utm +zone=28 +ellps=WGS84 +datum=WGS84 +units=m +no_defs"
>> gt1 <- GridTopology(c(5, 5), c(10, 10), c(100, 100))
>> gt2 <- GridTopology(c(50, 50), c(100, 100), c(10, 10))
>> band1 <- sample(c(0, 1), replace = TRUE, size = 10000)
>> sgdf1 <- SpatialGridDataFrame(gt1, data.frame(band1), CRS(prj))
>> sgdf2 <- SpatialGridDataFrame(gt2, data.frame(band1=rep(0, 100)),
>> CRS(prj))
>> ## Graphic display
>> spplot(sgdf1, scales = list(draw = TRUE),
>> ? ? ? panel = function(...){
>> ? ? ? ? ? panel.gridplot(...)
>> ? ? ? ? ? sp.grid(sgdf2, col = 0)
>> ? ? ? ? ? })
>>
>> I want to compute the mean (and other statistics) of sgdf1 at data$band1
>> according to the cells defined in sgdf2. How can I do that ? I tried to
>> use
>> overlay, without success:
>>
>>> sgdf3 <- overlay(sgdf1, sgdf2, fn = mean)
>>> sgdf3 at data$band1
>> ?[1] 1 0 0 0 0 0 1 1 1 0 0 1 0 0 0 0 0 1 1 0 1 0 1 1 0 1 0 0 0 0
>> ?[31] 0 0 1 0 1 1 1 0 0 0 0 0 0 1 0 1 1 0 0 0 1 0 1 0 1 0 1 1 0 0
>> ?[61] 1 1 0 1 1 1 1 0 0 0 1 1 0 0 1 1 1 1 1 1 1 1 1 1 0 0 0 0 0 0
>> ?[91] 1 0 1 1 1 0 1 0 1 0
>>
>> All the best,
>>
>> Renaud
>>
>>
>>
>> --
>> Renaud Lancelot
>> EDEN Project, coordinator
>> http://www.eden-fp6project.net/
>> << EDEN International Conference, Montpellier, ?10-12 May 2010 >>
>> << ? http://international-conference2010.eden-fp6project.net/ ?>>
>>
>> UMR CIRAD-INRA "Contr?le des maladies animales exotiques et ?mergentes"
>> Joint research unit "Control of emerging and exotic animal diseases"
>>
>> CIRAD, Campus International de Baillarguet TA A-DIR / B
>> F34398 Montpellier
>> http://www.cirad.fr ?http://bluetongue.cirad.fr/
>>
>> Tel. ?+33 4 67 59 37 17 ?- ?Fax ?+33 4 67 59 37 95
>> Secr. +33 4 67 59 37 37 ?- Cell. +33 6 77 52 08 69
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


-- 
Renaud Lancelot
EDEN Project, coordinator
http://www.eden-fp6project.net/
<< EDEN International Conference, Montpellier,  10-12 May 2010 >>
<<   http://international-conference2010.eden-fp6project.net/  >>

UMR CIRAD-INRA "Contr?le des maladies animales exotiques et ?mergentes"
Joint research unit "Control of emerging and exotic animal diseases"

CIRAD, Campus International de Baillarguet TA A-DIR / B
F34398 Montpellier
http://www.cirad.fr  http://bluetongue.cirad.fr/

Tel.  +33 4 67 59 37 17  -  Fax  +33 4 67 59 37 95
Secr. +33 4 67 59 37 37  - Cell. +33 6 77 52 08 69


From tech_dev at wildintellect.com  Wed Dec 23 08:09:54 2009
From: tech_dev at wildintellect.com (Alex Mandel)
Date: Tue, 22 Dec 2009 23:09:54 -0800
Subject: [R-sig-Geo] ecw for rgdal package
In-Reply-To: <alpine.LRH.2.00.0912211525190.20489@reclus.nhh.no>
References: <4B2F73A6.2040809@cebc.cnrs.fr>
	<alpine.LRH.2.00.0912211525190.20489@reclus.nhh.no>
Message-ID: <4B31C242.8060801@wildintellect.com>

Roger Bivand wrote:
> On Mon, 21 Dec 2009, Alexandre VILLERS wrote:
> 
>> Good afternoon,
>>
>> I was wondering if the reading and creating of ecw files was planned
>> for the rgdal library. I suppose it is a bit tricky to include this
>> function because of the need for the ECW SDK library from ER mapper...
> 
> Correct, we cannot distribute this library from CRAN. If you need this
> driver, you have to provide it yourself, on Windows using the
> instructions for the alternative build approach in:
> 
> file.show(system.file("README.windows", package="rgdal"))
> 
> You will have to improvise a little, as - for example - building R
> packages from source is easier now than it was in 2007.
> 
> Hope this helps,
> 
> Roger
> 

I believe the ECW dll for GDAL is available in the OSGEO4W package, and
my understanding of it is that as long as the dll is present on your
gdal path for the gdal install that rgdal is using it should work.
http://trac.osgeo.org/osgeo4w/

I can't speak for ECW but I do know for MrSID there's been clarification
on several occasions that it is ok to distribute the built binary.

Alex


From r.m.krug at gmail.com  Wed Dec 23 12:01:12 2009
From: r.m.krug at gmail.com (Rainer M Krug)
Date: Wed, 23 Dec 2009 13:01:12 +0200
Subject: [R-sig-Geo] ecw for rgdal package
In-Reply-To: <4B31C242.8060801@wildintellect.com>
References: <4B2F73A6.2040809@cebc.cnrs.fr>
	<alpine.LRH.2.00.0912211525190.20489@reclus.nhh.no>
	<4B31C242.8060801@wildintellect.com>
Message-ID: <fb7c7e870912230301i63527014ocf0c682b102c8a98@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20091223/05814124/attachment.pl>

From patrick.giraudoux at univ-fcomte.fr  Wed Dec 23 15:58:43 2009
From: patrick.giraudoux at univ-fcomte.fr (Patrick Giraudoux)
Date: Wed, 23 Dec 2009 15:58:43 +0100
Subject: [R-sig-Geo] overlay SpatialPolygons and SpatialGridDataFrame,
	overlay
Message-ID: <4B323023.7050108@univ-fcomte.fr>

I am trying to clip a SpatialGridDataframe using a SpatialPolygonsObject 
(actually a simple rectangle, e.g. a region), the ultimate aim being to 
extract the corresponding area to a new SpatialGridDataFrame 
corresponding to the region. I was supposing that I can start doing it 
using the overlay function. Here we are:

region<-matrix(c(73.5,18.1,73.5,54,135,54,135,18.1,73.5,18.1),ncol=2,byrow=T)
region<-SpatialPolygons(list(Polygons(list(Polygon(region)),ID=1)))

idx<-overlay(WorldTemp,region)

WorldTemp[!is.na(idx),]

I get:

Error in WorldTemp[!is.na(idx), ] :
  (subscript) logical subscript too long

The SpatialGridDataframe has  259200 pixels. Am I too greedy and is 
there really a limitation in length?

A second step would be to compute the upper left coordinates, etc... to 
get the new SpatialGridDataFrame But this is another story...


From reeves at nceas.ucsb.edu  Wed Dec 23 21:02:34 2009
From: reeves at nceas.ucsb.edu (reeves at nceas.ucsb.edu)
Date: Wed, 23 Dec 2009 12:02:34 -0800 (PST)
Subject: [R-sig-Geo] routine write.pointShape missing from maptools under R
	2.10?
Message-ID: <50875.207.118.29.234.1261598554.squirrel@webmail.nceas.ucsb.edu>

Hello List:

While testing some R scripts that use maptools/write.pointShape(), and which
run correctly under R ver 2.9 (and earlier), I encountered:

package 'maptools' successfully unpacked and MD5 sums checked

The downloaded packages are in
        C:\Users\visitor.rover19\AppData\Local\Temp\RtmpLg4gih\downloaded_packages

Executing the line:
#
# rgdal loads sp
#
     require(rgdal)
     require(PBSmapping)
     require(maptools)
.....

gives:
     write.pointShape(coordinates=coordinates(cbind(PolyCentPBS[,2],PolyCentPBS[,3])),PolyCentPBS,FullName)

Note that this script workes correctly under R 2.9 and earlier....



no methods for 'write.pointShape' and no documentation for it as a function

looking for documentation gives:

> ?write.pointShape
No documentation for 'write.pointShape' in specified packages and libraries:
you could try '??write.pointShape'
> ?write.pointShape()
Error in .helpForCall(topicExpr, parent.frame()) :
  no methods for 'write.pointShape' and no documentation for it as a function
>

The complete run-time output is given below......

When I ran the





R version 2.10.1 (2009-12-14)
Copyright (C) 2009 The R Foundation for Statistical Computing
ISBN 3-900051-07-0

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> utils:::menuInstallPkgs()
--- Please select a CRAN mirror for use in this session ---
trying URL
'http://cran.cnr.Berkeley.edu/bin/windows/contrib/2.10/maptools_0.7-29.zip'
Content type 'application/zip' length 1041753 bytes (1017 Kb)
opened URL
downloaded 1017 Kb

package 'maptools' successfully unpacked and MD5 sums checked

The downloaded packages are in
        C:\Users\visitor.rover19\AppData\Local\Temp\RtmpLg4gih\downloaded_packages
> ?write.pointShape
No documentation for 'write.pointShape' in specified packages and libraries:
you could try '??write.pointShape'
> ?write.pointShape()
Error in .helpForCall(topicExpr, parent.frame()) :
  no methods for 'write.pointShape' and no documentation for it as a function
>

Is write.pointShape still supported under R 2.10?


Thanks,
Rick R


From zua3 at cornell.edu  Wed Dec 23 21:54:43 2009
From: zua3 at cornell.edu (Zia Ahmed)
Date: Wed, 23 Dec 2009 15:54:43 -0500
Subject: [R-sig-Geo] Resent: colorkey: Placement of labels and ticks in
 center positions of "color key" of a levelplot ?
In-Reply-To: <4B327334.90108@cornell.edu>
References: <b105924e0912230919n178e60cem5528c711a8891bb7@mail.gmail.com>		<4B325347.7080902@braverock.com>		<b105924e0912230932h48c87b4btc038c3a3aae9be58@mail.gmail.com>		<4B32546E.1060904@braverock.com>	<b105924e0912230940w2f168243x177e7b2c3c585ddd@mail.gmail.com>
	<4B3258C2.7010709@braverock.com> <4B327334.90108@cornell.edu>
Message-ID: <4B328393.8070808@cornell.edu>

Is it possible to place  labels  and ticks  in center positions of each 
cut of  "color key" of levelplot ? Here is my code that I used to 
produce a map (see attachment). The two  labels and ticks  were  placed  
in  left  sides each segment of the color key. I want to show them 
center of the cuts.
Help will be appreciated.
Thanks

Zia

windows(width=4, height=5)
jpeg( file="/////Fig_1.jpg",
units = "px", pointsize = 12, quality = 75, bg = "white",
res = NA, restoreConsole = TRUE)

levelplot(ffreq~x+y, aspect="iso",
            xlab=list("E (m)",cex=.6), ylab="N (m)",
            scales=list(y=list(draw=T,cex=.7,rot=90, tck= 
.35),x=list(draw=T, cex=.7,tck= .35)),
             colorkey = list(space="right",tick.number=1,height=1, 
width=1.5,
             labels = list(at = seq(1,2,length=2),cex=.7,rot=90,
             lab = c("annual", "2-5 years"))),
# I want place above labels center of each cuts of colorkey"
             as.data.frame(meuse.grid),
             col.regions=gray.colors,cuts=1,
             panel = function(...) {
             panel.levelplot(...)
             panel.grid(h=-1, v=-1, col="darkgrey")
                 }, )
dev.off()
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Fig_1.jpg
Type: image/jpeg
Size: 24866 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20091223/f9a24e7b/attachment.jpg>

From Adrian.Baddeley at csiro.au  Thu Dec 24 02:43:16 2009
From: Adrian.Baddeley at csiro.au (Adrian.Baddeley at csiro.au)
Date: Thu, 24 Dec 2009 09:43:16 +0800
Subject: [R-sig-Geo]  Intersect polygon with grid
Message-ID: <57DC18C299094D4299F837570C5DF1C502D3839155@EXWA-MBX01.nexus.csiro.au>

Johannes Signer <j.m.signer at gmail.com> writes:

> I have a shapefile, that I want to overlay with a raster 
> and then assign each raster cell a value that represents 
> the percentage covered by the shape file.

In the 'spatstat' package the function 'pixellate.owin' does this calculation.

----
Prof Adrian Baddeley (UWA/CSIRO)
CSIRO Mathematical and Information Sciences
Leeuwin Centre, 65 Brockway Road, Floreat WA 6014, Australia
Tel: 08 9333 6177 | Fax: 08 9333 6121 | Mob: 0410 447 821


From Roger.Bivand at nhh.no  Thu Dec 24 10:47:40 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 24 Dec 2009 10:47:40 +0100 (CET)
Subject: [R-sig-Geo] routine write.pointShape missing from maptools
 under R 2.10?
In-Reply-To: <50875.207.118.29.234.1261598554.squirrel@webmail.nceas.ucsb.edu>
References: <50875.207.118.29.234.1261598554.squirrel@webmail.nceas.ucsb.edu>
Message-ID: <alpine.LRH.2.00.0912241044360.30891@reclus.nhh.no>

On Wed, 23 Dec 2009, reeves at nceas.ucsb.edu wrote:

> Hello List:
>
> While testing some R scripts that use maptools/write.pointShape(), and which
> run correctly under R ver 2.9 (and earlier), I encountered:
>
> package 'maptools' successfully unpacked and MD5 sums checked
>
> The downloaded packages are in
>        C:\Users\visitor.rover19\AppData\Local\Temp\RtmpLg4gih\downloaded_packages
>
> Executing the line:
> #
> # rgdal loads sp
> #
>     require(rgdal)
>     require(PBSmapping)
>     require(maptools)
> .....
>
> gives:
>     write.pointShape(coordinates=coordinates(cbind(PolyCentPBS[,2],PolyCentPBS[,3])),PolyCentPBS,FullName)

As of the latest release, maptools functions that have been deprecated 
(warned off) for some time - those not using sp S4 classes - have been 
removed from the namespace. All package maintainers depending on these 
were notified in advance. If you really need them, you get them in the 
usual way for internal functions with the ::: operator, so 
maptools:::write.pointShape will find it. Just make a 
SpatialPointsDataFrame first and write with writeSpatialShape() to make 
the script future-proof.

Hope this helps,

Roger

>
> Note that this script workes correctly under R 2.9 and earlier....
>
>
>
> no methods for 'write.pointShape' and no documentation for it as a function
>
> looking for documentation gives:
>
>> ?write.pointShape
> No documentation for 'write.pointShape' in specified packages and libraries:
> you could try '??write.pointShape'
>> ?write.pointShape()
> Error in .helpForCall(topicExpr, parent.frame()) :
>  no methods for 'write.pointShape' and no documentation for it as a function
>>
>
> The complete run-time output is given below......
>
> When I ran the
>
>
>
>
>
> R version 2.10.1 (2009-12-14)
> Copyright (C) 2009 The R Foundation for Statistical Computing
> ISBN 3-900051-07-0
>
> R is free software and comes with ABSOLUTELY NO WARRANTY.
> You are welcome to redistribute it under certain conditions.
> Type 'license()' or 'licence()' for distribution details.
>
>  Natural language support but running in an English locale
>
> R is a collaborative project with many contributors.
> Type 'contributors()' for more information and
> 'citation()' on how to cite R or R packages in publications.
>
> Type 'demo()' for some demos, 'help()' for on-line help, or
> 'help.start()' for an HTML browser interface to help.
> Type 'q()' to quit R.
>
>> utils:::menuInstallPkgs()
> --- Please select a CRAN mirror for use in this session ---
> trying URL
> 'http://cran.cnr.Berkeley.edu/bin/windows/contrib/2.10/maptools_0.7-29.zip'
> Content type 'application/zip' length 1041753 bytes (1017 Kb)
> opened URL
> downloaded 1017 Kb
>
> package 'maptools' successfully unpacked and MD5 sums checked
>
> The downloaded packages are in
>        C:\Users\visitor.rover19\AppData\Local\Temp\RtmpLg4gih\downloaded_packages
>> ?write.pointShape
> No documentation for 'write.pointShape' in specified packages and libraries:
> you could try '??write.pointShape'
>> ?write.pointShape()
> Error in .helpForCall(topicExpr, parent.frame()) :
>  no methods for 'write.pointShape' and no documentation for it as a function
>>
>
> Is write.pointShape still supported under R 2.10?
>
>
> Thanks,
> Rick R
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From patrick.giraudoux at univ-fcomte.fr  Thu Dec 24 14:12:37 2009
From: patrick.giraudoux at univ-fcomte.fr (Patrick Giraudoux)
Date: Thu, 24 Dec 2009 14:12:37 +0100
Subject: [R-sig-Geo] drawing order in spplot, sp.layout
Message-ID: <4B3368C5.908@univ-fcomte.fr>

Dear listers,

I am messing with spplot trying to get layers in the right order. 
Basically I want a SpatialGridDataframe overlapped with a 
SpatialPolygons object (actually a SpatialPolygonsDataFrame object). The 
the data attribute of the SpatialGridDataFrame has 13 columns (12 months 
+ the annual average of temperature). So, I expect 13 lattices panels 
corresponding to each.

This gives:

addCh<-list("sp.polygons",chinaUTM47,border="grey50")
spplot(ChinaTempTT,col.regions=mypal,sp.layout=addCh,as.table=T)

Unfortunately, in each panel:

- the polygons are drawn first and then are covered by the the grid (the 
reverse of what I want to). Thus polygons are invisible.
- the argument border="grey50" does not seems to used

Any hint ?

Patrick


From lfelliott at hotmail.com  Thu Dec 24 16:05:35 2009
From: lfelliott at hotmail.com (LeRoy Elliott)
Date: Thu, 24 Dec 2009 15:05:35 +0000
Subject: [R-sig-Geo] grids, points, and RandomForest
In-Reply-To: <mailman.11.1261652402.21688.r-sig-geo@stat.math.ethz.ch>
References: <mailman.11.1261652402.21688.r-sig-geo@stat.math.ethz.ch>
Message-ID: <BLU128-W24BEC4B15FFC01BBB06291A67F0@phx.gbl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20091224/a15d1823/attachment.pl>

From e.pebesma at gmail.com  Thu Dec 24 16:21:57 2009
From: e.pebesma at gmail.com (Edzer Pebesma)
Date: Thu, 24 Dec 2009 16:21:57 +0100
Subject: [R-sig-Geo] Resent: colorkey: Placement of labels and ticks in
 center positions of "color key" of a levelplot ?
In-Reply-To: <4B328393.8070808@cornell.edu>
References: <b105924e0912230919n178e60cem5528c711a8891bb7@mail.gmail.com>		<4B325347.7080902@braverock.com>		<b105924e0912230932h48c87b4btc038c3a3aae9be58@mail.gmail.com>		<4B32546E.1060904@braverock.com>	<b105924e0912230940w2f168243x177e7b2c3c585ddd@mail.gmail.com>	<4B3258C2.7010709@braverock.com>
	<4B327334.90108@cornell.edu> <4B328393.8070808@cornell.edu>
Message-ID: <4B338715.1060404@uni-muenster.de>

Dear Zia,

try as an example

library(sp)
data(meuse.grid)
gridded(meuse.grid) = ~x+y
meuse.grid$f = as.factor(meuse.grid$part.a)
spplot(meuse.grid, "f")

so, this works for spplot, by default, but only for factors.

You can find out from the sp sources how this works. Please note that on
r-help, few people will understand where you found meuse.grid.

A merry christmas to everyone,
--
Edzer

Zia Ahmed wrote:
> Is it possible to place  labels  and ticks  in center positions of 
> each cut of  "color key" of levelplot ? Here is my code that I used to 
> produce a map (see attachment). The two  labels and ticks  were  
> placed  in  left  sides each segment of the color key. I want to show 
> them center of the cuts.
> Help will be appreciated.
> Thanks
>
> Zia
>
> windows(width=4, height=5)
> jpeg( file="/////Fig_1.jpg",
> units = "px", pointsize = 12, quality = 75, bg = "white",
> res = NA, restoreConsole = TRUE)
>
> levelplot(ffreq~x+y, aspect="iso",
>            xlab=list("E (m)",cex=.6), ylab="N (m)",
>            scales=list(y=list(draw=T,cex=.7,rot=90, tck= 
> .35),x=list(draw=T, cex=.7,tck= .35)),
>             colorkey = list(space="right",tick.number=1,height=1, 
> width=1.5,
>             labels = list(at = seq(1,2,length=2),cex=.7,rot=90,
>             lab = c("annual", "2-5 years"))),
> # I want place above labels center of each cuts of colorkey"
>             as.data.frame(meuse.grid),
>             col.regions=gray.colors,cuts=1,
>             panel = function(...) {
>             panel.levelplot(...)
>             panel.grid(h=-1, v=-1, col="darkgrey")
>                 }, )
> dev.off()
>
> ------------------------------------------------------------------------
>
> ------------------------------------------------------------------------
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>   

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From e.pebesma at gmail.com  Thu Dec 24 16:31:39 2009
From: e.pebesma at gmail.com (Edzer Pebesma)
Date: Thu, 24 Dec 2009 16:31:39 +0100
Subject: [R-sig-Geo] grids, points, and RandomForest
In-Reply-To: <BLU128-W24BEC4B15FFC01BBB06291A67F0@phx.gbl>
References: <mailman.11.1261652402.21688.r-sig-geo@stat.math.ethz.ch>
	<BLU128-W24BEC4B15FFC01BBB06291A67F0@phx.gbl>
Message-ID: <4B33895B.2080205@uni-muenster.de>

Here's a general recipy:

1. import all the layers in R, using readGDAL in package rgdal, in case 
they're geotiffs e.g.

library(rgdal)
b1 = readGDAL("b1.tif")
b2 = readGDAL("b2.tif")
...
etc. and your response variable
y = readOGR("y.tif")

2. make sure they are all in a single R object, e.g.

b1$band2 = b2[[1]]
b1$band3 = b3[[1]]
...
etc.
b1$y = y[[1]]

3. Use RF predict:

library(randomForest)
b1$out = predict(randomForest(y~band1+band2+band3,as.data.frame(b1)))
spplot(b1, "out")

or write b1["out"] back as a geotiff using writeGDAL, and import in arcGIS.

This was of course all without trying, so that's now up to you.

Best wishes,
--
Edzer

LeRoy Elliott wrote:
> I'm new to using geo info in R, though I'm familiar with Arc & R.
>
> I have numerous ESRI grid files with image band and biophysical info that I'd like to use with RandomForest to do predictive habitat modeling with species occurrence points. I've tried looking on the web, but haven't found anything helpful.
>
> Can anyone point me to a resource that can step me through this process? I need to stack multiple grids and use the info from point locations with RandomForest. The grid files all have the same cell size, same projection, and the point locations are also in the same projection. So, I think the data is ready to go.
>
> Lee Elliott
> Missouri Resource Assessment Partnership
> University of Missouri
> Columbia, MO 
>  		 	   		  
> _________________________________________________________________
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>   

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster 
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251 
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de 
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From e.pebesma at gmail.com  Thu Dec 24 16:36:57 2009
From: e.pebesma at gmail.com (Edzer Pebesma)
Date: Thu, 24 Dec 2009 16:36:57 +0100
Subject: [R-sig-Geo] drawing order in spplot, sp.layout
In-Reply-To: <4B3368C5.908@univ-fcomte.fr>
References: <4B3368C5.908@univ-fcomte.fr>
Message-ID: <4B338A99.7060201@uni-muenster.de>



Patrick Giraudoux wrote:
> Dear listers,
>
> I am messing with spplot trying to get layers in the right order. 
> Basically I want a SpatialGridDataframe overlapped with a 
> SpatialPolygons object (actually a SpatialPolygonsDataFrame object). 
> The the data attribute of the SpatialGridDataFrame has 13 columns (12 
> months + the annual average of temperature). So, I expect 13 lattices 
> panels corresponding to each.
>
> This gives:
>
> addCh<-list("sp.polygons",chinaUTM47,border="grey50")
Patrick, I believe there's the option

addCh<-list("sp.polygons",chinaUTM47,col="grey50", first = FALSE)

that solves this. I can't find it really in the documentation, so 
something's missing there for sure. Use col instead of border.
--
Edzer
> spplot(ChinaTempTT,col.regions=mypal,sp.layout=addCh,as.table=T)
>
> Unfortunately, in each panel:
>
> - the polygons are drawn first and then are covered by the the grid 
> (the reverse of what I want to). Thus polygons are invisible.
> - the argument border="grey50" does not seems to used
>
> Any hint ?
>
> Patrick
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster 
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251 
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de 
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From e.pebesma at gmail.com  Thu Dec 24 16:59:39 2009
From: e.pebesma at gmail.com (Edzer Pebesma)
Date: Thu, 24 Dec 2009 16:59:39 +0100
Subject: [R-sig-Geo] overlay SpatialPolygons and SpatialGridDataFrame,
 overlay
In-Reply-To: <4B323023.7050108@univ-fcomte.fr>
References: <4B323023.7050108@univ-fcomte.fr>
Message-ID: <4B338FEB.70604@uni-muenster.de>

Dear Patrick,

Patrick Giraudoux wrote:
> I am trying to clip a SpatialGridDataframe using a 
> SpatialPolygonsObject (actually a simple rectangle, e.g. a region), 
> the ultimate aim being to extract the corresponding area to a new 
> SpatialGridDataFrame corresponding to the region. I was supposing that 
> I can start doing it using the overlay function. Here we are:
>
> region<-matrix(c(73.5,18.1,73.5,54,135,54,135,18.1,73.5,18.1),ncol=2,byrow=T) 
>
> region<-SpatialPolygons(list(Polygons(list(Polygon(region)),ID=1)))
>
> idx<-overlay(WorldTemp,region)
>
> WorldTemp[!is.na(idx),]
>
> I get:
>
> Error in WorldTemp[!is.na(idx), ] :
>  (subscript) logical subscript too long
>
> The SpatialGridDataframe has  259200 pixels. Am I too greedy and is 
> there really a limitation in length?
do first a

fullgrid(WorldTemp) = FALSE

and then do the overlay. If you want to select individual pixels, this 
needs be done on SpatialPixelsDataFrame objects; if you select the way 
you did it, on a SpatialGridDataFrame object, it will select grid rows, 
as in WorldTemp[rowNumbers,colNumbers] -- no wonder that the pixel 
indexes (cell index numbers) vector was too long.

 From a design perspective, this might sound complex, but both selection 
mechanisms are convenient at times, and they match the way the data are 
stored. If your selection is as simple as you sketch above, you might 
prefer to select straight away on grid rows and columns of a 
SpatialGridDataFrame object.
>
> A second step would be to compute the upper left coordinates, etc... 
> to get the new SpatialGridDataFrame But this is another story...
R does this for you automatically, by

bbox(WorldTemp[!is.na(idx),]

but note that the bbox values for *Grid* and *Pixel* objects are grid 
and cell corners, not cell centers.
-
Edzer
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster 
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251 
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de 
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From patrick.giraudoux at univ-fcomte.fr  Thu Dec 24 17:23:20 2009
From: patrick.giraudoux at univ-fcomte.fr (Patrick Giraudoux)
Date: Thu, 24 Dec 2009 17:23:20 +0100
Subject: [R-sig-Geo] overlay SpatialPolygons and SpatialGridDataFrame,
 overlay
In-Reply-To: <4B338FEB.70604@uni-muenster.de>
References: <4B323023.7050108@univ-fcomte.fr> <4B338FEB.70604@uni-muenster.de>
Message-ID: <4B339578.7010400@univ-fcomte.fr>

Edzer Pebesma a ?crit :
> Dear Patrick,
>
> Patrick Giraudoux wrote:
>> I am trying to clip a SpatialGridDataframe using a 
>> SpatialPolygonsObject (actually a simple rectangle, e.g. a region), 
>> the ultimate aim being to extract the corresponding area to a new 
>> SpatialGridDataFrame corresponding to the region. I was supposing 
>> that I can start doing it using the overlay function. Here we are:
>>
>> region<-matrix(c(73.5,18.1,73.5,54,135,54,135,18.1,73.5,18.1),ncol=2,byrow=T) 
>>
>> region<-SpatialPolygons(list(Polygons(list(Polygon(region)),ID=1)))
>>
>> idx<-overlay(WorldTemp,region)
>>
>> WorldTemp[!is.na(idx),]
>>
>> I get:
>>
>> Error in WorldTemp[!is.na(idx), ] :
>>  (subscript) logical subscript too long
>>
>> The SpatialGridDataframe has  259200 pixels. Am I too greedy and is 
>> there really a limitation in length?
> do first a
>
> fullgrid(WorldTemp) = FALSE
>
> and then do the overlay. If you want to select individual pixels, this 
> needs be done on SpatialPixelsDataFrame objects; if you select the way 
> you did it, on a SpatialGridDataFrame object, it will select grid 
> rows, as in WorldTemp[rowNumbers,colNumbers] -- no wonder that the 
> pixel indexes (cell index numbers) vector was too long.
>
> From a design perspective, this might sound complex, but both 
> selection mechanisms are convenient at times, and they match the way 
> the data are stored. If your selection is as simple as you sketch 
> above, you might prefer to select straight away on grid rows and 
> columns of a SpatialGridDataFrame object.
>>
>> A second step would be to compute the upper left coordinates, etc... 
>> to get the new SpatialGridDataFrame But this is another story...
> R does this for you automatically, by
>
> bbox(WorldTemp[!is.na(idx),]
>
> but note that the bbox values for *Grid* and *Pixel* objects are grid 
> and cell corners, not cell centers.
> -
> Edzer


Woaouuuu... Impressive. I will dig on that and go further ASAP



>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From patrick.giraudoux at univ-fcomte.fr  Thu Dec 24 17:28:06 2009
From: patrick.giraudoux at univ-fcomte.fr (Patrick Giraudoux)
Date: Thu, 24 Dec 2009 17:28:06 +0100
Subject: [R-sig-Geo] drawing order in spplot, sp.layout
In-Reply-To: <4B338A99.7060201@uni-muenster.de>
References: <4B3368C5.908@univ-fcomte.fr> <4B338A99.7060201@uni-muenster.de>
Message-ID: <4B339696.4070603@univ-fcomte.fr>

Great ! I may be wrong but it may be that some years ago I have got such 
info already from you or Roger (before your book) but I could not 
retrieve it in any help list and archive. It may be have been e-mails 
off list...

Thanks anyway and merry Xmas ,

Patrick



Edzer Pebesma a ?crit :
>
>
> Patrick Giraudoux wrote:
>> Dear listers,
>>
>> I am messing with spplot trying to get layers in the right order. 
>> Basically I want a SpatialGridDataframe overlapped with a 
>> SpatialPolygons object (actually a SpatialPolygonsDataFrame object). 
>> The the data attribute of the SpatialGridDataFrame has 13 columns (12 
>> months + the annual average of temperature). So, I expect 13 lattices 
>> panels corresponding to each.
>>
>> This gives:
>>
>> addCh<-list("sp.polygons",chinaUTM47,border="grey50")
> Patrick, I believe there's the option
>
> addCh<-list("sp.polygons",chinaUTM47,col="grey50", first = FALSE)
>
> that solves this. I can't find it really in the documentation, so 
> something's missing there for sure. Use col instead of border.
> -- 
> Edzer
>> spplot(ChinaTempTT,col.regions=mypal,sp.layout=addCh,as.table=T)
>>
>> Unfortunately, in each panel:
>>
>> - the polygons are drawn first and then are covered by the the grid 
>> (the reverse of what I want to). Thus polygons are invisible.
>> - the argument border="grey50" does not seems to used
>>
>> Any hint ?
>>
>> Patrick
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From j.m.signer at gmail.com  Sat Dec 26 10:51:46 2009
From: j.m.signer at gmail.com (Johannes Signer)
Date: Sat, 26 Dec 2009 10:51:46 +0100
Subject: [R-sig-Geo] Intersect polygon with grid
In-Reply-To: <57DC18C299094D4299F837570C5DF1C502D3839155@EXWA-MBX01.nexus.csiro.au>
References: <57DC18C299094D4299F837570C5DF1C502D3839155@EXWA-MBX01.nexus.csiro.au>
Message-ID: <aa7630000912260151k1781daa3o984e2ca4552ed22b@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20091226/cbc58031/attachment.pl>

From juantomas.sayago at gmail.com  Sat Dec 26 18:27:21 2009
From: juantomas.sayago at gmail.com (Juan Tomas Sayago)
Date: Sat, 26 Dec 2009 12:27:21 -0500
Subject: [R-sig-Geo] Map of flows?
Message-ID: <3364ce110912260927x3a63756el8c01f5a6215f97d2@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20091226/d9e3ef0a/attachment.pl>

From massimodisasha at yahoo.it  Sun Dec 27 14:24:28 2009
From: massimodisasha at yahoo.it (Massimo Di Stefano)
Date: Sun, 27 Dec 2009 14:24:28 +0100
Subject: [R-sig-Geo] depitting a DEM
Message-ID: <641755D6-CFBA-4FDD-833B-2EA9445DBF31@yahoo.it>

Hi All,

i'm a grass user, for my study i need to depit a digital elevation model.
i'm not sure if in grass exists a module to depit digital elevation models 
(i see some filer functions like " r.mfilter.fp - Raster map matrix filter"  and  r.neighbors)

have you any hints, if already exists a procedure in R using its geostatistics ability?

thanks for any suggestion,
happy new year :-)

Massimo.

From hengl at spatial-analyst.net  Mon Dec 28 09:50:21 2009
From: hengl at spatial-analyst.net (Tomislav Hengl)
Date: Mon, 28 Dec 2009 09:50:21 +0100
Subject: [R-sig-Geo] GEOSTAT 2010 Summer School, 27 June - 4 July 2010;
 University of Plasencia, Spain
Message-ID: <4B38714D.9040605@spatial-analyst.net>


GEOSTAT 2010 Summer School
27 June - 4 July 2010; University of Plasencia, Spain

This is the first call for participation in the GEOSTAT 2010 Summer
School. GEOSTAT focuses on important aspects of statistical analysis of
spatial and spatio-temporal data using open source / free GIS tools: R,
SAGA GIS, GRASS GIS, Quantum GIS, GDAL, Google Earth and similar. The
course participants learn how to move data back and forth between
different environments, how to produce scripts and automate analysis. We
welcome also R beginners and users needing refresh courses in
programming. This year, we would also like to introduce/promote topics
such as: web-based computing, WPS client-server environments, 3D and 4D
geostatistics, combining R+SAGA/GRASS. This is a 5-day course with two
parallel sessions, which means that there will be total 7 full-day
blocks (three days with parallel sessions) of lectures; the last day of
the summer school participants can present their research problems and
ask for feedback from the whole summer school. For more info see:

http://geostat2010.info/Info

-------------------------------------------------------------
LECTURERS:
Roger Bivand (nhh.no), Edzer Pebesma (uni-muenster.de), Gerard Heuvelink
(wur.nl), Olaf Conrad (geowiss.uni-hamburg.de), Tomislav Hengl (uva.nl)
and Victor Olaya Ferrero (unex.es)

-------------------------------------------------------------
DEADLINE TO REGISTER:
15th February 2010; online at:

http://geostat2010.info/deadline_registration

-------------------------------------------------------------
SELECTION OF CANDIDATES:
The participants will be selected using the following criteria:

1. your publication record / academic position;
2. previous involvement in the open source activities (R-sig-geo,
conferences and workshops)
3. distance from the venue (more distant applications have advantage);
4. time of application (first-come-first-served);

-------------------------------------------------------------
FEES:
To be determined; usually between 200-300 EUR (excluding accommodation 
costs). 5-6 double bed rooms (in-house accommodation) available at 
subsidized price for participants who reside in, and are nationals of an 
ODA country (http://www.oecd.org/dataoecd/32/40/43540882.pdf). Subject 
to availability.

-------------------------------------------------------------
CONTACT (Local organizers):
Victor Olaya Ferrero (volaya at unex.es), Tomislav Hengl (T.Hengl at uva.nl)
and Juan Carlos Jim?nez (jcfernan at unex.es)
URL: www.geostat2010.info


From b.rowlingson at lancaster.ac.uk  Mon Dec 28 11:33:55 2009
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Mon, 28 Dec 2009 10:33:55 +0000
Subject: [R-sig-Geo] Creating random (but believable) geographies
Message-ID: <d8ad40b50912280233t3ace4156uac152ef8bc009c3a@mail.gmail.com>

I've recently been working on a web site for tropical disease mapping
in Africa. As a demo, I'm not using real data, but I have been using
real countries. I don't really want to use real countries just in case
there's any misunderstanding that this is simulated case numbers.

 So I've thought about constructing random polygons to represent a
fake country and its administrative subdivisions. Any ideas how to do
this? Here's some thoughts so far:

 * Generate some random points, create voronoi polygons, then wiggle
the edges to make them look more natural. Problem may be stopping the
wiggling from causing edges to overlap, but maybe that just needs a
bunch of point-in-poly tests... Hmmm...

 * Overlay two existing unassociated polygon geometries, such as UK
counties and Ethiopian districts, compute intersections and rebuild
the polygon topology. Then you should end up with polygonal regions
with outlines composed of both sets of polygons. You might end up with
lots of tiny polygons where two lines closely overlap along their
length, but maybe a post-processing step can fix this.

 * Raster-based methods: similar to the voronoi method, start with a
number of seed points on a grid and grow by some random method - then
do raster-vector conversion.

 Obviously there's lots of possible options such as creating islands
and holes, but I thought I'd start with the basics.

 If anyone has any existing fake geographies in digital form then it
might be an idea to create a repository of them...

Barry


-- 
blog: http://geospaced.blogspot.com/
web: http://www.maths.lancs.ac.uk/~rowlings
web: http://www.rowlingson.com/
twitter: http://twitter.com/geospacedman
pics: http://www.flickr.com/photos/spacedman


From b.rowlingson at lancaster.ac.uk  Mon Dec 28 12:33:29 2009
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Mon, 28 Dec 2009 11:33:29 +0000
Subject: [R-sig-Geo] Creating random (but believable) geographies
In-Reply-To: <4B389493.6050000@bitwrit.com.au>
References: <d8ad40b50912280233t3ace4156uac152ef8bc009c3a@mail.gmail.com>
	<4B389493.6050000@bitwrit.com.au>
Message-ID: <d8ad40b50912280333j2066abdga9e33de1c5ee3452@mail.gmail.com>

On Mon, Dec 28, 2009 at 11:20 AM, Jim Lemon <jim at bitwrit.com.au> wrote:

>
> Hi Barry,
> The first thing I thought of was to specify nodes (intersections of borders
> = vertices of polygons) and then wiggle the lines between the nodes using
> something like this:
>
> wigglyLine<-function(xstart,ystart,xend,yend,nseg=20,mult=1) {
> ?xvec<-seq(xstart,xend,length.out=nseg+1)
> ?yvec<-seq(ystart,yend,length.out=nseg+1)
> ?xvec[2:nseg]<-xvec[2:nseg]+(runif(nseg-1)-0.5)*mult
> ?yvec[2:nseg]<-yvec[2:nseg]+(runif(nseg-1)-0.5)*mult
> ?return(list(x=xvec,y=yvec))
> }
>
> Obviously there are a lot of things that you could fiddle with here,
> including the easiest way to specify the vertices and then turn the wiggled
> edges into polygons. It does solve the problem of having the polygons fit
> together, though.

 My preferred wiggle algorithm is a fractal - for a line from points A
to B, choose a point C "between" A and B and create two lines AC and
CB. Repeat (recurse) for lines AC and CB up to a number of recursions.
Three or four should be enough.

 If you start with Voronoi polygon edges then you only have to check
that point C is inside either of the polygons on either side of AB to
keep the topology.

 There's some more choices here - you could either fully fractalise
one segment at a time, or do all the first divisions over the space,
then the subdivisions and so on. Also there's the definition of
"between", which strictly doesn't even have to be between A and B
(it's just more likely to be in one of the polygons if it is).

 May I also suggest that if anyone does generate some fake countries
that we place them in the middle of an ocean...

Barry


From jim at bitwrit.com.au  Mon Dec 28 12:20:51 2009
From: jim at bitwrit.com.au (Jim Lemon)
Date: Mon, 28 Dec 2009 22:20:51 +1100
Subject: [R-sig-Geo] Creating random (but believable) geographies
In-Reply-To: <d8ad40b50912280233t3ace4156uac152ef8bc009c3a@mail.gmail.com>
References: <d8ad40b50912280233t3ace4156uac152ef8bc009c3a@mail.gmail.com>
Message-ID: <4B389493.6050000@bitwrit.com.au>

On 12/28/2009 09:33 PM, Barry Rowlingson wrote:
> I've recently been working on a web site for tropical disease mapping
> in Africa. As a demo, I'm not using real data, but I have been using
> real countries. I don't really want to use real countries just in case
> there's any misunderstanding that this is simulated case numbers.
>
>   So I've thought about constructing random polygons to represent a
> fake country and its administrative subdivisions. Any ideas how to do
> this? Here's some thoughts so far:
>
>   * Generate some random points, create voronoi polygons, then wiggle
> the edges to make them look more natural. Problem may be stopping the
> wiggling from causing edges to overlap, but maybe that just needs a
> bunch of point-in-poly tests... Hmmm...
>
>   * Overlay two existing unassociated polygon geometries, such as UK
> counties and Ethiopian districts, compute intersections and rebuild
> the polygon topology. Then you should end up with polygonal regions
> with outlines composed of both sets of polygons. You might end up with
> lots of tiny polygons where two lines closely overlap along their
> length, but maybe a post-processing step can fix this.
>
>   * Raster-based methods: similar to the voronoi method, start with a
> number of seed points on a grid and grow by some random method - then
> do raster-vector conversion.
>
>   Obviously there's lots of possible options such as creating islands
> and holes, but I thought I'd start with the basics.
>
>   If anyone has any existing fake geographies in digital form then it
> might be an idea to create a repository of them...
>
>    
Hi Barry,
The first thing I thought of was to specify nodes (intersections of 
borders = vertices of polygons) and then wiggle the lines between the 
nodes using something like this:

wigglyLine<-function(xstart,ystart,xend,yend,nseg=20,mult=1) {
  xvec<-seq(xstart,xend,length.out=nseg+1)
  yvec<-seq(ystart,yend,length.out=nseg+1)
  xvec[2:nseg]<-xvec[2:nseg]+(runif(nseg-1)-0.5)*mult
  yvec[2:nseg]<-yvec[2:nseg]+(runif(nseg-1)-0.5)*mult
  return(list(x=xvec,y=yvec))
}

Obviously there are a lot of things that you could fiddle with here, 
including the easiest way to specify the vertices and then turn the 
wiggled edges into polygons. It does solve the problem of having the 
polygons fit together, though.

Jim


From doon75 at hotmail.com  Mon Dec 28 13:11:32 2009
From: doon75 at hotmail.com (Darren Norris)
Date: Mon, 28 Dec 2009 10:11:32 -0200
Subject: [R-sig-Geo] re.  Creating random (but believable) geographies
Message-ID: <BLU0-SMTP54B6365387B81338C77D38C77B0@phx.gbl>

how about simply using what already exists?
For example,
Brazil [data freely available (but may need to cite the source which may 
defeat what you are trying to achieve?) at: 
ftp://geoftp.ibge.gov.br/mapas/malhas_digitais/municipio_2005/E500/Proj_Geografica/ArcView_shp/ 
]
has three sub-administrative layers (region, state, municipality).
overlay a random polygon of your new country somewhere in the country 
(should be big enough) and you will end up with at least 2 
administrative layers?
If you want can then shift the coordinates to any location (ocean, 
middle of a desert etc)......
What am I missing?
Darren


From b.rowlingson at lancaster.ac.uk  Mon Dec 28 13:20:24 2009
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Mon, 28 Dec 2009 12:20:24 +0000
Subject: [R-sig-Geo] re.  Creating random (but believable) geographies
In-Reply-To: <BLU0-SMTP54B6365387B81338C77D38C77B0@phx.gbl>
References: <BLU0-SMTP54B6365387B81338C77D38C77B0@phx.gbl>
Message-ID: <d8ad40b50912280420s46d53158g28bd0005b53bdfc2@mail.gmail.com>

On Mon, Dec 28, 2009 at 12:11 PM, Darren Norris <doon75 at hotmail.com> wrote:
> how about simply using what already exists?
> For example,
> Brazil [data freely available (but may need to cite the source which may
> defeat what you are trying to achieve?) at:
> ftp://geoftp.ibge.gov.br/mapas/malhas_digitais/municipio_2005/E500/Proj_Geografica/ArcView_shp/
> ]
> has three sub-administrative layers (region, state, municipality).
> overlay a random polygon of your new country somewhere in the country
> (should be big enough) and you will end up with at least 2 administrative
> layers?
> If you want can then shift the coordinates to any location (ocean, middle of
> a desert etc)......
> What am I missing?

 That's an idea, but someone *might* recognise their state boundaries,
even shifted into the Atlantic and maybe even rotated and given a
silly name. I just like the idea of creating totally fictitious
regions!

 That's another interesting problem - creating fake names for regions.
I suppose you could have a set of prefixes and suffixes and join them
randomly...

 Reminds me of the time a few years ago I did a quiz round by printing
country and UK county outlines onto paper and cutting the paper into
circles so nobody knew where north was. It did confuse people...

Barry


From doon75 at hotmail.com  Mon Dec 28 13:33:40 2009
From: doon75 at hotmail.com (Darren Norris)
Date: Mon, 28 Dec 2009 10:33:40 -0200
Subject: [R-sig-Geo] re.  Creating random (but believable) geographies
In-Reply-To: <d8ad40b50912280420s46d53158g28bd0005b53bdfc2@mail.gmail.com>
References: <BLU0-SMTP54B6365387B81338C77D38C77B0@phx.gbl>
	<d8ad40b50912280420s46d53158g28bd0005b53bdfc2@mail.gmail.com>
Message-ID: <BLU0-SMTP67CEA99F1AC43E9A4C0774C77B0@phx.gbl>



...snip
>  That's an idea, but someone *might* recognise their state boundaries,
> even shifted into the Atlantic and maybe even rotated and given a
> silly name. I just like the idea of creating totally fictitious
> regions!
>
>  That's another interesting problem - creating fake names for regions.
> I suppose you could have a set of prefixes and suffixes and join them
> randomly...
>   
using names of disease vectors to generate prefix/suffixes (mosquito, 
nematode .....)? Can then use family, genus, species etc already nicely 
arranged into different strata?

>  Reminds me of the time a few years ago I did a quiz round by printing
> country and UK county outlines onto paper and cutting the paper into
> circles so nobody knew where north was. It did confuse people...
>
> Barry
>
>
>


From b.rowlingson at lancaster.ac.uk  Mon Dec 28 13:48:26 2009
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Mon, 28 Dec 2009 12:48:26 +0000
Subject: [R-sig-Geo] re.  Creating random (but believable) geographies
In-Reply-To: <BLU0-SMTP67CEA99F1AC43E9A4C0774C77B0@phx.gbl>
References: <BLU0-SMTP54B6365387B81338C77D38C77B0@phx.gbl>
	<d8ad40b50912280420s46d53158g28bd0005b53bdfc2@mail.gmail.com>
	<BLU0-SMTP67CEA99F1AC43E9A4C0774C77B0@phx.gbl>
Message-ID: <d8ad40b50912280448j232ab041v29cb5cf342bf0814@mail.gmail.com>

On Mon, Dec 28, 2009 at 12:33 PM, Darren Norris <doon75 at hotmail.com> wrote:

> using names of disease vectors to generate prefix/suffixes (mosquito,
> nematode .....)? Can then use family, genus, species etc already nicely
> arranged into different strata?

 I just tried using emacs' 'dissociated press'  function to chop up UK
county names to produce names of possible new fictional counties. It
combined 'Hereford' with 'Suffolk' to produce 'Hereffolk', for
example. It also combined something with Yorkshire to create
"Dorkshire".

Barry


From Roger.Bivand at nhh.no  Mon Dec 28 13:57:26 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 28 Dec 2009 13:57:26 +0100 (CET)
Subject: [R-sig-Geo] Creating random (but believable) geographies
In-Reply-To: <d8ad40b50912280333j2066abdga9e33de1c5ee3452@mail.gmail.com>
References: <d8ad40b50912280233t3ace4156uac152ef8bc009c3a@mail.gmail.com>
	<4B389493.6050000@bitwrit.com.au>
	<d8ad40b50912280333j2066abdga9e33de1c5ee3452@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.0912281353250.22881@reclus.nhh.no>

On Mon, 28 Dec 2009, Barry Rowlingson wrote:

> On Mon, Dec 28, 2009 at 11:20 AM, Jim Lemon <jim at bitwrit.com.au> wrote:
>
>>
>> Hi Barry,
>> The first thing I thought of was to specify nodes (intersections of borders
>> = vertices of polygons) and then wiggle the lines between the nodes using
>> something like this:
>>
>> wigglyLine<-function(xstart,ystart,xend,yend,nseg=20,mult=1) {
>> ?xvec<-seq(xstart,xend,length.out=nseg+1)
>> ?yvec<-seq(ystart,yend,length.out=nseg+1)
>> ?xvec[2:nseg]<-xvec[2:nseg]+(runif(nseg-1)-0.5)*mult
>> ?yvec[2:nseg]<-yvec[2:nseg]+(runif(nseg-1)-0.5)*mult
>> ?return(list(x=xvec,y=yvec))
>> }
>>
>> Obviously there are a lot of things that you could fiddle with here,
>> including the easiest way to specify the vertices and then turn the wiggled
>> edges into polygons. It does solve the problem of having the polygons fit
>> together, though.
>
> My preferred wiggle algorithm is a fractal - for a line from points A
> to B, choose a point C "between" A and B and create two lines AC and
> CB. Repeat (recurse) for lines AC and CB up to a number of recursions.
> Three or four should be enough.
>
> If you start with Voronoi polygon edges then you only have to check
> that point C is inside either of the polygons on either side of AB to
> keep the topology.

Couldn't you rather start from a hexagon grid, given the typical number of 
neighbours of "real" entities? Snipping in some straight lines (parallels) 
and some rivers might also make sense. Are there suitable collections of 
entities in gaming etc.? Or generate a DEM and take drainage basins?

Roger

>
> There's some more choices here - you could either fully fractalise
> one segment at a time, or do all the first divisions over the space,
> then the subdivisions and so on. Also there's the definition of
> "between", which strictly doesn't even have to be between A and B
> (it's just more likely to be in one of the polygons if it is).
>
> May I also suggest that if anyone does generate some fake countries
> that we place them in the middle of an ocean...
>
> Barry
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From r.aluizio at gmail.com  Wed Dec 30 17:38:16 2009
From: r.aluizio at gmail.com (Rodrigo Aluizio)
Date: Wed, 30 Dec 2009 14:38:16 -0200
Subject: [R-sig-Geo] Close Spatial Lines into a Polygon
Message-ID: <4b3b8202.0706c00a.46be.4119@mx.google.com>

Hi Sig list, I?m really new representing spatial data, but I?m already able
to create excellent maps using sp, maptools and mapdata packages. 

Anyway, I have a SpatialLines object (attached) which I would like to
?close? and turn it into a SpatialPolygon, so I can fill it with a color.
The object already posses some closed lines (islands) but the entire area is
wide open.  To make things easier it could be closed at the ocean side
(right side, if plotted), so there will be no need to deal with the open and
closed areas. This ?closure? may be done as the coast line was and
hypotenuse of a rectangular triangle.

 

Is there a way to do so? I was looking for something similar to that in the
R site search, but I didn?t found a total match with my issue, or maybe I?m
too new to that, so I wasn?t even able to recognize a solution J.

 

Thank you for your attention and sorry if the question was already answered.

 

-------------------------------------------------------------

MSc.  <mailto:r.aluizio at gmail.com> Rodrigo Aluizio

Centro de Estudos do Mar/UFPR
Laborat?rio de Micropaleontologia



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20091230/c896dd61/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: BP.Rdata
Type: application/octet-stream
Size: 39731 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20091230/c896dd61/attachment.obj>

From Roger.Bivand at nhh.no  Wed Dec 30 18:58:38 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 30 Dec 2009 18:58:38 +0100 (CET)
Subject: [R-sig-Geo] Close Spatial Lines into a Polygon
In-Reply-To: <4b3b8202.0706c00a.46be.4119@mx.google.com>
References: <4b3b8202.0706c00a.46be.4119@mx.google.com>
Message-ID: <alpine.LRH.2.00.0912301853350.31670@reclus.nhh.no>

On Wed, 30 Dec 2009, Rodrigo Aluizio wrote:

> Hi Sig list, I?m really new representing spatial data, but I?m already able
> to create excellent maps using sp, maptools and mapdata packages.
>
> Anyway, I have a SpatialLines object (attached) which I would like to
> ?close? and turn it into a SpatialPolygon, so I can fill it with a color.
> The object already posses some closed lines (islands) but the entire area is
> wide open.  To make things easier it could be closed at the ocean side
> (right side, if plotted), so there will be no need to deal with the open and
> closed areas. This ?closure? may be done as the coast line was and
> hypotenuse of a rectangular triangle.
>
>
>
> Is there a way to do so? I was looking for something similar to that in the
> R site search, but I didn?t found a total match with my issue, or maybe I?m
> too new to that, so I wasn?t even able to recognize a solution J.

The general answer is in chunks 66 and 71 in the code from our book, see:

http://www.asdar-book.org/book/cm_mod.R

That leaves one small unclosed island in the NE, plus the coastline. If 
you want to colour the land, you need to close these two manually to the 
E, N, and S bounding box values, and something extra to the west, probably 
by extracting and re-inserting the coords slots of the two "Line" objects.

Hope this helps,

Roger

>
>
>
> Thank you for your attention and sorry if the question was already answered.
>
>
>
> -------------------------------------------------------------
>
> MSc.  <mailto:r.aluizio at gmail.com> Rodrigo Aluizio
>
> Centro de Estudos do Mar/UFPR
> Laborat?rio de Micropaleontologia
>
>
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From alobolistas at gmail.com  Wed Dec 30 21:15:40 2009
From: alobolistas at gmail.com (Agustin Lobo)
Date: Wed, 30 Dec 2009 21:15:40 +0100
Subject: [R-sig-Geo] POSIX* objects and writeOGR()
Message-ID: <4B3BB4EC.6060203@gmail.com>

This might be a bit off-topic.
I have to export as shape an Sp.Poly.DF in which
one of the variables records date and time as POSIXtc. As
writeOGR() complains about the POSIXct variable, I'm
trying to convert to POSIXlt, which I think that will be
accepted (another alternative would be coverting to an
string char, but prefer to keep the SPDF object with
a correct class definition for that variable).
Let's call patata the table of the SPDF.

 > class(patata$Tima)
[1] "POSIXt"  "POSIXct"

 > patata$Tima[1]
[1] "2009-09-26 09:57:24 CEST"

 > as.POSIXlt(patata$Tima[1])
[1] "2009-09-26 09:57:24 CEST"

 > class(as.POSIXlt(patata$Tima[1]))
[1] "POSIXt"  "POSIXlt"

So I was happy, but:

 > patata$Tima <- as.POSIXlt(patata$Tima)
Error in `$<-.data.frame`(`*tmp*`, "Tima", value = list(sec = c(24, 33,  :
   replacement has 9 rows, data has 44
Calls: $<- -> $<-.data.frame


Is there any way I can put the POSIXlt object in the table (patata) of the SPDF 
object?

Thanks!

Agus


From mdsumner at gmail.com  Wed Dec 30 21:30:27 2009
From: mdsumner at gmail.com (Michael Sumner)
Date: Thu, 31 Dec 2009 07:30:27 +1100
Subject: [R-sig-Geo] POSIX* objects and writeOGR()
In-Reply-To: <4B3BB4EC.6060203@gmail.com>
References: <4B3BB4EC.6060203@gmail.com>
Message-ID: <522664f80912301230m4616ebd4y2e835e0cfc20da9a@mail.gmail.com>

POSIXlt stores the date-times as a list of vectors decomposed into the
(still numeric) component parts ("sec", "min", "hour", "mday", "mon",
"year", "wday", "yday", "isdst") so that cannot be stored as a single
column in the data frame - you would need 9 columns.


Compare these to see the underlying structure:

tm <- Sys.time()
## POSIXct
unclass(tm)
## POSIXlt
unclass(as.POSIXlt(tm))

You can just cast to character, directly or with format - see
?strptime for the full set of format tokens available. For example:

 as.character(tm)
##[1] "2009-12-31 07:28:01"
format(tm, "%Y/%b/%a %H:%M:%S")
##[1] "2009/Dec/Thu 07:28:01"

Hope that helps.

Regards, Mike.


On Thu, Dec 31, 2009 at 7:15 AM, Agustin Lobo <alobolistas at gmail.com> wrote:
> This might be a bit off-topic.
> I have to export as shape an Sp.Poly.DF in which
> one of the variables records date and time as POSIXtc. As
> writeOGR() complains about the POSIXct variable, I'm
> trying to convert to POSIXlt, which I think that will be
> accepted (another alternative would be coverting to an
> string char, but prefer to keep the SPDF object with
> a correct class definition for that variable).
> Let's call patata the table of the SPDF.
>
>> class(patata$Tima)
> [1] "POSIXt" ?"POSIXct"
>
>> patata$Tima[1]
> [1] "2009-09-26 09:57:24 CEST"
>
>> as.POSIXlt(patata$Tima[1])
> [1] "2009-09-26 09:57:24 CEST"
>
>> class(as.POSIXlt(patata$Tima[1]))
> [1] "POSIXt" ?"POSIXlt"
>
> So I was happy, but:
>
>> patata$Tima <- as.POSIXlt(patata$Tima)
> Error in `$<-.data.frame`(`*tmp*`, "Tima", value = list(sec = c(24, 33, ?:
> ?replacement has 9 rows, data has 44
> Calls: $<- -> $<-.data.frame
>
>
> Is there any way I can put the POSIXlt object in the table (patata) of the
> SPDF object?
>
> Thanks!
>
> Agus
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From julleeyaw at yahoo.ca  Thu Dec 31 00:32:46 2009
From: julleeyaw at yahoo.ca (Julie Lee-Yaw)
Date: Wed, 30 Dec 2009 15:32:46 -0800 (PST)
Subject: [R-sig-Geo] stuck on importing and projecting shapefiles
Message-ID: <393990.37257.qm@web30608.mail.mud.yahoo.com>

Hi,
I am new to both R and spatial data and am very stuck on what I think should be a simple analysis. I am trying to do a polygon overlay analysis of two shapefiles from different sources. Before proceeding to my overlay functions, I am trying to plot my shapefiles to double check that they line up properly. In R, I am using PBSmapping and maptools and the following script:

## read in first shapefile using maptools so I can pull out only those polygons that are labeled "blue"

s1=readShapePoly("shapefile1")
s1blue=s1[s1$SYMB=="BLUE",]
s1PS=SpatialPolygons2PolySet(sp1blue)
shape1=combinePolys(sp1PS)
attr(shape1,"projection")<-"LL"

## read in second shapefile using PBSmapping routine (in this case, I need to use importShapefile because I have previously modified this function to import only select polygons from this file

shape2<-importShapefile("shapefile2", projection="LL")

## trying to plot both together:

plotPolys(shape1) ##produces reasonable looking plot
addPolys(shape2)

## I get the following error message

In .checkProjection(projectionPlot, projectionPoly) :
? The data's 'projection' attribute (LL) differs from the
projection of the plot region (NA).

This leads me to think that the projections are different and thus my downstream calculations of intersection areas will be off. The first shapefile is projected and has the following prj file attached:

PROJCS["Clarke_1866_Lambert_Conformal_Conic",GEOGCS["GCS_Clarke_1866",DATUM["D_Clarke_1866",SPHEROID["Clarke_1866",6378206.4,294.9786982]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Lambert_Conformal_Conic"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",-95.0],PARAMETER["Standard_Parallel_1",49.0],PARAMETER["Standard_Parallel_2",77.0],PARAMETER["Latitude_Of_Origin",49.0],UNIT["Meter",1.0]]

The second shapefile is unprojected and the metadata indicates:
projection parameters: units: decimal degrees
Datum: North America 1983

Since I'm using a MAC and can't figure out how to load rgdal, I have tried importing both shapefiles into QGIS (a separate GIS program), reprojecting them and exporting them from there and re-applying my R code but I get the same error message. Does anyone have any suggestions as to what I might be doing wrong and how I can get these shapefiles into a common projection so that I can calculate the area of their intersection? Thanks in advance for the help!



      __________________________________________________________________
Be smarter than spam. See how smart SpamGuard is at giving junk email the boot

From nsicad at gmail.com  Thu Dec 31 04:43:27 2009
From: nsicad at gmail.com (Noli Sicad)
Date: Thu, 31 Dec 2009 10:43:27 +0700
Subject: [R-sig-Geo] Shapefiles of New Zealand
In-Reply-To: <f7bd71730912301935i2f7222a7tf41d74c236e5009b@mail.gmail.com>
References: <f7bd71730912301935i2f7222a7tf41d74c236e5009b@mail.gmail.com>
Message-ID: <f7bd71730912301943g4e9b149et3537cdc0e465701c@mail.gmail.com>

 Hi,

I am searching the net for the "basic" shapefile of New Zealand. I
could not find a site to download it.

Any hint where to download it.

Thanks.

Noli


From nsicad at gmail.com  Thu Dec 31 04:54:55 2009
From: nsicad at gmail.com (Noli Sicad)
Date: Thu, 31 Dec 2009 10:54:55 +0700
Subject: [R-sig-Geo] Shapefiles of New Zealand
In-Reply-To: <f7bd71730912301943g4e9b149et3537cdc0e465701c@mail.gmail.com>
References: <f7bd71730912301935i2f7222a7tf41d74c236e5009b@mail.gmail.com>
	<f7bd71730912301943g4e9b149et3537cdc0e465701c@mail.gmail.com>
Message-ID: <f7bd71730912301954o65621c28pedaeaf47ba3d9150@mail.gmail.com>

OK. I remember OSM repo - cloudmade.

http://downloads.cloudmade.com/oceania/new_zealand#breadcrumbs

Noli

On 12/31/09, Noli Sicad <nsicad at gmail.com> wrote:
>  Hi,
>
> I am searching the net for the "basic" shapefile of New Zealand. I
> could not find a site to download it.
>
> Any hint where to download it.
>
> Thanks.
>
> Noli
>


From nsicad at gmail.com  Thu Dec 31 05:15:12 2009
From: nsicad at gmail.com (Noli Sicad)
Date: Thu, 31 Dec 2009 11:15:12 +0700
Subject: [R-sig-Geo] Shapefiles of New Zealand
In-Reply-To: <f7bd71730912301954o65621c28pedaeaf47ba3d9150@mail.gmail.com>
References: <f7bd71730912301935i2f7222a7tf41d74c236e5009b@mail.gmail.com>
	<f7bd71730912301943g4e9b149et3537cdc0e465701c@mail.gmail.com>
	<f7bd71730912301954o65621c28pedaeaf47ba3d9150@mail.gmail.com>
Message-ID: <f7bd71730912302015u774fe859x59fa6bd52ef2545a@mail.gmail.com>

Better Free Spatial Data
Country level

http://www.diva-gis.org/Data

Sorry for answering my own question.

Noli


On 12/31/09, Noli Sicad <nsicad at gmail.com> wrote:
> OK. I remember OSM repo - cloudmade.
>
> http://downloads.cloudmade.com/oceania/new_zealand#breadcrumbs
>
> Noli
>
> On 12/31/09, Noli Sicad <nsicad at gmail.com> wrote:
>>  Hi,
>>
>> I am searching the net for the "basic" shapefile of New Zealand. I
>> could not find a site to download it.
>>
>> Any hint where to download it.
>>
>> Thanks.
>>
>> Noli
>>
>


From alexandre.villers at cebc.cnrs.fr  Thu Dec 31 08:26:33 2009
From: alexandre.villers at cebc.cnrs.fr (alexandre villers)
Date: Thu, 31 Dec 2009 08:26:33 +0100
Subject: [R-sig-Geo] stuck on importing and projecting shapefiles
Message-ID: <1262244393.8296bdcalexandre.villers@cebc.cnrs.fr>

Hey Julie,

The main problem, for what I understood of working with R and spatial objects, is that you are using the wrong tools to import your data. Maptools is mostly deprecated for all the import export function with shapefile/rasters (but still holds interesting ones for other jobs).
You'll have to struggle a bit and get rgdal to work on your Mac ! http://cran.r-project.org/bin/macosx/
Once this is done, it will be much easier to do the job. GDAL is a very powerful, essential tool to import export data to/from R. So get to the help list for MAC, the forum and check if
- rgdal is compatible for your version of R MAC
- look for all the packages necessary to compile this packages (I couldn't download and compile rgdal with linux ubuntu because a small package was missing...). Just check through the documentation which packages are necessary to compile rgdal with MAC.

Once this is done, your work will be much more simple

You will find all the help you need on the rgdal/sp helpfile and on the Internet. But do not hesitate to ask questions on the list.


Best regards and good luck.

Alex

PS: I'm pretty sure a R / rgdal /MAC user will help you with this !

-----Original Message-----
From: Julie Lee-Yaw <julleeyaw at yahoo.ca>
To: r-sig-geo at stat.math.ethz.ch
Date: Wed, 30 Dec 2009 15:32:46 -0800 (PST)
Subject: [R-sig-Geo] stuck on importing and projecting shapefiles

Hi,
I am new to both R and spatial data and am very stuck on what I think should be a simple analysis. I am trying to do a polygon overlay analysis of two shapefiles from different sources. Before proceeding to my overlay functions, I am trying to plot my shapefiles to double check that they line up properly. In R, I am using PBSmapping and maptools and the following script:

## read in first shapefile using maptools so I can pull out only those polygons that are labeled "blue"

s1=readShapePoly("shapefile1")
s1blue=s1[s1$SYMB=="BLUE",]
s1PS=SpatialPolygons2PolySet(sp1blue)
shape1=combinePolys(sp1PS)
attr(shape1,"projection")<-"LL"

## read in second shapefile using PBSmapping routine (in this case, I need to use importShapefile because I have previously modified this function to import only select polygons from this file

shape2<-importShapefile("shapefile2", projection="LL")

## trying to plot both together:

plotPolys(shape1) ##produces reasonable looking plot
addPolys(shape2)

## I get the following error message

In .checkProjection(projectionPlot, projectionPoly) :
? The data's 'projection' attribute (LL) differs from the
projection of the plot region (NA).

This leads me to think that the projections are different and thus my downstream calculations of intersection areas will be off. The first shapefile is projected and has the following prj file attached:

PROJCS["Clarke_1866_Lambert_Conformal_Conic",GEOGCS["GCS_Clarke_1866",DATUM["D_Clarke_1866",SPHEROID["Clarke_1866",6378206.4,294.9786982]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Lambert_Conformal_Conic"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",-95.0],PARAMETER["Standard_Parallel_1",49.0],PARAMETER["Standard_Parallel_2",77.0],PARAMETER["Latitude_Of_Origin",49.0],UNIT["Meter",1.0]]

The second shapefile is unprojected and the metadata indicates:
projection parameters: units: decimal degrees
Datum: North America 1983

Since I'm using a MAC and can't figure out how to load rgdal, I have tried importing both shapefiles into QGIS (a separate GIS program), reprojecting them and exporting them from there and re-applying my R code but I get the same error message. Does anyone have any suggestions as to what I might be doing wrong and how I can get these shapefiles into a common projection so that I can calculate the area of their intersection? Thanks in advance for the help!



Alexandre Villers
PhD. Candidate
Team Agripop
CEBC CNRS UPR 1934
79360 Beauvoir sur Niort

Phone: +33 (0)549 099 613 


__________ Information from ESET Mail Security, version of virus signature database 4730 (20091230) __________

The message was checked by ESET Mail Security.
http://www.eset.com


From nsicad at gmail.com  Thu Dec 31 08:55:59 2009
From: nsicad at gmail.com (Noli Sicad)
Date: Thu, 31 Dec 2009 14:55:59 +0700
Subject: [R-sig-Geo] stuck on importing and projecting shapefiles
In-Reply-To: <1262244393.8296bdcalexandre.villers@cebc.cnrs.fr>
References: <1262244393.8296bdcalexandre.villers@cebc.cnrs.fr>
Message-ID: <f7bd71730912302355q1521dccv1dba9597db126bc2@mail.gmail.com>

Hi Julie,


Probably you can downloading and installing using rgdal for Mac OS X
from this site

http://www.kyngchaos.com/software:frameworks

~~~~~~~~~
GDAL

    *
      GDAL framework v1.6.3-1 [44.9 MiB] {requires UnixImageIO, GEOS,
SQLite3 and PROJ frameworks}
    *
      ECW plugin v1.6.2-1 [2.9 MiB] (for any GDAL 1.6.x version)
    *
      MrSID plugin v1.6.1-1 [2.9 MiB] (for any GDAL 1.6.x version)
    *
      GRASS plugin is now a separate install, available with the GRASS
installer.
    *
      rgdal 0.6.22-1 - R 2.10 package [1.5 MiB] (for any GDAL 1.6.x version)
    *
      rgdal 0.6.18-1 - R 2.9 package [1.4 MiB] (for any GDAL 1.6.x version)

~~~~~~~~~~~~~~~~~

Noli


On 12/31/09, alexandre villers <alexandre.villers at cebc.cnrs.fr> wrote:
> Hey Julie,
>
> The main problem, for what I understood of working with R and spatial
> objects, is that you are using the wrong tools to import your data. Maptools
> is mostly deprecated for all the import export function with
> shapefile/rasters (but still holds interesting ones for other jobs).
> You'll have to struggle a bit and get rgdal to work on your Mac !
> http://cran.r-project.org/bin/macosx/
> Once this is done, it will be much easier to do the job. GDAL is a very
> powerful, essential tool to import export data to/from R. So get to the help
> list for MAC, the forum and check if
> - rgdal is compatible for your version of R MAC
> - look for all the packages necessary to compile this packages (I couldn't
> download and compile rgdal with linux ubuntu because a small package was
> missing...). Just check through the documentation which packages are
> necessary to compile rgdal with MAC.
>
> Once this is done, your work will be much more simple
>
> You will find all the help you need on the rgdal/sp helpfile and on the
> Internet. But do not hesitate to ask questions on the list.
>
>
> Best regards and good luck.
>
> Alex
>
> PS: I'm pretty sure a R / rgdal /MAC user will help you with this !
>
> -----Original Message-----
> From: Julie Lee-Yaw <julleeyaw at yahoo.ca>
> To: r-sig-geo at stat.math.ethz.ch
> Date: Wed, 30 Dec 2009 15:32:46 -0800 (PST)
> Subject: [R-sig-Geo] stuck on importing and projecting shapefiles
>
> Hi,
> I am new to both R and spatial data and am very stuck on what I think should
> be a simple analysis. I am trying to do a polygon overlay analysis of two
> shapefiles from different sources. Before proceeding to my overlay
> functions, I am trying to plot my shapefiles to double check that they line
> up properly. In R, I am using PBSmapping and maptools and the following
> script:
>
> ## read in first shapefile using maptools so I can pull out only those
> polygons that are labeled "blue"
>
> s1=readShapePoly("shapefile1")
> s1blue=s1[s1$SYMB=="BLUE",]
> s1PS=SpatialPolygons2PolySet(sp1blue)
> shape1=combinePolys(sp1PS)
> attr(shape1,"projection")<-"LL"
>
> ## read in second shapefile using PBSmapping routine (in this case, I need
> to use importShapefile because I have previously modified this function to
> import only select polygons from this file
>
> shape2<-importShapefile("shapefile2", projection="LL")
>
> ## trying to plot both together:
>
> plotPolys(shape1) ##produces reasonable looking plot
> addPolys(shape2)
>
> ## I get the following error message
>
> In .checkProjection(projectionPlot, projectionPoly) :
>   The data's 'projection' attribute (LL) differs from the
> projection of the plot region (NA).
>
> This leads me to think that the projections are different and thus my
> downstream calculations of intersection areas will be off. The first
> shapefile is projected and has the following prj file attached:
>
> PROJCS["Clarke_1866_Lambert_Conformal_Conic",GEOGCS["GCS_Clarke_1866",DATUM["D_Clarke_1866",SPHEROID["Clarke_1866",6378206.4,294.9786982]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Lambert_Conformal_Conic"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",-95.0],PARAMETER["Standard_Parallel_1",49.0],PARAMETER["Standard_Parallel_2",77.0],PARAMETER["Latitude_Of_Origin",49.0],UNIT["Meter",1.0]]
>
> The second shapefile is unprojected and the metadata indicates:
> projection parameters: units: decimal degrees
> Datum: North America 1983
>
> Since I'm using a MAC and can't figure out how to load rgdal, I have tried
> importing both shapefiles into QGIS (a separate GIS program), reprojecting
> them and exporting them from there and re-applying my R code but I get the
> same error message. Does anyone have any suggestions as to what I might be
> doing wrong and how I can get these shapefiles into a common projection so
> that I can calculate the area of their intersection? Thanks in advance for
> the help!
>
>
>
> Alexandre Villers
> PhD. Candidate
> Team Agripop
> CEBC CNRS UPR 1934
> 79360 Beauvoir sur Niort
>
> Phone: +33 (0)549 099 613
>
>
> __________ Information from ESET Mail Security, version of virus signature
> database 4730 (20091230) __________
>
> The message was checked by ESET Mail Security.
> http://www.eset.com
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From alobolistas at gmail.com  Thu Dec 31 09:25:05 2009
From: alobolistas at gmail.com (Agustin Lobo)
Date: Thu, 31 Dec 2009 09:25:05 +0100
Subject: [R-sig-Geo] POSIX* objects and writeOGR()
In-Reply-To: <522664f80912301230m4616ebd4y2e835e0cfc20da9a@mail.gmail.com>
References: <4B3BB4EC.6060203@gmail.com>
	<522664f80912301230m4616ebd4y2e835e0cfc20da9a@mail.gmail.com>
Message-ID: <4B3C5FE1.5090507@gmail.com>

Thanks!

I see that creating a temporary SPDF with that variable casted
as character is the only way to run writeOGR().

Would it be possible adding
an option i.e. POSIXtoCHAR=T to writeOGR() so that such a conversion is
automated?

Agus

Michael Sumner wrote:
> POSIXlt stores the date-times as a list of vectors decomposed into the
> (still numeric) component parts ("sec", "min", "hour", "mday", "mon",
> "year", "wday", "yday", "isdst") so that cannot be stored as a single
> column in the data frame - you would need 9 columns.
> 
> 
> Compare these to see the underlying structure:
> 
> tm <- Sys.time()
> ## POSIXct
> unclass(tm)
> ## POSIXlt
> unclass(as.POSIXlt(tm))
> 
> You can just cast to character, directly or with format - see
> ?strptime for the full set of format tokens available. For example:
> 
>  as.character(tm)
> ##[1] "2009-12-31 07:28:01"
> format(tm, "%Y/%b/%a %H:%M:%S")
> ##[1] "2009/Dec/Thu 07:28:01"
> 
> Hope that helps.
> 
> Regards, Mike.
> 
> 
> On Thu, Dec 31, 2009 at 7:15 AM, Agustin Lobo <alobolistas at gmail.com> wrote:
>> This might be a bit off-topic.
>> I have to export as shape an Sp.Poly.DF in which
>> one of the variables records date and time as POSIXtc. As
>> writeOGR() complains about the POSIXct variable, I'm
>> trying to convert to POSIXlt, which I think that will be
>> accepted (another alternative would be coverting to an
>> string char, but prefer to keep the SPDF object with
>> a correct class definition for that variable).
>> Let's call patata the table of the SPDF.
>>
>>> class(patata$Tima)
>> [1] "POSIXt"  "POSIXct"
>>
>>> patata$Tima[1]
>> [1] "2009-09-26 09:57:24 CEST"
>>
>>> as.POSIXlt(patata$Tima[1])
>> [1] "2009-09-26 09:57:24 CEST"
>>
>>> class(as.POSIXlt(patata$Tima[1]))
>> [1] "POSIXt"  "POSIXlt"
>>
>> So I was happy, but:
>>
>>> patata$Tima <- as.POSIXlt(patata$Tima)
>> Error in `$<-.data.frame`(`*tmp*`, "Tima", value = list(sec = c(24, 33,  :
>>  replacement has 9 rows, data has 44
>> Calls: $<- -> $<-.data.frame
>>
>>
>> Is there any way I can put the POSIXlt object in the table (patata) of the
>> SPDF object?
>>
>> Thanks!
>>
>> Agus
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>


From patrick.giraudoux at univ-fcomte.fr  Thu Dec 31 10:34:36 2009
From: patrick.giraudoux at univ-fcomte.fr (Patrick Giraudoux)
Date: Thu, 31 Dec 2009 10:34:36 +0100
Subject: [R-sig-Geo] color category SpatialGridDataFrame
 SpatialPolygonsDataFrame Corine Land Cover Global Land Cover 2000
Message-ID: <4B3C702C.8030108@univ-fcomte.fr>

Dear all,

I am wondering what is the safest way to handle colors when 
SpatialGridDataFrame data are categories. spplot() or image() are 
extremely convenient when attributes are continuous variables or so (eg 
altitude, rainfall, etc...), but the colorRamp() system and the 
col.regions, col arguments, though extremely powerful in other cases, is 
not really adapted to category data such as Corine LandCover or Global 
Land Cover 2000 codes. Thus to link pixels to the right color may be 
quite tedious (however I may have missed something...).

One option I though about was to change raster into shapefile (or 
SpatialGrid into SpatialPolygons objects), but again the straight way to 
get right colors is not evident.

Any idea ?

Patrick


From renaud.lancelot at cirad.fr  Thu Dec 31 12:07:03 2009
From: renaud.lancelot at cirad.fr (Renaud Lancelot)
Date: Thu, 31 Dec 2009 12:07:03 +0100
Subject: [R-sig-Geo] color category SpatialGridDataFrame
 SpatialPolygonsDataFrame Corine Land Cover Global Land Cover 2000
In-Reply-To: <4B3C702C.8030108@univ-fcomte.fr>
References: <4B3C702C.8030108@univ-fcomte.fr>
Message-ID: <4B3C85D7.7050600@cirad.fr>

Dear Patrick,

I recently met this issue. I finally used image() on the 
SpatialGridDataFrame, defining the appropriate colors using the col 
argument (?tonnant, non ;-)). I have defined the legend using legend(), 
and I used split.screen() to arrange the plots. If you wish, I can send 
you the whole stuff (data and code) in a private message (huge datasets).

Renaud

Patrick Giraudoux a ?crit :
> Dear all,
> 
> I am wondering what is the safest way to handle colors when 
> SpatialGridDataFrame data are categories. spplot() or image() are 
> extremely convenient when attributes are continuous variables or so (eg 
> altitude, rainfall, etc...), but the colorRamp() system and the 
> col.regions, col arguments, though extremely powerful in other cases, is 
> not really adapted to category data such as Corine LandCover or Global 
> Land Cover 2000 codes. Thus to link pixels to the right color may be 
> quite tedious (however I may have missed something...).
> 
> One option I though about was to change raster into shapefile (or 
> SpatialGrid into SpatialPolygons objects), but again the straight way to 
> get right colors is not evident.
> 
> Any idea ?
> 
> Patrick
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Renaud Lancelot
EDEN Project, coordinator
http://www.eden-fp6project.net/
<< EDEN International Conference, Montpellier,  10-12 May 2010 >>
<<   http://international-conference2010.eden-fp6project.net/  >>

UMR CIRAD-INRA "Contr?le des maladies animales exotiques et ?mergentes"
Joint research unit "Control of emerging and exotic animal diseases"

CIRAD, Campus International de Baillarguet TA A-DIR / B
F34398 Montpellier
http://www.cirad.fr  http://bluetongue.cirad.fr/

Tel.  +33 4 67 59 37 17  -  Fax  +33 4 67 59 37 95
Secr. +33 4 67 59 37 37  - Cell. +33 6 77 52 08 69


From alexandre.villers at cebc.cnrs.fr  Thu Dec 31 12:10:27 2009
From: alexandre.villers at cebc.cnrs.fr (alexandre villers)
Date: Thu, 31 Dec 2009 12:10:27 +0100
Subject: [R-sig-Geo] stuck on importing and projecting shapefiles
Message-ID: <1262257827.83c3d9calexandre.villers@cebc.cnrs.fr>

Hey Julie,

The main problem, for what I understood of working with R and spatial objects, is that you are using the wrong tools to import your data. Maptools is mostly deprecated for all the import export function with shapefile/rasters (but still holds interesting ones for other jobs).
You'll have to struggle a bit and get rgdal to work on your Mac ! http://cran.r-project.org/bin/macosx/
Once this is done, it will be much easier to do the job. GDAL is a very powerful, essential tool to import export data to/from R. So get to the help list for MAC, the forum and check if
- rgdal is compatible for your version of R MAC
- look for all the packages necessary to compile this packages (I couldn't download and compile rgdal with linux ubuntu because a small package was missing...). Just check through the documentation which packages are necessary to compile rgdal with MAC.

Once this is done, your work will be much more simple

You will find all the help you need on the rgdal/sp helpfile and on the Internet. But do not hesitate to ask questions on the list.


Best regards and good luck.

Alex

PS: I'm pretty sure a R / rgdal /MAC user will help you with this !

-----Original Message-----
From: Julie Lee-Yaw <julleeyaw at yahoo.ca>
To: r-sig-geo at stat.math.ethz.ch
Date: Wed, 30 Dec 2009 15:32:46 -0800 (PST)
Subject: [R-sig-Geo] stuck on importing and projecting shapefiles

Hi,
I am new to both R and spatial data and am very stuck on what I think should be a simple analysis. I am trying to do a polygon overlay analysis of two shapefiles from different sources. Before proceeding to my overlay functions, I am trying to plot my shapefiles to double check that they line up properly. In R, I am using PBSmapping and maptools and the following script:

## read in first shapefile using maptools so I can pull out only those polygons that are labeled "blue"

s1=readShapePoly("shapefile1")
s1blue=s1[s1$SYMB=="BLUE",]
s1PS=SpatialPolygons2PolySet(sp1blue)
shape1=combinePolys(sp1PS)
attr(shape1,"projection")<-"LL"

## read in second shapefile using PBSmapping routine (in this case, I need to use importShapefile because I have previously modified this function to import only select polygons from this file

shape2<-importShapefile("shapefile2", projection="LL")

## trying to plot both together:

plotPolys(shape1) ##produces reasonable looking plot
addPolys(shape2)

## I get the following error message

In .checkProjection(projectionPlot, projectionPoly) :
? The data's 'projection' attribute (LL) differs from the
projection of the plot region (NA).

This leads me to think that the projections are different and thus my downstream calculations of intersection areas will be off. The first shapefile is projected and has the following prj file attached:

PROJCS["Clarke_1866_Lambert_Conformal_Conic",GEOGCS["GCS_Clarke_1866",DATUM["D_Clarke_1866",SPHEROID["Clarke_1866",6378206.4,294.9786982]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Lambert_Conformal_Conic"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",-95.0],PARAMETER["Standard_Parallel_1",49.0],PARAMETER["Standard_Parallel_2",77.0],PARAMETER["Latitude_Of_Origin",49.0],UNIT["Meter",1.0]]

The second shapefile is unprojected and the metadata indicates:
projection parameters: units: decimal degrees
Datum: North America 1983

Since I'm using a MAC and can't figure out how to load rgdal, I have tried importing both shapefiles into QGIS (a separate GIS program), reprojecting them and exporting them from there and re-applying my R code but I get the same error message. Does anyone have any suggestions as to what I might be doing wrong and how I can get these shapefiles into a common projection so that I can calculate the area of their intersection? Thanks in advance for the help!



Alexandre Villers
PhD. Candidate
Team Agripop
CEBC CNRS UPR 1934
79360 Beauvoir sur Niort

Phone: +33 (0)549 099 613 


__________ Information from ESET Mail Security, version of virus signature database 4731 (20091231) __________

The message was checked by ESET Mail Security.
http://www.eset.com


From patrick.giraudoux at univ-fcomte.fr  Thu Dec 31 12:15:04 2009
From: patrick.giraudoux at univ-fcomte.fr (Patrick Giraudoux)
Date: Thu, 31 Dec 2009 12:15:04 +0100
Subject: [R-sig-Geo] color category SpatialGridDataFrame
 SpatialPolygonsDataFrame Corine Land Cover Global Land Cover 2000
In-Reply-To: <4B3C85D7.7050600@cirad.fr>
References: <4B3C702C.8030108@univ-fcomte.fr> <4B3C85D7.7050600@cirad.fr>
Message-ID: <4B3C87B8.5070605@univ-fcomte.fr>

Renaud Lancelot a ?crit :
> Dear Patrick,
>
> I recently met this issue. I finally used image() on the 
> SpatialGridDataFrame, defining the appropriate colors using the col 
> argument (?tonnant, non ;-)). I have defined the legend using 
> legend(), and I used split.screen() to arrange the plots. 

It was my point. In this case, you must have defined many breakpoints 
(to create appropriate intervals for each code) to get all the codes at 
the right color, which is quite tedious, isn't it ? I wonder if this can 
be simplified. Ideally importing a color table. Maybe a new function to 
write (thus to put on the many pending "to do").

> If you wish, I can send you the whole stuff (data and code) in a 
> private message (huge datasets).
I appreciate the proposal, but I was just interested in some general 
principles and advise...

Have a nice evening...

Cheers,

Patrick


>
> Renaud
>
> Patrick Giraudoux a ?crit :
>> Dear all,
>>
>> I am wondering what is the safest way to handle colors when 
>> SpatialGridDataFrame data are categories. spplot() or image() are 
>> extremely convenient when attributes are continuous variables or so 
>> (eg altitude, rainfall, etc...), but the colorRamp() system and the 
>> col.regions, col arguments, though extremely powerful in other cases, 
>> is not really adapted to category data such as Corine LandCover or 
>> Global Land Cover 2000 codes. Thus to link pixels to the right color 
>> may be quite tedious (however I may have missed something...).
>>
>> One option I though about was to change raster into shapefile (or 
>> SpatialGrid into SpatialPolygons objects), but again the straight way 
>> to get right colors is not evident.
>>
>> Any idea ?
>>
>> Patrick
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>


From renaud.lancelot at cirad.fr  Thu Dec 31 12:40:11 2009
From: renaud.lancelot at cirad.fr (Renaud Lancelot)
Date: Thu, 31 Dec 2009 12:40:11 +0100
Subject: [R-sig-Geo] color category SpatialGridDataFrame
 SpatialPolygonsDataFrame Corine Land Cover Global Land Cover 2000
In-Reply-To: <4B3C87B8.5070605@univ-fcomte.fr>
References: <4B3C702C.8030108@univ-fcomte.fr> <4B3C85D7.7050600@cirad.fr>
	<4B3C87B8.5070605@univ-fcomte.fr>
Message-ID: <4B3C8D9B.4040307@cirad.fr>

Patrick Giraudoux a ?crit :
> Renaud Lancelot a ?crit :
>> Dear Patrick,
>>
>> I recently met this issue. I finally used image() on the 
>> SpatialGridDataFrame, defining the appropriate colors using the col 
>> argument (?tonnant, non ;-)). I have defined the legend using 
>> legend(), and I used split.screen() to arrange the plots. 
> 
> It was my point. In this case, you must have defined many breakpoints 
> (to create appropriate intervals for each code) to get all the codes at 
> the right color, which is quite tedious, isn't it ? I wonder if this can 
> be simplified. Ideally importing a color table.

Indeed, that's what I did (the color table was stored in a dbf file).

Happy new year !

Renaud


-- 
Renaud Lancelot
EDEN Project, coordinator
http://www.eden-fp6project.net/
<< EDEN International Conference, Montpellier,  10-12 May 2010 >>
<<   http://international-conference2010.eden-fp6project.net/  >>

UMR CIRAD-INRA "Contr?le des maladies animales exotiques et ?mergentes"
Joint research unit "Control of emerging and exotic animal diseases"

CIRAD, Campus International de Baillarguet TA A-DIR / B
F34398 Montpellier
http://www.cirad.fr  http://bluetongue.cirad.fr/

Tel.  +33 4 67 59 37 17  -  Fax  +33 4 67 59 37 95
Secr. +33 4 67 59 37 37  - Cell. +33 6 77 52 08 69


From patrick.giraudoux at univ-fcomte.fr  Thu Dec 31 12:43:00 2009
From: patrick.giraudoux at univ-fcomte.fr (Patrick Giraudoux)
Date: Thu, 31 Dec 2009 12:43:00 +0100
Subject: [R-sig-Geo] color category SpatialGridDataFrame
 SpatialPolygonsDataFrame Corine Land Cover Global Land Cover 2000
In-Reply-To: <4B3C87B8.5070605@univ-fcomte.fr>
References: <4B3C702C.8030108@univ-fcomte.fr> <4B3C85D7.7050600@cirad.fr>
	<4B3C87B8.5070605@univ-fcomte.fr>
Message-ID: <4B3C8E44.2070805@univ-fcomte.fr>

Patrick Giraudoux a ?crit :
> Renaud Lancelot a ?crit :
>> Dear Patrick,
>>
>> I recently met this issue. I finally used image() on the 
>> SpatialGridDataFrame, defining the appropriate colors using the col 
>> argument (?tonnant, non ;-)). I have defined the legend using 
>> legend(), and I used split.screen() to arrange the plots. 
>
> It was my point. In this case, you must have defined many breakpoints 
> (to create appropriate intervals for each code) to get all the codes 
> at the right color, which is quite tedious, isn't it ? I wonder if 
> this can be simplified. Ideally importing a color table. Maybe a new 
> function to write (thus to put on the many pending "to do").
>

PS: by the way if you connect to http://pagesperso-orange.fr/giraudoux/, 
you can download an unofficial package 'pgirbric' (when I am sure things 
work well I move them to pgirmess). I have written some functions (based 
on splancs and sp) to extract info from rasters using buffer centred on 
points or polygons. A quite common business in my field of ecology but 
with no programmes (to my knowledge) doing it easy. The latest one are 
on the development version (I had quite busy Xmas vacation playing on 
Alevolar echinococcosis distribution in China).

Cheers,

Patrick


From patrick.giraudoux at univ-fcomte.fr  Thu Dec 31 12:48:04 2009
From: patrick.giraudoux at univ-fcomte.fr (Patrick Giraudoux)
Date: Thu, 31 Dec 2009 12:48:04 +0100
Subject: [R-sig-Geo] color category SpatialGridDataFrame
 SpatialPolygonsDataFrame Corine Land Cover Global Land Cover 2000
In-Reply-To: <4B3C87B8.5070605@univ-fcomte.fr>
References: <4B3C702C.8030108@univ-fcomte.fr> <4B3C85D7.7050600@cirad.fr>
	<4B3C87B8.5070605@univ-fcomte.fr>
Message-ID: <4B3C8F74.8080308@univ-fcomte.fr>

Patrick Giraudoux a ?crit :
> Renaud Lancelot a ?crit :
>> Dear Patrick,
>>
>> I recently met this issue. I finally used image() on the 
>> SpatialGridDataFrame, defining the appropriate colors using the col 
>> argument (?tonnant, non ;-)). I have defined the legend using 
>> legend(), and I used split.screen() to arrange the plots. 
>
> It was my point. In this case, you must have defined many breakpoints 
> (to create appropriate intervals for each code) to get all the codes 
> at the right color, which is quite tedious, isn't it ? I wonder if 
> this can be simplified. Ideally importing a color table. Maybe a new 
> function to write (thus to put on the many pending "to do").
>

PS: by the way, Renaud, if you connect to 
http://pagesperso-orange.fr/giraudoux/, you can download an unofficial 
package 'pgirbric' (when I am sure things work well I move them to 
pgirmess). I have written some functions (based on splancs and sp) to 
extract info from rasters using buffer centred on points or polygons. A 
quite common business in my field of ecology but with no programmes (to 
my knowledge) doing it easy. The latest functions are on the development 
version pgirbric 1.1.4 (I had quite busy Xmas vacation playing on 
Alevolar echinococcosis distribution in China).

Feed-back and suggestions appreciated if they are usable to your own work.

sp, splancs, maptools, spdep, rgdal, etc... are really great things ! 
GRASS and QGIS also.

Cheers,

Patrick


