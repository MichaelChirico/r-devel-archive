From RRoa at fisheries.gov.fk  Tue May  3 13:44:05 2005
From: RRoa at fisheries.gov.fk (Ruben Roa)
Date: Tue, 3 May 2005 09:44:05 -0200
Subject: [R-sig-Geo] Problem with BCtransform?
Message-ID: <AEF7C40954294D42990B3F90C6C73A450101650F@figmail.fig.fk>

Hi:

In geoR, when using BCtransform to back-transform the beta parameter into the 
space of the original data, like in

>mean(BCtransform(rnorm(5000,mean=likfitobject$beta,sd=sqrt(likfitobject$beta.var)),lambda=XXX,inverse=TRUE))

i have noticed (in two applications) that the value of this mean is much smaller (2.3 and 3.4 times smaller) than
the mean of the kriged predictions, obtained with

>mean(krig.object$predict)

even though geoR performs the back-transformation before kriging.

I would have thought that the two means (from back-transformed beta and from kriged predictions) would be
fairly similar. Of the two means the one that is closer to the mean of the raw data is the mean of the kriged 
predictions so i wonder maybe there is some problem with the BCtransform function when called by the
user? Or maybe there is something fundamental that i don't understand about the beta parameter (and thus its
back-transform)?

Thanks for clarifications.

Ruben



From RRoa at fisheries.gov.fk  Tue May  3 20:32:50 2005
From: RRoa at fisheries.gov.fk (Ruben Roa)
Date: Tue, 3 May 2005 16:32:50 -0200
Subject: [R-sig-Geo] Problem with BCtransform?
Message-ID: <AEF7C40954294D42990B3F90C6C73A4501016510@figmail.fig.fk>

> -----Original Message-----
> From: r-sig-geo-bounces at stat.math.ethz.ch
> [mailto:r-sig-geo-bounces at stat.math.ethz.ch]On Behalf Of Ruben Roa
> Sent: 03 May 2005 10:44
> To: R-sig-Geo at stat.math.ethz.ch
> Subject: [R-sig-Geo] Problem with BCtransform?
> 
> 
> Hi:
> 
> In geoR, when using BCtransform to back-transform the beta 
> parameter into the space of the original data, like in
> 
> >mean(BCtransform(rnorm(5000,mean=likfitobject$beta,sd=sqrt(li
> kfitobject$beta.var)),lambda=XXX,inverse=TRUE))
> 
> i have noticed (in two applications) that the value of this 
> mean is much smaller (2.3 and 3.4 times smaller) than
> the mean of the kriged predictions, obtained with
> 
> >mean(krig.object$predict)
> 
> even though geoR performs the back-transformation before kriging.
> 
> I would have thought that the two means (from 
> back-transformed beta and from kriged predictions) would be
> fairly similar. Of the two means the one that is closer to 
> the mean of the raw data is the mean of the kriged 
> predictions so i wonder maybe there is some problem with the 
> BCtransform function when called by the
> user? Or maybe there is something fundamental that i don't 
> understand about the beta parameter (and thus its
> back-transform)?
> 
> Thanks for clarifications.

Because the kriging predictions are close to the actual values of
the raw data, and these kriged predictions have been computed by back-
transforming using the estimated lambda in the Box-Cox distribution,
i must conclude that the problem of the difference between the back-
transform of beta and the mean of the kriged predictions lies in the
value of beta itself. Why is beta substantially lower in my two 
applications in relation to the value that it should be if its back
transform were to be close to the mean of the raw data and to the mean
of the kriged predictions?
R.



From reeves at nceas.ucsb.edu  Mon May  9 22:14:24 2005
From: reeves at nceas.ucsb.edu (Rick Reeves)
Date: Mon, 9 May 2005 13:14:24 -0700
Subject: [R-sig-Geo] Recursive user-defined methods in R scripts - upper
	bound on nested calls?
Message-ID: <000801c554d3$b17a44a0$8bdc6f80@BURAN>

	

Heres a question regarding R script development:

First, the scenario - 
I'm working on a method to aggregate voronoi cells
into larger polygons based on a scoring criteria;
part of the solution now uses a recursive R function
(written in R script). The calling program fails 
unceremoniously (no messages, just 'into the ether')
after about 50 nested recursive calls. Looks like a 
stack overflow to me, but I am now checking my dataset
for anomolies that may cause the failure.

I seem to recal recursive C routines crashing after
50 or so nested calls on Unix workstations, so this
may be unavoidable

The question: Has anyone explored the limits of 
recursive R function calls? I coded the recursive 
method to have a minimal run-time memory footprint. 

Is there a way to ask for more resources (stack space)
in the R run-time environment? 

Any thoughts are welcome!

Regards, 
Rick Reeves

Scientific Programmer / Quantitative Analyst
National Center for Ecological Analysis and Synthesis
University of California, Santa Barbara
805 892 2534
reeves at nceas.ucsb.edu



From B.Rowlingson at lancaster.ac.uk  Mon May  9 23:04:55 2005
From: B.Rowlingson at lancaster.ac.uk (Baz)
Date: Mon, 09 May 2005 22:04:55 +0100
Subject: [R-sig-Geo] Recursive user-defined methods in R scripts - upper
	bound on nested calls?
In-Reply-To: <000801c554d3$b17a44a0$8bdc6f80@BURAN>
References: <000801c554d3$b17a44a0$8bdc6f80@BURAN>
Message-ID: <427FD077.7050704@lancaster.ac.uk>

Rick Reeves wrote:

> 
> The question: Has anyone explored the limits of 
> recursive R function calls? I coded the recursive 
> method to have a minimal run-time memory footprint. 

  There's a limit on how deep expressions can go:

  > recurse
  function(n){if(n==1){return(0)}else{return(recurse(n-1))}}

  > recurse(99)
  [1] 0

  but this usually gives an error when it goes too far:

  > recurse(100)
  Error in recurse(n - 1) : evaluation nested too deeply: infinite 
recursion / options(expression=)?

> Is there a way to ask for more resources (stack space)
> in the R run-time environment? 

  > options(expressions=1000)
  > recurse(100)
  [1] 0

Might not explain why your code dies silently, unless the error is being 
trapped inside a 'try'...

Baz



From RRoa at fisheries.gov.fk  Wed May 11 17:43:37 2005
From: RRoa at fisheries.gov.fk (Ruben Roa)
Date: Wed, 11 May 2005 13:43:37 -0200
Subject: [R-sig-Geo] Image funct doesn't plot final matrix (after
	RandomFields' GaussRF)
Message-ID: <AEF7C40954294D42990B3F90C6C73A450101652E@figmail.fig.fk>

Hi people:
I wrote the code below to create N.sim random fields with RandomFields' 
GaussRF, in which a proportion of rows and columns (given by prow and 
pcol) are replaced by rows and columns of zeroes.
My problem is that with any simulation output when i use
image(x,y,mcola) instead of a plot with some random bands and columns of zeros 
i get a plot of the matrix as it comes out of GaussRF, full with positive realizations.
When i check the files written on the disk though (called mcolasim3.1, etc)
they do have the bands and columns of zeros i intended them to have.
Why is not image using the latest matrix (after the two final for-loops) instead
of the matrix coming untouched from GaussRF?
Thanks in advance,
Ruben

###########
function(N.sim,pcol,prow){
x<-seq(1,180,1)
y<-seq(1,540,1)
param<-c(6.63,2.24,1.82,4.36)
names(param)<-c("beta","sigmasq","tausq","varphi")
for(i in 1:N.sim){
                       mcola<-GaussRF(x=x,y=y,param=param,grid=TRUE,model="gauss")
                       for(j in 1:540){
                                          if(runif(1)<prow) mcola[,j]<-mcola[,j] else mcola[,j]<-mat.or.vec(180,1)
                                          }
                       for(k in 1:180){
                                          if(runif(1)<pcol) mcola[k,]<-mcola[k,] else mcola[k,]<-t(mat.or.vec(540,1))
                                          }
                                          file.out<-paste("mcolasim3",i,sep=".")
                                          write(t(mcola),file.out,ncol=ncol(t(mcola)))
                                          }
                       }
#############



From reeves at nceas.ucsb.edu  Wed May 11 19:46:00 2005
From: reeves at nceas.ucsb.edu (Rick Reeves)
Date: Wed, 11 May 2005 10:46:00 -0700
Subject: [R-sig-Geo] maptools package rejects some polygon shapefiles?
Message-ID: <000501c55651$4b5b9500$8bdc6f80@BURAN>



Greetings: 

Using maptools in the Win XP environment, trying to
display an ESRI Shapefile (created with ArcMAP GIS ver 9)
outline map of North America. read.shape throws error:
Error in read.shape: Not a valid shape type. 

read.sahpe does read (and plot displays) a point shapefile 
created on the same platform. 

Any hints on determining the problem with 'not valid' shapefiles
in R? 

Thanks, 
Rick R


Scientific Programmer / Quantitative Analyst
National Center for Ecological Analysis and Synthesis
University of California, Santa Barbara
805 892 2534
reeves at nceas.ucsb.edu



From reeves at nceas.ucsb.edu  Wed May 11 19:57:03 2005
From: reeves at nceas.ucsb.edu (Rick Reeves)
Date: Wed, 11 May 2005 10:57:03 -0700
Subject: [R-sig-Geo] maptools package rejects some polygon shapefiles?
In-Reply-To: <000501c55651$4b5b9500$8bdc6f80@BURAN>
Message-ID: <000701c55652$d6a5e330$8bdc6f80@BURAN>

News flash: the read.shapefile() method in the shapefiles package reads
the file. 

btw, this is a shapefile based on the VMAP0 / DCW dataset.

RR

Scientific Programmer / Quantitative Analyst
National Center for Ecological Analysis and Synthesis
University of California, Santa Barbara
805 892 2534
reeves at nceas.ucsb.edu



-----Original Message-----
From: r-sig-geo-bounces at stat.math.ethz.ch
[mailto:r-sig-geo-bounces at stat.math.ethz.ch] On Behalf Of Rick Reeves
Sent: Wednesday, May 11, 2005 9:46 AM
To: r-sig-geo at stat.math.ethz.ch
Subject: [R-sig-Geo] maptools package rejects some polygon shapefiles?




Greetings: 

Using maptools in the Win XP environment, trying to
display an ESRI Shapefile (created with ArcMAP GIS ver 9)
outline map of North America. read.shape throws error:
Error in read.shape: Not a valid shape type. 

read.sahpe does read (and plot displays) a point shapefile 
created on the same platform. 

Any hints on determining the problem with 'not valid' shapefiles
in R? 

Thanks, 
Rick R


Scientific Programmer / Quantitative Analyst
National Center for Ecological Analysis and Synthesis
University of California, Santa Barbara
805 892 2534
reeves at nceas.ucsb.edu

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at stat.math.ethz.ch
https://stat.ethz.ch/mailman/listinfo/r-sig-geo



From Roger.Bivand at nhh.no  Wed May 11 22:07:59 2005
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 11 May 2005 22:07:59 +0200 (CEST)
Subject: [R-sig-Geo] maptools package rejects some polygon shapefiles?
In-Reply-To: <000701c55652$d6a5e330$8bdc6f80@BURAN>
Message-ID: <Pine.LNX.4.44.0505112200360.10380-100000@reclus.nhh.no>

On Wed, 11 May 2005, Rick Reeves wrote:

> News flash: the read.shapefile() method in the shapefiles package reads
> the file. 

It would be useful to see what getinfo.shape(filen) says, and to have a 
sight of the file. The error message suggests that it is neither type 3 
(PolyLine) nor type 5 (Polygon), so ArcGIS 9 must be using other codes 
(perhaps for PolyLineM, PolyLineeM, or their polygon equivalents). If you 
could make the file available, it may be possible to try to handle files 
like this (benefitting others, since you have a working solution).

Roger

> 
> btw, this is a shapefile based on the VMAP0 / DCW dataset.
> 
> RR
> 
> Scientific Programmer / Quantitative Analyst
> National Center for Ecological Analysis and Synthesis
> University of California, Santa Barbara
> 805 892 2534
> reeves at nceas.ucsb.edu
> 
> 
> 
> -----Original Message-----
> From: r-sig-geo-bounces at stat.math.ethz.ch
> [mailto:r-sig-geo-bounces at stat.math.ethz.ch] On Behalf Of Rick Reeves
> Sent: Wednesday, May 11, 2005 9:46 AM
> To: r-sig-geo at stat.math.ethz.ch
> Subject: [R-sig-Geo] maptools package rejects some polygon shapefiles?
> 
> 
> 
> 
> Greetings: 
> 
> Using maptools in the Win XP environment, trying to
> display an ESRI Shapefile (created with ArcMAP GIS ver 9)
> outline map of North America. read.shape throws error:
> Error in read.shape: Not a valid shape type. 
> 
> read.sahpe does read (and plot displays) a point shapefile 
> created on the same platform. 
> 
> Any hints on determining the problem with 'not valid' shapefiles
> in R? 
> 
> Thanks, 
> Rick R
> 
> 
> Scientific Programmer / Quantitative Analyst
> National Center for Ecological Analysis and Synthesis
> University of California, Santa Barbara
> 805 892 2534
> reeves at nceas.ucsb.edu
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From stanimura-ngs at umin.ac.jp  Thu May 12 03:59:23 2005
From: stanimura-ngs at umin.ac.jp (Susumu Tanimura)
Date: Thu, 12 May 2005 10:59:23 +0900
Subject: [R-sig-Geo] Error to load rgdal
Message-ID: <20050512105923.00baf6dc.stanimura-ngs@umin.ac.jp>

Hi, there

Failure of loading rgdal 0.2-7 gives me the following message.

> library(rgdal)
Loading required package: abind
Loading required package: pixmap
Error in dyn.load(x, as.logical(local), as.logical(now)) : 
        unable to load shared library '/usr/lib/R/library/rgdal/libs/rgdal.so':
  /usr/lib/R/library/rgdal/libs/rgdal.so: undefined symbol: DGifCloseFile
Error in library(rgdal) : .First.lib failed for 'rgdal'

This trial was conducted on R 2.1.0 on VineLinux 3.1.
$ rpm -q R gdal
R-2.1.0-0vl1
gdal-1.2.6-0vl1
$ ls /usr/lib/R/library/rgdal/libs/rgdal.so
/usr/lib/R/library/rgdal/libs/rgdal.so*

It is happy to give me some advice.



From elw at stderr.org  Thu May 12 04:24:17 2005
From: elw at stderr.org (elijah wright)
Date: Wed, 11 May 2005 21:24:17 -0500 (CDT)
Subject: [R-sig-Geo] Error to load rgdal
In-Reply-To: <20050512105923.00baf6dc.stanimura-ngs@umin.ac.jp>
References: <20050512105923.00baf6dc.stanimura-ngs@umin.ac.jp>
Message-ID: <Pine.LNX.4.62.0505112123040.8168@illuminati.stderr.org>


> $ ls /usr/lib/R/library/rgdal/libs/rgdal.so
> /usr/lib/R/library/rgdal/libs/rgdal.so*
>
> It is happy to give me some advice.

what is the output of running

`ldd /usr/lib/R/library/rgdal/libs/rgdal.so`  ?


that may provide some further hints.  based on the error, you are probably 
missing a library dependency.

--elijah



From stanimura-ngs at umin.ac.jp  Thu May 12 06:35:17 2005
From: stanimura-ngs at umin.ac.jp (Susumu Tanimura)
Date: Thu, 12 May 2005 13:35:17 +0900
Subject: [R-sig-Geo] Error to load rgdal
In-Reply-To: <Pine.LNX.4.62.0505112123040.8168@illuminati.stderr.org>
References: <20050512105923.00baf6dc.stanimura-ngs@umin.ac.jp>
	<Pine.LNX.4.62.0505112123040.8168@illuminati.stderr.org>
Message-ID: <20050512133517.1f5f1797.stanimura-ngs@umin.ac.jp>

Dear elijah

Thank you very much for your reply.

$ ldd /usr/lib/R/library/rgdal/libs/rgdal.so
        libR.so => not found
        libstdc++.so.5 => /usr/lib/libstdc++.so.5 (0x40276000)
        libm.so.6 => /lib/i686/libm.so.6 (0x4032e000)
        libgcc_s.so.1 => /lib/libgcc_s.so.1 (0x40350000)
        libc.so.6 => /lib/i686/libc.so.6 (0x40358000)
        /lib/ld-linux.so.2 => /lib/ld-linux.so.2 (0x80000000)
$ locate libR.so
/usr/lib/R/lib/libR.so

So, I added /usr/lib/R/lib in /etc/ld.co.conf and did /sbin/ldconfig.
Then the result of ldd was changed.

$ ldd /usr/lib/R/library/rgdal/libs/rgdal.so
        libR.so => /usr/lib/R/lib/libR.so (0x40276000)
        libstdc++.so.5 => /usr/lib/libstdc++.so.5 (0x404f2000)
        libm.so.6 => /lib/i686/libm.so.6 (0x405aa000)
        libgcc_s.so.1 => /lib/libgcc_s.so.1 (0x405cc000)
        libc.so.6 => /lib/i686/libc.so.6 (0x405d4000)
        libg2c.so.0 => /usr/lib/libg2c.so.0 (0x4070f000)
        libreadline.so.4 => /usr/lib/libreadline.so.4 (0x4072d000)
        libncurses.so.5 => /usr/lib/libncurses.so.5 (0x40759000)
        libdl.so.2 => /lib/libdl.so.2 (0x40799000)
        /lib/ld-linux.so.2 => /lib/ld-linux.so.2 (0x80000000)
        libgpm.so.1 => /usr/lib/libgpm.so.1 (0x4079c000)

Nevertheless, there is the same failure.

> library(rgdal)
Loading required package: abind
Loading required package: pixmap
Error in dyn.load(x, as.logical(local), as.logical(now)) : 
        unable to load shared library '/usr/lib/R/library/rgdal/libs/rgdal.so':
  /usr/lib/R/library/rgdal/libs/rgdal.so: undefined symbol: DGifCloseFile
Error in library(rgdal) : .First.lib failed for 'rgdal'

Could you give me further advice?

--
Susumu Tanimura



From Roger.Bivand at nhh.no  Thu May 12 10:39:15 2005
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 12 May 2005 10:39:15 +0200 (CEST)
Subject: [R-sig-Geo] Error to load rgdal
In-Reply-To: <20050512133517.1f5f1797.stanimura-ngs@umin.ac.jp>
Message-ID: <Pine.LNX.4.44.0505121034010.11044-100000@reclus.nhh.no>

On Thu, 12 May 2005, Susumu Tanimura wrote:

> Dear elijah
> 
> Thank you very much for your reply.
> 
> $ ldd /usr/lib/R/library/rgdal/libs/rgdal.so
>         libR.so => not found
>         libstdc++.so.5 => /usr/lib/libstdc++.so.5 (0x40276000)
>         libm.so.6 => /lib/i686/libm.so.6 (0x4032e000)
>         libgcc_s.so.1 => /lib/libgcc_s.so.1 (0x40350000)
>         libc.so.6 => /lib/i686/libc.so.6 (0x40358000)
>         /lib/ld-linux.so.2 => /lib/ld-linux.so.2 (0x80000000)
> $ locate libR.so
> /usr/lib/R/lib/libR.so
> 
> So, I added /usr/lib/R/lib in /etc/ld.co.conf and did /sbin/ldconfig.
> Then the result of ldd was changed.
> 
> $ ldd /usr/lib/R/library/rgdal/libs/rgdal.so
>         libR.so => /usr/lib/R/lib/libR.so (0x40276000)
>         libstdc++.so.5 => /usr/lib/libstdc++.so.5 (0x404f2000)
>         libm.so.6 => /lib/i686/libm.so.6 (0x405aa000)
>         libgcc_s.so.1 => /lib/libgcc_s.so.1 (0x405cc000)
>         libc.so.6 => /lib/i686/libc.so.6 (0x405d4000)
>         libg2c.so.0 => /usr/lib/libg2c.so.0 (0x4070f000)
>         libreadline.so.4 => /usr/lib/libreadline.so.4 (0x4072d000)
>         libncurses.so.5 => /usr/lib/libncurses.so.5 (0x40759000)
>         libdl.so.2 => /lib/libdl.so.2 (0x40799000)
>         /lib/ld-linux.so.2 => /lib/ld-linux.so.2 (0x80000000)
>         libgpm.so.1 => /usr/lib/libgpm.so.1 (0x4079c000)
> 
> Nevertheless, there is the same failure.
> 
> > library(rgdal)
> Loading required package: abind
> Loading required package: pixmap
> Error in dyn.load(x, as.logical(local), as.logical(now)) : 
>         unable to load shared library '/usr/lib/R/library/rgdal/libs/rgdal.so':
>   /usr/lib/R/library/rgdal/libs/rgdal.so: undefined symbol: DGifCloseFile
> Error in library(rgdal) : .First.lib failed for 'rgdal'
> 
> Could you give me further advice?

What does:

$ gdalinfo --version
GDAL 1.2.6.0, released 2005/03/13

report for you? I do not think you have installed GDAL properly, my ldd on 
rgdal.so lists libgdal.so and its (many) dependencies, these are missing 
for you (the dependency on R is not at all necessary):

$ ldd /home/rsb/topics/Ris210/lib/R/library/rgdal/libs/rgdal.
so
        libgdal.so.1 => /usr/local/lib/libgdal.so.1 (0x003f0000)
        libstdc++.so.5 => /usr/lib/libstdc++.so.5 (0x00bcb000)
        libm.so.6 => /lib/tls/libm.so.6 (0x00335000)
        libgcc_s.so.1 => /lib/libgcc_s.so.1 (0x002e7000)
        libc.so.6 => /lib/tls/libc.so.6 (0x00111000)
        libodbc.so.1 => /usr/lib/libodbc.so.1 (0x00d86000)
        libungif.so.4 => /usr/lib/libungif.so.4 (0x00249000)
        libjpeg.so.62 => /usr/lib/libjpeg.so.62 (0x00935000)
        libpng12.so.0 => /usr/lib/libpng12.so.0 (0x00251000)
        libz.so.1 => /usr/lib/libz.so.1 (0x008ba000)
        libdl.so.2 => /lib/libdl.so.2 (0x00bb0000)
        libpq.so.3 => /usr/lib/libpq.so.3 (0x0095c000)
        /lib/ld-linux.so.2 => /lib/ld-linux.so.2 (0x00312000)
        libpthread.so.0 => /lib/tls/libpthread.so.0 (0x00274000)
        libX11.so.6 => /usr/X11R6/lib/libX11.so.6 (0x0072e000)
        libssl.so.4 => /lib/libssl.so.4 (0x00284000)
        libcrypto.so.4 => /lib/libcrypto.so.4 (0x00971000)
        libkrb5.so.3 => /usr/kerberos/lib/libkrb5.so.3 (0x00357000)
        libcrypt.so.1 => /lib/libcrypt.so.1 (0x003b5000)
        libresolv.so.2 => /lib/libresolv.so.2 (0x002b8000)
        libnsl.so.1 => /lib/libnsl.so.1 (0x00c92000)
        libgssapi_krb5.so.2 => /usr/kerberos/lib/libgssapi_krb5.so.2 (0x00d10000)
        libcom_err.so.3 => /usr/kerberos/lib/libcom_err.so.3 (0x002ca000)
        libk5crypto.so.3 => /usr/kerberos/lib/libk5crypto.so.3 (0x00cd4000)

It is almost never a good idea to install binary on Linux, almost always a 
good idea to install GDAL from source, then install rgdal from source, 
which is simple:

> install.packages("rgdal")

which then makes sure that all the bits and pieces are lined up correctly.

Please let the list know if this helps.

Roger


> 
> --
> Susumu Tanimura
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From Roger.Bivand at nhh.no  Thu May 12 10:58:31 2005
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 12 May 2005 10:58:31 +0200 (CEST)
Subject: [R-sig-Geo] maptools package rejects some polygon shapefiles? 
In-Reply-To: <000d01c55668$d9408940$8bdc6f80@BURAN>
Message-ID: <Pine.LNX.4.44.0505121055521.11044-100000@reclus.nhh.no>

On Wed, 11 May 2005, Rick Reeves wrote:

> 
> Roger: 
> 
> Thanks for the quick response. Here is the file, 
> and I will follow your suggestions.....
> The ArcCatalog metadata section claims that this
> is a Simple Polygon file, Topology FALSE,
> feature count 558, spatial index = TRUE, 
> Linear Referencing = TRUE, geographic coord system


Rick:

(I'm replying to the list too to ask for comments)

The file is recognised by ogrinfo as:

$ ogrinfo NorthAmericaBest.shp
INFO: Open of `NorthAmericaBest.shp'
using driver `ESRI Shapefile' successful.
1: NorthAmericaBest (3D Polygon)

It should not be too difficult to change read.shape to read 3D points as 
3D, and 3D lines and polygons as 2D. I guess that stripping the Z values 
is not a problem for anybody (excepting points I think)?

Thanks for your help - with a sample file to study, making this work will 
be much easier. Does anyone have 3D lines and 3D points files?

Best wishes,

Roger


> 
> Regards,
> Rick R
> 
> 
> Scientific Programmer / Quantitative Analyst
> National Center for Ecological Analysis and Synthesis
> University of California, Santa Barbara
> 805 892 2534
> reeves at nceas.ucsb.edu
> 
> 
> 
> -----Original Message-----
> From: Roger Bivand [mailto:Roger.Bivand at nhh.no] 
> Sent: Wednesday, May 11, 2005 12:08 PM
> To: Rick Reeves
> Cc: r-sig-geo at stat.math.ethz.ch
> Subject: RE: [R-sig-Geo] maptools package rejects some polygon
> shapefiles?
> 
> 
> On Wed, 11 May 2005, Rick Reeves wrote:
> 
> > News flash: the read.shapefile() method in the shapefiles package
> reads
> > the file. 
> 
> It would be useful to see what getinfo.shape(filen) says, and to have a 
> sight of the file. The error message suggests that it is neither type 3 
> (PolyLine) nor type 5 (Polygon), so ArcGIS 9 must be using other codes 
> (perhaps for PolyLineM, PolyLineeM, or their polygon equivalents). If
> you 
> could make the file available, it may be possible to try to handle files
> 
> like this (benefitting others, since you have a working solution).
> 
> Roger
> 
> > 
> > btw, this is a shapefile based on the VMAP0 / DCW dataset.
> > 
> > RR
> > 
> > Scientific Programmer / Quantitative Analyst
> > National Center for Ecological Analysis and Synthesis
> > University of California, Santa Barbara
> > 805 892 2534
> > reeves at nceas.ucsb.edu
> > 
> > 
> > 
> > -----Original Message-----
> > From: r-sig-geo-bounces at stat.math.ethz.ch
> > [mailto:r-sig-geo-bounces at stat.math.ethz.ch] On Behalf Of Rick Reeves
> > Sent: Wednesday, May 11, 2005 9:46 AM
> > To: r-sig-geo at stat.math.ethz.ch
> > Subject: [R-sig-Geo] maptools package rejects some polygon shapefiles?
> > 
> > 
> > 
> > 
> > Greetings: 
> > 
> > Using maptools in the Win XP environment, trying to
> > display an ESRI Shapefile (created with ArcMAP GIS ver 9)
> > outline map of North America. read.shape throws error:
> > Error in read.shape: Not a valid shape type. 
> > 
> > read.sahpe does read (and plot displays) a point shapefile 
> > created on the same platform. 
> > 
> > Any hints on determining the problem with 'not valid' shapefiles
> > in R? 
> > 
> > Thanks, 
> > Rick R
> > 
> > 
> > Scientific Programmer / Quantitative Analyst
> > National Center for Ecological Analysis and Synthesis
> > University of California, Santa Barbara
> > 805 892 2534
> > reeves at nceas.ucsb.edu
> > 
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at stat.math.ethz.ch
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > 
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at stat.math.ethz.ch
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > 
> 
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From tkeitt at mail.utexas.edu  Thu May 12 16:40:21 2005
From: tkeitt at mail.utexas.edu (Tim Keitt)
Date: Thu, 12 May 2005 09:40:21 -0500
Subject: [R-sig-Geo] Error to load rgdal
In-Reply-To: <Pine.LNX.4.44.0505121034010.11044-100000@reclus.nhh.no>
References: <Pine.LNX.4.44.0505121034010.11044-100000@reclus.nhh.no>
Message-ID: <1115908821.16605.6.camel@fosteri.keittlab.net>

I've had good luck in the past with binary GDAL rpm's and rgdal on
Fedora. (I've since switched to Gentoo which compiles everything from
source, so this sort of thing almost never happens. Oh, and GDAL is in
portage stable.)

The most likely culprit is changes to the underlying libraries. You may
have to try a few versions of GDAL, libgif, libtif, etc. It looks like
the missing symbol might belong to libgif. Is it installed? Also, can
you use gdalinfo on a gif or tif file? We probably do need to add some
checks on the GDAL version being compiled against. Its api has changed
on past occasions breaking rgdal.

THK

On Thu, 2005-05-12 at 10:39 +0200, Roger Bivand wrote:
> On Thu, 12 May 2005, Susumu Tanimura wrote:
> 
> > Dear elijah
> > 
> > Thank you very much for your reply.
> > 
> > $ ldd /usr/lib/R/library/rgdal/libs/rgdal.so
> >         libR.so => not found
> >         libstdc++.so.5 => /usr/lib/libstdc++.so.5 (0x40276000)
> >         libm.so.6 => /lib/i686/libm.so.6 (0x4032e000)
> >         libgcc_s.so.1 => /lib/libgcc_s.so.1 (0x40350000)
> >         libc.so.6 => /lib/i686/libc.so.6 (0x40358000)
> >         /lib/ld-linux.so.2 => /lib/ld-linux.so.2 (0x80000000)
> > $ locate libR.so
> > /usr/lib/R/lib/libR.so
> > 
> > So, I added /usr/lib/R/lib in /etc/ld.co.conf and did /sbin/ldconfig.
> > Then the result of ldd was changed.
> > 
> > $ ldd /usr/lib/R/library/rgdal/libs/rgdal.so
> >         libR.so => /usr/lib/R/lib/libR.so (0x40276000)
> >         libstdc++.so.5 => /usr/lib/libstdc++.so.5 (0x404f2000)
> >         libm.so.6 => /lib/i686/libm.so.6 (0x405aa000)
> >         libgcc_s.so.1 => /lib/libgcc_s.so.1 (0x405cc000)
> >         libc.so.6 => /lib/i686/libc.so.6 (0x405d4000)
> >         libg2c.so.0 => /usr/lib/libg2c.so.0 (0x4070f000)
> >         libreadline.so.4 => /usr/lib/libreadline.so.4 (0x4072d000)
> >         libncurses.so.5 => /usr/lib/libncurses.so.5 (0x40759000)
> >         libdl.so.2 => /lib/libdl.so.2 (0x40799000)
> >         /lib/ld-linux.so.2 => /lib/ld-linux.so.2 (0x80000000)
> >         libgpm.so.1 => /usr/lib/libgpm.so.1 (0x4079c000)
> > 
> > Nevertheless, there is the same failure.
> > 
> > > library(rgdal)
> > Loading required package: abind
> > Loading required package: pixmap
> > Error in dyn.load(x, as.logical(local), as.logical(now)) : 
> >         unable to load shared library '/usr/lib/R/library/rgdal/libs/rgdal.so':
> >   /usr/lib/R/library/rgdal/libs/rgdal.so: undefined symbol: DGifCloseFile
> > Error in library(rgdal) : .First.lib failed for 'rgdal'
> > 
> > Could you give me further advice?
> 
> What does:
> 
> $ gdalinfo --version
> GDAL 1.2.6.0, released 2005/03/13
> 
> report for you? I do not think you have installed GDAL properly, my ldd on 
> rgdal.so lists libgdal.so and its (many) dependencies, these are missing 
> for you (the dependency on R is not at all necessary):
> 
> $ ldd /home/rsb/topics/Ris210/lib/R/library/rgdal/libs/rgdal.
> so
>         libgdal.so.1 => /usr/local/lib/libgdal.so.1 (0x003f0000)
>         libstdc++.so.5 => /usr/lib/libstdc++.so.5 (0x00bcb000)
>         libm.so.6 => /lib/tls/libm.so.6 (0x00335000)
>         libgcc_s.so.1 => /lib/libgcc_s.so.1 (0x002e7000)
>         libc.so.6 => /lib/tls/libc.so.6 (0x00111000)
>         libodbc.so.1 => /usr/lib/libodbc.so.1 (0x00d86000)
>         libungif.so.4 => /usr/lib/libungif.so.4 (0x00249000)
>         libjpeg.so.62 => /usr/lib/libjpeg.so.62 (0x00935000)
>         libpng12.so.0 => /usr/lib/libpng12.so.0 (0x00251000)
>         libz.so.1 => /usr/lib/libz.so.1 (0x008ba000)
>         libdl.so.2 => /lib/libdl.so.2 (0x00bb0000)
>         libpq.so.3 => /usr/lib/libpq.so.3 (0x0095c000)
>         /lib/ld-linux.so.2 => /lib/ld-linux.so.2 (0x00312000)
>         libpthread.so.0 => /lib/tls/libpthread.so.0 (0x00274000)
>         libX11.so.6 => /usr/X11R6/lib/libX11.so.6 (0x0072e000)
>         libssl.so.4 => /lib/libssl.so.4 (0x00284000)
>         libcrypto.so.4 => /lib/libcrypto.so.4 (0x00971000)
>         libkrb5.so.3 => /usr/kerberos/lib/libkrb5.so.3 (0x00357000)
>         libcrypt.so.1 => /lib/libcrypt.so.1 (0x003b5000)
>         libresolv.so.2 => /lib/libresolv.so.2 (0x002b8000)
>         libnsl.so.1 => /lib/libnsl.so.1 (0x00c92000)
>         libgssapi_krb5.so.2 => /usr/kerberos/lib/libgssapi_krb5.so.2 (0x00d10000)
>         libcom_err.so.3 => /usr/kerberos/lib/libcom_err.so.3 (0x002ca000)
>         libk5crypto.so.3 => /usr/kerberos/lib/libk5crypto.so.3 (0x00cd4000)
> 
> It is almost never a good idea to install binary on Linux, almost always a 
> good idea to install GDAL from source, then install rgdal from source, 
> which is simple:
> 
> > install.packages("rgdal")
> 
> which then makes sure that all the bits and pieces are lined up correctly.
> 
> Please let the list know if this helps.
> 
> Roger
> 
> 
> > 
> > --
> > Susumu Tanimura
> > 
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at stat.math.ethz.ch
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > 
> 
-- 
Tim Keitt
Section of Integrative Biology
http://www.keittlab.org/



From nikko at hailmail.net  Thu May 12 17:55:32 2005
From: nikko at hailmail.net (Nicholas Lewin-Koh)
Date: Thu, 12 May 2005 10:55:32 -0500
Subject: Subject: RE: [R-sig-Geo] maptools package rejects some polygon
	shapefiles?
Message-ID: <1115913332.8812.233992451@webmail.messagingengine.com>

Hi,
Wouldn't it make more sense to handle 3d file as 3d?
In outher words store 3d poionts as 3d points. For dealing 
with this in R, we could write methods that would display the 
3rd dimension as an attribute. I don't think it would be hard to change
the
underlying C code to reade shape 3d files. I think the challange would
be in the
R data structure and methods.

Nicholas

Date: Thu, 12 May 2005 10:58:31 +0200 (CEST)
From: Roger Bivand <Roger.Bivand at nhh.no>
Subject: RE: [R-sig-Geo] maptools package rejects some polygon
        shapefiles?
To: Rick Reeves <reeves at nceas.ucsb.edu>
Cc: r-sig-geo at stat.math.ethz.ch
Message-ID: <Pine.LNX.4.44.0505121055521.11044-100000 at reclus.nhh.no>
Content-Type: TEXT/PLAIN; charset=US-ASCII

On Wed, 11 May 2005, Rick Reeves wrote:

>
> Roger:
>
> Thanks for the quick response. Here is the file,
> and I will follow your suggestions.....
> The ArcCatalog metadata section claims that this
> is a Simple Polygon file, Topology FALSE,
> feature count 558, spatial index = TRUE,
> Linear Referencing = TRUE, geographic coord system


Rick:

(I'm replying to the list too to ask for comments)

The file is recognised by ogrinfo as:

$ ogrinfo NorthAmericaBest.shp
INFO: Open of `NorthAmericaBest.shp'
using driver `ESRI Shapefile' successful.
1: NorthAmericaBest (3D Polygon)

It should not be too difficult to change read.shape to read 3D points as
3D, and 3D lines and polygons as 2D. I guess that stripping the Z values
is not a problem for anybody (excepting points I think)?

Thanks for your help - with a sample file to study, making this work
will
be much easier. Does anyone have 3D lines and 3D points files?

Best wishes,

Roger


>
> Regards,
> Rick R
>
>
> Scientific Programmer / Quantitative Analyst
> National Center for Ecological Analysis and Synthesis
> University of California, Santa Barbara
> 805 892 2534
> reeves at nceas.ucsb.edu
>
>
>
> -----Original Message-----
> From: Roger Bivand [mailto:Roger.Bivand at nhh.no]
> Sent: Wednesday, May 11, 2005 12:08 PM
> To: Rick Reeves
> Cc: r-sig-geo at stat.math.ethz.ch
> Subject: RE: [R-sig-Geo] maptools package rejects some polygon
> shapefiles?
>
>
> On Wed, 11 May 2005, Rick Reeves wrote:
>
> > News flash: the read.shapefile() method in the shapefiles package
> reads
> > the file.
>
> It would be useful to see what getinfo.shape(filen) says, and to have a
> sight of the file. The error message suggests that it is neither type 3
> (PolyLine) nor type 5 (Polygon), so ArcGIS 9 must be using other codes
> (perhaps for PolyLineM, PolyLineeM, or their polygon equivalents). If
> you
> could make the file available, it may be possible to try to handle files
>
> like this (benefitting others, since you have a working solution).
>
> Roger
>
> >
> > btw, this is a shapefile based on the VMAP0 / DCW dataset.
> >
> > RR
> >
> > Scientific Programmer / Quantitative Analyst
> > National Center for Ecological Analysis and Synthesis
> > University of California, Santa Barbara
> > 805 892 2534
> > reeves at nceas.ucsb.edu
> >
> >
> >
> > -----Original Message-----
> > From: r-sig-geo-bounces at stat.math.ethz.ch
> > [mailto:r-sig-geo-bounces at stat.math.ethz.ch] On Behalf Of Rick Reeves
> > Sent: Wednesday, May 11, 2005 9:46 AM
> > To: r-sig-geo at stat.math.ethz.ch
> > Subject: [R-sig-Geo] maptools package rejects some polygon shapefiles?
> >
> >
> >
> >
> > Greetings:
> >
> > Using maptools in the Win XP environment, trying to
> > display an ESRI Shapefile (created with ArcMAP GIS ver 9)
> > outline map of North America. read.shape throws error:
> > Error in read.shape: Not a valid shape type.
> >
> > read.sahpe does read (and plot displays) a point shapefile
> > created on the same platform.
> >
> > Any hints on determining the problem with 'not valid' shapefiles
> > in R?
> >
> > Thanks,
> > Rick R
> >
> >
> > Scientific Programmer / Quantitative Analyst
> > National Center for Ecological Analysis and Synthesis
> > University of California, Santa Barbara
> > 805 892 2534
> > reeves at nceas.ucsb.edu
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at stat.math.ethz.ch
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at stat.math.ethz.ch
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From Roger.Bivand at nhh.no  Thu May 12 18:09:45 2005
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 12 May 2005 18:09:45 +0200 (CEST)
Subject: Subject: RE: [R-sig-Geo] maptools package rejects some polygon
	shapefiles?
In-Reply-To: <1115913332.8812.233992451@webmail.messagingengine.com>
Message-ID: <Pine.LNX.4.44.0505121801060.11938-100000@reclus.nhh.no>

On Thu, 12 May 2005, Nicholas Lewin-Koh wrote:

> Hi,
> Wouldn't it make more sense to handle 3d file as 3d?
> In outher words store 3d poionts as 3d points. For dealing 
> with this in R, we could write methods that would display the 
> 3rd dimension as an attribute. I don't think it would be hard to change
> the
> underlying C code to reade shape 3d files. I think the challange would
> be in the
> R data structure and methods.

For points, 3D will be OK, one Z value per point, hence an attribute. But 
with lines and polygons, is anyone likely to need all three dimensions? 
The attributes are attached to each shape, which implies that a per vertex 
attribute would be a different kind of thing, wouldn't it? Which research 
situations might need 3D for anything other than points? It can probably 
be done, but the sp package lines and rings are 2D, and they would be the 
containers I would look at first (unless persuaded otherwise).

Roger

> 
> Nicholas
> 
> Date: Thu, 12 May 2005 10:58:31 +0200 (CEST)
> From: Roger Bivand <Roger.Bivand at nhh.no>
> Subject: RE: [R-sig-Geo] maptools package rejects some polygon
>         shapefiles?
> To: Rick Reeves <reeves at nceas.ucsb.edu>
> Cc: r-sig-geo at stat.math.ethz.ch
> Message-ID: <Pine.LNX.4.44.0505121055521.11044-100000 at reclus.nhh.no>
> Content-Type: TEXT/PLAIN; charset=US-ASCII
> 
> On Wed, 11 May 2005, Rick Reeves wrote:
> 
> >
> > Roger:
> >
> > Thanks for the quick response. Here is the file,
> > and I will follow your suggestions.....
> > The ArcCatalog metadata section claims that this
> > is a Simple Polygon file, Topology FALSE,
> > feature count 558, spatial index = TRUE,
> > Linear Referencing = TRUE, geographic coord system
> 
> 
> Rick:
> 
> (I'm replying to the list too to ask for comments)
> 
> The file is recognised by ogrinfo as:
> 
> $ ogrinfo NorthAmericaBest.shp
> INFO: Open of `NorthAmericaBest.shp'
> using driver `ESRI Shapefile' successful.
> 1: NorthAmericaBest (3D Polygon)
> 
> It should not be too difficult to change read.shape to read 3D points as
> 3D, and 3D lines and polygons as 2D. I guess that stripping the Z values
> is not a problem for anybody (excepting points I think)?
> 
> Thanks for your help - with a sample file to study, making this work
> will
> be much easier. Does anyone have 3D lines and 3D points files?
> 
> Best wishes,
> 
> Roger
> 
> 
> >
> > Regards,
> > Rick R
> >
> >
> > Scientific Programmer / Quantitative Analyst
> > National Center for Ecological Analysis and Synthesis
> > University of California, Santa Barbara
> > 805 892 2534
> > reeves at nceas.ucsb.edu
> >
> >
> >
> > -----Original Message-----
> > From: Roger Bivand [mailto:Roger.Bivand at nhh.no]
> > Sent: Wednesday, May 11, 2005 12:08 PM
> > To: Rick Reeves
> > Cc: r-sig-geo at stat.math.ethz.ch
> > Subject: RE: [R-sig-Geo] maptools package rejects some polygon
> > shapefiles?
> >
> >
> > On Wed, 11 May 2005, Rick Reeves wrote:
> >
> > > News flash: the read.shapefile() method in the shapefiles package
> > reads
> > > the file.
> >
> > It would be useful to see what getinfo.shape(filen) says, and to have a
> > sight of the file. The error message suggests that it is neither type 3
> > (PolyLine) nor type 5 (Polygon), so ArcGIS 9 must be using other codes
> > (perhaps for PolyLineM, PolyLineeM, or their polygon equivalents). If
> > you
> > could make the file available, it may be possible to try to handle files
> >
> > like this (benefitting others, since you have a working solution).
> >
> > Roger
> >
> > >
> > > btw, this is a shapefile based on the VMAP0 / DCW dataset.
> > >
> > > RR
> > >
> > > Scientific Programmer / Quantitative Analyst
> > > National Center for Ecological Analysis and Synthesis
> > > University of California, Santa Barbara
> > > 805 892 2534
> > > reeves at nceas.ucsb.edu
> > >
> > >
> > >
> > > -----Original Message-----
> > > From: r-sig-geo-bounces at stat.math.ethz.ch
> > > [mailto:r-sig-geo-bounces at stat.math.ethz.ch] On Behalf Of Rick Reeves
> > > Sent: Wednesday, May 11, 2005 9:46 AM
> > > To: r-sig-geo at stat.math.ethz.ch
> > > Subject: [R-sig-Geo] maptools package rejects some polygon shapefiles?
> > >
> > >
> > >
> > >
> > > Greetings:
> > >
> > > Using maptools in the Win XP environment, trying to
> > > display an ESRI Shapefile (created with ArcMAP GIS ver 9)
> > > outline map of North America. read.shape throws error:
> > > Error in read.shape: Not a valid shape type.
> > >
> > > read.sahpe does read (and plot displays) a point shapefile
> > > created on the same platform.
> > >
> > > Any hints on determining the problem with 'not valid' shapefiles
> > > in R?
> > >
> > > Thanks,
> > > Rick R
> > >
> > >
> > > Scientific Programmer / Quantitative Analyst
> > > National Center for Ecological Analysis and Synthesis
> > > University of California, Santa Barbara
> > > 805 892 2534
> > > reeves at nceas.ucsb.edu
> > >
> > > _______________________________________________
> > > R-sig-Geo mailing list
> > > R-sig-Geo at stat.math.ethz.ch
> > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > >
> > > _______________________________________________
> > > R-sig-Geo mailing list
> > > R-sig-Geo at stat.math.ethz.ch
> > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > >
> >
> >
> 
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From nikko at hailmail.net  Thu May 12 18:32:15 2005
From: nikko at hailmail.net (Nicholas Lewin-Koh)
Date: Thu, 12 May 2005 11:32:15 -0500
Subject: Subject: RE: [R-sig-Geo] maptools package rejects some polygon 
	shapefiles?
In-Reply-To: <Pine.LNX.4.44.0505121801060.11938-100000@reclus.nhh.no>
References: <Pine.LNX.4.44.0505121801060.11938-100000@reclus.nhh.no>
Message-ID: <1115915535.14455.233995071@webmail.messagingengine.com>

Hi,
No I actually meant to have a slot, or place for the 3rd dimension. and
for plotting methods treat it like an attribute. I was trying to think
of situations where 
3d lines or polygons would be useful, admittedly I am a little stumpped,
but I am sure
there must be something other than pretty flythroughs :) Maybe a polygon
view of a surface 
where thew polygon heights are interpolated from binned data to the
vertices of the polygon?

Nicholas

On Thu, 12 May 2005 18:09:45 +0200 (CEST), "Roger Bivand"
<Roger.Bivand at nhh.no> said:
> On Thu, 12 May 2005, Nicholas Lewin-Koh wrote:
> 
> > Hi,
> > Wouldn't it make more sense to handle 3d file as 3d?
> > In outher words store 3d poionts as 3d points. For dealing 
> > with this in R, we could write methods that would display the 
> > 3rd dimension as an attribute. I don't think it would be hard to change
> > the
> > underlying C code to reade shape 3d files. I think the challange would
> > be in the
> > R data structure and methods.
> 
> For points, 3D will be OK, one Z value per point, hence an attribute. But 
> with lines and polygons, is anyone likely to need all three dimensions? 
> The attributes are attached to each shape, which implies that a per
> vertex 
> attribute would be a different kind of thing, wouldn't it? Which research 
> situations might need 3D for anything other than points? It can probably 
> be done, but the sp package lines and rings are 2D, and they would be the 
> containers I would look at first (unless persuaded otherwise).
> 
> Roger
> 
> > 
> > Nicholas
> > 
> > Date: Thu, 12 May 2005 10:58:31 +0200 (CEST)
> > From: Roger Bivand <Roger.Bivand at nhh.no>
> > Subject: RE: [R-sig-Geo] maptools package rejects some polygon
> >         shapefiles?
> > To: Rick Reeves <reeves at nceas.ucsb.edu>
> > Cc: r-sig-geo at stat.math.ethz.ch
> > Message-ID: <Pine.LNX.4.44.0505121055521.11044-100000 at reclus.nhh.no>
> > Content-Type: TEXT/PLAIN; charset=US-ASCII
> > 
> > On Wed, 11 May 2005, Rick Reeves wrote:
> > 
> > >
> > > Roger:
> > >
> > > Thanks for the quick response. Here is the file,
> > > and I will follow your suggestions.....
> > > The ArcCatalog metadata section claims that this
> > > is a Simple Polygon file, Topology FALSE,
> > > feature count 558, spatial index = TRUE,
> > > Linear Referencing = TRUE, geographic coord system
> > 
> > 
> > Rick:
> > 
> > (I'm replying to the list too to ask for comments)
> > 
> > The file is recognised by ogrinfo as:
> > 
> > $ ogrinfo NorthAmericaBest.shp
> > INFO: Open of `NorthAmericaBest.shp'
> > using driver `ESRI Shapefile' successful.
> > 1: NorthAmericaBest (3D Polygon)
> > 
> > It should not be too difficult to change read.shape to read 3D points as
> > 3D, and 3D lines and polygons as 2D. I guess that stripping the Z values
> > is not a problem for anybody (excepting points I think)?
> > 
> > Thanks for your help - with a sample file to study, making this work
> > will
> > be much easier. Does anyone have 3D lines and 3D points files?
> > 
> > Best wishes,
> > 
> > Roger
> > 
> > 
> > >
> > > Regards,
> > > Rick R
> > >
> > >
> > > Scientific Programmer / Quantitative Analyst
> > > National Center for Ecological Analysis and Synthesis
> > > University of California, Santa Barbara
> > > 805 892 2534
> > > reeves at nceas.ucsb.edu
> > >
> > >
> > >
> > > -----Original Message-----
> > > From: Roger Bivand [mailto:Roger.Bivand at nhh.no]
> > > Sent: Wednesday, May 11, 2005 12:08 PM
> > > To: Rick Reeves
> > > Cc: r-sig-geo at stat.math.ethz.ch
> > > Subject: RE: [R-sig-Geo] maptools package rejects some polygon
> > > shapefiles?
> > >
> > >
> > > On Wed, 11 May 2005, Rick Reeves wrote:
> > >
> > > > News flash: the read.shapefile() method in the shapefiles package
> > > reads
> > > > the file.
> > >
> > > It would be useful to see what getinfo.shape(filen) says, and to have a
> > > sight of the file. The error message suggests that it is neither type 3
> > > (PolyLine) nor type 5 (Polygon), so ArcGIS 9 must be using other codes
> > > (perhaps for PolyLineM, PolyLineeM, or their polygon equivalents). If
> > > you
> > > could make the file available, it may be possible to try to handle files
> > >
> > > like this (benefitting others, since you have a working solution).
> > >
> > > Roger
> > >
> > > >
> > > > btw, this is a shapefile based on the VMAP0 / DCW dataset.
> > > >
> > > > RR
> > > >
> > > > Scientific Programmer / Quantitative Analyst
> > > > National Center for Ecological Analysis and Synthesis
> > > > University of California, Santa Barbara
> > > > 805 892 2534
> > > > reeves at nceas.ucsb.edu
> > > >
> > > >
> > > >
> > > > -----Original Message-----
> > > > From: r-sig-geo-bounces at stat.math.ethz.ch
> > > > [mailto:r-sig-geo-bounces at stat.math.ethz.ch] On Behalf Of Rick Reeves
> > > > Sent: Wednesday, May 11, 2005 9:46 AM
> > > > To: r-sig-geo at stat.math.ethz.ch
> > > > Subject: [R-sig-Geo] maptools package rejects some polygon shapefiles?
> > > >
> > > >
> > > >
> > > >
> > > > Greetings:
> > > >
> > > > Using maptools in the Win XP environment, trying to
> > > > display an ESRI Shapefile (created with ArcMAP GIS ver 9)
> > > > outline map of North America. read.shape throws error:
> > > > Error in read.shape: Not a valid shape type.
> > > >
> > > > read.sahpe does read (and plot displays) a point shapefile
> > > > created on the same platform.
> > > >
> > > > Any hints on determining the problem with 'not valid' shapefiles
> > > > in R?
> > > >
> > > > Thanks,
> > > > Rick R
> > > >
> > > >
> > > > Scientific Programmer / Quantitative Analyst
> > > > National Center for Ecological Analysis and Synthesis
> > > > University of California, Santa Barbara
> > > > 805 892 2534
> > > > reeves at nceas.ucsb.edu
> > > >
> > > > _______________________________________________
> > > > R-sig-Geo mailing list
> > > > R-sig-Geo at stat.math.ethz.ch
> > > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > > >
> > > > _______________________________________________
> > > > R-sig-Geo mailing list
> > > > R-sig-Geo at stat.math.ethz.ch
> > > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > > >
> > >
> > >
> > 
> > 
> 
> -- 
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>



From Roger.Bivand at nhh.no  Thu May 12 19:44:40 2005
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 12 May 2005 19:44:40 +0200 (CEST)
Subject: Subject: RE: [R-sig-Geo] maptools package rejects some polygon
	shapefiles?
In-Reply-To: <1115915535.14455.233995071@webmail.messagingengine.com>
Message-ID: <Pine.LNX.4.44.0505121931410.11938-100000@reclus.nhh.no>

On Thu, 12 May 2005, Nicholas Lewin-Koh wrote:

> Hi, No I actually meant to have a slot, or place for the 3rd dimension.
> and for plotting methods treat it like an attribute. I was trying to
> think of situations where 3d lines or polygons would be useful,
> admittedly I am a little stumpped, but I am sure there must be something
> other than pretty flythroughs :) Maybe a polygon view of a surface where
> thew polygon heights are interpolated from binned data to the vertices
> of the polygon?

I can see why visualising points is worth the trouble, and by extension 
voxels. Maybe even for polylines, such as showing the gradient of a 
stream by plotting z against the (x,y) distances. But plotting the varying 
z of a polygon boundary (this is a 2.5D object, I think, not CAD/CAM, 
non-self-intersecting?)? 

Maybe go by steps and see how easy it is to return the line and polygon z
values in the matrix of coordinates, and strip them by default? Something
like that? The z values in the original posting were spurious, ArcGIS just
output them, the data were decimal degree lat-long of a coastline.

Shall I put the maptools package code on sourceforge?

Roger

> 
> Nicholas
> 
> On Thu, 12 May 2005 18:09:45 +0200 (CEST), "Roger Bivand"
> <Roger.Bivand at nhh.no> said:
> > On Thu, 12 May 2005, Nicholas Lewin-Koh wrote:
> > 
> > > Hi,
> > > Wouldn't it make more sense to handle 3d file as 3d?
> > > In outher words store 3d poionts as 3d points. For dealing 
> > > with this in R, we could write methods that would display the 
> > > 3rd dimension as an attribute. I don't think it would be hard to change
> > > the
> > > underlying C code to reade shape 3d files. I think the challange would
> > > be in the
> > > R data structure and methods.
> > 
> > For points, 3D will be OK, one Z value per point, hence an attribute. But 
> > with lines and polygons, is anyone likely to need all three dimensions? 
> > The attributes are attached to each shape, which implies that a per
> > vertex 
> > attribute would be a different kind of thing, wouldn't it? Which research 
> > situations might need 3D for anything other than points? It can probably 
> > be done, but the sp package lines and rings are 2D, and they would be the 
> > containers I would look at first (unless persuaded otherwise).
> > 
> > Roger
> > 
> > > 
> > > Nicholas
> > > 
> > > Date: Thu, 12 May 2005 10:58:31 +0200 (CEST)
> > > From: Roger Bivand <Roger.Bivand at nhh.no>
> > > Subject: RE: [R-sig-Geo] maptools package rejects some polygon
> > >         shapefiles?
> > > To: Rick Reeves <reeves at nceas.ucsb.edu>
> > > Cc: r-sig-geo at stat.math.ethz.ch
> > > Message-ID: <Pine.LNX.4.44.0505121055521.11044-100000 at reclus.nhh.no>
> > > Content-Type: TEXT/PLAIN; charset=US-ASCII
> > > 
> > > On Wed, 11 May 2005, Rick Reeves wrote:
> > > 
> > > >
> > > > Roger:
> > > >
> > > > Thanks for the quick response. Here is the file,
> > > > and I will follow your suggestions.....
> > > > The ArcCatalog metadata section claims that this
> > > > is a Simple Polygon file, Topology FALSE,
> > > > feature count 558, spatial index = TRUE,
> > > > Linear Referencing = TRUE, geographic coord system
> > > 
> > > 
> > > Rick:
> > > 
> > > (I'm replying to the list too to ask for comments)
> > > 
> > > The file is recognised by ogrinfo as:
> > > 
> > > $ ogrinfo NorthAmericaBest.shp
> > > INFO: Open of `NorthAmericaBest.shp'
> > > using driver `ESRI Shapefile' successful.
> > > 1: NorthAmericaBest (3D Polygon)
> > > 
> > > It should not be too difficult to change read.shape to read 3D points as
> > > 3D, and 3D lines and polygons as 2D. I guess that stripping the Z values
> > > is not a problem for anybody (excepting points I think)?
> > > 
> > > Thanks for your help - with a sample file to study, making this work
> > > will
> > > be much easier. Does anyone have 3D lines and 3D points files?
> > > 
> > > Best wishes,
> > > 
> > > Roger
> > > 
> > > 
> > > >
> > > > Regards,
> > > > Rick R
> > > >
> > > >
> > > > Scientific Programmer / Quantitative Analyst
> > > > National Center for Ecological Analysis and Synthesis
> > > > University of California, Santa Barbara
> > > > 805 892 2534
> > > > reeves at nceas.ucsb.edu
> > > >
> > > >
> > > >
> > > > -----Original Message-----
> > > > From: Roger Bivand [mailto:Roger.Bivand at nhh.no]
> > > > Sent: Wednesday, May 11, 2005 12:08 PM
> > > > To: Rick Reeves
> > > > Cc: r-sig-geo at stat.math.ethz.ch
> > > > Subject: RE: [R-sig-Geo] maptools package rejects some polygon
> > > > shapefiles?
> > > >
> > > >
> > > > On Wed, 11 May 2005, Rick Reeves wrote:
> > > >
> > > > > News flash: the read.shapefile() method in the shapefiles package
> > > > reads
> > > > > the file.
> > > >
> > > > It would be useful to see what getinfo.shape(filen) says, and to have a
> > > > sight of the file. The error message suggests that it is neither type 3
> > > > (PolyLine) nor type 5 (Polygon), so ArcGIS 9 must be using other codes
> > > > (perhaps for PolyLineM, PolyLineeM, or their polygon equivalents). If
> > > > you
> > > > could make the file available, it may be possible to try to handle files
> > > >
> > > > like this (benefitting others, since you have a working solution).
> > > >
> > > > Roger
> > > >
> > > > >
> > > > > btw, this is a shapefile based on the VMAP0 / DCW dataset.
> > > > >
> > > > > RR
> > > > >
> > > > > Scientific Programmer / Quantitative Analyst
> > > > > National Center for Ecological Analysis and Synthesis
> > > > > University of California, Santa Barbara
> > > > > 805 892 2534
> > > > > reeves at nceas.ucsb.edu
> > > > >
> > > > >
> > > > >
> > > > > -----Original Message-----
> > > > > From: r-sig-geo-bounces at stat.math.ethz.ch
> > > > > [mailto:r-sig-geo-bounces at stat.math.ethz.ch] On Behalf Of Rick Reeves
> > > > > Sent: Wednesday, May 11, 2005 9:46 AM
> > > > > To: r-sig-geo at stat.math.ethz.ch
> > > > > Subject: [R-sig-Geo] maptools package rejects some polygon shapefiles?
> > > > >
> > > > >
> > > > >
> > > > >
> > > > > Greetings:
> > > > >
> > > > > Using maptools in the Win XP environment, trying to
> > > > > display an ESRI Shapefile (created with ArcMAP GIS ver 9)
> > > > > outline map of North America. read.shape throws error:
> > > > > Error in read.shape: Not a valid shape type.
> > > > >
> > > > > read.sahpe does read (and plot displays) a point shapefile
> > > > > created on the same platform.
> > > > >
> > > > > Any hints on determining the problem with 'not valid' shapefiles
> > > > > in R?
> > > > >
> > > > > Thanks,
> > > > > Rick R
> > > > >
> > > > >
> > > > > Scientific Programmer / Quantitative Analyst
> > > > > National Center for Ecological Analysis and Synthesis
> > > > > University of California, Santa Barbara
> > > > > 805 892 2534
> > > > > reeves at nceas.ucsb.edu
> > > > >
> > > > > _______________________________________________
> > > > > R-sig-Geo mailing list
> > > > > R-sig-Geo at stat.math.ethz.ch
> > > > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > > > >
> > > > > _______________________________________________
> > > > > R-sig-Geo mailing list
> > > > > R-sig-Geo at stat.math.ethz.ch
> > > > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > > > >
> > > >
> > > >
> > > 
> > > 
> > 
> > -- 
> > Roger Bivand
> > Economic Geography Section, Department of Economics, Norwegian School of
> > Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> > Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> > e-mail: Roger.Bivand at nhh.no
> > 
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From stanimura-ngs at umin.ac.jp  Fri May 13 05:39:41 2005
From: stanimura-ngs at umin.ac.jp (Susumu Tanimura)
Date: Fri, 13 May 2005 12:39:41 +0900
Subject: Solved (was Re: [R-sig-Geo] Error to load rgdal)
In-Reply-To: <1115908821.16605.6.camel@fosteri.keittlab.net>
References: <Pine.LNX.4.44.0505121034010.11044-100000@reclus.nhh.no>
	<1115908821.16605.6.camel@fosteri.keittlab.net>
Message-ID: <20050513123941.2df70db2.stanimura-ngs@umin.ac.jp>

Thank all.

Finally rgdal works.  Please accept my apology that I did not mention
about an important point.

The cause of my failure is that rgdal can not find libgdal.so because
of difference in the names.

Dear Roger, you are right. The fact is that the names of gdal library are
libgdal, libgdal.1, libgdal.1.7.0, but not libgdal.so, libgdal.so.1, or
libgdal.so.1.7.0.  Compiling from tar.gz put "so" into the library names,
but compiling through rpm 4.0.5 provides the library names without "so".  

Unfortunately, even though I am not professional, I am a voluntary
maintainer of the gdal package for VineLinux.  So, I should find out
the solution of this problem.  I checked rpm packages of other
distributions such as SUSE, FC3, and Mandrke, and found that, even
nothing special was given in spec files, the library names includes
"so".

Anyway, I did
# cd /usr/lib
# ln -s libgdal libgdal.so
and then reinstall rgdal package.
This enables rgdal to be loaded into R.

Thank you.

--
Susumu Tanimura



From tshort at eprisolutions.com  Fri May 13 17:26:06 2005
From: tshort at eprisolutions.com (Short, Tom)
Date: Fri, 13 May 2005 11:26:06 -0400
Subject: [R-sig-Geo] Interactive web mapping with Rpad
Message-ID: <FC4627EC695CD71180280003477108C501BBBA94@exchange.epripeac.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20050513/a57f5c8e/attachment.pl>

From Chloe.ARCHINARD at cefe.cnrs.fr  Tue May 17 16:19:00 2005
From: Chloe.ARCHINARD at cefe.cnrs.fr (Chloe ARCHINARD)
Date: Tue, 17 May 2005 16:19:00 +0200
Subject: [R-sig-Geo] How to create polygons for kriging
Message-ID: <EB09E5B9F0E2684F863B525E5C7E0F890B3839@ZZML.newcefe.newage.fr>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20050517/20ca7872/attachment.pl>

From RRoa at fisheries.gov.fk  Tue May 17 14:38:42 2005
From: RRoa at fisheries.gov.fk (Ruben Roa)
Date: Tue, 17 May 2005 10:38:42 -0200
Subject: [R-sig-Geo] How to create polygons for kriging
Message-ID: <AEF7C40954294D42990B3F90C6C73A4501016539@figmail.fig.fk>

> -----Original Message-----
> From: r-sig-geo-bounces at stat.math.ethz.ch
> [mailto:r-sig-geo-bounces at stat.math.ethz.ch]On Behalf Of 
> Chloe ARCHINARD
> Sent: 17 May 2005 13:19
> To: r-sig-geo at stat.math.ethz.ch
> Subject: [R-sig-Geo] How to create polygons for kriging
> 
> 
> Hello all,
> 
> I used geoR package to compute kriging with krige.conv() , 
> and to draw map I used contour() like this :
> 
> >contour(kc,locations, filled=TRUE, coords.data=geodata$coords,
> 
> >+color=terrain.colors)
> 
> And I want to limit the prediction inside data locations 
> (with borders()) which are not rectangular, so how can I 
> create a polygon which could contain my data? Or if someone 
> knows where I can find polygons data frame for the states of the US?

Just create a text file with the vertices and repeat the first vertix
at the end so that the polygon is closed. I see my maps with Surfer 8.0
and then use digitize to create the polygons. Then i edit the *.bln
file to make it directly readable using read.table in geoR.
After you have your polygon you would need the package splancs to do the 
kriging inside the polygon. geoR calls splancs.
Cheers
Ruben



From tshort at eprisolutions.com  Tue May 17 22:05:00 2005
From: tshort at eprisolutions.com (Short, Tom)
Date: Tue, 17 May 2005 16:05:00 -0400
Subject: [R-sig-Geo] SLDF to a segment data frame
Message-ID: <FC4627EC695CD71180280003477108C501BBBAA6@exchange.epripeac.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20050517/a8c1a0c3/attachment.pl>

From Roger.Bivand at nhh.no  Tue May 17 23:42:39 2005
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 17 May 2005 23:42:39 +0200 (CEST)
Subject: [R-sig-Geo] SLDF to a segment data frame
In-Reply-To: <FC4627EC695CD71180280003477108C501BBBAA6@exchange.epripeac.com>
Message-ID: <Pine.LNX.4.44.0505172339510.26119-100000@reclus.nhh.no>

On Tue, 17 May 2005, Short, Tom wrote:

> I'm impressed with R's plotting/mapping capabilities, especially with
> the new sp package that simplifies plotting of different data
> types. For a recent application with Rpad (www.rpad.org), the plotting
> speed was a little slow for line data with 250,000 line segments. To
> speed up plotting, I converted all of the line data to one big data
> frame that holds all of the segment data. Then I just plot with
> "segments". The resulting data frame contains columns x1, y1, x2, y2,
> along with an indexing vector idx that points back to the appropriate
> row in the attributes data frame for that line segment. 

With regard to speeds, could you say what OS and R version you are using, 
because the different devices behave differently on different systems (in 
particular the Windows segment drawing function seems to have been impared 
by a recent patch I think to XP). Otherwise, the work you are showing on 
Rpad is quite remarkable, far beyond anything I'd anticipated! 

Best wishes,

Roger

> 
> I wrote two functions for the conversion. One converts from the sp
> package SLDF object. The other converts from the maptools "Map"
> representation. Both should produce the same output. The code is
> enclosed if anyone has similar needs. Comments appreciated.
> 
> The following code is granted to the public domain:
> 
> SLDFtoSegment <- function(sldf) {
>   # Convert line segments from the SLDF representation to vectors to 
>   # plot with segments().
>   # It also includes an index term "idx" to use to index the dataframe 
>   # portion of the SLDF
>   crd <- coordinates(sldf)
>   lst <- sapply(crd,
>             function(x) lapply(x, function(l) 
>               cbind(l[1:(NROW(l)-1),,drop=F], l[2:NROW(l),,drop=F])))
>   seg <- data.frame(x1 = unlist(lapply(lst, function(x) x[, 1])),
>                     y1 = unlist(lapply(lst, function(x) x[, 2])), 
>                     x2 = unlist(lapply(lst, function(x) x[, 3])), 
>                     y2 = unlist(lapply(lst, function(x) x[, 4])))
>   segmentidx <- array(as.integer(0), NROW(seg))
>   j <- 1
>   for (i in seq(along=lst)) {
>     n <- NROW(lst[[i]])
>     segmentidx[j:(j+n-1)] <- rep(i, n)
>     j <- j + n
>   }
>   seg$idx <- segmentidx
>   seg
> }
> 
> ShapefiletoSegment <- function(map) {
>   # Convert line segments from the maptools "Map" representation 
>   # (from a shapefile import) to vectors to plot with segments().
>   # It also includes an index term "idx" to use to index the 
>   # dataframe portion.
>   extractsegs <- function(l) cbind(l$verts[1:(NROW(l$verts)-1),,drop=F],
>                                    l$verts[2:NROW(l$verts),,drop=F])
>   lst <- lapply(map$Shapes, extractsegs)
>   seg <- data.frame(x1 = unlist(lapply(lst, function(x) x[, 1])),
>                     y1 = unlist(lapply(lst, function(x) x[, 2])), 
>                     x2 = unlist(lapply(lst, function(x) x[, 3])), 
>                     y2 = unlist(lapply(lst, function(x) x[, 4])))
>   segmentidx <- array(as.integer(0), NROW(seg))
>   j <- 1
>   for (i in seq(along=lst)) {
>     n <- NROW(lst[[i]])
>     segmentidx[j:(j+n-1)] <- rep(i, n)
>     j <- j + n
>   }
>   seg$idx <- segmentidx
>   seg
> }
> 
> # Here's an example of using it.
> # You don't need it at all for this example
> # because the data set is so small.
> library(sp)
> data(lnsshp) 
> res <- shp2SLDF(lns)
> plot(res) # plot SLDF data
> 
> # faster plotting with segments:
> seg <- SLDFtoSegment(res)
> plot.new()
> plot.window(xlim=range(seg$x1, seg$x2),
>             ylim=range(seg$y1, seg$y2),
>             asp=1)
> segments(seg$x1,seg$y1,seg$x2,seg$y2)
> 
> # to vary line color by some attribute, you could do:
> res[["length.factor"]] <- cut(res[["LENGTH"]], 
>                               breaks=quantile(res[["LENGTH"]]))
> color = as.numeric(res[["length.factor"]][seg$idx])
> segments(seg$x1, seg$y1, seg$x2, seg$y2,
>          col = color)
> 
> - Tom
> 
> Tom Short
> EPRI Solutions, Inc.
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From tshort at eprisolutions.com  Wed May 18 13:32:54 2005
From: tshort at eprisolutions.com (Short, Tom)
Date: Wed, 18 May 2005 07:32:54 -0400
Subject: [R-sig-Geo] SLDF to a segment data frame
Message-ID: <FC4627EC695CD71180280003477108C501BBBAAB@exchange.epripeac.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20050518/17994c52/attachment.pl>

From Chloe.ARCHINARD at cefe.cnrs.fr  Thu May 19 18:23:43 2005
From: Chloe.ARCHINARD at cefe.cnrs.fr (Chloe ARCHINARD)
Date: Thu, 19 May 2005 18:23:43 +0200
Subject: [R-sig-Geo] kriging inside borders
Message-ID: <EB09E5B9F0E2684F863B525E5C7E0F8912239F@ZZML.newcefe.newage.fr>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20050519/0fad6d65/attachment.pl>

From Roger.Bivand at nhh.no  Thu May 19 19:07:14 2005
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 19 May 2005 19:07:14 +0200 (CEST)
Subject: [R-sig-Geo] kriging inside borders
In-Reply-To: <EB09E5B9F0E2684F863B525E5C7E0F8912239F@ZZML.newcefe.newage.fr>
Message-ID: <Pine.LNX.4.44.0505191857001.27579-100000@reclus.nhh.no>

On Thu, 19 May 2005, Chloe ARCHINARD wrote:

> Hello, I'm using geoR package to compute kriging with the function
> krige.conv() and I used maptools (read.shape () + Map2poly () )  and
> splancs (borders) packages to include a object of class polylist for the
> attribute borders.

>  But I've got this message of error when 'borders' is in krige.conv () :  
> krige.conv: there are no prediction locations inside the borders.  My
> polylist is not good? The coordinates seam to be OK when I draw a map
> with this polylist object. And if I use 'borders' in the contour
> function : message error is :

> Error in as.data.frame.default(borders) : can't coerce class "polylist"
> into a data.frame

Firstly, it does help if the exact commands are given, rather than your 
choice of them. I think the main issue here is that a polylist object is a 
list of matrices with attributes, not a matrix. If your polylist object 
is:

x <- Map2poly(read.shape("my.shp"))

what is length(x)? If it is 1, you may be able to say x[[1]] to extract 
the first matrix in the list, but even then it may not work. If you can 
show us the commands you are giving, and the length of your polylist 
object, it should be possible to find something that works. 


> If someone could help me, thanks a lot!

> Chlo? Archinard
> 
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From paulojus at est.ufpr.br  Thu May 19 20:19:30 2005
From: paulojus at est.ufpr.br (Paulo Justiniano Ribeiro Jr)
Date: Thu, 19 May 2005 15:19:30 -0300 (BRT)
Subject: [R-sig-Geo] kriging inside borders
In-Reply-To: <EB09E5B9F0E2684F863B525E5C7E0F8912239F@ZZML.newcefe.newage.fr>
References: <EB09E5B9F0E2684F863B525E5C7E0F8912239F@ZZML.newcefe.newage.fr>
Message-ID: <Pine.LNX.4.58L0.0505191516270.27396@est.ufpr.br>

Hi

There are a few exemples of kriging inside borders in the geoR tutorials
section available at:
http://www.est.ufpr.br/geoR

Basically you can use polygrid(), althouhg there are other mechanisms
available. polygrid() relies on a splancs function internaly

Please have a look and if the problem persists please contact me
preferelably with some dumpoed workspace and scripts

best
P.J.



On Thu, 19 May 2005, Chloe ARCHINARD wrote:

> Hello,
> I'm using geoR package to compute kriging with the function krige.conv() and I used maptools (read.shape () +  Map2poly () )
> and splancs (borders) packages to include a object of class polylist for the attribute borders.
>  But I've got this message of error when 'borders' is in krige.conv () :
> krige.conv: there are no prediction locations inside the borders.
> My polylist is not good? The coordinates seam to be OK when I draw a map with this polylist object.
> And if I use 'borders' in the contour function : message error is :
> Error in as.data.frame.default(borders) : can't coerce class "polylist" into a data.frame
> If someone could help me, thanks a lot!
> Chlo? Archinard
>
> --
> passerelle antivirus du campus CNRS de Montpellier
> --
>
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>

Paulo Justiniano Ribeiro Jr
LEG (Laborat?rio de Estat?stica e Geoinforma??o)
Departamento de Estat?stica
Universidade Federal do Paran?
Caixa Postal 19.081
CEP 81.531-990
Curitiba, PR  -  Brasil
Tel: (+55) 41 3361 3573
Fax: (+55) 41 3361 3141
e-mail: paulojus at est.ufpr.br
http://www.est.ufpr.br/~paulojus



From Chloe.ARCHINARD at cefe.cnrs.fr  Fri May 20 10:01:34 2005
From: Chloe.ARCHINARD at cefe.cnrs.fr (Chloe ARCHINARD)
Date: Fri, 20 May 2005 10:01:34 +0200
Subject: [R-sig-Geo] kriging inside borders
Message-ID: <EB09E5B9F0E2684F863B525E5C7E0F891223A1@ZZML.newcefe.newage.fr>

My exact commands are :
library(maptools)
shapefile=read.shape('my.shp')
x=Map2poly(shapefile)

and the length is :
length(mappolys)
[1] 615
 But i'm not sure that it's the good polylist object i need because it's a polygon grid in fact. 
Thank you for your help
Chlo?
-----Message d'origine-----
De?: Roger Bivand [mailto:Roger.Bivand at nhh.no] 
Envoy??: jeudi 19 mai 2005 19:07
??: Chloe ARCHINARD
Cc?: r-sig-geo at stat.math.ethz.ch
Objet?: Re: [R-sig-Geo] kriging inside borders

On Thu, 19 May 2005, Chloe ARCHINARD wrote:


> Hello, I'm using geoR package to compute kriging with the function

> krige.conv() and I used maptools (read.shape () + Map2poly () )  and

> splancs (borders) packages to include a object of class polylist for the

> attribute borders.


>  But I've got this message of error when 'borders' is in krige.conv () :  

> krige.conv: there are no prediction locations inside the borders.  My

> polylist is not good? The coordinates seam to be OK when I draw a map

> with this polylist object. And if I use 'borders' in the contour

> function : message error is :


> Error in as.data.frame.default(borders) : can't coerce class "polylist"

> into a data.frame


Firstly, it does help if the exact commands are given, rather than your 

choice of them. I think the main issue here is that a polylist object is a 

list of matrices with attributes, not a matrix. If your polylist object 

is:


x <- Map2poly(read.shape("my.shp"))


what is length(x)? If it is 1, you may be able to say x[[1]] to extract 

the first matrix in the list, but even then it may not work. If you can 

show us the commands you are giving, and the length of your polylist 

object, it should be possible to find something that works. 



> If someone could help me, thanks a lot!


> Chlo? Archinard

> 

> 


-- 

Roger Bivand

Economic Geography Section, Department of Economics, Norwegian School of

Economics and Business Administration, Helleveien 30, N-5045 Bergen,

Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43

e-mail: Roger.Bivand at nhh.no



-- 
passerelle antivirus du campus CNRS de Montpellier
--



-- 
passerelle antivirus du campus CNRS de Montpellier
--



From Roger.Bivand at nhh.no  Fri May 20 17:51:32 2005
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 20 May 2005 17:51:32 +0200 (CEST)
Subject: [R-sig-Geo] kriging inside borders
In-Reply-To: <EB09E5B9F0E2684F863B525E5C7E0F891223A1@ZZML.newcefe.newage.fr>
Message-ID: <Pine.LNX.4.44.0505201710340.28362-100000@reclus.nhh.no>

On Fri, 20 May 2005, Chloe ARCHINARD wrote:

> My exact commands are :
> library(maptools)
> shapefile=read.shape('my.shp')
> x=Map2poly(shapefile)
> 
> and the length is :
> length(mappolys)
> [1] 615

OK. So what I think you have is a grid of cells, possibly with cells 
missing around the edges and maybe in the middle too. The splancs polygon 
cannot have holes, by the way. I think that what you could do is to choose 
the locations= values you need within the polygon grid first, and not use 
borders=. I've tried to replicate your situation, and have made a 
shapefile with rectangular grid cells with uneven edges and a hole. Then I 
did:

library(sp)
library(maptools)
shapefile <- read.shape("<your file>.shp")
x <- as.SpatialRings.Shapes(shapefile$Shapes, IDs=1:length(shapefile$Shapes))
xp <- SpatialPoints(cbind(runif(50, 0, 3), runif(50, 0, 3)))

# here you do xp <- SpatialPoints(<your location points matrix>)

res <- overlay(x, xp)

# overlay() sets the value of res to the ID of the polygon the point falls 
# in, or to NA if the point does not fall in any polygon.

plot(x, col="grey")
points(xp[is.na(res)], col="red")
points(xp[!is.na(res)], col="blue")

and you can choose the points for the prediction locations as:

<my prediction locations> <- xp[!is.na(res)]

Please check on the plot to see if overlay divides up the points correctly 
first, just to be sure. If this works, it is will be a nice example of how 
the coordination of spatial data functions in the "sp" package can make 
things easier (if not, any reports on difficulties with "sp" are always 
welcome).

Roger

>  But i'm not sure that it's the good polylist object i need because it's
> a polygon grid in fact.

> Thank you for your help
> Chlo?
> -----Message d'origine-----
> De?: Roger Bivand [mailto:Roger.Bivand at nhh.no] 
> Envoy??: jeudi 19 mai 2005 19:07
> ??: Chloe ARCHINARD
> Cc?: r-sig-geo at stat.math.ethz.ch
> Objet?: Re: [R-sig-Geo] kriging inside borders
> 
> On Thu, 19 May 2005, Chloe ARCHINARD wrote:
> 
> 
> > Hello, I'm using geoR package to compute kriging with the function
> 
> > krige.conv() and I used maptools (read.shape () + Map2poly () )  and
> 
> > splancs (borders) packages to include a object of class polylist for the
> 
> > attribute borders.
> 
> 
> >  But I've got this message of error when 'borders' is in krige.conv () :  
> 
> > krige.conv: there are no prediction locations inside the borders.  My
> 
> > polylist is not good? The coordinates seam to be OK when I draw a map
> 
> > with this polylist object. And if I use 'borders' in the contour
> 
> > function : message error is :
> 
> 
> > Error in as.data.frame.default(borders) : can't coerce class "polylist"
> 
> > into a data.frame
> 
> 
> Firstly, it does help if the exact commands are given, rather than your 
> 
> choice of them. I think the main issue here is that a polylist object is a 
> 
> list of matrices with attributes, not a matrix. If your polylist object 
> 
> is:
> 
> 
> x <- Map2poly(read.shape("my.shp"))
> 
> 
> what is length(x)? If it is 1, you may be able to say x[[1]] to extract 
> 
> the first matrix in the list, but even then it may not work. If you can 
> 
> show us the commands you are giving, and the length of your polylist 
> 
> object, it should be possible to find something that works. 
> 
> 
> 
> > If someone could help me, thanks a lot!
> 
> 
> > Chlo? Archinard
> 
> > 
> 
> > 
> 
> 
> -- 
> 
> Roger Bivand
> 
> Economic Geography Section, Department of Economics, Norwegian School of
> 
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> 
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> 
> e-mail: Roger.Bivand at nhh.no
> 
> 
> 
> -- 
> passerelle antivirus du campus CNRS de Montpellier
> --
> 
> 
> 
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From Roger.Bivand at nhh.no  Sat May 21 18:07:12 2005
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sat, 21 May 2005 18:07:12 +0200 (CEST)
Subject: [R-sig-Geo] kriging inside borders
In-Reply-To: <Pine.LNX.4.44.0505201710340.28362-100000@reclus.nhh.no>
Message-ID: <Pine.LNX.4.44.0505211759230.29162-100000@reclus.nhh.no>

On Fri, 20 May 2005, Roger Bivand wrote:

> On Fri, 20 May 2005, Chloe ARCHINARD wrote:
> 
> > My exact commands are :
> > library(maptools)
> > shapefile=read.shape('my.shp')
> > x=Map2poly(shapefile)
> > 
> > and the length is :
> > length(mappolys)
> > [1] 615
> 
> OK. So what I think you have is a grid of cells, possibly with cells 
> missing around the edges and maybe in the middle too. The splancs polygon 
> cannot have holes, by the way. I think that what you could do is to choose 
> the locations= values you need within the polygon grid first, and not use 
> borders=. I've tried to replicate your situation, and have made a 
> shapefile with rectangular grid cells with uneven edges and a hole. Then I 
> did:
> 
> library(sp)
> library(maptools)
> shapefile <- read.shape("<your file>.shp")
> x <- as.SpatialRings.Shapes(shapefile$Shapes, IDs=1:length(shapefile$Shapes))
> xp <- SpatialPoints(cbind(runif(50, 0, 3), runif(50, 0, 3)))
> 
> # here you do xp <- SpatialPoints(<your location points matrix>)
> 
> res <- overlay(x, xp)
> 
> # overlay() sets the value of res to the ID of the polygon the point falls 
> # in, or to NA if the point does not fall in any polygon.
> 
> plot(x, col="grey")
> points(xp[is.na(res)], col="red")
> points(xp[!is.na(res)], col="blue")
> 
> and you can choose the points for the prediction locations as:
> 
> <my prediction locations> <- xp[!is.na(res)]

Further to my own reply, the last line was not right:

> xx <- xp[!is.na(res)]
> class(xx)
[1] "SpatialPoints"
attr(,"package")
[1] "sp"
> class(coordinates(xx))
[1] "matrix"

so what you need is:

<my prediction locations> <- coordinates(xp[!is.na(res)])

which returns just the matrix of point coordinates without the other 
information.

This now works, using check.locations() called by krige.conv():

> check.locations(xx)
[1] "no"
> check.locations(coordinates(xx))
      coords.x1 coords.x2
 [1,] 2.8883985 1.5438226
 [2,] 2.1517145 1.4901741
 [3,] 0.8694240 1.9049170

...


> 
> Please check on the plot to see if overlay divides up the points correctly 
> first, just to be sure. If this works, it is will be a nice example of how 
> the coordination of spatial data functions in the "sp" package can make 
> things easier (if not, any reports on difficulties with "sp" are always 
> welcome).
> 
> Roger
> 
> >  But i'm not sure that it's the good polylist object i need because it's
> > a polygon grid in fact.
> 
> > Thank you for your help
> > Chlo?
> > -----Message d'origine-----
> > De?: Roger Bivand [mailto:Roger.Bivand at nhh.no] 
> > Envoy??: jeudi 19 mai 2005 19:07
> > ??: Chloe ARCHINARD
> > Cc?: r-sig-geo at stat.math.ethz.ch
> > Objet?: Re: [R-sig-Geo] kriging inside borders
> > 
> > On Thu, 19 May 2005, Chloe ARCHINARD wrote:
> > 
> > 
> > > Hello, I'm using geoR package to compute kriging with the function
> > 
> > > krige.conv() and I used maptools (read.shape () + Map2poly () )  and
> > 
> > > splancs (borders) packages to include a object of class polylist for the
> > 
> > > attribute borders.
> > 
> > 
> > >  But I've got this message of error when 'borders' is in krige.conv () :  
> > 
> > > krige.conv: there are no prediction locations inside the borders.  My
> > 
> > > polylist is not good? The coordinates seam to be OK when I draw a map
> > 
> > > with this polylist object. And if I use 'borders' in the contour
> > 
> > > function : message error is :
> > 
> > 
> > > Error in as.data.frame.default(borders) : can't coerce class "polylist"
> > 
> > > into a data.frame
> > 
> > 
> > Firstly, it does help if the exact commands are given, rather than your 
> > 
> > choice of them. I think the main issue here is that a polylist object is a 
> > 
> > list of matrices with attributes, not a matrix. If your polylist object 
> > 
> > is:
> > 
> > 
> > x <- Map2poly(read.shape("my.shp"))
> > 
> > 
> > what is length(x)? If it is 1, you may be able to say x[[1]] to extract 
> > 
> > the first matrix in the list, but even then it may not work. If you can 
> > 
> > show us the commands you are giving, and the length of your polylist 
> > 
> > object, it should be possible to find something that works. 
> > 
> > 
> > 
> > > If someone could help me, thanks a lot!
> > 
> > 
> > > Chlo? Archinard
> > 
> > > 
> > 
> > > 
> > 
> > 
> > -- 
> > 
> > Roger Bivand
> > 
> > Economic Geography Section, Department of Economics, Norwegian School of
> > 
> > Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> > 
> > Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> > 
> > e-mail: Roger.Bivand at nhh.no
> > 
> > 
> > 
> > -- 
> > passerelle antivirus du campus CNRS de Montpellier
> > --
> > 
> > 
> > 
> > 
> 
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From Roger.Bivand at nhh.no  Mon May 23 13:08:25 2005
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 23 May 2005 13:08:25 +0200 (CEST)
Subject: [R-sig-Geo] Re: [R] Maps, Eastern Europe
Message-ID: <Pine.LNX.4.44.0505231258540.9661-100000@reclus.nhh.no>

Ray Brownrigg wrote:

> Unfortunately the world databases for the maps package are very old
> (early 1990's) and have not been updated since, except for minor
> typographical errors in country names.  Note that Czechoslovakia is
> there (as is USSR!).  Also, it currently satisfies my needs, which is
> why I don't have the resources to update it.

> I suggest you start with the maptools package, but as I understand it,
> you need to also find some appropriate shapefile data. [Other
> respondents may improve upon this suggestion.]

http://meta.wikimedia.org/wiki/Geographical_data 

provides some links, including one to:

http://www.esri.com/data/download/basemap/index.html

permitting the downloading of various layers as shapefiles that can be
read and handled by the maptools package. If you choose just country
boundaries, you'll get a lat-long rectangle, including the countries you
want (and (parts of) countries you don't). You may need to subset your
requests, because the website restricts how much you can choose at one go.  
Please contact me off-list or move this to the R-sig-geo list for more
information.

Roger

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From Roger.Bivand at nhh.no  Mon May 23 16:08:42 2005
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 23 May 2005 16:08:42 +0200 (CEST)
Subject: [R-sig-Geo] kriging inside borders
In-Reply-To: <EB09E5B9F0E2684F863B525E5C7E0F891223AA@ZZML.newcefe.newage.fr>
Message-ID: <Pine.LNX.4.44.0505231526240.4129-100000@reclus.nhh.no>

On Mon, 23 May 2005, Chloe ARCHINARD wrote:

> Here is in attached file the map plotted by 
> 
> > plot(x, col="grey")
> 
> > points(xp[is.na(res)], col="red")
> 
> > points(xp[!is.na(res)], col="blue")
> 
> It seems to be OK! When I use krige.conv to make kriging, in fact it
> makes prediction only inside each polygon cell. I explain me, it make
> one prediction per cell and the result of kriging is a mosaic of colors
> and not a map with gradients. I can't use contour() and I use :

> Plot(x,y,kc$predict) #x,y are coordinates for xx

> (If it is not clear I can send you the maps.) but thank you for your
> help, I will try something else.

The attachment is unfortunately in *.emf format, which can only be opened 
on Windows. A PNG graphic would have been enough, I think.

As far as your data are concerned, I think another possibility is to 
respect the fact that the rings were actually an incomplete grid. I guess 
that the prediction locations are the centroids of the grid cells. These 
suit the "sp" package class of SpatialPixels very well:

> shapefile <- read.shape("xdf.shp")
Shapefile Type: Polygon   # of Shapes: 4 
> x <- as.SpatialRings.Shapes(shapefile$Shapes, IDs=1:length(shapefile$Shapes))
> pts <- getSRSringsLabptSlots(x)
> pts
     [,1] [,2]
[1,]  1.5  0.5
[2,]  0.5  1.5
[3,]  2.5  1.5
[4,]  1.5  2.5

> check.locations(pts)
     [,1] [,2]
[1,]  1.5  0.5
[2,]  0.5  1.5
[3,]  2.5  1.5
[4,]  1.5  2.5

Make your prediction:

> kr.out <- krige.conv(..., locations=pts, ...)

Then use the "sp" magic to attach the points (which are regularly spaced) 
to the predictions:

res <- SpatialPixelsDataFrame(SpatialPoints(pts), list(z=kr.out$predict, 
z.se=krige.var))

should work. Try print(res) to confirm that it is a 
SpatialPixelsDataFrame. Then spplot(res, "z") will plot the predictions - 
the help page for spplot shows how to set the breaks and colour palette. 
This avoids the overlay step, and will work provided the points are spaced 
as a (rectangular) grid, even though many grid cells are missing.

If you want to share graphics, PNG - device png() - are much smaller. If 
you can put them on a web server, that's even better.

Hope this helps,

Roger



> Chlo? 
> 
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From Roger.Bivand at nhh.no  Mon May 23 16:21:50 2005
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 23 May 2005 16:21:50 +0200 (CEST)
Subject: TR: [R-sig-Geo] kriging inside borders
In-Reply-To: <EB09E5B9F0E2684F863B525E5C7E0F891223B0@ZZML.newcefe.newage.fr>
Message-ID: <Pine.LNX.4.44.0505231616241.4129-100000@reclus.nhh.no>

On Mon, 23 May 2005, Chloe ARCHINARD wrote:

> 
> 
> Overlay function is an interesting function, it seems to work good!
> It's very useful to create the prediction location for kriging : 
> predict <- coordinates(xp[!is.na(res)])
> kc=krige.conv(geodata,loc=predict,
> krige=krige.control(type.krige="ok",cov.model="spherical",
> cov.pars=c(sill,range),nugget=value)) 
> there's no error message but I can't plot the kriging prediction. With :
> image(kc)
> Error in image.default(x = c(1275000, 1285000, 1295000, 1305000, 1315000,  : 
>         dimensions of z are not length(x)(+1) times length(y)(+1)
> In addition: Warning message: 

> data length [2683] is not a sub-multiple or multiple of the number of
> rows [33] in matrix
> 
> I tried with another shapefile.shp, which is after shape.read() and
> Map2poly() a polylist object of length [[1]], so I can use this for
> borders() in krige.conv(). Kriging runs well but the result of contour()
> present problems! See the map! I don't have enough time to think more
> about that, but if I understand the problem I send you an answer. Thank
> you for your help!
> 

Firstly, your postings with attachments are being rejected by the mailing
list, so please try to post them on a website/homepage if you want the
list to see them.

Neither standard contour() nor standard image() are going to work on data 
in a different format than they understand. That is why using the 
SpatialPixel format is so nice, a regular but incomplete grid is made into 
a suitable format for plotting (there are other ways than spplot(), but 
this function is particularly flexible). Unfortunately, everything takes 
time!

Roger

> Chlo? 
> 
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From sokolmatt at gmail.com  Mon May 23 23:17:19 2005
From: sokolmatt at gmail.com (Matthew Sokol)
Date: Mon, 23 May 2005 14:17:19 -0700
Subject: [R-sig-Geo] Simulation question
Message-ID: <4505b2b105052314175a9d9076@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20050523/66d9eddb/attachment.pl>

From sokolmatt at gmail.com  Tue May 24 00:16:19 2005
From: sokolmatt at gmail.com (Matthew Sokol)
Date: Mon, 23 May 2005 15:16:19 -0700
Subject: [R-sig-Geo] Simulation question
In-Reply-To: <Pine.LNX.4.58L0.0505231842090.27231@est.ufpr.br>
References: <4505b2b105052314175a9d9076@mail.gmail.com>
	<Pine.LNX.4.58L0.0505231842090.27231@est.ufpr.br>
Message-ID: <4505b2b1050523151619e4021a@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20050523/7c4151c4/attachment.pl>

From Roger.Bivand at nhh.no  Tue May 24 20:40:19 2005
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 24 May 2005 20:40:19 +0200 (CEST)
Subject: [R-sig-Geo] maptools package rejects some polygon shapefiles?
In-Reply-To: <1115915535.14455.233995071@webmail.messagingengine.com>
Message-ID: <Pine.LNX.4.44.0505242030570.5605-100000@reclus.nhh.no>

Calling Arc users!

Could somebody please make available some small example 3D points and arcs
for me to try out on read.shape() (or a link to a public repository of
type POINTZ, ARCZ, and POLYGONZ shapefiles). 3D polygons now work, thanks
to an example file from Rick Reeves, but I have no way of creating 3D
points or lines to check the function in action, and I don't want to 
release an untried function (inviting seg.faults).

The idea is to support 3D points directly, but to drop the Z values for 
lines and polygon boundaries - the original example was anyway for the 
coastline of North America in latlong, so the Z value wasn't so important. 
Having discussed transect or track data at the Valencia "sp" meeting, we 
think that a transect should be a SpatialPoints object (which can take 3D 
points), not a line; this will need extra attention when plotting.

Roger

On Thu, 12 May 2005, Nicholas Lewin-Koh wrote:

> Hi,
> No I actually meant to have a slot, or place for the 3rd dimension. and
> for plotting methods treat it like an attribute. I was trying to think
> of situations where 
> 3d lines or polygons would be useful, admittedly I am a little stumpped,
> but I am sure
> there must be something other than pretty flythroughs :) Maybe a polygon
> view of a surface 
> where thew polygon heights are interpolated from binned data to the
> vertices of the polygon?
> 
> Nicholas
> 
> On Thu, 12 May 2005 18:09:45 +0200 (CEST), "Roger Bivand"
> <Roger.Bivand at nhh.no> said:
> > On Thu, 12 May 2005, Nicholas Lewin-Koh wrote:
> > 
> > > Hi,
> > > Wouldn't it make more sense to handle 3d file as 3d?
> > > In outher words store 3d poionts as 3d points. For dealing 
> > > with this in R, we could write methods that would display the 
> > > 3rd dimension as an attribute. I don't think it would be hard to change
> > > the
> > > underlying C code to reade shape 3d files. I think the challange would
> > > be in the
> > > R data structure and methods.
> > 
> > For points, 3D will be OK, one Z value per point, hence an attribute. But 
> > with lines and polygons, is anyone likely to need all three dimensions? 
> > The attributes are attached to each shape, which implies that a per
> > vertex 
> > attribute would be a different kind of thing, wouldn't it? Which research 
> > situations might need 3D for anything other than points? It can probably 
> > be done, but the sp package lines and rings are 2D, and they would be the 
> > containers I would look at first (unless persuaded otherwise).
> > 
> > Roger
> > 
> > > 
> > > Nicholas
> > > 
> > > Date: Thu, 12 May 2005 10:58:31 +0200 (CEST)
> > > From: Roger Bivand <Roger.Bivand at nhh.no>
> > > Subject: RE: [R-sig-Geo] maptools package rejects some polygon
> > >         shapefiles?
> > > To: Rick Reeves <reeves at nceas.ucsb.edu>
> > > Cc: r-sig-geo at stat.math.ethz.ch
> > > Message-ID: <Pine.LNX.4.44.0505121055521.11044-100000 at reclus.nhh.no>
> > > Content-Type: TEXT/PLAIN; charset=US-ASCII
> > > 
> > > On Wed, 11 May 2005, Rick Reeves wrote:
> > > 
> > > >
> > > > Roger:
> > > >
> > > > Thanks for the quick response. Here is the file,
> > > > and I will follow your suggestions.....
> > > > The ArcCatalog metadata section claims that this
> > > > is a Simple Polygon file, Topology FALSE,
> > > > feature count 558, spatial index = TRUE,
> > > > Linear Referencing = TRUE, geographic coord system
> > > 
> > > 
> > > Rick:
> > > 
> > > (I'm replying to the list too to ask for comments)
> > > 
> > > The file is recognised by ogrinfo as:
> > > 
> > > $ ogrinfo NorthAmericaBest.shp
> > > INFO: Open of `NorthAmericaBest.shp'
> > > using driver `ESRI Shapefile' successful.
> > > 1: NorthAmericaBest (3D Polygon)
> > > 
> > > It should not be too difficult to change read.shape to read 3D points as
> > > 3D, and 3D lines and polygons as 2D. I guess that stripping the Z values
> > > is not a problem for anybody (excepting points I think)?
> > > 
> > > Thanks for your help - with a sample file to study, making this work
> > > will
> > > be much easier. Does anyone have 3D lines and 3D points files?
> > > 
> > > Best wishes,
> > > 
> > > Roger
> > > 
> > > 
> > > >
> > > > Regards,
> > > > Rick R
> > > >
> > > >
> > > > Scientific Programmer / Quantitative Analyst
> > > > National Center for Ecological Analysis and Synthesis
> > > > University of California, Santa Barbara
> > > > 805 892 2534
> > > > reeves at nceas.ucsb.edu
> > > >
> > > >
> > > >
> > > > -----Original Message-----
> > > > From: Roger Bivand [mailto:Roger.Bivand at nhh.no]
> > > > Sent: Wednesday, May 11, 2005 12:08 PM
> > > > To: Rick Reeves
> > > > Cc: r-sig-geo at stat.math.ethz.ch
> > > > Subject: RE: [R-sig-Geo] maptools package rejects some polygon
> > > > shapefiles?
> > > >
> > > >
> > > > On Wed, 11 May 2005, Rick Reeves wrote:
> > > >
> > > > > News flash: the read.shapefile() method in the shapefiles package
> > > > reads
> > > > > the file.
> > > >
> > > > It would be useful to see what getinfo.shape(filen) says, and to have a
> > > > sight of the file. The error message suggests that it is neither type 3
> > > > (PolyLine) nor type 5 (Polygon), so ArcGIS 9 must be using other codes
> > > > (perhaps for PolyLineM, PolyLineeM, or their polygon equivalents). If
> > > > you
> > > > could make the file available, it may be possible to try to handle files
> > > >
> > > > like this (benefitting others, since you have a working solution).
> > > >
> > > > Roger
> > > >
> > > > >
> > > > > btw, this is a shapefile based on the VMAP0 / DCW dataset.
> > > > >
> > > > > RR
> > > > >
> > > > > Scientific Programmer / Quantitative Analyst
> > > > > National Center for Ecological Analysis and Synthesis
> > > > > University of California, Santa Barbara
> > > > > 805 892 2534
> > > > > reeves at nceas.ucsb.edu
> > > > >
> > > > >
> > > > >
> > > > > -----Original Message-----
> > > > > From: r-sig-geo-bounces at stat.math.ethz.ch
> > > > > [mailto:r-sig-geo-bounces at stat.math.ethz.ch] On Behalf Of Rick Reeves
> > > > > Sent: Wednesday, May 11, 2005 9:46 AM
> > > > > To: r-sig-geo at stat.math.ethz.ch
> > > > > Subject: [R-sig-Geo] maptools package rejects some polygon shapefiles?
> > > > >
> > > > >
> > > > >
> > > > >
> > > > > Greetings:
> > > > >
> > > > > Using maptools in the Win XP environment, trying to
> > > > > display an ESRI Shapefile (created with ArcMAP GIS ver 9)
> > > > > outline map of North America. read.shape throws error:
> > > > > Error in read.shape: Not a valid shape type.
> > > > >
> > > > > read.sahpe does read (and plot displays) a point shapefile
> > > > > created on the same platform.
> > > > >
> > > > > Any hints on determining the problem with 'not valid' shapefiles
> > > > > in R?
> > > > >
> > > > > Thanks,
> > > > > Rick R
> > > > >
> > > > >
> > > > > Scientific Programmer / Quantitative Analyst
> > > > > National Center for Ecological Analysis and Synthesis
> > > > > University of California, Santa Barbara
> > > > > 805 892 2534
> > > > > reeves at nceas.ucsb.edu
> > > > >
> > > > > _______________________________________________
> > > > > R-sig-Geo mailing list
> > > > > R-sig-Geo at stat.math.ethz.ch
> > > > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > > > >
> > > > > _______________________________________________
> > > > > R-sig-Geo mailing list
> > > > > R-sig-Geo at stat.math.ethz.ch
> > > > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > > > >
> > > >
> > > >
> > > 
> > > 
> > 
> > -- 
> > Roger Bivand
> > Economic Geography Section, Department of Economics, Norwegian School of
> > Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> > Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> > e-mail: Roger.Bivand at nhh.no
> > 
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From pawliw at sympatico.ca  Fri May 27 19:19:48 2005
From: pawliw at sympatico.ca (Ken Pawliw)
Date: Fri, 27 May 2005 13:19:48 -0400
Subject: [R-sig-Geo] problem running example(gwr) in package spgwr_0.2-7
	(Windows binary)
Message-ID: <AKEPLJBBNIODDMLOJBBHKEDMCDAA.pawliw@sympatico.ca>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20050527/50f58bfa/attachment.pl>

From Roger.Bivand at nhh.no  Fri May 27 19:47:22 2005
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 27 May 2005 19:47:22 +0200 (CEST)
Subject: [R-sig-Geo] problem running example(gwr) in package spgwr_0.2-7
	(Windows binary)
In-Reply-To: <AKEPLJBBNIODDMLOJBBHKEDMCDAA.pawliw@sympatico.ca>
Message-ID: <Pine.LNX.4.44.0505271934040.4423-100000@reclus.nhh.no>

On Fri, 27 May 2005, Ken Pawliw wrote:

> I am encountering errors when attempting to run the example(gwr) in the
> spgwr package. The first 4 commands run correctly, however I receive an
> error trying to execute the 5th command.
> 
> gwr> data(columbus)
> 
> gwr> col.lm <- lm(crime ~ income + housing, data = columbus)
> 
> gwr> summary(col.lm)
> 
> gwr> col.bw <- gwr.sel(crime ~ income + housing, data = columbus,
>     coords = cbind(columbus$x, columbus$y))
> 
> gwr> col.gauss <- gwr(crime ~ income + housing, data = columbus,
>     coords = cbind(columbus$x, columbus$y), bandwidth = col.bw,
>     hatmatrix = TRUE)
> Error in gridded(fit.points) : No direct or inherited method for function
> "gridded" for this call
> 
> I'm running the following configuration on Windows XP.
> Windows R 2.0.1
> Windows Binary sp_0.7-0.zip
> Windows Binary spgwr_0.2-7.zip

This information is just what is needed.

All of these are now superceded, and what is happening here is that the
(older) spgwr "view" of the sp classes no longer fits reality. This is a
bit of a problem if you need to keep R 2.0.1, rather than upgrading to R
2.1.0. If you upgrade, you can install the current sp package from CRAN,
and the Windows binary (spgwr_0.3-1) with the commands given on the
R-spatial homepage:

rSpatial <- "http://r-spatial.sourceforge.net/R"
install.packages("spgwr", repos=rSpatial)

But that is presupposing you are prepared to upgrade R itself. If not, 
then that functionality is not available. Please let the list know how you 
get on, sp is developing nicely, but there is plenty of opportunity to 
contribute ideas and reports.

Roger

> 
> Any guidance would be appreciated.
> 
> Ken
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From neteler at itc.it  Tue May 31 15:47:31 2005
From: neteler at itc.it (Markus Neteler)
Date: Tue, 31 May 2005 15:47:31 +0200
Subject: [R-sig-Geo] R-stats - GRASS6
Message-ID: <20050531134731.GD3694@thuille.itc.it>

Dear list members,

I am currently trying out the new GRASS 6/R-stats interface.
I installed all software today (R-2.1.0, all interfaces, using
GRASS 6.1-CVS).

There is a little problem which I don't understand:

> library(spgrass6)
> G <- gmeta6()
> str(G)
List of 28
 $ GISDBASE         : chr "/ssi0/ssi/neteler/grassdata"
 $ LOCATION_NAME    : chr "spearfish60"
 $ MAPSET           : chr "neteler"
 $ GRASS_DB_ENCODING: chr "utf-8"
 $ DEBUG            : chr "0"
 $ MONITOR          : chr "x0"
 $ GRASS_GUI        : chr "text"
 $ projection       : chr "1 (UTM)"
[...]

> system("r.info -t landcover.orig")
datatype=CELL
> landcover <- readCELL6sp("landcover.orig", cat = TRUE)
Error in "names<-.default"(`*tmp*`, value = "landcover.orig") :
        'names' attribute [1] must be the same length as the vector [0]

# this works:
> landcover <- readCELL6sp("geology", cat = FALSE)
>

> lcov <- readCELL6sp("landcover.30m",cat = TRUE)
Error in "names<-.default"(`*tmp*`, value = "landcover.30m") :
        'names' attribute [1] must be the same length as the vector [0]


I was inspired by
 http://r-spatial.sourceforge.net/xtra/xtra.RHnw.html
and the upcoming article from Roger Bivand in the GRASS Newsletter Vol3.

Was there a change recently which makes category transfer fail?

Best regards

 Markus

-- 
Markus Neteler     <neteler itc it>       http://mpa.itc.it
ITC-irst -  Centro per la Ricerca Scientifica e Tecnologica
MPBA - Predictive Models for Biol. & Environ. Data Analysis
Via Sommarive, 18        -       38050 Povo (Trento), Italy



From Roger.Bivand at nhh.no  Tue May 31 18:53:31 2005
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 31 May 2005 18:53:31 +0200 (CEST)
Subject: [R-sig-Geo] R-stats - GRASS6
In-Reply-To: <20050531134731.GD3694@thuille.itc.it>
Message-ID: <Pine.LNX.4.44.0505311812010.17616-100000@reclus.nhh.no>

On Tue, 31 May 2005, Markus Neteler wrote:

> Dear list members,
> 
> I am currently trying out the new GRASS 6/R-stats interface.
> I installed all software today (R-2.1.0, all interfaces, using
> GRASS 6.1-CVS).
> 
> There is a little problem which I don't understand:
> 
> > library(spgrass6)
> > G <- gmeta6()
> > str(G)
> List of 28
>  $ GISDBASE         : chr "/ssi0/ssi/neteler/grassdata"
>  $ LOCATION_NAME    : chr "spearfish60"
>  $ MAPSET           : chr "neteler"
>  $ GRASS_DB_ENCODING: chr "utf-8"
>  $ DEBUG            : chr "0"
>  $ MONITOR          : chr "x0"
>  $ GRASS_GUI        : chr "text"
>  $ projection       : chr "1 (UTM)"
> [...]
> 
> > system("r.info -t landcover.orig")
> datatype=CELL
> > landcover <- readCELL6sp("landcover.orig", cat = TRUE)
> Error in "names<-.default"(`*tmp*`, value = "landcover.orig") :
>         'names' attribute [1] must be the same length as the vector [0]

I can't replicate this, I'm afraid (R 2.1.0, Linux, sp 0.7-7, spgrass6
0.1-4 (from CVS on sourceforge, GRASS 6.0.0 release). I don't think the sp 
or spgrass6 versions make a difference. 

Could you say debug(readCELL6sp) and re-run this please - that should show 
which line is failing. Once we know that, please check the arguments to 
that function for sanity. I don't think it is important, but I'm running 
under LANG=en_GB ; export LANG, not UTF8. My current guess is that the 
problem is in:

res <- read.asciigrid(tmpfl, colname = vname, proj4string = p4)

where vname is the layer name. If you additionally do 
debug(read.asciigrid), it may fail at: names(df) = colname - please see 
what is in colname, and if length(colname) is the same as length(df). One 
possibility is that there is something amiss in read.asciigrid().

The landcover.orig layer is strange because there are no category labels 
at all, so:

> system("r.stats -l -q landcover.orig")
11 
21 
22 
23 
31 
32 
41 
42 
43 
51 
71 
81 
82 
83 
85 
91 
92 
* no data

so the factor gets built without labels:

> str(landcover)
Formal class 'SpatialGridDataFrame' [package "sp"] with 6 slots
  ..@ data       :Formal class 'AttributeList' [package "sp"] with 1 slots
  .. .. ..@ att:List of 1
  .. .. .. ..$ landcover.orig: Factor w/ 17 levels "","","","","",..: NA 15 2 2 2 2 2 2 2 2 ...
  ..@ grid       :Formal class 'GridTopology' [package "sp"] with 3 slots
  .. .. ..@ cellcentre.offset: num [1:2]  589995 4913715
  .. .. ..@ cellsize         : num [1:2] 30 30
  .. .. ..@ cells.dim        : int [1:2] 634 477
  ..@ grid.index : int(0) 
  ..@ coords     : num [1:2, 1:2]  589995  608985 4913715 4927995
  .. ..- attr(*, "dimnames")=List of 2
  .. .. ..$ : NULL
  .. .. ..$ : chr [1:2] "coords.x1" "coords.x2"
  ..@ bbox       : num [1:2, 1:2]  589995 4913715  608985 4927995
  .. ..- attr(*, "dimnames")=List of 2
  .. .. ..$ : chr [1:2] "coords.x1" "coords.x2"
  .. .. ..$ : chr [1:2] "min" "max"
  ..@ proj4string:Formal class 'CRS' [package "sp"] with 1 slots
  .. .. ..@ projargs: chr "+proj=utm +zone=13 +a=6378206.4 +rf=294.9786982 +no_defs +nadgrids=conus"

suggesting that the function should check for unique labels of the 
matching number.

Best wishes,

Roger

> 
> # this works:
> > landcover <- readCELL6sp("geology", cat = FALSE)
> >
> 
> > lcov <- readCELL6sp("landcover.30m",cat = TRUE)
> Error in "names<-.default"(`*tmp*`, value = "landcover.30m") :
>         'names' attribute [1] must be the same length as the vector [0]
> 
> 
> I was inspired by
>  http://r-spatial.sourceforge.net/xtra/xtra.RHnw.html
> and the upcoming article from Roger Bivand in the GRASS Newsletter Vol3.
> 
> Was there a change recently which makes category transfer fail?
> 
> Best regards
> 
>  Markus
> 
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From neteler at itc.it  Tue May 31 19:15:10 2005
From: neteler at itc.it (Markus Neteler)
Date: Tue, 31 May 2005 19:15:10 +0200
Subject: [R-sig-Geo] R-stats - GRASS6
In-Reply-To: <Pine.LNX.4.44.0505311812010.17616-100000@reclus.nhh.no>
References: <20050531134731.GD3694@thuille.itc.it>
	<Pine.LNX.4.44.0505311812010.17616-100000@reclus.nhh.no>
Message-ID: <20050531171510.GC30343@thuille.itc.it>

Dear Roger,

On Tue, May 31, 2005 at 06:53:31PM +0200, Roger Bivand wrote:
> On Tue, 31 May 2005, Markus Neteler wrote:
> 
> > Dear list members,
> > 
> > I am currently trying out the new GRASS 6/R-stats interface.
> > I installed all software today (R-2.1.0, all interfaces, using
> > GRASS 6.1-CVS).
> > 
> > There is a little problem which I don't understand:
> > 
> > > library(spgrass6)
> > > G <- gmeta6()
> > > str(G)
> > List of 28
> >  $ GISDBASE         : chr "/ssi0/ssi/neteler/grassdata"
> >  $ LOCATION_NAME    : chr "spearfish60"
> >  $ MAPSET           : chr "neteler"
> >  $ GRASS_DB_ENCODING: chr "utf-8"
> >  $ DEBUG            : chr "0"
> >  $ MONITOR          : chr "x0"
> >  $ GRASS_GUI        : chr "text"
> >  $ projection       : chr "1 (UTM)"
> > [...]
> > 
> > > system("r.info -t landcover.orig")
> > datatype=CELL
> > > landcover <- readCELL6sp("landcover.orig", cat = TRUE)
> > Error in "names<-.default"(`*tmp*`, value = "landcover.orig") :
> >         'names' attribute [1] must be the same length as the vector [0]
> 
> I can't replicate this, I'm afraid (R 2.1.0, Linux, sp 0.7-7, spgrass6
> 0.1-4 (from CVS on sourceforge, GRASS 6.0.0 release). I don't think the sp 
> or spgrass6 versions make a difference. 
> 
> Could you say debug(readCELL6sp) and re-run this please - that should show 
> which line is failing. Once we know that, please check the arguments to 
> that function for sanity. I don't think it is important, but I'm running 
> under LANG=en_GB ; export LANG, not UTF8. My current guess is that the 
> problem is in:
> 
> res <- read.asciigrid(tmpfl, colname = vname, proj4string = p4)
> 
> where vname is the layer name. If you additionally do 
> debug(read.asciigrid), it may fail at: names(df) = colname - please see 
> what is in colname, and if length(colname) is the same as length(df). One 
> possibility is that there is something amiss in read.asciigrid().
> 
> The landcover.orig layer is strange because there are no category labels 
> at all, so:

[... took the wrong landuse map, but it doesn't change ...]

> library(spgrass6)
Loading required package: rgdal
Loading required package: abind
Loading required package: pixmap
Geospatial Data Abstraction Library extensions to R successfully loaded
Loading required package: sp
> G <- gmeta6()

> landcover <- readCELL6sp("landcover.30m", cat = TRUE)
Error in "names<-.default"(`*tmp*`, value = "landcover.30m") :
        'names' attribute [1] must be the same length as the vector [0]
> debug(readCELL6sp)

> system("r.stats -l -q landcover.30m | head -20")
11 Open Water
21 Low Intensity Residential
22 High Intensity Residential
23 Commercial/Industrial/Transportation
31 Bare Rock/Sand/Clay
32 Quarries/Strip Mines/Gravel Pits
41 Deciduous Forest
42 Evergreen Forest
43 Mixed Forest
51 Shrubland
71 Grasslands/Herbaceous
81 Pasture/Hay
82 Row Crops
83 Small Grains
85 Urban/Recreational Grasses
91 Woody Wetlands
92 Emergent Herbaceous Wetlands
* no data

> landcover <- readCELL6sp("landcover.30m", cat = TRUE)
debugging in: readCELL6sp("landcover.30m", cat = TRUE)
debug: {
[...]
}
Browse[1]>
debug: tmpfl <- tempfile()
Browse[1]>
debug: system(paste("r.out.arc input=", vname, " output=", tmpfl, sep = ""))
Browse[1]>
debug: library(sp)
Browse[1]>
debug: p4 <- CRS(system("g.proj -j -f", intern = TRUE))
Browse[1]>
debug: res <- read.asciigrid(tmpfl, colname = vname, proj4string = p4)
Browse[1]>
debug: if (cat) {
    cats <- strsplit(system(paste("r.stats -l -q", vname), intern = TRUE),
        " ")
    catnos <- sapply(cats, function(x) x[1])
    catlabs <- sapply(cats, function(x) paste(x[-1], collapse = " "))
    if (any(!is.na(match(catnos, "*")))) {
        isNA <- which(catnos == "*")
        catnos <- catnos[-isNA]
        catlabs <- catlabs[-isNA]
    }
    res at data[, 1] <- factor(res at data[, 1], levels = catnos, labels = catlabs)
} else {
    res at data[, 1] <- as.integer(res at data[, 1])
}
Browse[1]>
debug: cats <- strsplit(system(paste("r.stats -l -q", vname), intern = TRUE),
    " ")
Browse[1]>
debug: catnos <- sapply(cats, function(x) x[1])
Browse[1]>
debug: catlabs <- sapply(cats, function(x) paste(x[-1], collapse = " "))
Browse[1]>
debug: if (any(!is.na(match(catnos, "*")))) {
    isNA <- which(catnos == "*")
    catnos <- catnos[-isNA]
    catlabs <- catlabs[-isNA]
}
Browse[1]>
debug: isNA <- which(catnos == "*")
Browse[1]>
debug: catnos <- catnos[-isNA]
Browse[1]>
debug: catlabs <- catlabs[-isNA]
Browse[1]>
debug: res at data[, 1] <- factor(res at data[, 1], levels = catnos, labels = catlabs)
Browse[1]>
Error in "names<-.default"(`*tmp*`, value = "landcover.30m") :
        'names' attribute [1] must be the same length as the vector [0]
>  


> debug(read.asciigrid)
> undebug(readCELL6sp)

> landcover <- readCELL6sp("landcover.30m", cat = TRUE)
[...]
Browse[1]>
debug: df = data.frame(map)
Browse[1]>
debug: names(df) = colname
Browse[1]> length(colname)
[1] 1
Browse[1]> length(df)
[1] 1
Browse[1]> colname
[1] "landcover.30m"
Browse[1]> df
[...all values...]

> str(df)
`data.frame':   302418 obs. of  1 variable:
 $ map: num  NA NA NA NA NA NA NA NA NA NA ...
Browse[1]>
debug: grid = GridTopology(c(xllcenter, yllcenter), rep(cellsize, 2),
    c(ncols, nrows))
Browse[1]>
debug: SpatialGridDataFrame(grid, data = df, proj4string = proj4string)
Browse[1]>
exiting from: read.asciigrid(tmpfl, colname = vname, proj4string = p4)
Error in "names<-.default"(`*tmp*`, value = "landcover.30m") :
        'names' attribute [1] must be the same length as the vector [0]
>    

I don't know if this is already helpful.

Best regards

 Markus



