From c@rr@nz@ju@np @end|ng |rom gm@||@com  Sat Jun  1 07:40:53 2019
From: c@rr@nz@ju@np @end|ng |rom gm@||@com (Juan Pablo Carranza)
Date: Sat, 1 Jun 2019 02:40:53 -0300
Subject: [R-sig-Geo] Calculate the internal angles of polygons
Message-ID: <CAFSWaCPZqvOUodO2H46YZ-ZNO3855=sawOeV8m=AJa_ztFG+Kw@mail.gmail.com>

Dear members,
I'm having trouble in calculating the internal angles of a set of polygons.
I have a sf "MULTIPOLYGON" object of 5000 land parcels that has been tagged
according to their shape. The objective is to train an algorithm to predict
a large dataset (over 2 million polygons) according to these
classification. But that is a problem that comes forward.
First I need to calculate the internal angles of each one of the polygons
in the sample, in order to eliminate unnecesary nodes (yes, I tryed
st_simplify and also ms_simplify, but I need to control the process by the
angle values).
Here is as far as I get, a few lines of code (with an example polygon). The
next steps will be dealing with a way to generate a dataframe in wich each
row is a line of each polygon (decomposing the geometry but preserving the
polygon entityid in order to go back... easy to do with spdplyr?), and find
a way to calculate the angle between adjscent lines. Need a hand, please!

x =
c(4293215,4293205,4293205,4293194,4293174,4293176,4293190,4293201,4293204,4293218,4293215)
y =
c(6463731,6463733,6463734,6463736,6463740,6463750,6463747,6463744,6463744,6463741,6463731)
cords = cbind(x, y)
library(sp)
p = Polygon(cords)
ps = Polygons(list(p),1)
poly = SpatialPolygons(list(ps))
plot(poly)
library(sf)
poly = st_as_sf(poly)
lines = st_cast(poly$geometry, "LINESTRING")
plot(lines)
# not run: this turns the object too simple, I need to work on very complex
shapes.
# lines = st_simplify(lines, preserveTopology = FALSE, dTolerance = 1)

Really sorry for the lousy english... Best regards.

*MSc. Juan Pablo Carranza*
Economist

	[[alternative HTML version deleted]]


From md@umner @end|ng |rom gm@||@com  Sat Jun  1 10:20:20 2019
From: md@umner @end|ng |rom gm@||@com (Michael Sumner)
Date: Sat, 1 Jun 2019 18:20:20 +1000
Subject: [R-sig-Geo] Calculate the internal angles of polygons
In-Reply-To: <CAFSWaCPZqvOUodO2H46YZ-ZNO3855=sawOeV8m=AJa_ztFG+Kw@mail.gmail.com>
References: <CAFSWaCPZqvOUodO2H46YZ-ZNO3855=sawOeV8m=AJa_ztFG+Kw@mail.gmail.com>
Message-ID: <CAAcGz98PZ8y64-gR5CGSMZj9YiB+60tFCWkUQqtccfHqozWodg@mail.gmail.com>

There's code in trip for the angles, but arranging the underlying coords
and expressing those in the right form will be the crux. st_coordinates
gives what you need, or pure data frame from spbabel::sptable is what I'd
start with.

I'll take a look when I can.

Cheers, Mike


On Sat., 1 Jun. 2019, 15:41 Juan Pablo Carranza, <carranzajuanp at gmail.com>
wrote:

> Dear members,
> I'm having trouble in calculating the internal angles of a set of polygons.
> I have a sf "MULTIPOLYGON" object of 5000 land parcels that has been tagged
> according to their shape. The objective is to train an algorithm to predict
> a large dataset (over 2 million polygons) according to these
> classification. But that is a problem that comes forward.
> First I need to calculate the internal angles of each one of the polygons
> in the sample, in order to eliminate unnecesary nodes (yes, I tryed
> st_simplify and also ms_simplify, but I need to control the process by the
> angle values).
> Here is as far as I get, a few lines of code (with an example polygon). The
> next steps will be dealing with a way to generate a dataframe in wich each
> row is a line of each polygon (decomposing the geometry but preserving the
> polygon entityid in order to go back... easy to do with spdplyr?), and find
> a way to calculate the angle between adjscent lines. Need a hand, please!
>
> x =
>
> c(4293215,4293205,4293205,4293194,4293174,4293176,4293190,4293201,4293204,4293218,4293215)
> y =
>
> c(6463731,6463733,6463734,6463736,6463740,6463750,6463747,6463744,6463744,6463741,6463731)
> cords = cbind(x, y)
> library(sp)
> p = Polygon(cords)
> ps = Polygons(list(p),1)
> poly = SpatialPolygons(list(ps))
> plot(poly)
> library(sf)
> poly = st_as_sf(poly)
> lines = st_cast(poly$geometry, "LINESTRING")
> plot(lines)
> # not run: this turns the object too simple, I need to work on very complex
> shapes.
> # lines = st_simplify(lines, preserveTopology = FALSE, dTolerance = 1)
>
> Really sorry for the lousy english... Best regards.
>
> *MSc. Juan Pablo Carranza*
> Economist
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From r@i@1290 m@iii@g oii @im@com  Sat Jun  1 17:24:06 2019
From: r@i@1290 m@iii@g oii @im@com (r@i@1290 m@iii@g oii @im@com)
Date: Sat, 1 Jun 2019 15:24:06 +0000 (UTC)
Subject: [R-sig-Geo] Creating a median curve among multiple curvesin ggplot
References: <1269474004.2799441.1559402646193.ref@mail.yahoo.com>
Message-ID: <1269474004.2799441.1559402646193@mail.yahoo.com>

Hi there,
Using ggplot, I have successfully created a plot that contains 37 separate line plots that each represent a trend in precipitation over 140 years. However, what I would like to do is show the curve that is the "median" of these lines. Is this possible to do??
Here is what I have so far in an attempt to do this, but I am not certain if it is the correct approach to create the desired median line - the first variable shows x-variable objects (each 1-dimensional) and the second variable shows the y-variable objects (3-dimensional):
RCP1pctCO2Median <- median(cbind(get, IPSL, IPSLMR, IPSL5, MIROC, HadGEM, MPI, MPI5, GFDL, GFDL5))?
RCP1pctCO2ModelMedian <- median(cbind(Model2, Model10, Model18, Model26, subset14, Model42, subset20, subset24, Model60, Model68))

The first variable appears to work, but it only returns one value, and I want all of the 140 values corresponding to whichever curve was returned. Why is it that only one value returns? Here is what the variable contains:
>RCP1pctCO2Median[1] 1.189044
When I run the second variable the same way, I receive the following error:
Error in sort.int(x, na.last = na.last, decreasing = decreasing, ...) : 
  'x' must be atomic
Why does this appear?? I tried "unlist" and "as.vector", but the same error appears.
If it helps, to show what the 1-dimensional objects of the first variable look like, here is an example of one (the object "get"):
>get
  [1] 0.00000000 0.00644777 0.01250601 0.01746194 0.02656210 0.03360072 0.04399755 0.05404601 0.06154399 0.07105423
 [11] 0.08315538 0.08925389 0.10060635 0.10833009 0.12196157 0.13730928 0.14890850 0.16087072 0.17361501 0.18310140
 [21] 0.19810085 0.21316248 0.22423607 0.23529990 0.24695577 0.26119599 0.27643532 0.28517213 0.29978970 0.31870887
 [31] 0.33418021 0.34585044 0.36071229 0.37379062 0.39324498 0.41099992 0.42437476 0.43643925 0.44687960 0.45864752
 [41] 0.48055932 0.49634662 0.50779009 0.52861303 0.54971600 0.56138206 0.57472491 0.59202033 0.60975420 0.63057494
 [51] 0.64653736 0.66088217 0.68168259 0.69649595 0.71363837 0.72988760 0.75010443 0.76776582 0.78613955 0.81099886
 [61] 0.82979667 0.84431553 0.86824787 0.88447672 0.89909577 0.92162514 0.94854647 0.96631038 0.98120815 1.00357985
 [71] 1.02769291 1.04733002 1.06585240 1.09083056 1.11592567 1.13627303 1.15866983 1.17941856 1.19748724 1.22012913
 [81] 1.24142718 1.26937973 1.29283488 1.31011736 1.33134723 1.36014366 1.38395822 1.40615380 1.42895305 1.45046842
 [91] 1.47504234 1.49920797 1.52142668 1.54559219 1.57354927 1.60000896 1.62449229 1.64506662 1.67100036 1.70185161
[101] 1.72964287 1.75235510 1.77455521 1.80183053 1.83121216 1.85619974 1.88188243 1.91002214 1.93333006 1.96133912
[111] 1.98944890 2.01225924 2.03804183 2.06614304 2.09558916 2.12400699 2.14846969 2.18011498 2.20532560 2.23031592
[121] 2.26106715 2.28796983 2.31954741 2.35274339 2.37794161 2.40643740 2.43963051 2.46948838 2.49733877 2.53035021
[131] 2.56229091 2.59265327 2.61934137 2.64592481 2.67754769 2.70779777 2.73824191 2.76880598 2.80077982 2.83057237

For the 3-D objects within the second variable, here is what is contained in the object "Model2", for example:
>Model2 <- brick("MaxPrecCCCMACanESM21pctCO2.nc", var = "onedaymax")
>Model2class       : RasterBrick 
dimensions  : 64, 128, 8192, 140  (nrow, ncol, ncell, nlayers)
resolution  : 2.8125, 2.789327  (x, y)
extent      : -181.4062, 178.5938, -89.25846, 89.25846  (xmin, xmax, ymin, ymax)
coord. ref. : +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0 
data source : C:/Users/Travis/Documents/Other documents/All netCDF files/netcdffiles/MaxPrecCCCMACanESM21pctCO2.nc 
names       : X1, X2, X3, X4, X5, X6, X7, X8, X9, X10, X11, X12, X13, X14, X15, ... 
z-value     : 1, 140 (min, max)
varname     : onedaymax 


In any case, I am not even certain if what I have done above is the correct approach altogether to create a median line, but I would greatly appreciate any assistance! Your feedback would be extremely valuable to me!
Thank you, and I very much look forward to hearing from you!
	[[alternative HTML version deleted]]


From b|@|ev||@t @end|ng |rom gm@||@com  Sat Jun  1 17:46:50 2019
From: b|@|ev||@t @end|ng |rom gm@||@com (=?UTF-8?Q?Bede-Fazekas_=c3=81kos?=)
Date: Sat, 1 Jun 2019 17:46:50 +0200
Subject: [R-sig-Geo] 
 Creating a median curve among multiple curvesin ggplot
In-Reply-To: <1269474004.2799441.1559402646193@mail.yahoo.com>
References: <1269474004.2799441.1559402646193.ref@mail.yahoo.com>
 <1269474004.2799441.1559402646193@mail.yahoo.com>
Message-ID: <fb525608-1585-1dad-d672-3ed714cadb71@gmail.com>

Hello,
in case of the vectors, you can get the median of the different models 
for each of the years using apply() function:
RCP1pctCO2Median <- median(apply(X = cbind(get, IPSL, IPSLMR, IPSL5, 
MIROC, HadGEM, MPI, MPI5, GFDL, GFDL5)), MARGIN = 1, FUN = median)
It calculates the median of each of the rows (= years) of the matrix.

In case of rasters, use raster::calc(), if all the rasters are 
single-layer RasterLayer objects:
RCP1pctCO2ModelMedian <- calc(x = stack(Model2, Model10, Model18, 
Model26, subset14, Model42, subset20, subset24, Model60, Model68), fun = 
median)
Since your rasters are multi-layer RasterBrick, you should give more 
details of their stucture/content to let us answer your question.

HTH,
?kos Bede-Fazekas
Hungarian Academy of Sciences

2019.06.01. 17:24 keltez?ssel, rain1290--- via R-sig-Geo ?rta:
> Hi there,
> Using ggplot, I have successfully created a plot that contains 37 separate line plots that each represent a trend in precipitation over 140 years. However, what I would like to do is show the curve that is the "median" of these lines. Is this possible to do?
> Here is what I have so far in an attempt to do this, but I am not certain if it is the correct approach to create the desired median line - the first variable shows x-variable objects (each 1-dimensional) and the second variable shows the y-variable objects (3-dimensional):
> RCP1pctCO2Median <- median(cbind(get, IPSL, IPSLMR, IPSL5, MIROC, HadGEM, MPI, MPI5, GFDL, GFDL5))
> RCP1pctCO2ModelMedian <- median(cbind(Model2, Model10, Model18, Model26, subset14, Model42, subset20, subset24, Model60, Model68))
>
> The first variable appears to work, but it only returns one value, and I want all of the 140 values corresponding to whichever curve was returned. Why is it that only one value returns? Here is what the variable contains:
>> RCP1pctCO2Median[1] 1.189044
> When I run the second variable the same way, I receive the following error:
> Error in sort.int(x, na.last = na.last, decreasing = decreasing, ...) :
>    'x' must be atomic
> Why does this appear?? I tried "unlist" and "as.vector", but the same error appears.
> If it helps, to show what the 1-dimensional objects of the first variable look like, here is an example of one (the object "get"):
>> get
>    [1] 0.00000000 0.00644777 0.01250601 0.01746194 0.02656210 0.03360072 0.04399755 0.05404601 0.06154399 0.07105423
>   [11] 0.08315538 0.08925389 0.10060635 0.10833009 0.12196157 0.13730928 0.14890850 0.16087072 0.17361501 0.18310140
>   [21] 0.19810085 0.21316248 0.22423607 0.23529990 0.24695577 0.26119599 0.27643532 0.28517213 0.29978970 0.31870887
>   [31] 0.33418021 0.34585044 0.36071229 0.37379062 0.39324498 0.41099992 0.42437476 0.43643925 0.44687960 0.45864752
>   [41] 0.48055932 0.49634662 0.50779009 0.52861303 0.54971600 0.56138206 0.57472491 0.59202033 0.60975420 0.63057494
>   [51] 0.64653736 0.66088217 0.68168259 0.69649595 0.71363837 0.72988760 0.75010443 0.76776582 0.78613955 0.81099886
>   [61] 0.82979667 0.84431553 0.86824787 0.88447672 0.89909577 0.92162514 0.94854647 0.96631038 0.98120815 1.00357985
>   [71] 1.02769291 1.04733002 1.06585240 1.09083056 1.11592567 1.13627303 1.15866983 1.17941856 1.19748724 1.22012913
>   [81] 1.24142718 1.26937973 1.29283488 1.31011736 1.33134723 1.36014366 1.38395822 1.40615380 1.42895305 1.45046842
>   [91] 1.47504234 1.49920797 1.52142668 1.54559219 1.57354927 1.60000896 1.62449229 1.64506662 1.67100036 1.70185161
> [101] 1.72964287 1.75235510 1.77455521 1.80183053 1.83121216 1.85619974 1.88188243 1.91002214 1.93333006 1.96133912
> [111] 1.98944890 2.01225924 2.03804183 2.06614304 2.09558916 2.12400699 2.14846969 2.18011498 2.20532560 2.23031592
> [121] 2.26106715 2.28796983 2.31954741 2.35274339 2.37794161 2.40643740 2.43963051 2.46948838 2.49733877 2.53035021
> [131] 2.56229091 2.59265327 2.61934137 2.64592481 2.67754769 2.70779777 2.73824191 2.76880598 2.80077982 2.83057237
>
> For the 3-D objects within the second variable, here is what is contained in the object "Model2", for example:
>> Model2 <- brick("MaxPrecCCCMACanESM21pctCO2.nc", var = "onedaymax")
>> Model2class       : RasterBrick
> dimensions  : 64, 128, 8192, 140  (nrow, ncol, ncell, nlayers)
> resolution  : 2.8125, 2.789327  (x, y)
> extent      : -181.4062, 178.5938, -89.25846, 89.25846  (xmin, xmax, ymin, ymax)
> coord. ref. : +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0
> data source : C:/Users/Travis/Documents/Other documents/All netCDF files/netcdffiles/MaxPrecCCCMACanESM21pctCO2.nc
> names       : X1, X2, X3, X4, X5, X6, X7, X8, X9, X10, X11, X12, X13, X14, X15, ...
> z-value     : 1, 140 (min, max)
> varname     : onedaymax
>
>
> In any case, I am not even certain if what I have done above is the correct approach altogether to create a median line, but I would greatly appreciate any assistance! Your feedback would be extremely valuable to me!
> Thank you, and I very much look forward to hearing from you!
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From r@i@1290 m@iii@g oii @im@com  Sat Jun  1 18:06:38 2019
From: r@i@1290 m@iii@g oii @im@com (r@i@1290 m@iii@g oii @im@com)
Date: Sat, 1 Jun 2019 16:06:38 +0000 (UTC)
Subject: [R-sig-Geo] 
 Creating a median curve among multiple curvesin ggplot
In-Reply-To: <fb525608-1585-1dad-d672-3ed714cadb71@gmail.com>
References: <1269474004.2799441.1559402646193.ref@mail.yahoo.com>
 <1269474004.2799441.1559402646193@mail.yahoo.com>
 <fb525608-1585-1dad-d672-3ed714cadb71@gmail.com>
Message-ID: <1275737724.4621877.1559405198628@mail.yahoo.com>

Hi Akos (and everyone),
Thank you kindly for this response!
I tried your suggestions, but for the first variable:?
RCP1pctCO2Median <- median(apply(X = cbind(get, IPSL, IPSLMR, IPSL5, 
MIROC, HadGEM, MPI, MPI5, GFDL, GFDL5)), MARGIN = 1, FUN = median)
I receive this error:
Error in match.fun(FUN) : argument "FUN" is missing, with no default
Why would that appear?
Also, for the raster objects for the second variable, yes, what you suggested worked, but this returns only the single median value per grid cell for the 140 years, as opposed to 140 medians (i.e. a median for each year/each layer) for each grid cell. Ideally, I would like to derive 140 medians corresponding to each of the 140 years/layers for each grid cell. Is there a way to do this??
Here is what some of the values/structure look like for the object Model2:
> head(Model2)
             X1       X2        X3        X4       X5       X6        X7        X8        X9       X10       X11
 [1,]  7.395703 6.493830  7.432156  6.767403 11.66004 7.158040 13.968703  8.139962  7.927880 10.367045  8.560315
 [2,]  7.277671 6.318810  8.406366  5.974478 12.51484 7.405914 15.350679  7.977879  8.039850  9.696597  9.374163
 [3,]  6.919258 6.119063  9.485675  6.256432 13.44547 7.542754 10.846225  8.441847  8.155234 10.129576 10.074353
 [4,]  6.633444 6.300559 10.349174  6.733875 14.35567 7.589797 12.452223  8.384633  8.697707 10.025741 10.589373
 [5,]  6.986749 7.057785 11.202586  8.037964 15.08123 7.668468 11.838186  8.506311  8.978721  9.699996 10.256382
 [6,]  7.287383 7.561100 12.091483  8.384658 15.56648 7.662876  8.925544  9.431210  8.979276 10.047477 10.898319
 [7,]  7.957773 7.732338 13.998432  8.982379 15.50928 7.599275  8.548879  8.287948  8.745722  9.496011 10.861937
            X12       X13       X14       X15      X16       X17      X18       X19      X20       X21       X22
 [1,]  5.533977 10.534669 12.136978  8.897428 10.07571  8.485538 7.731084 10.557160 15.36603 12.320665 11.274374
 [2,]  6.010256 10.299062 12.703854  9.522287 11.08078  8.996936 6.919732 10.900610 14.44405 11.949420 11.202058
 [3,]  6.590125  9.553597 12.781633  9.015289 11.35786  9.215069 6.888467  9.571572 13.47964 10.308230  9.772387
 [4,]  7.042177  8.800974 12.292124 11.457335 11.96268  9.329095 7.078347  9.072567 13.90133  9.780438  9.901325
 [5,]  7.613796  9.617242 11.511468 11.527631 12.94864  9.510409 7.504535  8.380163 14.01753  9.804405 10.389509
 [6,]  8.146129  9.211740 11.250921 11.483143 13.93948  8.881543 7.888670  8.917588 13.32526  8.609215  9.584101
 [7,]  8.551682  8.858268 10.417808 11.292067 15.19191  9.224810 8.231571  7.949825 12.58279  8.042569  9.816563
Thanks, once again, and I look forward to your response!
-----Original Message-----
From: Bede-Fazekas ?kos <bfalevlist at gmail.com>
To: r-sig-geo <r-sig-geo at r-project.org>
Sent: Sat, Jun 1, 2019 11:47 am
Subject: Re: [R-sig-Geo] Creating a median curve among multiple curvesin ggplot

Hello,
in case of the vectors, you can get the median of the different models 
for each of the years using apply() function:
RCP1pctCO2Median <- median(apply(X = cbind(get, IPSL, IPSLMR, IPSL5, 
MIROC, HadGEM, MPI, MPI5, GFDL, GFDL5)), MARGIN = 1, FUN = median)
It calculates the median of each of the rows (= years) of the matrix.

In case of rasters, use raster::calc(), if all the rasters are 
single-layer RasterLayer objects:
RCP1pctCO2ModelMedian <- calc(x = stack(Model2, Model10, Model18, 
Model26, subset14, Model42, subset20, subset24, Model60, Model68), fun = 
median)
Since your rasters are multi-layer RasterBrick, you should give more 
details of their stucture/content to let us answer your question.

HTH,
?kos Bede-Fazekas
Hungarian Academy of Sciences

2019.06.01. 17:24 keltez?ssel, rain1290--- via R-sig-Geo ?rta:
> Hi there,
> Using ggplot, I have successfully created a plot that contains 37 separate line plots that each represent a trend in precipitation over 140 years. However, what I would like to do is show the curve that is the "median" of these lines. Is this possible to do?
> Here is what I have so far in an attempt to do this, but I am not certain if it is the correct approach to create the desired median line - the first variable shows x-variable objects (each 1-dimensional) and the second variable shows the y-variable objects (3-dimensional):
> RCP1pctCO2Median <- median(cbind(get, IPSL, IPSLMR, IPSL5, MIROC, HadGEM, MPI, MPI5, GFDL, GFDL5))
> RCP1pctCO2ModelMedian <- median(cbind(Model2, Model10, Model18, Model26, subset14, Model42, subset20, subset24, Model60, Model68))
>
> The first variable appears to work, but it only returns one value, and I want all of the 140 values corresponding to whichever curve was returned. Why is it that only one value returns? Here is what the variable contains:
>> RCP1pctCO2Median[1] 1.189044
> When I run the second variable the same way, I receive the following error:
> Error in sort.int(x, na.last = na.last, decreasing = decreasing, ...) :
>? ? 'x' must be atomic
> Why does this appear?? I tried "unlist" and "as.vector", but the same error appears.
> If it helps, to show what the 1-dimensional objects of the first variable look like, here is an example of one (the object "get"):
>> get
>? ? [1] 0.00000000 0.00644777 0.01250601 0.01746194 0.02656210 0.03360072 0.04399755 0.05404601 0.06154399 0.07105423
>? [11] 0.08315538 0.08925389 0.10060635 0.10833009 0.12196157 0.13730928 0.14890850 0.16087072 0.17361501 0.18310140
>? [21] 0.19810085 0.21316248 0.22423607 0.23529990 0.24695577 0.26119599 0.27643532 0.28517213 0.29978970 0.31870887
>? [31] 0.33418021 0.34585044 0.36071229 0.37379062 0.39324498 0.41099992 0.42437476 0.43643925 0.44687960 0.45864752
>? [41] 0.48055932 0.49634662 0.50779009 0.52861303 0.54971600 0.56138206 0.57472491 0.59202033 0.60975420 0.63057494
>? [51] 0.64653736 0.66088217 0.68168259 0.69649595 0.71363837 0.72988760 0.75010443 0.76776582 0.78613955 0.81099886
>? [61] 0.82979667 0.84431553 0.86824787 0.88447672 0.89909577 0.92162514 0.94854647 0.96631038 0.98120815 1.00357985
>? [71] 1.02769291 1.04733002 1.06585240 1.09083056 1.11592567 1.13627303 1.15866983 1.17941856 1.19748724 1.22012913
>? [81] 1.24142718 1.26937973 1.29283488 1.31011736 1.33134723 1.36014366 1.38395822 1.40615380 1.42895305 1.45046842
>? [91] 1.47504234 1.49920797 1.52142668 1.54559219 1.57354927 1.60000896 1.62449229 1.64506662 1.67100036 1.70185161
> [101] 1.72964287 1.75235510 1.77455521 1.80183053 1.83121216 1.85619974 1.88188243 1.91002214 1.93333006 1.96133912
> [111] 1.98944890 2.01225924 2.03804183 2.06614304 2.09558916 2.12400699 2.14846969 2.18011498 2.20532560 2.23031592
> [121] 2.26106715 2.28796983 2.31954741 2.35274339 2.37794161 2.40643740 2.43963051 2.46948838 2.49733877 2.53035021
> [131] 2.56229091 2.59265327 2.61934137 2.64592481 2.67754769 2.70779777 2.73824191 2.76880598 2.80077982 2.83057237
>
> For the 3-D objects within the second variable, here is what is contained in the object "Model2", for example:
>> Model2 <- brick("MaxPrecCCCMACanESM21pctCO2.nc", var = "onedaymax")
>> Model2class? ? ? : RasterBrick
> dimensions? : 64, 128, 8192, 140? (nrow, ncol, ncell, nlayers)
> resolution? : 2.8125, 2.789327? (x, y)
> extent? ? ? : -181.4062, 178.5938, -89.25846, 89.25846? (xmin, xmax, ymin, ymax)
> coord. ref. : +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0
> data source : C:/Users/Travis/Documents/Other documents/All netCDF files/netcdffiles/MaxPrecCCCMACanESM21pctCO2.nc
> names? ? ? : X1, X2, X3, X4, X5, X6, X7, X8, X9, X10, X11, X12, X13, X14, X15, ...
> z-value? ? : 1, 140 (min, max)
> varname? ? : onedaymax
>
>
> In any case, I am not even certain if what I have done above is the correct approach altogether to create a median line, but I would greatly appreciate any assistance! Your feedback would be extremely valuable to me!
> Thank you, and I very much look forward to hearing from you!
> ??? [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo

	[[alternative HTML version deleted]]


From b|@|ev||@t @end|ng |rom gm@||@com  Sat Jun  1 18:46:59 2019
From: b|@|ev||@t @end|ng |rom gm@||@com (=?UTF-8?Q?Bede-Fazekas_=c3=81kos?=)
Date: Sat, 1 Jun 2019 18:46:59 +0200
Subject: [R-sig-Geo] 
 Creating a median curve among multiple curvesin ggplot
In-Reply-To: <1275737724.4621877.1559405198628@mail.yahoo.com>
References: <1269474004.2799441.1559402646193.ref@mail.yahoo.com>
 <1269474004.2799441.1559402646193@mail.yahoo.com>
 <fb525608-1585-1dad-d672-3ed714cadb71@gmail.com>
 <1275737724.4621877.1559405198628@mail.yahoo.com>
Message-ID: <aefba21c-3ea5-06f8-edac-738112fcc567@gmail.com>

Hello,
Sorry for this, it was wrong. This might work:
RCP1pctCO2Median <- apply(X = cbind(get, IPSL, IPSLMR, IPSL5, MIROC, 
HadGEM, MPI, MPI5, GFDL, GFDL5), MARGIN = 1, FUN = median)

OK, I understand now the structure of your rasters.
Something like this may do the task:
stack(lapply(X = 1:140, FUN = function(year) {calc(x = stack(lapply(X = 
list(Model2, Model10, Model18, Model26, subset14, Model42, subset20, 
subset24, Model60, Model68), FUN = "[[", i = year)), fun = median)}))
(Again, this is not tested. If you send us reproducible examples then we 
can try the code what we suggest you.)
HTH,
?kos

2019.06.01. 18:06 keltez?ssel, rain1290 at aim.com ?rta:
> Hi Akos (and everyone),
>
> Thank you kindly for this response!
>
> I tried your suggestions, but for the first variable:
>
> RCP1pctCO2Median <- median(apply(X = cbind(get, IPSL, IPSLMR, IPSL5,
> MIROC, HadGEM, MPI, MPI5, GFDL, GFDL5)), MARGIN = 1, FUN = median)
>
> I receive this error:
>
> Error in match.fun(FUN) : argument "FUN" is missing, with no default
>
> Why would that appear?
>
> Also, for the raster objects for the second variable, yes, what you 
> suggested worked, but this returns only the single median value per 
> grid cell for the 140 years, as opposed to 140 medians (i.e. a median 
> for each year/each layer) for each grid cell. Ideally, I would like to 
> derive 140 medians corresponding to each of the 140 years/layers for 
> each grid cell. Is there a way to do this?
>
> Here is what some of the values/structure look like for the object Model2:
>
> > head(Model2) X1 X2 X3 X4 X5 X6 X7 X8 X9 X10 X11 [1,] 7.395703 6.493830 
> 7.432156 6.767403 11.66004 7.158040 13.968703 8.139962 7.927880 
> 10.367045 8.560315 [2,] 7.277671 6.318810 8.406366 5.974478 12.51484 
> 7.405914 15.350679 7.977879 8.039850 9.696597 9.374163 [3,] 6.919258 
> 6.119063 9.485675 6.256432 13.44547 7.542754 10.846225 8.441847 
> 8.155234 10.129576 10.074353 [4,] 6.633444 6.300559 10.349174 6.733875 
> 14.35567 7.589797 12.452223 8.384633 8.697707 10.025741 10.589373 [5,] 
> 6.986749 7.057785 11.202586 8.037964 15.08123 7.668468 11.838186 
> 8.506311 8.978721 9.699996 10.256382 [6,] 7.287383 7.561100 12.091483 
> 8.384658 15.56648 7.662876 8.925544 9.431210 8.979276 10.047477 
> 10.898319 [7,] 7.957773 7.732338 13.998432 8.982379 15.50928 7.599275 
> 8.548879 8.287948 8.745722 9.496011 10.861937 X12 X13 X14 X15 X16 X17 
> X18 X19 X20 X21 X22 [1,] 5.533977 10.534669 12.136978 8.897428 
> 10.07571 8.485538 7.731084 10.557160 15.36603 12.320665 11.274374 [2,] 
> 6.010256 10.299062 12.703854 9.522287 11.08078 8.996936 6.919732 
> 10.900610 14.44405 11.949420 11.202058 [3,] 6.590125 9.553597 
> 12.781633 9.015289 11.35786 9.215069 6.888467 9.571572 13.47964 
> 10.308230 9.772387 [4,] 7.042177 8.800974 12.292124 11.457335 11.96268 
> 9.329095 7.078347 9.072567 13.90133 9.780438 9.901325 [5,] 7.613796 
> 9.617242 11.511468 11.527631 12.94864 9.510409 7.504535 8.380163 
> 14.01753 9.804405 10.389509 [6,] 8.146129 9.211740 11.250921 11.483143 
> 13.93948 8.881543 7.888670 8.917588 13.32526 8.609215 9.584101 [7,] 
> 8.551682 8.858268 10.417808 11.292067 15.19191 9.224810 8.231571 
> 7.949825 12.58279 8.042569 9.816563
>
> Thanks, once again, and I look forward to your response!
>
> -----Original Message-----
> From: Bede-Fazekas ?kos <bfalevlist at gmail.com>
> To: r-sig-geo <r-sig-geo at r-project.org>
> Sent: Sat, Jun 1, 2019 11:47 am
> Subject: Re: [R-sig-Geo] Creating a median curve among multiple 
> curvesin ggplot
>
> Hello,
> in case of the vectors, you can get the median of the different models
> for each of the years using apply() function:
> RCP1pctCO2Median <- median(apply(X = cbind(get, IPSL, IPSLMR, IPSL5,
> MIROC, HadGEM, MPI, MPI5, GFDL, GFDL5)), MARGIN = 1, FUN = median)
> It calculates the median of each of the rows (= years) of the matrix.
>
> In case of rasters, use raster::calc(), if all the rasters are
> single-layer RasterLayer objects:
> RCP1pctCO2ModelMedian <- calc(x = stack(Model2, Model10, Model18,
> Model26, subset14, Model42, subset20, subset24, Model60, Model68), fun =
> median)
> Since your rasters are multi-layer RasterBrick, you should give more
> details of their stucture/content to let us answer your question.
>
> HTH,
> ?kos Bede-Fazekas
> Hungarian Academy of Sciences
>
> 2019.06.01. 17:24 keltez?ssel, rain1290--- via R-sig-Geo ?rta:
> > Hi there,
> > Using ggplot, I have successfully created a plot that contains 37 
> separate line plots that each represent a trend in precipitation over 
> 140 years. However, what I would like to do is show the curve that is 
> the "median" of these lines. Is this possible to do?
> > Here is what I have so far in an attempt to do this, but I am not 
> certain if it is the correct approach to create the desired median 
> line - the first variable shows x-variable objects (each 
> 1-dimensional) and the second variable shows the y-variable objects 
> (3-dimensional):
> > RCP1pctCO2Median <- median(cbind(get, IPSL, IPSLMR, IPSL5, MIROC, 
> HadGEM, MPI, MPI5, GFDL, GFDL5))
> > RCP1pctCO2ModelMedian <- median(cbind(Model2, Model10, Model18, 
> Model26, subset14, Model42, subset20, subset24, Model60, Model68))
> >
> > The first variable appears to work, but it only returns one value, 
> and I want all of the 140 values corresponding to whichever curve was 
> returned. Why is it that only one value returns? Here is what the 
> variable contains:
> >> RCP1pctCO2Median[1] 1.189044
> > When I run the second variable the same way, I receive the following 
> error:
> > Error in sort.int(x, na.last = na.last, decreasing = decreasing, ...) :
> >? ? 'x' must be atomic
> > Why does this appear?? I tried "unlist" and "as.vector", but the 
> same error appears.
> > If it helps, to show what the 1-dimensional objects of the first 
> variable look like, here is an example of one (the object "get"):
> >> get
> >? ? [1] 0.00000000 0.00644777 0.01250601 0.01746194 0.02656210 
> 0.03360072 0.04399755 0.05404601 0.06154399 0.07105423
> >? [11] 0.08315538 0.08925389 0.10060635 0.10833009 0.12196157 
> 0.13730928 0.14890850 0.16087072 0.17361501 0.18310140
> >? [21] 0.19810085 0.21316248 0.22423607 0.23529990 0.24695577 
> 0.26119599 0.27643532 0.28517213 0.29978970 0.31870887
> >? [31] 0.33418021 0.34585044 0.36071229 0.37379062 0.39324498 
> 0.41099992 0.42437476 0.43643925 0.44687960 0.45864752
> >? [41] 0.48055932 0.49634662 0.50779009 0.52861303 0.54971600 
> 0.56138206 0.57472491 0.59202033 0.60975420 0.63057494
> >? [51] 0.64653736 0.66088217 0.68168259 0.69649595 0.71363837 
> 0.72988760 0.75010443 0.76776582 0.78613955 0.81099886
> >? [61] 0.82979667 0.84431553 0.86824787 0.88447672 0.89909577 
> 0.92162514 0.94854647 0.96631038 0.98120815 1.00357985
> >? [71] 1.02769291 1.04733002 1.06585240 1.09083056 1.11592567 
> 1.13627303 1.15866983 1.17941856 1.19748724 1.22012913
> >? [81] 1.24142718 1.26937973 1.29283488 1.31011736 1.33134723 
> 1.36014366 1.38395822 1.40615380 1.42895305 1.45046842
> >? [91] 1.47504234 1.49920797 1.52142668 1.54559219 1.57354927 
> 1.60000896 1.62449229 1.64506662 1.67100036 1.70185161
> > [101] 1.72964287 1.75235510 1.77455521 1.80183053 1.83121216 
> 1.85619974 1.88188243 1.91002214 1.93333006 1.96133912
> > [111] 1.98944890 2.01225924 2.03804183 2.06614304 2.09558916 
> 2.12400699 2.14846969 2.18011498 2.20532560 2.23031592
> > [121] 2.26106715 2.28796983 2.31954741 2.35274339 2.37794161 
> 2.40643740 2.43963051 2.46948838 2.49733877 2.53035021
> > [131] 2.56229091 2.59265327 2.61934137 2.64592481 2.67754769 
> 2.70779777 2.73824191 2.76880598 2.80077982 2.83057237
> >
> > For the 3-D objects within the second variable, here is what is 
> contained in the object "Model2", for example:
> >> Model2 <- brick("MaxPrecCCCMACanESM21pctCO2.nc", var = "onedaymax")
> >> Model2class? ? ? : RasterBrick
> > dimensions? : 64, 128, 8192, 140? (nrow, ncol, ncell, nlayers)
> > resolution? : 2.8125, 2.789327? (x, y)
> > extent? ? ? : -181.4062, 178.5938, -89.25846, 89.25846? (xmin, xmax, 
> ymin, ymax)
> > coord. ref. : +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0
> > data source : C:/Users/Travis/Documents/Other documents/All netCDF 
> files/netcdffiles/MaxPrecCCCMACanESM21pctCO2.nc
> > names? ? ? : X1, X2, X3, X4, X5, X6, X7, X8, X9, X10, X11, X12, X13, 
> X14, X15, ...
> > z-value? ? : 1, 140 (min, max)
> > varname? ? : onedaymax
> >
> >
> > In any case, I am not even certain if what I have done above is the 
> correct approach altogether to create a median line, but I would 
> greatly appreciate any assistance! Your feedback would be extremely 
> valuable to me!
> > Thank you, and I very much look forward to hearing from you!
>
> > ??? [[alternative HTML version deleted]]
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


	[[alternative HTML version deleted]]


From r@i@1290 m@iii@g oii @im@com  Sat Jun  1 19:23:35 2019
From: r@i@1290 m@iii@g oii @im@com (r@i@1290 m@iii@g oii @im@com)
Date: Sat, 1 Jun 2019 17:23:35 +0000 (UTC)
Subject: [R-sig-Geo] 
 Creating a median curve among multiple curvesin ggplot
In-Reply-To: <aefba21c-3ea5-06f8-edac-738112fcc567@gmail.com>
References: <1269474004.2799441.1559402646193.ref@mail.yahoo.com>
 <1269474004.2799441.1559402646193@mail.yahoo.com>
 <fb525608-1585-1dad-d672-3ed714cadb71@gmail.com>
 <1275737724.4621877.1559405198628@mail.yahoo.com>
 <aefba21c-3ea5-06f8-edac-738112fcc567@gmail.com>
Message-ID: <355652114.2414751.1559409815581@mail.yahoo.com>

Hi Akos,

Actually, I believe both of these worked just fine after testing them and returned the 140 values in each case! For the second variable, I first received an error after running it, but this was because the number of years/layers differed slightly for one of the objects (Model42), being 138 years/layers. So, I just modified the code to account for this (i.e. 1:138), and it worked fine. :) ?
Also, I need not arrange the raster objects in ascending order, correct? My sense is that it automatically sorts the values for each object from lowest to highest for each year for each grid cell. At least that is what it did for the 1-dimensional objects for the first variable, as the median values shown there are correctly ascending (as they should be with each year).?
Many, many thanks, once again!
-----Original Message-----
From: Bede-Fazekas ?kos <bfalevlist at gmail.com>
To: rain1290 <rain1290 at aim.com>; r-sig-geo <r-sig-geo at r-project.org>
Sent: Sat, Jun 1, 2019 12:47 pm
Subject: Re: [R-sig-Geo] Creating a median curve among multiple curvesin ggplot

 Hello,
 Sorry for this, it was wrong. This might work:
 RCP1pctCO2Median <- apply(X = cbind(get, IPSL, IPSLMR, IPSL5, MIROC, HadGEM, MPI, MPI5, GFDL, GFDL5), MARGIN = 1, FUN = median)
 
 OK, I understand now the structure of your rasters.
 Something like this may do the task:
 stack(lapply(X = 1:140, FUN = function(year) {calc(x = stack(lapply(X = list(Model2, Model10, Model18, Model26, subset14, Model42, subset20, subset24, Model60, Model68), FUN = "[[", i = year)), fun = median)}))
 (Again, this is not tested. If you send us reproducible examples then we can try the code what we suggest you.)
 HTH,
 ?kos
 
 2019.06.01. 18:06 keltez?ssel, rain1290 at aim.com ?rta:
  
 
 Hi Akos (and everyone), 
  Thank you kindly for this response! 
 I tried your suggestions, but for the first variable:? 
  RCP1pctCO2Median <- median(apply(X = cbind(get, IPSL, IPSLMR, IPSL5, 
  MIROC, HadGEM, MPI, MPI5, GFDL, GFDL5)), MARGIN = 1, FUN = median) 
  I receive this error: 
   Error in match.fun(FUN) : argument "FUN" is missing, with no default 
  Why would that appear? 
  Also, for the raster objects for the second variable, yes, what you suggested worked, but this returns only the single median value per grid cell for the 140 years, as opposed to 140 medians (i.e. a median for each year/each layer) for each grid cell. Ideally, I would like to derive 140 medians corresponding to each of the 140 years/layers for each grid cell. Is there a way to do this?? 
  Here is what some of the values/structure look like for the object Model2: 
   > head(Model2)
             X1       X2        X3        X4       X5       X6        X7        X8        X9       X10       X11
 [1,]  7.395703 6.493830  7.432156  6.767403 11.66004 7.158040 13.968703  8.139962  7.927880 10.367045  8.560315
 [2,]  7.277671 6.318810  8.406366  5.974478 12.51484 7.405914 15.350679  7.977879  8.039850  9.696597  9.374163
 [3,]  6.919258 6.119063  9.485675  6.256432 13.44547 7.542754 10.846225  8.441847  8.155234 10.129576 10.074353
 [4,]  6.633444 6.300559 10.349174  6.733875 14.35567 7.589797 12.452223  8.384633  8.697707 10.025741 10.589373
 [5,]  6.986749 7.057785 11.202586  8.037964 15.08123 7.668468 11.838186  8.506311  8.978721  9.699996 10.256382
 [6,]  7.287383 7.561100 12.091483  8.384658 15.56648 7.662876  8.925544  9.431210  8.979276 10.047477 10.898319
 [7,]  7.957773 7.732338 13.998432  8.982379 15.50928 7.599275  8.548879  8.287948  8.745722  9.496011 10.861937
            X12       X13       X14       X15      X16       X17      X18       X19      X20       X21       X22
 [1,]  5.533977 10.534669 12.136978  8.897428 10.07571  8.485538 7.731084 10.557160 15.36603 12.320665 11.274374
 [2,]  6.010256 10.299062 12.703854  9.522287 11.08078  8.996936 6.919732 10.900610 14.44405 11.949420 11.202058
 [3,]  6.590125  9.553597 12.781633  9.015289 11.35786  9.215069 6.888467  9.571572 13.47964 10.308230  9.772387
 [4,]  7.042177  8.800974 12.292124 11.457335 11.96268  9.329095 7.078347  9.072567 13.90133  9.780438  9.901325
 [5,]  7.613796  9.617242 11.511468 11.527631 12.94864  9.510409 7.504535  8.380163 14.01753  9.804405 10.389509
 [6,]  8.146129  9.211740 11.250921 11.483143 13.93948  8.881543 7.888670  8.917588 13.32526  8.609215  9.584101
 [7,]  8.551682  8.858268 10.417808 11.292067 15.19191  9.224810 8.231571  7.949825 12.58279  8.042569  9.816563 
  Thanks, once again, and I look forward to your response! 
  -----Original Message-----
 From: Bede-Fazekas ?kos <bfalevlist at gmail.com>
 To: r-sig-geo <r-sig-geo at r-project.org>
 Sent: Sat, Jun 1, 2019 11:47 am
 Subject: Re: [R-sig-Geo] Creating a median curve among multiple curvesin ggplot
 
 Hello,
 in case of the vectors, you can get the median of the different models 
 for each of the years using apply() function:
 RCP1pctCO2Median <- median(apply(X = cbind(get, IPSL, IPSLMR, IPSL5, 
 MIROC, HadGEM, MPI, MPI5, GFDL, GFDL5)), MARGIN = 1, FUN = median)
 It calculates the median of each of the rows (= years) of the matrix.
 
 In case of rasters, use raster::calc(), if all the rasters are 
 single-layer RasterLayer objects:
 RCP1pctCO2ModelMedian <- calc(x = stack(Model2, Model10, Model18, 
 Model26, subset14, Model42, subset20, subset24, Model60, Model68), fun = 
 median)
 Since your rasters are multi-layer RasterBrick, you should give more 
 details of their stucture/content to let us answer your question.
 
 HTH,
 ?kos Bede-Fazekas
 Hungarian Academy of Sciences
 
 2019.06.01. 17:24 keltez?ssel, rain1290--- via R-sig-Geo ?rta:
 > Hi there,
 > Using ggplot, I have successfully created a plot that contains 37 separate line plots that each represent a trend in precipitation over 140 years. However, what I would like to do is show the curve that is the "median" of these lines. Is this possible to do?
 > Here is what I have so far in an attempt to do this, but I am not certain if it is the correct approach to create the desired median line - the first variable shows x-variable objects (each 1-dimensional) and the second variable shows the y-variable objects (3-dimensional):
 > RCP1pctCO2Median <- median(cbind(get, IPSL, IPSLMR, IPSL5, MIROC, HadGEM, MPI, MPI5, GFDL, GFDL5))
 > RCP1pctCO2ModelMedian <- median(cbind(Model2, Model10, Model18, Model26, subset14, Model42, subset20, subset24, Model60, Model68))
 >
 > The first variable appears to work, but it only returns one value, and I want all of the 140 values corresponding to whichever curve was returned. Why is it that only one value returns? Here is what the variable contains:
 >> RCP1pctCO2Median[1] 1.189044
 > When I run the second variable the same way, I receive the following error:
 > Error in sort.int(x, na.last = na.last, decreasing = decreasing, ...) :
 >? ? 'x' must be atomic
 > Why does this appear?? I tried "unlist" and "as.vector", but the same error appears.
 > If it helps, to show what the 1-dimensional objects of the first variable look like, here is an example of one (the object "get"):
 >> get
 >? ? [1] 0.00000000 0.00644777 0.01250601 0.01746194 0.02656210 0.03360072 0.04399755 0.05404601 0.06154399 0.07105423
 >? [11] 0.08315538 0.08925389 0.10060635 0.10833009 0.12196157 0.13730928 0.14890850 0.16087072 0.17361501 0.18310140
 >? [21] 0.19810085 0.21316248 0.22423607 0.23529990 0.24695577 0.26119599 0.27643532 0.28517213 0.29978970 0.31870887
 >? [31] 0.33418021 0.34585044 0.36071229 0.37379062 0.39324498 0.41099992 0.42437476 0.43643925 0.44687960 0.45864752
 >? [41] 0.48055932 0.49634662 0.50779009 0.52861303 0.54971600 0.56138206 0.57472491 0.59202033 0.60975420 0.63057494
 >? [51] 0.64653736 0.66088217 0.68168259 0.69649595 0.71363837 0.72988760 0.75010443 0.76776582 0.78613955 0.81099886
 >? [61] 0.82979667 0.84431553 0.86824787 0.88447672 0.89909577 0.92162514 0.94854647 0.96631038 0.98120815 1.00357985
 >? [71] 1.02769291 1.04733002 1.06585240 1.09083056 1.11592567 1.13627303 1.15866983 1.17941856 1.19748724 1.22012913
 >? [81] 1.24142718 1.26937973 1.29283488 1.31011736 1.33134723 1.36014366 1.38395822 1.40615380 1.42895305 1.45046842
 >? [91] 1.47504234 1.49920797 1.52142668 1.54559219 1.57354927 1.60000896 1.62449229 1.64506662 1.67100036 1.70185161
 > [101] 1.72964287 1.75235510 1.77455521 1.80183053 1.83121216 1.85619974 1.88188243 1.91002214 1.93333006 1.96133912
 > [111] 1.98944890 2.01225924 2.03804183 2.06614304 2.09558916 2.12400699 2.14846969 2.18011498 2.20532560 2.23031592
 > [121] 2.26106715 2.28796983 2.31954741 2.35274339 2.37794161 2.40643740 2.43963051 2.46948838 2.49733877 2.53035021
 > [131] 2.56229091 2.59265327 2.61934137 2.64592481 2.67754769 2.70779777 2.73824191 2.76880598 2.80077982 2.83057237
 >
 > For the 3-D objects within the second variable, here is what is contained in the object "Model2", for example:
 >> Model2 <- brick("MaxPrecCCCMACanESM21pctCO2.nc", var = "onedaymax")
 >> Model2class? ? ? : RasterBrick
 > dimensions? : 64, 128, 8192, 140? (nrow, ncol, ncell, nlayers)
 > resolution? : 2.8125, 2.789327? (x, y)
 > extent? ? ? : -181.4062, 178.5938, -89.25846, 89.25846? (xmin, xmax, ymin, ymax)
 > coord. ref. : +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0
 > data source : C:/Users/Travis/Documents/Other documents/All netCDF files/netcdffiles/MaxPrecCCCMACanESM21pctCO2.nc
 > names? ? ? : X1, X2, X3, X4, X5, X6, X7, X8, X9, X10, X11, X12, X13, X14, X15, ...
 > z-value? ? : 1, 140 (min, max)
 > varname? ? : onedaymax
 >
 >
 > In any case, I am not even certain if what I have done above is the correct approach altogether to create a median line, but I would greatly appreciate any assistance! Your feedback would be extremely valuable to me!
 > Thank you, and I very much look forward to hearing from you! 
 > ??? [[alternative HTML version deleted]]
 >
 > _______________________________________________
 > R-sig-Geo mailing list
 > R-sig-Geo at r-project.org
 > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
 >
 
 _______________________________________________
 R-sig-Geo mailing list
 R-sig-Geo at r-project.org
 https://stat.ethz.ch/mailman/listinfo/r-sig-geo 
     

	[[alternative HTML version deleted]]


From b|@|ev||@t @end|ng |rom gm@||@com  Sat Jun  1 22:04:16 2019
From: b|@|ev||@t @end|ng |rom gm@||@com (=?UTF-8?Q?Bede-Fazekas_=c3=81kos?=)
Date: Sat, 1 Jun 2019 22:04:16 +0200
Subject: [R-sig-Geo] 
 Creating a median curve among multiple curvesin ggplot
In-Reply-To: <355652114.2414751.1559409815581@mail.yahoo.com>
References: <1269474004.2799441.1559402646193.ref@mail.yahoo.com>
 <1269474004.2799441.1559402646193@mail.yahoo.com>
 <fb525608-1585-1dad-d672-3ed714cadb71@gmail.com>
 <1275737724.4621877.1559405198628@mail.yahoo.com>
 <aefba21c-3ea5-06f8-edac-738112fcc567@gmail.com>
 <355652114.2414751.1559409815581@mail.yahoo.com>
Message-ID: <b27dadec-5615-e8e1-cfe9-4e427e8d2800@gmail.com>

Hi,
median() automatically sorts the data, so the order of the rasters is 
not important, I think.
Have a nice weekend,
?kos

2019.06.01. 19:23 keltez?ssel, rain1290 at aim.com ?rta:
> Hi Akos,
>
> Actually, I believe both of these worked just fine after testing them 
> and returned the 140 values in each case! For the second variable, I 
> first received an error after running it, but this was because the 
> number of years/layers differed slightly for one of the objects 
> (Model42), being 138 years/layers. So, I just modified the code to 
> account for this (i.e. 1:138), and it worked fine. :)
>
> Also, I need not arrange the raster objects in ascending order, 
> correct? My sense is that it automatically sorts the values for each 
> object from lowest to highest for each year for each grid cell. At 
> least that is what it did for the 1-dimensional objects for the first 
> variable, as the median values shown there are correctly ascending (as 
> they should be with each year).
>
> Many, many thanks, once again!
>
> -----Original Message-----
> From: Bede-Fazekas ?kos <bfalevlist at gmail.com>
> To: rain1290 <rain1290 at aim.com>; r-sig-geo <r-sig-geo at r-project.org>
> Sent: Sat, Jun 1, 2019 12:47 pm
> Subject: Re: [R-sig-Geo] Creating a median curve among multiple 
> curvesin ggplot
>
> Hello,
> Sorry for this, it was wrong. This might work:
> RCP1pctCO2Median <- apply(X = cbind(get, IPSL, IPSLMR, IPSL5, MIROC, 
> HadGEM, MPI, MPI5, GFDL, GFDL5), MARGIN = 1, FUN = median)
>
> OK, I understand now the structure of your rasters.
> Something like this may do the task:
> stack(lapply(X = 1:140, FUN = function(year) {calc(x = stack(lapply(X 
> = list(Model2, Model10, Model18, Model26, subset14, Model42, subset20, 
> subset24, Model60, Model68), FUN = "[[", i = year)), fun = median)}))
> (Again, this is not tested. If you send us reproducible examples then 
> we can try the code what we suggest you.)
> HTH,
> ?kos
>
> 2019.06.01. 18:06 keltez?ssel, rain1290 at aim.com 
> <mailto:rain1290 at aim.com> ?rta:
> Hi Akos (and everyone),
>
> Thank you kindly for this response!
>
> I tried your suggestions, but for the first variable:
>
> RCP1pctCO2Median <- median(apply(X = cbind(get, IPSL, IPSLMR, IPSL5,
> MIROC, HadGEM, MPI, MPI5, GFDL, GFDL5)), MARGIN = 1, FUN = median)
>
> I receive this error:
>
> Error in match.fun(FUN) : argument "FUN" is missing, with no default
>
> Why would that appear?
>
> Also, for the raster objects for the second variable, yes, what you 
> suggested worked, but this returns only the single median value per 
> grid cell for the 140 years, as opposed to 140 medians (i.e. a median 
> for each year/each layer) for each grid cell. Ideally, I would like to 
> derive 140 medians corresponding to each of the 140 years/layers for 
> each grid cell. Is there a way to do this?
>
> Here is what some of the values/structure look like for the object Model2:
>
> > head(Model2) X1 X2 X3 X4 X5 X6 X7 X8 X9 X10 X11 [1,] 7.395703 6.493830 
> 7.432156 6.767403 11.66004 7.158040 13.968703 8.139962 7.927880 
> 10.367045 8.560315 [2,] 7.277671 6.318810 8.406366 5.974478 12.51484 
> 7.405914 15.350679 7.977879 8.039850 9.696597 9.374163 [3,] 6.919258 
> 6.119063 9.485675 6.256432 13.44547 7.542754 10.846225 8.441847 
> 8.155234 10.129576 10.074353 [4,] 6.633444 6.300559 10.349174 6.733875 
> 14.35567 7.589797 12.452223 8.384633 8.697707 10.025741 10.589373 [5,] 
> 6.986749 7.057785 11.202586 8.037964 15.08123 7.668468 11.838186 
> 8.506311 8.978721 9.699996 10.256382 [6,] 7.287383 7.561100 12.091483 
> 8.384658 15.56648 7.662876 8.925544 9.431210 8.979276 10.047477 
> 10.898319 [7,] 7.957773 7.732338 13.998432 8.982379 15.50928 7.599275 
> 8.548879 8.287948 8.745722 9.496011 10.861937 X12 X13 X14 X15 X16 X17 
> X18 X19 X20 X21 X22 [1,] 5.533977 10.534669 12.136978 8.897428 
> 10.07571 8.485538 7.731084 10.557160 15.36603 12.320665 11.274374 [2,] 
> 6.010256 10.299062 12.703854 9.522287 11.08078 8.996936 6.919732 
> 10.900610 14.44405 11.949420 11.202058 [3,] 6.590125 9.553597 
> 12.781633 9.015289 11.35786 9.215069 6.888467 9.571572 13.47964 
> 10.308230 9.772387 [4,] 7.042177 8.800974 12.292124 11.457335 11.96268 
> 9.329095 7.078347 9.072567 13.90133 9.780438 9.901325 [5,] 7.613796 
> 9.617242 11.511468 11.527631 12.94864 9.510409 7.504535 8.380163 
> 14.01753 9.804405 10.389509 [6,] 8.146129 9.211740 11.250921 11.483143 
> 13.93948 8.881543 7.888670 8.917588 13.32526 8.609215 9.584101 [7,] 
> 8.551682 8.858268 10.417808 11.292067 15.19191 9.224810 8.231571 
> 7.949825 12.58279 8.042569 9.816563
>
> Thanks, once again, and I look forward to your response!
>
> -----Original Message-----
> From: Bede-Fazekas ?kos <bfalevlist at gmail.com> 
> <mailto:bfalevlist at gmail.com>
> To: r-sig-geo <r-sig-geo at r-project.org> <mailto:r-sig-geo at r-project.org>
> Sent: Sat, Jun 1, 2019 11:47 am
> Subject: Re: [R-sig-Geo] Creating a median curve among multiple 
> curvesin ggplot
>
> Hello,
> in case of the vectors, you can get the median of the different models
> for each of the years using apply() function:
> RCP1pctCO2Median <- median(apply(X = cbind(get, IPSL, IPSLMR, IPSL5,
> MIROC, HadGEM, MPI, MPI5, GFDL, GFDL5)), MARGIN = 1, FUN = median)
> It calculates the median of each of the rows (= years) of the matrix.
>
> In case of rasters, use raster::calc(), if all the rasters are
> single-layer RasterLayer objects:
> RCP1pctCO2ModelMedian <- calc(x = stack(Model2, Model10, Model18,
> Model26, subset14, Model42, subset20, subset24, Model60, Model68), fun =
> median)
> Since your rasters are multi-layer RasterBrick, you should give more
> details of their stucture/content to let us answer your question.
>
> HTH,
> ?kos Bede-Fazekas
> Hungarian Academy of Sciences
>
> 2019.06.01. 17:24 keltez?ssel, rain1290--- via R-sig-Geo ?rta:
> > Hi there,
> > Using ggplot, I have successfully created a plot that contains 37 
> separate line plots that each represent a trend in precipitation over 
> 140 years. However, what I would like to do is show the curve that is 
> the "median" of these lines. Is this possible to do?
> > Here is what I have so far in an attempt to do this, but I am not 
> certain if it is the correct approach to create the desired median 
> line - the first variable shows x-variable objects (each 
> 1-dimensional) and the second variable shows the y-variable objects 
> (3-dimensional):
> > RCP1pctCO2Median <- median(cbind(get, IPSL, IPSLMR, IPSL5, MIROC, 
> HadGEM, MPI, MPI5, GFDL, GFDL5))
> > RCP1pctCO2ModelMedian <- median(cbind(Model2, Model10, Model18, 
> Model26, subset14, Model42, subset20, subset24, Model60, Model68))
> >
> > The first variable appears to work, but it only returns one value, 
> and I want all of the 140 values corresponding to whichever curve was 
> returned. Why is it that only one value returns? Here is what the 
> variable contains:
> >> RCP1pctCO2Median[1] 1.189044
> > When I run the second variable the same way, I receive the following 
> error:
> > Error in sort.int(x, na.last = na.last, decreasing = decreasing, ...) :
> >? ? 'x' must be atomic
> > Why does this appear?? I tried "unlist" and "as.vector", but the 
> same error appears.
> > If it helps, to show what the 1-dimensional objects of the first 
> variable look like, here is an example of one (the object "get"):
> >> get
> >? ? [1] 0.00000000 0.00644777 0.01250601 0.01746194 0.02656210 
> 0.03360072 0.04399755 0.05404601 0.06154399 0.07105423
> >? [11] 0.08315538 0.08925389 0.10060635 0.10833009 0.12196157 
> 0.13730928 0.14890850 0.16087072 0.17361501 0.18310140
> >? [21] 0.19810085 0.21316248 0.22423607 0.23529990 0.24695577 
> 0.26119599 0.27643532 0.28517213 0.29978970 0.31870887
> >? [31] 0.33418021 0.34585044 0.36071229 0.37379062 0.39324498 
> 0.41099992 0.42437476 0.43643925 0.44687960 0.45864752
> >? [41] 0.48055932 0.49634662 0.50779009 0.52861303 0.54971600 
> 0.56138206 0.57472491 0.59202033 0.60975420 0.63057494
> >? [51] 0.64653736 0.66088217 0.68168259 0.69649595 0.71363837 
> 0.72988760 0.75010443 0.76776582 0.78613955 0.81099886
> >? [61] 0.82979667 0.84431553 0.86824787 0.88447672 0.89909577 
> 0.92162514 0.94854647 0.96631038 0.98120815 1.00357985
> >? [71] 1.02769291 1.04733002 1.06585240 1.09083056 1.11592567 
> 1.13627303 1.15866983 1.17941856 1.19748724 1.22012913
> >? [81] 1.24142718 1.26937973 1.29283488 1.31011736 1.33134723 
> 1.36014366 1.38395822 1.40615380 1.42895305 1.45046842
> >? [91] 1.47504234 1.49920797 1.52142668 1.54559219 1.57354927 
> 1.60000896 1.62449229 1.64506662 1.67100036 1.70185161
> > [101] 1.72964287 1.75235510 1.77455521 1.80183053 1.83121216 
> 1.85619974 1.88188243 1.91002214 1.93333006 1.96133912
> > [111] 1.98944890 2.01225924 2.03804183 2.06614304 2.09558916 
> 2.12400699 2.14846969 2.18011498 2.20532560 2.23031592
> > [121] 2.26106715 2.28796983 2.31954741 2.35274339 2.37794161 
> 2.40643740 2.43963051 2.46948838 2.49733877 2.53035021
> > [131] 2.56229091 2.59265327 2.61934137 2.64592481 2.67754769 
> 2.70779777 2.73824191 2.76880598 2.80077982 2.83057237
> >
> > For the 3-D objects within the second variable, here is what is 
> contained in the object "Model2", for example:
> >> Model2 <- brick("MaxPrecCCCMACanESM21pctCO2.nc", var = "onedaymax")
> >> Model2class? ? ? : RasterBrick
> > dimensions? : 64, 128, 8192, 140? (nrow, ncol, ncell, nlayers)
> > resolution? : 2.8125, 2.789327? (x, y)
> > extent? ? ? : -181.4062, 178.5938, -89.25846, 89.25846? (xmin, xmax, 
> ymin, ymax)
> > coord. ref. : +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0
> > data source : C:/Users/Travis/Documents/Other documents/All netCDF 
> files/netcdffiles/MaxPrecCCCMACanESM21pctCO2.nc
> > names? ? ? : X1, X2, X3, X4, X5, X6, X7, X8, X9, X10, X11, X12, X13, 
> X14, X15, ...
> > z-value? ? : 1, 140 (min, max)
> > varname? ? : onedaymax
> >
> >
> > In any case, I am not even certain if what I have done above is the 
> correct approach altogether to create a median line, but I would 
> greatly appreciate any assistance! Your feedback would be extremely 
> valuable to me!
> > Thank you, and I very much look forward to hearing from you!
>
> > ??? [[alternative HTML version deleted]]
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>


	[[alternative HTML version deleted]]


From r@i@1290 m@iii@g oii @im@com  Sat Jun  1 23:44:59 2019
From: r@i@1290 m@iii@g oii @im@com (r@i@1290 m@iii@g oii @im@com)
Date: Sat, 1 Jun 2019 21:44:59 +0000 (UTC)
Subject: [R-sig-Geo] 
 Creating a median curve among multiple curvesin ggplot
In-Reply-To: <b27dadec-5615-e8e1-cfe9-4e427e8d2800@gmail.com>
References: <1269474004.2799441.1559402646193.ref@mail.yahoo.com>
 <1269474004.2799441.1559402646193@mail.yahoo.com>
 <fb525608-1585-1dad-d672-3ed714cadb71@gmail.com>
 <1275737724.4621877.1559405198628@mail.yahoo.com>
 <aefba21c-3ea5-06f8-edac-738112fcc567@gmail.com>
 <355652114.2414751.1559409815581@mail.yahoo.com>
 <b27dadec-5615-e8e1-cfe9-4e427e8d2800@gmail.com>
Message-ID: <420214144.9293890.1559425499961@mail.yahoo.com>

Hi Akos,

Yes, I decided to experiment with different orders, just to see what would happen, and, indeed, the values returned were exactly the same. This confirms the automatic functionality!
Many thanks, once again! Your help was extremely appreciated!!
Have yourself a good weekend, as well.

-----Original Message-----
From: Bede-Fazekas ?kos <bfalevlist at gmail.com>
To: rain1290 <rain1290 at aim.com>; r-sig-geo <r-sig-geo at r-project.org>
Sent: Sat, Jun 1, 2019 4:04 pm
Subject: Re: [R-sig-Geo] Creating a median curve among multiple curvesin ggplot

 Hi,
 median() automatically sorts the data, so the order of the rasters is not important, I think.
 Have a nice weekend,
 ?kos
 
 2019.06.01. 19:23 keltez?ssel, rain1290 at aim.com ?rta:
  
 
Hi Akos,
 
 Actually, I believe both of these worked just fine after testing them and returned the 140 values in each case! For the second variable, I first received an error after running it, but this was because the number of years/layers differed slightly for one of the objects (Model42), being 138 years/layers. So, I just modified the code to account for this (i.e. 1:138), and it worked fine. :) ? 
  Also, I need not arrange the raster objects in ascending order, correct? My sense is that it automatically sorts the values for each object from lowest to highest for each year for each grid cell. At least that is what it did for the 1-dimensional objects for the first variable, as the median values shown there are correctly ascending (as they should be with each year).? 
  Many, many thanks, once again! 
  -----Original Message-----
 From: Bede-Fazekas ?kos <bfalevlist at gmail.com>
 To: rain1290 <rain1290 at aim.com>; r-sig-geo <r-sig-geo at r-project.org>
 Sent: Sat, Jun 1, 2019 12:47 pm
 Subject: Re: [R-sig-Geo] Creating a median curve among multiple curvesin ggplot
 
   Hello,
 Sorry for this, it was wrong. This might work:
 RCP1pctCO2Median <- apply(X = cbind(get, IPSL, IPSLMR, IPSL5, MIROC, HadGEM, MPI, MPI5, GFDL, GFDL5), MARGIN = 1, FUN = median)
 
 OK, I understand now the structure of your rasters.
 Something like this may do the task:
 stack(lapply(X = 1:140, FUN = function(year) {calc(x = stack(lapply(X = list(Model2, Model10, Model18, Model26, subset14, Model42, subset20, subset24, Model60, Model68), FUN = "[[", i = year)), fun = median)}))
 (Again, this is not tested. If you send us reproducible examples then we can try the code what we suggest you.)
 HTH,
 ?kos
 
 2019.06.01. 18:06 keltez?ssel, rain1290 at aim.com ?rta:
  
 
     Hi Akos (and everyone), 
  Thank you kindly for this response! 
 I tried your suggestions, but for the first variable:? 
  RCP1pctCO2Median <- median(apply(X = cbind(get, IPSL, IPSLMR, IPSL5, 
  MIROC, HadGEM, MPI, MPI5, GFDL, GFDL5)), MARGIN = 1, FUN = median) 
  I receive this error: 
   Error in match.fun(FUN) : argument "FUN" is missing, with no default 
  Why would that appear? 
  Also, for the raster objects for the second variable, yes, what you suggested worked, but this returns only the single median value per grid cell for the 140 years, as opposed to 140 medians (i.e. a median for each year/each layer) for each grid cell. Ideally, I would like to derive 140 medians corresponding to each of the 140 years/layers for each grid cell. Is there a way to do this?? 
  Here is what some of the values/structure look like for the object Model2: 
   > head(Model2)
             X1       X2        X3        X4       X5       X6        X7        X8        X9       X10       X11
 [1,]  7.395703 6.493830  7.432156  6.767403 11.66004 7.158040 13.968703  8.139962  7.927880 10.367045  8.560315
 [2,]  7.277671 6.318810  8.406366  5.974478 12.51484 7.405914 15.350679  7.977879  8.039850  9.696597  9.374163
 [3,]  6.919258 6.119063  9.485675  6.256432 13.44547 7.542754 10.846225  8.441847  8.155234 10.129576 10.074353
 [4,]  6.633444 6.300559 10.349174  6.733875 14.35567 7.589797 12.452223  8.384633  8.697707 10.025741 10.589373
 [5,]  6.986749 7.057785 11.202586  8.037964 15.08123 7.668468 11.838186  8.506311  8.978721  9.699996 10.256382
 [6,]  7.287383 7.561100 12.091483  8.384658 15.56648 7.662876  8.925544  9.431210  8.979276 10.047477 10.898319
 [7,]  7.957773 7.732338 13.998432  8.982379 15.50928 7.599275  8.548879  8.287948  8.745722  9.496011 10.861937
            X12       X13       X14       X15      X16       X17      X18       X19      X20       X21       X22
 [1,]  5.533977 10.534669 12.136978  8.897428 10.07571  8.485538 7.731084 10.557160 15.36603 12.320665 11.274374
 [2,]  6.010256 10.299062 12.703854  9.522287 11.08078  8.996936 6.919732 10.900610 14.44405 11.949420 11.202058
 [3,]  6.590125  9.553597 12.781633  9.015289 11.35786  9.215069 6.888467  9.571572 13.47964 10.308230  9.772387
 [4,]  7.042177  8.800974 12.292124 11.457335 11.96268  9.329095 7.078347  9.072567 13.90133  9.780438  9.901325
 [5,]  7.613796  9.617242 11.511468 11.527631 12.94864  9.510409 7.504535  8.380163 14.01753  9.804405 10.389509
 [6,]  8.146129  9.211740 11.250921 11.483143 13.93948  8.881543 7.888670  8.917588 13.32526  8.609215  9.584101
 [7,]  8.551682  8.858268 10.417808 11.292067 15.19191  9.224810 8.231571  7.949825 12.58279  8.042569  9.816563 
  Thanks, once again, and I look forward to your response! 
  -----Original Message-----
 From: Bede-Fazekas ?kos <bfalevlist at gmail.com>
 To: r-sig-geo <r-sig-geo at r-project.org>
 Sent: Sat, Jun 1, 2019 11:47 am
 Subject: Re: [R-sig-Geo] Creating a median curve among multiple curvesin ggplot
 
 Hello,
 in case of the vectors, you can get the median of the different models 
 for each of the years using apply() function:
 RCP1pctCO2Median <- median(apply(X = cbind(get, IPSL, IPSLMR, IPSL5, 
 MIROC, HadGEM, MPI, MPI5, GFDL, GFDL5)), MARGIN = 1, FUN = median)
 It calculates the median of each of the rows (= years) of the matrix.
 
 In case of rasters, use raster::calc(), if all the rasters are 
 single-layer RasterLayer objects:
 RCP1pctCO2ModelMedian <- calc(x = stack(Model2, Model10, Model18, 
 Model26, subset14, Model42, subset20, subset24, Model60, Model68), fun = 
 median)
 Since your rasters are multi-layer RasterBrick, you should give more 
 details of their stucture/content to let us answer your question.
 
 HTH,
 ?kos Bede-Fazekas
 Hungarian Academy of Sciences
 
 2019.06.01. 17:24 keltez?ssel, rain1290--- via R-sig-Geo ?rta:
 > Hi there,
 > Using ggplot, I have successfully created a plot that contains 37 separate line plots that each represent a trend in precipitation over 140 years. However, what I would like to do is show the curve that is the "median" of these lines. Is this possible to do?
 > Here is what I have so far in an attempt to do this, but I am not certain if it is the correct approach to create the desired median line - the first variable shows x-variable objects (each 1-dimensional) and the second variable shows the y-variable objects (3-dimensional):
 > RCP1pctCO2Median <- median(cbind(get, IPSL, IPSLMR, IPSL5, MIROC, HadGEM, MPI, MPI5, GFDL, GFDL5))
 > RCP1pctCO2ModelMedian <- median(cbind(Model2, Model10, Model18, Model26, subset14, Model42, subset20, subset24, Model60, Model68))
 >
 > The first variable appears to work, but it only returns one value, and I want all of the 140 values corresponding to whichever curve was returned. Why is it that only one value returns? Here is what the variable contains:
 >> RCP1pctCO2Median[1] 1.189044
 > When I run the second variable the same way, I receive the following error:
 > Error in sort.int(x, na.last = na.last, decreasing = decreasing, ...) :
 >? ? 'x' must be atomic
 > Why does this appear?? I tried "unlist" and "as.vector", but the same error appears.
 > If it helps, to show what the 1-dimensional objects of the first variable look like, here is an example of one (the object "get"):
 >> get
 >? ? [1] 0.00000000 0.00644777 0.01250601 0.01746194 0.02656210 0.03360072 0.04399755 0.05404601 0.06154399 0.07105423
 >? [11] 0.08315538 0.08925389 0.10060635 0.10833009 0.12196157 0.13730928 0.14890850 0.16087072 0.17361501 0.18310140
 >? [21] 0.19810085 0.21316248 0.22423607 0.23529990 0.24695577 0.26119599 0.27643532 0.28517213 0.29978970 0.31870887
 >? [31] 0.33418021 0.34585044 0.36071229 0.37379062 0.39324498 0.41099992 0.42437476 0.43643925 0.44687960 0.45864752
 >? [41] 0.48055932 0.49634662 0.50779009 0.52861303 0.54971600 0.56138206 0.57472491 0.59202033 0.60975420 0.63057494
 >? [51] 0.64653736 0.66088217 0.68168259 0.69649595 0.71363837 0.72988760 0.75010443 0.76776582 0.78613955 0.81099886
 >? [61] 0.82979667 0.84431553 0.86824787 0.88447672 0.89909577 0.92162514 0.94854647 0.96631038 0.98120815 1.00357985
 >? [71] 1.02769291 1.04733002 1.06585240 1.09083056 1.11592567 1.13627303 1.15866983 1.17941856 1.19748724 1.22012913
 >? [81] 1.24142718 1.26937973 1.29283488 1.31011736 1.33134723 1.36014366 1.38395822 1.40615380 1.42895305 1.45046842
 >? [91] 1.47504234 1.49920797 1.52142668 1.54559219 1.57354927 1.60000896 1.62449229 1.64506662 1.67100036 1.70185161
 > [101] 1.72964287 1.75235510 1.77455521 1.80183053 1.83121216 1.85619974 1.88188243 1.91002214 1.93333006 1.96133912
 > [111] 1.98944890 2.01225924 2.03804183 2.06614304 2.09558916 2.12400699 2.14846969 2.18011498 2.20532560 2.23031592
 > [121] 2.26106715 2.28796983 2.31954741 2.35274339 2.37794161 2.40643740 2.43963051 2.46948838 2.49733877 2.53035021
 > [131] 2.56229091 2.59265327 2.61934137 2.64592481 2.67754769 2.70779777 2.73824191 2.76880598 2.80077982 2.83057237
 >
 > For the 3-D objects within the second variable, here is what is contained in the object "Model2", for example:
 >> Model2 <- brick("MaxPrecCCCMACanESM21pctCO2.nc", var = "onedaymax")
 >> Model2class? ? ? : RasterBrick
 > dimensions? : 64, 128, 8192, 140? (nrow, ncol, ncell, nlayers)
 > resolution? : 2.8125, 2.789327? (x, y)
 > extent? ? ? : -181.4062, 178.5938, -89.25846, 89.25846? (xmin, xmax, ymin, ymax)
 > coord. ref. : +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0
 > data source : C:/Users/Travis/Documents/Other documents/All netCDF files/netcdffiles/MaxPrecCCCMACanESM21pctCO2.nc
 > names? ? ? : X1, X2, X3, X4, X5, X6, X7, X8, X9, X10, X11, X12, X13, X14, X15, ...
 > z-value? ? : 1, 140 (min, max)
 > varname? ? : onedaymax
 >
 >
 > In any case, I am not even certain if what I have done above is the correct approach altogether to create a median line, but I would greatly appreciate any assistance! Your feedback would be extremely valuable to me!
 > Thank you, and I very much look forward to hearing from you! 
 > ??? [[alternative HTML version deleted]]
 >
 > _______________________________________________
 > R-sig-Geo mailing list
 > R-sig-Geo at r-project.org
 > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
 >
 
 _______________________________________________
 R-sig-Geo mailing list
 R-sig-Geo at r-project.org
 https://stat.ethz.ch/mailman/listinfo/r-sig-geo 
     
      

	[[alternative HTML version deleted]]


From @nton|o@bubb|co @end|ng |rom gm@||@com  Tue Jun  4 15:18:10 2019
From: @nton|o@bubb|co @end|ng |rom gm@||@com (Antonio Bubbico)
Date: Tue, 4 Jun 2019 14:18:10 +0100
Subject: [R-sig-Geo] weather and trade
Message-ID: <CABW+3tCyhqtV-J=hhJPLTs49+D_CMA_ZyMYH=oqEpBgS2fb3KA@mail.gmail.com>

Hello,

I want to consider the effect of weather on trade. Data on trade are at
country level per month (I get them from COMEXT).

As for the weather data, I consider those by the NOOA, specifically from
dataset GSOM on temperature and precipitation (
https://data.noaa.gov/dataset/dataset/global-summary-of-the-month-version-1-0).
The GSOM refers to station level by month/year.

Since I need an observation by month for each country, the idea is to
simply make an average of the temp and prec from the stations within a
country.

I would like to ask to you if you see some criticalities in this approach.

Best Regards

-- 
*Dr Antonio Bubbico*

*Ph.D in Agrifood Economics and Statistics (Doctor Europaeus)*
www.localdevelopment.org

	[[alternative HTML version deleted]]


From |@cundo@munoz @end|ng |rom c|r@d@|r  Tue Jun  4 17:01:28 2019
From: |@cundo@munoz @end|ng |rom c|r@d@|r (=?UTF-8?Q?Facundo_Mu=c3=b1oz?=)
Date: Tue, 4 Jun 2019 17:01:28 +0200
Subject: [R-sig-Geo] spacetime and sf
Message-ID: <1bd6135e-7313-9cd8-0d36-ae9900167782@cirad.fr>

Dear Edzer,

How do you conceive the future of the package `spacetime` and more
generally, the representation of spatio-temporal data, in light of the
transition from `sp` to `sf`?

For context, I'm working on a package that handles spatio-temporal point
patterns. For my analyses I have relied on `sf` with some additional
attribute for the dates. However, for packaging I think it is safer to
rely on explicit classes for spatio-temporal data (so I don't have to
worry all the time about which is the temporal variable, in which
format, etc.). But it seems that only `spacetime` provides such classes
generically, which in turn relies on `sp` for the spatial dimension. Is
this going to continue to be supported or are there other plans?

Thanks in advance

??? ??? ?acu.-

-- 
Facundo Mu?oz
*Biostatistician*
D?partement de Syst?mes Biologiques
UMR ASTRE: Animal, Sant?, Territoires, Risques et ?cosyst?mes
Campus international de Baillarguet, TA A-117 / E (E-203)
34398 Montpellier Cedex 5 (France)
+33(0) 467 593 868
@famuvie


From edzer@pebe@m@ @end|ng |rom un|-muen@ter@de  Tue Jun  4 18:02:38 2019
From: edzer@pebe@m@ @end|ng |rom un|-muen@ter@de (Edzer Pebesma)
Date: Tue, 4 Jun 2019 18:02:38 +0200
Subject: [R-sig-Geo] spacetime and sf
In-Reply-To: <1bd6135e-7313-9cd8-0d36-ae9900167782@cirad.fr>
References: <1bd6135e-7313-9cd8-0d36-ae9900167782@cirad.fr>
Message-ID: <fb27d42a-4065-4dc4-042d-a63cc13284f3@uni-muenster.de>

Dear ?acu,

spacetime will remain the way it is, just like sp, too much stuff
depends on how it is now.

For STFDF objects in spacetime, a follow-up package is stars: it
supports raster and vector data cubes, and can deal with more cube
dimensions than STFDF ever could; it also gets better dealing with e.g.
large satellite images.

For the STIDF (irregular: s/t point patterns) there is currently no
follow-up package that builds on top of sf. As you note, its
functionality would be pretty much limited to registering which column
denotes time in an attribute, and add a class label. So far, I haven't
considered that worth the effort: you may have to add lots of method
instances to have that information survive all the current methods
available for sf objects.

Have you thought about giving the time variable a fixed name? Or is
there a need for maintaining multiple time variables in sf objects?

Best,

On 6/4/19 5:01 PM, Facundo Mu?oz wrote:
> Dear Edzer,
> 
> How do you conceive the future of the package `spacetime` and more
> generally, the representation of spatio-temporal data, in light of the
> transition from `sp` to `sf`?
> 
> For context, I'm working on a package that handles spatio-temporal point
> patterns. For my analyses I have relied on `sf` with some additional
> attribute for the dates. However, for packaging I think it is safer to
> rely on explicit classes for spatio-temporal data (so I don't have to
> worry all the time about which is the temporal variable, in which
> format, etc.). But it seems that only `spacetime` provides such classes
> generically, which in turn relies on `sp` for the spatial dimension. Is
> this going to continue to be supported or are there other plans?
> 
> Thanks in advance
> 
> ??? ??? ?acu.-
> 

-- 
Edzer Pebesma
Institute for Geoinformatics
Heisenbergstrasse 2, 48151 Muenster, Germany
Phone: +49 251 8333081

-------------- next part --------------
A non-text attachment was scrubbed...
Name: pEpkey.asc
Type: application/pgp-keys
Size: 2472 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20190604/1e6cb941/attachment.bin>

From |@cundo@munoz @end|ng |rom c|r@d@|r  Wed Jun  5 09:25:26 2019
From: |@cundo@munoz @end|ng |rom c|r@d@|r (=?UTF-8?Q?Facundo_Mu=c3=b1oz?=)
Date: Wed, 5 Jun 2019 09:25:26 +0200
Subject: [R-sig-Geo] spacetime and sf
In-Reply-To: <fb27d42a-4065-4dc4-042d-a63cc13284f3@uni-muenster.de>
References: <1bd6135e-7313-9cd8-0d36-ae9900167782@cirad.fr>
 <fb27d42a-4065-4dc4-042d-a63cc13284f3@uni-muenster.de>
Message-ID: <eaa0c56a-f17c-e821-9729-e4a293761501@cirad.fr>

Thank you Edzer, I understand the trade-offs.

I hadn't thought of fixing the variable name for the time attribute. But
since time can be eventually represented as either dates, or week
numbers, or day numbers, or months, etc. I think it is best to let the
variable adopt whatever name the user feels more natural.

On the other hand, I don't expect my users to perform spatial operations
with their point pattern (other than perhaps filtering observations). So
it might not be that much effort to maintain the appropriate methods for
a specific class inheriting from `sf`.

Best wishes

??? ??? ?acu.-


On 6/4/19 6:02 PM, Edzer Pebesma wrote:
> Dear ?acu,
>
> spacetime will remain the way it is, just like sp, too much stuff
> depends on how it is now.
>
> For STFDF objects in spacetime, a follow-up package is stars: it
> supports raster and vector data cubes, and can deal with more cube
> dimensions than STFDF ever could; it also gets better dealing with e.g.
> large satellite images.
>
> For the STIDF (irregular: s/t point patterns) there is currently no
> follow-up package that builds on top of sf. As you note, its
> functionality would be pretty much limited to registering which column
> denotes time in an attribute, and add a class label. So far, I haven't
> considered that worth the effort: you may have to add lots of method
> instances to have that information survive all the current methods
> available for sf objects.
>
> Have you thought about giving the time variable a fixed name? Or is
> there a need for maintaining multiple time variables in sf objects?
>
> Best,
>
> On 6/4/19 5:01 PM, Facundo Mu?oz wrote:
>> Dear Edzer,
>>
>> How do you conceive the future of the package `spacetime` and more
>> generally, the representation of spatio-temporal data, in light of the
>> transition from `sp` to `sf`?
>>
>> For context, I'm working on a package that handles spatio-temporal point
>> patterns. For my analyses I have relied on `sf` with some additional
>> attribute for the dates. However, for packaging I think it is safer to
>> rely on explicit classes for spatio-temporal data (so I don't have to
>> worry all the time about which is the temporal variable, in which
>> format, etc.). But it seems that only `spacetime` provides such classes
>> generically, which in turn relies on `sp` for the spatial dimension. Is
>> this going to continue to be supported or are there other plans?
>>
>> Thanks in advance
>>
>> ??? ??? ?acu.-
>>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From r@i@1290 m@iii@g oii @im@com  Wed Jun  5 16:21:57 2019
From: r@i@1290 m@iii@g oii @im@com (r@i@1290 m@iii@g oii @im@com)
Date: Wed, 5 Jun 2019 14:21:57 +0000 (UTC)
Subject: [R-sig-Geo] Plotting more than one regression line in ggplot
References: <1137207179.276713.1559744517039.ref@mail.yahoo.com>
Message-ID: <1137207179.276713.1559744517039@mail.yahoo.com>

I am trying to plot, using ggplot, a series of scatter plots with regression lines for several datasets. I started with the following dataset, "onepectCO2MEDIAN". The data for this dataset is as follows:
??? onepctCO2MEDIAN
??????????????????? x????????? y
??? layer.1?? 0.000000000? 0.0000000
??? layer.2?? 0.006794447? 4.9002490
??? layer.3?? 0.014288058? 0.1608000
??? layer.4?? 0.022087920? 6.6349133
??? layer.5?? 0.030797357 -1.2429506
??? layer.6?? 0.038451072? 1.5643374
??? layer.7?? 0.048087904 -2.2659035
??? layer.8?? 0.058677729? 2.2070045
??? layer.9?? 0.069261406 -2.3677001
??? layer.10? 0.080524530 -1.0913506
??? layer.11? 0.092760246? 0.4099940
??? layer.12? 0.103789609 -0.1259727
??? layer.13? 0.116953168 -2.4138253
??? layer.14? 0.129253298? 7.0890257
??? layer.15? 0.141710050 -0.7593539
??? layer.16? 0.156002052? 0.0454416
??? layer.17? 0.170648172 -1.5349683
??? layer.18? 0.185318425? 6.5524201
??? layer.19? 0.199463055 -0.8312563
??? layer.20? 0.213513337 -2.5099183
??? layer.21? 0.228839271? 0.1365968
??? layer.22? 0.246981293 -1.3719845
??? layer.23? 0.263012767 -0.8712988
??? layer.24? 0.278505564? 0.6632584
??? layer.25? 0.293658361? 0.7938036
??? layer.26? 0.310747266? 3.4880637
??? layer.27? 0.325990349 -4.4612208
??? layer.28? 0.342517540? 0.0871734
??? layer.29? 0.362751633 -1.4171578
??? layer.30? 0.380199537 -0.9956508
??? layer.31? 0.394992948? 0.3215526
??? layer.32? 0.414373398? 3.1403866
??? layer.33? 0.430690214 -0.7376099
??? layer.34? 0.449738145 -2.4860541
??? layer.35? 0.470167458 -3.4235858
??? layer.36? 0.489019871? 0.4824748
??? layer.37? 0.507242471 -0.9785386
??? layer.38? 0.524314284? 8.5359684
??? layer.39? 0.543750525? 5.4844742
??? layer.40? 0.564234197? 3.2149367
??? layer.41? 0.583679616? 3.9168916 
??? layer.42? 0.601459444? 4.4907020
??? layer.43? 0.619924664? 6.5410410
??? layer.44? 0.639932007? 4.8068650
??? layer.45? 0.661347181? 8.1510170
??? layer.46? 0.684117317? 0.2697413
??? layer.47? 0.704829752 -0.1807501
??? layer.48? 0.725045770? 9.7181249
??? layer.49? 0.745165825? 1.5406466
??? layer.50? 0.765016139 -1.6476041
??? layer.51? 0.783461511? 4.8024603
??? layer.52? 0.806382924? 4.0421516
??? layer.53? 0.829241335? 9.3756512
??? layer.54? 0.849924415? 5.3305050
??? layer.55? 0.871352434? 7.5445803
??? layer.56? 0.893632233? 6.4679547
??? layer.57? 0.916052133? 2.8096065
??? layer.58? 0.938579470? 5.3921661
??? layer.59? 0.959907651? 7.2043689
??? layer.60? 0.981643587? 3.3350806
??? layer.61? 1.004116774? 8.8690707
??? layer.62? 1.028363466? 1.7861299
??? layer.63? 1.054009140? 6.2555038
??? layer.64? 1.072440803? 7.6079236
??? layer.65? 1.094457805? 7.6871483
??? layer.66? 1.123176277? 4.7787764
??? layer.67? 1.149430871 12.7110502
??? layer.68? 1.170912921 -0.7156284
??? layer.69? 1.196743071? 1.6490899
??? layer.70? 1.218625903? 3.0363024
??? layer.71? 1.241868377? 4.2974769
??? layer.72? 1.267941594? 1.9543778
??? layer.73? 1.290708780? 3.9986964
??? layer.74? 1.313222289? 4.5179472
??? layer.75? 1.339045882? 0.9337905
??? layer.76? 1.362803459? 3.3050770
??? layer.77? 1.384450197? 3.5422970
??? layer.78? 1.409720302? 5.9973660
??? layer.79? 1.435851157? 0.5081869
??? layer.80? 1.455592215? 7.9661630
??? layer.81? 1.479495347? 9.9460496
??? layer.82? 1.506051958? 3.7908372
??? layer.83? 1.525728464? 2.5735847
??? layer.84? 1.549362063 10.1404974
??? layer.85? 1.573440671 13.7408304
??? layer.86? 1.600278735? 0.9335771
??? layer.87? 1.623879492? 9.7588742
??? layer.88? 1.650029302? 1.2769395
??? layer.89? 1.672362328 13.4970906
??? layer.90? 1.700221121 10.2087502
??? layer.91? 1.724793375? 1.6811275
??? layer.92? 1.751070559? 6.1178992
??? layer.93? 1.778022110 -0.1567626
??? layer.94? 1.803022087? 3.8237479
??? layer.95? 1.830668867? 4.4331468
??? layer.96? 1.855736911? 5.9790707
??? layer.97? 1.882615030 11.3104333
??? layer.98? 1.909218490? 8.2142607
??? layer.99? 1.938130021 15.3209674
??? layer.100 1.963727593? 5.8178217
??? layer.101 1.993271947? 9.6004907
??? layer.102 2.022548139? 3.4063646
??? layer.103 2.050679922? 4.7375010
??? layer.104 2.078064442? 3.0133019
??? layer.105 2.104113460? 5.5659522
??? layer.106 2.133597612 12.0346333
??? layer.107 2.164026260 -0.4028320
??? layer.108 2.194852829 10.5996780
??? layer.109 2.224257946? 5.4479584
??? layer.110 2.252194643? 4.7052374
??? layer.111 2.277335048 14.0962019
??? layer.112 2.304058313? 5.7149016
??? layer.113 2.330930233? 3.7780072
??? layer.114 2.357022762? 4.4120620
??? layer.115 2.386489272? 4.1866085
??? layer.116 2.417503953? 6.9078802
??? layer.117 2.448524356? 2.7825739
??? layer.118 2.478698969? 7.6171786
??? layer.119 2.510175705 10.2410603
??? layer.120 2.539697886? 8.1820711
??? layer.121 2.567915559? 4.8275494
??? layer.122 2.597463250 19.1624883
??? layer.123 2.627518773 16.0677109
??? layer.124 2.658759236 12.5897081
??? layer.125 2.692401528? 9.2907988
??? layer.126 2.721903205? 7.4262502
??? layer.127 2.753021359? 9.3902518
??? layer.128 2.786313415 12.6193550
??? layer.129 2.819564104 11.1121040
??? layer.130 2.850823164 15.7907100
??? layer.131 2.880394101 10.7425287
??? layer.132 2.911391258? 7.7971430
??? layer.133 2.942965150? 8.8060858
??? layer.134 2.974468350 17.5606266
??? layer.135 3.008983612 17.3088605
??? layer.136 3.040015221 13.4500543
??? layer.137 3.072668672 14.6377884
??? layer.138 3.105982423? 8.0798552dput(onepctCO2MEDIAN)??? dput(onepctCO2MEDIAN)
??? structure(list(x = c(0, 0.00679444684647024, 0.014288058038801, 
??? 0.0220879195258021, 0.0307973567396402,0.0384510718286037,0.0480879042297602, 
??? 0.0586777292191982, 0.0692614056169987, 0.080524530261755,0.0927602462470531, 
??? 0.103789608925581, 0.116953168064356, 0.129253298044205, 0.141710050404072, 
??? 0.156002052128315, 0.170648172497749, 0.185318425297737, 0.199463054537773, 
??? 0.21351333707571, 0.22883927077055, 0.246981292963028, 0.263012766838074, 
??? 0.278505563735962, 0.29365836083889, 0.310747265815735, 0.325990349054337, 
??? 0.342517539858818, 0.362751632928848, 0.380199536681175, 0.39499294757843, 
??? 0.414373397827148, 0.430690214037895, 0.449738144874573, 0.470167458057404, 
??? 0.489019870758057, 0.507242470979691, 0.524314284324646, 0.543750524520874, 
??? 0.56423419713974, 0.583679616451263, 0.601459443569183, 0.619924664497375, 
??? 0.639932006597519, 0.661347180604935, 0.684117317199707, 0.704829752445221, 
??? 0.725045770406723, 0.745165824890137, 0.765016138553619, 0.783461511135101, 
??? 0.806382924318314, 0.829241335391998, 0.84992441534996, 0.871352434158325, 
??? 0.893632233142853, 0.916052132844925, 0.938579469919205, 0.959907650947571, 
??? 0.981643587350845, 1.00411677360535, 1.02836346626282, 1.05400913953781, 
??? 1.07244080305099, 1.09445780515671, 1.12317627668381, 1.14943087100983, 
??? 1.17091292142868, 1.19674307107925, 1.21862590312958, 1.24186837673187, 
??? 1.26794159412384, 1.2907087802887, 1.31322228908539, 1.33904588222504, 
??? 1.36280345916748, 1.38445019721985, 1.40972030162811, 1.43585115671158, 
??? 1.45559221506119, 1.47949534654617, 1.50605195760727, 1.52572846412659, 
??? 1.5493620634079, 1.5734406709671, 1.60027873516083, 1.62387949228287, 
??? 1.65002930164337, 1.67236232757568, 1.70022112131119, 1.72479337453842, 
??? 1.75107055902481, 1.77802211046219, 1.80302208662033, 1.83066886663437, 
??? 1.85573691129684, 1.88261502981186, 1.90921849012375, 1.93813002109528, 
??? 1.96372759342194, 1.99327194690704, 2.02254813909531, 2.05067992210388, 
??? 2.07806444168091, 2.1041134595871, 2.13359761238098, 2.16402626037598, 
??? 2.19485282897949, 2.2242579460144, 2.25219464302063, 2.27733504772186, 
??? 2.30405831336975, 2.33093023300171, 2.35702276229858, 2.38648927211761, 
??? 2.41750395298004, 2.44852435588837, 2.47869896888733, 2.51017570495605, 
??? 2.53969788551331, 2.567915558815, 2.59746325016022, 2.62751877307892, 
??? 2.65875923633575, 2.69240152835846, 2.72190320491791, 2.75302135944366, 
??? 2.78631341457367, 2.8195641040802, 2.85082316398621, 2.88039410114288, 
??? 2.91139125823975, 2.94296514987946, 2.97446835041046, 3.00898361206055, 
??? 3.04001522064209, 3.07266867160797, 3.10598242282867), y = c(0, 
??? 4.90024901723162, 0.160799993152722, 6.63491326258641, -1.24295055804536, 
??? 1.56433744259162, -2.26590352245208, 2.20700446463354, -2.36770012911069, 
??? -1.09135061899174, 0.409993989292701, -0.125972681525582, -2.41382533818026, 
??? 7.08902570153028, -0.759353880417294, 0.0454415959640926, -1.53496826259972, 
??? 6.55242014096194, -0.831256280861552, -2.50991825629084, 0.136596820654013, 
??? -1.37198445498419, -0.871298832596736, 0.663258363762466, 0.793803634291308, 
??? 3.48806373666998, -4.46122081238949, 0.0871733966938564, -1.41715777257774, 
??? -0.995650815648318, 0.32155262317503, 3.14038657369241, -0.737609879885404, 
??? -2.48605406511292, -3.423585843908, 0.482474753780281, -0.978538630093809, 
??? 8.53596837794201, 5.48447420320695, 3.21493665820644, 3.91689160157513, 
??? 4.49070195980797, 6.54104103157039, 4.80686500146557, 8.15101701282067, 
??? 0.26974132191657, -0.180750068063062, 9.71812491230244, 1.54064657400204, 
??? -1.64760408795688, 4.80246028991894, 4.04215159914344, 9.37565121768513, 
??? 5.33050496938428, 7.54458026088508, 6.46795470819342, 2.80960651433971, 
??? 5.39216613235986, 7.20436888038562, 3.3350806460997, 8.86907069895943, 
??? 1.78612988613659, 6.25550382050395, 7.60792364896564, 7.68714830528144, 
??? 4.77877638957615, 12.7110501777314, -0.715628443181046, 1.64908991824022, 
??? 3.03630240714679, 4.29747688442346, 1.95437780501881, 3.99869636910933, 
??? 4.51794724689848, 0.933790484492299, 3.30507700050003, 3.5422970157433, 
??? 5.99736597322524, 0.508186860060022, 7.96616300581067, 9.94604963036295, 
??? 3.79083717222623, 2.57358468532258, 10.1404974171776, 13.7408303595752, 
??? 0.933577123801399, 9.75887417074129, 1.27693947132921, 13.4970905965787, 
??? 10.2087501765735, 1.68112753028756, 6.1178991508927, -0.156762622680077, 
??? 3.82374791691426, 4.43314678736265, 5.97907067167507, 11.3104332518482, 
??? 8.21426074201525, 15.320967360602, 5.81782169471483, 9.6004907412354, 
??? 3.40636455909704, 4.73750103921864, 3.0133019468806, 5.56595224859066, 
??? 12.0346332527215, -0.40283199827104, 10.5996779538754, 5.44795836991128, 
??? 4.70523736412729, 14.096201892183, 5.71490161813391, 3.77800720810782, 
??? 4.41206200639436, 4.18660847858423, 6.90788020044911, 2.78257393345915, 
??? 7.61717857379431, 10.2410602647684, 8.18207106836167, 4.82754943871433, 
??? 19.1624882857155, 16.0677109398509, 12.589708067017, 9.29079879799404, 
??? 7.42625019725314, 9.39025179806185, 12.6193550331438, 11.1121039747257, 
??? 15.7907099734986, 10.7425286789233, 7.79714300307344, 8.80608578166101, 
??? 17.5606266346039, 17.3088604929222, 13.4500543478523, 14.6377884248645, 
??? 8.07985518296064)), class = "data.frame", row.names = c("layer.1", 
??? "layer.2", "layer.3", "layer.4", "layer.5", "layer.6", "layer.7", 
??? "layer.8", "layer.9", "layer.10", "layer.11", "layer.12", "layer.13", 
??? "layer.14", "layer.15", "layer.16", "layer.17", "layer.18", "layer.19", 
??? "layer.20", "layer.21", "layer.22", "layer.23", "layer.24", "layer.25", 
??? "layer.26", "layer.27", "layer.28", "layer.29", "layer.30", "layer.31", 
??? "layer.32", "layer.33", "layer.34", "layer.35", "layer.36", "layer.37", 
??? "layer.38", "layer.39", "layer.40", "layer.41", "layer.42", "layer.43", 
??? "layer.44", "layer.45", "layer.46", "layer.47", "layer.48", "layer.49", 
??? "layer.50", "layer.51", "layer.52", "layer.53", "layer.54", "layer.55", 
??? "layer.56", "layer.57", "layer.58", "layer.59", "layer.60", "layer.61", 
??? "layer.62", "layer.63", "layer.64", "layer.65", "layer.66", "layer.67", 
??? "layer.68", "layer.69", "layer.70", "layer.71", "layer.72", "layer.73", 
??? "layer.74", "layer.75", "layer.76", "layer.77", "layer.78", "layer.79", 
??? "layer.80", "layer.81", "layer.82", "layer.83", "layer.84", "layer.85", 
??? "layer.86", "layer.87", "layer.88", "layer.89", "layer.90", "layer.91", 
??? "layer.92", "layer.93", "layer.94", "layer.95", "layer.96", "layer.97", 
??? "layer.98", "layer.99", "layer.100", "layer.101", "layer.102", 
??? "layer.103", "layer.104", "layer.105", "layer.106", "layer.107", 
??? "layer.108", "layer.109", "layer.110", "layer.111", "layer.112", 
??? "layer.113", "layer.114", "layer.115", "layer.116", "layer.117", 
??? "layer.118", "layer.119", "layer.120", "layer.121", "layer.122", 
??? "layer.123", "layer.124", "layer.125", "layer.126", "layer.127", 
??? "layer.128", "layer.129", "layer.130", "layer.131", "layer.132", 
??? "layer.133", "layer.134", "layer.135", "layer.136", "layer.137", 
??? "layer.138"))
I started with the following to generate the first regression line and scatter plot:??? lm<-ggplot(onepctCO2MEDIAN) +? 
??? geom_jitter(aes(RCP1pctCO2cumulativeMedian[1:138], departurea),?? 
??? colour="blue") + geom_smooth(aes(RCP1pctCO2cumulativeMedian[1:138], 
??? departurea), method=lm) 
But I receive this error:? ??Warning message:
??? Computation failed in `stat_smooth()`:
??? 'what' must be a function or character string
A blue scatter plot is successfully generated, but the problem is that the regression line does not appear, presumably related to the above warning.
Is there a reason for this? I would appreciate any assistance!
	[[alternative HTML version deleted]]


From j@chon7 @end|ng |rom gm@||@com  Wed Jun  5 16:42:21 2019
From: j@chon7 @end|ng |rom gm@||@com (Justin Schon)
Date: Wed, 5 Jun 2019 10:42:21 -0400
Subject: [R-sig-Geo] Predict function for splm object
Message-ID: <CAGH4ugJtRd0RTi9YqyD1tSZo5ARUwjObk3BVs0N7cEH7W+zvoQ@mail.gmail.com>

Hello all,

I've seen that a lot of people ask about this, but I am interested in
whether there may be any developments here. Is there a predict function
that works for splm objects?

Note that I am not referring to spLM objects, which often comes up for me
when I google this question.

I found a proposal to do this here:
https://github.com/rstats-gsoc/gsoc2015/wiki/Predict-methods-for-spatial-econometrics

Did that effort, or any other efforts, succeed?

Thank you for any insight that can be shared,

Justin


-- 
Justin Schon
Post-Doctoral Researcher on Environmental Change and Migration
MURI Migration Research Team <http://murimigration.org/>
University of Florida

	[[alternative HTML version deleted]]


From r@i@1290 m@iii@g oii @im@com  Wed Jun  5 17:04:43 2019
From: r@i@1290 m@iii@g oii @im@com (r@i@1290 m@iii@g oii @im@com)
Date: Wed, 5 Jun 2019 15:04:43 +0000 (UTC)
Subject: [R-sig-Geo] 
 [R] Plotting more than one regression line in ggplot
In-Reply-To: <B7E91F7C-9D66-4016-8E2D-C6835DD0EF5B@dcn.davis.ca.us>
References: <1137207179.276713.1559744517039.ref@mail.yahoo.com>
 <1137207179.276713.1559744517039@mail.yahoo.com>
 <B7E91F7C-9D66-4016-8E2D-C6835DD0EF5B@dcn.davis.ca.us>
Message-ID: <448346170.409006.1559747083753@mail.yahoo.com>

Hi Jeff (and everyone),

Thank you for your response and feedback. Yes, I know what you mean - it was a blind and quick choice to use "lm" as my object name. Unfortunately, changing the object name to something else does not eliminate that error/warning message. As a result, the same error/warning appears when running it. Oddly enough, the scatter plot is just fine - it's the regression line that struggles to appear. Could there be another reason for that?
Thanks, again,


-----Original Message-----
From: Jeff Newmiller <jdnewmil at dcn.davis.ca.us>
To: rain1290 <rain1290 at aim.com>; rain1290--- via R-help <r-help at r-project.org>; r-help <r-help at R-project.org>; r-sig-geo <r-sig-geo at r-project.org>
Sent: Wed, Jun 5, 2019 10:49 am
Subject: Re: [R] Plotting more than one regression line in ggplot

Please read the Posting Guide... posting HTML on a plain text mailing list really interferes with clear communication.

If you had spent even a small amount of time working with R tutorials then you would know that "lm" is the name of a very basic, very important R function. However, you are defining your own object called "lm" that is very different indeed than the usual "lm" function. I would guess that in a clean new R workspace where you had not already run your ggplot function and assigned the result to your own "lm" object then this code might run. However, once you have run it once and try to run it again, your "method" argument gives the wrong version of "lm" to geom_smooth and you confuse it.

As the doctor said to the man pounding his own head against the wall, "If it hurts, don't do that." Avoid re-using important object names in R... some common names I see abused this way are df, data, c, t, T, and F. Your choice was unusual, but quite effective at illustrating the problem.

On June 5, 2019 7:21:57 AM PDT, rain1290--- via R-help <r-help at r-project.org> wrote:
>I am trying to plot, using ggplot, a series of scatter plots with
>regression lines for several datasets. I started with the following
>dataset, "onepectCO2MEDIAN". The data for this dataset is as follows:
>??? onepctCO2MEDIAN
>??????????????????? x????????? y
>??? layer.1?? 0.000000000? 0.0000000
>??? layer.2?? 0.006794447? 4.9002490
>??? layer.3?? 0.014288058? 0.1608000
>??? layer.4?? 0.022087920? 6.6349133
>??? layer.5?? 0.030797357 -1.2429506
>??? layer.6?? 0.038451072? 1.5643374
>??? layer.7?? 0.048087904 -2.2659035
>??? layer.8?? 0.058677729? 2.2070045
>??? layer.9?? 0.069261406 -2.3677001
>??? layer.10? 0.080524530 -1.0913506
>??? layer.11? 0.092760246? 0.4099940
>??? layer.12? 0.103789609 -0.1259727
>??? layer.13? 0.116953168 -2.4138253
>??? layer.14? 0.129253298? 7.0890257
>??? layer.15? 0.141710050 -0.7593539
>??? layer.16? 0.156002052? 0.0454416
>??? layer.17? 0.170648172 -1.5349683
>??? layer.18? 0.185318425? 6.5524201
>??? layer.19? 0.199463055 -0.8312563
>??? layer.20? 0.213513337 -2.5099183
>??? layer.21? 0.228839271? 0.1365968
>??? layer.22? 0.246981293 -1.3719845
>??? layer.23? 0.263012767 -0.8712988
>??? layer.24? 0.278505564? 0.6632584
>??? layer.25? 0.293658361? 0.7938036
>??? layer.26? 0.310747266? 3.4880637
>??? layer.27? 0.325990349 -4.4612208
>??? layer.28? 0.342517540? 0.0871734
>??? layer.29? 0.362751633 -1.4171578
>??? layer.30? 0.380199537 -0.9956508
>??? layer.31? 0.394992948? 0.3215526
>??? layer.32? 0.414373398? 3.1403866
>??? layer.33? 0.430690214 -0.7376099
>??? layer.34? 0.449738145 -2.4860541
>??? layer.35? 0.470167458 -3.4235858
>??? layer.36? 0.489019871? 0.4824748
>??? layer.37? 0.507242471 -0.9785386
>??? layer.38? 0.524314284? 8.5359684
>??? layer.39? 0.543750525? 5.4844742
>??? layer.40? 0.564234197? 3.2149367
>??? layer.41? 0.583679616? 3.9168916 
>??? layer.42? 0.601459444? 4.4907020
>??? layer.43? 0.619924664? 6.5410410
>??? layer.44? 0.639932007? 4.8068650
>??? layer.45? 0.661347181? 8.1510170
>??? layer.46? 0.684117317? 0.2697413
>??? layer.47? 0.704829752 -0.1807501
>??? layer.48? 0.725045770? 9.7181249
>??? layer.49? 0.745165825? 1.5406466
>??? layer.50? 0.765016139 -1.6476041
>??? layer.51? 0.783461511? 4.8024603
>??? layer.52? 0.806382924? 4.0421516
>??? layer.53? 0.829241335? 9.3756512
>??? layer.54? 0.849924415? 5.3305050
>??? layer.55? 0.871352434? 7.5445803
>??? layer.56? 0.893632233? 6.4679547
>??? layer.57? 0.916052133? 2.8096065
>??? layer.58? 0.938579470? 5.3921661
>??? layer.59? 0.959907651? 7.2043689
>??? layer.60? 0.981643587? 3.3350806
>??? layer.61? 1.004116774? 8.8690707
>??? layer.62? 1.028363466? 1.7861299
>??? layer.63? 1.054009140? 6.2555038
>??? layer.64? 1.072440803? 7.6079236
>??? layer.65? 1.094457805? 7.6871483
>??? layer.66? 1.123176277? 4.7787764
>??? layer.67? 1.149430871 12.7110502
>??? layer.68? 1.170912921 -0.7156284
>??? layer.69? 1.196743071? 1.6490899
>??? layer.70? 1.218625903? 3.0363024
>??? layer.71? 1.241868377? 4.2974769
>??? layer.72? 1.267941594? 1.9543778
>??? layer.73? 1.290708780? 3.9986964
>??? layer.74? 1.313222289? 4.5179472
>??? layer.75? 1.339045882? 0.9337905
>??? layer.76? 1.362803459? 3.3050770
>??? layer.77? 1.384450197? 3.5422970
>??? layer.78? 1.409720302? 5.9973660
>??? layer.79? 1.435851157? 0.5081869
>??? layer.80? 1.455592215? 7.9661630
>??? layer.81? 1.479495347? 9.9460496
>??? layer.82? 1.506051958? 3.7908372
>??? layer.83? 1.525728464? 2.5735847
>??? layer.84? 1.549362063 10.1404974
>??? layer.85? 1.573440671 13.7408304
>??? layer.86? 1.600278735? 0.9335771
>??? layer.87? 1.623879492? 9.7588742
>??? layer.88? 1.650029302? 1.2769395
>??? layer.89? 1.672362328 13.4970906
>??? layer.90? 1.700221121 10.2087502
>??? layer.91? 1.724793375? 1.6811275
>??? layer.92? 1.751070559? 6.1178992
>??? layer.93? 1.778022110 -0.1567626
>??? layer.94? 1.803022087? 3.8237479
>??? layer.95? 1.830668867? 4.4331468
>??? layer.96? 1.855736911? 5.9790707
>??? layer.97? 1.882615030 11.3104333
>??? layer.98? 1.909218490? 8.2142607
>??? layer.99? 1.938130021 15.3209674
>??? layer.100 1.963727593? 5.8178217
>??? layer.101 1.993271947? 9.6004907
>??? layer.102 2.022548139? 3.4063646
>??? layer.103 2.050679922? 4.7375010
>??? layer.104 2.078064442? 3.0133019
>??? layer.105 2.104113460? 5.5659522
>??? layer.106 2.133597612 12.0346333
>??? layer.107 2.164026260 -0.4028320
>??? layer.108 2.194852829 10.5996780
>??? layer.109 2.224257946? 5.4479584
>??? layer.110 2.252194643? 4.7052374
>??? layer.111 2.277335048 14.0962019
>??? layer.112 2.304058313? 5.7149016
>??? layer.113 2.330930233? 3.7780072
>??? layer.114 2.357022762? 4.4120620
>??? layer.115 2.386489272? 4.1866085
>??? layer.116 2.417503953? 6.9078802
>??? layer.117 2.448524356? 2.7825739
>??? layer.118 2.478698969? 7.6171786
>??? layer.119 2.510175705 10.2410603
>??? layer.120 2.539697886? 8.1820711
>??? layer.121 2.567915559? 4.8275494
>??? layer.122 2.597463250 19.1624883
>??? layer.123 2.627518773 16.0677109
>??? layer.124 2.658759236 12.5897081
>??? layer.125 2.692401528? 9.2907988
>??? layer.126 2.721903205? 7.4262502
>??? layer.127 2.753021359? 9.3902518
>??? layer.128 2.786313415 12.6193550
>??? layer.129 2.819564104 11.1121040
>??? layer.130 2.850823164 15.7907100
>??? layer.131 2.880394101 10.7425287
>??? layer.132 2.911391258? 7.7971430
>??? layer.133 2.942965150? 8.8060858
>??? layer.134 2.974468350 17.5606266
>??? layer.135 3.008983612 17.3088605
>??? layer.136 3.040015221 13.4500543
>??? layer.137 3.072668672 14.6377884
>??? layer.138 3.105982423? 8.0798552dput(onepctCO2MEDIAN)???
>dput(onepctCO2MEDIAN)
>??? structure(list(x = c(0, 0.00679444684647024, 0.014288058038801, 
>??? 0.0220879195258021,
>0.0307973567396402,0.0384510718286037,0.0480879042297602, 
>??? 0.0586777292191982, 0.0692614056169987,
>0.080524530261755,0.0927602462470531, 
>??? 0.103789608925581, 0.116953168064356, 0.129253298044205,
>0.141710050404072, 
>??? 0.156002052128315, 0.170648172497749, 0.185318425297737,
>0.199463054537773, 
>??? 0.21351333707571, 0.22883927077055, 0.246981292963028,
>0.263012766838074, 
>??? 0.278505563735962, 0.29365836083889, 0.310747265815735,
>0.325990349054337, 
>??? 0.342517539858818, 0.362751632928848, 0.380199536681175,
>0.39499294757843, 
>??? 0.414373397827148, 0.430690214037895, 0.449738144874573,
>0.470167458057404, 
>??? 0.489019870758057, 0.507242470979691, 0.524314284324646,
>0.543750524520874, 
>??? 0.56423419713974, 0.583679616451263, 0.601459443569183,
>0.619924664497375, 
>??? 0.639932006597519, 0.661347180604935, 0.684117317199707,
>0.704829752445221, 
>??? 0.725045770406723, 0.745165824890137, 0.765016138553619,
>0.783461511135101, 
>??? 0.806382924318314, 0.829241335391998, 0.84992441534996,
>0.871352434158325, 
>??? 0.893632233142853, 0.916052132844925, 0.938579469919205,
>0.959907650947571, 
>??? 0.981643587350845, 1.00411677360535, 1.02836346626282,
>1.05400913953781, 
>??? 1.07244080305099, 1.09445780515671, 1.12317627668381,
>1.14943087100983, 
>??? 1.17091292142868, 1.19674307107925, 1.21862590312958,
>1.24186837673187, 
>??? 1.26794159412384, 1.2907087802887, 1.31322228908539,
>1.33904588222504, 
>??? 1.36280345916748, 1.38445019721985, 1.40972030162811,
>1.43585115671158, 
>??? 1.45559221506119, 1.47949534654617, 1.50605195760727,
>1.52572846412659, 
>??? 1.5493620634079, 1.5734406709671, 1.60027873516083,
>1.62387949228287, 
>??? 1.65002930164337, 1.67236232757568, 1.70022112131119,
>1.72479337453842, 
>??? 1.75107055902481, 1.77802211046219, 1.80302208662033,
>1.83066886663437, 
>??? 1.85573691129684, 1.88261502981186, 1.90921849012375,
>1.93813002109528, 
>??? 1.96372759342194, 1.99327194690704, 2.02254813909531,
>2.05067992210388, 
>??? 2.07806444168091, 2.1041134595871, 2.13359761238098,
>2.16402626037598, 
>??? 2.19485282897949, 2.2242579460144, 2.25219464302063,
>2.27733504772186, 
>??? 2.30405831336975, 2.33093023300171, 2.35702276229858,
>2.38648927211761, 
>??? 2.41750395298004, 2.44852435588837, 2.47869896888733,
>2.51017570495605, 
>??? 2.53969788551331, 2.567915558815, 2.59746325016022,
>2.62751877307892, 
>??? 2.65875923633575, 2.69240152835846, 2.72190320491791,
>2.75302135944366, 
>??? 2.78631341457367, 2.8195641040802, 2.85082316398621,
>2.88039410114288, 
>??? 2.91139125823975, 2.94296514987946, 2.97446835041046,
>3.00898361206055, 
>??? 3.04001522064209, 3.07266867160797, 3.10598242282867), y = c(0, 
>??? 4.90024901723162, 0.160799993152722, 6.63491326258641,
>-1.24295055804536, 
>??? 1.56433744259162, -2.26590352245208, 2.20700446463354,
>-2.36770012911069, 
>??? -1.09135061899174, 0.409993989292701, -0.125972681525582,
>-2.41382533818026, 
>??? 7.08902570153028, -0.759353880417294, 0.0454415959640926,
>-1.53496826259972, 
>??? 6.55242014096194, -0.831256280861552, -2.50991825629084,
>0.136596820654013, 
>??? -1.37198445498419, -0.871298832596736, 0.663258363762466,
>0.793803634291308, 
>??? 3.48806373666998, -4.46122081238949, 0.0871733966938564,
>-1.41715777257774, 
>??? -0.995650815648318, 0.32155262317503, 3.14038657369241,
>-0.737609879885404, 
>??? -2.48605406511292, -3.423585843908, 0.482474753780281,
>-0.978538630093809, 
>??? 8.53596837794201, 5.48447420320695, 3.21493665820644,
>3.91689160157513, 
>??? 4.49070195980797, 6.54104103157039, 4.80686500146557,
>8.15101701282067, 
>??? 0.26974132191657, -0.180750068063062, 9.71812491230244,
>1.54064657400204, 
>??? -1.64760408795688, 4.80246028991894, 4.04215159914344,
>9.37565121768513, 
>??? 5.33050496938428, 7.54458026088508, 6.46795470819342,
>2.80960651433971, 
>??? 5.39216613235986, 7.20436888038562, 3.3350806460997,
>8.86907069895943, 
>??? 1.78612988613659, 6.25550382050395, 7.60792364896564,
>7.68714830528144, 
>??? 4.77877638957615, 12.7110501777314, -0.715628443181046,
>1.64908991824022, 
>??? 3.03630240714679, 4.29747688442346, 1.95437780501881,
>3.99869636910933, 
>??? 4.51794724689848, 0.933790484492299, 3.30507700050003,
>3.5422970157433, 
>??? 5.99736597322524, 0.508186860060022, 7.96616300581067,
>9.94604963036295, 
>??? 3.79083717222623, 2.57358468532258, 10.1404974171776,
>13.7408303595752, 
>??? 0.933577123801399, 9.75887417074129, 1.27693947132921,
>13.4970905965787, 
>??? 10.2087501765735, 1.68112753028756, 6.1178991508927,
>-0.156762622680077, 
>??? 3.82374791691426, 4.43314678736265, 5.97907067167507,
>11.3104332518482, 
>??? 8.21426074201525, 15.320967360602, 5.81782169471483,
>9.6004907412354, 
>??? 3.40636455909704, 4.73750103921864, 3.0133019468806,
>5.56595224859066, 
>??? 12.0346332527215, -0.40283199827104, 10.5996779538754,
>5.44795836991128, 
>??? 4.70523736412729, 14.096201892183, 5.71490161813391,
>3.77800720810782, 
>??? 4.41206200639436, 4.18660847858423, 6.90788020044911,
>2.78257393345915, 
>??? 7.61717857379431, 10.2410602647684, 8.18207106836167,
>4.82754943871433, 
>??? 19.1624882857155, 16.0677109398509, 12.589708067017,
>9.29079879799404, 
>??? 7.42625019725314, 9.39025179806185, 12.6193550331438,
>11.1121039747257, 
>??? 15.7907099734986, 10.7425286789233, 7.79714300307344,
>8.80608578166101, 
>??? 17.5606266346039, 17.3088604929222, 13.4500543478523,
>14.6377884248645, 
>??? 8.07985518296064)), class = "data.frame", row.names = c("layer.1", 
>??? "layer.2", "layer.3", "layer.4", "layer.5", "layer.6", "layer.7", 
>??? "layer.8", "layer.9", "layer.10", "layer.11", "layer.12",
>"layer.13", 
>??? "layer.14", "layer.15", "layer.16", "layer.17", "layer.18",
>"layer.19", 
>??? "layer.20", "layer.21", "layer.22", "layer.23", "layer.24",
>"layer.25", 
>??? "layer.26", "layer.27", "layer.28", "layer.29", "layer.30",
>"layer.31", 
>??? "layer.32", "layer.33", "layer.34", "layer.35", "layer.36",
>"layer.37", 
>??? "layer.38", "layer.39", "layer.40", "layer.41", "layer.42",
>"layer.43", 
>??? "layer.44", "layer.45", "layer.46", "layer.47", "layer.48",
>"layer.49", 
>??? "layer.50", "layer.51", "layer.52", "layer.53", "layer.54",
>"layer.55", 
>??? "layer.56", "layer.57", "layer.58", "layer.59", "layer.60",
>"layer.61", 
>??? "layer.62", "layer.63", "layer.64", "layer.65", "layer.66",
>"layer.67", 
>??? "layer.68", "layer.69", "layer.70", "layer.71", "layer.72",
>"layer.73", 
>??? "layer.74", "layer.75", "layer.76", "layer.77", "layer.78",
>"layer.79", 
>??? "layer.80", "layer.81", "layer.82", "layer.83", "layer.84",
>"layer.85", 
>??? "layer.86", "layer.87", "layer.88", "layer.89", "layer.90",
>"layer.91", 
>??? "layer.92", "layer.93", "layer.94", "layer.95", "layer.96",
>"layer.97", 
>??? "layer.98", "layer.99", "layer.100", "layer.101", "layer.102", 
>??? "layer.103", "layer.104", "layer.105", "layer.106", "layer.107", 
>??? "layer.108", "layer.109", "layer.110", "layer.111", "layer.112", 
>??? "layer.113", "layer.114", "layer.115", "layer.116", "layer.117", 
>??? "layer.118", "layer.119", "layer.120", "layer.121", "layer.122", 
>??? "layer.123", "layer.124", "layer.125", "layer.126", "layer.127", 
>??? "layer.128", "layer.129", "layer.130", "layer.131", "layer.132", 
>??? "layer.133", "layer.134", "layer.135", "layer.136", "layer.137", 
>??? "layer.138"))
>I started with the following to generate the first regression line and
>scatter plot:??? lm<-ggplot(onepctCO2MEDIAN) +? 
>??? geom_jitter(aes(RCP1pctCO2cumulativeMedian[1:138], departurea),?? 
>??? colour="blue") + geom_smooth(aes(RCP1pctCO2cumulativeMedian[1:138],
>
>??? departurea), method=lm) 
>But I receive this error:? ??Warning message:
>??? Computation failed in `stat_smooth()`:
>??? 'what' must be a function or character string
>A blue scatter plot is successfully generated, but the problem is that
>the regression line does not appear, presumably related to the above
>warning.
>Is there a reason for this? I would appreciate any assistance!
>??? [[alternative HTML version deleted]]
>
>______________________________________________
>R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>https://stat.ethz.ch/mailman/listinfo/r-help
>PLEASE do read the posting guide
>http://www.R-project.org/posting-guide.html
>and provide commented, minimal, self-contained, reproducible code.

-- 
Sent from my phone. Please excuse my brevity.
	[[alternative HTML version deleted]]


From Roger@B|v@nd @end|ng |rom nhh@no  Wed Jun  5 17:06:41 2019
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Wed, 5 Jun 2019 17:06:41 +0200
Subject: [R-sig-Geo] Predict function for splm object
In-Reply-To: <CAGH4ugJtRd0RTi9YqyD1tSZo5ARUwjObk3BVs0N7cEH7W+zvoQ@mail.gmail.com>
References: <CAGH4ugJtRd0RTi9YqyD1tSZo5ARUwjObk3BVs0N7cEH7W+zvoQ@mail.gmail.com>
Message-ID: <alpine.LFD.2.21.1906051705120.23262@reclus.nhh.no>

On Wed, 5 Jun 2019, Justin Schon wrote:

> Hello all,
>
> I've seen that a lot of people ask about this, but I am interested in
> whether there may be any developments here. Is there a predict function
> that works for splm objects?
>
> Note that I am not referring to spLM objects, which often comes up for me
> when I google this question.
>
> I found a proposal to do this here:
> https://github.com/rstats-gsoc/gsoc2015/wiki/Predict-methods-for-spatial-econometrics
>
> Did that effort, or any other efforts, succeed?

Yes, spatialreg::predict.sarlm() implements cross-sectional predictions. 
Contributions are still needed for spatial panel and GMM models.

Roger

>
> Thank you for any insight that can be shared,
>
> Justin
>
>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en


From M|ch@e|@P@n@@c| @end|ng |rom ttu@edu  Wed Jun  5 18:57:31 2019
From: M|ch@e|@P@n@@c| @end|ng |rom ttu@edu (Panasci, Michael)
Date: Wed, 5 Jun 2019 16:57:31 +0000
Subject: [R-sig-Geo] rgdal warning
In-Reply-To: <CY4PR0601MB3716243D2DF70708BEBF3B6BFB140@CY4PR0601MB3716.namprd06.prod.outlook.com>
References: <CY4PR0601MB371693BD86B5D90C4B0A149AFB190@CY4PR0601MB3716.namprd06.prod.outlook.com>,
 <CY4PR0601MB3716243D2DF70708BEBF3B6BFB140@CY4PR0601MB3716.namprd06.prod.outlook.com>
Message-ID: <CY4PR0601MB3716B22F9E3285E628CE2D18FB160@CY4PR0601MB3716.namprd06.prod.outlook.com>


My question is in regards to the Implications of the "rgdal::checkCRSArgs:: no proj_defs.dat in PROJ.4 shared files" warning.
I recently solved this problem on a high-performance Linux cluster by redefining the PROJ_LIB path with:

export PROJ_LIB=/opt/ohpc/pub/libs/intel/proj/5.0.1/share/proj

I generated lots of data before finding this fix.  Despite receiving the warning message, does this actually lead to erroneous data?  All of my projection components were appropriately defined and the code seemed to have run fine (based on looking at the results).  Now that the issue is resolved and I no longer receive the warning, I'm wondering if I need to regenerate all the data from before realizing this fix.  I have not been able to find anything definitive on this message board regarding implications of that error.  Thoughts?

Michael

	[[alternative HTML version deleted]]


From j@chon7 @end|ng |rom gm@||@com  Wed Jun  5 19:11:28 2019
From: j@chon7 @end|ng |rom gm@||@com (Justin Schon)
Date: Wed, 5 Jun 2019 13:11:28 -0400
Subject: [R-sig-Geo] Predict function for splm object
In-Reply-To: <alpine.LFD.2.21.1906051705120.23262@reclus.nhh.no>
References: <CAGH4ugJtRd0RTi9YqyD1tSZo5ARUwjObk3BVs0N7cEH7W+zvoQ@mail.gmail.com>
 <alpine.LFD.2.21.1906051705120.23262@reclus.nhh.no>
Message-ID: <CAGH4ugL0DhOznotM8Wj9Q9KQP8A9z5KcMXLwnZspvqHQeV8XCw@mail.gmail.com>

Thank you for the confirmation!

On Wed, Jun 5, 2019 at 11:07 AM Roger Bivand <Roger.Bivand at nhh.no> wrote:

> On Wed, 5 Jun 2019, Justin Schon wrote:
>
> > Hello all,
> >
> > I've seen that a lot of people ask about this, but I am interested in
> > whether there may be any developments here. Is there a predict function
> > that works for splm objects?
> >
> > Note that I am not referring to spLM objects, which often comes up for me
> > when I google this question.
> >
> > I found a proposal to do this here:
> >
> https://github.com/rstats-gsoc/gsoc2015/wiki/Predict-methods-for-spatial-econometrics
> >
> > Did that effort, or any other efforts, succeed?
>
> Yes, spatialreg::predict.sarlm() implements cross-sectional predictions.
> Contributions are still needed for spatial panel and GMM models.
>
> Roger
>
> >
> > Thank you for any insight that can be shared,
> >
> > Justin
> >
> >
> >
>
> --
> Roger Bivand
> Department of Economics, Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
> https://orcid.org/0000-0003-2392-6140
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>


-- 
Justin Schon
Post-Doctoral Researcher on Environmental Change and Migration
MURI Migration Research Team <http://murimigration.org/>
University of Florida

	[[alternative HTML version deleted]]


From b|@|ev||@t @end|ng |rom gm@||@com  Wed Jun  5 19:26:28 2019
From: b|@|ev||@t @end|ng |rom gm@||@com (=?UTF-8?Q?Bede-Fazekas_=c3=81kos?=)
Date: Wed, 5 Jun 2019 19:26:28 +0200
Subject: [R-sig-Geo] 
 [R] Plotting more than one regression line in ggplot
In-Reply-To: <448346170.409006.1559747083753@mail.yahoo.com>
References: <1137207179.276713.1559744517039.ref@mail.yahoo.com>
 <1137207179.276713.1559744517039@mail.yahoo.com>
 <B7E91F7C-9D66-4016-8E2D-C6835DD0EF5B@dcn.davis.ca.us>
 <448346170.409006.1559747083753@mail.yahoo.com>
Message-ID: <c2781e9d-ae51-c279-9337-bdcf1afbec7b@gmail.com>

Hello,
this list is 'for discussing the development and use of R functions and 
packages for handling and analysis of spatial, and particularly 
geographical, data'. Please do not post question to r-sig-geo that are 
nothing to do with GIS.
Anyway, the ggplot() + geom_jitter() + geom_smooth() functions works 
perfectly on the data you sent (after changing the parameters of aes() 
to x and y) on my computer.
Best wishes,
?kos

2019.06.05. 17:04 keltez?ssel, rain1290--- via R-sig-Geo ?rta:
> Hi Jeff (and everyone),
>
> Thank you for your response and feedback. Yes, I know what you mean - it was a blind and quick choice to use "lm" as my object name. Unfortunately, changing the object name to something else does not eliminate that error/warning message. As a result, the same error/warning appears when running it. Oddly enough, the scatter plot is just fine - it's the regression line that struggles to appear. Could there be another reason for that?
> Thanks, again,
>
>
> -----Original Message-----
> From: Jeff Newmiller <jdnewmil at dcn.davis.ca.us>
> To: rain1290 <rain1290 at aim.com>; rain1290--- via R-help <r-help at r-project.org>; r-help <r-help at R-project.org>; r-sig-geo <r-sig-geo at r-project.org>
> Sent: Wed, Jun 5, 2019 10:49 am
> Subject: Re: [R] Plotting more than one regression line in ggplot
>
> Please read the Posting Guide... posting HTML on a plain text mailing list really interferes with clear communication.
>
> If you had spent even a small amount of time working with R tutorials then you would know that "lm" is the name of a very basic, very important R function. However, you are defining your own object called "lm" that is very different indeed than the usual "lm" function. I would guess that in a clean new R workspace where you had not already run your ggplot function and assigned the result to your own "lm" object then this code might run. However, once you have run it once and try to run it again, your "method" argument gives the wrong version of "lm" to geom_smooth and you confuse it.
>
> As the doctor said to the man pounding his own head against the wall, "If it hurts, don't do that." Avoid re-using important object names in R... some common names I see abused this way are df, data, c, t, T, and F. Your choice was unusual, but quite effective at illustrating the problem.
>
> On June 5, 2019 7:21:57 AM PDT, rain1290--- via R-help <r-help at r-project.org> wrote:
>> I am trying to plot, using ggplot, a series of scatter plots with
>> regression lines for several datasets. I started with the following
>> dataset, "onepectCO2MEDIAN". The data for this dataset is as follows:
>>  ??? onepctCO2MEDIAN
>>  ??????????????????? x????????? y
>>  ??? layer.1?? 0.000000000? 0.0000000
>>  ??? layer.2?? 0.006794447? 4.9002490
>>  ??? layer.3?? 0.014288058? 0.1608000
>>  ??? layer.4?? 0.022087920? 6.6349133
>>  ??? layer.5?? 0.030797357 -1.2429506
>>  ??? layer.6?? 0.038451072? 1.5643374
>>  ??? layer.7?? 0.048087904 -2.2659035
>>  ??? layer.8?? 0.058677729? 2.2070045
>>  ??? layer.9?? 0.069261406 -2.3677001
>>  ??? layer.10? 0.080524530 -1.0913506
>>  ??? layer.11? 0.092760246? 0.4099940
>>  ??? layer.12? 0.103789609 -0.1259727
>>  ??? layer.13? 0.116953168 -2.4138253
>>  ??? layer.14? 0.129253298? 7.0890257
>>  ??? layer.15? 0.141710050 -0.7593539
>>  ??? layer.16? 0.156002052? 0.0454416
>>  ??? layer.17? 0.170648172 -1.5349683
>>  ??? layer.18? 0.185318425? 6.5524201
>>  ??? layer.19? 0.199463055 -0.8312563
>>  ??? layer.20? 0.213513337 -2.5099183
>>  ??? layer.21? 0.228839271? 0.1365968
>>  ??? layer.22? 0.246981293 -1.3719845
>>  ??? layer.23? 0.263012767 -0.8712988
>>  ??? layer.24? 0.278505564? 0.6632584
>>  ??? layer.25? 0.293658361? 0.7938036
>>  ??? layer.26? 0.310747266? 3.4880637
>>  ??? layer.27? 0.325990349 -4.4612208
>>  ??? layer.28? 0.342517540? 0.0871734
>>  ??? layer.29? 0.362751633 -1.4171578
>>  ??? layer.30? 0.380199537 -0.9956508
>>  ??? layer.31? 0.394992948? 0.3215526
>>  ??? layer.32? 0.414373398? 3.1403866
>>  ??? layer.33? 0.430690214 -0.7376099
>>  ??? layer.34? 0.449738145 -2.4860541
>>  ??? layer.35? 0.470167458 -3.4235858
>>  ??? layer.36? 0.489019871? 0.4824748
>>  ??? layer.37? 0.507242471 -0.9785386
>>  ??? layer.38? 0.524314284? 8.5359684
>>  ??? layer.39? 0.543750525? 5.4844742
>>  ??? layer.40? 0.564234197? 3.2149367
>>  ??? layer.41? 0.583679616? 3.9168916
>>  ??? layer.42? 0.601459444? 4.4907020
>>  ??? layer.43? 0.619924664? 6.5410410
>>  ??? layer.44? 0.639932007? 4.8068650
>>  ??? layer.45? 0.661347181? 8.1510170
>>  ??? layer.46? 0.684117317? 0.2697413
>>  ??? layer.47? 0.704829752 -0.1807501
>>  ??? layer.48? 0.725045770? 9.7181249
>>  ??? layer.49? 0.745165825? 1.5406466
>>  ??? layer.50? 0.765016139 -1.6476041
>>  ??? layer.51? 0.783461511? 4.8024603
>>  ??? layer.52? 0.806382924? 4.0421516
>>  ??? layer.53? 0.829241335? 9.3756512
>>  ??? layer.54? 0.849924415? 5.3305050
>>  ??? layer.55? 0.871352434? 7.5445803
>>  ??? layer.56? 0.893632233? 6.4679547
>>  ??? layer.57? 0.916052133? 2.8096065
>>  ??? layer.58? 0.938579470? 5.3921661
>>  ??? layer.59? 0.959907651? 7.2043689
>>  ??? layer.60? 0.981643587? 3.3350806
>>  ??? layer.61? 1.004116774? 8.8690707
>>  ??? layer.62? 1.028363466? 1.7861299
>>  ??? layer.63? 1.054009140? 6.2555038
>>  ??? layer.64? 1.072440803? 7.6079236
>>  ??? layer.65? 1.094457805? 7.6871483
>>  ??? layer.66? 1.123176277? 4.7787764
>>  ??? layer.67? 1.149430871 12.7110502
>>  ??? layer.68? 1.170912921 -0.7156284
>>  ??? layer.69? 1.196743071? 1.6490899
>>  ??? layer.70? 1.218625903? 3.0363024
>>  ??? layer.71? 1.241868377? 4.2974769
>>  ??? layer.72? 1.267941594? 1.9543778
>>  ??? layer.73? 1.290708780? 3.9986964
>>  ??? layer.74? 1.313222289? 4.5179472
>>  ??? layer.75? 1.339045882? 0.9337905
>>  ??? layer.76? 1.362803459? 3.3050770
>>  ??? layer.77? 1.384450197? 3.5422970
>>  ??? layer.78? 1.409720302? 5.9973660
>>  ??? layer.79? 1.435851157? 0.5081869
>>  ??? layer.80? 1.455592215? 7.9661630
>>  ??? layer.81? 1.479495347? 9.9460496
>>  ??? layer.82? 1.506051958? 3.7908372
>>  ??? layer.83? 1.525728464? 2.5735847
>>  ??? layer.84? 1.549362063 10.1404974
>>  ??? layer.85? 1.573440671 13.7408304
>>  ??? layer.86? 1.600278735? 0.9335771
>>  ??? layer.87? 1.623879492? 9.7588742
>>  ??? layer.88? 1.650029302? 1.2769395
>>  ??? layer.89? 1.672362328 13.4970906
>>  ??? layer.90? 1.700221121 10.2087502
>>  ??? layer.91? 1.724793375? 1.6811275
>>  ??? layer.92? 1.751070559? 6.1178992
>>  ??? layer.93? 1.778022110 -0.1567626
>>  ??? layer.94? 1.803022087? 3.8237479
>>  ??? layer.95? 1.830668867? 4.4331468
>>  ??? layer.96? 1.855736911? 5.9790707
>>  ??? layer.97? 1.882615030 11.3104333
>>  ??? layer.98? 1.909218490? 8.2142607
>>  ??? layer.99? 1.938130021 15.3209674
>>  ??? layer.100 1.963727593? 5.8178217
>>  ??? layer.101 1.993271947? 9.6004907
>>  ??? layer.102 2.022548139? 3.4063646
>>  ??? layer.103 2.050679922? 4.7375010
>>  ??? layer.104 2.078064442? 3.0133019
>>  ??? layer.105 2.104113460? 5.5659522
>>  ??? layer.106 2.133597612 12.0346333
>>  ??? layer.107 2.164026260 -0.4028320
>>  ??? layer.108 2.194852829 10.5996780
>>  ??? layer.109 2.224257946? 5.4479584
>>  ??? layer.110 2.252194643? 4.7052374
>>  ??? layer.111 2.277335048 14.0962019
>>  ??? layer.112 2.304058313? 5.7149016
>>  ??? layer.113 2.330930233? 3.7780072
>>  ??? layer.114 2.357022762? 4.4120620
>>  ??? layer.115 2.386489272? 4.1866085
>>  ??? layer.116 2.417503953? 6.9078802
>>  ??? layer.117 2.448524356? 2.7825739
>>  ??? layer.118 2.478698969? 7.6171786
>>  ??? layer.119 2.510175705 10.2410603
>>  ??? layer.120 2.539697886? 8.1820711
>>  ??? layer.121 2.567915559? 4.8275494
>>  ??? layer.122 2.597463250 19.1624883
>>  ??? layer.123 2.627518773 16.0677109
>>  ??? layer.124 2.658759236 12.5897081
>>  ??? layer.125 2.692401528? 9.2907988
>>  ??? layer.126 2.721903205? 7.4262502
>>  ??? layer.127 2.753021359? 9.3902518
>>  ??? layer.128 2.786313415 12.6193550
>>  ??? layer.129 2.819564104 11.1121040
>>  ??? layer.130 2.850823164 15.7907100
>>  ??? layer.131 2.880394101 10.7425287
>>  ??? layer.132 2.911391258? 7.7971430
>>  ??? layer.133 2.942965150? 8.8060858
>>  ??? layer.134 2.974468350 17.5606266
>>  ??? layer.135 3.008983612 17.3088605
>>  ??? layer.136 3.040015221 13.4500543
>>  ??? layer.137 3.072668672 14.6377884
>>  ??? layer.138 3.105982423? 8.0798552dput(onepctCO2MEDIAN)
>> dput(onepctCO2MEDIAN)
>>  ??? structure(list(x = c(0, 0.00679444684647024, 0.014288058038801,
>>  ??? 0.0220879195258021,
>> 0.0307973567396402,0.0384510718286037,0.0480879042297602,
>>  ??? 0.0586777292191982, 0.0692614056169987,
>> 0.080524530261755,0.0927602462470531,
>>  ??? 0.103789608925581, 0.116953168064356, 0.129253298044205,
>> 0.141710050404072,
>>  ??? 0.156002052128315, 0.170648172497749, 0.185318425297737,
>> 0.199463054537773,
>>  ??? 0.21351333707571, 0.22883927077055, 0.246981292963028,
>> 0.263012766838074,
>>  ??? 0.278505563735962, 0.29365836083889, 0.310747265815735,
>> 0.325990349054337,
>>  ??? 0.342517539858818, 0.362751632928848, 0.380199536681175,
>> 0.39499294757843,
>>  ??? 0.414373397827148, 0.430690214037895, 0.449738144874573,
>> 0.470167458057404,
>>  ??? 0.489019870758057, 0.507242470979691, 0.524314284324646,
>> 0.543750524520874,
>>  ??? 0.56423419713974, 0.583679616451263, 0.601459443569183,
>> 0.619924664497375,
>>  ??? 0.639932006597519, 0.661347180604935, 0.684117317199707,
>> 0.704829752445221,
>>  ??? 0.725045770406723, 0.745165824890137, 0.765016138553619,
>> 0.783461511135101,
>>  ??? 0.806382924318314, 0.829241335391998, 0.84992441534996,
>> 0.871352434158325,
>>  ??? 0.893632233142853, 0.916052132844925, 0.938579469919205,
>> 0.959907650947571,
>>  ??? 0.981643587350845, 1.00411677360535, 1.02836346626282,
>> 1.05400913953781,
>>  ??? 1.07244080305099, 1.09445780515671, 1.12317627668381,
>> 1.14943087100983,
>>  ??? 1.17091292142868, 1.19674307107925, 1.21862590312958,
>> 1.24186837673187,
>>  ??? 1.26794159412384, 1.2907087802887, 1.31322228908539,
>> 1.33904588222504,
>>  ??? 1.36280345916748, 1.38445019721985, 1.40972030162811,
>> 1.43585115671158,
>>  ??? 1.45559221506119, 1.47949534654617, 1.50605195760727,
>> 1.52572846412659,
>>  ??? 1.5493620634079, 1.5734406709671, 1.60027873516083,
>> 1.62387949228287,
>>  ??? 1.65002930164337, 1.67236232757568, 1.70022112131119,
>> 1.72479337453842,
>>  ??? 1.75107055902481, 1.77802211046219, 1.80302208662033,
>> 1.83066886663437,
>>  ??? 1.85573691129684, 1.88261502981186, 1.90921849012375,
>> 1.93813002109528,
>>  ??? 1.96372759342194, 1.99327194690704, 2.02254813909531,
>> 2.05067992210388,
>>  ??? 2.07806444168091, 2.1041134595871, 2.13359761238098,
>> 2.16402626037598,
>>  ??? 2.19485282897949, 2.2242579460144, 2.25219464302063,
>> 2.27733504772186,
>>  ??? 2.30405831336975, 2.33093023300171, 2.35702276229858,
>> 2.38648927211761,
>>  ??? 2.41750395298004, 2.44852435588837, 2.47869896888733,
>> 2.51017570495605,
>>  ??? 2.53969788551331, 2.567915558815, 2.59746325016022,
>> 2.62751877307892,
>>  ??? 2.65875923633575, 2.69240152835846, 2.72190320491791,
>> 2.75302135944366,
>>  ??? 2.78631341457367, 2.8195641040802, 2.85082316398621,
>> 2.88039410114288,
>>  ??? 2.91139125823975, 2.94296514987946, 2.97446835041046,
>> 3.00898361206055,
>>  ??? 3.04001522064209, 3.07266867160797, 3.10598242282867), y = c(0,
>>  ??? 4.90024901723162, 0.160799993152722, 6.63491326258641,
>> -1.24295055804536,
>>  ??? 1.56433744259162, -2.26590352245208, 2.20700446463354,
>> -2.36770012911069,
>>  ??? -1.09135061899174, 0.409993989292701, -0.125972681525582,
>> -2.41382533818026,
>>  ??? 7.08902570153028, -0.759353880417294, 0.0454415959640926,
>> -1.53496826259972,
>>  ??? 6.55242014096194, -0.831256280861552, -2.50991825629084,
>> 0.136596820654013,
>>  ??? -1.37198445498419, -0.871298832596736, 0.663258363762466,
>> 0.793803634291308,
>>  ??? 3.48806373666998, -4.46122081238949, 0.0871733966938564,
>> -1.41715777257774,
>>  ??? -0.995650815648318, 0.32155262317503, 3.14038657369241,
>> -0.737609879885404,
>>  ??? -2.48605406511292, -3.423585843908, 0.482474753780281,
>> -0.978538630093809,
>>  ??? 8.53596837794201, 5.48447420320695, 3.21493665820644,
>> 3.91689160157513,
>>  ??? 4.49070195980797, 6.54104103157039, 4.80686500146557,
>> 8.15101701282067,
>>  ??? 0.26974132191657, -0.180750068063062, 9.71812491230244,
>> 1.54064657400204,
>>  ??? -1.64760408795688, 4.80246028991894, 4.04215159914344,
>> 9.37565121768513,
>>  ??? 5.33050496938428, 7.54458026088508, 6.46795470819342,
>> 2.80960651433971,
>>  ??? 5.39216613235986, 7.20436888038562, 3.3350806460997,
>> 8.86907069895943,
>>  ??? 1.78612988613659, 6.25550382050395, 7.60792364896564,
>> 7.68714830528144,
>>  ??? 4.77877638957615, 12.7110501777314, -0.715628443181046,
>> 1.64908991824022,
>>  ??? 3.03630240714679, 4.29747688442346, 1.95437780501881,
>> 3.99869636910933,
>>  ??? 4.51794724689848, 0.933790484492299, 3.30507700050003,
>> 3.5422970157433,
>>  ??? 5.99736597322524, 0.508186860060022, 7.96616300581067,
>> 9.94604963036295,
>>  ??? 3.79083717222623, 2.57358468532258, 10.1404974171776,
>> 13.7408303595752,
>>  ??? 0.933577123801399, 9.75887417074129, 1.27693947132921,
>> 13.4970905965787,
>>  ??? 10.2087501765735, 1.68112753028756, 6.1178991508927,
>> -0.156762622680077,
>>  ??? 3.82374791691426, 4.43314678736265, 5.97907067167507,
>> 11.3104332518482,
>>  ??? 8.21426074201525, 15.320967360602, 5.81782169471483,
>> 9.6004907412354,
>>  ??? 3.40636455909704, 4.73750103921864, 3.0133019468806,
>> 5.56595224859066,
>>  ??? 12.0346332527215, -0.40283199827104, 10.5996779538754,
>> 5.44795836991128,
>>  ??? 4.70523736412729, 14.096201892183, 5.71490161813391,
>> 3.77800720810782,
>>  ??? 4.41206200639436, 4.18660847858423, 6.90788020044911,
>> 2.78257393345915,
>>  ??? 7.61717857379431, 10.2410602647684, 8.18207106836167,
>> 4.82754943871433,
>>  ??? 19.1624882857155, 16.0677109398509, 12.589708067017,
>> 9.29079879799404,
>>  ??? 7.42625019725314, 9.39025179806185, 12.6193550331438,
>> 11.1121039747257,
>>  ??? 15.7907099734986, 10.7425286789233, 7.79714300307344,
>> 8.80608578166101,
>>  ??? 17.5606266346039, 17.3088604929222, 13.4500543478523,
>> 14.6377884248645,
>>  ??? 8.07985518296064)), class = "data.frame", row.names = c("layer.1",
>>  ??? "layer.2", "layer.3", "layer.4", "layer.5", "layer.6", "layer.7",
>>  ??? "layer.8", "layer.9", "layer.10", "layer.11", "layer.12",
>> "layer.13",
>>  ??? "layer.14", "layer.15", "layer.16", "layer.17", "layer.18",
>> "layer.19",
>>  ??? "layer.20", "layer.21", "layer.22", "layer.23", "layer.24",
>> "layer.25",
>>  ??? "layer.26", "layer.27", "layer.28", "layer.29", "layer.30",
>> "layer.31",
>>  ??? "layer.32", "layer.33", "layer.34", "layer.35", "layer.36",
>> "layer.37",
>>  ??? "layer.38", "layer.39", "layer.40", "layer.41", "layer.42",
>> "layer.43",
>>  ??? "layer.44", "layer.45", "layer.46", "layer.47", "layer.48",
>> "layer.49",
>>  ??? "layer.50", "layer.51", "layer.52", "layer.53", "layer.54",
>> "layer.55",
>>  ??? "layer.56", "layer.57", "layer.58", "layer.59", "layer.60",
>> "layer.61",
>>  ??? "layer.62", "layer.63", "layer.64", "layer.65", "layer.66",
>> "layer.67",
>>  ??? "layer.68", "layer.69", "layer.70", "layer.71", "layer.72",
>> "layer.73",
>>  ??? "layer.74", "layer.75", "layer.76", "layer.77", "layer.78",
>> "layer.79",
>>  ??? "layer.80", "layer.81", "layer.82", "layer.83", "layer.84",
>> "layer.85",
>>  ??? "layer.86", "layer.87", "layer.88", "layer.89", "layer.90",
>> "layer.91",
>>  ??? "layer.92", "layer.93", "layer.94", "layer.95", "layer.96",
>> "layer.97",
>>  ??? "layer.98", "layer.99", "layer.100", "layer.101", "layer.102",
>>  ??? "layer.103", "layer.104", "layer.105", "layer.106", "layer.107",
>>  ??? "layer.108", "layer.109", "layer.110", "layer.111", "layer.112",
>>  ??? "layer.113", "layer.114", "layer.115", "layer.116", "layer.117",
>>  ??? "layer.118", "layer.119", "layer.120", "layer.121", "layer.122",
>>  ??? "layer.123", "layer.124", "layer.125", "layer.126", "layer.127",
>>  ??? "layer.128", "layer.129", "layer.130", "layer.131", "layer.132",
>>  ??? "layer.133", "layer.134", "layer.135", "layer.136", "layer.137",
>>  ??? "layer.138"))
>> I started with the following to generate the first regression line and
>> scatter plot:??? lm<-ggplot(onepctCO2MEDIAN) +
>>  ??? geom_jitter(aes(RCP1pctCO2cumulativeMedian[1:138], departurea),
>>  ??? colour="blue") + geom_smooth(aes(RCP1pctCO2cumulativeMedian[1:138],
>>
>>  ??? departurea), method=lm)
>> But I receive this error:? ??Warning message:
>>  ??? Computation failed in `stat_smooth()`:
>>  ??? 'what' must be a function or character string
>> A blue scatter plot is successfully generated, but the problem is that
>> the regression line does not appear, presumably related to the above
>> warning.
>> Is there a reason for this? I would appreciate any assistance!
>>  ??? [[alternative HTML version deleted]]
>>
>> ______________________________________________
>> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>> https://stat.ethz.ch/mailman/listinfo/r-help
>> PLEASE do read the posting guide
>> http://www.R-project.org/posting-guide.html
>> and provide commented, minimal, self-contained, reproducible code.


From r@i@1290 m@iii@g oii @im@com  Wed Jun  5 23:37:13 2019
From: r@i@1290 m@iii@g oii @im@com (r@i@1290 m@iii@g oii @im@com)
Date: Wed, 5 Jun 2019 21:37:13 +0000 (UTC)
Subject: [R-sig-Geo] 
 [R] Plotting more than one regression line in ggplot
In-Reply-To: <f4750422-3f43-a0a2-0d8f-63b0b0008ee1@sapo.pt>
References: <1137207179.276713.1559744517039.ref@mail.yahoo.com>
 <1137207179.276713.1559744517039@mail.yahoo.com>
 <f4750422-3f43-a0a2-0d8f-63b0b0008ee1@sapo.pt>
Message-ID: <85074591.632264.1559770633796@mail.yahoo.com>

Hi Rui (and everyone),

Thank you so much for your response! Much appreciated!
What if I wanted I create several regression lines and scatter plots in the same ggplot using a "melted" dataset? I would like to create a scatter plot and regression line for both the objects of "onepctCO2MEDIAN" and "RCP8.5MEDIANThis melted dataset looks like this:

>NewestdataUltra
 x variable       value              L1
1   0.000000000        y  0.00000000 onepctCO2MEDIAN
2   0.006794447        y  4.90024902 onepctCO2MEDIAN
3   0.014288058        y  0.16079999 onepctCO2MEDIAN
4   0.022087920        y  6.63491326 onepctCO2MEDIAN
5   0.030797357        y -1.24295056 onepctCO2MEDIAN
6   0.038451072        y  1.56433744 onepctCO2MEDIAN
7   0.048087904        y -2.26590352 onepctCO2MEDIAN
8   0.058677729        y  2.20700446 onepctCO2MEDIAN
9   0.069261406        y -2.36770013 onepctCO2MEDIAN
10  0.080524530        y -1.09135062 onepctCO2MEDIAN
11  0.092760246        y  0.40999399 onepctCO2MEDIAN
12  0.103789609        y -0.12597268 onepctCO2MEDIAN
13  0.116953168        y -2.41382534 onepctCO2MEDIAN
14  0.129253298        y  7.08902570 onepctCO2MEDIAN
15  0.141710050        y -0.75935388 onepctCO2MEDIAN
16  0.156002052        y  0.04544160 onepctCO2MEDIAN
17  0.170648172        y -1.53496826 onepctCO2MEDIAN
18  0.185318425        y  6.55242014 onepctCO2MEDIAN
19  0.199463055        y -0.83125628 onepctCO2MEDIAN
20  0.213513337        y -2.50991826 onepctCO2MEDIAN
21  0.228839271        y  0.13659682 onepctCO2MEDIAN
22  0.246981293        y -1.37198445 onepctCO2MEDIAN
23  0.263012767        y -0.87129883 onepctCO2MEDIAN
24  0.278505564        y  0.66325836 onepctCO2MEDIAN
25  0.293658361        y  0.79380363 onepctCO2MEDIAN
26  0.310747266        y  3.48806374 onepctCO2MEDIAN
27  0.325990349        y -4.46122081 onepctCO2MEDIAN
28  0.342517540        y  0.08717340 onepctCO2MEDIAN
29  0.362751633        y -1.41715777 onepctCO2MEDIAN
30  0.380199537        y -0.99565082 onepctCO2MEDIAN
31  0.394992948        y  0.32155262 onepctCO2MEDIAN
32  0.414373398        y  3.14038657 onepctCO2MEDIAN
33  0.430690214        y -0.73760988 onepctCO2MEDIAN
34  0.449738145        y -2.48605407 onepctCO2MEDIAN
35  0.470167458        y -3.42358584 onepctCO2MEDIAN
36  0.489019871        y  0.48247475 onepctCO2MEDIAN
37  0.507242471        y -0.97853863 onepctCO2MEDIAN
38  0.524314284        y  8.53596838 onepctCO2MEDIAN
39  0.543750525        y  5.48447420 onepctCO2MEDIAN
40  0.564234197        y  3.21493666 onepctCO2MEDIAN
41  0.583679616        y  3.91689160 onepctCO2MEDIAN
42  0.601459444        y  4.49070196 onepctCO2MEDIAN
43  0.619924664        y  6.54104103 onepctCO2MEDIAN
44  0.639932007        y  4.80686500 onepctCO2MEDIAN
45  0.661347181        y  8.15101701 onepctCO2MEDIAN
46  0.684117317        y  0.26974132 onepctCO2MEDIAN
47  0.704829752        y -0.18075007 onepctCO2MEDIAN
48  0.725045770        y  9.71812491 onepctCO2MEDIAN
49  0.745165825        y  1.54064657 onepctCO2MEDIAN
50  0.765016139        y -1.64760409 onepctCO2MEDIAN
51  0.783461511        y  4.80246029 onepctCO2MEDIAN
52  0.806382924        y  4.04215160 onepctCO2MEDIAN
53  0.829241335        y  9.37565122 onepctCO2MEDIAN
54  0.849924415        y  5.33050497 onepctCO2MEDIAN
55  0.871352434        y  7.54458026 onepctCO2MEDIAN
56  0.893632233        y  6.46795471 onepctCO2MEDIAN
57  0.916052133        y  2.80960651 onepctCO2MEDIAN
58  0.938579470        y  5.39216613 onepctCO2MEDIAN
59  0.959907651        y  7.20436888 onepctCO2MEDIAN
60  0.981643587        y  3.33508065 onepctCO2MEDIAN
61  1.004116774        y  8.86907070 onepctCO2MEDIAN
62  1.028363466        y  1.78612989 onepctCO2MEDIAN
63  1.054009140        y  6.25550382 onepctCO2MEDIAN
64  1.072440803        y  7.60792365 onepctCO2MEDIAN
65  1.094457805        y  7.68714831 onepctCO2MEDIAN
66  1.123176277        y  4.77877639 onepctCO2MEDIAN
67  1.149430871        y 12.71105018 onepctCO2MEDIAN
68  1.170912921        y -0.71562844 onepctCO2MEDIAN
69  1.196743071        y  1.64908992 onepctCO2MEDIAN
70  1.218625903        y  3.03630241 onepctCO2MEDIAN
71  1.241868377        y  4.29747688 onepctCO2MEDIAN
72  1.267941594        y  1.95437781 onepctCO2MEDIAN
73  1.290708780        y  3.99869637 onepctCO2MEDIAN
74  1.313222289        y  4.51794725 onepctCO2MEDIAN
75  1.339045882        y  0.93379048 onepctCO2MEDIAN
76  1.362803459        y  3.30507700 onepctCO2MEDIAN
77  1.384450197        y  3.54229702 onepctCO2MEDIAN
78  1.409720302        y  5.99736597 onepctCO2MEDIAN
79  1.435851157        y  0.50818686 onepctCO2MEDIAN
80  1.455592215        y  7.96616301 onepctCO2MEDIAN
81  1.479495347        y  9.94604963 onepctCO2MEDIAN
82  1.506051958        y  3.79083717 onepctCO2MEDIAN
83  1.525728464        y  2.57358469 onepctCO2MEDIAN
84  1.549362063        y 10.14049742 onepctCO2MEDIAN
85  1.573440671        y 13.74083036 onepctCO2MEDIAN
86  1.600278735        y  0.93357712 onepctCO2MEDIAN
87  1.623879492        y  9.75887417 onepctCO2MEDIAN
88  1.650029302        y  1.27693947 onepctCO2MEDIAN
89  1.672362328        y 13.49709060 onepctCO2MEDIAN
90  1.700221121        y 10.20875018 onepctCO2MEDIAN
91  1.724793375        y  1.68112753 onepctCO2MEDIAN
92  1.751070559        y  6.11789915 onepctCO2MEDIAN
93  1.778022110        y -0.15676262 onepctCO2MEDIAN
94  1.803022087        y  3.82374792 onepctCO2MEDIAN
95  1.830668867        y  4.43314679 onepctCO2MEDIAN
96  1.855736911        y  5.97907067 onepctCO2MEDIAN
97  1.882615030        y 11.31043325 onepctCO2MEDIAN
98  1.909218490        y  8.21426074 onepctCO2MEDIAN
99  1.938130021        y 15.32096736 onepctCO2MEDIAN
100 1.963727593        y  5.81782169 onepctCO2MEDIAN
101 1.993271947        y  9.60049074 onepctCO2MEDIAN
102 2.022548139        y  3.40636456 onepctCO2MEDIAN
103 2.050679922        y  4.73750104 onepctCO2MEDIAN
104 2.078064442        y  3.01330195 onepctCO2MEDIAN
105 2.104113460        y  5.56595225 onepctCO2MEDIAN
106 2.133597612        y 12.03463325 onepctCO2MEDIAN
107 2.164026260        y -0.40283200 onepctCO2MEDIAN
108 2.194852829        y 10.59967795 onepctCO2MEDIAN
109 2.224257946        y  5.44795837 onepctCO2MEDIAN
110 2.252194643        y  4.70523736 onepctCO2MEDIAN
111 2.277335048        y 14.09620189 onepctCO2MEDIAN
112 2.304058313        y  5.71490162 onepctCO2MEDIAN
113 2.330930233        y  3.77800721 onepctCO2MEDIAN
114 2.357022762        y  4.41206201 onepctCO2MEDIAN
115 2.386489272        y  4.18660848 onepctCO2MEDIAN
116 2.417503953        y  6.90788020 onepctCO2MEDIAN
117 2.448524356        y  2.78257393 onepctCO2MEDIAN
118 2.478698969        y  7.61717857 onepctCO2MEDIAN
119 2.510175705        y 10.24106026 onepctCO2MEDIAN
120 2.539697886        y  8.18207107 onepctCO2MEDIAN
121 2.567915559        y  4.82754944 onepctCO2MEDIAN
122 2.597463250        y 19.16248829 onepctCO2MEDIAN
123 2.627518773        y 16.06771094 onepctCO2MEDIAN
124 2.658759236        y 12.58970807 onepctCO2MEDIAN
125 2.692401528        y  9.29079880 onepctCO2MEDIAN
126 2.721903205        y  7.42625020 onepctCO2MEDIAN
127 2.753021359        y  9.39025180 onepctCO2MEDIAN
128 2.786313415        y 12.61935503 onepctCO2MEDIAN
129 2.819564104        y 11.11210397 onepctCO2MEDIAN
130 2.850823164        y 15.79070997 onepctCO2MEDIAN
131 2.880394101        y 10.74252868 onepctCO2MEDIAN
132 2.911391258        y  7.79714300 onepctCO2MEDIAN
133 2.942965150        y  8.80608578 onepctCO2MEDIAN
134 2.974468350        y 17.56062663 onepctCO2MEDIAN
135 3.008983612        y 17.30886049 onepctCO2MEDIAN
136 3.040015221        y 13.45005435 onepctCO2MEDIAN
137 3.072668672        y 14.63778842 onepctCO2MEDIAN
138 3.105982423        y  8.07985518 onepctCO2MEDIAN
139 0.467429527        y -1.55704023    RCP4.5MEDIAN
140 0.478266196        y -3.19367515    RCP4.5MEDIAN
141 0.489205229        y -2.44452679    RCP4.5MEDIAN
142 0.500039143        y  0.87504367    RCP4.5MEDIAN
143 0.511021115        y -0.39185002    RCP4.5MEDIAN
144 0.519874968        y -4.18935168    RCP4.5MEDIAN
145 0.528508358        y -3.64179524    RCP4.5MEDIAN
146 0.537377594        y -2.58167128    RCP4.5MEDIAN
147 0.546194211        y  2.20583694    RCP4.5MEDIAN
148 0.554720591        y -8.57764597    RCP4.5MEDIAN
149 0.563289814        y  2.88442536    RCP4.5MEDIAN
150 0.572032790        y -3.90829882    RCP4.5MEDIAN
151 0.580939066        y -3.39269048    RCP4.5MEDIAN
152 0.590921065        y -4.60849867    RCP4.5MEDIAN
153 0.601575326        y -1.62572657    RCP4.5MEDIAN
154 0.612425555        y  1.14198465    RCP4.5MEDIAN
155 0.623773319        y -3.38454122    RCP4.5MEDIAN
156 0.635363359        y  2.43414265    RCP4.5MEDIAN
157 0.646722666        y  3.30007615    RCP4.5MEDIAN
158 0.658285673        y -0.79555442    RCP4.5MEDIAN
159 0.670250852        y -2.05220500    RCP4.5MEDIAN
160 0.681702690        y -5.56808946    RCP4.5MEDIAN
161 0.693531145        y  2.24168605    RCP4.5MEDIAN
162 0.706016061        y -4.83673351    RCP4.5MEDIAN
163 0.718231249        y  0.40086819    RCP4.5MEDIAN
164 0.730190911        y -1.98026992    RCP4.5MEDIAN
165 0.741269845        y  0.39963115    RCP4.5MEDIAN
166 0.751000321        y -0.83241777    RCP4.5MEDIAN
167 0.760886972        y -1.66101404    RCP4.5MEDIAN
168 0.771137164        y -1.05452982    RCP4.5MEDIAN
169 0.781856383        y -1.18338156    RCP4.5MEDIAN
170 0.792607542        y  0.22722653    RCP4.5MEDIAN
171 0.803724128        y -1.90642564    RCP4.5MEDIAN
172 0.815066246        y  0.75010550    RCP4.5MEDIAN
173 0.826027437        y -1.31108646    RCP4.5MEDIAN
174 0.836766732        y  1.05961515    RCP4.5MEDIAN
175 0.847553312        y -2.06588010    RCP4.5MEDIAN
176 0.858331452        y  8.53403315    RCP4.5MEDIAN
177 0.869154422        y  0.09979751    RCP4.5MEDIAN
178 0.879572539        y -2.50854353    RCP4.5MEDIAN
179 0.889426601        y  5.29550783    RCP4.5MEDIAN
180 0.899009805        y  2.02909481    RCP4.5MEDIAN
181 0.908289566        y  2.66922982    RCP4.5MEDIAN
182 0.917284978        y -4.17757196    RCP4.5MEDIAN
183 0.926128960        y  3.40202916    RCP4.5MEDIAN
184 0.934752874        y -1.92292218    RCP4.5MEDIAN
185 0.943010943        y  6.36969150    RCP4.5MEDIAN
186 0.950999217        y  1.86490308    RCP4.5MEDIAN
187 0.958795701        y  8.32126161    RCP4.5MEDIAN
188 0.966310396        y 10.15048356    RCP4.5MEDIAN
189 0.973635493        y  6.68925964    RCP4.5MEDIAN
190 0.980834088        y -1.01615369    RCP4.5MEDIAN
191 0.987694790        y  0.20892853    RCP4.5MEDIAN
192 0.994548581        y -1.52787222    RCP4.5MEDIAN
193 1.001274595        y -0.72374597    RCP4.5MEDIAN
194 1.007810612        y  2.26062309    RCP4.5MEDIAN
195 1.014270389        y -2.40270340    RCP4.5MEDIAN
196 1.022719711        y -1.94548262    RCP4.5MEDIAN
197 1.032070810        y -1.13053235    RCP4.5MEDIAN
198 1.041118812        y  0.56107969    RCP4.5MEDIAN
199 1.050189571        y  3.27941835    RCP4.5MEDIAN
200 1.059380475        y  3.01333588    RCP4.5MEDIAN
201 1.067877585        y  4.87457336    RCP4.5MEDIAN
202 1.076078766        y  1.02457895    RCP4.5MEDIAN
203 1.084707357        y  4.49174869    RCP4.5MEDIAN
204 1.093223180        y  8.24629303    RCP4.5MEDIAN
205 1.101414382        y -0.03364132    RCP4.5MEDIAN
206 1.108886304        y  9.12509848    RCP4.5MEDIAN
207 1.115482896        y  1.74254621    RCP4.5MEDIAN
208 1.121856558        y  2.27004536    RCP4.5MEDIAN
209 1.127809421        y -0.65627179    RCP4.5MEDIAN
210 1.133265961        y 12.02566969    RCP4.5MEDIAN
211 1.138549712        y -1.04260843    RCP4.5MEDIAN
212 1.143910237        y -6.47611327    RCP4.5MEDIAN
213 1.149437787        y  8.88410567    RCP4.5MEDIAN
214 1.154488347        y -4.24916247    RCP4.5MEDIAN
215 1.159872903        y  7.90741918    RCP4.5MEDIAN
216 1.165477487        y -3.91386711    RCP4.5MEDIAN
217 1.171103424        y  1.02370701    RCP4.5MEDIAN
218 1.177498256        y -3.71206616    RCP4.5MEDIAN
219 1.184003888        y -1.05694182    RCP4.5MEDIAN
220 1.190395856        y  1.10501459    RCP4.5MEDIAN
221 1.197284280        y  2.67668639    RCP4.5MEDIAN
222 1.204590551        y  2.21693031    RCP4.5MEDIAN
223 1.210807614        y  2.90252830    RCP4.5MEDIAN
224 1.216470664        y  2.75093766    RCP4.5MEDIAN
225 1.221914148        y -0.73815245    RCP4.5MEDIAN
226 1.227580480        y  3.58554626    RCP4.5MEDIAN
227 1.233317788        y 10.89961658    RCP4.5MEDIAN
228 1.238093406        y  3.23374387    RCP4.5MEDIAN
229 0.466622908        y -1.92366466    RCP8.5MEDIAN
230 0.474211509        y  4.09292949    RCP8.5MEDIAN
231 0.480383051        y -0.84736312    RCP8.5MEDIAN
232 0.486304903        y -0.80597889    RCP8.5MEDIAN
233 0.492151615        y -0.50244413    RCP8.5MEDIAN
234 0.499312643        y  3.07785701    RCP8.5MEDIAN
235 0.508859905        y -6.15175322    RCP8.5MEDIAN
236 0.518758845        y -0.51590144    RCP8.5MEDIAN
237 0.528675758        y  3.33135956    RCP8.5MEDIAN
238 0.538928423        y  2.62280891    RCP8.5MEDIAN
239 0.549621221        y -6.90096009    RCP8.5MEDIAN
240 0.560062840        y -3.45706029    RCP8.5MEDIAN
241 0.570860791        y  1.36192518    RCP8.5MEDIAN
242 0.581923368        y  0.34822359    RCP8.5MEDIAN
243 0.592628298        y  3.06882935    RCP8.5MEDIAN
244 0.604230648        y -3.56142825    RCP8.5MEDIAN
245 0.615975167        y 10.35932554    RCP8.5MEDIAN
246 0.627448279        y 10.21751629    RCP8.5MEDIAN
247 0.639401050        y  3.31040335    RCP8.5MEDIAN
248 0.651949591        y -0.53558775    RCP8.5MEDIAN
249 0.664634427        y  2.66081860    RCP8.5MEDIAN
250 0.677343552        y  3.21379656    RCP8.5MEDIAN

Maybe something like this?

lusher<-ggplot(NewestdataULTRA) + geom_jitter(aes(x,value,onepctCO2MEDIAN=L1), colour="green") + geom_smooth(aes(x, value, onepctCO2MEDIAN=L1), method=lm) + geom_jitter(aes(x, value, RCP8.5MEDIAN=L1), colour="red")

I receive this warning, however:
Warning: Ignoring unknown aesthetics: onepctCO2MEDIAN
Warning: Ignoring unknown aesthetics: onepctCO2MEDIAN
Perhaps I am not assigning the columns properly? Essentially, I just want create two scatter plots and two regression lines for these two objects.?
Once again, any assistance would be greatly appreciated!
-----Original Message-----
From: Rui Barradas <ruipbarradas at sapo.pt>
To: rain1290 <rain1290 at aim.com>; r-help <r-help at R-project.org>; r-sig-geo <r-sig-geo at r-project.org>
Sent: Wed, Jun 5, 2019 10:52 am
Subject: Re: [R] Plotting more than one regression line in ggplot

Hello,

This is pretty basic ggplot.


lm1 <- ggplot(onepctCO2MEDIAN, aes(x, y)) +
? geom_point(colour = 'blue') +
? geom_smooth(method = 'lm')

lm1


If you want to combine several datasets, you will have to have a 
variable telling which dataset is which. In the example below, this is 
column 'id'.


onepctCO2MEDIAN2 <- onepctCO2MEDIAN
onepctCO2MEDIAN2$y <- jitter(onepctCO2MEDIAN2$y) + 2
onepctCO2MEDIAN$id <- 1
onepctCO2MEDIAN2$id <- 2
df2 <- rbind(onepctCO2MEDIAN, onepctCO2MEDIAN2)

ggplot(df2, aes(x, y, group = id, colour = factor(id))) +
? geom_point() +
? geom_smooth(method = 'lm')


Hope this helps,

Rui Barradas

?s 15:21 de 05/06/19, rain1290--- via R-help escreveu:
> I am trying to plot, using ggplot, a series of scatter plots with regression lines for several datasets. I started with the following dataset, "onepectCO2MEDIAN". The data for this dataset is as follows:
>? ??? onepctCO2MEDIAN
>? ??????????????????? x????????? y
>? ??? layer.1?? 0.000000000? 0.0000000
>? ??? layer.2?? 0.006794447? 4.9002490
>? ??? layer.3?? 0.014288058? 0.1608000
>? ??? layer.4?? 0.022087920? 6.6349133
>? ??? layer.5?? 0.030797357 -1.2429506
>? ??? layer.6?? 0.038451072? 1.5643374
>? ??? layer.7?? 0.048087904 -2.2659035
>? ??? layer.8?? 0.058677729? 2.2070045
>? ??? layer.9?? 0.069261406 -2.3677001
>? ??? layer.10? 0.080524530 -1.0913506
>? ??? layer.11? 0.092760246? 0.4099940
>? ??? layer.12? 0.103789609 -0.1259727
>? ??? layer.13? 0.116953168 -2.4138253
>? ??? layer.14? 0.129253298? 7.0890257
>? ??? layer.15? 0.141710050 -0.7593539
>? ??? layer.16? 0.156002052? 0.0454416
>? ??? layer.17? 0.170648172 -1.5349683
>? ??? layer.18? 0.185318425? 6.5524201
>? ??? layer.19? 0.199463055 -0.8312563
>? ??? layer.20? 0.213513337 -2.5099183
>? ??? layer.21? 0.228839271? 0.1365968
>? ??? layer.22? 0.246981293 -1.3719845
>? ??? layer.23? 0.263012767 -0.8712988
>? ??? layer.24? 0.278505564? 0.6632584
>? ??? layer.25? 0.293658361? 0.7938036
>? ??? layer.26? 0.310747266? 3.4880637
>? ??? layer.27? 0.325990349 -4.4612208
>? ??? layer.28? 0.342517540? 0.0871734
>? ??? layer.29? 0.362751633 -1.4171578
>? ??? layer.30? 0.380199537 -0.9956508
>? ??? layer.31? 0.394992948? 0.3215526
>? ??? layer.32? 0.414373398? 3.1403866
>? ??? layer.33? 0.430690214 -0.7376099
>? ??? layer.34? 0.449738145 -2.4860541
>? ??? layer.35? 0.470167458 -3.4235858
>? ??? layer.36? 0.489019871? 0.4824748
>? ??? layer.37? 0.507242471 -0.9785386
>? ??? layer.38? 0.524314284? 8.5359684
>? ??? layer.39? 0.543750525? 5.4844742
>? ??? layer.40? 0.564234197? 3.2149367
>? ??? layer.41? 0.583679616? 3.9168916
>? ??? layer.42? 0.601459444? 4.4907020
>? ??? layer.43? 0.619924664? 6.5410410
>? ??? layer.44? 0.639932007? 4.8068650
>? ??? layer.45? 0.661347181? 8.1510170
>? ??? layer.46? 0.684117317? 0.2697413
>? ??? layer.47? 0.704829752 -0.1807501
>? ??? layer.48? 0.725045770? 9.7181249
>? ??? layer.49? 0.745165825? 1.5406466
>? ??? layer.50? 0.765016139 -1.6476041
>? ??? layer.51? 0.783461511? 4.8024603
>? ??? layer.52? 0.806382924? 4.0421516
>? ??? layer.53? 0.829241335? 9.3756512
>? ??? layer.54? 0.849924415? 5.3305050
>? ??? layer.55? 0.871352434? 7.5445803
>? ??? layer.56? 0.893632233? 6.4679547
>? ??? layer.57? 0.916052133? 2.8096065
>? ??? layer.58? 0.938579470? 5.3921661
>? ??? layer.59? 0.959907651? 7.2043689
>? ??? layer.60? 0.981643587? 3.3350806
>? ??? layer.61? 1.004116774? 8.8690707
>? ??? layer.62? 1.028363466? 1.7861299
>? ??? layer.63? 1.054009140? 6.2555038
>? ??? layer.64? 1.072440803? 7.6079236
>? ??? layer.65? 1.094457805? 7.6871483
>? ??? layer.66? 1.123176277? 4.7787764
>? ??? layer.67? 1.149430871 12.7110502
>? ??? layer.68? 1.170912921 -0.7156284
>? ??? layer.69? 1.196743071? 1.6490899
>? ??? layer.70? 1.218625903? 3.0363024
>? ??? layer.71? 1.241868377? 4.2974769
>? ??? layer.72? 1.267941594? 1.9543778
>? ??? layer.73? 1.290708780? 3.9986964
>? ??? layer.74? 1.313222289? 4.5179472
>? ??? layer.75? 1.339045882? 0.9337905
>? ??? layer.76? 1.362803459? 3.3050770
>? ??? layer.77? 1.384450197? 3.5422970
>? ??? layer.78? 1.409720302? 5.9973660
>? ??? layer.79? 1.435851157? 0.5081869
>? ??? layer.80? 1.455592215? 7.9661630
>? ??? layer.81? 1.479495347? 9.9460496
>? ??? layer.82? 1.506051958? 3.7908372
>? ??? layer.83? 1.525728464? 2.5735847
>? ??? layer.84? 1.549362063 10.1404974
>? ??? layer.85? 1.573440671 13.7408304
>? ??? layer.86? 1.600278735? 0.9335771
>? ??? layer.87? 1.623879492? 9.7588742
>? ??? layer.88? 1.650029302? 1.2769395
>? ??? layer.89? 1.672362328 13.4970906
>? ??? layer.90? 1.700221121 10.2087502
>? ??? layer.91? 1.724793375? 1.6811275
>? ??? layer.92? 1.751070559? 6.1178992
>? ??? layer.93? 1.778022110 -0.1567626
>? ??? layer.94? 1.803022087? 3.8237479
>? ??? layer.95? 1.830668867? 4.4331468
>? ??? layer.96? 1.855736911? 5.9790707
>? ??? layer.97? 1.882615030 11.3104333
>? ??? layer.98? 1.909218490? 8.2142607
>? ??? layer.99? 1.938130021 15.3209674
>? ??? layer.100 1.963727593? 5.8178217
>? ??? layer.101 1.993271947? 9.6004907
>? ??? layer.102 2.022548139? 3.4063646
>? ??? layer.103 2.050679922? 4.7375010
>? ??? layer.104 2.078064442? 3.0133019
>? ??? layer.105 2.104113460? 5.5659522
>? ??? layer.106 2.133597612 12.0346333
>? ??? layer.107 2.164026260 -0.4028320
>? ??? layer.108 2.194852829 10.5996780
>? ??? layer.109 2.224257946? 5.4479584
>? ??? layer.110 2.252194643? 4.7052374
>? ??? layer.111 2.277335048 14.0962019
>? ??? layer.112 2.304058313? 5.7149016
>? ??? layer.113 2.330930233? 3.7780072
>? ??? layer.114 2.357022762? 4.4120620
>? ??? layer.115 2.386489272? 4.1866085
>? ??? layer.116 2.417503953? 6.9078802
>? ??? layer.117 2.448524356? 2.7825739
>? ??? layer.118 2.478698969? 7.6171786
>? ??? layer.119 2.510175705 10.2410603
>? ??? layer.120 2.539697886? 8.1820711
>? ??? layer.121 2.567915559? 4.8275494
>? ??? layer.122 2.597463250 19.1624883
>? ??? layer.123 2.627518773 16.0677109
>? ??? layer.124 2.658759236 12.5897081
>? ??? layer.125 2.692401528? 9.2907988
>? ??? layer.126 2.721903205? 7.4262502
>? ??? layer.127 2.753021359? 9.3902518
>? ??? layer.128 2.786313415 12.6193550
>? ??? layer.129 2.819564104 11.1121040
>? ??? layer.130 2.850823164 15.7907100
>? ??? layer.131 2.880394101 10.7425287
>? ??? layer.132 2.911391258? 7.7971430
>? ??? layer.133 2.942965150? 8.8060858
>? ??? layer.134 2.974468350 17.5606266
>? ??? layer.135 3.008983612 17.3088605
>? ??? layer.136 3.040015221 13.4500543
>? ??? layer.137 3.072668672 14.6377884
>? ??? layer.138 3.105982423? 8.0798552dput(onepctCO2MEDIAN)??? dput(onepctCO2MEDIAN)
>? ??? structure(list(x = c(0, 0.00679444684647024, 0.014288058038801,
>? ??? 0.0220879195258021, 0.0307973567396402,0.0384510718286037,0.0480879042297602,
>? ??? 0.0586777292191982, 0.0692614056169987, 0.080524530261755,0.0927602462470531,
>? ??? 0.103789608925581, 0.116953168064356, 0.129253298044205, 0.141710050404072,
>? ??? 0.156002052128315, 0.170648172497749, 0.185318425297737, 0.199463054537773,
>? ??? 0.21351333707571, 0.22883927077055, 0.246981292963028, 0.263012766838074,
>? ??? 0.278505563735962, 0.29365836083889, 0.310747265815735, 0.325990349054337,
>? ??? 0.342517539858818, 0.362751632928848, 0.380199536681175, 0.39499294757843,
>? ??? 0.414373397827148, 0.430690214037895, 0.449738144874573, 0.470167458057404,
>? ??? 0.489019870758057, 0.507242470979691, 0.524314284324646, 0.543750524520874,
>? ??? 0.56423419713974, 0.583679616451263, 0.601459443569183, 0.619924664497375,
>? ??? 0.639932006597519, 0.661347180604935, 0.684117317199707, 0.704829752445221,
>? ??? 0.725045770406723, 0.745165824890137, 0.765016138553619, 0.783461511135101,
>? ??? 0.806382924318314, 0.829241335391998, 0.84992441534996, 0.871352434158325,
>? ??? 0.893632233142853, 0.916052132844925, 0.938579469919205, 0.959907650947571,
>? ??? 0.981643587350845, 1.00411677360535, 1.02836346626282, 1.05400913953781,
>? ??? 1.07244080305099, 1.09445780515671, 1.12317627668381, 1.14943087100983,
>? ??? 1.17091292142868, 1.19674307107925, 1.21862590312958, 1.24186837673187,
>? ??? 1.26794159412384, 1.2907087802887, 1.31322228908539, 1.33904588222504,
>? ??? 1.36280345916748, 1.38445019721985, 1.40972030162811, 1.43585115671158,
>? ??? 1.45559221506119, 1.47949534654617, 1.50605195760727, 1.52572846412659,
>? ??? 1.5493620634079, 1.5734406709671, 1.60027873516083, 1.62387949228287,
>? ??? 1.65002930164337, 1.67236232757568, 1.70022112131119, 1.72479337453842,
>? ??? 1.75107055902481, 1.77802211046219, 1.80302208662033, 1.83066886663437,
>? ??? 1.85573691129684, 1.88261502981186, 1.90921849012375, 1.93813002109528,
>? ??? 1.96372759342194, 1.99327194690704, 2.02254813909531, 2.05067992210388,
>? ??? 2.07806444168091, 2.1041134595871, 2.13359761238098, 2.16402626037598,
>? ??? 2.19485282897949, 2.2242579460144, 2.25219464302063, 2.27733504772186,
>? ??? 2.30405831336975, 2.33093023300171, 2.35702276229858, 2.38648927211761,
>? ??? 2.41750395298004, 2.44852435588837, 2.47869896888733, 2.51017570495605,
>? ??? 2.53969788551331, 2.567915558815, 2.59746325016022, 2.62751877307892,
>? ??? 2.65875923633575, 2.69240152835846, 2.72190320491791, 2.75302135944366,
>? ??? 2.78631341457367, 2.8195641040802, 2.85082316398621, 2.88039410114288,
>? ??? 2.91139125823975, 2.94296514987946, 2.97446835041046, 3.00898361206055,
>? ??? 3.04001522064209, 3.07266867160797, 3.10598242282867), y = c(0,
>? ??? 4.90024901723162, 0.160799993152722, 6.63491326258641, -1.24295055804536,
>? ??? 1.56433744259162, -2.26590352245208, 2.20700446463354, -2.36770012911069,
>? ??? -1.09135061899174, 0.409993989292701, -0.125972681525582, -2.41382533818026,
>? ??? 7.08902570153028, -0.759353880417294, 0.0454415959640926, -1.53496826259972,
>? ??? 6.55242014096194, -0.831256280861552, -2.50991825629084, 0.136596820654013,
>? ??? -1.37198445498419, -0.871298832596736, 0.663258363762466, 0.793803634291308,
>? ??? 3.48806373666998, -4.46122081238949, 0.0871733966938564, -1.41715777257774,
>? ??? -0.995650815648318, 0.32155262317503, 3.14038657369241, -0.737609879885404,
>? ??? -2.48605406511292, -3.423585843908, 0.482474753780281, -0.978538630093809,
>? ??? 8.53596837794201, 5.48447420320695, 3.21493665820644, 3.91689160157513,
>? ??? 4.49070195980797, 6.54104103157039, 4.80686500146557, 8.15101701282067,
>? ??? 0.26974132191657, -0.180750068063062, 9.71812491230244, 1.54064657400204,
>? ??? -1.64760408795688, 4.80246028991894, 4.04215159914344, 9.37565121768513,
>? ??? 5.33050496938428, 7.54458026088508, 6.46795470819342, 2.80960651433971,
>? ??? 5.39216613235986, 7.20436888038562, 3.3350806460997, 8.86907069895943,
>? ??? 1.78612988613659, 6.25550382050395, 7.60792364896564, 7.68714830528144,
>? ??? 4.77877638957615, 12.7110501777314, -0.715628443181046, 1.64908991824022,
>? ??? 3.03630240714679, 4.29747688442346, 1.95437780501881, 3.99869636910933,
>? ??? 4.51794724689848, 0.933790484492299, 3.30507700050003, 3.5422970157433,
>? ??? 5.99736597322524, 0.508186860060022, 7.96616300581067, 9.94604963036295,
>? ??? 3.79083717222623, 2.57358468532258, 10.1404974171776, 13.7408303595752,
>? ??? 0.933577123801399, 9.75887417074129, 1.27693947132921, 13.4970905965787,
>? ??? 10.2087501765735, 1.68112753028756, 6.1178991508927, -0.156762622680077,
>? ??? 3.82374791691426, 4.43314678736265, 5.97907067167507, 11.3104332518482,
>? ??? 8.21426074201525, 15.320967360602, 5.81782169471483, 9.6004907412354,
>? ??? 3.40636455909704, 4.73750103921864, 3.0133019468806, 5.56595224859066,
>? ??? 12.0346332527215, -0.40283199827104, 10.5996779538754, 5.44795836991128,
>? ??? 4.70523736412729, 14.096201892183, 5.71490161813391, 3.77800720810782,
>? ??? 4.41206200639436, 4.18660847858423, 6.90788020044911, 2.78257393345915,
>? ??? 7.61717857379431, 10.2410602647684, 8.18207106836167, 4.82754943871433,
>? ??? 19.1624882857155, 16.0677109398509, 12.589708067017, 9.29079879799404,
>? ??? 7.42625019725314, 9.39025179806185, 12.6193550331438, 11.1121039747257,
>? ??? 15.7907099734986, 10.7425286789233, 7.79714300307344, 8.80608578166101,
>? ??? 17.5606266346039, 17.3088604929222, 13.4500543478523, 14.6377884248645,
>? ??? 8.07985518296064)), class = "data.frame", row.names = c("layer.1",
>? ??? "layer.2", "layer.3", "layer.4", "layer.5", "layer.6", "layer.7",
>? ??? "layer.8", "layer.9", "layer.10", "layer.11", "layer.12", "layer.13",
>? ??? "layer.14", "layer.15", "layer.16", "layer.17", "layer.18", "layer.19",
>? ??? "layer.20", "layer.21", "layer.22", "layer.23", "layer.24", "layer.25",
>? ??? "layer.26", "layer.27", "layer.28", "layer.29", "layer.30", "layer.31",
>? ??? "layer.32", "layer.33", "layer.34", "layer.35", "layer.36", "layer.37",
>? ??? "layer.38", "layer.39", "layer.40", "layer.41", "layer.42", "layer.43",
>? ??? "layer.44", "layer.45", "layer.46", "layer.47", "layer.48", "layer.49",
>? ??? "layer.50", "layer.51", "layer.52", "layer.53", "layer.54", "layer.55",
>? ??? "layer.56", "layer.57", "layer.58", "layer.59", "layer.60", "layer.61",
>? ??? "layer.62", "layer.63", "layer.64", "layer.65", "layer.66", "layer.67",
>? ??? "layer.68", "layer.69", "layer.70", "layer.71", "layer.72", "layer.73",
>? ??? "layer.74", "layer.75", "layer.76", "layer.77", "layer.78", "layer.79",
>? ??? "layer.80", "layer.81", "layer.82", "layer.83", "layer.84", "layer.85",
>? ??? "layer.86", "layer.87", "layer.88", "layer.89", "layer.90", "layer.91",
>? ??? "layer.92", "layer.93", "layer.94", "layer.95", "layer.96", "layer.97",
>? ??? "layer.98", "layer.99", "layer.100", "layer.101", "layer.102",
>? ??? "layer.103", "layer.104", "layer.105", "layer.106", "layer.107",
>? ??? "layer.108", "layer.109", "layer.110", "layer.111", "layer.112",
>? ??? "layer.113", "layer.114", "layer.115", "layer.116", "layer.117",
>? ??? "layer.118", "layer.119", "layer.120", "layer.121", "layer.122",
>? ??? "layer.123", "layer.124", "layer.125", "layer.126", "layer.127",
>? ??? "layer.128", "layer.129", "layer.130", "layer.131", "layer.132",
>? ??? "layer.133", "layer.134", "layer.135", "layer.136", "layer.137",
>? ??? "layer.138"))
> I started with the following to generate the first regression line and scatter plot:??? lm<-ggplot(onepctCO2MEDIAN) +
>? ??? geom_jitter(aes(RCP1pctCO2cumulativeMedian[1:138], departurea),
>? ??? colour="blue") + geom_smooth(aes(RCP1pctCO2cumulativeMedian[1:138],
>? ??? departurea), method=lm)
> But I receive this error:? ??Warning message:
>? ??? Computation failed in `stat_smooth()`:
>? ??? 'what' must be a function or character string
> A blue scatter plot is successfully generated, but the problem is that the regression line does not appear, presumably related to the above warning.
> Is there a reason for this? I would appreciate any assistance!
> ??? [[alternative HTML version deleted]]
> 
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.
> 

	[[alternative HTML version deleted]]


From r@i@1290 m@iii@g oii @im@com  Thu Jun  6 17:02:12 2019
From: r@i@1290 m@iii@g oii @im@com (r@i@1290 m@iii@g oii @im@com)
Date: Thu, 6 Jun 2019 15:02:12 +0000 (UTC)
Subject: [R-sig-Geo] 
 [R] Plotting more than one regression line in ggplot
In-Reply-To: <c2781e9d-ae51-c279-9337-bdcf1afbec7b@gmail.com>
References: <1137207179.276713.1559744517039.ref@mail.yahoo.com>
 <1137207179.276713.1559744517039@mail.yahoo.com>
 <B7E91F7C-9D66-4016-8E2D-C6835DD0EF5B@dcn.davis.ca.us>
 <448346170.409006.1559747083753@mail.yahoo.com>
 <c2781e9d-ae51-c279-9337-bdcf1afbec7b@gmail.com>
Message-ID: <1155939096.995381.1559833332204@mail.yahoo.com>

Hi Akos, Jeff, and everyone,

Yes, I got this to work - as Jeff suggested, I simply started a new session, ran the same code, and it worked fine without that error!?
Thanks, again, for your feedback!

-----Original Message-----
From: Bede-Fazekas ?kos <bfalevlist at gmail.com>
To: r-sig-geo <r-sig-geo at r-project.org>
Sent: Wed, Jun 5, 2019 1:27 pm
Subject: Re: [R-sig-Geo] [R] Plotting more than one regression line in ggplot

Hello,
this list is 'for discussing the development and use of R functions and 
packages for handling and analysis of spatial, and particularly 
geographical, data'. Please do not post question to r-sig-geo that are 
nothing to do with GIS.
Anyway, the ggplot() + geom_jitter() + geom_smooth() functions works 
perfectly on the data you sent (after changing the parameters of aes() 
to x and y) on my computer.
Best wishes,
?kos

2019.06.05. 17:04 keltez?ssel, rain1290--- via R-sig-Geo ?rta:
> Hi Jeff (and everyone),
>
> Thank you for your response and feedback. Yes, I know what you mean - it was a blind and quick choice to use "lm" as my object name. Unfortunately, changing the object name to something else does not eliminate that error/warning message. As a result, the same error/warning appears when running it. Oddly enough, the scatter plot is just fine - it's the regression line that struggles to appear. Could there be another reason for that?
> Thanks, again,
>
>
> -----Original Message-----
> From: Jeff Newmiller <jdnewmil at dcn.davis.ca.us>
> To: rain1290 <rain1290 at aim.com>; rain1290--- via R-help <r-help at r-project.org>; r-help <r-help at R-project.org>; r-sig-geo <r-sig-geo at r-project.org>
> Sent: Wed, Jun 5, 2019 10:49 am
> Subject: Re: [R] Plotting more than one regression line in ggplot
>
> Please read the Posting Guide... posting HTML on a plain text mailing list really interferes with clear communication.
>
> If you had spent even a small amount of time working with R tutorials then you would know that "lm" is the name of a very basic, very important R function. However, you are defining your own object called "lm" that is very different indeed than the usual "lm" function. I would guess that in a clean new R workspace where you had not already run your ggplot function and assigned the result to your own "lm" object then this code might run. However, once you have run it once and try to run it again, your "method" argument gives the wrong version of "lm" to geom_smooth and you confuse it.
>
> As the doctor said to the man pounding his own head against the wall, "If it hurts, don't do that." Avoid re-using important object names in R... some common names I see abused this way are df, data, c, t, T, and F. Your choice was unusual, but quite effective at illustrating the problem.
>
> On June 5, 2019 7:21:57 AM PDT, rain1290--- via R-help <r-help at r-project.org> wrote:
>> I am trying to plot, using ggplot, a series of scatter plots with
>> regression lines for several datasets. I started with the following
>> dataset, "onepectCO2MEDIAN". The data for this dataset is as follows:
>>? ??? onepctCO2MEDIAN
>>? ??????????????????? x????????? y
>>? ??? layer.1?? 0.000000000? 0.0000000
>>? ??? layer.2?? 0.006794447? 4.9002490
>>? ??? layer.3?? 0.014288058? 0.1608000
>>? ??? layer.4?? 0.022087920? 6.6349133
>>? ??? layer.5?? 0.030797357 -1.2429506
>>? ??? layer.6?? 0.038451072? 1.5643374
>>? ??? layer.7?? 0.048087904 -2.2659035
>>? ??? layer.8?? 0.058677729? 2.2070045
>>? ??? layer.9?? 0.069261406 -2.3677001
>>? ??? layer.10? 0.080524530 -1.0913506
>>? ??? layer.11? 0.092760246? 0.4099940
>>? ??? layer.12? 0.103789609 -0.1259727
>>? ??? layer.13? 0.116953168 -2.4138253
>>? ??? layer.14? 0.129253298? 7.0890257
>>? ??? layer.15? 0.141710050 -0.7593539
>>? ??? layer.16? 0.156002052? 0.0454416
>>? ??? layer.17? 0.170648172 -1.5349683
>>? ??? layer.18? 0.185318425? 6.5524201
>>? ??? layer.19? 0.199463055 -0.8312563
>>? ??? layer.20? 0.213513337 -2.5099183
>>? ??? layer.21? 0.228839271? 0.1365968
>>? ??? layer.22? 0.246981293 -1.3719845
>>? ??? layer.23? 0.263012767 -0.8712988
>>? ??? layer.24? 0.278505564? 0.6632584
>>? ??? layer.25? 0.293658361? 0.7938036
>>? ??? layer.26? 0.310747266? 3.4880637
>>? ??? layer.27? 0.325990349 -4.4612208
>>? ??? layer.28? 0.342517540? 0.0871734
>>? ??? layer.29? 0.362751633 -1.4171578
>>? ??? layer.30? 0.380199537 -0.9956508
>>? ??? layer.31? 0.394992948? 0.3215526
>>? ??? layer.32? 0.414373398? 3.1403866
>>? ??? layer.33? 0.430690214 -0.7376099
>>? ??? layer.34? 0.449738145 -2.4860541
>>? ??? layer.35? 0.470167458 -3.4235858
>>? ??? layer.36? 0.489019871? 0.4824748
>>? ??? layer.37? 0.507242471 -0.9785386
>>? ??? layer.38? 0.524314284? 8.5359684
>>? ??? layer.39? 0.543750525? 5.4844742
>>? ??? layer.40? 0.564234197? 3.2149367
>>? ??? layer.41? 0.583679616? 3.9168916
>>? ??? layer.42? 0.601459444? 4.4907020
>>? ??? layer.43? 0.619924664? 6.5410410
>>? ??? layer.44? 0.639932007? 4.8068650
>>? ??? layer.45? 0.661347181? 8.1510170
>>? ??? layer.46? 0.684117317? 0.2697413
>>? ??? layer.47? 0.704829752 -0.1807501
>>? ??? layer.48? 0.725045770? 9.7181249
>>? ??? layer.49? 0.745165825? 1.5406466
>>? ??? layer.50? 0.765016139 -1.6476041
>>? ??? layer.51? 0.783461511? 4.8024603
>>? ??? layer.52? 0.806382924? 4.0421516
>>? ??? layer.53? 0.829241335? 9.3756512
>>? ??? layer.54? 0.849924415? 5.3305050
>>? ??? layer.55? 0.871352434? 7.5445803
>>? ??? layer.56? 0.893632233? 6.4679547
>>? ??? layer.57? 0.916052133? 2.8096065
>>? ??? layer.58? 0.938579470? 5.3921661
>>? ??? layer.59? 0.959907651? 7.2043689
>>? ??? layer.60? 0.981643587? 3.3350806
>>? ??? layer.61? 1.004116774? 8.8690707
>>? ??? layer.62? 1.028363466? 1.7861299
>>? ??? layer.63? 1.054009140? 6.2555038
>>? ??? layer.64? 1.072440803? 7.6079236
>>? ??? layer.65? 1.094457805? 7.6871483
>>? ??? layer.66? 1.123176277? 4.7787764
>>? ??? layer.67? 1.149430871 12.7110502
>>? ??? layer.68? 1.170912921 -0.7156284
>>? ??? layer.69? 1.196743071? 1.6490899
>>? ??? layer.70? 1.218625903? 3.0363024
>>? ??? layer.71? 1.241868377? 4.2974769
>>? ??? layer.72? 1.267941594? 1.9543778
>>? ??? layer.73? 1.290708780? 3.9986964
>>? ??? layer.74? 1.313222289? 4.5179472
>>? ??? layer.75? 1.339045882? 0.9337905
>>? ??? layer.76? 1.362803459? 3.3050770
>>? ??? layer.77? 1.384450197? 3.5422970
>>? ??? layer.78? 1.409720302? 5.9973660
>>? ??? layer.79? 1.435851157? 0.5081869
>>? ??? layer.80? 1.455592215? 7.9661630
>>? ??? layer.81? 1.479495347? 9.9460496
>>? ??? layer.82? 1.506051958? 3.7908372
>>? ??? layer.83? 1.525728464? 2.5735847
>>? ??? layer.84? 1.549362063 10.1404974
>>? ??? layer.85? 1.573440671 13.7408304
>>? ??? layer.86? 1.600278735? 0.9335771
>>? ??? layer.87? 1.623879492? 9.7588742
>>? ??? layer.88? 1.650029302? 1.2769395
>>? ??? layer.89? 1.672362328 13.4970906
>>? ??? layer.90? 1.700221121 10.2087502
>>? ??? layer.91? 1.724793375? 1.6811275
>>? ??? layer.92? 1.751070559? 6.1178992
>>? ??? layer.93? 1.778022110 -0.1567626
>>? ??? layer.94? 1.803022087? 3.8237479
>>? ??? layer.95? 1.830668867? 4.4331468
>>? ??? layer.96? 1.855736911? 5.9790707
>>? ??? layer.97? 1.882615030 11.3104333
>>? ??? layer.98? 1.909218490? 8.2142607
>>? ??? layer.99? 1.938130021 15.3209674
>>? ??? layer.100 1.963727593? 5.8178217
>>? ??? layer.101 1.993271947? 9.6004907
>>? ??? layer.102 2.022548139? 3.4063646
>>? ??? layer.103 2.050679922? 4.7375010
>>? ??? layer.104 2.078064442? 3.0133019
>>? ??? layer.105 2.104113460? 5.5659522
>>? ??? layer.106 2.133597612 12.0346333
>>? ??? layer.107 2.164026260 -0.4028320
>>? ??? layer.108 2.194852829 10.5996780
>>? ??? layer.109 2.224257946? 5.4479584
>>? ??? layer.110 2.252194643? 4.7052374
>>? ??? layer.111 2.277335048 14.0962019
>>? ??? layer.112 2.304058313? 5.7149016
>>? ??? layer.113 2.330930233? 3.7780072
>>? ??? layer.114 2.357022762? 4.4120620
>>? ??? layer.115 2.386489272? 4.1866085
>>? ??? layer.116 2.417503953? 6.9078802
>>? ??? layer.117 2.448524356? 2.7825739
>>? ??? layer.118 2.478698969? 7.6171786
>>? ??? layer.119 2.510175705 10.2410603
>>? ??? layer.120 2.539697886? 8.1820711
>>? ??? layer.121 2.567915559? 4.8275494
>>? ??? layer.122 2.597463250 19.1624883
>>? ??? layer.123 2.627518773 16.0677109
>>? ??? layer.124 2.658759236 12.5897081
>>? ??? layer.125 2.692401528? 9.2907988
>>? ??? layer.126 2.721903205? 7.4262502
>>? ??? layer.127 2.753021359? 9.3902518
>>? ??? layer.128 2.786313415 12.6193550
>>? ??? layer.129 2.819564104 11.1121040
>>? ??? layer.130 2.850823164 15.7907100
>>? ??? layer.131 2.880394101 10.7425287
>>? ??? layer.132 2.911391258? 7.7971430
>>? ??? layer.133 2.942965150? 8.8060858
>>? ??? layer.134 2.974468350 17.5606266
>>? ??? layer.135 3.008983612 17.3088605
>>? ??? layer.136 3.040015221 13.4500543
>>? ??? layer.137 3.072668672 14.6377884
>>? ??? layer.138 3.105982423? 8.0798552dput(onepctCO2MEDIAN)
>> dput(onepctCO2MEDIAN)
>>? ??? structure(list(x = c(0, 0.00679444684647024, 0.014288058038801,
>>? ??? 0.0220879195258021,
>> 0.0307973567396402,0.0384510718286037,0.0480879042297602,
>>? ??? 0.0586777292191982, 0.0692614056169987,
>> 0.080524530261755,0.0927602462470531,
>>? ??? 0.103789608925581, 0.116953168064356, 0.129253298044205,
>> 0.141710050404072,
>>? ??? 0.156002052128315, 0.170648172497749, 0.185318425297737,
>> 0.199463054537773,
>>? ??? 0.21351333707571, 0.22883927077055, 0.246981292963028,
>> 0.263012766838074,
>>? ??? 0.278505563735962, 0.29365836083889, 0.310747265815735,
>> 0.325990349054337,
>>? ??? 0.342517539858818, 0.362751632928848, 0.380199536681175,
>> 0.39499294757843,
>>? ??? 0.414373397827148, 0.430690214037895, 0.449738144874573,
>> 0.470167458057404,
>>? ??? 0.489019870758057, 0.507242470979691, 0.524314284324646,
>> 0.543750524520874,
>>? ??? 0.56423419713974, 0.583679616451263, 0.601459443569183,
>> 0.619924664497375,
>>? ??? 0.639932006597519, 0.661347180604935, 0.684117317199707,
>> 0.704829752445221,
>>? ??? 0.725045770406723, 0.745165824890137, 0.765016138553619,
>> 0.783461511135101,
>>? ??? 0.806382924318314, 0.829241335391998, 0.84992441534996,
>> 0.871352434158325,
>>? ??? 0.893632233142853, 0.916052132844925, 0.938579469919205,
>> 0.959907650947571,
>>? ??? 0.981643587350845, 1.00411677360535, 1.02836346626282,
>> 1.05400913953781,
>>? ??? 1.07244080305099, 1.09445780515671, 1.12317627668381,
>> 1.14943087100983,
>>? ??? 1.17091292142868, 1.19674307107925, 1.21862590312958,
>> 1.24186837673187,
>>? ??? 1.26794159412384, 1.2907087802887, 1.31322228908539,
>> 1.33904588222504,
>>? ??? 1.36280345916748, 1.38445019721985, 1.40972030162811,
>> 1.43585115671158,
>>? ??? 1.45559221506119, 1.47949534654617, 1.50605195760727,
>> 1.52572846412659,
>>? ??? 1.5493620634079, 1.5734406709671, 1.60027873516083,
>> 1.62387949228287,
>>? ??? 1.65002930164337, 1.67236232757568, 1.70022112131119,
>> 1.72479337453842,
>>? ??? 1.75107055902481, 1.77802211046219, 1.80302208662033,
>> 1.83066886663437,
>>? ??? 1.85573691129684, 1.88261502981186, 1.90921849012375,
>> 1.93813002109528,
>>? ??? 1.96372759342194, 1.99327194690704, 2.02254813909531,
>> 2.05067992210388,
>>? ??? 2.07806444168091, 2.1041134595871, 2.13359761238098,
>> 2.16402626037598,
>>? ??? 2.19485282897949, 2.2242579460144, 2.25219464302063,
>> 2.27733504772186,
>>? ??? 2.30405831336975, 2.33093023300171, 2.35702276229858,
>> 2.38648927211761,
>>? ??? 2.41750395298004, 2.44852435588837, 2.47869896888733,
>> 2.51017570495605,
>>? ??? 2.53969788551331, 2.567915558815, 2.59746325016022,
>> 2.62751877307892,
>>? ??? 2.65875923633575, 2.69240152835846, 2.72190320491791,
>> 2.75302135944366,
>>? ??? 2.78631341457367, 2.8195641040802, 2.85082316398621,
>> 2.88039410114288,
>>? ??? 2.91139125823975, 2.94296514987946, 2.97446835041046,
>> 3.00898361206055,
>>? ??? 3.04001522064209, 3.07266867160797, 3.10598242282867), y = c(0,
>>? ??? 4.90024901723162, 0.160799993152722, 6.63491326258641,
>> -1.24295055804536,
>>? ??? 1.56433744259162, -2.26590352245208, 2.20700446463354,
>> -2.36770012911069,
>>? ??? -1.09135061899174, 0.409993989292701, -0.125972681525582,
>> -2.41382533818026,
>>? ??? 7.08902570153028, -0.759353880417294, 0.0454415959640926,
>> -1.53496826259972,
>>? ??? 6.55242014096194, -0.831256280861552, -2.50991825629084,
>> 0.136596820654013,
>>? ??? -1.37198445498419, -0.871298832596736, 0.663258363762466,
>> 0.793803634291308,
>>? ??? 3.48806373666998, -4.46122081238949, 0.0871733966938564,
>> -1.41715777257774,
>>? ??? -0.995650815648318, 0.32155262317503, 3.14038657369241,
>> -0.737609879885404,
>>? ??? -2.48605406511292, -3.423585843908, 0.482474753780281,
>> -0.978538630093809,
>>? ??? 8.53596837794201, 5.48447420320695, 3.21493665820644,
>> 3.91689160157513,
>>? ??? 4.49070195980797, 6.54104103157039, 4.80686500146557,
>> 8.15101701282067,
>>? ??? 0.26974132191657, -0.180750068063062, 9.71812491230244,
>> 1.54064657400204,
>>? ??? -1.64760408795688, 4.80246028991894, 4.04215159914344,
>> 9.37565121768513,
>>? ??? 5.33050496938428, 7.54458026088508, 6.46795470819342,
>> 2.80960651433971,
>>? ??? 5.39216613235986, 7.20436888038562, 3.3350806460997,
>> 8.86907069895943,
>>? ??? 1.78612988613659, 6.25550382050395, 7.60792364896564,
>> 7.68714830528144,
>>? ??? 4.77877638957615, 12.7110501777314, -0.715628443181046,
>> 1.64908991824022,
>>? ??? 3.03630240714679, 4.29747688442346, 1.95437780501881,
>> 3.99869636910933,
>>? ??? 4.51794724689848, 0.933790484492299, 3.30507700050003,
>> 3.5422970157433,
>>? ??? 5.99736597322524, 0.508186860060022, 7.96616300581067,
>> 9.94604963036295,
>>? ??? 3.79083717222623, 2.57358468532258, 10.1404974171776,
>> 13.7408303595752,
>>? ??? 0.933577123801399, 9.75887417074129, 1.27693947132921,
>> 13.4970905965787,
>>? ??? 10.2087501765735, 1.68112753028756, 6.1178991508927,
>> -0.156762622680077,
>>? ??? 3.82374791691426, 4.43314678736265, 5.97907067167507,
>> 11.3104332518482,
>>? ??? 8.21426074201525, 15.320967360602, 5.81782169471483,
>> 9.6004907412354,
>>? ??? 3.40636455909704, 4.73750103921864, 3.0133019468806,
>> 5.56595224859066,
>>? ??? 12.0346332527215, -0.40283199827104, 10.5996779538754,
>> 5.44795836991128,
>>? ??? 4.70523736412729, 14.096201892183, 5.71490161813391,
>> 3.77800720810782,
>>? ??? 4.41206200639436, 4.18660847858423, 6.90788020044911,
>> 2.78257393345915,
>>? ??? 7.61717857379431, 10.2410602647684, 8.18207106836167,
>> 4.82754943871433,
>>? ??? 19.1624882857155, 16.0677109398509, 12.589708067017,
>> 9.29079879799404,
>>? ??? 7.42625019725314, 9.39025179806185, 12.6193550331438,
>> 11.1121039747257,
>>? ??? 15.7907099734986, 10.7425286789233, 7.79714300307344,
>> 8.80608578166101,
>>? ??? 17.5606266346039, 17.3088604929222, 13.4500543478523,
>> 14.6377884248645,
>>? ??? 8.07985518296064)), class = "data.frame", row.names = c("layer.1",
>>? ??? "layer.2", "layer.3", "layer.4", "layer.5", "layer.6", "layer.7",
>>? ??? "layer.8", "layer.9", "layer.10", "layer.11", "layer.12",
>> "layer.13",
>>? ??? "layer.14", "layer.15", "layer.16", "layer.17", "layer.18",
>> "layer.19",
>>? ??? "layer.20", "layer.21", "layer.22", "layer.23", "layer.24",
>> "layer.25",
>>? ??? "layer.26", "layer.27", "layer.28", "layer.29", "layer.30",
>> "layer.31",
>>? ??? "layer.32", "layer.33", "layer.34", "layer.35", "layer.36",
>> "layer.37",
>>? ??? "layer.38", "layer.39", "layer.40", "layer.41", "layer.42",
>> "layer.43",
>>? ??? "layer.44", "layer.45", "layer.46", "layer.47", "layer.48",
>> "layer.49",
>>? ??? "layer.50", "layer.51", "layer.52", "layer.53", "layer.54",
>> "layer.55",
>>? ??? "layer.56", "layer.57", "layer.58", "layer.59", "layer.60",
>> "layer.61",
>>? ??? "layer.62", "layer.63", "layer.64", "layer.65", "layer.66",
>> "layer.67",
>>? ??? "layer.68", "layer.69", "layer.70", "layer.71", "layer.72",
>> "layer.73",
>>? ??? "layer.74", "layer.75", "layer.76", "layer.77", "layer.78",
>> "layer.79",
>>? ??? "layer.80", "layer.81", "layer.82", "layer.83", "layer.84",
>> "layer.85",
>>? ??? "layer.86", "layer.87", "layer.88", "layer.89", "layer.90",
>> "layer.91",
>>? ??? "layer.92", "layer.93", "layer.94", "layer.95", "layer.96",
>> "layer.97",
>>? ??? "layer.98", "layer.99", "layer.100", "layer.101", "layer.102",
>>? ??? "layer.103", "layer.104", "layer.105", "layer.106", "layer.107",
>>? ??? "layer.108", "layer.109", "layer.110", "layer.111", "layer.112",
>>? ??? "layer.113", "layer.114", "layer.115", "layer.116", "layer.117",
>>? ??? "layer.118", "layer.119", "layer.120", "layer.121", "layer.122",
>>? ??? "layer.123", "layer.124", "layer.125", "layer.126", "layer.127",
>>? ??? "layer.128", "layer.129", "layer.130", "layer.131", "layer.132",
>>? ??? "layer.133", "layer.134", "layer.135", "layer.136", "layer.137",
>>? ??? "layer.138"))
>> I started with the following to generate the first regression line and
>> scatter plot:??? lm<-ggplot(onepctCO2MEDIAN) +
>>? ??? geom_jitter(aes(RCP1pctCO2cumulativeMedian[1:138], departurea),
>>? ??? colour="blue") + geom_smooth(aes(RCP1pctCO2cumulativeMedian[1:138],
>>
>>? ??? departurea), method=lm)
>> But I receive this error:? ??Warning message:
>>? ??? Computation failed in `stat_smooth()`:
>>? ??? 'what' must be a function or character string
>> A blue scatter plot is successfully generated, but the problem is that
>> the regression line does not appear, presumably related to the above
>> warning.
>> Is there a reason for this? I would appreciate any assistance!
>>? ??? [[alternative HTML version deleted]]
>>
>> ______________________________________________
>> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>> https://stat.ethz.ch/mailman/listinfo/r-help
>> PLEASE do read the posting guide
>> http://www.R-project.org/posting-guide.html
>> and provide commented, minimal, self-contained, reproducible code.

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo

	[[alternative HTML version deleted]]


From Roger@B|v@nd @end|ng |rom nhh@no  Fri Jun  7 11:10:10 2019
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Fri, 7 Jun 2019 11:10:10 +0200
Subject: [R-sig-Geo] rgdal warning
In-Reply-To: <CY4PR0601MB3716B22F9E3285E628CE2D18FB160@CY4PR0601MB3716.namprd06.prod.outlook.com>
References: <CY4PR0601MB371693BD86B5D90C4B0A149AFB190@CY4PR0601MB3716.namprd06.prod.outlook.com>,
 <CY4PR0601MB3716243D2DF70708BEBF3B6BFB140@CY4PR0601MB3716.namprd06.prod.outlook.com>
 <CY4PR0601MB3716B22F9E3285E628CE2D18FB160@CY4PR0601MB3716.namprd06.prod.outlook.com>
Message-ID: <alpine.LFD.2.21.1906071047350.3732@reclus.nhh.no>

On Wed, 5 Jun 2019, Panasci, Michael wrote:

>
> My question is in regards to the Implications of the 
> "rgdal::checkCRSArgs:: no proj_defs.dat in PROJ.4 shared files" warning. 
> I recently solved this problem on a high-performance Linux cluster by 
> redefining the PROJ_LIB path with:
>
> export PROJ_LIB=/opt/ohpc/pub/libs/intel/proj/5.0.1/share/proj

In the 4.9.1 release of PROJ (March 2015), the proj_defs.dat file was left 
out by accident. A work-around was added to rgdal then. This only affects 
people using really old systems with very out-of-date PROJ and GDAL 
versions (or possibly trying to reproduce old work).

>
> I generated lots of data before finding this fix.  Despite receiving the 
> warning message, does this actually lead to erroneous data?  All of my 
> projection components were appropriately defined and the code seemed to 
> have run fine (based on looking at the results).  Now that the issue is 
> resolved and I no longer receive the warning, I'm wondering if I need to 
> regenerate all the data from before realizing this fix.  I have not been 
> able to find anything definitive on this message board regarding 
> implications of that error.  Thoughts?

The fix (still operative for those affected is:

proj_def_bug_fix <- function(uprojargs) {
     if (length(grep("no_defs", uprojargs)) == 0L &&
# corrected 20150904
         length(grep("init", uprojargs)) == 0L) {
         if (length(grep("ellps", uprojargs)) == 0L &&
# corrected 20150905
             length(grep("datum", uprojargs)) == 0L) {
             tags <- sapply(strsplit(strsplit("+proj=longlat +no_defs",
                 "\\+")[[1]], "="), "[", 1)
# based on proj/src/pj_init.c lines 191-197
             if (!any(c("datum", "ellps", "a", "b", "rf", "f") %in% tags)) 
{
                 uprojargs <- paste(uprojargs, "+ellps=WGS84", sep=" ")
            }
          }
     }
     uprojargs
}

run by rgdal::checkCRSArgs() when no proj_defs.dat is found. The missing 
file added +ellps=WGS84 to proj strings with no ellipse or datum 
information. If your input strings defined "+ellps=" and/or "+datum=" (or 
the other "a", "b", "rf", "f" values) no action was taken. The problem was 
noted in https://stat.ethz.ch/pipermail/r-sig-geo/2015-June/022969.html 
and the first changes in rgdal came in 0.9-3 2015-05-21. The advice then 
given was: "The best remedy is to update rgdal to >= 0.9-3 or put a copy 
of the missing file in the appropriate place."

You seem to have multiple versions of PROJ installed, which always risks 
trouble. If you have to run 4.9.1, add the missing file to the appropriate 
directory (possibly ../share/proj for the version you are using), then the 
warnings go away.

Roger

>
> Michael
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en


From |@r@@@|p@@||v@ @end|ng |rom gm@||@com  Fri Jun  7 15:45:57 2019
From: |@r@@@|p@@||v@ @end|ng |rom gm@||@com (Lara Silva)
Date: Fri, 7 Jun 2019 13:45:57 +0000
Subject: [R-sig-Geo] Modelling: opinion of new methods
Message-ID: <CALN9TEQU745zwSrU+1T3RRgRmk3L_pnW7McVV0m+=uouEzPEAw@mail.gmail.com>

Hello everyone!

I am new in modelling species (plants). However, I used some approaches
like ENFA (Biomapper), Maxent, generalized linear and additive models (in
R) and Biomod2.

I would like to improve my knowledge in this area.Currently, what methods
have been used?
Any suggestions?

Regards,

Lara

<https://www.avast.com/sig-email?utm_medium=email&utm_source=link&utm_campaign=sig-email&utm_content=webmail>
Sem
v?rus. www.avast.com
<https://www.avast.com/sig-email?utm_medium=email&utm_source=link&utm_campaign=sig-email&utm_content=webmail>
<#DAB4FAD8-2DD7-40BB-A1B8-4E2AA1F9FDF2>

	[[alternative HTML version deleted]]


From b|@|ev||@t @end|ng |rom gm@||@com  Fri Jun  7 16:03:11 2019
From: b|@|ev||@t @end|ng |rom gm@||@com (=?UTF-8?Q?Bede-Fazekas_=c3=81kos?=)
Date: Fri, 7 Jun 2019 16:03:11 +0200
Subject: [R-sig-Geo] Modelling: opinion of new methods
In-Reply-To: <CALN9TEQU745zwSrU+1T3RRgRmk3L_pnW7McVV0m+=uouEzPEAw@mail.gmail.com>
References: <CALN9TEQU745zwSrU+1T3RRgRmk3L_pnW7McVV0m+=uouEzPEAw@mail.gmail.com>
Message-ID: <28733edd-4153-474c-73d7-bd3e5663689f@gmail.com>

Dear Lara,

Several correlative species distribution models exist (and are used 
currently), including machine learning approaches as well, such as 
artificial neural network (ANN), boosted regression trees (RGB / GBM), 
genetic algorithm (GA), and random forests (RF).
You may find the papers comparing or grouping them interesting:
- Dormann CF, Elith J, Bacher S, Buchmann C, Carl G, Carr? G, Garc?a 
Marqu?z JR, Gruber B, Lafourcade B, Leit?o PJ, M?nkem?ller T, McClean C, 
Osborne PE, Reineking B, Schr?der B, Skidmore AK, Zurell D, Lautenbach S 
(2013): Collinearity: a review of methods to deal with it and a 
simulation study evaluating their performance. Ecography 36(1): 27?46.
- Elith J, Graham CH (2009)? Do they? How do they? Why do they differ? 
On finding reasons for differing performances of species distribution 
models. Ecography 32(1) 66?77.
- Heikkinen RK, Luoto M, Ara?jo MB, Virkkala R, Thuiller W, Sykes MT 
(2006): Methods and uncertainties in bioclimatic envelope modelling 
under climate change. Progress in Physical Geography 30(6): 751?777.
- Hernandez PA, Graham CH, Master LL, Albert DL (2006): The effect of 
sample size and species characteristics on performance of different 
species distribution modeling methods. Ecography 29(5): 773?785.
- Pearson RG, Thuiller W, Ara?jo MB, Martinez-Meyer E, Brotons L, 
McClean C, Miles L, Segurado P, Dawson TE, Lees DC (2006): Model-based 
uncertainty in species? range prediction. Journal of Biogeography 
33(10): 1704?1711.
- Thuiller W (2004): Patterns and uncertainties of species? range shifts 
under climate change. Global Change Biology 10(12): 2020?2027.

Also see package 'sdm' by Naimi and Ara?jo.
HTH,
?kos Bede-Fazekas
Hungarian Academy of Sciences

2019.06.07. 15:45 keltez?ssel, Lara Silva ?rta:
> Hello everyone!
>
> I am new in modelling species (plants). However, I used some approaches
> like ENFA (Biomapper), Maxent, generalized linear and additive models (in
> R) and Biomod2.
>
> I would like to improve my knowledge in this area.Currently, what methods
> have been used?
> Any suggestions?
>
> Regards,
>
> Lara
>
> <https://www.avast.com/sig-email?utm_medium=email&utm_source=link&utm_campaign=sig-email&utm_content=webmail>
> Sem
> v?rus. www.avast.com
> <https://www.avast.com/sig-email?utm_medium=email&utm_source=link&utm_campaign=sig-email&utm_content=webmail>
> <#DAB4FAD8-2DD7-40BB-A1B8-4E2AA1F9FDF2>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From do@c3612 @end|ng |rom co|or@do@edu  Sun Jun  9 21:52:55 2019
From: do@c3612 @end|ng |rom co|or@do@edu (Dominik Schneider)
Date: Sun, 9 Jun 2019 12:52:55 -0700
Subject: [R-sig-Geo] install rgdal from source macOS
Message-ID: <CAF1jk_ndHGqdX1AENj-77bMQZhGJtQ_THGP5AZrOmJ81HVpiSA@mail.gmail.com>

I'm trying to install rgdal from source on a fresh r 3.6 installation.
i setup a conda environment to install gdal, proj, geos

install.packages('rgdal', type = "source",
configure.args=c('--with-proj-include=/Users/dosc3612/Applications/miniconda3/envs/rgdal/include',
'--with-proj-lib=/Users/dosc3612/Applications/miniconda3/envs/rgdal/lib',
'--with-gdal-config=/Users/dosc3612/Applications/miniconda3/envs/rgdal/bin/gdal-config'))

The full output is below but the first error I see is:
./configure: line 2101: pkg-config: command not found
configure: pkg-config proj not available
  set PKG_CONFIG_PATH to the directory containing proj.pc
configure: PROJ version not determined using pkg-config proj

which I don't understand because:
Sys.getenv('PKG_CONFIG_PATH')
[1] "/Users/dosc3612/Applications/miniconda3/envs/rgdal/lib/pkgconfig"

and just to confirm:
(rgdal) Phoenix:~ $ ls `echo $PKG_CONFIG_PATH` | grep proj
proj.pc

*Is there another way to set PKG_CONFIG_PATH within install.packages?*

There are also some undefined symbols:
Undefined symbols for architecture x86_64:
  "_pj_ctx_fclose", referenced from:
      _main in proj_conf_test2-9a39dc.o
  "_pj_get_default_ctx", referenced from:
      _main in proj_conf_test2-9a39dc.o
  "_pj_open_lib", referenced from:
      _main in proj_conf_test2-9a39dc.o
ld: symbol(s) not found for architecture x86_64
clang: error: linker command failed with exit code 1 (use -v to see
invocation)
./configure: line 2422: ./proj_conf_test2: No such file or directory

I tried with gdal 2.4.1 and gdal 3.0.0 (after seeing
http://r-sig-geo.2731867.n2.nabble.com/GDAL-3-0-0-and-rgdal-tt7592822.html#a7592834
)
proj is 6.1
geos is 3.7.1

What did I miss? Please advise. Thanks.

FULL OUTPUT:
> install.packages('rgdal', type = "source",
configure.args=c('--with-proj-include=/Users/dosc3612/Applications/miniconda3/envs/rgdal/include',
'--with-proj-lib=/Users/dosc3612/Applications/miniconda3/envs/rgdal/lib',
'--with-gdal-config=/Users/dosc3612/Applications/miniconda3/envs/rgdal/bin/gdal-config'))
--- Please select a CRAN mirror for use in this session ---
trying URL 'https://cloud.r-project.org/src/contrib/rgdal_1.4-4.tar.gz'
Content type 'application/x-gzip' length 1687518 bytes (1.6 MB)
==================================================
downloaded 1.6 MB

* installing *source* package ?rgdal? ...
** package ?rgdal? successfully unpacked and MD5 sums checked
** using staged installation
configure: R_HOME: /Library/Frameworks/R.framework/Resources
configure: CC: clang
configure: CXX: clang++ -std=gnu++11
configure: C++11 support available
configure: rgdal: 1.4-4
checking for /usr/bin/svnversion... yes
configure: svn revision: 833
configure: gdal-config set to
/Users/dosc3612/Applications/miniconda3/envs/rgdal/bin/gdal-config
checking gdal-config exists... yes
checking gdal-config executable... yes
checking gdal-config usability... yes
configure: GDAL: 2.4.1
checking C++11 support for GDAL >= 2.3.0... yes
checking GDAL version >= 1.11.4... yes
checking GDAL version <= 2.5 or >= 3.0... yes
checking gdal: linking with --libs only... yes
checking GDAL: gdal-config data directory readable... yes
checking GDAL:
/Users/dosc3612/Applications/miniconda3/envs/rgdal/share/gdal/pcs.csv
readable... yes
./configure: line 2101: pkg-config: command not found
configure: pkg-config proj not available
  set PKG_CONFIG_PATH to the directory containing proj.pc
configure: PROJ version not determined using pkg-config proj
configure: proj CPP flags:
 -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
-I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
checking PROJ header API:... proj_api.h
checking proj_api.h presence and usability... yes
checking PROJ version >= 4.8.0... yes
Undefined symbols for architecture x86_64:
  "_pj_ctx_fclose", referenced from:
      _main in proj_conf_test2-9a39dc.o
  "_pj_get_default_ctx", referenced from:
      _main in proj_conf_test2-9a39dc.o
  "_pj_open_lib", referenced from:
      _main in proj_conf_test2-9a39dc.o
ld: symbol(s) not found for architecture x86_64
clang: error: linker command failed with exit code 1 (use -v to see
invocation)
./configure: line 2422: ./proj_conf_test2: No such file or directory
checking PROJ.4: proj.db found and readable... yes
Undefined symbols for architecture x86_64:
  "_pj_ctx_fclose", referenced from:
      _main in proj_conf_test3-9f8df7.o
  "_pj_get_default_ctx", referenced from:
      _main in proj_conf_test3-9f8df7.o
  "_pj_open_lib", referenced from:
      _main in proj_conf_test3-9f8df7.o
ld: symbol(s) not found for architecture x86_64
clang: error: linker command failed with exit code 1 (use -v to see
invocation)
./configure: line 2482: ./proj_conf_test3: No such file or directory
checking PROJ.4: conus found and readable... yes
configure: Package CPP flags:
 -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
-I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
-DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
configure: Package LIBS:
 -L/Users/dosc3612/Applications/miniconda3/envs/rgdal/lib -lgdal
-L/Users/dosc3612/Applications/miniconda3/envs/rgdal/lib -lproj
configure: creating ./config.status
config.status: creating src/Makevars
** libs
clang++ -std=gnu++11 -I"/Library/Frameworks/R.framework/Resources/include"
-DNDEBUG -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
-I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
-DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
-I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
-isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
-I/usr/local/include  -fPIC  -Wall -g -O2  -c OGR_write.cpp -o OGR_write.o
clang++ -std=gnu++11 -I"/Library/Frameworks/R.framework/Resources/include"
-DNDEBUG -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
-I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
-DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
-I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
-isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
-I/usr/local/include  -fPIC  -Wall -g -O2  -c gdal-bindings.cpp -o
gdal-bindings.o
clang -I"/Library/Frameworks/R.framework/Resources/include" -DNDEBUG
-I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
-I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
-DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
-I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
-isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
-I/usr/local/include  -fPIC  -Wall -g -O2  -c init.c -o init.o
clang -I"/Library/Frameworks/R.framework/Resources/include" -DNDEBUG
-I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
-I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
-DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
-I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
-isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
-I/usr/local/include  -fPIC  -Wall -g -O2  -c inverser.c -o inverser.o
clang -I"/Library/Frameworks/R.framework/Resources/include" -DNDEBUG
-I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
-I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
-DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
-I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
-isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
-I/usr/local/include  -fPIC  -Wall -g -O2  -c local_stubs.c -o local_stubs.o
clang++ -std=gnu++11 -I"/Library/Frameworks/R.framework/Resources/include"
-DNDEBUG -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
-I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
-DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
-I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
-isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
-I/usr/local/include  -fPIC  -Wall -g -O2  -c ogr_geom.cpp -o ogr_geom.o
clang -I"/Library/Frameworks/R.framework/Resources/include" -DNDEBUG
-I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
-I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
-DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
-I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
-isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
-I/usr/local/include  -fPIC  -Wall -g -O2  -c ogr_polygons.c -o
ogr_polygons.o
clang++ -std=gnu++11 -I"/Library/Frameworks/R.framework/Resources/include"
-DNDEBUG -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
-I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
-DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
-I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
-isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
-I/usr/local/include  -fPIC  -Wall -g -O2  -c ogr_proj.cpp -o ogr_proj.o
clang++ -std=gnu++11 -I"/Library/Frameworks/R.framework/Resources/include"
-DNDEBUG -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
-I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
-DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
-I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
-isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
-I/usr/local/include  -fPIC  -Wall -g -O2  -c ogrdrivers.cpp -o ogrdrivers.o
clang++ -std=gnu++11 -I"/Library/Frameworks/R.framework/Resources/include"
-DNDEBUG -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
-I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
-DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
-I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
-isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
-I/usr/local/include  -fPIC  -Wall -g -O2  -c ogrsource.cpp -o ogrsource.o
clang++ -std=gnu++11 -I"/Library/Frameworks/R.framework/Resources/include"
-DNDEBUG -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
-I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
-DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
-I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
-isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
-I/usr/local/include  -fPIC  -Wall -g -O2  -c proj_info6.cpp -o proj_info6.o
clang++ -std=gnu++11 -I"/Library/Frameworks/R.framework/Resources/include"
-DNDEBUG -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
-I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
-DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
-I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
-isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
-I/usr/local/include  -fPIC  -Wall -g -O2  -c projectit.cpp -o projectit.o
clang++ -std=gnu++11 -dynamiclib -Wl,-headerpad_max_install_names
-undefined dynamic_lookup -single_module -multiply_defined suppress
-L/Library/Frameworks/R.framework/Resources/lib -L/usr/local/lib -o
rgdal.so OGR_write.o gdal-bindings.o init.o inverser.o local_stubs.o
ogr_geom.o ogr_polygons.o ogr_proj.o ogrdrivers.o ogrsource.o proj_info6.o
projectit.o -L/Users/dosc3612/Applications/miniconda3/envs/rgdal/lib -lgdal
-L/Users/dosc3612/Applications/miniconda3/envs/rgdal/lib -lproj
-F/Library/Frameworks/R.framework/.. -framework R -Wl,-framework
-Wl,CoreFoundation
installing to
/Library/Frameworks/R.framework/Versions/3.6/Resources/library/00LOCK-rgdal/00new/rgdal/libs
** R
** data
** inst
** byte-compile and prepare package for lazy loading
** help
*** installing help indices
** building package indices
** installing vignettes
** testing if installed package can be loaded from temporary location
Error: package or namespace load failed for ?rgdal? in dyn.load(file,
DLLpath = DLLpath, ...):
 unable to load shared object
'/Library/Frameworks/R.framework/Versions/3.6/Resources/library/00LOCK-rgdal/00new/rgdal/libs/rgdal.so':

dlopen(/Library/Frameworks/R.framework/Versions/3.6/Resources/library/00LOCK-rgdal/00new/rgdal/libs/rgdal.so,
6): Library not loaded: @rpath/libgdal.20.dylib
  Referenced from:
/Library/Frameworks/R.framework/Versions/3.6/Resources/library/00LOCK-rgdal/00new/rgdal/libs/rgdal.so
  Reason: image not found
Error: loading failed
Execution halted
ERROR: loading failed
* removing
?/Library/Frameworks/R.framework/Versions/3.6/Resources/library/rgdal?

The downloaded source packages are in
?/private/var/folders/bb/13z2kq0j01jg5q_0ypjc76gr0000gn/T/RtmplsyMiu/downloaded_packages?
Warning message:
In install.packages("rgdal", type = "source", configure.args =
c("--with-proj-include=/Users/dosc3612/Applications/miniconda3/envs/rgdal/include",
 :
  installation of package ?rgdal? had non-zero exit status

	[[alternative HTML version deleted]]


From dehn@v|2300 @end|ng |rom y@hoo@com  Mon Jun 10 08:58:19 2019
From: dehn@v|2300 @end|ng |rom y@hoo@com (hamide dehnavi)
Date: Mon, 10 Jun 2019 06:58:19 +0000 (UTC)
Subject: [R-sig-Geo] Disjungtive kriging in RGeostats pakage
References: <1971486084.913827.1560149899979.ref@mail.yahoo.com>
Message-ID: <1971486084.913827.1560149899979@mail.yahoo.com>

?I want to use this function(dk) of RGeostats pakage but i have? errors . I don't found example of this fuction please guide me?

Sent from Yahoo Mail on Android
	[[alternative HTML version deleted]]


From m@rcomeiiom m@iii@g oii iibero@it  Mon Jun 10 17:45:46 2019
From: m@rcomeiiom m@iii@g oii iibero@it (m@rcomeiiom m@iii@g oii iibero@it)
Date: Mon, 10 Jun 2019 17:45:46 +0200 (CEST)
Subject: [R-sig-Geo] Error in lag.listw(listw2,
 u) : Variable contains non-finite values - panel
 spatial model using splm
Message-ID: <2074069805.1663586.1560181546753@mail.libero.it>

Dear community,

I am working on a panel spatial model in R using the package splm. In particular I am trying to estimate the following model

spatpan<-spml(y ~ x, data = data_p, index = NULL, listw = W30, na.action = na.fail, lag = TRUE, spatial.error = "b", model = "within", effect = "twoways",zero.policy=TRUE)

but I get the following error and warnings:

Error in lag.listw(listw2, u) : Variable contains non-finite values
In addition: Warning messages:
1: In lag.listw(listw, u) : NAs in lagged values
2: In lag.listw(listw, u) : NAs in lagged values
3: In lag.listw(listw2, u) : NAs in lagged values
4: In lag.listw(listw2, u) : NAs in lagged values


Similarly, if I model the spatial correlation only for the error term,

spatpan<-spml(y ~ x, data = data_p, index = NULL, listw = W30, na.action = na.fail, lag = FALSE, spatial.error = "b", model = "within", effect = "twoways",zero.policy=TRUE)

I get the following warnings

1: In lag.listw(listw, u) : NAs in lagged values

...

3: In lag.listw(listw, TT) : NAs in lagged values

...

35: In optimize(sarpanelerror, interval = interval, maximum = TRUE, ... :
NA/Inf replaced by maximum positive value

...


In this case however the model turns out to be estimated, despite the standard errors are everywhere NAs and the spatial rho coefficient equal to 1 with weird t stats and p-values. 

An identical problem to mine was already signalled in this mailing list, unfortunately without receiving any suggestion : http://r-sig-geo.2731867.n2.nabble.com/problems-using-spml-with-a-listw-where-not-everybody-has-a-neighbour-td7587857.html.

I guess that the issue could be due to the n by n spatial weighting matrix W30, which contains some neighbourless observations. However this feature should be taken into account by the zero.policy option. Moreover the same framework perfectly works in the cross-sectional case, by using the function sacsarlm from the package spdep.

Please, does anybody know what is causing this and how can I solve this issue? Any help would be really appreciated.

Kind Regards,

Marco Mello

 
	[[alternative HTML version deleted]]


From Roger@B|v@nd @end|ng |rom nhh@no  Mon Jun 10 19:26:52 2019
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Mon, 10 Jun 2019 19:26:52 +0200
Subject: [R-sig-Geo] Disjungtive kriging in RGeostats pakage
In-Reply-To: <1971486084.913827.1560149899979@mail.yahoo.com>
References: <1971486084.913827.1560149899979.ref@mail.yahoo.com>
 <1971486084.913827.1560149899979@mail.yahoo.com>
Message-ID: <alpine.LFD.2.21.1906101926370.1884@reclus.nhh.no>

This package is not a CRAN package but comes from:

http://rgeostats.free.fr/

with a restrictive license. The df() function has a help page at:

http://rgeostats.free.fr/html/dk.html

The authors may be the best source of advice. In general, it is best to 
provide a toy example with a widely available data set (coal ash?) that 
mimics your problem. Then anyone with access to the package can see what 
is the problem and maybe also help illuminate it.

Hope this clarifies,

Roger

On Mon, 10 Jun 2019, hamide dehnavi via R-sig-Geo wrote:

> ?I want to use this function(dk) of RGeostats pakage but i have? errors . I don't found example of this fuction please guide me?
>
> Sent from Yahoo Mail on Android
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

From Roger@B|v@nd @end|ng |rom nhh@no  Mon Jun 10 19:42:49 2019
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Mon, 10 Jun 2019 19:42:49 +0200
Subject: [R-sig-Geo] Error in lag.listw(listw2,
 u) : Variable contains non-finite values - panel
 spatial model using splm
In-Reply-To: <2074069805.1663586.1560181546753@mail.libero.it>
References: <2074069805.1663586.1560181546753@mail.libero.it>
Message-ID: <alpine.LFD.2.21.1906101930330.1884@reclus.nhh.no>

On Mon, 10 Jun 2019, Marco Mello via R-sig-Geo wrote:

> Dear community,

Please post plain text, not HTML, easier to copy and paste into an R 
session.

>
> I am working on a panel spatial model in R using the package splm. In 
> particular I am trying to estimate the following model
>
> spatpan<-spml(y ~ x, data = data_p, index = NULL, listw = W30, na.action 
> = na.fail, lag = TRUE, spatial.error = "b", model = "within", effect = 
> "twoways",zero.policy=TRUE)
>
> but I get the following error and warnings:
>
> Error in lag.listw(listw2, u) : Variable contains non-finite values
> In addition: Warning messages:
> 1: In lag.listw(listw, u) : NAs in lagged values
> 2: In lag.listw(listw, u) : NAs in lagged values
> 3: In lag.listw(listw2, u) : NAs in lagged values
> 4: In lag.listw(listw2, u) : NAs in lagged values
>

This is not a reproducible example. Such an example is needed unless you 
can run traceback() and debug() yourself to solve the problem, but since 
you have posted, I assume you prefer that someone else runs debug() - and 
someone will then need a reproducible example, preferably with an adapted 
standard dataset (add NAs to Produc?).

I seem to recall that zero.policy= was not always passed through in some 
model fitting functions, possibly in splm. If so, set the option with 
spatialreg::set.ZeroPolicyOption(TRUE) and/or 
spdep::set.ZeroPolicyOption(TRUE)
to avoid that issue if it is present and biting. Of course, had I had a 
reproducible example, I could have checked and given clearer advice.

>
> Similarly, if I model the spatial correlation only for the error term,
>
> spatpan<-spml(y ~ x, data = data_p, index = NULL, listw = W30, na.action 
> = na.fail, lag = FALSE, spatial.error = "b", model = "within", effect = 
> "twoways",zero.policy=TRUE)
>
> I get the following warnings
>
> 1: In lag.listw(listw, u) : NAs in lagged values
>
> ...
>
> 3: In lag.listw(listw, TT) : NAs in lagged values
>
> ...
>
> 35: In optimize(sarpanelerror, interval = interval, maximum = TRUE, ... :
> NA/Inf replaced by maximum positive value
>
> ...
>
>
> In this case however the model turns out to be estimated, despite the 
> standard errors are everywhere NAs and the spatial rho coefficient equal 
> to 1 with weird t stats and p-values.
>
> An identical problem to mine was already signalled in this mailing list, 
> unfortunately without receiving any suggestion : 
> http://r-sig-geo.2731867.n2.nabble.com/problems-using-spml-with-a-listw-where-not-everybody-has-a-neighbour-td7587857.html.

Nabble is only an archive, the real link is:

https://stat.ethz.ch/pipermail/r-sig-geo/2015-March/022428.html

The posting also gave no reproducible example, so nobody had anything to 
work on.

Hope this helps,

Roger

>
> I guess that the issue could be due to the n by n spatial weighting 
> matrix W30, which contains some neighbourless observations. However this 
> feature should be taken into account by the zero.policy option. Moreover 
> the same framework perfectly works in the cross-sectional case, by using 
> the function sacsarlm from the package spdep.
>
> Please, does anybody know what is causing this and how can I solve this 
> issue? Any help would be really appreciated.
>
> Kind Regards,
>
> Marco Mello
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en


From tom@heng| @end|ng |rom gm@||@com  Tue Jun 11 14:50:19 2019
From: tom@heng| @end|ng |rom gm@||@com (Tomislav Hengl)
Date: Tue, 11 Jun 2019 08:50:19 -0400
Subject: [R-sig-Geo] How is defined PWP in soilgrids?
In-Reply-To: <CAKonnoEtNQwpFivWLD=ievLmY9WB13mLwiwD_2r3JV1xtRoySg@mail.gmail.com>
References: <CAKonnoEtNQwpFivWLD=ievLmY9WB13mLwiwD_2r3JV1xtRoySg@mail.gmail.com>
Message-ID: <8b22b265-de3a-c64e-409a-b33b2acb33ca@gmail.com>


Hi Eliza,

The most up-to-date water capacity maps of the world you can find at:

https://zenodo.org/record/2629149

Soil water content in percent for 33 kPa and 1500 kPa suctions predicted 
at 6 standard depths (0, 10, 30, 60, 100 and 200 cm) at 250 m resolution 
and based on a global compilation of soil profiles (USDA NCSS, AfSPDB, 
ISRIC WISE, EGRPR, SPADE, CanNPDB, UNSODA, SWIG, HYBRAS and HydroS) you 
can access from:

https://zenodo.org/record/2784001

and visually explore at:

https://openlandmap.org/#/?base=Stamen%20(OpenStreetMap)&center=46.3848,2.4939&zoom=4&opacity=80&layer=sol_watercontent.33kPa_usda.4b1c_m&depth=0

Note these maps are not based on PTFs but on direct prediction from 
laboratory data.

If you have any more issues or questions please post them via:

https://github.com/Envirometrix/LandGISmaps

THT,

-- 
T. (Tom) Hengl
Technical support / Vice Chair
OpenGeoHub Foundation
Address: Agro Business Park 10 (unit 1.05), 6708 PW Wageningen, NL
Tel: +31 (0)317 427537
Url: https://opengeohub.org/about
Twitter: https://twitter.com/opengeohub
https://www.youtube.com/c/OpenGeoHubFoundation
skype:tom.hengl?chat
Publications: http://scholar.google.com/citations?user=2oYU7S8AAAAJ


On 6/11/19 7:34 AM, M? Eliza Turek wrote:
> Dear Tomislav,
> 
> I am working with SoilGrids database and I need the values for permanent 
> wilting point, because I want to define the soil water retention curve 
> with the van Genuchten equation. However, I saw that are available just 
> the available water in some potentials, and not the values of retention 
> themselves. I was thinking about use WWP as a point itself and estimate 
> the permanent wilting point with a pedotransfer function, but for that I 
> need to know the criteria for WWP. How did you define field capacity? By 
> pedotransfers?
> 
> You said in one of your answers 
> (https://groups.google.com/forum/#!topic/global-soil-information/SMJzAXBhS08) 
> that
> WWP = moisture potential at wilting point in kPa e.g. -1585 (pF 4.2),
> However in my selected data they are at the same order of magnitude that 
> AWCh1, AWCh2 and AWCh3. Is this correct?
> 
> Thank you very?much!
> 
> -- 
> Maria Eliza Turek
> PhD Student - Graduate Program in Environmental Engineering??- PPGEA
> Federal University of Paran? - UFPR- Brazil


From m@rcomeiiom m@iii@g oii iibero@it  Tue Jun 11 15:53:02 2019
From: m@rcomeiiom m@iii@g oii iibero@it (m@rcomeiiom m@iii@g oii iibero@it)
Date: Tue, 11 Jun 2019 15:53:02 +0200 (CEST)
Subject: [R-sig-Geo] Error in lag.listw(listw2,
 u) : Variable contains non-finite values - panel
 spatial model using splm
In-Reply-To: <alpine.LFD.2.21.1906101930330.1884@reclus.nhh.no>
References: <2074069805.1663586.1560181546753@mail.libero.it>
 <alpine.LFD.2.21.1906101930330.1884@reclus.nhh.no>
Message-ID: <1811587816.1688119.1560261182608@mail.libero.it>

Dear Roger,

many thanks for your help. Actually the issue was exactly the zero.policy option. I solved this by imposing spdep::set.ZeroPolicyOption(TRUE). Now the estimation works. This solution should apply to all weighting matrices having rows with all zeros, i.e. neighbourless observations.

I notice however that results are different between those obtained if we estimate the model with both individual and time fixed effects by setting effect="twoways" and those obtained by estimating the model with just one type of fixed effect (e.g. effect="individual") and adding the other ones by hand in the formula.

I will add a reproducible example using the Produc dataset to show this issue.





library(plm)
library(spdep)
library(splm)

data(Produc, package = "plm")
data(usaww)

##effect="twoways"

fespaterr <- spml(log(gsp) ~ log(pcap) + log(pc) + log(emp) + unemp, data = Produc, listw = mat2listw(usaww),
model="within",lag=T,effect = "twoways", spatial.error="b", Hess = FALSE)

summary(fespaterr)

##effect="individual" and time fixed effects by hand

fespaterr <- spml(log(gsp) ~ log(pcap) + log(pc) + log(emp) + unemp + factor(year), data = Produc, listw = mat2listw(usaww),
model="within",lag=T,effect = "individual", spatial.error="b", Hess = FALSE)

summary(fespaterr)

##effect="time" and individual fixed effects by hand

fespaterr <- spml(log(gsp) ~ log(pcap) + log(pc) + log(emp) + unemp + factor(state), data = Produc, listw = mat2listw(usaww),
model="within",lag=T,effect = "time", spatial.error="b", Hess = FALSE)

summary(fespaterr)





Is this correct?

In this example the coefficients are just slightly different between the three specifications. In my case however, with T=2, these three specifications provide completely different results.

Thank you again for your help,

Marco



> 
>     Il 10 giugno 2019 alle 19.42 Roger Bivand <Roger.Bivand at nhh.no> ha scritto:
> 
>     On Mon, 10 Jun 2019, Marco Mello via R-sig-Geo wrote:
> 
>         > > 
> >         Dear community,
> > 
> >     > 
>     Please post plain text, not HTML, easier to copy and paste into an R
>     session.
> 
>     >
> 
>         > > 
> >         I am working on a panel spatial model in R using the package splm. In
> >         particular I am trying to estimate the following model
> > 
> >         spatpan<-spml(y ~ x, data = data_p, index = NULL, listw = W30, na.action
> >         = na.fail, lag = TRUE, spatial.error = "b", model = "within", effect =
> >         "twoways",zero.policy=TRUE)
> > 
> >         but I get the following error and warnings:
> > 
> >         Error in lag.listw(listw2, u) : Variable contains non-finite values
> >         In addition: Warning messages:
> >         1: In lag.listw(listw, u) : NAs in lagged values
> >         2: In lag.listw(listw, u) : NAs in lagged values
> >         3: In lag.listw(listw2, u) : NAs in lagged values
> >         4: In lag.listw(listw2, u) : NAs in lagged values
> > 
> >     > 
>     This is not a reproducible example. Such an example is needed unless you
>     can run traceback() and debug() yourself to solve the problem, but since
>     you have posted, I assume you prefer that someone else runs debug() - and
>     someone will then need a reproducible example, preferably with an adapted
>     standard dataset (add NAs to Produc?).
> 
>     I seem to recall that zero.policy= was not always passed through in some
>     model fitting functions, possibly in splm. If so, set the option with
>     spatialreg::set.ZeroPolicyOption(TRUE) and/or
>     spdep::set.ZeroPolicyOption(TRUE)
>     to avoid that issue if it is present and biting. Of course, had I had a
>     reproducible example, I could have checked and given clearer advice.
> 
>     >
> 
>         > > 
> >         Similarly, if I model the spatial correlation only for the error term,
> > 
> >         spatpan<-spml(y ~ x, data = data_p, index = NULL, listw = W30, na.action
> >         = na.fail, lag = FALSE, spatial.error = "b", model = "within", effect =
> >         "twoways",zero.policy=TRUE)
> > 
> >         I get the following warnings
> > 
> >         1: In lag.listw(listw, u) : NAs in lagged values
> > 
> >         ...
> > 
> >         3: In lag.listw(listw, TT) : NAs in lagged values
> > 
> >         ...
> > 
> >         35: In optimize(sarpanelerror, interval = interval, maximum = TRUE, ... :
> >         NA/Inf replaced by maximum positive value
> > 
> >         ...
> > 
> >         In this case however the model turns out to be estimated, despite the
> >         standard errors are everywhere NAs and the spatial rho coefficient equal
> >         to 1 with weird t stats and p-values.
> > 
> >         An identical problem to mine was already signalled in this mailing list,
> >         unfortunately without receiving any suggestion :
> >         http://r-sig-geo.2731867.n2.nabble.com/problems-using-spml-with-a-listw-where-not-everybody-has-a-neighbour-td7587857.html.
> > 
> >     > 
>     Nabble is only an archive, the real link is:
> 
>     https://stat.ethz.ch/pipermail/r-sig-geo/2015-March/022428.html
> 
>     The posting also gave no reproducible example, so nobody had anything to
>     work on.
> 
>     Hope this helps,
> 
>     Roger
> 
>     >
> 
>         > > 
> >         I guess that the issue could be due to the n by n spatial weighting
> >         matrix W30, which contains some neighbourless observations. However this
> >         feature should be taken into account by the zero.policy option. Moreover
> >         the same framework perfectly works in the cross-sectional case, by using
> >         the function sacsarlm from the package spdep.
> > 
> >         Please, does anybody know what is causing this and how can I solve this
> >         issue? Any help would be really appreciated.
> > 
> >         Kind Regards,
> > 
> >         Marco Mello
> > 
> >         [[alternative HTML version deleted]]
> > 
> >         _______________________________________________
> >         R-sig-Geo mailing list
> >         R-sig-Geo at r-project.org
> >         https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > 
> >     > 
>     --
>     Roger Bivand
>     Department of Economics, Norwegian School of Economics,
>     Helleveien 30, N-5045 Bergen, Norway.
>     voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
>     https://orcid.org/0000-0003-2392-6140
>     https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
> 

	[[alternative HTML version deleted]]


From Roger@B|v@nd @end|ng |rom nhh@no  Tue Jun 11 16:04:52 2019
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Tue, 11 Jun 2019 16:04:52 +0200
Subject: [R-sig-Geo] Error in lag.listw(listw2,
 u) : Variable contains non-finite values - panel
 spatial model using splm
In-Reply-To: <1811587816.1688119.1560261182608@mail.libero.it>
References: <2074069805.1663586.1560181546753@mail.libero.it>
 <alpine.LFD.2.21.1906101930330.1884@reclus.nhh.no>
 <1811587816.1688119.1560261182608@mail.libero.it>
Message-ID: <alpine.LFD.2.21.1906111602210.16232@reclus.nhh.no>

On Tue, 11 Jun 2019, marcomellom at libero.it wrote:

> Dear Roger,
>
> many thanks for your help. Actually the issue was exactly the 
> zero.policy option. I solved this by imposing 
> spdep::set.ZeroPolicyOption(TRUE). Now the estimation works. This 
> solution should apply to all weighting matrices having rows with all 
> zeros, i.e. neighbourless observations.
>

OK, good, my memory isn't so bad after all ...

> I notice however that results are different between those obtained if we 
> estimate the model with both individual and time fixed effects by 
> setting effect="twoways" and those obtained by estimating the model with 
> just one type of fixed effect (e.g. effect="individual") and adding the 
> other ones by hand in the formula.
>
> I will add a reproducible example using the Produc dataset to show this 
> issue.
>

Thanks for the example, I've CC'ed the splm maintainer to elicit more 
insight.

Roger

>
>
>
>
> library(plm)
> library(spdep)
> library(splm)
>
> data(Produc, package = "plm")
> data(usaww)
>
> ##effect="twoways"
>
> fespaterr <- spml(log(gsp) ~ log(pcap) + log(pc) + log(emp) + unemp, data = Produc, listw = mat2listw(usaww),
> model="within",lag=T,effect = "twoways", spatial.error="b", Hess = FALSE)
>
> summary(fespaterr)
>
> ##effect="individual" and time fixed effects by hand
>
> fespaterr <- spml(log(gsp) ~ log(pcap) + log(pc) + log(emp) + unemp + factor(year), data = Produc, listw = mat2listw(usaww),
> model="within",lag=T,effect = "individual", spatial.error="b", Hess = FALSE)
>
> summary(fespaterr)
>
> ##effect="time" and individual fixed effects by hand
>
> fespaterr <- spml(log(gsp) ~ log(pcap) + log(pc) + log(emp) + unemp + factor(state), data = Produc, listw = mat2listw(usaww),
> model="within",lag=T,effect = "time", spatial.error="b", Hess = FALSE)
>
> summary(fespaterr)
>
>
>
>
>
> Is this correct?
>
> In this example the coefficients are just slightly different between the three specifications. In my case however, with T=2, these three specifications provide completely different results.
>
> Thank you again for your help,
>
> Marco
>
>
>
>>
>>     Il 10 giugno 2019 alle 19.42 Roger Bivand <Roger.Bivand at nhh.no> ha scritto:
>>
>>     On Mon, 10 Jun 2019, Marco Mello via R-sig-Geo wrote:
>>
>>        >>
>>>         Dear community,
>>>
>>>    >
>>     Please post plain text, not HTML, easier to copy and paste into an R
>>     session.
>>
>>    >
>>
>>        >>
>>>         I am working on a panel spatial model in R using the package splm. In
>>>         particular I am trying to estimate the following model
>>>
>>>         spatpan<-spml(y ~ x, data = data_p, index = NULL, listw = W30, na.action
>>>         = na.fail, lag = TRUE, spatial.error = "b", model = "within", effect =
>>>         "twoways",zero.policy=TRUE)
>>>
>>>         but I get the following error and warnings:
>>>
>>>         Error in lag.listw(listw2, u) : Variable contains non-finite values
>>>         In addition: Warning messages:
>>>         1: In lag.listw(listw, u) : NAs in lagged values
>>>         2: In lag.listw(listw, u) : NAs in lagged values
>>>         3: In lag.listw(listw2, u) : NAs in lagged values
>>>         4: In lag.listw(listw2, u) : NAs in lagged values
>>>
>>>    >
>>     This is not a reproducible example. Such an example is needed unless you
>>     can run traceback() and debug() yourself to solve the problem, but since
>>     you have posted, I assume you prefer that someone else runs debug() - and
>>     someone will then need a reproducible example, preferably with an adapted
>>     standard dataset (add NAs to Produc?).
>>
>>     I seem to recall that zero.policy= was not always passed through in some
>>     model fitting functions, possibly in splm. If so, set the option with
>>     spatialreg::set.ZeroPolicyOption(TRUE) and/or
>>     spdep::set.ZeroPolicyOption(TRUE)
>>     to avoid that issue if it is present and biting. Of course, had I had a
>>     reproducible example, I could have checked and given clearer advice.
>>
>>    >
>>
>>        >>
>>>         Similarly, if I model the spatial correlation only for the error term,
>>>
>>>         spatpan<-spml(y ~ x, data = data_p, index = NULL, listw = W30, na.action
>>>         = na.fail, lag = FALSE, spatial.error = "b", model = "within", effect =
>>>         "twoways",zero.policy=TRUE)
>>>
>>>         I get the following warnings
>>>
>>>         1: In lag.listw(listw, u) : NAs in lagged values
>>>
>>>         ...
>>>
>>>         3: In lag.listw(listw, TT) : NAs in lagged values
>>>
>>>         ...
>>>
>>>         35: In optimize(sarpanelerror, interval = interval, maximum = TRUE, ... :
>>>         NA/Inf replaced by maximum positive value
>>>
>>>         ...
>>>
>>>         In this case however the model turns out to be estimated, despite the
>>>         standard errors are everywhere NAs and the spatial rho coefficient equal
>>>         to 1 with weird t stats and p-values.
>>>
>>>         An identical problem to mine was already signalled in this mailing list,
>>>         unfortunately without receiving any suggestion :
>>>         http://r-sig-geo.2731867.n2.nabble.com/problems-using-spml-with-a-listw-where-not-everybody-has-a-neighbour-td7587857.html.
>>>
>>>    >
>>     Nabble is only an archive, the real link is:
>>
>>     https://stat.ethz.ch/pipermail/r-sig-geo/2015-March/022428.html
>>
>>     The posting also gave no reproducible example, so nobody had anything to
>>     work on.
>>
>>     Hope this helps,
>>
>>     Roger
>>
>>    >
>>
>>        >>
>>>         I guess that the issue could be due to the n by n spatial weighting
>>>         matrix W30, which contains some neighbourless observations. However this
>>>         feature should be taken into account by the zero.policy option. Moreover
>>>         the same framework perfectly works in the cross-sectional case, by using
>>>         the function sacsarlm from the package spdep.
>>>
>>>         Please, does anybody know what is causing this and how can I solve this
>>>         issue? Any help would be really appreciated.
>>>
>>>         Kind Regards,
>>>
>>>         Marco Mello
>>>
>>>         [[alternative HTML version deleted]]
>>>
>>>         _______________________________________________
>>>         R-sig-Geo mailing list
>>>         R-sig-Geo at r-project.org
>>>         https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>>    >
>>     --
>>     Roger Bivand
>>     Department of Economics, Norwegian School of Economics,
>>     Helleveien 30, N-5045 Bergen, Norway.
>>     voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
>>     https://orcid.org/0000-0003-2392-6140
>>     https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en


From edzer@pebe@m@ @end|ng |rom un|-muen@ter@de  Tue Jun 11 19:32:28 2019
From: edzer@pebe@m@ @end|ng |rom un|-muen@ter@de (Edzer Pebesma)
Date: Tue, 11 Jun 2019 19:32:28 +0200
Subject: [R-sig-Geo] install rgdal from source macOS
In-Reply-To: <CAF1jk_ndHGqdX1AENj-77bMQZhGJtQ_THGP5AZrOmJ81HVpiSA@mail.gmail.com>
References: <CAF1jk_ndHGqdX1AENj-77bMQZhGJtQ_THGP5AZrOmJ81HVpiSA@mail.gmail.com>
Message-ID: <8067aa0e-3cc1-89d2-351b-c680cb25b0dc@uni-muenster.de>

for compiling rgdal from source on OSX against gdal 3 and proj 6.1.0,
please use the dev version on r-forge. See also
https://github.com/r-spatial/sf/issues/1070


On 6/9/19 9:52 PM, Dominik Schneider wrote:
> I'm trying to install rgdal from source on a fresh r 3.6 installation.
> i setup a conda environment to install gdal, proj, geos
> 
> install.packages('rgdal', type = "source",
> configure.args=c('--with-proj-include=/Users/dosc3612/Applications/miniconda3/envs/rgdal/include',
> '--with-proj-lib=/Users/dosc3612/Applications/miniconda3/envs/rgdal/lib',
> '--with-gdal-config=/Users/dosc3612/Applications/miniconda3/envs/rgdal/bin/gdal-config'))
> 
> The full output is below but the first error I see is:
> ./configure: line 2101: pkg-config: command not found
> configure: pkg-config proj not available
>   set PKG_CONFIG_PATH to the directory containing proj.pc
> configure: PROJ version not determined using pkg-config proj
> 
> which I don't understand because:
> Sys.getenv('PKG_CONFIG_PATH')
> [1] "/Users/dosc3612/Applications/miniconda3/envs/rgdal/lib/pkgconfig"
> 
> and just to confirm:
> (rgdal) Phoenix:~ $ ls `echo $PKG_CONFIG_PATH` | grep proj
> proj.pc
> 
> *Is there another way to set PKG_CONFIG_PATH within install.packages?*
> 
> There are also some undefined symbols:
> Undefined symbols for architecture x86_64:
>   "_pj_ctx_fclose", referenced from:
>       _main in proj_conf_test2-9a39dc.o
>   "_pj_get_default_ctx", referenced from:
>       _main in proj_conf_test2-9a39dc.o
>   "_pj_open_lib", referenced from:
>       _main in proj_conf_test2-9a39dc.o
> ld: symbol(s) not found for architecture x86_64
> clang: error: linker command failed with exit code 1 (use -v to see
> invocation)
> ./configure: line 2422: ./proj_conf_test2: No such file or directory
> 
> I tried with gdal 2.4.1 and gdal 3.0.0 (after seeing
> http://r-sig-geo.2731867.n2.nabble.com/GDAL-3-0-0-and-rgdal-tt7592822.html#a7592834
> )
> proj is 6.1
> geos is 3.7.1
> 
> What did I miss? Please advise. Thanks.
> 
> FULL OUTPUT:
>> install.packages('rgdal', type = "source",
> configure.args=c('--with-proj-include=/Users/dosc3612/Applications/miniconda3/envs/rgdal/include',
> '--with-proj-lib=/Users/dosc3612/Applications/miniconda3/envs/rgdal/lib',
> '--with-gdal-config=/Users/dosc3612/Applications/miniconda3/envs/rgdal/bin/gdal-config'))
> --- Please select a CRAN mirror for use in this session ---
> trying URL 'https://cloud.r-project.org/src/contrib/rgdal_1.4-4.tar.gz'
> Content type 'application/x-gzip' length 1687518 bytes (1.6 MB)
> ==================================================
> downloaded 1.6 MB
> 
> * installing *source* package ?rgdal? ...
> ** package ?rgdal? successfully unpacked and MD5 sums checked
> ** using staged installation
> configure: R_HOME: /Library/Frameworks/R.framework/Resources
> configure: CC: clang
> configure: CXX: clang++ -std=gnu++11
> configure: C++11 support available
> configure: rgdal: 1.4-4
> checking for /usr/bin/svnversion... yes
> configure: svn revision: 833
> configure: gdal-config set to
> /Users/dosc3612/Applications/miniconda3/envs/rgdal/bin/gdal-config
> checking gdal-config exists... yes
> checking gdal-config executable... yes
> checking gdal-config usability... yes
> configure: GDAL: 2.4.1
> checking C++11 support for GDAL >= 2.3.0... yes
> checking GDAL version >= 1.11.4... yes
> checking GDAL version <= 2.5 or >= 3.0... yes
> checking gdal: linking with --libs only... yes
> checking GDAL: gdal-config data directory readable... yes
> checking GDAL:
> /Users/dosc3612/Applications/miniconda3/envs/rgdal/share/gdal/pcs.csv
> readable... yes
> ./configure: line 2101: pkg-config: command not found
> configure: pkg-config proj not available
>   set PKG_CONFIG_PATH to the directory containing proj.pc
> configure: PROJ version not determined using pkg-config proj
> configure: proj CPP flags:
>  -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> checking PROJ header API:... proj_api.h
> checking proj_api.h presence and usability... yes
> checking PROJ version >= 4.8.0... yes
> Undefined symbols for architecture x86_64:
>   "_pj_ctx_fclose", referenced from:
>       _main in proj_conf_test2-9a39dc.o
>   "_pj_get_default_ctx", referenced from:
>       _main in proj_conf_test2-9a39dc.o
>   "_pj_open_lib", referenced from:
>       _main in proj_conf_test2-9a39dc.o
> ld: symbol(s) not found for architecture x86_64
> clang: error: linker command failed with exit code 1 (use -v to see
> invocation)
> ./configure: line 2422: ./proj_conf_test2: No such file or directory
> checking PROJ.4: proj.db found and readable... yes
> Undefined symbols for architecture x86_64:
>   "_pj_ctx_fclose", referenced from:
>       _main in proj_conf_test3-9f8df7.o
>   "_pj_get_default_ctx", referenced from:
>       _main in proj_conf_test3-9f8df7.o
>   "_pj_open_lib", referenced from:
>       _main in proj_conf_test3-9f8df7.o
> ld: symbol(s) not found for architecture x86_64
> clang: error: linker command failed with exit code 1 (use -v to see
> invocation)
> ./configure: line 2482: ./proj_conf_test3: No such file or directory
> checking PROJ.4: conus found and readable... yes
> configure: Package CPP flags:
>  -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> -DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
> configure: Package LIBS:
>  -L/Users/dosc3612/Applications/miniconda3/envs/rgdal/lib -lgdal
> -L/Users/dosc3612/Applications/miniconda3/envs/rgdal/lib -lproj
> configure: creating ./config.status
> config.status: creating src/Makevars
> ** libs
> clang++ -std=gnu++11 -I"/Library/Frameworks/R.framework/Resources/include"
> -DNDEBUG -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> -DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
> -I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
> -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
> -I/usr/local/include  -fPIC  -Wall -g -O2  -c OGR_write.cpp -o OGR_write.o
> clang++ -std=gnu++11 -I"/Library/Frameworks/R.framework/Resources/include"
> -DNDEBUG -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> -DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
> -I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
> -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
> -I/usr/local/include  -fPIC  -Wall -g -O2  -c gdal-bindings.cpp -o
> gdal-bindings.o
> clang -I"/Library/Frameworks/R.framework/Resources/include" -DNDEBUG
> -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> -DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
> -I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
> -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
> -I/usr/local/include  -fPIC  -Wall -g -O2  -c init.c -o init.o
> clang -I"/Library/Frameworks/R.framework/Resources/include" -DNDEBUG
> -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> -DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
> -I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
> -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
> -I/usr/local/include  -fPIC  -Wall -g -O2  -c inverser.c -o inverser.o
> clang -I"/Library/Frameworks/R.framework/Resources/include" -DNDEBUG
> -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> -DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
> -I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
> -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
> -I/usr/local/include  -fPIC  -Wall -g -O2  -c local_stubs.c -o local_stubs.o
> clang++ -std=gnu++11 -I"/Library/Frameworks/R.framework/Resources/include"
> -DNDEBUG -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> -DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
> -I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
> -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
> -I/usr/local/include  -fPIC  -Wall -g -O2  -c ogr_geom.cpp -o ogr_geom.o
> clang -I"/Library/Frameworks/R.framework/Resources/include" -DNDEBUG
> -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> -DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
> -I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
> -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
> -I/usr/local/include  -fPIC  -Wall -g -O2  -c ogr_polygons.c -o
> ogr_polygons.o
> clang++ -std=gnu++11 -I"/Library/Frameworks/R.framework/Resources/include"
> -DNDEBUG -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> -DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
> -I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
> -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
> -I/usr/local/include  -fPIC  -Wall -g -O2  -c ogr_proj.cpp -o ogr_proj.o
> clang++ -std=gnu++11 -I"/Library/Frameworks/R.framework/Resources/include"
> -DNDEBUG -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> -DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
> -I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
> -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
> -I/usr/local/include  -fPIC  -Wall -g -O2  -c ogrdrivers.cpp -o ogrdrivers.o
> clang++ -std=gnu++11 -I"/Library/Frameworks/R.framework/Resources/include"
> -DNDEBUG -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> -DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
> -I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
> -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
> -I/usr/local/include  -fPIC  -Wall -g -O2  -c ogrsource.cpp -o ogrsource.o
> clang++ -std=gnu++11 -I"/Library/Frameworks/R.framework/Resources/include"
> -DNDEBUG -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> -DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
> -I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
> -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
> -I/usr/local/include  -fPIC  -Wall -g -O2  -c proj_info6.cpp -o proj_info6.o
> clang++ -std=gnu++11 -I"/Library/Frameworks/R.framework/Resources/include"
> -DNDEBUG -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> -DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
> -I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
> -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
> -I/usr/local/include  -fPIC  -Wall -g -O2  -c projectit.cpp -o projectit.o
> clang++ -std=gnu++11 -dynamiclib -Wl,-headerpad_max_install_names
> -undefined dynamic_lookup -single_module -multiply_defined suppress
> -L/Library/Frameworks/R.framework/Resources/lib -L/usr/local/lib -o
> rgdal.so OGR_write.o gdal-bindings.o init.o inverser.o local_stubs.o
> ogr_geom.o ogr_polygons.o ogr_proj.o ogrdrivers.o ogrsource.o proj_info6.o
> projectit.o -L/Users/dosc3612/Applications/miniconda3/envs/rgdal/lib -lgdal
> -L/Users/dosc3612/Applications/miniconda3/envs/rgdal/lib -lproj
> -F/Library/Frameworks/R.framework/.. -framework R -Wl,-framework
> -Wl,CoreFoundation
> installing to
> /Library/Frameworks/R.framework/Versions/3.6/Resources/library/00LOCK-rgdal/00new/rgdal/libs
> ** R
> ** data
> ** inst
> ** byte-compile and prepare package for lazy loading
> ** help
> *** installing help indices
> ** building package indices
> ** installing vignettes
> ** testing if installed package can be loaded from temporary location
> Error: package or namespace load failed for ?rgdal? in dyn.load(file,
> DLLpath = DLLpath, ...):
>  unable to load shared object
> '/Library/Frameworks/R.framework/Versions/3.6/Resources/library/00LOCK-rgdal/00new/rgdal/libs/rgdal.so':
> 
> dlopen(/Library/Frameworks/R.framework/Versions/3.6/Resources/library/00LOCK-rgdal/00new/rgdal/libs/rgdal.so,
> 6): Library not loaded: @rpath/libgdal.20.dylib
>   Referenced from:
> /Library/Frameworks/R.framework/Versions/3.6/Resources/library/00LOCK-rgdal/00new/rgdal/libs/rgdal.so
>   Reason: image not found
> Error: loading failed
> Execution halted
> ERROR: loading failed
> * removing
> ?/Library/Frameworks/R.framework/Versions/3.6/Resources/library/rgdal?
> 
> The downloaded source packages are in
> ?/private/var/folders/bb/13z2kq0j01jg5q_0ypjc76gr0000gn/T/RtmplsyMiu/downloaded_packages?
> Warning message:
> In install.packages("rgdal", type = "source", configure.args =
> c("--with-proj-include=/Users/dosc3612/Applications/miniconda3/envs/rgdal/include",
>  :
>   installation of package ?rgdal? had non-zero exit status
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics
Heisenbergstrasse 2, 48151 Muenster, Germany
Phone: +49 251 8333081

-------------- next part --------------
A non-text attachment was scrubbed...
Name: pEpkey.asc
Type: application/pgp-keys
Size: 2472 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20190611/4c41d76a/attachment.bin>

From @@|ov@|@berg @end|ng |rom gm@||@com  Tue Jun 11 22:21:46 2019
From: @@|ov@|@berg @end|ng |rom gm@||@com (Salo V)
Date: Tue, 11 Jun 2019 16:21:46 -0400
Subject: [R-sig-Geo] skater - spdep runtime - geographic territories
Message-ID: <CA+AUPyFONQ3aA288a5Rk-djfEcnd7ct+RVGvtvcXjuxdO18hqQ@mail.gmail.com>

Hi Everyone,

I am trying to run the skater function for graph partitions, part of the
spdep package. My goal is to create contiguous territories for the entire
USA at the ZIP Code level.

The function takes a very long time to run even for ~15% of my total areas.
I am looking to run this for the 30,000 ZIP Codes in the USA.

The skater function documentation gives an example of parallel processing,
but it doesn?t seem to be speeding things up. I have a windows laptop with
2 physical cores and 4 logical cores. In the below code, I have already
tried to set nc = 1, nc=2 and nc=4 all with very similar results in time.

Has anyone been able to run the skater function for a large amount of areas
in a reasonable amount of time? Would really appreciate any guidance on
this, perhaps I am missing steps.



Here is the example from the documentation and which I am also running.

*library*(parallel)

nc <- detectCores(logical=FALSE)

# set nc to 1L here

*if* (nc > 1L) nc <- 1L

coresOpt <- get.coresOption()

invisible(set.coresOption(nc))

*if*(!get.mcOption()) {

# no-op, "snow" parallel calculation not available

  cl <- makeCluster(get.coresOption())

  set.ClusterOption(cl)

}

### calculating costs

system.time(plcosts <- nbcosts(bh.nb, dpad))

all.equal(lcosts, plcosts, check.attributes=FALSE)

### making listw

pnb.w <- nb2listw(bh.nb, plcosts, style="B")

### find a minimum spanning tree

pmst.bh <- mstree(pnb.w,5)

### three groups with no restriction

system.time(pres1 <- skater(pmst.bh[,1:2], dpad, 2))

*if*(!get.mcOption()) {

  set.ClusterOption(NULL)

  stopCluster(cl)

}


much appreciated!

	[[alternative HTML version deleted]]


From e||@@kr@|n@k| @end|ng |rom gm@||@com  Wed Jun 12 00:52:10 2019
From: e||@@kr@|n@k| @end|ng |rom gm@||@com (Elias T. Krainski)
Date: Tue, 11 Jun 2019 19:52:10 -0300
Subject: [R-sig-Geo] skater - spdep runtime - geographic territories
In-Reply-To: <CA+AUPyFONQ3aA288a5Rk-djfEcnd7ct+RVGvtvcXjuxdO18hqQ@mail.gmail.com>
References: <CA+AUPyFONQ3aA288a5Rk-djfEcnd7ct+RVGvtvcXjuxdO18hqQ@mail.gmail.com>
Message-ID: <059054dc-b641-8f7d-d0ee-1d45352e2c17@gmail.com>

Hi Salo,

I have implemented it several years ago and this is not optimal some 
ways. I will update it in near future to account for an heuristic to 
avoid the exhaustive search that it performs. For now, you can find a 
significant runtime reduction considering an alternative function to 
compute the ssw because the way it does by default uses a lot of memory 
and is bad for big datasets.

Please consider the attached code that illustrates this fact. When using 
the ssdfun() I experienced a reduction factor around 4 for n=2k. I found 
an additional reduction factor of 1.6 by using two (physical) cores. 
This is the result I got on my laptop:

 ????? n t1 t2 t3 t4
15? 225? 1? 1? 1? 1
20? 400? 1? 1? 1? 1
25? 625? 4? 3? 3? 2
30? 900 10? 5? 6? 4
35 1225 21? 8 13? 5
40 1600 39 12 23? 8
45 2025 86 24 50 15

best regards,

Elias

On 6/11/19 5:21 PM, Salo V wrote:
> Hi Everyone,
>
> I am trying to run the skater function for graph partitions, part of the
> spdep package. My goal is to create contiguous territories for the entire
> USA at the ZIP Code level.
>
> The function takes a very long time to run even for ~15% of my total areas.
> I am looking to run this for the 30,000 ZIP Codes in the USA.
>
> The skater function documentation gives an example of parallel processing,
> but it doesn?t seem to be speeding things up. I have a windows laptop with
> 2 physical cores and 4 logical cores. In the below code, I have already
> tried to set nc = 1, nc=2 and nc=4 all with very similar results in time.
>
> Has anyone been able to run the skater function for a large amount of areas
> in a reasonable amount of time? Would really appreciate any guidance on
> this, perhaps I am missing steps.
>
>
>
> Here is the example from the documentation and which I am also running.
>
> *library*(parallel)
>
> nc <- detectCores(logical=FALSE)
>
> # set nc to 1L here
>
> *if* (nc > 1L) nc <- 1L
>
> coresOpt <- get.coresOption()
>
> invisible(set.coresOption(nc))
>
> *if*(!get.mcOption()) {
>
> # no-op, "snow" parallel calculation not available
>
>    cl <- makeCluster(get.coresOption())
>
>    set.ClusterOption(cl)
>
> }
>
> ### calculating costs
>
> system.time(plcosts <- nbcosts(bh.nb, dpad))
>
> all.equal(lcosts, plcosts, check.attributes=FALSE)
>
> ### making listw
>
> pnb.w <- nb2listw(bh.nb, plcosts, style="B")
>
> ### find a minimum spanning tree
>
> pmst.bh <- mstree(pnb.w,5)
>
> ### three groups with no restriction
>
> system.time(pres1 <- skater(pmst.bh[,1:2], dpad, 2))
>
> *if*(!get.mcOption()) {
>
>    set.ClusterOption(NULL)
>
>    stopCluster(cl)
>
> }
>
>
> much appreciated!
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-------------- next part --------------
A non-text attachment was scrubbed...
Name: elapsed-time-ssdfun.R
Type: text/x-r-source
Size: 2521 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20190611/bc768363/attachment.bin>

From e||@@kr@|n@k| @end|ng |rom gm@||@com  Wed Jun 12 01:12:47 2019
From: e||@@kr@|n@k| @end|ng |rom gm@||@com (Elias T. Krainski)
Date: Tue, 11 Jun 2019 20:12:47 -0300
Subject: [R-sig-Geo] skater - spdep runtime - geographic territories
In-Reply-To: <CA+AUPyFONQ3aA288a5Rk-djfEcnd7ct+RVGvtvcXjuxdO18hqQ@mail.gmail.com>
References: <CA+AUPyFONQ3aA288a5Rk-djfEcnd7ct+RVGvtvcXjuxdO18hqQ@mail.gmail.com>
Message-ID: <593e7baf-d602-c9b7-b9a4-0711425d5b06@gmail.com>

Hi Salo,

In the file I sent attached to my previous email the ssdfun() has to be 
replaced by the following in order to give the same results as the 
default option in skater():

ssdfun <- function(d,i)
 ??? sum(sqrt(colSums((t(d[i,,drop=FALSE])-
 ????????????????????? colMeans(d[i,,drop=FALSE]))^2)))

So, the recommendation is to use skater(..., method=ssdfun)

Best regards,

Elias

On 6/11/19 5:21 PM, Salo V wrote:
> Hi Everyone,
>
> I am trying to run the skater function for graph partitions, part of the
> spdep package. My goal is to create contiguous territories for the entire
> USA at the ZIP Code level.
>
> The function takes a very long time to run even for ~15% of my total areas.
> I am looking to run this for the 30,000 ZIP Codes in the USA.
>
> The skater function documentation gives an example of parallel processing,
> but it doesn?t seem to be speeding things up. I have a windows laptop with
> 2 physical cores and 4 logical cores. In the below code, I have already
> tried to set nc = 1, nc=2 and nc=4 all with very similar results in time.
>
> Has anyone been able to run the skater function for a large amount of areas
> in a reasonable amount of time? Would really appreciate any guidance on
> this, perhaps I am missing steps.
>
>
>
> Here is the example from the documentation and which I am also running.
>
> *library*(parallel)
>
> nc <- detectCores(logical=FALSE)
>
> # set nc to 1L here
>
> *if* (nc > 1L) nc <- 1L
>
> coresOpt <- get.coresOption()
>
> invisible(set.coresOption(nc))
>
> *if*(!get.mcOption()) {
>
> # no-op, "snow" parallel calculation not available
>
>    cl <- makeCluster(get.coresOption())
>
>    set.ClusterOption(cl)
>
> }
>
> ### calculating costs
>
> system.time(plcosts <- nbcosts(bh.nb, dpad))
>
> all.equal(lcosts, plcosts, check.attributes=FALSE)
>
> ### making listw
>
> pnb.w <- nb2listw(bh.nb, plcosts, style="B")
>
> ### find a minimum spanning tree
>
> pmst.bh <- mstree(pnb.w,5)
>
> ### three groups with no restriction
>
> system.time(pres1 <- skater(pmst.bh[,1:2], dpad, 2))
>
> *if*(!get.mcOption()) {
>
>    set.ClusterOption(NULL)
>
>    stopCluster(cl)
>
> }
>
>
> much appreciated!
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From @@m|ro2013 @end|ng |rom gm@||@com  Thu Jun 13 11:05:09 2019
From: @@m|ro2013 @end|ng |rom gm@||@com (asmiro Abeje Fikadu)
Date: Thu, 13 Jun 2019 11:05:09 +0200
Subject: [R-sig-Geo] Error in "lag.listw(listw, xt,
 ...) : object lengths differ" to estimate panel SLX model
Message-ID: <CACd4P95xQXR_BZfQpBUctRhjeShHYAA6WtZAZhTo3bRpKb8o9A@mail.gmail.com>

Dear Members,

I am trying to estimate spatial lagged explanatory (SLX) model with R.
I did the following codes.
teffdata <- read_dta("pdata.dta.dta")  # Loaded the dataset
coordinates(teffdata) <- ~Latitude + Longitude
mycoords <- coordinates(teffdata)
dis_rd <- rdist.earth(mycoords, miles = FALSE)
# relabel rows/columns
temp <- teffdata$id
str(temp)
row.names(dis_rd) <- temp
colnames(dis_rd) <- temp
#Create neighbor list based on inverse distance
for(i in 1:dim(dis_rd)[1]) {dis_rd[i,i] = 0} # renders exactly zero all
diagonal elements, where dim is "dimension"
dis_rd[dis_rd > 160] <- 0                   # all distances > 80km are set
to zero ==> Why I choose 20 miles??
dis_rd <- ifelse(dis_rd!=0, 1/dis_rd, dis_rd) # calculating the inverse
distances
# Create the spatial weights based on inverse distance
nbl <- mat2listw(dis_rd, style="W")  # create a (normalized) listw object
or number of neighbors list
# Then, I converted the data.frame into pdata.frame
pd  <- pdata.frame(as.data.frame(teffdata), index = c("ID","year"))
# then,
# Creating specific pdata.frame spatial vectors, for instance:
speduc  <- pd$Educ
spage <- pd$Age
spext  <- pd$Ext
spcredit < pd$Credit # could not create this variable, look the label of it
spfert <- pd$FertilUsage
spswC <- pd$SWC
spsow <- pd$SowingMethod
spdmkt <- pd$dist_market
sprain <- pd$MRainfall
sphhsize <- pd$HHSIZE
spslope <- pd$Slope
spfertil <- pd$SoilFertilStatus
spgender <- pd$Gender
spseedtype <- pd$SeedType
spaez <- pd$AEZ
sptlu <- pd$TLU

# Specifying a formula for these models:
model <- ineff_translog_time ~ Educ + Age + Ext + Credit + FertilUsage +
SWC + SowingMethod +
  dist_market + MRainfall + HHSIZE + Slope + SoilFertilStatus + Gender +
SeedType + AEZ + TLU +
  slag(speduc, listw = nbl) + slag(spage, listw = nbl) + slag(spext, listw
= nbl) +
  slag(spfert, listw = nbl) + slag(spswC, listw = nbl) + slag(spsow, listw
= nbl) +
  slag(spdmkt, listw = nbl) + slag(sprain, listw = nbl) + slag(spfertil,
listw = nbl) +
  slag(spseedtype)

# Applying plm and splm functions on the original data (data.table
data.frame object):
regslx<-plm(model,data= as.data.frame(pd),listw = nbl,index=c("ID","year"),
            model="within", effect="twoways",spatial.error="none",lag=F)
summary(regslx)
# Finally, I got an error Error in "lag.listw(listw, xt, ...) : object
lengths differ"
Note: number of observations = 858
          number of time periods = 2
          I applied inverse distance based spatial weight matrix

So, could you please somone help me where I am getting wrong?




*Kind Regards,*
*Asmiro Abeje Fikadu*
*MSc student in Uni-Bonn, Germany*
*Address: Hainstrasse 52 /Zi. 229*
*                   P.O.BOX:  53121, Bonn*
*                   Cell phone: 015214173450*

	[[alternative HTML version deleted]]


From Roger@B|v@nd @end|ng |rom nhh@no  Thu Jun 13 11:16:13 2019
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Thu, 13 Jun 2019 11:16:13 +0200
Subject: [R-sig-Geo] Error in "lag.listw(listw, xt,
 ...) : object lengths differ" to estimate panel SLX model
In-Reply-To: <CACd4P95xQXR_BZfQpBUctRhjeShHYAA6WtZAZhTo3bRpKb8o9A@mail.gmail.com>
References: <CACd4P95xQXR_BZfQpBUctRhjeShHYAA6WtZAZhTo3bRpKb8o9A@mail.gmail.com>
Message-ID: <alpine.LFD.2.21.1906131109530.3129@reclus.nhh.no>

On Thu, 13 Jun 2019, asmiro Abeje Fikadu wrote:

> Dear Members,
>
> I am trying to estimate spatial lagged explanatory (SLX) model with R.
> I did the following codes.
> teffdata <- read_dta("pdata.dta.dta")  # Loaded the dataset
> coordinates(teffdata) <- ~Latitude + Longitude
> mycoords <- coordinates(teffdata)
> dis_rd <- rdist.earth(mycoords, miles = FALSE)
> # relabel rows/columns
> temp <- teffdata$id
> str(temp)
> row.names(dis_rd) <- temp
> colnames(dis_rd) <- temp
> #Create neighbor list based on inverse distance
> for(i in 1:dim(dis_rd)[1]) {dis_rd[i,i] = 0} # renders exactly zero all
> diagonal elements, where dim is "dimension"
> dis_rd[dis_rd > 160] <- 0                   # all distances > 80km are set
> to zero ==> Why I choose 20 miles??
> dis_rd <- ifelse(dis_rd!=0, 1/dis_rd, dis_rd) # calculating the inverse
> distances
> # Create the spatial weights based on inverse distance
> nbl <- mat2listw(dis_rd, style="W")  # create a (normalized) listw object
> or number of neighbors list

None of the above tells us much (IDW are usually a bad idea anyway) - you 
need to re-cast this using a built-in data set for anyone to reproduce 
your problem.

> # Then, I converted the data.frame into pdata.frame
> pd  <- pdata.frame(as.data.frame(teffdata), index = c("ID","year"))
> # then,
> # Creating specific pdata.frame spatial vectors, for instance:
> speduc  <- pd$Educ
> spage <- pd$Age
> spext  <- pd$Ext
> spcredit < pd$Credit # could not create this variable, look the label of it
> spfert <- pd$FertilUsage
> spswC <- pd$SWC
> spsow <- pd$SowingMethod
> spdmkt <- pd$dist_market
> sprain <- pd$MRainfall
> sphhsize <- pd$HHSIZE
> spslope <- pd$Slope
> spfertil <- pd$SoilFertilStatus
> spgender <- pd$Gender
> spseedtype <- pd$SeedType
> spaez <- pd$AEZ
> sptlu <- pd$TLU
>
> # Specifying a formula for these models:
> model <- ineff_translog_time ~ Educ + Age + Ext + Credit + FertilUsage +
> SWC + SowingMethod +
>  dist_market + MRainfall + HHSIZE + Slope + SoilFertilStatus + Gender +
> SeedType + AEZ + TLU +
>  slag(speduc, listw = nbl) + slag(spage, listw = nbl) + slag(spext, listw
> = nbl) +
>  slag(spfert, listw = nbl) + slag(spswC, listw = nbl) + slag(spsow, listw
> = nbl) +
>  slag(spdmkt, listw = nbl) + slag(sprain, listw = nbl) + slag(spfertil,
> listw = nbl) +
>  slag(spseedtype)
>

What is length(spseedtype) - is it nxT? What is length(nbl$neighbours) - 
is it n? Did you forget to generate the nxT x nxT space-time weights by 
hand, would that work better than splm::slag()? Without a reproducible 
example (just use Produc), it is hard to tell.

Roger

> # Applying plm and splm functions on the original data (data.table
> data.frame object):
> regslx<-plm(model,data= as.data.frame(pd),listw = nbl,index=c("ID","year"),
>            model="within", effect="twoways",spatial.error="none",lag=F)
> summary(regslx)
> # Finally, I got an error Error in "lag.listw(listw, xt, ...) : object
> lengths differ"
> Note: number of observations = 858
>          number of time periods = 2
>          I applied inverse distance based spatial weight matrix
>
> So, could you please somone help me where I am getting wrong?
>
>
>
>
> *Kind Regards,*
> *Asmiro Abeje Fikadu*
> *MSc student in Uni-Bonn, Germany*
> *Address: Hainstrasse 52 /Zi. 229*
> *                   P.O.BOX:  53121, Bonn*
> *                   Cell phone: 015214173450*
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en


From em@nue|e@b@rc@ @end|ng |rom b@@|r@@@cnr@|t  Sun Jun 16 09:25:40 2019
From: em@nue|e@b@rc@ @end|ng |rom b@@|r@@@cnr@|t (Emanuele Barca)
Date: Sun, 16 Jun 2019 09:25:40 +0200
Subject: [R-sig-Geo] auto-correlation of nominal variables
Message-ID: <0e0033fa070243babff88fa41dd8d403@ba.irsa.cnr.it>

Dear friends,

I received a  dataset of point data, organized in the following way:

a couple of coordinates and a column of "crop classes codes", three 
columns.

I would like to compute something similar to the Moran index for each 
crop class code.

How can I carry out such task in R?

thanks in advance

emanuele


From dn|ven @end|ng |rom uc@c@edu  Mon Jun 17 22:49:56 2019
From: dn|ven @end|ng |rom uc@c@edu (Doug Niven)
Date: Mon, 17 Jun 2019 13:49:56 -0700
Subject: [R-sig-Geo] RGDAL configure error in Centos
Message-ID: <2A40F8E8-F82E-4596-8AF3-62550EFEE1E9@ucsc.edu>

Hi Folks,

Am seeing the following when trying to install RGDAL in fully up-to-date Centos 7 server.

Specifically I believe "proj_api.h and pkg-config give different versions? is the issue, but am unsure how to fix this.

Any tips/suggestions most appreciated!

[root at stats ~]# R CMD INSTALL rgdal_1.4-4.tar.gz 
* installing to library ?/usr/lib64/R/library?
* installing *source* package ?rgdal? ...
** package ?rgdal? successfully unpacked and MD5 sums checked
configure: R_HOME: /usr/lib64/R
configure: CC: gcc -m64 -std=gnu99
configure: CXX: g++ -m64
configure: C++11 support available
configure: rgdal: 1.4-4
checking for /usr/bin/svnversion... yes
configure: svn revision: 833
checking for gdal-config... /usr/local/bin/gdal-config
checking gdal-config usability... yes
configure: GDAL: 2.4.0
checking C++11 support for GDAL >= 2.3.0... yes
checking GDAL version >= 1.11.4... yes
checking GDAL version <= 2.5 or >= 3.0... yes
checking gdal: linking with --libs only... yes
checking GDAL: gdal-config data directory readable... yes
checking GDAL: /usr/local/share/gdal/pcs.csv readable... yes
configure: pkg-config proj exists, will use it
configure: PROJ version: 4.8.0
configure: PROJ version < 6.0.0
configure: proj CPP flags:    
checking PROJ header API:... proj_api.h
checking proj_api.h presence and usability... yes
checking PROJ version agreement... no
configure: error: proj_api.h and pkg-config give different versions
ERROR: configuration failed for package ?rgdal?
* removing ?/usr/lib64/R/library/rgdal?

Doug


From dn|ven @end|ng |rom uc@c@edu  Tue Jun 18 06:26:17 2019
From: dn|ven @end|ng |rom uc@c@edu (Doug Niven)
Date: Mon, 17 Jun 2019 21:26:17 -0700
Subject: [R-sig-Geo] RGDAL configure error in Centos
In-Reply-To: <2A40F8E8-F82E-4596-8AF3-62550EFEE1E9@ucsc.edu>
References: <2A40F8E8-F82E-4596-8AF3-62550EFEE1E9@ucsc.edu>
Message-ID: <656EC5DD-46D2-453A-BB43-631A15D30911@ucsc.edu>

Ah, nevermind. I needed a newer version of PROJ, all working now.

> On Jun 17, 2019, at 1:49 PM, Doug Niven <dniven at ucsc.edu> wrote:
> 
> Hi Folks,
> 
> Am seeing the following when trying to install RGDAL in fully up-to-date Centos 7 server.
> 
> Specifically I believe "proj_api.h and pkg-config give different versions? is the issue, but am unsure how to fix this.
> 
> Any tips/suggestions most appreciated!
> 
> [root at stats ~]# R CMD INSTALL rgdal_1.4-4.tar.gz 
> * installing to library ?/usr/lib64/R/library?
> * installing *source* package ?rgdal? ...
> ** package ?rgdal? successfully unpacked and MD5 sums checked
> configure: R_HOME: /usr/lib64/R
> configure: CC: gcc -m64 -std=gnu99
> configure: CXX: g++ -m64
> configure: C++11 support available
> configure: rgdal: 1.4-4
> checking for /usr/bin/svnversion... yes
> configure: svn revision: 833
> checking for gdal-config... /usr/local/bin/gdal-config
> checking gdal-config usability... yes
> configure: GDAL: 2.4.0
> checking C++11 support for GDAL >= 2.3.0... yes
> checking GDAL version >= 1.11.4... yes
> checking GDAL version <= 2.5 or >= 3.0... yes
> checking gdal: linking with --libs only... yes
> checking GDAL: gdal-config data directory readable... yes
> checking GDAL: /usr/local/share/gdal/pcs.csv readable... yes
> configure: pkg-config proj exists, will use it
> configure: PROJ version: 4.8.0
> configure: PROJ version < 6.0.0
> configure: proj CPP flags:    
> checking PROJ header API:... proj_api.h
> checking proj_api.h presence and usability... yes
> checking PROJ version agreement... no
> configure: error: proj_api.h and pkg-config give different versions
> ERROR: configuration failed for package ?rgdal?
> * removing ?/usr/lib64/R/library/rgdal?
> 
> Doug
> 


From Roger@B|v@nd @end|ng |rom nhh@no  Mon Jun 17 10:39:41 2019
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Mon, 17 Jun 2019 10:39:41 +0200
Subject: [R-sig-Geo] auto-correlation of nominal variables
In-Reply-To: <0e0033fa070243babff88fa41dd8d403@ba.irsa.cnr.it>
References: <0e0033fa070243babff88fa41dd8d403@ba.irsa.cnr.it>
Message-ID: <alpine.LFD.2.21.1906171037030.13964-1236@reclus.nhh.no>


On Sun, 16 Jun 2019, Emanuele Barca wrote:

> Dear friends,
>
> I received a  dataset of point data, organized in the following way:
>
> a couple of coordinates and a column of "crop classes codes", three columns.
>
> I would like to compute something similar to the Moran index for each crop 
> class code.
>
> How can I carry out such task in R?

spdep::joincount.multi() and spdep::joincount.test().

and read the references on the help pages. See eg.

https://keen-swartz-3146c4.netlify.com/area-data-and-spatial-autcorrelation.html#measures-of-spatial-autocorrelation

Roger

>
> thanks in advance
>
> emanuele
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en


From |@r@@@|p@@||v@ @end|ng |rom gm@||@com  Tue Jun 18 15:46:08 2019
From: |@r@@@|p@@||v@ @end|ng |rom gm@||@com (Lara Silva)
Date: Tue, 18 Jun 2019 13:46:08 +0000
Subject: [R-sig-Geo] GAM parameters: Biomod 2
Message-ID: <CALN9TESvDGWfNcd=p0Emt4Ri_WEhOXbQhidpRJ1N=eU74V+zzA@mail.gmail.com>

Hello,

I am using Biomod 2 to modelling species distribution. I ran some
algorithms like GAM, GLM, RF and CTA.

I did not change the parameters. How can I known the quadratic terms of GAM?


I used the variables with form linear (e.g.  precipitation, altimetry,
temperature) I did not use temperature ^2.


Any suggestions?

Regards,


Lara






<https://www.avast.com/sig-email?utm_medium=email&utm_source=link&utm_campaign=sig-email&utm_content=webmail>
Sem
v?rus. www.avast.com
<https://www.avast.com/sig-email?utm_medium=email&utm_source=link&utm_campaign=sig-email&utm_content=webmail>
<#DAB4FAD8-2DD7-40BB-A1B8-4E2AA1F9FDF2>

	[[alternative HTML version deleted]]


From r@hep@rd @end|ng |rom @pp|-eco@y@@com  Tue Jun 18 16:51:09 2019
From: r@hep@rd @end|ng |rom @pp|-eco@y@@com (Rich Shepard)
Date: Tue, 18 Jun 2019 07:51:09 -0700 (PDT)
Subject: [R-sig-Geo] auto-correlation of nominal variables
In-Reply-To: <0e0033fa070243babff88fa41dd8d403@ba.irsa.cnr.it>
References: <0e0033fa070243babff88fa41dd8d403@ba.irsa.cnr.it>
Message-ID: <alpine.LNX.2.20.1906180742260.15745@salmo.appl-ecosys.com>

On Sun, 16 Jun 2019, Emanuele Barca wrote:

> I received a  dataset of point data, organized in the following way: a
> couple of coordinates and a column of "crop classes codes", three columns.

> I would like to compute something similar to the Moran index for each crop 
> class code.

Emanuele,

What is your interest in these data? Are you interested in the pattern of
crop classes (such as in epidemiology or designing a timber sale) or
something else?

If it is the pattern that is of interest I suggest you first test for
complete spatial randomness. Look at some of the references and R packages
for spatial point processes. The distribution of crop classes could be
random, regular, or clumped/clustered.

Peter Diggle's book, "Statistical Analysis of Spatial Point Patterns," and
"Spatial Point Patterns" by Adrian Baddeley, Ege Rubak, and Rolf Turner
would be excellent places to start.

Hope this helps,

Rich


From |@r@@@|p@@||v@ @end|ng |rom gm@||@com  Wed Jun 19 12:41:06 2019
From: |@r@@@|p@@||v@ @end|ng |rom gm@||@com (Lara Silva)
Date: Wed, 19 Jun 2019 10:41:06 +0000
Subject: [R-sig-Geo] Plot a map in r (csv and shapefile)
Message-ID: <CALN9TESGL99JXXM3X+YsM_H-mkqygr4q6_N0cT0w=oowNvWiQQ@mail.gmail.com>

Hello,

I am new in R and I need to plot the occurrence of a species.
I have the presences of species (CSV) and the shapefile with the limits of
study area.

Which code should I use?

Regards,

Lara

<https://www.avast.com/sig-email?utm_medium=email&utm_source=link&utm_campaign=sig-email&utm_content=webmail>
Sem
v?rus. www.avast.com
<https://www.avast.com/sig-email?utm_medium=email&utm_source=link&utm_campaign=sig-email&utm_content=webmail>
<#DAB4FAD8-2DD7-40BB-A1B8-4E2AA1F9FDF2>

	[[alternative HTML version deleted]]


From z|@207 @end|ng |rom gm@||@com  Wed Jun 19 13:03:37 2019
From: z|@207 @end|ng |rom gm@||@com (Zia Ahmed)
Date: Wed, 19 Jun 2019 07:03:37 -0400
Subject: [R-sig-Geo] Plot a map in r (csv and shapefile)
In-Reply-To: <CALN9TESGL99JXXM3X+YsM_H-mkqygr4q6_N0cT0w=oowNvWiQQ@mail.gmail.com>
References: <CALN9TESGL99JXXM3X+YsM_H-mkqygr4q6_N0cT0w=oowNvWiQQ@mail.gmail.com>
Message-ID: <CAKqUiG=Gpohvn-5YLuFeF6O_5styw3JCKQUJSkTq_A7A7u0vag@mail.gmail.com>

Please check this below link.  It might help you what you need to do.
Zia

https://zia207.github.io/geospatial-data-science.github.io/

On Wed, Jun 19, 2019, 6:40 AM Lara Silva <lara.sfp.silva at gmail.com> wrote:

> Hello,
>
> I am new in R and I need to plot the occurrence of a species.
> I have the presences of species (CSV) and the shapefile with the limits of
> study area.
>
> Which code should I use?
>
> Regards,
>
> Lara
>
> <
> https://www.avast.com/sig-email?utm_medium=email&utm_source=link&utm_campaign=sig-email&utm_content=webmail
> >
> Sem
> v?rus. www.avast.com
> <
> https://www.avast.com/sig-email?utm_medium=email&utm_source=link&utm_campaign=sig-email&utm_content=webmail
> >
> <#DAB4FAD8-2DD7-40BB-A1B8-4E2AA1F9FDF2>
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From em@nue|e@b@rc@ @end|ng |rom b@@|r@@@cnr@|t  Wed Jun 19 13:24:34 2019
From: em@nue|e@b@rc@ @end|ng |rom b@@|r@@@cnr@|t (Emanuele Barca)
Date: Wed, 19 Jun 2019 13:24:34 +0200
Subject: [R-sig-Geo] 
 auto-correlation of nominal variables (Rich Shepard)
In-Reply-To: <mailman.27400.3.1560938402.42477.r-sig-geo@r-project.org>
References: <mailman.27400.3.1560938402.42477.r-sig-geo@r-project.org>
Message-ID: <d7c09958cf06e6fe87ae81bf5798ac5b@ba.irsa.cnr.it>

Thank you Rich for your suggestion, is indeed intersting!

Actually, my interest is in finding a clustering tendency of 
crop-classes.

Therefore, joincount.multi of spdep library is perfect for my aims.

I would like to find a function for representing graphically such 
tendency.

thanks once more.

emanuele



Il 2019-06-19 12:00 r-sig-geo-request at r-project.org ha scritto:
> Send R-sig-Geo mailing list submissions to
> 	r-sig-geo at r-project.org
> 
> To subscribe or unsubscribe via the World Wide Web, visit
> 	https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> or, via email, send a message with subject or body 'help' to
> 	r-sig-geo-request at r-project.org
> 
> You can reach the person managing the list at
> 	r-sig-geo-owner at r-project.org
> 
> When replying, please edit your Subject line so it is more specific
> than "Re: Contents of R-sig-Geo digest..."
> 
> 
> Today's Topics:
> 
>    1. GAM parameters: Biomod 2 (Lara Silva)
>    2. Re: auto-correlation of nominal variables (Rich Shepard)
> 
> ----------------------------------------------------------------------
> 
> Message: 1
> Date: Tue, 18 Jun 2019 13:46:08 +0000
> From: Lara Silva <lara.sfp.silva at gmail.com>
> To: r-sig-ecology at r-project.org, r-sig-geo at r-project.org
> Subject: [R-sig-Geo] GAM parameters: Biomod 2
> Message-ID:
> 	<CALN9TESvDGWfNcd=p0Emt4Ri_WEhOXbQhidpRJ1N=eU74V+zzA at mail.gmail.com>
> Content-Type: text/plain; charset="utf-8"
> 
> Hello,
> 
> I am using Biomod 2 to modelling species distribution. I ran some
> algorithms like GAM, GLM, RF and CTA.
> 
> I did not change the parameters. How can I known the quadratic terms of 
> GAM?
> 
> 
> I used the variables with form linear (e.g.  precipitation, altimetry,
> temperature) I did not use temperature ^2.
> 
> 
> Any suggestions?
> 
> Regards,
> 
> 
> Lara
> 
> 
> 
> 
> 
> 
> <https://www.avast.com/sig-email?utm_medium=email&utm_source=link&utm_campaign=sig-email&utm_content=webmail>
> Sem
> v?rus. www.avast.com
> <https://www.avast.com/sig-email?utm_medium=email&utm_source=link&utm_campaign=sig-email&utm_content=webmail>
> <#DAB4FAD8-2DD7-40BB-A1B8-4E2AA1F9FDF2>
> 
> 	[[alternative HTML version deleted]]
> 
> 
> 
> 
> ------------------------------
> 
> Message: 2
> Date: Tue, 18 Jun 2019 07:51:09 -0700 (PDT)
> From: Rich Shepard <rshepard at appl-ecosys.com>
> To: r-sig-geo at r-project.org
> Subject: Re: [R-sig-Geo] auto-correlation of nominal variables
> Message-ID:
> 	<alpine.LNX.2.20.1906180742260.15745 at salmo.appl-ecosys.com>
> Content-Type: text/plain; charset="us-ascii"; Format="flowed"
> 
> On Sun, 16 Jun 2019, Emanuele Barca wrote:
> 
>> I received a  dataset of point data, organized in the following way: a
>> couple of coordinates and a column of "crop classes codes", three 
>> columns.
> 
>> I would like to compute something similar to the Moran index for each 
>> crop
>> class code.
> 
> Emanuele,
> 
> What is your interest in these data? Are you interested in the pattern 
> of
> crop classes (such as in epidemiology or designing a timber sale) or
> something else?
> 
> If it is the pattern that is of interest I suggest you first test for
> complete spatial randomness. Look at some of the references and R 
> packages
> for spatial point processes. The distribution of crop classes could be
> random, regular, or clumped/clustered.
> 
> Peter Diggle's book, "Statistical Analysis of Spatial Point Patterns," 
> and
> "Spatial Point Patterns" by Adrian Baddeley, Ege Rubak, and Rolf Turner
> would be excellent places to start.
> 
> Hope this helps,
> 
> Rich
> 
> 
> 
> 
> ------------------------------
> 
> Subject: Digest Footer
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 
> 
> ------------------------------
> 
> End of R-sig-Geo Digest, Vol 190, Issue 13
> ******************************************


From r@hep@rd @end|ng |rom @pp|-eco@y@@com  Wed Jun 19 15:05:01 2019
From: r@hep@rd @end|ng |rom @pp|-eco@y@@com (Rich Shepard)
Date: Wed, 19 Jun 2019 06:05:01 -0700 (PDT)
Subject: [R-sig-Geo] 
 auto-correlation of nominal variables (Rich Shepard)
In-Reply-To: <d7c09958cf06e6fe87ae81bf5798ac5b@ba.irsa.cnr.it>
References: <mailman.27400.3.1560938402.42477.r-sig-geo@r-project.org>
 <d7c09958cf06e6fe87ae81bf5798ac5b@ba.irsa.cnr.it>
Message-ID: <alpine.LNX.2.20.1906190600210.14093@salmo.appl-ecosys.com>

On Wed, 19 Jun 2019, Emanuele Barca wrote:

> Actually, my interest is in finding a clustering tendency of crop-classes.
> Therefore, joincount.multi of spdep library is perfect for my aims.

Emanuele,

Glad I helped.

> I would like to find a function for representing graphically such tendency.

My spatio-temporal work almost always involves geostatistics, not point
processes. For the latter, in addition to the two books I suggested
yesterday, take a look at "Spatial and Spatio-temporal Bayesian Models with
R - INLA" by Marta Blangiardo and Michela Cameletti. They have a lot of
graphics with their examples, some of which you might find useful.

Best regards,

Rich


From r@turner @end|ng |rom @uck|@nd@@c@nz  Thu Jun 20 00:54:25 2019
From: r@turner @end|ng |rom @uck|@nd@@c@nz (Rolf Turner)
Date: Thu, 20 Jun 2019 10:54:25 +1200
Subject: [R-sig-Geo] [FORGED]  Plot a map in r (csv and shapefile)
In-Reply-To: <CALN9TESGL99JXXM3X+YsM_H-mkqygr4q6_N0cT0w=oowNvWiQQ@mail.gmail.com>
References: <CALN9TESGL99JXXM3X+YsM_H-mkqygr4q6_N0cT0w=oowNvWiQQ@mail.gmail.com>
Message-ID: <ef2bd518-2a93-b49d-702c-4fec4cffcc12@auckland.ac.nz>


On 19/06/19 10:41 PM, Lara Silva wrote:

> Hello,
> 
> I am new in R and I need to plot the occurrence of a species.
> I have the presences of species (CSV) and the shapefile with the limits of
> study area.
> 
> Which code should I use?

You might consider having a look at the spatstat package which has tools 
explicitly designed for this sort of thing.

cheers,

Rolf Turner

-- 
Honorary Research Fellow
Department of Statistics
University of Auckland
Phone: +64-9-373-7599 ext. 88276


From e@j@h@n@h|r| @end|ng |rom gm@||@com  Thu Jun 20 08:47:52 2019
From: e@j@h@n@h|r| @end|ng |rom gm@||@com (Ebrahim Jahanshiri)
Date: Thu, 20 Jun 2019 14:47:52 +0800
Subject: [R-sig-Geo] Plot a map in r (csv and shapefile)
In-Reply-To: <CALN9TESGL99JXXM3X+YsM_H-mkqygr4q6_N0cT0w=oowNvWiQQ@mail.gmail.com>
References: <CALN9TESGL99JXXM3X+YsM_H-mkqygr4q6_N0cT0w=oowNvWiQQ@mail.gmail.com>
Message-ID: <CANCB45uumhT6R_AT-0i7N+N8q9yQ7G4i-8KHMub9YJumwx4nhQ@mail.gmail.com>

A good intro for beginners here but generally mapview package is your friend
https://nceas.github.io/oss-lessons/spatial-data-gis-law/3-mon-intro-gis-in-r.html

On Wed, Jun 19, 2019 at 6:40 PM Lara Silva <lara.sfp.silva at gmail.com> wrote:

> Hello,
>
> I am new in R and I need to plot the occurrence of a species.
> I have the presences of species (CSV) and the shapefile with the limits of
> study area.
>
> Which code should I use?
>
> Regards,
>
> Lara
>
> <
> https://www.avast.com/sig-email?utm_medium=email&utm_source=link&utm_campaign=sig-email&utm_content=webmail
> >
> Sem
> v?rus. www.avast.com
> <
> https://www.avast.com/sig-email?utm_medium=email&utm_source=link&utm_campaign=sig-email&utm_content=webmail
> >
> <#DAB4FAD8-2DD7-40BB-A1B8-4E2AA1F9FDF2>
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From roy@mende|@@ohn @end|ng |rom no@@@gov  Thu Jun 20 16:18:35 2019
From: roy@mende|@@ohn @end|ng |rom no@@@gov (Roy Mendelssohn - NOAA Federal)
Date: Thu, 20 Jun 2019 07:18:35 -0700
Subject: [R-sig-Geo] testing a crs string
Message-ID: <57F87A0A-E0FE-4DBD-B59E-F62295EC59F0@noaa.gov>

Hi All:

I am extending a package I have to allow users to provide a crs string, which will eventually through some other packages be sent to sf.  I like to try and make at least minimal tests that inputs are valid.  Is there some existing code that will check if a string is a valid crs string?

Thanks,

-Roy


**********************
"The contents of this message do not reflect any position of the U.S. Government or NOAA."
**********************
Roy Mendelssohn
Supervisory Operations Research Analyst
NOAA/NMFS
Environmental Research Division
Southwest Fisheries Science Center
***Note new street address***
110 McAllister Way
Santa Cruz, CA 95060
Phone: (831)-420-3666
Fax: (831) 420-3980
e-mail: Roy.Mendelssohn at noaa.gov www: http://www.pfeg.noaa.gov/

"Old age and treachery will overcome youth and skill."
"From those who have been given much, much will be expected" 
"the arc of the moral universe is long, but it bends toward justice" -MLK Jr.


From edzer@pebe@m@ @end|ng |rom un|-muen@ter@de  Thu Jun 20 16:42:03 2019
From: edzer@pebe@m@ @end|ng |rom un|-muen@ter@de (Edzer Pebesma)
Date: Thu, 20 Jun 2019 16:42:03 +0200
Subject: [R-sig-Geo] testing a crs string
In-Reply-To: <57F87A0A-E0FE-4DBD-B59E-F62295EC59F0@noaa.gov>
References: <57F87A0A-E0FE-4DBD-B59E-F62295EC59F0@noaa.gov>
Message-ID: <687c49ab-41bc-a52c-fcc2-028d0d736d3c@uni-muenster.de>



On 6/20/19 4:18 PM, Roy Mendelssohn - NOAA Federal via R-sig-Geo wrote:
> Hi All:
> 
> I am extending a package I have to allow users to provide a crs string, which will eventually through some other packages be sent to sf.  I like to try and make at least minimal tests that inputs are valid.  Is there some existing code that will check if a string is a valid crs string?

> inherits(try(sf::st_crs("+proj=invalid"), silent = TRUE), "try-error")
[1] TRUE
> inherits(try(sf::st_crs("+proj=longlat"), silent = TRUE), "try-error")
[1] FALSE


> 
> Thanks,
> 
> -Roy
> 
> 
> **********************
> "The contents of this message do not reflect any position of the U.S. Government or NOAA."
> **********************
> Roy Mendelssohn
> Supervisory Operations Research Analyst
> NOAA/NMFS
> Environmental Research Division
> Southwest Fisheries Science Center
> ***Note new street address***
> 110 McAllister Way
> Santa Cruz, CA 95060
> Phone: (831)-420-3666
> Fax: (831) 420-3980
> e-mail: Roy.Mendelssohn at noaa.gov www: http://www.pfeg.noaa.gov/
> 
> "Old age and treachery will overcome youth and skill."
> "From those who have been given much, much will be expected" 
> "the arc of the moral universe is long, but it bends toward justice" -MLK Jr.
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics
Heisenbergstrasse 2, 48151 Muenster, Germany
Phone: +49 251 8333081

-------------- next part --------------
A non-text attachment was scrubbed...
Name: pEpkey.asc
Type: application/pgp-keys
Size: 2472 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20190620/b37d7539/attachment.bin>

From roy@mende|@@ohn @end|ng |rom no@@@gov  Thu Jun 20 16:44:27 2019
From: roy@mende|@@ohn @end|ng |rom no@@@gov (Roy Mendelssohn - NOAA Federal)
Date: Thu, 20 Jun 2019 07:44:27 -0700
Subject: [R-sig-Geo] testing a crs string
In-Reply-To: <687c49ab-41bc-a52c-fcc2-028d0d736d3c@uni-muenster.de>
References: <57F87A0A-E0FE-4DBD-B59E-F62295EC59F0@noaa.gov>
 <687c49ab-41bc-a52c-fcc2-028d0d736d3c@uni-muenster.de>
Message-ID: <F785ADF0-8FAC-41EF-A0B5-2F0723997E1A@noaa.gov>

perfect.  Thank you.   I thought there must be a function in one of the packages to check.

-Roy

> On Jun 20, 2019, at 7:42 AM, Edzer Pebesma <edzer.pebesma at uni-muenster.de> wrote:
> 
> 
> 
> On 6/20/19 4:18 PM, Roy Mendelssohn - NOAA Federal via R-sig-Geo wrote:
>> Hi All:
>> 
>> I am extending a package I have to allow users to provide a crs string, which will eventually through some other packages be sent to sf.  I like to try and make at least minimal tests that inputs are valid.  Is there some existing code that will check if a string is a valid crs string?
> 
>> inherits(try(sf::st_crs("+proj=invalid"), silent = TRUE), "try-error")
> [1] TRUE
>> inherits(try(sf::st_crs("+proj=longlat"), silent = TRUE), "try-error")
> [1] FALSE
> 
> 
>> 
>> Thanks,
>> 
>> -Roy
>> 
>> 
>> **********************
>> "The contents of this message do not reflect any position of the U.S. Government or NOAA."
>> **********************
>> Roy Mendelssohn
>> Supervisory Operations Research Analyst
>> NOAA/NMFS
>> Environmental Research Division
>> Southwest Fisheries Science Center
>> ***Note new street address***
>> 110 McAllister Way
>> Santa Cruz, CA 95060
>> Phone: (831)-420-3666
>> Fax: (831) 420-3980
>> e-mail: Roy.Mendelssohn at noaa.gov www: http://www.pfeg.noaa.gov/
>> 
>> "Old age and treachery will overcome youth and skill."
>> "From those who have been given much, much will be expected" 
>> "the arc of the moral universe is long, but it bends toward justice" -MLK Jr.
>> 
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> 
> 
> -- 
> Edzer Pebesma
> Institute for Geoinformatics
> Heisenbergstrasse 2, 48151 Muenster, Germany
> Phone: +49 251 8333081
> <pEpkey.asc>_______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

**********************
"The contents of this message do not reflect any position of the U.S. Government or NOAA."
**********************
Roy Mendelssohn
Supervisory Operations Research Analyst
NOAA/NMFS
Environmental Research Division
Southwest Fisheries Science Center
***Note new street address***
110 McAllister Way
Santa Cruz, CA 95060
Phone: (831)-420-3666
Fax: (831) 420-3980
e-mail: Roy.Mendelssohn at noaa.gov www: http://www.pfeg.noaa.gov/

"Old age and treachery will overcome youth and skill."
"From those who have been given much, much will be expected" 
"the arc of the moral universe is long, but it bends toward justice" -MLK Jr.


From j_@rronte @end|ng |rom hotm@||@com  Thu Jun 20 18:36:05 2019
From: j_@rronte @end|ng |rom hotm@||@com (JC Arronte)
Date: Thu, 20 Jun 2019 16:36:05 +0000
Subject: [R-sig-Geo] Surface Chlorophyll data calculation
Message-ID: <VI1P189MB028599FE13304A374BC6B49D8BE40@VI1P189MB0285.EURP189.PROD.OUTLOOK.COM>

Hello,

This is my first post to this list. I am a beginner in R and GIS and  I work as researcher at Spanish Institute of Oceanography.

I have a ncdf file from the Copernicus webpage with monthly primary production data from the Northeastern Atlantic. In my case, the chlorophyll concentration from the following link,

 http://marine.copernicus.eu/services-portfolio/access-to-products/?option=com_csw&view=details&product_id=IBI_REANALYSIS_BIO_005_003

I want to calculate the monthly surface chlorophyll concentration. Unfortunately, after a lot of reading on the issue, I have been unable to come to any understanding.

Any indication of tutorials, scripts, sites or packages will be very welcomed.

Thanks in advance. Kindest regards,

Juan Carlos


	[[alternative HTML version deleted]]


From rv@|dezr @end|ng |rom gm@||@com  Fri Jun 21 02:26:08 2019
From: rv@|dezr @end|ng |rom gm@||@com (Rolando Valdez)
Date: Thu, 20 Jun 2019 17:26:08 -0700
Subject: [R-sig-Geo] Create a Spatial Weight Matrix based on road distance
Message-ID: <CAFvJtoFemxph=u+ewBra6ebHLzaOC=49r3WFB6sJ5N7Zxs4m_Q@mail.gmail.com>

Dear community,

Is there any way to create a spatial weight matrix based on road distance?
I am trying to use the road distance between two points instead of
euclidean distance.

I've seen that there is a package named osrm. Can anyone give some advice?

Thank you in advance.

Regards,

-- 
Rol~

	[[alternative HTML version deleted]]


From r@turner @end|ng |rom @uck|@nd@@c@nz  Fri Jun 21 04:08:23 2019
From: r@turner @end|ng |rom @uck|@nd@@c@nz (Rolf Turner)
Date: Fri, 21 Jun 2019 14:08:23 +1200
Subject: [R-sig-Geo] 
 [FORGED] Create a Spatial Weight Matrix based on road distance
In-Reply-To: <CAFvJtoFemxph=u+ewBra6ebHLzaOC=49r3WFB6sJ5N7Zxs4m_Q@mail.gmail.com>
References: <CAFvJtoFemxph=u+ewBra6ebHLzaOC=49r3WFB6sJ5N7Zxs4m_Q@mail.gmail.com>
Message-ID: <49e352fb-6742-86d6-bd7e-571088a0b3eb@auckland.ac.nz>


On 21/06/19 12:26 PM, Rolando Valdez wrote:

> Dear community,
> 
> Is there any way to create a spatial weight matrix based on road distance?
> I am trying to use the road distance between two points instead of
> euclidean distance.
> 
> I've seen that there is a package named osrm. Can anyone give some advice?

I don't know anything about "osrm".  Calculating "road distances" can be 
done in the spatstat package reasonably easily, if you take the trouble 
to represent your collection of roads as a "linnet" object.

Given that you have done so, suppose that your linnet object is "L" and 
that you have vectors "x" and "y" specifying the points on L (i.e. on 
your roads) between which you want to know the distances.

Do:

     X    <- lpp(data.frame(x=x,y=y),L)
     dMat <- pairdist(X)

The object "dMat" is a (symmetric) square matrix; dMat[i,j] is the 
distance between point i and point j.  (Of course the diagonal entries 
are all 0.)

If your collection of roads is specified by means of a shapefile, 
vignette("shapefiles") will tell you how to turn this collection into a 
"psp" ("planar segment pattern") object; the function (method) 
as.linnet.psp() can then be used to turn the "psp" object into a 
"linnet" object.

HTH

cheers,

Rolf Turner

-- 
Honorary Research Fellow
Department of Statistics
University of Auckland
Phone: +64-9-373-7599 ext. 88276


From @dr|@n@b@dde|ey @end|ng |rom curt|n@edu@@u  Fri Jun 21 04:30:27 2019
From: @dr|@n@b@dde|ey @end|ng |rom curt|n@edu@@u (Adrian Baddeley)
Date: Fri, 21 Jun 2019 02:30:27 +0000
Subject: [R-sig-Geo] 
 [FORGED] Create a Spatial Weight Matrix based on road distance
In-Reply-To: <49e352fb-6742-86d6-bd7e-571088a0b3eb@auckland.ac.nz>
References: <CAFvJtoFemxph=u+ewBra6ebHLzaOC=49r3WFB6sJ5N7Zxs4m_Q@mail.gmail.com>,
 <49e352fb-6742-86d6-bd7e-571088a0b3eb@auckland.ac.nz>
Message-ID: <MEAPR01MB32216AB3C4EFE314DFCA2041A4E70@MEAPR01MB3221.ausprd01.prod.outlook.com>

Rather than converting an object of class 'SpatialLines' or 'SpatialLinesDataFrame' to the spatstat class 'psp' and then converting it to the spatstat class 'linnet', it is safer and more efficient to convert the SpatialLines* object directly to class linnet using as.linnet.SpatialLinesDataFrame() from the package 'maptools'.


Prof Adrian Baddeley DSc FAA

John Curtin Distinguished Professor

Department of Mathematics and Statistics

Curtin University, Perth, Western Australia


________________________________
From: Rolf Turner <r.turner at auckland.ac.nz>
Sent: Friday, 21 June 2019 10:08 AM
To: Rolando Valdez
Cc: r-sig-geo at r-project.org; Adrian Baddeley; Ege Rubak
Subject: Re: [FORGED] [R-sig-Geo] Create a Spatial Weight Matrix based on road distance


On 21/06/19 12:26 PM, Rolando Valdez wrote:

> Dear community,
>
> Is there any way to create a spatial weight matrix based on road distance?
> I am trying to use the road distance between two points instead of
> euclidean distance.
>
> I've seen that there is a package named osrm. Can anyone give some advice?

I don't know anything about "osrm".  Calculating "road distances" can be
done in the spatstat package reasonably easily, if you take the trouble
to represent your collection of roads as a "linnet" object.

Given that you have done so, suppose that your linnet object is "L" and
that you have vectors "x" and "y" specifying the points on L (i.e. on
your roads) between which you want to know the distances.

Do:

     X    <- lpp(data.frame(x=x,y=y),L)
     dMat <- pairdist(X)

The object "dMat" is a (symmetric) square matrix; dMat[i,j] is the
distance between point i and point j.  (Of course the diagonal entries
are all 0.)

If your collection of roads is specified by means of a shapefile,
vignette("shapefiles") will tell you how to turn this collection into a
"psp" ("planar segment pattern") object; the function (method)
as.linnet.psp() can then be used to turn the "psp" object into a
"linnet" object.

HTH

cheers,

Rolf Turner

--
Honorary Research Fellow
Department of Statistics
University of Auckland
Phone: +64-9-373-7599 ext. 88276

	[[alternative HTML version deleted]]


From do@c3612 @end|ng |rom co|or@do@edu  Fri Jun 21 05:00:36 2019
From: do@c3612 @end|ng |rom co|or@do@edu (Dominik Schneider)
Date: Thu, 20 Jun 2019 20:00:36 -0700
Subject: [R-sig-Geo] install rgdal from source macOS
In-Reply-To: <8067aa0e-3cc1-89d2-351b-c680cb25b0dc@uni-muenster.de>
References: <CAF1jk_ndHGqdX1AENj-77bMQZhGJtQ_THGP5AZrOmJ81HVpiSA@mail.gmail.com>
 <8067aa0e-3cc1-89d2-351b-c680cb25b0dc@uni-muenster.de>
Message-ID: <CAF1jk_=UFRW9FW=6S2g1js+DF8tsCbMfCuVsVkuD=go-3R8dXw@mail.gmail.com>

I finally got back to this. Unfortunately this did not work.
It still doesn't like PKG_CONFIG_PATH and now pcs.csv was not readable. It
did not exist in 'share/gdal' but I found it in miniconda3/pkgs/libgdal* so
I copied it to share/gdal.

> Sys.getenv('PKG_CONFIG_PATH')
[1] "/Users/dosc3612/Applications/miniconda3/envs/rgdal/lib/pkgconfig"
> grep('proj.pc',dir(Sys.getenv('PKG_CONFIG_PATH')))

I'm not sure why it can't find the pkg config

>  install.packages('rgdal', repo = 'https://r-forge.r-project.org', type =
"source",
configure.args=c('--with-proj-include=/Users/dosc3612/Applications/miniconda3/envs/rgdal/include',
'--with-proj-lib=/Users/dosc3612/Applications/miniconda3/envs/rgdal/lib',
'--with-gdal-config=/Users/dosc3612/Applications/miniconda3/envs/rgdal/bin/gdal-config','--with-proj-share=/Users/dosc3612/Applications/miniconda3/envs/rgdal/share/proj',
'--with-data-copy=yes'))
trying URL 'https://r-forge.r-project.org/src/contrib/rgdal_1.4-5.tar.gz'
Content type 'application/x-gzip' length 1687877 bytes (1.6 MB)
==================================================
downloaded 1.6 MB

* installing *source* package ?rgdal? ...
** using staged installation
configure: R_HOME: /Library/Frameworks/R.framework/Resources
configure: CC: clang
configure: CXX: clang++ -std=gnu++11
configure: C++11 support available
configure: rgdal: 1.4-4
checking for /usr/bin/svnversion... yes
cat: inst/SVN_VERSION: No such file or directory
configure: svn revision:
configure: gdal-config set to
/Users/dosc3612/Applications/miniconda3/envs/rgdal/bin/gdal-config
checking gdal-config exists... yes
checking gdal-config executable... yes
checking gdal-config usability... yes
configure: GDAL: 3.0.0
checking GDAL version >= 1.11.4... yes
checking GDAL version <= 2.5 or >= 3.0... yes
checking gdal: linking with --libs only... yes
checking GDAL: gdal-config data directory readable... yes
checking GDAL:
/Users/dosc3612/Applications/miniconda3/envs/rgdal/share/gdal/pcs.csv
readable... yes
./configure: line 2101: pkg-config: command not found
configure: pkg-config proj not available
  set PKG_CONFIG_PATH to the directory containing proj.pc
configure: PROJ version not determined using pkg-config proj
configure: proj CPP flags:
 -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
-I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
checking PROJ header API:... proj_api.h
checking proj_api.h presence and usability... yes
checking PROJ version >= 4.8.0... yes
configure: PROJ_LIB:
/Users/dosc3612/Applications/miniconda3/envs/rgdal/share/proj
dyld: Library not loaded: @rpath/libproj.15.dylib
  Referenced from:
/private/var/folders/bb/13z2kq0j01jg5q_0ypjc76gr0000gn/T/RtmpVtyBCi/R.INSTALL76ca8b2ce2d/rgdal/./proj_conf_test2
  Reason: image not found
./configure: line 2451: 30994 Abort trap: 6
PROJ_LIB="${proj_share_path}" ./proj_conf_test2
checking PROJ: proj.db found and readable... yes
configure: Copy data for:
configure:   PROJ.4:
/Users/dosc3612/Applications/miniconda3/envs/rgdal/share/proj
configure:   GDAL:
/Users/dosc3612/Applications/miniconda3/envs/rgdal/share/gdal
configure: Package CPP flags:
 -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
-I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
-DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
configure: Package LIBS:
 -L/Users/dosc3612/Applications/miniconda3/envs/rgdal/lib -lgdal
-L/Users/dosc3612/Applications/miniconda3/envs/rgdal/lib -lproj
configure: creating ./config.status
config.status: creating src/Makevars
** libs
clang++ -std=gnu++11 -I"/Library/Frameworks/R.framework/Resources/include"
-DNDEBUG -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
-I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
-DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
-I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
-isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
-I/usr/local/include  -fPIC  -Wall -g -O2  -c OGR_write.cpp -o OGR_write.o
clang++ -std=gnu++11 -I"/Library/Frameworks/R.framework/Resources/include"
-DNDEBUG -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
-I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
-DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
-I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
-isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
-I/usr/local/include  -fPIC  -Wall -g -O2  -c gdal-bindings.cpp -o
gdal-bindings.o
clang -I"/Library/Frameworks/R.framework/Resources/include" -DNDEBUG
-I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
-I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
-DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
-I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
-isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
-I/usr/local/include  -fPIC  -Wall -g -O2  -c init.c -o init.o
clang -I"/Library/Frameworks/R.framework/Resources/include" -DNDEBUG
-I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
-I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
-DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
-I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
-isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
-I/usr/local/include  -fPIC  -Wall -g -O2  -c inverser.c -o inverser.o
clang -I"/Library/Frameworks/R.framework/Resources/include" -DNDEBUG
-I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
-I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
-DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
-I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
-isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
-I/usr/local/include  -fPIC  -Wall -g -O2  -c local_stubs.c -o local_stubs.o
clang++ -std=gnu++11 -I"/Library/Frameworks/R.framework/Resources/include"
-DNDEBUG -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
-I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
-DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
-I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
-isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
-I/usr/local/include  -fPIC  -Wall -g -O2  -c ogr_geom.cpp -o ogr_geom.o
clang -I"/Library/Frameworks/R.framework/Resources/include" -DNDEBUG
-I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
-I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
-DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
-I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
-isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
-I/usr/local/include  -fPIC  -Wall -g -O2  -c ogr_polygons.c -o
ogr_polygons.o
clang++ -std=gnu++11 -I"/Library/Frameworks/R.framework/Resources/include"
-DNDEBUG -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
-I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
-DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
-I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
-isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
-I/usr/local/include  -fPIC  -Wall -g -O2  -c ogr_proj.cpp -o ogr_proj.o
clang++ -std=gnu++11 -I"/Library/Frameworks/R.framework/Resources/include"
-DNDEBUG -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
-I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
-DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
-I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
-isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
-I/usr/local/include  -fPIC  -Wall -g -O2  -c ogrdrivers.cpp -o ogrdrivers.o
clang++ -std=gnu++11 -I"/Library/Frameworks/R.framework/Resources/include"
-DNDEBUG -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
-I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
-DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
-I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
-isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
-I/usr/local/include  -fPIC  -Wall -g -O2  -c ogrsource.cpp -o ogrsource.o
clang++ -std=gnu++11 -I"/Library/Frameworks/R.framework/Resources/include"
-DNDEBUG -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
-I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
-DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
-I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
-isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
-I/usr/local/include  -fPIC  -Wall -g -O2  -c proj_info6.cpp -o proj_info6.o
clang++ -std=gnu++11 -I"/Library/Frameworks/R.framework/Resources/include"
-DNDEBUG -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
-I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
-DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
-I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
-isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
-I/usr/local/include  -fPIC  -Wall -g -O2  -c projectit.cpp -o projectit.o
clang++ -std=gnu++11 -dynamiclib -Wl,-headerpad_max_install_names
-undefined dynamic_lookup -single_module -multiply_defined suppress
-L/Library/Frameworks/R.framework/Resources/lib -L/usr/local/lib -o
rgdal.so OGR_write.o gdal-bindings.o init.o inverser.o local_stubs.o
ogr_geom.o ogr_polygons.o ogr_proj.o ogrdrivers.o ogrsource.o proj_info6.o
projectit.o -L/Users/dosc3612/Applications/miniconda3/envs/rgdal/lib -lgdal
-L/Users/dosc3612/Applications/miniconda3/envs/rgdal/lib -lproj
-F/Library/Frameworks/R.framework/.. -framework R -Wl,-framework
-Wl,CoreFoundation
installing to
/Library/Frameworks/R.framework/Versions/3.6/Resources/library/00LOCK-rgdal/00new/rgdal/libs
** R
** data
** inst
** byte-compile and prepare package for lazy loading
** help
*** installing help indices
** building package indices
** installing vignettes
** testing if installed package can be loaded from temporary location
Error: package or namespace load failed for ?rgdal? in dyn.load(file,
DLLpath = DLLpath, ...):
 unable to load shared object
'/Library/Frameworks/R.framework/Versions/3.6/Resources/library/00LOCK-rgdal/00new/rgdal/libs/rgdal.so':

dlopen(/Library/Frameworks/R.framework/Versions/3.6/Resources/library/00LOCK-rgdal/00new/rgdal/libs/rgdal.so,
6): Library not loaded: @rpath/libgdal.26.dylib
  Referenced from:
/Library/Frameworks/R.framework/Versions/3.6/Resources/library/00LOCK-rgdal/00new/rgdal/libs/rgdal.so
  Reason: image not found
Error: loading failed
Execution halted
ERROR: loading failed
* removing
?/Library/Frameworks/R.framework/Versions/3.6/Resources/library/rgdal?

The downloaded source packages are in
?/private/var/folders/bb/13z2kq0j01jg5q_0ypjc76gr0000gn/T/Rtmpqaf8Yh/downloaded_packages?
Warning message:
In install.packages("rgdal", repo = "https://r-forge.r-project.org",  :
  installation of package ?rgdal? had non-zero exit status
>





I also tried passing
'--with-proj-share=/Users/dosc3612/Applications/miniconda3/envs/rgdal/lib'
because that is where I found libproj.15.dylib but the installer still says
it can't find it.


*any suggestions?*


>  install.packages('rgdal', repo = 'https://r-forge.r-project.org', type =
"source",
configure.args=c('--with-proj-include=/Users/dosc3612/Applications/miniconda3/envs/rgdal/include',
'--with-proj-lib=/Users/dosc3612/Applications/miniconda3/envs/rgdal/lib',
'--with-gdal-config=/Users/dosc3612/Applications/miniconda3/envs/rgdal/bin/gdal-config','--with-proj-share=/Users/dosc3612/Applications/miniconda3/envs/rgdal/lib',
'--with-data-copy=yes'))
trying URL 'https://r-forge.r-project.org/src/contrib/rgdal_1.4-5.tar.gz'
Content type 'application/x-gzip' length 1687877 bytes (1.6 MB)
==================================================
downloaded 1.6 MB

* installing *source* package ?rgdal? ...
** using staged installation
configure: R_HOME: /Library/Frameworks/R.framework/Resources
configure: CC: clang
configure: CXX: clang++ -std=gnu++11
configure: C++11 support available
configure: rgdal: 1.4-4
checking for /usr/bin/svnversion... yes
cat: inst/SVN_VERSION: No such file or directory
configure: svn revision:
configure: gdal-config set to
/Users/dosc3612/Applications/miniconda3/envs/rgdal/bin/gdal-config
checking gdal-config exists... yes
checking gdal-config executable... yes
checking gdal-config usability... yes
configure: GDAL: 3.0.0
checking GDAL version >= 1.11.4... yes
checking GDAL version <= 2.5 or >= 3.0... yes
checking gdal: linking with --libs only... yes
checking GDAL: gdal-config data directory readable... yes
checking GDAL:
/Users/dosc3612/Applications/miniconda3/envs/rgdal/share/gdal/pcs.csv
readable... yes
./configure: line 2101: pkg-config: command not found
configure: pkg-config proj not available
  set PKG_CONFIG_PATH to the directory containing proj.pc
configure: PROJ version not determined using pkg-config proj
configure: proj CPP flags:
 -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
-I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
checking PROJ header API:... proj_api.h
checking proj_api.h presence and usability... yes
checking PROJ version >= 4.8.0... yes
configure: PROJ_LIB: /Users/dosc3612/Applications/miniconda3/envs/rgdal/lib
dyld: Library not loaded: @rpath/libproj.15.dylib
  Referenced from:
/private/var/folders/bb/13z2kq0j01jg5q_0ypjc76gr0000gn/T/Rtmpcbzrca/R.INSTALL7a1919c4df31/rgdal/./proj_conf_test2
  Reason: image not found
./configure: line 2451: 31841 Abort trap: 6
PROJ_LIB="${proj_share_path}" ./proj_conf_test2
checking PROJ: proj.db found and readable... yes
configure: Copy data for:
configure:   PROJ.4:
/Users/dosc3612/Applications/miniconda3/envs/rgdal/share/proj
configure:   GDAL:
/Users/dosc3612/Applications/miniconda3/envs/rgdal/share/gdal
configure: Package CPP flags:
 -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
-I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
-DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
configure: Package LIBS:
 -L/Users/dosc3612/Applications/miniconda3/envs/rgdal/lib -lgdal
-L/Users/dosc3612/Applications/miniconda3/envs/rgdal/lib -lproj
configure: creating ./config.status
config.status: creating src/Makevars
** libs
clang++ -std=gnu++11 -I"/Library/Frameworks/R.framework/Resources/include"
-DNDEBUG -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
-I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
-DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
-I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
-isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
-I/usr/local/include  -fPIC  -Wall -g -O2  -c OGR_write.cpp -o OGR_write.o
clang++ -std=gnu++11 -I"/Library/Frameworks/R.framework/Resources/include"
-DNDEBUG -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
-I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
-DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
-I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
-isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
-I/usr/local/include  -fPIC  -Wall -g -O2  -c gdal-bindings.cpp -o
gdal-bindings.o
clang -I"/Library/Frameworks/R.framework/Resources/include" -DNDEBUG
-I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
-I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
-DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
-I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
-isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
-I/usr/local/include  -fPIC  -Wall -g -O2  -c init.c -o init.o
clang -I"/Library/Frameworks/R.framework/Resources/include" -DNDEBUG
-I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
-I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
-DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
-I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
-isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
-I/usr/local/include  -fPIC  -Wall -g -O2  -c inverser.c -o inverser.o
clang -I"/Library/Frameworks/R.framework/Resources/include" -DNDEBUG
-I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
-I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
-DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
-I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
-isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
-I/usr/local/include  -fPIC  -Wall -g -O2  -c local_stubs.c -o local_stubs.o
clang++ -std=gnu++11 -I"/Library/Frameworks/R.framework/Resources/include"
-DNDEBUG -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
-I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
-DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
-I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
-isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
-I/usr/local/include  -fPIC  -Wall -g -O2  -c ogr_geom.cpp -o ogr_geom.o
clang -I"/Library/Frameworks/R.framework/Resources/include" -DNDEBUG
-I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
-I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
-DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
-I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
-isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
-I/usr/local/include  -fPIC  -Wall -g -O2  -c ogr_polygons.c -o
ogr_polygons.o
clang++ -std=gnu++11 -I"/Library/Frameworks/R.framework/Resources/include"
-DNDEBUG -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
-I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
-DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
-I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
-isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
-I/usr/local/include  -fPIC  -Wall -g -O2  -c ogr_proj.cpp -o ogr_proj.o
clang++ -std=gnu++11 -I"/Library/Frameworks/R.framework/Resources/include"
-DNDEBUG -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
-I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
-DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
-I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
-isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
-I/usr/local/include  -fPIC  -Wall -g -O2  -c ogrdrivers.cpp -o ogrdrivers.o
clang++ -std=gnu++11 -I"/Library/Frameworks/R.framework/Resources/include"
-DNDEBUG -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
-I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
-DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
-I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
-isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
-I/usr/local/include  -fPIC  -Wall -g -O2  -c ogrsource.cpp -o ogrsource.o
clang++ -std=gnu++11 -I"/Library/Frameworks/R.framework/Resources/include"
-DNDEBUG -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
-I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
-DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
-I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
-isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
-I/usr/local/include  -fPIC  -Wall -g -O2  -c proj_info6.cpp -o proj_info6.o
clang++ -std=gnu++11 -I"/Library/Frameworks/R.framework/Resources/include"
-DNDEBUG -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
-I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
-DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
-I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
-isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
-I/usr/local/include  -fPIC  -Wall -g -O2  -c projectit.cpp -o projectit.o
clang++ -std=gnu++11 -dynamiclib -Wl,-headerpad_max_install_names
-undefined dynamic_lookup -single_module -multiply_defined suppress
-L/Library/Frameworks/R.framework/Resources/lib -L/usr/local/lib -o
rgdal.so OGR_write.o gdal-bindings.o init.o inverser.o local_stubs.o
ogr_geom.o ogr_polygons.o ogr_proj.o ogrdrivers.o ogrsource.o proj_info6.o
projectit.o -L/Users/dosc3612/Applications/miniconda3/envs/rgdal/lib -lgdal
-L/Users/dosc3612/Applications/miniconda3/envs/rgdal/lib -lproj
-F/Library/Frameworks/R.framework/.. -framework R -Wl,-framework
-Wl,CoreFoundation
installing to
/Library/Frameworks/R.framework/Versions/3.6/Resources/library/00LOCK-rgdal/00new/rgdal/libs
** R
** data
** inst
** byte-compile and prepare package for lazy loading
** help
*** installing help indices
** building package indices
** installing vignettes
** testing if installed package can be loaded from temporary location
Error: package or namespace load failed for ?rgdal? in dyn.load(file,
DLLpath = DLLpath, ...):
 unable to load shared object
'/Library/Frameworks/R.framework/Versions/3.6/Resources/library/00LOCK-rgdal/00new/rgdal/libs/rgdal.so':

dlopen(/Library/Frameworks/R.framework/Versions/3.6/Resources/library/00LOCK-rgdal/00new/rgdal/libs/rgdal.so,
6): Library not loaded: @rpath/libgdal.26.dylib
  Referenced from:
/Library/Frameworks/R.framework/Versions/3.6/Resources/library/00LOCK-rgdal/00new/rgdal/libs/rgdal.so
  Reason: image not found
Error: loading failed
Execution halted
ERROR: loading failed
* removing
?/Library/Frameworks/R.framework/Versions/3.6/Resources/library/rgdal?

The downloaded source packages are in
?/private/var/folders/bb/13z2kq0j01jg5q_0ypjc76gr0000gn/T/Rtmpqaf8Yh/downloaded_packages?
Warning message:
In install.packages("rgdal", repo = "https://r-forge.r-project.org",  :
  installation of package ?rgdal? had non-zero exit status
>

On Tue, Jun 11, 2019 at 10:32 AM Edzer Pebesma <
edzer.pebesma at uni-muenster.de> wrote:

> for compiling rgdal from source on OSX against gdal 3 and proj 6.1.0,
> please use the dev version on r-forge. See also
> https://github.com/r-spatial/sf/issues/1070
>
>
> On 6/9/19 9:52 PM, Dominik Schneider wrote:
> > I'm trying to install rgdal from source on a fresh r 3.6 installation.
> > i setup a conda environment to install gdal, proj, geos
> >
> > install.packages('rgdal', type = "source",
> >
> configure.args=c('--with-proj-include=/Users/dosc3612/Applications/miniconda3/envs/rgdal/include',
> > '--with-proj-lib=/Users/dosc3612/Applications/miniconda3/envs/rgdal/lib',
> >
> '--with-gdal-config=/Users/dosc3612/Applications/miniconda3/envs/rgdal/bin/gdal-config'))
> >
> > The full output is below but the first error I see is:
> > ./configure: line 2101: pkg-config: command not found
> > configure: pkg-config proj not available
> >   set PKG_CONFIG_PATH to the directory containing proj.pc
> > configure: PROJ version not determined using pkg-config proj
> >
> > which I don't understand because:
> > Sys.getenv('PKG_CONFIG_PATH')
> > [1] "/Users/dosc3612/Applications/miniconda3/envs/rgdal/lib/pkgconfig"
> >
> > and just to confirm:
> > (rgdal) Phoenix:~ $ ls `echo $PKG_CONFIG_PATH` | grep proj
> > proj.pc
> >
> > *Is there another way to set PKG_CONFIG_PATH within install.packages?*
> >
> > There are also some undefined symbols:
> > Undefined symbols for architecture x86_64:
> >   "_pj_ctx_fclose", referenced from:
> >       _main in proj_conf_test2-9a39dc.o
> >   "_pj_get_default_ctx", referenced from:
> >       _main in proj_conf_test2-9a39dc.o
> >   "_pj_open_lib", referenced from:
> >       _main in proj_conf_test2-9a39dc.o
> > ld: symbol(s) not found for architecture x86_64
> > clang: error: linker command failed with exit code 1 (use -v to see
> > invocation)
> > ./configure: line 2422: ./proj_conf_test2: No such file or directory
> >
> > I tried with gdal 2.4.1 and gdal 3.0.0 (after seeing
> >
> http://r-sig-geo.2731867.n2.nabble.com/GDAL-3-0-0-and-rgdal-tt7592822.html#a7592834
> > )
> > proj is 6.1
> > geos is 3.7.1
> >
> > What did I miss? Please advise. Thanks.
> >
> > FULL OUTPUT:
> >> install.packages('rgdal', type = "source",
> >
> configure.args=c('--with-proj-include=/Users/dosc3612/Applications/miniconda3/envs/rgdal/include',
> > '--with-proj-lib=/Users/dosc3612/Applications/miniconda3/envs/rgdal/lib',
> >
> '--with-gdal-config=/Users/dosc3612/Applications/miniconda3/envs/rgdal/bin/gdal-config'))
> > --- Please select a CRAN mirror for use in this session ---
> > trying URL 'https://cloud.r-project.org/src/contrib/rgdal_1.4-4.tar.gz'
> > Content type 'application/x-gzip' length 1687518 bytes (1.6 MB)
> > ==================================================
> > downloaded 1.6 MB
> >
> > * installing *source* package ?rgdal? ...
> > ** package ?rgdal? successfully unpacked and MD5 sums checked
> > ** using staged installation
> > configure: R_HOME: /Library/Frameworks/R.framework/Resources
> > configure: CC: clang
> > configure: CXX: clang++ -std=gnu++11
> > configure: C++11 support available
> > configure: rgdal: 1.4-4
> > checking for /usr/bin/svnversion... yes
> > configure: svn revision: 833
> > configure: gdal-config set to
> > /Users/dosc3612/Applications/miniconda3/envs/rgdal/bin/gdal-config
> > checking gdal-config exists... yes
> > checking gdal-config executable... yes
> > checking gdal-config usability... yes
> > configure: GDAL: 2.4.1
> > checking C++11 support for GDAL >= 2.3.0... yes
> > checking GDAL version >= 1.11.4... yes
> > checking GDAL version <= 2.5 or >= 3.0... yes
> > checking gdal: linking with --libs only... yes
> > checking GDAL: gdal-config data directory readable... yes
> > checking GDAL:
> > /Users/dosc3612/Applications/miniconda3/envs/rgdal/share/gdal/pcs.csv
> > readable... yes
> > ./configure: line 2101: pkg-config: command not found
> > configure: pkg-config proj not available
> >   set PKG_CONFIG_PATH to the directory containing proj.pc
> > configure: PROJ version not determined using pkg-config proj
> > configure: proj CPP flags:
> >  -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> > -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> > checking PROJ header API:... proj_api.h
> > checking proj_api.h presence and usability... yes
> > checking PROJ version >= 4.8.0... yes
> > Undefined symbols for architecture x86_64:
> >   "_pj_ctx_fclose", referenced from:
> >       _main in proj_conf_test2-9a39dc.o
> >   "_pj_get_default_ctx", referenced from:
> >       _main in proj_conf_test2-9a39dc.o
> >   "_pj_open_lib", referenced from:
> >       _main in proj_conf_test2-9a39dc.o
> > ld: symbol(s) not found for architecture x86_64
> > clang: error: linker command failed with exit code 1 (use -v to see
> > invocation)
> > ./configure: line 2422: ./proj_conf_test2: No such file or directory
> > checking PROJ.4: proj.db found and readable... yes
> > Undefined symbols for architecture x86_64:
> >   "_pj_ctx_fclose", referenced from:
> >       _main in proj_conf_test3-9f8df7.o
> >   "_pj_get_default_ctx", referenced from:
> >       _main in proj_conf_test3-9f8df7.o
> >   "_pj_open_lib", referenced from:
> >       _main in proj_conf_test3-9f8df7.o
> > ld: symbol(s) not found for architecture x86_64
> > clang: error: linker command failed with exit code 1 (use -v to see
> > invocation)
> > ./configure: line 2482: ./proj_conf_test3: No such file or directory
> > checking PROJ.4: conus found and readable... yes
> > configure: Package CPP flags:
> >  -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> > -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> > -DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
> > configure: Package LIBS:
> >  -L/Users/dosc3612/Applications/miniconda3/envs/rgdal/lib -lgdal
> > -L/Users/dosc3612/Applications/miniconda3/envs/rgdal/lib -lproj
> > configure: creating ./config.status
> > config.status: creating src/Makevars
> > ** libs
> > clang++ -std=gnu++11
> -I"/Library/Frameworks/R.framework/Resources/include"
> > -DNDEBUG -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> > -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> > -DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
> >
> -I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
> > -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
> > -I/usr/local/include  -fPIC  -Wall -g -O2  -c OGR_write.cpp -o
> OGR_write.o
> > clang++ -std=gnu++11
> -I"/Library/Frameworks/R.framework/Resources/include"
> > -DNDEBUG -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> > -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> > -DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
> >
> -I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
> > -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
> > -I/usr/local/include  -fPIC  -Wall -g -O2  -c gdal-bindings.cpp -o
> > gdal-bindings.o
> > clang -I"/Library/Frameworks/R.framework/Resources/include" -DNDEBUG
> > -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> > -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> > -DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
> >
> -I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
> > -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
> > -I/usr/local/include  -fPIC  -Wall -g -O2  -c init.c -o init.o
> > clang -I"/Library/Frameworks/R.framework/Resources/include" -DNDEBUG
> > -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> > -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> > -DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
> >
> -I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
> > -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
> > -I/usr/local/include  -fPIC  -Wall -g -O2  -c inverser.c -o inverser.o
> > clang -I"/Library/Frameworks/R.framework/Resources/include" -DNDEBUG
> > -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> > -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> > -DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
> >
> -I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
> > -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
> > -I/usr/local/include  -fPIC  -Wall -g -O2  -c local_stubs.c -o
> local_stubs.o
> > clang++ -std=gnu++11
> -I"/Library/Frameworks/R.framework/Resources/include"
> > -DNDEBUG -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> > -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> > -DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
> >
> -I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
> > -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
> > -I/usr/local/include  -fPIC  -Wall -g -O2  -c ogr_geom.cpp -o ogr_geom.o
> > clang -I"/Library/Frameworks/R.framework/Resources/include" -DNDEBUG
> > -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> > -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> > -DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
> >
> -I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
> > -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
> > -I/usr/local/include  -fPIC  -Wall -g -O2  -c ogr_polygons.c -o
> > ogr_polygons.o
> > clang++ -std=gnu++11
> -I"/Library/Frameworks/R.framework/Resources/include"
> > -DNDEBUG -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> > -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> > -DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
> >
> -I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
> > -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
> > -I/usr/local/include  -fPIC  -Wall -g -O2  -c ogr_proj.cpp -o ogr_proj.o
> > clang++ -std=gnu++11
> -I"/Library/Frameworks/R.framework/Resources/include"
> > -DNDEBUG -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> > -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> > -DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
> >
> -I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
> > -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
> > -I/usr/local/include  -fPIC  -Wall -g -O2  -c ogrdrivers.cpp -o
> ogrdrivers.o
> > clang++ -std=gnu++11
> -I"/Library/Frameworks/R.framework/Resources/include"
> > -DNDEBUG -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> > -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> > -DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
> >
> -I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
> > -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
> > -I/usr/local/include  -fPIC  -Wall -g -O2  -c ogrsource.cpp -o
> ogrsource.o
> > clang++ -std=gnu++11
> -I"/Library/Frameworks/R.framework/Resources/include"
> > -DNDEBUG -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> > -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> > -DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
> >
> -I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
> > -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
> > -I/usr/local/include  -fPIC  -Wall -g -O2  -c proj_info6.cpp -o
> proj_info6.o
> > clang++ -std=gnu++11
> -I"/Library/Frameworks/R.framework/Resources/include"
> > -DNDEBUG -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> > -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> > -DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
> >
> -I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
> > -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
> > -I/usr/local/include  -fPIC  -Wall -g -O2  -c projectit.cpp -o
> projectit.o
> > clang++ -std=gnu++11 -dynamiclib -Wl,-headerpad_max_install_names
> > -undefined dynamic_lookup -single_module -multiply_defined suppress
> > -L/Library/Frameworks/R.framework/Resources/lib -L/usr/local/lib -o
> > rgdal.so OGR_write.o gdal-bindings.o init.o inverser.o local_stubs.o
> > ogr_geom.o ogr_polygons.o ogr_proj.o ogrdrivers.o ogrsource.o
> proj_info6.o
> > projectit.o -L/Users/dosc3612/Applications/miniconda3/envs/rgdal/lib
> -lgdal
> > -L/Users/dosc3612/Applications/miniconda3/envs/rgdal/lib -lproj
> > -F/Library/Frameworks/R.framework/.. -framework R -Wl,-framework
> > -Wl,CoreFoundation
> > installing to
> >
> /Library/Frameworks/R.framework/Versions/3.6/Resources/library/00LOCK-rgdal/00new/rgdal/libs
> > ** R
> > ** data
> > ** inst
> > ** byte-compile and prepare package for lazy loading
> > ** help
> > *** installing help indices
> > ** building package indices
> > ** installing vignettes
> > ** testing if installed package can be loaded from temporary location
> > Error: package or namespace load failed for ?rgdal? in dyn.load(file,
> > DLLpath = DLLpath, ...):
> >  unable to load shared object
> >
> '/Library/Frameworks/R.framework/Versions/3.6/Resources/library/00LOCK-rgdal/00new/rgdal/libs/rgdal.so':
> >
> >
> dlopen(/Library/Frameworks/R.framework/Versions/3.6/Resources/library/00LOCK-rgdal/00new/rgdal/libs/rgdal.so,
> > 6): Library not loaded: @rpath/libgdal.20.dylib
> >   Referenced from:
> >
> /Library/Frameworks/R.framework/Versions/3.6/Resources/library/00LOCK-rgdal/00new/rgdal/libs/rgdal.so
> >   Reason: image not found
> > Error: loading failed
> > Execution halted
> > ERROR: loading failed
> > * removing
> > ?/Library/Frameworks/R.framework/Versions/3.6/Resources/library/rgdal?
> >
> > The downloaded source packages are in
> >
> ?/private/var/folders/bb/13z2kq0j01jg5q_0ypjc76gr0000gn/T/RtmplsyMiu/downloaded_packages?
> > Warning message:
> > In install.packages("rgdal", type = "source", configure.args =
> >
> c("--with-proj-include=/Users/dosc3612/Applications/miniconda3/envs/rgdal/include",
> >  :
> >   installation of package ?rgdal? had non-zero exit status
> >
> >       [[alternative HTML version deleted]]
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
>
> --
> Edzer Pebesma
> Institute for Geoinformatics
> Heisenbergstrasse 2, 48151 Muenster, Germany
> Phone: +49 251 8333081
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From Roger@B|v@nd @end|ng |rom nhh@no  Fri Jun 21 11:24:32 2019
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Fri, 21 Jun 2019 11:24:32 +0200
Subject: [R-sig-Geo] install rgdal from source macOS
In-Reply-To: <CAF1jk_=UFRW9FW=6S2g1js+DF8tsCbMfCuVsVkuD=go-3R8dXw@mail.gmail.com>
References: <CAF1jk_ndHGqdX1AENj-77bMQZhGJtQ_THGP5AZrOmJ81HVpiSA@mail.gmail.com>
 <8067aa0e-3cc1-89d2-351b-c680cb25b0dc@uni-muenster.de>
 <CAF1jk_=UFRW9FW=6S2g1js+DF8tsCbMfCuVsVkuD=go-3R8dXw@mail.gmail.com>
Message-ID: <alpine.LFD.2.21.1906211106140.2863@reclus.nhh.no>

You are making everything unnecessarily complicated. What is happening is 
that rgdal is being build against the headers and libraries you specify, 
but the GDAL shared object loaded by rgdal.so is not the one used to build 
it (so you have multiple copies of at least GDAL installed). These 
speculations do seem to match what you report:

** testing if installed package can be loaded from temporary location
Error: package or namespace load failed for ?rgdal? in dyn.load(file,
DLLpath = DLLpath, ...):
  unable to load shared object
'/Library/Frameworks/R.framework/Versions/3.6/Resources/library/00LOCK-rgdal
/00new/rgdal/libs/rgdal.so':

dlopen(/Library/Frameworks/R.framework/Versions/3.6/Resources/library/00LOCK
-rgdal/00new/rgdal/libs/rgdal.so,
6): Library not loaded: @rpath/libgdal.26.dylib
                         ^^^^^^^^^^^^^^^^^^^^^^^
   Referenced from:
/Library/Frameworks/R.framework/Versions/3.6/Resources/library/00LOCK-rgdal/
00new/rgdal/libs/rgdal.so
   Reason: image not found
Error: loading failed
Execution halted
ERROR: loading failed

Further, you probably also have multiple copies of PROJ and GDAL support 
files installed for different versions of PROJ and GDAL.

If you read the output carefully, you'll also see that you do not seem to 
have the pkg-config program installed, so setting the environment variable 
to point to where proj.pc lives will not work; try pkg-config --help at 
the command line to check its availability.

./configure: line 2101: pkg-config: command not found
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
configure: pkg-config proj not available
   set PKG_CONFIG_PATH to the directory containing proj.pc
configure: PROJ version not determined using pkg-config proj

Roger


On Fri, 21 Jun 2019, Dominik Schneider wrote:

> I finally got back to this. Unfortunately this did not work.
> It still doesn't like PKG_CONFIG_PATH and now pcs.csv was not readable. It
> did not exist in 'share/gdal' but I found it in miniconda3/pkgs/libgdal* so
> I copied it to share/gdal.
>
>> Sys.getenv('PKG_CONFIG_PATH')
> [1] "/Users/dosc3612/Applications/miniconda3/envs/rgdal/lib/pkgconfig"
>> grep('proj.pc',dir(Sys.getenv('PKG_CONFIG_PATH')))
>
> I'm not sure why it can't find the pkg config
>
>>  install.packages('rgdal', repo = 'https://r-forge.r-project.org', type =
> "source",
> configure.args=c('--with-proj-include=/Users/dosc3612/Applications/miniconda3/envs/rgdal/include',
> '--with-proj-lib=/Users/dosc3612/Applications/miniconda3/envs/rgdal/lib',
> '--with-gdal-config=/Users/dosc3612/Applications/miniconda3/envs/rgdal/bin/gdal-config','--with-proj-share=/Users/dosc3612/Applications/miniconda3/envs/rgdal/share/proj',
> '--with-data-copy=yes'))
> trying URL 'https://r-forge.r-project.org/src/contrib/rgdal_1.4-5.tar.gz'
> Content type 'application/x-gzip' length 1687877 bytes (1.6 MB)
> ==================================================
> downloaded 1.6 MB
>
> * installing *source* package ?rgdal? ...
> ** using staged installation
> configure: R_HOME: /Library/Frameworks/R.framework/Resources
> configure: CC: clang
> configure: CXX: clang++ -std=gnu++11
> configure: C++11 support available
> configure: rgdal: 1.4-4
> checking for /usr/bin/svnversion... yes
> cat: inst/SVN_VERSION: No such file or directory
> configure: svn revision:
> configure: gdal-config set to
> /Users/dosc3612/Applications/miniconda3/envs/rgdal/bin/gdal-config
> checking gdal-config exists... yes
> checking gdal-config executable... yes
> checking gdal-config usability... yes
> configure: GDAL: 3.0.0
> checking GDAL version >= 1.11.4... yes
> checking GDAL version <= 2.5 or >= 3.0... yes
> checking gdal: linking with --libs only... yes
> checking GDAL: gdal-config data directory readable... yes
> checking GDAL:
> /Users/dosc3612/Applications/miniconda3/envs/rgdal/share/gdal/pcs.csv
> readable... yes
> ./configure: line 2101: pkg-config: command not found
> configure: pkg-config proj not available
>  set PKG_CONFIG_PATH to the directory containing proj.pc
> configure: PROJ version not determined using pkg-config proj
> configure: proj CPP flags:
> -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> checking PROJ header API:... proj_api.h
> checking proj_api.h presence and usability... yes
> checking PROJ version >= 4.8.0... yes
> configure: PROJ_LIB:
> /Users/dosc3612/Applications/miniconda3/envs/rgdal/share/proj
> dyld: Library not loaded: @rpath/libproj.15.dylib
>  Referenced from:
> /private/var/folders/bb/13z2kq0j01jg5q_0ypjc76gr0000gn/T/RtmpVtyBCi/R.INSTALL76ca8b2ce2d/rgdal/./proj_conf_test2
>  Reason: image not found
> ./configure: line 2451: 30994 Abort trap: 6
> PROJ_LIB="${proj_share_path}" ./proj_conf_test2
> checking PROJ: proj.db found and readable... yes
> configure: Copy data for:
> configure:   PROJ.4:
> /Users/dosc3612/Applications/miniconda3/envs/rgdal/share/proj
> configure:   GDAL:
> /Users/dosc3612/Applications/miniconda3/envs/rgdal/share/gdal
> configure: Package CPP flags:
> -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> -DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
> configure: Package LIBS:
> -L/Users/dosc3612/Applications/miniconda3/envs/rgdal/lib -lgdal
> -L/Users/dosc3612/Applications/miniconda3/envs/rgdal/lib -lproj
> configure: creating ./config.status
> config.status: creating src/Makevars
> ** libs
> clang++ -std=gnu++11 -I"/Library/Frameworks/R.framework/Resources/include"
> -DNDEBUG -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> -DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
> -I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
> -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
> -I/usr/local/include  -fPIC  -Wall -g -O2  -c OGR_write.cpp -o OGR_write.o
> clang++ -std=gnu++11 -I"/Library/Frameworks/R.framework/Resources/include"
> -DNDEBUG -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> -DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
> -I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
> -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
> -I/usr/local/include  -fPIC  -Wall -g -O2  -c gdal-bindings.cpp -o
> gdal-bindings.o
> clang -I"/Library/Frameworks/R.framework/Resources/include" -DNDEBUG
> -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> -DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
> -I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
> -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
> -I/usr/local/include  -fPIC  -Wall -g -O2  -c init.c -o init.o
> clang -I"/Library/Frameworks/R.framework/Resources/include" -DNDEBUG
> -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> -DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
> -I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
> -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
> -I/usr/local/include  -fPIC  -Wall -g -O2  -c inverser.c -o inverser.o
> clang -I"/Library/Frameworks/R.framework/Resources/include" -DNDEBUG
> -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> -DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
> -I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
> -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
> -I/usr/local/include  -fPIC  -Wall -g -O2  -c local_stubs.c -o local_stubs.o
> clang++ -std=gnu++11 -I"/Library/Frameworks/R.framework/Resources/include"
> -DNDEBUG -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> -DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
> -I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
> -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
> -I/usr/local/include  -fPIC  -Wall -g -O2  -c ogr_geom.cpp -o ogr_geom.o
> clang -I"/Library/Frameworks/R.framework/Resources/include" -DNDEBUG
> -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> -DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
> -I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
> -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
> -I/usr/local/include  -fPIC  -Wall -g -O2  -c ogr_polygons.c -o
> ogr_polygons.o
> clang++ -std=gnu++11 -I"/Library/Frameworks/R.framework/Resources/include"
> -DNDEBUG -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> -DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
> -I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
> -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
> -I/usr/local/include  -fPIC  -Wall -g -O2  -c ogr_proj.cpp -o ogr_proj.o
> clang++ -std=gnu++11 -I"/Library/Frameworks/R.framework/Resources/include"
> -DNDEBUG -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> -DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
> -I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
> -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
> -I/usr/local/include  -fPIC  -Wall -g -O2  -c ogrdrivers.cpp -o ogrdrivers.o
> clang++ -std=gnu++11 -I"/Library/Frameworks/R.framework/Resources/include"
> -DNDEBUG -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> -DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
> -I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
> -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
> -I/usr/local/include  -fPIC  -Wall -g -O2  -c ogrsource.cpp -o ogrsource.o
> clang++ -std=gnu++11 -I"/Library/Frameworks/R.framework/Resources/include"
> -DNDEBUG -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> -DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
> -I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
> -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
> -I/usr/local/include  -fPIC  -Wall -g -O2  -c proj_info6.cpp -o proj_info6.o
> clang++ -std=gnu++11 -I"/Library/Frameworks/R.framework/Resources/include"
> -DNDEBUG -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> -DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
> -I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
> -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
> -I/usr/local/include  -fPIC  -Wall -g -O2  -c projectit.cpp -o projectit.o
> clang++ -std=gnu++11 -dynamiclib -Wl,-headerpad_max_install_names
> -undefined dynamic_lookup -single_module -multiply_defined suppress
> -L/Library/Frameworks/R.framework/Resources/lib -L/usr/local/lib -o
> rgdal.so OGR_write.o gdal-bindings.o init.o inverser.o local_stubs.o
> ogr_geom.o ogr_polygons.o ogr_proj.o ogrdrivers.o ogrsource.o proj_info6.o
> projectit.o -L/Users/dosc3612/Applications/miniconda3/envs/rgdal/lib -lgdal
> -L/Users/dosc3612/Applications/miniconda3/envs/rgdal/lib -lproj
> -F/Library/Frameworks/R.framework/.. -framework R -Wl,-framework
> -Wl,CoreFoundation
> installing to
> /Library/Frameworks/R.framework/Versions/3.6/Resources/library/00LOCK-rgdal/00new/rgdal/libs
> ** R
> ** data
> ** inst
> ** byte-compile and prepare package for lazy loading
> ** help
> *** installing help indices
> ** building package indices
> ** installing vignettes
> ** testing if installed package can be loaded from temporary location
> Error: package or namespace load failed for ?rgdal? in dyn.load(file,
> DLLpath = DLLpath, ...):
> unable to load shared object
> '/Library/Frameworks/R.framework/Versions/3.6/Resources/library/00LOCK-rgdal/00new/rgdal/libs/rgdal.so':
>
> dlopen(/Library/Frameworks/R.framework/Versions/3.6/Resources/library/00LOCK-rgdal/00new/rgdal/libs/rgdal.so,
> 6): Library not loaded: @rpath/libgdal.26.dylib
>  Referenced from:
> /Library/Frameworks/R.framework/Versions/3.6/Resources/library/00LOCK-rgdal/00new/rgdal/libs/rgdal.so
>  Reason: image not found
> Error: loading failed
> Execution halted
> ERROR: loading failed
> * removing
> ?/Library/Frameworks/R.framework/Versions/3.6/Resources/library/rgdal?
>
> The downloaded source packages are in
> ?/private/var/folders/bb/13z2kq0j01jg5q_0ypjc76gr0000gn/T/Rtmpqaf8Yh/downloaded_packages?
> Warning message:
> In install.packages("rgdal", repo = "https://r-forge.r-project.org",  :
>  installation of package ?rgdal? had non-zero exit status
>>
>
>
>
>
>
> I also tried passing
> '--with-proj-share=/Users/dosc3612/Applications/miniconda3/envs/rgdal/lib'
> because that is where I found libproj.15.dylib but the installer still says
> it can't find it.
>
>
> *any suggestions?*
>
>
>>  install.packages('rgdal', repo = 'https://r-forge.r-project.org', type =
> "source",
> configure.args=c('--with-proj-include=/Users/dosc3612/Applications/miniconda3/envs/rgdal/include',
> '--with-proj-lib=/Users/dosc3612/Applications/miniconda3/envs/rgdal/lib',
> '--with-gdal-config=/Users/dosc3612/Applications/miniconda3/envs/rgdal/bin/gdal-config','--with-proj-share=/Users/dosc3612/Applications/miniconda3/envs/rgdal/lib',
> '--with-data-copy=yes'))
> trying URL 'https://r-forge.r-project.org/src/contrib/rgdal_1.4-5.tar.gz'
> Content type 'application/x-gzip' length 1687877 bytes (1.6 MB)
> ==================================================
> downloaded 1.6 MB
>
> * installing *source* package ?rgdal? ...
> ** using staged installation
> configure: R_HOME: /Library/Frameworks/R.framework/Resources
> configure: CC: clang
> configure: CXX: clang++ -std=gnu++11
> configure: C++11 support available
> configure: rgdal: 1.4-4
> checking for /usr/bin/svnversion... yes
> cat: inst/SVN_VERSION: No such file or directory
> configure: svn revision:
> configure: gdal-config set to
> /Users/dosc3612/Applications/miniconda3/envs/rgdal/bin/gdal-config
> checking gdal-config exists... yes
> checking gdal-config executable... yes
> checking gdal-config usability... yes
> configure: GDAL: 3.0.0
> checking GDAL version >= 1.11.4... yes
> checking GDAL version <= 2.5 or >= 3.0... yes
> checking gdal: linking with --libs only... yes
> checking GDAL: gdal-config data directory readable... yes
> checking GDAL:
> /Users/dosc3612/Applications/miniconda3/envs/rgdal/share/gdal/pcs.csv
> readable... yes
> ./configure: line 2101: pkg-config: command not found
> configure: pkg-config proj not available
>  set PKG_CONFIG_PATH to the directory containing proj.pc
> configure: PROJ version not determined using pkg-config proj
> configure: proj CPP flags:
> -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> checking PROJ header API:... proj_api.h
> checking proj_api.h presence and usability... yes
> checking PROJ version >= 4.8.0... yes
> configure: PROJ_LIB: /Users/dosc3612/Applications/miniconda3/envs/rgdal/lib
> dyld: Library not loaded: @rpath/libproj.15.dylib
>  Referenced from:
> /private/var/folders/bb/13z2kq0j01jg5q_0ypjc76gr0000gn/T/Rtmpcbzrca/R.INSTALL7a1919c4df31/rgdal/./proj_conf_test2
>  Reason: image not found
> ./configure: line 2451: 31841 Abort trap: 6
> PROJ_LIB="${proj_share_path}" ./proj_conf_test2
> checking PROJ: proj.db found and readable... yes
> configure: Copy data for:
> configure:   PROJ.4:
> /Users/dosc3612/Applications/miniconda3/envs/rgdal/share/proj
> configure:   GDAL:
> /Users/dosc3612/Applications/miniconda3/envs/rgdal/share/gdal
> configure: Package CPP flags:
> -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> -DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
> configure: Package LIBS:
> -L/Users/dosc3612/Applications/miniconda3/envs/rgdal/lib -lgdal
> -L/Users/dosc3612/Applications/miniconda3/envs/rgdal/lib -lproj
> configure: creating ./config.status
> config.status: creating src/Makevars
> ** libs
> clang++ -std=gnu++11 -I"/Library/Frameworks/R.framework/Resources/include"
> -DNDEBUG -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> -DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
> -I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
> -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
> -I/usr/local/include  -fPIC  -Wall -g -O2  -c OGR_write.cpp -o OGR_write.o
> clang++ -std=gnu++11 -I"/Library/Frameworks/R.framework/Resources/include"
> -DNDEBUG -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> -DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
> -I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
> -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
> -I/usr/local/include  -fPIC  -Wall -g -O2  -c gdal-bindings.cpp -o
> gdal-bindings.o
> clang -I"/Library/Frameworks/R.framework/Resources/include" -DNDEBUG
> -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> -DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
> -I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
> -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
> -I/usr/local/include  -fPIC  -Wall -g -O2  -c init.c -o init.o
> clang -I"/Library/Frameworks/R.framework/Resources/include" -DNDEBUG
> -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> -DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
> -I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
> -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
> -I/usr/local/include  -fPIC  -Wall -g -O2  -c inverser.c -o inverser.o
> clang -I"/Library/Frameworks/R.framework/Resources/include" -DNDEBUG
> -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> -DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
> -I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
> -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
> -I/usr/local/include  -fPIC  -Wall -g -O2  -c local_stubs.c -o local_stubs.o
> clang++ -std=gnu++11 -I"/Library/Frameworks/R.framework/Resources/include"
> -DNDEBUG -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> -DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
> -I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
> -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
> -I/usr/local/include  -fPIC  -Wall -g -O2  -c ogr_geom.cpp -o ogr_geom.o
> clang -I"/Library/Frameworks/R.framework/Resources/include" -DNDEBUG
> -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> -DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
> -I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
> -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
> -I/usr/local/include  -fPIC  -Wall -g -O2  -c ogr_polygons.c -o
> ogr_polygons.o
> clang++ -std=gnu++11 -I"/Library/Frameworks/R.framework/Resources/include"
> -DNDEBUG -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> -DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
> -I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
> -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
> -I/usr/local/include  -fPIC  -Wall -g -O2  -c ogr_proj.cpp -o ogr_proj.o
> clang++ -std=gnu++11 -I"/Library/Frameworks/R.framework/Resources/include"
> -DNDEBUG -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> -DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
> -I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
> -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
> -I/usr/local/include  -fPIC  -Wall -g -O2  -c ogrdrivers.cpp -o ogrdrivers.o
> clang++ -std=gnu++11 -I"/Library/Frameworks/R.framework/Resources/include"
> -DNDEBUG -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> -DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
> -I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
> -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
> -I/usr/local/include  -fPIC  -Wall -g -O2  -c ogrsource.cpp -o ogrsource.o
> clang++ -std=gnu++11 -I"/Library/Frameworks/R.framework/Resources/include"
> -DNDEBUG -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> -DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
> -I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
> -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
> -I/usr/local/include  -fPIC  -Wall -g -O2  -c proj_info6.cpp -o proj_info6.o
> clang++ -std=gnu++11 -I"/Library/Frameworks/R.framework/Resources/include"
> -DNDEBUG -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
> -DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
> -I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
> -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
> -I/usr/local/include  -fPIC  -Wall -g -O2  -c projectit.cpp -o projectit.o
> clang++ -std=gnu++11 -dynamiclib -Wl,-headerpad_max_install_names
> -undefined dynamic_lookup -single_module -multiply_defined suppress
> -L/Library/Frameworks/R.framework/Resources/lib -L/usr/local/lib -o
> rgdal.so OGR_write.o gdal-bindings.o init.o inverser.o local_stubs.o
> ogr_geom.o ogr_polygons.o ogr_proj.o ogrdrivers.o ogrsource.o proj_info6.o
> projectit.o -L/Users/dosc3612/Applications/miniconda3/envs/rgdal/lib -lgdal
> -L/Users/dosc3612/Applications/miniconda3/envs/rgdal/lib -lproj
> -F/Library/Frameworks/R.framework/.. -framework R -Wl,-framework
> -Wl,CoreFoundation
> installing to
> /Library/Frameworks/R.framework/Versions/3.6/Resources/library/00LOCK-rgdal/00new/rgdal/libs
> ** R
> ** data
> ** inst
> ** byte-compile and prepare package for lazy loading
> ** help
> *** installing help indices
> ** building package indices
> ** installing vignettes
> ** testing if installed package can be loaded from temporary location
> Error: package or namespace load failed for ?rgdal? in dyn.load(file,
> DLLpath = DLLpath, ...):
> unable to load shared object
> '/Library/Frameworks/R.framework/Versions/3.6/Resources/library/00LOCK-rgdal/00new/rgdal/libs/rgdal.so':
>
> dlopen(/Library/Frameworks/R.framework/Versions/3.6/Resources/library/00LOCK-rgdal/00new/rgdal/libs/rgdal.so,
> 6): Library not loaded: @rpath/libgdal.26.dylib
>  Referenced from:
> /Library/Frameworks/R.framework/Versions/3.6/Resources/library/00LOCK-rgdal/00new/rgdal/libs/rgdal.so
>  Reason: image not found
> Error: loading failed
> Execution halted
> ERROR: loading failed
> * removing
> ?/Library/Frameworks/R.framework/Versions/3.6/Resources/library/rgdal?
>
> The downloaded source packages are in
> ?/private/var/folders/bb/13z2kq0j01jg5q_0ypjc76gr0000gn/T/Rtmpqaf8Yh/downloaded_packages?
> Warning message:
> In install.packages("rgdal", repo = "https://r-forge.r-project.org",  :
>  installation of package ?rgdal? had non-zero exit status
>>
>
> On Tue, Jun 11, 2019 at 10:32 AM Edzer Pebesma <
> edzer.pebesma at uni-muenster.de> wrote:
>
>> for compiling rgdal from source on OSX against gdal 3 and proj 6.1.0,
>> please use the dev version on r-forge. See also
>> https://github.com/r-spatial/sf/issues/1070
>>
>>
>> On 6/9/19 9:52 PM, Dominik Schneider wrote:
>>> I'm trying to install rgdal from source on a fresh r 3.6 installation.
>>> i setup a conda environment to install gdal, proj, geos
>>>
>>> install.packages('rgdal', type = "source",
>>>
>> configure.args=c('--with-proj-include=/Users/dosc3612/Applications/miniconda3/envs/rgdal/include',
>>> '--with-proj-lib=/Users/dosc3612/Applications/miniconda3/envs/rgdal/lib',
>>>
>> '--with-gdal-config=/Users/dosc3612/Applications/miniconda3/envs/rgdal/bin/gdal-config'))
>>>
>>> The full output is below but the first error I see is:
>>> ./configure: line 2101: pkg-config: command not found
>>> configure: pkg-config proj not available
>>>   set PKG_CONFIG_PATH to the directory containing proj.pc
>>> configure: PROJ version not determined using pkg-config proj
>>>
>>> which I don't understand because:
>>> Sys.getenv('PKG_CONFIG_PATH')
>>> [1] "/Users/dosc3612/Applications/miniconda3/envs/rgdal/lib/pkgconfig"
>>>
>>> and just to confirm:
>>> (rgdal) Phoenix:~ $ ls `echo $PKG_CONFIG_PATH` | grep proj
>>> proj.pc
>>>
>>> *Is there another way to set PKG_CONFIG_PATH within install.packages?*
>>>
>>> There are also some undefined symbols:
>>> Undefined symbols for architecture x86_64:
>>>   "_pj_ctx_fclose", referenced from:
>>>       _main in proj_conf_test2-9a39dc.o
>>>   "_pj_get_default_ctx", referenced from:
>>>       _main in proj_conf_test2-9a39dc.o
>>>   "_pj_open_lib", referenced from:
>>>       _main in proj_conf_test2-9a39dc.o
>>> ld: symbol(s) not found for architecture x86_64
>>> clang: error: linker command failed with exit code 1 (use -v to see
>>> invocation)
>>> ./configure: line 2422: ./proj_conf_test2: No such file or directory
>>>
>>> I tried with gdal 2.4.1 and gdal 3.0.0 (after seeing
>>>
>> http://r-sig-geo.2731867.n2.nabble.com/GDAL-3-0-0-and-rgdal-tt7592822.html#a7592834
>>> )
>>> proj is 6.1
>>> geos is 3.7.1
>>>
>>> What did I miss? Please advise. Thanks.
>>>
>>> FULL OUTPUT:
>>>> install.packages('rgdal', type = "source",
>>>
>> configure.args=c('--with-proj-include=/Users/dosc3612/Applications/miniconda3/envs/rgdal/include',
>>> '--with-proj-lib=/Users/dosc3612/Applications/miniconda3/envs/rgdal/lib',
>>>
>> '--with-gdal-config=/Users/dosc3612/Applications/miniconda3/envs/rgdal/bin/gdal-config'))
>>> --- Please select a CRAN mirror for use in this session ---
>>> trying URL 'https://cloud.r-project.org/src/contrib/rgdal_1.4-4.tar.gz'
>>> Content type 'application/x-gzip' length 1687518 bytes (1.6 MB)
>>> ==================================================
>>> downloaded 1.6 MB
>>>
>>> * installing *source* package ?rgdal? ...
>>> ** package ?rgdal? successfully unpacked and MD5 sums checked
>>> ** using staged installation
>>> configure: R_HOME: /Library/Frameworks/R.framework/Resources
>>> configure: CC: clang
>>> configure: CXX: clang++ -std=gnu++11
>>> configure: C++11 support available
>>> configure: rgdal: 1.4-4
>>> checking for /usr/bin/svnversion... yes
>>> configure: svn revision: 833
>>> configure: gdal-config set to
>>> /Users/dosc3612/Applications/miniconda3/envs/rgdal/bin/gdal-config
>>> checking gdal-config exists... yes
>>> checking gdal-config executable... yes
>>> checking gdal-config usability... yes
>>> configure: GDAL: 2.4.1
>>> checking C++11 support for GDAL >= 2.3.0... yes
>>> checking GDAL version >= 1.11.4... yes
>>> checking GDAL version <= 2.5 or >= 3.0... yes
>>> checking gdal: linking with --libs only... yes
>>> checking GDAL: gdal-config data directory readable... yes
>>> checking GDAL:
>>> /Users/dosc3612/Applications/miniconda3/envs/rgdal/share/gdal/pcs.csv
>>> readable... yes
>>> ./configure: line 2101: pkg-config: command not found
>>> configure: pkg-config proj not available
>>>   set PKG_CONFIG_PATH to the directory containing proj.pc
>>> configure: PROJ version not determined using pkg-config proj
>>> configure: proj CPP flags:
>>>  -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
>>> -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
>>> checking PROJ header API:... proj_api.h
>>> checking proj_api.h presence and usability... yes
>>> checking PROJ version >= 4.8.0... yes
>>> Undefined symbols for architecture x86_64:
>>>   "_pj_ctx_fclose", referenced from:
>>>       _main in proj_conf_test2-9a39dc.o
>>>   "_pj_get_default_ctx", referenced from:
>>>       _main in proj_conf_test2-9a39dc.o
>>>   "_pj_open_lib", referenced from:
>>>       _main in proj_conf_test2-9a39dc.o
>>> ld: symbol(s) not found for architecture x86_64
>>> clang: error: linker command failed with exit code 1 (use -v to see
>>> invocation)
>>> ./configure: line 2422: ./proj_conf_test2: No such file or directory
>>> checking PROJ.4: proj.db found and readable... yes
>>> Undefined symbols for architecture x86_64:
>>>   "_pj_ctx_fclose", referenced from:
>>>       _main in proj_conf_test3-9f8df7.o
>>>   "_pj_get_default_ctx", referenced from:
>>>       _main in proj_conf_test3-9f8df7.o
>>>   "_pj_open_lib", referenced from:
>>>       _main in proj_conf_test3-9f8df7.o
>>> ld: symbol(s) not found for architecture x86_64
>>> clang: error: linker command failed with exit code 1 (use -v to see
>>> invocation)
>>> ./configure: line 2482: ./proj_conf_test3: No such file or directory
>>> checking PROJ.4: conus found and readable... yes
>>> configure: Package CPP flags:
>>>  -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
>>> -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
>>> -DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
>>> configure: Package LIBS:
>>>  -L/Users/dosc3612/Applications/miniconda3/envs/rgdal/lib -lgdal
>>> -L/Users/dosc3612/Applications/miniconda3/envs/rgdal/lib -lproj
>>> configure: creating ./config.status
>>> config.status: creating src/Makevars
>>> ** libs
>>> clang++ -std=gnu++11
>> -I"/Library/Frameworks/R.framework/Resources/include"
>>> -DNDEBUG -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
>>> -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
>>> -DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
>>>
>> -I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
>>> -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
>>> -I/usr/local/include  -fPIC  -Wall -g -O2  -c OGR_write.cpp -o
>> OGR_write.o
>>> clang++ -std=gnu++11
>> -I"/Library/Frameworks/R.framework/Resources/include"
>>> -DNDEBUG -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
>>> -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
>>> -DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
>>>
>> -I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
>>> -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
>>> -I/usr/local/include  -fPIC  -Wall -g -O2  -c gdal-bindings.cpp -o
>>> gdal-bindings.o
>>> clang -I"/Library/Frameworks/R.framework/Resources/include" -DNDEBUG
>>> -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
>>> -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
>>> -DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
>>>
>> -I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
>>> -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
>>> -I/usr/local/include  -fPIC  -Wall -g -O2  -c init.c -o init.o
>>> clang -I"/Library/Frameworks/R.framework/Resources/include" -DNDEBUG
>>> -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
>>> -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
>>> -DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
>>>
>> -I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
>>> -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
>>> -I/usr/local/include  -fPIC  -Wall -g -O2  -c inverser.c -o inverser.o
>>> clang -I"/Library/Frameworks/R.framework/Resources/include" -DNDEBUG
>>> -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
>>> -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
>>> -DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
>>>
>> -I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
>>> -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
>>> -I/usr/local/include  -fPIC  -Wall -g -O2  -c local_stubs.c -o
>> local_stubs.o
>>> clang++ -std=gnu++11
>> -I"/Library/Frameworks/R.framework/Resources/include"
>>> -DNDEBUG -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
>>> -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
>>> -DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
>>>
>> -I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
>>> -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
>>> -I/usr/local/include  -fPIC  -Wall -g -O2  -c ogr_geom.cpp -o ogr_geom.o
>>> clang -I"/Library/Frameworks/R.framework/Resources/include" -DNDEBUG
>>> -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
>>> -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
>>> -DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
>>>
>> -I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
>>> -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
>>> -I/usr/local/include  -fPIC  -Wall -g -O2  -c ogr_polygons.c -o
>>> ogr_polygons.o
>>> clang++ -std=gnu++11
>> -I"/Library/Frameworks/R.framework/Resources/include"
>>> -DNDEBUG -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
>>> -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
>>> -DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
>>>
>> -I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
>>> -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
>>> -I/usr/local/include  -fPIC  -Wall -g -O2  -c ogr_proj.cpp -o ogr_proj.o
>>> clang++ -std=gnu++11
>> -I"/Library/Frameworks/R.framework/Resources/include"
>>> -DNDEBUG -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
>>> -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
>>> -DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
>>>
>> -I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
>>> -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
>>> -I/usr/local/include  -fPIC  -Wall -g -O2  -c ogrdrivers.cpp -o
>> ogrdrivers.o
>>> clang++ -std=gnu++11
>> -I"/Library/Frameworks/R.framework/Resources/include"
>>> -DNDEBUG -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
>>> -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
>>> -DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
>>>
>> -I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
>>> -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
>>> -I/usr/local/include  -fPIC  -Wall -g -O2  -c ogrsource.cpp -o
>> ogrsource.o
>>> clang++ -std=gnu++11
>> -I"/Library/Frameworks/R.framework/Resources/include"
>>> -DNDEBUG -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
>>> -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
>>> -DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
>>>
>> -I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
>>> -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
>>> -I/usr/local/include  -fPIC  -Wall -g -O2  -c proj_info6.cpp -o
>> proj_info6.o
>>> clang++ -std=gnu++11
>> -I"/Library/Frameworks/R.framework/Resources/include"
>>> -DNDEBUG -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
>>> -I/Users/dosc3612/Applications/miniconda3/envs/rgdal/include
>>> -DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
>>>
>> -I"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/sp/include"
>>> -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
>>> -I/usr/local/include  -fPIC  -Wall -g -O2  -c projectit.cpp -o
>> projectit.o
>>> clang++ -std=gnu++11 -dynamiclib -Wl,-headerpad_max_install_names
>>> -undefined dynamic_lookup -single_module -multiply_defined suppress
>>> -L/Library/Frameworks/R.framework/Resources/lib -L/usr/local/lib -o
>>> rgdal.so OGR_write.o gdal-bindings.o init.o inverser.o local_stubs.o
>>> ogr_geom.o ogr_polygons.o ogr_proj.o ogrdrivers.o ogrsource.o
>> proj_info6.o
>>> projectit.o -L/Users/dosc3612/Applications/miniconda3/envs/rgdal/lib
>> -lgdal
>>> -L/Users/dosc3612/Applications/miniconda3/envs/rgdal/lib -lproj
>>> -F/Library/Frameworks/R.framework/.. -framework R -Wl,-framework
>>> -Wl,CoreFoundation
>>> installing to
>>>
>> /Library/Frameworks/R.framework/Versions/3.6/Resources/library/00LOCK-rgdal/00new/rgdal/libs
>>> ** R
>>> ** data
>>> ** inst
>>> ** byte-compile and prepare package for lazy loading
>>> ** help
>>> *** installing help indices
>>> ** building package indices
>>> ** installing vignettes
>>> ** testing if installed package can be loaded from temporary location
>>> Error: package or namespace load failed for ?rgdal? in dyn.load(file,
>>> DLLpath = DLLpath, ...):
>>>  unable to load shared object
>>>
>> '/Library/Frameworks/R.framework/Versions/3.6/Resources/library/00LOCK-rgdal/00new/rgdal/libs/rgdal.so':
>>>
>>>
>> dlopen(/Library/Frameworks/R.framework/Versions/3.6/Resources/library/00LOCK-rgdal/00new/rgdal/libs/rgdal.so,
>>> 6): Library not loaded: @rpath/libgdal.20.dylib
>>>   Referenced from:
>>>
>> /Library/Frameworks/R.framework/Versions/3.6/Resources/library/00LOCK-rgdal/00new/rgdal/libs/rgdal.so
>>>   Reason: image not found
>>> Error: loading failed
>>> Execution halted
>>> ERROR: loading failed
>>> * removing
>>> ?/Library/Frameworks/R.framework/Versions/3.6/Resources/library/rgdal?
>>>
>>> The downloaded source packages are in
>>>
>> ?/private/var/folders/bb/13z2kq0j01jg5q_0ypjc76gr0000gn/T/RtmplsyMiu/downloaded_packages?
>>> Warning message:
>>> In install.packages("rgdal", type = "source", configure.args =
>>>
>> c("--with-proj-include=/Users/dosc3612/Applications/miniconda3/envs/rgdal/include",
>>>  :
>>>   installation of package ?rgdal? had non-zero exit status
>>>
>>>       [[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>> --
>> Edzer Pebesma
>> Institute for Geoinformatics
>> Heisenbergstrasse 2, 48151 Muenster, Germany
>> Phone: +49 251 8333081
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

From m@d|@z| @end|ng |rom gm@||@com  Fri Jun 21 11:53:01 2019
From: m@d|@z| @end|ng |rom gm@||@com (Andres Diaz Loaiza)
Date: Fri, 21 Jun 2019 11:53:01 +0200
Subject: [R-sig-Geo] 
 [FORGED] Create a Spatial Weight Matrix based on road distance
In-Reply-To: <MEAPR01MB32216AB3C4EFE314DFCA2041A4E70@MEAPR01MB3221.ausprd01.prod.outlook.com>
References: <CAFvJtoFemxph=u+ewBra6ebHLzaOC=49r3WFB6sJ5N7Zxs4m_Q@mail.gmail.com>
 <49e352fb-6742-86d6-bd7e-571088a0b3eb@auckland.ac.nz>
 <MEAPR01MB32216AB3C4EFE314DFCA2041A4E70@MEAPR01MB3221.ausprd01.prod.outlook.com>
Message-ID: <CAMXOh=1Y48St-XD9vYJDmarHo7ticE89CdKFUpfCFCAo7K3MpA@mail.gmail.com>

Dear Rolando,

The advantage of using Open Street Maps engine is that you can give the
travel option. This means you can select whether are you traveling by bike,
car or walking. The previous approach didn't consider this topic. For this,
you should have added a vector layer depending on your position of the
street you can take (or not). Open Street Maps project allow you two
options: a service in which you give your current position, the position
you want to reach and your transport method (giving you back the fastest
route). Or the option to download the engine/algorithm compile by yourself
(if I am not wrong is made in C or python) and then you can make your own
calculation at your own computer. For the first option, the package OSRM is
an interface in which send a request to the OSM web page and wait for an
answer. With this method, you can send a couple of request at the same time
but no to many (you should read the manual for this). Of course, also will
depend on whether the OSM server is down or not (or busy).

I have to say that I used some years ago this app and nowadays I know that
for some cities OSM has more streets reported than the same google maps.
Also is an open project and they let you download their data for free,
contrary to what google maps do.

All the best,


Andres

El vie., 21 jun. 2019 a las 4:30, Adrian Baddeley (<
adrian.baddeley at curtin.edu.au>) escribi?:

> Rather than converting an object of class 'SpatialLines' or
> 'SpatialLinesDataFrame' to the spatstat class 'psp' and then converting it
> to the spatstat class 'linnet', it is safer and more efficient to convert
> the SpatialLines* object directly to class linnet using
> as.linnet.SpatialLinesDataFrame() from the package 'maptools'.
>
>
> Prof Adrian Baddeley DSc FAA
>
> John Curtin Distinguished Professor
>
> Department of Mathematics and Statistics
>
> Curtin University, Perth, Western Australia
>
>
> ________________________________
> From: Rolf Turner <r.turner at auckland.ac.nz>
> Sent: Friday, 21 June 2019 10:08 AM
> To: Rolando Valdez
> Cc: r-sig-geo at r-project.org; Adrian Baddeley; Ege Rubak
> Subject: Re: [FORGED] [R-sig-Geo] Create a Spatial Weight Matrix based on
> road distance
>
>
> On 21/06/19 12:26 PM, Rolando Valdez wrote:
>
> > Dear community,
> >
> > Is there any way to create a spatial weight matrix based on road
> distance?
> > I am trying to use the road distance between two points instead of
> > euclidean distance.
> >
> > I've seen that there is a package named osrm. Can anyone give some
> advice?
>
> I don't know anything about "osrm".  Calculating "road distances" can be
> done in the spatstat package reasonably easily, if you take the trouble
> to represent your collection of roads as a "linnet" object.
>
> Given that you have done so, suppose that your linnet object is "L" and
> that you have vectors "x" and "y" specifying the points on L (i.e. on
> your roads) between which you want to know the distances.
>
> Do:
>
>      X    <- lpp(data.frame(x=x,y=y),L)
>      dMat <- pairdist(X)
>
> The object "dMat" is a (symmetric) square matrix; dMat[i,j] is the
> distance between point i and point j.  (Of course the diagonal entries
> are all 0.)
>
> If your collection of roads is specified by means of a shapefile,
> vignette("shapefiles") will tell you how to turn this collection into a
> "psp" ("planar segment pattern") object; the function (method)
> as.linnet.psp() can then be used to turn the "psp" object into a
> "linnet" object.
>
> HTH
>
> cheers,
>
> Rolf Turner
>
> --
> Honorary Research Fellow
> Department of Statistics
> University of Auckland
> Phone: +64-9-373-7599 ext. 88276
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


-- 
Andr?s D.

	[[alternative HTML version deleted]]


From roche||e@d@ @end|ng |rom gm@||@com  Fri Jun 21 19:56:29 2019
From: roche||e@d@ @end|ng |rom gm@||@com (Rochelle Schneider)
Date: Fri, 21 Jun 2019 17:56:29 +0000
Subject: [R-sig-Geo] Surface Chlorophyll data calculation
In-Reply-To: <VI1P189MB028599FE13304A374BC6B49D8BE40@VI1P189MB0285.EURP189.PROD.OUTLOOK.COM>
References: <VI1P189MB028599FE13304A374BC6B49D8BE40@VI1P189MB0285.EURP189.PROD.OUTLOOK.COM>
Message-ID: <LO2P265MB086370771DE8ED3629EB726D9AE70@LO2P265MB0863.GBRP265.PROD.OUTLOOK.COM>

Hi Juan Carlos,

You have 10 variables inside your NetCDF, which chlorophyll concentration (CHL) is the variable [1]. According to your link, all variables are provided by month and day (i.e. many time-layers for the same variable); therefore you do not need to calculate only extract it.


I would recommend you to start reading this post  https://dominicroye.github.io/en/2018/access-to-climate-reanalysis-data-from-r/, then go to this one https://www.r-bloggers.com/a-netcdf-4-in-r-cheatsheet/ which uses CHL data as well.


Cheers,

Rochelle Schneider
PhD Geospatial Analytics | MSc GIS | MSc Remote Sensing

________________________________
From: R-sig-Geo <r-sig-geo-bounces at r-project.org> on behalf of JC Arronte <j_arronte at hotmail.com>
Sent: 20 June 2019 17:36
To: r-sig-geo at r-project.org
Subject: [R-sig-Geo] Surface Chlorophyll data calculation

Hello,

This is my first post to this list. I am a beginner in R and GIS and  I work as researcher at Spanish Institute of Oceanography.

I have a ncdf file from the Copernicus webpage with monthly primary production data from the Northeastern Atlantic. In my case, the chlorophyll concentration from the following link,

 http://marine.copernicus.eu/services-portfolio/access-to-products/?option=com_csw&view=details&product_id=IBI_REANALYSIS_BIO_005_003

I want to calculate the monthly surface chlorophyll concentration. Unfortunately, after a lot of reading on the issue, I have been unable to come to any understanding.

Any indication of tutorials, scripts, sites or packages will be very welcomed.

Thanks in advance. Kindest regards,

Juan Carlos


        [[alternative HTML version deleted]]

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo

	[[alternative HTML version deleted]]


From |@r@@@|p@@||v@ @end|ng |rom gm@||@com  Sat Jun 22 07:43:26 2019
From: |@r@@@|p@@||v@ @end|ng |rom gm@||@com (Lara Silva)
Date: Sat, 22 Jun 2019 05:43:26 +0000
Subject: [R-sig-Geo] Plot a map in r (csv and shapefile)
In-Reply-To: <CANCB45uumhT6R_AT-0i7N+N8q9yQ7G4i-8KHMub9YJumwx4nhQ@mail.gmail.com>
References: <CALN9TESGL99JXXM3X+YsM_H-mkqygr4q6_N0cT0w=oowNvWiQQ@mail.gmail.com>
 <CANCB45uumhT6R_AT-0i7N+N8q9yQ7G4i-8KHMub9YJumwx4nhQ@mail.gmail.com>
Message-ID: <CALN9TEQf+o6xa86aKq6vz1ha_SQ-sNppmMbE0QzXBqOPzCwPtg@mail.gmail.com>

Awesome, thanks!

Ebrahim Jahanshiri <e.jahanshiri at gmail.com> escreveu no dia quinta,
20/06/2019 ?(s) 06:48:

> A good intro for beginners here but generally mapview package is your
> friend
>
> https://nceas.github.io/oss-lessons/spatial-data-gis-law/3-mon-intro-gis-in-r.html
>
> On Wed, Jun 19, 2019 at 6:40 PM Lara Silva <lara.sfp.silva at gmail.com>
> wrote:
>
>> Hello,
>>
>> I am new in R and I need to plot the occurrence of a species.
>> I have the presences of species (CSV) and the shapefile with the limits of
>> study area.
>>
>> Which code should I use?
>>
>> Regards,
>>
>> Lara
>>
>> <
>> https://www.avast.com/sig-email?utm_medium=email&utm_source=link&utm_campaign=sig-email&utm_content=webmail
>> >
>> Sem
>> v?rus. www.avast.com
>> <
>> https://www.avast.com/sig-email?utm_medium=email&utm_source=link&utm_campaign=sig-email&utm_content=webmail
>> >
>> <#DAB4FAD8-2DD7-40BB-A1B8-4E2AA1F9FDF2>
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>

	[[alternative HTML version deleted]]


From rv@|dezr @end|ng |rom gm@||@com  Sun Jun 23 03:17:09 2019
From: rv@|dezr @end|ng |rom gm@||@com (Rolando Valdez)
Date: Sat, 22 Jun 2019 18:17:09 -0700
Subject: [R-sig-Geo] 
 [FORGED] Create a Spatial Weight Matrix based on road distance
In-Reply-To: <49e352fb-6742-86d6-bd7e-571088a0b3eb@auckland.ac.nz>
References: <CAFvJtoFemxph=u+ewBra6ebHLzaOC=49r3WFB6sJ5N7Zxs4m_Q@mail.gmail.com>
 <49e352fb-6742-86d6-bd7e-571088a0b3eb@auckland.ac.nz>
Message-ID: <CAFvJtoH4s5oqkmjP=jyJFhRNQBn1EUm442GY6yRsMEUxX7O45A@mail.gmail.com>

Thank you for your answer.

I have a shapefile with, say, counties, and I got another shapefile with
the roads. ?What if a county does not intersect any road?

El jue., 20 de jun. de 2019 a la(s) 19:08, Rolf Turner (
r.turner at auckland.ac.nz) escribi?:

>
> On 21/06/19 12:26 PM, Rolando Valdez wrote:
>
> > Dear community,
> >
> > Is there any way to create a spatial weight matrix based on road
> distance?
> > I am trying to use the road distance between two points instead of
> > euclidean distance.
> >
> > I've seen that there is a package named osrm. Can anyone give some
> advice?
>
> I don't know anything about "osrm".  Calculating "road distances" can be
> done in the spatstat package reasonably easily, if you take the trouble
> to represent your collection of roads as a "linnet" object.
>
> Given that you have done so, suppose that your linnet object is "L" and
> that you have vectors "x" and "y" specifying the points on L (i.e. on
> your roads) between which you want to know the distances.
>
> Do:
>
>      X    <- lpp(data.frame(x=x,y=y),L)
>      dMat <- pairdist(X)
>
> The object "dMat" is a (symmetric) square matrix; dMat[i,j] is the
> distance between point i and point j.  (Of course the diagonal entries
> are all 0.)
>
> If your collection of roads is specified by means of a shapefile,
> vignette("shapefiles") will tell you how to turn this collection into a
> "psp" ("planar segment pattern") object; the function (method)
> as.linnet.psp() can then be used to turn the "psp" object into a
> "linnet" object.
>
> HTH
>
> cheers,
>
> Rolf Turner
>
> --
> Honorary Research Fellow
> Department of Statistics
> University of Auckland
> Phone: +64-9-373-7599 ext. 88276
>


-- 
Rol~

	[[alternative HTML version deleted]]


From r@turner @end|ng |rom @uck|@nd@@c@nz  Sun Jun 23 04:28:39 2019
From: r@turner @end|ng |rom @uck|@nd@@c@nz (Rolf Turner)
Date: Sun, 23 Jun 2019 14:28:39 +1200
Subject: [R-sig-Geo] 
 [FORGED] Create a Spatial Weight Matrix based on road distance
In-Reply-To: <CAFvJtoH4s5oqkmjP=jyJFhRNQBn1EUm442GY6yRsMEUxX7O45A@mail.gmail.com>
References: <CAFvJtoFemxph=u+ewBra6ebHLzaOC=49r3WFB6sJ5N7Zxs4m_Q@mail.gmail.com>
 <49e352fb-6742-86d6-bd7e-571088a0b3eb@auckland.ac.nz>
 <CAFvJtoH4s5oqkmjP=jyJFhRNQBn1EUm442GY6yRsMEUxX7O45A@mail.gmail.com>
Message-ID: <946cf6cb-6863-e853-c458-0a5a9c144f68@auckland.ac.nz>


On 23/06/19 1:17 PM, Rolando Valdez wrote:

> Thank you for your answer.
> 
> I have a shapefile with, say, counties, and I got another shapefile with 
> the roads. ?What if a county does not intersect any road?

I am sorry, but it is not at all clear to me just what the problem is. 
How do the counties come into the picture?  You said you wanted to get 
the road distance between points on the roads.  What have the counties 
got to do with this?

Can you perhaps provide a reproducible example?

cheers,

Rolf

> 
> El jue., 20 de jun. de 2019 a la(s) 19:08, Rolf Turner 
> (r.turner at auckland.ac.nz <mailto:r.turner at auckland.ac.nz>) escribi?:
> 
> 
>     On 21/06/19 12:26 PM, Rolando Valdez wrote:
> 
>      > Dear community,
>      >
>      > Is there any way to create a spatial weight matrix based on road
>     distance?
>      > I am trying to use the road distance between two points instead of
>      > euclidean distance.
>      >
>      > I've seen that there is a package named osrm. Can anyone give
>     some advice?
> 
>     I don't know anything about "osrm".? Calculating "road distances"
>     can be
>     done in the spatstat package reasonably easily, if you take the trouble
>     to represent your collection of roads as a "linnet" object.
> 
>     Given that you have done so, suppose that your linnet object is "L" and
>     that you have vectors "x" and "y" specifying the points on L (i.e. on
>     your roads) between which you want to know the distances.
> 
>     Do:
> 
>      ? ? ?X? ? <- lpp(data.frame(x=x,y=y),L)
>      ? ? ?dMat <- pairdist(X)
> 
>     The object "dMat" is a (symmetric) square matrix; dMat[i,j] is the
>     distance between point i and point j.? (Of course the diagonal entries
>     are all 0.)
> 
>     If your collection of roads is specified by means of a shapefile,
>     vignette("shapefiles") will tell you how to turn this collection into a
>     "psp" ("planar segment pattern") object; the function (method)
>     as.linnet.psp() can then be used to turn the "psp" object into a
>     "linnet" object.
> 
>     HTH


From rv@|dezr @end|ng |rom gm@||@com  Sun Jun 23 04:38:59 2019
From: rv@|dezr @end|ng |rom gm@||@com (Rolando Valdez)
Date: Sat, 22 Jun 2019 19:38:59 -0700
Subject: [R-sig-Geo] 
 [FORGED] Create a Spatial Weight Matrix based on road distance
In-Reply-To: <946cf6cb-6863-e853-c458-0a5a9c144f68@auckland.ac.nz>
References: <CAFvJtoFemxph=u+ewBra6ebHLzaOC=49r3WFB6sJ5N7Zxs4m_Q@mail.gmail.com>
 <49e352fb-6742-86d6-bd7e-571088a0b3eb@auckland.ac.nz>
 <CAFvJtoH4s5oqkmjP=jyJFhRNQBn1EUm442GY6yRsMEUxX7O45A@mail.gmail.com>
 <946cf6cb-6863-e853-c458-0a5a9c144f68@auckland.ac.nz>
Message-ID: <CAFvJtoFooKRQKFDSd+hysJ=1_h2gfA3ZUH1F3x8kocxo-YuUgQ@mail.gmail.com>

I am sorry, I was not clear enough. My goal is to calculate a spatial
weight matrix (nxn) across counties but, instead of euclidean distance, to
use road distance.

El s?b., 22 de jun. de 2019 a la(s) 19:28, Rolf Turner (
r.turner at auckland.ac.nz) escribi?:

>
> On 23/06/19 1:17 PM, Rolando Valdez wrote:
>
> > Thank you for your answer.
> >
> > I have a shapefile with, say, counties, and I got another shapefile with
> > the roads. ?What if a county does not intersect any road?
>
> I am sorry, but it is not at all clear to me just what the problem is.
> How do the counties come into the picture?  You said you wanted to get
> the road distance between points on the roads.  What have the counties
> got to do with this?
>
> Can you perhaps provide a reproducible example?
>
> cheers,
>
> Rolf
>
> >
> > El jue., 20 de jun. de 2019 a la(s) 19:08, Rolf Turner
> > (r.turner at auckland.ac.nz <mailto:r.turner at auckland.ac.nz>) escribi?:
> >
> >
> >     On 21/06/19 12:26 PM, Rolando Valdez wrote:
> >
> >      > Dear community,
> >      >
> >      > Is there any way to create a spatial weight matrix based on road
> >     distance?
> >      > I am trying to use the road distance between two points instead of
> >      > euclidean distance.
> >      >
> >      > I've seen that there is a package named osrm. Can anyone give
> >     some advice?
> >
> >     I don't know anything about "osrm".  Calculating "road distances"
> >     can be
> >     done in the spatstat package reasonably easily, if you take the
> trouble
> >     to represent your collection of roads as a "linnet" object.
> >
> >     Given that you have done so, suppose that your linnet object is "L"
> and
> >     that you have vectors "x" and "y" specifying the points on L (i.e. on
> >     your roads) between which you want to know the distances.
> >
> >     Do:
> >
> >           X    <- lpp(data.frame(x=x,y=y),L)
> >           dMat <- pairdist(X)
> >
> >     The object "dMat" is a (symmetric) square matrix; dMat[i,j] is the
> >     distance between point i and point j.  (Of course the diagonal
> entries
> >     are all 0.)
> >
> >     If your collection of roads is specified by means of a shapefile,
> >     vignette("shapefiles") will tell you how to turn this collection
> into a
> >     "psp" ("planar segment pattern") object; the function (method)
> >     as.linnet.psp() can then be used to turn the "psp" object into a
> >     "linnet" object.
> >
> >     HTH
>


-- 
Rol~

	[[alternative HTML version deleted]]


From r@turner @end|ng |rom @uck|@nd@@c@nz  Sun Jun 23 05:00:02 2019
From: r@turner @end|ng |rom @uck|@nd@@c@nz (Rolf Turner)
Date: Sun, 23 Jun 2019 15:00:02 +1200
Subject: [R-sig-Geo] 
 [FORGED] Create a Spatial Weight Matrix based on road distance
In-Reply-To: <CAFvJtoFooKRQKFDSd+hysJ=1_h2gfA3ZUH1F3x8kocxo-YuUgQ@mail.gmail.com>
References: <CAFvJtoFemxph=u+ewBra6ebHLzaOC=49r3WFB6sJ5N7Zxs4m_Q@mail.gmail.com>
 <49e352fb-6742-86d6-bd7e-571088a0b3eb@auckland.ac.nz>
 <CAFvJtoH4s5oqkmjP=jyJFhRNQBn1EUm442GY6yRsMEUxX7O45A@mail.gmail.com>
 <946cf6cb-6863-e853-c458-0a5a9c144f68@auckland.ac.nz>
 <CAFvJtoFooKRQKFDSd+hysJ=1_h2gfA3ZUH1F3x8kocxo-YuUgQ@mail.gmail.com>
Message-ID: <9f41bccc-43ca-6789-34ff-bac633de2a86@auckland.ac.nz>


On 23/06/19 2:38 PM, Rolando Valdez wrote:

> I am sorry, I was not clear enough. My goal is to calculate a spatial 
> weight matrix (nxn) across counties but, instead of euclidean distance, 
> to use road distance.

I'm afraid I still don't understand.  To put it mildly. You presumably 
have a clear idea of what you are trying to, but those of us who are not 
involved in your research have no such idea.  We (or at least I) haven't 
a clue as to what you are talking about.

What do you mean by "spatial weight"?  What are these weights used for? 
What is n?  How are the counties involved?  Is n the number of counties? 
Are you interested in the road distance (minimum road distance?) between 
pairs of counties?

Please explain *clearly* and do not expect those who are trying to help 
you to be mind-readers!!!

cheers,

Rolf

> 
> El s?b., 22 de jun. de 2019 a la(s) 19:28, Rolf Turner 
> (r.turner at auckland.ac.nz <mailto:r.turner at auckland.ac.nz>) escribi?:
> 
> 
>     On 23/06/19 1:17 PM, Rolando Valdez wrote:
> 
>      > Thank you for your answer.
>      >
>      > I have a shapefile with, say, counties, and I got another
>     shapefile with
>      > the roads. ?What if a county does not intersect any road?
> 
>     I am sorry, but it is not at all clear to me just what the problem is.
>     How do the counties come into the picture?? You said you wanted to get
>     the road distance between points on the roads.? What have the counties
>     got to do with this?
> 
>     Can you perhaps provide a reproducible example?
> 
>     cheers,
> 
>     Rolf
> 
>      >
>      > El jue., 20 de jun. de 2019 a la(s) 19:08, Rolf Turner
>      > (r.turner at auckland.ac.nz <mailto:r.turner at auckland.ac.nz>
>     <mailto:r.turner at auckland.ac.nz <mailto:r.turner at auckland.ac.nz>>)
>     escribi?:
>      >
>      >
>      >? ? ?On 21/06/19 12:26 PM, Rolando Valdez wrote:
>      >
>      >? ? ? > Dear community,
>      >? ? ? >
>      >? ? ? > Is there any way to create a spatial weight matrix based
>     on road
>      >? ? ?distance?
>      >? ? ? > I am trying to use the road distance between two points
>     instead of
>      >? ? ? > euclidean distance.
>      >? ? ? >
>      >? ? ? > I've seen that there is a package named osrm. Can anyone give
>      >? ? ?some advice?
>      >
>      >? ? ?I don't know anything about "osrm".? Calculating "road distances"
>      >? ? ?can be
>      >? ? ?done in the spatstat package reasonably easily, if you take
>     the trouble
>      >? ? ?to represent your collection of roads as a "linnet" object.
>      >
>      >? ? ?Given that you have done so, suppose that your linnet object
>     is "L" and
>      >? ? ?that you have vectors "x" and "y" specifying the points on L
>     (i.e. on
>      >? ? ?your roads) between which you want to know the distances.
>      >
>      >? ? ?Do:
>      >
>      >? ? ? ? ? ?X? ? <- lpp(data.frame(x=x,y=y),L)
>      >? ? ? ? ? ?dMat <- pairdist(X)
>      >
>      >? ? ?The object "dMat" is a (symmetric) square matrix; dMat[i,j]
>     is the
>      >? ? ?distance between point i and point j.? (Of course the
>     diagonal entries
>      >? ? ?are all 0.)
>      >
>      >? ? ?If your collection of roads is specified by means of a shapefile,
>      >? ? ?vignette("shapefiles") will tell you how to turn this
>     collection into a
>      >? ? ?"psp" ("planar segment pattern") object; the function (method)
>      >? ? ?as.linnet.psp() can then be used to turn the "psp" object into a
>      >? ? ?"linnet" object.
>      >
>      >? ? ?HTH


From rv@|dezr @end|ng |rom gm@||@com  Sun Jun 23 05:30:28 2019
From: rv@|dezr @end|ng |rom gm@||@com (Rolando Valdez)
Date: Sat, 22 Jun 2019 20:30:28 -0700
Subject: [R-sig-Geo] 
 [FORGED] Create a Spatial Weight Matrix based on road distance
In-Reply-To: <9f41bccc-43ca-6789-34ff-bac633de2a86@auckland.ac.nz>
References: <CAFvJtoFemxph=u+ewBra6ebHLzaOC=49r3WFB6sJ5N7Zxs4m_Q@mail.gmail.com>
 <49e352fb-6742-86d6-bd7e-571088a0b3eb@auckland.ac.nz>
 <CAFvJtoH4s5oqkmjP=jyJFhRNQBn1EUm442GY6yRsMEUxX7O45A@mail.gmail.com>
 <946cf6cb-6863-e853-c458-0a5a9c144f68@auckland.ac.nz>
 <CAFvJtoFooKRQKFDSd+hysJ=1_h2gfA3ZUH1F3x8kocxo-YuUgQ@mail.gmail.com>
 <9f41bccc-43ca-6789-34ff-bac633de2a86@auckland.ac.nz>
Message-ID: <CAFvJtoFCY18APnXSOQ_PoCLjiyh0baMGEyqjedOEzdOPSVXt7Q@mail.gmail.com>

Sorry again.

A Spatial Weight Matrix (swm) is an object used in spatial econometrics to
characterize the spatial structure among territories. It is an element nxn
where n is the number of territorial units (counties, districts, states,
cities, regions) in the sample and it could be based on contiguity or
distance. Usually, you can create a swm based on distance using
'dnearneigh' from spdep and then convert to a listw through 'nb2listw'. The
problem is that the matrix that you generate trough 'dnearneigh'computes
the euclidean distance among centroids of polygons. This is where I spot my
issue, I need to compute the swm using the road distance instead of
euclidean distance computed through 'dnearneigh'. I do have a shapefile
with poligons (counties) and another shapefile with lines (roads).


El s?b., 22 de jun. de 2019 a la(s) 20:00, Rolf Turner (
r.turner at auckland.ac.nz) escribi?:

>
> On 23/06/19 2:38 PM, Rolando Valdez wrote:
>
> > I am sorry, I was not clear enough. My goal is to calculate a spatial
> > weight matrix (nxn) across counties but, instead of euclidean distance,
> > to use road distance.
>
> I'm afraid I still don't understand.  To put it mildly. You presumably
> have a clear idea of what you are trying to, but those of us who are not
> involved in your research have no such idea.  We (or at least I) haven't
> a clue as to what you are talking about.
>
> What do you mean by "spatial weight"?  What are these weights used for?
> What is n?  How are the counties involved?  Is n the number of counties?
> Are you interested in the road distance (minimum road distance?) between
> pairs of counties?
>
> Please explain *clearly* and do not expect those who are trying to help
> you to be mind-readers!!!
>
> cheers,
>
> Rolf
>
> >
> > El s?b., 22 de jun. de 2019 a la(s) 19:28, Rolf Turner
> > (r.turner at auckland.ac.nz <mailto:r.turner at auckland.ac.nz>) escribi?:
> >
> >
> >     On 23/06/19 1:17 PM, Rolando Valdez wrote:
> >
> >      > Thank you for your answer.
> >      >
> >      > I have a shapefile with, say, counties, and I got another
> >     shapefile with
> >      > the roads. ?What if a county does not intersect any road?
> >
> >     I am sorry, but it is not at all clear to me just what the problem
> is.
> >     How do the counties come into the picture?  You said you wanted to
> get
> >     the road distance between points on the roads.  What have the
> counties
> >     got to do with this?
> >
> >     Can you perhaps provide a reproducible example?
> >
> >     cheers,
> >
> >     Rolf
> >
> >      >
> >      > El jue., 20 de jun. de 2019 a la(s) 19:08, Rolf Turner
> >      > (r.turner at auckland.ac.nz <mailto:r.turner at auckland.ac.nz>
> >     <mailto:r.turner at auckland.ac.nz <mailto:r.turner at auckland.ac.nz>>)
> >     escribi?:
> >      >
> >      >
> >      >     On 21/06/19 12:26 PM, Rolando Valdez wrote:
> >      >
> >      >      > Dear community,
> >      >      >
> >      >      > Is there any way to create a spatial weight matrix based
> >     on road
> >      >     distance?
> >      >      > I am trying to use the road distance between two points
> >     instead of
> >      >      > euclidean distance.
> >      >      >
> >      >      > I've seen that there is a package named osrm. Can anyone
> give
> >      >     some advice?
> >      >
> >      >     I don't know anything about "osrm".  Calculating "road
> distances"
> >      >     can be
> >      >     done in the spatstat package reasonably easily, if you take
> >     the trouble
> >      >     to represent your collection of roads as a "linnet" object.
> >      >
> >      >     Given that you have done so, suppose that your linnet object
> >     is "L" and
> >      >     that you have vectors "x" and "y" specifying the points on L
> >     (i.e. on
> >      >     your roads) between which you want to know the distances.
> >      >
> >      >     Do:
> >      >
> >      >           X    <- lpp(data.frame(x=x,y=y),L)
> >      >           dMat <- pairdist(X)
> >      >
> >      >     The object "dMat" is a (symmetric) square matrix; dMat[i,j]
> >     is the
> >      >     distance between point i and point j.  (Of course the
> >     diagonal entries
> >      >     are all 0.)
> >      >
> >      >     If your collection of roads is specified by means of a
> shapefile,
> >      >     vignette("shapefiles") will tell you how to turn this
> >     collection into a
> >      >     "psp" ("planar segment pattern") object; the function (method)
> >      >     as.linnet.psp() can then be used to turn the "psp" object
> into a
> >      >     "linnet" object.
> >      >
> >      >     HTH
>


-- 
Rol~

	[[alternative HTML version deleted]]


From r@turner @end|ng |rom @uck|@nd@@c@nz  Sun Jun 23 06:15:31 2019
From: r@turner @end|ng |rom @uck|@nd@@c@nz (Rolf Turner)
Date: Sun, 23 Jun 2019 16:15:31 +1200
Subject: [R-sig-Geo] 
 [FORGED] Create a Spatial Weight Matrix based on road distance
In-Reply-To: <CAFvJtoFCY18APnXSOQ_PoCLjiyh0baMGEyqjedOEzdOPSVXt7Q@mail.gmail.com>
References: <CAFvJtoFemxph=u+ewBra6ebHLzaOC=49r3WFB6sJ5N7Zxs4m_Q@mail.gmail.com>
 <49e352fb-6742-86d6-bd7e-571088a0b3eb@auckland.ac.nz>
 <CAFvJtoH4s5oqkmjP=jyJFhRNQBn1EUm442GY6yRsMEUxX7O45A@mail.gmail.com>
 <946cf6cb-6863-e853-c458-0a5a9c144f68@auckland.ac.nz>
 <CAFvJtoFooKRQKFDSd+hysJ=1_h2gfA3ZUH1F3x8kocxo-YuUgQ@mail.gmail.com>
 <9f41bccc-43ca-6789-34ff-bac633de2a86@auckland.ac.nz>
 <CAFvJtoFCY18APnXSOQ_PoCLjiyh0baMGEyqjedOEzdOPSVXt7Q@mail.gmail.com>
Message-ID: <bb171071-37d1-1da9-1b08-490019051634@auckland.ac.nz>

On 23/06/19 3:30 PM, Rolando Valdez wrote:
> Sorry again.
> 
> A Spatial Weight Matrix (swm) is an object used in spatial econometrics 
> to characterize the spatial structure among territories. It is an 
> element nxn where n is the number of territorial units (counties, 
> districts, states, cities, regions) in the sample and it could be based 
> on contiguity or distance. Usually, you can create a swm based on 
> distance using 'dnearneigh' from spdep and then convert to a listw 
> through 'nb2listw'. The problem is that the matrix that you generate 
> trough 'dnearneigh'computes the euclidean distance among centroids of 
> polygons. This is where I spot my issue, I need to compute the swm using 
> the road distance instead of euclidean distance computed through 
> 'dnearneigh'. I do have a shapefile with poligons (counties) and another 
> shapefile with lines (roads).

OK.  It's getting a *bit* clearer ....  You are interested in "road 
distances" between counties.  I'm still not entirely sure what this 
means.  Is it the *minimum* distance by road from one county to another? 
In which case, if two counties are contiguous (adjacent) and there is a 
road crossing the border between the two, is the distance between the 
counties equal to zero?  (This doesn't seem like it would be 
satisfactory ....)

If this is not the case, then what *is* the case?  Perhaps you want 
distances between the *centroids* of the counties.  What then do you 
mean by road distance when the centroids do not lie on a road?

You apparently need to deal with counties in which there are no roads at 
all.  To handle this you have to define what *you* mean by the distance 
by road from county A to county B when there are no roads at all in 
county B.  Perhaps infinity would be the appropriate distance, but *I* 
don't know; you have to make the call.

Previously you indicated that you needed to know (pairwise) road 
distances between specified points in a given set, and I showed you how 
to obtain those using pairdist(), from spatstat.  Now it seems that you 
want something rather different, and it's still not clear what.

You need to get *your* thoughts clear; make some definitions and 
specifications, and decide what you really want or need.

It seems that you are expecting R to magically do your thinking for you; 
it won't!

cheers,

Rolf

> El s?b., 22 de jun. de 2019 a la(s) 20:00, Rolf Turner 
> (r.turner at auckland.ac.nz <mailto:r.turner at auckland.ac.nz>) escribi?:
> 
> 
>     On 23/06/19 2:38 PM, Rolando Valdez wrote:
> 
>      > I am sorry, I was not clear enough. My goal is to calculate a
>     spatial
>      > weight matrix (nxn) across counties but, instead of euclidean
>     distance,
>      > to use road distance.
> 
>     I'm afraid I still don't understand.? To put it mildly. You presumably
>     have a clear idea of what you are trying to, but those of us who are
>     not
>     involved in your research have no such idea.? We (or at least I)
>     haven't
>     a clue as to what you are talking about.
> 
>     What do you mean by "spatial weight"?? What are these weights used for?
>     What is n?? How are the counties involved?? Is n the number of
>     counties?
>     Are you interested in the road distance (minimum road distance?)
>     between
>     pairs of counties?
> 
>     Please explain *clearly* and do not expect those who are trying to help
>     you to be mind-readers!!!
> 
>     cheers,
> 
>     Rolf
> 
>      >
>      > El s?b., 22 de jun. de 2019 a la(s) 19:28, Rolf Turner
>      > (r.turner at auckland.ac.nz <mailto:r.turner at auckland.ac.nz>
>     <mailto:r.turner at auckland.ac.nz <mailto:r.turner at auckland.ac.nz>>)
>     escribi?:
>      >
>      >
>      >? ? ?On 23/06/19 1:17 PM, Rolando Valdez wrote:
>      >
>      >? ? ? > Thank you for your answer.
>      >? ? ? >
>      >? ? ? > I have a shapefile with, say, counties, and I got another
>      >? ? ?shapefile with
>      >? ? ? > the roads. ?What if a county does not intersect any road?
>      >
>      >? ? ?I am sorry, but it is not at all clear to me just what the
>     problem is.
>      >? ? ?How do the counties come into the picture?? You said you
>     wanted to get
>      >? ? ?the road distance between points on the roads.? What have the
>     counties
>      >? ? ?got to do with this?
>      >
>      >? ? ?Can you perhaps provide a reproducible example?
>      >
>      >? ? ?cheers,
>      >
>      >? ? ?Rolf
>      >
>      >? ? ? >
>      >? ? ? > El jue., 20 de jun. de 2019 a la(s) 19:08, Rolf Turner
>      >? ? ? > (r.turner at auckland.ac.nz <mailto:r.turner at auckland.ac.nz>
>     <mailto:r.turner at auckland.ac.nz <mailto:r.turner at auckland.ac.nz>>
>      >? ? ?<mailto:r.turner at auckland.ac.nz
>     <mailto:r.turner at auckland.ac.nz> <mailto:r.turner at auckland.ac.nz
>     <mailto:r.turner at auckland.ac.nz>>>)
>      >? ? ?escribi?:
>      >? ? ? >
>      >? ? ? >
>      >? ? ? >? ? ?On 21/06/19 12:26 PM, Rolando Valdez wrote:
>      >? ? ? >
>      >? ? ? >? ? ? > Dear community,
>      >? ? ? >? ? ? >
>      >? ? ? >? ? ? > Is there any way to create a spatial weight matrix
>     based
>      >? ? ?on road
>      >? ? ? >? ? ?distance?
>      >? ? ? >? ? ? > I am trying to use the road distance between two points
>      >? ? ?instead of
>      >? ? ? >? ? ? > euclidean distance.
>      >? ? ? >? ? ? >
>      >? ? ? >? ? ? > I've seen that there is a package named osrm. Can
>     anyone give
>      >? ? ? >? ? ?some advice?
>      >? ? ? >
>      >? ? ? >? ? ?I don't know anything about "osrm".? Calculating "road
>     distances"
>      >? ? ? >? ? ?can be
>      >? ? ? >? ? ?done in the spatstat package reasonably easily, if you
>     take
>      >? ? ?the trouble
>      >? ? ? >? ? ?to represent your collection of roads as a "linnet"
>     object.
>      >? ? ? >
>      >? ? ? >? ? ?Given that you have done so, suppose that your linnet
>     object
>      >? ? ?is "L" and
>      >? ? ? >? ? ?that you have vectors "x" and "y" specifying the
>     points on L
>      >? ? ?(i.e. on
>      >? ? ? >? ? ?your roads) between which you want to know the distances.
>      >? ? ? >
>      >? ? ? >? ? ?Do:
>      >? ? ? >
>      >? ? ? >? ? ? ? ? ?X? ? <- lpp(data.frame(x=x,y=y),L)
>      >? ? ? >? ? ? ? ? ?dMat <- pairdist(X)
>      >? ? ? >
>      >? ? ? >? ? ?The object "dMat" is a (symmetric) square matrix;
>     dMat[i,j]
>      >? ? ?is the
>      >? ? ? >? ? ?distance between point i and point j.? (Of course the
>      >? ? ?diagonal entries
>      >? ? ? >? ? ?are all 0.)
>      >? ? ? >
>      >? ? ? >? ? ?If your collection of roads is specified by means of a
>     shapefile,
>      >? ? ? >? ? ?vignette("shapefiles") will tell you how to turn this
>      >? ? ?collection into a
>      >? ? ? >? ? ?"psp" ("planar segment pattern") object; the function
>     (method)
>      >? ? ? >? ? ?as.linnet.psp() can then be used to turn the "psp"
>     object into a
>      >? ? ? >? ? ?"linnet" object.
>      >? ? ? >
>      >? ? ? >? ? ?HTH


From c@rr@nz@ju@np @end|ng |rom gm@||@com  Sun Jun 23 07:17:18 2019
From: c@rr@nz@ju@np @end|ng |rom gm@||@com (Juan Pablo Carranza)
Date: Sun, 23 Jun 2019 02:17:18 -0300
Subject: [R-sig-Geo] 
 [FORGED] Create a Spatial Weight Matrix based on road distance
In-Reply-To: <bb171071-37d1-1da9-1b08-490019051634@auckland.ac.nz>
References: <CAFvJtoFemxph=u+ewBra6ebHLzaOC=49r3WFB6sJ5N7Zxs4m_Q@mail.gmail.com>
 <49e352fb-6742-86d6-bd7e-571088a0b3eb@auckland.ac.nz>
 <CAFvJtoH4s5oqkmjP=jyJFhRNQBn1EUm442GY6yRsMEUxX7O45A@mail.gmail.com>
 <946cf6cb-6863-e853-c458-0a5a9c144f68@auckland.ac.nz>
 <CAFvJtoFooKRQKFDSd+hysJ=1_h2gfA3ZUH1F3x8kocxo-YuUgQ@mail.gmail.com>
 <9f41bccc-43ca-6789-34ff-bac633de2a86@auckland.ac.nz>
 <CAFvJtoFCY18APnXSOQ_PoCLjiyh0baMGEyqjedOEzdOPSVXt7Q@mail.gmail.com>
 <bb171071-37d1-1da9-1b08-490019051634@auckland.ac.nz>
Message-ID: <CAFSWaCObTTNm-LNE4jyFp4wLmsQB0=cZFfXfDWSEF1nG6FTbXA@mail.gmail.com>

Hi all!
I don't have the specific answer, but I don't appreciate academic bullying
either. So... here is a way you could take. Go to qgis, calculate road
distances by network analysis and then add it to your dataframe. Use this
new variable to weigth the matrix.
I hope this serves, and I hope Rolf solves what ever is bothering *him*.
Cheers

Juan Pablo Carranza
Mgter. en Administraci?n P?blica
Lic. en Econom?a

El dom., 23 de jun. de 2019 1:16 a. m., Rolf Turner <r.turner at auckland.ac.nz>
escribi?:

> On 23/06/19 3:30 PM, Rolando Valdez wrote:
> > Sorry again.
> >
> > A Spatial Weight Matrix (swm) is an object used in spatial econometrics
> > to characterize the spatial structure among territories. It is an
> > element nxn where n is the number of territorial units (counties,
> > districts, states, cities, regions) in the sample and it could be based
> > on contiguity or distance. Usually, you can create a swm based on
> > distance using 'dnearneigh' from spdep and then convert to a listw
> > through 'nb2listw'. The problem is that the matrix that you generate
> > trough 'dnearneigh'computes the euclidean distance among centroids of
> > polygons. This is where I spot my issue, I need to compute the swm using
> > the road distance instead of euclidean distance computed through
> > 'dnearneigh'. I do have a shapefile with poligons (counties) and another
> > shapefile with lines (roads).
>
> OK.  It's getting a *bit* clearer ....  You are interested in "road
> distances" between counties.  I'm still not entirely sure what this
> means.  Is it the *minimum* distance by road from one county to another?
> In which case, if two counties are contiguous (adjacent) and there is a
> road crossing the border between the two, is the distance between the
> counties equal to zero?  (This doesn't seem like it would be
> satisfactory ....)
>
> If this is not the case, then what *is* the case?  Perhaps you want
> distances between the *centroids* of the counties.  What then do you
> mean by road distance when the centroids do not lie on a road?
>
> You apparently need to deal with counties in which there are no roads at
> all.  To handle this you have to define what *you* mean by the distance
> by road from county A to county B when there are no roads at all in
> county B.  Perhaps infinity would be the appropriate distance, but *I*
> don't know; you have to make the call.
>
> Previously you indicated that you needed to know (pairwise) road
> distances between specified points in a given set, and I showed you how
> to obtain those using pairdist(), from spatstat.  Now it seems that you
> want something rather different, and it's still not clear what.
>
> You need to get *your* thoughts clear; make some definitions and
> specifications, and decide what you really want or need.
>
> It seems that you are expecting R to magically do your thinking for you;
> it won't!
>
> cheers,
>
> Rolf
>
> > El s?b., 22 de jun. de 2019 a la(s) 20:00, Rolf Turner
> > (r.turner at auckland.ac.nz <mailto:r.turner at auckland.ac.nz>) escribi?:
> >
> >
> >     On 23/06/19 2:38 PM, Rolando Valdez wrote:
> >
> >      > I am sorry, I was not clear enough. My goal is to calculate a
> >     spatial
> >      > weight matrix (nxn) across counties but, instead of euclidean
> >     distance,
> >      > to use road distance.
> >
> >     I'm afraid I still don't understand.  To put it mildly. You
> presumably
> >     have a clear idea of what you are trying to, but those of us who are
> >     not
> >     involved in your research have no such idea.  We (or at least I)
> >     haven't
> >     a clue as to what you are talking about.
> >
> >     What do you mean by "spatial weight"?  What are these weights used
> for?
> >     What is n?  How are the counties involved?  Is n the number of
> >     counties?
> >     Are you interested in the road distance (minimum road distance?)
> >     between
> >     pairs of counties?
> >
> >     Please explain *clearly* and do not expect those who are trying to
> help
> >     you to be mind-readers!!!
> >
> >     cheers,
> >
> >     Rolf
> >
> >      >
> >      > El s?b., 22 de jun. de 2019 a la(s) 19:28, Rolf Turner
> >      > (r.turner at auckland.ac.nz <mailto:r.turner at auckland.ac.nz>
> >     <mailto:r.turner at auckland.ac.nz <mailto:r.turner at auckland.ac.nz>>)
> >     escribi?:
> >      >
> >      >
> >      >     On 23/06/19 1:17 PM, Rolando Valdez wrote:
> >      >
> >      >      > Thank you for your answer.
> >      >      >
> >      >      > I have a shapefile with, say, counties, and I got another
> >      >     shapefile with
> >      >      > the roads. ?What if a county does not intersect any road?
> >      >
> >      >     I am sorry, but it is not at all clear to me just what the
> >     problem is.
> >      >     How do the counties come into the picture?  You said you
> >     wanted to get
> >      >     the road distance between points on the roads.  What have the
> >     counties
> >      >     got to do with this?
> >      >
> >      >     Can you perhaps provide a reproducible example?
> >      >
> >      >     cheers,
> >      >
> >      >     Rolf
> >      >
> >      >      >
> >      >      > El jue., 20 de jun. de 2019 a la(s) 19:08, Rolf Turner
> >      >      > (r.turner at auckland.ac.nz <mailto:r.turner at auckland.ac.nz>
> >     <mailto:r.turner at auckland.ac.nz <mailto:r.turner at auckland.ac.nz>>
> >      >     <mailto:r.turner at auckland.ac.nz
> >     <mailto:r.turner at auckland.ac.nz> <mailto:r.turner at auckland.ac.nz
> >     <mailto:r.turner at auckland.ac.nz>>>)
> >      >     escribi?:
> >      >      >
> >      >      >
> >      >      >     On 21/06/19 12:26 PM, Rolando Valdez wrote:
> >      >      >
> >      >      >      > Dear community,
> >      >      >      >
> >      >      >      > Is there any way to create a spatial weight matrix
> >     based
> >      >     on road
> >      >      >     distance?
> >      >      >      > I am trying to use the road distance between two
> points
> >      >     instead of
> >      >      >      > euclidean distance.
> >      >      >      >
> >      >      >      > I've seen that there is a package named osrm. Can
> >     anyone give
> >      >      >     some advice?
> >      >      >
> >      >      >     I don't know anything about "osrm".  Calculating "road
> >     distances"
> >      >      >     can be
> >      >      >     done in the spatstat package reasonably easily, if you
> >     take
> >      >     the trouble
> >      >      >     to represent your collection of roads as a "linnet"
> >     object.
> >      >      >
> >      >      >     Given that you have done so, suppose that your linnet
> >     object
> >      >     is "L" and
> >      >      >     that you have vectors "x" and "y" specifying the
> >     points on L
> >      >     (i.e. on
> >      >      >     your roads) between which you want to know the
> distances.
> >      >      >
> >      >      >     Do:
> >      >      >
> >      >      >           X    <- lpp(data.frame(x=x,y=y),L)
> >      >      >           dMat <- pairdist(X)
> >      >      >
> >      >      >     The object "dMat" is a (symmetric) square matrix;
> >     dMat[i,j]
> >      >     is the
> >      >      >     distance between point i and point j.  (Of course the
> >      >     diagonal entries
> >      >      >     are all 0.)
> >      >      >
> >      >      >     If your collection of roads is specified by means of a
> >     shapefile,
> >      >      >     vignette("shapefiles") will tell you how to turn this
> >      >     collection into a
> >      >      >     "psp" ("planar segment pattern") object; the function
> >     (method)
> >      >      >     as.linnet.psp() can then be used to turn the "psp"
> >     object into a
> >      >      >     "linnet" object.
> >      >      >
> >      >      >     HTH
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From rv@|dezr @end|ng |rom gm@||@com  Sun Jun 23 08:01:30 2019
From: rv@|dezr @end|ng |rom gm@||@com (Rolando Valdez)
Date: Sat, 22 Jun 2019 23:01:30 -0700
Subject: [R-sig-Geo] 
 [FORGED] Create a Spatial Weight Matrix based on road distance
In-Reply-To: <bb171071-37d1-1da9-1b08-490019051634@auckland.ac.nz>
References: <CAFvJtoFemxph=u+ewBra6ebHLzaOC=49r3WFB6sJ5N7Zxs4m_Q@mail.gmail.com>
 <49e352fb-6742-86d6-bd7e-571088a0b3eb@auckland.ac.nz>
 <CAFvJtoH4s5oqkmjP=jyJFhRNQBn1EUm442GY6yRsMEUxX7O45A@mail.gmail.com>
 <946cf6cb-6863-e853-c458-0a5a9c144f68@auckland.ac.nz>
 <CAFvJtoFooKRQKFDSd+hysJ=1_h2gfA3ZUH1F3x8kocxo-YuUgQ@mail.gmail.com>
 <9f41bccc-43ca-6789-34ff-bac633de2a86@auckland.ac.nz>
 <CAFvJtoFCY18APnXSOQ_PoCLjiyh0baMGEyqjedOEzdOPSVXt7Q@mail.gmail.com>
 <bb171071-37d1-1da9-1b08-490019051634@auckland.ac.nz>
Message-ID: <CAFvJtoH39rnSiR-eUyaNt8HucVp6Y6Uw+jT6jVh6sgP_PVOxfg@mail.gmail.com>

I apologize for the lack of clarity.

Let me try again:

The SWM captures the spatial structure among territories. In the case of a
matrix based on distance, you define a distance-threshold, say 50 km, and
every territory under that distance is considered as neighbor, in the
matrix, those territories considered neighbors take the value 1, and 0
otherwise (territories beyond 50 km). This is what 'dnearneigh' function
does.

Then, I want to define a distance-threshold, say 50 km by road (not
euclidean) and every territory under that distance (by road) be considered
as neighbor.

El s?b., 22 de jun. de 2019 a la(s) 21:15, Rolf Turner (
r.turner at auckland.ac.nz) escribi?:

> On 23/06/19 3:30 PM, Rolando Valdez wrote:
> > Sorry again.
> >
> > A Spatial Weight Matrix (swm) is an object used in spatial econometrics
> > to characterize the spatial structure among territories. It is an
> > element nxn where n is the number of territorial units (counties,
> > districts, states, cities, regions) in the sample and it could be based
> > on contiguity or distance. Usually, you can create a swm based on
> > distance using 'dnearneigh' from spdep and then convert to a listw
> > through 'nb2listw'. The problem is that the matrix that you generate
> > trough 'dnearneigh'computes the euclidean distance among centroids of
> > polygons. This is where I spot my issue, I need to compute the swm using
> > the road distance instead of euclidean distance computed through
> > 'dnearneigh'. I do have a shapefile with poligons (counties) and another
> > shapefile with lines (roads).
>
> OK.  It's getting a *bit* clearer ....  You are interested in "road
> distances" between counties.  I'm still not entirely sure what this
> means.  Is it the *minimum* distance by road from one county to another?
> In which case, if two counties are contiguous (adjacent) and there is a
> road crossing the border between the two, is the distance between the
> counties equal to zero?  (This doesn't seem like it would be
> satisfactory ....)
>
> Yes, actually it is possible that two counties were connected by more than
one road, however it's not a big deal. If I define a distance of 50 km, it
doesn't matter how many times two counties are connected, I just need that
they are at 50 km trough, at least, one road.

> If this is not the case, then what *is* the case?  Perhaps you want
> distances between the *centroids* of the counties.  What then do you
> mean by road distance when the centroids do not lie on a road?
>

This is a big challenge, I'm still working on it.

>
> You apparently need to deal with counties in which there are no roads at
> all.  To handle this you have to define what *you* mean by the distance
> by road from county A to county B when there are no roads at all in
> county B.  Perhaps infinity would be the appropriate distance, but *I*
> don't know; you have to make the call.
>

If two counties are not connected through a road, they could not be
neighbors. In this case, it would correspond to a value 0 in the matrix.

>
> Previously you indicated that you needed to know (pairwise) road
> distances between specified points in a given set, and I showed you how
> to obtain those using pairdist(), from spatstat.  Now it seems that you
> want something rather different, and it's still not clear what.
>
> In a sense is the same, but you said so properly, We have different
research fields.


> You need to get *your* thoughts clear; make some definitions and
> specifications, and decide what you really want or need.
>

I got it.

>
> It seems that you are expecting R to magically do your thinking for you;
> it won't!
>
> No, I'm not expecting that.

> cheers,
>
> Rolf
>
> > El s?b., 22 de jun. de 2019 a la(s) 20:00, Rolf Turner
> > (r.turner at auckland.ac.nz <mailto:r.turner at auckland.ac.nz>) escribi?:
> >
> >
> >     On 23/06/19 2:38 PM, Rolando Valdez wrote:
> >
> >      > I am sorry, I was not clear enough. My goal is to calculate a
> >     spatial
> >      > weight matrix (nxn) across counties but, instead of euclidean
> >     distance,
> >      > to use road distance.
> >
> >     I'm afraid I still don't understand.  To put it mildly. You
> presumably
> >     have a clear idea of what you are trying to, but those of us who are
> >     not
> >     involved in your research have no such idea.  We (or at least I)
> >     haven't
> >     a clue as to what you are talking about.
> >
> >     What do you mean by "spatial weight"?  What are these weights used
> for?
> >     What is n?  How are the counties involved?  Is n the number of
> >     counties?
> >     Are you interested in the road distance (minimum road distance?)
> >     between
> >     pairs of counties?
> >
> >     Please explain *clearly* and do not expect those who are trying to
> help
> >     you to be mind-readers!!!
> >
> >     cheers,
> >
> >     Rolf
> >
> >      >
> >      > El s?b., 22 de jun. de 2019 a la(s) 19:28, Rolf Turner
> >      > (r.turner at auckland.ac.nz <mailto:r.turner at auckland.ac.nz>
> >     <mailto:r.turner at auckland.ac.nz <mailto:r.turner at auckland.ac.nz>>)
> >     escribi?:
> >      >
> >      >
> >      >     On 23/06/19 1:17 PM, Rolando Valdez wrote:
> >      >
> >      >      > Thank you for your answer.
> >      >      >
> >      >      > I have a shapefile with, say, counties, and I got another
> >      >     shapefile with
> >      >      > the roads. ?What if a county does not intersect any road?
> >      >
> >      >     I am sorry, but it is not at all clear to me just what the
> >     problem is.
> >      >     How do the counties come into the picture?  You said you
> >     wanted to get
> >      >     the road distance between points on the roads.  What have the
> >     counties
> >      >     got to do with this?
> >      >
> >      >     Can you perhaps provide a reproducible example?
> >      >
> >      >     cheers,
> >      >
> >      >     Rolf
> >      >
> >      >      >
> >      >      > El jue., 20 de jun. de 2019 a la(s) 19:08, Rolf Turner
> >      >      > (r.turner at auckland.ac.nz <mailto:r.turner at auckland.ac.nz>
> >     <mailto:r.turner at auckland.ac.nz <mailto:r.turner at auckland.ac.nz>>
> >      >     <mailto:r.turner at auckland.ac.nz
> >     <mailto:r.turner at auckland.ac.nz> <mailto:r.turner at auckland.ac.nz
> >     <mailto:r.turner at auckland.ac.nz>>>)
> >      >     escribi?:
> >      >      >
> >      >      >
> >      >      >     On 21/06/19 12:26 PM, Rolando Valdez wrote:
> >      >      >
> >      >      >      > Dear community,
> >      >      >      >
> >      >      >      > Is there any way to create a spatial weight matrix
> >     based
> >      >     on road
> >      >      >     distance?
> >      >      >      > I am trying to use the road distance between two
> points
> >      >     instead of
> >      >      >      > euclidean distance.
> >      >      >      >
> >      >      >      > I've seen that there is a package named osrm. Can
> >     anyone give
> >      >      >     some advice?
> >      >      >
> >      >      >     I don't know anything about "osrm".  Calculating "road
> >     distances"
> >      >      >     can be
> >      >      >     done in the spatstat package reasonably easily, if you
> >     take
> >      >     the trouble
> >      >      >     to represent your collection of roads as a "linnet"
> >     object.
> >      >      >
> >      >      >     Given that you have done so, suppose that your linnet
> >     object
> >      >     is "L" and
> >      >      >     that you have vectors "x" and "y" specifying the
> >     points on L
> >      >     (i.e. on
> >      >      >     your roads) between which you want to know the
> distances.
> >      >      >
> >      >      >     Do:
> >      >      >
> >      >      >           X    <- lpp(data.frame(x=x,y=y),L)
> >      >      >           dMat <- pairdist(X)
> >      >      >
> >      >      >     The object "dMat" is a (symmetric) square matrix;
> >     dMat[i,j]
> >      >     is the
> >      >      >     distance between point i and point j.  (Of course the
> >      >     diagonal entries
> >      >      >     are all 0.)
> >      >      >
> >      >      >     If your collection of roads is specified by means of a
> >     shapefile,
> >      >      >     vignette("shapefiles") will tell you how to turn this
> >      >     collection into a
> >      >      >     "psp" ("planar segment pattern") object; the function
> >     (method)
> >      >      >     as.linnet.psp() can then be used to turn the "psp"
> >     object into a
> >      >      >     "linnet" object.
> >      >      >
> >      >      >     HTH
>


-- 
Rol~

	[[alternative HTML version deleted]]


From rv@|dezr @end|ng |rom gm@||@com  Sun Jun 23 08:19:34 2019
From: rv@|dezr @end|ng |rom gm@||@com (Rolando Valdez)
Date: Sat, 22 Jun 2019 23:19:34 -0700
Subject: [R-sig-Geo] 
 [FORGED] Create a Spatial Weight Matrix based on road distance
In-Reply-To: <CAFSWaCObTTNm-LNE4jyFp4wLmsQB0=cZFfXfDWSEF1nG6FTbXA@mail.gmail.com>
References: <CAFvJtoFemxph=u+ewBra6ebHLzaOC=49r3WFB6sJ5N7Zxs4m_Q@mail.gmail.com>
 <49e352fb-6742-86d6-bd7e-571088a0b3eb@auckland.ac.nz>
 <CAFvJtoH4s5oqkmjP=jyJFhRNQBn1EUm442GY6yRsMEUxX7O45A@mail.gmail.com>
 <946cf6cb-6863-e853-c458-0a5a9c144f68@auckland.ac.nz>
 <CAFvJtoFooKRQKFDSd+hysJ=1_h2gfA3ZUH1F3x8kocxo-YuUgQ@mail.gmail.com>
 <9f41bccc-43ca-6789-34ff-bac633de2a86@auckland.ac.nz>
 <CAFvJtoFCY18APnXSOQ_PoCLjiyh0baMGEyqjedOEzdOPSVXt7Q@mail.gmail.com>
 <bb171071-37d1-1da9-1b08-490019051634@auckland.ac.nz>
 <CAFSWaCObTTNm-LNE4jyFp4wLmsQB0=cZFfXfDWSEF1nG6FTbXA@mail.gmail.com>
Message-ID: <CAFvJtoE6M3bPAS6o-dXmiCfifYK2G57dUmj3QjUdeFgfreKt+Q@mail.gmail.com>

I don't know how exactly works that, but I will try.

Thank you.

El s?b., 22 de jun. de 2019 a la(s) 22:17, Juan Pablo Carranza (
carranzajuanp at gmail.com) escribi?:

> Hi all!
> I don't have the specific answer, but I don't appreciate academic bullying
> either. So... here is a way you could take. Go to qgis, calculate road
> distances by network analysis and then add it to your dataframe. Use this
> new variable to weigth the matrix.
> I hope this serves, and I hope Rolf solves what ever is bothering *him*.
> Cheers
>
> Juan Pablo Carranza
> Mgter. en Administraci?n P?blica
> Lic. en Econom?a
>
> El dom., 23 de jun. de 2019 1:16 a. m., Rolf Turner <
> r.turner at auckland.ac.nz> escribi?:
>
>> On 23/06/19 3:30 PM, Rolando Valdez wrote:
>> > Sorry again.
>> >
>> > A Spatial Weight Matrix (swm) is an object used in spatial econometrics
>> > to characterize the spatial structure among territories. It is an
>> > element nxn where n is the number of territorial units (counties,
>> > districts, states, cities, regions) in the sample and it could be based
>> > on contiguity or distance. Usually, you can create a swm based on
>> > distance using 'dnearneigh' from spdep and then convert to a listw
>> > through 'nb2listw'. The problem is that the matrix that you generate
>> > trough 'dnearneigh'computes the euclidean distance among centroids of
>> > polygons. This is where I spot my issue, I need to compute the swm
>> using
>> > the road distance instead of euclidean distance computed through
>> > 'dnearneigh'. I do have a shapefile with poligons (counties) and
>> another
>> > shapefile with lines (roads).
>>
>> OK.  It's getting a *bit* clearer ....  You are interested in "road
>> distances" between counties.  I'm still not entirely sure what this
>> means.  Is it the *minimum* distance by road from one county to another?
>> In which case, if two counties are contiguous (adjacent) and there is a
>> road crossing the border between the two, is the distance between the
>> counties equal to zero?  (This doesn't seem like it would be
>> satisfactory ....)
>>
>> If this is not the case, then what *is* the case?  Perhaps you want
>> distances between the *centroids* of the counties.  What then do you
>> mean by road distance when the centroids do not lie on a road?
>>
>> You apparently need to deal with counties in which there are no roads at
>> all.  To handle this you have to define what *you* mean by the distance
>> by road from county A to county B when there are no roads at all in
>> county B.  Perhaps infinity would be the appropriate distance, but *I*
>> don't know; you have to make the call.
>>
>> Previously you indicated that you needed to know (pairwise) road
>> distances between specified points in a given set, and I showed you how
>> to obtain those using pairdist(), from spatstat.  Now it seems that you
>> want something rather different, and it's still not clear what.
>>
>> You need to get *your* thoughts clear; make some definitions and
>> specifications, and decide what you really want or need.
>>
>> It seems that you are expecting R to magically do your thinking for you;
>> it won't!
>>
>> cheers,
>>
>> Rolf
>>
>> > El s?b., 22 de jun. de 2019 a la(s) 20:00, Rolf Turner
>> > (r.turner at auckland.ac.nz <mailto:r.turner at auckland.ac.nz>) escribi?:
>> >
>> >
>> >     On 23/06/19 2:38 PM, Rolando Valdez wrote:
>> >
>> >      > I am sorry, I was not clear enough. My goal is to calculate a
>> >     spatial
>> >      > weight matrix (nxn) across counties but, instead of euclidean
>> >     distance,
>> >      > to use road distance.
>> >
>> >     I'm afraid I still don't understand.  To put it mildly. You
>> presumably
>> >     have a clear idea of what you are trying to, but those of us who are
>> >     not
>> >     involved in your research have no such idea.  We (or at least I)
>> >     haven't
>> >     a clue as to what you are talking about.
>> >
>> >     What do you mean by "spatial weight"?  What are these weights used
>> for?
>> >     What is n?  How are the counties involved?  Is n the number of
>> >     counties?
>> >     Are you interested in the road distance (minimum road distance?)
>> >     between
>> >     pairs of counties?
>> >
>> >     Please explain *clearly* and do not expect those who are trying to
>> help
>> >     you to be mind-readers!!!
>> >
>> >     cheers,
>> >
>> >     Rolf
>> >
>> >      >
>> >      > El s?b., 22 de jun. de 2019 a la(s) 19:28, Rolf Turner
>> >      > (r.turner at auckland.ac.nz <mailto:r.turner at auckland.ac.nz>
>> >     <mailto:r.turner at auckland.ac.nz <mailto:r.turner at auckland.ac.nz>>)
>> >     escribi?:
>> >      >
>> >      >
>> >      >     On 23/06/19 1:17 PM, Rolando Valdez wrote:
>> >      >
>> >      >      > Thank you for your answer.
>> >      >      >
>> >      >      > I have a shapefile with, say, counties, and I got another
>> >      >     shapefile with
>> >      >      > the roads. ?What if a county does not intersect any road?
>> >      >
>> >      >     I am sorry, but it is not at all clear to me just what the
>> >     problem is.
>> >      >     How do the counties come into the picture?  You said you
>> >     wanted to get
>> >      >     the road distance between points on the roads.  What have the
>> >     counties
>> >      >     got to do with this?
>> >      >
>> >      >     Can you perhaps provide a reproducible example?
>> >      >
>> >      >     cheers,
>> >      >
>> >      >     Rolf
>> >      >
>> >      >      >
>> >      >      > El jue., 20 de jun. de 2019 a la(s) 19:08, Rolf Turner
>> >      >      > (r.turner at auckland.ac.nz <mailto:r.turner at auckland.ac.nz>
>> >     <mailto:r.turner at auckland.ac.nz <mailto:r.turner at auckland.ac.nz>>
>> >      >     <mailto:r.turner at auckland.ac.nz
>> >     <mailto:r.turner at auckland.ac.nz> <mailto:r.turner at auckland.ac.nz
>> >     <mailto:r.turner at auckland.ac.nz>>>)
>> >      >     escribi?:
>> >      >      >
>> >      >      >
>> >      >      >     On 21/06/19 12:26 PM, Rolando Valdez wrote:
>> >      >      >
>> >      >      >      > Dear community,
>> >      >      >      >
>> >      >      >      > Is there any way to create a spatial weight matrix
>> >     based
>> >      >     on road
>> >      >      >     distance?
>> >      >      >      > I am trying to use the road distance between two
>> points
>> >      >     instead of
>> >      >      >      > euclidean distance.
>> >      >      >      >
>> >      >      >      > I've seen that there is a package named osrm. Can
>> >     anyone give
>> >      >      >     some advice?
>> >      >      >
>> >      >      >     I don't know anything about "osrm".  Calculating "road
>> >     distances"
>> >      >      >     can be
>> >      >      >     done in the spatstat package reasonably easily, if you
>> >     take
>> >      >     the trouble
>> >      >      >     to represent your collection of roads as a "linnet"
>> >     object.
>> >      >      >
>> >      >      >     Given that you have done so, suppose that your linnet
>> >     object
>> >      >     is "L" and
>> >      >      >     that you have vectors "x" and "y" specifying the
>> >     points on L
>> >      >     (i.e. on
>> >      >      >     your roads) between which you want to know the
>> distances.
>> >      >      >
>> >      >      >     Do:
>> >      >      >
>> >      >      >           X    <- lpp(data.frame(x=x,y=y),L)
>> >      >      >           dMat <- pairdist(X)
>> >      >      >
>> >      >      >     The object "dMat" is a (symmetric) square matrix;
>> >     dMat[i,j]
>> >      >     is the
>> >      >      >     distance between point i and point j.  (Of course the
>> >      >     diagonal entries
>> >      >      >     are all 0.)
>> >      >      >
>> >      >      >     If your collection of roads is specified by means of a
>> >     shapefile,
>> >      >      >     vignette("shapefiles") will tell you how to turn this
>> >      >     collection into a
>> >      >      >     "psp" ("planar segment pattern") object; the function
>> >     (method)
>> >      >      >     as.linnet.psp() can then be used to turn the "psp"
>> >     object into a
>> >      >      >     "linnet" object.
>> >      >      >
>> >      >      >     HTH
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>

-- 
Rol~

	[[alternative HTML version deleted]]


From c@rr@nz@ju@np @end|ng |rom gm@||@com  Sun Jun 23 08:32:04 2019
From: c@rr@nz@ju@np @end|ng |rom gm@||@com (Juan Pablo Carranza)
Date: Sun, 23 Jun 2019 03:32:04 -0300
Subject: [R-sig-Geo] 
 [FORGED] Create a Spatial Weight Matrix based on road distance
In-Reply-To: <CAFvJtoH39rnSiR-eUyaNt8HucVp6Y6Uw+jT6jVh6sgP_PVOxfg@mail.gmail.com>
References: <CAFvJtoFemxph=u+ewBra6ebHLzaOC=49r3WFB6sJ5N7Zxs4m_Q@mail.gmail.com>
 <49e352fb-6742-86d6-bd7e-571088a0b3eb@auckland.ac.nz>
 <CAFvJtoH4s5oqkmjP=jyJFhRNQBn1EUm442GY6yRsMEUxX7O45A@mail.gmail.com>
 <946cf6cb-6863-e853-c458-0a5a9c144f68@auckland.ac.nz>
 <CAFvJtoFooKRQKFDSd+hysJ=1_h2gfA3ZUH1F3x8kocxo-YuUgQ@mail.gmail.com>
 <9f41bccc-43ca-6789-34ff-bac633de2a86@auckland.ac.nz>
 <CAFvJtoFCY18APnXSOQ_PoCLjiyh0baMGEyqjedOEzdOPSVXt7Q@mail.gmail.com>
 <bb171071-37d1-1da9-1b08-490019051634@auckland.ac.nz>
 <CAFvJtoH39rnSiR-eUyaNt8HucVp6Y6Uw+jT6jVh6sgP_PVOxfg@mail.gmail.com>
Message-ID: <CAFSWaCMQ79eVB7Zzsh5h2ujjEbznJ6toFzUym03gftRbs2=2zg@mail.gmail.com>

Rolando, thanks for clarify.
"gdistance" may give you what you are looking for. Another option is the
package "osrm", for calculate distances using Open Street Maps routes.
Once you calculate a dataframe with the distances of every pair of
locations, you could make ones and ceros with a simple ifelse. Then you
could standarize by row. That will be your lw matrix.
Here is some help:

https://www.google.com/url?sa=t&source=web&rct=j&url=https://cran.r-project.org/web/packages/gdistance/vignettes/gdistance1.pdf&ved=2ahUKEwim8u3P-f7iAhV5GLkGHbUKBCUQFjAAegQIAxAB&usg=AOvVaw2EjdceAFDJB9Qet-EBEDAn&cshid=1561271237676


Juan Pablo Carranza
Mgter. en Administraci?n P?blica
Lic. en Econom?a

El dom., 23 de jun. de 2019 3:02 a. m., Rolando Valdez <rvaldezr at gmail.com>
escribi?:

> I apologize for the lack of clarity.
>
> Let me try again:
>
> The SWM captures the spatial structure among territories. In the case of a
> matrix based on distance, you define a distance-threshold, say 50 km, and
> every territory under that distance is considered as neighbor, in the
> matrix, those territories considered neighbors take the value 1, and 0
> otherwise (territories beyond 50 km). This is what 'dnearneigh' function
> does.
>
> Then, I want to define a distance-threshold, say 50 km by road (not
> euclidean) and every territory under that distance (by road) be considered
> as neighbor.
>
> El s?b., 22 de jun. de 2019 a la(s) 21:15, Rolf Turner (
> r.turner at auckland.ac.nz) escribi?:
>
> > On 23/06/19 3:30 PM, Rolando Valdez wrote:
> > > Sorry again.
> > >
> > > A Spatial Weight Matrix (swm) is an object used in spatial econometrics
> > > to characterize the spatial structure among territories. It is an
> > > element nxn where n is the number of territorial units (counties,
> > > districts, states, cities, regions) in the sample and it could be based
> > > on contiguity or distance. Usually, you can create a swm based on
> > > distance using 'dnearneigh' from spdep and then convert to a listw
> > > through 'nb2listw'. The problem is that the matrix that you generate
> > > trough 'dnearneigh'computes the euclidean distance among centroids of
> > > polygons. This is where I spot my issue, I need to compute the swm
> using
> > > the road distance instead of euclidean distance computed through
> > > 'dnearneigh'. I do have a shapefile with poligons (counties) and
> another
> > > shapefile with lines (roads).
> >
> > OK.  It's getting a *bit* clearer ....  You are interested in "road
> > distances" between counties.  I'm still not entirely sure what this
> > means.  Is it the *minimum* distance by road from one county to another?
> > In which case, if two counties are contiguous (adjacent) and there is a
> > road crossing the border between the two, is the distance between the
> > counties equal to zero?  (This doesn't seem like it would be
> > satisfactory ....)
> >
> > Yes, actually it is possible that two counties were connected by more
> than
> one road, however it's not a big deal. If I define a distance of 50 km, it
> doesn't matter how many times two counties are connected, I just need that
> they are at 50 km trough, at least, one road.
>
> > If this is not the case, then what *is* the case?  Perhaps you want
> > distances between the *centroids* of the counties.  What then do you
> > mean by road distance when the centroids do not lie on a road?
> >
>
> This is a big challenge, I'm still working on it.
>
> >
> > You apparently need to deal with counties in which there are no roads at
> > all.  To handle this you have to define what *you* mean by the distance
> > by road from county A to county B when there are no roads at all in
> > county B.  Perhaps infinity would be the appropriate distance, but *I*
> > don't know; you have to make the call.
> >
>
> If two counties are not connected through a road, they could not be
> neighbors. In this case, it would correspond to a value 0 in the matrix.
>
> >
> > Previously you indicated that you needed to know (pairwise) road
> > distances between specified points in a given set, and I showed you how
> > to obtain those using pairdist(), from spatstat.  Now it seems that you
> > want something rather different, and it's still not clear what.
> >
> > In a sense is the same, but you said so properly, We have different
> research fields.
>
>
> > You need to get *your* thoughts clear; make some definitions and
> > specifications, and decide what you really want or need.
> >
>
> I got it.
>
> >
> > It seems that you are expecting R to magically do your thinking for you;
> > it won't!
> >
> > No, I'm not expecting that.
>
> > cheers,
> >
> > Rolf
> >
> > > El s?b., 22 de jun. de 2019 a la(s) 20:00, Rolf Turner
> > > (r.turner at auckland.ac.nz <mailto:r.turner at auckland.ac.nz>) escribi?:
> > >
> > >
> > >     On 23/06/19 2:38 PM, Rolando Valdez wrote:
> > >
> > >      > I am sorry, I was not clear enough. My goal is to calculate a
> > >     spatial
> > >      > weight matrix (nxn) across counties but, instead of euclidean
> > >     distance,
> > >      > to use road distance.
> > >
> > >     I'm afraid I still don't understand.  To put it mildly. You
> > presumably
> > >     have a clear idea of what you are trying to, but those of us who
> are
> > >     not
> > >     involved in your research have no such idea.  We (or at least I)
> > >     haven't
> > >     a clue as to what you are talking about.
> > >
> > >     What do you mean by "spatial weight"?  What are these weights used
> > for?
> > >     What is n?  How are the counties involved?  Is n the number of
> > >     counties?
> > >     Are you interested in the road distance (minimum road distance?)
> > >     between
> > >     pairs of counties?
> > >
> > >     Please explain *clearly* and do not expect those who are trying to
> > help
> > >     you to be mind-readers!!!
> > >
> > >     cheers,
> > >
> > >     Rolf
> > >
> > >      >
> > >      > El s?b., 22 de jun. de 2019 a la(s) 19:28, Rolf Turner
> > >      > (r.turner at auckland.ac.nz <mailto:r.turner at auckland.ac.nz>
> > >     <mailto:r.turner at auckland.ac.nz <mailto:r.turner at auckland.ac.nz>>)
> > >     escribi?:
> > >      >
> > >      >
> > >      >     On 23/06/19 1:17 PM, Rolando Valdez wrote:
> > >      >
> > >      >      > Thank you for your answer.
> > >      >      >
> > >      >      > I have a shapefile with, say, counties, and I got another
> > >      >     shapefile with
> > >      >      > the roads. ?What if a county does not intersect any road?
> > >      >
> > >      >     I am sorry, but it is not at all clear to me just what the
> > >     problem is.
> > >      >     How do the counties come into the picture?  You said you
> > >     wanted to get
> > >      >     the road distance between points on the roads.  What have
> the
> > >     counties
> > >      >     got to do with this?
> > >      >
> > >      >     Can you perhaps provide a reproducible example?
> > >      >
> > >      >     cheers,
> > >      >
> > >      >     Rolf
> > >      >
> > >      >      >
> > >      >      > El jue., 20 de jun. de 2019 a la(s) 19:08, Rolf Turner
> > >      >      > (r.turner at auckland.ac.nz <mailto:r.turner at auckland.ac.nz
> >
> > >     <mailto:r.turner at auckland.ac.nz <mailto:r.turner at auckland.ac.nz>>
> > >      >     <mailto:r.turner at auckland.ac.nz
> > >     <mailto:r.turner at auckland.ac.nz> <mailto:r.turner at auckland.ac.nz
> > >     <mailto:r.turner at auckland.ac.nz>>>)
> > >      >     escribi?:
> > >      >      >
> > >      >      >
> > >      >      >     On 21/06/19 12:26 PM, Rolando Valdez wrote:
> > >      >      >
> > >      >      >      > Dear community,
> > >      >      >      >
> > >      >      >      > Is there any way to create a spatial weight matrix
> > >     based
> > >      >     on road
> > >      >      >     distance?
> > >      >      >      > I am trying to use the road distance between two
> > points
> > >      >     instead of
> > >      >      >      > euclidean distance.
> > >      >      >      >
> > >      >      >      > I've seen that there is a package named osrm. Can
> > >     anyone give
> > >      >      >     some advice?
> > >      >      >
> > >      >      >     I don't know anything about "osrm".  Calculating
> "road
> > >     distances"
> > >      >      >     can be
> > >      >      >     done in the spatstat package reasonably easily, if
> you
> > >     take
> > >      >     the trouble
> > >      >      >     to represent your collection of roads as a "linnet"
> > >     object.
> > >      >      >
> > >      >      >     Given that you have done so, suppose that your linnet
> > >     object
> > >      >     is "L" and
> > >      >      >     that you have vectors "x" and "y" specifying the
> > >     points on L
> > >      >     (i.e. on
> > >      >      >     your roads) between which you want to know the
> > distances.
> > >      >      >
> > >      >      >     Do:
> > >      >      >
> > >      >      >           X    <- lpp(data.frame(x=x,y=y),L)
> > >      >      >           dMat <- pairdist(X)
> > >      >      >
> > >      >      >     The object "dMat" is a (symmetric) square matrix;
> > >     dMat[i,j]
> > >      >     is the
> > >      >      >     distance between point i and point j.  (Of course the
> > >      >     diagonal entries
> > >      >      >     are all 0.)
> > >      >      >
> > >      >      >     If your collection of roads is specified by means of
> a
> > >     shapefile,
> > >      >      >     vignette("shapefiles") will tell you how to turn this
> > >      >     collection into a
> > >      >      >     "psp" ("planar segment pattern") object; the function
> > >     (method)
> > >      >      >     as.linnet.psp() can then be used to turn the "psp"
> > >     object into a
> > >      >      >     "linnet" object.
> > >      >      >
> > >      >      >     HTH
> >
>
>
> --
> Rol~
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From r@turner @end|ng |rom @uck|@nd@@c@nz  Sun Jun 23 10:17:21 2019
From: r@turner @end|ng |rom @uck|@nd@@c@nz (Rolf Turner)
Date: Sun, 23 Jun 2019 20:17:21 +1200
Subject: [R-sig-Geo] 
 [FORGED] Create a Spatial Weight Matrix based on road distance
In-Reply-To: <CAFvJtoH39rnSiR-eUyaNt8HucVp6Y6Uw+jT6jVh6sgP_PVOxfg@mail.gmail.com>
References: <CAFvJtoFemxph=u+ewBra6ebHLzaOC=49r3WFB6sJ5N7Zxs4m_Q@mail.gmail.com>
 <49e352fb-6742-86d6-bd7e-571088a0b3eb@auckland.ac.nz>
 <CAFvJtoH4s5oqkmjP=jyJFhRNQBn1EUm442GY6yRsMEUxX7O45A@mail.gmail.com>
 <946cf6cb-6863-e853-c458-0a5a9c144f68@auckland.ac.nz>
 <CAFvJtoFooKRQKFDSd+hysJ=1_h2gfA3ZUH1F3x8kocxo-YuUgQ@mail.gmail.com>
 <9f41bccc-43ca-6789-34ff-bac633de2a86@auckland.ac.nz>
 <CAFvJtoFCY18APnXSOQ_PoCLjiyh0baMGEyqjedOEzdOPSVXt7Q@mail.gmail.com>
 <bb171071-37d1-1da9-1b08-490019051634@auckland.ac.nz>
 <CAFvJtoH39rnSiR-eUyaNt8HucVp6Y6Uw+jT6jVh6sgP_PVOxfg@mail.gmail.com>
Message-ID: <d24c8969-adee-d176-9241-f319734d24b3@auckland.ac.nz>


On 23/06/19 6:01 PM, Rolando Valdez wrote:

> I apologize for the lack of clarity.
> 
> Let me try again:
> 
> The SWM captures the spatial structure among territories. In the case of 
> a matrix based on distance, you define a distance-threshold, say 50 km, 
> and every territory under that distance is considered as neighbor, in 
> the matrix, those territories considered neighbors take the value 1, and 
> 0 otherwise (territories beyond 50 km). This is what 'dnearneigh' 
> function does.
> 
> Then, I want to define a distance-threshold, say 50 km by road (not 
> euclidean) and every territory under that distance (by road) be 
> considered as neighbor.

You still have not defined what you mean by *distance* between 
territories (regions, counties). Distance between *points* is well 
defined; distance between territories is not.  You have to specify what 
you mean by such a distance.  This could be the minimum distance between 
points in the regions (which is not of course a metric), distance 
between centroids of the territories, Hausdorff distance, or something 
else.  This applies whether you are talking about the distance between 
points being Euclidean distance or road distance or some other metric. 
Thresholding that distance (e.g. at 50 km.) is then a trivial matter.

I have tried my best to get you to clarify what you mean, and my efforts 
seem to be in vain.  Since Juan Pablo thinks that I am "bullying you" 
(which mystifies me completely) I guess I'll give up.  And to respond to 
Juan Pablo's hope, nothing whatever is "bothering" me.

cheers,

Rolf

> 
> El s?b., 22 de jun. de 2019 a la(s) 21:15, Rolf Turner 
> (r.turner at auckland.ac.nz <mailto:r.turner at auckland.ac.nz>) escribi?:
> 
>     On 23/06/19 3:30 PM, Rolando Valdez wrote:
>      > Sorry again.
>      >
>      > A Spatial Weight Matrix (swm) is an object used in spatial
>     econometrics
>      > to characterize the spatial structure among territories. It is an
>      > element nxn where n is the number of territorial units (counties,
>      > districts, states, cities, regions) in the sample and it could be
>     based
>      > on contiguity or distance. Usually, you can create a swm based on
>      > distance using 'dnearneigh' from spdep and then convert to a listw
>      > through 'nb2listw'. The problem is that the matrix that you generate
>      > trough 'dnearneigh'computes the euclidean distance among
>     centroids of
>      > polygons. This is where I spot my issue, I need to compute the
>     swm using
>      > the road distance instead of euclidean distance computed through
>      > 'dnearneigh'. I do have a shapefile with poligons (counties) and
>     another
>      > shapefile with lines (roads).
> 
>     OK.? It's getting a *bit* clearer ....? You are interested in "road
>     distances" between counties.? I'm still not entirely sure what this
>     means.? Is it the *minimum* distance by road from one county to
>     another?
>     In which case, if two counties are contiguous (adjacent) and there is a
>     road crossing the border between the two, is the distance between the
>     counties equal to zero?? (This doesn't seem like it would be
>     satisfactory ....)
> 
> Yes, actually it is possible that two counties were connected by more 
> than one road, however it's not a big deal. If I define a distance of 50 
> km, it doesn't matter how many times two counties are connected, I just 
> need that they are at 50 km trough, at least, one road.
> 
>     If this is not the case, then what *is* the case?? Perhaps you want
>     distances between the *centroids* of the counties.? What then do you
>     mean by road distance when the centroids do not lie on a road?
> 
> 
> This is a big challenge, I'm still working on it.
> 
> 
>     You apparently need to deal with counties in which there are no
>     roads at
>     all.? To handle this you have to define what *you* mean by the distance
>     by road from county A to county B when there are no roads at all in
>     county B.? Perhaps infinity would be the appropriate distance, but *I*
>     don't know; you have to make the call.
> 
> 
> If two counties are not connected through a road, they could not be 
> neighbors. In this case, it would correspond to a value 0 in the matrix.
> 
> 
>     Previously you indicated that you needed to know (pairwise) road
>     distances between specified points in a given set, and I showed you how
>     to obtain those using pairdist(), from spatstat.? Now it seems that you
>     want something rather different, and it's still not clear what.
> 
> In a sense is the same, but you said so properly, We have different 
> research fields.
> 
>     You need to get *your* thoughts clear; make some definitions and
>     specifications, and decide what you really want or need.
> 
> 
> I got it.
> 
> 
>     It seems that you are expecting R to magically do your thinking for
>     you;
>     it won't!
> 
> No, I'm not expecting that.
> 
>     cheers,
> 
>     Rolf
> 
>      > El s?b., 22 de jun. de 2019 a la(s) 20:00, Rolf Turner
>      > (r.turner at auckland.ac.nz <mailto:r.turner at auckland.ac.nz>
>     <mailto:r.turner at auckland.ac.nz <mailto:r.turner at auckland.ac.nz>>)
>     escribi?:
>      >
>      >
>      >? ? ?On 23/06/19 2:38 PM, Rolando Valdez wrote:
>      >
>      >? ? ? > I am sorry, I was not clear enough. My goal is to calculate a
>      >? ? ?spatial
>      >? ? ? > weight matrix (nxn) across counties but, instead of euclidean
>      >? ? ?distance,
>      >? ? ? > to use road distance.
>      >
>      >? ? ?I'm afraid I still don't understand.? To put it mildly. You
>     presumably
>      >? ? ?have a clear idea of what you are trying to, but those of us
>     who are
>      >? ? ?not
>      >? ? ?involved in your research have no such idea.? We (or at least I)
>      >? ? ?haven't
>      >? ? ?a clue as to what you are talking about.
>      >
>      >? ? ?What do you mean by "spatial weight"?? What are these weights
>     used for?
>      >? ? ?What is n?? How are the counties involved?? Is n the number of
>      >? ? ?counties?
>      >? ? ?Are you interested in the road distance (minimum road distance?)
>      >? ? ?between
>      >? ? ?pairs of counties?
>      >
>      >? ? ?Please explain *clearly* and do not expect those who are
>     trying to help
>      >? ? ?you to be mind-readers!!!
>      >
>      >? ? ?cheers,
>      >
>      >? ? ?Rolf
>      >
>      >? ? ? >
>      >? ? ? > El s?b., 22 de jun. de 2019 a la(s) 19:28, Rolf Turner
>      >? ? ? > (r.turner at auckland.ac.nz <mailto:r.turner at auckland.ac.nz>
>     <mailto:r.turner at auckland.ac.nz <mailto:r.turner at auckland.ac.nz>>
>      >? ? ?<mailto:r.turner at auckland.ac.nz
>     <mailto:r.turner at auckland.ac.nz> <mailto:r.turner at auckland.ac.nz
>     <mailto:r.turner at auckland.ac.nz>>>)
>      >? ? ?escribi?:
>      >? ? ? >
>      >? ? ? >
>      >? ? ? >? ? ?On 23/06/19 1:17 PM, Rolando Valdez wrote:
>      >? ? ? >
>      >? ? ? >? ? ? > Thank you for your answer.
>      >? ? ? >? ? ? >
>      >? ? ? >? ? ? > I have a shapefile with, say, counties, and I got
>     another
>      >? ? ? >? ? ?shapefile with
>      >? ? ? >? ? ? > the roads. ?What if a county does not intersect any
>     road?
>      >? ? ? >
>      >? ? ? >? ? ?I am sorry, but it is not at all clear to me just what the
>      >? ? ?problem is.
>      >? ? ? >? ? ?How do the counties come into the picture?? You said you
>      >? ? ?wanted to get
>      >? ? ? >? ? ?the road distance between points on the roads.? What
>     have the
>      >? ? ?counties
>      >? ? ? >? ? ?got to do with this?
>      >? ? ? >
>      >? ? ? >? ? ?Can you perhaps provide a reproducible example?
>      >? ? ? >
>      >? ? ? >? ? ?cheers,
>      >? ? ? >
>      >? ? ? >? ? ?Rolf
>      >? ? ? >
>      >? ? ? >? ? ? >
>      >? ? ? >? ? ? > El jue., 20 de jun. de 2019 a la(s) 19:08, Rolf Turner
>      >? ? ? >? ? ? > (r.turner at auckland.ac.nz
>     <mailto:r.turner at auckland.ac.nz> <mailto:r.turner at auckland.ac.nz
>     <mailto:r.turner at auckland.ac.nz>>
>      >? ? ?<mailto:r.turner at auckland.ac.nz
>     <mailto:r.turner at auckland.ac.nz> <mailto:r.turner at auckland.ac.nz
>     <mailto:r.turner at auckland.ac.nz>>>
>      >? ? ? >? ? ?<mailto:r.turner at auckland.ac.nz
>     <mailto:r.turner at auckland.ac.nz>
>      >? ? ?<mailto:r.turner at auckland.ac.nz
>     <mailto:r.turner at auckland.ac.nz>> <mailto:r.turner at auckland.ac.nz
>     <mailto:r.turner at auckland.ac.nz>
>      >? ? ?<mailto:r.turner at auckland.ac.nz
>     <mailto:r.turner at auckland.ac.nz>>>>)
>      >? ? ? >? ? ?escribi?:
>      >? ? ? >? ? ? >
>      >? ? ? >? ? ? >
>      >? ? ? >? ? ? >? ? ?On 21/06/19 12:26 PM, Rolando Valdez wrote:
>      >? ? ? >? ? ? >
>      >? ? ? >? ? ? >? ? ? > Dear community,
>      >? ? ? >? ? ? >? ? ? >
>      >? ? ? >? ? ? >? ? ? > Is there any way to create a spatial weight
>     matrix
>      >? ? ?based
>      >? ? ? >? ? ?on road
>      >? ? ? >? ? ? >? ? ?distance?
>      >? ? ? >? ? ? >? ? ? > I am trying to use the road distance between
>     two points
>      >? ? ? >? ? ?instead of
>      >? ? ? >? ? ? >? ? ? > euclidean distance.
>      >? ? ? >? ? ? >? ? ? >
>      >? ? ? >? ? ? >? ? ? > I've seen that there is a package named
>     osrm. Can
>      >? ? ?anyone give
>      >? ? ? >? ? ? >? ? ?some advice?
>      >? ? ? >? ? ? >
>      >? ? ? >? ? ? >? ? ?I don't know anything about "osrm". 
>     Calculating "road
>      >? ? ?distances"
>      >? ? ? >? ? ? >? ? ?can be
>      >? ? ? >? ? ? >? ? ?done in the spatstat package reasonably easily,
>     if you
>      >? ? ?take
>      >? ? ? >? ? ?the trouble
>      >? ? ? >? ? ? >? ? ?to represent your collection of roads as a "linnet"
>      >? ? ?object.
>      >? ? ? >? ? ? >
>      >? ? ? >? ? ? >? ? ?Given that you have done so, suppose that your
>     linnet
>      >? ? ?object
>      >? ? ? >? ? ?is "L" and
>      >? ? ? >? ? ? >? ? ?that you have vectors "x" and "y" specifying the
>      >? ? ?points on L
>      >? ? ? >? ? ?(i.e. on
>      >? ? ? >? ? ? >? ? ?your roads) between which you want to know the
>     distances.
>      >? ? ? >? ? ? >
>      >? ? ? >? ? ? >? ? ?Do:
>      >? ? ? >? ? ? >
>      >? ? ? >? ? ? >? ? ? ? ? ?X? ? <- lpp(data.frame(x=x,y=y),L)
>      >? ? ? >? ? ? >? ? ? ? ? ?dMat <- pairdist(X)
>      >? ? ? >? ? ? >
>      >? ? ? >? ? ? >? ? ?The object "dMat" is a (symmetric) square matrix;
>      >? ? ?dMat[i,j]
>      >? ? ? >? ? ?is the
>      >? ? ? >? ? ? >? ? ?distance between point i and point j.? (Of
>     course the
>      >? ? ? >? ? ?diagonal entries
>      >? ? ? >? ? ? >? ? ?are all 0.)
>      >? ? ? >? ? ? >
>      >? ? ? >? ? ? >? ? ?If your collection of roads is specified by
>     means of a
>      >? ? ?shapefile,
>      >? ? ? >? ? ? >? ? ?vignette("shapefiles") will tell you how to
>     turn this
>      >? ? ? >? ? ?collection into a
>      >? ? ? >? ? ? >? ? ?"psp" ("planar segment pattern") object; the
>     function
>      >? ? ?(method)
>      >? ? ? >? ? ? >? ? ?as.linnet.psp() can then be used to turn the "psp"
>      >? ? ?object into a
>      >? ? ? >? ? ? >? ? ?"linnet" object.
>      >? ? ? >? ? ? >
>      >? ? ? >? ? ? >? ? ?HTH


From h@h@|eez@deh @end|ng |rom gm@||@com  Sat Jun 22 16:05:08 2019
From: h@h@|eez@deh @end|ng |rom gm@||@com (Hossein Shafizadeh)
Date: Sat, 22 Jun 2019 18:35:08 +0430
Subject: [R-sig-Geo] How to save components in pls model
Message-ID: <CA+P0tdNb6hdON=A_0oKjAuBXZhX967nnCwwXEFL2szswQaCHpg-9857@mail.gmail.com>

Hello everyone,
I want to *save the components *when using pls, I tried several ways but
failed.
No matter if using the caret package or in other coding formats. The code
in the caret is:
factors <- c("a","b","c")
set.seed(123)
silt <- caret::train(extsentinel[,factors],extsentinel$Silt,metric="RMSE",
                method="pls",tuneLength = 10 , importance=T, verbose=FALSE,
                trControl=trainControl(method="cv",savePredictions =
"final"),
                returnData=T, preProc = c("BoxCox","center", "scale"))

Thanks in advance,
Hossein

	[[alternative HTML version deleted]]


From Roger@B|v@nd @end|ng |rom nhh@no  Sun Jun 23 11:16:05 2019
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Sun, 23 Jun 2019 11:16:05 +0200
Subject: [R-sig-Geo] How to save components in pls model
In-Reply-To: <CA+P0tdNb6hdON=A_0oKjAuBXZhX967nnCwwXEFL2szswQaCHpg-9857@mail.gmail.com>
References: <CA+P0tdNb6hdON=A_0oKjAuBXZhX967nnCwwXEFL2szswQaCHpg-9857@mail.gmail.com>
Message-ID: <alpine.LFD.2.21.1906231108180.24806@reclus.nhh.no>

On Sat, 22 Jun 2019, Hossein Shafizadeh wrote:

> Hello everyone,
> I want to *save the components *when using pls, I tried several ways but
> failed.
> No matter if using the caret package or in other coding formats. The code
> in the caret is:

Maybe you should condider a different list? The only reason this list 
might be relevant is if the object name extsentinel suggests that you are 
using earth observation data. In any case a reproducible example would be 
needed using a built in data set, such as a raster image from a CRAN 
package, or spDataLarge::landsat; install from:

install.packages("spDataLarge", repos = "https://nowosad.github.io/drat/", 
type = "source")

Roger

> factors <- c("a","b","c")
> set.seed(123)
> silt <- caret::train(extsentinel[,factors],extsentinel$Silt,metric="RMSE",
>                method="pls",tuneLength = 10 , importance=T, verbose=FALSE,
>                trControl=trainControl(method="cv",savePredictions =
> "final"),
>                returnData=T, preProc = c("BoxCox","center", "scale"))
>
> Thanks in advance,
> Hossein
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en


From Roger@B|v@nd @end|ng |rom nhh@no  Sun Jun 23 12:00:44 2019
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Sun, 23 Jun 2019 12:00:44 +0200
Subject: [R-sig-Geo] 
 [FORGED] Create a Spatial Weight Matrix based on road distance
In-Reply-To: <CAFvJtoH39rnSiR-eUyaNt8HucVp6Y6Uw+jT6jVh6sgP_PVOxfg@mail.gmail.com>
References: <CAFvJtoFemxph=u+ewBra6ebHLzaOC=49r3WFB6sJ5N7Zxs4m_Q@mail.gmail.com>
 <49e352fb-6742-86d6-bd7e-571088a0b3eb@auckland.ac.nz>
 <CAFvJtoH4s5oqkmjP=jyJFhRNQBn1EUm442GY6yRsMEUxX7O45A@mail.gmail.com>
 <946cf6cb-6863-e853-c458-0a5a9c144f68@auckland.ac.nz>
 <CAFvJtoFooKRQKFDSd+hysJ=1_h2gfA3ZUH1F3x8kocxo-YuUgQ@mail.gmail.com>
 <9f41bccc-43ca-6789-34ff-bac633de2a86@auckland.ac.nz>
 <CAFvJtoFCY18APnXSOQ_PoCLjiyh0baMGEyqjedOEzdOPSVXt7Q@mail.gmail.com>
 <bb171071-37d1-1da9-1b08-490019051634@auckland.ac.nz>
 <CAFvJtoH39rnSiR-eUyaNt8HucVp6Y6Uw+jT6jVh6sgP_PVOxfg@mail.gmail.com>
Message-ID: <alpine.LFD.2.21.1906231133230.24806@reclus.nhh.no>

Comments inline below:

On Sun, 23 Jun 2019, Rolando Valdez wrote:

> I apologize for the lack of clarity.
>
> Let me try again:
>
> The SWM captures the spatial structure among territories. In the case of a
> matrix based on distance, you define a distance-threshold, say 50 km, and
> every territory under that distance is considered as neighbor, in the
> matrix, those territories considered neighbors take the value 1, and 0
> otherwise (territories beyond 50 km). This is what 'dnearneigh' function
> does.
>
> Then, I want to define a distance-threshold, say 50 km by road (not
> euclidean) and every territory under that distance (by road) be considered
> as neighbor.


So the main goal is to use distance by road between territories to 
construct a neighbour object, with a maximum distance threshold.

Firstly, why do you suppose that this will represent your a priori 
knowledge better than contiguity, which is the most obvious measure of 
neighbourhood for data with areal support?

If there are major mountain chains or water bodies impeding contact across 
a boundary between contiguous territories, could you not just edit out 
those graph edges (spdep::edit.nb() for example)? If there are many, a 
programmatic approach may be needed.

The inherent difficulty is that distances to territories in practice mean 
that you have to change support from area to point, and that needs 
thinking through. A territory centroid may, for example, not lie on a 
transport link. If you have finer scale population or production data, you 
might use weighted centroids, but this involves further steps, and using 
this kind of data may add endogeneity, as the variables used to define the 
neighbour object may enter your model elsewhere.

So:

I) explain why you cannot simply use contiguities (using accessibility as 
a covariate if important);

II) if some contiguities given territory boundaries should be removed 
because there are good reasons (mountain range, ...) for no contact, 
provide a reproducible example so that you can be assisted in programming 
the criteria for thinning the contiguity graph; and

III) if you really want to go with road distances, provide a reproducible 
example for first finding the representative point for each territory and 
then giving the road network and territory boundaries. With the linear 
network and the change-of-support points, it is not unlikely that the 
spatstat linnet route will be easiest to implement. I have used raster 
cost distances in GRASS for things like this (see the Snow example in ch. 
4 in ASDAR); gdistance is slower in that setting.

Hope this helps,

Roger

PS. It would be really helpful to use affiliations, as gmail addresses 
tell us nothing about what might be expected of background knowledge. This 
posting feels like someone looking for a response to a reviewer of an 
article submitted to a journal, where the reviewer has little idea of the 
underlying challenges involved in making such a revision. Not knowing 
this, and the lack of a reproducible example leaves helpers pretty much in 
the dark. Using existing or toy data sets lets you post without showing 
too much of the detail in your specific problem, but in this thread there 
has been too little information for reasonable traction.

>
> El s?b., 22 de jun. de 2019 a la(s) 21:15, Rolf Turner (
> r.turner at auckland.ac.nz) escribi?:
>
>> On 23/06/19 3:30 PM, Rolando Valdez wrote:
>>> Sorry again.
>>>
>>> A Spatial Weight Matrix (swm) is an object used in spatial econometrics
>>> to characterize the spatial structure among territories. It is an
>>> element nxn where n is the number of territorial units (counties,
>>> districts, states, cities, regions) in the sample and it could be based
>>> on contiguity or distance. Usually, you can create a swm based on
>>> distance using 'dnearneigh' from spdep and then convert to a listw
>>> through 'nb2listw'. The problem is that the matrix that you generate
>>> trough 'dnearneigh'computes the euclidean distance among centroids of
>>> polygons. This is where I spot my issue, I need to compute the swm using
>>> the road distance instead of euclidean distance computed through
>>> 'dnearneigh'. I do have a shapefile with poligons (counties) and another
>>> shapefile with lines (roads).
>>
>> OK.  It's getting a *bit* clearer ....  You are interested in "road
>> distances" between counties.  I'm still not entirely sure what this
>> means.  Is it the *minimum* distance by road from one county to another?
>> In which case, if two counties are contiguous (adjacent) and there is a
>> road crossing the border between the two, is the distance between the
>> counties equal to zero?  (This doesn't seem like it would be
>> satisfactory ....)
>>
>> Yes, actually it is possible that two counties were connected by more than
> one road, however it's not a big deal. If I define a distance of 50 km, it
> doesn't matter how many times two counties are connected, I just need that
> they are at 50 km trough, at least, one road.
>
>> If this is not the case, then what *is* the case?  Perhaps you want
>> distances between the *centroids* of the counties.  What then do you
>> mean by road distance when the centroids do not lie on a road?
>>
>
> This is a big challenge, I'm still working on it.
>
>>
>> You apparently need to deal with counties in which there are no roads at
>> all.  To handle this you have to define what *you* mean by the distance
>> by road from county A to county B when there are no roads at all in
>> county B.  Perhaps infinity would be the appropriate distance, but *I*
>> don't know; you have to make the call.
>>
>
> If two counties are not connected through a road, they could not be
> neighbors. In this case, it would correspond to a value 0 in the matrix.
>
>>
>> Previously you indicated that you needed to know (pairwise) road
>> distances between specified points in a given set, and I showed you how
>> to obtain those using pairdist(), from spatstat.  Now it seems that you
>> want something rather different, and it's still not clear what.
>>
>> In a sense is the same, but you said so properly, We have different
> research fields.
>
>
>> You need to get *your* thoughts clear; make some definitions and
>> specifications, and decide what you really want or need.
>>
>
> I got it.
>
>>
>> It seems that you are expecting R to magically do your thinking for you;
>> it won't!
>>
>> No, I'm not expecting that.
>
>> cheers,
>>
>> Rolf
>>
>>> El s?b., 22 de jun. de 2019 a la(s) 20:00, Rolf Turner
>>> (r.turner at auckland.ac.nz <mailto:r.turner at auckland.ac.nz>) escribi?:
>>>
>>>
>>>     On 23/06/19 2:38 PM, Rolando Valdez wrote:
>>>
>>>     > I am sorry, I was not clear enough. My goal is to calculate a
>>>     spatial
>>>     > weight matrix (nxn) across counties but, instead of euclidean
>>>     distance,
>>>     > to use road distance.
>>>
>>>     I'm afraid I still don't understand.  To put it mildly. You
>> presumably
>>>     have a clear idea of what you are trying to, but those of us who are
>>>     not
>>>     involved in your research have no such idea.  We (or at least I)
>>>     haven't
>>>     a clue as to what you are talking about.
>>>
>>>     What do you mean by "spatial weight"?  What are these weights used
>> for?
>>>     What is n?  How are the counties involved?  Is n the number of
>>>     counties?
>>>     Are you interested in the road distance (minimum road distance?)
>>>     between
>>>     pairs of counties?
>>>
>>>     Please explain *clearly* and do not expect those who are trying to
>> help
>>>     you to be mind-readers!!!
>>>
>>>     cheers,
>>>
>>>     Rolf
>>>
>>>     >
>>>     > El s?b., 22 de jun. de 2019 a la(s) 19:28, Rolf Turner
>>>     > (r.turner at auckland.ac.nz <mailto:r.turner at auckland.ac.nz>
>>>     <mailto:r.turner at auckland.ac.nz <mailto:r.turner at auckland.ac.nz>>)
>>>     escribi?:
>>>     >
>>>     >
>>>     >     On 23/06/19 1:17 PM, Rolando Valdez wrote:
>>>     >
>>>     >     > Thank you for your answer.
>>>     >     >
>>>     >     > I have a shapefile with, say, counties, and I got another
>>>     >     shapefile with
>>>     >     > the roads. ?What if a county does not intersect any road?
>>>     >
>>>     >     I am sorry, but it is not at all clear to me just what the
>>>     problem is.
>>>     >     How do the counties come into the picture?  You said you
>>>     wanted to get
>>>     >     the road distance between points on the roads.  What have the
>>>     counties
>>>     >     got to do with this?
>>>     >
>>>     >     Can you perhaps provide a reproducible example?
>>>     >
>>>     >     cheers,
>>>     >
>>>     >     Rolf
>>>     >
>>>     >     >
>>>     >     > El jue., 20 de jun. de 2019 a la(s) 19:08, Rolf Turner
>>>     >     > (r.turner at auckland.ac.nz <mailto:r.turner at auckland.ac.nz>
>>>     <mailto:r.turner at auckland.ac.nz <mailto:r.turner at auckland.ac.nz>>
>>>     >     <mailto:r.turner at auckland.ac.nz
>>>     <mailto:r.turner at auckland.ac.nz> <mailto:r.turner at auckland.ac.nz
>>>     <mailto:r.turner at auckland.ac.nz>>>)
>>>     >     escribi?:
>>>     >     >
>>>     >     >
>>>     >     >     On 21/06/19 12:26 PM, Rolando Valdez wrote:
>>>     >     >
>>>     >     >     > Dear community,
>>>     >     >     >
>>>     >     >     > Is there any way to create a spatial weight matrix
>>>     based
>>>     >     on road
>>>     >     >     distance?
>>>     >     >     > I am trying to use the road distance between two
>> points
>>>     >     instead of
>>>     >     >     > euclidean distance.
>>>     >     >     >
>>>     >     >     > I've seen that there is a package named osrm. Can
>>>     anyone give
>>>     >     >     some advice?
>>>     >     >
>>>     >     >     I don't know anything about "osrm".  Calculating "road
>>>     distances"
>>>     >     >     can be
>>>     >     >     done in the spatstat package reasonably easily, if you
>>>     take
>>>     >     the trouble
>>>     >     >     to represent your collection of roads as a "linnet"
>>>     object.
>>>     >     >
>>>     >     >     Given that you have done so, suppose that your linnet
>>>     object
>>>     >     is "L" and
>>>     >     >     that you have vectors "x" and "y" specifying the
>>>     points on L
>>>     >     (i.e. on
>>>     >     >     your roads) between which you want to know the
>> distances.
>>>     >     >
>>>     >     >     Do:
>>>     >     >
>>>     >     >           X    <- lpp(data.frame(x=x,y=y),L)
>>>     >     >           dMat <- pairdist(X)
>>>     >     >
>>>     >     >     The object "dMat" is a (symmetric) square matrix;
>>>     dMat[i,j]
>>>     >     is the
>>>     >     >     distance between point i and point j.  (Of course the
>>>     >     diagonal entries
>>>     >     >     are all 0.)
>>>     >     >
>>>     >     >     If your collection of roads is specified by means of a
>>>     shapefile,
>>>     >     >     vignette("shapefiles") will tell you how to turn this
>>>     >     collection into a
>>>     >     >     "psp" ("planar segment pattern") object; the function
>>>     (method)
>>>     >     >     as.linnet.psp() can then be used to turn the "psp"
>>>     object into a
>>>     >     >     "linnet" object.
>>>     >     >
>>>     >     >     HTH
>>
>
>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

From rv@|dezr @end|ng |rom gm@||@com  Mon Jun 24 01:48:42 2019
From: rv@|dezr @end|ng |rom gm@||@com (Rolando Valdez)
Date: Sun, 23 Jun 2019 16:48:42 -0700
Subject: [R-sig-Geo] 
 [FORGED] Create a Spatial Weight Matrix based on road distance
In-Reply-To: <d24c8969-adee-d176-9241-f319734d24b3@auckland.ac.nz>
References: <CAFvJtoFemxph=u+ewBra6ebHLzaOC=49r3WFB6sJ5N7Zxs4m_Q@mail.gmail.com>
 <49e352fb-6742-86d6-bd7e-571088a0b3eb@auckland.ac.nz>
 <CAFvJtoH4s5oqkmjP=jyJFhRNQBn1EUm442GY6yRsMEUxX7O45A@mail.gmail.com>
 <946cf6cb-6863-e853-c458-0a5a9c144f68@auckland.ac.nz>
 <CAFvJtoFooKRQKFDSd+hysJ=1_h2gfA3ZUH1F3x8kocxo-YuUgQ@mail.gmail.com>
 <9f41bccc-43ca-6789-34ff-bac633de2a86@auckland.ac.nz>
 <CAFvJtoFCY18APnXSOQ_PoCLjiyh0baMGEyqjedOEzdOPSVXt7Q@mail.gmail.com>
 <bb171071-37d1-1da9-1b08-490019051634@auckland.ac.nz>
 <CAFvJtoH39rnSiR-eUyaNt8HucVp6Y6Uw+jT6jVh6sgP_PVOxfg@mail.gmail.com>
 <d24c8969-adee-d176-9241-f319734d24b3@auckland.ac.nz>
Message-ID: <CAFvJtoG6J9nv68Xn9eBEvs+V0hGDzzCUr8qCcV-VvC3vnaNE+A@mail.gmail.com>

I mean the distance between centroids of polygons that represent counties.

Thank you for your time.

El dom., 23 de jun. de 2019 a la(s) 01:17, Rolf Turner (
r.turner at auckland.ac.nz) escribi?:

>
> On 23/06/19 6:01 PM, Rolando Valdez wrote:
>
> > I apologize for the lack of clarity.
> >
> > Let me try again:
> >
> > The SWM captures the spatial structure among territories. In the case of
> > a matrix based on distance, you define a distance-threshold, say 50 km,
> > and every territory under that distance is considered as neighbor, in
> > the matrix, those territories considered neighbors take the value 1, and
> > 0 otherwise (territories beyond 50 km). This is what 'dnearneigh'
> > function does.
> >
> > Then, I want to define a distance-threshold, say 50 km by road (not
> > euclidean) and every territory under that distance (by road) be
> > considered as neighbor.
>
> You still have not defined what you mean by *distance* between
> territories (regions, counties). Distance between *points* is well
> defined; distance between territories is not.  You have to specify what
> you mean by such a distance.  This could be the minimum distance between
> points in the regions (which is not of course a metric), distance
> between centroids of the territories, Hausdorff distance, or something
> else.  This applies whether you are talking about the distance between
> points being Euclidean distance or road distance or some other metric.
> Thresholding that distance (e.g. at 50 km.) is then a trivial matter.
>
> I have tried my best to get you to clarify what you mean, and my efforts
> seem to be in vain.  Since Juan Pablo thinks that I am "bullying you"
> (which mystifies me completely) I guess I'll give up.  And to respond to
> Juan Pablo's hope, nothing whatever is "bothering" me.
>
> cheers,
>
> Rolf
>
> >
> > El s?b., 22 de jun. de 2019 a la(s) 21:15, Rolf Turner
> > (r.turner at auckland.ac.nz <mailto:r.turner at auckland.ac.nz>) escribi?:
> >
> >     On 23/06/19 3:30 PM, Rolando Valdez wrote:
> >      > Sorry again.
> >      >
> >      > A Spatial Weight Matrix (swm) is an object used in spatial
> >     econometrics
> >      > to characterize the spatial structure among territories. It is an
> >      > element nxn where n is the number of territorial units (counties,
> >      > districts, states, cities, regions) in the sample and it could be
> >     based
> >      > on contiguity or distance. Usually, you can create a swm based on
> >      > distance using 'dnearneigh' from spdep and then convert to a listw
> >      > through 'nb2listw'. The problem is that the matrix that you
> generate
> >      > trough 'dnearneigh'computes the euclidean distance among
> >     centroids of
> >      > polygons. This is where I spot my issue, I need to compute the
> >     swm using
> >      > the road distance instead of euclidean distance computed through
> >      > 'dnearneigh'. I do have a shapefile with poligons (counties) and
> >     another
> >      > shapefile with lines (roads).
> >
> >     OK.  It's getting a *bit* clearer ....  You are interested in "road
> >     distances" between counties.  I'm still not entirely sure what this
> >     means.  Is it the *minimum* distance by road from one county to
> >     another?
> >     In which case, if two counties are contiguous (adjacent) and there
> is a
> >     road crossing the border between the two, is the distance between the
> >     counties equal to zero?  (This doesn't seem like it would be
> >     satisfactory ....)
> >
> > Yes, actually it is possible that two counties were connected by more
> > than one road, however it's not a big deal. If I define a distance of 50
> > km, it doesn't matter how many times two counties are connected, I just
> > need that they are at 50 km trough, at least, one road.
> >
> >     If this is not the case, then what *is* the case?  Perhaps you want
> >     distances between the *centroids* of the counties.  What then do you
> >     mean by road distance when the centroids do not lie on a road?
> >
> >
> > This is a big challenge, I'm still working on it.
> >
> >
> >     You apparently need to deal with counties in which there are no
> >     roads at
> >     all.  To handle this you have to define what *you* mean by the
> distance
> >     by road from county A to county B when there are no roads at all in
> >     county B.  Perhaps infinity would be the appropriate distance, but
> *I*
> >     don't know; you have to make the call.
> >
> >
> > If two counties are not connected through a road, they could not be
> > neighbors. In this case, it would correspond to a value 0 in the matrix.
> >
> >
> >     Previously you indicated that you needed to know (pairwise) road
> >     distances between specified points in a given set, and I showed you
> how
> >     to obtain those using pairdist(), from spatstat.  Now it seems that
> you
> >     want something rather different, and it's still not clear what.
> >
> > In a sense is the same, but you said so properly, We have different
> > research fields.
> >
> >     You need to get *your* thoughts clear; make some definitions and
> >     specifications, and decide what you really want or need.
> >
> >
> > I got it.
> >
> >
> >     It seems that you are expecting R to magically do your thinking for
> >     you;
> >     it won't!
> >
> > No, I'm not expecting that.
> >
> >     cheers,
> >
> >     Rolf
> >
> >      > El s?b., 22 de jun. de 2019 a la(s) 20:00, Rolf Turner
> >      > (r.turner at auckland.ac.nz <mailto:r.turner at auckland.ac.nz>
> >     <mailto:r.turner at auckland.ac.nz <mailto:r.turner at auckland.ac.nz>>)
> >     escribi?:
> >      >
> >      >
> >      >     On 23/06/19 2:38 PM, Rolando Valdez wrote:
> >      >
> >      >      > I am sorry, I was not clear enough. My goal is to
> calculate a
> >      >     spatial
> >      >      > weight matrix (nxn) across counties but, instead of
> euclidean
> >      >     distance,
> >      >      > to use road distance.
> >      >
> >      >     I'm afraid I still don't understand.  To put it mildly. You
> >     presumably
> >      >     have a clear idea of what you are trying to, but those of us
> >     who are
> >      >     not
> >      >     involved in your research have no such idea.  We (or at least
> I)
> >      >     haven't
> >      >     a clue as to what you are talking about.
> >      >
> >      >     What do you mean by "spatial weight"?  What are these weights
> >     used for?
> >      >     What is n?  How are the counties involved?  Is n the number of
> >      >     counties?
> >      >     Are you interested in the road distance (minimum road
> distance?)
> >      >     between
> >      >     pairs of counties?
> >      >
> >      >     Please explain *clearly* and do not expect those who are
> >     trying to help
> >      >     you to be mind-readers!!!
> >      >
> >      >     cheers,
> >      >
> >      >     Rolf
> >      >
> >      >      >
> >      >      > El s?b., 22 de jun. de 2019 a la(s) 19:28, Rolf Turner
> >      >      > (r.turner at auckland.ac.nz <mailto:r.turner at auckland.ac.nz>
> >     <mailto:r.turner at auckland.ac.nz <mailto:r.turner at auckland.ac.nz>>
> >      >     <mailto:r.turner at auckland.ac.nz
> >     <mailto:r.turner at auckland.ac.nz> <mailto:r.turner at auckland.ac.nz
> >     <mailto:r.turner at auckland.ac.nz>>>)
> >      >     escribi?:
> >      >      >
> >      >      >
> >      >      >     On 23/06/19 1:17 PM, Rolando Valdez wrote:
> >      >      >
> >      >      >      > Thank you for your answer.
> >      >      >      >
> >      >      >      > I have a shapefile with, say, counties, and I got
> >     another
> >      >      >     shapefile with
> >      >      >      > the roads. ?What if a county does not intersect any
> >     road?
> >      >      >
> >      >      >     I am sorry, but it is not at all clear to me just what
> the
> >      >     problem is.
> >      >      >     How do the counties come into the picture?  You said
> you
> >      >     wanted to get
> >      >      >     the road distance between points on the roads.  What
> >     have the
> >      >     counties
> >      >      >     got to do with this?
> >      >      >
> >      >      >     Can you perhaps provide a reproducible example?
> >      >      >
> >      >      >     cheers,
> >      >      >
> >      >      >     Rolf
> >      >      >
> >      >      >      >
> >      >      >      > El jue., 20 de jun. de 2019 a la(s) 19:08, Rolf
> Turner
> >      >      >      > (r.turner at auckland.ac.nz
> >     <mailto:r.turner at auckland.ac.nz> <mailto:r.turner at auckland.ac.nz
> >     <mailto:r.turner at auckland.ac.nz>>
> >      >     <mailto:r.turner at auckland.ac.nz
> >     <mailto:r.turner at auckland.ac.nz> <mailto:r.turner at auckland.ac.nz
> >     <mailto:r.turner at auckland.ac.nz>>>
> >      >      >     <mailto:r.turner at auckland.ac.nz
> >     <mailto:r.turner at auckland.ac.nz>
> >      >     <mailto:r.turner at auckland.ac.nz
> >     <mailto:r.turner at auckland.ac.nz>> <mailto:r.turner at auckland.ac.nz
> >     <mailto:r.turner at auckland.ac.nz>
> >      >     <mailto:r.turner at auckland.ac.nz
> >     <mailto:r.turner at auckland.ac.nz>>>>)
> >      >      >     escribi?:
> >      >      >      >
> >      >      >      >
> >      >      >      >     On 21/06/19 12:26 PM, Rolando Valdez wrote:
> >      >      >      >
> >      >      >      >      > Dear community,
> >      >      >      >      >
> >      >      >      >      > Is there any way to create a spatial weight
> >     matrix
> >      >     based
> >      >      >     on road
> >      >      >      >     distance?
> >      >      >      >      > I am trying to use the road distance between
> >     two points
> >      >      >     instead of
> >      >      >      >      > euclidean distance.
> >      >      >      >      >
> >      >      >      >      > I've seen that there is a package named
> >     osrm. Can
> >      >     anyone give
> >      >      >      >     some advice?
> >      >      >      >
> >      >      >      >     I don't know anything about "osrm".
> >     Calculating "road
> >      >     distances"
> >      >      >      >     can be
> >      >      >      >     done in the spatstat package reasonably easily,
> >     if you
> >      >     take
> >      >      >     the trouble
> >      >      >      >     to represent your collection of roads as a
> "linnet"
> >      >     object.
> >      >      >      >
> >      >      >      >     Given that you have done so, suppose that your
> >     linnet
> >      >     object
> >      >      >     is "L" and
> >      >      >      >     that you have vectors "x" and "y" specifying the
> >      >     points on L
> >      >      >     (i.e. on
> >      >      >      >     your roads) between which you want to know the
> >     distances.
> >      >      >      >
> >      >      >      >     Do:
> >      >      >      >
> >      >      >      >           X    <- lpp(data.frame(x=x,y=y),L)
> >      >      >      >           dMat <- pairdist(X)
> >      >      >      >
> >      >      >      >     The object "dMat" is a (symmetric) square
> matrix;
> >      >     dMat[i,j]
> >      >      >     is the
> >      >      >      >     distance between point i and point j.  (Of
> >     course the
> >      >      >     diagonal entries
> >      >      >      >     are all 0.)
> >      >      >      >
> >      >      >      >     If your collection of roads is specified by
> >     means of a
> >      >     shapefile,
> >      >      >      >     vignette("shapefiles") will tell you how to
> >     turn this
> >      >      >     collection into a
> >      >      >      >     "psp" ("planar segment pattern") object; the
> >     function
> >      >     (method)
> >      >      >      >     as.linnet.psp() can then be used to turn the
> "psp"
> >      >     object into a
> >      >      >      >     "linnet" object.
> >      >      >      >
> >      >      >      >     HTH
>


-- 
Rol~

	[[alternative HTML version deleted]]


From rv@|dezr @end|ng |rom gm@||@com  Mon Jun 24 06:52:58 2019
From: rv@|dezr @end|ng |rom gm@||@com (Rolando Valdez)
Date: Sun, 23 Jun 2019 21:52:58 -0700
Subject: [R-sig-Geo] 
 [FORGED] Create a Spatial Weight Matrix based on road distance
In-Reply-To: <alpine.LFD.2.21.1906231133230.24806@reclus.nhh.no>
References: <CAFvJtoFemxph=u+ewBra6ebHLzaOC=49r3WFB6sJ5N7Zxs4m_Q@mail.gmail.com>
 <49e352fb-6742-86d6-bd7e-571088a0b3eb@auckland.ac.nz>
 <CAFvJtoH4s5oqkmjP=jyJFhRNQBn1EUm442GY6yRsMEUxX7O45A@mail.gmail.com>
 <946cf6cb-6863-e853-c458-0a5a9c144f68@auckland.ac.nz>
 <CAFvJtoFooKRQKFDSd+hysJ=1_h2gfA3ZUH1F3x8kocxo-YuUgQ@mail.gmail.com>
 <9f41bccc-43ca-6789-34ff-bac633de2a86@auckland.ac.nz>
 <CAFvJtoFCY18APnXSOQ_PoCLjiyh0baMGEyqjedOEzdOPSVXt7Q@mail.gmail.com>
 <bb171071-37d1-1da9-1b08-490019051634@auckland.ac.nz>
 <CAFvJtoH39rnSiR-eUyaNt8HucVp6Y6Uw+jT6jVh6sgP_PVOxfg@mail.gmail.com>
 <alpine.LFD.2.21.1906231133230.24806@reclus.nhh.no>
Message-ID: <CAFvJtoHhbjriDUscpcd8=4LosdNont3cfz2y_oknNqq19BYjwg@mail.gmail.com>

El dom., 23 de jun. de 2019 a la(s) 03:00, Roger Bivand (Roger.Bivand at nhh.no)
escribi?:

> Comments inline below:
>
> On Sun, 23 Jun 2019, Rolando Valdez wrote:
>
> > I apologize for the lack of clarity.
> >
> > Let me try again:
> >
> > The SWM captures the spatial structure among territories. In the case of
> a
> > matrix based on distance, you define a distance-threshold, say 50 km, and
> > every territory under that distance is considered as neighbor, in the
> > matrix, those territories considered neighbors take the value 1, and 0
> > otherwise (territories beyond 50 km). This is what 'dnearneigh' function
> > does.
> >
> > Then, I want to define a distance-threshold, say 50 km by road (not
> > euclidean) and every territory under that distance (by road) be
> considered
> > as neighbor.
>
>
> So the main goal is to use distance by road between territories to
> construct a neighbour object, with a maximum distance threshold.
>

Yes, just like that.

>
> Firstly, why do you suppose that this will represent your a priori
> knowledge better than contiguity, which is the most obvious measure of
> neighbourhood for data with areal support?
>

I'm running the same specification with 8 distance-threshold to assess the
impact of the distance on a key dependent variable.

>
> If there are major mountain chains or water bodies impeding contact across
> a boundary between contiguous territories, could you not just edit out
> those graph edges (spdep::edit.nb() for example)? If there are many, a
> programmatic approach may be needed.
>

Yes, there are many cases like this you mentioned.

>
> The inherent difficulty is that distances to territories in practice mean
> that you have to change support from area to point, and that needs
> thinking through. A territory centroid may, for example, not lie on a
> transport link. If you have finer scale population or production data, you
> might use weighted centroids, but this involves further steps, and using
> this kind of data may add endogeneity, as the variables used to define the
> neighbour object may enter your model elsewhere.
>

I have redefine the shapefile to urban areas, these polygons are smaller
than counties, thus, their centroids would lie on the roads more
confidently.

I am not using variables to define the neighbor object.

>
> So:
>
> I) explain why you cannot simply use contiguities (using accessibility as
> a covariate if important);
>

Because the distance is an explanatory component itself.

>
> II) if some contiguities given territory boundaries should be removed
> because there are good reasons (mountain range, ...) for no contact,
> provide a reproducible example so that you can be assisted in programming
> the criteria for thinning the contiguity graph; and
>
> III) if you really want to go with road distances, provide a reproducible
> example for first finding the representative point for each territory and
> then giving the road network and territory boundaries. With the linear
> network and the change-of-support points, it is not unlikely that the
> spatstat linnet route will be easiest to implement. I have used raster
> cost distances in GRASS for things like this (see the Snow example in ch.
> 4 in ASDAR); gdistance is slower in that setting.
>

I've seen the example you suggest, I cannot figure out how to fit to my case
.

>
> Hope this helps,
>
> Roger
>
> PS. It would be really helpful to use affiliations, as gmail addresses
> tell us nothing about what might be expected of background knowledge. This
> posting feels like someone looking for a response to a reviewer of an
> article submitted to a journal, where the reviewer has little idea of the
> underlying challenges involved in making such a revision. Not knowing
> this, and the lack of a reproducible example leaves helpers pretty much in
> the dark. Using existing or toy data sets lets you post without showing
> too much of the detail in your specific problem, but in this thread there
> has been too little information for reasonable traction.
>

You are absolutely right. I am trying to follow a suggestion from a
referee, who suggests to switch from the euclidean distance to a road
distance. This is the reason I posted my doubt, I had no clue even where to
start.

Now, I have task to do.

Thanks a lot for your help.


> >
> > El s?b., 22 de jun. de 2019 a la(s) 21:15, Rolf Turner (
> > r.turner at auckland.ac.nz) escribi?:
> >
> >> On 23/06/19 3:30 PM, Rolando Valdez wrote:
> >>> Sorry again.
> >>>
> >>> A Spatial Weight Matrix (swm) is an object used in spatial econometrics
> >>> to characterize the spatial structure among territories. It is an
> >>> element nxn where n is the number of territorial units (counties,
> >>> districts, states, cities, regions) in the sample and it could be based
> >>> on contiguity or distance. Usually, you can create a swm based on
> >>> distance using 'dnearneigh' from spdep and then convert to a listw
> >>> through 'nb2listw'. The problem is that the matrix that you generate
> >>> trough 'dnearneigh'computes the euclidean distance among centroids of
> >>> polygons. This is where I spot my issue, I need to compute the swm
> using
> >>> the road distance instead of euclidean distance computed through
> >>> 'dnearneigh'. I do have a shapefile with poligons (counties) and
> another
> >>> shapefile with lines (roads).
> >>
> >> OK.  It's getting a *bit* clearer ....  You are interested in "road
> >> distances" between counties.  I'm still not entirely sure what this
> >> means.  Is it the *minimum* distance by road from one county to another?
> >> In which case, if two counties are contiguous (adjacent) and there is a
> >> road crossing the border between the two, is the distance between the
> >> counties equal to zero?  (This doesn't seem like it would be
> >> satisfactory ....)
> >>
> >> Yes, actually it is possible that two counties were connected by more
> than
> > one road, however it's not a big deal. If I define a distance of 50 km,
> it
> > doesn't matter how many times two counties are connected, I just need
> that
> > they are at 50 km trough, at least, one road.
> >
> >> If this is not the case, then what *is* the case?  Perhaps you want
> >> distances between the *centroids* of the counties.  What then do you
> >> mean by road distance when the centroids do not lie on a road?
> >>
> >
> > This is a big challenge, I'm still working on it.
> >
> >>
> >> You apparently need to deal with counties in which there are no roads at
> >> all.  To handle this you have to define what *you* mean by the distance
> >> by road from county A to county B when there are no roads at all in
> >> county B.  Perhaps infinity would be the appropriate distance, but *I*
> >> don't know; you have to make the call.
> >>
> >
> > If two counties are not connected through a road, they could not be
> > neighbors. In this case, it would correspond to a value 0 in the matrix.
> >
> >>
> >> Previously you indicated that you needed to know (pairwise) road
> >> distances between specified points in a given set, and I showed you how
> >> to obtain those using pairdist(), from spatstat.  Now it seems that you
> >> want something rather different, and it's still not clear what.
> >>
> >> In a sense is the same, but you said so properly, We have different
> > research fields.
> >
> >
> >> You need to get *your* thoughts clear; make some definitions and
> >> specifications, and decide what you really want or need.
> >>
> >
> > I got it.
> >
> >>
> >> It seems that you are expecting R to magically do your thinking for you;
> >> it won't!
> >>
> >> No, I'm not expecting that.
> >
> >> cheers,
> >>
> >> Rolf
> >>
> >>> El s?b., 22 de jun. de 2019 a la(s) 20:00, Rolf Turner
> >>> (r.turner at auckland.ac.nz <mailto:r.turner at auckland.ac.nz>) escribi?:
> >>>
> >>>
> >>>     On 23/06/19 2:38 PM, Rolando Valdez wrote:
> >>>
> >>>     > I am sorry, I was not clear enough. My goal is to calculate a
> >>>     spatial
> >>>     > weight matrix (nxn) across counties but, instead of euclidean
> >>>     distance,
> >>>     > to use road distance.
> >>>
> >>>     I'm afraid I still don't understand.  To put it mildly. You
> >> presumably
> >>>     have a clear idea of what you are trying to, but those of us who
> are
> >>>     not
> >>>     involved in your research have no such idea.  We (or at least I)
> >>>     haven't
> >>>     a clue as to what you are talking about.
> >>>
> >>>     What do you mean by "spatial weight"?  What are these weights used
> >> for?
> >>>     What is n?  How are the counties involved?  Is n the number of
> >>>     counties?
> >>>     Are you interested in the road distance (minimum road distance?)
> >>>     between
> >>>     pairs of counties?
> >>>
> >>>     Please explain *clearly* and do not expect those who are trying to
> >> help
> >>>     you to be mind-readers!!!
> >>>
> >>>     cheers,
> >>>
> >>>     Rolf
> >>>
> >>>     >
> >>>     > El s?b., 22 de jun. de 2019 a la(s) 19:28, Rolf Turner
> >>>     > (r.turner at auckland.ac.nz <mailto:r.turner at auckland.ac.nz>
> >>>     <mailto:r.turner at auckland.ac.nz <mailto:r.turner at auckland.ac.nz>>)
> >>>     escribi?:
> >>>     >
> >>>     >
> >>>     >     On 23/06/19 1:17 PM, Rolando Valdez wrote:
> >>>     >
> >>>     >     > Thank you for your answer.
> >>>     >     >
> >>>     >     > I have a shapefile with, say, counties, and I got another
> >>>     >     shapefile with
> >>>     >     > the roads. ?What if a county does not intersect any road?
> >>>     >
> >>>     >     I am sorry, but it is not at all clear to me just what the
> >>>     problem is.
> >>>     >     How do the counties come into the picture?  You said you
> >>>     wanted to get
> >>>     >     the road distance between points on the roads.  What have the
> >>>     counties
> >>>     >     got to do with this?
> >>>     >
> >>>     >     Can you perhaps provide a reproducible example?
> >>>     >
> >>>     >     cheers,
> >>>     >
> >>>     >     Rolf
> >>>     >
> >>>     >     >
> >>>     >     > El jue., 20 de jun. de 2019 a la(s) 19:08, Rolf Turner
> >>>     >     > (r.turner at auckland.ac.nz <mailto:r.turner at auckland.ac.nz>
> >>>     <mailto:r.turner at auckland.ac.nz <mailto:r.turner at auckland.ac.nz>>
> >>>     >     <mailto:r.turner at auckland.ac.nz
> >>>     <mailto:r.turner at auckland.ac.nz> <mailto:r.turner at auckland.ac.nz
> >>>     <mailto:r.turner at auckland.ac.nz>>>)
> >>>     >     escribi?:
> >>>     >     >
> >>>     >     >
> >>>     >     >     On 21/06/19 12:26 PM, Rolando Valdez wrote:
> >>>     >     >
> >>>     >     >     > Dear community,
> >>>     >     >     >
> >>>     >     >     > Is there any way to create a spatial weight matrix
> >>>     based
> >>>     >     on road
> >>>     >     >     distance?
> >>>     >     >     > I am trying to use the road distance between two
> >> points
> >>>     >     instead of
> >>>     >     >     > euclidean distance.
> >>>     >     >     >
> >>>     >     >     > I've seen that there is a package named osrm. Can
> >>>     anyone give
> >>>     >     >     some advice?
> >>>     >     >
> >>>     >     >     I don't know anything about "osrm".  Calculating "road
> >>>     distances"
> >>>     >     >     can be
> >>>     >     >     done in the spatstat package reasonably easily, if you
> >>>     take
> >>>     >     the trouble
> >>>     >     >     to represent your collection of roads as a "linnet"
> >>>     object.
> >>>     >     >
> >>>     >     >     Given that you have done so, suppose that your linnet
> >>>     object
> >>>     >     is "L" and
> >>>     >     >     that you have vectors "x" and "y" specifying the
> >>>     points on L
> >>>     >     (i.e. on
> >>>     >     >     your roads) between which you want to know the
> >> distances.
> >>>     >     >
> >>>     >     >     Do:
> >>>     >     >
> >>>     >     >           X    <- lpp(data.frame(x=x,y=y),L)
> >>>     >     >           dMat <- pairdist(X)
> >>>     >     >
> >>>     >     >     The object "dMat" is a (symmetric) square matrix;
> >>>     dMat[i,j]
> >>>     >     is the
> >>>     >     >     distance between point i and point j.  (Of course the
> >>>     >     diagonal entries
> >>>     >     >     are all 0.)
> >>>     >     >
> >>>     >     >     If your collection of roads is specified by means of a
> >>>     shapefile,
> >>>     >     >     vignette("shapefiles") will tell you how to turn this
> >>>     >     collection into a
> >>>     >     >     "psp" ("planar segment pattern") object; the function
> >>>     (method)
> >>>     >     >     as.linnet.psp() can then be used to turn the "psp"
> >>>     object into a
> >>>     >     >     "linnet" object.
> >>>     >     >
> >>>     >     >     HTH
> >>
> >
> >
> >
>
> --
> Roger Bivand
> Department of Economics, Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
> https://orcid.org/0000-0003-2392-6140
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en



-- 
Rol~

	[[alternative HTML version deleted]]


From h@h@|eez@deh @end|ng |rom gm@||@com  Mon Jun 24 06:55:10 2019
From: h@h@|eez@deh @end|ng |rom gm@||@com (Hossein Shafizadeh)
Date: Mon, 24 Jun 2019 09:25:10 +0430
Subject: [R-sig-Geo] How to save components in pls model
In-Reply-To: <alpine.LFD.2.21.1906231108180.24806@reclus.nhh.no>
References: <CA+P0tdNb6hdON=A_0oKjAuBXZhX967nnCwwXEFL2szswQaCHpg-9857@mail.gmail.com>
 <alpine.LFD.2.21.1906231108180.24806@reclus.nhh.no>
Message-ID: <CA+P0tdPNSuWUHQuip8VJROUhSZNdt9T=aMQo_y5ozKDGA8DYEg@mail.gmail.com>

Thank you for your kind reply.
Hossein

On Sun, Jun 23, 2019 at 1:46 PM Roger Bivand <Roger.Bivand at nhh.no> wrote:

> On Sat, 22 Jun 2019, Hossein Shafizadeh wrote:
>
> > Hello everyone,
> > I want to *save the components *when using pls, I tried several ways but
> > failed.
> > No matter if using the caret package or in other coding formats. The code
> > in the caret is:
>
> Maybe you should condider a different list? The only reason this list
> might be relevant is if the object name extsentinel suggests that you are
> using earth observation data. In any case a reproducible example would be
> needed using a built in data set, such as a raster image from a CRAN
> package, or spDataLarge::landsat; install from:
>
> install.packages("spDataLarge", repos = "https://nowosad.github.io/drat/",
>
> type = "source")
>
> Roger
>
> > factors <- c("a","b","c")
> > set.seed(123)
> > silt <-
> caret::train(extsentinel[,factors],extsentinel$Silt,metric="RMSE",
> >                method="pls",tuneLength = 10 , importance=T,
> verbose=FALSE,
> >                trControl=trainControl(method="cv",savePredictions =
> > "final"),
> >                returnData=T, preProc = c("BoxCox","center", "scale"))
> >
> > Thanks in advance,
> > Hossein
> >
> >       [[alternative HTML version deleted]]
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
>
> --
> Roger Bivand
> Department of Economics, Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
> https://orcid.org/0000-0003-2392-6140
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>

	[[alternative HTML version deleted]]


From rv@|dezr @end|ng |rom gm@||@com  Mon Jun 24 07:03:25 2019
From: rv@|dezr @end|ng |rom gm@||@com (Rolando Valdez)
Date: Sun, 23 Jun 2019 22:03:25 -0700
Subject: [R-sig-Geo] 
 [FORGED] Create a Spatial Weight Matrix based on road distance
In-Reply-To: <CAMXOh=1Y48St-XD9vYJDmarHo7ticE89CdKFUpfCFCAo7K3MpA@mail.gmail.com>
References: <CAFvJtoFemxph=u+ewBra6ebHLzaOC=49r3WFB6sJ5N7Zxs4m_Q@mail.gmail.com>
 <49e352fb-6742-86d6-bd7e-571088a0b3eb@auckland.ac.nz>
 <MEAPR01MB32216AB3C4EFE314DFCA2041A4E70@MEAPR01MB3221.ausprd01.prod.outlook.com>
 <CAMXOh=1Y48St-XD9vYJDmarHo7ticE89CdKFUpfCFCAo7K3MpA@mail.gmail.com>
Message-ID: <CAFvJtoEzyk38wyZhdKWffunV8V_xBYweb2Jtg7-ksDgkHuV88g@mail.gmail.com>

Dear Andres,

I could follow an example provided with the package, it was a little bit
simple, however, I got this message:

> dists <- osrmTable(loc = muns13, measure = "duration")
The OSRM server returned an error:
Error: The public OSRM API does not allow results with a number of
durations
higher than 10000. Ask for fewer durations or use your own server and set
its
--max-table-size option.

My sample size is 2,457

El vie., 21 de jun. de 2019 a la(s) 02:53, Andres Diaz Loaiza (
madiazl at gmail.com) escribi?:

> Dear Rolando,
>
> The advantage of using Open Street Maps engine is that you can give the
> travel option. This means you can select whether are you traveling by bike,
> car or walking. The previous approach didn't consider this topic. For this,
> you should have added a vector layer depending on your position of the
> street you can take (or not). Open Street Maps project allow you two
> options: a service in which you give your current position, the position
> you want to reach and your transport method (giving you back the fastest
> route). Or the option to download the engine/algorithm compile by yourself
> (if I am not wrong is made in C or python) and then you can make your own
> calculation at your own computer. For the first option, the package OSRM is
> an interface in which send a request to the OSM web page and wait for an
> answer. With this method, you can send a couple of request at the same time
> but no to many (you should read the manual for this). Of course, also will
> depend on whether the OSM server is down or not (or busy).
>
> I have to say that I used some years ago this app and nowadays I know that
> for some cities OSM has more streets reported than the same google maps.
> Also is an open project and they let you download their data for free,
> contrary to what google maps do.
>
> All the best,
>
>
> Andres
>
> El vie., 21 jun. 2019 a las 4:30, Adrian Baddeley (<
> adrian.baddeley at curtin.edu.au>) escribi?:
>
>> Rather than converting an object of class 'SpatialLines' or
>> 'SpatialLinesDataFrame' to the spatstat class 'psp' and then converting it
>> to the spatstat class 'linnet', it is safer and more efficient to convert
>> the SpatialLines* object directly to class linnet using
>> as.linnet.SpatialLinesDataFrame() from the package 'maptools'.
>>
>>
>> Prof Adrian Baddeley DSc FAA
>>
>> John Curtin Distinguished Professor
>>
>> Department of Mathematics and Statistics
>>
>> Curtin University, Perth, Western Australia
>>
>>
>> ________________________________
>> From: Rolf Turner <r.turner at auckland.ac.nz>
>> Sent: Friday, 21 June 2019 10:08 AM
>> To: Rolando Valdez
>> Cc: r-sig-geo at r-project.org; Adrian Baddeley; Ege Rubak
>> Subject: Re: [FORGED] [R-sig-Geo] Create a Spatial Weight Matrix based on
>> road distance
>>
>>
>> On 21/06/19 12:26 PM, Rolando Valdez wrote:
>>
>> > Dear community,
>> >
>> > Is there any way to create a spatial weight matrix based on road
>> distance?
>> > I am trying to use the road distance between two points instead of
>> > euclidean distance.
>> >
>> > I've seen that there is a package named osrm. Can anyone give some
>> advice?
>>
>> I don't know anything about "osrm".  Calculating "road distances" can be
>> done in the spatstat package reasonably easily, if you take the trouble
>> to represent your collection of roads as a "linnet" object.
>>
>> Given that you have done so, suppose that your linnet object is "L" and
>> that you have vectors "x" and "y" specifying the points on L (i.e. on
>> your roads) between which you want to know the distances.
>>
>> Do:
>>
>>      X    <- lpp(data.frame(x=x,y=y),L)
>>      dMat <- pairdist(X)
>>
>> The object "dMat" is a (symmetric) square matrix; dMat[i,j] is the
>> distance between point i and point j.  (Of course the diagonal entries
>> are all 0.)
>>
>> If your collection of roads is specified by means of a shapefile,
>> vignette("shapefiles") will tell you how to turn this collection into a
>> "psp" ("planar segment pattern") object; the function (method)
>> as.linnet.psp() can then be used to turn the "psp" object into a
>> "linnet" object.
>>
>> HTH
>>
>> cheers,
>>
>> Rolf Turner
>>
>> --
>> Honorary Research Fellow
>> Department of Statistics
>> University of Auckland
>> Phone: +64-9-373-7599 ext. 88276
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>
> --
> Andr?s D.
>


-- 
Rol~

	[[alternative HTML version deleted]]


From Roger@B|v@nd @end|ng |rom nhh@no  Mon Jun 24 09:57:49 2019
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Mon, 24 Jun 2019 09:57:49 +0200
Subject: [R-sig-Geo] 
 [FORGED] Create a Spatial Weight Matrix based on road distance
In-Reply-To: <CAFvJtoEzyk38wyZhdKWffunV8V_xBYweb2Jtg7-ksDgkHuV88g@mail.gmail.com>
References: <CAFvJtoFemxph=u+ewBra6ebHLzaOC=49r3WFB6sJ5N7Zxs4m_Q@mail.gmail.com>
 <49e352fb-6742-86d6-bd7e-571088a0b3eb@auckland.ac.nz>
 <MEAPR01MB32216AB3C4EFE314DFCA2041A4E70@MEAPR01MB3221.ausprd01.prod.outlook.com>
 <CAMXOh=1Y48St-XD9vYJDmarHo7ticE89CdKFUpfCFCAo7K3MpA@mail.gmail.com>
 <CAFvJtoEzyk38wyZhdKWffunV8V_xBYweb2Jtg7-ksDgkHuV88g@mail.gmail.com>
Message-ID: <alpine.LFD.2.21.1906240916340.31909@reclus.nhh.no>

On Mon, 24 Jun 2019, Rolando Valdez wrote:

> Dear Andres,
>
> I could follow an example provided with the package, it was a little bit
> simple, however, I got this message:
>
>> dists <- osrmTable(loc = muns13, measure = "duration")
> The OSRM server returned an error:
> Error: The public OSRM API does not allow results with a number of
> durations
> higher than 10000. Ask for fewer durations or use your own server and set
> its
> --max-table-size option.
>
> My sample size is 2,457

Were you asking for the whole nx(n-1)/2 set of durations in one run? You 
see that the API limits the number of interactions (possibly by time and 
by unique IP number). So you need to reduce the number of queries. If you 
are going to impose a distance threshold anyway, you can do that using the 
Great Circle (not Euclidean) distances between your geographical 
coordinates and dnearneigh(), and step through the nb list object with 
src= being the data frame of the observation coordinates, and dest= the 
data frame of the neighbours' coordinates.

library(sf)
nc <- st_read(system.file("shapes/sids.shp", package="spData")[1], 
quiet=TRUE)
st_crs(nc) <- "+proj=longlat +datum=NAD27"
nc1 <- st_transform(nc, 32019)
nc2 <- st_centroid(nc1, of_largest_polygon=TRUE)
nc3 <- st_transform(nc2, 4326)
crds <- st_coordinates(st_geometry(nc3))
df <- data.frame(id=nc3$FIPSNO, long=crds[,1], lat=crds[,2])
library(spdep)
nb <- dnearneigh(crds, 0, 50, longlat=TRUE)
library(osrm)
res <- vector(mode="list", length=nrow(df))
for (i in seq(along=res)) res[[i]] <- osrmTable(src=df[i,],
  dst=df[nb[[i]],], measure = "duration")
res1 <- lapply(res, function(x) 10/x$duration)
lw <- nb2listw(nb, glist=res1, style="B")

gives general spatial weights based on 10/# minutes travel time between 
county centroids (centroids calculated from projected coordinates), for 
county centroids closer than 50 km measured by Great Circle.

In your case, you may need to split the for() loop into portions of 
cumsum(card(nb)) of less than the limit. If durations are symmetric, 
you could also halve the query count by taking only neighbour ids > i, 
but you'd have to fold them back afterwards. You also wanted to categorise 
the durations into 0,1, which you could do with lapply() instead of using 
inverse durations.

Hope this helps,

Roger

>
> El vie., 21 de jun. de 2019 a la(s) 02:53, Andres Diaz Loaiza (
> madiazl at gmail.com) escribi?:
>
>> Dear Rolando,
>>
>> The advantage of using Open Street Maps engine is that you can give the
>> travel option. This means you can select whether are you traveling by bike,
>> car or walking. The previous approach didn't consider this topic. For this,
>> you should have added a vector layer depending on your position of the
>> street you can take (or not). Open Street Maps project allow you two
>> options: a service in which you give your current position, the position
>> you want to reach and your transport method (giving you back the fastest
>> route). Or the option to download the engine/algorithm compile by yourself
>> (if I am not wrong is made in C or python) and then you can make your own
>> calculation at your own computer. For the first option, the package OSRM is
>> an interface in which send a request to the OSM web page and wait for an
>> answer. With this method, you can send a couple of request at the same time
>> but no to many (you should read the manual for this). Of course, also will
>> depend on whether the OSM server is down or not (or busy).
>>
>> I have to say that I used some years ago this app and nowadays I know that
>> for some cities OSM has more streets reported than the same google maps.
>> Also is an open project and they let you download their data for free,
>> contrary to what google maps do.
>>
>> All the best,
>>
>>
>> Andres
>>
>> El vie., 21 jun. 2019 a las 4:30, Adrian Baddeley (<
>> adrian.baddeley at curtin.edu.au>) escribi?:
>>
>>> Rather than converting an object of class 'SpatialLines' or
>>> 'SpatialLinesDataFrame' to the spatstat class 'psp' and then converting it
>>> to the spatstat class 'linnet', it is safer and more efficient to convert
>>> the SpatialLines* object directly to class linnet using
>>> as.linnet.SpatialLinesDataFrame() from the package 'maptools'.
>>>
>>>
>>> Prof Adrian Baddeley DSc FAA
>>>
>>> John Curtin Distinguished Professor
>>>
>>> Department of Mathematics and Statistics
>>>
>>> Curtin University, Perth, Western Australia
>>>
>>>
>>> ________________________________
>>> From: Rolf Turner <r.turner at auckland.ac.nz>
>>> Sent: Friday, 21 June 2019 10:08 AM
>>> To: Rolando Valdez
>>> Cc: r-sig-geo at r-project.org; Adrian Baddeley; Ege Rubak
>>> Subject: Re: [FORGED] [R-sig-Geo] Create a Spatial Weight Matrix based on
>>> road distance
>>>
>>>
>>> On 21/06/19 12:26 PM, Rolando Valdez wrote:
>>>
>>>> Dear community,
>>>>
>>>> Is there any way to create a spatial weight matrix based on road
>>> distance?
>>>> I am trying to use the road distance between two points instead of
>>>> euclidean distance.
>>>>
>>>> I've seen that there is a package named osrm. Can anyone give some
>>> advice?
>>>
>>> I don't know anything about "osrm".  Calculating "road distances" can be
>>> done in the spatstat package reasonably easily, if you take the trouble
>>> to represent your collection of roads as a "linnet" object.
>>>
>>> Given that you have done so, suppose that your linnet object is "L" and
>>> that you have vectors "x" and "y" specifying the points on L (i.e. on
>>> your roads) between which you want to know the distances.
>>>
>>> Do:
>>>
>>>      X    <- lpp(data.frame(x=x,y=y),L)
>>>      dMat <- pairdist(X)
>>>
>>> The object "dMat" is a (symmetric) square matrix; dMat[i,j] is the
>>> distance between point i and point j.  (Of course the diagonal entries
>>> are all 0.)
>>>
>>> If your collection of roads is specified by means of a shapefile,
>>> vignette("shapefiles") will tell you how to turn this collection into a
>>> "psp" ("planar segment pattern") object; the function (method)
>>> as.linnet.psp() can then be used to turn the "psp" object into a
>>> "linnet" object.
>>>
>>> HTH
>>>
>>> cheers,
>>>
>>> Rolf Turner
>>>
>>> --
>>> Honorary Research Fellow
>>> Department of Statistics
>>> University of Auckland
>>> Phone: +64-9-373-7599 ext. 88276
>>>
>>>         [[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>>
>> --
>> Andr?s D.
>>
>
>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

From t|mothee@g|r@ud @end|ng |rom cnr@@|r  Mon Jun 24 10:15:21 2019
From: t|mothee@g|r@ud @end|ng |rom cnr@@|r (=?iso-8859-1?q?Timoth=E9e?= Giraud)
Date: Mon, 24 Jun 2019 10:15:21 +0200
Subject: [R-sig-Geo] [FORGED] Create a Spatial Weight Matrix based on road
 distance
In-Reply-To: <mailman.27431.2.1561284002.60074.r-sig-geo@r-project.org>
References: <mailman.27431.2.1561284002.60074.r-sig-geo@r-project.org>
Message-ID: <1561364121.3393.0@smtp.cnrs.fr>

Dear Rolando,

OSRM (Open Source Routing Machine) is a routing engine designed to run 
on OpenStreetMap data.

There is a public instance of the engine, a demo server. This server 
has limitations 
(https://github.com/Project-OSRM/osrm-backend/wiki/Demo-server) like 
the number of requests/minute, or in your case the maximum size of a 
requested distance matrix (10000, meaning 100 origines x 100 
destinations).  As they say :"he demo server usage is restricted to 
reasonable, non-commercial use-cases. We provide no guarantees wrt. 
uptime, latency, or data updates."

A solution is to run your own instance of the server to get rid of 
these limitations. The prefered and simplest way to run an instance is 
to use a Docker container 
(https://github.com/Project-OSRM/osrm-backend#quick-start).
When launching the Docker you'll have to set a large value for the 
--max-table-size parameter. Something like:
docker run -t -i -p 5000:5000 -v "${PWD}:/data" osrm/osrm-backend 
osrm-routed --algorithm mld --max-table-size 9000000 
/data/berlin-latest.osrm

The osrm R package is an interface between R and OSRM. The default 
server used by the package is the OSRM demo server. But you can change 
the default server with :
options(osrm.server = "http://0.0.0.0:5000/", osrm.profile = "driving")

Cheers,

Timoth?e



	[[alternative HTML version deleted]]


From m@d|@z| @end|ng |rom gm@||@com  Mon Jun 24 11:00:59 2019
From: m@d|@z| @end|ng |rom gm@||@com (Andres Diaz Loaiza)
Date: Mon, 24 Jun 2019 11:00:59 +0200
Subject: [R-sig-Geo] 
 [FORGED] Create a Spatial Weight Matrix based on road distance
In-Reply-To: <alpine.LFD.2.21.1906240916340.31909@reclus.nhh.no>
References: <CAFvJtoFemxph=u+ewBra6ebHLzaOC=49r3WFB6sJ5N7Zxs4m_Q@mail.gmail.com>
 <49e352fb-6742-86d6-bd7e-571088a0b3eb@auckland.ac.nz>
 <MEAPR01MB32216AB3C4EFE314DFCA2041A4E70@MEAPR01MB3221.ausprd01.prod.outlook.com>
 <CAMXOh=1Y48St-XD9vYJDmarHo7ticE89CdKFUpfCFCAo7K3MpA@mail.gmail.com>
 <CAFvJtoEzyk38wyZhdKWffunV8V_xBYweb2Jtg7-ksDgkHuV88g@mail.gmail.com>
 <alpine.LFD.2.21.1906240916340.31909@reclus.nhh.no>
Message-ID: <CAMXOh=3xt1=70pugtmA4kj_Gb=_hUqQD_twCn1R=gf23r8a9wg@mail.gmail.com>

Dear Rolando,


As previous members of the list asked you, it will be nice if you can
provide a reproducible example. Something like Roger has just done (with
command lines), but including your original data. In that way is always
easier to provide help.

 With the command: osrmTable, you are going to obtain the travel time
between points of your domain. In this case, I assume are the centroids of
your polygons. But no distances (what you were talking about). Since the
OSRM is only an interface, it only allows you to perform some few
calculations (since the algorithm to perform these calculations is on the
same web page). That is probably the reason why you are having this error
(I already warn you about this). If you have massive calculations, then I
will recommend you to download the app directly and run it on your
computer.

To get the distance in the manual says you should put as an argument the
distance, something like:

dists <- osrmTable(loc = muns13, measure = "distance")

You have to think this app is an emulator of google maps, that can give you
the shortest path and travel times according to different travel options,
although their primary goal is to cartography all
roads/ways/channels/railways etc., and make them freely available. please
visit
http://project-osrm.org/  (for the engine) and
https://www.openstreetmap.org/
<https://www.openstreetmap.org/#map=12/52.1710/5.2956> for the cartography.

 Andres D.
TU-Delft
Associate Researcher

El lun., 24 jun. 2019 a las 9:58, Roger Bivand (<Roger.Bivand at nhh.no>)
escribi?:

> On Mon, 24 Jun 2019, Rolando Valdez wrote:
>
> > Dear Andres,
> >
> > I could follow an example provided with the package, it was a little bit
> > simple, however, I got this message:
> >
> >> dists <- osrmTable(loc = muns13, measure = "duration")
> > The OSRM server returned an error:
> > Error: The public OSRM API does not allow results with a number of
> > durations
> > higher than 10000. Ask for fewer durations or use your own server and set
> > its
> > --max-table-size option.
> >
> > My sample size is 2,457
>
> Were you asking for the whole nx(n-1)/2 set of durations in one run? You
> see that the API limits the number of interactions (possibly by time and
> by unique IP number). So you need to reduce the number of queries. If you
> are going to impose a distance threshold anyway, you can do that using the
> Great Circle (not Euclidean) distances between your geographical
> coordinates and dnearneigh(), and step through the nb list object with
> src= being the data frame of the observation coordinates, and dest= the
> data frame of the neighbours' coordinates.
>
> library(sf)
> nc <- st_read(system.file("shapes/sids.shp", package="spData")[1],
> quiet=TRUE)
> st_crs(nc) <- "+proj=longlat +datum=NAD27"
> nc1 <- st_transform(nc, 32019)
> nc2 <- st_centroid(nc1, of_largest_polygon=TRUE)
> nc3 <- st_transform(nc2, 4326)
> crds <- st_coordinates(st_geometry(nc3))
> df <- data.frame(id=nc3$FIPSNO, long=crds[,1], lat=crds[,2])
> library(spdep)
> nb <- dnearneigh(crds, 0, 50, longlat=TRUE)
> library(osrm)
> res <- vector(mode="list", length=nrow(df))
> for (i in seq(along=res)) res[[i]] <- osrmTable(src=df[i,],
>   dst=df[nb[[i]],], measure = "duration")
> res1 <- lapply(res, function(x) 10/x$duration)
> lw <- nb2listw(nb, glist=res1, style="B")
>
> gives general spatial weights based on 10/# minutes travel time between
> county centroids (centroids calculated from projected coordinates), for
> county centroids closer than 50 km measured by Great Circle.
>
> In your case, you may need to split the for() loop into portions of
> cumsum(card(nb)) of less than the limit. If durations are symmetric,
> you could also halve the query count by taking only neighbour ids > i,
> but you'd have to fold them back afterwards. You also wanted to categorise
> the durations into 0,1, which you could do with lapply() instead of using
> inverse durations.
>
> Hope this helps,
>
> Roger
>
> >
> > El vie., 21 de jun. de 2019 a la(s) 02:53, Andres Diaz Loaiza (
> > madiazl at gmail.com) escribi?:
> >
> >> Dear Rolando,
> >>
> >> The advantage of using Open Street Maps engine is that you can give the
> >> travel option. This means you can select whether are you traveling by
> bike,
> >> car or walking. The previous approach didn't consider this topic. For
> this,
> >> you should have added a vector layer depending on your position of the
> >> street you can take (or not). Open Street Maps project allow you two
> >> options: a service in which you give your current position, the position
> >> you want to reach and your transport method (giving you back the fastest
> >> route). Or the option to download the engine/algorithm compile by
> yourself
> >> (if I am not wrong is made in C or python) and then you can make your
> own
> >> calculation at your own computer. For the first option, the package
> OSRM is
> >> an interface in which send a request to the OSM web page and wait for an
> >> answer. With this method, you can send a couple of request at the same
> time
> >> but no to many (you should read the manual for this). Of course, also
> will
> >> depend on whether the OSM server is down or not (or busy).
> >>
> >> I have to say that I used some years ago this app and nowadays I know
> that
> >> for some cities OSM has more streets reported than the same google maps.
> >> Also is an open project and they let you download their data for free,
> >> contrary to what google maps do.
> >>
> >> All the best,
> >>
> >>
> >> Andres
> >>
> >> El vie., 21 jun. 2019 a las 4:30, Adrian Baddeley (<
> >> adrian.baddeley at curtin.edu.au>) escribi?:
> >>
> >>> Rather than converting an object of class 'SpatialLines' or
> >>> 'SpatialLinesDataFrame' to the spatstat class 'psp' and then
> converting it
> >>> to the spatstat class 'linnet', it is safer and more efficient to
> convert
> >>> the SpatialLines* object directly to class linnet using
> >>> as.linnet.SpatialLinesDataFrame() from the package 'maptools'.
> >>>
> >>>
> >>> Prof Adrian Baddeley DSc FAA
> >>>
> >>> John Curtin Distinguished Professor
> >>>
> >>> Department of Mathematics and Statistics
> >>>
> >>> Curtin University, Perth, Western Australia
> >>>
> >>>
> >>> ________________________________
> >>> From: Rolf Turner <r.turner at auckland.ac.nz>
> >>> Sent: Friday, 21 June 2019 10:08 AM
> >>> To: Rolando Valdez
> >>> Cc: r-sig-geo at r-project.org; Adrian Baddeley; Ege Rubak
> >>> Subject: Re: [FORGED] [R-sig-Geo] Create a Spatial Weight Matrix based
> on
> >>> road distance
> >>>
> >>>
> >>> On 21/06/19 12:26 PM, Rolando Valdez wrote:
> >>>
> >>>> Dear community,
> >>>>
> >>>> Is there any way to create a spatial weight matrix based on road
> >>> distance?
> >>>> I am trying to use the road distance between two points instead of
> >>>> euclidean distance.
> >>>>
> >>>> I've seen that there is a package named osrm. Can anyone give some
> >>> advice?
> >>>
> >>> I don't know anything about "osrm".  Calculating "road distances" can
> be
> >>> done in the spatstat package reasonably easily, if you take the trouble
> >>> to represent your collection of roads as a "linnet" object.
> >>>
> >>> Given that you have done so, suppose that your linnet object is "L" and
> >>> that you have vectors "x" and "y" specifying the points on L (i.e. on
> >>> your roads) between which you want to know the distances.
> >>>
> >>> Do:
> >>>
> >>>      X    <- lpp(data.frame(x=x,y=y),L)
> >>>      dMat <- pairdist(X)
> >>>
> >>> The object "dMat" is a (symmetric) square matrix; dMat[i,j] is the
> >>> distance between point i and point j.  (Of course the diagonal entries
> >>> are all 0.)
> >>>
> >>> If your collection of roads is specified by means of a shapefile,
> >>> vignette("shapefiles") will tell you how to turn this collection into a
> >>> "psp" ("planar segment pattern") object; the function (method)
> >>> as.linnet.psp() can then be used to turn the "psp" object into a
> >>> "linnet" object.
> >>>
> >>> HTH
> >>>
> >>> cheers,
> >>>
> >>> Rolf Turner
> >>>
> >>> --
> >>> Honorary Research Fellow
> >>> Department of Statistics
> >>> University of Auckland
> >>> Phone: +64-9-373-7599 ext. 88276
> >>>
> >>>         [[alternative HTML version deleted]]
> >>>
> >>> _______________________________________________
> >>> R-sig-Geo mailing list
> >>> R-sig-Geo at r-project.org
> >>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >>>
> >>
> >>
> >> --
> >> Andr?s D.
> >>
> >
> >
> >
>
> --
> Roger Bivand
> Department of Economics, Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
> https://orcid.org/0000-0003-2392-6140
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en



-- 
Andr?s D.

	[[alternative HTML version deleted]]


From @@r@@h@er| @end|ng |rom y@hoo@com  Tue Jun 25 03:32:30 2019
From: @@r@@h@er| @end|ng |rom y@hoo@com (Sara Shaeri)
Date: Tue, 25 Jun 2019 01:32:30 +0000 (UTC)
Subject: [R-sig-Geo] slow computation progress for calc function
References: <737092015.919848.1561426350050.ref@mail.yahoo.com>
Message-ID: <737092015.919848.1561426350050@mail.yahoo.com>

Dear community,
I?m trying to use the Calc function in a raster stack (8000 binary format rasters). Each raster covers 2,421,090 cells, as such, I?m using parallel coding to make the most of the available cores for this computation, however, this process is extremely slow on a 36 core and 76 Gb RAM. How could I speed up the calculations? This is the code I?m using: 

beginCluster(30)

interflood <- clusterR(all_predictions, calc, args=list(function(x){y <- rle(as.numeric(x));return(max( y$lengths[y$values == 0]))}))

endCluster()


RegardsSara


-------------------------
Sara Shaeri KarimiPhD Candidate, Department of Environmental SciencesFaculty of Science and EngineeringMacquarie University, NSW 2109 Australia?
Researchgate
Linkedin 






	[[alternative HTML version deleted]]


From b|@|ev||@t @end|ng |rom gm@||@com  Tue Jun 25 08:32:56 2019
From: b|@|ev||@t @end|ng |rom gm@||@com (=?UTF-8?Q?Bede-Fazekas_=c3=81kos?=)
Date: Tue, 25 Jun 2019 08:32:56 +0200
Subject: [R-sig-Geo] slow computation progress for calc function
In-Reply-To: <737092015.919848.1561426350050@mail.yahoo.com>
References: <737092015.919848.1561426350050.ref@mail.yahoo.com>
 <737092015.919848.1561426350050@mail.yahoo.com>
Message-ID: <676ce0e2-9515-7275-e4a2-86eca3382e35@gmail.com>

Dear Sara,

it is faster if you first convert the integer vector to logical, and 
then run rle().

set.seed(12345)
random_sample <- sample.int(n = 10, size = 1e5, replace = TRUE) - 1

original <- function(x){
 ??? y <- rle(x)
 ??? return(max(y$lengths[y$values == 0]))
}

faster <- function(x){
 ??? y <- rle(x == 0)
 ??? return(max(y$lengths[y$values]))
}

original(random_sample) == faster(random_sample)

library(microbenchmark)
microbenchmark(
 ??? original(random_sample),
 ??? faster(random_sample)
)

Hence, this may be faster:
interflood <- clusterR(all_predictions, calc, args=list(function(x){y <- 
rle(as.numeric(x) == 0; return(max(y$lengths[y$values]))}))

HTH,
?kos Bede-Fazekas
Hungarian Academy of Sciences

2019.06.25. 3:32 keltez?ssel, Sara Shaeri via R-sig-Geo ?rta:
> Dear community,
> I?m trying to use the Calc function in a raster stack (8000 binary format rasters). Each raster covers 2,421,090 cells, as such, I?m using parallel coding to make the most of the available cores for this computation, however, this process is extremely slow on a 36 core and 76 Gb RAM. How could I speed up the calculations? This is the code I?m using:
>
> beginCluster(30)
>
> interflood <- clusterR(all_predictions, calc, args=list(function(x){y <- rle(as.numeric(x));return(max( y$lengths[y$values == 0]))}))
>
> endCluster()
>
>
> RegardsSara
>
>
> -------------------------
> Sara Shaeri KarimiPhD Candidate, Department of Environmental SciencesFaculty of Science and EngineeringMacquarie University, NSW 2109 Australia
> Researchgate
> Linkedin
>
>
>
>
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From @@r@@h@er| @end|ng |rom y@hoo@com  Tue Jun 25 09:55:59 2019
From: @@r@@h@er| @end|ng |rom y@hoo@com (Sara Shaeri)
Date: Tue, 25 Jun 2019 07:55:59 +0000 (UTC)
Subject: [R-sig-Geo] slow computation progress for calc function
In-Reply-To: <676ce0e2-9515-7275-e4a2-86eca3382e35@gmail.com>
References: <737092015.919848.1561426350050.ref@mail.yahoo.com>
 <737092015.919848.1561426350050@mail.yahoo.com>
 <676ce0e2-9515-7275-e4a2-86eca3382e35@gmail.com>
Message-ID: <811150816.950977.1561449359564@mail.yahoo.com>

Dear ?kos, 
I tried it on a small partition of my data. However, the processing time is the same :(. Any other suggestion? 

-------------------------
Sara Shaeri KarimiPhD Candidate, Department of Environmental SciencesFaculty of Science and EngineeringMacquarie University, NSW 2109 Australia?
Researchgate
Linkedin 





 

    On Tuesday, June 25, 2019, 4:33:34 PM GMT+10, Bede-Fazekas ?kos <bfalevlist at gmail.com> wrote:  
 
 Dear Sara,

it is faster if you first convert the integer vector to logical, and 
then run rle().

set.seed(12345)
random_sample <- sample.int(n = 10, size = 1e5, replace = TRUE) - 1

original <- function(x){
 ??? y <- rle(x)
 ??? return(max(y$lengths[y$values == 0]))
}

faster <- function(x){
 ??? y <- rle(x == 0)
 ??? return(max(y$lengths[y$values]))
}

original(random_sample) == faster(random_sample)

library(microbenchmark)
microbenchmark(
 ??? original(random_sample),
 ??? faster(random_sample)
)

Hence, this may be faster:
interflood <- clusterR(all_predictions, calc, args=list(function(x){y <- 
rle(as.numeric(x) == 0; return(max(y$lengths[y$values]))}))

HTH,
?kos Bede-Fazekas
Hungarian Academy of Sciences

2019.06.25. 3:32 keltez?ssel, Sara Shaeri via R-sig-Geo ?rta:
> Dear community,
> I?m trying to use the Calc function in a raster stack (8000 binary format rasters). Each raster covers 2,421,090 cells, as such, I?m using parallel coding to make the most of the available cores for this computation, however, this process is extremely slow on a 36 core and 76 Gb RAM. How could I speed up the calculations? This is the code I?m using:
>
> beginCluster(30)
>
> interflood <- clusterR(all_predictions, calc, args=list(function(x){y <- rle(as.numeric(x));return(max( y$lengths[y$values == 0]))}))
>
> endCluster()
>
>
> RegardsSara
>
>
> -------------------------
> Sara Shaeri KarimiPhD Candidate, Department of Environmental SciencesFaculty of Science and EngineeringMacquarie University, NSW 2109 Australia
> Researchgate
> Linkedin
>
>
>
>
>
>
> ??? [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo
  
	[[alternative HTML version deleted]]


From b|@|ev||@t @end|ng |rom gm@||@com  Tue Jun 25 10:03:44 2019
From: b|@|ev||@t @end|ng |rom gm@||@com (=?UTF-8?Q?Bede-Fazekas_=c3=81kos?=)
Date: Tue, 25 Jun 2019 10:03:44 +0200
Subject: [R-sig-Geo] slow computation progress for calc function
In-Reply-To: <811150816.950977.1561449359564@mail.yahoo.com>
References: <737092015.919848.1561426350050.ref@mail.yahoo.com>
 <737092015.919848.1561426350050@mail.yahoo.com>
 <676ce0e2-9515-7275-e4a2-86eca3382e35@gmail.com>
 <811150816.950977.1561449359564@mail.yahoo.com>
Message-ID: <27ce5bb2-6b50-527f-ab8d-f83d2e01c511@gmail.com>

Dear Sara,
Hm.. so sorry, I have no more idea...
?kos

2019.06.25. 9:55 keltez?ssel, Sara Shaeri ?rta:
> Dear ?kos,
> I tried it on a small partition of my data. However, the processing 
> time is the same :(. Any other suggestion?
>
> -------------------------
> *Sara Shaeri Karimi*
> PhD Candidate, Department of Environmental Sciences
> Faculty of Science and Engineering
> Macquarie University, NSW 2109 Australia
> /Researchgate <https://www.researchgate.net/profile/Sara_Shaeri>
> /
> /Linkedin <https://www.linkedin.com/in/sara-shaeri-karimi-94351433>/
>
>
>
>
>
>
>
>
> On Tuesday, June 25, 2019, 4:33:34 PM GMT+10, Bede-Fazekas ?kos 
> <bfalevlist at gmail.com> wrote:
>
>
> Dear Sara,
>
> it is faster if you first convert the integer vector to logical, and
> then run rle().
>
> set.seed(12345)
> random_sample <- sample.int(n = 10, size = 1e5, replace = TRUE) - 1
>
> original <- function(x){
> ??? y <- rle(x)
> ??? return(max(y$lengths[y$values == 0]))
> }
>
> faster <- function(x){
> ??? y <- rle(x == 0)
> ??? return(max(y$lengths[y$values]))
> }
>
> original(random_sample) == faster(random_sample)
>
> library(microbenchmark)
> microbenchmark(
> ??? original(random_sample),
> ??? faster(random_sample)
> )
>
> Hence, this may be faster:
> interflood <- clusterR(all_predictions, calc, args=list(function(x){y <-
> rle(as.numeric(x) == 0; return(max(y$lengths[y$values]))}))
>
> HTH,
> ?kos Bede-Fazekas
> Hungarian Academy of Sciences
>
> 2019.06.25. 3:32 keltez?ssel, Sara Shaeri via R-sig-Geo ?rta:
> > Dear community,
> > I?m trying to use the Calc function in a raster stack (8000 binary 
> format rasters). Each raster covers 2,421,090 cells, as such, I?m 
> using parallel coding to make the most of the available cores for this 
> computation, however, this process is extremely slow on a 36 core and 
> 76 Gb RAM. How could I speed up the calculations? This is the code I?m 
> using:
> >
> > beginCluster(30)
> >
> > interflood <- clusterR(all_predictions, calc, 
> args=list(function(x){y <- rle(as.numeric(x));return(max( 
> y$lengths[y$values == 0]))}))
> >
> > endCluster()
> >
> >
> > RegardsSara
> >
> >
> > -------------------------
> > Sara Shaeri KarimiPhD Candidate, Department of Environmental 
> SciencesFaculty of Science and EngineeringMacquarie University, NSW 
> 2109 Australia
> > Researchgate
> > Linkedin
>
> >
> >
> >
> >
> >
> >
> > ??? [[alternative HTML version deleted]]
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


	[[alternative HTML version deleted]]


From @@r@@h@er| @end|ng |rom y@hoo@com  Tue Jun 25 13:22:58 2019
From: @@r@@h@er| @end|ng |rom y@hoo@com (Sara Shaeri)
Date: Tue, 25 Jun 2019 11:22:58 +0000 (UTC)
Subject: [R-sig-Geo] slow computation progress for calc function
In-Reply-To: <CANVKczPrY-kp8ii5dEgjZfiqR-D1fSAbGQxUcGYw1SK5DEaS1w@mail.gmail.com>
References: <737092015.919848.1561426350050.ref@mail.yahoo.com>
 <737092015.919848.1561426350050@mail.yahoo.com>
 <CANVKczPrY-kp8ii5dEgjZfiqR-D1fSAbGQxUcGYw1SK5DEaS1w@mail.gmail.com>
Message-ID: <1378622265.1010438.1561461778604@mail.yahoo.com>

Hi Barry,Yes all of them are running at near 100% usage.

Sara





 

    On Tuesday, June 25, 2019, 9:17:05 PM GMT+10, Barry Rowlingson <b.rowlingson at lancaster.ac.uk> wrote:  
 
 

On Tue, Jun 25, 2019 at 2:32 AM Sara Shaeri via R-sig-Geo <r-sig-geo at r-project.org> wrote:


interflood <- clusterR(all_predictions, calc, args=list(function(x){y <- rle(as.numeric(x));return(max( y$lengths[y$values == 0]))}))



If I understand this correctly you are trying to find the length of the longest run of zeroes in each pixel stack?
You need to find out where the bottleneck is - are all your beginCluster(30) CPU cores running at near 100% usage? If not then there's a memory or disk bottleneck which would need a different optimisation strategy than trying to find something to optimise the CPU usage.
Barry

?


? ? ? ? [[alternative HTML version deleted]]

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo

  
	[[alternative HTML version deleted]]


From Roger@B|v@nd @end|ng |rom nhh@no  Tue Jun 25 13:44:39 2019
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Tue, 25 Jun 2019 13:44:39 +0200
Subject: [R-sig-Geo] slow computation progress for calc function
In-Reply-To: <1378622265.1010438.1561461778604@mail.yahoo.com>
References: <737092015.919848.1561426350050.ref@mail.yahoo.com>
 <737092015.919848.1561426350050@mail.yahoo.com>
 <CANVKczPrY-kp8ii5dEgjZfiqR-D1fSAbGQxUcGYw1SK5DEaS1w@mail.gmail.com>
 <1378622265.1010438.1561461778604@mail.yahoo.com>
Message-ID: <alpine.LFD.2.21.1906251328200.11033@reclus.nhh.no>

On Tue, 25 Jun 2019, Sara Shaeri via R-sig-Geo wrote:

> Hi Barry,Yes all of them are running at near 100% usage.
>
> Sara
>
>    On Tuesday, June 25, 2019, 9:17:05 PM GMT+10, Barry Rowlingson
>    <b.rowlingson at lancaster.ac.uk> wrote:
>
> On Tue, Jun 25, 2019 at 2:32 AM Sara Shaeri via R-sig-Geo 
> <r-sig-geo at r-project.org> wrote:
>
> interflood <- clusterR(all_predictions, calc, args=list(function(x){y <- 
> rle(as.numeric(x));return(max( y$lengths[y$values == 0]))}))
>
> If I understand this correctly you are trying to find the length of the 
> longest run of zeroes in each pixel stack?

This is how I read this too, finding the longest run of zeroes (no flood?) 
among 8000 layers. This means that each of the raster cells is 
independent. I assume that all_predictions is not trying to fit into 
memory (how many copies across the cluster?). I believe GRASS reads and 
writes by default by raster row, so would just iterate across this row by 
row.

I suspect that the clusterR() framework is not what you need, this should 
be feasible on a laptop (data 2M x 8K x INT4 ~ 64G) by stepping through in 
blocks, shouldn't it? One row is max 64M? Read a row for the whole stack 
updating the rle's on read, store one row until all layers processed, 
write the row as INT4? Try GRASS?

Just thinking aloud, the underlying problem is needing to slice cell-wise 
through the array.

Roger

> You need to find out where 
> the bottleneck is - are all your beginCluster(30) CPU cores running at 
> near 100% usage? If not then there's a memory or disk bottleneck which 
> would need a different optimisation strategy than trying to find 
> something to optimise the CPU usage. Barry
>
>
> ? ? ? ? [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

From @tephen@@tew@rt85 @end|ng |rom gm@||@com  Tue Jun 25 15:19:07 2019
From: @tephen@@tew@rt85 @end|ng |rom gm@||@com (Stephen Stewart)
Date: Tue, 25 Jun 2019 23:19:07 +1000
Subject: [R-sig-Geo] slow computation progress for calc function
In-Reply-To: <alpine.LFD.2.21.1906251328200.11033@reclus.nhh.no>
References: <737092015.919848.1561426350050.ref@mail.yahoo.com>
 <737092015.919848.1561426350050@mail.yahoo.com>
 <CANVKczPrY-kp8ii5dEgjZfiqR-D1fSAbGQxUcGYw1SK5DEaS1w@mail.gmail.com>
 <1378622265.1010438.1561461778604@mail.yahoo.com>
 <alpine.LFD.2.21.1906251328200.11033@reclus.nhh.no>
Message-ID: <CAJefdj7gye-t_TS4SV6FK+fW9_yMV6Z2u-s78tnbjyceiL7KMA@mail.gmail.com>

I have used the slice approach with success using complex functions and
multiple outputs on 12,000+ layers (3,000 X 3,000 cells approx) loaded into
chunked NetCDF files on a desktop machine, so this should work.

This was all done using the ncdf4 and raster packages. There is some work
involved in setting up the input / output NetCDF files though. The trick
was to select a chunking strategy that minimises row-wise read times
through the time series, then extract slices for each row into a matrix
using the ncdf4 package and use apply() with your custom functions.

The majority of overhead will be in read / write if you're using rle with
one output. I suspect clusteR / calc will be a lot faster on a chunked
NetCDF as well... I've seen some huge speed improvements before but it was
a special case with fewer layers and more computationally expensively
functions.

In any case, stacking 8,000 separate rasters is going to be super slow for
processing in R unless you use something like NetCDF.



On Tue., 25 Jun. 2019, 9:45 pm Roger Bivand, <Roger.Bivand at nhh.no> wrote:

> On Tue, 25 Jun 2019, Sara Shaeri via R-sig-Geo wrote:
>
> > Hi Barry,Yes all of them are running at near 100% usage.
> >
> > Sara
> >
> >    On Tuesday, June 25, 2019, 9:17:05 PM GMT+10, Barry Rowlingson
> >    <b.rowlingson at lancaster.ac.uk> wrote:
> >
> > On Tue, Jun 25, 2019 at 2:32 AM Sara Shaeri via R-sig-Geo
> > <r-sig-geo at r-project.org> wrote:
> >
> > interflood <- clusterR(all_predictions, calc, args=list(function(x){y <-
> > rle(as.numeric(x));return(max( y$lengths[y$values == 0]))}))
> >
> > If I understand this correctly you are trying to find the length of the
> > longest run of zeroes in each pixel stack?
>
> This is how I read this too, finding the longest run of zeroes (no flood?)
> among 8000 layers. This means that each of the raster cells is
> independent. I assume that all_predictions is not trying to fit into
> memory (how many copies across the cluster?). I believe GRASS reads and
> writes by default by raster row, so would just iterate across this row by
> row.
>
> I suspect that the clusterR() framework is not what you need, this should
> be feasible on a laptop (data 2M x 8K x INT4 ~ 64G) by stepping through in
> blocks, shouldn't it? One row is max 64M? Read a row for the whole stack
> updating the rle's on read, store one row until all layers processed,
> write the row as INT4? Try GRASS?
>
> Just thinking aloud, the underlying problem is needing to slice cell-wise
> through the array.
>
> Roger
>
> > You need to find out where
> > the bottleneck is - are all your beginCluster(30) CPU cores running at
> > near 100% usage? If not then there's a memory or disk bottleneck which
> > would need a different optimisation strategy than trying to find
> > something to optimise the CPU usage. Barry
> >
> >
> >         [[alternative HTML version deleted]]
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
> >
> >       [[alternative HTML version deleted]]
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
>
> --
> Roger Bivand
> Department of Economics, Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
> https://orcid.org/0000-0003-2392-6140
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From |ove|y||tt|ed@|@|e@ @end|ng |rom gm@||@com  Tue Jun 25 16:28:16 2019
From: |ove|y||tt|ed@|@|e@ @end|ng |rom gm@||@com (Jiawen Ng)
Date: Tue, 25 Jun 2019 15:28:16 +0100
Subject: [R-sig-Geo] Error in predict.sarlm (spatial reg package): Not yet
 able to subset general weights lists
Message-ID: <CAHz1c-WagR684-zunLH7g0wH6HjPFFggxL05=hWe+gBi4iUn_Q@mail.gmail.com>

Dear Roger,

I have an inverse distance matrix that has been converted to listw object
via mat2listw function.

To predict out-of-sample data, I made 2 listw objects -- one that is based
upon the training data -- this is used as the listw input for training the
model (i called this train_listw) and the other is based on all data (both
train and test) that is used as the listw input for predicting new data (i
called this all_listw).

Here is the code:

model <-  spatialreg::lagsarlm(rest_formula, data=train, train_listw)
model_pred <- spatialreg::predict.sarlm(model, test, all_listw)

Here is the function that I used to create the inverse distance matrix and
the listw object:

get_inv_dist_nb <- function(full_df){
  dist_matrix <- as.matrix(dist(cbind(full_df$Longitude,full_df$Latitude)))
  dist_matrix_inv <- 1/dist_matrix
  diag(dist_matrix_inv) <- 0
  mylistw <- mat2listw(dist_matrix_inv, style="W")
  return (mylistw)
}



The error i receive is:

Error in subset.listw(listw, (attr(listw, "region.id") %in% region.id),  :
  Not yet able to subset general weights lists


>From a previous post that you have answered, you mentioned that this is
because some observations are not complete. May I just clarify what do you
mean by observations here? the listw object? I have checked both my
all_listw and train_listw objects -- they do not have missing neighbours.
The function above that I wrote to calculate the inverse distance matrix
does not allow for missing values too. There is also no missing values upon
checking my training and testing datasets.


Please advise, thank you so much!

	[[alternative HTML version deleted]]


From Roger@B|v@nd @end|ng |rom nhh@no  Tue Jun 25 17:31:30 2019
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Tue, 25 Jun 2019 17:31:30 +0200
Subject: [R-sig-Geo] 
 Error in predict.sarlm (spatial reg package): Not yet
 able to subset general weights lists
In-Reply-To: <CAHz1c-WagR684-zunLH7g0wH6HjPFFggxL05=hWe+gBi4iUn_Q@mail.gmail.com>
References: <CAHz1c-WagR684-zunLH7g0wH6HjPFFggxL05=hWe+gBi4iUn_Q@mail.gmail.com>
Message-ID: <alpine.LFD.2.21.1906251725340.11973@reclus.nhh.no>

On Tue, 25 Jun 2019, Jiawen Ng wrote:

> Dear Roger,
>
> I have an inverse distance matrix that has been converted to listw object
> via mat2listw function.
>
> To predict out-of-sample data, I made 2 listw objects -- one that is based
> upon the training data -- this is used as the listw input for training the
> model (i called this train_listw) and the other is based on all data (both
> train and test) that is used as the listw input for predicting new data (i
> called this all_listw).
>
> Here is the code:
>
> model <-  spatialreg::lagsarlm(rest_formula, data=train, train_listw)
> model_pred <- spatialreg::predict.sarlm(model, test, all_listw)
>
> Here is the function that I used to create the inverse distance matrix and
> the listw object:
>
> get_inv_dist_nb <- function(full_df){
>  dist_matrix <- as.matrix(dist(cbind(full_df$Longitude,full_df$Latitude)))
>  dist_matrix_inv <- 1/dist_matrix
>  diag(dist_matrix_inv) <- 0
>  mylistw <- mat2listw(dist_matrix_inv, style="W")
>  return (mylistw)
> }
>
>
>
> The error i receive is:
>
> Error in subset.listw(listw, (attr(listw, "region.id") %in% region.id),  :
>  Not yet able to subset general weights lists
>

That seems self-explanatory. You and anyone else interested are very 
welcome to contribute. There may be ways of flagging general weights as 
subsettable under a given weights scheme, but some are not subsettable, 
hence the absence of support.

It might also be possible to re-write all the internals as sparse matrices 
(IDW are often in practice dense, which is a poor weighting scheme for 
an SAR/CAR/MRF approach anyway). But that needs coding.

Ideas welcome. Until then, don't use IDW or other general weights if you 
want to use prediction methods.

Roger

>
> From a previous post that you have answered, you mentioned that this is
> because some observations are not complete. May I just clarify what do you
> mean by observations here? the listw object? I have checked both my
> all_listw and train_listw objects -- they do not have missing neighbours.
> The function above that I wrote to calculate the inverse distance matrix
> does not allow for missing values too. There is also no missing values upon
> checking my training and testing datasets.
>
>
> Please advise, thank you so much!
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en


From rv@|dezr @end|ng |rom gm@||@com  Wed Jun 26 20:44:13 2019
From: rv@|dezr @end|ng |rom gm@||@com (Rolando Valdez)
Date: Wed, 26 Jun 2019 11:44:13 -0700
Subject: [R-sig-Geo] 
 [FORGED] Create a Spatial Weight Matrix based on road distance
In-Reply-To: <alpine.LFD.2.21.1906240916340.31909@reclus.nhh.no>
References: <CAFvJtoFemxph=u+ewBra6ebHLzaOC=49r3WFB6sJ5N7Zxs4m_Q@mail.gmail.com>
 <49e352fb-6742-86d6-bd7e-571088a0b3eb@auckland.ac.nz>
 <MEAPR01MB32216AB3C4EFE314DFCA2041A4E70@MEAPR01MB3221.ausprd01.prod.outlook.com>
 <CAMXOh=1Y48St-XD9vYJDmarHo7ticE89CdKFUpfCFCAo7K3MpA@mail.gmail.com>
 <CAFvJtoEzyk38wyZhdKWffunV8V_xBYweb2Jtg7-ksDgkHuV88g@mail.gmail.com>
 <alpine.LFD.2.21.1906240916340.31909@reclus.nhh.no>
Message-ID: <CAFvJtoGXw+3qTwYd_h67iBpd3AN9=xXfbY-RTxVLVOpYRznYgQ@mail.gmail.com>

Dear Prof. Roger, many thanks for your help, I am working on.

I have a doubt: Which is the differece between Great Circle and Euclidean
Distance?

Thanks

El lun., 24 de jun. de 2019 a la(s) 00:58, Roger Bivand (Roger.Bivand at nhh.no)
escribi?:

> On Mon, 24 Jun 2019, Rolando Valdez wrote:
>
> > Dear Andres,
> >
> > I could follow an example provided with the package, it was a little bit
> > simple, however, I got this message:
> >
> >> dists <- osrmTable(loc = muns13, measure = "duration")
> > The OSRM server returned an error:
> > Error: The public OSRM API does not allow results with a number of
> > durations
> > higher than 10000. Ask for fewer durations or use your own server and set
> > its
> > --max-table-size option.
> >
> > My sample size is 2,457
>
> Were you asking for the whole nx(n-1)/2 set of durations in one run? You
> see that the API limits the number of interactions (possibly by time and
> by unique IP number). So you need to reduce the number of queries. If you
> are going to impose a distance threshold anyway, you can do that using the
> Great Circle (not Euclidean) distances between your geographical
> coordinates and dnearneigh(), and step through the nb list object with
> src= being the data frame of the observation coordinates, and dest= the
> data frame of the neighbours' coordinates.
>
> library(sf)
> nc <- st_read(system.file("shapes/sids.shp", package="spData")[1],
> quiet=TRUE)
> st_crs(nc) <- "+proj=longlat +datum=NAD27"
> nc1 <- st_transform(nc, 32019)
> nc2 <- st_centroid(nc1, of_largest_polygon=TRUE)
> nc3 <- st_transform(nc2, 4326)
> crds <- st_coordinates(st_geometry(nc3))
> df <- data.frame(id=nc3$FIPSNO, long=crds[,1], lat=crds[,2])
> library(spdep)
> nb <- dnearneigh(crds, 0, 50, longlat=TRUE)
> library(osrm)
> res <- vector(mode="list", length=nrow(df))
> for (i in seq(along=res)) res[[i]] <- osrmTable(src=df[i,],
>   dst=df[nb[[i]],], measure = "duration")
> res1 <- lapply(res, function(x) 10/x$duration)
> lw <- nb2listw(nb, glist=res1, style="B")
>
> gives general spatial weights based on 10/# minutes travel time between
> county centroids (centroids calculated from projected coordinates), for
> county centroids closer than 50 km measured by Great Circle.
>
> In your case, you may need to split the for() loop into portions of
> cumsum(card(nb)) of less than the limit. If durations are symmetric,
> you could also halve the query count by taking only neighbour ids > i,
> but you'd have to fold them back afterwards. You also wanted to categorise
> the durations into 0,1, which you could do with lapply() instead of using
> inverse durations.
>
> Hope this helps,
>
> Roger
>
> >
> > El vie., 21 de jun. de 2019 a la(s) 02:53, Andres Diaz Loaiza (
> > madiazl at gmail.com) escribi?:
> >
> >> Dear Rolando,
> >>
> >> The advantage of using Open Street Maps engine is that you can give the
> >> travel option. This means you can select whether are you traveling by
> bike,
> >> car or walking. The previous approach didn't consider this topic. For
> this,
> >> you should have added a vector layer depending on your position of the
> >> street you can take (or not). Open Street Maps project allow you two
> >> options: a service in which you give your current position, the position
> >> you want to reach and your transport method (giving you back the fastest
> >> route). Or the option to download the engine/algorithm compile by
> yourself
> >> (if I am not wrong is made in C or python) and then you can make your
> own
> >> calculation at your own computer. For the first option, the package
> OSRM is
> >> an interface in which send a request to the OSM web page and wait for an
> >> answer. With this method, you can send a couple of request at the same
> time
> >> but no to many (you should read the manual for this). Of course, also
> will
> >> depend on whether the OSM server is down or not (or busy).
> >>
> >> I have to say that I used some years ago this app and nowadays I know
> that
> >> for some cities OSM has more streets reported than the same google maps.
> >> Also is an open project and they let you download their data for free,
> >> contrary to what google maps do.
> >>
> >> All the best,
> >>
> >>
> >> Andres
> >>
> >> El vie., 21 jun. 2019 a las 4:30, Adrian Baddeley (<
> >> adrian.baddeley at curtin.edu.au>) escribi?:
> >>
> >>> Rather than converting an object of class 'SpatialLines' or
> >>> 'SpatialLinesDataFrame' to the spatstat class 'psp' and then
> converting it
> >>> to the spatstat class 'linnet', it is safer and more efficient to
> convert
> >>> the SpatialLines* object directly to class linnet using
> >>> as.linnet.SpatialLinesDataFrame() from the package 'maptools'.
> >>>
> >>>
> >>> Prof Adrian Baddeley DSc FAA
> >>>
> >>> John Curtin Distinguished Professor
> >>>
> >>> Department of Mathematics and Statistics
> >>>
> >>> Curtin University, Perth, Western Australia
> >>>
> >>>
> >>> ________________________________
> >>> From: Rolf Turner <r.turner at auckland.ac.nz>
> >>> Sent: Friday, 21 June 2019 10:08 AM
> >>> To: Rolando Valdez
> >>> Cc: r-sig-geo at r-project.org; Adrian Baddeley; Ege Rubak
> >>> Subject: Re: [FORGED] [R-sig-Geo] Create a Spatial Weight Matrix based
> on
> >>> road distance
> >>>
> >>>
> >>> On 21/06/19 12:26 PM, Rolando Valdez wrote:
> >>>
> >>>> Dear community,
> >>>>
> >>>> Is there any way to create a spatial weight matrix based on road
> >>> distance?
> >>>> I am trying to use the road distance between two points instead of
> >>>> euclidean distance.
> >>>>
> >>>> I've seen that there is a package named osrm. Can anyone give some
> >>> advice?
> >>>
> >>> I don't know anything about "osrm".  Calculating "road distances" can
> be
> >>> done in the spatstat package reasonably easily, if you take the trouble
> >>> to represent your collection of roads as a "linnet" object.
> >>>
> >>> Given that you have done so, suppose that your linnet object is "L" and
> >>> that you have vectors "x" and "y" specifying the points on L (i.e. on
> >>> your roads) between which you want to know the distances.
> >>>
> >>> Do:
> >>>
> >>>      X    <- lpp(data.frame(x=x,y=y),L)
> >>>      dMat <- pairdist(X)
> >>>
> >>> The object "dMat" is a (symmetric) square matrix; dMat[i,j] is the
> >>> distance between point i and point j.  (Of course the diagonal entries
> >>> are all 0.)
> >>>
> >>> If your collection of roads is specified by means of a shapefile,
> >>> vignette("shapefiles") will tell you how to turn this collection into a
> >>> "psp" ("planar segment pattern") object; the function (method)
> >>> as.linnet.psp() can then be used to turn the "psp" object into a
> >>> "linnet" object.
> >>>
> >>> HTH
> >>>
> >>> cheers,
> >>>
> >>> Rolf Turner
> >>>
> >>> --
> >>> Honorary Research Fellow
> >>> Department of Statistics
> >>> University of Auckland
> >>> Phone: +64-9-373-7599 ext. 88276
> >>>
> >>>         [[alternative HTML version deleted]]
> >>>
> >>> _______________________________________________
> >>> R-sig-Geo mailing list
> >>> R-sig-Geo at r-project.org
> >>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >>>
> >>
> >>
> >> --
> >> Andr?s D.
> >>
> >
> >
> >
>
> --
> Roger Bivand
> Department of Economics, Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
> https://orcid.org/0000-0003-2392-6140
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en



-- 
Rol~

	[[alternative HTML version deleted]]


From @@|ov@|@berg @end|ng |rom gm@||@com  Thu Jun 27 03:24:43 2019
From: @@|ov@|@berg @end|ng |rom gm@||@com (Salo V)
Date: Wed, 26 Jun 2019 21:24:43 -0400
Subject: [R-sig-Geo] Ensuring compactness on territories created
Message-ID: <CA+AUPyGpaJUCGq_Scz+ugW8JP=F43PeJTyr5HbXR8g-vpKo8jw@mail.gmail.com>

Hi Everyone,



I am trying to create contiguous territories given polygon data (at the US
ZIP Code level) and need some help ensuring compactness of the territories
created.



I am using the SKATER algorithm implemented in the spdep package to achieve
this ? this is a graph partition algorithm on a minimum spanning tree.

I can use the lat / long as one of the variables and this algorithm will
try to minimize the variance of the variables passed (in this case lat /
long) for each territory therefore trying to force compactness in my
solution. The problem is that if the minimum spanning tree has very large
chains with vertices of degree = 2 then there is nothing you can do to
avoid non-compact territories.

This representation shows (--*--*--*--*--*--*--*--*) there is nothing you
can do to avoid ending with a territory in a very long straight line.



My question revolves around adjusting the tree created to avoid as much as
possible the creation of such large chains and favor the creation of a tree
(with slightly higher cost than the minimum spanning tree) but with less of
these chains of nodes with degree = 2.



Any advice on this will be highly appreciated.



Best,

Salomon

	[[alternative HTML version deleted]]


From rv@|dezr @end|ng |rom gm@||@com  Wed Jun 26 20:51:11 2019
From: rv@|dezr @end|ng |rom gm@||@com (Rolando Valdez)
Date: Wed, 26 Jun 2019 11:51:11 -0700
Subject: [R-sig-Geo] Error while performing Lagrange Multiplier test
 (bsktest)
Message-ID: <CAFvJtoEwT8BkA35rRNtd0peSeQA29CBpw9bxGw5i_6Zmja=JLA@mail.gmail.com>

Dear all:

I am trying to compute a Lagrange Multiplier test through the function
bsktest for panel data sets.

This is what I am doing:


library(rgdal)
library(spdep)
library(sf)
library(spatialreg)

spatialreg::set.ZeroPolicyOption(TRUE)
spdep::set.ZeroPolicyOption(TRUE)

shell.exec("
https://drive.google.com/open?id=1PHm5NX9IPoeo6vgv7Zb3VolNfOoApm6c&authuser=rvaldez35 at uabc.edu.mx&usp=drive_fs
")

headmuns <- readOGR(".", "head_muns_2013") #Reading shapefile with
localities
IDs <- row.names(headmuns)
wgs84 <- "+proj=longlat +ellps=WGS84"
headmunsWGS84 <- spTransform(headmuns, CRS(wgs84)) # Changing CRS
headmunsxy <-coordinates(headmunsWGS84)

#Creating a neighbor matrix with 20 km threshold distance
nb20 <- dnearneigh(headmunsxy, 0, 20, longlat = TRUE, row.names = IDs)
w20 <- nb2listw(nb20, style = "W", zero.policy = TRUE)

### The dataset

shell.exec("
https://drive.google.com/file/d/1aeeetHi1p6YbFiWRAmI7dGqDoqBnsdAx/view?usp=sharing
")

library(splm)
library(plm)
dbout <- read_dta("dbout.dta", package = "haven")
pdbout <- pdata.frame(dbout, index = c("geocode", "yr"))
spdbout <- pdbout[order(pdbout$yr),]
restmod <- ilny ~ ilnk + factor(yr)
bsktest(x = restmod, data = spdbout, listw = w20, test = "CLMlambda")

Then I get the next error:

Error in (WpsW) %*% q :
  Cholmod error 'X and/or Y have wrong dimensions' at file
../MatrixOps/cholmod_sdmult.c, line 90

-- 
Rol~

	[[alternative HTML version deleted]]


From yud @end|ng |rom m@||@montc|@|r@edu  Thu Jun 27 10:08:03 2019
From: yud @end|ng |rom m@||@montc|@|r@edu (Danlin Yu)
Date: Thu, 27 Jun 2019 16:08:03 +0800
Subject: [R-sig-Geo] 
 [FORGED] Create a Spatial Weight Matrix based on road distance
In-Reply-To: <CAFvJtoGXw+3qTwYd_h67iBpd3AN9=xXfbY-RTxVLVOpYRznYgQ@mail.gmail.com>
References: <CAFvJtoFemxph=u+ewBra6ebHLzaOC=49r3WFB6sJ5N7Zxs4m_Q@mail.gmail.com>
 <49e352fb-6742-86d6-bd7e-571088a0b3eb@auckland.ac.nz>
 <MEAPR01MB32216AB3C4EFE314DFCA2041A4E70@MEAPR01MB3221.ausprd01.prod.outlook.com>
 <CAMXOh=1Y48St-XD9vYJDmarHo7ticE89CdKFUpfCFCAo7K3MpA@mail.gmail.com>
 <CAFvJtoEzyk38wyZhdKWffunV8V_xBYweb2Jtg7-ksDgkHuV88g@mail.gmail.com>
 <alpine.LFD.2.21.1906240916340.31909@reclus.nhh.no>
 <CAFvJtoGXw+3qTwYd_h67iBpd3AN9=xXfbY-RTxVLVOpYRznYgQ@mail.gmail.com>
Message-ID: <714cdf18-0f6c-20ce-c9e7-a006730ca592@mail.montclair.edu>

Hi, Rolando:

A Great Circle distance is the distance measured with un-projected 
coordinates, or what we normally called the longitude and latitude 
coordinates (measured in decimal degrees). These coordinates are 
essentially Spherical coordinates recorded on the surface of a Sphere 
(or sphere-like object, the Spheroid/Ellipsoid, which is basically our 
Earth). When measuring distance using these coordinates, you must use 
the Great Circle (the Circle that centered on the center of the Earth) 
that crosses the two points and calculate the distance on the Great 
Circle, which is calculated as (assuming the Earth is a perfect Sphere):

[ (angle between the two lines from the center of the Earth to the two 
points on the surface of the Earth)/360 ] * 2*Pai* (Radius of the Earth)

If, however, the coordinates are projected to a planar system (a 
Cartesian coordinate system), we can then use the normal Euclidean 
distance measure to calculate the distance between two points recorded 
in planar coordinate system (such as the UTM, State Plane used in the 
US, and many others), which is calculated simply as:

sqrt((difference between the xs)^2 + (difference between the ys)^2).

Hope this helps.

Best,

Danlin

On 6/27/2019 2:44 AM, Rolando Valdez wrote:
> Dear Prof. Roger, many thanks for your help, I am working on.
>
> I have a doubt: Which is the differece between Great Circle and Euclidean
> Distance?
>
> Thanks
>
> El lun., 24 de jun. de 2019 a la(s) 00:58, Roger Bivand (Roger.Bivand at nhh.no)
> escribi?:
>
>> On Mon, 24 Jun 2019, Rolando Valdez wrote:
>>
>>> Dear Andres,
>>>
>>> I could follow an example provided with the package, it was a little bit
>>> simple, however, I got this message:
>>>
>>>> dists <- osrmTable(loc = muns13, measure = "duration")
>>> The OSRM server returned an error:
>>> Error: The public OSRM API does not allow results with a number of
>>> durations
>>> higher than 10000. Ask for fewer durations or use your own server and set
>>> its
>>> --max-table-size option.
>>>
>>> My sample size is 2,457
>> Were you asking for the whole nx(n-1)/2 set of durations in one run? You
>> see that the API limits the number of interactions (possibly by time and
>> by unique IP number). So you need to reduce the number of queries. If you
>> are going to impose a distance threshold anyway, you can do that using the
>> Great Circle (not Euclidean) distances between your geographical
>> coordinates and dnearneigh(), and step through the nb list object with
>> src= being the data frame of the observation coordinates, and dest= the
>> data frame of the neighbours' coordinates.
>>
>> library(sf)
>> nc <- st_read(system.file("shapes/sids.shp", package="spData")[1],
>> quiet=TRUE)
>> st_crs(nc) <- "+proj=longlat +datum=NAD27"
>> nc1 <- st_transform(nc, 32019)
>> nc2 <- st_centroid(nc1, of_largest_polygon=TRUE)
>> nc3 <- st_transform(nc2, 4326)
>> crds <- st_coordinates(st_geometry(nc3))
>> df <- data.frame(id=nc3$FIPSNO, long=crds[,1], lat=crds[,2])
>> library(spdep)
>> nb <- dnearneigh(crds, 0, 50, longlat=TRUE)
>> library(osrm)
>> res <- vector(mode="list", length=nrow(df))
>> for (i in seq(along=res)) res[[i]] <- osrmTable(src=df[i,],
>>    dst=df[nb[[i]],], measure = "duration")
>> res1 <- lapply(res, function(x) 10/x$duration)
>> lw <- nb2listw(nb, glist=res1, style="B")
>>
>> gives general spatial weights based on 10/# minutes travel time between
>> county centroids (centroids calculated from projected coordinates), for
>> county centroids closer than 50 km measured by Great Circle.
>>
>> In your case, you may need to split the for() loop into portions of
>> cumsum(card(nb)) of less than the limit. If durations are symmetric,
>> you could also halve the query count by taking only neighbour ids > i,
>> but you'd have to fold them back afterwards. You also wanted to categorise
>> the durations into 0,1, which you could do with lapply() instead of using
>> inverse durations.
>>
>> Hope this helps,
>>
>> Roger
>>
>>> El vie., 21 de jun. de 2019 a la(s) 02:53, Andres Diaz Loaiza (
>>> madiazl at gmail.com) escribi?:
>>>
>>>> Dear Rolando,
>>>>
>>>> The advantage of using Open Street Maps engine is that you can give the
>>>> travel option. This means you can select whether are you traveling by
>> bike,
>>>> car or walking. The previous approach didn't consider this topic. For
>> this,
>>>> you should have added a vector layer depending on your position of the
>>>> street you can take (or not). Open Street Maps project allow you two
>>>> options: a service in which you give your current position, the position
>>>> you want to reach and your transport method (giving you back the fastest
>>>> route). Or the option to download the engine/algorithm compile by
>> yourself
>>>> (if I am not wrong is made in C or python) and then you can make your
>> own
>>>> calculation at your own computer. For the first option, the package
>> OSRM is
>>>> an interface in which send a request to the OSM web page and wait for an
>>>> answer. With this method, you can send a couple of request at the same
>> time
>>>> but no to many (you should read the manual for this). Of course, also
>> will
>>>> depend on whether the OSM server is down or not (or busy).
>>>>
>>>> I have to say that I used some years ago this app and nowadays I know
>> that
>>>> for some cities OSM has more streets reported than the same google maps.
>>>> Also is an open project and they let you download their data for free,
>>>> contrary to what google maps do.
>>>>
>>>> All the best,
>>>>
>>>>
>>>> Andres
>>>>
>>>> El vie., 21 jun. 2019 a las 4:30, Adrian Baddeley (<
>>>> adrian.baddeley at curtin.edu.au>) escribi?:
>>>>
>>>>> Rather than converting an object of class 'SpatialLines' or
>>>>> 'SpatialLinesDataFrame' to the spatstat class 'psp' and then
>> converting it
>>>>> to the spatstat class 'linnet', it is safer and more efficient to
>> convert
>>>>> the SpatialLines* object directly to class linnet using
>>>>> as.linnet.SpatialLinesDataFrame() from the package 'maptools'.
>>>>>
>>>>>
>>>>> Prof Adrian Baddeley DSc FAA
>>>>>
>>>>> John Curtin Distinguished Professor
>>>>>
>>>>> Department of Mathematics and Statistics
>>>>>
>>>>> Curtin University, Perth, Western Australia
>>>>>
>>>>>
>>>>> ________________________________
>>>>> From: Rolf Turner <r.turner at auckland.ac.nz>
>>>>> Sent: Friday, 21 June 2019 10:08 AM
>>>>> To: Rolando Valdez
>>>>> Cc: r-sig-geo at r-project.org; Adrian Baddeley; Ege Rubak
>>>>> Subject: Re: [FORGED] [R-sig-Geo] Create a Spatial Weight Matrix based
>> on
>>>>> road distance
>>>>>
>>>>>
>>>>> On 21/06/19 12:26 PM, Rolando Valdez wrote:
>>>>>
>>>>>> Dear community,
>>>>>>
>>>>>> Is there any way to create a spatial weight matrix based on road
>>>>> distance?
>>>>>> I am trying to use the road distance between two points instead of
>>>>>> euclidean distance.
>>>>>>
>>>>>> I've seen that there is a package named osrm. Can anyone give some
>>>>> advice?
>>>>>
>>>>> I don't know anything about "osrm".  Calculating "road distances" can
>> be
>>>>> done in the spatstat package reasonably easily, if you take the trouble
>>>>> to represent your collection of roads as a "linnet" object.
>>>>>
>>>>> Given that you have done so, suppose that your linnet object is "L" and
>>>>> that you have vectors "x" and "y" specifying the points on L (i.e. on
>>>>> your roads) between which you want to know the distances.
>>>>>
>>>>> Do:
>>>>>
>>>>>       X    <- lpp(data.frame(x=x,y=y),L)
>>>>>       dMat <- pairdist(X)
>>>>>
>>>>> The object "dMat" is a (symmetric) square matrix; dMat[i,j] is the
>>>>> distance between point i and point j.  (Of course the diagonal entries
>>>>> are all 0.)
>>>>>
>>>>> If your collection of roads is specified by means of a shapefile,
>>>>> vignette("shapefiles") will tell you how to turn this collection into a
>>>>> "psp" ("planar segment pattern") object; the function (method)
>>>>> as.linnet.psp() can then be used to turn the "psp" object into a
>>>>> "linnet" object.
>>>>>
>>>>> HTH
>>>>>
>>>>> cheers,
>>>>>
>>>>> Rolf Turner
>>>>>
>>>>> --
>>>>> Honorary Research Fellow
>>>>> Department of Statistics
>>>>> University of Auckland
>>>>> Phone: +64-9-373-7599 ext. 88276
>>>>>
>>>>>          [[alternative HTML version deleted]]
>>>>>
>>>>> _______________________________________________
>>>>> R-sig-Geo mailing list
>>>>> R-sig-Geo at r-project.org
>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>
>>>>
>>>> --
>>>> Andr?s D.
>>>>
>>>
>>>
>> --
>> Roger Bivand
>> Department of Economics, Norwegian School of Economics,
>> Helleveien 30, N-5045 Bergen, Norway.
>> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
>> https://orcid.org/0000-0003-2392-6140
>> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>
>
-- 
___________________________________________
Danlin Yu, Ph.D.
Professor of GIS and Urban Geography
Department of Earth & Environmental Studies
Montclair State University
Montclair, NJ, 07043
Tel: 973-655-4313
Fax: 973-655-4072
Office: CELS 314
Email: yud at mail.montclair.edu
webpage: csam.montclair.edu/~yu


From rv@|dezr @end|ng |rom gm@||@com  Thu Jun 27 12:40:44 2019
From: rv@|dezr @end|ng |rom gm@||@com (Rolando Valdez)
Date: Thu, 27 Jun 2019 05:40:44 -0500
Subject: [R-sig-Geo] 
 [FORGED] Create a Spatial Weight Matrix based on road distance
In-Reply-To: <714cdf18-0f6c-20ce-c9e7-a006730ca592@mail.montclair.edu>
References: <CAFvJtoFemxph=u+ewBra6ebHLzaOC=49r3WFB6sJ5N7Zxs4m_Q@mail.gmail.com>
 <49e352fb-6742-86d6-bd7e-571088a0b3eb@auckland.ac.nz>
 <MEAPR01MB32216AB3C4EFE314DFCA2041A4E70@MEAPR01MB3221.ausprd01.prod.outlook.com>
 <CAMXOh=1Y48St-XD9vYJDmarHo7ticE89CdKFUpfCFCAo7K3MpA@mail.gmail.com>
 <CAFvJtoEzyk38wyZhdKWffunV8V_xBYweb2Jtg7-ksDgkHuV88g@mail.gmail.com>
 <alpine.LFD.2.21.1906240916340.31909@reclus.nhh.no>
 <CAFvJtoGXw+3qTwYd_h67iBpd3AN9=xXfbY-RTxVLVOpYRznYgQ@mail.gmail.com>
 <714cdf18-0f6c-20ce-c9e7-a006730ca592@mail.montclair.edu>
Message-ID: <CAFvJtoESNN-Uv9d+riqcX0abxCsEgLmjQP1UbfQ2FA_4S7F4fw@mail.gmail.com>

I see. It is very interesting.

Thank you for your answer.

El El jue, 27 de junio de 2019 a la(s) 3:08, Danlin Yu <
yud at mail.montclair.edu> escribi?:

> Hi, Rolando:
>
> A Great Circle distance is the distance measured with un-projected
> coordinates, or what we normally called the longitude and latitude
> coordinates (measured in decimal degrees). These coordinates are
> essentially Spherical coordinates recorded on the surface of a Sphere
> (or sphere-like object, the Spheroid/Ellipsoid, which is basically our
> Earth). When measuring distance using these coordinates, you must use
> the Great Circle (the Circle that centered on the center of the Earth)
> that crosses the two points and calculate the distance on the Great
> Circle, which is calculated as (assuming the Earth is a perfect Sphere):
>
> [ (angle between the two lines from the center of the Earth to the two
> points on the surface of the Earth)/360 ] * 2*Pai* (Radius of the Earth)
>
> If, however, the coordinates are projected to a planar system (a
> Cartesian coordinate system), we can then use the normal Euclidean
> distance measure to calculate the distance between two points recorded
> in planar coordinate system (such as the UTM, State Plane used in the
> US, and many others), which is calculated simply as:
>
> sqrt((difference between the xs)^2 + (difference between the ys)^2).
>
> Hope this helps.
>
> Best,
>
> Danlin
>
> On 6/27/2019 2:44 AM, Rolando Valdez wrote:
> > Dear Prof. Roger, many thanks for your help, I am working on.
> >
> > I have a doubt: Which is the differece between Great Circle and Euclidean
> > Distance?
> >
> > Thanks
> >
> > El lun., 24 de jun. de 2019 a la(s) 00:58, Roger Bivand (
> Roger.Bivand at nhh.no)
> > escribi?:
> >
> >> On Mon, 24 Jun 2019, Rolando Valdez wrote:
> >>
> >>> Dear Andres,
> >>>
> >>> I could follow an example provided with the package, it was a little
> bit
> >>> simple, however, I got this message:
> >>>
> >>>> dists <- osrmTable(loc = muns13, measure = "duration")
> >>> The OSRM server returned an error:
> >>> Error: The public OSRM API does not allow results with a number of
> >>> durations
> >>> higher than 10000. Ask for fewer durations or use your own server and
> set
> >>> its
> >>> --max-table-size option.
> >>>
> >>> My sample size is 2,457
> >> Were you asking for the whole nx(n-1)/2 set of durations in one run? You
> >> see that the API limits the number of interactions (possibly by time and
> >> by unique IP number). So you need to reduce the number of queries. If
> you
> >> are going to impose a distance threshold anyway, you can do that using
> the
> >> Great Circle (not Euclidean) distances between your geographical
> >> coordinates and dnearneigh(), and step through the nb list object with
> >> src= being the data frame of the observation coordinates, and dest= the
> >> data frame of the neighbours' coordinates.
> >>
> >> library(sf)
> >> nc <- st_read(system.file("shapes/sids.shp", package="spData")[1],
> >> quiet=TRUE)
> >> st_crs(nc) <- "+proj=longlat +datum=NAD27"
> >> nc1 <- st_transform(nc, 32019)
> >> nc2 <- st_centroid(nc1, of_largest_polygon=TRUE)
> >> nc3 <- st_transform(nc2, 4326)
> >> crds <- st_coordinates(st_geometry(nc3))
> >> df <- data.frame(id=nc3$FIPSNO, long=crds[,1], lat=crds[,2])
> >> library(spdep)
> >> nb <- dnearneigh(crds, 0, 50, longlat=TRUE)
> >> library(osrm)
> >> res <- vector(mode="list", length=nrow(df))
> >> for (i in seq(along=res)) res[[i]] <- osrmTable(src=df[i,],
> >>    dst=df[nb[[i]],], measure = "duration")
> >> res1 <- lapply(res, function(x) 10/x$duration)
> >> lw <- nb2listw(nb, glist=res1, style="B")
> >>
> >> gives general spatial weights based on 10/# minutes travel time between
> >> county centroids (centroids calculated from projected coordinates), for
> >> county centroids closer than 50 km measured by Great Circle.
> >>
> >> In your case, you may need to split the for() loop into portions of
> >> cumsum(card(nb)) of less than the limit. If durations are symmetric,
> >> you could also halve the query count by taking only neighbour ids > i,
> >> but you'd have to fold them back afterwards. You also wanted to
> categorise
> >> the durations into 0,1, which you could do with lapply() instead of
> using
> >> inverse durations.
> >>
> >> Hope this helps,
> >>
> >> Roger
> >>
> >>> El vie., 21 de jun. de 2019 a la(s) 02:53, Andres Diaz Loaiza (
> >>> madiazl at gmail.com) escribi?:
> >>>
> >>>> Dear Rolando,
> >>>>
> >>>> The advantage of using Open Street Maps engine is that you can give
> the
> >>>> travel option. This means you can select whether are you traveling by
> >> bike,
> >>>> car or walking. The previous approach didn't consider this topic. For
> >> this,
> >>>> you should have added a vector layer depending on your position of the
> >>>> street you can take (or not). Open Street Maps project allow you two
> >>>> options: a service in which you give your current position, the
> position
> >>>> you want to reach and your transport method (giving you back the
> fastest
> >>>> route). Or the option to download the engine/algorithm compile by
> >> yourself
> >>>> (if I am not wrong is made in C or python) and then you can make your
> >> own
> >>>> calculation at your own computer. For the first option, the package
> >> OSRM is
> >>>> an interface in which send a request to the OSM web page and wait for
> an
> >>>> answer. With this method, you can send a couple of request at the same
> >> time
> >>>> but no to many (you should read the manual for this). Of course, also
> >> will
> >>>> depend on whether the OSM server is down or not (or busy).
> >>>>
> >>>> I have to say that I used some years ago this app and nowadays I know
> >> that
> >>>> for some cities OSM has more streets reported than the same google
> maps.
> >>>> Also is an open project and they let you download their data for free,
> >>>> contrary to what google maps do.
> >>>>
> >>>> All the best,
> >>>>
> >>>>
> >>>> Andres
> >>>>
> >>>> El vie., 21 jun. 2019 a las 4:30, Adrian Baddeley (<
> >>>> adrian.baddeley at curtin.edu.au>) escribi?:
> >>>>
> >>>>> Rather than converting an object of class 'SpatialLines' or
> >>>>> 'SpatialLinesDataFrame' to the spatstat class 'psp' and then
> >> converting it
> >>>>> to the spatstat class 'linnet', it is safer and more efficient to
> >> convert
> >>>>> the SpatialLines* object directly to class linnet using
> >>>>> as.linnet.SpatialLinesDataFrame() from the package 'maptools'.
> >>>>>
> >>>>>
> >>>>> Prof Adrian Baddeley DSc FAA
> >>>>>
> >>>>> John Curtin Distinguished Professor
> >>>>>
> >>>>> Department of Mathematics and Statistics
> >>>>>
> >>>>> Curtin University, Perth, Western Australia
> >>>>>
> >>>>>
> >>>>> ________________________________
> >>>>> From: Rolf Turner <r.turner at auckland.ac.nz>
> >>>>> Sent: Friday, 21 June 2019 10:08 AM
> >>>>> To: Rolando Valdez
> >>>>> Cc: r-sig-geo at r-project.org; Adrian Baddeley; Ege Rubak
> >>>>> Subject: Re: [FORGED] [R-sig-Geo] Create a Spatial Weight Matrix
> based
> >> on
> >>>>> road distance
> >>>>>
> >>>>>
> >>>>> On 21/06/19 12:26 PM, Rolando Valdez wrote:
> >>>>>
> >>>>>> Dear community,
> >>>>>>
> >>>>>> Is there any way to create a spatial weight matrix based on road
> >>>>> distance?
> >>>>>> I am trying to use the road distance between two points instead of
> >>>>>> euclidean distance.
> >>>>>>
> >>>>>> I've seen that there is a package named osrm. Can anyone give some
> >>>>> advice?
> >>>>>
> >>>>> I don't know anything about "osrm".  Calculating "road distances" can
> >> be
> >>>>> done in the spatstat package reasonably easily, if you take the
> trouble
> >>>>> to represent your collection of roads as a "linnet" object.
> >>>>>
> >>>>> Given that you have done so, suppose that your linnet object is "L"
> and
> >>>>> that you have vectors "x" and "y" specifying the points on L (i.e. on
> >>>>> your roads) between which you want to know the distances.
> >>>>>
> >>>>> Do:
> >>>>>
> >>>>>       X    <- lpp(data.frame(x=x,y=y),L)
> >>>>>       dMat <- pairdist(X)
> >>>>>
> >>>>> The object "dMat" is a (symmetric) square matrix; dMat[i,j] is the
> >>>>> distance between point i and point j.  (Of course the diagonal
> entries
> >>>>> are all 0.)
> >>>>>
> >>>>> If your collection of roads is specified by means of a shapefile,
> >>>>> vignette("shapefiles") will tell you how to turn this collection
> into a
> >>>>> "psp" ("planar segment pattern") object; the function (method)
> >>>>> as.linnet.psp() can then be used to turn the "psp" object into a
> >>>>> "linnet" object.
> >>>>>
> >>>>> HTH
> >>>>>
> >>>>> cheers,
> >>>>>
> >>>>> Rolf Turner
> >>>>>
> >>>>> --
> >>>>> Honorary Research Fellow
> >>>>> Department of Statistics
> >>>>> University of Auckland
> >>>>> Phone: +64-9-373-7599 ext. 88276
> >>>>>
> >>>>>          [[alternative HTML version deleted]]
> >>>>>
> >>>>> _______________________________________________
> >>>>> R-sig-Geo mailing list
> >>>>> R-sig-Geo at r-project.org
> >>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >>>>>
> >>>>
> >>>> --
> >>>> Andr?s D.
> >>>>
> >>>
> >>>
> >> --
> >> Roger Bivand
> >> Department of Economics, Norwegian School of Economics,
> >> Helleveien 30, N-5045 Bergen, Norway.
> >> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
> >> https://orcid.org/0000-0003-2392-6140
> >> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
> >
> >
> --
> ___________________________________________
> Danlin Yu, Ph.D.
> Professor of GIS and Urban Geography
> Department of Earth & Environmental Studies
> Montclair State University
> Montclair, NJ, 07043
> Tel: 973-655-4313
> Fax: 973-655-4072
> Office: CELS 314
> Email: yud at mail.montclair.edu
> webpage: csam.montclair.edu/~yu
>
> --
Rol~

	[[alternative HTML version deleted]]


From bunn@ @end|ng |rom wwu@edu  Thu Jun 27 22:59:48 2019
From: bunn@ @end|ng |rom wwu@edu (Andy Bunn)
Date: Thu, 27 Jun 2019 20:59:48 +0000
Subject: [R-sig-Geo] Location estimation methods based on multiple surfaces?
Message-ID: <AB532CC3-5088-410A-BB2B-F11D40395DE8@wwu.edu>

Hello all. I?m probably reinventing the wheel here and wonder if somebody can point me in a better direction.

I have about 10 surfaces of signal strength (z) received at a transmitter. Here I?ll provide an example with four surfaces `r1`, `r2`, `r3`, `r4`.

    library(raster)
    library(gstat)
    set.seed(3178)
    n <- 100
    r0 <- raster(nrows=n, ncols=n,xmn=1, xmx=n,ymn=1,ymx=n)
    r0 <- as(r0,"SpatialGrid")
    pts <- data.frame(x=c(10,20,60,80,1,1,n,n),y=c(10,80,70,40,1,n,1,n),
                      id=c(1:4,rep(0,4)), z=c(c(rep(1,4)),rep(0,4)))

    pts <- SpatialPointsDataFrame(pts[,1:2],data=pts[,3:4])


    r1 <- idw(z~1,pts[c(1,5:8),],newdata=r0)
    r2 <- idw(z~1,pts[c(2,5:8),],newdata=r0)
    r3 <- idw(z~1,pts[c(3,5:8),],newdata=r0)
    r4 <- idw(z~1,pts[c(4,5:8),],newdata=r0)

    r1 <- raster(r1)
    r2 <- raster(r2)
    r3 <- raster(r3)
    r4 <- raster(r4)

I also have a series of points with signal strengths that correspond to each surface. The locations of these points is unknown. The task is to determine a location for each point. E.g., for `unknownXY`:

    # Extract a point. For the real data I would have the z data but not x and y
    cell2get <- floor(runif(1,1,n^2))
    unknownXY <- c(extract(brick(r1,r2,r3,r4),cell2get))

In this case there is a four-way intersection of the contour lines that I could find suing some kind of intersection technique (e.g., `rgeos::gIntersection`).


    # Here is the the contour for the unknown point on each raster
    plot(r1,axes=F)
    contour(r1,levels=unknownXY[1],add=TRUE)

    plot(r2,axes=F)
    contour(r2,levels=unknownXY[2],add=TRUE)

    plot(r3,axes=F)
    contour(r3,levels=unknownXY[3],add=TRUE)

    plot(r4,axes=F)
    contour(r4,levels=unknownXY[4],add=TRUE)

    # here are all 4 contours
    plot(r0,axes=F,col="white")
    contour(r1,levels=unknownXY[1],add=TRUE,drawlabels=FALSE,col="red")
    contour(r2,levels=unknownXY[2],add=TRUE,drawlabels=FALSE,col="blue")
    contour(r3,levels=unknownXY[3],add=TRUE,drawlabels=FALSE,col="purple")
    contour(r4,levels=unknownXY[4],add=TRUE,drawlabels=FALSE,col="green")

But there are times when, I think, that there will not be a completely pure intersection (e.g., the contours will not exactly overlap). In that case I?m wondering about using a probabilistic method for finding x,y for a given vector of z.

One thing I was thinking was calculating distances. E.g.,

    # calc distances
    r1d <- sqrt((unknownXY[1] - r1)^2)
    r2d <- sqrt((unknownXY[2] - r2)^2)
    r3d <- sqrt((unknownXY[3] - r3)^2)
    r4d <- sqrt((unknownXY[4] - r4)^2)
    plot(brick(r1d,r2d,r3d,r4d))

And them summing them:

    # Straight sum? Should they be weighted in some manner?
    rdSum <- sum(brick(r1d,r2d,r3d,r4d))
    plot(rdSum)

I could find the min value to get the ``best'' point:

    # Use min to get possible location. Seems easy to get trapped.
    rdSumMin <- rdSum == minValue(rdSum)
    plot(rdSumMin)

Or use a threshold value to get a series of locations that are the most likely:

    # Or use quantile to get possible locations?
    thresh <- quantile(rdSum, probs = c(0.01))
    rdSum99 <- rdSum < thresh
    plot(rdSum99)

What I?m wondering it whether there is a way of finding a surface that is explicitly probabilistic. What I?d like to do is be able to determine possible location with x% likelihood.

Any ideas, tips, tricks, appreciated.











	[[alternative HTML version deleted]]


From bunn@ @end|ng |rom wwu@edu  Fri Jun 28 19:51:36 2019
From: bunn@ @end|ng |rom wwu@edu (Andy Bunn)
Date: Fri, 28 Jun 2019 17:51:36 +0000
Subject: [R-sig-Geo] 
 Location estimation methods based on multiple surfaces?
In-Reply-To: <CANVKczMWJ1YO7FPtms_dDqvyTorv3qo4AScdeG=ZgNCo21KVAQ@mail.gmail.com>
References: <AB532CC3-5088-410A-BB2B-F11D40395DE8@wwu.edu>
 <CANVKczMWJ1YO7FPtms_dDqvyTorv3qo4AScdeG=ZgNCo21KVAQ@mail.gmail.com>
Message-ID: <67DAA924-0312-4E34-9670-1EA4F6E075A3@wwu.edu>

Excellent. I think I have a way forward worked out in my head. But as with many things, I need to go back and think about what it is I?m really after as the end product. I might be heading down the wrong path. Thanks for your help.

From: Barry Rowlingson <b.rowlingson at lancaster.ac.uk>
Date: Friday, June 28, 2019 at 4:12 AM
To: Andy Bunn <bunna at wwu.edu>
Cc: R-sig-Geo <r-sig-geo at r-project.org>
Subject: Re: [R-sig-Geo] Location estimation methods based on multiple surfaces?

This has also been posted to gis.stackexchange.com<https://nam03.safelinks.protection.outlook.com/?url=http%3A%2F%2Fgis.stackexchange.com&data=02%7C01%7Cbunna%40wwu.edu%7C1cf95b53c5474c35586d08d6fbb97375%7Cdc46140ce26f43efb0ae00f257f478ff%7C0%7C1%7C636973171266761575&sdata=lAXBPTNLIUZvpmJCx8FzCwZ7%2FeCu%2F6hi%2BbtK7OSZfGY%3D&reserved=0> where I've blathered a bit about probability distributions:

https://gis.stackexchange.com/questions/327164/location-estimation-methods-based-on-multiple-surfaces/327174#327174<https://nam03.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgis.stackexchange.com%2Fquestions%2F327164%2Flocation-estimation-methods-based-on-multiple-surfaces%2F327174%23327174&data=02%7C01%7Cbunna%40wwu.edu%7C1cf95b53c5474c35586d08d6fbb97375%7Cdc46140ce26f43efb0ae00f257f478ff%7C0%7C1%7C636973171266761575&sdata=WOdNOrWftOgPl2%2BWzDQRokTOkek8mn4UgpmdtvOulBE%3D&reserved=0>

That site might not be the best place to solve the problem if it gets a bit too much like a discussion - the question might be a bit broad...

Barry


On Thu, Jun 27, 2019 at 10:00 PM Andy Bunn <bunna at wwu.edu<mailto:bunna at wwu.edu>> wrote:
Hello all. I?m probably reinventing the wheel here and wonder if somebody can point me in a better direction.

I have about 10 surfaces of signal strength (z) received at a transmitter. Here I?ll provide an example with four surfaces `r1`, `r2`, `r3`, `r4`.

    library(raster)
    library(gstat)
    set.seed(3178)
    n <- 100
    r0 <- raster(nrows=n, ncols=n,xmn=1, xmx=n,ymn=1,ymx=n)
    r0 <- as(r0,"SpatialGrid")
    pts <- data.frame(x=c(10,20,60,80,1,1,n,n),y=c(10,80,70,40,1,n,1,n),
                      id=c(1:4,rep(0,4)), z=c(c(rep(1,4)),rep(0,4)))

    pts <- SpatialPointsDataFrame(pts[,1:2],data=pts[,3:4])


    r1 <- idw(z~1,pts[c(1,5:8),],newdata=r0)
    r2 <- idw(z~1,pts[c(2,5:8),],newdata=r0)
    r3 <- idw(z~1,pts[c(3,5:8),],newdata=r0)
    r4 <- idw(z~1,pts[c(4,5:8),],newdata=r0)

    r1 <- raster(r1)
    r2 <- raster(r2)
    r3 <- raster(r3)
    r4 <- raster(r4)

I also have a series of points with signal strengths that correspond to each surface. The locations of these points is unknown. The task is to determine a location for each point. E.g., for `unknownXY`:

    # Extract a point. For the real data I would have the z data but not x and y
    cell2get <- floor(runif(1,1,n^2))
    unknownXY <- c(extract(brick(r1,r2,r3,r4),cell2get))

In this case there is a four-way intersection of the contour lines that I could find suing some kind of intersection technique (e.g., `rgeos::gIntersection`).


    # Here is the the contour for the unknown point on each raster
    plot(r1,axes=F)
    contour(r1,levels=unknownXY[1],add=TRUE)

    plot(r2,axes=F)
    contour(r2,levels=unknownXY[2],add=TRUE)

    plot(r3,axes=F)
    contour(r3,levels=unknownXY[3],add=TRUE)

    plot(r4,axes=F)
    contour(r4,levels=unknownXY[4],add=TRUE)

    # here are all 4 contours
    plot(r0,axes=F,col="white")
    contour(r1,levels=unknownXY[1],add=TRUE,drawlabels=FALSE,col="red")
    contour(r2,levels=unknownXY[2],add=TRUE,drawlabels=FALSE,col="blue")
    contour(r3,levels=unknownXY[3],add=TRUE,drawlabels=FALSE,col="purple")
    contour(r4,levels=unknownXY[4],add=TRUE,drawlabels=FALSE,col="green")

But there are times when, I think, that there will not be a completely pure intersection (e.g., the contours will not exactly overlap). In that case I?m wondering about using a probabilistic method for finding x,y for a given vector of z.

One thing I was thinking was calculating distances. E.g.,

    # calc distances
    r1d <- sqrt((unknownXY[1] - r1)^2)
    r2d <- sqrt((unknownXY[2] - r2)^2)
    r3d <- sqrt((unknownXY[3] - r3)^2)
    r4d <- sqrt((unknownXY[4] - r4)^2)
    plot(brick(r1d,r2d,r3d,r4d))

And them summing them:

    # Straight sum? Should they be weighted in some manner?
    rdSum <- sum(brick(r1d,r2d,r3d,r4d))
    plot(rdSum)

I could find the min value to get the ``best'' point:

    # Use min to get possible location. Seems easy to get trapped.
    rdSumMin <- rdSum == minValue(rdSum)
    plot(rdSumMin)

Or use a threshold value to get a series of locations that are the most likely:

    # Or use quantile to get possible locations?
    thresh <- quantile(rdSum, probs = c(0.01))
    rdSum99 <- rdSum < thresh
    plot(rdSum99)

What I?m wondering it whether there is a way of finding a surface that is explicitly probabilistic. What I?d like to do is be able to determine possible location with x% likelihood.

Any ideas, tips, tricks, appreciated.











        [[alternative HTML version deleted]]

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org<mailto:R-sig-Geo at r-project.org>
https://stat.ethz.ch/mailman/listinfo/r-sig-geo<https://nam03.safelinks.protection.outlook.com/?url=https%3A%2F%2Fstat.ethz.ch%2Fmailman%2Flistinfo%2Fr-sig-geo&data=02%7C01%7Cbunna%40wwu.edu%7C1cf95b53c5474c35586d08d6fbb97375%7Cdc46140ce26f43efb0ae00f257f478ff%7C0%7C1%7C636973171266771583&sdata=mtkWNtpKSRkRLfgU2SjO%2Blo7wSpIhH1d61iZSILPRxA%3D&reserved=0>

	[[alternative HTML version deleted]]


From |ove|y||tt|ed@|@|e@ @end|ng |rom gm@||@com  Sat Jun 29 01:36:22 2019
From: |ove|y||tt|ed@|@|e@ @end|ng |rom gm@||@com (Jiawen Ng)
Date: Sat, 29 Jun 2019 00:36:22 +0100
Subject: [R-sig-Geo] Running huge dataset with dnearneigh
Message-ID: <CAHz1c-V8DcT4UNqiw38pLvJrDJgFjGu+rq=a1PLhznxsTLdAGw@mail.gmail.com>

Dear Roger,

How can we deal with a huge dataset when using dnearneigh?

Here is my code:

d <- dnearneigh(spdf,0, 22000)
all_listw <- nb2listw(d, style = "W")

where the spdf object is in the british national grid CRS:
+init=epsg:27700, with 227,973 observations/points. The distance of 22,000
was decided by a training set that had 214 observations and the spdf object
contains both the training set and the testing set.

I am using a Mac, with a processor of 2.3 GHz Intel Core i5 and 8 GB
memory. My laptop showed that when dnearneigh command was run on all
observations, around 6.9 out of 8GB was used by the rsession and that the
%CPU used by the rsession was stated to be around 98%, although another
indicator showed that my computer was around 60% idle. After running the
command for a day, rstudio alerted me that the connection to the rsession
could not be established, so I aborted the entire process altogether. I
think the problem here may be the size of the dataset and perhaps the
limitations of my laptop specs.

Do you have any advice on how I can go about making a neighbours list with
dnearneigh for 227,973 observations in a successful and efficient way?
Also, would you foresee any problems in the next steps, especially when I
will be using the neighbourhood listw object as an input in fitting and
predicting using the spatial lag/error models? (see code below)

model <-  spatialreg::lagsarlm(rest_formula, data=train, train_listw)
model_pred <- spatialreg::predict.sarlm(model, test, all_listw)

I think the predicting part may take some time, since my test set consists
of 227,973 - 214 observations = 227,759 observations.

Here are some solutions that I have thought of:

1. Interpolate the test set point data of 227,759 observations over a more
manageable spatial pixel dataframe with cell size of perhaps 10,000m by
10,000m which would give me around 4900 points. So instead of 227,759
observations, I can make the listw object based on just 4900 + 214 training
points and predict just on 4900 observations.

2. Get hold of better performance machines through cloud computing such as
AWS EC2 services and try running the commands and models there.

3. Parallel computing using the parallel package from r (although I am not
sure whether dnearneigh can be parallelised).

I believe option 1 would be the most manageable but I am not sure how and
by how much this would affect the accuracy of the predictions as
interpolating the dataset would be akin to introducing more estimations in
the prediction. However, I am also grappling with the trade-off between
accuracy and computation time. Hence, if options 2 and 3 can offer a
reasonable computation time (1-2 hours) then I would forgo option 1.

What do you think? Is it possible to make a neighbourhood listw object out
of 227,973 observations efficiently?

Thank you for reading to the end! Apologies for writing a lengthy one, just
wanted to fully describe what I am facing, I hope I didn't miss out
anything crucial.

Thank you so much once again!

jiawen

	[[alternative HTML version deleted]]


From kent3737 @end|ng |rom gm@||@com  Sat Jun 29 20:29:41 2019
From: kent3737 @end|ng |rom gm@||@com (Kent Johnson)
Date: Sat, 29 Jun 2019 14:29:41 -0400
Subject: [R-sig-Geo] Running huge dataset with dnearneigh
In-Reply-To: <mailman.27456.3.1561802402.34670.r-sig-geo@r-project.org>
References: <mailman.27456.3.1561802402.34670.r-sig-geo@r-project.org>
Message-ID: <CAPP0wygVVtjG=1gEnzBBd_-vhaBObxq6JzokH2k0tA1F-Ngm_Q@mail.gmail.com>

>
> Date: Sat, 29 Jun 2019 00:36:22 +0100
> From: Jiawen Ng <lovelylittledaisies at gmail.com>
> To: r-sig-geo at r-project.org
> Subject: [R-sig-Geo] Running huge dataset with dnearneigh
>
> How can we deal with a huge dataset when using dnearneigh?
>
> Here is my code:
>
> d <- dnearneigh(spdf,0, 22000)
> all_listw <- nb2listw(d, style = "W")
>
> where the spdf object is in the british national grid CRS:
> +init=epsg:27700, with 227,973 observations/points. The distance of 22,000
> was decided by a training set that had 214 observations and the spdf object
> contains both the training set and the testing set.


I have had good results using the rtree package to compute nearest
neighbors. It is very fast with relatively low memory requirements. I have
not tried it with so many points but it works well up to 10,000 or so. If I
understand the dnearneigh docs, the rtree::withinDistance function is
similar.
https://github.com/hunzikp/rtree

Kent Johnson

	[[alternative HTML version deleted]]


From Roger@B|v@nd @end|ng |rom nhh@no  Sun Jun 30 17:57:32 2019
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Sun, 30 Jun 2019 17:57:32 +0200
Subject: [R-sig-Geo] Running huge dataset with dnearneigh
In-Reply-To: <CAHz1c-V8DcT4UNqiw38pLvJrDJgFjGu+rq=a1PLhznxsTLdAGw@mail.gmail.com>
References: <CAHz1c-V8DcT4UNqiw38pLvJrDJgFjGu+rq=a1PLhznxsTLdAGw@mail.gmail.com>
Message-ID: <alpine.LFD.2.21.1906301721550.17653@reclus.nhh.no>

On Sat, 29 Jun 2019, Jiawen Ng wrote:

> Dear Roger,

Postings go to the whole list ...

>
> How can we deal with a huge dataset when using dnearneigh?
>

First, why distance neighbours? What is the support of the data, point or 
polygon? If polygon, contiguity neighbours are preferred. If not, and the 
intensity of observations is similar across the whole area, distance may 
be justified, but if the intensity varies, some observations will have 
very many neighbours. In that case, unless you have a clear ecological or 
environmental reason for knowing that a known distance threshold binds, it 
is not a good choice.

> Here is my code:
>
> d <- dnearneigh(spdf,0, 22000)
> all_listw <- nb2listw(d, style = "W")
>
> where the spdf object is in the british national grid CRS:
> +init=epsg:27700, with 227,973 observations/points. The distance of 22,000
> was decided by a training set that had 214 observations and the spdf object
> contains both the training set and the testing set.
>

This is questionable. You train on 214 observations - do their areal 
intensity match those of the whole data set? If chosen at random, you run 
into the spatial sampling problems discussed in:

https://www.sciencedirect.com/science/article/pii/S0304380019302145?dgcid=author

Are 214 observations for training representative of 227,973 prediction 
sites? Do you only have observations on the response for 214, and an 
unobserved response otherwise? What are the data, what are you trying to 
do and why? This is not a sensible setting for models using weights 
matrices for prediction (I think), because we do not have estimates of the 
prediction error in general.

> I am using a Mac, with a processor of 2.3 GHz Intel Core i5 and 8 GB
> memory. My laptop showed that when dnearneigh command was run on all
> observations, around 6.9 out of 8GB was used by the rsession and that the
> %CPU used by the rsession was stated to be around 98%, although another
> indicator showed that my computer was around 60% idle. After running the
> command for a day, rstudio alerted me that the connection to the rsession
> could not be established, so I aborted the entire process altogether. I
> think the problem here may be the size of the dataset and perhaps the
> limitations of my laptop specs.
>

On planar data, there is no good reason for this, as each observation is 
treated separately, finding and sorting distances, and choosing those 
under the threshold. It will undoubtedly slow if there are more than a few 
neighbours within the threshold, but I already covered the inadvisability 
of defining neighbours in that way.

Using an rtree might help, but you get hit badly if there are many 
neighbours within the threshold you have chosen anyway.

On most 8GB hardware and modern OS, you do not have more than 3-4GB for 
work. So something was swapping on your laptop.

> Do you have any advice on how I can go about making a neighbours list with
> dnearneigh for 227,973 observations in a successful and efficient way?
> Also, would you foresee any problems in the next steps, especially when I
> will be using the neighbourhood listw object as an input in fitting and
> predicting using the spatial lag/error models? (see code below)
>
> model <-  spatialreg::lagsarlm(rest_formula, data=train, train_listw)
> model_pred <- spatialreg::predict.sarlm(model, test, all_listw)
>

Why would using a spatial lag model make sense? Why are you suggesting 
this model, do you have a behavioural for why only the spatially lagged 
response should be included?

Why do you think that this is sensible? You are predicting 1000 times for 
each observation - this is not what the prediction methods are written 
for. Most involve inverting an nxn inverse matrix - did you refer to 
Goulard et al. (2017) to get a good understanding of the underlying 
methods?

> I think the predicting part may take some time, since my test set consists
> of 227,973 - 214 observations = 227,759 observations.
>
> Here are some solutions that I have thought of:
>
> 1. Interpolate the test set point data of 227,759 observations over a more
> manageable spatial pixel dataframe with cell size of perhaps 10,000m by
> 10,000m which would give me around 4900 points. So instead of 227,759
> observations, I can make the listw object based on just 4900 + 214 training
> points and predict just on 4900 observations.

But what are you trying to do? Are the observations output areas? House 
sales? If you are not filling in missing areal units (the Goulard et al. 
case), couldn't you simply use geostatistical methods which seem to match 
your support better, and can be fitted and can predict using a local 
neighbourhood? While you are doing that, you could switch to INLA with 
SPDE, which interposes a mesh like the one you suggest. But in that case, 
beware of the mesh choice issue in:

https://doi.org/10.1080/03610926.2018.1536209

>
> 2. Get hold of better performance machines through cloud computing such as
> AWS EC2 services and try running the commands and models there.
>

What you need are methods, not wasted money on hardware as a service.

> 3. Parallel computing using the parallel package from r (although I am not
> sure whether dnearneigh can be parallelised).
>

This could easily be implemented if it was really needed, which I don't 
think it is; better methods understanding lets one do more with less.

> I believe option 1 would be the most manageable but I am not sure how and
> by how much this would affect the accuracy of the predictions as
> interpolating the dataset would be akin to introducing more estimations in
> the prediction. However, I am also grappling with the trade-off between
> accuracy and computation time. Hence, if options 2 and 3 can offer a
> reasonable computation time (1-2 hours) then I would forgo option 1.
>
> What do you think? Is it possible to make a neighbourhood listw object out
> of 227,973 observations efficiently?

Yes, but only if the numbers of neighbours are very small. Look in Bivand 
et al. (2013) to see the use of some fairly large n, but only with few 
neighbours for each observation. You seem to be getting average neighbour 
counts in the thousands, which makes no sense.

>
> Thank you for reading to the end! Apologies for writing a lengthy one, just
> wanted to fully describe what I am facing, I hope I didn't miss out
> anything crucial.
>

Long is OK, but there is no motivation here for why you want to make 200K 
predictions from 200 observations with point support (?) using weights 
matrices.

Hope this clarifies,

Roger

> Thank you so much once again!
>
> jiawen
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en


