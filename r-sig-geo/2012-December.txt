From mintibezabih at gmail.com  Sat Dec  1 15:54:44 2012
From: mintibezabih at gmail.com (alemante zd)
Date: Sat, 1 Dec 2012 14:54:44 +0000
Subject: [R-sig-Geo] repeated commands... how to loop?
Message-ID: <CAJfxP+pomqT1VT+v6buO07sdDZn=8yopy-c9avYBUOFYnx=BHQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121201/112df25c/attachment.pl>

From mintibezabih at gmail.com  Sat Dec  1 21:02:23 2012
From: mintibezabih at gmail.com (alemante zd)
Date: Sat, 1 Dec 2012 20:02:23 +0000
Subject: [R-sig-Geo] repeaed commands.... looping?
Message-ID: <CAJfxP+rMm9ogoUsCwvdqRsyRtoC=8YUz0z0mC_aArMvh5DjzZQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121201/f15569e1/attachment.pl>

From apcar at deakin.edu.au  Sun Dec  2 00:12:16 2012
From: apcar at deakin.edu.au (ADAM PETER CARDILINI)
Date: Sat, 1 Dec 2012 23:12:16 +0000
Subject: [R-sig-Geo] Error:can not allocate vector of size ...,
	using ff or bigmemory?
Message-ID: <11DC569BD7493645998AD27DA1F01E273B2AEB0E@MBOX-B-6.du.deakin.edu.au>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121201/026cc6df/attachment.pl>

From hi_ono2001 at ybb.ne.jp  Sun Dec  2 03:34:24 2012
From: hi_ono2001 at ybb.ne.jp (hi_ono2001 at ybb.ne.jp)
Date: Sun, 2 Dec 2012 11:34:24 +0900 (JST)
Subject: [R-sig-Geo] Replacement shapefiles with SpatiaLite for R-geo
	packages(spdep, rgeos etc.)
Message-ID: <420707.68405.qm@web200207.mail.kks.yahoo.co.jp>

Hello.

 Recently SpatiaLite 4.0 was released. It has lots of powerful, fast and robust functions for Geoprocessing(spatial queries, overlay analysis, creating topology, network analysis, gridding, creating TIN/voronois).
 Some people say SpatiaLite is one of candidate to next standard spatial data format. 

 Current rgeos package seems to be slower and unstable for bigger spatial data.
 And I think if using SpatiaLite, spdep could create spatial weight matrices more speedy than current ones. If this, R will be exactly "R as a GIS".

Unfortunately SQLiteMap, R package for accessing SpatiaLite, has been removed from CRAN since this September.

Any plan to employing  this SpatiaLite for current R-geo packages.

Thanks in advance.



From julleeyaw at yahoo.ca  Sun Dec  2 04:10:40 2012
From: julleeyaw at yahoo.ca (Julie Lee-Yaw)
Date: Sat, 1 Dec 2012 19:10:40 -0800 (PST)
Subject: [R-sig-Geo] need help using maxent k-fold cross validation option
	in dismo
Message-ID: <1354417840.19873.YahooMailNeo@web142501.mail.bf1.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121201/7dcf1e13/attachment.pl>

From raffaele.morelli at gmail.com  Sun Dec  2 07:58:06 2012
From: raffaele.morelli at gmail.com (Raffaele Morelli)
Date: Sun, 2 Dec 2012 07:58:06 +0100
Subject: [R-sig-Geo] Error:can not allocate vector of size ...,
 using ff or bigmemory?
In-Reply-To: <11DC569BD7493645998AD27DA1F01E273B2AEB0E@MBOX-B-6.du.deakin.edu.au>
References: <11DC569BD7493645998AD27DA1F01E273B2AEB0E@MBOX-B-6.du.deakin.edu.au>
Message-ID: <CAD4guxNBoMvtQkW9LmNGTg2SOCfHACBaeuQ5LJ5sqDZ-1kgAxA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121202/12906621/attachment.pl>

From villers.alexandre at gmail.com  Sun Dec  2 08:58:58 2012
From: villers.alexandre at gmail.com (Alexandre Villers)
Date: Sun, 02 Dec 2012 09:58:58 +0200
Subject: [R-sig-Geo] repeated commands... how to loop?
In-Reply-To: <CAJfxP+pomqT1VT+v6buO07sdDZn=8yopy-c9avYBUOFYnx=BHQ@mail.gmail.com>
References: <CAJfxP+pomqT1VT+v6buO07sdDZn=8yopy-c9avYBUOFYnx=BHQ@mail.gmail.com>
Message-ID: <50BB0A42.20508@gmail.com>

Hello,

It's not really clear from your message whether y1, y2, y3 are the y 
part of x/y coordinates, and what is the exact structure of your data 
frame. Without knowing this, the code below is to be adapted to your needs

##load the packages
library(gstat)
library(raster)

#Load the data that are needed
setwd("f:/Grids")
r2 <- raster("idgd_wgs.asc")

y.list <- list(y1<-runif(10), y2 <- runif(10), y3 <- runif(10))
da1<-data.frame(x=1:10, z=1:10)

for (i in 1:length(y.list) {
  da.temp<-data.frame(da1, y=y.list[[i]])
  IDW.temp <- gstat(id = "z", formula = z~1, locations = ~x+y, 
data=da.temp, set=list(idp =2))
  IDWRaster.temp <- interpolate(r2, IDW.temp)
  #add here one or two command lines to save the objects you want to 
save, or check
  rm(da.temp, IDW.temp, IDWRaster.temp) #remove the temporary elements 
(always safer)
}


HTH

Alex


> Dear r users,
>   I have the following script that I would like to run repeatedly for
> different values of y ( the list of which I created below).
> y.list <- list(y1=runif(10), y2 <- runif(10), y3 <- runif(10))
>
> and here is the script I want to run for different values of y.
>
> ############
>
> x <- 1:10
> y <- 1:10
> z<- 1:10
>
> da1<-data.frame(x,y,z)
> ***** this file is an aready existing ascii file that I use to form the
> raster
> library(raster)
>
> setwd("f:/Grids")
> r2 <- raster("idgd_wgs.asc")
> library(raster)
>
> library(gstat)
> IDW <- gstat(id = "z", formula = z~1, locations = ~x+y, data=da1,
> set=list(idp =2))
> IDWRaster <- interpolate(r2, IDW)
>
> Any suggestion appreciated.
> Thanks.
> minti
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>


From Roger.Bivand at nhh.no  Sun Dec  2 15:16:07 2012
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sun, 2 Dec 2012 15:16:07 +0100
Subject: [R-sig-Geo] Error:can not allocate vector of size ...,
 using ff or bigmemory?
In-Reply-To: <CAD4guxNBoMvtQkW9LmNGTg2SOCfHACBaeuQ5LJ5sqDZ-1kgAxA@mail.gmail.com>
References: <11DC569BD7493645998AD27DA1F01E273B2AEB0E@MBOX-B-6.du.deakin.edu.au>
	<CAD4guxNBoMvtQkW9LmNGTg2SOCfHACBaeuQ5LJ5sqDZ-1kgAxA@mail.gmail.com>
Message-ID: <alpine.LRH.2.02.1212021511090.6842@reclus.nhh.no>

On Sun, 2 Dec 2012, Raffaele Morelli wrote:

> 2012/12/2 ADAM PETER CARDILINI <apcar at deakin.edu.au>
>
>> G'day Everyone,
>>
>> I have recently been trying to run some analysis on very large raster
>> files (~200mb, file found here<
>> https://www.ga.gov.au/products/servlet/controller?event=FILE_SELECTION&catno=71071>
>> the first option "Tagged Image File Format (TIFF), Contains the final 34
>> DLC classes, 25.77MB") for Australian land cover. I can successfully read
>> this file into R and isolate the information I am interested in, eg.,
>>
>> # to get a tree cover map, where tree cover is 1 and everything else is 0
>> library(raster)
>>                                 landcover<-raster("landcover_file.tiff") #
>> I can only open the large TIFF file as a raster?
>> isBecomes<
>> -cbind(c(1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34),c(NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,1,1,NA,NA))
>> treecover <- reclass(landcover, rcl=isBecomes)
>>
>> I would then like to get some distance data from this treecover map using
>> gdistance. I try to create a transition matrix from the treecover raster
>> (which will be incredibly huge) and get the Error: can not allocate vector
>> of size ... .
>>
>>                                 library(gdistance)
>> tr1 <- transition(r, transitionFunction=mean, directions=8)
>>
>> Error: cannot allocate vector of size 1.1 Gb
>> In addition: Warning messages:
>> 1: In `slot<-`(.Object, slotName, check = FALSE, slotVal) :
>>   Reached total allocation of 3892Mb: see help(memory.size)
>> 2: In `slot<-`(.Object, slotName, check = FALSE, slotVal) :
>>   Reached total allocation of 3892Mb: see help(memory.size)
>> 3: In `slot<-`(.Object, slotName, check = FALSE, slotVal) :
>>   Reached total allocation of 3892Mb: see help(memory.size)
>> 4: In `slot<-`(.Object, slotName, check = FALSE, slotVal) :
>>   Reached total allocation of 3892Mb: see help(memory.size)
>>
>> I am wondering what I could do to get around this? Is there a better way
>> to work with such large files? I have been reading up on ff and bigmemory
>> but am finding it hard to find a simple introduction that explains how to
>> work with raster files in these frameworks. In other words, I sort of get
>> what these packages are doing I just don't understand how to implement
>> them. Does anyone have example code for importing a raster using ff and
>> then working on it with some functions?
>>
>> I am running 64bit R on a laptop with only 4GB RAM. The only other thing I
>> can think of doing is using a machine with more RAM, unfortunately that's
>> not really an option. Any suggestions or help would be great and really
>> appreciated. Thanks in advance for your time and suggestions.
>>
>>
>> Kind regards,
>>
>> Adam Cardilini
>>
>
> More RAM won't help you, I've had the same problem on a 9GB RAM Dell server
> with 8 processors and it really seems that R can't handle such big
> rasters...

I believe that you mean that you "can't handle such big rasters..."? The 
underlying question is related to your workflow, and to whether your 
distances could better be represented as sparse matrices, dropping 
measuements beyond a given threshold. Probably you don't need all the 
distances, so if you think through the logic of what you want to do, I 
don't doubt that you can get there. If you ask any system to do something 
rash (like measure and store lots of distances you will subsequently 
discard), you shouldn't be surprised when it runs out of resources.

Roger

>
> BTW I didn't know about "ff" and "bigmemory", I'll have a look
>
> -raffaele
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From Roger.Bivand at nhh.no  Sun Dec  2 15:40:25 2012
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sun, 2 Dec 2012 15:40:25 +0100
Subject: [R-sig-Geo] Replacement shapefiles with SpatiaLite for R-geo
 packages(spdep, rgeos etc.)
In-Reply-To: <420707.68405.qm@web200207.mail.kks.yahoo.co.jp>
References: <420707.68405.qm@web200207.mail.kks.yahoo.co.jp>
Message-ID: <alpine.LRH.2.02.1212021520420.6842@reclus.nhh.no>

On Sun, 2 Dec 2012, hi_ono2001 at ybb.ne.jp wrote:

> Hello.
>
> Recently SpatiaLite 4.0 was released. It has lots of powerful, fast and 
> robust functions for Geoprocessing(spatial queries, overlay analysis, 
> creating topology, network analysis, gridding, creating TIN/voronois). 
> Some people say SpatiaLite is one of candidate to next standard spatial 
> data format.

Spatialite is supported by OGR in rgdal if the drivers are available. Its 
future status is unknown, but of course we should try to make life easier 
for its users. If you could document how easy it is to include the driver 
in the CRAN Windows and OSX binaries, that would help. In my opinion, 
Spatialite should be used through OGR in R, and should not be used for 
topological operations, which blunt the sense of having shared classes in 
R for spatial data. Using OGR means that things stay maintainable.

>
> Current rgeos package seems to be slower and unstable for bigger spatial 
> data. And I think if using SpatiaLite, spdep could create spatial weight 
> matrices more speedy than current ones. If this, R will be exactly "R as 
> a GIS".

Since Spatialite uses the same GEOS dependency as rgeos, you should 
substaniate this claim with clear reproducible cases; rgeos is now pretty 
stable, and misbehaviour now is usually because of erroneous topologies 
(overlaps, slivers and dangles). I would strongly advise against thinking 
that exporting to Spatialite then GEOS, doing GEOS there, and importing 
again, will be faster or more stable than converting Spatial* objects to 
GEOS objects, doing GEOS, and converting back again - the steps are very 
similar, and such a claim would need to be studied carefully. The same 
time could rather be used to contribute to rgeos. Spatial weights matrices 
created in spdep can use STRtrees from GEOS, and are fast (90K polygons in 
10 seconds). But this isn't the default, you need to use extra arguments.

>
> Unfortunately SQLiteMap, R package for accessing SpatiaLite, has been 
> removed from CRAN since this September.

CRAN has been making its management more systematic - if maintainers do 
not respond to requests for corrections, the source packages are archived 
until the maintainers comply. This is why maintainability is crucial. 
Arguably, the package would also be redundant if OGR Spatialite drivers 
were available for those dependent on the CRAN rgdal binaries.

>
> Any plan to employing  this SpatiaLite for current R-geo packages.
>

Please contribute a vignette to a suitable package, showing how one can 
use this storage format with R already. For use of SQL, rather consider 
contributing to helping add OGR SQL to readOGR in rgdal, then other 
drivers would benefit too.

Best wishes,

Roger

> Thanks in advance.
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From jacobvanetten at yahoo.com  Sun Dec  2 18:10:12 2012
From: jacobvanetten at yahoo.com (Jacob van Etten)
Date: Sun, 2 Dec 2012 17:10:12 +0000 (GMT)
Subject: [R-sig-Geo] Problem with update gdistance 1.1-3
In-Reply-To: <161DC602615F6943A19BAEA3DBF2E4B901A8245D006B@HARFANG.intranet.mrn.gouv>
References: <161DC602615F6943A19BAEA3DBF2E4B901A8245D006B@HARFANG.intranet.mrn.gouv>
Message-ID: <1354468212.20160.YahooMailNeo@web29702.mail.ird.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121202/4936d9e4/attachment.pl>

From oliveirajc1 at gmail.com  Sun Dec  2 18:31:59 2012
From: oliveirajc1 at gmail.com (Julio Oliveira)
Date: Sun, 2 Dec 2012 15:31:59 -0200
Subject: [R-sig-Geo] How convert day of the year in year/month/day
In-Reply-To: <mailman.15.1353409205.27475.r-sig-geo@r-project.org>
References: <mailman.15.1353409205.27475.r-sig-geo@r-project.org>
Message-ID: <3E129C60-FA75-43F6-9FD4-72C803BC46D0@gmail.com>

Dears,

I have dates of the type YYYYddd (ex.: 2005135), where 2005 is the year and 135 is day of the year.

I need convert this format for year/month/day (%Y/%b%d).

Thanks.

Julio

From oliveirajc at ufv.br  Sun Dec  2 18:34:14 2012
From: oliveirajc at ufv.br (julio cesar oliveira)
Date: Sun, 2 Dec 2012 15:34:14 -0200
Subject: [R-sig-Geo] How convert Day of Year in Year/month/day
Message-ID: <CAG+u5gqu-AkN82V4yiQo3Z6sTEuoHdbqQS8kwntqfLyASHM4kw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121202/f0328142/attachment.pl>

From yangli at iastate.edu  Sun Dec  2 19:09:23 2012
From: yangli at iastate.edu (Yang Li)
Date: Sun, 02 Dec 2012 12:09:23 -0600
Subject: [R-sig-Geo] How convert day of the year in year/month/day
In-Reply-To: <3E129C60-FA75-43F6-9FD4-72C803BC46D0@gmail.com>
References: <mailman.15.1353409205.27475.r-sig-geo@r-project.org>
	<3E129C60-FA75-43F6-9FD4-72C803BC46D0@gmail.com>
Message-ID: <50BB9953.6020005@iastate.edu>

You could use

 > x <- 2005135
 > strptime(x, format="%Y %j")
[1] "2005-05-15"

Yang

On 12/2/2012 11:31 AM, Julio Oliveira wrote:
> Dears,
>
> I have dates of the type YYYYddd (ex.: 2005135), where 2005 is the year and 135 is day of the year.
>
> I need convert this format for year/month/day (%Y/%b%d).
>
> Thanks.
>
> Julio
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From matteo.mattiuzzi at boku.ac.at  Sun Dec  2 19:15:09 2012
From: matteo.mattiuzzi at boku.ac.at (Matteo Mattiuzzi)
Date: Sun, 02 Dec 2012 19:15:09 +0100
Subject: [R-sig-Geo] Antw:  How convert day of the year in year/month/day
Message-ID: <50BBA8BD02000027000172D5@gwia2.boku.ac.at>

Dear Julio,


format(as.Date("2005135","%Y%j"),"%Y/%b/%d")


Here a nice description of possibilities: http://statistics.berkeley.edu/classes/s133/dates.html


Matteo

>>> Julio Oliveira  02.12.12 18.34 Uhr >>>
Dears,

I have dates of the type YYYYddd (ex.: 2005135), where 2005 is the year and 135 is day of the year.

I need convert this format for year/month/day (%Y/%b%d).

Thanks.

Julio
_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From edzer.pebesma at uni-muenster.de  Sun Dec  2 19:54:00 2012
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Sun, 02 Dec 2012 19:54:00 +0100
Subject: [R-sig-Geo] Replacement shapefiles with SpatiaLite for R-geo
 packages(spdep, rgeos etc.)
In-Reply-To: <alpine.LRH.2.02.1212021520420.6842@reclus.nhh.no>
References: <420707.68405.qm@web200207.mail.kks.yahoo.co.jp>
	<alpine.LRH.2.02.1212021520420.6842@reclus.nhh.no>
Message-ID: <50BBA3C8.3040906@uni-muenster.de>

Roger, what do you mean by "Its [Spatialite's] future status is unknown"?

A few months ago I found an interesting discussion here:
https://groups.google.com/forum/?hl=en&fromgroups=#!topic/geospatial-mobile-data-format-for-vectors/VEri8doLNz4
which convinced me that spatialite is a software, rather than an open
(file) format - the format is of course there, but not specified
otherwise than by the software that reads/writes it (sqlite).

I'm also interested in spatialite, as I do not see other really useful
data formats (although it's not a format!) that can be used to exchange
spatio-temporal data to other environments, say ArcGIS or so.

Taking the OGR path is of interest, but of course OGR has no idea of
time. For this path, the main burden would be there where people prepare
the distributions that are used by the windows and OS-X CRAN build
trains, right?

The R SQLiteMap package, IIRC, was built on top of the SQLite driver
directly without OGR, and parsed the geometry columns directly; I once
looked at it, but was somehow not overwhelmed by enthousiasm and forgot
why -- was it restricted to WKT representation of geometry?

Best regards,


On 12/02/2012 03:40 PM, Roger Bivand wrote:
> On Sun, 2 Dec 2012, hi_ono2001 at ybb.ne.jp wrote:
> 
>> Hello.
>>
>> Recently SpatiaLite 4.0 was released. It has lots of powerful, fast
>> and robust functions for Geoprocessing(spatial queries, overlay
>> analysis, creating topology, network analysis, gridding, creating
>> TIN/voronois). Some people say SpatiaLite is one of candidate to next
>> standard spatial data format.
> 
> Spatialite is supported by OGR in rgdal if the drivers are available.
> Its future status is unknown, but of course we should try to make life
> easier for its users. If you could document how easy it is to include
> the driver in the CRAN Windows and OSX binaries, that would help. In my
> opinion, Spatialite should be used through OGR in R, and should not be
> used for topological operations, which blunt the sense of having shared
> classes in R for spatial data. Using OGR means that things stay
> maintainable.
> 
>>
>> Current rgeos package seems to be slower and unstable for bigger
>> spatial data. And I think if using SpatiaLite, spdep could create
>> spatial weight matrices more speedy than current ones. If this, R will
>> be exactly "R as a GIS".
> 
> Since Spatialite uses the same GEOS dependency as rgeos, you should
> substaniate this claim with clear reproducible cases; rgeos is now
> pretty stable, and misbehaviour now is usually because of erroneous
> topologies (overlaps, slivers and dangles). I would strongly advise
> against thinking that exporting to Spatialite then GEOS, doing GEOS
> there, and importing again, will be faster or more stable than
> converting Spatial* objects to GEOS objects, doing GEOS, and converting
> back again - the steps are very similar, and such a claim would need to
> be studied carefully. The same time could rather be used to contribute
> to rgeos. Spatial weights matrices created in spdep can use STRtrees
> from GEOS, and are fast (90K polygons in 10 seconds). But this isn't the
> default, you need to use extra arguments.
> 
>>
>> Unfortunately SQLiteMap, R package for accessing SpatiaLite, has been
>> removed from CRAN since this September.
> 
> CRAN has been making its management more systematic - if maintainers do
> not respond to requests for corrections, the source packages are
> archived until the maintainers comply. This is why maintainability is
> crucial. Arguably, the package would also be redundant if OGR Spatialite
> drivers were available for those dependent on the CRAN rgdal binaries.
> 
>>
>> Any plan to employing  this SpatiaLite for current R-geo packages.
>>
> 
> Please contribute a vignette to a suitable package, showing how one can
> use this storage format with R already. For use of SQL, rather consider
> contributing to helping add OGR SQL to readOGR in rgdal, then other
> drivers would benefit too.
> 
> Best wishes,
> 
> Roger
> 
>> Thanks in advance.
>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From mdsumner at gmail.com  Sun Dec  2 19:55:50 2012
From: mdsumner at gmail.com (Michael Sumner)
Date: Mon, 3 Dec 2012 05:55:50 +1100
Subject: [R-sig-Geo] How convert Day of Year in Year/month/day
In-Reply-To: <CAG+u5gqu-AkN82V4yiQo3Z6sTEuoHdbqQS8kwntqfLyASHM4kw@mail.gmail.com>
References: <CAG+u5gqu-AkN82V4yiQo3Z6sTEuoHdbqQS8kwntqfLyASHM4kw@mail.gmail.com>
Message-ID: <CAAcGz9-Rvbtat4iJSXGce86etA2jgvOkR-RCxj6FzDEmtQBfZw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121203/018ead7b/attachment.pl>

From osoong+r at gmail.com  Sun Dec  2 21:36:36 2012
From: osoong+r at gmail.com (Oliver Soong)
Date: Sun, 2 Dec 2012 12:36:36 -0800
Subject: [R-sig-Geo] raster::writeRaster access violation
Message-ID: <CAPQ=hVKidLzDqjppsz80YZ8Un-DRTNkB-uDonT04mc0N4T0SaA@mail.gmail.com>

Hi,

I'm getting occasional crashes writing out GeoTIFFs.  For reference,
this is on Windows 7 32-bit, R 2.15.2 (x86), rgdal 0.7.22, and raster
2.0.31.  Windows is reporting an access violation from msvcrt.dll.
When the crash occurs, there is a temporary file in tempdir() and the
correctly written output file in the correct location.  It might
possibly be related to an earlier problem with GDAL.close, which Roger
so kindly fixed a few months back.  That thread is quoted below.

I have not been able to pin down a specific trigger or test case.  I'm
processing a number of rasters, and the error occurs on different
rasters each time I run things.  Suggestions on workarounds and how to
isolate the fault are welcome.

Oliver


On Fri, Sep 21, 2012 at 11:42 AM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
> On Wed, 19 Sep 2012, Oliver Soong wrote:
>
>> I'm processing and outputting a large number of large GeoTIFFs.  Every
>> time I write one, I get a new intermediate file in tempdir().  I do
>> not have enough space in my temporary folder to store all of these
>> intermediates.  I believe these intermediate files back the
>> GDALTransientDataset objects created by create2GDAL called from
>> writeGDAL (I think), which are then copied to a data drive by
>> saveDataset.  After saveDataset, though, the transient object is
>> orphaned.
>>
>> Is it possible to tell rgdal to remove these transients after
>> writing/saveDataset?  Alternatively, is it possible to tell rgdal to
>> write these intermediates to a particular location?
>>
>> I can think of two workarounds, but I'd love to hear better ideas.  I
>> could redirect R's tempdir, although this is rather inconvenient.  I
>> can also try to detect the temporary files and delete them manually,
>> although this is probably driver- and version-specific and so less
>> robust than I would prefer.
>
>
> Thanks for the report. A long time ago, there must have been an issue here,
> because a GDAL.close() - on the wrong object - was commented out. After
> checking, I've committed a fix to the rgdal R-forge project. If you can
> install rgdal from source, I'd be grateful for feedback on that; if you need
> a Windows binary, please let me know, and I'll submit the source package to
> win-builder to create one.
>
> Roger
>
>>
>> Cheers,
>> Oliver
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> --
> Roger Bivand
> Department of Economics, NHH Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>


From mintibezabih at gmail.com  Sun Dec  2 21:53:28 2012
From: mintibezabih at gmail.com (alemante zd)
Date: Sun, 2 Dec 2012 20:53:28 +0000
Subject: [R-sig-Geo] repeated commands... how to loop?
In-Reply-To: <50BB0A42.20508@gmail.com>
References: <CAJfxP+pomqT1VT+v6buO07sdDZn=8yopy-c9avYBUOFYnx=BHQ@mail.gmail.com>
	<50BB0A42.20508@gmail.com>
Message-ID: <CAJfxP+ppwuph90J98DM4KNhsU9ffnaxxt5Eyux9kTncCYZ3J3A@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121202/9a7777bd/attachment.pl>

From edzer.pebesma at uni-muenster.de  Sun Dec  2 22:26:32 2012
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Sun, 02 Dec 2012 22:26:32 +0100
Subject: [R-sig-Geo] repeated commands... how to loop?
In-Reply-To: <CAJfxP+ppwuph90J98DM4KNhsU9ffnaxxt5Eyux9kTncCYZ3J3A@mail.gmail.com>
References: <CAJfxP+pomqT1VT+v6buO07sdDZn=8yopy-c9avYBUOFYnx=BHQ@mail.gmail.com>
	<50BB0A42.20508@gmail.com>
	<CAJfxP+ppwuph90J98DM4KNhsU9ffnaxxt5Eyux9kTncCYZ3J3A@mail.gmail.com>
Message-ID: <50BBC788.1040503@uni-muenster.de>



On 12/02/2012 09:53 PM, alemante zd wrote:
> Thanks Alexandre. Sorry my coding was a bit confusing but I have rectified
> it now. When I run it however, I get error message. The new code and the
> error message I get are as follows:
> 
> library(gstat)
> library(raster)
> x <- 1:10
> #y <- 1:10
> z<- 1:10
> setwd("f:/Grids")
> r2 <- raster("idgd_wgs.asc")
> 
> z.list <- list(z1<-runif(10), z2 <- runif(10), z3 <- runif(10))
> da1<-data.frame(x=1:10, y=1:10)
> for i in 1:length(z.list) {

for (i in 1:length(z.list))

>  da.temp<-data.frame(da1, z=z.list[[i]])
>  IDW.temp <- gstat(id = "z", formula = z~1, locations = ~x+y, data=da.temp,
> set=list(idp =2))
>  IDWRaster.temp <- interpolate(r2, IDW.temp)
>  #add here one or two command lines to save the objects you want to save,
> or check
>  rm(da.temp, IDW.temp, IDWRaster.temp) #remove the temporary elements
> (always safer)
> }
> 
> 
> ### the error message I got is as follows
> 
>> library(gstat)
>> library(raster)
>>
>> x <- 1:10
>> #y <- 1:10
>> z<- 1:10
>> setwd("f:/Grids")
>> r2 <- raster("idgd_wgs.asc")
>>
>>
>> z.list <- list(z1<-runif(10), z2 <- runif(10), z3 <- runif(10))
>> da1<-data.frame(x=1:10, y=1:10)
>>
>> for i in 1:length(z.list) {
> Error: unexpected symbol in "for i"
>>  da.temp<-data.frame(da1, z=z.list[[i]])
> Error in data.frame(da1, z = z.list[[i]]) : object 'i' not found
>>  IDW.temp <- gstat(id = "z", formula = z~1, locations = ~x+y,
> data=da.temp, set=list(idp =2))
> Error in gstat(id = "z", formula = z ~ 1, locations = ~x + y, data =
> da.temp,  :
>   object 'da.temp' not found
>>  IDWRaster.temp <- interpolate(r2, IDW.temp)
> Error in inherits(model, "gstat") : object 'IDW.temp' not found
> In addition: Warning messages:
> 1: In inherits(model, "gstat") : restarting interrupted promise evaluation
> 2: In inherits(model, "gstat") : restarting interrupted promise evaluation
>>  #add here one or two command lines to save the objects you want to save,
> or check
>>  rm(da.temp, IDW.temp, IDWRaster.temp) #remove the temporary elements
> (always safer)
> Warning messages:
> 1: In rm(da.temp, IDW.temp, IDWRaster.temp) : object 'da.temp' not found
> 2: In rm(da.temp, IDW.temp, IDWRaster.temp) : object 'IDW.temp' not found
> 3: In rm(da.temp, IDW.temp, IDWRaster.temp) :
>   object 'IDWRaster.temp' not found
>> }
> Error: unexpected '}' in "}"
> thanks
> //minti
> 
> On Sun, Dec 2, 2012 at 7:58 AM, Alexandre Villers <
> villers.alexandre at gmail.com> wrote:
> 
>> Hello,
>>
>> It's not really clear from your message whether y1, y2, y3 are the y part
>> of x/y coordinates, and
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From Roger.Bivand at nhh.no  Mon Dec  3 09:29:09 2012
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 3 Dec 2012 09:29:09 +0100
Subject: [R-sig-Geo] Replacement shapefiles with SpatiaLite for R-geo
 packages(spdep, rgeos etc.)
In-Reply-To: <50BBA3C8.3040906@uni-muenster.de>
References: <420707.68405.qm@web200207.mail.kks.yahoo.co.jp>
	<alpine.LRH.2.02.1212021520420.6842@reclus.nhh.no>
	<50BBA3C8.3040906@uni-muenster.de>
Message-ID: <alpine.LRH.2.02.1212030907480.9485@reclus.nhh.no>

On Sun, 2 Dec 2012, Edzer Pebesma wrote:

> Roger, what do you mean by "Its [Spatialite's] future status is unknown"?

Only that people have been talking it up, but I haven't seen data on 
adoption (or repeated pleas from users) that would show that it has 
reached a critical mass of any kind, let alone of the mass/mess of 
shapefiles. So for the time being, OGR is the obvious route, but building 
spatialite without Excel, without GEOS, etc. I found its compile option to 
include GEOS development (trunk) features very concerning - even GEOS 
advise against building against its experimental features.

>
> A few months ago I found an interesting discussion here:
> https://groups.google.com/forum/?hl=en&fromgroups=#!topic/geospatial-mobile-data-format-for-vectors/VEri8doLNz4
> which convinced me that spatialite is a software, rather than an open
> (file) format - the format is of course there, but not specified
> otherwise than by the software that reads/writes it (sqlite).
>

Well, if it is software, someone could Rcpp it, but I don't see why, when 
what it offers for us is GEOS again, and probably more muddle on CRS and 
codepages - controlling what GDAL/OGR do is a serious enough task without 
mixing in less well-judged and cautious software (QGIS?). My take on the 
discussion you cite would be close to Paul Ramsey's doubts.

> I'm also interested in spatialite, as I do not see other really useful
> data formats (although it's not a format!) that can be used to exchange
> spatio-temporal data to other environments, say ArcGIS or so.
>

Well, OGR could move in that direction, couldn't it? Then some drivers 
would be have temporal capabilities, others not; of course, someone would 
need to do some work on generalisable data models, but OGR could lead 
here (INPE?).

> Taking the OGR path is of interest, but of course OGR has no idea of
> time. For this path, the main burden would be there where people prepare
> the distributions that are used by the windows and OS-X CRAN build
> trains, right?

That's why contributing upstream to OGR is a better idea, unless the data 
models would become too convoluted. The same applies - as I wrote - to SQL 
in OGR.

>
> The R SQLiteMap package, IIRC, was built on top of the SQLite driver
> directly without OGR, and parsed the geometry columns directly; I once
> looked at it, but was somehow not overwhelmed by enthousiasm and forgot
> why -- was it restricted to WKT representation of geometry?
>

It was written for a particular purpose some time ago, and is now orphaned 
by its authors. CRAN policy is to orphan maintainerless packages that have 
unanswered issues.

Best wishes,

Roger

> Best regards,
>
>
> On 12/02/2012 03:40 PM, Roger Bivand wrote:
>> On Sun, 2 Dec 2012, hi_ono2001 at ybb.ne.jp wrote:
>>
>>> Hello.
>>>
>>> Recently SpatiaLite 4.0 was released. It has lots of powerful, fast
>>> and robust functions for Geoprocessing(spatial queries, overlay
>>> analysis, creating topology, network analysis, gridding, creating
>>> TIN/voronois). Some people say SpatiaLite is one of candidate to next
>>> standard spatial data format.
>>
>> Spatialite is supported by OGR in rgdal if the drivers are available.
>> Its future status is unknown, but of course we should try to make life
>> easier for its users. If you could document how easy it is to include
>> the driver in the CRAN Windows and OSX binaries, that would help. In my
>> opinion, Spatialite should be used through OGR in R, and should not be
>> used for topological operations, which blunt the sense of having shared
>> classes in R for spatial data. Using OGR means that things stay
>> maintainable.
>>
>>>
>>> Current rgeos package seems to be slower and unstable for bigger
>>> spatial data. And I think if using SpatiaLite, spdep could create
>>> spatial weight matrices more speedy than current ones. If this, R will
>>> be exactly "R as a GIS".
>>
>> Since Spatialite uses the same GEOS dependency as rgeos, you should
>> substaniate this claim with clear reproducible cases; rgeos is now
>> pretty stable, and misbehaviour now is usually because of erroneous
>> topologies (overlaps, slivers and dangles). I would strongly advise
>> against thinking that exporting to Spatialite then GEOS, doing GEOS
>> there, and importing again, will be faster or more stable than
>> converting Spatial* objects to GEOS objects, doing GEOS, and converting
>> back again - the steps are very similar, and such a claim would need to
>> be studied carefully. The same time could rather be used to contribute
>> to rgeos. Spatial weights matrices created in spdep can use STRtrees
>> from GEOS, and are fast (90K polygons in 10 seconds). But this isn't the
>> default, you need to use extra arguments.
>>
>>>
>>> Unfortunately SQLiteMap, R package for accessing SpatiaLite, has been
>>> removed from CRAN since this September.
>>
>> CRAN has been making its management more systematic - if maintainers do
>> not respond to requests for corrections, the source packages are
>> archived until the maintainers comply. This is why maintainability is
>> crucial. Arguably, the package would also be redundant if OGR Spatialite
>> drivers were available for those dependent on the CRAN rgdal binaries.
>>
>>>
>>> Any plan to employing  this SpatiaLite for current R-geo packages.
>>>
>>
>> Please contribute a vignette to a suitable package, showing how one can
>> use this storage format with R already. For use of SQL, rather consider
>> contributing to helping add OGR SQL to readOGR in rgdal, then other
>> drivers would benefit too.
>>
>> Best wishes,
>>
>> Roger
>>
>>> Thanks in advance.
>>>
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From Terry.Beutel at daff.qld.gov.au  Mon Dec  3 09:55:07 2012
From: Terry.Beutel at daff.qld.gov.au (Beutel, Terry S)
Date: Mon, 3 Dec 2012 18:55:07 +1000
Subject: [R-sig-Geo] Regression of a raster brick on image dates with NAs
Message-ID: <8DDC710ABE58694FB90E74D26915702C47A1AD7EDF@SPIBSRVPR08.org.local>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121203/b4dcc04b/attachment.pl>

From apcar at deakin.edu.au  Mon Dec  3 11:01:52 2012
From: apcar at deakin.edu.au (Adam)
Date: Mon, 3 Dec 2012 02:01:52 -0800 (PST)
Subject: [R-sig-Geo] Error:can not allocate vector of size ...,
 using ff or bigmemory?
In-Reply-To: <alpine.LRH.2.02.1212021511090.6842@reclus.nhh.no>
References: <11DC569BD7493645998AD27DA1F01E273B2AEB0E@MBOX-B-6.du.deakin.edu.au>
	<CAD4guxNBoMvtQkW9LmNGTg2SOCfHACBaeuQ5LJ5sqDZ-1kgAxA@mail.gmail.com>
	<alpine.LRH.2.02.1212021511090.6842@reclus.nhh.no>
Message-ID: <1354528912457-7581834.post@n2.nabble.com>

Roger Bivand wrote
> 
> I believe that you mean that you "can't handle such big rasters..."? The 
> underlying question is related to your workflow, and to whether your 
> distances could better be represented as sparse matrices, dropping 
> measuements beyond a given threshold. Probably you don't need all the 
> distances, so if you think through the logic of what you want to do, I 
> don't doubt that you can get there. If you ask any system to do something 
> rash (like measure and store lots of distances you will subsequently 
> discard), you shouldn't be surprised when it runs out of resources.
> 
> Roger

Thanks Roger,
 
Yes, I do mean I can't handle them, sorry. I will try cutting out all of the
useless stuff and give it another go.

Cheers,
Adam



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Error-can-not-allocate-vector-of-size-using-ff-or-bigmemory-tp7581815p7581834.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From j.boutet at conservatoirepicardie.org  Mon Dec  3 12:05:36 2012
From: j.boutet at conservatoirepicardie.org (j.boutet at conservatoirepicardie.org)
Date: Mon, 3 Dec 2012 12:05:36 +0100 (CET)
Subject: [R-sig-Geo] =?utf-8?q?_R=C3=A9ponse_automatique?=
Message-ID: <201212031105.qB3B5aJm049457@albane6.nfrance.com>




Bonjour,



Je serais en cong?s jusqu'au Jeudi 6 D?cembre.

Pour des raisons d'urgence, vous pourrez me contacter par t?l?phone au 06 46 34 81 03.



Cordialement,



------------------



J?r?me Boutet

Conservatoire d'espaces naturels de Picardie

1, place Ginkgo - village Oasis

80 044 AMIENS cedex 

t?l : 03 22 89 84 24 



> From: r-sig-geo-request at r-project.org
> Subject: R-sig-Geo Digest, Vol 112, Issue 3
> Date: Mon, 03 Dec 2012 12:00:04 +0100


From mintibezabih at gmail.com  Mon Dec  3 17:54:00 2012
From: mintibezabih at gmail.com (alemante zd)
Date: Mon, 3 Dec 2012 16:54:00 +0000
Subject: [R-sig-Geo] repeated commands... how to loop?
In-Reply-To: <CAFrtd2Pmain9O1R=aux-YWvrPW=dF99hJCrLATT7pWoR3ah6GQ@mail.gmail.com>
References: <CAJfxP+pomqT1VT+v6buO07sdDZn=8yopy-c9avYBUOFYnx=BHQ@mail.gmail.com>
	<50BB0A42.20508@gmail.com>
	<CAJfxP+ppwuph90J98DM4KNhsU9ffnaxxt5Eyux9kTncCYZ3J3A@mail.gmail.com>
	<CAFrtd2Pmain9O1R=aux-YWvrPW=dF99hJCrLATT7pWoR3ah6GQ@mail.gmail.com>
Message-ID: <CAJfxP+qQO-ODY2J2dpFAE7H=dCfqBdv8h9yYDDa7Zp_mQC+XCA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121203/5055aaa2/attachment.pl>

From Roger.Bivand at nhh.no  Mon Dec  3 20:07:37 2012
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 3 Dec 2012 20:07:37 +0100
Subject: [R-sig-Geo] Replacement shapefiles with SpatiaLite for R-geo
 packages(spdep, rgeos etc.)
In-Reply-To: <alpine.LRH.2.02.1212030907480.9485@reclus.nhh.no>
References: <420707.68405.qm@web200207.mail.kks.yahoo.co.jp>
	<alpine.LRH.2.02.1212021520420.6842@reclus.nhh.no>
	<50BBA3C8.3040906@uni-muenster.de>
	<alpine.LRH.2.02.1212030907480.9485@reclus.nhh.no>
Message-ID: <alpine.LRH.2.02.1212032003500.10980@reclus.nhh.no>

On Mon, 3 Dec 2012, Roger Bivand wrote:

> On Sun, 2 Dec 2012, Edzer Pebesma wrote:
>
>> Roger, what do you mean by "Its [Spatialite's] future status is unknown"?

In addition, in trying to see the benefits of the file format, I loaded:

https://groups.google.com/group/spatialite-users/attach/9fd2f47b1a686829/meridian_test.7z?part=4&view=1

(3.6 MB) into R as three layers (rivers, rail, woods). In R, the sum of 
the layers is 20KB. Am I missing something, or is the format bloated? 
Maybe the choice made by GADM to distribute in RData format makes more 
sense? GDAL already supports SpatialGridDataFrame objects.

Roger

>
> Only that people have been talking it up, but I haven't seen data on adoption 
> (or repeated pleas from users) that would show that it has reached a critical 
> mass of any kind, let alone of the mass/mess of shapefiles. So for the time 
> being, OGR is the obvious route, but building spatialite without Excel, 
> without GEOS, etc. I found its compile option to include GEOS development 
> (trunk) features very concerning - even GEOS advise against building against 
> its experimental features.
>
>> 
>> A few months ago I found an interesting discussion here:
>> https://groups.google.com/forum/?hl=en&fromgroups=#!topic/geospatial-mobile-data-format-for-vectors/VEri8doLNz4
>> which convinced me that spatialite is a software, rather than an open
>> (file) format - the format is of course there, but not specified
>> otherwise than by the software that reads/writes it (sqlite).
>> 
>
> Well, if it is software, someone could Rcpp it, but I don't see why, when 
> what it offers for us is GEOS again, and probably more muddle on CRS and 
> codepages - controlling what GDAL/OGR do is a serious enough task without 
> mixing in less well-judged and cautious software (QGIS?). My take on the 
> discussion you cite would be close to Paul Ramsey's doubts.
>
>> I'm also interested in spatialite, as I do not see other really useful
>> data formats (although it's not a format!) that can be used to exchange
>> spatio-temporal data to other environments, say ArcGIS or so.
>> 
>
> Well, OGR could move in that direction, couldn't it? Then some drivers would 
> be have temporal capabilities, others not; of course, someone would need to 
> do some work on generalisable data models, but OGR could lead here (INPE?).
>
>> Taking the OGR path is of interest, but of course OGR has no idea of
>> time. For this path, the main burden would be there where people prepare
>> the distributions that are used by the windows and OS-X CRAN build
>> trains, right?
>
> That's why contributing upstream to OGR is a better idea, unless the data 
> models would become too convoluted. The same applies - as I wrote - to SQL in 
> OGR.
>
>> 
>> The R SQLiteMap package, IIRC, was built on top of the SQLite driver
>> directly without OGR, and parsed the geometry columns directly; I once
>> looked at it, but was somehow not overwhelmed by enthousiasm and forgot
>> why -- was it restricted to WKT representation of geometry?
>> 
>
> It was written for a particular purpose some time ago, and is now orphaned by 
> its authors. CRAN policy is to orphan maintainerless packages that have 
> unanswered issues.
>
> Best wishes,
>
> Roger
>
>> Best regards,
>> 
>> 
>> On 12/02/2012 03:40 PM, Roger Bivand wrote:
>>> On Sun, 2 Dec 2012, hi_ono2001 at ybb.ne.jp wrote:
>>> 
>>>> Hello.
>>>> 
>>>> Recently SpatiaLite 4.0 was released. It has lots of powerful, fast
>>>> and robust functions for Geoprocessing(spatial queries, overlay
>>>> analysis, creating topology, network analysis, gridding, creating
>>>> TIN/voronois). Some people say SpatiaLite is one of candidate to next
>>>> standard spatial data format.
>>> 
>>> Spatialite is supported by OGR in rgdal if the drivers are available.
>>> Its future status is unknown, but of course we should try to make life
>>> easier for its users. If you could document how easy it is to include
>>> the driver in the CRAN Windows and OSX binaries, that would help. In my
>>> opinion, Spatialite should be used through OGR in R, and should not be
>>> used for topological operations, which blunt the sense of having shared
>>> classes in R for spatial data. Using OGR means that things stay
>>> maintainable.
>>> 
>>>> 
>>>> Current rgeos package seems to be slower and unstable for bigger
>>>> spatial data. And I think if using SpatiaLite, spdep could create
>>>> spatial weight matrices more speedy than current ones. If this, R will
>>>> be exactly "R as a GIS".
>>> 
>>> Since Spatialite uses the same GEOS dependency as rgeos, you should
>>> substaniate this claim with clear reproducible cases; rgeos is now
>>> pretty stable, and misbehaviour now is usually because of erroneous
>>> topologies (overlaps, slivers and dangles). I would strongly advise
>>> against thinking that exporting to Spatialite then GEOS, doing GEOS
>>> there, and importing again, will be faster or more stable than
>>> converting Spatial* objects to GEOS objects, doing GEOS, and converting
>>> back again - the steps are very similar, and such a claim would need to
>>> be studied carefully. The same time could rather be used to contribute
>>> to rgeos. Spatial weights matrices created in spdep can use STRtrees
>>> from GEOS, and are fast (90K polygons in 10 seconds). But this isn't the
>>> default, you need to use extra arguments.
>>> 
>>>> 
>>>> Unfortunately SQLiteMap, R package for accessing SpatiaLite, has been
>>>> removed from CRAN since this September.
>>> 
>>> CRAN has been making its management more systematic - if maintainers do
>>> not respond to requests for corrections, the source packages are
>>> archived until the maintainers comply. This is why maintainability is
>>> crucial. Arguably, the package would also be redundant if OGR Spatialite
>>> drivers were available for those dependent on the CRAN rgdal binaries.
>>> 
>>>> 
>>>> Any plan to employing  this SpatiaLite for current R-geo packages.
>>>> 
>>> 
>>> Please contribute a vignette to a suitable package, showing how one can
>>> use this storage format with R already. For use of SQL, rather consider
>>> contributing to helping add OGR SQL to readOGR in rgdal, then other
>>> drivers would benefit too.
>>> 
>>> Best wishes,
>>> 
>>> Roger
>>> 
>>>> Thanks in advance.
>>>> 
>>>> 
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at r-project.org
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>> 
>>> 
>> 
>> 
>
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From Terry.Beutel at daff.qld.gov.au  Tue Dec  4 00:27:47 2012
From: Terry.Beutel at daff.qld.gov.au (Beutel, Terry S)
Date: Tue, 4 Dec 2012 09:27:47 +1000
Subject: [R-sig-Geo] Regression of a raster brick on image dates with NAs
In-Reply-To: <8DDC710ABE58694FB90E74D26915702C47A1AD7EDF@SPIBSRVPR08.org.local>
References: <8DDC710ABE58694FB90E74D26915702C47A1AD7EDF@SPIBSRVPR08.org.local>
Message-ID: <8DDC710ABE58694FB90E74D26915702C47A1AD7F7C@SPIBSRVPR08.org.local>

Apologies, but after further searching, I see the problem is addressed here

https://stat.ethz.ch/pipermail/r-sig-geo/2012-April/014824.html

Regards

Terry

-----Original Message-----
From: r-sig-geo-bounces at r-project.org [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of Beutel, Terry S
Sent: Monday, 3 December 2012 6:55 PM
To: r-sig-geo at r-project.org
Subject: [R-sig-Geo] Regression of a raster brick on image dates with NAs

Hi
I have a raster brick composed of multiple date imagery, and I want to regress the pixel values on image dates to generate an image of the slope coefficents. This is covered in the Raster package help files (p35) as

# regression of values in one brick (or stack) with 'time'
time <- 1:nlayers(s)
fun <- function(x) { lm(x ~ time)$coefficients[2] }
x2 <- calc(s, fun)

The above to work well if there are sufficient non NA values in each pixel column to allow a regression. However if the brick includes pixel columns that are NA on all dates, the above approach delivers the following for me

Error in .calcTest(x[1:5], fun, na.rm, forcefun, forceapply) :   cannot use this function

I have tried inserting an additional layer (layer 1 below) in the raster brick that provides a count of the number of non NA cells in that pixel column, and use this to determine conduct a regression only where sufficient data are available, but the same error is returned. ie

> fun <- function(data) { ifelse (subset(data,1)>4,lm(subset(data,c(2:5)) ~ 1)$coefficients[2],99) }
> out<-calc(data,fun)
Error in .calcTest(x[1:5], fun, na.rm, forcefun, forceapply) :   cannot use this function

Can anyone suggest where I am going wrong? I suspect this is too common a problem not to have been covered somewhere before, but I was unable to find a relevant post so apologies if I have missed it in the archive,

Many thanks



Dr Terry Beutel

Senior Scientist

Agri-Science Queensland



	[[alternative HTML version deleted]]

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From macqueen1 at llnl.gov  Tue Dec  4 02:03:39 2012
From: macqueen1 at llnl.gov (MacQueen, Don)
Date: Tue, 4 Dec 2012 01:03:39 +0000
Subject: [R-sig-Geo] readOGR or writeOGR not closing connections?
Message-ID: <5E1B812FAC2C4A49B3D99593B5A5219115B973@PRDEXMBX-08.the-lab.llnl.gov>

I am using R to help me interactively create and manage GIS layers, stored
as shapefiles, and I'm encountering a problem. From time to time I get an
error:

Error in writeOGR(tmpp, "shps", fn, "a.name", driver = "ESRI Shapefile", :
Layer creation failed

I can work around it by quitting and restarting R, but it would be nice if
I didn't have to.


Below is a little script that reproduces the behavior (on my machine).
('shps' is a sub-directory)



The implication, as I see it, is that one or both of readOGR or writeOGR
is not closing some connections. If I'm right about this, it would be nice
to have a way to force-close them whenever necessary, but I haven't found
a way to do that. Information for how, or any other suggestions, would be
appreciated.



Note that in each iteration there are 4 files written and 4 files read.
  2*4*14=112
which is getting close to the number available according to ?open:

-- quote --
    A maximum of 128 connections can be allocated (not necessarily
     open) at any one time.  Three of these are pre-allocated (see
     'stdout').  The OS will impose limits on the numbers of
     connections of various types, but these are usually larger than
     125.
-- end quote --





#### begin script
require(sp)
require(rgdal)

print(sessionInfo())

data(meuse.grid)
coordinates(meuse.grid) = ~x+y
tmpp <- meuse.grid[1:10,]

for(i in 1:100) {
  fn <- paste('tmpp',i,sep='')
  writeOGR(tmpp, 'shps',fn,'a.name',driver='ESRI Shapefile',
overwrite_layer=TRUE)
  foo <- readOGR('shps',fn)
}

print(sessionInfo())
#### end script


And here is the output when I source the script in a fresh R session

-----------------------------
>source('try-problem.r')
Loading required package: sp
Loading required package: rgdal
rgdal: (SVN revision 360)
Geospatial Data Abstraction Library extensions to R successfully loaded
Loaded GDAL runtime: GDAL 1.9.0, released 2011/12/29
Path to GDAL shared files:
/Library/Frameworks/R.framework/Versions/2.15/Resources/library/rgdal/gdal
Loaded PROJ.4 runtime: Rel. 4.8.0, 6 March 2012, [PJ_VERSION: 480]
Path to PROJ.4 shared files:
/Library/Frameworks/R.framework/Versions/2.15/Resources/library/rgdal/proj

R version 2.15.2 (2012-10-26)
Platform: x86_64-apple-darwin9.8.0/x86_64 (64-bit)

locale:
[1] C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] rgdal_0.7-24 sp_1.0-2

loaded via a namespace (and not attached):
[1] grid_2.15.2     lattice_0.20-10

OGR data source with driver: ESRI Shapefile
Source: "shps", layer: "tmpp1"
with 10 features and 5 fields
Feature type: wkbPoint with 2 dimensions
OGR data source with driver: ESRI Shapefile
Source: "shps", layer: "tmpp2"
with 10 features and 5 fields
Feature type: wkbPoint with 2 dimensions

--- output from iterations 2 through 12 omitted ---

OGR data source with driver: ESRI Shapefile
Source: "shps", layer: "tmpp13"
with 10 features and 5 fields
Feature type: wkbPoint with 2 dimensions
OGR data source with driver: ESRI Shapefile
Source: "shps", layer: "tmpp14"
with 10 features and 5 fields
Feature type: wkbPoint with 2 dimensions
Error in writeOGR(tmpp, "shps", fn, "a.name", driver = "ESRI Shapefile",  :
  Layer creation failed
>

## then manually:

>print(sessionInfo())
Error in gzfile(file, "rb") : cannot open the connection
In addition: Warning message:
In gzfile(file, "rb") :
  cannot open compressed file
'/Library/Frameworks/R.framework/Versions/2.15/Resources/library/rgdal/Meta
/package.rds', probable reason 'Too many open files'



I'm beginning to suspect this has to do with "gzcon" or "gzfile"
connections (not sure of correct terminology).
?open also says,

-- quote --
     'close' closes and destroys a connection.  This will happen
     automatically in due course (with a warning) if there is no longer
     an R object referring to the connection.
-- end quote --

But ?showConnections says

-- quote --
... However, if there is no R level object referring to
     the connection it will be closed automatically at the next garbage
     collection (except for 'gzcon' connections).
-- end quote --


So if read/write OGR involve zipping and unzipping, I guess the
connections don't get closed. (?)

Anyway, it would be very nice if I didn't have to quit and restart my R
sessions every so often when I'm working with my shapefiles.


Thanks
-Don


From Roger.Bivand at nhh.no  Tue Dec  4 09:52:16 2012
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 4 Dec 2012 09:52:16 +0100
Subject: [R-sig-Geo] readOGR or writeOGR not closing connections?
In-Reply-To: <5E1B812FAC2C4A49B3D99593B5A5219115B973@PRDEXMBX-08.the-lab.llnl.gov>
References: <5E1B812FAC2C4A49B3D99593B5A5219115B973@PRDEXMBX-08.the-lab.llnl.gov>
Message-ID: <alpine.LRH.2.02.1212040934060.13781@reclus.nhh.no>

On Tue, 4 Dec 2012, MacQueen, Don wrote:

> I am using R to help me interactively create and manage GIS layers, stored
> as shapefiles, and I'm encountering a problem. From time to time I get an
> error:
>
> Error in writeOGR(tmpp, "shps", fn, "a.name", driver = "ESRI Shapefile", :
> Layer creation failed
>
> I can work around it by quitting and restarting R, but it would be nice if
> I didn't have to.
>
> Below is a little script that reproduces the behavior (on my machine).
> ('shps' is a sub-directory)
>
> The implication, as I see it, is that one or both of readOGR or writeOGR
> is not closing some connections. If I'm right about this, it would be nice
> to have a way to force-close them whenever necessary, but I haven't found
> a way to do that. Information for how, or any other suggestions, would be
> appreciated.
>

Don,

Thanks for a helpful report. Your diagnosis is, however, wrong. The files 
left open are a consequence of checking introduced in GDAL 1.8, meant by 
GDAL to prevent overwriting of layers. Because of this, the 
check_exists=NULL argument was introduced into writeOGR(), defaulting to 
FALSE before 1.8, TRUE >= 1.8. When TRUE, the C++ ogrInfo() was called to 
see whether the dsn and layer exist, and if so, and if 
overwrite_layer=TRUE, the layer is deleted. However, if the layer did not 
exist in the dsn, the C++ ogrInfo() error-exited, the error was trapped, 
and no deletion occurred.

In your case, with GDAL 1.9, check_exists is TRUE, the files did not 
exist, but the dsn was left open (and shapefile dsn open all the layers in 
the folder, then check to see if the required layer is present). The C++ 
ogrInfo() - committed to R-forge SVN, revision 395 - now closes the dsn on 
error, so your example runs fine. It would also have run (the first time) 
with check_exists=FALSE.

If you can install rgdal from source, I'd be grateful for confirmation 
that the bugfix works in your production setting.

Roger

>
>
> Note that in each iteration there are 4 files written and 4 files read.
>  2*4*14=112
> which is getting close to the number available according to ?open:
>
> -- quote --
>    A maximum of 128 connections can be allocated (not necessarily
>     open) at any one time.  Three of these are pre-allocated (see
>     'stdout').  The OS will impose limits on the numbers of
>     connections of various types, but these are usually larger than
>     125.
> -- end quote --
>
>
>
>
>
> #### begin script
> require(sp)
> require(rgdal)
>
> print(sessionInfo())
>
> data(meuse.grid)
> coordinates(meuse.grid) = ~x+y
> tmpp <- meuse.grid[1:10,]
>
> for(i in 1:100) {
>  fn <- paste('tmpp',i,sep='')
>  writeOGR(tmpp, 'shps',fn,'a.name',driver='ESRI Shapefile',
> overwrite_layer=TRUE)
>  foo <- readOGR('shps',fn)
> }
>
> print(sessionInfo())
> #### end script
>
>
> And here is the output when I source the script in a fresh R session
>
> -----------------------------
>> source('try-problem.r')
> Loading required package: sp
> Loading required package: rgdal
> rgdal: (SVN revision 360)
> Geospatial Data Abstraction Library extensions to R successfully loaded
> Loaded GDAL runtime: GDAL 1.9.0, released 2011/12/29
> Path to GDAL shared files:
> /Library/Frameworks/R.framework/Versions/2.15/Resources/library/rgdal/gdal
> Loaded PROJ.4 runtime: Rel. 4.8.0, 6 March 2012, [PJ_VERSION: 480]
> Path to PROJ.4 shared files:
> /Library/Frameworks/R.framework/Versions/2.15/Resources/library/rgdal/proj
>
> R version 2.15.2 (2012-10-26)
> Platform: x86_64-apple-darwin9.8.0/x86_64 (64-bit)
>
> locale:
> [1] C
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> other attached packages:
> [1] rgdal_0.7-24 sp_1.0-2
>
> loaded via a namespace (and not attached):
> [1] grid_2.15.2     lattice_0.20-10
>
> OGR data source with driver: ESRI Shapefile
> Source: "shps", layer: "tmpp1"
> with 10 features and 5 fields
> Feature type: wkbPoint with 2 dimensions
> OGR data source with driver: ESRI Shapefile
> Source: "shps", layer: "tmpp2"
> with 10 features and 5 fields
> Feature type: wkbPoint with 2 dimensions
>
> --- output from iterations 2 through 12 omitted ---
>
> OGR data source with driver: ESRI Shapefile
> Source: "shps", layer: "tmpp13"
> with 10 features and 5 fields
> Feature type: wkbPoint with 2 dimensions
> OGR data source with driver: ESRI Shapefile
> Source: "shps", layer: "tmpp14"
> with 10 features and 5 fields
> Feature type: wkbPoint with 2 dimensions
> Error in writeOGR(tmpp, "shps", fn, "a.name", driver = "ESRI Shapefile",  :
>  Layer creation failed
>>
>
> ## then manually:
>
>> print(sessionInfo())
> Error in gzfile(file, "rb") : cannot open the connection
> In addition: Warning message:
> In gzfile(file, "rb") :
>  cannot open compressed file
> '/Library/Frameworks/R.framework/Versions/2.15/Resources/library/rgdal/Meta
> /package.rds', probable reason 'Too many open files'
>
>
>
> I'm beginning to suspect this has to do with "gzcon" or "gzfile"
> connections (not sure of correct terminology).
> ?open also says,
>
> -- quote --
>     'close' closes and destroys a connection.  This will happen
>     automatically in due course (with a warning) if there is no longer
>     an R object referring to the connection.
> -- end quote --
>
> But ?showConnections says
>
> -- quote --
> ... However, if there is no R level object referring to
>     the connection it will be closed automatically at the next garbage
>     collection (except for 'gzcon' connections).
> -- end quote --
>
>
> So if read/write OGR involve zipping and unzipping, I guess the
> connections don't get closed. (?)
>
> Anyway, it would be very nice if I didn't have to quit and restart my R
> sessions every so often when I'm working with my shapefiles.
>
>
> Thanks
> -Don
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From michela.giusti at isprambiente.it  Tue Dec  4 11:34:42 2012
From: michela.giusti at isprambiente.it (Michela Giusti)
Date: Tue, 04 Dec 2012 11:34:42 +0100
Subject: [R-sig-Geo] question about stack command
Message-ID: <50BDD1C2.4000703@isprambiente.it>

Hello everybody,

I have many "SpatialPixelsDataFrame" in my R project and I am wondering 
if there is a command like the command "stack" for raster to do the same 
with this object class.
Can you help me?
Thank you.
Bye,

Michela

-- 
*****************************************************************
Dr. Michela Giusti
ISPRA
Istituto Superiore per la Protezione e la Ricerca Ambientale
Via Brancati, 60
00144 Roma
Tel. +390650074746
michela.giusti at isprambiente.it


From j.boutet at conservatoirepicardie.org  Tue Dec  4 12:03:33 2012
From: j.boutet at conservatoirepicardie.org (j.boutet at conservatoirepicardie.org)
Date: Tue, 4 Dec 2012 12:03:33 +0100 (CET)
Subject: [R-sig-Geo] =?utf-8?q?_R=C3=A9ponse_automatique?=
Message-ID: <201212041103.qB4B3XaL022645@albane10.nfrance.com>




Bonjour,



Je serais en cong?s jusqu'au Jeudi 6 D?cembre.

Pour des raisons d'urgence, vous pourrez me contacter par t?l?phone au 06 46 34 81 03.



Cordialement,



------------------



J?r?me Boutet

Conservatoire d'espaces naturels de Picardie

1, place Ginkgo - village Oasis

80 044 AMIENS cedex 

t?l : 03 22 89 84 24 



> From: r-sig-geo-request at r-project.org
> Subject: R-sig-Geo Digest, Vol 112, Issue 4
> Date: Tue, 04 Dec 2012 12:00:03 +0100


From edzer.pebesma at uni-muenster.de  Tue Dec  4 12:08:27 2012
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Tue, 04 Dec 2012 12:08:27 +0100
Subject: [R-sig-Geo] question about stack command
In-Reply-To: <50BDD1C2.4000703@isprambiente.it>
References: <50BDD1C2.4000703@isprambiente.it>
Message-ID: <50BDD9AB.2040305@uni-muenster.de>

Michela,

there are options that come fairly close:

What you could do is add columns to a SpatialPixelsDataFrame:

a$colb = b$col
a$colc = c$col

but of course you need to check yourself that this make sense (i.e. the
pixels of a, b and c are identical).

Another way would be working with SpatialGridDataFrame's:

fullgrid(a) = TRUE
fullgrid(b) = TRUE
fullgrid(c) = TRUE

abc = cbind(a,b,c)

which combines layers into one object (similar to what raster::stack
does), and does check for equality of all grid topologies.

Best regards,

On 12/04/2012 11:34 AM, Michela Giusti wrote:
> Hello everybody,
> 
> I have many "SpatialPixelsDataFrame" in my R project and I am wondering
> if there is a command like the command "stack" for raster to do the same
> with this object class.
> Can you help me?
> Thank you.
> Bye,
> 
> Michela
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From swagathnavin82 at gmail.com  Tue Dec  4 15:33:30 2012
From: swagathnavin82 at gmail.com (Swagath)
Date: Tue, 04 Dec 2012 15:33:30 +0100
Subject: [R-sig-Geo] Compensating smoothing effect by ordinary kriging
In-Reply-To: <mailman.11.1354618803.3098.r-sig-geo@r-project.org>
References: <mailman.11.1354618803.3098.r-sig-geo@r-project.org>
Message-ID: <50BE09BA.2090309@gmail.com>

Dear all,

I'm a relatively new with kriging methods using gstat. I am interested 
in performing an ordinary kriging to interpolate heavy metal 
concentrations across Europe  with 1000 data points.  However, I 
realized that when i performed cross-validation, OK tends to 
under-estimate my higher values and over-estimate some lower values. Is 
there anything i can do to correct for this smoothening effect by OK. I 
was doing a web search and came across a paper 'Compensating for 
Estimation Smoothing in Kriging' by Ricardo A. Olea and Vera Pawlowsky 
where they discuss about this smoothening effect. Can anybody tell me  
how to compensate for this smoothening effect by OK and show the 
hot-spots on map.

Thanks a lot for your time and help.

Thanks,
Navin


From edukoski at gmail.com  Tue Dec  4 16:04:17 2012
From: edukoski at gmail.com (=?UTF-8?Q?Eduardo_Bie=C3=B1kowski?=)
Date: Tue, 4 Dec 2012 13:04:17 -0200
Subject: [R-sig-Geo] RGDAL PROBLEM IN R-STUDIO
Message-ID: <CA+8CrM3s7KKxeWUHm5nojgCCKfrrTq0G1drNJYs_F1McSiM16g@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121204/87436604/attachment.pl>

From ashton at msu.edu  Tue Dec  4 16:13:28 2012
From: ashton at msu.edu (Ashton Shortridge)
Date: Tue, 4 Dec 2012 10:13:28 -0500
Subject: [R-sig-Geo] RGDAL PROBLEM IN R-STUDIO
In-Reply-To: <CA+8CrM3s7KKxeWUHm5nojgCCKfrrTq0G1drNJYs_F1McSiM16g@mail.gmail.com>
References: <CA+8CrM3s7KKxeWUHm5nojgCCKfrrTq0G1drNJYs_F1McSiM16g@mail.gmail.com>
Message-ID: <201212041013.28398.ashton@msu.edu>

Dear Eduardo,

from the error message, it looks like GDAL is not installed, or not installed 
properly, on your system. You should know that rgdal is simply a wrapper for 
the GDAL library, which must be installed separately. Check around online to 
learn how to install that on your machine, and then try installing rgdal 
again.

Yours,

Ashton

On 12/04/12, Eduardo Bie?kowski, wrote:
> I have a problem with rgdal packages installation.
> 
> 
> I work in R-Studio 0.96.330 version
> 
> 
> I need help, thanks
> 
> 
> MESSAGE IN R-STUDIO CONSOLE
> 
> 
> 
> * installing *source* package ???rgdal??? ...** package ???rgdal???
> successfully unpacked and MD5 sums checkedmv: no se puede mover
> ??/home/usuario/R/x86_64-pc-linux-gnu-library/2.15/rgdal?? a
> ??/home/usuario/R/x86_64-pc-linux-gnu-library/2.15/00LOCK-rgdal/rgdal??:
> Permiso denegadoconfigure: gdal-config: gdal-config
> checking gdal-config usability... ./configure: line 2058: gdal-config:
> command not foundno
> Error: gdal-config not found
> The gdal-config script distributed with GDAL could not be found.
> If you have not installed the GDAL libraries, you can
> download the source from  http://www.gdal.org/
> If you have installed the GDAL libraries, then make sure that
> gdal-config is in your path. Try typing gdal-config at a
> shell prompt and see if it runs. If not, use:
>  --configure-args='--with-gdal-config=/usr/local/bin/gdal-config'
> with appropriate values for your installation.
> ERROR: configuration failed for package ???rgdal???* removing
> ???/home/usuario/R/x86_64-pc-linux-gnu-library/2.15/rgdal???Warning in
> install.packages :
>   installation of package ???rgdal??? had non-zero exit status
> 
> The downloaded source packages are in
> 	???/tmp/RtmpAywZKD/downloaded_packages???


-----
Ashton Shortridge
Associate Professor			ashton at msu.edu
Dept of Geography			http://www.msu.edu/~ashton
235 Geography Building		ph (517) 432-3561
Michigan State University		fx (517) 432-1671


From swagathnavin82 at gmail.com  Tue Dec  4 16:26:22 2012
From: swagathnavin82 at gmail.com (Swagath)
Date: Tue, 04 Dec 2012 16:26:22 +0100
Subject: [R-sig-Geo] RGDAL PROBLEM IN R-STUDIO
In-Reply-To: <50BE142A.7030700@rug.nl>
References: <CA+8CrM3s7KKxeWUHm5nojgCCKfrrTq0G1drNJYs_F1McSiM16g@mail.gmail.com>
	<50BE142A.7030700@rug.nl>
Message-ID: <50BE161E.4030900@gmail.com>

Hi,

Did you try this;

setRepositories(ind=1:2)
install.packages(?rgdal?)
library(rgdal)

source: 
http://stackoverflow.com/questions/7852679/trouble-loading-rgdal-in-rstudio

cheers,
Navin


From edzer.pebesma at uni-muenster.de  Tue Dec  4 16:24:30 2012
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Tue, 04 Dec 2012 16:24:30 +0100
Subject: [R-sig-Geo] Compensating smoothing effect by ordinary kriging
In-Reply-To: <50BE09BA.2090309@gmail.com>
References: <mailman.11.1354618803.3098.r-sig-geo@r-project.org>
	<50BE09BA.2090309@gmail.com>
Message-ID: <50BE15AE.10309@uni-muenster.de>

Navin, I believe constrained kriging may do this; I'm Cc:ing its
authors, who may not be on the list.

http://cran.r-project.org/web/packages/constrainedKriging/


On 12/04/2012 03:33 PM, Swagath wrote:
> Dear all,
> 
> I'm a relatively new with kriging methods using gstat. I am interested
> in performing an ordinary kriging to interpolate heavy metal
> concentrations across Europe  with 1000 data points.  However, I
> realized that when i performed cross-validation, OK tends to
> under-estimate my higher values and over-estimate some lower values. Is
> there anything i can do to correct for this smoothening effect by OK. I
> was doing a web search and came across a paper 'Compensating for
> Estimation Smoothing in Kriging' by Ricardo A. Olea and Vera Pawlowsky
> where they discuss about this smoothening effect. Can anybody tell me 
> how to compensate for this smoothening effect by OK and show the
> hot-spots on map.
> 
> Thanks a lot for your time and help.
> 
> Thanks,
> Navin
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From e.polaina at gmail.com  Tue Dec  4 17:36:08 2012
From: e.polaina at gmail.com (Ester Polaina Lacambra)
Date: Tue, 4 Dec 2012 17:36:08 +0100
Subject: [R-sig-Geo] Function classIntervals in package classInt
Message-ID: <CAB3kvzOzOAcYUj08FFVStabD3sXVceeav0dvWMr-JwS-_RCMfg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121204/591a5fef/attachment.pl>

From Roger.Bivand at nhh.no  Tue Dec  4 18:22:05 2012
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 4 Dec 2012 18:22:05 +0100
Subject: [R-sig-Geo] RGDAL PROBLEM IN R-STUDIO
In-Reply-To: <50BE161E.4030900@gmail.com>
References: <CA+8CrM3s7KKxeWUHm5nojgCCKfrrTq0G1drNJYs_F1McSiM16g@mail.gmail.com>
	<50BE142A.7030700@rug.nl> <50BE161E.4030900@gmail.com>
Message-ID: <alpine.LRH.2.02.1212041758280.16783@reclus.nhh.no>

On Tue, 4 Dec 2012, Swagath wrote:

> Hi,
>
> Did you try this;
>
> setRepositories(ind=1:2)
> install.packages(?rgdal?)
> library(rgdal)
>
> source: 
> http://stackoverflow.com/questions/7852679/trouble-loading-rgdal-in-rstudio

A splendid example of why stackoverflow is rarely the correct answer for 
anything. Not only is this "solution" deprecated in that OSX rgdal is now 
on CRAN, not CRAN Extras - so out of date by many months (that thread 
October 2011), but just googling and then quoting the stackoverflow 
"solution" misses the important point that the stackoverflow thread 
applied to:

Platform: x86_64-apple-darwin9.8.0/x86_64 (64-bit)

as you see if you read the beginning of the thread, whereas our questioner 
has:

/home/usuario/R/x86_64-pc-linux-gnu-library/2.15/

(but did not state the output of sessionInfo(), so may actually not be 
running Linux, who knows?). The correct reply, given by Ashton, is the 
package external dependencies (SystemRequirements) must be installed 
before installing the rgdal source package. The thing anyone should do in 
such a situation is to visit the CRAN page of the package:

http://cran.r-project.org/web/packages/rgdal/index.html

for pointers. The inst/README file included in the source package provides 
further guidance.

@RStudio: Probably RStudio should be more careful in permitting source 
installs for packages that declare SystemRequirements, and have 
./configure files.

Roger

PS. I really like Bruce Schreier's term "United States of Convenience" 
with regard to users' assumptions about the systems we offer:

http://www.schneier.com/blog/archives/2012/12/feudal_sec.html
http://www.wired.com/opinion/2012/11/feudal-security/

In R, you have freedom, convenience is and should be an optional extra, 
expecially if it gets in the way "real work".

PPS. Navin didn't quote the thread, it is here:

https://stat.ethz.ch/pipermail/r-sig-geo/2012-December/016852.html

>
> cheers,
> Navin
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From ehartel at hboi.fau.edu  Tue Dec  4 18:39:21 2012
From: ehartel at hboi.fau.edu (ehartel)
Date: Tue, 4 Dec 2012 09:39:21 -0800 (PST)
Subject: [R-sig-Geo] complex coastline and adehabitatHR: trouble with
 kerneloverlaphr function after coastline has been clipped out
Message-ID: <1354642761294-7581851.post@n2.nabble.com>

Hi all,

I am using R version 2.14.2 on a Windows 7 machine and adehabitatHR version
0.4.2.  

I have an extensive database of dolphin locations and would like to look at
home range overlap between animals.  My study area has a complex coastline
and does not work with the "boundary" slot in the kernelUD function.  I was
able to clip out the land using the method devised by Tony Fischback and
Clement Calenge in the following post
http://r-sig-geo.2731867.n2.nabble.com/Walruses-and-adehabitatHR-class-estUDm-exclusion-of-non-habitat-pixels-and-summary-over-all-animals-td6497315.html.

The above method requires coversion of the kernelUD output (of class-estUDm)
into a SpatialPixelsDataFrame.  Once the land is clipped out, I successfully
converted the object back into class-estUDm.  However, when I try to run the
kerneloverlaphr function with the converted file, I get 0 for every overlap
(which should not be the case).  Kerneloverlaphr works fine if I run it
using the kernelUDs before the land is clipped out, but not after.  I have
no idea why it's not working properly, but it must have something to do with
the process of clipping out the land.

Any advice on the matter would be greatly appreciated.  I have included an
example of my code using the data(puechabonsp) that comes with the
adehabitatHR package.


# Load data
 data(puechabonsp)

# Store relocations
 loc <- puechabonsp$relocs

# Store map
 elev <- puechabonsp$map

# Build "fake" habitat map (1= habitat, 0 = non habitat)
 fullgrid(elev) <- TRUE
 hab <- elev
 hab[[1]] <- as.numeric(!is.na(hab[[1]]))

# Convert hab back into SpatialPixelsDataFrame (as needed for kernelUD
function)
 hab <- as(hab, "SpatialPixelsDataFrame")

# Estimate UD
 ud <- kernelUD(loc[,1], grid=hab)

# Convert to SpatialPixelsDataFrame
 udspdf <- estUDm2spixdf(ud)

# Convert resulting file to fullgrid
 fullgrid(udspdf) <- TRUE

# Convert habitat map to fullgrid
 fullgrid(hab)<-TRUE

# Multiply each column of udspdf by the habitat variable
 resu <- lapply(1:ncol(udspdf), function(i) {udspdf[[i]] * hab[[1]] /
sum(udspdf[[i]] * hab[[1]])})
 resu <- as.data.frame(resu)
 names(resu) <- names(udspdf at data)

# Define it as a data slot for udspdf
 udspdf at data <- resu

# Convert to SpatialPixelsDataFrame
 fullgrid(udspdf) <- FALSE

# Convert result back into class estUDm
 re <- lapply(1:ncol(udspdf), function(i) { 
      so <- new("estUD", udspdf[,i]) 
      so at h <- list(h=0, meth="specified") # fake value 
      so at vol <- FALSE 
      return(so) 
      }) 

 names(re) <- names(udspdf) 
 class(re) <- "estUDm" 

# Find kernel overlap
 kov_clipped <- kerneloverlaphr(re, method = "PHR", percent = 95,
conditional = FALSE)

# Result is all zeros (copied directly from R window)
> kov_clipped
      Brock Calou Chou Jean
Brock     0     0    0    0
Calou     0     0    0    0
Chou      0     0    0    0
Jean      0     0    0    0

# Run kernel overlap for non-clipped UDs (to test accuracy of the above)
 kov_nonclipped <- kerneloverlaphr(ud, method = "PHR", percent = 95,
conditional = FALSE)

# Result is not all zeros (copied directly from R window)
> kov_nonclipped
           Brock     Calou      Chou       Jean
Brock 0.94933028 0.7198043 0.0000000 0.02139490
Calou 0.30917730 0.9495502 0.0000000 0.02949861
Chou  0.00000000 0.0000000 0.9496367 0.89242679
Jean  0.04359732 0.3086748 0.9122472 0.94957049



Thanks so much for your time and assistance!

Liz



-----------
Liz Hartel
Biological Scientist
Population Biology and Behavioral Ecology
Harbor Branch Oceanographic Institute - FAU
5600 US 1 North, Fort Pierce, FL 34946
work: (772) 242-2238
cell: (772) 216-4363
www.hboi.fau.edu



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/complex-coastline-and-adehabitatHR-trouble-with-kerneloverlaphr-function-after-coastline-has-been-clt-tp7581851.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From mintibezabih at gmail.com  Tue Dec  4 19:15:26 2012
From: mintibezabih at gmail.com (alemante zd)
Date: Tue, 4 Dec 2012 18:15:26 +0000
Subject: [R-sig-Geo] saving results from a loop
Message-ID: <CAJfxP+ru8Thp5A4nQUdFbugvh_CU6fdyisK5bO1s64-jDeFp9w@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121204/9de997b1/attachment.pl>

From sarah.goslee at gmail.com  Tue Dec  4 19:19:20 2012
From: sarah.goslee at gmail.com (Sarah Goslee)
Date: Tue, 4 Dec 2012 13:19:20 -0500
Subject: [R-sig-Geo] saving results from a loop
In-Reply-To: <CAJfxP+ru8Thp5A4nQUdFbugvh_CU6fdyisK5bO1s64-jDeFp9w@mail.gmail.com>
References: <CAJfxP+ru8Thp5A4nQUdFbugvh_CU6fdyisK5bO1s64-jDeFp9w@mail.gmail.com>
Message-ID: <CAM_vju=86Hni1_m_LeLZcQHj=JaxQ8CeGMk3-fu2S2ExK+Jgiw@mail.gmail.com>

I would save the information you're interested in as a list:


library(gstat)
library(raster)
x <- 1:10
#y <- 1:10
z<- 1:10

results <- list()

setwd("f:/Grids")
r2 <- raster("idgd_wgs.asc")
z.list <- list(z1<-runif(10), z2 <- runif(10), z3 <- runif(10))
da1<-data.frame(x=1:10, y=1:10)
for (i in 1:length(z.list)) {
 da.temp<-data.frame(da1, z=z.list[[i]])
 IDW.temp<- gstat(id = "z", formula = z~1, locations = ~x+y, data=da.temp,
set=list(idp =2))
 IDWRaster.temp <- interpolate(r2, IDW.temp)


 # I want to save the results from  IDWRaster.temp

results[[i]] <- IDWRaster.temp
}

On Tue, Dec 4, 2012 at 1:15 PM, alemante zd <mintibezabih at gmail.com> wrote:
> Dear R-sig-geo users,
>
> I have the following code in a loop. I was wondering how I can get the
> results saved from the loop. The result I am interested in
> is  IDWRaster.temp
>
> library(gstat)
> library(raster)
> x <- 1:10
> #y <- 1:10
> z<- 1:10
> setwd("f:/Grids")
> r2 <- raster("idgd_wgs.asc")
> z.list <- list(z1<-runif(10), z2 <- runif(10), z3 <- runif(10))
> da1<-data.frame(x=1:10, y=1:10)
> for (i in 1:length(z.list)) {
>  da.temp<-data.frame(da1, z=z.list[[i]])
>  IDW.temp<- gstat(id = "z", formula = z~1, locations = ~x+y, data=da.temp,
> set=list(idp =2))
>  IDWRaster.temp <- interpolate(r2, IDW.temp)
>  # I want to save the results from  IDWRaster.temp
> }
> Thanks in advance for any help.
> Miniti
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



-- 
Sarah Goslee
http://www.stringpage.com
http://www.sarahgoslee.com
http://www.functionaldiversity.org


From mintibezabih at gmail.com  Tue Dec  4 20:07:45 2012
From: mintibezabih at gmail.com (alemante zd)
Date: Tue, 4 Dec 2012 19:07:45 +0000
Subject: [R-sig-Geo] saving results from a loop
In-Reply-To: <CAM_vju=86Hni1_m_LeLZcQHj=JaxQ8CeGMk3-fu2S2ExK+Jgiw@mail.gmail.com>
References: <CAJfxP+ru8Thp5A4nQUdFbugvh_CU6fdyisK5bO1s64-jDeFp9w@mail.gmail.com>
	<CAM_vju=86Hni1_m_LeLZcQHj=JaxQ8CeGMk3-fu2S2ExK+Jgiw@mail.gmail.com>
Message-ID: <CAJfxP+o0wStj=nTqW1X9KUCcu05CR8e-Jg9d4tLkyvhNQ5M=8g@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121204/d74118a4/attachment.pl>

From saramartino at yahoo.com  Tue Dec  4 20:12:17 2012
From: saramartino at yahoo.com (sara martino)
Date: Tue, 4 Dec 2012 11:12:17 -0800 (PST)
Subject: [R-sig-Geo] Problem with RNetCDF and ubuntu
In-Reply-To: <1354298273.90558.YahooMailNeo@web140905.mail.bf1.yahoo.com>
References: <1354298273.90558.YahooMailNeo@web140905.mail.bf1.yahoo.com>
Message-ID: <1354648337.61614.YahooMailNeo@web140903.mail.bf1.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121204/965ba97e/attachment.pl>

From sarah.goslee at gmail.com  Tue Dec  4 20:23:35 2012
From: sarah.goslee at gmail.com (Sarah Goslee)
Date: Tue, 4 Dec 2012 14:23:35 -0500
Subject: [R-sig-Geo] saving results from a loop
In-Reply-To: <CAJfxP+o0wStj=nTqW1X9KUCcu05CR8e-Jg9d4tLkyvhNQ5M=8g@mail.gmail.com>
References: <CAJfxP+ru8Thp5A4nQUdFbugvh_CU6fdyisK5bO1s64-jDeFp9w@mail.gmail.com>
	<CAM_vju=86Hni1_m_LeLZcQHj=JaxQ8CeGMk3-fu2S2ExK+Jgiw@mail.gmail.com>
	<CAJfxP+o0wStj=nTqW1X9KUCcu05CR8e-Jg9d4tLkyvhNQ5M=8g@mail.gmail.com>
Message-ID: <CAM_vjukyMOdu40sR+XionALh4sEioa2CT4Nr+y4Pt1xbb1vWeA@mail.gmail.com>

Well, yes:

summary(results[[i]])

gives you the summary for the i-th element of the list results, which
is presumably the last of your loop iterations.

summary(results[[1]])
summary(results[[2]])
summary(results[[3]])


or better,

lapply(results, summary)


You'd be well advised to read some intro to R materials, especially
the sections about lists.

Sarah

On Tue, Dec 4, 2012 at 2:07 PM, alemante zd <mintibezabih at gmail.com> wrote:
> Thanks Sarah.
>
> The code runs fine but I still dont get 3 different resukts (corresponding
> to the 3 zs). Here is what I get instead:
>
>> summary(results[[i]])
>
> Min.    0.5900
> 1st Qu. 0.5911
> Median  0.5917
> Mean    0.5918
> 3rd Qu. 0.5924
> Max.    0.5936
>> summary (IDWRaster.temp)
>
> Min.    0.5900
> 1st Qu. 0.5911
> Median  0.5917
> Mean    0.5918
> 3rd Qu. 0.5924
> Max.    0.5936
>
>
> #### the code
>
> library(gstat)
> library(raster)
> x <- 1:10
> #y <- 1:10
> z<- 1:10
> results <- list()
> setwd("f:/Grids")
> r2 <- raster("idgd_wgs.asc")
>
> z.list <- list(z1<-runif(10), z2 <- runif(10), z3 <- runif(10))
> da1<-data.frame(x=1:10, y=1:10)
> for (i in 1:length(z.list)) {
>  da.temp<-data.frame(da1, z=z.list[[i]])
>
>  IDW.temp<- gstat(id = "z", formula = z~1, locations = ~x+y, data=da.temp,
> set=list(idp =2))
>  IDWRaster.temp <- interpolate(r2, IDW.temp)
> results[[i]] <- IDWRaster.temp
> }
>
>
> Thanks again.
> minti
> On Tue, Dec 4, 2012 at 6:19 PM, Sarah Goslee <sarah.goslee at gmail.com> wrote:
>>
>> I would save the information you're interested in as a list:
>>
>>
>> library(gstat)
>> library(raster)
>> x <- 1:10
>> #y <- 1:10
>> z<- 1:10
>>
>> results <- list()
>>
>> setwd("f:/Grids")
>> r2 <- raster("idgd_wgs.asc")
>> z.list <- list(z1<-runif(10), z2 <- runif(10), z3 <- runif(10))
>> da1<-data.frame(x=1:10, y=1:10)
>> for (i in 1:length(z.list)) {
>>  da.temp<-data.frame(da1, z=z.list[[i]])
>>  IDW.temp<- gstat(id = "z", formula = z~1, locations = ~x+y, data=da.temp,
>> set=list(idp =2))
>>  IDWRaster.temp <- interpolate(r2, IDW.temp)
>>
>>
>>  # I want to save the results from  IDWRaster.temp
>>
>> results[[i]] <- IDWRaster.temp
>> }
>>
>> On Tue, Dec 4, 2012 at 1:15 PM, alemante zd <mintibezabih at gmail.com>
>> wrote:
>> > Dear R-sig-geo users,
>> >
>> > I have the following code in a loop. I was wondering how I can get the
>> > results saved from the loop. The result I am interested in
>> > is  IDWRaster.temp
>> >
>> > library(gstat)
>> > library(raster)
>> > x <- 1:10
>> > #y <- 1:10
>> > z<- 1:10
>> > setwd("f:/Grids")
>> > r2 <- raster("idgd_wgs.asc")
>> > z.list <- list(z1<-runif(10), z2 <- runif(10), z3 <- runif(10))
>> > da1<-data.frame(x=1:10, y=1:10)
>> > for (i in 1:length(z.list)) {
>> >  da.temp<-data.frame(da1, z=z.list[[i]])
>> >  IDW.temp<- gstat(id = "z", formula = z~1, locations = ~x+y,
>> > data=da.temp,
>> > set=list(idp =2))
>> >  IDWRaster.temp <- interpolate(r2, IDW.temp)
>> >  # I want to save the results from  IDWRaster.temp
>> > }
>> > Thanks in advance for any help.
>> > Miniti
>> >
>> >         [[alternative HTML version deleted]]
>> >


--
Sarah Goslee
http://www.functionaldiversity.org


From julian at hafro.is  Wed Dec  5 00:03:32 2012
From: julian at hafro.is (Julian Burgos)
Date: Tue, 4 Dec 2012 23:03:32 -0000 (GMT)
Subject: [R-sig-Geo] Function classIntervals in package classInt
In-Reply-To: <CAB3kvzOzOAcYUj08FFVStabD3sXVceeav0dvWMr-JwS-_RCMfg@mail.gmail.com>
References: <CAB3kvzOzOAcYUj08FFVStabD3sXVceeav0dvWMr-JwS-_RCMfg@mail.gmail.com>
Message-ID: <65501.46.239.234.92.1354662212.squirrel@www.hafro.is>

There are many ways, for example, if your data is a vector named "mydata",
you can do something like this:

mydata[!is.na(mydata)]

Julian


> Hello everyone,
>
> I am drawing maps with the function spplot, previously using the function
> "classIntervals" in order to make "pretty" categories of my variables. I
> have noticed this function doesn't accept NA values in the set of data...
> is there any way of telling R that doesn't take the rows containing NA
> values?
>
> Thank you very much!
>
> --
> Ester Polaina Lacambra
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From milansharma2012 at yahoo.com  Wed Dec  5 02:33:39 2012
From: milansharma2012 at yahoo.com (Milan Sharma)
Date: Tue, 4 Dec 2012 17:33:39 -0800 (PST)
Subject: [R-sig-Geo] read shapfile in R
In-Reply-To: <1354282936830-7581802.post@n2.nabble.com>
References: <1354282936830-7581802.post@n2.nabble.com>
Message-ID: <1354671219.80047.YahooMailNeo@web161202.mail.bf1.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121204/afea006b/attachment.pl>

From mdsumner at gmail.com  Wed Dec  5 03:17:28 2012
From: mdsumner at gmail.com (Michael Sumner)
Date: Wed, 5 Dec 2012 13:17:28 +1100
Subject: [R-sig-Geo] read shapfile in R
In-Reply-To: <1354671219.80047.YahooMailNeo@web161202.mail.bf1.yahoo.com>
References: <1354282936830-7581802.post@n2.nabble.com>
	<1354671219.80047.YahooMailNeo@web161202.mail.bf1.yahoo.com>
Message-ID: <CAAcGz98_tWiDVn7E8w0eFNqfeU=q9vfAJS5DctL0LKr6YwyxbA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121205/cd711e25/attachment.pl>

From thi_veloso at yahoo.com.br  Wed Dec  5 08:47:33 2012
From: thi_veloso at yahoo.com.br (Thiago V. dos Santos)
Date: Tue, 4 Dec 2012 23:47:33 -0800 (PST)
Subject: [R-sig-Geo] Problem with RNetCDF and ubuntu
In-Reply-To: <1354648337.61614.YahooMailNeo@web140903.mail.bf1.yahoo.com>
References: <1354298273.90558.YahooMailNeo@web140905.mail.bf1.yahoo.com>
	<1354648337.61614.YahooMailNeo@web140903.mail.bf1.yahoo.com>
Message-ID: <1354693653.31757.YahooMailNeo@web121903.mail.ne1.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121204/adf8b98a/attachment.pl>

From virgilio.gomez at uclm.es  Wed Dec  5 11:54:25 2012
From: virgilio.gomez at uclm.es (Virgilio =?ISO-8859-1?Q?G=F3mez-Rubio?=)
Date: Wed, 05 Dec 2012 11:54:25 +0100
Subject: [R-sig-Geo] Problem with RNetCDF and ubuntu
In-Reply-To: <1354648337.61614.YahooMailNeo@web140903.mail.bf1.yahoo.com>
References: <1354298273.90558.YahooMailNeo@web140905.mail.bf1.yahoo.com>
	<1354648337.61614.YahooMailNeo@web140903.mail.bf1.yahoo.com>
Message-ID: <1354704865.2276.15.camel@virgil-HP-Compaq-8000-Elite-USDT-PC>

Sara,

I have just tried on my Ubuntu (12.04) and your code works fine. I am
using the following packages:

libnetcdf-dev 1:4.1.1-6
libnetcdf6 1:4.1.1-6
netcdf-bin 1:4.1.1-6

So my guess is that your problem may be related to an old bug... Can you
update your system and try again?

Best,

Virgilio


From j.boutet at conservatoirepicardie.org  Wed Dec  5 12:02:13 2012
From: j.boutet at conservatoirepicardie.org (j.boutet at conservatoirepicardie.org)
Date: Wed, 5 Dec 2012 12:02:13 +0100 (CET)
Subject: [R-sig-Geo] =?utf-8?q?_R=C3=A9ponse_automatique?=
Message-ID: <201212051102.qB5B2DHP097308@albane10.nfrance.com>




Bonjour,



Je serais en cong?s jusqu'au Jeudi 6 D?cembre.

Pour des raisons d'urgence, vous pourrez me contacter par t?l?phone au 06 46 34 81 03.



Cordialement,



------------------



J?r?me Boutet

Conservatoire d'espaces naturels de Picardie

1, place Ginkgo - village Oasis

80 044 AMIENS cedex 

t?l : 03 22 89 84 24 



> From: r-sig-geo-request at r-project.org
> Subject: R-sig-Geo Digest, Vol 112, Issue 5
> Date: Wed, 05 Dec 2012 12:00:04 +0100


From edukoski at gmail.com  Wed Dec  5 13:46:14 2012
From: edukoski at gmail.com (=?UTF-8?Q?Eduardo_Bie=C3=B1kowski?=)
Date: Wed, 5 Dec 2012 10:46:14 -0200
Subject: [R-sig-Geo] RGDAL PROBLEM IN R-STUDIO
In-Reply-To: <alpine.LRH.2.02.1212041758280.16783@reclus.nhh.no>
References: <CA+8CrM3s7KKxeWUHm5nojgCCKfrrTq0G1drNJYs_F1McSiM16g@mail.gmail.com>
	<50BE142A.7030700@rug.nl> <50BE161E.4030900@gmail.com>
	<alpine.LRH.2.02.1212041758280.16783@reclus.nhh.no>
Message-ID: <CA+8CrM2g9MhokbkYp0xwnxJ=OVc4ZaWUU2sXtF5dK05NEAcqYQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121205/d6ff35d6/attachment.pl>

From martin.ivanov at ifg.uni-tuebingen.de  Wed Dec  5 15:49:48 2012
From: martin.ivanov at ifg.uni-tuebingen.de (Martin Ivanov)
Date: Wed, 05 Dec 2012 15:49:48 +0100
Subject: [R-sig-Geo] esri_pe_string to proj4?
Message-ID: <50BF5F0C.3050907@ifg.uni-tuebingen.de>

Dear all,

I have 2m-temperature data with the following projection information:
esri_pe_string = 
"GEOGCS[\"GCS_WGS_1984\",DATUM[\"D_WGS_1984\",SPHEROID[\"WGS_1984\",6378137.0,298.257223563]],PRIMEM[\"Greenwich\",0.0],UNIT[\"Degree\",0.0174532925199433]],VERTCS[\"EGM96_Geoid\",VDATUM[\"EGM96_Geoid\"],PARAMETER[\"Vertical_Shift\",0.0],PARAMETER[\"Direction\",1.0],UNIT[\"Meter\",1.0]]" 


I need to project the data on a standard latitude-longitude grid.
But to do this I have to create a SpatialPoints object and specify a 
proj4 string.
Any ideas how to find the correct proj4 specification for the above 
mentioned projection?
Or is there any other way to incorporate the esri_pe_string info into an 
R object so that I can
transform the data coordinates?

Any suggestions will be appreciated.

Best regards,

-- 
Dr. Martin Ivanov
Eberhard-Karls-Universit?t T?bingen
Mathematisch-Naturwissenschaftliche Fakult?t
Fachbereich Geowissenschaften
Water & Earth System Science (WESS)
H?lderlinstra?e 12, 72074 T?bingen, Deutschland
Tel. +4970712974213


From Roger.Bivand at nhh.no  Wed Dec  5 18:38:22 2012
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 5 Dec 2012 18:38:22 +0100
Subject: [R-sig-Geo] RGDAL PROBLEM IN R-STUDIO
In-Reply-To: <CA+8CrM2g9MhokbkYp0xwnxJ=OVc4ZaWUU2sXtF5dK05NEAcqYQ@mail.gmail.com>
References: <CA+8CrM3s7KKxeWUHm5nojgCCKfrrTq0G1drNJYs_F1McSiM16g@mail.gmail.com>
	<50BE142A.7030700@rug.nl> <50BE161E.4030900@gmail.com>
	<alpine.LRH.2.02.1212041758280.16783@reclus.nhh.no>
	<CA+8CrM2g9MhokbkYp0xwnxJ=OVc4ZaWUU2sXtF5dK05NEAcqYQ@mail.gmail.com>
Message-ID: <alpine.LRH.2.02.1212051834380.5272@reclus.nhh.no>

Thanks for helpful feedback. I've added your solution to the inst/README 
file in the package.

Roger

On Wed, 5 Dec 2012, Eduardo Bie?kowski wrote:

> Hi all.
> For those who had the same problem:
> The solution was:
> In Ubuntu
> sudo apt-get install-dev libgdal1
> sudo apt-get install-dev libproj
>
> and then, install the package rgdal in RStudio
> Thanks
> Eduardo
>
>
> 2012/12/4 Roger Bivand <Roger.Bivand at nhh.no>
>
>> On Tue, 4 Dec 2012, Swagath wrote:
>>
>>  Hi,
>>>
>>> Did you try this;
>>>
>>> setRepositories(ind=1:2)
>>> install.packages(?rgdal?)
>>> library(rgdal)
>>>
>>> source: http://stackoverflow.com/**questions/7852679/trouble-**
>>> loading-rgdal-in-rstudio<http://stackoverflow.com/questions/7852679/trouble-loading-rgdal-in-rstudio>
>>>
>>
>> A splendid example of why stackoverflow is rarely the correct answer for
>> anything. Not only is this "solution" deprecated in that OSX rgdal is now
>> on CRAN, not CRAN Extras - so out of date by many months (that thread
>> October 2011), but just googling and then quoting the stackoverflow
>> "solution" misses the important point that the stackoverflow thread applied
>> to:
>>
>> Platform: x86_64-apple-darwin9.8.0/x86_**64 (64-bit)
>>
>> as you see if you read the beginning of the thread, whereas our questioner
>> has:
>>
>> /home/usuario/R/x86_64-pc-**linux-gnu-library/2.15/
>>
>> (but did not state the output of sessionInfo(), so may actually not be
>> running Linux, who knows?). The correct reply, given by Ashton, is the
>> package external dependencies (SystemRequirements) must be installed before
>> installing the rgdal source package. The thing anyone should do in such a
>> situation is to visit the CRAN page of the package:
>>
>> http://cran.r-project.org/web/**packages/rgdal/index.html<http://cran.r-project.org/web/packages/rgdal/index.html>
>>
>> for pointers. The inst/README file included in the source package provides
>> further guidance.
>>
>> @RStudio: Probably RStudio should be more careful in permitting source
>> installs for packages that declare SystemRequirements, and have ./configure
>> files.
>>
>> Roger
>>
>> PS. I really like Bruce Schreier's term "United States of Convenience"
>> with regard to users' assumptions about the systems we offer:
>>
>> http://www.schneier.com/blog/**archives/2012/12/feudal_sec.**html<http://www.schneier.com/blog/archives/2012/12/feudal_sec.html>
>> http://www.wired.com/opinion/**2012/11/feudal-security/<http://www.wired.com/opinion/2012/11/feudal-security/>
>>
>> In R, you have freedom, convenience is and should be an optional extra,
>> expecially if it gets in the way "real work".
>>
>> PPS. Navin didn't quote the thread, it is here:
>>
>> https://stat.ethz.ch/**pipermail/r-sig-geo/2012-**December/016852.html<https://stat.ethz.ch/pipermail/r-sig-geo/2012-December/016852.html>
>>
>>
>>
>>> cheers,
>>> Navin
>>>
>>> ______________________________**_________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/**listinfo/r-sig-geo<https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
>>>
>>>
>> --
>> Roger Bivand
>> Department of Economics, NHH Norwegian School of Economics,
>> Helleveien 30, N-5045 Bergen, Norway.
>> voice: +47 55 95 93 55; fax +47 55 95 95 43
>> e-mail: Roger.Bivand at nhh.no
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>
>
>
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From dennis.duro at gmail.com  Thu Dec  6 00:31:59 2012
From: dennis.duro at gmail.com (dcd)
Date: Wed, 5 Dec 2012 15:31:59 -0800 (PST)
Subject: [R-sig-Geo] [raster] formal way of addressing specific layer in
	RasterStack?
Message-ID: <1354750319862-7581866.post@n2.nabble.com>

Just curious if this is the most optimal way of addressing a specific layer
in a RasterStack:

-RasterStack with 14 layers called "stack"
-polygon layer called "sites"

# extract cell values from layer 2 of "stack" RasterStack using "sites"
polygon
extract_stack_sites<-extract(stack at layers[[2]], sites))

# extract summary stats (mean) for each polygon
extract_stack_sites_mean<-unlist(lapply(extract_stack_sites, function(x) if
(!is.null(x)) mean(x, na.rm=TRUE) else NA ))

The above works, but perhaps there's a more elegant solution, especially if
dealing with a range, or subset of layers within a RasterStack?

Cheers



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/raster-formal-way-of-addressing-specific-layer-in-RasterStack-tp7581866.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From matteo.mattiuzzi at boku.ac.at  Thu Dec  6 00:57:12 2012
From: matteo.mattiuzzi at boku.ac.at (Matteo Mattiuzzi)
Date: Thu, 06 Dec 2012 00:57:12 +0100
Subject: [R-sig-Geo] Antw: [raster] formal way of addressing specific layer
 in RasterStack?
Message-ID: <50BFED68020000270001741A@gwia2.boku.ac.at>

Hi,


using the example of ?extract you can do:


r <- raster(ncol=36, nrow=18)
r[] <- 1:ncell(r)
r <- stack(r,r,r)


cds1 <- rbind(c(-180,-20), c(-160,5), c(-60, 0), c(-160,-60), c(-180,-20))
cds2 <- rbind(c(80,0), c(100,60), c(120,0), c(120,-55), c(80,0))
polys <- SpatialPolygons(list(Polygons(list(Polygon(cds1)), 1), 
                                   Polygons(list(Polygon(cds2)), 2)))
     

v <- extract(r[[2]],polys,mean)


Matteo


>>> dcd  06.12.12 0.33 Uhr >>>
Just curious if this is the most optimal way of addressing a specific layer
in a RasterStack:

-RasterStack with 14 layers called "stack"
-polygon layer called "sites"

# extract cell values from layer 2 of "stack" RasterStack using "sites"
polygon
extract_stack_sites<-extract(stack at layers[[2]], sites))

# extract summary stats (mean) for each polygon
extract_stack_sites_mean<-unlist(lapply(extract_stack_sites, function(x) if
(!is.null(x)) mean(x, na.rm=TRUE) else NA ))

The above works, but perhaps there's a more elegant solution, especially if
dealing with a range, or subset of layers within a RasterStack?

Cheers



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/raster-formal-way-of-addressing-specific-layer-in-RasterStack-tp7581866.html
Sent from the R-sig-geo mailing list archive at Nabble.com.

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From milansharma2012 at yahoo.com  Thu Dec  6 03:10:14 2012
From: milansharma2012 at yahoo.com (Milan Sharma)
Date: Wed, 5 Dec 2012 18:10:14 -0800 (PST)
Subject: [R-sig-Geo] Shape file of USA land cover data
Message-ID: <1354759814.12065.YahooMailNeo@web161206.mail.bf1.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121205/a4ce3f0d/attachment.pl>

From mdsumner at gmail.com  Thu Dec  6 03:34:20 2012
From: mdsumner at gmail.com (Michael Sumner)
Date: Thu, 6 Dec 2012 13:34:20 +1100
Subject: [R-sig-Geo] Shape file of USA land cover data
In-Reply-To: <1354759814.12065.YahooMailNeo@web161206.mail.bf1.yahoo.com>
References: <1354759814.12065.YahooMailNeo@web161206.mail.bf1.yahoo.com>
Message-ID: <CAAcGz98cL=gOU76_bbSF1hywMhjjC5huWPa0BFS-ZqkDXqwKnQ@mail.gmail.com>

It's not a shapefile, and it's not a vector format. It's a gridded
(raster) format. Specifically it's an Erdas Imaging (.img) format:

http://www.gdal.org/frmt_hfa.html

I tried the Hawaii one which is much smaller (2.4Mb) and so more
reasonable to share.

http://gisdata.usgs.gov/TDDS/DownloadFile.php?TYPE=nlcdhi&FNAME=HI_landcover_wimperv_9-30-08_se5.zip

You seem to have found metadata files, but I haven't found what you
presented to us.

I get this:

 list.files()
[1] "hi_landcover_wimperv_9-30-08_se5.img"
[2] "hi_landcover_wimperv_9-30-08_se5.rrd"
[3] "landcov_meta_web_final"

library(raster)
r <- raster("hi_landcover_wimperv_9-30-08_se5.img")
r
class       : RasterLayer
dimensions  : 12618, 19439, 245281302  (nrow, ncol, ncell)
resolution  : 30, 30  (x, y)
extent      : -345945, 237225, 1753875, 2132415  (xmin, xmax, ymin, ymax)
coord. ref. : +proj=aea +lat_1=8.000000000000002 +lat_2=18 +lat_0=3
+lon_0=-157 +x_0=0 +y_0=0 +ellps=WGS84 +towgs84=0,0,0,0,0,0,0 +units=m
+no_defs
data source : C:\Users\Michaels\Downloads\HI_landcover_wimperv_9-30-08_se5\hi_landcover_wimperv_9-30-08_se5.img
names       : hi_landcover_wimperv_9.30.08_se5
values      : 0, 95  (min, max)
Raster Attribute Table
     fields :  ID     COUNT  Red Green Blue Land.Cover.Class Opacity
        min :   0         0 0.00  0.00 0.00                        0
        max : 255 221606161 0.98  0.98 0.98   Woody Wetlands       1


You'll have to work through the documentation for rasters to
understand how to work with these data. The raster package requires
rgdal to load this format, and you could do that more directly with

require(rgdal)
r <- readGDAL("hi_landcover_wimperv_9-30-08_se5.img")

though arguably raster is probably a better place to start.

Cheers, Mike.

On Thu, Dec 6, 2012 at 1:10 PM, Milan Sharma <milansharma2012 at yahoo.com> wrote:
> Hi List,
> I  wanted to download national land cover data of USA, 2006 which I could convert to shape file and do analysis. The website is http://www.mrlc.gov/nlcd01_data.php.
>  I got the following 6 files in it:
> 1. appendix1_nlcd2006_scene_list_by_path_row_txt
> 2. appendix1_nlcd2006_scene_list_by_path_zone_txt
> 3. metadata_nlcd2006_lc_4-20-11-txt
> 4. metadata_nlcd2006_lc_4-20-11-se5.ige
> 5. metadata_nlcd2006_lc_4-20-11-se5.img
> 6.metadata_nlcd2006_lc_4-20-11-se5.rrd
>
> I didn't see any shape file in here, or will I get the shape file from any one  the above  file formats?
> (Has anybody in the list downloaded such data?) (or can anybody instruct me of how to get it done?
> Thanks so much for your help,
> Milan
>         [[alternative HTML version deleted]]
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



-- 
Michael Sumner
Hobart, Australia
e-mail: mdsumner at gmail.com


From HodgessE at uhd.edu  Thu Dec  6 04:45:12 2012
From: HodgessE at uhd.edu (Hodgess, Erin)
Date: Thu, 6 Dec 2012 03:45:12 +0000
Subject: [R-sig-Geo] Shape file of USA land cover data
In-Reply-To: <CAAcGz98cL=gOU76_bbSF1hywMhjjC5huWPa0BFS-ZqkDXqwKnQ@mail.gmail.com>
References: <1354759814.12065.YahooMailNeo@web161206.mail.bf1.yahoo.com>,
	<CAAcGz98cL=gOU76_bbSF1hywMhjjC5huWPa0BFS-ZqkDXqwKnQ@mail.gmail.com>
Message-ID: <FF9DB805FC41CC4E95825A50F6806302128E69E7@columbia.uhd.campus>

Hi

I got the same data set that Milan did and used the raster:

r <- raster("c://goodc//nlcd2006_landcover_4-20-11_se5.img")

and it worked.  When I used gdal, it said that it was too big.

Thanks,
Erin 
PS the plot looks really nice too.

________________________________________
From: r-sig-geo-bounces at r-project.org [r-sig-geo-bounces at r-project.org] on behalf of Michael Sumner [mdsumner at gmail.com]
Sent: Wednesday, December 05, 2012 8:34 PM
To: Milan Sharma
Cc: r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] Shape file of USA land cover data

It's not a shapefile, and it's not a vector format. It's a gridded
(raster) format. Specifically it's an Erdas Imaging (.img) format:

http://www.gdal.org/frmt_hfa.html

I tried the Hawaii one which is much smaller (2.4Mb) and so more
reasonable to share.

http://gisdata.usgs.gov/TDDS/DownloadFile.php?TYPE=nlcdhi&FNAME=HI_landcover_wimperv_9-30-08_se5.zip

You seem to have found metadata files, but I haven't found what you
presented to us.

I get this:

 list.files()
[1] "hi_landcover_wimperv_9-30-08_se5.img"
[2] "hi_landcover_wimperv_9-30-08_se5.rrd"
[3] "landcov_meta_web_final"

library(raster)
r <- raster("hi_landcover_wimperv_9-30-08_se5.img")
r
class       : RasterLayer
dimensions  : 12618, 19439, 245281302  (nrow, ncol, ncell)
resolution  : 30, 30  (x, y)
extent      : -345945, 237225, 1753875, 2132415  (xmin, xmax, ymin, ymax)
coord. ref. : +proj=aea +lat_1=8.000000000000002 +lat_2=18 +lat_0=3
+lon_0=-157 +x_0=0 +y_0=0 +ellps=WGS84 +towgs84=0,0,0,0,0,0,0 +units=m
+no_defs
data source : C:\Users\Michaels\Downloads\HI_landcover_wimperv_9-30-08_se5\hi_landcover_wimperv_9-30-08_se5.img
names       : hi_landcover_wimperv_9.30.08_se5
values      : 0, 95  (min, max)
Raster Attribute Table
     fields :  ID     COUNT  Red Green Blue Land.Cover.Class Opacity
        min :   0         0 0.00  0.00 0.00                        0
        max : 255 221606161 0.98  0.98 0.98   Woody Wetlands       1


You'll have to work through the documentation for rasters to
understand how to work with these data. The raster package requires
rgdal to load this format, and you could do that more directly with

require(rgdal)
r <- readGDAL("hi_landcover_wimperv_9-30-08_se5.img")

though arguably raster is probably a better place to start.

Cheers, Mike.

On Thu, Dec 6, 2012 at 1:10 PM, Milan Sharma <milansharma2012 at yahoo.com> wrote:
> Hi List,
> I  wanted to download national land cover data of USA, 2006 which I could convert to shape file and do analysis. The website is http://www.mrlc.gov/nlcd01_data.php.
>  I got the following 6 files in it:
> 1. appendix1_nlcd2006_scene_list_by_path_row_txt
> 2. appendix1_nlcd2006_scene_list_by_path_zone_txt
> 3. metadata_nlcd2006_lc_4-20-11-txt
> 4. metadata_nlcd2006_lc_4-20-11-se5.ige
> 5. metadata_nlcd2006_lc_4-20-11-se5.img
> 6.metadata_nlcd2006_lc_4-20-11-se5.rrd
>
> I didn't see any shape file in here, or will I get the shape file from any one  the above  file formats?
> (Has anybody in the list downloaded such data?) (or can anybody instruct me of how to get it done?
> Thanks so much for your help,
> Milan
>         [[alternative HTML version deleted]]
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



--
Michael Sumner
Hobart, Australia
e-mail: mdsumner at gmail.com

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From mdsumner at gmail.com  Thu Dec  6 05:28:03 2012
From: mdsumner at gmail.com (Michael Sumner)
Date: Thu, 6 Dec 2012 15:28:03 +1100
Subject: [R-sig-Geo] Shape file of USA land cover data
In-Reply-To: <1354766965.74214.YahooMailNeo@web161201.mail.bf1.yahoo.com>
References: <1354759814.12065.YahooMailNeo@web161206.mail.bf1.yahoo.com>
	<CAAcGz98cL=gOU76_bbSF1hywMhjjC5huWPa0BFS-ZqkDXqwKnQ@mail.gmail.com>
	<FF9DB805FC41CC4E95825A50F6806302128E69E7@columbia.uhd.campus>
	<1354766965.74214.YahooMailNeo@web161201.mail.bf1.yahoo.com>
Message-ID: <CAAcGz9_RrDLDwqkmVN8Oo1DC5ffEnNnpGXbJ3o_qjgtZ-r2nzw@mail.gmail.com>

The error message already advises on what is required:  "you use rgdal
version: 0.7-19. You need version 0.7-22 or higher".

Is that not clear somehow? It's important to read the messages and
work on understanding them.

Please upgrade to latest rgdal and raster, it only creates extra work
trying to chase issues with outdated versions. If you have trouble
upgrading then that's another topic, for another list.  The "R
Installation and Administration" manual is the first port of call for
maintaining your R installation, but how to do it exactly will depend
on your set up, operating system, whether your R is current, and other
things that we do not know.

Cheers, Mike.


On Thu, Dec 6, 2012 at 3:09 PM, Milan Sharma <milansharma2012 at yahoo.com> wrote:
> Hi Erin,
> I got the following error.. Can you advise me of the solution?
>> setwd("C://Users//milan//Desktop")
>> r <- raster("nlcd2006_landcover_4-20-11_se5.img")
> Error in .requireRgdal(FALSE) : you use rgdal version: 0.7-19
> You need version 0.7-22 or higher
> ________________________________
> From: "Hodgess, Erin" <HodgessE at uhd.edu>
> To: Michael Sumner <mdsumner at gmail.com>; Milan Sharma
> <milansharma2012 at yahoo.com>
> Cc: "r-sig-geo at r-project.org" <r-sig-geo at r-project.org>
> Sent: Wednesday, December 5, 2012 9:45 PM
> Subject: RE: [R-sig-Geo] Shape file of USA land cover data
>
> Hi
>
> I got the same data set that Milan did and used the raster:
>
> r <- raster("c://goodc//nlcd2006_landcover_4-20-11_se5.img")
>
> and it worked.  When I used gdal, it said that it was too big.
>
> Thanks,
> Erin
> PS the plot looks really nice too.
>
> ________________________________________
> From: r-sig-geo-bounces at r-project.org [r-sig-geo-bounces at r-project.org] on
> behalf of Michael Sumner [mdsumner at gmail.com]
> Sent: Wednesday, December 05, 2012 8:34 PM
> To: Milan Sharma
> Cc: r-sig-geo at r-project.org
> Subject: Re: [R-sig-Geo] Shape file of USA land cover data
>
> It's not a shapefile, and it's not a vector format. It's a gridded
> (raster) format. Specifically it's an Erdas Imaging (.img) format:
>
> http://www.gdal.org/frmt_hfa.html
>
> I tried the Hawaii one which is much smaller (2.4Mb) and so more
> reasonable to share.
>
> http://gisdata.usgs.gov/TDDS/DownloadFile.php?TYPE=nlcdhi&FNAME=HI_landcover_wimperv_9-30-08_se5.zip
>
> You seem to have found metadata files, but I haven't found what you
> presented to us.
>
> I get this:
>
> list.files()
> [1] "hi_landcover_wimperv_9-30-08_se5.img"
> [2] "hi_landcover_wimperv_9-30-08_se5.rrd"
> [3] "landcov_meta_web_final"
>
> library(raster)
> r <- raster("hi_landcover_wimperv_9-30-08_se5.img")
> r
> class      : RasterLayer
> dimensions  : 12618, 19439, 245281302  (nrow, ncol, ncell)
> resolution  : 30, 30  (x, y)
> extent      : -345945, 237225, 1753875, 2132415  (xmin, xmax, ymin, ymax)
> coord. ref. : +proj=aea +lat_1=8.000000000000002 +lat_2=18 +lat_0=3
> +lon_0=-157 +x_0=0 +y_0=0 +ellps=WGS84 +towgs84=0,0,0,0,0,0,0 +units=m
> +no_defs
> data source :
> C:\Users\Michaels\Downloads\HI_landcover_wimperv_9-30-08_se5\hi_landcover_wimperv_9-30-08_se5.img
> names      : hi_landcover_wimperv_9.30.08_se5
> values      : 0, 95  (min, max)
> Raster Attribute Table
>     fields :  ID    COUNT  Red Green Blue Land.Cover.Class Opacity
>         min :  0        0 0.00  0.00 0.00                        0
>         max : 255 221606161 0.98  0.98 0.98  Woody Wetlands      1
>
>
> You'll have to work through the documentation for rasters to
> understand how to work with these data. The raster package requires
> rgdal to load this format, and you could do that more directly with
>
> require(rgdal)
> r <- readGDAL("hi_landcover_wimperv_9-30-08_se5.img")
>
> though arguably raster is probably a better place to start.
>
> Cheers, Mike.
>
> On Thu, Dec 6, 2012 at 1:10 PM, Milan Sharma <milansharma2012 at yahoo.com>
> wrote:
>> Hi List,
>> I  wanted to download national land cover data of USA, 2006 which I could
>> convert to shape file and do analysis. The website is
>> http://www.mrlc.gov/nlcd01_data.php.
>>  I got the following 6 files in it:
>> 1. appendix1_nlcd2006_scene_list_by_path_row_txt
>> 2. appendix1_nlcd2006_scene_list_by_path_zone_txt
>> 3. metadata_nlcd2006_lc_4-20-11-txt
>> 4. metadata_nlcd2006_lc_4-20-11-se5.ige
>> 5. metadata_nlcd2006_lc_4-20-11-se5.img
>> 6.metadata_nlcd2006_lc_4-20-11-se5.rrd
>>
>> I didn't see any shape file in here, or will I get the shape file from any
>> one  the above  file formats?
>> (Has anybody in the list downloaded such data?) (or can anybody instruct
>> me of how to get it done?
>> Thanks so much for your help,
>> Milan
>>        [[alternative HTML version deleted]]
>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>
>
> --
> Michael Sumner
> Hobart, Australia
> e-mail: mdsumner at gmail.com
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>



-- 
Michael Sumner
Hobart, Australia
e-mail: mdsumner at gmail.com


From milansharma2012 at yahoo.com  Thu Dec  6 06:23:59 2012
From: milansharma2012 at yahoo.com (Milan Sharma)
Date: Wed, 5 Dec 2012 21:23:59 -0800 (PST)
Subject: [R-sig-Geo] Shape file of USA land cover data
In-Reply-To: <CAAcGz9-dpDrD=NJCraPHCmkXHfuVc0edEkKP1Yy0=nvCFe=z-w@mail.gmail.com>
References: <1354759814.12065.YahooMailNeo@web161206.mail.bf1.yahoo.com>
	<CAAcGz98cL=gOU76_bbSF1hywMhjjC5huWPa0BFS-ZqkDXqwKnQ@mail.gmail.com>
	<FF9DB805FC41CC4E95825A50F6806302128E69E7@columbia.uhd.campus>
	<1354766965.74214.YahooMailNeo@web161201.mail.bf1.yahoo.com>
	<CAAcGz9_RrDLDwqkmVN8Oo1DC5ffEnNnpGXbJ3o_qjgtZ-r2nzw@mail.gmail.com>
	<1354768591.989.YahooMailNeo@web161203.mail.bf1.yahoo.com>
	<CAAcGz9-dpDrD=NJCraPHCmkXHfuVc0edEkKP1Yy0=nvCFe=z-w@mail.gmail.com>
Message-ID: <1354771439.48128.YahooMailNeo@web161203.mail.bf1.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121205/53a0ecdf/attachment.pl>

From rhurlin at gwdg.de  Thu Dec  6 07:30:20 2012
From: rhurlin at gwdg.de (Rainer Hurling)
Date: Thu, 06 Dec 2012 07:30:20 +0100
Subject: [R-sig-Geo] Shape file of USA land cover data
In-Reply-To: <1354771439.48128.YahooMailNeo@web161203.mail.bf1.yahoo.com>
References: <1354759814.12065.YahooMailNeo@web161206.mail.bf1.yahoo.com>
	<CAAcGz98cL=gOU76_bbSF1hywMhjjC5huWPa0BFS-ZqkDXqwKnQ@mail.gmail.com>
	<FF9DB805FC41CC4E95825A50F6806302128E69E7@columbia.uhd.campus>
	<1354766965.74214.YahooMailNeo@web161201.mail.bf1.yahoo.com>
	<CAAcGz9_RrDLDwqkmVN8Oo1DC5ffEnNnpGXbJ3o_qjgtZ-r2nzw@mail.gmail.com>
	<1354768591.989.YahooMailNeo@web161203.mail.bf1.yahoo.com>
	<CAAcGz9-dpDrD=NJCraPHCmkXHfuVc0edEkKP1Yy0=nvCFe=z-w@mail.gmail.com>
	<1354771439.48128.YahooMailNeo@web161203.mail.bf1.yahoo.com>
Message-ID: <50C03B7C.7040805@gwdg.de>

Am 06.12.2012 06:23 (UTC+1) schrieb Milan Sharma:
> My rgdal version is 2.0-31 (see below) and how the system says my version is 0.7-19? Isn't it interesting?

It seems you mixed up 'rgdal' with 'raster' here. These are different
packages and rgdal is needed by raster (as a dependency).

Please update rgdal.

>> library(raster)
> raster 2.0-31 (9-November-2012)
>> setwd("C://Users//rasmit99//Desktop")
>> r <- raster("C://Users//rasmit99//Desktop//NLCD2006_landcover_4-20-11_se5.img")
> Error in .requireRgdal(FALSE) : you use rgdal version: 0.7-19
> You need version 0.7-22 or higher
>>  
> Please clarify me if you see whats going on.
> Milan
> 
> 
> 
> ________________________________
>  From: Michael Sumner <mdsumner at gmail.com>
> 
> Sent: Wednesday, December 5, 2012 11:13 PM
> Subject: Re: [R-sig-Geo] Shape file of USA land cover data
> 
> 
> sessionInfo() will tell you what's loaded and install.packages("rgdal") in a fresh session will install latest, depending on your system
> 
> On Thursday, December 6, 2012, Milan Sharma  wrote:
> 
> Mike, I just updated my R (I uninstalled the previous version of R and installed R version 2.15.2). Still, I get the same error message.
>> BY the way, how do I check what version of rgdal version do I have and how to update that to higher one?
>> Milan
>>
>>
>>
>> Subject: Re: [R-sig-Geo] Shape file of USA land cover data
>>
>> The error message already advises on what is required:  "you use rgdal
>> version: 0.7-19. You need version 0.7-22 or higher".
>>
>> Is that not clear somehow? It's important to read the messages and
>> work on understanding them.
>>
>> Please upgrade to latest rgdal and raster, it only creates extra work
>> trying to chase issues with outdated versions. If you have trouble
>> upgrading then that's another topic, for another list.  The "R
>> Installation and Administration" manual is the first port of call for
>> maintaining your R installation, but how to do it exactly will depend
>> on your set up, operating system, whether your R is current, and other
>> things that we do not know.
>>
>> Cheers, Mike.
>>
>>
> 
> rote:
>>> Hi Erin,
>>> I got the following error..
>  Can you advise me of the solution?
>>>> setwd("C://Users//milan//Desktop")
>>>> r <- raster("nlcd2006_landcover_4-20-11_se5.img")
>>> Error in .requireRgdal(FALSE) : you use rgdal version: 0.7-19
>>> You need version 0.7-22 or higher
>>> ________________________________
>>> From: "Hodgess, Erin" <HodgessE at uhd.edu>
>>> To: Michael Sumner <mdsumner at gmail.com>; Milan Sharma
> 
>>> Cc: "r-sig-geo at r-project.org" <r-sig-geo at r-project.org>
>>> Sent:
>  Wednesday, December 5, 2012 9:45 PM
>>> Subject: RE: [R-sig-Geo] Shape file of USA land cover data
>>>
>>> Hi
>>>
>>> I got the same data set that Milan did and used the raster:
>>>
>>> r <- raster("c://goodc//nlcd2006_landcover_4-20-11_se5.img")
>>>
>>> and it worked.  When I used gdal, it said that it was too big.
>>>
>>> Thanks,
>>> Erin
>>> PS the plot looks really nice too.
>>>
>>> ________________________________________
>>> From: r-sig-geo-bounces at r-project.org [r-sig-geo-bounces at r-project.org] on
>>> behalf of Michael Sumner [mdsumner at gmail.com]
>>> Sent: Wednesday, December 05, 2012 8:34
>  PM
>>> To: Milan Sharma
>>> Cc: r-sig-geo at r-project.org
>>> Subject: Re: [R-sig-Geo] Shape file of USA land cover data
>>>
>>> It's not a shapefile, and it's not a vector format. It's a gridded
>>> (raster) format. Specifically it's an Erdas Imaging (.img) format:
>>>
>>> http://www.gdal.org/frmt_hfa.html
>>>
>>> I tried the Hawaii one which is much smaller (2.4Mb) and so more
>>> reasonable to share.
>>>
>>> http://gisdata.usgs.gov/TDDS/DownloadFile.php?TYPE=nlcdhi&FNAME=HI_landcover_wimperv_9-30-08_se5.zip
>>>
>>> You seem to have found metadata files, but I haven't found what you
>>> presented to us.
>>>
>>> I get this:
>>>
>>> list.files()
>>>
>  [1] "hi_landcover_wimperv_9-30-08_se5.img"
>>> [2] "hi_landcover_wimperv_9-30-08_se5.rrd"
>>> [3] "landcov_meta_web_final"
>>>
>>> library(raster)
>>> r <- raster("hi_landcover_wimperv_9-30-08_se5.img")
>>> r
>>> class      : RasterLayer
>>> dimensions  : 12618, 19439, 245281302  (nrow, ncol, ncell)
>>> resolution  : 30, 30  (x, y)
>>> extent      : -345945, 237225, 1753875, 2132415  (xmin, xmax, ymin, ymax)
>>> coord. ref. : +proj=aea +lat_1=8.000000000000002 +lat_2=18 +lat_0=3
>>> +lon_0=-157 +x_0=0 +y_0=0 +ellps=WGS84 +towgs84=0,0,0,0,0,0,0 +units=m
>>> +no_defs
>>> data source :
>>> C:\Users\Michaels\Downloads\HI_landcover_wimperv_9-30-08_se5\hi_landcover_wimperv_9-30-08_se5.img
>>> names      : hi_landcover_wimperv_9.30.08_se5
>>> values      : 0, 95  (mi


From Terry.Beutel at daff.qld.gov.au  Thu Dec  6 08:27:43 2012
From: Terry.Beutel at daff.qld.gov.au (Beutel, Terry S)
Date: Thu, 6 Dec 2012 17:27:43 +1000
Subject: [R-sig-Geo] assigning names to iteratively generated rasters
Message-ID: <8DDC710ABE58694FB90E74D26915702C47A1B20D0B@SPIBSRVPR08.org.local>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121206/476a459b/attachment.pl>

From HodgessE at uhd.edu  Thu Dec  6 08:38:33 2012
From: HodgessE at uhd.edu (Hodgess, Erin)
Date: Thu, 6 Dec 2012 07:38:33 +0000
Subject: [R-sig-Geo] assigning names to iteratively generated rasters
In-Reply-To: <8DDC710ABE58694FB90E74D26915702C47A1B20D0B@SPIBSRVPR08.org.local>
References: <8DDC710ABE58694FB90E74D26915702C47A1B20D0B@SPIBSRVPR08.org.local>
Message-ID: <FF9DB805FC41CC4E95825A50F6806302128E6A9B@columbia.uhd.campus>

Hi Terry, 

Try this:

assign(paste("d",i,sep=""),crop(x,extent(x,r1=r[1],r2=r[2],c1=c[1],c=c[2]))
________________________________________
From: r-sig-geo-bounces at r-project.org [r-sig-geo-bounces at r-project.org] on behalf of Beutel, Terry S [Terry.Beutel at daff.qld.gov.au]
Sent: Thursday, December 06, 2012 1:27 AM
To: r-sig-geo at r-project.org
Subject: [R-sig-Geo] assigning names to iteratively generated rasters

Hi everyone

I want to know how to iteratively assign names to rasters as I generate them, taking those names from a vector of preset names.

For example, say I have a list of the names I want my rasters to inherit. ie

> raster.names<-paste("d",1:8,sep="")
> raster.names
[1] "d1" "d2" "d3" "d4" "d5" "d6" "d7" "d8"

Now I take a raster. eg


> library(raster)

> x<-raster()

> x

class       : RasterLayer

dimensions  : 180, 360, 64800  (nrow, ncol, ncell)

resolution  : 1, 1  (x, y)

extent      : -180, 180, -90, 90  (xmin, xmax, ymin, ymax)

coord. ref. : +proj=longlat +datum=WGS84

I can iteratively crop random sections from the raster eg

for(i in 1:8){

> r<-sort(sample(1:180,2,replace=F))

> c<-sort(sample(1:360,2,replace=F))

> out<-crop(x,extent(x,r1=r[1],r2=r[2],c1=c[1],c=c[2]))

}



My question is this. Instead of saving each random crop as "out" in each iteration (and thus overwriting the previous iteration of "out"), how do I save sequential iterations with those names listed in raster.names. So for example in the first loop "out" would be saved as an object called d1, in the second as an object called d2 etc. Just to be clear, the random cropping here is just to serve an example, my real interest is in how I permanently keep rasters I generate from an iterative process under names I choose for them.



Thanks for any help.

> Dr Terry Beutel

Senior Scientist

Agri-Science Queensland



        [[alternative HTML version deleted]]

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From HodgessE at uhd.edu  Thu Dec  6 09:00:20 2012
From: HodgessE at uhd.edu (Hodgess, Erin)
Date: Thu, 6 Dec 2012 08:00:20 +0000
Subject: [R-sig-Geo] Shape file of USA land cover data
In-Reply-To: <50C03B7C.7040805@gwdg.de>
References: <1354759814.12065.YahooMailNeo@web161206.mail.bf1.yahoo.com>
	<CAAcGz98cL=gOU76_bbSF1hywMhjjC5huWPa0BFS-ZqkDXqwKnQ@mail.gmail.com>
	<FF9DB805FC41CC4E95825A50F6806302128E69E7@columbia.uhd.campus>
	<1354766965.74214.YahooMailNeo@web161201.mail.bf1.yahoo.com>
	<CAAcGz9_RrDLDwqkmVN8Oo1DC5ffEnNnpGXbJ3o_qjgtZ-r2nzw@mail.gmail.com>
	<1354768591.989.YahooMailNeo@web161203.mail.bf1.yahoo.com>
	<CAAcGz9-dpDrD=NJCraPHCmkXHfuVc0edEkKP1Yy0=nvCFe=z-w@mail.gmail.com>
	<1354771439.48128.YahooMailNeo@web161203.mail.bf1.yahoo.com>,
	<50C03B7C.7040805@gwdg.de>
Message-ID: <FF9DB805FC41CC4E95825A50F6806302128E6ABF@columbia.uhd.campus>

Hi again Milan:

You could try this:

r1 <- as(r,"SpatialPolygonsDataFrame")
write(r1,"r1","r1",driver="ESRI Shapefile")

The first step will take a REALLY long time.

Erin

________________________________________
From: r-sig-geo-bounces at r-project.org [r-sig-geo-bounces at r-project.org] on behalf of Rainer Hurling [rhurlin at gwdg.de]
Sent: Thursday, December 06, 2012 12:30 AM
To: Milan Sharma
Cc: r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] Shape file of USA land cover data

Am 06.12.2012 06:23 (UTC+1) schrieb Milan Sharma:
> My rgdal version is 2.0-31 (see below) and how the system says my version is 0.7-19? Isn't it interesting?

It seems you mixed up 'rgdal' with 'raster' here. These are different
packages and rgdal is needed by raster (as a dependency).

Please update rgdal.

>> library(raster)
> raster 2.0-31 (9-November-2012)
>> setwd("C://Users//rasmit99//Desktop")
>> r <- raster("C://Users//rasmit99//Desktop//NLCD2006_landcover_4-20-11_se5.img")
> Error in .requireRgdal(FALSE) : you use rgdal version: 0.7-19
> You need version 0.7-22 or higher
>>
> Please clarify me if you see whats going on.
> Milan
>
>
>
> ________________________________
>  From: Michael Sumner <mdsumner at gmail.com>
>
> Sent: Wednesday, December 5, 2012 11:13 PM
> Subject: Re: [R-sig-Geo] Shape file of USA land cover data
>
>
> sessionInfo() will tell you what's loaded and install.packages("rgdal") in a fresh session will install latest, depending on your system
>
> On Thursday, December 6, 2012, Milan Sharma  wrote:
>
> Mike, I just updated my R (I uninstalled the previous version of R and installed R version 2.15.2). Still, I get the same error message.
>> BY the way, how do I check what version of rgdal version do I have and how to update that to higher one?
>> Milan
>>
>>
>>
>> Subject: Re: [R-sig-Geo] Shape file of USA land cover data
>>
>> The error message already advises on what is required:  "you use rgdal
>> version: 0.7-19. You need version 0.7-22 or higher".
>>
>> Is that not clear somehow? It's important to read the messages and
>> work on understanding them.
>>
>> Please upgrade to latest rgdal and raster, it only creates extra work
>> trying to chase issues with outdated versions. If you have trouble
>> upgrading then that's another topic, for another list.  The "R
>> Installation and Administration" manual is the first port of call for
>> maintaining your R installation, but how to do it exactly will depend
>> on your set up, operating system, whether your R is current, and other
>> things that we do not know.
>>
>> Cheers, Mike.
>>
>>
>
> rote:
>>> Hi Erin,
>>> I got the following error..
>  Can you advise me of the solution?
>>>> setwd("C://Users//milan//Desktop")
>>>> r <- raster("nlcd2006_landcover_4-20-11_se5.img")
>>> Error in .requireRgdal(FALSE) : you use rgdal version: 0.7-19
>>> You need version 0.7-22 or higher
>>> ________________________________
>>> From: "Hodgess, Erin" <HodgessE at uhd.edu>
>>> To: Michael Sumner <mdsumner at gmail.com>; Milan Sharma
>
>>> Cc: "r-sig-geo at r-project.org" <r-sig-geo at r-project.org>
>>> Sent:
>  Wednesday, December 5, 2012 9:45 PM
>>> Subject: RE: [R-sig-Geo] Shape file of USA land cover data
>>>
>>> Hi
>>>
>>> I got the same data set that Milan did and used the raster:
>>>
>>> r <- raster("c://goodc//nlcd2006_landcover_4-20-11_se5.img")
>>>
>>> and it worked.  When I used gdal, it said that it was too big.
>>>
>>> Thanks,
>>> Erin
>>> PS the plot looks really nice too.
>>>
>>> ________________________________________
>>> From: r-sig-geo-bounces at r-project.org [r-sig-geo-bounces at r-project.org] on
>>> behalf of Michael Sumner [mdsumner at gmail.com]
>>> Sent: Wednesday, December 05, 2012 8:34
>  PM
>>> To: Milan Sharma
>>> Cc: r-sig-geo at r-project.org
>>> Subject: Re: [R-sig-Geo] Shape file of USA land cover data
>>>
>>> It's not a shapefile, and it's not a vector format. It's a gridded
>>> (raster) format. Specifically it's an Erdas Imaging (.img) format:
>>>
>>> http://www.gdal.org/frmt_hfa.html
>>>
>>> I tried the Hawaii one which is much smaller (2.4Mb) and so more
>>> reasonable to share.
>>>
>>> http://gisdata.usgs.gov/TDDS/DownloadFile.php?TYPE=nlcdhi&FNAME=HI_landcover_wimperv_9-30-08_se5.zip
>>>
>>> You seem to have found metadata files, but I haven't found what you
>>> presented to us.
>>>
>>> I get this:
>>>
>>> list.files()
>>>
>  [1] "hi_landcover_wimperv_9-30-08_se5.img"
>>> [2] "hi_landcover_wimperv_9-30-08_se5.rrd"
>>> [3] "landcov_meta_web_final"
>>>
>>> library(raster)
>>> r <- raster("hi_landcover_wimperv_9-30-08_se5.img")
>>> r
>>> class      : RasterLayer
>>> dimensions  : 12618, 19439, 245281302  (nrow, ncol, ncell)
>>> resolution  : 30, 30  (x, y)
>>> extent      : -345945, 237225, 1753875, 2132415  (xmin, xmax, ymin, ymax)
>>> coord. ref. : +proj=aea +lat_1=8.000000000000002 +lat_2=18 +lat_0=3
>>> +lon_0=-157 +x_0=0 +y_0=0 +ellps=WGS84 +towgs84=0,0,0,0,0,0,0 +units=m
>>> +no_defs
>>> data source :
>>> C:\Users\Michaels\Downloads\HI_landcover_wimperv_9-30-08_se5\hi_landcover_wimperv_9-30-08_se5.img
>>> names      : hi_landcover_wimperv_9.30.08_se5
>>> values      : 0, 95  (mi

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From micheledimarcantonio at gmail.com  Thu Dec  6 13:02:38 2012
From: micheledimarcantonio at gmail.com (Michele Di Marcantonio)
Date: Thu, 6 Dec 2012 13:02:38 +0100
Subject: [R-sig-Geo] How to develop variogram models in R: setting minumum
 lag distance and modelling 3D anisotropy
Message-ID: <CAO6e4JLyw8et7ufM11_4SVJ=qR2PtOPVYdsQ-F88jYkHeVt=_g@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121206/b2b1d2e6/attachment.pl>

From etiennebr at gmail.com  Thu Dec  6 14:04:12 2012
From: etiennebr at gmail.com (Etienne B. Racine)
Date: Thu, 6 Dec 2012 08:04:12 -0500
Subject: [R-sig-Geo] Antw: [raster] formal way of addressing specific
 layer in RasterStack?
In-Reply-To: <50BFED68020000270001741A@gwia2.boku.ac.at>
References: <50BFED68020000270001741A@gwia2.boku.ac.at>
Message-ID: <CALjAYt4WE0WNo6Qa9dNFQLA_jHOz=WsTnfF7-nm2cJ9J6H1f6w@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121206/1d3e37c2/attachment.pl>

From etiennebr at gmail.com  Thu Dec  6 14:18:43 2012
From: etiennebr at gmail.com (Etienne B. Racine)
Date: Thu, 6 Dec 2012 08:18:43 -0500
Subject: [R-sig-Geo] assigning names to iteratively generated rasters
In-Reply-To: <FF9DB805FC41CC4E95825A50F6806302128E6A9B@columbia.uhd.campus>
References: <8DDC710ABE58694FB90E74D26915702C47A1B20D0B@SPIBSRVPR08.org.local>
	<FF9DB805FC41CC4E95825A50F6806302128E6A9B@columbia.uhd.campus>
Message-ID: <CALjAYt52KEzkvgTE--5y2z9xtC1s1S4-sHaYoOcndqT3zsOKGQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121206/9d21cd44/attachment.pl>

From edzer.pebesma at uni-muenster.de  Thu Dec  6 18:57:09 2012
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Thu, 06 Dec 2012 18:57:09 +0100
Subject: [R-sig-Geo] How to develop variogram models in R: setting
 minumum lag distance and modelling 3D anisotropy
In-Reply-To: <CAO6e4JLyw8et7ufM11_4SVJ=qR2PtOPVYdsQ-F88jYkHeVt=_g@mail.gmail.com>
References: <CAO6e4JLyw8et7ufM11_4SVJ=qR2PtOPVYdsQ-F88jYkHeVt=_g@mail.gmail.com>
Message-ID: <50C0DC75.7040409@uni-muenster.de>



On 12/06/2012 01:02 PM, Michele Di Marcantonio wrote:
> Dear All,
> 
> 
> I have some questions about the development of variogram models in R, in
> paerticular for setting a minimum lag distance and for modelling 3D
> anisotropy.
> 
> 
> The aim of our research is to analyze a set of spatial data Z(x; y)
> distributed on a regular grid (x; y). We want to develop a Kriging
> forecasting model trying different variogram models (both isotropic and
> anisotropic) fitted using sample observations (empirical variograms).
> 
> If we use gstat (NOT STRICTLY NECESSARY) the initial codes to be run in R
> are the following:
> 
> 
> library(gstat)
> DATA<- read.table("DATA.txt",header=TRUE)
> 
> 
> In the following questions we specify some R (gstat) functions and
> parameters that we consider appropriate for reaching our objectives of
> analysis - although obviously still to be integrated/corrected considering
> the answers to our questions. However, in case you consider more
> appropriate to use different libraries, functions or parameters, we would
> be grateful if you could specify the codes we should use to run the
> analyses in R.
> 
> 
> 
> 
> 
> *1) *In the <variogram> function, for calculating the empirical variogram
> (we call it ?V.EMP?), we can set the [cutoff], that is the maximum lag
> distance between the observations to be considered. For example, for a
> maximum distance equal to 0.07:
> 
> 
> 
> V.EMP<- variogram(z~1, locations=~x+y, DATA, cutoff=0.07)
> 
> 
> *How should we do to set also a minimum distance below which observations
> must not be considered to determine the variogram? Which parameter should
> we add in the <variogram> function (if that function is the correct one)?*
> 
> *Or should we add a minimum distance parameter later in the <vgm> function
> for estimating the variogram model (and in case which one)?*

V.EMP is a data.frame, so if you want you can throw out records e.g. by

V.EMP <- V.EMP[V.EMP$dist > 0.01,]

> 
> The empirical variogram is used for fitting a variogram model and finally
> for Kriging. For example:
> 
> *
> *model.variog <- vgm(psill=0.00725878, model="Exp", nugget=0,
> range=0.2326746)
> 
> fit.variog <- fit.variogram(V.EMP, model.variog, fit.sills=TRUE,
> fit.ranges=TRUE)
> 
> OK <- krige(z~1, DATA, FORECASTS.COORDINATES, model=fit.variog)
> 
> 
> *2)* *How should we do to calculate the anisotropic empirical variogram
> (that is the empirical variogram in the three dimensions x, y and z)?*

look into arguments alpha and beta in ?variogram, as well as tol.hor and
tol.ver
> 
> *How should we do to fit a 3D anisotropic variogram model (estimating also
> the anisotropy parameters) to be used for Kriging?*

There is no high-level interface for this; you can use optim to do this,
but it's a bit of work; I have no example lying around.

> 
> *What are the R codes for calculating i) the Ordinary Kriging and ii) the
> Universal Kriging using that anisotropic variogram model (if gstat is
> appropriate, can we use the same <krige> function?)?
> 
> *

Yes.

> 
> We have tried to add one by one the following parameters (assuming an
> anisotropy angle of 90?) in the <variogram> function: [dir=pi/2],
> [dir.hor=90], [alpha=90]; nevertheless, those insertions produced no
> effects, as all the resulting variograms we obtained coincide with the one
> calculated without adding any of those parameters.
> 
>  Similarly, also the insertion of the [anis=c(k1, k2, k3, k4, k5)]
> parameter in the <vgm> function (with realistic values of the ks) produced
> no effects.
> 

If you find unexpected results, it might help to present a reproducible
example to the list.

> 
> model.variog <- vgm(psill=0.00725878, model="Exp", nugget=0,
> range=0.2326746, *anis=c(k1, k2, k3, k4, k5)*)
> 
> 
> 
> Furthermore, even if it produced effects, considering that ? if we have
> understood well ? the <fit.variog> function does not estimate the
> anisotropy parameters (the ks), we would have still the problem of
> estimating them.
> 
> 
> Once more, we have given suggestions for possible functions in gstat that
> we consider appropriate, but in case you suggest other libraries or
> functions, consider that we just need to know a code in R to calculate: i)
> empirical variogram, ii) variogram model (with minimum lag, both isotropic
> and anisotropic), iii) fit the variogram model and iv) develop Kriging on
> the base of the variogram model.
> 

Thank you for your suggestions.

I suggest using optim, then writing a well documented high-level wrapper
function, and contributing this back to the developers of gstat or some
other geostats package where this would be useful, so they can integrate
it for future users with similar needs.

> 
> 
> Thanks in advance for your help
> 
> 
> 
> Best regards,
> 
>  Michele Di Marcantonio
> 
> 	[[alternative HTML version deleted]]
> 
> 
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From bresson-georges at orange.fr  Thu Dec  6 19:11:57 2012
From: bresson-georges at orange.fr (Georges BRESSON)
Date: Thu, 6 Dec 2012 19:11:57 +0100 (CET)
Subject: [R-sig-Geo] multiple layers with administrative maps and artificial
	data
Message-ID: <186619534.79318.1354817517957.JavaMail.www@wwinf1h16>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121206/a2c17a2e/attachment.pl>

From bresson-georges at orange.fr  Thu Dec  6 19:14:48 2012
From: bresson-georges at orange.fr (Georges BRESSON)
Date: Thu, 6 Dec 2012 19:14:48 +0100 (CET)
Subject: [R-sig-Geo] multiple layers with administrative maps and artificial
	data
Message-ID: <324619502.79431.1354817688498.JavaMail.www@wwinf1h16>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121206/0e19f393/attachment.pl>

From emptican at gmail.com  Thu Dec  6 19:21:25 2012
From: emptican at gmail.com (SH)
Date: Thu, 6 Dec 2012 13:21:25 -0500
Subject: [R-sig-Geo] presence-only data analysis
Message-ID: <CALSKosB-XkXtLVOxoS-ZeZ3HXU7Ujga1F3iTWipWBgmQnOO=xA@mail.gmail.com>

Dear List:

I have googled to try to understand analyzing presence-only data and
predicting (?) species outbreaks.  Although I was able to find a few
papers, it is somewhat hard for me to figure out adapting my data.
Or, I may be looking at a wrong place.  Any suggestions/comments will
be appreciated.

I have a data set of GPS coordinates (long, lat) and presence-only
data (i.e., '1') based on counties.  I would like to estimate
likelihood of outbreak index.  For example, we know there is an
observation in (say) county A (or A, B, and C neighboring counties)
and I would like to know the likelihood (e.g., probabilities) of other
surrounding or neighboring counties (e.g., D, E, F, etc.).  Could you
give me any suggestion on analyzing this type of data?  I DON'T have
any covariates.

Thank you in advance,

SH


From jchandler at emiconsulting.com  Thu Dec  6 19:29:46 2012
From: jchandler at emiconsulting.com (Jess Chandler)
Date: Thu, 6 Dec 2012 18:29:46 +0000
Subject: [R-sig-Geo] presence-only data analysis
In-Reply-To: <CALSKosB-XkXtLVOxoS-ZeZ3HXU7Ujga1F3iTWipWBgmQnOO=xA@mail.gmail.com>
Message-ID: <CCE622E7.11DB9%jchandler@emiconsulting.com>

SH,

What you are looking at sounds like a hazard rate analysis (but with only
location and a dummy variable). You can define a set of neighbor counties
and presence for those counties (or set of counties) as another variable.
You will then have 

Outbreak risk = a(presence) + b(location-maybe) + c(neighbor)

Which model in R that you use will depend upon whether you have time
series data.

Jess


On 12/6/12 10:21 AM, "SH" <emptican at gmail.com> wrote:

>Dear List:
>
>I have googled to try to understand analyzing presence-only data and
>predicting (?) species outbreaks.  Although I was able to find a few
>papers, it is somewhat hard for me to figure out adapting my data.
>Or, I may be looking at a wrong place.  Any suggestions/comments will
>be appreciated.
>
>I have a data set of GPS coordinates (long, lat) and presence-only
>data (i.e., '1') based on counties.  I would like to estimate
>likelihood of outbreak index.  For example, we know there is an
>observation in (say) county A (or A, B, and C neighboring counties)
>and I would like to know the likelihood (e.g., probabilities) of other
>surrounding or neighboring counties (e.g., D, E, F, etc.).  Could you
>give me any suggestion on analyzing this type of data?  I DON'T have
>any covariates.
>
>Thank you in advance,
>
>SH
>
>_______________________________________________
>R-sig-Geo mailing list
>R-sig-Geo at r-project.org
>https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From emptican at gmail.com  Thu Dec  6 20:04:52 2012
From: emptican at gmail.com (SH)
Date: Thu, 6 Dec 2012 14:04:52 -0500
Subject: [R-sig-Geo] presence-only data analysis
In-Reply-To: <CCE622E7.11DB9%jchandler@emiconsulting.com>
References: <CALSKosB-XkXtLVOxoS-ZeZ3HXU7Ujga1F3iTWipWBgmQnOO=xA@mail.gmail.com>
	<CCE622E7.11DB9%jchandler@emiconsulting.com>
Message-ID: <CALSKosCxDMia+W4hmeAwGSS+vDbc11_YjOxgjcg-r4LgTCSxug@mail.gmail.com>

Thank you, Jess.

Still confused, if I understand correctly, my model will be:

Outbreak risk = a(presence) + b1(location-longitude) +
b2(location-latitude) + c(neighbor)

Then, what could be the contents of 'presence' and 'neighbor'
variables?  Are they names of counties or indices?

I don't have time component in the data.  What R-package can I look?
I found 'muhaz' package, is that one of them you think of?

Thanks again,

SH




I am not familiar with a hazard rate analysis.  I found '

On Thu, Dec 6, 2012 at 1:29 PM, Jess Chandler
<jchandler at emiconsulting.com> wrote:
> SH,
>
> What you are looking at sounds like a hazard rate analysis (but with only
> location and a dummy variable). You can define a set of neighbor counties
> and presence for those counties (or set of counties) as another variable.
> You will then have
>
> Outbreak risk = a(presence) + b(location-maybe) + c(neighbor)
>
> Which model in R that you use will depend upon whether you have time
> series data.
>
> Jess
>
>
> On 12/6/12 10:21 AM, "SH" <emptican at gmail.com> wrote:
>
>>Dear List:
>>
>>I have googled to try to understand analyzing presence-only data and
>>predicting (?) species outbreaks.  Although I was able to find a few
>>papers, it is somewhat hard for me to figure out adapting my data.
>>Or, I may be looking at a wrong place.  Any suggestions/comments will
>>be appreciated.
>>
>>I have a data set of GPS coordinates (long, lat) and presence-only
>>data (i.e., '1') based on counties.  I would like to estimate
>>likelihood of outbreak index.  For example, we know there is an
>>observation in (say) county A (or A, B, and C neighboring counties)
>>and I would like to know the likelihood (e.g., probabilities) of other
>>surrounding or neighboring counties (e.g., D, E, F, etc.).  Could you
>>give me any suggestion on analyzing this type of data?  I DON'T have
>>any covariates.
>>
>>Thank you in advance,
>>
>>SH
>>
>>_______________________________________________
>>R-sig-Geo mailing list
>>R-sig-Geo at r-project.org
>>https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From e.polaina at gmail.com  Thu Dec  6 20:36:15 2012
From: e.polaina at gmail.com (Ester Polaina Lacambra)
Date: Thu, 6 Dec 2012 20:36:15 +0100
Subject: [R-sig-Geo] Export a trellis object as a pdf, jpg or similar
Message-ID: <CAB3kvzNL6P1B60kfV8kP_ksji7ZcR-xD3m1NYXP81kJkb=mshA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121206/7855bfc5/attachment.pl>

From tim.appelhans at gmail.com  Thu Dec  6 21:32:59 2012
From: tim.appelhans at gmail.com (Tim Appelhans)
Date: Thu, 06 Dec 2012 21:32:59 +0100
Subject: [R-sig-Geo] Export a trellis object as a pdf, jpg or similar
In-Reply-To: <CAB3kvzNL6P1B60kfV8kP_ksji7ZcR-xD3m1NYXP81kJkb=mshA@mail.gmail.com>
References: <CAB3kvzNL6P1B60kfV8kP_ksji7ZcR-xD3m1NYXP81kJkb=mshA@mail.gmail.com>
Message-ID: <50C100FB.1030108@gmail.com>

Hi Ester,
for trellis objects you need the print command.

Try:

print(world_threat)

within your pdf(), jpg() or png() call and it should work.

HTH
Tim

On 6/12/2012 20:36, Ester Polaina Lacambra wrote:
> Hello everyone!
>
> I am drawing maps using spplot function, from sp package, and I am
> experiencing problems in visualizing my maps because apparently the volume
> of data is big. To avoid waiting I've thought in creating an object and
> then export it in another format such as pdf, jpg, png...
>
> I've tried pdf(), png(), but what it is recorded is an empty file. What
> else can I try?
>
> Or if not, is there any way of diminishing the time R takes to show the map
> I'm drawing?
>
> I let here my trellis object:
>
> world_threat <- spplot(World_map, "total_amenazadas", at=world_pretty$brks,
> col.regions=pal, sp.layout=spl, col = "grey30")
>
> Thank you very much,
>
> Ester
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
#####################################
Tim Appelhans
Department of Geography
Environmental Informatics
Philipps Universit?t Marburg
Deutschhausstra?e 12
35032 Marburg (Paketpost: 35037 Marburg)
Germany

Tel +49 (0) 6421 28-25957

http://environmentalinformatics-marburg.de/


From r.turner at auckland.ac.nz  Thu Dec  6 21:56:17 2012
From: r.turner at auckland.ac.nz (Rolf Turner)
Date: Fri, 07 Dec 2012 09:56:17 +1300
Subject: [R-sig-Geo] Export a trellis object as a pdf, jpg or similar
In-Reply-To: <CAB3kvzNL6P1B60kfV8kP_ksji7ZcR-xD3m1NYXP81kJkb=mshA@mail.gmail.com>
References: <CAB3kvzNL6P1B60kfV8kP_ksji7ZcR-xD3m1NYXP81kJkb=mshA@mail.gmail.com>
Message-ID: <50C10671.1080301@auckland.ac.nz>

On 07/12/12 08:36, Ester Polaina Lacambra wrote:
> Hello everyone!
>
> I am drawing maps using spplot function, from sp package, and I am
> experiencing problems in visualizing my maps because apparently the volume
> of data is big. To avoid waiting I've thought in creating an object and
> then export it in another format such as pdf, jpg, png...
>
> I've tried pdf(), png(), but what it is recorded is an empty file. What
> else can I try?
>
> Or if not, is there any way of diminishing the time R takes to show the map
> I'm drawing?
>
> I let here my trellis object:
>
> world_threat <- spplot(World_map, "total_amenazadas", at=world_pretty$brks,
> col.regions=pal, sp.layout=spl, col = "grey30")
>
> Thank you very much.

FAQ 7.22.  See also:

     fortune("confuse people")


     cheers,

         Rolf Turner


From HodgessE at uhd.edu  Thu Dec  6 22:50:55 2012
From: HodgessE at uhd.edu (Hodgess, Erin)
Date: Thu, 6 Dec 2012 21:50:55 +0000
Subject: [R-sig-Geo] installing rgdal on Debian
Message-ID: <FF9DB805FC41CC4E95825A50F6806302128E72D5@columbia.uhd.campus>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121206/d4511d74/attachment.pl>

From Terry.Beutel at daff.qld.gov.au  Fri Dec  7 05:09:57 2012
From: Terry.Beutel at daff.qld.gov.au (Beutel, Terry S)
Date: Fri, 7 Dec 2012 14:09:57 +1000
Subject: [R-sig-Geo] assigning names to iteratively generated rasters
In-Reply-To: <CALjAYt52KEzkvgTE--5y2z9xtC1s1S4-sHaYoOcndqT3zsOKGQ@mail.gmail.com>
References: <8DDC710ABE58694FB90E74D26915702C47A1B20D0B@SPIBSRVPR08.org.local>
	<FF9DB805FC41CC4E95825A50F6806302128E6A9B@columbia.uhd.campus>
	<CALjAYt52KEzkvgTE--5y2z9xtC1s1S4-sHaYoOcndqT3zsOKGQ@mail.gmail.com>
Message-ID: <8DDC710ABE58694FB90E74D26915702C47A1B20ED9@SPIBSRVPR08.org.local>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121207/65c3cded/attachment.pl>

From raffaele.morelli at gmail.com  Fri Dec  7 08:24:33 2012
From: raffaele.morelli at gmail.com (Raffaele Morelli)
Date: Fri, 7 Dec 2012 08:24:33 +0100
Subject: [R-sig-Geo] installing rgdal on Debian
In-Reply-To: <FF9DB805FC41CC4E95825A50F6806302128E72D5@columbia.uhd.campus>
References: <FF9DB805FC41CC4E95825A50F6806302128E72D5@columbia.uhd.campus>
Message-ID: <CAD4guxNiMTAb6HGHdhwJ+eNCS6HNoKMNr6qM_Mg=4wMhkO8cnA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121207/578b48bd/attachment.pl>

From hughsturrock at hotmail.com  Fri Dec  7 09:58:00 2012
From: hughsturrock at hotmail.com (hughsturrock)
Date: Fri, 7 Dec 2012 00:58:00 -0800 (PST)
Subject: [R-sig-Geo] Geographic Profiling
In-Reply-To: <CAN8mTrbq+4oDPeiOWuYjRTrKiCR0nyN0WfehXm7A=JZ-n1hJFg@mail.gmail.com>
References: <CAN8mTrbq+4oDPeiOWuYjRTrKiCR0nyN0WfehXm7A=JZ-n1hJFg@mail.gmail.com>
Message-ID: <1354870680071-7581892.post@n2.nabble.com>

Hi Bryce,

I've just seen this - get in touch with Steven le Comber at Queen Mary's in
London. They have been developing a package on this although I'm not sure if
its publicly available yet. 

Hugh



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Geographic-Profiling-tp7580320p7581892.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From edukoski at gmail.com  Fri Dec  7 11:43:08 2012
From: edukoski at gmail.com (=?UTF-8?Q?Eduardo_Bie=C3=B1kowski?=)
Date: Fri, 7 Dec 2012 08:43:08 -0200
Subject: [R-sig-Geo] installing rgdal on Debian
In-Reply-To: <FF9DB805FC41CC4E95825A50F6806302128E72D5@columbia.uhd.campus>
References: <FF9DB805FC41CC4E95825A50F6806302128E72D5@columbia.uhd.campus>
Message-ID: <CA+8CrM2LLuwTnMwnDpByPCSCgAS7TVaz6vivVx3KXeB=1qcgoQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121207/bbcd97a1/attachment.pl>

From jbechara at lri-lb.org  Fri Dec  7 11:59:52 2012
From: jbechara at lri-lb.org (Joseph Bechara)
Date: Fri, 7 Dec 2012 12:59:52 +0200
Subject: [R-sig-Geo] installing rgdal on Debian
In-Reply-To: <CA+8CrM2LLuwTnMwnDpByPCSCgAS7TVaz6vivVx3KXeB=1qcgoQ@mail.gmail.com>
References: <FF9DB805FC41CC4E95825A50F6806302128E72D5@columbia.uhd.campus>
	<CA+8CrM2LLuwTnMwnDpByPCSCgAS7TVaz6vivVx3KXeB=1qcgoQ@mail.gmail.com>
Message-ID: <000b01cdd469$fd07bdd0$f7173970$@lri-lb.org>

Hello, 

 I'm not able to use the crop function for a raster Stack. I read that this
problem was corrected in the CRAN version v 2.0-08.
But it still not working for me also I modified the CRAN.
Can somebody advise me.

JOSEPH BECHARA
Mapping Specialist
8th floor, Olivetti building, Mathaf, Beirut, Lebanon
Tel. : +961 (1) 426630-1-2
Fax: +961 (1) 426631 
Mail: jbechara at lri-lb.org
www.lri-lb.org


-----Original Message-----
From: r-sig-geo-bounces at r-project.org
[mailto:r-sig-geo-bounces at r-project.org] On Behalf Of Eduardo Bie?kowski
Sent: Friday, December 07, 2012 12:43 PM
To: Hodgess, Erin
Cc: r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] installing rgdal on Debian

Hi all.
For those who had the same problem:
The solution was:
In Ubuntu / Debian
sudo apt-get install-dev libgdal1
sudo apt-get install-dev libproj

Eduardo


2012/12/6 Hodgess, Erin <HodgessE at uhd.edu>

> Hello!
>
> I'm trying to install rgdal on Debian.
>
> I keep getting the  "checking for gdal.h...no" error.
>
> I have updated libgdal1.dev.
>
> I also put the /usr/include and /usr/include/gdal in my PATH.
>
> Any ideas as to what is wrong, please?
>
> I have a feeling that it is something very simple.
>
> Thanks,
> Erin
> PS on R-2.15.2
>
>
> Erin M. Hodgess, Ph.D.
> Associate Professor
> Department of Computer and Mathematical Sciences University of Houston 
> - Downtown
> mailto: hodgesse at uhd.edu<mailto:hodgesse at uhd.edu>
>
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



--
Eduardo

	[[alternative HTML version deleted]]

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From raffaele.morelli at gmail.com  Fri Dec  7 12:21:17 2012
From: raffaele.morelli at gmail.com (Raffaele Morelli)
Date: Fri, 7 Dec 2012 12:21:17 +0100
Subject: [R-sig-Geo] installing rgdal on Debian
In-Reply-To: <CA+8CrM2LLuwTnMwnDpByPCSCgAS7TVaz6vivVx3KXeB=1qcgoQ@mail.gmail.com>
References: <FF9DB805FC41CC4E95825A50F6806302128E72D5@columbia.uhd.campus>
	<CA+8CrM2LLuwTnMwnDpByPCSCgAS7TVaz6vivVx3KXeB=1qcgoQ@mail.gmail.com>
Message-ID: <CAD4guxOKSBUYHXqPr=KgK3BzCp0TN-WBFVy+nxM33ViemA42eQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121207/19d003da/attachment.pl>

From simon.ohanlon at imperial.ac.uk  Fri Dec  7 14:10:00 2012
From: simon.ohanlon at imperial.ac.uk (O'Hanlon, Simon J)
Date: Fri, 7 Dec 2012 13:10:00 +0000
Subject: [R-sig-Geo] Distance between two points
Message-ID: <7AE0828DCFFC0144817331B53EDC11A025DEB161@icexch-m5.ic.ac.uk>

Dear list,
I am using the package geoRglm to do some predictive mapping. There is a function that calculates the distance between observed data points and the prediction locations using a .C call to a function which eventually calculates the length of the hypotenuse between one location and the other given the vertical and horizontal separation distance of those points.

My question is, is this method of distance-finding incompatible with long-lat style coordinates? Should I first transform my data and prediction locations into something where the unit of measurement is in metres rather than decimal degrees?

Many thanks,

Simon


From sarah.goslee at gmail.com  Fri Dec  7 15:18:00 2012
From: sarah.goslee at gmail.com (Sarah Goslee)
Date: Fri, 7 Dec 2012 09:18:00 -0500
Subject: [R-sig-Geo] Distance between two points
In-Reply-To: <7AE0828DCFFC0144817331B53EDC11A025DEB161@icexch-m5.ic.ac.uk>
References: <7AE0828DCFFC0144817331B53EDC11A025DEB161@icexch-m5.ic.ac.uk>
Message-ID: <CAM_vjunxS0h+X141_MqE6Z49inMun6k0C5LXv4XJbQk9OD=Y_w@mail.gmail.com>

Precisely. You should use great-circle distances with lat-lon
coordinates, rather than Euclidean distance, because the actual length
varies with position on the globe.

Converting to UTM or something similar is one solution if your points
are not too far apart.

There are many other R solutions: searching for "great circle
distance" at rseek.org will get you quite a list.

Sarah

On Fri, Dec 7, 2012 at 8:10 AM, O'Hanlon, Simon J
<simon.ohanlon at imperial.ac.uk> wrote:
> Dear list,
> I am using the package geoRglm to do some predictive mapping. There is a function that calculates the distance between observed data points and the prediction locations using a .C call to a function which eventually calculates the length of the hypotenuse between one location and the other given the vertical and horizontal separation distance of those points.
>
> My question is, is this method of distance-finding incompatible with long-lat style coordinates? Should I first transform my data and prediction locations into something where the unit of measurement is in metres rather than decimal degrees?
>
> Many thanks,
>
> Simon
>
--
Sarah Goslee
http://www.functionaldiversity.org


From sarah.goslee at gmail.com  Fri Dec  7 15:45:38 2012
From: sarah.goslee at gmail.com (Sarah Goslee)
Date: Fri, 7 Dec 2012 09:45:38 -0500
Subject: [R-sig-Geo] Distance between two points
In-Reply-To: <7AE0828DCFFC0144817331B53EDC11A025DEB244@icexch-m5.ic.ac.uk>
References: <7AE0828DCFFC0144817331B53EDC11A025DEB161@icexch-m5.ic.ac.uk>
	<CAM_vjunxS0h+X141_MqE6Z49inMun6k0C5LXv4XJbQk9OD=Y_w@mail.gmail.com>
	<7AE0828DCFFC0144817331B53EDC11A025DEB244@icexch-m5.ic.ac.uk>
Message-ID: <CAM_vjunZJTf_r_p-HXuhwMhvhw2bqegTR-dD4SyDDYgmER2Ntg@mail.gmail.com>

Hi Simon,

I've copied this back to the list, as is encouraged.

On Fri, Dec 7, 2012 at 9:41 AM, O'Hanlon, Simon J
<simon.ohanlon at imperial.ac.uk> wrote:
> Hi Sarah, thank you.
>
> My data points are located in West Africa, so I think a good projection would be Lambert Azimuthal Equal Area.
>
> This does raise one more question for me. I also have some raster data that I wish to use as covariates which is also in geographic coordinates. If I try to simply reproject a raster, I think it would screw up the regular grid. Does it make sense if I convert the lat-long raster to a SpatialPointsDataFrame and transform this to LAEA so I could then create a grid in the desired planar coordinates from scratch and use over() to assign values from the reprojected spatial points onto the raster?

A reprojected raster is still a raster, and thus a regular grid. Or am
I missing something?

Sarah


> Thanks again for your help.
>
> Cheers,
>
> Simon
>
> -----Original Message-----
> From: Sarah Goslee [mailto:sarah.goslee at gmail.com]
> Sent: 07 December 2012 14:18
> To: O'Hanlon, Simon J
> Cc: r-sig-geo at r-project.org
> Subject: Re: [R-sig-Geo] Distance between two points
>
> Precisely. You should use great-circle distances with lat-lon coordinates, rather than Euclidean distance, because the actual length varies with position on the globe.
>
> Converting to UTM or something similar is one solution if your points are not too far apart.
>
> There are many other R solutions: searching for "great circle distance" at rseek.org will get you quite a list.
>
> Sarah
>
> On Fri, Dec 7, 2012 at 8:10 AM, O'Hanlon, Simon J <simon.ohanlon at imperial.ac.uk> wrote:
>> Dear list,
>> I am using the package geoRglm to do some predictive mapping. There is a function that calculates the distance between observed data points and the prediction locations using a .C call to a function which eventually calculates the length of the hypotenuse between one location and the other given the vertical and horizontal separation distance of those points.
>>
>> My question is, is this method of distance-finding incompatible with long-lat style coordinates? Should I first transform my data and prediction locations into something where the unit of measurement is in metres rather than decimal degrees?
>>
>> Many thanks,
>>
>> Simon
>>


--
Sarah Goslee
http://www.functionaldiversity.org


From Roger.Bivand at nhh.no  Fri Dec  7 15:56:57 2012
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 7 Dec 2012 15:56:57 +0100
Subject: [R-sig-Geo] Distance between two points
In-Reply-To: <CAM_vjunZJTf_r_p-HXuhwMhvhw2bqegTR-dD4SyDDYgmER2Ntg@mail.gmail.com>
References: <7AE0828DCFFC0144817331B53EDC11A025DEB161@icexch-m5.ic.ac.uk>
	<CAM_vjunxS0h+X141_MqE6Z49inMun6k0C5LXv4XJbQk9OD=Y_w@mail.gmail.com>
	<7AE0828DCFFC0144817331B53EDC11A025DEB244@icexch-m5.ic.ac.uk>
	<CAM_vjunZJTf_r_p-HXuhwMhvhw2bqegTR-dD4SyDDYgmER2Ntg@mail.gmail.com>
Message-ID: <alpine.LRH.2.02.1212071552050.13564@reclus.nhh.no>

On Fri, 7 Dec 2012, Sarah Goslee wrote:

> Hi Simon,
>
> I've copied this back to the list, as is encouraged.
>
> On Fri, Dec 7, 2012 at 9:41 AM, O'Hanlon, Simon J
> <simon.ohanlon at imperial.ac.uk> wrote:
>> Hi Sarah, thank you.
>>
>> My data points are located in West Africa, so I think a good projection 
>> would be Lambert Azimuthal Equal Area.
>>
>> This does raise one more question for me. I also have some raster data 
>> that I wish to use as covariates which is also in geographic 
>> coordinates. If I try to simply reproject a raster, I think it would 
>> screw up the regular grid. Does it make sense if I convert the lat-long 
>> raster to a SpatialPointsDataFrame and transform this to LAEA so I 
>> could then create a grid in the desired planar coordinates from scratch 
>> and use over() to assign values from the reprojected spatial points 
>> onto the raster?
>
> A reprojected raster is still a raster, and thus a regular grid. Or am
> I missing something?

Yes, a warped raster is a raster, but a reprojected raster will in general 
be a set of irregular points. So resampling is invoved one way or the 
other. Whether one queries the raster as-is with spatial points, and then 
projects the output, or warps the raster doing spatial query with 
projected points will depend a bit on the support(s) of the data sets. 
Maybe see: ?projectRaster in raster for warping.

Roger

>
> Sarah
>
>
>> Thanks again for your help.
>>
>> Cheers,
>>
>> Simon
>>
>> -----Original Message-----
>> From: Sarah Goslee [mailto:sarah.goslee at gmail.com]
>> Sent: 07 December 2012 14:18
>> To: O'Hanlon, Simon J
>> Cc: r-sig-geo at r-project.org
>> Subject: Re: [R-sig-Geo] Distance between two points
>>
>> Precisely. You should use great-circle distances with lat-lon coordinates, rather than Euclidean distance, because the actual length varies with position on the globe.
>>
>> Converting to UTM or something similar is one solution if your points are not too far apart.
>>
>> There are many other R solutions: searching for "great circle distance" at rseek.org will get you quite a list.
>>
>> Sarah
>>
>> On Fri, Dec 7, 2012 at 8:10 AM, O'Hanlon, Simon J <simon.ohanlon at imperial.ac.uk> wrote:
>>> Dear list,
>>> I am using the package geoRglm to do some predictive mapping. There is a function that calculates the distance between observed data points and the prediction locations using a .C call to a function which eventually calculates the length of the hypotenuse between one location and the other given the vertical and horizontal separation distance of those points.
>>>
>>> My question is, is this method of distance-finding incompatible with long-lat style coordinates? Should I first transform my data and prediction locations into something where the unit of measurement is in metres rather than decimal degrees?
>>>
>>> Many thanks,
>>>
>>> Simon
>>>
>
>
> --
> Sarah Goslee
> http://www.functionaldiversity.org
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From corrie.curtice at duke.edu  Fri Dec  7 16:05:50 2012
From: corrie.curtice at duke.edu (Corrie Curtice)
Date: Fri, 07 Dec 2012 10:05:50 -0500
Subject: [R-sig-Geo] trying to pass a grid to kernelkc
In-Reply-To: <CCE5121E.17D14%corrie.curtice@duke.edu>
Message-ID: <CCE76BB2.17E38%corrie.curtice@duke.edu>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121207/fc1ad09e/attachment.pl>

From mdsumner at gmail.com  Fri Dec  7 20:33:13 2012
From: mdsumner at gmail.com (Michael Sumner)
Date: Sat, 8 Dec 2012 06:33:13 +1100
Subject: [R-sig-Geo] Distance between two points
In-Reply-To: <alpine.LRH.2.02.1212071552050.13564@reclus.nhh.no>
References: <7AE0828DCFFC0144817331B53EDC11A025DEB161@icexch-m5.ic.ac.uk>
	<CAM_vjunxS0h+X141_MqE6Z49inMun6k0C5LXv4XJbQk9OD=Y_w@mail.gmail.com>
	<7AE0828DCFFC0144817331B53EDC11A025DEB244@icexch-m5.ic.ac.uk>
	<CAM_vjunZJTf_r_p-HXuhwMhvhw2bqegTR-dD4SyDDYgmER2Ntg@mail.gmail.com>
	<alpine.LRH.2.02.1212071552050.13564@reclus.nhh.no>
Message-ID: <CAAcGz987BWuSgtFDhMB6pB2MK9K+kkycp07sVctqBKZhrG_A8Q@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121208/67d82eca/attachment.pl>

From desiderare at yandex.ru  Sat Dec  8 12:04:12 2012
From: desiderare at yandex.ru (Olena Dubovyk)
Date: Sat, 08 Dec 2012 15:04:12 +0400
Subject: [R-sig-Geo] R-sig-Geo Digest, Vol 112, Issue 8
Message-ID: <83811354964652@mxfront10.mail.yandex.net>

Dear Mail Sender,

Thank you for your email. I will be out of the office till January 2nd 2013.

I will review your message following my return date.

Thank you for your understanding.

Best regards,

Olena Dubovyk


From simon.ohanlon at imperial.ac.uk  Sat Dec  8 12:22:42 2012
From: simon.ohanlon at imperial.ac.uk (O'Hanlon, Simon J)
Date: Sat, 8 Dec 2012 11:22:42 +0000
Subject: [R-sig-Geo] Distance between two points
In-Reply-To: <CAAcGz987BWuSgtFDhMB6pB2MK9K+kkycp07sVctqBKZhrG_A8Q@mail.gmail.com>
References: <7AE0828DCFFC0144817331B53EDC11A025DEB161@icexch-m5.ic.ac.uk>
	<CAM_vjunxS0h+X141_MqE6Z49inMun6k0C5LXv4XJbQk9OD=Y_w@mail.gmail.com>
	<7AE0828DCFFC0144817331B53EDC11A025DEB244@icexch-m5.ic.ac.uk>
	<CAM_vjunZJTf_r_p-HXuhwMhvhw2bqegTR-dD4SyDDYgmER2Ntg@mail.gmail.com>
	<alpine.LRH.2.02.1212071552050.13564@reclus.nhh.no>
	<CAAcGz987BWuSgtFDhMB6pB2MK9K+kkycp07sVctqBKZhrG_A8Q@mail.gmail.com>
Message-ID: <7AE0828DCFFC0144817331B53EDC11A025DEB832@icexch-m5.ic.ac.uk>

Dear Sarah, Roger and Michael,
Thank you very much for your help. So in summary if I understand correctly;
If I have a raster in long-lat which has some values and I would like to reproject this data to planar coordinates. A good way to proceed would be to:

- make spatial points from the lat-long raster
- transform  these spatial points to desired planar coordinates
- over(lay) the transformed spatial points on a planar raster with desired extent and resolution (ideally the resolution would be close to the original raster) and assign values to the new raster (in a sensible way)

Alternatively I could use raster::reprojectRaster and crop the edges of the new raster to a desired bounding box if I require a rectangular grid (which I do)?

Thanks again.

Simon

-----Original Message-----
From: r-sig-geo-bounces at r-project.org [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of Michael Sumner
Sent: 07 December 2012 19:33
To: Roger.Bivand at nhh.no
Cc: r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] Distance between two points

Reproject the points to the coordinate system of thr grid, do the overlay then copy the attributes back. No need to warp a raster just for over(lay).



On Saturday, December 8, 2012, Roger Bivand wrote:

> On Fri, 7 Dec 2012, Sarah Goslee wrote:
>
>  Hi Simon,
>>
>> I've copied this back to the list, as is encouraged.
>>
>> On Fri, Dec 7, 2012 at 9:41 AM, O'Hanlon, Simon J 
>> <simon.ohanlon at imperial.ac.uk> wrote:
>>
>>> Hi Sarah, thank you.
>>>
>>> My data points are located in West Africa, so I think a good 
>>> projection would be Lambert Azimuthal Equal Area.
>>>
>>> This does raise one more question for me. I also have some raster 
>>> data that I wish to use as covariates which is also in geographic coordinates.
>>> If I try to simply reproject a raster, I think it would screw up the 
>>> regular grid. Does it make sense if I convert the lat-long raster to 
>>> a SpatialPointsDataFrame and transform this to LAEA so I could then 
>>> create a grid in the desired planar coordinates from scratch and use 
>>> over() to assign values from the reprojected spatial points onto the raster?
>>>
>>
>> A reprojected raster is still a raster, and thus a regular grid. Or 
>> am I missing something?
>>
>
> Yes, a warped raster is a raster, but a reprojected raster will in 
> general be a set of irregular points. So resampling is invoved one way 
> or the other. Whether one queries the raster as-is with spatial 
> points, and then projects the output, or warps the raster doing 
> spatial query with projected points will depend a bit on the support(s) of the data sets. Maybe see:
> ?projectRaster in raster for warping.
>
> Roger
>
>
>> Sarah
>>
>>
>>  Thanks again for your help.
>>>
>>> Cheers,
>>>
>>> Simon
>>>
>>> -----Original Message-----
>>> From: Sarah Goslee [mailto:sarah.goslee at gmail.com]
>>> Sent: 07 December 2012 14:18
>>> To: O'Hanlon, Simon J
>>> Cc: r-sig-geo at r-project.org
>>> Subject: Re: [R-sig-Geo] Distance between two points
>>>
>>> Precisely. You should use great-circle distances with lat-lon 
>>> coordinates, rather than Euclidean distance, because the actual 
>>> length varies with position on the globe.
>>>
>>> Converting to UTM or something similar is one solution if your 
>>> points are not too far apart.
>>>
>>> There are many other R solutions: searching for "great circle distance"
>>> at rseek.org will get you quite a list.
>>>
>>> Sarah
>>>
>>> On Fri, Dec 7, 2012 at 8:10 AM, O'Hanlon, Simon J < 
>>> simon.ohanlon at imperial.ac.uk> wrote:
>>>
>>>> Dear list,
>>>> I am using the package geoRglm to do some predictive mapping. There 
>>>> is a function that calculates the distance between observed data 
>>>> points and the prediction locations using a .C call to a function 
>>>> which eventually calculates the length of the hypotenuse between 
>>>> one location and the other given the vertical and horizontal separation distance of those points.
>>>>
>>>> My question is, is this method of distance-finding incompatible 
>>>> with long-lat style coordinates? Should I first transform my data 
>>>> and prediction locations into something where the unit of 
>>>> measurement is in metres rather than decimal degrees?
>>>>
>>>> Many thanks,
>>>>
>>>> Simon
>>>>
>>>>
>>
>> --
>> Sarah Goslee
>> http://www.**functionaldiversity.org 
>> <http://www.functionaldiversity.org>
>>
>> ______________________________**_________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/**listinfo/r-sig-geo<https://stat.ethz.c
>> h/mailman/listinfo/r-sig-geo>
>>
>>
> --
> Roger Bivand
> Department of Economics, NHH Norwegian School of Economics, Helleveien 
> 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>
> ______________________________**_________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/**listinfo/r-sig-geo<https://stat.ethz.ch
> /mailman/listinfo/r-sig-geo>
>


--
Michael Sumner
Hobart, Australia
e-mail: mdsumner at gmail.com

	[[alternative HTML version deleted]]

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From benno.dillinger at gmail.com  Sat Dec  8 17:30:25 2012
From: benno.dillinger at gmail.com (Benno Dillinger)
Date: Sat, 08 Dec 2012 17:30:25 +0100
Subject: [R-sig-Geo] Data Manipulation
Message-ID: <50C36B21.8050507@gmail.com>

Dear all,

I'm new to R and I have a question regarding data manipulation:

I have a 2 column dataframe with
ID        value
1        1
1        2
2        3
2        4
3        5
3        6

I would like to create a dataframe that looks like

ID        value1        value2
1        1                    2
2        3                    4
3        5                    6

Any suggestions how to do this?


Additionally, is it possible for the 'numbers' to have different 
lengths, in sense of one ID having 3 entries an still being able to 
perform the (hopefully) suggested operation?

ID        value
1        1
1        2
1        2.5
2        3
2        4
3        5
3        6

==>
ID        value1        value2        value3
1        1                    2               2.5
2        3                    4               NA
3        5                    6               NA

Any help would be appreciated.

Regards

Benno


From b.rowlingson at lancaster.ac.uk  Sat Dec  8 18:33:13 2012
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Sat, 8 Dec 2012 17:33:13 +0000
Subject: [R-sig-Geo] Data Manipulation
In-Reply-To: <448a91ba163f42249b6291a36d6f4ef7@EX-1-HT0.lancs.local>
References: <448a91ba163f42249b6291a36d6f4ef7@EX-1-HT0.lancs.local>
Message-ID: <CANVKczMX2q6b4xKOSpTn-YN=nqVOmo9wDGoV+c488PxogPgdzQ@mail.gmail.com>

You are converting from 'long' to 'wide' format. This is probably
something that the 'reshape' package will do for you. Install it, and
check out the 'melt' and 'cast' functions.

 Also, you are asking a non-geo question on the geo mailing list. You
should try asking on R-help (but read the posting guide first).

You could also try asking on stackoverflow (stackoverflow.com),
tagging your question with 'R'.

 However you ask, a reproducible example is always welcome. We don't
like to have to reconstruct your data objects manually...


On Sat, Dec 8, 2012 at 4:30 PM, Benno Dillinger
<benno.dillinger at gmail.com> wrote:
> Dear all,
>
> I'm new to R and I have a question regarding data manipulation:
>
> I have a 2 column dataframe with
> ID        value
> 1        1
> 1        2
> 2        3
> 2        4
> 3        5
> 3        6
>
> I would like to create a dataframe that looks like
>
> ID        value1        value2
> 1        1                    2
> 2        3                    4
> 3        5                    6
>
> Any suggestions how to do this?
>
>
> Additionally, is it possible for the 'numbers' to have different
> lengths, in sense of one ID having 3 entries an still being able to
> perform the (hopefully) suggested operation?
>
> ID        value
> 1        1
> 1        2
> 1        2.5
> 2        3
> 2        4
> 3        5
> 3        6
>
> ==>
> ID        value1        value2        value3
> 1        1                    2               2.5
> 2        3                    4               NA
> 3        5                    6               NA
>
> Any help would be appreciated.
>
> Regards
>
> Benno
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From martin.ivanov at ifg.uni-tuebingen.de  Sat Dec  8 18:59:13 2012
From: martin.ivanov at ifg.uni-tuebingen.de (epaiv01)
Date: Sat, 08 Dec 2012 18:59:13 +0100
Subject: [R-sig-Geo] a minor bug in rgdal?
Message-ID: <50C37FF1.4040700@ifg.uni-tuebingen.de>

Dear Prof. Bivand,

I am running R-2.15.2 with rgdal version 0.7-22.
I noticed the following bug: when transforming a SpatialPoints object,
a white space is prepended to the proj4string of the target CRS. For 
example:

crds <- matrix(data=c(9.05, 48.52), ncol=2)
spPoint <- SpatialPoints(coords=crds,
  proj4string=CRS("+proj=longlat +ellps=sphere +no_defs"))
a <- spTransform(spPoint, CRS(paste("+proj=ob_tran +o_proj=longlat",
  "+o_lon_p=-162 +o_lat_p=39.25 +lon_0=180 +ellps=sphere +no_defs")),
  use_ob_tran=TRUE)

proj4string(a)
# " +proj=ob_tran +o_proj=longlat +o_lon_p=-162 +o_lat_p=39.25 
+lon_0=180 +ellps=sphere +no_defs"

As You can see, a white space is prepended to the proj4string, from 
"+proj=ob_tran ..."
it becomes " +proj=ob_tran ...". This leads to errors when one 
interpolates using krige from gstat for example.

Best regards,


-- 
Dr. Martin Ivanov
Eberhard-Karls-Universit?t T?bingen
Mathematisch-Naturwissenschaftliche Fakult?t
Fachbereich Geowissenschaften
Water & Earth System Science (WESS)
H?lderlinstra?e 12, 72074 T?bingen, Deutschland
Tel. +4970712974213


From Roger.Bivand at nhh.no  Sat Dec  8 20:39:23 2012
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sat, 8 Dec 2012 20:39:23 +0100
Subject: [R-sig-Geo] a minor bug in rgdal?
In-Reply-To: <50C37FF1.4040700@ifg.uni-tuebingen.de>
References: <50C37FF1.4040700@ifg.uni-tuebingen.de>
Message-ID: <alpine.LRH.2.02.1212082032350.20278@reclus.nhh.no>

On Sat, 8 Dec 2012, epaiv01 wrote:

> Dear Prof. Bivand,
>
> I am running R-2.15.2 with rgdal version 0.7-22.
> I noticed the following bug: when transforming a SpatialPoints object,
> a white space is prepended to the proj4string of the target CRS. For example:

Thanks for a helpful example. The problem has been around for a long time, 
and is basically caused by pj_get_def() in PROJ.4, which prepends a space. 
This function is called in various places in rgdal, and in addition, when 
the sp constructor method for CRS objects is called when rgdal is loaded, 
it is called then too; it checks the string for formal errors. Probably a 
forthcoming release of sp would have permitted this to be resolved at the 
R level, but in order to sort things out for earlier sp versions, I've 
added a trap in the C code in rgdal. I've committed the fix to R-forge SVN 
revision 402.

Please let me know if this helps,

Roger

>
> crds <- matrix(data=c(9.05, 48.52), ncol=2)
> spPoint <- SpatialPoints(coords=crds,
> proj4string=CRS("+proj=longlat +ellps=sphere +no_defs"))
> a <- spTransform(spPoint, CRS(paste("+proj=ob_tran +o_proj=longlat",
> "+o_lon_p=-162 +o_lat_p=39.25 +lon_0=180 +ellps=sphere +no_defs")),
> use_ob_tran=TRUE)
>
> proj4string(a)
> # " +proj=ob_tran +o_proj=longlat +o_lon_p=-162 +o_lat_p=39.25 +lon_0=180 
> +ellps=sphere +no_defs"
>
> As You can see, a white space is prepended to the proj4string, from 
> "+proj=ob_tran ..."
> it becomes " +proj=ob_tran ...". This leads to errors when one interpolates 
> using krige from gstat for example.
>
> Best regards,
>
>
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From martin.ivanov at ifg.uni-tuebingen.de  Sat Dec  8 21:16:33 2012
From: martin.ivanov at ifg.uni-tuebingen.de (epaiv01)
Date: Sat, 08 Dec 2012 21:16:33 +0100
Subject: [R-sig-Geo] a minor bug in rgdal?
In-Reply-To: <alpine.LRH.2.02.1212082032350.20278@reclus.nhh.no>
References: <50C37FF1.4040700@ifg.uni-tuebingen.de>
	<alpine.LRH.2.02.1212082032350.20278@reclus.nhh.no>
Message-ID: <50C3A021.8040200@ifg.uni-tuebingen.de>

Dear Prof. Bivand,

Thank You very much for Your fast response. Now the proj4string after 
spTransform is ok.
Many thanks again.

Best regards,

Martin Ivanov

On 12/08/2012 08:39 PM, Roger Bivand wrote:
> On Sat, 8 Dec 2012, epaiv01 wrote:
>
>> Dear Prof. Bivand,
>>
>> I am running R-2.15.2 with rgdal version 0.7-22.
>> I noticed the following bug: when transforming a SpatialPoints object,
>> a white space is prepended to the proj4string of the target CRS. For 
>> example:
>
> Thanks for a helpful example. The problem has been around for a long 
> time, and is basically caused by pj_get_def() in PROJ.4, which 
> prepends a space. This function is called in various places in rgdal, 
> and in addition, when the sp constructor method for CRS objects is 
> called when rgdal is loaded, it is called then too; it checks the 
> string for formal errors. Probably a forthcoming release of sp would 
> have permitted this to be resolved at the R level, but in order to 
> sort things out for earlier sp versions, I've added a trap in the C 
> code in rgdal. I've committed the fix to R-forge SVN revision 402.
>
> Please let me know if this helps,
>
> Roger
>
>>
>> crds <- matrix(data=c(9.05, 48.52), ncol=2)
>> spPoint <- SpatialPoints(coords=crds,
>> proj4string=CRS("+proj=longlat +ellps=sphere +no_defs"))
>> a <- spTransform(spPoint, CRS(paste("+proj=ob_tran +o_proj=longlat",
>> "+o_lon_p=-162 +o_lat_p=39.25 +lon_0=180 +ellps=sphere +no_defs")),
>> use_ob_tran=TRUE)
>>
>> proj4string(a)
>> # " +proj=ob_tran +o_proj=longlat +o_lon_p=-162 +o_lat_p=39.25 
>> +lon_0=180 +ellps=sphere +no_defs"
>>
>> As You can see, a white space is prepended to the proj4string, from 
>> "+proj=ob_tran ..."
>> it becomes " +proj=ob_tran ...". This leads to errors when one 
>> interpolates using krige from gstat for example.
>>
>> Best regards,
>>
>>
>>
>


-- 
Dr. Martin Ivanov
Eberhard-Karls-Universit?t T?bingen
Mathematisch-Naturwissenschaftliche Fakult?t
Fachbereich Geowissenschaften
Water & Earth System Science (WESS)
H?lderlinstra?e 12, 72074 T?bingen, Deutschland
Tel. +4970712974213


From desiderare at yandex.ru  Sun Dec  9 12:03:15 2012
From: desiderare at yandex.ru (Olena Dubovyk)
Date: Sun, 09 Dec 2012 15:03:15 +0400
Subject: [R-sig-Geo] R-sig-Geo Digest, Vol 112, Issue 9
Message-ID: <88131355050995@mxfront37.mail.yandex.net>

Dear Mail Sender,

Thank you for your email. I will be out of the office till January 2nd 2013.

I will review your message following my return date.

Thank you for your understanding.

Best regards,

Olena Dubovyk


From berryboessenkool at hotmail.com  Sun Dec  9 17:48:40 2012
From: berryboessenkool at hotmail.com (Berry Boessenkool)
Date: Sun, 9 Dec 2012 17:48:40 +0100
Subject: [R-sig-Geo] dissolve and other things
Message-ID: <BAY173-W42522DC582544BAF8618BBD54A0@phx.gbl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121209/7968f1e6/attachment.pl>

From piero.campa at gmail.com  Sun Dec  9 20:08:07 2012
From: piero.campa at gmail.com (piero campa)
Date: Sun, 9 Dec 2012 11:08:07 -0800 (PST)
Subject: [R-sig-Geo] Time-extent/time-lag in spatiotemporal variograms
Message-ID: <1355080087882-7581911.post@n2.nabble.com>

Dear experts,

rather than a technical question, this is more about how to set up a model
for spatiotemporal kriging predictions.

With special regard to the fitting of a spatio-temporal model, whichever the
covariance model I want will use, I was wondering /how deep/ in time should
my `spacetime` ST*DF object be.

The temporal memory I am expecting to have should drive the cutoff distance
of the variogram in time, but how many temporal units of data should I
(better) have in case I want, say, N tlags in the variogram?

I know that ~30 pairs per lag are suggested for a stable variogram. Assuming
I have a pattern in space that permits such rule-of-thumb to be satisfied,
in case I have e.g. 3 different days with the same spatial pattern, I could
also compute my stable experimental spatiotemporal variogram with 2-3
temporal lags with no worries of not having enough pairs for meaningful
statistics (even at the border lags I would have a sufficient number of
observations).

Thanks for any guidance/reference,
Piero







--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Time-extent-time-lag-in-spatiotemporal-variograms-tp7581911.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From edzer.pebesma at uni-muenster.de  Mon Dec 10 10:48:14 2012
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Mon, 10 Dec 2012 10:48:14 +0100
Subject: [R-sig-Geo] How to develop variogram models in R: setting
 minumum lag distance and modelling 3D anisotropy
In-Reply-To: <CAO6e4JLE_0v=oZU6wLvW+Z0gFAhXZo4Y3q--CQ1y65+Stq2OFg@mail.gmail.com>
References: <CAO6e4JLyw8et7ufM11_4SVJ=qR2PtOPVYdsQ-F88jYkHeVt=_g@mail.gmail.com>
	<50C0DC75.7040409@uni-muenster.de>
	<CAO6e4JLE_0v=oZU6wLvW+Z0gFAhXZo4Y3q--CQ1y65+Stq2OFg@mail.gmail.com>
Message-ID: <50C5AFDE.3020301@uni-muenster.de>



On 12/09/2012 11:03 PM, Michele Di Marcantonio wrote:
> Dear Edezer,
> 
> thank you for your help and for all your suggestions.
> 
> I have tried to develop the analyses adding the "$dist > D" parameter in
> order to throw out records but I have got an error message, surely for my
> fault. Anyway, if possible, I would like to calculate the empirical
> variogram just for lag distances higher than a "D" value without throwing
> away records.
> 
> I enclose you a txt file "DATA" with [x, y, Z] sample values, where (x, y)
> are the coordinates of the Z(x, y) observations.
> Below is the base for a possible code in gstat to get what I need following
> those sample data.
> 
> I would be grateful if somebody could help me showing me directly how
> should I integrate and/or correct that code in order to:
> 
> 1) get a variogram model just for lag distances higher than a "D" level
> (for the sample: e.g. for lag distances between 0.24 and 0.42, so
> cutoff=0.42 and minimum distance (function?)=0.24);

variog1=variog1[variog1$dist > 0.24 & variog1$dist < 0.42,]
fit.variog1 <- fit.variogram(variog1, model.variog1)
plot(variog1,fit.variog1)

selects the sample variogram values in the range you mention, and fits a
model to those. Of course, this model again is valid for every distance,
as a variogram model is supposed to.

> 2) calculate a 3D anisotropic variogram (both empirical and a model) which
> can be used for kriging (krige(z~1, DATA, LOCATIONS, model=fit.variog1)).

I gave suggestions in my previous answer; did you try them?

> 
> Thank you again,
> 
> Michele
> 
> ---
> 
> ### Libraries
> library(gstat)
> ### Data
> DATA<- read.table("DATA.txt",header=TRUE)
> names(DATA)
> attach(DATA)
> ### Empiricial variogram
> variog1 <- variogram(z~1, locations=~x+y, DATA, cutoff=0.42)
> variog1
> plot(variog1)
> ### Variogram fitting
> model.variog1 <- vgm(psill=0.7, model="Gau", nugget=0, range=1)
> fit.variog1 <- fit.variogram(variog1, model.variog1, fit.sills=TRUE,
> fit.ranges=TRUE)
> plot(variog1, model=fit.variog1)
> fit.variog1
> 
> 
> 2012/12/6 Edzer Pebesma <edzer.pebesma at uni-muenster.de>
> 
>>
>>
>> On 12/06/2012 01:02 PM, Michele Di Marcantonio wrote:
>>> Dear All,
>>>
>>>
>>> I have some questions about the development of variogram models in R, in
>>> paerticular for setting a minimum lag distance and for modelling 3D
>>> anisotropy.
>>>
>>>
>>> The aim of our research is to analyze a set of spatial data Z(x; y)
>>> distributed on a regular grid (x; y). We want to develop a Kriging
>>> forecasting model trying different variogram models (both isotropic and
>>> anisotropic) fitted using sample observations (empirical variograms).
>>>
>>> If we use gstat (NOT STRICTLY NECESSARY) the initial codes to be run in R
>>> are the following:
>>>
>>>
>>> library(gstat)
>>> DATA<- read.table("DATA.txt",header=TRUE)
>>>
>>>
>>> In the following questions we specify some R (gstat) functions and
>>> parameters that we consider appropriate for reaching our objectives of
>>> analysis - although obviously still to be integrated/corrected
>> considering
>>> the answers to our questions. However, in case you consider more
>>> appropriate to use different libraries, functions or parameters, we would
>>> be grateful if you could specify the codes we should use to run the
>>> analyses in R.
>>>
>>>
>>>
>>>
>>>
>>> *1) *In the <variogram> function, for calculating the empirical variogram
>>> (we call it ?V.EMP?), we can set the [cutoff], that is the maximum lag
>>> distance between the observations to be considered. For example, for a
>>> maximum distance equal to 0.07:
>>>
>>>
>>>
>>> V.EMP<- variogram(z~1, locations=~x+y, DATA, cutoff=0.07)
>>>
>>>
>>> *How should we do to set also a minimum distance below which observations
>>> must not be considered to determine the variogram? Which parameter should
>>> we add in the <variogram> function (if that function is the correct
>> one)?*
>>>
>>> *Or should we add a minimum distance parameter later in the <vgm>
>> function
>>> for estimating the variogram model (and in case which one)?*
>>
>> V.EMP is a data.frame, so if you want you can throw out records e.g. by
>>
>> V.EMP <- V.EMP[V.EMP$dist > 0.01,]
>>
>>>
>>> The empirical variogram is used for fitting a variogram model and finally
>>> for Kriging. For example:
>>>
>>> *
>>> *model.variog <- vgm(psill=0.00725878, model="Exp", nugget=0,
>>> range=0.2326746)
>>>
>>> fit.variog <- fit.variogram(V.EMP, model.variog, fit.sills=TRUE,
>>> fit.ranges=TRUE)
>>>
>>> OK <- krige(z~1, DATA, FORECASTS.COORDINATES, model=fit.variog)
>>>
>>>
>>> *2)* *How should we do to calculate the anisotropic empirical variogram
>>> (that is the empirical variogram in the three dimensions x, y and z)?*
>>
>> look into arguments alpha and beta in ?variogram, as well as tol.hor and
>> tol.ver
>>>
>>> *How should we do to fit a 3D anisotropic variogram model (estimating
>> also
>>> the anisotropy parameters) to be used for Kriging?*
>>
>> There is no high-level interface for this; you can use optim to do this,
>> but it's a bit of work; I have no example lying around.
>>
>>>
>>> *What are the R codes for calculating i) the Ordinary Kriging and ii) the
>>> Universal Kriging using that anisotropic variogram model (if gstat is
>>> appropriate, can we use the same <krige> function?)?
>>>
>>> *
>>
>> Yes.
>>
>>>
>>> We have tried to add one by one the following parameters (assuming an
>>> anisotropy angle of 90?) in the <variogram> function: [dir=pi/2],
>>> [dir.hor=90], [alpha=90]; nevertheless, those insertions produced no
>>> effects, as all the resulting variograms we obtained coincide with the
>> one
>>> calculated without adding any of those parameters.
>>>
>>>  Similarly, also the insertion of the [anis=c(k1, k2, k3, k4, k5)]
>>> parameter in the <vgm> function (with realistic values of the ks)
>> produced
>>> no effects.
>>>
>>
>> If you find unexpected results, it might help to present a reproducible
>> example to the list.
>>
>>>
>>> model.variog <- vgm(psill=0.00725878, model="Exp", nugget=0,
>>> range=0.2326746, *anis=c(k1, k2, k3, k4, k5)*)
>>>
>>>
>>>
>>> Furthermore, even if it produced effects, considering that ? if we have
>>> understood well ? the <fit.variog> function does not estimate the
>>> anisotropy parameters (the ks), we would have still the problem of
>>> estimating them.
>>>
>>>
>>> Once more, we have given suggestions for possible functions in gstat that
>>> we consider appropriate, but in case you suggest other libraries or
>>> functions, consider that we just need to know a code in R to calculate:
>> i)
>>> empirical variogram, ii) variogram model (with minimum lag, both
>> isotropic
>>> and anisotropic), iii) fit the variogram model and iv) develop Kriging on
>>> the base of the variogram model.
>>>
>>
>> Thank you for your suggestions.
>>
>> I suggest using optim, then writing a well documented high-level wrapper
>> function, and contributing this back to the developers of gstat or some
>> other geostats package where this would be useful, so they can integrate
>> it for future users with similar needs.
>>
>>>
>>>
>>> Thanks in advance for your help
>>>
>>>
>>>
>>> Best regards,
>>>
>>>  Michele Di Marcantonio
>>>
>>>       [[alternative HTML version deleted]]
>>>
>>>
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>> --
>> Edzer Pebesma
>> Institute for Geoinformatics (ifgi), University of M?nster
>> Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
>> 8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
>> http://www.52north.org/geostatistics      e.pebesma at wwu.de
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From virgilio.gomez at uclm.es  Mon Dec 10 10:54:08 2012
From: virgilio.gomez at uclm.es (Virgilio =?ISO-8859-1?Q?G=F3mez-Rubio?=)
Date: Mon, 10 Dec 2012 10:54:08 +0100
Subject: [R-sig-Geo] Reminder useR! 2013: call for tutorials
Message-ID: <1355133248.2993.2.camel@virgil-HP-Compaq-8000-Elite-USDT-PC>

Dear all,

This is a reminder that the deadline for proposing a tutorial for 
useR! 2013 is this Friday (see below). We'd love to have some tutorials 
on spatial data analysis and/or spatial statistics.

Best,

Virgilio 


---

We are pleased to announce that the R user conference

   useR! 2013

is scheduled for July 10-12, 2013, and will take place at the
University of Castilla-La Mancha, Albacete, Spain.

As for the predecessor conferences, the program will consist of two
parts: invited lectures and user-contributed sessions (abstract
submission will be available soon). Prior to the
conference, there will be tutorials on R (proposals for tutorials should
be sent before December 15, 2012, see below).

CONFIRMED INVITED SPEAKERS

Mar?a Jes?s Bayarri, Jos? Manuel Ben?tez-S?nchez, Havard Rue, Steve
Scott and Hadley Wickham

USER-CONTRIBUTED SESSIONS

The conference will feature both talks and posters illustrating the use
of R in practice. Contributions are welcome that introduce recent
developments in the R Project (including CRAN packages), demonstrate
applications of R in areas of current interest, or otherwise engage and
inspire participants in their use of R.

PRE-CONFERENCE TUTORIALS

Before the official program, half-day tutorials will be offered on
Tuesday, July 9.

We invite R users to submit proposals for three hour tutorials on
special topics regarding R. The proposals should give a brief
description of the tutorial, including goals, detailed outline,
justification of why the tutorial is important, background knowledge
required and potential attendees. The proposals should be sent before
December 15, 2012 to useR-2013_at_R-project.org.

A web page offering more information on the `useR!' conference is
available at

   http://www.R-project.org/useR-2013

We hope to see you in Albacete!

The organizing committee:

Esteban Alfaro, Jos? Luis Alfaro, M. Teresa Alonso, Emilio L. Cano, 
Gonzalo Garc?a-Donato, Mat?as G?mez, Noelia Garc?a, Virgilio
G?mez-Rubio, Mar?a Jos? Haro, Eva J. Moreno and Francisco Parre?o. 


From desiderare at yandex.ru  Mon Dec 10 12:05:35 2012
From: desiderare at yandex.ru (Olena Dubovyk)
Date: Mon, 10 Dec 2012 15:05:35 +0400
Subject: [R-sig-Geo] R-sig-Geo Digest, Vol 112, Issue 10
Message-ID: <104451355137535@mxfront23.mail.yandex.net>

Dear Mail Sender,

Thank you for your email. I will be out of the office till January 2nd 2013.

I will review your message following my return date.

Thank you for your understanding.

Best regards,

Olena Dubovyk


From jwesroberts at gmail.com  Mon Dec 10 14:28:48 2012
From: jwesroberts at gmail.com (Wesley Roberts)
Date: Mon, 10 Dec 2012 15:28:48 +0200
Subject: [R-sig-Geo] wget error While downloading a MODIS Tile
Message-ID: <CAFik=FcDcY-AmpWOHqKZKUCiWJSnNcduv+X376OGXHMhqzk3Fg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121210/368345f5/attachment.pl>

From matteo.mattiuzzi at boku.ac.at  Mon Dec 10 14:48:43 2012
From: matteo.mattiuzzi at boku.ac.at (Matteo Mattiuzzi)
Date: Mon, 10 Dec 2012 14:48:43 +0100
Subject: [R-sig-Geo] wget error While downloading a MODIS Tile
Message-ID: <50C5F64B02000027000175AA@gwia2.boku.ac.at>

Dear Wesley,


You may give a try to the MODIS package. Currently it has build problems in R-Forge but you can also install ZIP or TAR from here:
https://www.dropbox.com/sh/18t0rgcm6bga7xt/-4k_Xwojxr/MODIS


If you just want to download the data you are fine with that. If you want to also process the data and you use Windows, you need a GDAL with HDF4 driver (FWTools or OSgeos4W).
http://trac.osgeo.org/osgeo4w/ (http://download.osgeo.org/osgeo4w/osgeo4w-setup.exe)
or 
http://fwtools.maptools.org/ (http://home.gdal.org/fwtools/FWTools247.exe)


If basic settings (like the location of the local HDF archieve) are fine see ?MODISoptions, you can proceed directly to the processing see: ?runGdal().


Matteo
  

>>> Wesley Roberts  12/10/12 2:30 PM >>>
Dear R-Sig-Geo,


I am currently using a script I downloaded from the
spatial-analyst.netwebsite to download and mosaic a couple of MODIS
Tiles for my study area (
http://spatial-analyst.net/wiki/index.php?title=Download_and_resampling_of_MODIS_images
)

I have managed to get as far as the first wget request and am receiving the
following error.

> download.file(paste(MOD13A3, dates$dirname[[i]], "/", BLOCK1,sep=""),
destfile=paste(getwd(), "/", BLOCK1, sep=""), mode='wb', method='wget',
quiet=T, cacheOK=FALSE)
cygwin warning:
  MS-DOS style path detected:
C:/Users/biocarbon/Documents/MOD13A3.A2001091.h20v09.005.2007112114336.hdf
  Preferred POSIX equivalent is:
/cygdrive/c/Users/biocarbon/Documents/MOD13A3.A2001091.h20v09.005.2007112114336.hdf
  CYGWIN environment variable option "nodosfilewarning" turns off this
warning.
  Consult the user's guide for more details about POSIX paths:
    http://cygwin.com/cygwin-ug-net/using.html#using-pathnames
Warning messages:
1: running command 'wget --quiet --cache=off "
ftp://e4ftl01.cr.usgs.gov/MOLT/MOD13A3.005/2001.05.01/MOD13A3.A2001091.h20v09.005.2007112114336.hdf"
-O
"C:/Users/biocarbon/Documents/MOD13A3.A2001091.h20v09.005.2007112114336.hdf"'
had status 8
2: In download.file(paste(MOD13A3, dates$dirname[[i]], "/", BLOCK1,  :
  download had nonzero exit status


I presume wget is working correctly and that I have specified the correct
server credentials as per the original example code. I am currently
manually downloading data using FileZilla so I presume the server is
working. Is wget allowed to access data on this server? If not are there
other tools I can use to download the data?

Any help on the above mentioned error would be greatly appreciated.

Many thanks and kind regards,
Wesley


-- 
Dr Wesley Roberts
jwesroberts at gmail.com
Cell: +27(0)83 5355 646
skype: roberts-w

    [[alternative HTML version deleted]]

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From johannesradinger at gmail.com  Mon Dec 10 15:21:45 2012
From: johannesradinger at gmail.com (Johannes Radinger)
Date: Mon, 10 Dec 2012 15:21:45 +0100
Subject: [R-sig-Geo] Cluster (Group) Layers of a RasterBrick
Message-ID: <CABsGe_yJv-z3goZo7TNk864MqkT67=ekouJb42Pb+=wBNCFkcg@mail.gmail.com>

Hi,

I have a RasterBrick with multiple Layers (appr. 50). Some
of the layers are correlated as they show similar patterns (although
maybe in different scales).
Now I'd like to do a cluster analysis or similar to arrange my layers
into groups of similar information. I thought about sampling the
rasterbrick at each cell (or randomly at 1000 cells) and then I take
the information of each layer as characteristic of each sampling site.
Then I could do an ordinary cluster analysis like it is done for other
datasets.
Or is there a simpler way to do that e.g with the "raster"-package.
Has anybody recommendations on that?

/johannes


From jwesroberts at gmail.com  Mon Dec 10 15:28:47 2012
From: jwesroberts at gmail.com (Wesley Roberts)
Date: Mon, 10 Dec 2012 16:28:47 +0200
Subject: [R-sig-Geo] wget error While downloading a MODIS Tile
In-Reply-To: <50C5F64B02000027000175AA@gwia2.boku.ac.at>
References: <50C5F64B02000027000175AA@gwia2.boku.ac.at>
Message-ID: <CAFik=FfuU5GKRUbyweNkWuk5VP6bwQoaj0TKQE8BXAuHEDrciQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121210/f07d0875/attachment.pl>

From matteo.mattiuzzi at boku.ac.at  Mon Dec 10 16:44:37 2012
From: matteo.mattiuzzi at boku.ac.at (Matteo Mattiuzzi)
Date: Mon, 10 Dec 2012 16:44:37 +0100
Subject: [R-sig-Geo] wget error While downloading a MODIS Tile
Message-ID: <50C6117502000027000175D6@gwia2.boku.ac.at>

There is currently being created a Blog: http://stevemosher.wordpress.com/
I think the very last changes are not specified there for now. So I suggest to first try the lines below and if you face problems the blog may helps. Soon the blog will become a nice description with examples!
  
The MODIS package is intended to download MODIS Grid (land) data from from LP_DAAC and LAADS Server (manly done by the ?getHdf function)
to pre-process the data (conversion from HDF to GeoTIFF, crop, mosaic, reproject) using GDAL or MRT, performed with ?runGdal or ?runMrt functions.
and some further processing mainly thought for Time Series:


repDoy # vectorizes the DOY information in the 'day of the year layer'
makeWeights # extracts and encodes QA bit information


# for Time series filtering
whittaker.raster
smooth.spline.raster


The idea is to make data available to other packages (especially to the raster package)


check if calling MODISoptions() the settings "localArcPath", "outDirPath" and "GDAL" and "DEPENDENCIES" are fine. If so proceed:


and If you have already downloaded MODIS data, you can use the function ?orgStruc to MOVE or COPY the data to the standard archive.
orgStruc(from="root/dir/of/data") # it will move or copy all HDF files found under 'from' to options("MODIS_localArcPath") and so available to the MODIS package.
  
As getHdf is integrated in runGdal as first thing try to do something like that:


runGdal(product="MOD13A1",begin="2010001",end="2010030",job="MODIStest")
# a window will pop-up to select the area (see the "extent" argument)
# see arguments in runGdal. Most important: SDSstring, outProj (prj4).


see the result in dir:
options("MODIS_outDirPath")


Last week I did major changes, so the package defaults are printed out very often...but the functionality should be hopefully fine!


Matteo






>>> Wesley Roberts  12/10/12 3:28 PM >>>
Many thanks Matteo,

I downloaded the file and installed the zip to my local R directory. Am
busy trying to figure out how the package works.

My workflow is very simple, I would like to download some MODIS Albedo and
EVI data to conduct a Change Vector Analysis for our study area. I am able
to undertake the exercise using standard gdal, grass, qgis tools however, I
would like to try and accomplish the task using an R script only. As such I
would like all of the processing to be done within the R script.


Do you have any example scripts I could use to become more familiar with
the tools? I have the manual and will use that for now.

Many thanks,
Wesley


On Mon, Dec 10, 2012 at 3:48 PM, Matteo Mattiuzzi <
matteo.mattiuzzi at boku.ac.at> wrote:

> Dear Wesley,
>
>
> You may give a try to the MODIS package. Currently it has build problems
> in R-Forge but you can also install ZIP or TAR from here:
> https://www.dropbox.com/sh/18t0rgcm6bga7xt/-4k_Xwojxr/MODIS
>
>
> If you just want to download the data you are fine with that. If you want
> to also process the data and you use Windows, you need a GDAL with HDF4
> driver (FWTools or OSgeos4W).
> http://trac.osgeo.org/osgeo4w/ (
> http://download.osgeo.org/osgeo4w/osgeo4w-setup.exe)
> or
> http://fwtools.maptools.org/ (http://home.gdal.org/fwtools/FWTools247.exe)
>
>
> If basic settings (like the location of the local HDF archieve) are fine
> see ?MODISoptions, you can proceed directly to the processing see:
> ?runGdal().
>
>
> Matteo
>
>
> >>> Wesley Roberts  12/10/12 2:30 PM >>>
> Dear R-Sig-Geo,
>
>
> I am currently using a script I downloaded from the
> spatial-analyst.netwebsite to download and mosaic a couple of MODIS
> Tiles for my study area (
>
> http://spatial-analyst.net/wiki/index.php?title=Download_and_resampling_of_MODIS_images
> )
>
> I have managed to get as far as the first wget request and am receiving the
> following error.
>
> > download.file(paste(MOD13A3, dates$dirname[[i]], "/", BLOCK1,sep=""),
> destfile=paste(getwd(), "/", BLOCK1, sep=""), mode='wb', method='wget',
> quiet=T, cacheOK=FALSE)
> cygwin warning:
>   MS-DOS style path detected:
> C:/Users/biocarbon/Documents/MOD13A3.A2001091.h20v09.005.2007112114336.hdf
>   Preferred POSIX equivalent is:
>
> /cygdrive/c/Users/biocarbon/Documents/MOD13A3.A2001091.h20v09.005.2007112114336.hdf
>   CYGWIN environment variable option "nodosfilewarning" turns off this
> warning.
>   Consult the user's guide for more details about POSIX paths:
>     http://cygwin.com/cygwin-ug-net/using.html#using-pathnames
> Warning messages:
> 1: running command 'wget --quiet --cache=off "
>
> ftp://e4ftl01.cr.usgs.gov/MOLT/MOD13A3.005/2001.05.01/MOD13A3.A2001091.h20v09.005.2007112114336.hdf
> "
> -O
>
> "C:/Users/biocarbon/Documents/MOD13A3.A2001091.h20v09.005.2007112114336.hdf"'
> had status 8
> 2: In download.file(paste(MOD13A3, dates$dirname[[i]], "/", BLOCK1,  :
>   download had nonzero exit status
>
>
> I presume wget is working correctly and that I have specified the correct
> server credentials as per the original example code. I am currently
> manually downloading data using FileZilla so I presume the server is
> working. Is wget allowed to access data on this server? If not are there
> other tools I can use to download the data?
>
> Any help on the above mentioned error would be greatly appreciated.
>
> Many thanks and kind regards,
> Wesley
>
>
> --
> Dr Wesley Roberts
> jwesroberts at gmail.com
> Cell: +27(0)83 5355 646
> skype: roberts-w
>
>     [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
>


-- 
Dr Wesley Roberts
jwesroberts at gmail.com
Cell: +27(0)83 5355 646
skype: roberts-w


From bwilso27 at utk.edu  Mon Dec 10 17:12:32 2012
From: bwilso27 at utk.edu (Wilson, Bruce Edwin)
Date: Mon, 10 Dec 2012 16:12:32 +0000
Subject: [R-sig-Geo] wget error While downloading a MODIS Tile
In-Reply-To: <CAFik=FfuU5GKRUbyweNkWuk5VP6bwQoaj0TKQE8BXAuHEDrciQ@mail.gmail.com>
References: <50C5F64B02000027000175AA@gwia2.boku.ac.at>,
	<CAFik=FfuU5GKRUbyweNkWuk5VP6bwQoaj0TKQE8BXAuHEDrciQ@mail.gmail.com>
Message-ID: <5F1BF1E6-A7FD-440F-8EE5-DEBBAB67459F@utk.edu>

Wesley -- it depends on how large your study area is.  If it's less than 201 km area of interest, there is an application at http://daac.ornl.gov/MODIS that will give you csv time series subsets of MODIS data.  That may be another useful option.  I believe they've developed a REST web service interface to that MODIS toolset.  

===================================
Bruce E. Wilson (wilsonbe at ornl.gov)


On Dec 10, 2012, at 8:30 AM, "Wesley Roberts" <jwesroberts at gmail.com> wrote:

> Many thanks Matteo,
> 
> I downloaded the file and installed the zip to my local R directory. Am
> busy trying to figure out how the package works.
> 
> My workflow is very simple, I would like to download some MODIS Albedo and
> EVI data to conduct a Change Vector Analysis for our study area. I am able
> to undertake the exercise using standard gdal, grass, qgis tools however, I
> would like to try and accomplish the task using an R script only. As such I
> would like all of the processing to be done within the R script.
> 
> 
> Do you have any example scripts I could use to become more familiar with
> the tools? I have the manual and will use that for now.
> 
> Many thanks,
> Wesley
> 
> 
> On Mon, Dec 10, 2012 at 3:48 PM, Matteo Mattiuzzi <
> matteo.mattiuzzi at boku.ac.at> wrote:
> 
>> Dear Wesley,
>> 
>> 
>> You may give a try to the MODIS package. Currently it has build problems
>> in R-Forge but you can also install ZIP or TAR from here:
>> https://www.dropbox.com/sh/18t0rgcm6bga7xt/-4k_Xwojxr/MODIS
>> 
>> 
>> If you just want to download the data you are fine with that. If you want
>> to also process the data and you use Windows, you need a GDAL with HDF4
>> driver (FWTools or OSgeos4W).
>> http://trac.osgeo.org/osgeo4w/ (
>> http://download.osgeo.org/osgeo4w/osgeo4w-setup.exe)
>> or
>> http://fwtools.maptools.org/ (http://home.gdal.org/fwtools/FWTools247.exe)
>> 
>> 
>> If basic settings (like the location of the local HDF archieve) are fine
>> see ?MODISoptions, you can proceed directly to the processing see:
>> ?runGdal().
>> 
>> 
>> Matteo
>> 
>> 
>>>>> Wesley Roberts  12/10/12 2:30 PM >>>
>> Dear R-Sig-Geo,
>> 
>> 
>> I am currently using a script I downloaded from the
>> spatial-analyst.netwebsite to download and mosaic a couple of MODIS
>> Tiles for my study area (
>> 
>> http://spatial-analyst.net/wiki/index.php?title=Download_and_resampling_of_MODIS_images
>> )
>> 
>> I have managed to get as far as the first wget request and am receiving the
>> following error.
>> 
>>> download.file(paste(MOD13A3, dates$dirname[[i]], "/", BLOCK1,sep=""),
>> destfile=paste(getwd(), "/", BLOCK1, sep=""), mode='wb', method='wget',
>> quiet=T, cacheOK=FALSE)
>> cygwin warning:
>>  MS-DOS style path detected:
>> C:/Users/biocarbon/Documents/MOD13A3.A2001091.h20v09.005.2007112114336.hdf
>>  Preferred POSIX equivalent is:
>> 
>> /cygdrive/c/Users/biocarbon/Documents/MOD13A3.A2001091.h20v09.005.2007112114336.hdf
>>  CYGWIN environment variable option "nodosfilewarning" turns off this
>> warning.
>>  Consult the user's guide for more details about POSIX paths:
>>    http://cygwin.com/cygwin-ug-net/using.html#using-pathnames
>> Warning messages:
>> 1: running command 'wget --quiet --cache=off "
>> 
>> ftp://e4ftl01.cr.usgs.gov/MOLT/MOD13A3.005/2001.05.01/MOD13A3.A2001091.h20v09.005.2007112114336.hdf
>> "
>> -O
>> 
>> "C:/Users/biocarbon/Documents/MOD13A3.A2001091.h20v09.005.2007112114336.hdf"'
>> had status 8
>> 2: In download.file(paste(MOD13A3, dates$dirname[[i]], "/", BLOCK1,  :
>>  download had nonzero exit status
>> 
>> 
>> I presume wget is working correctly and that I have specified the correct
>> server credentials as per the original example code. I am currently
>> manually downloading data using FileZilla so I presume the server is
>> working. Is wget allowed to access data on this server? If not are there
>> other tools I can use to download the data?
>> 
>> Any help on the above mentioned error would be greatly appreciated.
>> 
>> Many thanks and kind regards,
>> Wesley
>> 
>> 
>> --
>> Dr Wesley Roberts
>> jwesroberts at gmail.com
>> Cell: +27(0)83 5355 646
>> skype: roberts-w
>> 
>>    [[alternative HTML version deleted]]
>> 
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 
> 
> -- 
> Dr Wesley Roberts
> jwesroberts at gmail.com
> Cell: +27(0)83 5355 646
> skype: roberts-w
> 
>    [[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 


From vesnikos at gmail.com  Mon Dec 10 17:25:10 2012
From: vesnikos at gmail.com (Nick Ves)
Date: Mon, 10 Dec 2012 18:25:10 +0200
Subject: [R-sig-Geo] wget error While downloading a MODIS Tile
In-Reply-To: <50C6117502000027000175D6@gwia2.boku.ac.at>
References: <50C6117502000027000175D6@gwia2.boku.ac.at>
Message-ID: <CADCcPvtfdwzBi1k3wcGKnir2Qrb11PYMTKSoRrxrsaka4Ch6hg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121210/653c830b/attachment.pl>

From kristin.graves at gmail.com  Mon Dec 10 21:04:53 2012
From: kristin.graves at gmail.com (Kristin Graves)
Date: Mon, 10 Dec 2012 15:04:53 -0500
Subject: [R-sig-Geo] spgwr and predictions for separate spdf dataset
In-Reply-To: <CABQqjOKV6Gjt0ehMzS=+Pp3nkw7Q7HjqtQPJHuCQVcPH3evB0w@mail.gmail.com>
References: <CABQqjOKcHZgmSCpJ4OC+2Mgenp7zTaT7NFnMoi5iOfne03LO6w@mail.gmail.com>
	<CABQqjOKV6Gjt0ehMzS=+Pp3nkw7Q7HjqtQPJHuCQVcPH3evB0w@mail.gmail.com>
Message-ID: <CABQqjOK-uVHt9JJJZt2RsuD6uD5vUKDRiYyhzwY_kQ_YQ0sJQQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121210/50363fd6/attachment.pl>

From jwesroberts at gmail.com  Tue Dec 11 07:35:33 2012
From: jwesroberts at gmail.com (Wesley Roberts)
Date: Tue, 11 Dec 2012 08:35:33 +0200
Subject: [R-sig-Geo] wget error While downloading a MODIS Tile
In-Reply-To: <5F1BF1E6-A7FD-440F-8EE5-DEBBAB67459F@utk.edu>
References: <50C5F64B02000027000175AA@gwia2.boku.ac.at>
	<CAFik=FfuU5GKRUbyweNkWuk5VP6bwQoaj0TKQE8BXAuHEDrciQ@mail.gmail.com>
	<5F1BF1E6-A7FD-440F-8EE5-DEBBAB67459F@utk.edu>
Message-ID: <CAFik=FfT8P10r-xbk+Asw92aEDAPTX-Z1QVOnd1F6Assv=2GAA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121211/fd98e855/attachment.pl>

From jeanyves.barnagaud at gmail.com  Tue Dec 11 15:10:02 2012
From: jeanyves.barnagaud at gmail.com (Jean-Yves Barnagaud)
Date: Tue, 11 Dec 2012 15:10:02 +0100
Subject: [R-sig-Geo] scaling response variable in a GWR
Message-ID: <50C73EBA.7070108@gmail.com>

Dear listers;

I'm wondering about how to scale variables to get meaningful results in 
a geographically weighted regression. Apologies if this topic has 
already been adressed on the list, I didn't find out.

My aim is to study spatial patterns in the temporal trend of a variable, 
say Y, through a GWR - in a nutschell as far as I understand the model 
is like:

Y[x,y,t] = alpha[x,y] + beta[x,y]*time[t]

where beta[x,y] and alpha[x,y] are computed as a bandwidth function of 
neighbouring points -> am I right in my summary here?

Y is a continuous normally distributed variable, and I'm interested in a 
way of scaling Y which would allow to compare alpha and beta across 
localities. As my reseearch question is related to whether and where Y 
increases more or less, I'm particularly interested in the magnitude of 
beta, not just its sign.

 > Do I need any kind of scaling ever? I mean, would I be able to 
compare beta[x,y] between sites in which the mean Y differs (and thus 
ground my gwr on raw Y values)? Or should I expect some kind of 
relationship between alpha and beta (something like localities with 
higher Y have higher betas)? I'm not too sure about whether what I know 
from standard linear regression holds for GWR.

 > If I do need a scaling what would be wise to do?

- scaling Y across sites, or within sites?
- scaling by standardizing ((Y-mean(Y)) / sd(Y)) or something else, like 
Y/max(Y) ? or something else?

Any justified advice appreciated :o)

Thanks a lot in advance;

Best

JY Barnagaud

-- 
Jean-Yves Barnagaud
postdoctoral researcher
macroecology - community ecology - ornithology
Institut for Bioscience - Ecoinformatics and Biodiversity
Ny Munkegade 116
building 1540, office 321
8000, Aarhus C - Danemark
phone (+0045) 87156126
http://sites/google/com/site/jybarnagaud


From paallen at attglobal.net  Wed Dec 12 00:35:13 2012
From: paallen at attglobal.net (paallen at attglobal.net)
Date: Tue, 11 Dec 2012 23:35:13 +0000
Subject: [R-sig-Geo] 3D (xyzm) SpatialLines in R
Message-ID: <1278579649-1355268926-cardhu_decombobulator_blackberry.rim.net-959271261-@b1.c3.bise6.blackberry>

Hi all,

I have 2 questions
1.  Can I create a 3D SpatialLine with distance (m)?  

2. Then can I  take another dataframe with from & to distances along that 3d SpatialLine feature & create a 3D polyline ( w/ m), similar to the ArcGIS "Make Route Event Layer"


I want to calculate 3D polylines using the minimum curvature algorithm to represent curved bore-holes (directional drilling) and down-hole samples/logging.  I have written this program in PostGIS but would now like to work it up in R.

Regard,
Phil
Sent via BlackBerry by AT&T


From pep.bioalerts at gmail.com  Wed Dec 12 11:12:13 2012
From: pep.bioalerts at gmail.com (Josep M Serra diaz)
Date: Wed, 12 Dec 2012 11:12:13 +0100
Subject: [R-sig-Geo] Some issues when ploting rasters...
Message-ID: <CAF8H1dfKvptyLYssx23Hm2CYkmex3oEMtxgpZEbJh0zETgfzLQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121212/839fd192/attachment.pl>

From leiwang.uconn at gmail.com  Wed Dec 12 15:58:06 2012
From: leiwang.uconn at gmail.com (Lei Wang)
Date: Wed, 12 Dec 2012 09:58:06 -0500
Subject: [R-sig-Geo] Modify lagsarlm function in spdep package
Message-ID: <CANTEn900y9qCGT-zQdL9DtxrkvFd6EvQn0PD_SGvPyxrJdUFTQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121212/18407edd/attachment.pl>

From marie.augermethe at gmail.com  Wed Dec 12 19:54:57 2012
From: marie.augermethe at gmail.com (Marie Auger-Methe)
Date: Wed, 12 Dec 2012 18:54:57 +0000
Subject: [R-sig-Geo] Raster memory problem
Message-ID: <50C8D301.7010808@gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121212/78773bdf/attachment.pl>

From Roger.Bivand at nhh.no  Wed Dec 12 20:11:00 2012
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 12 Dec 2012 20:11:00 +0100
Subject: [R-sig-Geo] Modify lagsarlm function in spdep package
In-Reply-To: <CANTEn900y9qCGT-zQdL9DtxrkvFd6EvQn0PD_SGvPyxrJdUFTQ@mail.gmail.com>
References: <CANTEn900y9qCGT-zQdL9DtxrkvFd6EvQn0PD_SGvPyxrJdUFTQ@mail.gmail.com>
Message-ID: <alpine.LRH.2.02.1212122005220.8438@reclus.nhh.no>

On Wed, 12 Dec 2012, Lei Wang wrote:

> Dear subscribers and Prof. Bivand,
>
> I am using lagsarlm function in spdep package to study my research problem.
> I am trying to use restaurants' price, rating, and some other variables to
> explain their customer visit. So customer visit is my dependent variable,
> and I have 6 independent variables. I want to use the spatial mixed model
> so that I can find out whether there are spatial correlated issue in my
> independent variables. I understand that for the spatial mixed model, the
> lagsarlm function calculates the spatial lag coefficients for all the 6
> independent variable, but what I really want is just for two of them.
>
> So I checked the course code for lagsarlm function to see where I should
> modify based on my need. I figured I should change the part that construct
> the WX matrix. My modification is as follows:

You do not want to do this in this way - simply create two new variables 
with lag.listw() and use them in a regular lag model. You will not be able 
to use impact measures in the usual way - if n is small enough to invert 
(I - \rho W), use dense matrix methods to generate the S(W)_r for the 
variable pair.

Roger

PS: the reasons functions and variables are not found in your case is that 
they are not exported in the NAMESPACE, so need to be prepended with 
spdep:::.

>
> if (m > 1) {
>      WX <- matrix(nrow = n, ncol = 2)
>        wx1 <- lag.listw(listw, x[, 7], zero.policy = zero.policy)
>        wx2 <- lag.listw(listw, x[, 8], zero.policy = zero.policy)
>        if (any(is.na(wx)))
>          stop("NAs in lagged independent variable")
>        WX <- cbind(wx1, wx2)
>    }
>
> and all the other parts remain same. However, when I run this self-defined
> function, R keeps giving me the following error message:
>
> Error in get("verbose", envir = .spdepOptions) :
>  object '.spdepOptions' not found
>
> I have made sure that I loaded the spdep package before I run this
> function.
>
> Could you please let me know why I get this error and how should I fix it?
>
> I really appreciate any help or suggestion you could give to me.
>
>
> Best,
>
> Michelle
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From raffaele.morelli at gmail.com  Wed Dec 12 21:20:17 2012
From: raffaele.morelli at gmail.com (Raffaele Morelli)
Date: Wed, 12 Dec 2012 21:20:17 +0100
Subject: [R-sig-Geo] Raster memory problem
In-Reply-To: <50C8D301.7010808@gmail.com>
References: <50C8D301.7010808@gmail.com>
Message-ID: <CAD4guxPvYztA4AcmvDu6yg6ypoU0qigJHovf9UhZ+DJJ-PKa-w@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121212/c9401b87/attachment.pl>

From jacobvanetten at yahoo.com  Wed Dec 12 21:24:02 2012
From: jacobvanetten at yahoo.com (Jacob van Etten)
Date: Wed, 12 Dec 2012 15:24:02 -0500
Subject: [R-sig-Geo] Raster memory problem
In-Reply-To: <CAD4guxPvYztA4AcmvDu6yg6ypoU0qigJHovf9UhZ+DJJ-PKa-w@mail.gmail.com>
References: <50C8D301.7010808@gmail.com>
	<CAD4guxPvYztA4AcmvDu6yg6ypoU0qigJHovf9UhZ+DJJ-PKa-w@mail.gmail.com>
Message-ID: <65A1D577-4226-4FDC-B1D0-FE5C08D8EFF6@yahoo.com>

Take a look at setOptions to force disk to disk.

raster will guess if it can do the operation in memory but occasionally underestimates the memory available or required.

Sent from my iPhone

On 12/12/2012, at 15:20, Raffaele Morelli <raffaele.morelli at gmail.com> wrote:

> 2012/12/12 Marie Auger-Methe <marie.augermethe at gmail.com>
> 
>> Dear list,
>> 
>> I am using large raster bricks for my analyses and I am running out of
>> memory. I get the following message:
>> 
>> Error: cannot allocate vector of size 231.0 Mb
>> 
>> and this whether I do all my brick manipulations by loading the brick in
>> R's memory or not (i.e., whether I use the option filename="name of my
>> file").
>> The strangest characteristic of the problem I have is that I get an
>> error message when I handle smaller brick and not when handle larger brick.
>> 
>> I have clean up my computer, defragmented it, increase my virtual
>> memory, etc, and I still get an error.
>> 
>> Any help will be greatly appreciated,
>> 
>> Marie
> 
> 
> Welcome to the band called "Three of us (can't handle such big rasters)"
> ;-)
> 
> -raffaele
> 
>   [[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From marie.augermethe at gmail.com  Wed Dec 12 22:14:33 2012
From: marie.augermethe at gmail.com (Marie Auger-Methe)
Date: Wed, 12 Dec 2012 21:14:33 +0000
Subject: [R-sig-Geo] Raster memory problem
In-Reply-To: <65A1D577-4226-4FDC-B1D0-FE5C08D8EFF6@yahoo.com>
References: <50C8D301.7010808@gmail.com>
	<CAD4guxPvYztA4AcmvDu6yg6ypoU0qigJHovf9UhZ+DJJ-PKa-w@mail.gmail.com>
	<65A1D577-4226-4FDC-B1D0-FE5C08D8EFF6@yahoo.com>
Message-ID: <50C8F3B9.1000704@gmail.com>

Thanks for the replies.

changing the raster options as suggested by Jacob fixed the problem. I 
lowered the maxmemory:
rasterOptions(maxmemory=90000000)
rather than changing the todisk option. It worked like a charm.

Thanks!

Marie



On 12/12/2012 8:24 PM, Jacob van Etten wrote:
> Take a look at setOptions to force disk to disk.
>
> raster will guess if it can do the operation in memory but occasionally underestimates the memory available or required.
>
> Sent from my iPhone
>
> On 12/12/2012, at 15:20, Raffaele Morelli <raffaele.morelli at gmail.com> wrote:
>
>> 2012/12/12 Marie Auger-Methe <marie.augermethe at gmail.com>
>>
>>> Dear list,
>>>
>>> I am using large raster bricks for my analyses and I am running out of
>>> memory. I get the following message:
>>>
>>> Error: cannot allocate vector of size 231.0 Mb
>>>
>>> and this whether I do all my brick manipulations by loading the brick in
>>> R's memory or not (i.e., whether I use the option filename="name of my
>>> file").
>>> The strangest characteristic of the problem I have is that I get an
>>> error message when I handle smaller brick and not when handle larger brick.
>>>
>>> I have clean up my computer, defragmented it, increase my virtual
>>> memory, etc, and I still get an error.
>>>
>>> Any help will be greatly appreciated,
>>>
>>> Marie
>>
>> Welcome to the band called "Three of us (can't handle such big rasters)"
>> ;-)
>>
>> -raffaele
>>
>>    [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From r.hijmans at gmail.com  Wed Dec 12 22:22:39 2012
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Wed, 12 Dec 2012 13:22:39 -0800
Subject: [R-sig-Geo] Raster memory problem
In-Reply-To: <50C8F3B9.1000704@gmail.com>
References: <50C8D301.7010808@gmail.com>
	<CAD4guxPvYztA4AcmvDu6yg6ypoU0qigJHovf9UhZ+DJJ-PKa-w@mail.gmail.com>
	<65A1D577-4226-4FDC-B1D0-FE5C08D8EFF6@yahoo.com>
	<50C8F3B9.1000704@gmail.com>
Message-ID: <CANtt_hxiF=34AcCW_Y+odOQLtb1RpAoGR2GEgwZJ3B9bc+1qnA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121212/c1995992/attachment.pl>

From Gustaf.Granath at ebc.uu.se  Thu Dec 13 08:55:49 2012
From: Gustaf.Granath at ebc.uu.se (Gustaf Granath)
Date: Thu, 13 Dec 2012 08:55:49 +0100
Subject: [R-sig-Geo] rasterize func: polygon values to raster cells - error
	msg
Message-ID: <50C98A05.6020603@ebc.uu.se>

Hi,
I have used the rasterize function to get values from a 
spatialPolyDataFrame variable (@data$variable) to raster:
rasterize(SPDFobj, rasterObj, field="variable")

For a specific case a get a, to me, strange error message .
"Error in writeValues(out, fun(n), tr$row[i]) :
   error in evaluating the argument 'v' in selecting a method for 
function 'writeValues': Error in fun(n) : unused argument(s) (n)"

It works with one SpatialPolyDataFrame that Im working with, but not 
with another one and I cannot figure out why. Any ideas of what is going on?

Unfortunately, I have not been able to reproduce the error with 
simulated data (and my data files are huge) but this is essentially what 
I have done (but the code below works - actually the raster layer in 
this code works with my SPDFobj):
p1 <- rbind(c(-180,-20), c(-140,55), c(10, 0), c(-140,-60), c(-180,-20))
p2 <- rbind(c(-10,0), c(140,60), c(160,0), c(140,-55), c(-10,0))
p3 <- rbind(c(-125,0), c(0,60), c(40,5), c(15,-45), c(-125,0))
pols <- SpatialPolygons( list(  Polygons(list(Polygon(p1), 
Polygon(hole)), 1),
                 Polygons(list(Polygon(p2)), 2), 
Polygons(list(Polygon(p3)), 3)))
pols <-SpatialPolygonsDataFrame(pols, data.frame("W"=1:3))
r <- raster(ncol=80, nrow=90)
test<-rasterize(pols, r, field="W")

Here is an overview of the objects I am using.

 > summary(SPDFobj)
Object of class SpatialPolygonsDataFrame
Coordinates:
         min      max
x -11.08333 31.91753
y  33.91667 71.91743
Is projected: FALSE
proj4string : [+proj=longlat +datum=WGS84]
Data attributes:
      variable
...
...

 > rasterObj_orig
class       : RasterLayer
dimensions  : 12768, 11050, 141086400  (nrow, ncol, ncell)
resolution  : 250, 250  (x, y)
extent      : 2782250, 5544750, 2220250, 5412250  (xmin, xmax, ymin, ymax)
coord. ref. : +proj=laea +lat_0=52 +lon_0=10 +x_0=4321000 +y_0=3210000 
+ellps=GRS80 +units=m +no_defs
data source : C:\Users\veGustaf\Desktop\phd\Where is Ndep neg\bogs.grd
names       : layer
values      : 36, 36  (min, max)

 > rasterObj #projection fixed etc through an extent object, raster --> 
extent --> raster
class       : RasterLayer
dimensions  : 12768, 11050, 141086400  (nrow, ncol, ncell)
resolution  : 250, 250  (x, y)
extent      : 2782250, 5544750, 2220250, 5412250  (xmin, xmax, ymin, ymax)
coord. ref. : +proj=longlat +datum=WGS84


Cheers,

Gustaf

-- 
Gustaf Granath (PhD)

Dept of Plant Ecology and Evolution
Uppsala University


From jaalonson at indra.es  Thu Dec 13 16:33:52 2012
From: jaalonson at indra.es (=?iso-8859-1?Q?Alonso_Nanclares=2C_Jes=FAs_Alberto?=)
Date: Thu, 13 Dec 2012 16:33:52 +0100
Subject: [R-sig-Geo] readOGR ceased working since updating to R 2.15.2
Message-ID: <3852B275C82A9444AB29EA92AA1B0C9201E8F1C0BB@MADARRMAILBOX07.indra.es>

Hello dear list,

I have a problem with the function readOGR since I installed the last version of R, 2.15.2 and, consequently, had to install rgdal package again. I am using a script I ran just a moment before the update, when it worked perfectly, in which my intention is to read a shapefile. The command looks like this:

secciones_espanya <- readOGR("INE_SPAIN.shp", "INE_SPAIN")

And when I execute it I am showed this error:

Error en file(paste(dsn, .Platform$file.sep, layer, ".dbf", sep = ""),  :
  no se puede abrir la conexi?n
Adem?s: Mensajes de aviso perdidos
In file(paste(dsn, .Platform$file.sep, layer, ".dbf", sep = ""),  :
  no fue posible abrir el archivo 'INE_SPAIN.shp/INE_SPAIN.dbf': No such file or directory

saying the connection could not be open.

I have tried with other .shp of my PC that could also be read without problems before the update with the same results.

Does anyone know why this is happening?

Thanks in advance and greetings,

Jes?s Alberto Alonso Nanclares
Consultor Junior
Centro de Competencia Business Analytics

Avda de Bruselas, 35
28108 Alcobendas (Madrid)
Espa?a

T +34 914 805 863
jaalonson at indra.es
www.indracompany.com<http://www.indracompany.com>

[cid:image001.jpg at 01CDD94F.5D93BF20]


________________________________
Este correo electr?nico y, en su caso, cualquier fichero anexo al mismo, contiene informaci?n de car?cter confidencial exclusivamente dirigida a su destinatario o destinatarios. Si no es vd. el destinatario indicado, queda notificado que la lectura, utilizaci?n, divulgaci?n y/o copia sin autorizaci?n est? prohibida en virtud de la legislaci?n vigente. En el caso de haber recibido este correo electr?nico por error, se ruega notificar inmediatamente esta circunstancia mediante reenv?o a la direcci?n electr?nica del remitente.
Evite imprimir este mensaje si no es estrictamente necesario.

This email and any file attached to it (when applicable) contain(s) confidential information that is exclusively addressed to its recipient(s). If you are not the indicated recipient, you are informed that reading, using, disseminating and/or copying it without authorisation is forbidden in accordance with the legislation in effect. If you have received this email by mistake, please immediately notify the sender of the situation by resending it to their email address.
Avoid printing this message if it is not absolutely necessary.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121213/53c37615/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.jpg
Type: image/jpeg
Size: 1907 bytes
Desc: image001.jpg
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121213/53c37615/attachment.jpg>

From carstennh at aol.com  Thu Dec 13 16:38:43 2012
From: carstennh at aol.com (Carsten Neumann)
Date: Thu, 13 Dec 2012 16:38:43 +0100
Subject: [R-sig-Geo] chull function behavior
Message-ID: <50C9F683.3060809@aol.com>

Dear List members,

sorry for the non specific geo question, but working with image spectra 
led me to the following problem calculating a convex upper hull curve 
using the function "chull {grDevices}".

Imaging there is a image spectra that you need to normalize using 
continuum removal (deviding spectra by upper hull), then you do not 
expect values greater than 1. Unfortunately the "chull()" functions did 
not identify all points of intersection on a hull curve. At the 
beginning there are also points beneath a hull, see example data (first 
3 points).

#############################################################################################################
wavelength<-seq(350,449,1)
dummy<-c(0.204054, 0.204828, 0.204161, 0.202444, 0.199883, 0.200960, 
0.203838, 0.205723,
  0.203404, 0.204835, 0.207257, 0.205682, 0.209670, 0.212622, 0.212032, 
0.211062,
  0.212727, 0.215129, 0.216259, 0.217435, 0.218270, 0.219039, 0.220333, 
0.222520,
  0.223502, 0.223225, 0.225050, 0.225485, 0.226832, 0.230962, 0.231891, 
0.231264,
  0.231170, 0.233540, 0.235799, 0.238165, 0.240494, 0.240793, 0.242218, 
0.244078,
  0.244795, 0.246343, 0.247142, 0.247406, 0.249348, 0.250772, 0.251937, 
0.253166,
  0.253301, 0.253941, 0.255231, 0.256503, 0.257881, 0.258632, 0.258916, 
0.260414,
  0.261584, 0.262598, 0.263891, 0.264702, 0.265681, 0.266892, 0.267861, 
0.268923,
  0.270050, 0.271112, 0.271767, 0.273130, 0.274604, 0.275065, 0.276157, 
0.277331,
  0.278321, 0.279585, 0.280577, 0.281469, 0.282497, 0.283157, 0.284381, 
0.285984,
  0.286866, 0.288173, 0.289387, 0.290084, 0.290770, 0.291659, 0.292730, 
0.293823,
  0.294841, 0.295763, 0.296607, 0.297420, 0.298529, 0.299691, 0.300580, 
0.301300,
  0.302290, 0.303378, 0.303885, 0.304686)

id<-sort(chull(wavelength, dummy))
plot(wavelength,dummy,type="l")
points(wavelength[id],dummy[id],type="p",col="red")
#############################################################################################################
Can anybody explain this behavior or give some advice on improving 
functionality?

Thanks in advance!

Best

Carsten


-- 

Carsten Neumann
Telegrafenberg, A 17 01.13
14473 Potsdam
-------------------------------------------------------
Helmholtz Centre Potsdam
GFZ German Research Centre for Geosciences
Department 1 - Section 1.4 - Remote Sensing
-------------------------------------------------------
Tel.: +49 (0) 331 288 1766
e-mail: carstenn at gfz-potsdam.de


From lukaslehnert at googlemail.com  Thu Dec 13 16:51:44 2012
From: lukaslehnert at googlemail.com (Lukas Lehnert)
Date: Thu, 13 Dec 2012 16:51:44 +0100
Subject: [R-sig-Geo] chull function behavior
In-Reply-To: <50C9F683.3060809@aol.com>
References: <50C9F683.3060809@aol.com>
Message-ID: <1543835.q8T5tTsb65@lujola>

Dear Carsten,

the function chull finds the hull of a curve, which consists of the upper and 
the lower part of the hull. In your case, you might be only interested in the 
upper part. You can extract this with the following commands:
    c.hull <- chull(y)
    c.hull <- c.hull[(which(c.hull == 1):length(c.hull))]
    c.hull <- sort(c.hull)

The calculation of the hull can be performed by:
    hull[i,] <- approx(x=x[c.hull],y=y[i,c.hull], xout = x,method = "linear", 
ties = "mean")$y

Best regards

Lukas Lehnert

Am Donnerstag, 13. Dezember 2012, 16:38:43 schrieb Carsten Neumann:
> Dear List members,
> 
> sorry for the non specific geo question, but working with image spectra
> led me to the following problem calculating a convex upper hull curve
> using the function "chull {grDevices}".
> 
> Imaging there is a image spectra that you need to normalize using
> continuum removal (deviding spectra by upper hull), then you do not
> expect values greater than 1. Unfortunately the "chull()" functions did
> not identify all points of intersection on a hull curve. At the
> beginning there are also points beneath a hull, see example data (first
> 3 points).
> 
> ############################################################################
> ################################# wavelength<-seq(350,449,1)
> dummy<-c(0.204054, 0.204828, 0.204161, 0.202444, 0.199883, 0.200960,
> 0.203838, 0.205723,
>   0.203404, 0.204835, 0.207257, 0.205682, 0.209670, 0.212622, 0.212032,
> 0.211062,
>   0.212727, 0.215129, 0.216259, 0.217435, 0.218270, 0.219039, 0.220333,
> 0.222520,
>   0.223502, 0.223225, 0.225050, 0.225485, 0.226832, 0.230962, 0.231891,
> 0.231264,
>   0.231170, 0.233540, 0.235799, 0.238165, 0.240494, 0.240793, 0.242218,
> 0.244078,
>   0.244795, 0.246343, 0.247142, 0.247406, 0.249348, 0.250772, 0.251937,
> 0.253166,
>   0.253301, 0.253941, 0.255231, 0.256503, 0.257881, 0.258632, 0.258916,
> 0.260414,
>   0.261584, 0.262598, 0.263891, 0.264702, 0.265681, 0.266892, 0.267861,
> 0.268923,
>   0.270050, 0.271112, 0.271767, 0.273130, 0.274604, 0.275065, 0.276157,
> 0.277331,
>   0.278321, 0.279585, 0.280577, 0.281469, 0.282497, 0.283157, 0.284381,
> 0.285984,
>   0.286866, 0.288173, 0.289387, 0.290084, 0.290770, 0.291659, 0.292730,
> 0.293823,
>   0.294841, 0.295763, 0.296607, 0.297420, 0.298529, 0.299691, 0.300580,
> 0.301300,
>   0.302290, 0.303378, 0.303885, 0.304686)
> 
> id<-sort(chull(wavelength, dummy))
> plot(wavelength,dummy,type="l")
> points(wavelength[id],dummy[id],type="p",col="red")
> ############################################################################
> ################################# Can anybody explain this behavior or give
> some advice on improving functionality?
> 
> Thanks in advance!
> 
> Best
> 
> Carsten


From jaalonson at indra.es  Thu Dec 13 17:20:06 2012
From: jaalonson at indra.es (=?iso-8859-1?Q?Alonso_Nanclares=2C_Jes=FAs_Alberto?=)
Date: Thu, 13 Dec 2012 17:20:06 +0100
Subject: [R-sig-Geo] readOGR ceased working since updating to R 2.15.2
Message-ID: <3852B275C82A9444AB29EA92AA1B0C9201E8F1C15E@MADARRMAILBOX07.indra.es>

Solved.

Thanks anyways.

Jes?s Alberto Alonso Nanclares
Consultor Junior
Centro de Competencia Business Analytics

Avda de Bruselas, 35
28108 Alcobendas (Madrid)
Espa?a

T +34 914 805 863
jaalonson at indra.es
www.indracompany.com<http://www.indracompany.com>

[cid:image001.jpg at 01CDD956.1899CD40]

De: Alonso Nanclares, Jes?s Alberto
Enviado el: jueves, 13 de diciembre de 2012 16:34
Para: 'r-sig-geo at r-project.org'
Asunto: readOGR ceased working since updating to R 2.15.2

Hello dear list,

I have a problem with the function readOGR since I installed the last version of R, 2.15.2 and, consequently, had to install rgdal package again. I am using a script I ran just a moment before the update, when it worked perfectly, in which my intention is to read a shapefile. The command looks like this:

secciones_espanya <- readOGR("INE_SPAIN.shp", "INE_SPAIN")

And when I execute it I am showed this error:

Error en file(paste(dsn, .Platform$file.sep, layer, ".dbf", sep = ""),  :
  no se puede abrir la conexi?n
Adem?s: Mensajes de aviso perdidos
In file(paste(dsn, .Platform$file.sep, layer, ".dbf", sep = ""),  :
  no fue posible abrir el archivo 'INE_SPAIN.shp/INE_SPAIN.dbf': No such file or directory

saying the connection could not be open.

I have tried with other .shp of my PC that could also be read without problems before the update with the same results.

Does anyone know why this is happening?

Thanks in advance and greetings,

Jes?s Alberto Alonso Nanclares
Consultor Junior
Centro de Competencia Business Analytics

Avda de Bruselas, 35
28108 Alcobendas (Madrid)
Espa?a

T +34 914 805 863
jaalonson at indra.es<mailto:jaalonson at indra.es>
www.indracompany.com<http://www.indracompany.com>

[cid:image001.jpg at 01CDD956.1899CD40]


________________________________
Este correo electr?nico y, en su caso, cualquier fichero anexo al mismo, contiene informaci?n de car?cter confidencial exclusivamente dirigida a su destinatario o destinatarios. Si no es vd. el destinatario indicado, queda notificado que la lectura, utilizaci?n, divulgaci?n y/o copia sin autorizaci?n est? prohibida en virtud de la legislaci?n vigente. En el caso de haber recibido este correo electr?nico por error, se ruega notificar inmediatamente esta circunstancia mediante reenv?o a la direcci?n electr?nica del remitente.
Evite imprimir este mensaje si no es estrictamente necesario.

This email and any file attached to it (when applicable) contain(s) confidential information that is exclusively addressed to its recipient(s). If you are not the indicated recipient, you are informed that reading, using, disseminating and/or copying it without authorisation is forbidden in accordance with the legislation in effect. If you have received this email by mistake, please immediately notify the sender of the situation by resending it to their email address.
Avoid printing this message if it is not absolutely necessary.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121213/21cdb275/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.jpg
Type: image/jpeg
Size: 1907 bytes
Desc: image001.jpg
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121213/21cdb275/attachment.jpg>

From Roger.Bivand at nhh.no  Thu Dec 13 21:15:37 2012
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 13 Dec 2012 21:15:37 +0100
Subject: [R-sig-Geo] readOGR ceased working since updating to R 2.15.2
In-Reply-To: <3852B275C82A9444AB29EA92AA1B0C9201E8F1C15E@MADARRMAILBOX07.indra.es>
References: <3852B275C82A9444AB29EA92AA1B0C9201E8F1C15E@MADARRMAILBOX07.indra.es>
Message-ID: <alpine.LRH.2.02.1212132104520.12078@reclus.nhh.no>

On Thu, 13 Dec 2012, Alonso Nanclares, Jes?s Alberto wrote:

> Solved.

You might care to report what the problem was? My guess is that you 
installed rgdal from the current R-forge development version, because the 
specific line you quote was present between revisions 404 (Tue Dec 11 
20:36:52) and 408 (Thu Dec 13 11:50:55). When reporting problems, always 
provide the output of sessionInfo(), and for rgdal, also the complete 
package startup message (which now includes the SVN revision). When 
installing development versions, do wait substantial time to see whether 
later commits do not remove the problem.

Roger

>
> Thanks anyways.
>
> Jes?s Alberto Alonso Nanclares
> Consultor Junior
> Centro de Competencia Business Analytics
>
> Avda de Bruselas, 35
> 28108 Alcobendas (Madrid)
> Espa?a
>
> T +34 914 805 863
> jaalonson at indra.es
> www.indracompany.com<http://www.indracompany.com>
>
> [cid:image001.jpg at 01CDD956.1899CD40]
>
> De: Alonso Nanclares, Jes?s Alberto
> Enviado el: jueves, 13 de diciembre de 2012 16:34
> Para: 'r-sig-geo at r-project.org'
> Asunto: readOGR ceased working since updating to R 2.15.2
>
> Hello dear list,
>
> I have a problem with the function readOGR since I installed the last version of R, 2.15.2 and, consequently, had to install rgdal package again. I am using a script I ran just a moment before the update, when it worked perfectly, in which my intention is to read a shapefile. The command looks like this:
>
> secciones_espanya <- readOGR("INE_SPAIN.shp", "INE_SPAIN")
>
> And when I execute it I am showed this error:
>
> Error en file(paste(dsn, .Platform$file.sep, layer, ".dbf", sep = ""),  :
>  no se puede abrir la conexi?n
> Adem?s: Mensajes de aviso perdidos
> In file(paste(dsn, .Platform$file.sep, layer, ".dbf", sep = ""),  :
>  no fue posible abrir el archivo 'INE_SPAIN.shp/INE_SPAIN.dbf': No such file or directory
>
> saying the connection could not be open.
>
> I have tried with other .shp of my PC that could also be read without problems before the update with the same results.
>
> Does anyone know why this is happening?
>
> Thanks in advance and greetings,
>
> Jes?s Alberto Alonso Nanclares
> Consultor Junior
> Centro de Competencia Business Analytics
>
> Avda de Bruselas, 35
> 28108 Alcobendas (Madrid)
> Espa?a
>
> T +34 914 805 863
> jaalonson at indra.es<mailto:jaalonson at indra.es>
> www.indracompany.com<http://www.indracompany.com>
>
> [cid:image001.jpg at 01CDD956.1899CD40]
>
>
> ________________________________
> Este correo electr?nico y, en su caso, cualquier fichero anexo al mismo, contiene informaci?n de car?cter confidencial exclusivamente dirigida a su destinatario o destinatarios. Si no es vd. el destinatario indicado, queda notificado que la lectura, utilizaci?n, divulgaci?n y/o copia sin autorizaci?n est? prohibida en virtud de la legislaci?n vigente. En el caso de haber recibido este correo electr?nico por error, se ruega notificar inmediatamente esta circunstancia mediante reenv?o a la direcci?n electr?nica del remitente.
> Evite imprimir este mensaje si no es estrictamente necesario.
>
> This email and any file attached to it (when applicable) contain(s) confidential information that is exclusively addressed to its recipient(s). If you are not the indicated recipient, you are informed that reading, using, disseminating and/or copying it without authorisation is forbidden in accordance with the legislation in effect. If you have received this email by mistake, please immediately notify the sender of the situation by resending it to their email address.
> Avoid printing this message if it is not absolutely necessary.
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From gregmacfarlane at gatech.edu  Thu Dec 13 22:10:33 2012
From: gregmacfarlane at gatech.edu (Gregory Macfarlane)
Date: Thu, 13 Dec 2012 16:10:33 -0500
Subject: [R-sig-Geo] ML estimate of neighbors radius
Message-ID: <D2FBFF44-11B3-4C62-B091-E467F495EC4A@gatech.edu>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121213/0af73e6e/attachment.pl>

From Roger.Bivand at nhh.no  Thu Dec 13 22:57:33 2012
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 13 Dec 2012 22:57:33 +0100
Subject: [R-sig-Geo] ML estimate of neighbors radius
In-Reply-To: <D2FBFF44-11B3-4C62-B091-E467F495EC4A@gatech.edu>
References: <D2FBFF44-11B3-4C62-B091-E467F495EC4A@gatech.edu>
Message-ID: <alpine.LRH.2.02.1212132240360.12421@reclus.nhh.no>

On Thu, 13 Dec 2012, Gregory Macfarlane wrote:

> I am trying to identify the maximum likelihood estimates in an SDM model 
> (a hedonic home price model, with observations being 5,000 individual 
> homes), $$y=\rho W y + X\beta + WX\lambda + \epsilon$$
>
> I have been able to successfully estimate parameters $\rho, \beta,\lambda$ using the `lagsarlm` function in the `spdep` package. In my case, $W$ is an inverse distance matrix limited to a radius $r$, or
> $$W_{ij} = \begin{cases}
>  1/d_{ij} & \text{for $d_{ij} \leq r$ miles}\\
>  0  & \text{for $d_{ij} > r$ miles}
>  \end{cases}$$
> I would like to identify $r$ simultaneously with $\rho, \beta,\lambda$. 
> I have even written a likelihood function to do this in R (making use of 
> the neighbors and lag functions in `spdep`)
>
> sdm.lik <- function(params, y, X, GeoPoints){
>  n <- length(y)
>  rho <- params[1]
>  radius <- params[2]
>  sigma2 <- params[3]
>  delta <- params[-c(1,2,3)]
>  # make W subject to radius
>  points.dnn <- dnearneigh(GeoPoints, 0, radius*5280)
>  dists   	 <- nbdists(points.dnn, GeoPoints)
>  dists.inv  <- lapply(dists, function(x) 1/x)
>  Wlist <- nb2listw(points.dnn, glist=dists.inv, style="W", zero.policy=TRUE)
>  W <- listw2mat(Wlist)
>  # Lag X variables
>  Z <- cbind(X[,1], lag.listw(Wlist, X[,1], zero.policy=TRUE))
>  for(i in 2:ncol(X)){
>    Z <- cbind(Z, X[,i], lag.listw(Wlist, X[,1], zero.policy=TRUE))
>  }
>  # Calculate log likelihood
>  e <- y - ((rho * W) %*% y) - (Z %*% delta)
>  lagmatrix <- diag(1,nrow=length(y), ncol=length(y)) - rho*W
>  logL <- ( -0.5*n*log(pi * sigma2) + log( det(lagmatrix) )
>                                           -(t(e) %*% e) / (2*sigma2) )
>  return(-logL)
> }
>
> Optimizing this function is far too slow to be practical, however. 
> Unsurprisingly, the highest cost operation is the log-determinant.

Yes, all of the components are present. See ?do_ldet in spdep. Also note 
that log(det()) will underflow as det() approaches zero. Do also note that 
W should be sparse - see the same help page and the code of the setup 
functions for insight. You certainly do not want to be handling dense 
matrices. Note that by endogenising W jointly, you make life very hard for 
yourself - you could take a coarse grid of radius values instead and 
optimize rho and beta for fixed radius, which would run very much faster. 
If you change W at each pass, none of the available methods for speeding 
up the logdet will benifit from running the setup function only once - you 
need now to set up the framework, such as solving the eigenproblem, each 
time. Probably "Matrix_J" will work best in your current setting.

Hope this helps,

Roger

>   1. Do you have tips for computing this determinant more quickly?
>   2. Does `lagsarlm` already have functionality to do this?
>   2.a). Can I hack it to make it do this?
>
> Greg Macfarlane
> Georgia Tech | Civil Engineering
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From ross.dwyer at uq.edu.au  Fri Dec 14 01:03:40 2012
From: ross.dwyer at uq.edu.au (Ross Dwyer)
Date: Fri, 14 Dec 2012 00:03:40 +0000
Subject: [R-sig-Geo] polygons intersecting the international date line
Message-ID: <84B4751733167E41A8156E63A69C1C3A0D44E2@uqexmdb3.soe.uq.edu.au>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121214/15ab27fc/attachment.pl>

From vladimir.gut at gmail.com  Fri Dec 14 18:32:16 2012
From: vladimir.gut at gmail.com (Vladimir Gutierrez Corea)
Date: Fri, 14 Dec 2012 18:32:16 +0100
Subject: [R-sig-Geo] How to access a local sp-variable inside a function
	using the layer method
Message-ID: <CALiSPOqo37vJgbjwZwAGknNmwgRW+eFYBxgX86g866Pur0_LBQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121214/66ee5f1f/attachment.pl>

From oscar.perpinan at gmail.com  Fri Dec 14 18:47:59 2012
From: oscar.perpinan at gmail.com (=?ISO-8859-1?Q?Oscar_Perpi=F1an?=)
Date: Fri, 14 Dec 2012 18:47:59 +0100
Subject: [R-sig-Geo] How to access a local sp-variable inside a function
 using the layer method
In-Reply-To: <CALiSPOqo37vJgbjwZwAGknNmwgRW+eFYBxgX86g866Pur0_LBQ@mail.gmail.com>
References: <CALiSPOqo37vJgbjwZwAGknNmwgRW+eFYBxgX86g866Pur0_LBQ@mail.gmail.com>
Message-ID: <CAMLL7bn5AKUxGM0Bnq1nH3zm6s2VNEb_BJxUsWv9SP6we5n9uA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121214/e7c84fc2/attachment.pl>

From lestes at princeton.edu  Fri Dec 14 21:16:18 2012
From: lestes at princeton.edu (Lyndon Estes)
Date: Fri, 14 Dec 2012 15:16:18 -0500
Subject: [R-sig-Geo] Cleaning up self-intersections
Message-ID: <CALuVVaaKGsQmAhTkfUuSzdqycYVmX25BO_7MsZ72OBff=f4hjA@mail.gmail.com>

Dear List,

I am working on a project to have users maps agricultural fields
(mappingafrica.princeton.edu, if anyone is interested or has comments
on what we are trying to do (will be highly appreciated)), and it
makes uses of rgeos functions quite heavily to perform some quality
control checks on user maps versus our definition of "truth".

Given the type of work we are asking of people, we are getting many
"unclean" polygons (self-intersects, overlaps, non-noding
intersections, etc).  I have been writing in various patches to deal
with these as I have been going, but I turn now for some advice on
cleaning up operations. An example taken from the workflow illustrates
a typical problem I encounter that I am looking for an efficient way
to handle. This example is followed by my two questions.

#########################################################
# Begin example

library(rgdal)
library(rgeos)
library(raster)

# Load polygons.  q is the polygon representing "truth",
# u represents the user's efforts
load(url("http://dl.dropbox.com/u/31890709/test_polys.Rdata"))

# My workflow has several attempts to clean up the code after
# retrieving  some important information on the number of crop
# fields perceived by the user
user.nfields <- nrow(u)  # 13 polygons
qa.nfields <- nrow(q)  # 9 fields

# Once that is dispensed with, I am then interested in the areas of
# overlaps between the SpatialPolygons* u and q, so no longer care
# how many individual fields there are in the dataset. Before I can do
# that, I first have to do some cleaning of messy polygons.
# By messy, I mean they have many overlaps
qo <- gOverlaps(q, byid = T)
uo <- gOverlaps(u, byid = T)
qo[which(qo)] <- 1
uo[which(uo)] <- 1
rowSums(qo)
# 0 1 2 3 4 5 6 7 8
# 1 0 0 0 2 2 3 1 1
rowSums(uo)
# 0  1  2  3  4  5  6  7  8  9 10 11 12
# 3  1  1  1  3  1  1  4  2  1  1  2  1

# Overlaps between many, which is expected with manual digitization.
# To prevent failures running gIntersect
# and gDifference at later steps in the workflow, I did this

qu <- gUnaryUnion(q)  # Works Fine
uu <- gUnaryUnion(u)  # Fails!
# In fact, if you use Rstudio (as I do on my Mac), you will
# have the entire program crash

# R from terminal gives this:
# Error: TopologyException: found non-noded intersection between
# LINESTRING
# (643687 -3.20465e+06, 643686 -3.20465e+06) and LINESTRING
# (643687 -3.20465e+06, 643660 -3.20465e+06) at
# 643686.30952548271 -3204653.8822991014
# (I haven't figured out why this causes an Rstudio crash, but that is not
# the concern here)
# Looking more closely at which polygons are offending

gIsValid(u, byid = T)

# 0     1     2     3     4     5     6     7     8     9    10    11    12
# TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE FALSE  TRUE
# TRUE  TRUE  TRUE FALSE
# Warning messages:
# 1: In RGEOSUnaryPredFunc(spgeom, byid, "rgeos_isvalid") :
# Self-intersection at or near point 643686.30952548271
# -3204653.8822991014
#2: In RGEOSUnaryPredFunc(spgeom, byid, "rgeos_isvalid") :
# Self-intersection at or near point 642553.28272326116
# -3203984.9120338778

# Looking a plot, the self intersections are not visible,
# but can be fixed with two possible approaches
plot(u[8, ])
u8 <- gSimplify(u[8, ], tol = 0.0001)  # Approach 1
gIsValid(u8)  # TRUE
plot(u8)  # Look identical to original
u8 <- gBuffer(u[8, ], width = 0)  # Approach 2
gIsValid(u8)  # TRUE
plot(u8)  # Looks identical

# Either of those approaches works nicely. However, the second
# offender, which I made to represent an extreme
# case of self-intersection, loses a lot of its area when cleaned with
# these methods:
u13 <- gSimplify(u[13, ], tol = 0.0001)
u13a <- gBuffer(u[13, ], width = 0)
plot(u[13, ])
plot(u13, add = T, col = rgb(1, 0, 0, alpha = 0.7))  # Not identical
plot(u13a, add = T, col = rgb(0, 0, 1, alpha = 0.7))  # Not identical
# You can see from the plots that a large part of the polygon area is lost.
# Ideally I would like to retain the full area, but I have not worked out
# how to do this efficiently
# One solution, involving the raster package
polr <- raster(extent(u[13, ]))
res(polr) <- 10  # Coarser resolution than I would like, for speed
u13r <- rasterize(u[13, ], polr)  # Rasterize
u13f <- rasterToPolygons(u13r, n = 4, dissolve = T)  # Polygonize
gIsValid(u13f)  # TRUE
plot(u13f) # Approximates original polygon

# End example
#####################################

So, here''s my first question.  Is there some other of cleaning
self-intersections up that preserves the area better than the examples
using gBuffer and gSimplify, and which might be more efficient and
provide a results that more closely approximates the original map than
rasterizing and polygonizing? e.g. Is it possible to explode polygons
at the point(s) of self-intersection, in order to create multiple
valid polygons?

My second question: am I barking up the wrong tree here?  Should I
preferentially use something like GRASS's v.clean before I even read
into R?  I haven't until now because 1) I don't know GRASS very well,
2) I want to minimize the number of different routines/software in the
workflow (which currently involves python, postgis/postgres, R,
openlayers).

Will very much appreciate any pointers/comments on this.

Thanks, Lyndon  (sessionInfo() for this example follows)

>From testing on Mac:

R version 2.15.1 (2012-06-22)
Platform: x86_64-apple-darwin9.8.0/x86_64 (64-bit)

locale:
[1] C/en_US.UTF-8/C/C/C/C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] raster_2.0-31 rgeos_0.2-9   rgdal_0.7-22  sp_1.0-2

loaded via a namespace (and not attached):
[1] grid_2.15.1    lattice_0.20-6 tools_2.15.1

For linux server, where the work actually gets done:

R version 2.15.1 (2012-06-22)
Platform: x86_64-redhat-linux-gnu (64-bit)

locale:
 [1] LC_CTYPE=C                 LC_NUMERIC=C
 [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
 [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
 [7] LC_PAPER=C                 LC_NAME=C
 [9] LC_ADDRESS=C               LC_TELEPHONE=C
[11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] rgdal_0.7-18  raster_2.0-12 rgeos_0.2-7   plyr_1.7.1    stringr_0.6.1
[6] sp_0.9-99

loaded via a namespace (and not attached):
[1] grid_2.15.1    lattice_0.20-6



lestes at princeton.edu
www.princeton.edu/~lestes


From macqueen1 at llnl.gov  Fri Dec 14 21:18:05 2012
From: macqueen1 at llnl.gov (MacQueen, Don)
Date: Fri, 14 Dec 2012 20:18:05 +0000
Subject: [R-sig-Geo] readOGR or writeOGR not closing connections?
In-Reply-To: <alpine.LRH.2.02.1212141058110.14610@reclus.nhh.no>
Message-ID: <5E1B812FAC2C4A49B3D99593B5A5219119309C@PRDEXMBX-08.the-lab.llnl.gov>

Roger,

My earlier reply to your request to test a newer version of rgdal seems to
have not been sent.

I can't receive attachments that are zip files. Could you change the
suffix to, say ".doc" and resend?

For everyone else on r-sig-geo, I apologize for the email noise; this is
an attempt to work around another email problem.

Thanks
-Don

-- 
Don MacQueen

Lawrence Livermore National Laboratory
7000 East Ave., L-627
Livermore, CA 94550
925-423-1062


From spluque at gmail.com  Fri Dec 14 22:11:08 2012
From: spluque at gmail.com (Sebastian P. Luque)
Date: Fri, 14 Dec 2012 15:11:08 -0600
Subject: [R-sig-Geo] small improvement for saveDataset() in rgdal
Message-ID: <87pq2cmj9v.fsf@kolob.subpolar.dyndns.org>

Hi,

Some time ago I spent several hours trying to figure out why the
following was failing?:

library(rgdal); library(adehabitatHR)
data(puechabonsp)
locs <- puechabonsp$relocs
## Estimation of UD for four animals
(ud <- kernelUD(locs[, 1]))
locs.gtiff <- create2GDAL(ud[[1]],
                          drivername="GTiff")
locs.aaigrid <- copyDataset(locs.gtiff,
                            driver="AAIGrid")
saveDataset(locs.aaigrid, "~/tmp/test.asc")

which prints this:

Error in .local(.Object, ...) : Dataset copy failed

finding that this resulted from failure to expand the 'filename'
argument in saveDataset().  Would it make sense to patch this function
with:

---<--------------------cut here---------------start------------------->---
*** /home/sluque/Scripts/R/src/rgdal/R/gdal.R	2012-12-14 15:05:25.000000000 -0600
--- /home/sluque/Scripts/R/src/gdal.R	2012-12-14 15:05:11.000000000 -0600
***************
*** 217,223 ****
    new.obj <- new(new.class,
                   handle = .Call('RGDAL_CopyDataset',
                     dataset, getDriver(dataset),
!                    FALSE, options, filename, PACKAGE="rgdal"))
  
    if (returnNewObj) return(new.obj)
    invisible(GDAL.close(new.obj))
--- 217,223 ----
    new.obj <- new(new.class,
                   handle = .Call('RGDAL_CopyDataset',
                     dataset, getDriver(dataset),
!                    FALSE, options, normalizePath(filename), PACKAGE="rgdal"))
  
    if (returnNewObj) return(new.obj)
    invisible(GDAL.close(new.obj))
---<--------------------cut here---------------end--------------------->---

?  It tests fine on my system:

R> sessionInfo()
R version 2.15.2 (2012-10-26)
Platform: x86_64-pc-linux-gnu (64-bit)

locale:
 [1] LC_CTYPE=en_CA.UTF-8       LC_NUMERIC=C               LC_TIME=en_CA.UTF-8        LC_COLLATE=en_CA.UTF-8     LC_MONETARY=en_CA.UTF-8    LC_MESSAGES=en_CA.UTF-8   
 [7] LC_PAPER=C                 LC_NAME=C                  LC_ADDRESS=C               LC_TELEPHONE=C             LC_MEASUREMENT=en_CA.UTF-8 LC_IDENTIFICATION=C       

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
 [1] adehabitatHR_0.4.4  adehabitatLT_0.3.7  CircStats_0.2-4     boot_1.3-7          MASS_7.3-22         adehabitatMA_0.3.4  ade4_1.5-1          deldir_0.0-21       rgdal_0.7-25       
[10] sp_1.0-2            slmisc_0.9.3        latticeExtra_0.6-24 RColorBrewer_1.0-5  lattice_0.20-10    

loaded via a namespace (and not attached):
[1] compiler_2.15.2 grid_2.15.2     tools_2.15.2   


Cheers,

--
Seb

? https://stat.ethz.ch/pipermail/r-sig-ecology/2012-March/002895.html


From vladimir.gut at gmail.com  Sat Dec 15 01:01:55 2012
From: vladimir.gut at gmail.com (Vladimir Gutierrez Corea)
Date: Sat, 15 Dec 2012 01:01:55 +0100
Subject: [R-sig-Geo] How to access a local sp-variable inside a function
	using the layer method
In-Reply-To: <CAMLL7bn5AKUxGM0Bnq1nH3zm6s2VNEb_BJxUsWv9SP6we5n9uA@mail.gmail.com>
References: <CALiSPOqo37vJgbjwZwAGknNmwgRW+eFYBxgX86g866Pur0_LBQ@mail.gmail.com>
	<CAMLL7bn5AKUxGM0Bnq1nH3zm6s2VNEb_BJxUsWv9SP6we5n9uA@mail.gmail.com>
Message-ID: <CALiSPOq5Unq3sVSh1utAgpY_E=Q6VeGJdgRBGSyzzUS54qMn9Q@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121215/374a5216/attachment.pl>

From b.rowlingson at lancaster.ac.uk  Sat Dec 15 01:04:43 2012
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Sat, 15 Dec 2012 00:04:43 +0000
Subject: [R-sig-Geo] Cleaning up self-intersections
In-Reply-To: <79c927d12d74474ab8de3233faf9b9fc@EX-1-HT0.lancs.local>
References: <79c927d12d74474ab8de3233faf9b9fc@EX-1-HT0.lancs.local>
Message-ID: <CANVKczOWndegVgW6hx3duhdjJf02Nq+Q6Xst1Q=VLfsDR-8Psw@mail.gmail.com>

On Fri, Dec 14, 2012 at 8:16 PM, Lyndon Estes <lestes at princeton.edu> wrote:

> Given the type of work we are asking of people, we are getting many
> "unclean" polygons (self-intersects, overlaps, non-noding
> intersections, etc).  I have been writing in various patches to deal
> with these as I have been going, but I turn now for some advice on
> cleaning up operations. An example taken from the workflow illustrates
> a typical problem I encounter that I am looking for an efficient way
> to handle. This example is followed by my two questions.

> So, here''s my first question.  Is there some other of cleaning
> self-intersections up that preserves the area better than the examples
> using gBuffer and gSimplify, and which might be more efficient and
> provide a results that more closely approximates the original map than
> rasterizing and polygonizing? e.g. Is it possible to explode polygons
> at the point(s) of self-intersection, in order to create multiple
> valid polygons?
>
> My second question: am I barking up the wrong tree here?  Should I
> preferentially use something like GRASS's v.clean before I even read
> into R?  I haven't until now because 1) I don't know GRASS very well,
> 2) I want to minimize the number of different routines/software in the
> workflow (which currently involves python, postgis/postgres, R,
> openlayers).

 The most promising thing I've seen for cleaning up polygon topology
is pprepair:

https://github.com/tudelft-gist/pprepair


which won a best paper prize at OSGIS-UK this year. Its not simple to
run properly, which is why I say most promising, and not best.

If run on your extreme self-intersection 'bow tie' polygon, it
produces a shapefile with a feature for each part of the bow tie. I
can't currently find a way of tieing those two features back to the
source bow-tie feature since the attributes aren't propogating
properly. Also, it seems to merge two of the large features in your
examples. Its a standalone C++ program that needs the CGAL library to
work, and there's no R interface. It operates on Shapefiles (or
possibly any OGR source?).

Overall, cleaning up messy digitizing is a hard problem. Obviously
overlaps between polygons are wrong, and pprepair does a great job of
assigning them to one or other of the polygons, but gaps are trickier
to assign - they might be real gaps (like a river between regions) or
they could be digiitzing errors. Its possible that some buffering
could help here, before doing pprepair.

Barry


From facampos at ucalgary.ca  Sat Dec 15 08:24:17 2012
From: facampos at ucalgary.ca (camposfa)
Date: Fri, 14 Dec 2012 23:24:17 -0800 (PST)
Subject: [R-sig-Geo] small bug in adehabitatHR function BRB
Message-ID: <1355556257209-7581950.post@n2.nabble.com>

The function BRB of the package adehabitatHR implements the biased random
bridge method of home range estimation. It takes the following argument by
default:

type=c("UD","ID", "RD")

This suggests that the function will return three types of distributions
(utilization distribution, intensity distribution, and recursion
distribution). However, only the utilization distribution is returned by
default. From browsing the code, the function does not appear to be designed
to return more than one type of distribution (although this would be very
useful). Thus, the default value of the argument should probably be:

type="UD"

It is not clear to me why this small bug does not produce an error. For
example, an error is produced if you attempt to call the function with
type=c("UD","ID")

#####
# Using the example data set from the package documentation
data(buffalo)
vv <- BRB.D(buffalo$traj, Tmax = 180*60, Lmin = 50,habitat =
buffalo$habitat, activ = "act")
ud <- BRB(buffalo$traj, D = vv, Tmax = 180*60, tau = 300, Lmin = 50,
hmin=100, habitat = buffalo$habitat, activity = "act", grid = 50, b=0,
type=c("UD","ID"), same4all=FALSE, extent=0.5)
#####

Generates the following error:
Error in match.arg(type) : 'arg' must be of length 1



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/small-bug-in-adehabitatHR-function-BRB-tp7581950.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From clement.calenge at oncfs.gouv.fr  Sat Dec 15 12:36:32 2012
From: clement.calenge at oncfs.gouv.fr (Clement Calenge)
Date: Sat, 15 Dec 2012 12:36:32 +0100
Subject: [R-sig-Geo] small bug in adehabitatHR function BRB
In-Reply-To: <1355556257209-7581950.post@n2.nabble.com>
References: <1355556257209-7581950.post@n2.nabble.com>
Message-ID: <50CC60C0.1020601@oncfs.gouv.fr>

It's not a bug, it's a feature! The function BRB uses internally the 
function match.arg, that checks that the argument type passed by the 
user is one of the the three possible values (Also, partial matching is 
allowed, so that type="U" is considered identical to type = "UD"). If a 
vector is passed, then the first element is considered to be the value 
of the argument. Therefore, by default, BRB calculates the "UD".
Argument matching is described in the R language definition:
http://cran.r-project.org/doc/manuals/R-lang.html#Argument-matching
and for the function match.arg, see the help page of this function:

?match.arg

Best Regards,

Cl?ment Calenge


On 12/15/2012 08:24 AM, camposfa wrote:
> The function BRB of the package adehabitatHR implements the biased random
> bridge method of home range estimation. It takes the following argument by
> default:
>
> type=c("UD","ID", "RD")
>
> This suggests that the function will return three types of distributions
> (utilization distribution, intensity distribution, and recursion
> distribution). However, only the utilization distribution is returned by
> default. From browsing the code, the function does not appear to be designed
> to return more than one type of distribution (although this would be very
> useful). Thus, the default value of the argument should probably be:
>
> type="UD"
>
> It is not clear to me why this small bug does not produce an error. For
> example, an error is produced if you attempt to call the function with
> type=c("UD","ID")
>
> #####
> # Using the example data set from the package documentation
> data(buffalo)
> vv <- BRB.D(buffalo$traj, Tmax = 180*60, Lmin = 50,habitat =
> buffalo$habitat, activ = "act")
> ud <- BRB(buffalo$traj, D = vv, Tmax = 180*60, tau = 300, Lmin = 50,
> hmin=100, habitat = buffalo$habitat, activity = "act", grid = 50, b=0,
> type=c("UD","ID"), same4all=FALSE, extent=0.5)
> #####
>
> Generates the following error:
> Error in match.arg(type) : 'arg' must be of length 1
>
>
>
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/small-bug-in-adehabitatHR-function-BRB-tp7581950.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


-- 
Cl?ment CALENGE
Cellule d'appui ? l'analyse de donn?es
Direction des Etudes et de la Recherche
Office national de la chasse et de la faune sauvage
Saint Benoist - 78610 Auffargis
tel. (33) 01.30.46.54.14


From edzer.pebesma at uni-muenster.de  Sat Dec 15 16:38:01 2012
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Sat, 15 Dec 2012 16:38:01 +0100
Subject: [R-sig-Geo] How to access a local sp-variable inside a function
 using the layer method
In-Reply-To: <CALiSPOq5Unq3sVSh1utAgpY_E=Q6VeGJdgRBGSyzzUS54qMn9Q@mail.gmail.com>
References: <CALiSPOqo37vJgbjwZwAGknNmwgRW+eFYBxgX86g866Pur0_LBQ@mail.gmail.com>
	<CAMLL7bn5AKUxGM0Bnq1nH3zm6s2VNEb_BJxUsWv9SP6we5n9uA@mail.gmail.com>
	<CALiSPOq5Unq3sVSh1utAgpY_E=Q6VeGJdgRBGSyzzUS54qMn9Q@mail.gmail.com>
Message-ID: <50CC9959.2090503@uni-muenster.de>

If you must post non-reproducible example code to this list, then at
least try to mention the packages you're addressing. You mention sp in
the subject, but my guess is that a tiny fraction of the list will
understood that you're (both) talking about the layer function in the
latticeExtra package.


On 12/15/2012 01:01 AM, Vladimir Gutierrez Corea wrote:
> Hello,
> 
> Oscar,  Thank you!
> 
> I'm relatively new on using spatial data into R, and I wasn't able to
> figured out that the "evaluation used in layer is non-standard",... the
> reason why the local variables were working fine until the layer method was
> called.
> 
> Now (if someone else has this doubt in the future) this is the way for
> using local data inside a function that calls the layer method: (the last
> two lines on the previous example function):
> 
> layer(sp.points(*h1,* col='red', pch = 18)*, data = list(h1 = pDatos)*) +
> layer(sp.text(coordinates*(h2*), round(h2$RS,0), adj=0, col='blue')*, data
> = list(h2 = pDatos*))
> 
> Best,
> 
> --Vladimir
> 
> On Fri, Dec 14, 2012 at 6:47 PM, Oscar Perpi?an <oscar.perpinan at gmail.com>wrote:
> 
>> Hello,
>>
>> The layer function uses non-standard evaluation. The help page of layer
>> says:
>>
>> "Note that the evaluation used in layer is non-standard and can be
>> confusing at first: you typically refer to variables as if inside the panel
>> function (x, y,etc);you can usually refer to objects which exist in the
>> global environment(workspace),but it  is safer to pass them in by name in
>> the data argument to layer.(And this should not to be confused with the
>> data argument to the original xyplot.)"
>>
>> The last example of this help page will be useful for you.
>>
>> Best,
>>
>> Oscar.
>> El 14/12/2012 18:33, "Vladimir Gutierrez Corea" <vladimir.gut at gmail.com>
>> escribi?:
>>
>>>  Dear All,
>>>
>>> I'm building a function for plotting some maps. This function get as
>>> argument a variable and also create some local variables, but then when I
>>> try to read these  variables through layer(sp.points(VARIABLE)), I got the
>>> following error: Object 'VARIABLE' not found...
>>>
>>> here the code
>>>
>>> #-----------------------------------------------------------------------------
>>> ShowInMap <- function(pDatos)
>>> {
>>>   coordinates(pDatos) <- c("COORDX", "COORDY")
>>>   proj4string(pDatos) <- CRS("+init=epsg:4326")
>>>   pDatos <- spTransform(pDatos,CRS("+init=epsg:23030"))
>>>   browser()
>>>   InterP.IDW <- krige(RS ~ 1, pDatos, gGrid)
>>>   InterP <- InterP.IDW
>>>   InterP[["IDW_pred"]] <- InterP.IDW$var1.pred
>>>
>>>   spplot(InterP, c("IDW_pred"), names.attr = c("IDW"), main = "(UTC)",
>>> col.regions = grey(rev(seq(0,0.75,0.05)))) +
>>>   layer(sp.polygons(gEsp, col='blue')) + # /* gEsp is a Global variable
>>> and
>>> this line works fine */
>>>   layer(sp.polygons(gCyL, col='cyan')) + # /* gCyL is a Global variable
>>> and
>>> this line works fine */
>>>   layer(sp.points(pDatos, col='red', pch = 18)) + #  / * HERE IS THE
>>> PROBLEM with "pDatos", pDatos is working fine in all the other part of
>>> code
>>> */
>>>   layer(sp.text(coordinates(pDatos), round(pDatos$RS,0), adj=0,
>>> col='blue')) # / * HERE IS THE PROBLEM with "pDatos", pDatos is working
>>> fine in all the other part of code */
>>> }
>>>
>>> #-----------------------------------------------------------------------------
>>>
>>> It seems like if the following code: "layer(sp.points" is pointing to
>>> other
>>> environment than local environment of the function... If I change the code
>>> for reading a global variable of course this works fine but I don't like
>>> to
>>> do a mess in the code by doing that!
>>>
>>> How can I manage that?
>>> What can be the problem?
>>> Is there a way to say "R" that "layer" and "sp.points" have to see this
>>> local environment (like some kind of full-path)?
>>>
>>> Thanks in advance for your help
>>>
>>> Best regards,
>>>
>>> --
>>> ************************************************************
>>> Federico *Vladimir* Gutierrez Corea   www.vlado.es
>>>
>>> PhD Candidate at Technical University of Madrid (UPM)
>>> MERCATOR Research Group
>>> Campus SUR , Paseo de la Arboleda s/n.
>>> E-28031 Madrid (Spain)
>>> E-Mail: fv.gutierrez at upm.es
>>> Ph.:  +34 91 331 1968  (University)
>>> Fax.: +34 91 331 1968 (University)
>>> ************************************************************
>>> See *Vladimir* on Linked-In <http://es.linkedin.com/in/fvgutierrez>
>>> See *Vladimir* on GeoI+D Research Center at
>>> UPM<
>>> http://www.upm.es/observatorio/vi/index.jsp?pageac=investigador.jsp&idInvestigador=11805
>>>>
>>> See *Vladimir* on Google-Scientific
>>> Publications<
>>> http://scholar.google.es/scholar?start=0&q=F.+Vladimir+Gutierrez-Corea&hl=en&as_sdt=1
>>>>
>>>
>>> ************************************************************
>>>
>>>         [[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
> 
> 
> 
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From lestes at princeton.edu  Sat Dec 15 16:40:52 2012
From: lestes at princeton.edu (Lyndon Estes)
Date: Sat, 15 Dec 2012 10:40:52 -0500
Subject: [R-sig-Geo] Cleaning up self-intersections
In-Reply-To: <3a151ec42ec6465a9a0d091120a1034d@CSGHUB209W.pu.win.princeton.edu>
References: <79c927d12d74474ab8de3233faf9b9fc@EX-1-HT0.lancs.local>
	<3a151ec42ec6465a9a0d091120a1034d@CSGHUB209W.pu.win.princeton.edu>
Message-ID: <CALuVVaZxM_35B7N_NJaQHEFC7awnt5LU0ti8O6gFtq_P04ncJA@mail.gmail.com>

Hi Barry,

Thanks very much for the tip.  I will try and see if I can implement
that using system calls from my R script, and will report back.

Thanks, Lyndon

On Fri, Dec 14, 2012 at 7:04 PM, Barry Rowlingson
<b.rowlingson at lancaster.ac.uk> wrote:
> On Fri, Dec 14, 2012 at 8:16 PM, Lyndon Estes <lestes at princeton.edu> wrote:
>
>> Given the type of work we are asking of people, we are getting many
>> "unclean" polygons (self-intersects, overlaps, non-noding
>> intersections, etc).  I have been writing in various patches to deal
>> with these as I have been going, but I turn now for some advice on
>> cleaning up operations. An example taken from the workflow illustrates
>> a typical problem I encounter that I am looking for an efficient way
>> to handle. This example is followed by my two questions.
>
>> So, here''s my first question.  Is there some other of cleaning
>> self-intersections up that preserves the area better than the examples
>> using gBuffer and gSimplify, and which might be more efficient and
>> provide a results that more closely approximates the original map than
>> rasterizing and polygonizing? e.g. Is it possible to explode polygons
>> at the point(s) of self-intersection, in order to create multiple
>> valid polygons?
>>
>> My second question: am I barking up the wrong tree here?  Should I
>> preferentially use something like GRASS's v.clean before I even read
>> into R?  I haven't until now because 1) I don't know GRASS very well,
>> 2) I want to minimize the number of different routines/software in the
>> workflow (which currently involves python, postgis/postgres, R,
>> openlayers).
>
>  The most promising thing I've seen for cleaning up polygon topology
> is pprepair:
>
> https://github.com/tudelft-gist/pprepair
>
>
> which won a best paper prize at OSGIS-UK this year. Its not simple to
> run properly, which is why I say most promising, and not best.
>
> If run on your extreme self-intersection 'bow tie' polygon, it
> produces a shapefile with a feature for each part of the bow tie. I
> can't currently find a way of tieing those two features back to the
> source bow-tie feature since the attributes aren't propogating
> properly. Also, it seems to merge two of the large features in your
> examples. Its a standalone C++ program that needs the CGAL library to
> work, and there's no R interface. It operates on Shapefiles (or
> possibly any OGR source?).
>
> Overall, cleaning up messy digitizing is a hard problem. Obviously
> overlaps between polygons are wrong, and pprepair does a great job of
> assigning them to one or other of the polygons, but gaps are trickier
> to assign - they might be real gaps (like a river between regions) or
> they could be digiitzing errors. Its possible that some buffering
> could help here, before doing pprepair.
>
> Barry



-- 
Lyndon Estes
Associate Research Scholar
Princeton University
+1-609-258-8308 (o)
+1-609-258-2799 (f)
+1-202-431-0496 (m)
lestes at princeton.edu
www.princeton.edu/~lestes


From alobolistas at gmail.com  Sat Dec 15 21:40:24 2012
From: alobolistas at gmail.com (Agustin Lobo)
Date: Sat, 15 Dec 2012 21:40:24 +0100
Subject: [R-sig-Geo] Rotating with maptools::ellide()
Message-ID: <CAG4NRe+zWjcrG0qrTtr4=C5E_HY6V1bTDS0a=i72YPhn91RscQ@mail.gmail.com>

Given an SpPolDF, if I rotate the first polygon  with
delme <- elide(testAlfacs20120626footp[1,], rotate=-90)

I get the result shifted. I get the rotation I was expecting by indicating the
coordinates of the center:
delme <- elide(testAlfacs20120626footp[1,],
rotate=-90,center=coordinates(testAlfacs20120626footp[1,]))

How could I rotate all polygons, each one around its own centroid?
I've tried
> delme <- elide(testAlfacs20120626footp, rotate=-90,center=coordinates(testAlfacs20120626footp))
Error in .local(obj, ...) : center must be numeric of length two

Thanks,

Agus

Data: http://dl.dropbox.com/u/3180464/testAlfacs20120626footp.rda

> sessionInfo()
R version 2.15.2 (2012-10-26)
Platform: i686-pc-linux-gnu (32-bit)

locale:
 [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
LC_TIME=en_US.UTF-8
 [4] LC_COLLATE=en_US.UTF-8     LC_MONETARY=en_US.UTF-8
LC_MESSAGES=en_US.UTF-8
 [7] LC_PAPER=C                 LC_NAME=C
LC_ADDRESS=C
[10] LC_TELEPHONE=C             LC_MEASUREMENT=en_US.UTF-8
LC_IDENTIFICATION=C

attached base packages:
[1] grid      stats     graphics  grDevices utils     datasets
methods   base

other attached packages:
[1] maptools_0.8-20 lattice_0.19-30 foreign_0.8-51  zoo_1.7-7
chron_2.3-39    raster_2.0-25
[7] rgdal_0.7-22    sp_1.0-2

loaded via a namespace (and not attached):
[1] tools_2.15.2


From Roger.Bivand at nhh.no  Sat Dec 15 23:06:39 2012
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sat, 15 Dec 2012 23:06:39 +0100
Subject: [R-sig-Geo] Rotating with maptools::ellide()
In-Reply-To: <CAG4NRe+zWjcrG0qrTtr4=C5E_HY6V1bTDS0a=i72YPhn91RscQ@mail.gmail.com>
References: <CAG4NRe+zWjcrG0qrTtr4=C5E_HY6V1bTDS0a=i72YPhn91RscQ@mail.gmail.com>
Message-ID: <alpine.LRH.2.02.1212152303100.22746@reclus.nhh.no>

On Sat, 15 Dec 2012, Agustin Lobo wrote:

> Given an SpPolDF, if I rotate the first polygon  with
> delme <- elide(testAlfacs20120626footp[1,], rotate=-90)
>
> I get the result shifted. I get the rotation I was expecting by indicating the
> coordinates of the center:
> delme <- elide(testAlfacs20120626footp[1,],
> rotate=-90,center=coordinates(testAlfacs20120626footp[1,]))
>
> How could I rotate all polygons, each one around its own centroid?
> I've tried
>> delme <- elide(testAlfacs20120626footp, rotate=-90,center=coordinates(testAlfacs20120626footp))
> Error in .local(obj, ...) : center must be numeric of length two

Plrease provide a motivation - elide methods are not intended to elide 
parts of data sets. Please also provide the code for copy and paste, 
withou having to discard the leading prompts. If you need a different 
function, why not write one as a loop over elide - although then there 
will be absolutely no chance that your output geometries will be planar, 
so things like plotting just will not work as expected where entities 
overlap.

Roger

>
> Thanks,
>
> Agus
>
> Data: http://dl.dropbox.com/u/3180464/testAlfacs20120626footp.rda
>
>> sessionInfo()
> R version 2.15.2 (2012-10-26)
> Platform: i686-pc-linux-gnu (32-bit)
>
> locale:
> [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
> LC_TIME=en_US.UTF-8
> [4] LC_COLLATE=en_US.UTF-8     LC_MONETARY=en_US.UTF-8
> LC_MESSAGES=en_US.UTF-8
> [7] LC_PAPER=C                 LC_NAME=C
> LC_ADDRESS=C
> [10] LC_TELEPHONE=C             LC_MEASUREMENT=en_US.UTF-8
> LC_IDENTIFICATION=C
>
> attached base packages:
> [1] grid      stats     graphics  grDevices utils     datasets
> methods   base
>
> other attached packages:
> [1] maptools_0.8-20 lattice_0.19-30 foreign_0.8-51  zoo_1.7-7
> chron_2.3-39    raster_2.0-25
> [7] rgdal_0.7-22    sp_1.0-2
>
> loaded via a namespace (and not attached):
> [1] tools_2.15.2
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From elaine.kuo.tw at gmail.com  Sun Dec 16 05:15:19 2012
From: elaine.kuo.tw at gmail.com (Elaine Kuo)
Date: Sun, 16 Dec 2012 12:15:19 +0800
Subject: [R-sig-Geo] averaging X of specific Y (latitude)
Message-ID: <CAGJhoDzXOHiZGN-tiV=22DZwAJf5-J0mJwz9em7jGKfStn+Gkg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121216/a62f9922/attachment.pl>

From HodgessE at uhd.edu  Sun Dec 16 05:20:32 2012
From: HodgessE at uhd.edu (Hodgess, Erin)
Date: Sun, 16 Dec 2012 04:20:32 +0000
Subject: [R-sig-Geo] averaging X of specific Y (latitude)
In-Reply-To: <CAGJhoDzXOHiZGN-tiV=22DZwAJf5-J0mJwz9em7jGKfStn+Gkg@mail.gmail.com>
References: <CAGJhoDzXOHiZGN-tiV=22DZwAJf5-J0mJwz9em7jGKfStn+Gkg@mail.gmail.com>
Message-ID: <FF9DB805FC41CC4E95825A50F6806302128EE5B1@columbia.uhd.campus>

Hi!

Is it a data frame, please?

Have you tried the "table" function or "cut" function?

Sincerely,
Erin

________________________________________
From: r-sig-geo-bounces at r-project.org [r-sig-geo-bounces at r-project.org] on behalf of Elaine Kuo [elaine.kuo.tw at gmail.com]
Sent: Saturday, December 15, 2012 10:15 PM
To: r-help at r-project.org; r-sig-geo
Subject: [R-sig-Geo] averaging X of specific Y (latitude)

Hello



I have a table describing butterfly range traits.

It is composed of three columns as below



Species name  range size (X)    latitude of range midpoint (Y)



There are 11 kinds of butterflies.

Each has its range size, and the latitude of each range midpoint ranges
from 9 to 19.

I would like to have the average range size of every degree of latitude.

For example, the average range size of latitude degree 10 (10.0-10.99:
Butterfly A2, B1, B2)

Please kindly help with R code to calculate the average values.

Thank you.


Elaine


The details are as followed.



Butterfly A1      130.5                 9.45

Butterfly A2      450.68                           10.2

Butterfly A3      1102.38                        9.3

Butterfly A4            893.34                             16.4

Butterfly B1           820.2                               10.54

Butterfly B2            872.2                               10.87

Butterfly B3            488.2                               16.79

Butterfly B4            620.11                             18.3

Butterfly B5            982.78                             12.98

Butterfly C1           720.32                             12.67

Butterfly C2            912.2                               18.07

        [[alternative HTML version deleted]]

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From elaine.kuo.tw at gmail.com  Sun Dec 16 05:26:50 2012
From: elaine.kuo.tw at gmail.com (Elaine Kuo)
Date: Sun, 16 Dec 2012 12:26:50 +0800
Subject: [R-sig-Geo] averaging X of specific Y (latitude)
In-Reply-To: <FF9DB805FC41CC4E95825A50F6806302128EE5B1@columbia.uhd.campus>
References: <CAGJhoDzXOHiZGN-tiV=22DZwAJf5-J0mJwz9em7jGKfStn+Gkg@mail.gmail.com>
	<FF9DB805FC41CC4E95825A50F6806302128EE5B1@columbia.uhd.campus>
Message-ID: <CAGJhoDySDwxa_b9BKiR17a66U49S9Xu_UATBFPNVO9oUM9ACYg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121216/ee0aa09d/attachment.pl>

From HodgessE at uhd.edu  Sun Dec 16 06:11:33 2012
From: HodgessE at uhd.edu (Hodgess, Erin)
Date: Sun, 16 Dec 2012 05:11:33 +0000
Subject: [R-sig-Geo] averaging X of specific Y (latitude)
In-Reply-To: <CAGJhoDySDwxa_b9BKiR17a66U49S9Xu_UATBFPNVO9oUM9ACYg@mail.gmail.com>
References: <CAGJhoDzXOHiZGN-tiV=22DZwAJf5-J0mJwz9em7jGKfStn+Gkg@mail.gmail.com>
	<FF9DB805FC41CC4E95825A50F6806302128EE5B1@columbia.uhd.campus>,
	<CAGJhoDySDwxa_b9BKiR17a66U49S9Xu_UATBFPNVO9oUM9ACYg@mail.gmail.com>
Message-ID: <FF9DB805FC41CC4E95825A50F6806302128EE5D7@columbia.uhd.campus>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121216/2097a9c9/attachment.pl>

From HodgessE at uhd.edu  Sun Dec 16 06:24:01 2012
From: HodgessE at uhd.edu (Hodgess, Erin)
Date: Sun, 16 Dec 2012 05:24:01 +0000
Subject: [R-sig-Geo] averaging X of specific Y (latitude)
In-Reply-To: <FF9DB805FC41CC4E95825A50F6806302128EE5D7@columbia.uhd.campus>
References: <CAGJhoDzXOHiZGN-tiV=22DZwAJf5-J0mJwz9em7jGKfStn+Gkg@mail.gmail.com>
	<FF9DB805FC41CC4E95825A50F6806302128EE5B1@columbia.uhd.campus>,
	<CAGJhoDySDwxa_b9BKiR17a66U49S9Xu_UATBFPNVO9oUM9ACYg@mail.gmail.com>,
	<FF9DB805FC41CC4E95825A50F6806302128EE5D7@columbia.uhd.campus>
Message-ID: <FF9DB805FC41CC4E95825A50F6806302128EE601@columbia.uhd.campus>

Would this help you:

> butterfly
   V1      V2    V3
1  A1  130.50  9.45
2  A2  450.68 10.20
3  A3 1102.38  9.30
4  A4  893.34 16.40
5  B1  820.20 10.54
6  B2  872.20 10.87
7  B3  488.20 16.79
8  B4  620.11 18.30
9  B5  982.78 12.98
10 C1  720.32 12.67
11 C2  912.20 18.07
> table(cut(butterfly$V3,breaks=9:19))

 (9,10] (10,11] (11,12] (12,13] (13,14] (14,15] (15,16] (16,17] (17,18] (18,19] 
      2       3       0       2       0       0       0       2       0       2 
> 


________________________________________
From: r-sig-geo-bounces at r-project.org [r-sig-geo-bounces at r-project.org] on behalf of Hodgess, Erin
Sent: Saturday, December 15, 2012 11:11 PM
To: Elaine Kuo; r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] averaging X of specific Y (latitude)

Could you put up a little sample from your data frame?  It's easier to work with then.

Erin


________________________________
From: Elaine Kuo [elaine.kuo.tw at gmail.com]
Sent: Saturday, December 15, 2012 10:26 PM
To: Hodgess, Erin
Cc: r-help at r-project.org; r-sig-geo
Subject: Re: [R-sig-Geo] averaging X of specific Y (latitude)

Hello,

Yes, it is a data frame.

This is the first time to hear "table" function or "cut" function.
Please kindly point out how to use them.

By the way,
if the dataset (data frame) includes more than 2000 kinds of butterfly range sizes and the latitude of range midpoints,
please kindly help with any suggestion to perform the task.
Thank you

Elaine

On Sun, Dec 16, 2012 at 12:20 PM, Hodgess, Erin <HodgessE at uhd.edu<mailto:HodgessE at uhd.edu>> wrote:
Hi!

Is it a data frame, please?

Have you tried the "table" function or "cut" function?

Sincerely,
Erin

________________________________________
From: r-sig-geo-bounces at r-project.org<mailto:r-sig-geo-bounces at r-project.org> [r-sig-geo-bounces at r-project.org<mailto:r-sig-geo-bounces at r-project.org>] on behalf of Elaine Kuo [elaine.kuo.tw at gmail.com<mailto:elaine.kuo.tw at gmail.com>]
Sent: Saturday, December 15, 2012 10:15 PM
To: r-help at r-project.org<mailto:r-help at r-project.org>; r-sig-geo
Subject: [R-sig-Geo] averaging X of specific Y (latitude)

Hello



I have a table describing butterfly range traits.

It is composed of three columns as below



Species name  range size (X)    latitude of range midpoint (Y)



There are 11 kinds of butterflies.

Each has its range size, and the latitude of each range midpoint ranges
from 9 to 19.

I would like to have the average range size of every degree of latitude.

For example, the average range size of latitude degree 10 (10.0-10.99:
Butterfly A2, B1, B2)

Please kindly help with R code to calculate the average values.

Thank you.


Elaine


The details are as followed.



Butterfly A1      130.5                 9.45

Butterfly A2      450.68                           10.2

Butterfly A3      1102.38                        9.3

Butterfly A4            893.34                             16.4

Butterfly B1           820.2                               10.54

Butterfly B2            872.2                               10.87

Butterfly B3            488.2                               16.79

Butterfly B4            620.11                             18.3

Butterfly B5            982.78                             12.98

Butterfly C1           720.32                             12.67

Butterfly C2            912.2                               18.07

        [[alternative HTML version deleted]]

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org<mailto:R-sig-Geo at r-project.org>
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


        [[alternative HTML version deleted]]

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From vladimir.gut at gmail.com  Sun Dec 16 12:35:42 2012
From: vladimir.gut at gmail.com (Vladimir Gutierrez Corea)
Date: Sun, 16 Dec 2012 12:35:42 +0100
Subject: [R-sig-Geo] How to access a local sp-variable inside a function
 using the layer method
Message-ID: <CALiSPOqz_ymmXs7u149FP98h0Za8tzXh-rCcEcDoizLDfL+1Mw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121216/4677c529/attachment.pl>

From b.rowlingson at lancaster.ac.uk  Sun Dec 16 16:13:07 2012
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Sun, 16 Dec 2012 15:13:07 +0000
Subject: [R-sig-Geo] R 3.0.0 and spatial classes
Message-ID: <CANVKczMNHVLV1TQVhaopZceWnteaQ_2-N1LO0Tp5_5Y-L7ZXSA@mail.gmail.com>

There's been an announcement that the next version of R will be called
3.0.0. Although not a massive change (compared to Python 2.x and 3.x,
or Perl 4 to Perl 5), it might be a good opportunity to revise all the
spatial classes in order to:

 * clear out any cruft
 * remove any inconsistencies
 * add some new functionality
 * unify across spatial packages

The first thing that springs to mind, for example, is getting sp and
raster to use the same functions for coordinate reference system
processing. Doubtless there are other opprtunities for synergy...

 Yes, this may well break existing code, but if R is going to jump
from 2 to 3 then that will break existing code too.

 Your ponderances, please...

Barry


From mdsumner at gmail.com  Sun Dec 16 17:37:27 2012
From: mdsumner at gmail.com (Michael Sumner)
Date: Sun, 16 Dec 2012 08:37:27 -0800
Subject: [R-sig-Geo] R 3.0.0 and spatial classes
In-Reply-To: <CANVKczMNHVLV1TQVhaopZceWnteaQ_2-N1LO0Tp5_5Y-L7ZXSA@mail.gmail.com>
References: <CANVKczMNHVLV1TQVhaopZceWnteaQ_2-N1LO0Tp5_5Y-L7ZXSA@mail.gmail.com>
Message-ID: <CAAcGz99w9+cdUg7S1L4A5gg=HR33ER1rH6tNgT1iaah5Dm9qMw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121216/534db100/attachment.pl>

From b.rowlingson at lancaster.ac.uk  Sun Dec 16 17:41:08 2012
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Sun, 16 Dec 2012 16:41:08 +0000
Subject: [R-sig-Geo] R 3.0.0 and spatial classes
In-Reply-To: <3649fbe645b94724a62f9e14a432a86a@EX-0-HT0.lancs.local>
References: <CANVKczMNHVLV1TQVhaopZceWnteaQ_2-N1LO0Tp5_5Y-L7ZXSA@mail.gmail.com>
	<3649fbe645b94724a62f9e14a432a86a@EX-0-HT0.lancs.local>
Message-ID: <CANVKczMM-ECJqQa18QsGmLw2a1JvLiBnH=w4yY4Ombcb5gMUHw@mail.gmail.com>

In the latest R-devel NEWS file:

http://stat.ethz.ch/R-manual/R-devel/doc/html/NEWS.html



On Sun, Dec 16, 2012 at 4:37 PM, Michael Sumner <mdsumner at gmail.com> wrote:
> Where is the announcement?
>
>
>
> On Sunday, December 16, 2012, Barry Rowlingson wrote:
>>
>> There's been an announcement that the next version of R will be called
>> 3.0.0. Although not a massive change (compared to Python 2.x and 3.x,
>> or Perl 4 to Perl 5), it might be a good opportunity to revise all the
>> spatial classes in order to:
>>
>>  * clear out any cruft
>>  * remove any inconsistencies
>>  * add some new functionality
>>  * unify across spatial packages
>>
>> The first thing that springs to mind, for example, is getting sp and
>> raster to use the same functions for coordinate reference system
>> processing. Doubtless there are other opprtunities for synergy...
>>
>>  Yes, this may well break existing code, but if R is going to jump
>> from 2 to 3 then that will break existing code too.
>>
>>  Your ponderances, please...
>>
>> Barry
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
>
> --
> Michael Sumner
> Hobart, Australia
> e-mail: mdsumner at gmail.com


From edzer.pebesma at uni-muenster.de  Sun Dec 16 18:19:22 2012
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Sun, 16 Dec 2012 18:19:22 +0100
Subject: [R-sig-Geo] R 3.0.0 and spatial classes
In-Reply-To: <CANVKczMNHVLV1TQVhaopZceWnteaQ_2-N1LO0Tp5_5Y-L7ZXSA@mail.gmail.com>
References: <CANVKczMNHVLV1TQVhaopZceWnteaQ_2-N1LO0Tp5_5Y-L7ZXSA@mail.gmail.com>
Message-ID: <50CE029A.8010604@uni-muenster.de>

Hi Barry, that sounds like a great project. As of your (only) example, I
already see, after loading package raster:

> showMethods(proj4string)
Function: proj4string (package sp)
obj="Raster"
obj="Spatial"

Loading Tcl/Tk interface ... done
> getMethod(proj4string, "Raster")
Method Definition:

function (obj)
{
    projection(obj)
}
<environment: namespace:raster>

Signatures:
        obj
target  "Raster"
defined "Raster"

or do you suggest that sp should adopt the use of projection() as well?

I'm looking forward to many reactions too, but will draw my conclusions
if there aren't any.

On 12/16/2012 04:13 PM, Barry Rowlingson wrote:
> There's been an announcement that the next version of R will be called
> 3.0.0. Although not a massive change (compared to Python 2.x and 3.x,
> or Perl 4 to Perl 5), it might be a good opportunity to revise all the
> spatial classes in order to:
> 
>  * clear out any cruft
>  * remove any inconsistencies
>  * add some new functionality
>  * unify across spatial packages
> 
> The first thing that springs to mind, for example, is getting sp and
> raster to use the same functions for coordinate reference system
> processing. Doubtless there are other opprtunities for synergy...
> 
>  Yes, this may well break existing code, but if R is going to jump
> from 2 to 3 then that will break existing code too.
> 
>  Your ponderances, please...
> 
> Barry
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From piero.campa at gmail.com  Sun Dec 16 18:32:12 2012
From: piero.campa at gmail.com (piero campa)
Date: Sun, 16 Dec 2012 09:32:12 -0800 (PST)
Subject: [R-sig-Geo] STFDF with n variables
Message-ID: <1355679132144-7581966.post@n2.nabble.com>

Dear list,
I am going to build a spacetime::STFDF object where the "n" spatial
locations hold "h" different values (different fields) over the "m" times.

Along the documentation (spacetime vignette, ?stConstruct, ?STFDF, ?reshape)
I only found examples with layout of {n?m?1} observations, and not {n?m?h}
as in my case.
[I might as well have missed such examples, so please forgive me in that
case]

I am writing here to have a confirmation that I am doing things correctly.
This is a toy-example of my workflow (letting out CRS or ending-times
details):

-----------------------------------
library(gstat)
library(spacetime)
data(meuse)
# subset
meuse <- meuse[c("cadmium", "copper", "x", "y")][1:10,]
coordinates(meuse) <- ~x+y
#
ds <- slot(meuse, "data")
meuse <- as(meuse, "SpatialPoints")
# append hypothetical values to match cardinality of data required
ds <- rbind(ds, ds+1)
# Assign dates
dts <- as.Date(c(1:2))
ds <- cbind(ds, time=sort(rep(dts,10)), id=1:nrow(ds))
# Rename field variables to avoid conflict
#names(ds) <- c("cadmiums", "coppers", "time", "id")
# Build the spacetime object: n=10, m=2, h=2
stMeuse = STFDF(meuse, dts, ds) 
str(stMeuse)
-----------------------------------

Thanks for any comment.
Piero







--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/STFDF-with-n-variables-tp7581966.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From sglish at hotmail.com  Sun Dec 16 19:16:42 2012
From: sglish at hotmail.com (Chris English)
Date: Sun, 16 Dec 2012 13:16:42 -0500
Subject: [R-sig-Geo] R 3.0.0 and spatial classes
In-Reply-To: <CANVKczMNHVLV1TQVhaopZceWnteaQ_2-N1LO0Tp5_5Y-L7ZXSA@mail.gmail.com>
References: <CANVKczMNHVLV1TQVhaopZceWnteaQ_2-N1LO0Tp5_5Y-L7ZXSA@mail.gmail.com>
Message-ID: <BAY172-W2205B3894B8AC45E4BB669C5330@phx.gbl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121216/fe254387/attachment.pl>

From edzer.pebesma at uni-muenster.de  Sun Dec 16 19:19:50 2012
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Sun, 16 Dec 2012 19:19:50 +0100
Subject: [R-sig-Geo] STFDF with n variables
In-Reply-To: <1355679132144-7581966.post@n2.nabble.com>
References: <1355679132144-7581966.post@n2.nabble.com>
Message-ID: <50CE10C6.2090108@uni-muenster.de>


On 12/16/2012 06:32 PM, piero campa wrote:
> Dear list,
> I am going to build a spacetime::STFDF object where the "n" spatial
> locations hold "h" different values (different fields) over the "m" times.
> 
> Along the documentation (spacetime vignette, ?stConstruct, ?STFDF, ?reshape)
> I only found examples with layout of {n?m?1} observations, and not {n?m?h}
> as in my case.
> [I might as well have missed such examples, so please forgive me in that
> case]
> 
> I am writing here to have a confirmation that I am doing things correctly.
> This is a toy-example of my workflow (letting out CRS or ending-times
> details):
> 
> -----------------------------------
> library(gstat)
> library(spacetime)
> data(meuse)
> # subset
> meuse <- meuse[c("cadmium", "copper", "x", "y")][1:10,]
> coordinates(meuse) <- ~x+y
> #
> ds <- slot(meuse, "data")
> meuse <- as(meuse, "SpatialPoints")
> # append hypothetical values to match cardinality of data required
> ds <- rbind(ds, ds+1)
> # Assign dates
> dts <- as.Date(c(1:2))
> ds <- cbind(ds, time=sort(rep(dts,10)), id=1:nrow(ds))
> # Rename field variables to avoid conflict
> #names(ds) <- c("cadmiums", "coppers", "time", "id")
> # Build the spacetime object: n=10, m=2, h=2
> stMeuse = STFDF(meuse, dts, ds) 
> str(stMeuse)
> -----------------------------------
> 
> Thanks for any comment.
> Piero

Yes, that works:

> class(stMeuse)
[1] "STFDF"
attr(,"package")
[1] "spacetime"
> dim(stMeuse)
    space      time variables
       10         2         4


stConstruct would need extension to be help here, it tries to build
STFDF objects from time- or space-wide tables -- with multiple
attributes, the organization of such tables is not unambiguous.

(also note that with the CRAN version of spacetime, you'd need to load
package zoo first in order to run your script)


> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/STFDF-with-n-variables-tp7581966.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From edzer.pebesma at uni-muenster.de  Sun Dec 16 19:26:34 2012
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Sun, 16 Dec 2012 19:26:34 +0100
Subject: [R-sig-Geo] R 3.0.0 and spatial classes
In-Reply-To: <BAY172-W2205B3894B8AC45E4BB669C5330@phx.gbl>
References: <CANVKczMNHVLV1TQVhaopZceWnteaQ_2-N1LO0Tp5_5Y-L7ZXSA@mail.gmail.com>
	<BAY172-W2205B3894B8AC45E4BB669C5330@phx.gbl>
Message-ID: <50CE125A.2090707@uni-muenster.de>

Could you please detail in which respect you believe they are orphaned,
right now, and what kind of love they should receive?

On 12/16/2012 07:16 PM, Chris English wrote:
> 
> Well, I hope something is done with Spatial Lines that seem strangely like orphans
> while Spatial Points, Spatial Polygons, Spatial Grids and Spatial Pixels get all the love.
>> Date: Sun, 16 Dec 2012 15:13:07 +0000
>> From: b.rowlingson at lancaster.ac.uk
>> To: r-sig-geo at r-project.org
>> Subject: [R-sig-Geo] R 3.0.0 and spatial classes
>>
>> There's been an announcement that the next version of R will be called
>> 3.0.0. Although not a massive change (compared to Python 2.x and 3.x,
>> or Perl 4 to Perl 5), it might be a good opportunity to revise all the
>> spatial classes in order to:
>>
>>  * clear out any cruft
>>  * remove any inconsistencies
>>  * add some new functionality
>>  * unify across spatial packages
>>
>> The first thing that springs to mind, for example, is getting sp and
>> raster to use the same functions for coordinate reference system
>> processing. Doubtless there are other opprtunities for synergy...
>>
>>  Yes, this may well break existing code, but if R is going to jump
>> from 2 to 3 then that will break existing code too.
>>
>>  Your ponderances, please...
>>
>> Barry
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>  		 	   		  
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From piero.campa at gmail.com  Sun Dec 16 19:42:59 2012
From: piero.campa at gmail.com (Piero Campalani)
Date: Sun, 16 Dec 2012 19:42:59 +0100
Subject: [R-sig-Geo] STFDF with n variables
In-Reply-To: <50CE10C6.2090108@uni-muenster.de>
References: <1355679132144-7581966.post@n2.nabble.com>
	<50CE10C6.2090108@uni-muenster.de>
Message-ID: <CAMp9JaPw8nO-2TmFCeBCftCfhp6jgRDn9Gn-8C1dzOHK4qGsDw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121216/69d7081e/attachment.pl>

From edzer.pebesma at uni-muenster.de  Sun Dec 16 19:53:46 2012
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Sun, 16 Dec 2012 19:53:46 +0100
Subject: [R-sig-Geo] STFDF with n variables
In-Reply-To: <CAMp9JaPw8nO-2TmFCeBCftCfhp6jgRDn9Gn-8C1dzOHK4qGsDw@mail.gmail.com>
References: <1355679132144-7581966.post@n2.nabble.com>
	<50CE10C6.2090108@uni-muenster.de>
	<CAMp9JaPw8nO-2TmFCeBCftCfhp6jgRDn9Gn-8C1dzOHK4qGsDw@mail.gmail.com>
Message-ID: <50CE18BA.9080603@uni-muenster.de>

Piero,

in your case id is simply an attribute, so it can have any value, as you
can see from:

stplot(stMeuse[,,1:4], mode = 'ts')

what is the special purpose of your IDs, what should they identify?

On 12/16/2012 07:42 PM, Piero Campalani wrote:
> Thank you Edzer,
> comments inline
> 
> On 16 December 2012 19:19, Edzer Pebesma <edzer.pebesma at uni-muenster.de>wrote:
>>
>> Yes, that works:
>>
>>> class(stMeuse)
>> [1] "STFDF"
>> attr(,"package")
>> [1] "spacetime"
>>> dim(stMeuse)
>>     space      time variables
>>        10         2         4
>>
> 
> I could see that a STFDF object was created, but I still have some concern
> with regard to the "id" which need to be attached to the data.frame .
> 
> With regards to my example, I tried as well with reverse-order IDs:
>> ds <- cbind(ds, time=sort(rep(dts,10)), id=nrow(ds):1)
> ...or with duplicated IDs like:
>> ds <- cbind(ds, time=sort(rep(dts,10)), id=rep(1:10,2))
> and the final stMeuse object still seemed the same by looking at
> stplot(stMeuse).
> I guess they are not bound to the locations of the spatial object (points
> in `meuse` in this case).
> 
> 
>> (also note that with the CRAN version of spacetime, you'd need to load
> 
> package zoo first in order to run your script)
>>
> 
> Got it, thanks ;)
> 
> Piero
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From sglish at hotmail.com  Sun Dec 16 19:53:02 2012
From: sglish at hotmail.com (Chris English)
Date: Sun, 16 Dec 2012 13:53:02 -0500
Subject: [R-sig-Geo] R 3.0.0 and spatial classes
In-Reply-To: <50CE125A.2090707@uni-muenster.de>
References: <CANVKczMNHVLV1TQVhaopZceWnteaQ_2-N1LO0Tp5_5Y-L7ZXSA@mail.gmail.com>,
	<BAY172-W2205B3894B8AC45E4BB669C5330@phx.gbl>,
	<50CE125A.2090707@uni-muenster.de>
Message-ID: <BAY172-W3524EF474AD1335D13D452C5330@phx.gbl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121216/d4f9463d/attachment.pl>

From piero.campa at gmail.com  Sun Dec 16 20:28:07 2012
From: piero.campa at gmail.com (Piero Campalani)
Date: Sun, 16 Dec 2012 20:28:07 +0100
Subject: [R-sig-Geo] STFDF with n variables
In-Reply-To: <50CE18BA.9080603@uni-muenster.de>
References: <1355679132144-7581966.post@n2.nabble.com>
	<50CE10C6.2090108@uni-muenster.de>
	<CAMp9JaPw8nO-2TmFCeBCftCfhp6jgRDn9Gn-8C1dzOHK4qGsDw@mail.gmail.com>
	<50CE18BA.9080603@uni-muenster.de>
Message-ID: <CAMp9JaO1FU04Jdr--=dapZ4bNzJpbc36jwXc_Ckz902=3ym5oA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121216/8a2d2edf/attachment.pl>

From edzer.pebesma at uni-muenster.de  Sun Dec 16 20:53:58 2012
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Sun, 16 Dec 2012 20:53:58 +0100
Subject: [R-sig-Geo] STFDF with n variables
In-Reply-To: <CAMp9JaO1FU04Jdr--=dapZ4bNzJpbc36jwXc_Ckz902=3ym5oA@mail.gmail.com>
References: <1355679132144-7581966.post@n2.nabble.com>
	<50CE10C6.2090108@uni-muenster.de>
	<CAMp9JaPw8nO-2TmFCeBCftCfhp6jgRDn9Gn-8C1dzOHK4qGsDw@mail.gmail.com>
	<50CE18BA.9080603@uni-muenster.de>
	<CAMp9JaO1FU04Jdr--=dapZ4bNzJpbc36jwXc_Ckz902=3ym5oA@mail.gmail.com>
Message-ID: <50CE26D6.5070806@uni-muenster.de>



On 12/16/2012 08:28 PM, Piero Campalani wrote:
> Oh, right,
> I actually can see that things work fine even with no "id" attribute in the
> data.frame.
> 
> I started it all by following an example of Roger with NDVI images of
> Gambia, where the initial wide-format dataframe was `reshape`d to
> long-format to eventually create a STFDF: the ids were used there.
> Afaics, one can keep trace of the spatial location of each row with the IDs
> when going from a time-wide format to a long one, otherwise the spatial
> dimension gets flattened with no chance of reverting to time-wide format.

Piero, there is a chance: if the layout is complete (full: STFDF) you
can recreate space and time ID from row order,

> ((1:prod(dim(stMeuse)[1:2])-1) %% dim(stMeuse)[1] + 1)
 [1]  1  2  3  4  5  6  7  8  9 10  1  2  3  4  5  6  7  8  9 10
> ((1:prod(dim(stMeuse)[1:2])-1) %/% dim(stMeuse)[1] + 1)
 [1] 1 1 1 1 1 1 1 1 1 1 2 2 2 2 2 2 2 2 2 2

For an irregular layout, STIDF, the IDs are kept in the index slot.

Indeed, you need to know that space cycles fastest, and so it is easy to
make mistakes.

> Thought they were used by STFDF to link the locations in the spatial object
> and the values in the data.frame.
> 
> Thanks again Edzer.
> Cheers,
> Piero
> 
> 
> On 16 December 2012 19:53, Edzer Pebesma <edzer.pebesma at uni-muenster.de>wrote:
> 
>> Piero,
>>
>> in your case id is simply an attribute, so it can have any value, as you
>> can see from:
>>
>> stplot(stMeuse[,,1:4], mode = 'ts')
>>
>> what is the special purpose of your IDs, what should they identify?
>>
>> On 12/16/2012 07:42 PM, Piero Campalani wrote:
>>> Thank you Edzer,
>>> comments inline
>>>
>>> On 16 December 2012 19:19, Edzer Pebesma <edzer.pebesma at uni-muenster.de
>>> wrote:
>>>>
>>>> Yes, that works:
>>>>
>>>>> class(stMeuse)
>>>> [1] "STFDF"
>>>> attr(,"package")
>>>> [1] "spacetime"
>>>>> dim(stMeuse)
>>>>     space      time variables
>>>>        10         2         4
>>>>
>>>
>>> I could see that a STFDF object was created, but I still have some
>> concern
>>> with regard to the "id" which need to be attached to the data.frame .
>>>
>>> With regards to my example, I tried as well with reverse-order IDs:
>>>> ds <- cbind(ds, time=sort(rep(dts,10)), id=nrow(ds):1)
>>> ...or with duplicated IDs like:
>>>> ds <- cbind(ds, time=sort(rep(dts,10)), id=rep(1:10,2))
>>> and the final stMeuse object still seemed the same by looking at
>>> stplot(stMeuse).
>>> I guess they are not bound to the locations of the spatial object (points
>>> in `meuse` in this case).
>>>
>>>
>>>> (also note that with the CRAN version of spacetime, you'd need to load
>>>
>>> package zoo first in order to run your script)
>>>>
>>>
>>> Got it, thanks ;)
>>>
>>> Piero
>>>
>>
>> --
>> Edzer Pebesma
>> Institute for Geoinformatics (ifgi), University of M?nster
>> Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
>> 8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
>> http://www.52north.org/geostatistics      e.pebesma at wwu.de
>>
>>
> 
> 	[[alternative HTML version deleted]]
> 
> 
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From b.rowlingson at lancaster.ac.uk  Sun Dec 16 20:58:55 2012
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Sun, 16 Dec 2012 19:58:55 +0000
Subject: [R-sig-Geo] R 3.0.0 and spatial classes
In-Reply-To: <9764661df8f74b628d0f7f856db9d0d1@EX-0-HT0.lancs.local>
References: <CANVKczMNHVLV1TQVhaopZceWnteaQ_2-N1LO0Tp5_5Y-L7ZXSA@mail.gmail.com>
	<BAY172-W2205B3894B8AC45E4BB669C5330@phx.gbl>
	<50CE125A.2090707@uni-muenster.de>
	<9764661df8f74b628d0f7f856db9d0d1@EX-0-HT0.lancs.local>
Message-ID: <CANVKczPuzJRk7vK7FJ3OL5FdW9Mr3auM5XGdcXRjKe+s0HOVog@mail.gmail.com>

On Sun, Dec 16, 2012 at 6:53 PM, Chris English <sglish at hotmail.com> wrote:
>
> Edzer:
> On Tue, Jul 17, 2012 at 2:34 PM, Agustin Lobo ~ from Barry Rowlingson
> wrote:
> To convert to SpatialLines, get the coordinates and build in the
> usual convoluted manner:
>
>  > s=data.frame(x=runif(10),y=1:10,z=rnorm(10))
>  > coordinates(s)=~x+y
>  > L = SpatialLines(list(Lines(list(Line(coordinates(s))),"X")))
>  > plot(L)
> Convoluted is not the same as orphaned, certainly, but one gets the sense that
> 'Line' owes its existence to matters of plotting rather than line as line, independent of
> drawing it, and this may have some import upon line analysis and the possibility of
> arriving at topology and dispensing with shared lines and the like.

 "Line" is a non-spatial Line, made up from an ordered set of (x,y)
coordinate pairs. It cannot have a coordinate system assigned to it.

 "Lines" is a list of Lines, making a non-spatial set of Line
segments. It too cannot have a coordinate system assigned.

 "SpatialLines" is a spatial set of Lines, for when you have a number
of features each of which may be composed of several disconnected
segments. It can have a coordinate system assigned.

 You are making a SpatialLines object where a single feature has a
single line segment. The slightly annoying
list(Lines(list(Line(...)))) dance is unavoidable because the lists
are necessary since the lists can have more than one element, but you
could easy create a 'SimpleSpatialLine' function that did all that. It
might even make sp for R 3.0.0! (SimpleSpatialPolygon might be handy
too...)

Another possibility might be to write methods for SpatialLines that
takes a matrix and skips the complexity for simple cases...

Barry


From b.rowlingson at lancaster.ac.uk  Sun Dec 16 21:15:27 2012
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Sun, 16 Dec 2012 20:15:27 +0000
Subject: [R-sig-Geo] R 3.0.0 and spatial classes
In-Reply-To: <c3299e85897d45c289bed3a77c6b9915@EX-0-HT0.lancs.local>
References: <CANVKczMNHVLV1TQVhaopZceWnteaQ_2-N1LO0Tp5_5Y-L7ZXSA@mail.gmail.com>
	<c3299e85897d45c289bed3a77c6b9915@EX-0-HT0.lancs.local>
Message-ID: <CANVKczNuA0s0wUed4-TNCbPpFE4m9LL0gS7dPbmcRim=f-e0Ng@mail.gmail.com>

On Sun, Dec 16, 2012 at 5:19 PM, Edzer Pebesma
<edzer.pebesma at uni-muenster.de> wrote:
> Hi Barry, that sounds like a great project. As of your (only) example, I
> already see, after loading package raster:
>
>> showMethods(proj4string)
> Function: proj4string (package sp)
> obj="Raster"
> obj="Spatial"
>
> Loading Tcl/Tk interface ... done
>> getMethod(proj4string, "Raster")
> Method Definition:
>
> function (obj)
> {
>     projection(obj)
> }
> <environment: namespace:raster>
>
> Signatures:
>         obj
> target  "Raster"
> defined "Raster"
>
> or do you suggest that sp should adopt the use of projection() as well?
>
> I'm looking forward to many reactions too, but will draw my conclusions
> if there aren't any.

 I'm not sure I like 'projection' at all. Technically these are
spatial coordinate reference systems. I think I would prefer to assign
a coordinate reference system with the CRS<- function:

CRS(foo) = proj4("+init=epsg:27700")

that would allow the possible use of other reference system specs, e.g.

CRS(foo) = wktProj('GEOGCS["WGS 84".... etc]')

but of course things like spTransform would have to understand how to
convert from things that aren't specified by a proj4 object, so they'd
probably have to error.

The proj4 and wktProj functions here would return an object of class
"CRS" and "proj4"/"wktProj". The thing that's nagging me now is the
use of a function called CRS that isn't a constructor for CRS objects,
so maybe:

setCRS(foo)=proj4("+init=epsg:4326")

Hmm.

Barry


From edzer.pebesma at uni-muenster.de  Sun Dec 16 21:47:29 2012
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Sun, 16 Dec 2012 21:47:29 +0100
Subject: [R-sig-Geo] R 3.0.0 and spatial classes
In-Reply-To: <CANVKczPuzJRk7vK7FJ3OL5FdW9Mr3auM5XGdcXRjKe+s0HOVog@mail.gmail.com>
References: <CANVKczMNHVLV1TQVhaopZceWnteaQ_2-N1LO0Tp5_5Y-L7ZXSA@mail.gmail.com>
	<BAY172-W2205B3894B8AC45E4BB669C5330@phx.gbl>
	<50CE125A.2090707@uni-muenster.de>
	<9764661df8f74b628d0f7f856db9d0d1@EX-0-HT0.lancs.local>
	<CANVKczPuzJRk7vK7FJ3OL5FdW9Mr3auM5XGdcXRjKe+s0HOVog@mail.gmail.com>
Message-ID: <50CE3361.6070008@uni-muenster.de>



On 12/16/2012 08:58 PM, Barry Rowlingson wrote:
> On Sun, Dec 16, 2012 at 6:53 PM, Chris English <sglish at hotmail.com> wrote:
>>
>> Edzer:
>> On Tue, Jul 17, 2012 at 2:34 PM, Agustin Lobo ~ from Barry Rowlingson
>> wrote:
>> To convert to SpatialLines, get the coordinates and build in the
>> usual convoluted manner:
>>
>>  > s=data.frame(x=runif(10),y=1:10,z=rnorm(10))
>>  > coordinates(s)=~x+y
>>  > L = SpatialLines(list(Lines(list(Line(coordinates(s))),"X")))
>>  > plot(L)
>> Convoluted is not the same as orphaned, certainly, but one gets the sense that
>> 'Line' owes its existence to matters of plotting rather than line as line, independent of
>> drawing it, and this may have some import upon line analysis and the possibility of
>> arriving at topology and dispensing with shared lines and the like.
> 
>  "Line" is a non-spatial Line, made up from an ordered set of (x,y)
> coordinate pairs. It cannot have a coordinate system assigned to it.
> 
>  "Lines" is a list of Lines, making a non-spatial set of Line
> segments. It too cannot have a coordinate system assigned.
> 
>  "SpatialLines" is a spatial set of Lines, for when you have a number
> of features each of which may be composed of several disconnected
> segments. It can have a coordinate system assigned.
> 
>  You are making a SpatialLines object where a single feature has a
> single line segment. The slightly annoying
> list(Lines(list(Line(...)))) dance is unavoidable because the lists
> are necessary since the lists can have more than one element, but you
> could easy create a 'SimpleSpatialLine' function that did all that. It
> might even make sp for R 3.0.0! (SimpleSpatialPolygon might be handy
> too...)

Nice idea -- or a "simple" method that does it with whatever you feed it
with? Or simply "c" methods, like c(Line1,Line2,Line3) creating a
SpatialLines object?

@Chris: the convolution of lines is identical to that of polygons, as is
its lack of topology and facilities for analysis.

> 
> Another possibility might be to write methods for SpatialLines that
> takes a matrix and skips the complexity for simple cases...

like, a n x 2 matrix with NA-separated lines?

> 
> Barry
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From dennis.duro at gmail.com  Sun Dec 16 23:18:32 2012
From: dennis.duro at gmail.com (dcd)
Date: Sun, 16 Dec 2012 14:18:32 -0800 (PST)
Subject: [R-sig-Geo] [raster] How to loop extract function?
Message-ID: <1355696312037-7581978.post@n2.nabble.com>

As asked  here
<http://stackoverflow.com/questions/13897455/pass-variable-name-to-a-function-and-output-inside-of-loop-in-r>  
on stackoverflow:


for(j in 1:3) {
    for(k in 1:17){
       extract_[j]km <- extract(RasterStack, SpatialPolygonsDataFrame_[j]km,
layer=[k], nl=1, df=TRUE)
    }
}

While the Rasterstack remains constant, the SpatialPolygon and layer within
the RasterStack will iterate. From the posts I've read I'm now getting the
hint that loops and R aren't the best combination, but what approach would
achieve something similar to  the above pseudo-loop code? I've looked at
get, paste, and lapply, but I can't get them to work with extract. Any help
would be most appreciated.

Many thanks in advance!

D






--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/raster-How-to-loop-extract-function-tp7581978.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From elaine.kuo.tw at gmail.com  Mon Dec 17 00:16:37 2012
From: elaine.kuo.tw at gmail.com (Elaine Kuo)
Date: Mon, 17 Dec 2012 07:16:37 +0800
Subject: [R-sig-Geo] [R] averaging X of specific Y (latitude)
In-Reply-To: <1355677224.43164.YahooMailNeo@web142603.mail.bf1.yahoo.com>
References: <CAGJhoDzXOHiZGN-tiV=22DZwAJf5-J0mJwz9em7jGKfStn+Gkg@mail.gmail.com>
	<002401cddbab$02642320$072c6960$@edu>
	<1355677224.43164.YahooMailNeo@web142603.mail.bf1.yahoo.com>
Message-ID: <CAGJhoDzOtzZuAXg9+3tk51xmk-kbQfH_KGMcKm6U-LWRU-pcxA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121217/b597cede/attachment.pl>

From r.hijmans at gmail.com  Mon Dec 17 05:05:05 2012
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Sun, 16 Dec 2012 20:05:05 -0800
Subject: [R-sig-Geo] R 3.0.0 and spatial classes
In-Reply-To: <CANVKczNuA0s0wUed4-TNCbPpFE4m9LL0gS7dPbmcRim=f-e0Ng@mail.gmail.com>
References: <CANVKczMNHVLV1TQVhaopZceWnteaQ_2-N1LO0Tp5_5Y-L7ZXSA@mail.gmail.com>
	<c3299e85897d45c289bed3a77c6b9915@EX-0-HT0.lancs.local>
	<CANVKczNuA0s0wUed4-TNCbPpFE4m9LL0gS7dPbmcRim=f-e0Ng@mail.gmail.com>
Message-ID: <CANtt_hx_fVVb883XzpX5fkcEqJ=6Q3urp7_Ow0D7N9RPVzF1iw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121216/2e05c44c/attachment.pl>

From r.hijmans at gmail.com  Mon Dec 17 05:07:10 2012
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Sun, 16 Dec 2012 20:07:10 -0800
Subject: [R-sig-Geo] R 3.0.0 and spatial classes
In-Reply-To: <50CE3361.6070008@uni-muenster.de>
References: <CANVKczMNHVLV1TQVhaopZceWnteaQ_2-N1LO0Tp5_5Y-L7ZXSA@mail.gmail.com>
	<BAY172-W2205B3894B8AC45E4BB669C5330@phx.gbl>
	<50CE125A.2090707@uni-muenster.de>
	<9764661df8f74b628d0f7f856db9d0d1@EX-0-HT0.lancs.local>
	<CANVKczPuzJRk7vK7FJ3OL5FdW9Mr3auM5XGdcXRjKe+s0HOVog@mail.gmail.com>
	<50CE3361.6070008@uni-muenster.de>
Message-ID: <CANtt_hzrsP9kp4cJ79xxn-yJxQM1D3Xn6kzdDyo3LW_YEC5ezg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121216/b35ccafd/attachment.pl>

From r.hijmans at gmail.com  Mon Dec 17 05:25:12 2012
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Sun, 16 Dec 2012 20:25:12 -0800
Subject: [R-sig-Geo] R 3.0.0 and spatial classes
In-Reply-To: <50CE029A.8010604@uni-muenster.de>
References: <CANVKczMNHVLV1TQVhaopZceWnteaQ_2-N1LO0Tp5_5Y-L7ZXSA@mail.gmail.com>
	<50CE029A.8010604@uni-muenster.de>
Message-ID: <CANtt_hzUbT1W8rQ88v0xmGE-H2nWBnvVtnGXQwgK_2jU_Rq5Dw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121216/f72ade68/attachment.pl>

From r.hijmans at gmail.com  Mon Dec 17 05:57:06 2012
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Sun, 16 Dec 2012 20:57:06 -0800
Subject: [R-sig-Geo] [raster] How to loop extract function?
In-Reply-To: <1355696312037-7581978.post@n2.nabble.com>
References: <1355696312037-7581978.post@n2.nabble.com>
Message-ID: <CANtt_hzmR5-hffE=0_uNst72mz1zjAAN+Wi-moadFy-Bv=sM6Q@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121216/ad3c6340/attachment.pl>

From r.hijmans at gmail.com  Mon Dec 17 07:32:38 2012
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Sun, 16 Dec 2012 22:32:38 -0800
Subject: [R-sig-Geo] rasterize func: polygon values to raster cells -
 error msg
In-Reply-To: <50C98A05.6020603@ebc.uu.se>
References: <50C98A05.6020603@ebc.uu.se>
Message-ID: <CANtt_hxrq7n3T-eeLAXfRNxpb6=N6payaBqdM7owRWu--irvww@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121216/d5b4b2eb/attachment.pl>

From b.rowlingson at lancaster.ac.uk  Mon Dec 17 10:14:15 2012
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Mon, 17 Dec 2012 09:14:15 +0000
Subject: [R-sig-Geo] R 3.0.0 and spatial classes
In-Reply-To: <76d2f75a31e04ec7b65d860a5fe00eb2@EX-0-HT0.lancs.local>
References: <CANVKczMNHVLV1TQVhaopZceWnteaQ_2-N1LO0Tp5_5Y-L7ZXSA@mail.gmail.com>
	<50CE029A.8010604@uni-muenster.de>
	<76d2f75a31e04ec7b65d860a5fe00eb2@EX-0-HT0.lancs.local>
Message-ID: <CANVKczMn+deexo0JZKZWzkKU=2u9uo=ZM+rSeX7gC0OZ2booJQ@mail.gmail.com>

On Mon, Dec 17, 2012 at 4:25 AM, Robert J. Hijmans <r.hijmans at gmail.com> wrote:
> Barry,
> Interesting idea. The proj4string discussion is good, but somewhat trivial;
> a major R release merits more than that. Are there bigger things to be done?
> How about a redesign of sp to accommodate objects that have data on disk (in
> a database, wherever) both for raster and points/lines/polys. I.e. that is a
> design where  having all values in a data.frame memory is a special case
> (but packages may require that to be possible); and such a change need not
> break any, or not much, code in other packages.

 Ha! And we come back round to my 'rmap' package from ~8 years ago! It
was a bunch of simple methods on spatial data where the objects
inherited from 'rmap' and a class like 'shapefile' or (potentially)
'postgis' so that when data was required it was gotten using an
appropriate method. The objects themselves didn't actually store any
data (I think now I'd make 'sp' one of the child classes for objects
all stored in memory).

I'd be very keen on something that would make it easier to work with
PostGIS data in this way, certainly...

> Add perhaps a few other
> things, such as matching holes to polygon-parts; rename the proj4string slot
> to something appropriate; change the bbox from a matrix to an Extent (or
> similar) object.

 Definitely +1 on the bbox->Extent thing. I hate bboxes :)

> Perhaps too much work for little gain? Focus on new things? I thought that
> attempt to clean topologies you were working on a while ago would be great
> to wrap up and package.

Was that some hacky thing I was doing with lines, or was I talking
about the pprepair code for cleaning planar polygon partitions? An R
interface to pprepair would be very nice.

Barry


From b.rowlingson at lancaster.ac.uk  Mon Dec 17 10:24:10 2012
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Mon, 17 Dec 2012 09:24:10 +0000
Subject: [R-sig-Geo] R 3.0.0 and spatial classes
In-Reply-To: <5ad16978ae4c4b1a80b046ef0a55511f@EX-0-HT0.lancs.local>
References: <CANVKczMNHVLV1TQVhaopZceWnteaQ_2-N1LO0Tp5_5Y-L7ZXSA@mail.gmail.com>
	<c3299e85897d45c289bed3a77c6b9915@EX-0-HT0.lancs.local>
	<CANVKczNuA0s0wUed4-TNCbPpFE4m9LL0gS7dPbmcRim=f-e0Ng@mail.gmail.com>
	<5ad16978ae4c4b1a80b046ef0a55511f@EX-0-HT0.lancs.local>
Message-ID: <CANVKczNFSe=Qx1b7o+7Oj1NxFdQGdzBSf_GnfdKbPSz0y8Ucww@mail.gmail.com>

On Mon, Dec 17, 2012 at 4:05 AM, Robert J. Hijmans <r.hijmans at gmail.com> wrote:

>

>> that would allow the possible use of other reference system specs, e.g.
>>
>> CRS(foo) = wktProj('GEOGCS["WGS 84".... etc]')
>
>
> That is a transformation, so I would think:
>
>  foo = spTransform('GEOGCS["WGS 84".... etc]')
>
> and foo could be either of class 'character' (a.k.a. a proj4-string) or an
> object of class CRS
>

Not sure I get you here. There's more than one way to specify a
coordinate reference system than the Proj4 string. For example, if I
wanted to set the CRS of an object to be the same as that in a
Shapefile's .prj file I would have to load the shapefile into an SP
object and get the object's proj4string. Much nicer would be if I
could do something like:

setCRS(foo) = shapefileProj("foo.prj")

Where the shapefileProj function returns a CRS object from the file.
If there's an easy way of converting that to a Proj4 string, then
shapefileProj would do that and return an object of class
c("CRS","proj4"), otherwise it would be c("CRS","shpprj") and code
using it would scream if if didn't have a method that could deal with
that class.

The spatialreference.org site has over a dozen formats for each
reference spec (many of which are perhaps trivially translatable
between) but it might be nice to have code that could handle more than
just proj4 formats...


Barry


From Roger.Bivand at nhh.no  Mon Dec 17 11:23:50 2012
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 17 Dec 2012 11:23:50 +0100
Subject: [R-sig-Geo] R 3.0.0 and spatial classes
In-Reply-To: <CANVKczMNHVLV1TQVhaopZceWnteaQ_2-N1LO0Tp5_5Y-L7ZXSA@mail.gmail.com>
References: <CANVKczMNHVLV1TQVhaopZceWnteaQ_2-N1LO0Tp5_5Y-L7ZXSA@mail.gmail.com>
Message-ID: <alpine.LRH.2.02.1212171109450.30951@reclus.nhh.no>

On Sun, 16 Dec 2012, Barry Rowlingson wrote:

> There's been an announcement that the next version of R will be called
> 3.0.0. Although not a massive change (compared to Python 2.x and 3.x,
> or Perl 4 to Perl 5),

While I won't comment on the ideas discussed in this thread (now), I think 
that it is worth noting that the 2.15 -> 3.0 is no more than the Linux 
kernel shift to 3.*, there were simply getting to be too many minor 
versions in a system that had migrated a long way from 2.0.

One set of 2/3 changes has already been addressed. It is crucial to 
maintaining stability in R, and imposes a ban on calling compiled code 
across contributed package boundaries. We recently saw an example between 
rgdal and raster, where my changing the number of arguments passed to a C 
function in rgdal broke raster, which was calling directly to rgdal. All 
the rgdal C functions called from raster now have R wrappers, so that 
raster can call them safely. There are very many cases like this across 
package-sphere, and they make the maintenance of CRAN hard. It is in these 
kinds of developer-facing issues that we'll see differences, not in 
user-facing R.

The distinction between user and developer should however be tempered; I 
personally find user's wishes frustrating (sometimes very frustrating). If 
users have wishes, then the first alternative should be to try to 
contribute something better, preferably in terms of working code. Once the 
user has established that things aren't so obvious, and/or involve design 
choices, any dialogue becomes more fruitful. "Simple" in a non-simple 
conceptual setting is not necessarily as simple as it sounds, in my 
experience.

Hope this clarifies,

Roger

> it might be a good opportunity to revise all the
> spatial classes in order to:
>
> * clear out any cruft
> * remove any inconsistencies
> * add some new functionality
> * unify across spatial packages
>
> The first thing that springs to mind, for example, is getting sp and
> raster to use the same functions for coordinate reference system
> processing. Doubtless there are other opprtunities for synergy...
>
> Yes, this may well break existing code, but if R is going to jump
> from 2 to 3 then that will break existing code too.
>
> Your ponderances, please...
>
> Barry
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From sophie.padie at gmail.com  Mon Dec 17 15:22:59 2012
From: sophie.padie at gmail.com (=?ISO-8859-1?Q?Sophie_Padi=E9?=)
Date: Mon, 17 Dec 2012 15:22:59 +0100
Subject: [R-sig-Geo] Intersection between two SpatialPolygonsDataFrame using
 gIntersection function in R
Message-ID: <CAECAxeya88VRY1u3ZKRas2haJM9vYsC5hJc0fwXyf2PyfPQ6LA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121217/d1c42d8d/attachment.pl>

From carstennh at aol.com  Mon Dec 17 18:19:41 2012
From: carstennh at aol.com (Carsten Neumann)
Date: Mon, 17 Dec 2012 18:19:41 +0100
Subject: [R-sig-Geo] chull function behavior
In-Reply-To: <1543835.q8T5tTsb65@lujola>
References: <50C9F683.3060809@aol.com> <1543835.q8T5tTsb65@lujola>
Message-ID: <50CF542D.10404@aol.com>

Dear Lukas,

very great thanks for your suggestion. Your example code works well in 
defining the convex upper hull as in CLARK et al. 1987 - "Automatic 
continuum analysis of reflectance spectra. I will work further to 
implement this into future R functionality.

Best

Carsten

On 12/13/2012 04:51 PM, Lukas Lehnert wrote:
> Dear Carsten,
>
> the function chull finds the hull of a curve, which consists of the upper and
> the lower part of the hull. In your case, you might be only interested in the
> upper part. You can extract this with the following commands:
>      c.hull <- chull(y)
>      c.hull <- c.hull[(which(c.hull == 1):length(c.hull))]
>      c.hull <- sort(c.hull)
>
> The calculation of the hull can be performed by:
>      hull[i,] <- approx(x=x[c.hull],y=y[i,c.hull], xout = x,method = "linear",
> ties = "mean")$y
>
> Best regards
>
> Lukas Lehnert
>
> Am Donnerstag, 13. Dezember 2012, 16:38:43 schrieb Carsten Neumann:
>> Dear List members,
>>
>> sorry for the non specific geo question, but working with image spectra
>> led me to the following problem calculating a convex upper hull curve
>> using the function "chull {grDevices}".
>>
>> Imaging there is a image spectra that you need to normalize using
>> continuum removal (deviding spectra by upper hull), then you do not
>> expect values greater than 1. Unfortunately the "chull()" functions did
>> not identify all points of intersection on a hull curve. At the
>> beginning there are also points beneath a hull, see example data (first
>> 3 points).
>>
>> ############################################################################
>> ################################# wavelength<-seq(350,449,1)
>> dummy<-c(0.204054, 0.204828, 0.204161, 0.202444, 0.199883, 0.200960,
>> 0.203838, 0.205723,
>>    0.203404, 0.204835, 0.207257, 0.205682, 0.209670, 0.212622, 0.212032,
>> 0.211062,
>>    0.212727, 0.215129, 0.216259, 0.217435, 0.218270, 0.219039, 0.220333,
>> 0.222520,
>>    0.223502, 0.223225, 0.225050, 0.225485, 0.226832, 0.230962, 0.231891,
>> 0.231264,
>>    0.231170, 0.233540, 0.235799, 0.238165, 0.240494, 0.240793, 0.242218,
>> 0.244078,
>>    0.244795, 0.246343, 0.247142, 0.247406, 0.249348, 0.250772, 0.251937,
>> 0.253166,
>>    0.253301, 0.253941, 0.255231, 0.256503, 0.257881, 0.258632, 0.258916,
>> 0.260414,
>>    0.261584, 0.262598, 0.263891, 0.264702, 0.265681, 0.266892, 0.267861,
>> 0.268923,
>>    0.270050, 0.271112, 0.271767, 0.273130, 0.274604, 0.275065, 0.276157,
>> 0.277331,
>>    0.278321, 0.279585, 0.280577, 0.281469, 0.282497, 0.283157, 0.284381,
>> 0.285984,
>>    0.286866, 0.288173, 0.289387, 0.290084, 0.290770, 0.291659, 0.292730,
>> 0.293823,
>>    0.294841, 0.295763, 0.296607, 0.297420, 0.298529, 0.299691, 0.300580,
>> 0.301300,
>>    0.302290, 0.303378, 0.303885, 0.304686)
>>
>> id<-sort(chull(wavelength, dummy))
>> plot(wavelength,dummy,type="l")
>> points(wavelength[id],dummy[id],type="p",col="red")
>> ############################################################################
>> ################################# Can anybody explain this behavior or give
>> some advice on improving functionality?
>>
>> Thanks in advance!
>>
>> Best
>>
>> Carsten
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 

Carsten Neumann
Telegrafenberg, A 17 01.13
14473 Potsdam
-------------------------------------------------------
Helmholtz Centre Potsdam
GFZ German Research Centre for Geosciences
Department 1 - Section 1.4 - Remote Sensing
-------------------------------------------------------
Tel.: +49 (0) 331 288 1766
e-mail: carstenn at gfz-potsdam.de


From carstennh at aol.com  Mon Dec 17 18:21:15 2012
From: carstennh at aol.com (Carsten Neumann)
Date: Mon, 17 Dec 2012 18:21:15 +0100
Subject: [R-sig-Geo] chull function behavior
In-Reply-To: <1543835.q8T5tTsb65@lujola>
References: <50C9F683.3060809@aol.com> <1543835.q8T5tTsb65@lujola>
Message-ID: <50CF548B.40803@aol.com>

Dear Lukas,

very great thanks for your suggestion. Your example code works well in 
defining the convex upper hull as in CLARK et al. 1987 - "Automatic 
continuum analysis of reflectance spectra. I will work further to 
implement this into future R functionality.

Best

Carsten

On 12/13/2012 04:51 PM, Lukas Lehnert wrote:
> Dear Carsten,
>
> the function chull finds the hull of a curve, which consists of the upper and
> the lower part of the hull. In your case, you might be only interested in the
> upper part. You can extract this with the following commands:
>      c.hull <- chull(y)
>      c.hull <- c.hull[(which(c.hull == 1):length(c.hull))]
>      c.hull <- sort(c.hull)
>
> The calculation of the hull can be performed by:
>      hull[i,] <- approx(x=x[c.hull],y=y[i,c.hull], xout = x,method = "linear",
> ties = "mean")$y
>
> Best regards
>
> Lukas Lehnert
>
> Am Donnerstag, 13. Dezember 2012, 16:38:43 schrieb Carsten Neumann:
>> Dear List members,
>>
>> sorry for the non specific geo question, but working with image spectra
>> led me to the following problem calculating a convex upper hull curve
>> using the function "chull {grDevices}".
>>
>> Imaging there is a image spectra that you need to normalize using
>> continuum removal (deviding spectra by upper hull), then you do not
>> expect values greater than 1. Unfortunately the "chull()" functions did
>> not identify all points of intersection on a hull curve. At the
>> beginning there are also points beneath a hull, see example data (first
>> 3 points).
>>
>> ############################################################################
>> ################################# wavelength<-seq(350,449,1)
>> dummy<-c(0.204054, 0.204828, 0.204161, 0.202444, 0.199883, 0.200960,
>> 0.203838, 0.205723,
>>    0.203404, 0.204835, 0.207257, 0.205682, 0.209670, 0.212622, 0.212032,
>> 0.211062,
>>    0.212727, 0.215129, 0.216259, 0.217435, 0.218270, 0.219039, 0.220333,
>> 0.222520,
>>    0.223502, 0.223225, 0.225050, 0.225485, 0.226832, 0.230962, 0.231891,
>> 0.231264,
>>    0.231170, 0.233540, 0.235799, 0.238165, 0.240494, 0.240793, 0.242218,
>> 0.244078,
>>    0.244795, 0.246343, 0.247142, 0.247406, 0.249348, 0.250772, 0.251937,
>> 0.253166,
>>    0.253301, 0.253941, 0.255231, 0.256503, 0.257881, 0.258632, 0.258916,
>> 0.260414,
>>    0.261584, 0.262598, 0.263891, 0.264702, 0.265681, 0.266892, 0.267861,
>> 0.268923,
>>    0.270050, 0.271112, 0.271767, 0.273130, 0.274604, 0.275065, 0.276157,
>> 0.277331,
>>    0.278321, 0.279585, 0.280577, 0.281469, 0.282497, 0.283157, 0.284381,
>> 0.285984,
>>    0.286866, 0.288173, 0.289387, 0.290084, 0.290770, 0.291659, 0.292730,
>> 0.293823,
>>    0.294841, 0.295763, 0.296607, 0.297420, 0.298529, 0.299691, 0.300580,
>> 0.301300,
>>    0.302290, 0.303378, 0.303885, 0.304686)
>>
>> id<-sort(chull(wavelength, dummy))
>> plot(wavelength,dummy,type="l")
>> points(wavelength[id],dummy[id],type="p",col="red")
>> ############################################################################
>> ################################# Can anybody explain this behavior or give
>> some advice on improving functionality?
>>
>> Thanks in advance!
>>
>> Best
>>
>> Carsten
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 

Carsten Neumann
Telegrafenberg, A 17 01.13
14473 Potsdam
-------------------------------------------------------
Helmholtz Centre Potsdam
GFZ German Research Centre for Geosciences
Department 1 - Section 1.4 - Remote Sensing
-------------------------------------------------------
Tel.: +49 (0) 331 288 1766
e-mail: carstenn at gfz-potsdam.de


From etiennebr at gmail.com  Mon Dec 17 22:06:56 2012
From: etiennebr at gmail.com (Etienne B. Racine)
Date: Mon, 17 Dec 2012 16:06:56 -0500
Subject: [R-sig-Geo] 3D (xyzm) SpatialLines in R
In-Reply-To: <1278579649-1355268926-cardhu_decombobulator_blackberry.rim.net-959271261-@b1.c3.bise6.blackberry>
References: <1278579649-1355268926-cardhu_decombobulator_blackberry.rim.net-959271261-@b1.c3.bise6.blackberry>
Message-ID: <CALjAYt7o6HkyNzd5CL+zV8V8K+yPVLHaAYpuotTbxv7BgGx8aA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121217/9d8fcbc9/attachment.pl>

From Roger.Bivand at nhh.no  Tue Dec 18 09:13:48 2012
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 18 Dec 2012 09:13:48 +0100
Subject: [R-sig-Geo] Intersection between two SpatialPolygonsDataFrame
 using gIntersection function in R
In-Reply-To: <CAECAxeya88VRY1u3ZKRas2haJM9vYsC5hJc0fwXyf2PyfPQ6LA@mail.gmail.com>
References: <CAECAxeya88VRY1u3ZKRas2haJM9vYsC5hJc0fwXyf2PyfPQ6LA@mail.gmail.com>
Message-ID: <alpine.LRH.2.02.1212180851120.3667@reclus.nhh.no>

On Mon, 17 Dec 2012, Sophie Padi? wrote:

> Dear subscribers,
>
> After a quick search on the net and on this mailing list, I didn't find any
> solution, so I hope my question won't be that trivial.
>
> I want to select a subset of a map (a SpatialPolygonsDataFrame) to create a
> new vector map = a part of the initial map included inside a given polygon
> (eventually, inside several polygons). I have a large study area, under the
> object "parcel", and would like to select the part of the map inside the
> polygon "hr_kud". This is basically the part of my study area used by an
> animal, so I want to compute basic statistics on this new map and to use it
> for new analyses (of habitat selection). I have to repeat this operation
> for about 100 animals...
>
> Here are my data : http://dl.free.fr/vX4TA8nsE
>
> *parcel* = my study area map. and *hr_kud* = an example of homerange used
> to reduce the study area
>
> Here is a part of my R code, used under Rstudio (R version 2.15.2
> (2012-10-26)) :

Never run examples under any IDE, it may only obscure, made worse here by 
posting in HTML (which is not allowed).

>
>> library(rgeos)> load("Data.RData")
>

The problem arises earlier than this. If I tabulate the number of 
characters in the OGC SFS comments of the Polygons objects, I see:

res <- sapply(slot(parcel, "polygons"), comment)
any(is.null(res))

# [1] FALSE

table(sapply(res, nchar))

#    0     1     3     5     7     9    11    13
#   31 19673   299    49    12     2     2     1

and:

parcel1 <- parcel[-odd,]
gIsValid(parcel1)

# Error in createPolygonsComment(p) :
#  rgeos_PolyCreateComment: orphaned hole, cannot find containing polygon 
#  for hole at index 3

So there are problems in the creation of parcel, and these are leading to 
the crash in rgeos (empty assigned comment strings; they are NULL if not 
assigned). So you need to specify the antecedents of parcel - as well, of 
course, as reporting the output of sessionInfo() - including all the 
packages used for creating the damaged object, and the complete startup 
message of rgeos (and rgdal if implicated).

I'll add code to guard against attempts to use empty comment strings, but 
it would be very helpful to establish where they came from (rgdal?).

In addition to these issues, parcel has further topology issues.

A fix is to use the hole analysis wrapper in maptools, which uses rgeos to 
try to correct wrong hole assignments, also correcting the damaged 
comments:

library(maptools)
pls <- slot(parcel, "polygons")
pls1 <- sapply(pls, checkPolygonsHoles)
slot(parcel, "polygons") <- pls1
res <- sapply(slot(parcel, "polygons"), comment)
table(sapply(res, nchar))

#     1     3     5     7     9    11    13
# 19701   302    49    12     2     2     1

gIsValid(parcel)
# [1] TRUE
hr_map <- gIntersection(parcel, hr_kud, byid=TRUE)
# Warning message:
# In RGEOSBinTopoFunc(spgeom1, spgeom2, byid, id, "rgeos_intersection") :
#   spgeom1 and spgeom2 have different proj4 strings

which runs to completion with no problems; you could remove the warning in 
the obvious way, the CRS are:

[1] " +proj=lcc +lat_1=46.8 +lat_0=46.8 +lon_0=2.337229166666667 
+k_0=0.99987742 +x_0=600000 +y_0=2200000 +a=6378249.2 +b=6356514.999904194 
+units=m +no_defs"

[1] " +init=epsg:27572 +proj=lcc +lat_1=46.8 +lat_0=46.8 +lon_0=0 
+k_0=0.99987742 +x_0=600000 +y_0=2200000 +a=6378249.2 +b=6356515 
+towgs84=-168,-60,320,0,0,0,0 +pm=paris +units=m +no_defs"

which are almost the same, but are not string-identical.

Hope this helps,

Roger

>
>> class(parcel)[1] "SpatialPolygonsDataFrame"
> attr(,"package")
> [1] "sp"
>
>> head(parcel)  AREAHA RECNO      AREA AREASQKM        OS_06 GRD_CAT_06
> 0 0.0519     0  519.1941        0 chemin prive        way
> 1 0.0127     1  127.0963        0 chemin prive        way
> 2 0.0596     2  596.2204        0 chemin prive        way
> 3 0.0248     3  248.0452        0    route D90        way
> 4 0.0375     4  375.0141        0 route privee        way
> 5 0.1260     5 1260.3941        0 chemin prive        way
>
>> dim(parcel) [1] 20069 7 > class(hr_kud) [1] "SpatialPolygonsDataFrame"
> attr(,"package") [1] "sp" > object.size(hr_kud) 9536 bytes >
> object.size(parcel)
> 88250824 bytes
>
>
>
> And when I run my final command, it causes Rstudio to crash :
>
>> hr_map <- gIntersection(parcel, hr_kud, byid=TRUE)
>
>
>
> It is not the first crash reported, but none of the answers find on the net
> are efficient for me... It's exactly the same using R or Rstudio and all my
> packages are updated.
>
> So If you have any idea of why it's crashing, or of an alternative method
> to create my subset map or to intersect two SpatialPolygonsDataFrame in R,
> It will be really appreciated !
>
> thanks in advance,
> Sophie
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From Roger.Bivand at nhh.no  Tue Dec 18 10:53:13 2012
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 18 Dec 2012 10:53:13 +0100
Subject: [R-sig-Geo] small improvement for saveDataset() in rgdal
In-Reply-To: <87pq2cmj9v.fsf@kolob.subpolar.dyndns.org>
References: <87pq2cmj9v.fsf@kolob.subpolar.dyndns.org>
Message-ID: <alpine.LRH.2.02.1212181051200.3667@reclus.nhh.no>

Seb,

Thanks for a helpful example and patch - committed in SVN revision 411.

Best wishes,

Roger

On Fri, 14 Dec 2012, Sebastian P. Luque wrote:

> Hi,
>
> Some time ago I spent several hours trying to figure out why the
> following was failing?:
>
> library(rgdal); library(adehabitatHR)
> data(puechabonsp)
> locs <- puechabonsp$relocs
> ## Estimation of UD for four animals
> (ud <- kernelUD(locs[, 1]))
> locs.gtiff <- create2GDAL(ud[[1]],
>                          drivername="GTiff")
> locs.aaigrid <- copyDataset(locs.gtiff,
>                            driver="AAIGrid")
> saveDataset(locs.aaigrid, "~/tmp/test.asc")
>
> which prints this:
>
> Error in .local(.Object, ...) : Dataset copy failed
>
> finding that this resulted from failure to expand the 'filename'
> argument in saveDataset().  Would it make sense to patch this function
> with:
>
> ---<--------------------cut here---------------start------------------->---
> *** /home/sluque/Scripts/R/src/rgdal/R/gdal.R	2012-12-14 15:05:25.000000000 -0600
> --- /home/sluque/Scripts/R/src/gdal.R	2012-12-14 15:05:11.000000000 -0600
> ***************
> *** 217,223 ****
>    new.obj <- new(new.class,
>                   handle = .Call('RGDAL_CopyDataset',
>                     dataset, getDriver(dataset),
> !                    FALSE, options, filename, PACKAGE="rgdal"))
>
>    if (returnNewObj) return(new.obj)
>    invisible(GDAL.close(new.obj))
> --- 217,223 ----
>    new.obj <- new(new.class,
>                   handle = .Call('RGDAL_CopyDataset',
>                     dataset, getDriver(dataset),
> !                    FALSE, options, normalizePath(filename), PACKAGE="rgdal"))
>
>    if (returnNewObj) return(new.obj)
>    invisible(GDAL.close(new.obj))
> ---<--------------------cut here---------------end--------------------->---
>
> ?  It tests fine on my system:
>
> R> sessionInfo()
> R version 2.15.2 (2012-10-26)
> Platform: x86_64-pc-linux-gnu (64-bit)
>
> locale:
> [1] LC_CTYPE=en_CA.UTF-8       LC_NUMERIC=C               LC_TIME=en_CA.UTF-8        LC_COLLATE=en_CA.UTF-8     LC_MONETARY=en_CA.UTF-8    LC_MESSAGES=en_CA.UTF-8 
> [7] LC_PAPER=C                 LC_NAME=C                  LC_ADDRESS=C               LC_TELEPHONE=C             LC_MEASUREMENT=en_CA.UTF-8 LC_IDENTIFICATION=C 
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base 
>
> other attached packages:
> [1] adehabitatHR_0.4.4  adehabitatLT_0.3.7  CircStats_0.2-4     boot_1.3-7          MASS_7.3-22         adehabitatMA_0.3.4  ade4_1.5-1          deldir_0.0-21       rgdal_0.7-25 
> [10] sp_1.0-2            slmisc_0.9.3        latticeExtra_0.6-24 RColorBrewer_1.0-5  lattice_0.20-10 
>
> loaded via a namespace (and not attached):
> [1] compiler_2.15.2 grid_2.15.2     tools_2.15.2 
>
>
> Cheers,
>
> --
> Seb
>
> ? https://stat.ethz.ch/pipermail/r-sig-ecology/2012-March/002895.html
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From samanmonfared1 at gmail.com  Tue Dec 18 15:56:31 2012
From: samanmonfared1 at gmail.com (Saman Monfared)
Date: Tue, 18 Dec 2012 18:26:31 +0330
Subject: [R-sig-Geo] Help for spdep package
Message-ID: <CAOytA4YkNG732zfW9aQZjuf8AL4nbNM1apYG2hPcGNmdpuPTHw@mail.gmail.com>

Dear all.
I try to fit conditional auto regressive models (CAR and  SAR) in package spdep.
Also, I have fitted some other models like GLM, Empirical Bayes and ...

My program to CAR and SAR is:

esar1f1 <- spautolm(IMR.m~ 0+PCFP+Sup+B.F,data =data1,
 listw=nb2listw(nb6, style="W"), family="SAR", method="full", verbose=TRUE)

summary(esar1f1)

esar1f2 <- spautolm(IMR.m~ 0+PCFP+Sup+B.F,data =data1,
listw=nb2listw(nb6, style="W"), family="CAR", method="full", verbose=TRUE)

> esar1f1

Call:
spautolm(formula = IMR.m ~ 0 + PCFP + Sup + B.F, data = data1,
    listw = nb2listw(nb6, style = "W"), family = "SAR", method = "full",
    verbose = TRUE)

Coefficients:
      PCFP        Sup        B.F     lambda
 0.1711382 -0.2262700  0.2414336 -1.7946991

Log likelihood: -56.24405


What is lambda?? I couldn't find a good refrences to understand tese model!!!
How can I predict this model for new data??
How can I cross validate results of CAR and SAR??

-- 
Saman Monfared
Msc, Department of Statistics, Shiraz University,
Shiraz 71454, Iran
Email: Samanmonfared1 at gmail.com

Tel: +98 917 5305167


From samanmonfared1 at gmail.com  Tue Dec 18 16:06:08 2012
From: samanmonfared1 at gmail.com (Saman Monfared)
Date: Tue, 18 Dec 2012 18:36:08 +0330
Subject: [R-sig-Geo] Help for spdep package
Message-ID: <CAOytA4a5tfL=zHfzTuosDKkpu1B1RitDSOa3cH5EL25c42NJmw@mail.gmail.com>

Dear all.
I try to fit CAR and SAR model.
I have fitted these model by spatulm but I don't understand the mean
of lambda???
I couldn't find good renascences to distinct the difference between SAR and CAR.
What is the difference between BYM and CAR model??
Hw can I predict results of spatulm for new data??
Thanks.

-- 
Saman Monfared
Msc, Department of Statistics, Shiraz University,
Shiraz 71454, Iran
Email: Samanmonfared1 at gmail.com

Tel: +98 917 5305167


From Roger.Bivand at nhh.no  Tue Dec 18 16:06:29 2012
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 18 Dec 2012 16:06:29 +0100
Subject: [R-sig-Geo] Help for spdep package
In-Reply-To: <CAOytA4YkNG732zfW9aQZjuf8AL4nbNM1apYG2hPcGNmdpuPTHw@mail.gmail.com>
References: <CAOytA4YkNG732zfW9aQZjuf8AL4nbNM1apYG2hPcGNmdpuPTHw@mail.gmail.com>
Message-ID: <alpine.LRH.2.02.1212181601030.4838@reclus.nhh.no>

On Tue, 18 Dec 2012, Saman Monfared wrote:

> Dear all.
> I try to fit conditional auto regressive models (CAR and  SAR) in package spdep.
> Also, I have fitted some other models like GLM, Empirical Bayes and ...
>
> My program to CAR and SAR is:
>
> esar1f1 <- spautolm(IMR.m~ 0+PCFP+Sup+B.F,data =data1,
> listw=nb2listw(nb6, style="W"), family="SAR", method="full", verbose=TRUE)
>
> summary(esar1f1)
>
> esar1f2 <- spautolm(IMR.m~ 0+PCFP+Sup+B.F,data =data1,
> listw=nb2listw(nb6, style="W"), family="CAR", method="full", verbose=TRUE)
>
>> esar1f1
>
> Call:
> spautolm(formula = IMR.m ~ 0 + PCFP + Sup + B.F, data = data1,
>    listw = nb2listw(nb6, style = "W"), family = "SAR", method = "full",
>    verbose = TRUE)
>
> Coefficients:
>      PCFP        Sup        B.F     lambda
> 0.1711382 -0.2262700  0.2414336 -1.7946991
>
> Log likelihood: -56.24405
>
>
> What is lambda?? I couldn't find a good refrences to understand tese model!!!

See the help page (lambda is said to be the ML autoregressive coefficient 
about half way down), and certainly read Waller & Gotway (it may be that 
they term the spatial coefficient rho, but lambda is used here for 
consistency with errorsarlm()).

> How can I predict this model for new data??

There are no predict methods provided - but analysis of the model will 
show that \hat{y} is X \beta, isn't it?

> How can I cross validate results of CAR and SAR??
>

They are not nested processes, but as Clif & Ord, Ripley and the others 
show, a CAR and a SAR may be expressed in terms of one-another.

By the way, your lambda may me maxing out at the bottom of its range, so 
be careful, very strong negative autocorrelation is very unlikely.

Roger

>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From Nathalie.M.Morin at Usherbrooke.ca  Tue Dec 18 16:26:50 2012
From: Nathalie.M.Morin at Usherbrooke.ca (Nathalie Morin)
Date: Tue, 18 Dec 2012 10:26:50 -0500
Subject: [R-sig-Geo] Clip SpatialGridDataFrame with SpatialPolygons
Message-ID: <002201cddd34$19d63900$4d82ab00$@Usherbrooke.ca>

Hello!

 

I have already searched the Forum?s archives and sp documentation, but the
answer is still unclear to this basic question : how can you clip a
SpatialGridDataFrame with a SpatialPolygons and return a new clipped
SpatialGridDataFrame (not a vector !).

 

Here is my data as an example :

 

> summary(D.tls.SPGDF)

Object of class SpatialGridDataFrame

Coordinates:

            min        max

[1,] 828049.000 828191.000

[2,] 101770.000 101915.000

[3,]    321.632    480.632

Is projected: TRUE 

proj4string :

[+init=epsg:27561 +proj=lcc +lat_1=49.50000000000001
+lat_0=49.50000000000001 +lon_0=0

+k_0=0.999877341 +x_0=600000 +y_0=200000 +a=6378249.2 +b=6356515

+towgs84=-168,-60,320,0,0,0,0 +pm=paris +units=m +no_defs]

Grid attributes:

  cellcentre.offset cellsize cells.dim

1        828049.500        1       142

2        101770.500        1       145

3           322.132        1       159

Data attributes:

    Min.  1st Qu.   Median     Mean  3rd Qu.     Max.     NA's 

   0.000    0.000    0.000    0.000    0.000    0.969 6895.000 

 

> summary(g)
Object of class SpatialPolygons
Coordinates:
       min      max
x 828103.9 828133.9
y 101839.3 101869.3
Is projected: TRUE 
proj4string :
[+init=epsg:27561 +proj=lcc +lat_1=49.50000000000001
+lat_0=49.50000000000001 +lon_0=0
+k_0=0.999877341 +x_0=600000 +y_0=200000 +a=6378249.2 +b=6356515
+towgs84=-168,-60,320,0,0,0,0 +pm=paris +units=m +no_defs]

 

If I do :

> o <- overlay(D.tls.SPGDF, g)

R returns a vector 

 

Which is the function that returns the initial object i.e.
SpatialGridDataFrame ?

 

Nathalie

 

Nathalie MORIN

Doctorante en t?l?d?tection foresti?re (Ph.D student in remote sensing
applied to forestry)

Centre d?application et de recherches en t?l?d?tection (CARTEL)

D?partement de G?omatique Appliqu?e

Sherbrooke (QC) CANADA J1K 2R1

T?l. : + 1 (819)  821-8000 #62962

e-mail :  <mailto:Nathalie.M.Morin at Usherbrooke.ca>
Nathalie.M.Morin at Usherbrooke.ca

 <http://www.usherbrooke.ca/> Universit? de Sherbrooke

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121218/6df98714/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/gif
Size: 1245 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121218/6df98714/attachment.gif>

From Nathalie.M.Morin at usherbrooke.ca  Tue Dec 18 16:59:36 2012
From: Nathalie.M.Morin at usherbrooke.ca (Nathalie Morin)
Date: Tue, 18 Dec 2012 07:59:36 -0800 (PST)
Subject: [R-sig-Geo] Clip SpatialGridDataFrame with SpatialPolygons
In-Reply-To: <002201cddd34$19d63900$4d82ab00$@Usherbrooke.ca>
References: <002201cddd34$19d63900$4d82ab00$@Usherbrooke.ca>
Message-ID: <1355846376465-7581999.post@n2.nabble.com>

Hello again,

Actually, I found the answer to my own question :
clip <- D.tls.SPGDF[g,]

The problem is that the coordinates and cells dimension remain unchanged
after the process !?

> summary(clip)
Object of class SpatialGridDataFrame
Coordinates:
            min        max
[1,] 828049.000 828191.000
[2,] 101770.000 101915.000
[3,]    321.632    480.632
Is projected: TRUE 
proj4string :
[+init=epsg:27561 +proj=lcc +lat_1=49.50000000000001
+lat_0=49.50000000000001 +lon_0=0
+k_0=0.999877341 +x_0=600000 +y_0=200000 +a=6378249.2 +b=6356515
+towgs84=-168,-60,320,0,0,0,0 +pm=paris +units=m +no_defs]
Grid attributes:
  cellcentre.offset cellsize cells.dim
1        828049.500        1       142
2        101770.500        1       145
3           322.132        1       159
Data attributes:
     Min.   1st Qu.    Median      Mean   3rd Qu.      Max.      NA's 
      0.0       0.0       0.0       0.0       0.0       0.6 3161825.0 



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Clip-SpatialGridDataFrame-with-SpatialPolygons-tp7581998p7581999.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From edzer.pebesma at uni-muenster.de  Tue Dec 18 17:30:37 2012
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Tue, 18 Dec 2012 17:30:37 +0100
Subject: [R-sig-Geo] Clip SpatialGridDataFrame with SpatialPolygons
In-Reply-To: <1355846376465-7581999.post@n2.nabble.com>
References: <002201cddd34$19d63900$4d82ab00$@Usherbrooke.ca>
	<1355846376465-7581999.post@n2.nabble.com>
Message-ID: <50D09A2D.2070701@uni-muenster.de>



On 12/18/2012 04:59 PM, Nathalie Morin wrote:
> Hello again,
> 
> Actually, I found the answer to my own question :
> clip <- D.tls.SPGDF[g,]

fullgrid(D.tls.SPGDF) = FALSE
clip <- D.tls.SPGDF[g,,drop=TRUE]
# and, if you want:
fullgrid(clip) = TRUE
gridparameters(clip)

> 
> The problem is that the coordinates and cells dimension remain unchanged
> after the process !?
> 
>> summary(clip)
> Object of class SpatialGridDataFrame
> Coordinates:
>             min        max
> [1,] 828049.000 828191.000
> [2,] 101770.000 101915.000
> [3,]    321.632    480.632
> Is projected: TRUE 
> proj4string :
> [+init=epsg:27561 +proj=lcc +lat_1=49.50000000000001
> +lat_0=49.50000000000001 +lon_0=0
> +k_0=0.999877341 +x_0=600000 +y_0=200000 +a=6378249.2 +b=6356515
> +towgs84=-168,-60,320,0,0,0,0 +pm=paris +units=m +no_defs]
> Grid attributes:
>   cellcentre.offset cellsize cells.dim
> 1        828049.500        1       142
> 2        101770.500        1       145
> 3           322.132        1       159
> Data attributes:
>      Min.   1st Qu.    Median      Mean   3rd Qu.      Max.      NA's 
>       0.0       0.0       0.0       0.0       0.0       0.6 3161825.0 
> 
> 
> 
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Clip-SpatialGridDataFrame-with-SpatialPolygons-tp7581998p7581999.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From Nathalie.M.Morin at usherbrooke.ca  Tue Dec 18 19:34:06 2012
From: Nathalie.M.Morin at usherbrooke.ca (Nathalie Morin)
Date: Tue, 18 Dec 2012 10:34:06 -0800 (PST)
Subject: [R-sig-Geo] Clip SpatialGridDataFrame with SpatialPolygons
In-Reply-To: <50D09A2D.2070701@uni-muenster.de>
References: <002201cddd34$19d63900$4d82ab00$@Usherbrooke.ca>
	<1355846376465-7581999.post@n2.nabble.com>
	<50D09A2D.2070701@uni-muenster.de>
Message-ID: <1355855646618-7582001.post@n2.nabble.com>

Eur?ka !



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Clip-SpatialGridDataFrame-with-SpatialPolygons-tp7581998p7582001.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From Gustaf.Granath at ebc.uu.se  Tue Dec 18 19:35:04 2012
From: Gustaf.Granath at ebc.uu.se (Gustaf Granath)
Date: Tue, 18 Dec 2012 19:35:04 +0100
Subject: [R-sig-Geo] rasterize func: polygon values to raster cells -
 error msg
In-Reply-To: <CANtt_hxrq7n3T-eeLAXfRNxpb6=N6payaBqdM7owRWu--irvww@mail.gmail.com>
References: <50C98A05.6020603@ebc.uu.se>
	<CANtt_hxrq7n3T-eeLAXfRNxpb6=N6payaBqdM7owRWu--irvww@mail.gmail.com>
Message-ID: <50D0B758.3040708@ebc.uu.se>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121218/ae889735/attachment.pl>

From samanmonfared1 at gmail.com  Tue Dec 18 20:36:50 2012
From: samanmonfared1 at gmail.com (Saman Monfared)
Date: Tue, 18 Dec 2012 23:06:50 +0330
Subject: [R-sig-Geo] Help for spdep package
Message-ID: <CAOytA4ZMtqYGsp7_G9g=EeQGKwkvuXB7cWs3SwmUz-=c=5iX4g@mail.gmail.com>

Dear All,
 I performed moran I test for all 1-6 neighbors as:

coords<-cbind(data1$x,data1$y)
knn1 <- knearneigh(coords, 1,RANN=F)
knn2 <- knearneigh(coords, 2,RANN=F)
knn3 <- knearneigh(coords, 3,RANN=F)
knn4 <- knearneigh(coords, 4,RANN=F)
knn5 <- knearneigh(coords, 5,RANN=F)
knn6 <- knearneigh(coords, 6,RANN=F)
nb1 <- knn2nb(knn1)
nb2 <- knn2nb(knn2)
nb3 <- knn2nb(knn3)
nb4 <- knn2nb(knn4)
nb5 <- knn2nb(knn5)
nb6 <- knn2nb(knn6)
###### harche mizan p-value kamtar bashad hambastegi bishtar ast
moran.1.m<-moran.test(data1$IMR.m,nb2listw(nb1, style="W"))
moran.2.m<-moran.test(data1$IMR.m,nb2listw(nb2, style="W"))
moran.3.m<-moran.test(data1$IMR.m,nb2listw(nb3, style="W"))
moran.4.m<-moran.test(data1$IMR.m,nb2listw(nb4, style="W"))
moran.5.m<-moran.test(data1$IMR.m,nb2listw(nb5, style="W"))
moran.6.m<-moran.test(data1$IMR.m,nb2listw(nb6, style="W"))

results:
               First        Second        Third       Fourth
Fifth        Sixth
p-value 0.4053004 0.2749966 0.4010877 0.633948 0.7313581 0.9098516

these p-values indicate week spatial correlations.Also I examine other
style ("B","C",..)
In addition the Moran test for residuals of regression model also
indicates week spatial correlation.my data isn't symmetric
neighbors.Can it make a problem?
What is your suggestion?




-- 
Saman Monfared
Msc, Department of Statistics, Shiraz University,
Shiraz 71454, Iran
Email: Samanmonfared1 at gmail.com

Tel: +98 917 5305167


From Tom_Roche at pobox.com  Wed Dec 19 05:15:48 2012
From: Tom_Roche at pobox.com (Tom Roche)
Date: Tue, 18 Dec 2012 23:15:48 -0500
Subject: [R-sig-Geo] problems drawing a world map on a levelplot
Message-ID: <87txri4qyz.fsf@pobox.com>


summary: I've tried several ways to draw wrld_simpl over global data
plotted with rasterVis::levelplot, but keep encountering the same
problem:

- only the eastern hemisphere of the map plots

- the eastern hemisphere of the map overlays the western hemisphere of
  the data

How to fix? or otherwise provide geographical context?

details:

(I'll attempt to produce a "complete, self-contained example" after I
make the code publicly viewable, but for now, I'm hoping the problem is
sufficiently simple to diagnose.)

I have atmospheric data in a netCDF file specifying gas concentrations
over a 3D space with dimensions longitude, latitude, and (vertical)
level, such that

* the horizontal extents are global 

* the vertical coordinates are pressures (specifically hybrid
  sigma-pressure)

package=raster provides very usable API for loading the data into a
RasterBrick, and package=rasterVis makes it relatively easy to levelplot
the data in a single "atmospheric column" with the highest pressures at
the bottom. However I also want to provide some geographic context
(e.g., to overlay the data with national boundaries), and have failed to
date.

I have done this with maptools::wrld_simpl successfully in other
contexts, i.e.,

* loading the data with package=ncdf4 (which is considerably more work)
* converting the data to a data.frame
* lattice::levelplot-ing the data
* lattice::xyplot-ing the map

But when I do

data(wrld_simpl)
global.raster <- brick(in.fp, varname=data.var.name)
layers.n <- nbands(global.raster)
global.data.df <- as.data.frame(global.raster)
# some twiddling of names(global.data.df) omitted
global.map <- map('world', plot=FALSE)
global.map.df <- data.frame(lon=global.map$x, lat=global.map$y)
pdf(file=pdf.fp, width=5, height=100)
# using rasterVis::levelplot, not lattice::levelplot
levelplot(global.raster,
  margin=FALSE,
  names.attr=names(global.data.df),
  layout=c(1,layers.n), # all layers in one "atmospheric column"
) + xyplot(lat ~ lon, global.map.df, type='l', lty=1, lwd=1, col='black')
dev.off()

the data plots apparently correctly, but the map plots incorrectly, as
shown by this .png of the top level:

https://docs.google.com/open?id=0BzDAFHgIxRzKOVdlSDFMR29BdWM

As noted above, the map's eastern hemisphere overlays the data's western
hemisphere, and nothing overlays the data's eastern hemisphere.

I tried several variations on the above, but either got the same
results, or outright error. (Unfortunately the error messages are often
printed on the levelplot, but the messages are truncated (so they can't
be understood), and it's annoying to "fail slow" (after waiting for a
long plot to finish).) So after some research I sought to emulate the
means recommended @

http://rastervis.r-forge.r-project.org/#levelplot

data(wrld_simpl)
global.raster <- brick(in.fp, varname=data.var.name)
layers.n <- nbands(global.raster)
global.data.df <- as.data.frame(global.raster)
# some twiddling of names(global.data.df) omitted
global.map.proj <- CRS('+proj=latlon +ellps=WGS84')
global.map <- map('world', plot=FALSE)
global.map.shp <- map2SpatialLines(global.map, proj4string=global.map.proj)
pdf(file=pdf.fp, width=5, height=100)
# using rasterVis::levelplot, not lattice::levelplot
levelplot(global.raster,
  margin=FALSE,
  names.attr=names(global.data.df),
  layout=c(1,layers.n), # all layers in one "atmospheric column"
) + layer(sp.lines(global.map.shp, lwd=0.8, col='darkgray'))
dev.off()

This also fails, and very similarly (though the line colors differ). See
this .png:

https://docs.google.com/open?id=0BzDAFHgIxRzKYzd6cVB2TDE4RE0

I'm guessing I can either do something simple to wrld_simpl's longitude
values, or Something Completely Different that would Just Work Better,
but don't know. Your assistance is appreciated.

TIA, Tom Roche <Tom_Roche at pobox.com>


From mdsumner at gmail.com  Wed Dec 19 05:54:25 2012
From: mdsumner at gmail.com (Michael Sumner)
Date: Tue, 18 Dec 2012 20:54:25 -0800
Subject: [R-sig-Geo] problems drawing a world map on a levelplot
In-Reply-To: <87txri4qyz.fsf@pobox.com>
References: <87txri4qyz.fsf@pobox.com>
Message-ID: <CAAcGz98tv8AR1B1Maa6m8W+QJnzGZ90Lt4VUgoPajyJcb3_6nQ@mail.gmail.com>

I happened to write this yesterday, which switches the parts of
wrld_simpl from < 0 longitude to the east (Pacific view). I haven't
investigated what you need in detail, so just ignore if I'm off track.

It's not careful about data or anything, since all I needed was the
raw geometry. It might be of use. "xrange" here can be anything from
[-180, 360] though it's really assuming you don't traverse more than
360 in total.

It would be nice to carefully clean up a copy of wrld_simpl like this
and make a wrld_simpl version like the maps package has.

Cheers, Mike.


xrange <- c(140, 250)
##xrange <- c(0, 360)
yrange <- c(-60, 20)

require(maptools)
require(raster)
require(rgeos)



    ext <- extent(xrange[1], xrange[2], yrange[1], yrange[2])
    data(wrld_simpl, package = "maptools")
    if (xrange[2] > 180.0) {

        eastrange <- c(xrange[1], 180.0)
        westrange <- c(-180.0, xrange[2] - 360)

        ew <- extent(westrange[1], westrange[2], yrange[1], yrange[2])
        ee <- extent(eastrange[1], eastrange[2], yrange[1], yrange[2])

        geome <- as(ee, "SpatialPolygons")
        geomw <- as(ew, "SpatialPolygons")

        ## why does this get dropped?
        proj4string(geome) <- CRS(proj4string(wrld_simpl))
        proj4string(geomw) <- CRS(proj4string(wrld_simpl))

        worlde <- gIntersection(wrld_simpl, geome)
        worldw <- gIntersection(wrld_simpl, geomw)
        worldw <- elide(worldw, shift = c(360.0, 0.0))

        proj4string(worldw) <- CRS(proj4string(wrld_simpl))

        dfe <- data.frame(x = seq_len(length(worlde at polygons)))
        dfw <- data.frame(x = seq_len(length(worldw at polygons)))
        rownames(dfw) <- as.character(as.numeric(rownames(dfe)) + nrow(dfe))

        worlde <- SpatialPolygonsDataFrame(worlde, dfe, match.ID = FALSE)
        worldw <- SpatialPolygonsDataFrame(worldw, dfw, match.ID = FALSE)
        worldw <- spChFIDs(worldw, rownames(dfw))

        world <- spRbind(worlde, worldw)

    } else {

        geom <- as(ext, "SpatialPolygons")
        proj4string(geom) <- CRS(proj4string(wrld_simpl))
        ## TODO: make this spdf if needed
        world <- gIntersection(wrld_simpl, geom)
    }


plot(world)



On Tue, Dec 18, 2012 at 8:15 PM, Tom Roche <Tom_Roche at pobox.com> wrote:
>
> summary: I've tried several ways to draw wrld_simpl over global data
> plotted with rasterVis::levelplot, but keep encountering the same
> problem:
>
> - only the eastern hemisphere of the map plots
>
> - the eastern hemisphere of the map overlays the western hemisphere of
>   the data
>
> How to fix? or otherwise provide geographical context?
>
> details:
>
> (I'll attempt to produce a "complete, self-contained example" after I
> make the code publicly viewable, but for now, I'm hoping the problem is
> sufficiently simple to diagnose.)
>
> I have atmospheric data in a netCDF file specifying gas concentrations
> over a 3D space with dimensions longitude, latitude, and (vertical)
> level, such that
>
> * the horizontal extents are global
>
> * the vertical coordinates are pressures (specifically hybrid
>   sigma-pressure)
>
> package=raster provides very usable API for loading the data into a
> RasterBrick, and package=rasterVis makes it relatively easy to levelplot
> the data in a single "atmospheric column" with the highest pressures at
> the bottom. However I also want to provide some geographic context
> (e.g., to overlay the data with national boundaries), and have failed to
> date.
>
> I have done this with maptools::wrld_simpl successfully in other
> contexts, i.e.,
>
> * loading the data with package=ncdf4 (which is considerably more work)
> * converting the data to a data.frame
> * lattice::levelplot-ing the data
> * lattice::xyplot-ing the map
>
> But when I do
>
> data(wrld_simpl)
> global.raster <- brick(in.fp, varname=data.var.name)
> layers.n <- nbands(global.raster)
> global.data.df <- as.data.frame(global.raster)
> # some twiddling of names(global.data.df) omitted
> global.map <- map('world', plot=FALSE)
> global.map.df <- data.frame(lon=global.map$x, lat=global.map$y)
> pdf(file=pdf.fp, width=5, height=100)
> # using rasterVis::levelplot, not lattice::levelplot
> levelplot(global.raster,
>   margin=FALSE,
>   names.attr=names(global.data.df),
>   layout=c(1,layers.n), # all layers in one "atmospheric column"
> ) + xyplot(lat ~ lon, global.map.df, type='l', lty=1, lwd=1, col='black')
> dev.off()
>
> the data plots apparently correctly, but the map plots incorrectly, as
> shown by this .png of the top level:
>
> https://docs.google.com/open?id=0BzDAFHgIxRzKOVdlSDFMR29BdWM
>
> As noted above, the map's eastern hemisphere overlays the data's western
> hemisphere, and nothing overlays the data's eastern hemisphere.
>
> I tried several variations on the above, but either got the same
> results, or outright error. (Unfortunately the error messages are often
> printed on the levelplot, but the messages are truncated (so they can't
> be understood), and it's annoying to "fail slow" (after waiting for a
> long plot to finish).) So after some research I sought to emulate the
> means recommended @
>
> http://rastervis.r-forge.r-project.org/#levelplot
>
> data(wrld_simpl)
> global.raster <- brick(in.fp, varname=data.var.name)
> layers.n <- nbands(global.raster)
> global.data.df <- as.data.frame(global.raster)
> # some twiddling of names(global.data.df) omitted
> global.map.proj <- CRS('+proj=latlon +ellps=WGS84')
> global.map <- map('world', plot=FALSE)
> global.map.shp <- map2SpatialLines(global.map, proj4string=global.map.proj)
> pdf(file=pdf.fp, width=5, height=100)
> # using rasterVis::levelplot, not lattice::levelplot
> levelplot(global.raster,
>   margin=FALSE,
>   names.attr=names(global.data.df),
>   layout=c(1,layers.n), # all layers in one "atmospheric column"
> ) + layer(sp.lines(global.map.shp, lwd=0.8, col='darkgray'))
> dev.off()
>
> This also fails, and very similarly (though the line colors differ). See
> this .png:
>
> https://docs.google.com/open?id=0BzDAFHgIxRzKYzd6cVB2TDE4RE0
>
> I'm guessing I can either do something simple to wrld_simpl's longitude
> values, or Something Completely Different that would Just Work Better,
> but don't know. Your assistance is appreciated.
>
> TIA, Tom Roche <Tom_Roche at pobox.com>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



-- 
Michael Sumner
Hobart, Australia
e-mail: mdsumner at gmail.com


From mdsumner at gmail.com  Wed Dec 19 05:55:10 2012
From: mdsumner at gmail.com (Michael Sumner)
Date: Tue, 18 Dec 2012 20:55:10 -0800
Subject: [R-sig-Geo] problems drawing a world map on a levelplot
In-Reply-To: <CAAcGz98tv8AR1B1Maa6m8W+QJnzGZ90Lt4VUgoPajyJcb3_6nQ@mail.gmail.com>
References: <87txri4qyz.fsf@pobox.com>
	<CAAcGz98tv8AR1B1Maa6m8W+QJnzGZ90Lt4VUgoPajyJcb3_6nQ@mail.gmail.com>
Message-ID: <CAAcGz98TG9j46ahKjFK3kiCmUE3N048-5syrwaA+tTgstP4uyw@mail.gmail.com>

I meant "wrld_simpl2 version like the maps package has".

On Tue, Dec 18, 2012 at 8:54 PM, Michael Sumner <mdsumner at gmail.com> wrote:
> I happened to write this yesterday, which switches the parts of
> wrld_simpl from < 0 longitude to the east (Pacific view). I haven't
> investigated what you need in detail, so just ignore if I'm off track.
>
> It's not careful about data or anything, since all I needed was the
> raw geometry. It might be of use. "xrange" here can be anything from
> [-180, 360] though it's really assuming you don't traverse more than
> 360 in total.
>
> It would be nice to carefully clean up a copy of wrld_simpl like this
> and make a wrld_simpl version like the maps package has.
>
> Cheers, Mike.
>
>
> xrange <- c(140, 250)
> ##xrange <- c(0, 360)
> yrange <- c(-60, 20)
>
> require(maptools)
> require(raster)
> require(rgeos)
>
>
>
>     ext <- extent(xrange[1], xrange[2], yrange[1], yrange[2])
>     data(wrld_simpl, package = "maptools")
>     if (xrange[2] > 180.0) {
>
>         eastrange <- c(xrange[1], 180.0)
>         westrange <- c(-180.0, xrange[2] - 360)
>
>         ew <- extent(westrange[1], westrange[2], yrange[1], yrange[2])
>         ee <- extent(eastrange[1], eastrange[2], yrange[1], yrange[2])
>
>         geome <- as(ee, "SpatialPolygons")
>         geomw <- as(ew, "SpatialPolygons")
>
>         ## why does this get dropped?
>         proj4string(geome) <- CRS(proj4string(wrld_simpl))
>         proj4string(geomw) <- CRS(proj4string(wrld_simpl))
>
>         worlde <- gIntersection(wrld_simpl, geome)
>         worldw <- gIntersection(wrld_simpl, geomw)
>         worldw <- elide(worldw, shift = c(360.0, 0.0))
>
>         proj4string(worldw) <- CRS(proj4string(wrld_simpl))
>
>         dfe <- data.frame(x = seq_len(length(worlde at polygons)))
>         dfw <- data.frame(x = seq_len(length(worldw at polygons)))
>         rownames(dfw) <- as.character(as.numeric(rownames(dfe)) + nrow(dfe))
>
>         worlde <- SpatialPolygonsDataFrame(worlde, dfe, match.ID = FALSE)
>         worldw <- SpatialPolygonsDataFrame(worldw, dfw, match.ID = FALSE)
>         worldw <- spChFIDs(worldw, rownames(dfw))
>
>         world <- spRbind(worlde, worldw)
>
>     } else {
>
>         geom <- as(ext, "SpatialPolygons")
>         proj4string(geom) <- CRS(proj4string(wrld_simpl))
>         ## TODO: make this spdf if needed
>         world <- gIntersection(wrld_simpl, geom)
>     }
>
>
> plot(world)
>
>
>
> On Tue, Dec 18, 2012 at 8:15 PM, Tom Roche <Tom_Roche at pobox.com> wrote:
>>
>> summary: I've tried several ways to draw wrld_simpl over global data
>> plotted with rasterVis::levelplot, but keep encountering the same
>> problem:
>>
>> - only the eastern hemisphere of the map plots
>>
>> - the eastern hemisphere of the map overlays the western hemisphere of
>>   the data
>>
>> How to fix? or otherwise provide geographical context?
>>
>> details:
>>
>> (I'll attempt to produce a "complete, self-contained example" after I
>> make the code publicly viewable, but for now, I'm hoping the problem is
>> sufficiently simple to diagnose.)
>>
>> I have atmospheric data in a netCDF file specifying gas concentrations
>> over a 3D space with dimensions longitude, latitude, and (vertical)
>> level, such that
>>
>> * the horizontal extents are global
>>
>> * the vertical coordinates are pressures (specifically hybrid
>>   sigma-pressure)
>>
>> package=raster provides very usable API for loading the data into a
>> RasterBrick, and package=rasterVis makes it relatively easy to levelplot
>> the data in a single "atmospheric column" with the highest pressures at
>> the bottom. However I also want to provide some geographic context
>> (e.g., to overlay the data with national boundaries), and have failed to
>> date.
>>
>> I have done this with maptools::wrld_simpl successfully in other
>> contexts, i.e.,
>>
>> * loading the data with package=ncdf4 (which is considerably more work)
>> * converting the data to a data.frame
>> * lattice::levelplot-ing the data
>> * lattice::xyplot-ing the map
>>
>> But when I do
>>
>> data(wrld_simpl)
>> global.raster <- brick(in.fp, varname=data.var.name)
>> layers.n <- nbands(global.raster)
>> global.data.df <- as.data.frame(global.raster)
>> # some twiddling of names(global.data.df) omitted
>> global.map <- map('world', plot=FALSE)
>> global.map.df <- data.frame(lon=global.map$x, lat=global.map$y)
>> pdf(file=pdf.fp, width=5, height=100)
>> # using rasterVis::levelplot, not lattice::levelplot
>> levelplot(global.raster,
>>   margin=FALSE,
>>   names.attr=names(global.data.df),
>>   layout=c(1,layers.n), # all layers in one "atmospheric column"
>> ) + xyplot(lat ~ lon, global.map.df, type='l', lty=1, lwd=1, col='black')
>> dev.off()
>>
>> the data plots apparently correctly, but the map plots incorrectly, as
>> shown by this .png of the top level:
>>
>> https://docs.google.com/open?id=0BzDAFHgIxRzKOVdlSDFMR29BdWM
>>
>> As noted above, the map's eastern hemisphere overlays the data's western
>> hemisphere, and nothing overlays the data's eastern hemisphere.
>>
>> I tried several variations on the above, but either got the same
>> results, or outright error. (Unfortunately the error messages are often
>> printed on the levelplot, but the messages are truncated (so they can't
>> be understood), and it's annoying to "fail slow" (after waiting for a
>> long plot to finish).) So after some research I sought to emulate the
>> means recommended @
>>
>> http://rastervis.r-forge.r-project.org/#levelplot
>>
>> data(wrld_simpl)
>> global.raster <- brick(in.fp, varname=data.var.name)
>> layers.n <- nbands(global.raster)
>> global.data.df <- as.data.frame(global.raster)
>> # some twiddling of names(global.data.df) omitted
>> global.map.proj <- CRS('+proj=latlon +ellps=WGS84')
>> global.map <- map('world', plot=FALSE)
>> global.map.shp <- map2SpatialLines(global.map, proj4string=global.map.proj)
>> pdf(file=pdf.fp, width=5, height=100)
>> # using rasterVis::levelplot, not lattice::levelplot
>> levelplot(global.raster,
>>   margin=FALSE,
>>   names.attr=names(global.data.df),
>>   layout=c(1,layers.n), # all layers in one "atmospheric column"
>> ) + layer(sp.lines(global.map.shp, lwd=0.8, col='darkgray'))
>> dev.off()
>>
>> This also fails, and very similarly (though the line colors differ). See
>> this .png:
>>
>> https://docs.google.com/open?id=0BzDAFHgIxRzKYzd6cVB2TDE4RE0
>>
>> I'm guessing I can either do something simple to wrld_simpl's longitude
>> values, or Something Completely Different that would Just Work Better,
>> but don't know. Your assistance is appreciated.
>>
>> TIA, Tom Roche <Tom_Roche at pobox.com>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
>
> --
> Michael Sumner
> Hobart, Australia
> e-mail: mdsumner at gmail.com



-- 
Michael Sumner
Hobart, Australia
e-mail: mdsumner at gmail.com


From mdsumner at gmail.com  Wed Dec 19 08:20:15 2012
From: mdsumner at gmail.com (Michael Sumner)
Date: Tue, 18 Dec 2012 23:20:15 -0800
Subject: [R-sig-Geo] problems drawing a world map on a levelplot
In-Reply-To: <CAAcGz98TG9j46ahKjFK3kiCmUE3N048-5syrwaA+tTgstP4uyw@mail.gmail.com>
References: <87txri4qyz.fsf@pobox.com>
	<CAAcGz98tv8AR1B1Maa6m8W+QJnzGZ90Lt4VUgoPajyJcb3_6nQ@mail.gmail.com>
	<CAAcGz98TG9j46ahKjFK3kiCmUE3N048-5syrwaA+tTgstP4uyw@mail.gmail.com>
Message-ID: <CAAcGz98v-SRkaV04MLMou4MZ32n+7VHYtBmKnkRRVKdFfT9v5Q@mail.gmail.com>

Here's a crack at a full example, sorry the clip/merge polygon stuff
is a mess still.

library(maptools)
library(raster)

## first, do the jiggery pokery of wrld_simpl to
## convert from Atlantic to Pacific view
xrange <- c(0, 360)
yrange <- c(-90, 90)

require(maptools)
require(raster)
require(rgeos)

    ext <- extent(xrange[1], xrange[2], yrange[1], yrange[2])
    data(wrld_simpl, package = "maptools")

## this is a bit more general than needed for this example, since I
## wanted arbitrary crops originally

        eastrange <- c(xrange[1], 180.0)
        westrange <- c(-180.0, xrange[2] - 360)

        ew <- extent(westrange[1], westrange[2], yrange[1], yrange[2])
        ee <- extent(eastrange[1], eastrange[2], yrange[1], yrange[2])

        geome <- as(ee, "SpatialPolygons")
        geomw <- as(ew, "SpatialPolygons")

        ## why does this get dropped?
        proj4string(geome) <- CRS(proj4string(wrld_simpl))
        proj4string(geomw) <- CRS(proj4string(wrld_simpl))

        worlde <- gIntersection(wrld_simpl, geome)
        worldw <- gIntersection(wrld_simpl, geomw)
        worldw <- elide(worldw, shift = c(360.0, 0.0))

        proj4string(worldw) <- CRS(proj4string(wrld_simpl))

        dfe <- data.frame(x = seq_len(length(worlde at polygons)))
        dfw <- data.frame(x = seq_len(length(worldw at polygons)))
        rownames(dfw) <- as.character(as.numeric(rownames(dfe)) + nrow(dfe))

        worlde <- SpatialPolygonsDataFrame(worlde, dfe, match.ID = FALSE)
        worldw <- SpatialPolygonsDataFrame(worldw, dfw, match.ID = FALSE)
        worldw <- spChFIDs(worldw, rownames(dfw))

        world <- spRbind(worlde, worldw)


## so, "world" is longitudes [0, 360], which is pretty much essential
## given the input data shown

r <- raster(nrows = 180, ncols = 360, xmn = 0, xmx = 360, ymn = -90,
ymx = 90, crs = "+proj=longlat +ellps=WGS84 +over")

## fake a raster so we have something equivalent to your data (but simple/r)
rast <- rasterize(world, r)

## fill the ocean parts with something . . .
rast[is.na(rast)] <- 1:sum(is.na(getValues(rast)))

library(rasterVis)
levelplot(rast, margin = FALSE) + layer(sp.polygons(world, lwd=0.8,
col='darkgray'))





On Tue, Dec 18, 2012 at 8:55 PM, Michael Sumner <mdsumner at gmail.com> wrote:
> I meant "wrld_simpl2 version like the maps package has".
>
> On Tue, Dec 18, 2012 at 8:54 PM, Michael Sumner <mdsumner at gmail.com> wrote:
>> I happened to write this yesterday, which switches the parts of
>> wrld_simpl from < 0 longitude to the east (Pacific view). I haven't
>> investigated what you need in detail, so just ignore if I'm off track.
>>
>> It's not careful about data or anything, since all I needed was the
>> raw geometry. It might be of use. "xrange" here can be anything from
>> [-180, 360] though it's really assuming you don't traverse more than
>> 360 in total.
>>
>> It would be nice to carefully clean up a copy of wrld_simpl like this
>> and make a wrld_simpl version like the maps package has.
>>
>> Cheers, Mike.
>>
>>
>> xrange <- c(140, 250)
>> ##xrange <- c(0, 360)
>> yrange <- c(-60, 20)
>>
>> require(maptools)
>> require(raster)
>> require(rgeos)
>>
>>
>>
>>     ext <- extent(xrange[1], xrange[2], yrange[1], yrange[2])
>>     data(wrld_simpl, package = "maptools")
>>     if (xrange[2] > 180.0) {
>>
>>         eastrange <- c(xrange[1], 180.0)
>>         westrange <- c(-180.0, xrange[2] - 360)
>>
>>         ew <- extent(westrange[1], westrange[2], yrange[1], yrange[2])
>>         ee <- extent(eastrange[1], eastrange[2], yrange[1], yrange[2])
>>
>>         geome <- as(ee, "SpatialPolygons")
>>         geomw <- as(ew, "SpatialPolygons")
>>
>>         ## why does this get dropped?
>>         proj4string(geome) <- CRS(proj4string(wrld_simpl))
>>         proj4string(geomw) <- CRS(proj4string(wrld_simpl))
>>
>>         worlde <- gIntersection(wrld_simpl, geome)
>>         worldw <- gIntersection(wrld_simpl, geomw)
>>         worldw <- elide(worldw, shift = c(360.0, 0.0))
>>
>>         proj4string(worldw) <- CRS(proj4string(wrld_simpl))
>>
>>         dfe <- data.frame(x = seq_len(length(worlde at polygons)))
>>         dfw <- data.frame(x = seq_len(length(worldw at polygons)))
>>         rownames(dfw) <- as.character(as.numeric(rownames(dfe)) + nrow(dfe))
>>
>>         worlde <- SpatialPolygonsDataFrame(worlde, dfe, match.ID = FALSE)
>>         worldw <- SpatialPolygonsDataFrame(worldw, dfw, match.ID = FALSE)
>>         worldw <- spChFIDs(worldw, rownames(dfw))
>>
>>         world <- spRbind(worlde, worldw)
>>
>>     } else {
>>
>>         geom <- as(ext, "SpatialPolygons")
>>         proj4string(geom) <- CRS(proj4string(wrld_simpl))
>>         ## TODO: make this spdf if needed
>>         world <- gIntersection(wrld_simpl, geom)
>>     }
>>
>>
>> plot(world)
>>
>>
>>
>> On Tue, Dec 18, 2012 at 8:15 PM, Tom Roche <Tom_Roche at pobox.com> wrote:
>>>
>>> summary: I've tried several ways to draw wrld_simpl over global data
>>> plotted with rasterVis::levelplot, but keep encountering the same
>>> problem:
>>>
>>> - only the eastern hemisphere of the map plots
>>>
>>> - the eastern hemisphere of the map overlays the western hemisphere of
>>>   the data
>>>
>>> How to fix? or otherwise provide geographical context?
>>>
>>> details:
>>>
>>> (I'll attempt to produce a "complete, self-contained example" after I
>>> make the code publicly viewable, but for now, I'm hoping the problem is
>>> sufficiently simple to diagnose.)
>>>
>>> I have atmospheric data in a netCDF file specifying gas concentrations
>>> over a 3D space with dimensions longitude, latitude, and (vertical)
>>> level, such that
>>>
>>> * the horizontal extents are global
>>>
>>> * the vertical coordinates are pressures (specifically hybrid
>>>   sigma-pressure)
>>>
>>> package=raster provides very usable API for loading the data into a
>>> RasterBrick, and package=rasterVis makes it relatively easy to levelplot
>>> the data in a single "atmospheric column" with the highest pressures at
>>> the bottom. However I also want to provide some geographic context
>>> (e.g., to overlay the data with national boundaries), and have failed to
>>> date.
>>>
>>> I have done this with maptools::wrld_simpl successfully in other
>>> contexts, i.e.,
>>>
>>> * loading the data with package=ncdf4 (which is considerably more work)
>>> * converting the data to a data.frame
>>> * lattice::levelplot-ing the data
>>> * lattice::xyplot-ing the map
>>>
>>> But when I do
>>>
>>> data(wrld_simpl)
>>> global.raster <- brick(in.fp, varname=data.var.name)
>>> layers.n <- nbands(global.raster)
>>> global.data.df <- as.data.frame(global.raster)
>>> # some twiddling of names(global.data.df) omitted
>>> global.map <- map('world', plot=FALSE)
>>> global.map.df <- data.frame(lon=global.map$x, lat=global.map$y)
>>> pdf(file=pdf.fp, width=5, height=100)
>>> # using rasterVis::levelplot, not lattice::levelplot
>>> levelplot(global.raster,
>>>   margin=FALSE,
>>>   names.attr=names(global.data.df),
>>>   layout=c(1,layers.n), # all layers in one "atmospheric column"
>>> ) + xyplot(lat ~ lon, global.map.df, type='l', lty=1, lwd=1, col='black')
>>> dev.off()
>>>
>>> the data plots apparently correctly, but the map plots incorrectly, as
>>> shown by this .png of the top level:
>>>
>>> https://docs.google.com/open?id=0BzDAFHgIxRzKOVdlSDFMR29BdWM
>>>
>>> As noted above, the map's eastern hemisphere overlays the data's western
>>> hemisphere, and nothing overlays the data's eastern hemisphere.
>>>
>>> I tried several variations on the above, but either got the same
>>> results, or outright error. (Unfortunately the error messages are often
>>> printed on the levelplot, but the messages are truncated (so they can't
>>> be understood), and it's annoying to "fail slow" (after waiting for a
>>> long plot to finish).) So after some research I sought to emulate the
>>> means recommended @
>>>
>>> http://rastervis.r-forge.r-project.org/#levelplot
>>>
>>> data(wrld_simpl)
>>> global.raster <- brick(in.fp, varname=data.var.name)
>>> layers.n <- nbands(global.raster)
>>> global.data.df <- as.data.frame(global.raster)
>>> # some twiddling of names(global.data.df) omitted
>>> global.map.proj <- CRS('+proj=latlon +ellps=WGS84')
>>> global.map <- map('world', plot=FALSE)
>>> global.map.shp <- map2SpatialLines(global.map, proj4string=global.map.proj)
>>> pdf(file=pdf.fp, width=5, height=100)
>>> # using rasterVis::levelplot, not lattice::levelplot
>>> levelplot(global.raster,
>>>   margin=FALSE,
>>>   names.attr=names(global.data.df),
>>>   layout=c(1,layers.n), # all layers in one "atmospheric column"
>>> ) + layer(sp.lines(global.map.shp, lwd=0.8, col='darkgray'))
>>> dev.off()
>>>
>>> This also fails, and very similarly (though the line colors differ). See
>>> this .png:
>>>
>>> https://docs.google.com/open?id=0BzDAFHgIxRzKYzd6cVB2TDE4RE0
>>>
>>> I'm guessing I can either do something simple to wrld_simpl's longitude
>>> values, or Something Completely Different that would Just Work Better,
>>> but don't know. Your assistance is appreciated.
>>>
>>> TIA, Tom Roche <Tom_Roche at pobox.com>
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>
>>
>> --
>> Michael Sumner
>> Hobart, Australia
>> e-mail: mdsumner at gmail.com
>
>
>
> --
> Michael Sumner
> Hobart, Australia
> e-mail: mdsumner at gmail.com



-- 
Michael Sumner
Hobart, Australia
e-mail: mdsumner at gmail.com


From oscar.perpinan at gmail.com  Wed Dec 19 12:19:19 2012
From: oscar.perpinan at gmail.com (=?ISO-8859-1?Q?Oscar_Perpi=F1an?=)
Date: Wed, 19 Dec 2012 12:19:19 +0100
Subject: [R-sig-Geo] problems drawing a world map on a levelplot
In-Reply-To: <CAAcGz98v-SRkaV04MLMou4MZ32n+7VHYtBmKnkRRVKdFfT9v5Q@mail.gmail.com>
References: <87txri4qyz.fsf@pobox.com>
	<CAAcGz98tv8AR1B1Maa6m8W+QJnzGZ90Lt4VUgoPajyJcb3_6nQ@mail.gmail.com>
	<CAAcGz98TG9j46ahKjFK3kiCmUE3N048-5syrwaA+tTgstP4uyw@mail.gmail.com>
	<CAAcGz98v-SRkaV04MLMou4MZ32n+7VHYtBmKnkRRVKdFfT9v5Q@mail.gmail.com>
Message-ID: <CAMLL7bkTA8hBFUQxN_JTaVa-re1mBZvV5h9uehGKf_XPD=JWhg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121219/91829958/attachment.pl>

From hengl at spatial-analyst.net  Wed Dec 19 13:52:39 2012
From: hengl at spatial-analyst.net (Tomislav Hengl)
Date: Wed, 19 Dec 2012 13:52:39 +0100
Subject: [R-sig-Geo] Upcoming training courses: ISRIC's Spring School 2013
 and GEOSTAT Quebec City 2013
Message-ID: <50D1B897.5040501@spatial-analyst.net>


Dear R-sig-geo,

Registrations for the two upcoming 5-day training courses are now open:

---------------------------------------------------------------
"Hands-on Global Soil Information Facilities", 22-26 April 2013, 
Wageningen University

The purpose of the Spring School is to introduce participants to 
software for soil data analysis and visualisation, digital soil mapping 
and soil-web services. The focus is on using the Free and Open Source 
Software for statistical and geographical computing for soil analysis 
and mapping: R (the main programming environment), SAGA GIS, Python and 
Google Earth. Upon completing the course, participants will be able to 
use the software and data sets for generating soil GIS layers following 
the international standards (e.g. GlobalSoilMap specifications) and for 
land use planning.

Registration deadline: 20th of January 2013.
URL: http://www.isric.org/content/isrics-spring-school-2013

---------------------------------------------------------------
"GEOSTAT Quebec City 2013", 26 May - 1 of June, 2013, Quebec City

The GEOSTAT Quebec city 2013 summer school is 8th in a series of summer 
schools organized by R and OS GIS developers and enthusiasts. GEOSTAT 
aims at PhD students and R-sig-geo enthusiasts in a range of 
environmental and GIS sciences, with a special focus on analyzing 
spatio-temporal gridded data in R and connected OS GIS software. The 
participants will learn how to import and organize space-time data i.e. 
time series of rasters and how to program statistical and geographical 
analysis using a combination of R and OS GIS functionality. The school 
will be hosted at the Faculty of Forestry, Geomatics and Geography, on 
the campus of Laval University, a few kilometers from the heart of 
Quebec City, Canada.

Registration deadline: 1st of February 2013.
URL: http://geostat-course.org/Quebec_2013


PS: If you are aware of any such (future or past!) training course or 
event that is related to the R-sig-geo topics, please consider adding it 
to the GEOSTAT timeline at http://geostat-course.org/timeline/nodes


T. Hengl
http://www.wewur.wur.nl/popups/vcard.aspx?id=HENGL001


From evberghe at gmail.com  Wed Dec 19 14:48:29 2012
From: evberghe at gmail.com (Edward Vanden Berghe)
Date: Wed, 19 Dec 2012 14:48:29 +0100
Subject: [R-sig-Geo] reading PostGIS table into sp data frame
Message-ID: <002301cdddef$87b2d9e0$97188da0$@gmail.com>

I wanted to create a global map with squares in lat-lon. I have PostGIS tables to define these squares ? but I haven?t been able to figure out an efficient way of reading those tables into R. The code I am using now is:

       crs <- CRS("+proj=longlat +ellps=WGS84")
       s <- paste("select id, st_astext(geom) as geom from geo.cs10d";", sep="")
       r <- dbGetQuery(con, s)
       p <- readWKT(r$geom[1],id=r$id[1],p4s=crs)
       for(i in 2:length(r$id)){
              p <- rbind(p, readWKT(r$geom[i], id=r$id[i], p4s=crs))
       }

where geo.cs10d is the table with squares, id the primary key of the table, and geom the binary geometry field.

The code above works fine for the larger squares, such as 10 degrees, of which I only need 648 to cover the globe. For finer resolutions, the above takes just too long ? I assume because the rbind function rewrites the whole sp object each time it executes. I?ve seen other R scripts that initiate an empty data frame of the correct length to go round similar problems with the rbind function; I haven?t been able to find an equivalent for spatial polygons. How can I initiate an empty data frame with the right structure, and the right length?

A preferable solution would be if there would be a single function to load a complete PostGIS table, rather than having to load the polygons one by one in a loop. Is there such a function?

I?m using PostgreSQL 8.4, PostGIS 1.5, R 2.15.2, platform x86_64-w64-mingw32; IDE is StatET 3.0.1 plugin for Eclipse 3.7.2.

Any help would be much appreciated.

Edward 


From raffaele.morelli at gmail.com  Wed Dec 19 14:58:52 2012
From: raffaele.morelli at gmail.com (Raffaele Morelli)
Date: Wed, 19 Dec 2012 14:58:52 +0100
Subject: [R-sig-Geo] reading PostGIS table into sp data frame
In-Reply-To: <002301cdddef$87b2d9e0$97188da0$@gmail.com>
References: <002301cdddef$87b2d9e0$97188da0$@gmail.com>
Message-ID: <CAD4guxOt5fSUPbK4VbbPuZf-oTBrcY-UvNPcguvUYt4qS0+_kQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121219/dabad7d7/attachment.pl>

From Tom_Roche at pobox.com  Wed Dec 19 18:38:12 2012
From: Tom_Roche at pobox.com (Tom Roche)
Date: Wed, 19 Dec 2012 12:38:12 -0500
Subject: [R-sig-Geo] problems drawing a world map on a levelplot
In-Reply-To: <CAMLL7bkTA8hBFUQxN_JTaVa-re1mBZvV5h9uehGKf_XPD=JWhg@mail.gmail.com>
References: <CAMLL7bkTA8hBFUQxN_JTaVa-re1mBZvV5h9uehGKf_XPD=JWhg@mail.gmail.com>
	<87txri4qyz.fsf@pobox.com>
	<CAAcGz98tv8AR1B1Maa6m8W+QJnzGZ90Lt4VUgoPajyJcb3_6nQ@mail.gmail.com>
	<CAAcGz98TG9j46ahKjFK3kiCmUE3N048-5syrwaA+tTgstP4uyw@mail.gmail.com>
	<CAAcGz98v-SRkaV04MLMou4MZ32n+7VHYtBmKnkRRVKdFfT9v5Q@mail.gmail.com>
Message-ID: <87r4mm3ptn.fsf@pobox.com>


https://stat.ethz.ch/pipermail/r-sig-geo/2012-December/017014.html
(rearranged)
> following your code I think you are not setting the CRS of your
> RasterBrick.

True, but since it was also global data, brick(...) "did the right
thing." I have now set its CRS just to be sure.

> Instead of:

> global.map.proj <- CRS('+proj=latlon +ellps=WGS84')

> you should try:

> global.map.proj <- CRS('+proj=longlat +ellps=WGS84')

Thanks again, but please note that I was following (see starred line)

http://rastervis.r-forge.r-project.org/#levelplot
>> let's add the administrative borders. This information is available
>> at the GADM service.

>> library(maptools)
** proj <- CRS('+proj=latlon +ellps=WGS84')
>> ##Change to your folder
>> mapaSHP <- readShapeLines('~/Datos/ESP_adm/ESP_adm2.shp', proj4string=proj)
>> p <- levelplot(SISmm, layers=1, FUN.margin=median)
>> p + layer(sp.lines(mapaSHP, lwd=0.8, col='darkgray'))

...

> Date: 2012-08-10
> Author: Oscar Perpi??n Lamigueiro

Perhaps you could fix that?

TIA, Tom Roche <Tom_Roche at pobox.com>


From samanmonfared1 at gmail.com  Wed Dec 19 19:07:06 2012
From: samanmonfared1 at gmail.com (Saman Monfared)
Date: Wed, 19 Dec 2012 21:37:06 +0330
Subject: [R-sig-Geo] help for spdep
Message-ID: <CAOytA4ZoNBuheSdAyS=UgmSh4_4O0oSWPz93BGph6uKQMuCsMw@mail.gmail.com>

Dear all.
I try to fit conditional auto regressive models (CAR and  SAR) in package spdep.
Also, I have fitted some other models like GLM, Empirical Bayes and ...

My program to CAR and SAR is:

esar1f1 <- spautolm(IMR.m~ 0+PCFP+Sup+B.F,data =data1,
 listw=nb2listw(nb6, style="W"), family="SAR", method="full", verbose=TRUE)

summary(esar1f1)

esar1f2 <- spautolm(IMR.m~ 0+PCFP+Sup+B.F,data =data1,
listw=nb2listw(nb6, style="W"), family="CAR", method="full", verbose=TRUE)

> esar1f1

Call:
spautolm(formula = IMR.m ~ 0 + PCFP + Sup + B.F, data = data1,
    listw = nb2listw(nb6, style = "W"), family = "SAR", method = "full",
    verbose = TRUE)

Coefficients:
      PCFP        Sup        B.F     lambda
 0.1711382 -0.2262700  0.2414336 -1.7946991

Log likelihood: -56.24405


What is lambda?? I couldn't find a good refrences to understand tese model!!!
How can I predict this model for new data??
How can I cross validate results of CAR and SAR??


-- 
Saman Monfared
Msc, Department of Statistics, Shiraz University,
Shiraz 71454, Iran
Email: Samanmonfared1 at gmail.com

Tel: +98 917 5305167


From ppanday at clarku.edu  Wed Dec 19 19:19:30 2012
From: ppanday at clarku.edu (Panday, Prajjwal)
Date: Wed, 19 Dec 2012 18:19:30 +0000
Subject: [R-sig-Geo] Runtime error when opening netCDF
Message-ID: <C3A65516E00A294DA9B1DBF9474A0EA63CB976AC@CH1PRD0310MB356.namprd03.prod.outlook.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121219/890c90b6/attachment.pl>

From Tom_Roche at pobox.com  Wed Dec 19 19:39:15 2012
From: Tom_Roche at pobox.com (Tom Roche)
Date: Wed, 19 Dec 2012 13:39:15 -0500
Subject: [R-sig-Geo] Runtime error when opening netCDF
Message-ID: <87obhp51kc.fsf@pobox.com>


2 suggestions:

Panday, Prajjwal Wed Dec 19 19:19:30 CET 2012
> I am trying to read/open a netCDF file using the ncdf package,

Use package=ncdf4, not package=ncdf: the latter is no longer supported,
per the developer (of both packages).

> but it keeps giving me the Microsoft Visual C++ Runtime Library error:

Use linux.

HTH, Tom Roche <Tom_Roche at pobox.com>


From Tom_Roche at pobox.com  Wed Dec 19 19:52:38 2012
From: Tom_Roche at pobox.com (Tom Roche)
Date: Wed, 19 Dec 2012 13:52:38 -0500
Subject: [R-sig-Geo] problems drawing a world map on a levelplot
In-Reply-To: <CAAcGz98v-SRkaV04MLMou4MZ32n+7VHYtBmKnkRRVKdFfT9v5Q@mail.gmail.com>
References: <87r4mm3ptn.fsf@pobox.com>
	<CAMLL7bkTA8hBFUQxN_JTaVa-re1mBZvV5h9uehGKf_XPD=JWhg@mail.gmail.com>
	<87txri4qyz.fsf@pobox.com>
	<CAAcGz98tv8AR1B1Maa6m8W+QJnzGZ90Lt4VUgoPajyJcb3_6nQ@mail.gmail.com>
	<CAAcGz98TG9j46ahKjFK3kiCmUE3N048-5syrwaA+tTgstP4uyw@mail.gmail.com>
	<CAAcGz98v-SRkaV04MLMou4MZ32n+7VHYtBmKnkRRVKdFfT9v5Q@mail.gmail.com>
Message-ID: <87lict50y1.fsf@pobox.com>


summary: How to best/easiest range-shift lon-lat data?

details:

https://stat.ethz.ch/pipermail/r-sig-geo/2012-December/017011.html
> I happened to write [the following code, omitted] yesterday, which
> switches the parts of wrld_simpl from < 0 longitude to the east
> (Pacific view).

<self-administered dopeslap/> Of course! the problem is my input!
see starred line:

R session
> > global.proj <- CRS('+proj=longlat +ellps=WGS84')
> > global.raster <- brick(in.fp, varname=data.var.name, crs=global.proj)
> > global.raster
> class       : RasterBrick 
> dimensions  : 96, 144, 13824, 56  (nrow, ncol, ncell, nlayers)
> resolution  : 2.5, 1.894737  (x, y)
* extent      : -1.25, 358.75, -90.94737, 90.94737  (xmin, xmax, ymin, ymax)
> coord. ref. : +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0 

which is wrong:

- latitudes outside the range [-90, +90]?

- (as you note) 0-based longitudes are likely troublesome (I'm pretty
  sure the other data with which this must integrate is [-180, +180])

- ... and these longitudes aren't even 0-based!

I didn't even check :-( since the data's source is much more eminent
than a mere student like myself. But now I note

$ ncdump -h ./2008N2O_restart.nc | head
> netcdf \2008N2O_restart {
> dimensions:
>         lev = 56 ;
>         lat = 96 ;
>         lon = 144 ;
>         ilev = 57 ;
> variables:
>         double N2O(lev, lat, lon) ;
>                 N2O:long_name = "N2O" ;
>                 N2O:units = "ppmV" ;

$ ncdump -v lat ./2008N2O_restart.nc | tail -n 28
>  lat = -90, -88.1052631578947, -86.2105263157895, -84.3157894736842, 
>     -82.4210526315789, -80.5263157894737, -78.6315789473684, 
>     -76.7368421052632, -74.8421052631579, -72.9473684210526, 
>     -71.0526315789474, -69.1578947368421, -67.2631578947368, 
>     -65.3684210526316, -63.4736842105263, -61.5789473684211, 
>     -59.6842105263158, -57.7894736842105, -55.8947368421053, -54, 
>     -52.1052631578947, -50.2105263157895, -48.3157894736842, 
>     -46.4210526315789, -44.5263157894737, -42.6315789473684, 
>     -40.7368421052632, -38.8421052631579, -36.9473684210526, 
>     -35.0526315789474, -33.1578947368421, -31.2631578947368, 
>     -29.3684210526316, -27.4736842105263, -25.5789473684211, 
>     -23.6842105263158, -21.7894736842105, -19.8947368421053, -18, 
>     -16.1052631578947, -14.2105263157895, -12.3157894736842, 
>     -10.4210526315789, -8.52631578947369, -6.63157894736842, 
>     -4.73684210526316, -2.84210526315789, -0.947368421052634, 
>     0.947368421052634, 2.84210526315788, 4.73684210526315,
>     6.63157894736842, 8.52631578947369, 10.4210526315789,
>     12.3157894736842, 14.2105263157895, 16.1052631578947, 18,
>     19.8947368421053, 21.7894736842105, 23.6842105263158,
>     25.5789473684211, 27.4736842105263, 29.3684210526316,
>     31.2631578947368, 33.1578947368421, 35.0526315789474,
>     36.9473684210526, 38.8421052631579, 40.7368421052632,
>     42.6315789473684, 44.5263157894737, 46.4210526315789,
>     48.3157894736842, 50.2105263157895, 52.1052631578947, 54,
>     55.8947368421053, 57.7894736842105, 59.6842105263158,
>     61.578947368421, 63.4736842105263, 65.3684210526316,
>     67.2631578947368, 69.1578947368421, 71.0526315789474,
>     72.9473684210526, 74.8421052631579, 76.7368421052632,
>     78.6315789473684, 80.5263157894737, 82.4210526315789,
>     84.3157894736842, 86.2105263157895, 88.1052631578947, 90 ; }

I'm not sure why raster is reporting y range=[-90.94737, 90.94737],
except that 2 * 0.94737 = 1.89474 == the latitude resolution.

$ ncdump -v lon ./2008N2O_restart.nc | tail -n 15
>  lon = 0, 2.5, 5, 7.5, 10, 12.5, 15, 17.5, 20, 22.5, 25, 27.5, 30,
>     32.5, 35, 37.5, 40, 42.5, 45, 47.5, 50, 52.5, 55, 57.5, 60, 62.5,
>     65, 67.5, 70, 72.5, 75, 77.5, 80, 82.5, 85, 87.5, 90, 92.5, 95,
>     97.5, 100, 102.5, 105, 107.5, 110, 112.5, 115, 117.5, 120, 122.5,
>     125, 127.5, 130, 132.5, 135, 137.5, 140, 142.5, 145, 147.5, 150,
>     152.5, 155, 157.5, 160, 162.5, 165, 167.5, 170, 172.5, 175, 177.5,
>     180, 182.5, 185, 187.5, 190, 192.5, 195, 197.5, 200, 202.5, 205,
>     207.5, 210, 212.5, 215, 217.5, 220, 222.5, 225, 227.5, 230, 232.5,
>     235, 237.5, 240, 242.5, 245, 247.5, 250, 252.5, 255, 257.5, 260,
>     262.5, 265, 267.5, 270, 272.5, 275, 277.5, 280, 282.5, 285, 287.5,
>     290, 292.5, 295, 297.5, 300, 302.5, 305, 307.5, 310, 312.5, 315,
>     317.5, 320, 322.5, 325, 327.5, 330, 332.5, 335, 337.5, 340, 342.5,
>     345, 347.5, 350, 352.5, 355, 357.5 ; }

Again, it seems raster is reporting range(x)=[-1.25, 358.75] only
because resolution(x)=2.5?. I'll defer to its superior wisdom.

Given my need to integrate this data with other more conventional,
longitudes=[-180, +180] datasets, it seems better to fix this data than
to fix wrld_simpl. So I'm wondering, how best to "shift" my data from
longitudes=[0, 360] to longitudes=[-180, +180]?

TIA, Tom Roche <Tom_Roche at pobox.com>


From r.hijmans at gmail.com  Wed Dec 19 20:06:13 2012
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Wed, 19 Dec 2012 11:06:13 -0800
Subject: [R-sig-Geo] Runtime error when opening netCDF
In-Reply-To: <87obhp51kc.fsf@pobox.com>
References: <87obhp51kc.fsf@pobox.com>
Message-ID: <CANtt_hwyR7o_L7zFoMKvr7b07xy_TbE9Sm-gS9oYZMKCn9MTUQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121219/b042b6f8/attachment.pl>

From landis at isciences.com  Wed Dec 19 20:08:45 2012
From: landis at isciences.com (Matt Landis)
Date: Wed, 19 Dec 2012 14:08:45 -0500
Subject: [R-sig-Geo] problems drawing a world map on a levelplot
In-Reply-To: <87lict50y1.fsf@pobox.com>
References: <87r4mm3ptn.fsf@pobox.com>
	<CAMLL7bkTA8hBFUQxN_JTaVa-re1mBZvV5h9uehGKf_XPD=JWhg@mail.gmail.com>
	<87txri4qyz.fsf@pobox.com>
	<CAAcGz98tv8AR1B1Maa6m8W+QJnzGZ90Lt4VUgoPajyJcb3_6nQ@mail.gmail.com>
	<CAAcGz98TG9j46ahKjFK3kiCmUE3N048-5syrwaA+tTgstP4uyw@mail.gmail.com>
	<CAAcGz98v-SRkaV04MLMou4MZ32n+7VHYtBmKnkRRVKdFfT9v5Q@mail.gmail.com>
	<87lict50y1.fsf@pobox.com>
Message-ID: <CAE-RneJvWLzhG2u=_Gqycw-EMn7Dr1ZZJBhVa-cVWKMj1DPVsg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121219/4ec151f2/attachment.pl>

From r.hijmans at gmail.com  Wed Dec 19 20:08:51 2012
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Wed, 19 Dec 2012 11:08:51 -0800
Subject: [R-sig-Geo] rasterize func: polygon values to raster cells -
 error msg
In-Reply-To: <50D0B758.3040708@ebc.uu.se>
References: <50C98A05.6020603@ebc.uu.se>
	<CANtt_hxrq7n3T-eeLAXfRNxpb6=N6payaBqdM7owRWu--irvww@mail.gmail.com>
	<50D0B758.3040708@ebc.uu.se>
Message-ID: <CANtt_hwreneOz534Lf+QJiAz0KRtfwM3Q2FAYTqn_Pn00xWP1g@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121219/da3c70cf/attachment.pl>

From landis at isciences.com  Wed Dec 19 20:09:57 2012
From: landis at isciences.com (Matt Landis)
Date: Wed, 19 Dec 2012 14:09:57 -0500
Subject: [R-sig-Geo] problems drawing a world map on a levelplot
In-Reply-To: <CAE-RneJvWLzhG2u=_Gqycw-EMn7Dr1ZZJBhVa-cVWKMj1DPVsg@mail.gmail.com>
References: <87r4mm3ptn.fsf@pobox.com>
	<CAMLL7bkTA8hBFUQxN_JTaVa-re1mBZvV5h9uehGKf_XPD=JWhg@mail.gmail.com>
	<87txri4qyz.fsf@pobox.com>
	<CAAcGz98tv8AR1B1Maa6m8W+QJnzGZ90Lt4VUgoPajyJcb3_6nQ@mail.gmail.com>
	<CAAcGz98TG9j46ahKjFK3kiCmUE3N048-5syrwaA+tTgstP4uyw@mail.gmail.com>
	<CAAcGz98v-SRkaV04MLMou4MZ32n+7VHYtBmKnkRRVKdFfT9v5Q@mail.gmail.com>
	<87lict50y1.fsf@pobox.com>
	<CAE-RneJvWLzhG2u=_Gqycw-EMn7Dr1ZZJBhVa-cVWKMj1DPVsg@mail.gmail.com>
Message-ID: <CAE-RneJOB5pk7sKL7D66_LWvU=kVWk1Nc92pRbtrACN0JOHiJg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121219/35265d5e/attachment.pl>

From ppanday at clarku.edu  Wed Dec 19 20:16:13 2012
From: ppanday at clarku.edu (ppanday)
Date: Wed, 19 Dec 2012 11:16:13 -0800 (PST)
Subject: [R-sig-Geo] Runtime error when opening netCDF
In-Reply-To: <CANtt_hwyR7o_L7zFoMKvr7b07xy_TbE9Sm-gS9oYZMKCn9MTUQ@mail.gmail.com>
References: <C3A65516E00A294DA9B1DBF9474A0EA63CB976AC@CH1PRD0310MB356.namprd03.prod.outlook.com>
	<87obhp51kc.fsf@pobox.com>
	<CANtt_hwyR7o_L7zFoMKvr7b07xy_TbE9Sm-gS9oYZMKCn9MTUQ@mail.gmail.com>
Message-ID: <1355944573164-7582021.post@n2.nabble.com>

Robert

Yes I was able to read the file using ncdf. However, I am not able to load
the entire variable in R-32bit using get.var.ncdf command. I get the error
"cannot allocate vector of size 2.5 Gb". Also, would this be a problem down
the road if I am working with large datasets in R-32bit?

Thanks,
Prajjwal



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Runtime-error-when-opening-netCDF-tp7582014p7582021.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From r.hijmans at gmail.com  Wed Dec 19 20:21:04 2012
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Wed, 19 Dec 2012 11:21:04 -0800
Subject: [R-sig-Geo] Runtime error when opening netCDF
In-Reply-To: <1355944573164-7582021.post@n2.nabble.com>
References: <C3A65516E00A294DA9B1DBF9474A0EA63CB976AC@CH1PRD0310MB356.namprd03.prod.outlook.com>
	<87obhp51kc.fsf@pobox.com>
	<CANtt_hwyR7o_L7zFoMKvr7b07xy_TbE9Sm-gS9oYZMKCn9MTUQ@mail.gmail.com>
	<1355944573164-7582021.post@n2.nabble.com>
Message-ID: <CANtt_hzBXSjzfUQc7Y3u4yWrPJE0n4um6C9y8yKKK1D-VTkkRQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121219/21eec9c3/attachment.pl>

From Nathalie.M.Morin at Usherbrooke.ca  Wed Dec 19 21:04:21 2012
From: Nathalie.M.Morin at Usherbrooke.ca (Nathalie Morin)
Date: Wed, 19 Dec 2012 15:04:21 -0500
Subject: [R-sig-Geo] Apply() function on 3rd dimension of
	SpatialGridDataFrame
Message-ID: <007201cdde24$093bdf00$1bb39d00$@Usherbrooke.ca>

Hello,

 

I have a 3D array with an attribute converted to SpatiaGridDataFrame named
?clip? :

 

> summary(clip)

Object of class SpatialGridDataFrame

Coordinates:

         min       max

s1 828104.00 828134.00

s2 101839.00 101869.00

s3    324.09    373.09

Is projected: TRUE

proj4string :

[+init=epsg:27561 +proj=lcc +lat_1=49.50000000000001
+lat_0=49.50000000000001 +lon_0=0

+k_0=0.999877341 +x_0=600000 +y_0=200000 +a=6378249.2 +b=6356515

+towgs84=-168,-60,320,0,0,0,0 +pm=paris +units=m +no_defs]

Grid attributes:

   cellcentre.offset cellsize cells.dim

s1         828104.50        1        30

s2         101839.50        1        30

s3            324.59        1        49

Data attributes:

    Min.  1st Qu.   Median     Mean  3rd Qu.     Max.     NA's 

   0.000    0.000    0.000    0.002    0.000    0.806 9506.000

 

The apply() function does not work on the 3rd dimension of the
SpatiaGridDataFrame :

 

> D.tls.z.mean <- apply(clip, 3, mean, na.rm=T)

 

=> I get an error message (sorry it's in French) :

"Erreur dans if (d2 == 0L) { : valeur manquante l? o? TRUE / FALSE est
requis"

 

I tried with z coordinate instead :

> z <- coordinates(clip)[,3]

> D.tls.z.mean <- apply(clip, z, mean, na.rm=T)

 

The only solution I found is to convert back to standard non spatial 3D
array.

 

Cheers,

 

Nathalie MORIN

Doctorante en t?l?d?tection foresti?re (Ph.D student in remote sensing
applied to forestry)

Centre d?application et de recherches en t?l?d?tection (CARTEL)

D?partement de G?omatique Appliqu?e

Sherbrooke (QC) CANADA J1K 2R1

T?l. : + 1 (819)  821-8000 #62962

e-mail :  <mailto:Nathalie.M.Morin at Usherbrooke.ca>
Nathalie.M.Morin at Usherbrooke.ca

 <http://www.usherbrooke.ca/> Universit? de Sherbrooke

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121219/bd61efd6/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/gif
Size: 1245 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121219/bd61efd6/attachment.gif>

From thi_veloso at yahoo.com.br  Wed Dec 19 21:20:06 2012
From: thi_veloso at yahoo.com.br (Thiago V. dos Santos)
Date: Wed, 19 Dec 2012 12:20:06 -0800 (PST)
Subject: [R-sig-Geo] Make raster from oddly organized ASCII
Message-ID: <1355948406.9467.YahooMailNeo@web121905.mail.ne1.yahoo.com>

Dear all,

Today I received some ASCII files that need to be converted to raster. They are organized in a rather odd way, and I cannot think of a method
to read and organize the data to make a raster. Please take a look at a sample file:

sample<-readLines(url("http://dl.dropbox.com/u/27700634/gghswmp.lis"))

Useful information that I know about the data:
- global coverage at 1 degree;
- each line's 2nd value corresponds to the latitude coordinate;?
- the records are ordered from north (lat = 89) to south (lat = 90) within each hemisphere, the eastern?hemisphere (lon=0) appearing first and the western (lon=180) second;
- lon is the longitude and lat is the latitude of the southwest corner of the first 1x1 degree cell.

Initially I thought of creating a XYZ data.frame and then use rasterfromXYZ to produce the raster.

Could anyone help me to create a XYZ data.frame from the supplied file?

Many thanks in advance,
Thiago.


From Tom_Roche at pobox.com  Wed Dec 19 21:50:06 2012
From: Tom_Roche at pobox.com (Tom Roche)
Date: Wed, 19 Dec 2012 15:50:06 -0500
Subject: [R-sig-Geo] problems drawing a world map on a levelplot
In-Reply-To: <CAE-RneJOB5pk7sKL7D66_LWvU=kVWk1Nc92pRbtrACN0JOHiJg@mail.gmail.com>
References: <CAE-RneJOB5pk7sKL7D66_LWvU=kVWk1Nc92pRbtrACN0JOHiJg@mail.gmail.com>
	<87r4mm3ptn.fsf@pobox.com>
	<CAMLL7bkTA8hBFUQxN_JTaVa-re1mBZvV5h9uehGKf_XPD=JWhg@mail.gmail.com>
	<87txri4qyz.fsf@pobox.com>
	<CAAcGz98tv8AR1B1Maa6m8W+QJnzGZ90Lt4VUgoPajyJcb3_6nQ@mail.gmail.com>
	<CAAcGz98TG9j46ahKjFK3kiCmUE3N048-5syrwaA+tTgstP4uyw@mail.gmail.com>
	<CAAcGz98v-SRkaV04MLMou4MZ32n+7VHYtBmKnkRRVKdFfT9v5Q@mail.gmail.com>
	<87lict50y1.fsf@pobox.com>
	<CAE-RneJvWLzhG2u=_Gqycw-EMn7Dr1ZZJBhVa-cVWKMj1DPVsg@mail.gmail.com>
Message-ID: <87ip7x4vi9.fsf@pobox.com>


Tom Roche Wed, 19 Dec 2012 13:52:38 -0500
>> How to best/easiest range-shift lon-lat data?

Matt Landis Wed, 19 Dec 2012 14:09:57 -0500
> [raster::shift] will work, but [raster::rotate] is even easier

Thanks! Now this code-------------------------------------------------

global.proj <- CRS('+proj=longlat +ellps=WGS84')
global.raster <- brick(in.fp, varname=data.var.name, crs=global.proj)
global.raster
# class       : RasterBrick 
# dimensions  : 96, 144, 13824, 56  (nrow, ncol, ncell, nlayers)
# resolution  : 2.5, 1.894737  (x, y)
# extent      : -1.25, 358.75, -90.94737, 90.94737  (xmin, xmax, ymin, ymax)
# coord. ref. : +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0 
layers.n <- nbands(global.raster)

# make longitudes NOT zero-based
global.raster <- 
  rotate(global.raster,
    overwrite=TRUE) # else levelplot does one layer per page?
global.raster
# class       : RasterBrick 
# dimensions  : 96, 144, 13824, 56  (nrow, ncol, ncell, nlayers)
# resolution  : 2.5, 1.894737  (x, y)
# extent      : -181.25, 178.75, -90.94737, 90.94737  (xmin, xmax, ymin, ymax)
# ...

# TODO: if using rasterVis::levelplot, get names with `layerNames`
global.df <- as.data.frame(global.raster)
names(global.df) <- formatC(as.numeric(sub(x=names(global.df), pattern="X", replacement="", fixed=TRUE)), format="g", digits=sigdigs)
# debugging
summary(unlist(global.df))
#    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.
# 0.01459 0.22440 0.48350 0.36550 0.48530 0.50210
# matches known stats

global.map <- map('world', plot=FALSE)
global.map.shp <- map2SpatialLines(global.map, proj4string=global.proj)

# start plot driver
cat(sprintf(
  '%s: plotting %s (may take awhile! TODO: add progress control)\n',
  this.fn, pdf.fp))
pdf(file=pdf.fp, width=5, height=100)
# using rasterVis::levelplot, not lattice::levelplot
levelplot(global.raster,
  margin=FALSE,
  names.attr=names(global.df),
  layout=c(1,layers.n), # all layers in one "atmospheric" column
) + layer(sp.lines(global.map.shp, lwd=0.8, col='darkgray'))
dev.off()

--------------------------------------------------------------produces

https://docs.google.com/open?id=0BzDAFHgIxRzKaGhMOE5BblpEeVE

with both map hemispheres overlaying the data.

thanks all! Tom Roche <Tom_Roche at pobox.com>


From oscar.perpinan at gmail.com  Wed Dec 19 22:22:57 2012
From: oscar.perpinan at gmail.com (=?ISO-8859-1?Q?Oscar_Perpi=F1an?=)
Date: Wed, 19 Dec 2012 22:22:57 +0100
Subject: [R-sig-Geo] problems drawing a world map on a levelplot
In-Reply-To: <87r4mm3ptn.fsf@pobox.com>
References: <87txri4qyz.fsf@pobox.com>
	<CAAcGz98tv8AR1B1Maa6m8W+QJnzGZ90Lt4VUgoPajyJcb3_6nQ@mail.gmail.com>
	<CAAcGz98TG9j46ahKjFK3kiCmUE3N048-5syrwaA+tTgstP4uyw@mail.gmail.com>
	<CAAcGz98v-SRkaV04MLMou4MZ32n+7VHYtBmKnkRRVKdFfT9v5Q@mail.gmail.com>
	<CAMLL7bkTA8hBFUQxN_JTaVa-re1mBZvV5h9uehGKf_XPD=JWhg@mail.gmail.com>
	<87r4mm3ptn.fsf@pobox.com>
Message-ID: <CAMLL7bmsFy=rXOq_1e2ZgE8P12O4r1Cvn0K2HQrhJ66YhpCjpQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121219/32e0395b/attachment.pl>

From ppanday at clarku.edu  Wed Dec 19 22:34:30 2012
From: ppanday at clarku.edu (ppanday)
Date: Wed, 19 Dec 2012 13:34:30 -0800 (PST)
Subject: [R-sig-Geo] Runtime error when opening netCDF
In-Reply-To: <CANtt_hzBXSjzfUQc7Y3u4yWrPJE0n4um6C9y8yKKK1D-VTkkRQ@mail.gmail.com>
References: <C3A65516E00A294DA9B1DBF9474A0EA63CB976AC@CH1PRD0310MB356.namprd03.prod.outlook.com>
	<87obhp51kc.fsf@pobox.com>
	<CANtt_hwyR7o_L7zFoMKvr7b07xy_TbE9Sm-gS9oYZMKCn9MTUQ@mail.gmail.com>
	<1355944573164-7582021.post@n2.nabble.com>
	<CANtt_hzBXSjzfUQc7Y3u4yWrPJE0n4um6C9y8yKKK1D-VTkkRQ@mail.gmail.com>
Message-ID: <1355952870695-7582027.post@n2.nabble.com>

Robert, from what I understand, use raster package in 32-bit to open and
write as a new netCDF file (using writeRaster) and then open in 64-bit using
ncdf. This way I should be able to bypass size limit issue if I come across
large datasets.
So far, I have read the netCDF file as raster using brick() command. In my
next steps, I am trying to compute monthly anomalies of the netcdf data and
extract monthly means using another raster layer. Any suggestions regarding
these steps would be greatly appreciated.

Thanks,
Prajjwal



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Runtime-error-when-opening-netCDF-tp7582014p7582027.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From megan.evans at anu.edu.au  Thu Dec 20 00:03:13 2012
From: megan.evans at anu.edu.au (Megan Evans)
Date: Wed, 19 Dec 2012 15:03:13 -0800 (PST)
Subject: [R-sig-Geo] Raster crosstab output: -1 values?
Message-ID: <1355958193522-7582028.post@n2.nabble.com>

Hi everyone,

I'm computing a very large crosstab analysis (using the raster package) for
around 700 tiles of 25m resolution vegetation raster data. Essentially, I
want to figure out how much forest is contained within each land use, land
tenure and jurisdictional boundary (eight Australian States) over a 39 year
time period (20 years with data). 

The land tenure, land use and State layers have all been cut up into the
same extent, resolution and projection as the forest cover data. I then
create a raster stack of the forest cover, State and land tenure-use (the
latter was combined into one raster layer) tiles, and subsequently a
crosstab. This process is repeated for each tile and year (~700 loops,
taking a rather long time). The forest cover data (in this particular year -
1972) has values of only 0 and 1 (non-forest/forest). However, I'm finding
in some cases the crosstab output contains data in a "-1" category, despite
this value not being part of the original forest cover data. 

I'm at a loss to explain this; all datasets have the same number of cells,
resoluton, and no missing data. Would really appreciate any insights!

Cheers, Megan

Data details below:

Forest Cover (ttile):
class       : RasterLayer 
dimensions  : 16000, 28360, 453760000  (nrow, ncol, ncell)
resolution  : 0.00025, 0.00025  (x, y)
extent      : 112.91, 120, -28, -24  (xmin, xmax, ymin, ymax)
coord. ref. : +proj=longlat +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +no_defs 
data source :
D:/Analysis/R/Data/forestextent_reg/forest_v8_72_11/sg50/forst72.grd 
names       : layer 
values      : 0, 1  (min, max)
Raster Attribute Table
     fields : ID     COUNT
        min :  0  30065009
        max :  1 423694991

State (st_tex):
class       : RasterLayer 
dimensions  : 16000, 28360, 453760000  (nrow, ncol, ncell)
resolution  : 0.00025, 0.00025  (x, y)
extent      : 112.91, 120, -28, -24  (xmin, xmax, ymin, ymax)
coord. ref. : +proj=longlat +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +no_defs 
data source : D:/Analysis/R/Data/sttiles/forest_v8_72_11/stsg50.grd 
names       : states_p 
values      : 8, 8  (min, max)

Land Use/Tenure (lu_ten_tex):
class       : RasterLayer 
dimensions  : 16000, 28360, 453760000  (nrow, ncol, ncell)
resolution  : 0.00025, 0.00025  (x, y)
extent      : 112.91, 120, -28, -24  (xmin, xmax, ymin, ymax)
coord. ref. : +proj=longlat +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +no_defs 
data source : D:/Analysis/R/Data/lutentiles/forest_v8_72_11/lutensg50.grd 
names       : lu_ten 
values      : 1, 73  (min, max)
Raster Attribute Table
     fields : ID       COUNT
        min :  1 -1816924096
        max : 73  1681761600

Relevant code:
# Create raster stack between forestextent, lu and state
        x <-stack(ttile, lu_ten_tex, st_tex)
        
        #Crosstab will calculate the frequency of each level (0=non-forest,
1=primforest, 2=regforest) in each land use/tenure/state
        vegfreq <-crosstab(x, digits=0, long=FALSE, progress="text")

> vegfreq
, , states_p = 8

     lu_ten
layer         0         1         3        11        13        61        63       
33
   0     400975   2059222   2355223  28336430  13144612   2565663 316999241    
42855
   1      15814      1098     19824   6497248   3958995    761517  17902798      
345
   -1        11      1280       153      3522       393        20     15961        
0
     lu_ten
layer        43        73        23        53        71        51        12       
22
   0       8447     16777     64401     50205     19375     17463    334230   
664199
   1       1153      7223     66799       995     31825       137    396970   
126201
   -1         0         0         0         0         0         0         0        
0
     lu_ten
layer        62         2        32
   0     310439      1586     13062
   1     201561        14      2938
   -1         0         0         0




--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Raster-crosstab-output-1-values-tp7582028.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From fmarkham at gmail.com  Thu Dec 20 01:52:32 2012
From: fmarkham at gmail.com (Francis Markham)
Date: Thu, 20 Dec 2012 11:52:32 +1100
Subject: [R-sig-Geo] R 3.0.0 and spatial classes
Message-ID: <CACsciEhPjzDzDXb_aS4MTw2svYLQtKh4UxTNShU2-tw8MbpkyA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121220/34e71bb5/attachment.pl>

From subbu_843 at yahoo.co.in  Thu Dec 20 08:31:01 2012
From: subbu_843 at yahoo.co.in (subash)
Date: Wed, 19 Dec 2012 23:31:01 -0800 (PST)
Subject: [R-sig-Geo] Plot variograms ensembles in a single plot
Message-ID: <1355988661919-7582030.post@n2.nabble.com>

I am beginner in R.I would like to see all the varigrams ensembles of 8
months rainfall data in a single plot.  I am using autofitVariogram and
autoKrige functions.  

The following code adapted using the Paul Hiemstra trick at 
https://stat.ethz.ch/pipermail/r-sig-geo/2009-December/007109.html
<https://stat.ethz.ch/pipermail/r-sig-geo/2009-December/007109.html>   does
the job, but it plots them in * (panels)/subplots*. I want all the
variograms in a single plot.

I tried  to see the parameters in *xyplot * but could'nt find the solution.

Thanks  in advance

# Import the required libraries
library(rgdal)
library(maptools)
library(gstat)
library(sp)
library(automap)
library(XLConnect) 

remove(list=ls())

workdir = "/home/subash/MyData/KSNDMC/Homogenous Regions/2011/JJAS/"
fileName = "grd1_dly_Rainfall_JJAS2011.xls"

path_fileName = paste(workdir,fileName,sep='') #Concatenation

rawdata = readWorksheetFromFile(path_fileName,"Sheet3", region = "D1:DC123",
header = FALSE)
N = nrow(rawdata)
rain = rawdata[4:N,]

lat = as.numeric(t(rawdata[2,]))
lon = as.numeric(t(rawdata[3,]))
lonlat = cbind(lon,lat)

sp = SpatialPoints(lonlat,proj4string = CRS("+proj=longlat")) 
sp_utm = spTransform(sp, CRS("+proj=utm +zone=43N +datum=WGS84"))

av_list = list()

nRows = nrow(rain)

for (i in 1:nRows) 
{   
  irain = rain[i,]
  indx = (irain == "NaN")
  irain = irain[!indx]
  irain = as.numeric(irain)
  isallzeros = max(irain) # To take care of the cases of dry day(irain =0)
at all stations
  irain = as.data.frame(irain)
  M = nrow(irain)
    
  if (M > 5) # To avoid cases of NaN across many stations
  {
    if (!(isallzeros == 0))
    {
      print(i)
      foo_utm = sp_utm[!indx]# Removing the locations with NaN values
      data = data.frame(foo_utm,irain)
      names(data) = c("Easting","Northing","rain")
      coordinates(data) = c("Easting","Northing")  
      
      variogram = autofitVariogram(rain~1,data)
#       plot(variogram)
      av_list[[i]] = variogram       

    }

  }
}

sv_list = do.call("rbind", lapply(1:nRows, function(x) {
  sv = av_list[[x]]$exp_var
  sv$identification = as.character(x)
  return(sv)
}))

# Make a list of fitted models
model_list = lapply(av_list, function(x) x$var_model)


xyplot(gamma ~ dist|identification,sv_list,
         panel = function(...) {
         ret = variogramLine(model_list[[panel.number()]], maxdist =
max(sv_list$dist))
         llines(ret$dist, ret$gamma, col = "red")
       })



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Plot-variograms-ensembles-in-a-single-plot-tp7582030.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From Roger.Bivand at nhh.no  Thu Dec 20 09:56:36 2012
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 20 Dec 2012 09:56:36 +0100
Subject: [R-sig-Geo] R 3.0.0 and spatial classes
In-Reply-To: <CACsciEhPjzDzDXb_aS4MTw2svYLQtKh4UxTNShU2-tw8MbpkyA@mail.gmail.com>
References: <CACsciEhPjzDzDXb_aS4MTw2svYLQtKh4UxTNShU2-tw8MbpkyA@mail.gmail.com>
Message-ID: <alpine.LRH.2.02.1212200950420.11316@reclus.nhh.no>

On Thu, 20 Dec 2012, Francis Markham wrote:

> Is there interest in something like this code for generating SpatialLines?
> I use a variation of this fairly regularly:
>

If the geometry is simple, why not construct a WKT string and use 
available functions? Try:

library(rgeos)
set.seed(1)
coords.1 <- runif(10)
coords.2 <- runif(10)
crds <- paste(coords.1, coords.2)
crdstr <- paste(crds, collapse=",", sep="")
WKT <- paste("LINESTRING(", crdstr, ")", sep="")
g2 <- readWKT(WKT)
class(g2)

The same use of readWKT() of course extends to other WKT flavours.

Hope this helps,

Roger

>
> SimpleSpatialLines <- function(coords.1, coords.2, proj4string =
> CRS(as.character(NA))){
>  coords.1 <- coordinates(coords.1)
>  coords.2 <- coordinates(coords.2)
>  if (nrow(coords.1) != nrow(coords.2)) stop("coords.1 must be of same
> length as coords.2")
>  coords.both <- cbind(coords.1, coords.2)
>  coords.both <- cbind(coords.both, 1:nrow(coords.both))
>  lines <- apply(X=coords.both,
>                 MARGIN=1,
>                 FUN=function(x){
>                   Lines(list(Line(cbind(c(x[1], x[3]),
>                                         c(x[2], x[4])))),
>                         ID=x[5])})
>  SpatialLines(LinesList=lines, proj4string=proj4string)
> }
>
>
>
> Regards,
>
> Francis Markham
> Australian National University
> francis.markham at anu.edu.au
>
>
>
>
>
>
> On 17 December 2012 06:58, Barry Rowlingson <b.rowlingson at lancaster.ac.uk>wrote:
>
>> On Sun, Dec 16, 2012 at 6:53 PM, Chris English <sglish at hotmail.com> wrote:
>>>
>>> Edzer:
>>> On Tue, Jul 17, 2012 at 2:34 PM, Agustin Lobo ~ from Barry Rowlingson
>>> wrote:
>>> To convert to SpatialLines, get the coordinates and build in the
>>> usual convoluted manner:
>>>
>>> > s=data.frame(x=runif(10),y=1:10,z=rnorm(10))
>>> > coordinates(s)=~x+y
>>> > L = SpatialLines(list(Lines(list(Line(coordinates(s))),"X")))
>>> > plot(L)
>>> Convoluted is not the same as orphaned, certainly, but one gets the
>> sense that
>>> 'Line' owes its existence to matters of plotting rather than line as
>> line, independent of
>>> drawing it, and this may have some import upon line analysis and the
>> possibility of
>>> arriving at topology and dispensing with shared lines and the like.
>>
>>  "Line" is a non-spatial Line, made up from an ordered set of (x,y)
>> coordinate pairs. It cannot have a coordinate system assigned to it.
>>
>>  "Lines" is a list of Lines, making a non-spatial set of Line
>> segments. It too cannot have a coordinate system assigned.
>>
>>  "SpatialLines" is a spatial set of Lines, for when you have a number
>> of features each of which may be composed of several disconnected
>> segments. It can have a coordinate system assigned.
>>
>>  You are making a SpatialLines object where a single feature has a
>> single line segment. The slightly annoying
>> list(Lines(list(Line(...)))) dance is unavoidable because the lists
>> are necessary since the lists can have more than one element, but you
>> could easy create a 'SimpleSpatialLine' function that did all that. It
>> might even make sp for R 3.0.0! (SimpleSpatialPolygon might be handy
>> too...)
>>
>> Another possibility might be to write methods for SpatialLines that
>> takes a matrix and skips the complexity for simple cases...
>>
>> Barry
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From b.rowlingson at lancaster.ac.uk  Thu Dec 20 10:17:46 2012
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Thu, 20 Dec 2012 09:17:46 +0000
Subject: [R-sig-Geo] R 3.0.0 and spatial classes
In-Reply-To: <a7be2b485e4b42ba91862e34dc5ace3e@EX-1-HT0.lancs.local>
References: <CACsciEhPjzDzDXb_aS4MTw2svYLQtKh4UxTNShU2-tw8MbpkyA@mail.gmail.com>
	<a7be2b485e4b42ba91862e34dc5ace3e@EX-1-HT0.lancs.local>
Message-ID: <CANVKczMZTKuzvPVgeW4sUOhhn2jftjXL3EfVUba1-qu17RfCVA@mail.gmail.com>

On Thu, Dec 20, 2012 at 8:56 AM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
> On Thu, 20 Dec 2012, Francis Markham wrote:
>
>> Is there interest in something like this code for generating SpatialLines?
>> I use a variation of this fairly regularly:
>>
>
> If the geometry is simple, why not construct a WKT string and use
> available functions? Try:

 Because converting numbers to characters and then back to numbers
gives me the shivers? It seems inefficient and prone to precision
problems. I'd rather keep my numerics as numerics than be at the mercy
of a decimal representation that I don't have much control over...

Barry


From edzer.pebesma at uni-muenster.de  Thu Dec 20 15:00:19 2012
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Thu, 20 Dec 2012 15:00:19 +0100
Subject: [R-sig-Geo] Apply() function on 3rd dimension of
	SpatialGridDataFrame
In-Reply-To: <007201cdde24$093bdf00$1bb39d00$@Usherbrooke.ca>
References: <007201cdde24$093bdf00$1bb39d00$@Usherbrooke.ca>
Message-ID: <50D319F3.2080201@uni-muenster.de>

Dear Nathalie,

3D and higher-D support for Points Pixels and Grids in sp is there on
the level of object creation, but very limited on the level of useful
functionality.

apply() is not even a generic, so can only be applied to arrays,
according to ?apply. Would an as.array(clip) method for
SpatialGridDataFrame help you further? Or is it something else you need,
e.g. clipping a SpatialGridDataFrame with more than 2 dimensions?

On 12/19/2012 09:04 PM, Nathalie Morin wrote:
> Hello,
> 
>  
> 
> I have a 3D array with an attribute converted to SpatiaGridDataFrame named
> ?clip? :
> 
>  
> 
>> summary(clip)
> 
> Object of class SpatialGridDataFrame
> 
> Coordinates:
> 
>          min       max
> 
> s1 828104.00 828134.00
> 
> s2 101839.00 101869.00
> 
> s3    324.09    373.09
> 
> Is projected: TRUE
> 
> proj4string :
> 
> [+init=epsg:27561 +proj=lcc +lat_1=49.50000000000001
> +lat_0=49.50000000000001 +lon_0=0
> 
> +k_0=0.999877341 +x_0=600000 +y_0=200000 +a=6378249.2 +b=6356515
> 
> +towgs84=-168,-60,320,0,0,0,0 +pm=paris +units=m +no_defs]
> 
> Grid attributes:
> 
>    cellcentre.offset cellsize cells.dim
> 
> s1         828104.50        1        30
> 
> s2         101839.50        1        30
> 
> s3            324.59        1        49
> 
> Data attributes:
> 
>     Min.  1st Qu.   Median     Mean  3rd Qu.     Max.     NA's 
> 
>    0.000    0.000    0.000    0.002    0.000    0.806 9506.000
> 
>  
> 
> The apply() function does not work on the 3rd dimension of the
> SpatiaGridDataFrame :
> 
>  
> 
>> D.tls.z.mean <- apply(clip, 3, mean, na.rm=T)
> 
>  
> 
> => I get an error message (sorry it's in French) :
> 
> "Erreur dans if (d2 == 0L) { : valeur manquante l? o? TRUE / FALSE est
> requis"
> 
>  
> 
> I tried with z coordinate instead :
> 
>> z <- coordinates(clip)[,3]
> 
>> D.tls.z.mean <- apply(clip, z, mean, na.rm=T)
> 
>  
> 
> The only solution I found is to convert back to standard non spatial 3D
> array.
> 
>  
> 
> Cheers,
> 
>  
> 
> Nathalie MORIN
> 
> Doctorante en t?l?d?tection foresti?re (Ph.D student in remote sensing
> applied to forestry)
> 
> Centre d?application et de recherches en t?l?d?tection (CARTEL)
> 
> D?partement de G?omatique Appliqu?e
> 
> Sherbrooke (QC) CANADA J1K 2R1
> 
> T?l. : + 1 (819)  821-8000 #62962
> 
> e-mail :  <mailto:Nathalie.M.Morin at Usherbrooke.ca>
> Nathalie.M.Morin at Usherbrooke.ca
> 
>  <http://www.usherbrooke.ca/> Universit? de Sherbrooke
> 
>  
> 
> 
> 
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From lyndon.estes at gmail.com  Thu Dec 20 16:01:13 2012
From: lyndon.estes at gmail.com (Lyndon Estes)
Date: Thu, 20 Dec 2012 10:01:13 -0500
Subject: [R-sig-Geo] Raster crosstab output: -1 values?
In-Reply-To: <1355958193522-7582028.post@n2.nabble.com>
References: <1355958193522-7582028.post@n2.nabble.com>
Message-ID: <CALuVVaZUvow6oksZ-0ZTdSyVys2VuK+xn3UVdkVR2jBhYqRDmA@mail.gmail.com>

Hi Megan,

Can you give some steps on how you prepared the data before stacking?
Was there any resampling, reprojecting, etc. involved in your forest
cover layer?  I have had similar results with rasters in the past
where NA values were represented by negative numbers.  What might have
happened is a relatively large negative number (in absolute terms) was
resampled down to a small one (in absolute terms) with the default
setting at bilinear, e.g.

resample(x)

But that's just a guess without knowing your processing steps.

Best, Lyndon

On Wed, Dec 19, 2012 at 6:03 PM, Megan Evans <megan.evans at anu.edu.au> wrote:
> Hi everyone,
>
> I'm computing a very large crosstab analysis (using the raster package) for
> around 700 tiles of 25m resolution vegetation raster data. Essentially, I
> want to figure out how much forest is contained within each land use, land
> tenure and jurisdictional boundary (eight Australian States) over a 39 year
> time period (20 years with data).
>
> The land tenure, land use and State layers have all been cut up into the
> same extent, resolution and projection as the forest cover data. I then
> create a raster stack of the forest cover, State and land tenure-use (the
> latter was combined into one raster layer) tiles, and subsequently a
> crosstab. This process is repeated for each tile and year (~700 loops,
> taking a rather long time). The forest cover data (in this particular year -
> 1972) has values of only 0 and 1 (non-forest/forest). However, I'm finding
> in some cases the crosstab output contains data in a "-1" category, despite
> this value not being part of the original forest cover data.
>
> I'm at a loss to explain this; all datasets have the same number of cells,
> resoluton, and no missing data. Would really appreciate any insights!
>
> Cheers, Megan
>
> Data details below:
>
> Forest Cover (ttile):
> class       : RasterLayer
> dimensions  : 16000, 28360, 453760000  (nrow, ncol, ncell)
> resolution  : 0.00025, 0.00025  (x, y)
> extent      : 112.91, 120, -28, -24  (xmin, xmax, ymin, ymax)
> coord. ref. : +proj=longlat +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +no_defs
> data source :
> D:/Analysis/R/Data/forestextent_reg/forest_v8_72_11/sg50/forst72.grd
> names       : layer
> values      : 0, 1  (min, max)
> Raster Attribute Table
>      fields : ID     COUNT
>         min :  0  30065009
>         max :  1 423694991
>
> State (st_tex):
> class       : RasterLayer
> dimensions  : 16000, 28360, 453760000  (nrow, ncol, ncell)
> resolution  : 0.00025, 0.00025  (x, y)
> extent      : 112.91, 120, -28, -24  (xmin, xmax, ymin, ymax)
> coord. ref. : +proj=longlat +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +no_defs
> data source : D:/Analysis/R/Data/sttiles/forest_v8_72_11/stsg50.grd
> names       : states_p
> values      : 8, 8  (min, max)
>
> Land Use/Tenure (lu_ten_tex):
> class       : RasterLayer
> dimensions  : 16000, 28360, 453760000  (nrow, ncol, ncell)
> resolution  : 0.00025, 0.00025  (x, y)
> extent      : 112.91, 120, -28, -24  (xmin, xmax, ymin, ymax)
> coord. ref. : +proj=longlat +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +no_defs
> data source : D:/Analysis/R/Data/lutentiles/forest_v8_72_11/lutensg50.grd
> names       : lu_ten
> values      : 1, 73  (min, max)
> Raster Attribute Table
>      fields : ID       COUNT
>         min :  1 -1816924096
>         max : 73  1681761600
>
> Relevant code:
> # Create raster stack between forestextent, lu and state
>         x <-stack(ttile, lu_ten_tex, st_tex)
>
>         #Crosstab will calculate the frequency of each level (0=non-forest,
> 1=primforest, 2=regforest) in each land use/tenure/state
>         vegfreq <-crosstab(x, digits=0, long=FALSE, progress="text")
>
>> vegfreq
> , , states_p = 8
>
>      lu_ten
> layer         0         1         3        11        13        61        63
> 33
>    0     400975   2059222   2355223  28336430  13144612   2565663 316999241
> 42855
>    1      15814      1098     19824   6497248   3958995    761517  17902798
> 345
>    -1        11      1280       153      3522       393        20     15961
> 0
>      lu_ten
> layer        43        73        23        53        71        51        12
> 22
>    0       8447     16777     64401     50205     19375     17463    334230
> 664199
>    1       1153      7223     66799       995     31825       137    396970
> 126201
>    -1         0         0         0         0         0         0         0
> 0
>      lu_ten
> layer        62         2        32
>    0     310439      1586     13062
>    1     201561        14      2938
>    -1         0         0         0
>
>
>
>
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Raster-crosstab-output-1-values-tp7582028.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From evberghe at gmail.com  Thu Dec 20 18:34:29 2012
From: evberghe at gmail.com (Edward Vanden Berghe)
Date: Thu, 20 Dec 2012 18:34:29 +0100
Subject: [R-sig-Geo]  reading PostGIS table into sp data frame
Message-ID: <005501cdded8$449ec350$cddc49f0$@gmail.com>

Thanks!

Unfortunately I have no luck trying to get readOGR to work directly with the PostGIS database. I tried different variations:

> sp.object <- readOGR(dsn="PG:dbname=...
> sp.object <- readOGR(dsn="my_dsn" ... [where my_dsn is a Windows system dsn]
> sp.object <- readOGR(dsn="PG:my_dsn" ...

all result in the same error message:

	Error in ogrInfo(dsn = dsn, layer = layer, input_field_name_encoding = input_field_name_encoding) : 
	  Cannot open file

Another variation, 

> sp.object <- readOGR(dsn="ODBC:my_dsn" ...

Results in 

	Error in ogrInfo(dsn = dsn, layer = layer, input_field_name_encoding = input_field_name_encoding) : 
	  Multiple # dimensions:

though all he geometries are 2d, and there is a constraint enforcing this in the database. 

It seems rgdal is properly installed: I can use readOGR to read shape files (and this, actually, resolves my problem, as I can use this as a work-around); also, ogrDrivers() returns a list of 43 drivers (but PG, PostgreSQL or PostGIS are not among these; ESRI Shapefile and ODBC are). 

I have no problems connecting to the PostgreSQL database using either DBI/RPostgreSQL, or RODBC (the latter with the same Windows system DSN that I used for the tests above). I am not familiar with GDAL, don't know how to try and connect to the PostgreSQL database from GDAL directly, rather than through rgdal.

Again, any insight in what might go wrong would be most appreciated.

Cheers,

Edward

Message: 4
Date: Wed, 19 Dec 2012 14:58:52 +0100
From: Raffaele Morelli <raffaele.morelli at gmail.com>
To: r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] reading PostGIS table into sp data frame
Message-ID:
	<CAD4guxOt5fSUPbK4VbbPuZf-oTBrcY-UvNPcguvUYt4qS0+_kQ at mail.gmail.com>
Content-Type: text/plain

2012/12/19 Edward Vanden Berghe <evberghe at gmail.com>

> I wanted to create a global map with squares in lat-lon. I have PostGIS
> tables to define these squares  but I havent been able to figure out an
> efficient way of reading those tables into R. The code I am using now is:
>
>        crs <- CRS("+proj=longlat +ellps=WGS84")
>        s <- paste("select id, st_astext(geom) as geom from geo.cs10d";",
> sep="")
>        r <- dbGetQuery(con, s)
>        p <- readWKT(r$geom[1],id=r$id[1],p4s=crs)
>        for(i in 2:length(r$id)){
>               p <- rbind(p, readWKT(r$geom[i], id=r$id[i], p4s=crs))
>        }
>
> where geo.cs10d is the table with squares, id the primary key of the
> table, and geom the binary geometry field.
>
> The code above works fine for the larger squares, such as 10 degrees, of
> which I only need 648 to cover the globe. For finer resolutions, the above
> takes just too long  I assume because the rbind function rewrites the
> whole sp object each time it executes. Ive seen other R scripts that
> initiate an empty data frame of the correct length to go round similar
> problems with the rbind function; I havent been able to find an equivalent
> for spatial polygons. How can I initiate an empty data frame with the right
> structure, and the right length?
>
> A preferable solution would be if there would be a single function to load
> a complete PostGIS table, rather than having to load the polygons one by
> one in a loop. Is there such a function?
>
> Im using PostgreSQL 8.4, PostGIS 1.5, R 2.15.2, platform
> x86_64-w64-mingw32; IDE is StatET 3.0.1 plugin for Eclipse 3.7.2.
>
> Any help would be much appreciated.
>
> Edward
>

Use postgis st_transfom to convert your table in epsg:4326, I would suggest
to use a view for that.
Then use readOGR (in package rgdal) to read the table/view (geom and
attributes) in a sp object with :

sp.object <- readOGR("PG:dbname=your_db host=your_host user=username
password=xxx", "geo.cs10d ")

regards
-r


-- 
*L'unica speranza di catarsi, ammesso che ne esista una, resta affidata
all'istinto di ribellione, alla rivolta non isterilita in progetti, alla
protesta violenta e viscerale. (V. Evangelisti)
*

	[[alternative HTML version deleted]]


From Nathalie.M.Morin at usherbrooke.ca  Thu Dec 20 19:56:22 2012
From: Nathalie.M.Morin at usherbrooke.ca (Nathalie Morin)
Date: Thu, 20 Dec 2012 10:56:22 -0800 (PST)
Subject: [R-sig-Geo] Apply() function on 3rd dimension of
	SpatialGridDataFrame
In-Reply-To: <50D319F3.2080201@uni-muenster.de>
References: <007201cdde24$093bdf00$1bb39d00$@Usherbrooke.ca>
	<50D319F3.2080201@uni-muenster.de>
Message-ID: <1356029782244-7582036.post@n2.nabble.com>

Dear Edzer,

1) as.array()
/"Would an as.array(clip) method for
SpatialGridDataFrame help you further?"/

Yes, as I mentionned in my initial post :
/"The only solution I found is to convert back to standard non spatial 3D
array."/
(in order to make the apply() function work on my 3rd dimension or z layer)

I still encounter a problem though :

D.tls.SPGDF <- SpatialGridDataFrame(D.tls.SPG, D.tls.DF)

buffer <- readOGR("donnees/limites", layer="bure_106_buffer")
buffer.proj <- spTransform(buffer, CRS("+init=epsg:27561"))
g <- geometry(buffer.proj)

fullgrid(D.tls.SPGDF) = FALSE
clip <- D.tls.SPGDF[g,,drop=TRUE] 
fullgrid(clip) = TRUE

A <- as.array(clip$d)
DA <- apply(A, 3, mean, na.rm=T)
=> gives an error message related to a missing value where TRUE / FALSE is
required
"Erreur dans if (d2 == 0L) { : valeur manquante l? o? TRUE / FALSE est
requis"

I suspect this could be related to the fullgrid() ?
Any hint ?

2) /Or is it something else you need,
e.g. clipping a SpatialGridDataFrame with more than 2 dimensions? /

This is another story ! For the moment, I do not need a convex hull because
I do not want to truncate the height information on the z axis. But this is
an interesting question. I should probably open a separate post for that.










--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Apply-function-on-3rd-dimension-of-SpatialGridDataFrame-tp7582023p7582036.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From Nathalie.M.Morin at Usherbrooke.ca  Thu Dec 20 20:08:33 2012
From: Nathalie.M.Morin at Usherbrooke.ca (Nathalie Morin)
Date: Thu, 20 Dec 2012 14:08:33 -0500
Subject: [R-sig-Geo] Convex hull clip on 3D Spatial Objects
Message-ID: <006d01cddee5$680382b0$380a8810$@Usherbrooke.ca>

Hello !

 

Does sp handle clipping 3D Spatial Objects such as a convex hull envelope
around SpatialPoints or SpatialGrids ?

 

Cheers,

 

Nathalie MORIN

Doctorante en t?l?d?tection foresti?re (Ph.D student in remote sensing
applied to forestry)

Centre d?application et de recherches en t?l?d?tection (CARTEL)

D?partement de G?omatique Appliqu?e

Sherbrooke (QC) CANADA J1K 2R1

T?l. : + 1 (819)  821-8000 #62962

e-mail :  <mailto:Nathalie.M.Morin at Usherbrooke.ca>
Nathalie.M.Morin at Usherbrooke.ca

 <http://www.usherbrooke.ca/> Universit? de Sherbrooke

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121220/1a27eb2a/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/gif
Size: 1245 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121220/1a27eb2a/attachment.gif>

From Roger.Bivand at nhh.no  Thu Dec 20 20:57:55 2012
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 20 Dec 2012 20:57:55 +0100
Subject: [R-sig-Geo] reading PostGIS table into sp data frame
In-Reply-To: <005501cdded8$449ec350$cddc49f0$@gmail.com>
References: <005501cdded8$449ec350$cddc49f0$@gmail.com>
Message-ID: <alpine.LRH.2.02.1212202053130.13083@reclus.nhh.no>

On Thu, 20 Dec 2012, Edward Vanden Berghe wrote:

> Thanks!
>
> Unfortunately I have no luck trying to get readOGR to work directly with 
> the PostGIS database. I tried different variations:

Did you check whether your rgdal/GDAL supports the PostGIS driver? Did you 
look at the output of ogrDrivers()? If you did not install rgdal as a 
source package built against a GDAL that has the PostGIS driver on your 
platform (maybe OSGeo4W??), but are using the standard CRAN Windows binary 
package, then it is simply the case that the driver is not supported. On 
OSX using the Kyngchaos frameworks, or on Linux, this would be simple, but 
it isn't simple on Windows. You need to establish how rgdal was installed 
and report that.

Hope this clarifies,

Roger

>
>> sp.object <- readOGR(dsn="PG:dbname=...
>> sp.object <- readOGR(dsn="my_dsn" ... [where my_dsn is a Windows system dsn]
>> sp.object <- readOGR(dsn="PG:my_dsn" ...
>
> all result in the same error message:
>
> 	Error in ogrInfo(dsn = dsn, layer = layer, input_field_name_encoding = input_field_name_encoding) :
> 	  Cannot open file
>
> Another variation,
>
>> sp.object <- readOGR(dsn="ODBC:my_dsn" ...
>
> Results in
>
> 	Error in ogrInfo(dsn = dsn, layer = layer, input_field_name_encoding = input_field_name_encoding) :
> 	  Multiple # dimensions:
>
> though all he geometries are 2d, and there is a constraint enforcing 
> this in the database.
>
> It seems rgdal is properly installed: I can use readOGR to read shape 
> files (and this, actually, resolves my problem, as I can use this as a 
> work-around); also, ogrDrivers() returns a list of 43 drivers (but PG, 
> PostgreSQL or PostGIS are not among these; ESRI Shapefile and ODBC are).
>
> I have no problems connecting to the PostgreSQL database using either 
> DBI/RPostgreSQL, or RODBC (the latter with the same Windows system DSN 
> that I used for the tests above). I am not familiar with GDAL, don't 
> know how to try and connect to the PostgreSQL database from GDAL 
> directly, rather than through rgdal.
>
> Again, any insight in what might go wrong would be most appreciated.
>
> Cheers,
>
> Edward
>
> Message: 4
> Date: Wed, 19 Dec 2012 14:58:52 +0100
> From: Raffaele Morelli <raffaele.morelli at gmail.com>
> To: r-sig-geo at r-project.org
> Subject: Re: [R-sig-Geo] reading PostGIS table into sp data frame
> Message-ID:
> 	<CAD4guxOt5fSUPbK4VbbPuZf-oTBrcY-UvNPcguvUYt4qS0+_kQ at mail.gmail.com>
> Content-Type: text/plain
>
> 2012/12/19 Edward Vanden Berghe <evberghe at gmail.com>
>
>> I wanted to create a global map with squares in lat-lon. I have PostGIS
>> tables to define these squares  but I havent been able to figure out an
>> efficient way of reading those tables into R. The code I am using now is:
>>
>>        crs <- CRS("+proj=longlat +ellps=WGS84")
>>        s <- paste("select id, st_astext(geom) as geom from geo.cs10d";",
>> sep="")
>>        r <- dbGetQuery(con, s)
>>        p <- readWKT(r$geom[1],id=r$id[1],p4s=crs)
>>        for(i in 2:length(r$id)){
>>               p <- rbind(p, readWKT(r$geom[i], id=r$id[i], p4s=crs))
>>        }
>>
>> where geo.cs10d is the table with squares, id the primary key of the
>> table, and geom the binary geometry field.
>>
>> The code above works fine for the larger squares, such as 10 degrees, of
>> which I only need 648 to cover the globe. For finer resolutions, the above
>> takes just too long  I assume because the rbind function rewrites the
>> whole sp object each time it executes. Ive seen other R scripts that
>> initiate an empty data frame of the correct length to go round similar
>> problems with the rbind function; I havent been able to find an equivalent
>> for spatial polygons. How can I initiate an empty data frame with the right
>> structure, and the right length?
>>
>> A preferable solution would be if there would be a single function to load
>> a complete PostGIS table, rather than having to load the polygons one by
>> one in a loop. Is there such a function?
>>
>> Im using PostgreSQL 8.4, PostGIS 1.5, R 2.15.2, platform
>> x86_64-w64-mingw32; IDE is StatET 3.0.1 plugin for Eclipse 3.7.2.
>>
>> Any help would be much appreciated.
>>
>> Edward
>>
>
> Use postgis st_transfom to convert your table in epsg:4326, I would suggest
> to use a view for that.
> Then use readOGR (in package rgdal) to read the table/view (geom and
> attributes) in a sp object with :
>
> sp.object <- readOGR("PG:dbname=your_db host=your_host user=username
> password=xxx", "geo.cs10d ")
>
> regards
> -r
>
>
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From emptican at gmail.com  Thu Dec 20 22:09:32 2012
From: emptican at gmail.com (SH)
Date: Thu, 20 Dec 2012 16:09:32 -0500
Subject: [R-sig-Geo] DCluster package
Message-ID: <CALSKosAE38ThmJkOqiRzKYTWj10LCPvXVohUxN27iXOi=Nk6Lw@mail.gmail.com>

Hi List:

I noticed that 'DCluster' package is not available any more while I
self-study 'Applied Spatial Data Analysis with R'.  Is there an
alternative?

Thanks,

SH


From edzer.pebesma at uni-muenster.de  Thu Dec 20 22:12:01 2012
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Thu, 20 Dec 2012 22:12:01 +0100
Subject: [R-sig-Geo] Apply() function on 3rd dimension of
	SpatialGridDataFrame
In-Reply-To: <1356029782244-7582036.post@n2.nabble.com>
References: <007201cdde24$093bdf00$1bb39d00$@Usherbrooke.ca>
	<50D319F3.2080201@uni-muenster.de>
	<1356029782244-7582036.post@n2.nabble.com>
Message-ID: <50D37F21.60103@uni-muenster.de>



On 12/20/2012 07:56 PM, Nathalie Morin wrote:
> Dear Edzer,
> 
> 1) as.array()
> /"Would an as.array(clip) method for
> SpatialGridDataFrame help you further?"/
> 
> Yes, as I mentionned in my initial post :
> /"The only solution I found is to convert back to standard non spatial 3D
> array."/
> (in order to make the apply() function work on my 3rd dimension or z layer)
> 
> I still encounter a problem though :
> 
> D.tls.SPGDF <- SpatialGridDataFrame(D.tls.SPG, D.tls.DF)
> 
> buffer <- readOGR("donnees/limites", layer="bure_106_buffer")
> buffer.proj <- spTransform(buffer, CRS("+init=epsg:27561"))
> g <- geometry(buffer.proj)
> 
> fullgrid(D.tls.SPGDF) = FALSE
> clip <- D.tls.SPGDF[g,,drop=TRUE] 
> fullgrid(clip) = TRUE
> 
> A <- as.array(clip$d)
> DA <- apply(A, 3, mean, na.rm=T)
> => gives an error message related to a missing value where TRUE / FALSE is
> required
> "Erreur dans if (d2 == 0L) { : valeur manquante l? o? TRUE / FALSE est
> requis"
> 
> I suspect this could be related to the fullgrid() ?

No, you should inspect A, check dim(A) and find out that it is a
one-dimensional array;

apply(array(1:3), 3, mean)

triggers the same error.

as.array(clip) will only work if you add the appropriate as.array
method, e.g.

as.array.SpatialGridDataFrame = function(x,...) {
    d = gridparameters(x)$cells.dim
    if (ncol(x at data) > 1)
        d = c(d, ncol(x at data))
    array(do.call(c, x at data), dim = d)
}

then, as.array(clip) will return a 3 or 4 dimensional array (4 if clip
has more than one attribute).

Note that this function produces an array for which y decreases with
increasing index, all other dimensions increase with increasing index.

I will add this method to sp.

> 
> 2) /Or is it something else you need,
> e.g. clipping a SpatialGridDataFrame with more than 2 dimensions? /
> 
> This is another story ! For the moment, I do not need a convex hull because
> I do not want to truncate the height information on the z axis. But this is
> an interesting question. I should probably open a separate post for that.
> 
> 
> 
> 
> 
> 
> 
> 
> 
> 
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Apply-function-on-3rd-dimension-of-SpatialGridDataFrame-tp7582023p7582036.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From edzer.pebesma at uni-muenster.de  Thu Dec 20 22:17:01 2012
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Thu, 20 Dec 2012 22:17:01 +0100
Subject: [R-sig-Geo] Convex hull clip on 3D Spatial Objects
In-Reply-To: <006d01cddee5$680382b0$380a8810$@Usherbrooke.ca>
References: <006d01cddee5$680382b0$380a8810$@Usherbrooke.ca>
Message-ID: <50D3804D.2020203@uni-muenster.de>



On 12/20/2012 08:08 PM, Nathalie Morin wrote:
> Hello !
> 
>  
> 
> Does sp handle clipping 3D Spatial Objects such as a convex hull envelope
> around SpatialPoints or SpatialGrids ?

more-dimensional grids can be 'clipped' by 2D objects:

library(sp)
# 10 x 20 x 30 grid:
sgdim = c(10,20,30)
SG = SpatialGrid(GridTopology(rep(0,3), rep(10, 3), sgdim))
SGDF = SpatialGridDataFrame(SG, data.frame(val = rnorm(prod(sgdim))))
image(SGDF, axes=TRUE,col = 'grey')
pol = cbind(c(0,50,50,0,0),c(0,0,50,50,0))
lines(pol)
p = Polygon(pol)
sp = SpatialPolygons(list(Polygons(list(p), "p")))
image(SGDF[sp,], axes=TRUE, add=TRUE)
plot(sp, col='#88888888',add=TRUE)

but not by 3D objects. We have no Spatial* classes yet to represent
convex hulls in more than 2D.


> 
>  
> 
> Cheers,
> 
>  
> 
> Nathalie MORIN
> 
> Doctorante en t?l?d?tection foresti?re (Ph.D student in remote sensing
> applied to forestry)
> 
> Centre d?application et de recherches en t?l?d?tection (CARTEL)
> 
> D?partement de G?omatique Appliqu?e
> 
> Sherbrooke (QC) CANADA J1K 2R1
> 
> T?l. : + 1 (819)  821-8000 #62962
> 
> e-mail :  <mailto:Nathalie.M.Morin at Usherbrooke.ca>
> Nathalie.M.Morin at Usherbrooke.ca
> 
>  <http://www.usherbrooke.ca/> Universit? de Sherbrooke
> 
>  
> 
> 
> 
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From subbu_843 at yahoo.co.in  Fri Dec 21 11:03:19 2012
From: subbu_843 at yahoo.co.in (subash)
Date: Fri, 21 Dec 2012 02:03:19 -0800 (PST)
Subject: [R-sig-Geo] STFDF object error
Message-ID: <1356084199938-7582048.post@n2.nabble.com>

Hi! all,


I am a beginner in R running the a tutorial script of Spatio-Temporal
Geostatistics GESTAT 2012. The data is provided at 
http://www.geostat-course.org/Topic_Graeler
<http://www.geostat-course.org/Topic_Graeler>  . It get the below error.

Any help would be appreciated.

Thanks in advance...

str(ger_gridded at data)
str(ger_june)

spplot(ger_gridded,"altitude",col.regions=terrain.colors(30))

stplot(ger_june[1:4,1:30,c("EMEP")], mode="xt")
*
error in stplot(ger_june[1:4, 1:30, c("EMEP")], mode = "xt") : 
  error in evaluating the argument 'obj' in selecting a method for function
'stplot': Error in ger_june[1:4, 1:30, c("EMEP")] : 
  no slot of name "endTime" for this object of class "STFDF"*



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/STFDF-object-error-tp7582048.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From ben.graeler at uni-muenster.de  Fri Dec 21 11:33:54 2012
From: ben.graeler at uni-muenster.de (=?ISO-8859-1?Q?Benedikt_Gr=E4ler?=)
Date: Fri, 21 Dec 2012 11:33:54 +0100
Subject: [R-sig-Geo] STFDF object error
In-Reply-To: <1356084199938-7582048.post@n2.nabble.com>
References: <1356084199938-7582048.post@n2.nabble.com>
Message-ID: <50D43B12.3060606@uni-muenster.de>

Dear subash,

this error is due to a change in the structure of ST*DF in the spacetime 
package that occurred after the RData-file has been saved and published. 
The immediate workaround are the following two lines:

# selecting a subset of data columns from the spatial slot
# (as non unique column names occur)
ger_june at sp <- ger_june at sp[,1:8]

# reconstructing the STFDF, the newly introduced slot endTime will
# automatically be created
ger_june <- STFDF(ger_june at sp, ger_june at time, ger_june at data)

However, I'll update the zip-file at geostat-course.org as well - thanks 
for letting me know.

Best wishes,

  Ben


On 21.12.2012 11:03, subash wrote:
> Hi! all,
>
>
> I am a beginner in R running the a tutorial script of Spatio-Temporal
> Geostatistics GESTAT 2012. The data is provided at
> http://www.geostat-course.org/Topic_Graeler
> <http://www.geostat-course.org/Topic_Graeler>  . It get the below error.
>
> Any help would be appreciated.
>
> Thanks in advance...
>
> str(ger_gridded at data)
> str(ger_june)
>
> spplot(ger_gridded,"altitude",col.regions=terrain.colors(30))
>
> stplot(ger_june[1:4,1:30,c("EMEP")], mode="xt")
> *
> error in stplot(ger_june[1:4, 1:30, c("EMEP")], mode = "xt") :
>    error in evaluating the argument 'obj' in selecting a method for function
> 'stplot': Error in ger_june[1:4, 1:30, c("EMEP")] :
>    no slot of name "endTime" for this object of class "STFDF"*
>
>
>
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/STFDF-object-error-tp7582048.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Benedikt Gr?ler

ifgi - Institute for Geoinformatics
University of Muenster

http://ifgi.uni-muenster.de/graeler

Phone: +49 251 83-33082
Mail: ben.graeler at uni-muenster.de


From evberghe at gmail.com  Fri Dec 21 11:41:49 2012
From: evberghe at gmail.com (Edward Vanden Berghe)
Date: Fri, 21 Dec 2012 11:41:49 +0100
Subject: [R-sig-Geo] reading PostGIS table into sp data frame
In-Reply-To: <alpine.LRH.2.02.1212202053130.13083@reclus.nhh.no>
References: <005501cdded8$449ec350$cddc49f0$@gmail.com>
	<alpine.LRH.2.02.1212202053130.13083@reclus.nhh.no>
Message-ID: <002301cddf67$c8f223b0$5ad66b10$@gmail.com>

The GDAL was installed from www.gisinternals.com/sdk; I installed the 32 bits version, though my Windows version is 64: the table on gisinternals.com stated that there was a build problem with the 64-bits version.

rgdal was installed from CRAN, as a binary, version 0.7-20, build 2.15.1. R version is 2.15.2 (2012-10-26) -- "Trick or Treat", platform x86_64-w64-mingw32/x64 (64-bit).

The output from ogrDrivers() is pasted below.

If I understand you correctly, and since I am using the standard CRAN Windows binary package, I might be out of luck?

Cheers,

Edward

Output from ogrDrivers():

             name write
1      AeronavFAA FALSE
2          ARCGEN FALSE
3          AVCBin FALSE
4          AVCE00 FALSE
5             BNA  TRUE
6             CSV  TRUE
7             DGN  TRUE
8             DXF  TRUE
9          EDIGEO FALSE
10 ESRI Shapefile  TRUE
11     Geoconcept  TRUE
12        GeoJSON  TRUE
13       Geomedia FALSE
14         GeoRSS  TRUE
15            GML  TRUE
16            GMT  TRUE
17       GPSBabel  TRUE
18  GPSTrackMaker  TRUE
19            GPX  TRUE
20            HTF FALSE
21         Idrisi FALSE
22            KML  TRUE
23   MapInfo File  TRUE
24         Memory  TRUE
25   MSSQLSpatial  TRUE
26           ODBC  TRUE
27        OpenAir FALSE
28         PCIDSK  TRUE
29            PDS FALSE
30         PGDump  TRUE
31           PGeo FALSE
32            REC FALSE
33            S57  TRUE
34           SDTS FALSE
35       SEGUKOOA FALSE
36           SEGY FALSE
37            SUA FALSE
38            SVG FALSE
39          TIGER  TRUE
40        UK .NTF FALSE
41            VFK FALSE
42            VRT FALSE
43         XPlane FALSE

-----Original Message-----
From: Roger Bivand [mailto:Roger.Bivand at nhh.no] 
Sent: 20 December 2012 20:58
To: Edward Vanden Berghe
Cc: r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] reading PostGIS table into sp data frame

On Thu, 20 Dec 2012, Edward Vanden Berghe wrote:

> Thanks!
>
> Unfortunately I have no luck trying to get readOGR to work directly 
> with the PostGIS database. I tried different variations:

Did you check whether your rgdal/GDAL supports the PostGIS driver? Did you look at the output of ogrDrivers()? If you did not install rgdal as a source package built against a GDAL that has the PostGIS driver on your platform (maybe OSGeo4W??), but are using the standard CRAN Windows binary package, then it is simply the case that the driver is not supported. On OSX using the Kyngchaos frameworks, or on Linux, this would be simple, but it isn't simple on Windows. You need to establish how rgdal was installed and report that.

Hope this clarifies,

Roger

>
>> sp.object <- readOGR(dsn="PG:dbname=...
>> sp.object <- readOGR(dsn="my_dsn" ... [where my_dsn is a Windows 
>> system dsn] sp.object <- readOGR(dsn="PG:my_dsn" ...
>
> all result in the same error message:
>
> 	Error in ogrInfo(dsn = dsn, layer = layer, input_field_name_encoding = input_field_name_encoding) :
> 	  Cannot open file
>
> Another variation,
>
>> sp.object <- readOGR(dsn="ODBC:my_dsn" ...
>
> Results in
>
> 	Error in ogrInfo(dsn = dsn, layer = layer, input_field_name_encoding = input_field_name_encoding) :
> 	  Multiple # dimensions:
>
> though all he geometries are 2d, and there is a constraint enforcing 
> this in the database.
>
> It seems rgdal is properly installed: I can use readOGR to read shape 
> files (and this, actually, resolves my problem, as I can use this as a 
> work-around); also, ogrDrivers() returns a list of 43 drivers (but PG, 
> PostgreSQL or PostGIS are not among these; ESRI Shapefile and ODBC are).
>
> I have no problems connecting to the PostgreSQL database using either 
> DBI/RPostgreSQL, or RODBC (the latter with the same Windows system DSN 
> that I used for the tests above). I am not familiar with GDAL, don't 
> know how to try and connect to the PostgreSQL database from GDAL 
> directly, rather than through rgdal.
>
> Again, any insight in what might go wrong would be most appreciated.
>
> Cheers,
>
> Edward
>
> Message: 4
> Date: Wed, 19 Dec 2012 14:58:52 +0100
> From: Raffaele Morelli <raffaele.morelli at gmail.com>
> To: r-sig-geo at r-project.org
> Subject: Re: [R-sig-Geo] reading PostGIS table into sp data frame
> Message-ID:
> 	<CAD4guxOt5fSUPbK4VbbPuZf-oTBrcY-UvNPcguvUYt4qS0+_kQ at mail.gmail.com>
> Content-Type: text/plain
>
> 2012/12/19 Edward Vanden Berghe <evberghe at gmail.com>
>
>> I wanted to create a global map with squares in lat-lon. I have 
>> PostGIS tables to define these squares  but I havent been able to 
>> figure out an efficient way of reading those tables into R. The code I am using now is:
>>
>>        crs <- CRS("+proj=longlat +ellps=WGS84")
>>        s <- paste("select id, st_astext(geom) as geom from 
>> geo.cs10d";",
>> sep="")
>>        r <- dbGetQuery(con, s)
>>        p <- readWKT(r$geom[1],id=r$id[1],p4s=crs)
>>        for(i in 2:length(r$id)){
>>               p <- rbind(p, readWKT(r$geom[i], id=r$id[i], p4s=crs))
>>        }
>>
>> where geo.cs10d is the table with squares, id the primary key of the 
>> table, and geom the binary geometry field.
>>
>> The code above works fine for the larger squares, such as 10 degrees, 
>> of which I only need 648 to cover the globe. For finer resolutions, 
>> the above takes just too long  I assume because the rbind function 
>> rewrites the whole sp object each time it executes. Ive seen other R 
>> scripts that initiate an empty data frame of the correct length to go 
>> round similar problems with the rbind function; I havent been able 
>> to find an equivalent for spatial polygons. How can I initiate an 
>> empty data frame with the right structure, and the right length?
>>
>> A preferable solution would be if there would be a single function to 
>> load a complete PostGIS table, rather than having to load the 
>> polygons one by one in a loop. Is there such a function?
>>
>> Im using PostgreSQL 8.4, PostGIS 1.5, R 2.15.2, platform 
>> x86_64-w64-mingw32; IDE is StatET 3.0.1 plugin for Eclipse 3.7.2.
>>
>> Any help would be much appreciated.
>>
>> Edward
>>
>
> Use postgis st_transfom to convert your table in epsg:4326, I would 
> suggest to use a view for that.
> Then use readOGR (in package rgdal) to read the table/view (geom and
> attributes) in a sp object with :
>
> sp.object <- readOGR("PG:dbname=your_db host=your_host user=username 
> password=xxx", "geo.cs10d ")
>
> regards
> -r
>
>
>

--
Roger Bivand
Department of Economics, NHH Norwegian School of Economics, Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From edzer.pebesma at uni-muenster.de  Fri Dec 21 12:15:47 2012
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Fri, 21 Dec 2012 12:15:47 +0100
Subject: [R-sig-Geo] reading PostGIS table into sp data frame
In-Reply-To: <002301cddf67$c8f223b0$5ad66b10$@gmail.com>
References: <005501cdded8$449ec350$cddc49f0$@gmail.com>
	<alpine.LRH.2.02.1212202053130.13083@reclus.nhh.no>
	<002301cddf67$c8f223b0$5ad66b10$@gmail.com>
Message-ID: <50D444E3.6010507@uni-muenster.de>



On 12/21/2012 11:41 AM, Edward Vanden Berghe wrote:
> The GDAL was installed from www.gisinternals.com/sdk; I installed the 32 bits version, though my Windows version is 64: the table on gisinternals.com stated that there was a build problem with the 64-bits version.
> 
> rgdal was installed from CRAN, as a binary, version 0.7-20, build 2.15.1. R version is 2.15.2 (2012-10-26) -- "Trick or Treat", platform x86_64-w64-mingw32/x64 (64-bit).
> 
> The output from ogrDrivers() is pasted below.

mine mentions

39     PostgreSQL  TRUE

too. http://www.gdal.org/ogr/ogr_formats.html mentions that you'll need
to install the PostgreSQL client library (libpq), then compile gdal
against that, and then you'll have to to install rgdal from source on
top of that.

> 
> If I understand you correctly, and since I am using the standard CRAN Windows binary package, I might be out of luck?

On the contrary. You may have arrived at the moment where you realize
that you can work with open source software quite easily in an
environment that is completely open source too. You may want to leave
windows. I can't even remember when I did this, but I do remember the
relief it brought.

You can also stay with windows, and solve the problems there. You might
even make a lot of windows/R/rgdal users happy if you publish the
outcome as a binary distribution, or if you publish instructions how to
install & build things on windows.

> 
> Cheers,
> 
> Edward
> 
> Output from ogrDrivers():
> 
>              name write
> 1      AeronavFAA FALSE
> 2          ARCGEN FALSE
> 3          AVCBin FALSE
> 4          AVCE00 FALSE
> 5             BNA  TRUE
> 6             CSV  TRUE
> 7             DGN  TRUE
> 8             DXF  TRUE
> 9          EDIGEO FALSE
> 10 ESRI Shapefile  TRUE
> 11     Geoconcept  TRUE
> 12        GeoJSON  TRUE
> 13       Geomedia FALSE
> 14         GeoRSS  TRUE
> 15            GML  TRUE
> 16            GMT  TRUE
> 17       GPSBabel  TRUE
> 18  GPSTrackMaker  TRUE
> 19            GPX  TRUE
> 20            HTF FALSE
> 21         Idrisi FALSE
> 22            KML  TRUE
> 23   MapInfo File  TRUE
> 24         Memory  TRUE
> 25   MSSQLSpatial  TRUE
> 26           ODBC  TRUE
> 27        OpenAir FALSE
> 28         PCIDSK  TRUE
> 29            PDS FALSE
> 30         PGDump  TRUE
> 31           PGeo FALSE
> 32            REC FALSE
> 33            S57  TRUE
> 34           SDTS FALSE
> 35       SEGUKOOA FALSE
> 36           SEGY FALSE
> 37            SUA FALSE
> 38            SVG FALSE
> 39          TIGER  TRUE
> 40        UK .NTF FALSE
> 41            VFK FALSE
> 42            VRT FALSE
> 43         XPlane FALSE
> 
> -----Original Message-----
> From: Roger Bivand [mailto:Roger.Bivand at nhh.no] 
> Sent: 20 December 2012 20:58
> To: Edward Vanden Berghe
> Cc: r-sig-geo at r-project.org
> Subject: Re: [R-sig-Geo] reading PostGIS table into sp data frame
> 
> On Thu, 20 Dec 2012, Edward Vanden Berghe wrote:
> 
>> Thanks!
>>
>> Unfortunately I have no luck trying to get readOGR to work directly 
>> with the PostGIS database. I tried different variations:
> 
> Did you check whether your rgdal/GDAL supports the PostGIS driver? Did you look at the output of ogrDrivers()? If you did not install rgdal as a source package built against a GDAL that has the PostGIS driver on your platform (maybe OSGeo4W??), but are using the standard CRAN Windows binary package, then it is simply the case that the driver is not supported. On OSX using the Kyngchaos frameworks, or on Linux, this would be simple, but it isn't simple on Windows. You need to establish how rgdal was installed and report that.
> 
> Hope this clarifies,
> 
> Roger
> 
>>
>>> sp.object <- readOGR(dsn="PG:dbname=...
>>> sp.object <- readOGR(dsn="my_dsn" ... [where my_dsn is a Windows 
>>> system dsn] sp.object <- readOGR(dsn="PG:my_dsn" ...
>>
>> all result in the same error message:
>>
>> 	Error in ogrInfo(dsn = dsn, layer = layer, input_field_name_encoding = input_field_name_encoding) :
>> 	  Cannot open file
>>
>> Another variation,
>>
>>> sp.object <- readOGR(dsn="ODBC:my_dsn" ...
>>
>> Results in
>>
>> 	Error in ogrInfo(dsn = dsn, layer = layer, input_field_name_encoding = input_field_name_encoding) :
>> 	  Multiple # dimensions:
>>
>> though all he geometries are 2d, and there is a constraint enforcing 
>> this in the database.
>>
>> It seems rgdal is properly installed: I can use readOGR to read shape 
>> files (and this, actually, resolves my problem, as I can use this as a 
>> work-around); also, ogrDrivers() returns a list of 43 drivers (but PG, 
>> PostgreSQL or PostGIS are not among these; ESRI Shapefile and ODBC are).
>>
>> I have no problems connecting to the PostgreSQL database using either 
>> DBI/RPostgreSQL, or RODBC (the latter with the same Windows system DSN 
>> that I used for the tests above). I am not familiar with GDAL, don't 
>> know how to try and connect to the PostgreSQL database from GDAL 
>> directly, rather than through rgdal.
>>
>> Again, any insight in what might go wrong would be most appreciated.
>>
>> Cheers,
>>
>> Edward
>>
>> Message: 4
>> Date: Wed, 19 Dec 2012 14:58:52 +0100
>> From: Raffaele Morelli <raffaele.morelli at gmail.com>
>> To: r-sig-geo at r-project.org
>> Subject: Re: [R-sig-Geo] reading PostGIS table into sp data frame
>> Message-ID:
>> 	<CAD4guxOt5fSUPbK4VbbPuZf-oTBrcY-UvNPcguvUYt4qS0+_kQ at mail.gmail.com>
>> Content-Type: text/plain
>>
>> 2012/12/19 Edward Vanden Berghe <evberghe at gmail.com>
>>
>>> I wanted to create a global map with squares in lat-lon. I have 
>>> PostGIS tables to define these squares  but I havent been able to 
>>> figure out an efficient way of reading those tables into R. The code I am using now is:
>>>
>>>        crs <- CRS("+proj=longlat +ellps=WGS84")
>>>        s <- paste("select id, st_astext(geom) as geom from 
>>> geo.cs10d";",
>>> sep="")
>>>        r <- dbGetQuery(con, s)
>>>        p <- readWKT(r$geom[1],id=r$id[1],p4s=crs)
>>>        for(i in 2:length(r$id)){
>>>               p <- rbind(p, readWKT(r$geom[i], id=r$id[i], p4s=crs))
>>>        }
>>>
>>> where geo.cs10d is the table with squares, id the primary key of the 
>>> table, and geom the binary geometry field.
>>>
>>> The code above works fine for the larger squares, such as 10 degrees, 
>>> of which I only need 648 to cover the globe. For finer resolutions, 
>>> the above takes just too long  I assume because the rbind function 
>>> rewrites the whole sp object each time it executes. Ive seen other R 
>>> scripts that initiate an empty data frame of the correct length to go 
>>> round similar problems with the rbind function; I havent been able 
>>> to find an equivalent for spatial polygons. How can I initiate an 
>>> empty data frame with the right structure, and the right length?
>>>
>>> A preferable solution would be if there would be a single function to 
>>> load a complete PostGIS table, rather than having to load the 
>>> polygons one by one in a loop. Is there such a function?
>>>
>>> Im using PostgreSQL 8.4, PostGIS 1.5, R 2.15.2, platform 
>>> x86_64-w64-mingw32; IDE is StatET 3.0.1 plugin for Eclipse 3.7.2.
>>>
>>> Any help would be much appreciated.
>>>
>>> Edward
>>>
>>
>> Use postgis st_transfom to convert your table in epsg:4326, I would 
>> suggest to use a view for that.
>> Then use readOGR (in package rgdal) to read the table/view (geom and
>> attributes) in a sp object with :
>>
>> sp.object <- readOGR("PG:dbname=your_db host=your_host user=username 
>> password=xxx", "geo.cs10d ")
>>
>> regards
>> -r
>>
>>
>>
> 
> --
> Roger Bivand
> Department of Economics, NHH Norwegian School of Economics, Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From Roger.Bivand at nhh.no  Fri Dec 21 13:30:52 2012
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 21 Dec 2012 13:30:52 +0100
Subject: [R-sig-Geo] reading PostGIS table into sp data frame
In-Reply-To: <002301cddf67$c8f223b0$5ad66b10$@gmail.com>
References: <005501cdded8$449ec350$cddc49f0$@gmail.com>
	<alpine.LRH.2.02.1212202053130.13083@reclus.nhh.no>
	<002301cddf67$c8f223b0$5ad66b10$@gmail.com>
Message-ID: <alpine.LRH.2.02.1212211315100.15932@reclus.nhh.no>

On Fri, 21 Dec 2012, Edward Vanden Berghe wrote:

> The GDAL was installed from www.gisinternals.com/sdk; I installed the 32 
> bits version, though my Windows version is 64: the table on 
> gisinternals.com stated that there was a build problem with the 64-bits 
> version.
>
> rgdal was installed from CRAN, as a binary, version 0.7-20, build 
> 2.15.1. R version is 2.15.2 (2012-10-26) -- "Trick or Treat", platform 
> x86_64-w64-mingw32/x64 (64-bit).
>
> The output from ogrDrivers() is pasted below.
>
> If I understand you correctly, and since I am using the standard CRAN 
> Windows binary package, I might be out of luck?

Not out of luck, the users of the CRAN Windows and OSX rgdal binaries are 
very lucky indeed, thanks to hard work by Uwe Ligges, Brian Ripley and 
Simon Urbanek. At least many of the most commonly used drivers are 
present.

There never is a complete set of drivers ionstalled in any GDAL, some 
depend on proprietary dynamically linked objects.

file.show(system.file("README.windows", package="rgdal"))

displays the accumulated - but *not* updated - wisdom with regard to 
installing source rgdal on Windows, linked to an external GDAL DLL. If you 
try to follow this route, please pass back your experience with regard to 
installing - it is likely that much has changed. You may find that OSGeo4W 
is another source for a Win32 GDAL binary, but I don't see from the 
documentation whether it supports PostGIS.

Installing Linux, PostgreSQL, PostGIS, GDAL, Proj.4, etc., then R and 
rgdal under Linux will probably require less jumping through hoops than 
building rgdal against an external 64-bit GDAL under windows.

Hope this helps,

Roger

>
> Cheers,
>
> Edward
>
> Output from ogrDrivers():
>
>             name write
> 1      AeronavFAA FALSE
> 2          ARCGEN FALSE
> 3          AVCBin FALSE
> 4          AVCE00 FALSE
> 5             BNA  TRUE
> 6             CSV  TRUE
> 7             DGN  TRUE
> 8             DXF  TRUE
> 9          EDIGEO FALSE
> 10 ESRI Shapefile  TRUE
> 11     Geoconcept  TRUE
> 12        GeoJSON  TRUE
> 13       Geomedia FALSE
> 14         GeoRSS  TRUE
> 15            GML  TRUE
> 16            GMT  TRUE
> 17       GPSBabel  TRUE
> 18  GPSTrackMaker  TRUE
> 19            GPX  TRUE
> 20            HTF FALSE
> 21         Idrisi FALSE
> 22            KML  TRUE
> 23   MapInfo File  TRUE
> 24         Memory  TRUE
> 25   MSSQLSpatial  TRUE
> 26           ODBC  TRUE
> 27        OpenAir FALSE
> 28         PCIDSK  TRUE
> 29            PDS FALSE
> 30         PGDump  TRUE
> 31           PGeo FALSE
> 32            REC FALSE
> 33            S57  TRUE
> 34           SDTS FALSE
> 35       SEGUKOOA FALSE
> 36           SEGY FALSE
> 37            SUA FALSE
> 38            SVG FALSE
> 39          TIGER  TRUE
> 40        UK .NTF FALSE
> 41            VFK FALSE
> 42            VRT FALSE
> 43         XPlane FALSE
>
> -----Original Message-----
> From: Roger Bivand [mailto:Roger.Bivand at nhh.no]
> Sent: 20 December 2012 20:58
> To: Edward Vanden Berghe
> Cc: r-sig-geo at r-project.org
> Subject: Re: [R-sig-Geo] reading PostGIS table into sp data frame
>
> On Thu, 20 Dec 2012, Edward Vanden Berghe wrote:
>
>> Thanks!
>>
>> Unfortunately I have no luck trying to get readOGR to work directly
>> with the PostGIS database. I tried different variations:
>
> Did you check whether your rgdal/GDAL supports the PostGIS driver? Did you look at the output of ogrDrivers()? If you did not install rgdal as a source package built against a GDAL that has the PostGIS driver on your platform (maybe OSGeo4W??), but are using the standard CRAN Windows binary package, then it is simply the case that the driver is not supported. On OSX using the Kyngchaos frameworks, or on Linux, this would be simple, but it isn't simple on Windows. You need to establish how rgdal was installed and report that.
>
> Hope this clarifies,
>
> Roger
>
>>
>>> sp.object <- readOGR(dsn="PG:dbname=...
>>> sp.object <- readOGR(dsn="my_dsn" ... [where my_dsn is a Windows
>>> system dsn] sp.object <- readOGR(dsn="PG:my_dsn" ...
>>
>> all result in the same error message:
>>
>> 	Error in ogrInfo(dsn = dsn, layer = layer, input_field_name_encoding = input_field_name_encoding) :
>> 	  Cannot open file
>>
>> Another variation,
>>
>>> sp.object <- readOGR(dsn="ODBC:my_dsn" ...
>>
>> Results in
>>
>> 	Error in ogrInfo(dsn = dsn, layer = layer, input_field_name_encoding = input_field_name_encoding) :
>> 	  Multiple # dimensions:
>>
>> though all he geometries are 2d, and there is a constraint enforcing
>> this in the database.
>>
>> It seems rgdal is properly installed: I can use readOGR to read shape
>> files (and this, actually, resolves my problem, as I can use this as a
>> work-around); also, ogrDrivers() returns a list of 43 drivers (but PG,
>> PostgreSQL or PostGIS are not among these; ESRI Shapefile and ODBC are).
>>
>> I have no problems connecting to the PostgreSQL database using either
>> DBI/RPostgreSQL, or RODBC (the latter with the same Windows system DSN
>> that I used for the tests above). I am not familiar with GDAL, don't
>> know how to try and connect to the PostgreSQL database from GDAL
>> directly, rather than through rgdal.
>>
>> Again, any insight in what might go wrong would be most appreciated.
>>
>> Cheers,
>>
>> Edward
>>
>> Message: 4
>> Date: Wed, 19 Dec 2012 14:58:52 +0100
>> From: Raffaele Morelli <raffaele.morelli at gmail.com>
>> To: r-sig-geo at r-project.org
>> Subject: Re: [R-sig-Geo] reading PostGIS table into sp data frame
>> Message-ID:
>> 	<CAD4guxOt5fSUPbK4VbbPuZf-oTBrcY-UvNPcguvUYt4qS0+_kQ at mail.gmail.com>
>> Content-Type: text/plain
>>
>> 2012/12/19 Edward Vanden Berghe <evberghe at gmail.com>
>>
>>> I wanted to create a global map with squares in lat-lon. I have
>>> PostGIS tables to define these squares  but I havent been able to
>>> figure out an efficient way of reading those tables into R. The code I am using now is:
>>>
>>>        crs <- CRS("+proj=longlat +ellps=WGS84")
>>>        s <- paste("select id, st_astext(geom) as geom from
>>> geo.cs10d";",
>>> sep="")
>>>        r <- dbGetQuery(con, s)
>>>        p <- readWKT(r$geom[1],id=r$id[1],p4s=crs)
>>>        for(i in 2:length(r$id)){
>>>               p <- rbind(p, readWKT(r$geom[i], id=r$id[i], p4s=crs))
>>>        }
>>>
>>> where geo.cs10d is the table with squares, id the primary key of the
>>> table, and geom the binary geometry field.
>>>
>>> The code above works fine for the larger squares, such as 10 degrees,
>>> of which I only need 648 to cover the globe. For finer resolutions,
>>> the above takes just too long  I assume because the rbind function
>>> rewrites the whole sp object each time it executes. Ive seen other R
>>> scripts that initiate an empty data frame of the correct length to go
>>> round similar problems with the rbind function; I havent been able
>>> to find an equivalent for spatial polygons. How can I initiate an
>>> empty data frame with the right structure, and the right length?
>>>
>>> A preferable solution would be if there would be a single function to
>>> load a complete PostGIS table, rather than having to load the
>>> polygons one by one in a loop. Is there such a function?
>>>
>>> Im using PostgreSQL 8.4, PostGIS 1.5, R 2.15.2, platform
>>> x86_64-w64-mingw32; IDE is StatET 3.0.1 plugin for Eclipse 3.7.2.
>>>
>>> Any help would be much appreciated.
>>>
>>> Edward
>>>
>>
>> Use postgis st_transfom to convert your table in epsg:4326, I would
>> suggest to use a view for that.
>> Then use readOGR (in package rgdal) to read the table/view (geom and
>> attributes) in a sp object with :
>>
>> sp.object <- readOGR("PG:dbname=your_db host=your_host user=username
>> password=xxx", "geo.cs10d ")
>>
>> regards
>> -r
>>
>>
>>
>
> --
> Roger Bivand
> Department of Economics, NHH Norwegian School of Economics, Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From evberghe at gmail.com  Fri Dec 21 15:48:04 2012
From: evberghe at gmail.com (Edward Vanden Berghe)
Date: Fri, 21 Dec 2012 15:48:04 +0100
Subject: [R-sig-Geo] reading PostGIS table into sp data frame
In-Reply-To: <alpine.LRH.2.02.1212211315100.15932@reclus.nhh.no>
References: <005501cdded8$449ec350$cddc49f0$@gmail.com>
	<alpine.LRH.2.02.1212202053130.13083@reclus.nhh.no>
	<002301cddf67$c8f223b0$5ad66b10$@gmail.com>
	<alpine.LRH.2.02.1212211315100.15932@reclus.nhh.no>
Message-ID: <000b01cddf8a$2f6288c0$8e279a40$@gmail.com>

Thanks Roger and also Edzer for your replies. Apologies for the choice of words below - I much appreciate your efforts, and those of the many others who are developing and maintaining Open Source software.

I'll look into installing GDAL and rgdal from source - not sure what chances of success I have, as I have absolutely no experience with this. Might be a good time to switch to Ubuntu for me!

Edward

-----Original Message-----
From: Roger Bivand [mailto:Roger.Bivand at nhh.no] 
Sent: 21 December 2012 13:31
To: Edward Vanden Berghe
Cc: r-sig-geo at r-project.org
Subject: RE: [R-sig-Geo] reading PostGIS table into sp data frame

On Fri, 21 Dec 2012, Edward Vanden Berghe wrote:

> The GDAL was installed from www.gisinternals.com/sdk; I installed the 
> 32 bits version, though my Windows version is 64: the table on 
> gisinternals.com stated that there was a build problem with the 
> 64-bits version.
>
> rgdal was installed from CRAN, as a binary, version 0.7-20, build 
> 2.15.1. R version is 2.15.2 (2012-10-26) -- "Trick or Treat", platform
> x86_64-w64-mingw32/x64 (64-bit).
>
> The output from ogrDrivers() is pasted below.
>
> If I understand you correctly, and since I am using the standard CRAN 
> Windows binary package, I might be out of luck?

Not out of luck, the users of the CRAN Windows and OSX rgdal binaries are very lucky indeed, thanks to hard work by Uwe Ligges, Brian Ripley and Simon Urbanek. At least many of the most commonly used drivers are present.

There never is a complete set of drivers ionstalled in any GDAL, some depend on proprietary dynamically linked objects.

file.show(system.file("README.windows", package="rgdal"))

displays the accumulated - but *not* updated - wisdom with regard to installing source rgdal on Windows, linked to an external GDAL DLL. If you try to follow this route, please pass back your experience with regard to installing - it is likely that much has changed. You may find that OSGeo4W is another source for a Win32 GDAL binary, but I don't see from the documentation whether it supports PostGIS.

Installing Linux, PostgreSQL, PostGIS, GDAL, Proj.4, etc., then R and rgdal under Linux will probably require less jumping through hoops than building rgdal against an external 64-bit GDAL under windows.

Hope this helps,

Roger

>
> Cheers,
>
> Edward
>
> Output from ogrDrivers():
>
>             name write
> 1      AeronavFAA FALSE
> 2          ARCGEN FALSE
> 3          AVCBin FALSE
> 4          AVCE00 FALSE
> 5             BNA  TRUE
> 6             CSV  TRUE
> 7             DGN  TRUE
> 8             DXF  TRUE
> 9          EDIGEO FALSE
> 10 ESRI Shapefile  TRUE
> 11     Geoconcept  TRUE
> 12        GeoJSON  TRUE
> 13       Geomedia FALSE
> 14         GeoRSS  TRUE
> 15            GML  TRUE
> 16            GMT  TRUE
> 17       GPSBabel  TRUE
> 18  GPSTrackMaker  TRUE
> 19            GPX  TRUE
> 20            HTF FALSE
> 21         Idrisi FALSE
> 22            KML  TRUE
> 23   MapInfo File  TRUE
> 24         Memory  TRUE
> 25   MSSQLSpatial  TRUE
> 26           ODBC  TRUE
> 27        OpenAir FALSE
> 28         PCIDSK  TRUE
> 29            PDS FALSE
> 30         PGDump  TRUE
> 31           PGeo FALSE
> 32            REC FALSE
> 33            S57  TRUE
> 34           SDTS FALSE
> 35       SEGUKOOA FALSE
> 36           SEGY FALSE
> 37            SUA FALSE
> 38            SVG FALSE
> 39          TIGER  TRUE
> 40        UK .NTF FALSE
> 41            VFK FALSE
> 42            VRT FALSE
> 43         XPlane FALSE
>
> -----Original Message-----
> From: Roger Bivand [mailto:Roger.Bivand at nhh.no]
> Sent: 20 December 2012 20:58
> To: Edward Vanden Berghe
> Cc: r-sig-geo at r-project.org
> Subject: Re: [R-sig-Geo] reading PostGIS table into sp data frame
>
> On Thu, 20 Dec 2012, Edward Vanden Berghe wrote:
>
>> Thanks!
>>
>> Unfortunately I have no luck trying to get readOGR to work directly 
>> with the PostGIS database. I tried different variations:
>
> Did you check whether your rgdal/GDAL supports the PostGIS driver? Did you look at the output of ogrDrivers()? If you did not install rgdal as a source package built against a GDAL that has the PostGIS driver on your platform (maybe OSGeo4W??), but are using the standard CRAN Windows binary package, then it is simply the case that the driver is not supported. On OSX using the Kyngchaos frameworks, or on Linux, this would be simple, but it isn't simple on Windows. You need to establish how rgdal was installed and report that.
>
> Hope this clarifies,
>
> Roger
>
>>
>>> sp.object <- readOGR(dsn="PG:dbname=...
>>> sp.object <- readOGR(dsn="my_dsn" ... [where my_dsn is a Windows 
>>> system dsn] sp.object <- readOGR(dsn="PG:my_dsn" ...
>>
>> all result in the same error message:
>>
>> 	Error in ogrInfo(dsn = dsn, layer = layer, input_field_name_encoding = input_field_name_encoding) :
>> 	  Cannot open file
>>
>> Another variation,
>>
>>> sp.object <- readOGR(dsn="ODBC:my_dsn" ...
>>
>> Results in
>>
>> 	Error in ogrInfo(dsn = dsn, layer = layer, input_field_name_encoding = input_field_name_encoding) :
>> 	  Multiple # dimensions:
>>
>> though all he geometries are 2d, and there is a constraint enforcing 
>> this in the database.
>>
>> It seems rgdal is properly installed: I can use readOGR to read shape 
>> files (and this, actually, resolves my problem, as I can use this as 
>> a work-around); also, ogrDrivers() returns a list of 43 drivers (but 
>> PG, PostgreSQL or PostGIS are not among these; ESRI Shapefile and ODBC are).
>>
>> I have no problems connecting to the PostgreSQL database using either 
>> DBI/RPostgreSQL, or RODBC (the latter with the same Windows system 
>> DSN that I used for the tests above). I am not familiar with GDAL, 
>> don't know how to try and connect to the PostgreSQL database from 
>> GDAL directly, rather than through rgdal.
>>
>> Again, any insight in what might go wrong would be most appreciated.
>>
>> Cheers,
>>
>> Edward
>>
>> Message: 4
>> Date: Wed, 19 Dec 2012 14:58:52 +0100
>> From: Raffaele Morelli <raffaele.morelli at gmail.com>
>> To: r-sig-geo at r-project.org
>> Subject: Re: [R-sig-Geo] reading PostGIS table into sp data frame
>> Message-ID:
>> 	<CAD4guxOt5fSUPbK4VbbPuZf-oTBrcY-UvNPcguvUYt4qS0+_kQ at mail.gmail.com>
>> Content-Type: text/plain
>>
>> 2012/12/19 Edward Vanden Berghe <evberghe at gmail.com>
>>
>>> I wanted to create a global map with squares in lat-lon. I have 
>>> PostGIS tables to define these squares  but I havent been able to 
>>> figure out an efficient way of reading those tables into R. The code I am using now is:
>>>
>>>        crs <- CRS("+proj=longlat +ellps=WGS84")
>>>        s <- paste("select id, st_astext(geom) as geom from 
>>> geo.cs10d";",
>>> sep="")
>>>        r <- dbGetQuery(con, s)
>>>        p <- readWKT(r$geom[1],id=r$id[1],p4s=crs)
>>>        for(i in 2:length(r$id)){
>>>               p <- rbind(p, readWKT(r$geom[i], id=r$id[i], p4s=crs))
>>>        }
>>>
>>> where geo.cs10d is the table with squares, id the primary key of the 
>>> table, and geom the binary geometry field.
>>>
>>> The code above works fine for the larger squares, such as 10 
>>> degrees, of which I only need 648 to cover the globe. For finer 
>>> resolutions, the above takes just too long  I assume because the 
>>> rbind function rewrites the whole sp object each time it executes. 
>>> Ive seen other R scripts that initiate an empty data frame of the 
>>> correct length to go round similar problems with the rbind function; 
>>> I havent been able to find an equivalent for spatial polygons. How 
>>> can I initiate an empty data frame with the right structure, and the right length?
>>>
>>> A preferable solution would be if there would be a single function 
>>> to load a complete PostGIS table, rather than having to load the 
>>> polygons one by one in a loop. Is there such a function?
>>>
>>> Im using PostgreSQL 8.4, PostGIS 1.5, R 2.15.2, platform 
>>> x86_64-w64-mingw32; IDE is StatET 3.0.1 plugin for Eclipse 3.7.2.
>>>
>>> Any help would be much appreciated.
>>>
>>> Edward
>>>
>>
>> Use postgis st_transfom to convert your table in epsg:4326, I would 
>> suggest to use a view for that.
>> Then use readOGR (in package rgdal) to read the table/view (geom and
>> attributes) in a sp object with :
>>
>> sp.object <- readOGR("PG:dbname=your_db host=your_host user=username 
>> password=xxx", "geo.cs10d ")
>>
>> regards
>> -r
>>
>>
>>
>
> --
> Roger Bivand
> Department of Economics, NHH Norwegian School of Economics, Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>
>

--
Roger Bivand
Department of Economics, NHH Norwegian School of Economics, Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From pgalpern at gmail.com  Fri Dec 21 16:53:03 2012
From: pgalpern at gmail.com (Paul Galpern)
Date: Fri, 21 Dec 2012 09:53:03 -0600
Subject: [R-sig-Geo] Plotting pie charts using plotKML
Message-ID: <50D485DF.2060206@gmail.com>

Dear list,

   This question pertains to the very nice package, plotKML.

   Does anyone know of an efficient way to render pie charts on Google 
Earth using plotKML? Creating thousands of little pie images and using 
the SpatialPhotoOverlay class doesn't seem viable.

   The only other thing I can think of is rendering each segment of each 
pie (of which there may be thousands) as a SpatialPolygons object.  But 
this, again, seems like a lot of work (and likely to produce a very 
large KML file).

Thanks for your ideas.

Sincerely,
Paul

-- 
Paul Galpern
Natural Resources Institute
70 Dysart Road
University of Manitoba
Winnipeg, Manitoba, Canada R3T 2M6
http://borealscape.ca


From b.rowlingson at lancaster.ac.uk  Fri Dec 21 17:58:55 2012
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Fri, 21 Dec 2012 16:58:55 +0000
Subject: [R-sig-Geo] Plotting pie charts using plotKML
In-Reply-To: <b525a00a17bf46fea683f8817f0039ce@EX-1-HT0.lancs.local>
References: <b525a00a17bf46fea683f8817f0039ce@EX-1-HT0.lancs.local>
Message-ID: <CANVKczPwURxZyhAQYUS94p6NYz7iKuy2ZtWdhfrrQzOCNj_UHw@mail.gmail.com>

On Fri, Dec 21, 2012 at 3:53 PM, Paul Galpern <pgalpern at gmail.com> wrote:
> Dear list,
>
>    This question pertains to the very nice package, plotKML.
>
>    Does anyone know of an efficient way to render pie charts on Google
> Earth using plotKML? Creating thousands of little pie images and using
> the SpatialPhotoOverlay class doesn't seem viable.
>
>    The only other thing I can think of is rendering each segment of each
> pie (of which there may be thousands) as a SpatialPolygons object.  But
> this, again, seems like a lot of work (and likely to produce a very
> large KML file).

These guys:

http://blog.thematicmapping.org/2008/04/using-google-charts-with-kml.html

call the google charts API to generate the pie charts. Sneaky. You
don't have to include the images in the KML, they get generated by the
API on the fly (I think).

 Anyway, pie charts are bad, mmmkay?

Barry


From edzer.pebesma at uni-muenster.de  Fri Dec 21 18:26:46 2012
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Fri, 21 Dec 2012 18:26:46 +0100
Subject: [R-sig-Geo] Plotting pie charts using plotKML
In-Reply-To: <50D485DF.2060206@gmail.com>
References: <50D485DF.2060206@gmail.com>
Message-ID: <50D49BD6.2010302@uni-muenster.de>

RKML, from omegahat, was written to do that: plot arbitrary R plots
somewhere on the earth - you might give it a try.

On 12/21/2012 04:53 PM, Paul Galpern wrote:
> Dear list,
> 
>   This question pertains to the very nice package, plotKML.
> 
>   Does anyone know of an efficient way to render pie charts on Google
> Earth using plotKML? Creating thousands of little pie images and using
> the SpatialPhotoOverlay class doesn't seem viable.
> 
>   The only other thing I can think of is rendering each segment of each
> pie (of which there may be thousands) as a SpatialPolygons object.  But
> this, again, seems like a lot of work (and likely to produce a very
> large KML file).
> 
> Thanks for your ideas.
> 
> Sincerely,
> Paul
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From spamgoodbye at me.com  Fri Dec 21 18:40:24 2012
From: spamgoodbye at me.com (Baalam Kan)
Date: Fri, 21 Dec 2012 18:40:24 +0100
Subject: [R-sig-Geo] Mean of SpatialGridDataFrames or SpatialPixelsDataFrames
References: <094416B4-81A4-4058-B9F4-263BDDA876C3@me.com>
Message-ID: <8CD82021-EFFD-4387-8194-AE1F83758620@me.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121221/e478449b/attachment.pl>

From spamgoodbye at me.com  Fri Dec 21 18:47:05 2012
From: spamgoodbye at me.com (Baalam Kan)
Date: Fri, 21 Dec 2012 18:47:05 +0100
Subject: [R-sig-Geo] Mean of SpatialGridDataFrames or SpatialPixelsDataFrames
References: <8CD82021-EFFD-4387-8194-AE1F83758620@me.com>
Message-ID: <727ACC67-2FED-458A-ABAD-E81DAC69F7E4@me.com>

Hello List:

[Sorry for my last email in HTML format!]

I'm using the adehabitatHR package to obtain several "Utilization Distribution" maps for some individuals of a same species. Now, I want combine these in a single map using a mean value. The overlay function don't work for me in this issue.

Shortly, I want average one SpatialGridDataFrame over other SpatialGridDataFrame.

I hope someone can help.

Any ideas as to what might be going on?

Thanks,

Andres


======= CODE =========
class(UD_obj)
[1] "estUDm"

UD_spixdf <- estUDm2spixdf(UD_obj)   # Several SpatialPixelsDataFrames
class(UD_spixdf)
[1] "SpatialPixelsDataFrame"
attr(,"package")
[1] "sp"


UD_spixdf_1 <- UD_spixdf[1]   # The first SpatialPixelsDataFrame to combine
class(UD_spixdf_1)
[1] "SpatialPixelsDataFrame"
attr(,"package")
[1] "sp"


UD_spixdf_2 <- UD_spixdf[2]  # The second SpatialPixelsDataFrame to combine
class(UD_spixdf_2)
[1] "SpatialPixelsDataFrame"
attr(,"package")
[1] "sp"

UD_mean <- overlay(as(UD_spixdf_1, "SpatialGridDataFrame"), UD_spixdf_2, fn=mean)
gridded(UD_mean) = TRUE
UD_mean_grid <- as.image.SpatialGridDataFrame(UD_mean)
image(UD_mean_grid)


From julien.salanie at agrocampus-ouest.fr  Fri Dec 21 21:23:36 2012
From: julien.salanie at agrocampus-ouest.fr (=?ISO-8859-1?Q?Julien_Salani=E9?=)
Date: Fri, 21 Dec 2012 21:23:36 +0100
Subject: [R-sig-Geo] How to create spatial weights with several unlocalised
 points in polygons?
Message-ID: <50D4C548.8000407@agrocampus-ouest.fr>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121221/d25cbfdf/attachment.pl>

From Roger.Bivand at nhh.no  Fri Dec 21 21:59:58 2012
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 21 Dec 2012 21:59:58 +0100
Subject: [R-sig-Geo] How to create spatial weights with several
 unlocalised points in polygons?
In-Reply-To: <50D4C548.8000407@agrocampus-ouest.fr>
References: <50D4C548.8000407@agrocampus-ouest.fr>
Message-ID: <alpine.LRH.2.02.1212212155210.14673@reclus.nhh.no>

On Fri, 21 Dec 2012, Julien Salani? wrote:

> Hi,
>
> My problem is the following : I have points (houses) that are in
> polygons (counties). I don't have their exact location inside the
> polygon. I would like to estimate a spatial model to relate houses'
> prices to some counties characteristics.
>
> How do I create spatial weights ? I would like to weight in the
> following manner : For all the houses in the same county would by first
> order neighboors. All the houses in the adjacent counties would be
> second-order neighboors, etc, as in contiguity matrices for areal data.

Please see nb2blocknb() in spdep. This doesn't quite do what you need, 
because it defines all other points in the same county, and all points in 
neighbouring counties, as neighbours. You might want to define a custom nb 
object for your 1st order neighbours, and then use diffnb() with the 
output of nb2blocknb() to get the 2nd order neighbours.

Hope this helps,

Roger

>
> Otherwise, I though I could randomly assign a location within the
> polygon for each house. Is it possible in R to draw spatial locations
> from polygons. Put clearly: I have 2 houses (A & B) in county C. I want
> to draw coordinates (xA, yA) and (xB,yB) inside polygon C (that is, I
> want to make sure that(xA, yA) and (xB,yB)  belong to C). And I want to
> do that for the houses and for all the polygons in my dataset.
>
> Is there a way to do that in R ?
>
> Thank you very much for your advices. All the best, Julien Salani?
>
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From pgalpern at gmail.com  Sat Dec 22 00:16:11 2012
From: pgalpern at gmail.com (Paul Galpern)
Date: Fri, 21 Dec 2012 17:16:11 -0600
Subject: [R-sig-Geo] Plotting pie charts using plotKML
In-Reply-To: <CANVKczPwURxZyhAQYUS94p6NYz7iKuy2ZtWdhfrrQzOCNj_UHw@mail.gmail.com>
References: <b525a00a17bf46fea683f8817f0039ce@EX-1-HT0.lancs.local>
	<CANVKczPwURxZyhAQYUS94p6NYz7iKuy2ZtWdhfrrQzOCNj_UHw@mail.gmail.com>
Message-ID: <50D4EDBB.4010100@gmail.com>

Thanks Barry, Edzer.  These are helpful suggestions.

Barry--yes its too bad about the pie charts--this is how the data has 
been presented in the past, so we do what me must!

Sincerely,
Paul

On 21/12/2012 10:58 AM, Barry Rowlingson wrote:
> On Fri, Dec 21, 2012 at 3:53 PM, Paul Galpern <pgalpern at gmail.com> wrote:
>> Dear list,
>>
>>     This question pertains to the very nice package, plotKML.
>>
>>     Does anyone know of an efficient way to render pie charts on Google
>> Earth using plotKML? Creating thousands of little pie images and using
>> the SpatialPhotoOverlay class doesn't seem viable.
>>
>>     The only other thing I can think of is rendering each segment of each
>> pie (of which there may be thousands) as a SpatialPolygons object.  But
>> this, again, seems like a lot of work (and likely to produce a very
>> large KML file).
> These guys:
>
> http://blog.thematicmapping.org/2008/04/using-google-charts-with-kml.html
>
> call the google charts API to generate the pie charts. Sneaky. You
> don't have to include the images in the KML, they get generated by the
> API on the fly (I think).
>
>   Anyway, pie charts are bad, mmmkay?
>
> Barry

-- 
Paul Galpern
Natural Resources Institute
70 Dysart Road
University of Manitoba
Winnipeg, Manitoba, Canada R3T 2M6
http://borealscape.ca


From kili at grf.bg.ac.rs  Sat Dec 22 16:31:27 2012
From: kili at grf.bg.ac.rs (Milan Kilibarda)
Date: Sat, 22 Dec 2012 16:31:27 +0100
Subject: [R-sig-Geo] Plotting pie charts using plotKML
In-Reply-To: <CANVKczPwURxZyhAQYUS94p6NYz7iKuy2ZtWdhfrrQzOCNj_UHw@mail.gmail.com>
References: <b525a00a17bf46fea683f8817f0039ce@EX-1-HT0.lancs.local>
	<CANVKczPwURxZyhAQYUS94p6NYz7iKuy2ZtWdhfrrQzOCNj_UHw@mail.gmail.com>
Message-ID: <51478b2b623cf67099c83ede2d1917b5.squirrel@mail.grf.bg.ac.rs>

Dear Paul,
Maybe you can solve you problem in this way.

I agree with ---Barry--yes its too bad about the pie charts--this is how the data has been
presented in the past, so we do what me must!

# plotGoogleMaps solution to plot 3 variables in piecharts
library('plotGoogleMaps')
data(meuse)
coordinates(meuse)<-~x+y
proj4string(meuse) <- CRS('+init=epsg:28992')

m<-segmentGoogleMaps(meuse,zcol=c('zinc','lead','copper'),filename='myMap.htm')
#################################################################################

# This function can help you to find solution to your problem in plotKML


# Function creates SPolyDF from points, piecharts from points  , modified from plotGoogleMaps package
pie<-function(SPDF,
                        zcol=1:length(SP at data),
                        scalelist=TRUE,  # TRUE proportional, FALSE pie charts same size
                        max.radius=100,  #m
                        do.sqrt = TRUE,
                        colPalette=rainbow(ncol(SP at data[,zcol])),
                        fillColor=rainbow(length(key.entries)),
                        strokeColor="red"){

####  FUNCTION modified from plotGoogleMaps package

    createSphereSegment <- function(partOfSP,
                                  max.radius=100,  #m
                                 key.entries = as.numeric(partOfSP at data),
                                 scalelist=1,
                                 do.sqrt = TRUE,
                                 fillColor=rainbow(length(key.entries)),
                                 strokeColor="red",
                                 id=length(key.entries)) {

     center=coordinates(partOfSP)
    fillColor<-as.character(substr(fillColor,1,7))

    	obj = as(partOfSP, "SpatialPointsDataFrame")
    		z = as.numeric(partOfSP at data)
        	# avoid negative values
        	if (min(key.entries)<0 ){
        	ke<-abs(min(key.entries))+ key.entries+mean(key.entries)
        	}else{ke<-key.entries+min(key.entries)}     # no zeros for radius vecor
        	# creating a vector for subgroupes
        	if(do.sqrt){
        	scale.level<- sqrt(ke/(max(ke)) ) }else{scale.level<-ke/(max(ke))}
    	radius.level<-max.radius*scale.level
    	 # list of radiuses for createSphereCircle
    	radius.vector<-   radius.level
    	dfi<-cbind(rep(NA,1+length(radius.vector)))
    	dfi[1]=0

    	if(max(scale.level)==0)
                              {scale.level=0.1
                               scalelist=0.01}

    	dfi[2:(length(radius.vector)+1)]=360/sum(scale.level)*  scale.level


    	fi= cbind(rep(NA,2*length(radius.vector)) )
    	dfi=as.numeric(dfi)
     for (i in (seq(2,length(fi),by=2))){
     fi[i]=sum(dfi[1:(i/2+1)])
     }
     fi[1]=0
       for (i in (seq(3,length(fi),by=2))){
     fi[i]=fi[i-1]
     }


    radius.vector=scalelist*max.radius/6378000
    # radius<-	spDistsN1(pts=rbind(c(soil.ll at bbox[1,1],soil.ll at bbox[2,1])),
pt=c(soil.ll at bbox[1,2],soil.ll at bbox[2,2]), longlat = T)/6378	## radians

    		lat1 <- (pi/180)* center[2];
    	  lng1 <- (pi/180)* center[1];

      paths<-as.list(rep(NA,length(radius.vector)))

     for(ik in (seq(2,length(fi),by=2))){
         radius<-  radius.vector

        coords<-cbind(rep(NA,11),rep(NA,11))
        coords[1,]  <- c(  center[,1], center[,2])
          j<-2
    		for (i in seq(fi[ik-1],fi[ik],length.out=10)) {
    			tc <- (pi/180)*i
    			y <- asin(sin(lat1)*cos(radius)+cos(lat1)*sin(radius)*cos(tc))
    			dlng <- atan2(sin(tc)*sin(radius)*cos(lat1),cos(radius)-sin(lat1)*sin(y))
    			x <- ((lng1-dlng+pi) %% (2*pi)) - pi

    			coords[j,1] <-c(x*(180/pi))
    			coords[j,2] <-c(y*(180/pi))
    			j<-j+1
    		}



           lonlat<-coords
           paths[[ik/2]]<-rbind(lonlat,lonlat[1,])
                     }
     pol=paths
     lonlat<-rbind( paths[[1]],paths[[1]][1,])
     pol[[1]]<-Polygon(lonlat,hole=FALSE)
     pol[[1]]<-Polygons(list(pol[[1]]),ID=id-1)

         for(i in (2:(length(paths)))){
              lonlat<-rbind( paths[[i]],paths[[i]][1,])
               pol[[i]]<-Polygon(lonlat,hole=FALSE)
               pol[[i]]<-Polygons(list(pol[[i]]),ID=id-i)   }


      # Vrace Polygons obj koji je lista Polygon objekata
      return(pol)

                     }

###########################################################################
#####            END
##########################################################################

SP <-as(SPDF, "SpatialPointsDataFrame")
SP.ll <- spTransform(SP, CRS("+proj=longlat +datum=WGS84"))
SP.ll<-SP.ll[,zcol]

if(strokeColor!=""){
    rgbc<-col2rgb(strokeColor)
    strokeColor<-rgb(rgbc[1],rgbc[2],rgbc[3],maxColorValue=255) }

    if(!is.null(colPalette)){
    rgbc<-col2rgb(colPalette)
    colPalette<-apply(rgbc,2,function(x) rgb(x[1],x[2],x[3],maxColorValue=255))}
  if(scalelist){
    xdata<-SP at data[,zcol]
    xdata <- apply(xdata, 2L, function(x) (x - min(x, na.rm = TRUE))/diff(range(x, na.rm = TRUE)))
    xsum <- apply(xdata, 1L,function(x) ( sum(x)))
    scalelist<-xsum/max(xsum)
    scalelist<-sqrt(scalelist)} else{ scalelist<-rep(1,length(SP.ll at coords[,1])) }

  Pols<-as.list(rep(NA,length(SP.ll[,1])))
  Srl<-Pols
   num=(rep(NA,length(zcol)*length(SP.ll at data[,1])) )
  for(i in 1:length(SP.ll at data[,1])){
    Pols[[i]]<-createSphereSegment(SP.ll[i,zcol],
                              max.radius=max.radius,  #m
                             key.entries = as.numeric(SP.ll at data[i,zcol]),
                             scalelist= scalelist[i],
                             do.sqrt = do.sqrt,
                             fillColor=colPalette,
                             strokeColor= strokeColor,
                             id=i*length(key.entries))
                             num[i*length(zcol)-(0:(length(zcol)-1))]=i

                                      }

   id=num  # rep(1:length(zcol),length(SP.ll at data[,1]))
  dat=data.frame(id)
  SP$id=1: length(SP.ll at data[,1])
  dat=merge(dat,SP at data)
  Pols=unlist(Pols)
  SPl<-SpatialPolygons(Pols,proj4string=SP.ll at proj4string)
  SPldf<-SpatialPolygonsDataFrame(SPl,dat,match.ID = FALSE)
  return(SPldf)
}

###########################  END OF FUNCTION pie ###############################

 a=pie(meuse,zcol=c('zinc','lead','copper'))
 spplot(a)
 a$col=rep(c('zinc','lead','copper'),155)
 m=plotGoogleMaps(a,zcol='col',colPalette=c('red','green','blue') )

 # Similary you can try it to plot in plotKML , I don't have package at home

Best,
Milan


> On Fri, Dec 21, 2012 at 3:53 PM, Paul Galpern <pgalpern at gmail.com> wrote:
>> Dear list,
>>
>>    This question pertains to the very nice package, plotKML.
>>
>>    Does anyone know of an efficient way to render pie charts on Google
>> Earth using plotKML? Creating thousands of little pie images and using
>> the SpatialPhotoOverlay class doesn't seem viable.
>>
>>    The only other thing I can think of is rendering each segment of each
>> pie (of which there may be thousands) as a SpatialPolygons object.  But
>> this, again, seems like a lot of work (and likely to produce a very
>> large KML file).
>
> These guys:
>
> http://blog.thematicmapping.org/2008/04/using-google-charts-with-kml.html
>
> call the google charts API to generate the pie charts. Sneaky. You
> don't have to include the images in the KML, they get generated by the
> API on the fly (I think).
>
>  Anyway, pie charts are bad, mmmkay?
>
> Barry
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


Milan Kilibarda

University of Belgrade,
Faculty of Civil Engineering,
Department of Geodesy and Geoinformatics,
Address: Bulevar kralja Aleksandra 73
   11000 Belgrade, Serbia,
Mail:  kili at grf.bg.ac.rs

tel:+381 11 3218516


From Roger.Bivand at nhh.no  Sat Dec 22 18:11:32 2012
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sat, 22 Dec 2012 18:11:32 +0100
Subject: [R-sig-Geo] spgwr and predictions for separate spdf dataset
In-Reply-To: <CABQqjOK-uVHt9JJJZt2RsuD6uD5vUKDRiYyhzwY_kQ_YQ0sJQQ@mail.gmail.com>
References: <CABQqjOKcHZgmSCpJ4OC+2Mgenp7zTaT7NFnMoi5iOfne03LO6w@mail.gmail.com>
	<CABQqjOKV6Gjt0ehMzS=+Pp3nkw7Q7HjqtQPJHuCQVcPH3evB0w@mail.gmail.com>
	<CABQqjOK-uVHt9JJJZt2RsuD6uD5vUKDRiYyhzwY_kQ_YQ0sJQQ@mail.gmail.com>
Message-ID: <alpine.LRH.2.02.1212221803240.19787@reclus.nhh.no>

On Mon, 10 Dec 2012, Kristin Graves wrote:

> Hello-
> I am pretty new at R so apologize in advance if I am not using the correct
> terminology.
>
> I am running spgwr, analyzing a spatial points data frame of 113 records
> (busall). I have a separate spatial points data frame (9 records, busfill)
> for which I would like to obtain predicted values for the dependent
> variable.
>
> busfill contains all the right hand side variables but does not include the
> dependent variable (k16) at all.
>
> My modeling statement is as follows:
>
> model_gwr<-(k16~c5+c6, data=busall, bandwidth=0.2212, predictions=TRUE, 
> fittedGWRobject=busfill)

This is not the correct syntax. I think that what you want is:

model_gwr <- gwr(k16~c5+c6, data=busall, bandwidth=0.2212,
   predictions=TRUE, fit.points=busfill)

where you fit the model based on the data including responses in busall to 
the busfill points. The help page says:

predictions: default FALSE; if TRUE and no fit points given, return GW
           fitted values at data points, if fit points given and are a
           Spatial*DataFrame object containing the RHS variables in the
           formula, return GW predictions at the fit points

and

fit.points: an object containing the coordinates of fit points; often
           an object from package ?sp?; if missing, the coordinates
           given through the data argument object, or the coords
           argument are used


If you also want prediction "standard errors", follow the example:

      data(meuse)
      coordinates(meuse) <- c("x", "y")
      meuse$ffreq <- factor(meuse$ffreq)
      data(meuse.grid)
      coordinates(meuse.grid) <- c("x", "y")
      meuse.grid$ffreq <- factor(meuse.grid$ffreq)
      gridded(meuse.grid) <- TRUE
      xx <- gwr(cadmium ~ dist, meuse, bandwidth = 228, hatmatrix=TRUE)
      xx
      x <- gwr(cadmium ~ dist, meuse, bandwidth = 228, fit.points =
       meuse.grid, predict=TRUE, se.fit=TRUE, fittedGWRobject=xx)
      x
      spplot(x$SDF, "pred")
      spplot(x$SDF, "pred.se")

Hope this helps,

Roger
>
> The model runs without error. But I don't know how to view the newly
> predicted values for k16 for my busfill dataset. Perhaps I have
> mis-specified the model, or perhaps I have set up my input busfill dataset
> incorrectly.
>
> Any help is greatly appreciated.
>
> Thanks,
> Kristin Graves
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From Roger.Bivand at nhh.no  Sat Dec 22 18:18:54 2012
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sat, 22 Dec 2012 18:18:54 +0100
Subject: [R-sig-Geo] scaling response variable in a GWR
In-Reply-To: <50C73EBA.7070108@gmail.com>
References: <50C73EBA.7070108@gmail.com>
Message-ID: <alpine.LRH.2.02.1212221814410.19787@reclus.nhh.no>

On Tue, 11 Dec 2012, Jean-Yves Barnagaud wrote:

> Dear listers;
>
> I'm wondering about how to scale variables to get meaningful results in a 
> geographically weighted regression. Apologies if this topic has already been 
> adressed on the list, I didn't find out.
>
> My aim is to study spatial patterns in the temporal trend of a variable, say 
> Y, through a GWR - in a nutschell as far as I understand the model is like:
>
> Y[x,y,t] = alpha[x,y] + beta[x,y]*time[t]
>
> where beta[x,y] and alpha[x,y] are computed as a bandwidth function of 
> neighbouring points -> am I right in my summary here?

I'm not sure that you are. This feels a bit like an attempt to look at the 
separability of spatial and temporal processes, where you could also 
include a process in [t] too. A separable setting would have only alpha 
and time, while their interaction is beta, perhaps? I don't think that 
scaling is central to the problem as such, although this may depend on 
the empirical configuration of Y.

Roger

>
> Y is a continuous normally distributed variable, and I'm interested in a way 
> of scaling Y which would allow to compare alpha and beta across localities. 
> As my reseearch question is related to whether and where Y increases more or 
> less, I'm particularly interested in the magnitude of beta, not just its 
> sign.
>
>> Do I need any kind of scaling ever? I mean, would I be able to compare 
> beta[x,y] between sites in which the mean Y differs (and thus ground my gwr 
> on raw Y values)? Or should I expect some kind of relationship between alpha 
> and beta (something like localities with higher Y have higher betas)? I'm not 
> too sure about whether what I know from standard linear regression holds for 
> GWR.
>
>> If I do need a scaling what would be wise to do?
>
> - scaling Y across sites, or within sites?
> - scaling by standardizing ((Y-mean(Y)) / sd(Y)) or something else, like 
> Y/max(Y) ? or something else?
>
> Any justified advice appreciated :o)
>
> Thanks a lot in advance;
>
> Best
>
> JY Barnagaud
>
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From evberghe at gmail.com  Sat Dec 22 18:43:28 2012
From: evberghe at gmail.com (Edward Vanden Berghe)
Date: Sat, 22 Dec 2012 18:43:28 +0100
Subject: [R-sig-Geo] reading PostGIS table into sp data frame
In-Reply-To: <alpine.LRH.2.02.1212211315100.15932@reclus.nhh.no>
References: <005501cdded8$449ec350$cddc49f0$@gmail.com>
	<alpine.LRH.2.02.1212202053130.13083@reclus.nhh.no>
	<002301cddf67$c8f223b0$5ad66b10$@gmail.com>
	<alpine.LRH.2.02.1212211315100.15932@reclus.nhh.no>
Message-ID: <000901cde06b$da9f06f0$8fdd14d0$@gmail.com>

Sorry, me again.

The PostGIS driver might be missing from the pre-compiled version of rgdal for Windows, but the ODBC driver isn't; so that should be an alternative to using a driver specific for PostGIS. But as already mentioned, the following R statement

> p <- readOGR(dsn="ODBC:PostgreSQL VM", "geo.cs10d")

results in the following output:

Error in ogrInfo(dsn = dsn, layer = layer, encoding = encoding) : 
  Multiple # dimensions:

I checked the log files of the postgresql server; there seems to be an sql statement asking for a non-existing field:

192.168.56.101(49436): evberghe: 2012-12-22 12:27:00 EST: LOG:  connection authorized: user=evberghe database=obis	
192.168.56.101(49436): evberghe: 2012-12-22 12:27:00 EST: ERROR:  column "geometry_type" does not exist at character 41	
192.168.56.101(49436): evberghe: 2012-12-22 12:27:00 EST: STATEMENT:  SELECT f_table_name, f_geometry_column, geometry_type FROM geometry_columns	
	

I assume rgdal is checking whether all records have the same number of dimensions and the same geometry type. The geometry type is in a field 'type', not in a field 'geometry_type'.

Is it because the PostGIS driver is not available that the ODBC driver doesn't know the correct field in which to look for the geometry type? 

I could ask the PostgreSQL server to log everything and post the relevant sections of the log if this would help.

Edward

-----Original Message-----
From: Roger Bivand [mailto:Roger.Bivand at nhh.no] 
Sent: 21 December 2012 13:31
To: Edward Vanden Berghe
Cc: r-sig-geo at r-project.org
Subject: RE: [R-sig-Geo] reading PostGIS table into sp data frame

On Fri, 21 Dec 2012, Edward Vanden Berghe wrote:

> The GDAL was installed from www.gisinternals.com/sdk; I installed the 
> 32 bits version, though my Windows version is 64: the table on 
> gisinternals.com stated that there was a build problem with the 
> 64-bits version.
>
> rgdal was installed from CRAN, as a binary, version 0.7-20, build 
> 2.15.1. R version is 2.15.2 (2012-10-26) -- "Trick or Treat", platform
> x86_64-w64-mingw32/x64 (64-bit).
>
> The output from ogrDrivers() is pasted below.
>
> If I understand you correctly, and since I am using the standard CRAN 
> Windows binary package, I might be out of luck?

Not out of luck, the users of the CRAN Windows and OSX rgdal binaries are very lucky indeed, thanks to hard work by Uwe Ligges, Brian Ripley and Simon Urbanek. At least many of the most commonly used drivers are present.

There never is a complete set of drivers ionstalled in any GDAL, some depend on proprietary dynamically linked objects.

file.show(system.file("README.windows", package="rgdal"))

displays the accumulated - but *not* updated - wisdom with regard to installing source rgdal on Windows, linked to an external GDAL DLL. If you try to follow this route, please pass back your experience with regard to installing - it is likely that much has changed. You may find that OSGeo4W is another source for a Win32 GDAL binary, but I don't see from the documentation whether it supports PostGIS.

Installing Linux, PostgreSQL, PostGIS, GDAL, Proj.4, etc., then R and rgdal under Linux will probably require less jumping through hoops than building rgdal against an external 64-bit GDAL under windows.

Hope this helps,

Roger

>
> Cheers,
>
> Edward
>
> Output from ogrDrivers():
>
>             name write
> 1      AeronavFAA FALSE
> 2          ARCGEN FALSE
> 3          AVCBin FALSE
> 4          AVCE00 FALSE
> 5             BNA  TRUE
> 6             CSV  TRUE
> 7             DGN  TRUE
> 8             DXF  TRUE
> 9          EDIGEO FALSE
> 10 ESRI Shapefile  TRUE
> 11     Geoconcept  TRUE
> 12        GeoJSON  TRUE
> 13       Geomedia FALSE
> 14         GeoRSS  TRUE
> 15            GML  TRUE
> 16            GMT  TRUE
> 17       GPSBabel  TRUE
> 18  GPSTrackMaker  TRUE
> 19            GPX  TRUE
> 20            HTF FALSE
> 21         Idrisi FALSE
> 22            KML  TRUE
> 23   MapInfo File  TRUE
> 24         Memory  TRUE
> 25   MSSQLSpatial  TRUE
> 26           ODBC  TRUE
> 27        OpenAir FALSE
> 28         PCIDSK  TRUE
> 29            PDS FALSE
> 30         PGDump  TRUE
> 31           PGeo FALSE
> 32            REC FALSE
> 33            S57  TRUE
> 34           SDTS FALSE
> 35       SEGUKOOA FALSE
> 36           SEGY FALSE
> 37            SUA FALSE
> 38            SVG FALSE
> 39          TIGER  TRUE
> 40        UK .NTF FALSE
> 41            VFK FALSE
> 42            VRT FALSE
> 43         XPlane FALSE
>
> -----Original Message-----
> From: Roger Bivand [mailto:Roger.Bivand at nhh.no]
> Sent: 20 December 2012 20:58
> To: Edward Vanden Berghe
> Cc: r-sig-geo at r-project.org
> Subject: Re: [R-sig-Geo] reading PostGIS table into sp data frame
>
> On Thu, 20 Dec 2012, Edward Vanden Berghe wrote:
>
>> Thanks!
>>
>> Unfortunately I have no luck trying to get readOGR to work directly 
>> with the PostGIS database. I tried different variations:
>
> Did you check whether your rgdal/GDAL supports the PostGIS driver? Did you look at the output of ogrDrivers()? If you did not install rgdal as a source package built against a GDAL that has the PostGIS driver on your platform (maybe OSGeo4W??), but are using the standard CRAN Windows binary package, then it is simply the case that the driver is not supported. On OSX using the Kyngchaos frameworks, or on Linux, this would be simple, but it isn't simple on Windows. You need to establish how rgdal was installed and report that.
>
> Hope this clarifies,
>
> Roger
>
>>
>>> sp.object <- readOGR(dsn="PG:dbname=...
>>> sp.object <- readOGR(dsn="my_dsn" ... [where my_dsn is a Windows 
>>> system dsn] sp.object <- readOGR(dsn="PG:my_dsn" ...
>>
>> all result in the same error message:
>>
>> 	Error in ogrInfo(dsn = dsn, layer = layer, input_field_name_encoding = input_field_name_encoding) :
>> 	  Cannot open file
>>
>> Another variation,
>>
>>> sp.object <- readOGR(dsn="ODBC:my_dsn" ...
>>
>> Results in
>>
>> 	Error in ogrInfo(dsn = dsn, layer = layer, input_field_name_encoding = input_field_name_encoding) :
>> 	  Multiple # dimensions:
>>
>> though all he geometries are 2d, and there is a constraint enforcing 
>> this in the database.
>>
>> It seems rgdal is properly installed: I can use readOGR to read shape 
>> files (and this, actually, resolves my problem, as I can use this as 
>> a work-around); also, ogrDrivers() returns a list of 43 drivers (but 
>> PG, PostgreSQL or PostGIS are not among these; ESRI Shapefile and ODBC are).
>>
>> I have no problems connecting to the PostgreSQL database using either 
>> DBI/RPostgreSQL, or RODBC (the latter with the same Windows system 
>> DSN that I used for the tests above). I am not familiar with GDAL, 
>> don't know how to try and connect to the PostgreSQL database from 
>> GDAL directly, rather than through rgdal.
>>
>> Again, any insight in what might go wrong would be most appreciated.
>>
>> Cheers,
>>
>> Edward
>>
>> Message: 4
>> Date: Wed, 19 Dec 2012 14:58:52 +0100
>> From: Raffaele Morelli <raffaele.morelli at gmail.com>
>> To: r-sig-geo at r-project.org
>> Subject: Re: [R-sig-Geo] reading PostGIS table into sp data frame
>> Message-ID:
>> 	<CAD4guxOt5fSUPbK4VbbPuZf-oTBrcY-UvNPcguvUYt4qS0+_kQ at mail.gmail.com>
>> Content-Type: text/plain
>>
>> 2012/12/19 Edward Vanden Berghe <evberghe at gmail.com>
>>
>>> I wanted to create a global map with squares in lat-lon. I have 
>>> PostGIS tables to define these squares  but I havent been able to 
>>> figure out an efficient way of reading those tables into R. The code I am using now is:
>>>
>>>        crs <- CRS("+proj=longlat +ellps=WGS84")
>>>        s <- paste("select id, st_astext(geom) as geom from 
>>> geo.cs10d";",
>>> sep="")
>>>        r <- dbGetQuery(con, s)
>>>        p <- readWKT(r$geom[1],id=r$id[1],p4s=crs)
>>>        for(i in 2:length(r$id)){
>>>               p <- rbind(p, readWKT(r$geom[i], id=r$id[i], p4s=crs))
>>>        }
>>>
>>> where geo.cs10d is the table with squares, id the primary key of the 
>>> table, and geom the binary geometry field.
>>>
>>> The code above works fine for the larger squares, such as 10 
>>> degrees, of which I only need 648 to cover the globe. For finer 
>>> resolutions, the above takes just too long  I assume because the 
>>> rbind function rewrites the whole sp object each time it executes. 
>>> Ive seen other R scripts that initiate an empty data frame of the 
>>> correct length to go round similar problems with the rbind function; 
>>> I havent been able to find an equivalent for spatial polygons. How 
>>> can I initiate an empty data frame with the right structure, and the right length?
>>>
>>> A preferable solution would be if there would be a single function 
>>> to load a complete PostGIS table, rather than having to load the 
>>> polygons one by one in a loop. Is there such a function?
>>>
>>> Im using PostgreSQL 8.4, PostGIS 1.5, R 2.15.2, platform 
>>> x86_64-w64-mingw32; IDE is StatET 3.0.1 plugin for Eclipse 3.7.2.
>>>
>>> Any help would be much appreciated.
>>>
>>> Edward
>>>
>>
>> Use postgis st_transfom to convert your table in epsg:4326, I would 
>> suggest to use a view for that.
>> Then use readOGR (in package rgdal) to read the table/view (geom and
>> attributes) in a sp object with :
>>
>> sp.object <- readOGR("PG:dbname=your_db host=your_host user=username 
>> password=xxx", "geo.cs10d ")
>>
>> regards
>> -r
>>
>>
>>
>
> --
> Roger Bivand
> Department of Economics, NHH Norwegian School of Economics, Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>
>

--
Roger Bivand
Department of Economics, NHH Norwegian School of Economics, Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From Roger.Bivand at nhh.no  Sat Dec 22 18:54:38 2012
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sat, 22 Dec 2012 18:54:38 +0100
Subject: [R-sig-Geo] reading PostGIS table into sp data frame
In-Reply-To: <000901cde06b$da9f06f0$8fdd14d0$@gmail.com>
References: <005501cdded8$449ec350$cddc49f0$@gmail.com>
	<alpine.LRH.2.02.1212202053130.13083@reclus.nhh.no>
	<002301cddf67$c8f223b0$5ad66b10$@gmail.com>
	<alpine.LRH.2.02.1212211315100.15932@reclus.nhh.no>
	<000901cde06b$da9f06f0$8fdd14d0$@gmail.com>
Message-ID: <alpine.LRH.2.02.1212221848150.19787@reclus.nhh.no>

On Sat, 22 Dec 2012, Edward Vanden Berghe wrote:

> Sorry, me again.
>
> The PostGIS driver might be missing from the pre-compiled version of 
> rgdal for Windows, but the ODBC driver isn't; so that should be an 
> alternative to using a driver specific for PostGIS. But as already 
> mentioned, the following R statement
>
>> p <- readOGR(dsn="ODBC:PostgreSQL VM", "geo.cs10d")
>
> results in the following output:
>
> Error in ogrInfo(dsn = dsn, layer = layer, encoding = encoding) :
>  Multiple # dimensions:
>
> I checked the log files of the postgresql server; there seems to be an sql statement asking for a non-existing field:
>
> 192.168.56.101(49436): evberghe: 2012-12-22 12:27:00 EST: LOG:  connection authorized: user=evberghe database=obis
> 192.168.56.101(49436): evberghe: 2012-12-22 12:27:00 EST: ERROR:  column "geometry_type" does not exist at character 41
> 192.168.56.101(49436): evberghe: 2012-12-22 12:27:00 EST: STATEMENT:  SELECT f_table_name, f_geometry_column, geometry_type FROM geometry_columns
>
>
> I assume rgdal is checking whether all records have the same number of 
> dimensions and the same geometry type. The geometry type is in a field 
> 'type', not in a field 'geometry_type'.

rgdal doesn't check anything at all, it uses OGR to handle everything. Try 
first with the ogrinfo and ogr2ogr command line utilities. If your 
external GDAL does have PostGIS support, then - as the rgdal documentation 
says - use ogr2ogr to convert your PostGIS data to a file or database 
format that you have a read driver for in rgdal with static GDAL. You may 
run this through the R system() function. Writing to PostGIS could be done 
in the same way. Try using ogr2ogr as an intermediary.

>
> Is it because the PostGIS driver is not available that the ODBC driver 
> doesn't know the correct field in which to look for the geometry type?
>

Yes, of course.

> I could ask the PostgreSQL server to log everything and post the 
> relevant sections of the log if this would help.

The only way to use PostGIS directly in rgdal is to install rgdal against 
a GDAL that has the required drivers - the Windows CRAN rgdal binary does 
not, and almost certainly will never have the PostGIS driver.

Hope this clarifies,

Roger

>
> Edward
>
> -----Original Message-----
> From: Roger Bivand [mailto:Roger.Bivand at nhh.no]
> Sent: 21 December 2012 13:31
> To: Edward Vanden Berghe
> Cc: r-sig-geo at r-project.org
> Subject: RE: [R-sig-Geo] reading PostGIS table into sp data frame
>
> On Fri, 21 Dec 2012, Edward Vanden Berghe wrote:
>
>> The GDAL was installed from www.gisinternals.com/sdk; I installed the
>> 32 bits version, though my Windows version is 64: the table on
>> gisinternals.com stated that there was a build problem with the
>> 64-bits version.
>>
>> rgdal was installed from CRAN, as a binary, version 0.7-20, build
>> 2.15.1. R version is 2.15.2 (2012-10-26) -- "Trick or Treat", platform
>> x86_64-w64-mingw32/x64 (64-bit).
>>
>> The output from ogrDrivers() is pasted below.
>>
>> If I understand you correctly, and since I am using the standard CRAN
>> Windows binary package, I might be out of luck?
>
> Not out of luck, the users of the CRAN Windows and OSX rgdal binaries are very lucky indeed, thanks to hard work by Uwe Ligges, Brian Ripley and Simon Urbanek. At least many of the most commonly used drivers are present.
>
> There never is a complete set of drivers ionstalled in any GDAL, some depend on proprietary dynamically linked objects.
>
> file.show(system.file("README.windows", package="rgdal"))
>
> displays the accumulated - but *not* updated - wisdom with regard to installing source rgdal on Windows, linked to an external GDAL DLL. If you try to follow this route, please pass back your experience with regard to installing - it is likely that much has changed. You may find that OSGeo4W is another source for a Win32 GDAL binary, but I don't see from the documentation whether it supports PostGIS.
>
> Installing Linux, PostgreSQL, PostGIS, GDAL, Proj.4, etc., then R and rgdal under Linux will probably require less jumping through hoops than building rgdal against an external 64-bit GDAL under windows.
>
> Hope this helps,
>
> Roger
>
>>
>> Cheers,
>>
>> Edward
>>
>> Output from ogrDrivers():
>>
>>             name write
>> 1      AeronavFAA FALSE
>> 2          ARCGEN FALSE
>> 3          AVCBin FALSE
>> 4          AVCE00 FALSE
>> 5             BNA  TRUE
>> 6             CSV  TRUE
>> 7             DGN  TRUE
>> 8             DXF  TRUE
>> 9          EDIGEO FALSE
>> 10 ESRI Shapefile  TRUE
>> 11     Geoconcept  TRUE
>> 12        GeoJSON  TRUE
>> 13       Geomedia FALSE
>> 14         GeoRSS  TRUE
>> 15            GML  TRUE
>> 16            GMT  TRUE
>> 17       GPSBabel  TRUE
>> 18  GPSTrackMaker  TRUE
>> 19            GPX  TRUE
>> 20            HTF FALSE
>> 21         Idrisi FALSE
>> 22            KML  TRUE
>> 23   MapInfo File  TRUE
>> 24         Memory  TRUE
>> 25   MSSQLSpatial  TRUE
>> 26           ODBC  TRUE
>> 27        OpenAir FALSE
>> 28         PCIDSK  TRUE
>> 29            PDS FALSE
>> 30         PGDump  TRUE
>> 31           PGeo FALSE
>> 32            REC FALSE
>> 33            S57  TRUE
>> 34           SDTS FALSE
>> 35       SEGUKOOA FALSE
>> 36           SEGY FALSE
>> 37            SUA FALSE
>> 38            SVG FALSE
>> 39          TIGER  TRUE
>> 40        UK .NTF FALSE
>> 41            VFK FALSE
>> 42            VRT FALSE
>> 43         XPlane FALSE
>>
>> -----Original Message-----
>> From: Roger Bivand [mailto:Roger.Bivand at nhh.no]
>> Sent: 20 December 2012 20:58
>> To: Edward Vanden Berghe
>> Cc: r-sig-geo at r-project.org
>> Subject: Re: [R-sig-Geo] reading PostGIS table into sp data frame
>>
>> On Thu, 20 Dec 2012, Edward Vanden Berghe wrote:
>>
>>> Thanks!
>>>
>>> Unfortunately I have no luck trying to get readOGR to work directly
>>> with the PostGIS database. I tried different variations:
>>
>> Did you check whether your rgdal/GDAL supports the PostGIS driver? Did you look at the output of ogrDrivers()? If you did not install rgdal as a source package built against a GDAL that has the PostGIS driver on your platform (maybe OSGeo4W??), but are using the standard CRAN Windows binary package, then it is simply the case that the driver is not supported. On OSX using the Kyngchaos frameworks, or on Linux, this would be simple, but it isn't simple on Windows. You need to establish how rgdal was installed and report that.
>>
>> Hope this clarifies,
>>
>> Roger
>>
>>>
>>>> sp.object <- readOGR(dsn="PG:dbname=...
>>>> sp.object <- readOGR(dsn="my_dsn" ... [where my_dsn is a Windows
>>>> system dsn] sp.object <- readOGR(dsn="PG:my_dsn" ...
>>>
>>> all result in the same error message:
>>>
>>> 	Error in ogrInfo(dsn = dsn, layer = layer, input_field_name_encoding = input_field_name_encoding) :
>>> 	  Cannot open file
>>>
>>> Another variation,
>>>
>>>> sp.object <- readOGR(dsn="ODBC:my_dsn" ...
>>>
>>> Results in
>>>
>>> 	Error in ogrInfo(dsn = dsn, layer = layer, input_field_name_encoding = input_field_name_encoding) :
>>> 	  Multiple # dimensions:
>>>
>>> though all he geometries are 2d, and there is a constraint enforcing
>>> this in the database.
>>>
>>> It seems rgdal is properly installed: I can use readOGR to read shape
>>> files (and this, actually, resolves my problem, as I can use this as
>>> a work-around); also, ogrDrivers() returns a list of 43 drivers (but
>>> PG, PostgreSQL or PostGIS are not among these; ESRI Shapefile and ODBC are).
>>>
>>> I have no problems connecting to the PostgreSQL database using either
>>> DBI/RPostgreSQL, or RODBC (the latter with the same Windows system
>>> DSN that I used for the tests above). I am not familiar with GDAL,
>>> don't know how to try and connect to the PostgreSQL database from
>>> GDAL directly, rather than through rgdal.
>>>
>>> Again, any insight in what might go wrong would be most appreciated.
>>>
>>> Cheers,
>>>
>>> Edward
>>>
>>> Message: 4
>>> Date: Wed, 19 Dec 2012 14:58:52 +0100
>>> From: Raffaele Morelli <raffaele.morelli at gmail.com>
>>> To: r-sig-geo at r-project.org
>>> Subject: Re: [R-sig-Geo] reading PostGIS table into sp data frame
>>> Message-ID:
>>> 	<CAD4guxOt5fSUPbK4VbbPuZf-oTBrcY-UvNPcguvUYt4qS0+_kQ at mail.gmail.com>
>>> Content-Type: text/plain
>>>
>>> 2012/12/19 Edward Vanden Berghe <evberghe at gmail.com>
>>>
>>>> I wanted to create a global map with squares in lat-lon. I have
>>>> PostGIS tables to define these squares  but I havent been able to
>>>> figure out an efficient way of reading those tables into R. The code I am using now is:
>>>>
>>>>        crs <- CRS("+proj=longlat +ellps=WGS84")
>>>>        s <- paste("select id, st_astext(geom) as geom from
>>>> geo.cs10d";",
>>>> sep="")
>>>>        r <- dbGetQuery(con, s)
>>>>        p <- readWKT(r$geom[1],id=r$id[1],p4s=crs)
>>>>        for(i in 2:length(r$id)){
>>>>               p <- rbind(p, readWKT(r$geom[i], id=r$id[i], p4s=crs))
>>>>        }
>>>>
>>>> where geo.cs10d is the table with squares, id the primary key of the
>>>> table, and geom the binary geometry field.
>>>>
>>>> The code above works fine for the larger squares, such as 10
>>>> degrees, of which I only need 648 to cover the globe. For finer
>>>> resolutions, the above takes just too long  I assume because the
>>>> rbind function rewrites the whole sp object each time it executes.
>>>> Ive seen other R scripts that initiate an empty data frame of the
>>>> correct length to go round similar problems with the rbind function;
>>>> I havent been able to find an equivalent for spatial polygons. How
>>>> can I initiate an empty data frame with the right structure, and the right length?
>>>>
>>>> A preferable solution would be if there would be a single function
>>>> to load a complete PostGIS table, rather than having to load the
>>>> polygons one by one in a loop. Is there such a function?
>>>>
>>>> Im using PostgreSQL 8.4, PostGIS 1.5, R 2.15.2, platform
>>>> x86_64-w64-mingw32; IDE is StatET 3.0.1 plugin for Eclipse 3.7.2.
>>>>
>>>> Any help would be much appreciated.
>>>>
>>>> Edward
>>>>
>>>
>>> Use postgis st_transfom to convert your table in epsg:4326, I would
>>> suggest to use a view for that.
>>> Then use readOGR (in package rgdal) to read the table/view (geom and
>>> attributes) in a sp object with :
>>>
>>> sp.object <- readOGR("PG:dbname=your_db host=your_host user=username
>>> password=xxx", "geo.cs10d ")
>>>
>>> regards
>>> -r
>>>
>>>
>>>
>>
>> --
>> Roger Bivand
>> Department of Economics, NHH Norwegian School of Economics, Helleveien 30, N-5045 Bergen, Norway.
>> voice: +47 55 95 93 55; fax +47 55 95 95 43
>> e-mail: Roger.Bivand at nhh.no
>>
>>
>
> --
> Roger Bivand
> Department of Economics, NHH Norwegian School of Economics, Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From raffaele.morelli at gmail.com  Sat Dec 22 20:48:01 2012
From: raffaele.morelli at gmail.com (Raffaele Morelli)
Date: Sat, 22 Dec 2012 20:48:01 +0100
Subject: [R-sig-Geo] reading PostGIS table into sp data frame
In-Reply-To: <000901cde06b$da9f06f0$8fdd14d0$@gmail.com>
References: <005501cdded8$449ec350$cddc49f0$@gmail.com>
	<alpine.LRH.2.02.1212202053130.13083@reclus.nhh.no>
	<002301cddf67$c8f223b0$5ad66b10$@gmail.com>
	<alpine.LRH.2.02.1212211315100.15932@reclus.nhh.no>
	<000901cde06b$da9f06f0$8fdd14d0$@gmail.com>
Message-ID: <CAD4guxOTrEbWTmoLmXAkhJKo88NbG0VDqLb7uskN+QFUgwT+9Q@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121222/047a4486/attachment.pl>

From allenaven at gmail.com  Sun Dec 23 09:54:26 2012
From: allenaven at gmail.com (Allen Aven)
Date: Sun, 23 Dec 2012 02:54:26 -0600
Subject: [R-sig-Geo] line density
Message-ID: <CADwQ1voLQnf6R8FGzGecatpEYXgMzt2ad3qUfHqPYvoLSKhtvA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121223/738df841/attachment.pl>

From villers.alexandre at gmail.com  Sun Dec 23 10:02:12 2012
From: villers.alexandre at gmail.com (Alexandre Villers)
Date: Sun, 23 Dec 2012 11:02:12 +0200
Subject: [R-sig-Geo] line density
In-Reply-To: <CADwQ1voLQnf6R8FGzGecatpEYXgMzt2ad3qUfHqPYvoLSKhtvA@mail.gmail.com>
References: <CADwQ1voLQnf6R8FGzGecatpEYXgMzt2ad3qUfHqPYvoLSKhtvA@mail.gmail.com>
Message-ID: <50D6C894.1020703@gmail.com>

Hi,

Have a look at density.psp() in spatstat package ( 
http://r-sig-geo.2731867.n2.nabble.com/Kernel-Density-With-Lines-td6407187.html 
)

HTH

Alex



On 23/12/2012 10:54, Allen Aven wrote:
> Hi geo-listers.  I'm trying to figure out if there is a method in R for
> line density estimation, similar to an existing tool in Arc.  My specific
> problem is to estimate location and relative frequency of use of wildlife
> travel corridors based on lines drawn between telemetry points.  I have
> thought of converting the lines to very closely spaced points and then
> using standard kernel density estimation tools (such as found in the ks or
> adehabitat packages) but I'm not sure if that's a valid approach.  Any help
> would be much appreciated!
> Allen
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From alobolistas at gmail.com  Sun Dec 23 11:56:24 2012
From: alobolistas at gmail.com (Agustin Lobo)
Date: Sun, 23 Dec 2012 11:56:24 +0100
Subject: [R-sig-Geo] Rotating with maptools::ellide()
In-Reply-To: <alpine.LRH.2.02.1212152303100.22746@reclus.nhh.no>
References: <CAG4NRe+zWjcrG0qrTtr4=C5E_HY6V1bTDS0a=i72YPhn91RscQ@mail.gmail.com>
	<alpine.LRH.2.02.1212152303100.22746@reclus.nhh.no>
Message-ID: <CAG4NRe+=5qY6H5Rebba+DwHyhpWzheDj008pSiMHEDG9VgKMmw@mail.gmail.com>

Roger,

On Sat, Dec 15, 2012 at 11:06 PM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
> On Sat, 15 Dec 2012, Agustin Lobo wrote:
>
>> Given an SpPolDF, if I rotate the first polygon  with
>> delme <- elide(testAlfacs20120626footp[1,], rotate=-90)
>>
>> I get the result shifted. I get the rotation I was expecting by indicating
>> the
>> coordinates of the center:
>> delme <- elide(testAlfacs20120626footp[1,],
>> rotate=-90,center=coordinates(testAlfacs20120626footp[1,]))
>>
>> How could I rotate all polygons, each one around its own centroid?
>> I've tried
>>>
>>> delme <- elide(testAlfacs20120626footp,
>>> rotate=-90,center=coordinates(testAlfacs20120626footp))
>>
>> Error in .local(obj, ...) : center must be numeric of length two
>
>
> Plrease provide a motivation - elide methods are not intended to elide parts
> of data sets.
My polygons are rectangles that represent the ideal footprints of
aerial images acquired from a UAV.
I want to rotate in order to visualize different positions of the
camera in the UAV.

>Please also provide the code for copy and paste, withou having
> to discard the leading prompts. If you need a different function, why not
> write one as a loop over elide - although then there will be absolutely no
> chance that your output geometries will be planar, so things like plotting
> just will not work as expected where entities overlap.
Yes, a loop is the obvious solution, I just thought ellide() would actually
provide the option of individual rotation by providing on center point
of rotation for each
polygon.

Thanks

Agus


From alobolistas at gmail.com  Sun Dec 23 12:56:37 2012
From: alobolistas at gmail.com (Agustin Lobo)
Date: Sun, 23 Dec 2012 12:56:37 +0100
Subject: [R-sig-Geo] gdal color tables
Message-ID: <CAG4NRe+5aTUEZgUSupZKfvuyUWtnf=L0gaB-q6ZWLeUeg+P42Q@mail.gmail.com>

Is there a function that would write R color tables as gdal color
tables such as the one described in
http://www.gdal.org/rgb2pct.html
?

Thanks

Agus


From b.rowlingson at lancaster.ac.uk  Sun Dec 23 13:42:25 2012
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Sun, 23 Dec 2012 12:42:25 +0000
Subject: [R-sig-Geo] gdal color tables
In-Reply-To: <e34b82729aed4b3f9b38cab5c8243770@EX-1-HT0.lancs.local>
References: <e34b82729aed4b3f9b38cab5c8243770@EX-1-HT0.lancs.local>
Message-ID: <CANVKczPSLFLN4vj7viF46Fgj6QgwK9dkshWYABwLb1JG-Oq4ug@mail.gmail.com>

On Sun, Dec 23, 2012 at 11:56 AM, Agustin Lobo <alobolistas at gmail.com> wrote:
> Is there a function that would write R color tables as gdal color
> tables such as the one described in
> http://www.gdal.org/rgb2pct.html
> ?

 I'm not sure what you mean by an "R color table" - just a vector of colours?

 For output do you mean the XML snippet at the bottom of that page?
All of it, or just the <colortable> part?

 Two minute job to do, twenty minute job to do properly...

Barry


From alobolistas at gmail.com  Sun Dec 23 14:14:03 2012
From: alobolistas at gmail.com (Agustin Lobo)
Date: Sun, 23 Dec 2012 14:14:03 +0100
Subject: [R-sig-Geo] gdal color tables
In-Reply-To: <CANVKczPSLFLN4vj7viF46Fgj6QgwK9dkshWYABwLb1JG-Oq4ug@mail.gmail.com>
References: <e34b82729aed4b3f9b38cab5c8243770@EX-1-HT0.lancs.local>
	<CANVKczPSLFLN4vj7viF46Fgj6QgwK9dkshWYABwLb1JG-Oq4ug@mail.gmail.com>
Message-ID: <CAG4NReKWW=ptKztB+txMye_0ym7_tUi+TeZqAOTMY7tdxhH9+A@mail.gmail.com>

On Sun, Dec 23, 2012 at 1:42 PM, Barry Rowlingson
<b.rowlingson at lancaster.ac.uk> wrote:
> On Sun, Dec 23, 2012 at 11:56 AM, Agustin Lobo <alobolistas at gmail.com> wrote:
>> Is there a function that would write R color tables as gdal color
>> tables such as the one described in
>> http://www.gdal.org/rgb2pct.html
>> ?
>
>  I'm not sure what you mean by an "R color table" - just a vector of colours?
Form the help pages
"A color palette, i.e. a vector of n contiguous colors generated by
functions like rainbow, heat.colors, topo.colors, bpy.colors or one or
your own making, perhaps using colorRampPalette"

>  For output do you mean the XML snippet at the bottom of that page?
> All of it, or just the <colortable> part?
The colortable part.
http://www.gdal.org/classGDALColorTable.html

>
>  Two minute job to do, twenty minute job to do properly...
0 minutes if it already exists and, most important, the obvious
advantage of using an standard function that has already been tested
(or help out by testing it)...

An alternative could be using
http://en.geopublishing.org/gdal%20colorpalette%20to%20symbology%20encoding

but have not tried myself (yet).

I understand, that, as far as you know, such a function does not exist.

Agus

> Barry
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From b.rowlingson at lancaster.ac.uk  Sun Dec 23 15:25:58 2012
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Sun, 23 Dec 2012 14:25:58 +0000
Subject: [R-sig-Geo] gdal color tables
In-Reply-To: <475004ce3cdb45768306de325ffebf69@EX-1-HT0.lancs.local>
References: <e34b82729aed4b3f9b38cab5c8243770@EX-1-HT0.lancs.local>
	<CANVKczPSLFLN4vj7viF46Fgj6QgwK9dkshWYABwLb1JG-Oq4ug@mail.gmail.com>
	<475004ce3cdb45768306de325ffebf69@EX-1-HT0.lancs.local>
Message-ID: <CANVKczMPQrdTpCbRJP7C7ddH51XrygK7LCsP7cCX7DYDvWq2aA@mail.gmail.com>

On Sun, Dec 23, 2012 at 1:14 PM, Agustin Lobo <alobolistas at gmail.com> wrote:

>>  I'm not sure what you mean by an "R color table" - just a vector of colours?
> Form the help pages
> "A color palette, i.e. a vector of n contiguous colors generated by
> functions like rainbow, heat.colors, topo.colors, bpy.colors or one or
> your own making, perhaps using colorRampPalette"

 Okay, that is just a vector of colours.

>>  For output do you mean the XML snippet at the bottom of that page?
>> All of it, or just the <colortable> part?
> The colortable part.
> http://www.gdal.org/classGDALColorTable.html

 You mean you want to convert an R vector of colours to a C++ structure?

Barry


From Roger.Bivand at nhh.no  Sun Dec 23 15:54:33 2012
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sun, 23 Dec 2012 15:54:33 +0100
Subject: [R-sig-Geo] gdal color tables
In-Reply-To: <CAG4NReKWW=ptKztB+txMye_0ym7_tUi+TeZqAOTMY7tdxhH9+A@mail.gmail.com>
References: <e34b82729aed4b3f9b38cab5c8243770@EX-1-HT0.lancs.local>
	<CANVKczPSLFLN4vj7viF46Fgj6QgwK9dkshWYABwLb1JG-Oq4ug@mail.gmail.com>
	<CAG4NReKWW=ptKztB+txMye_0ym7_tUi+TeZqAOTMY7tdxhH9+A@mail.gmail.com>
Message-ID: <alpine.LRH.2.02.1212231529180.26107@reclus.nhh.no>

On Sun, 23 Dec 2012, Agustin Lobo wrote:

> On Sun, Dec 23, 2012 at 1:42 PM, Barry Rowlingson
> <b.rowlingson at lancaster.ac.uk> wrote:
>> On Sun, Dec 23, 2012 at 11:56 AM, Agustin Lobo <alobolistas at gmail.com> wrote:
>>> Is there a function that would write R color tables as gdal color
>>> tables such as the one described in
>>> http://www.gdal.org/rgb2pct.html
>>> ?
>>
>>  I'm not sure what you mean by an "R color table" - just a vector of colours?
> Form the help pages
> "A color palette, i.e. a vector of n contiguous colors generated by
> functions like rainbow, heat.colors, topo.colors, bpy.colors or one or
> your own making, perhaps using colorRampPalette"
>
>>  For output do you mean the XML snippet at the bottom of that page?
>> All of it, or just the <colortable> part?
> The colortable part.
> http://www.gdal.org/classGDALColorTable.html
>
>>
>>  Two minute job to do, twenty minute job to do properly...
> 0 minutes if it already exists and, most important, the obvious
> advantage of using an standard function that has already been tested
> (or help out by testing it)...

Isn't this ?RGB2PCT ?

This does exactly what the Python script does. It can return the color 
vector, and regular R functions can convert it to a matrix of RGBA values:

logo <- system.file("pictures/Rlogo.jpg", package="rgdal")[1]
x <- GDAL.open(logo)
dim(x)
dx <- RGB2PCT(x, band=1:3)
GDAL.close(x)
displayDataset(dx)
dim(dx)
ct <- getColorTable(dx)
# to save the file if needed
tf <- tempfile()
dxx <- copyDataset(dx, "GTiff")
saveDataset(dxx, tf)
GDAL.close(dx)

sx <- GDAL.open(tf)
displayDataset(sx)
GDAL.close(sx)

colmat <-t(col2rgb(ct, alpha=TRUE))
head(colmat)

Wrapping this in cat() and paste() to get the desired XML should not be 
hard. SGDF2PCT() can be used for three-band SpatialGridDataFrame objects.

Hope this clarifies,

Roger

>
> An alternative could be using
> http://en.geopublishing.org/gdal%20colorpalette%20to%20symbology%20encoding
>
> but have not tried myself (yet).
>
> I understand, that, as far as you know, such a function does not exist.
>
> Agus
>
>> Barry
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From fairyland118 at gmail.com  Sun Dec 23 17:31:57 2012
From: fairyland118 at gmail.com (Joseph Duncan)
Date: Sun, 23 Dec 2012 11:31:57 -0500
Subject: [R-sig-Geo] (no subject)
Message-ID: <CANZYGDfW0Vq-YBowV-Sfd04y1Tj_qC7fc7koxhPbqWxGfV3AaQ@mail.gmail.com>

Hi Everyone

Happy Christmas!

I have tried several days but cannot solve the problem.  Can any one help
me ? Below is R command for a simple spatial regression. The data is
attached.


library(spdep)
library(sphet)
mat0 <- read.table("50state1.txt", header=FALSE, sep="\t", fill=TRUE)
mat <- as.matrix(mat0)
dim(mat)
summary(c(mat))
mat[is.na(mat)] <- 0
summary(c(mat))
lw <- mat2listw(mat, style="B")
summary(lw, zero.policy=TRUE)
is.symmetric.nb(lw$neighbours)

lit <- read.csv(file="lit1.csv", h=T, sep= ",")
sarml <- lagsarlm(lpax2010 ~ sh65up + lpoptot + lypc, data = lit, listw =
lw, method ="eigen", zero.policy=TRUE)
summary(sarml)


Thank you very much

 Fairy
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121223/8da92843/attachment.html>
-------------- next part --------------
									1	1														1																		1								
																																																		
				1																								1			1													1						
																		1						1	1											1						1	1							
		1																										1									1													
																1											1				1					1								1						1
																					1											1							1											
																				1										1								1												
																				1																										1				
1										1																																								
1									1																								1							1		1								
																																																		
																										1		1									1							1			1			1
														1	1		1					1			1																								1	
													1				1					1													1															
													1										1		1		1														1								1	
					1																				1		1									1														
													1	1											1										1							1				1		1		
			1																					1																			1							
																													1																					
							1	1																														1								1		1		
						1																							1			1							1						1					
													1	1									1												1														1	
															1							1												1							1								1	
1			1															1																								1								
			1										1		1	1	1										1									1						1								
												1																						1							1									1
					1										1	1									1																1									1
		1		1								1																									1							1						
																			1		1																								1					
							1																									1						1												
		1			1																															1							1							
						1															1									1								1							1					
										1																														1		1				1				
																							1			1															1									
														1			1					1																1										1		
			1		1											1									1						1												1							
				1								1																1																			1			
							1													1										1		1			1													1		
						1															1																													
										1																							1																	
															1								1			1	1							1																1
1			1							1							1							1	1								1													1				
			1															1													1					1														
		1			1							1																1																						1
																					1								1			1																		
								1									1			1													1									1						1		
												1																									1													
																	1			1															1			1								1			
												1		1							1	1																											
				1							1														1	1														1									
-------------- next part --------------
A non-text attachment was scrubbed...
Name: lit1.csv
Type: text/csv
Size: 2479 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121223/8da92843/attachment.bin>

From alobolistas at gmail.com  Sun Dec 23 21:00:35 2012
From: alobolistas at gmail.com (Agustin Lobo)
Date: Sun, 23 Dec 2012 21:00:35 +0100
Subject: [R-sig-Geo] gdal color tables
In-Reply-To: <alpine.LRH.2.02.1212231529180.26107@reclus.nhh.no>
References: <e34b82729aed4b3f9b38cab5c8243770@EX-1-HT0.lancs.local>
	<CANVKczPSLFLN4vj7viF46Fgj6QgwK9dkshWYABwLb1JG-Oq4ug@mail.gmail.com>
	<CAG4NReKWW=ptKztB+txMye_0ym7_tUi+TeZqAOTMY7tdxhH9+A@mail.gmail.com>
	<alpine.LRH.2.02.1212231529180.26107@reclus.nhh.no>
Message-ID: <CAG4NReLiSLK9W0VA6hq5B6AT5+uOL=Bo0Ak1cntjwdQ5xHwh4A@mail.gmail.com>

Roger,

The problem is not getting a color table as colmat in your
example, but writing colmat in gdal format to create pseudocolor raster
files, best using either writeRaster() or writeGDAL() (a bit like you
would display a raster layer
in R using plot() and the col argument).
The way I was thinking on was writing
the greylevel raster with the current writeRaster() and then writing
an R function to create a
vrt file that, from one single layer, is essentially the color palette
in gdal format
(see http://trac.osgeo.org/gdal/wiki/FAQRaster#Howtocreateormodifyanimagecolortable).
Then the vrt file can be translated to any other format using gdal_translate.
But then I thought that a more direct function could already exist in
R, thus I asked.

The mention to rgb2pct.py was just to show the format of the palette.

On Sun, Dec 23, 2012 at 3:54 PM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
> .../...
>
> Wrapping this in cat() and paste() to get the desired XML should not be
> hard.

...which definitely  means that the function does not exist. I'll try,
either as you say
or perhaps using R package xml. At least I'll write a function to make
QGIS color tables,
I think the format is the same as in gdal.

Agus


> Hope this clarifies,
>
> Roger
>
>
>>
>> An alternative could be using
>>
>> http://en.geopublishing.org/gdal%20colorpalette%20to%20symbology%20encoding
>>
>> but have not tried myself (yet).
>>
>> I understand, that, as far as you know, such a function does not exist.
>>
>> Agus
>>
>>> Barry
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> --
> Roger Bivand
> Department of Economics, NHH Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From Roger.Bivand at nhh.no  Sun Dec 23 21:15:08 2012
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sun, 23 Dec 2012 21:15:08 +0100
Subject: [R-sig-Geo] (no subject)
In-Reply-To: <CANZYGDfW0Vq-YBowV-Sfd04y1Tj_qC7fc7koxhPbqWxGfV3AaQ@mail.gmail.com>
References: <CANZYGDfW0Vq-YBowV-Sfd04y1Tj_qC7fc7koxhPbqWxGfV3AaQ@mail.gmail.com>
Message-ID: <alpine.LRH.2.02.1212232059470.26815@reclus.nhh.no>

On Sun, 23 Dec 2012, Joseph Duncan wrote:

> Hi Everyone
>
> Happy Christmas!
>
> I have tried several days but cannot solve the problem.  Can any one help
> me ? Below is R command for a simple spatial regression. The data is
> attached.
>
>
> library(spdep)
> library(sphet)
> mat0 <- read.table("50state1.txt", header=FALSE, sep="\t", fill=TRUE)
> mat <- as.matrix(mat0)
> dim(mat)
> summary(c(mat))
> mat[is.na(mat)] <- 0
> summary(c(mat))
> lw <- mat2listw(mat, style="B")
> summary(lw, zero.policy=TRUE)
> is.symmetric.nb(lw$neighbours)
>
> lit <- read.csv(file="lit1.csv", h=T, sep= ",")

One row of lit is all missing values. So the easiest thing to do is to 
find out which:

> dim(lit)
[1] 52  9
> which(is.na(lit$lpax2010))
[1] 52
> lm(lpax2010 ~ sh65up + lpoptot + lypc, data = lit)
Call:
lm(formula = lpax2010 ~ sh65up + lpoptot + lypc, data = lit)

Coefficients:
(Intercept)       sh65up      lpoptot         lypc
     142.559       -1.616        1.669        6.210

> lm(lpax2010 ~ sh65up + lpoptot + lypc, data = lit[-52,])

Call:
lm(formula = lpax2010 ~ sh65up + lpoptot + lypc, data = lit[-52,
     ])

Coefficients:
(Intercept)       sh65up      lpoptot         lypc
     142.559       -1.616        1.669        6.210

(lm can handle dropping the empty row, but lagsarlm cannot when the 
weights were imported as a matrix)

> sarml <- lagsarlm(lpax2010 ~ sh65up + lpoptot + lypc, data = lit, listw =
> lw, method ="eigen", zero.policy=TRUE)

Next, the intercept is scaled in an unfortunate way, so rescale:

> sarml <- lagsarlm(lpax2010 ~ sh65up + lpoptot + lypc, data = lit[-52,], 
listw = lw, method ="eigen", zero.policy=TRUE)
Error in solve.default(inf, tol = tol.solve) :
   system is computationally singular: reciprocal condition number = 
8.55692e-14
> sarml <- lagsarlm(I(lpax2010/100) ~ sh65up + lpoptot + lypc,
  data = lit[-52,], listw = lw, method ="eigen", zero.policy=TRUE)

is OK. You can also declare the binary status of the weights by:

attr(lw$weights, "mode") <- "binary"

then you don't need to drop the NA row in lit, but expecting the software 
to know what you mean by itself when you haven't told it is perhaps risky, 
it might have guessed wrong.

plot(lw$neighbours, as.matrix(lit[-52,c(4,3)]))

looks rather unusual - was it what you intended?

Hope this helps,

Roger


> summary(sarml)
>
>
> Thank you very much
>
> Fairy
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From Roger.Bivand at nhh.no  Sun Dec 23 21:23:46 2012
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sun, 23 Dec 2012 21:23:46 +0100
Subject: [R-sig-Geo] gdal color tables
In-Reply-To: <CAG4NReLiSLK9W0VA6hq5B6AT5+uOL=Bo0Ak1cntjwdQ5xHwh4A@mail.gmail.com>
References: <e34b82729aed4b3f9b38cab5c8243770@EX-1-HT0.lancs.local>
	<CANVKczPSLFLN4vj7viF46Fgj6QgwK9dkshWYABwLb1JG-Oq4ug@mail.gmail.com>
	<CAG4NReKWW=ptKztB+txMye_0ym7_tUi+TeZqAOTMY7tdxhH9+A@mail.gmail.com>
	<alpine.LRH.2.02.1212231529180.26107@reclus.nhh.no>
	<CAG4NReLiSLK9W0VA6hq5B6AT5+uOL=Bo0Ak1cntjwdQ5xHwh4A@mail.gmail.com>
Message-ID: <alpine.LRH.2.02.1212232115580.26815@reclus.nhh.no>

On Sun, 23 Dec 2012, Agustin Lobo wrote:

> Roger,
>
> The problem is not getting a color table as colmat in your
> example, but writing colmat in gdal format to create pseudocolor raster
> files, best using either writeRaster() or writeGDAL() (a bit like you
> would display a raster layer
> in R using plot() and the col argument).
> The way I was thinking on was writing
> the greylevel raster with the current writeRaster() and then writing
> an R function to create a
> vrt file that, from one single layer, is essentially the color palette
> in gdal format
> (see http://trac.osgeo.org/gdal/wiki/FAQRaster#Howtocreateormodifyanimagecolortable).
> Then the vrt file can be translated to any other format using gdal_translate.
> But then I thought that a more direct function could already exist in
> R, thus I asked.

There is no support in raster or sp objects for symbology, and unless 
someone extends the classes to accommodate symbology on a dynamic 
by-attribute basis, it isn't going to happen.

Possibly writeGDAL could set a colortable on the output Byte raster, in 
the way that I did show. First you would need to generate an RGB 
raster/grid object, then quantize it, and output the result. That was the 
point of the code I showed. If you need the facility, you can write it at 
the R level using the lower-level GDAL interface code from an RGB object. 
I guess that is something you could contribute using a vector of R 
colours, col2rbg, and the breaks between colours to partition a numeric 
raster (use findIntervals). Maybe you can re-use code in classInt?

Roger

>
> The mention to rgb2pct.py was just to show the format of the palette.
>
> On Sun, Dec 23, 2012 at 3:54 PM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
>> .../...
>>
>> Wrapping this in cat() and paste() to get the desired XML should not be
>> hard.
>
> ...which definitely  means that the function does not exist. I'll try,
> either as you say
> or perhaps using R package xml. At least I'll write a function to make
> QGIS color tables,
> I think the format is the same as in gdal.
>
> Agus
>
>
>> Hope this clarifies,
>>
>> Roger
>>
>>
>>>
>>> An alternative could be using
>>>
>>> http://en.geopublishing.org/gdal%20colorpalette%20to%20symbology%20encoding
>>>
>>> but have not tried myself (yet).
>>>
>>> I understand, that, as far as you know, such a function does not exist.
>>>
>>> Agus
>>>
>>>> Barry
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at r-project.org
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>> --
>> Roger Bivand
>> Department of Economics, NHH Norwegian School of Economics,
>> Helleveien 30, N-5045 Bergen, Norway.
>> voice: +47 55 95 93 55; fax +47 55 95 95 43
>> e-mail: Roger.Bivand at nhh.no
>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From b.rowlingson at lancaster.ac.uk  Sun Dec 23 22:25:31 2012
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Sun, 23 Dec 2012 21:25:31 +0000
Subject: [R-sig-Geo] gdal color tables
In-Reply-To: <da346ab4f5bd4563918623ef0b210404@EX-1-HT0.lancs.local>
References: <e34b82729aed4b3f9b38cab5c8243770@EX-1-HT0.lancs.local>
	<CANVKczPSLFLN4vj7viF46Fgj6QgwK9dkshWYABwLb1JG-Oq4ug@mail.gmail.com>
	<CAG4NReKWW=ptKztB+txMye_0ym7_tUi+TeZqAOTMY7tdxhH9+A@mail.gmail.com>
	<alpine.LRH.2.02.1212231529180.26107@reclus.nhh.no>
	<CAG4NReLiSLK9W0VA6hq5B6AT5+uOL=Bo0Ak1cntjwdQ5xHwh4A@mail.gmail.com>
	<da346ab4f5bd4563918623ef0b210404@EX-1-HT0.lancs.local>
Message-ID: <CANVKczMTJLDs2w6V_CsLfnjUFP-+AHiShpjn-o=j=TQmPNR9xg@mail.gmail.com>

On Sun, Dec 23, 2012 at 8:23 PM, Roger Bivand <Roger.Bivand at nhh.no> wrote:

> There is no support in raster or sp objects for symbology, and unless
> someone extends the classes to accommodate symbology on a dynamic
> by-attribute basis, it isn't going to happen.
>

 I'm not sure that's true - I can read in a raster from a geoTIFF and
get a colour table from it, then plot will show it with the right
colours - here's a Land Use tiff:

> lu
class       : RasterLayer
dimensions  : 397, 413, 163961  (nrow, ncol, ncell)
resolution  : 100, 100  (x, y)
extent      : 3356200, 3397500, 3533200, 3572900  (xmin, xmax, ymin, ymax)
coord. ref. : +proj=laea +lat_0=52 +lon_0=10 +x_0=4321000 +y_0=3210000
+ellps=GRS80 +units=m +no_defs
data source : /data/rowlings/MapLibrary/Europe/UK/IsleOfMan/iomcorine.tiff
names       : iomcorine
values      : 0, 255  (min, max)

> lu at legend@colortable[1:10]
 [1] "#000000" "#E6004D" "#FF0000" "#CC4DF2" "#CC0000" "#E6CCCC" "#E6CCE6"
 [8] "#A600CC" "#A64D00" "#FF4DFF"


 Support for this is minimal in package:raster, and I think what Agus
is trying to do (correct me if wrong) is create a raster with a colour
table such as this from R. If I just use writeRaster I get a numeric
raster with no palette.

I think Robert has talked about better support for paletted rasters in the past.

Barry


From b.rowlingson at lancaster.ac.uk  Sun Dec 23 22:51:10 2012
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Sun, 23 Dec 2012 21:51:10 +0000
Subject: [R-sig-Geo] gdal color tables
In-Reply-To: <bd3d6d241f90457a891f72e124a33ff8@EX-0-HT0.lancs.local>
References: <e34b82729aed4b3f9b38cab5c8243770@EX-1-HT0.lancs.local>
	<CANVKczPSLFLN4vj7viF46Fgj6QgwK9dkshWYABwLb1JG-Oq4ug@mail.gmail.com>
	<CAG4NReKWW=ptKztB+txMye_0ym7_tUi+TeZqAOTMY7tdxhH9+A@mail.gmail.com>
	<alpine.LRH.2.02.1212231529180.26107@reclus.nhh.no>
	<CAG4NReLiSLK9W0VA6hq5B6AT5+uOL=Bo0Ak1cntjwdQ5xHwh4A@mail.gmail.com>
	<da346ab4f5bd4563918623ef0b210404@EX-1-HT0.lancs.local>
	<bd3d6d241f90457a891f72e124a33ff8@EX-0-HT0.lancs.local>
Message-ID: <CANVKczN3ab11U3hHiARrP8OsvcQsJxhgUg3D2fnEX1s1aw=-Ag@mail.gmail.com>

Here's a solution:

makePalette <- function(colourvector){
  cmat = cbind(t(col2rgb(colourvector)),255)
  res = apply(cmat,1,function(x){sprintf('<Entry c1="%s" c2="%s"
c3="%s" c4="%s"/>',x[1],x[2],x[3],x[4])})
  res = paste(res,collapse="\n")
  res
}


Then:

 write a raster tiff

 writeRaster(iom,"test.tif",overwrite=TRUE,datatype="INT1U")


Then use makePalette to create the colortable lines:

cat(makePalette(iom at legend@colortable)) # replace
iom at legend@colortable with your colour table vector

That spits out a bunch of <Entry> lines. Stick them in your .vrt file thus:

<VRTDataset rasterXSize="413" rasterYSize="397">
  <VRTRasterBand dataType="Byte" band="1">
    <ColorInterp>Palette</ColorInterp>
<SimpleSource>
<SourceFilename relativeToVRT="1">test.tif</SourceFilename>
</SimpleSource>
    <ColorTable>
<Entry c1="0" c2="0" c3="0" c4="255"/>
<Entry c1="230" c2="0" c3="77" c4="255"/>
<Entry c1="255" c2="0" c3="0" c4="255"/>
<Entry c1="204" c2="77" c3="242" c4="255"/>
<Entry c1="204" c2="0" c3="0" c4="255"/>
[etc]
   </ColorTable>
  </VRTRasterBand>
</VRTDataset>

Note you have to fill in the rasterXSize and rasterYSize, and the
source filename. Also you'll need to get the geotransform of the
original and stick that in otherwise your raster is geolocated at
(1:Nrows, 1:Ncolumns).

If I do all that, I get a raster created by R that I can read into
QGis and is coloured according to my colour scheme, as long as I open
*test.vrt* in QGis and *not* test.tif.

I'm sorry this isn't (yet) a one-shot solution, and its a bit of a
construction set. Like I said, two minute job, twenty minute job to do
properly... I've spent ten minutes on it :)

Barry




On Sun, Dec 23, 2012 at 9:25 PM, Rowlingson, Barry
<b.rowlingson at lancaster.ac.uk> wrote:
> On Sun, Dec 23, 2012 at 8:23 PM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
>
>> There is no support in raster or sp objects for symbology, and unless
>> someone extends the classes to accommodate symbology on a dynamic
>> by-attribute basis, it isn't going to happen.
>>
>
>  I'm not sure that's true - I can read in a raster from a geoTIFF and
> get a colour table from it, then plot will show it with the right
> colours - here's a Land Use tiff:
>
>> lu
> class       : RasterLayer
> dimensions  : 397, 413, 163961  (nrow, ncol, ncell)
> resolution  : 100, 100  (x, y)
> extent      : 3356200, 3397500, 3533200, 3572900  (xmin, xmax, ymin, ymax)
> coord. ref. : +proj=laea +lat_0=52 +lon_0=10 +x_0=4321000 +y_0=3210000
> +ellps=GRS80 +units=m +no_defs
> data source : /data/rowlings/MapLibrary/Europe/UK/IsleOfMan/iomcorine.tiff
> names       : iomcorine
> values      : 0, 255  (min, max)
>
>> lu at legend@colortable[1:10]
>  [1] "#000000" "#E6004D" "#FF0000" "#CC4DF2" "#CC0000" "#E6CCCC" "#E6CCE6"
>  [8] "#A600CC" "#A64D00" "#FF4DFF"
>
>
>  Support for this is minimal in package:raster, and I think what Agus
> is trying to do (correct me if wrong) is create a raster with a colour
> table such as this from R. If I just use writeRaster I get a numeric
> raster with no palette.
>
> I think Robert has talked about better support for paletted rasters in the past.
>
> Barry
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From lockhart.katherine at gmail.com  Mon Dec 24 05:18:42 2012
From: lockhart.katherine at gmail.com (Katherine Lockhart)
Date: Sun, 23 Dec 2012 20:18:42 -0800
Subject: [R-sig-Geo] Mean of SpatialGridDataFrames or
	SpatialPixelsDataFrames (Baalam Kan)
Message-ID: <CAMEAd6wWFShqd93ekiAPwugpdZAfNG8ohJXaOcsMPxYFXQbocw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121223/f5f2efd8/attachment.pl>

From fairyland118 at gmail.com  Wed Dec 26 18:02:20 2012
From: fairyland118 at gmail.com (Joseph Duncan)
Date: Wed, 26 Dec 2012 12:02:20 -0500
Subject: [R-sig-Geo] (no subject)
In-Reply-To: <alpine.LRH.2.02.1212232059470.26815@reclus.nhh.no>
References: <CANZYGDfW0Vq-YBowV-Sfd04y1Tj_qC7fc7koxhPbqWxGfV3AaQ@mail.gmail.com>
	<alpine.LRH.2.02.1212232059470.26815@reclus.nhh.no>
Message-ID: <CANZYGDcn+e+KccX-eyT9x9zfSnzN=+hfA8XkcBrHwYjQ7j-uMg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121226/11221219/attachment.pl>

From sergio.edfisica at gmail.com  Thu Dec 27 19:11:40 2012
From: sergio.edfisica at gmail.com (=?ISO-8859-1?Q?S=E9rgio_Henrique_almeida_da_silva_ju?=)
Date: Thu, 27 Dec 2012 16:11:40 -0200
Subject: [R-sig-Geo] Help ggmap
Message-ID: <CAEuVWs3mFok7aDMmJWeue2L1ogSvkBJ-+96e4YLZfEHQjKWtWQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121227/d7403dab/attachment.pl>

From b.rowlingson at lancaster.ac.uk  Thu Dec 27 23:35:48 2012
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Thu, 27 Dec 2012 22:35:48 +0000
Subject: [R-sig-Geo] gdal color tables
In-Reply-To: <605df35965554cd39d3a44c635458589@EX-0-HT0.lancs.local>
References: <e34b82729aed4b3f9b38cab5c8243770@EX-1-HT0.lancs.local>
	<CANVKczPSLFLN4vj7viF46Fgj6QgwK9dkshWYABwLb1JG-Oq4ug@mail.gmail.com>
	<CAG4NReKWW=ptKztB+txMye_0ym7_tUi+TeZqAOTMY7tdxhH9+A@mail.gmail.com>
	<alpine.LRH.2.02.1212231529180.26107@reclus.nhh.no>
	<CAG4NReLiSLK9W0VA6hq5B6AT5+uOL=Bo0Ak1cntjwdQ5xHwh4A@mail.gmail.com>
	<da346ab4f5bd4563918623ef0b210404@EX-1-HT0.lancs.local>
	<bd3d6d241f90457a891f72e124a33ff8@EX-0-HT0.lancs.local>
	<605df35965554cd39d3a44c635458589@EX-0-HT0.lancs.local>
Message-ID: <CANVKczOONGzE+bXOmorftsGc-LpC=RfTYhxX-6npmkLkNerXqA@mail.gmail.com>

How to create colour-paletted rasters using R and Python:

http://www.rpubs.com/geospacedman/rasterColourPalettes

It would be great to be able to do this solely from R using either
raster or rgdal, and to have the couple of bugs with paletted rasters
in package:raster mentioned in the Rpubs doc fixed. I shall try and
raise this with Robert H when everyone comes out of hibernation in
January.

On Sun, Dec 23, 2012 at 9:51 PM, Rowlingson, Barry
<b.rowlingson at lancaster.ac.uk> wrote:
> Here's a solution:
>
> makePalette <- function(colourvector){
>   cmat = cbind(t(col2rgb(colourvector)),255)
>   res = apply(cmat,1,function(x){sprintf('<Entry c1="%s" c2="%s"
> c3="%s" c4="%s"/>',x[1],x[2],x[3],x[4])})
>   res = paste(res,collapse="\n")
>   res
> }
>
>
> Then:
>
>  write a raster tiff
>
>  writeRaster(iom,"test.tif",overwrite=TRUE,datatype="INT1U")
>
>
> Then use makePalette to create the colortable lines:
>
> cat(makePalette(iom at legend@colortable)) # replace
> iom at legend@colortable with your colour table vector
>
> That spits out a bunch of <Entry> lines. Stick them in your .vrt file thus:
>
> <VRTDataset rasterXSize="413" rasterYSize="397">
>   <VRTRasterBand dataType="Byte" band="1">
>     <ColorInterp>Palette</ColorInterp>
> <SimpleSource>
> <SourceFilename relativeToVRT="1">test.tif</SourceFilename>
> </SimpleSource>
>     <ColorTable>
> <Entry c1="0" c2="0" c3="0" c4="255"/>
> <Entry c1="230" c2="0" c3="77" c4="255"/>
> <Entry c1="255" c2="0" c3="0" c4="255"/>
> <Entry c1="204" c2="77" c3="242" c4="255"/>
> <Entry c1="204" c2="0" c3="0" c4="255"/>
> [etc]
>    </ColorTable>
>   </VRTRasterBand>
> </VRTDataset>
>
> Note you have to fill in the rasterXSize and rasterYSize, and the
> source filename. Also you'll need to get the geotransform of the
> original and stick that in otherwise your raster is geolocated at
> (1:Nrows, 1:Ncolumns).
>
> If I do all that, I get a raster created by R that I can read into
> QGis and is coloured according to my colour scheme, as long as I open
> *test.vrt* in QGis and *not* test.tif.
>
> I'm sorry this isn't (yet) a one-shot solution, and its a bit of a
> construction set. Like I said, two minute job, twenty minute job to do
> properly... I've spent ten minutes on it :)
>
> Barry
>
>
>
>
> On Sun, Dec 23, 2012 at 9:25 PM, Rowlingson, Barry
> <b.rowlingson at lancaster.ac.uk> wrote:
>> On Sun, Dec 23, 2012 at 8:23 PM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
>>
>>> There is no support in raster or sp objects for symbology, and unless
>>> someone extends the classes to accommodate symbology on a dynamic
>>> by-attribute basis, it isn't going to happen.
>>>
>>
>>  I'm not sure that's true - I can read in a raster from a geoTIFF and
>> get a colour table from it, then plot will show it with the right
>> colours - here's a Land Use tiff:
>>
>>> lu
>> class       : RasterLayer
>> dimensions  : 397, 413, 163961  (nrow, ncol, ncell)
>> resolution  : 100, 100  (x, y)
>> extent      : 3356200, 3397500, 3533200, 3572900  (xmin, xmax, ymin, ymax)
>> coord. ref. : +proj=laea +lat_0=52 +lon_0=10 +x_0=4321000 +y_0=3210000
>> +ellps=GRS80 +units=m +no_defs
>> data source : /data/rowlings/MapLibrary/Europe/UK/IsleOfMan/iomcorine.tiff
>> names       : iomcorine
>> values      : 0, 255  (min, max)
>>
>>> lu at legend@colortable[1:10]
>>  [1] "#000000" "#E6004D" "#FF0000" "#CC4DF2" "#CC0000" "#E6CCCC" "#E6CCE6"
>>  [8] "#A600CC" "#A64D00" "#FF4DFF"
>>
>>
>>  Support for this is minimal in package:raster, and I think what Agus
>> is trying to do (correct me if wrong) is create a raster with a colour
>> table such as this from R. If I just use writeRaster I get a numeric
>> raster with no palette.
>>
>> I think Robert has talked about better support for paletted rasters in the past.
>>
>> Barry
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From ppanday at clarku.edu  Fri Dec 28 01:06:06 2012
From: ppanday at clarku.edu (ppanday)
Date: Thu, 27 Dec 2012 16:06:06 -0800 (PST)
Subject: [R-sig-Geo] raster extraction
Message-ID: <1356653166159-7582124.post@n2.nabble.com>

Hello all

I have a raster bricklayer with 30 layers. Is there a way to extract
area-average using a raster mask? Or if I have the same layer already
masked, how would I compute area-average for the bricklayer?

My other questions is if I have a raster bricklayer with 360 layers
(months), how would I compute monthly average such that the output has 12
layers. 

Thanks,
Prajjwal



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/raster-extraction-tp7582124.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From beiyang_2005 at sina.com  Fri Dec 28 04:33:15 2012
From: beiyang_2005 at sina.com (beiyang_2005 at sina.com)
Date: Fri, 28 Dec 2012 11:33:15 +0800 
Subject: [R-sig-Geo] how to use my data
Message-ID: <20121228033315.9F48F730002@webmail.sinamail.sina.com.cn>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121228/1e8117c5/attachment.pl>

From roosbeh.nowrouzian at gmail.com  Fri Dec 28 04:46:24 2012
From: roosbeh.nowrouzian at gmail.com (Roosbeh Nowrouzian)
Date: Thu, 27 Dec 2012 22:46:24 -0500
Subject: [R-sig-Geo] Is GWR in ggwr function with poisson distribiution the
 same as Geographically Weighted Poisson Regression (GWPR) disused by Nakaya
 2005
Message-ID: <CAJw-hPY1_g9SDV5DevPeb6FO7UUSfN__HwynOhHWaTo_coVLgQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121227/4165a265/attachment.pl>

From roman.lustrik at gmail.com  Fri Dec 28 10:18:19 2012
From: roman.lustrik at gmail.com (=?UTF-8?Q?Roman_Lu=C5=A1trik?=)
Date: Fri, 28 Dec 2012 10:18:19 +0100
Subject: [R-sig-Geo] raster extraction
In-Reply-To: <1356653166159-7582124.post@n2.nabble.com>
References: <1356653166159-7582124.post@n2.nabble.com>
Message-ID: <CAHT1vpjJpqmAdJ0m+o5c99cO=6DGWiz72QxKMzvSJY33H6qh1g@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121228/65aba843/attachment.pl>

From Roger.Bivand at nhh.no  Fri Dec 28 11:46:37 2012
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 28 Dec 2012 11:46:37 +0100
Subject: [R-sig-Geo] Is GWR in ggwr function with poisson distribiution
 the same as Geographically Weighted Poisson Regression (GWPR) disused by
 Nakaya 2005
In-Reply-To: <CAJw-hPY1_g9SDV5DevPeb6FO7UUSfN__HwynOhHWaTo_coVLgQ@mail.gmail.com>
References: <CAJw-hPY1_g9SDV5DevPeb6FO7UUSfN__HwynOhHWaTo_coVLgQ@mail.gmail.com>
Message-ID: <alpine.LRH.2.02.1212281140130.11137@reclus.nhh.no>

On Fri, 28 Dec 2012, Roosbeh Nowrouzian wrote:

> Dear list members:
>
> I am wondering if Geographically weighted Regression(GWR) applied in
> Generalized Linear Models(GLM) framework with defined family="poisson" in
> ggwr.sel and ggwr functions is the same as Geographically Weighted Poisson
> Regression (GWPR) disused by Nakaya et al. 2005 for disease association
> mapping.

Since GWR3 and GWR4 are closed-source implementations, nobody knows 
whether they implement Nakaya et al. 2005 either. If you read the code of 
ggwr(), you'll see that it uses GW on glm() in a way that is probably not 
dissimilar to that proposed. But you'd need to check carefully on a test 
data set to see whether the local coefficients agree - probably glm() is a 
more robust GLM than that in GWR, certainly the OLS in GWR used to be 
based on very old matrix inversion code, something nobody serious does 
nowadays, because it is not numerically stable. You should also be 
concerned about overdispersion.

Try rather GLMM or GAMM unless you have an unmeasurable non-stationarity - 
if it is measurable, re-specify the model to include it and forget GWR.

Roger

>
> Thanks
>
> Roosbeh Nowrouzian
> PhD Student
> University of Florida
> Department of Civil and Coastal Engineering
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From lucianolasala at yahoo.com.ar  Fri Dec 28 14:39:31 2012
From: lucianolasala at yahoo.com.ar (Luciano La Sala)
Date: Fri, 28 Dec 2012 10:39:31 -0300
Subject: [R-sig-Geo] Raster processing, pop density estimation and more
In-Reply-To: <mailman.7.1356692402.11930.r-sig-geo@r-project.org>
References: <mailman.7.1356692402.11930.r-sig-geo@r-project.org>
Message-ID: <002701cde500$c57767b0$50663710$@com.ar>

Dear r-sig-geo people,


I have a raster image of human population counts; a LandScan grid at a
resolution of 1 km where each pixel's value represents population number,
which I am processing using Quantum GIS and GRASS the modules inside of it.


Using R, I need to: 

1) Take each cell of the raster one by one and retrieve the population count
for that cell.

2) Work out the number of households per cell: for this, I should take a
random draw from a Poisson distribution assuming that there is a mean of 4
people per household. Keep a running total individuals allocated to
households so that when we reach the total population size for the given
cell the process stops. The total number of Poisson draws taken for a cell
will equal the number of households.

3) Finally, I am interested in the number of households in a cell that keep
poultry. I should take a random draw from a binomial distribution. For this
the number of trials would be the total number of households and the
probability of keeping poultry would depend on human population density. If
population density is high (i.e. the household is in a city) the probability
of keeping poultry is zero. 

I colleague who did a very similar work (only that he worked with ArcView)
wrote the following code below to get the job done:  

----------------------------------------------------------------------------
---------------------------------------------------

# Estimating the number of poultry-positive parcels per grid cell

# Create a grid theme of population density - based on the grid themes
specifying population counts and area.
# Export population count and population density files from ArcView to *.asc
files.

pop.file <- "vc_pop.asc"
den.file <- "vc_den.asc"
out.file <- "vc_byp.asc"

out.xllcorner <- -74.010559082031
out.yllcorner <- -33.743896484375
out.cellsize <- 0.008333333333333
out.na <- -9999

dat.pop <- as.matrix(read.table(file = pop.file, sep = " ", na.strings =
"-9999", skip = 6)) dat.den <- as.matrix(read.table(file = den.file, sep = "
", na.strings = "-9999", skip = 6))

# Set up a matrix to collect results:
dat.byp <- dat.pop
dat.byp[,][dat.byp[,] >= 0] <- 0

# 2. Loop through each grid cell of population file and work out the
estimated number of establishments in each:
nrows <- dim(dat.den)[1]
ncols <- dim(dat.den)[2]

for(i in 1:nrows){
  for(j in 1:ncols){
    total <- 0

    # Only proceed if data is present:
    if(!is.na(dat.pop[i,j]) & !is.na(dat.den[i,j]) ){

      # What is the population size and density for this cell?
      tmp.pop <- dat.pop[i,j]
      tmp.den <- dat.den[i,j]

      # What is the population density category for this cell?
      id.den <- 0
      if(tmp.den < 1.50) id.den <- 1
      if(tmp.den >= 1.50 & tmp.den < 4.20) id.den <- 2
      if(tmp.den >= 4.20 & tmp.den < 6.00) id.den <- 3
      if(tmp.den >= 6.00 & tmp.den < 10.00) id.den <- 4
      if(tmp.den >= 10.00) id.den <- 5

      while(sum(total) < tmp.pop) {
       n <- rpois(n = 1, lambda = 4)
       # Vector of the number of individuals in each establishment:
       total <- c(total, n)
       }

      # Number of establishments in this cell:
      n.estab <- length(total) - 1

      # Estimated number of establishments that keep poultry (set to vary
according to human population density):
      if(id.den == 1){dat.byp[i,j] <- rbinom(n = 1, size = n.estab, prob =
0.90)}
      if(id.den == 2){dat.byp[i,j] <- rbinom(n = 1, size = n.estab, prob =
0.50)}
      if(id.den == 3){dat.byp[i,j] <- rbinom(n = 1, size = n.estab, prob =
0.20)}
      if(id.den == 4){dat.byp[i,j] <- rbinom(n = 1, size = n.estab, prob =
0.10)}
      if(id.den == 5){dat.byp[i,j] <- 0}

      # if(id.den == 1){dat.byp[i,j] <- qbinom(0.50, size = n.estab, prob =
0.90)}
      # if(id.den == 2){dat.byp[i,j] <- qbinom(0.50, size = n.estab, prob =
0.50)}
      # if(id.den == 3){dat.byp[i,j] <- qbinom(0.50, size = n.estab, prob =
0.05)}
      # if(id.den == 4){dat.byp[i,j] <- 0}
    }
   }
  }

rval.byp <- dat.byp

----------------------------------------------------------------------------
---------------------------------------------------

I am using Quantum GIS/GRASS and since my original raster (Landscan grid) is
at resolution 1 km, then the population count and density (per sq km) should
be the same. Using the GRASS module r.out.xyz I got an ASCII text file with
three columns: X, Y, value. The X-Y are cell enters, and value would
represent Population count.
 
That being said, I guess that my pop density grid would be the LandScan grid
as it is (people/sq km). If this is correct, then I see no point in
following the steps below (as described above)?   

# Create a grid theme of population density - based on the grid themes
specifying population counts and area.
# Export population count and population density files from ArcView to *.asc
files.

Any help with this will be greatly appreciated! 

Luciano La Sala


From HodgessE at uhd.edu  Sat Dec 29 00:30:47 2012
From: HodgessE at uhd.edu (Hodgess, Erin)
Date: Fri, 28 Dec 2012 23:30:47 +0000
Subject: [R-sig-Geo] calculating a variogram/semi-variogram
Message-ID: <FF9DB805FC41CC4E95825A50F6806302128FBB58@challenger.uhd.campus>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121228/1738899b/attachment.pl>

From roman.lustrik at gmail.com  Sat Dec 29 00:56:10 2012
From: roman.lustrik at gmail.com (=?UTF-8?Q?Roman_Lu=C5=A1trik?=)
Date: Sat, 29 Dec 2012 00:56:10 +0100
Subject: [R-sig-Geo] calculating a variogram/semi-variogram
In-Reply-To: <FF9DB805FC41CC4E95825A50F6806302128FBB58@challenger.uhd.campus>
References: <FF9DB805FC41CC4E95825A50F6806302128FBB58@challenger.uhd.campus>
Message-ID: <CAHT1vpibag9OGm0THu72bgQLQwA4fFoO7w+PfQdUt-Uqfb8A3A@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121229/5fa839d7/attachment.pl>

From HodgessE at uhd.edu  Sat Dec 29 01:09:48 2012
From: HodgessE at uhd.edu (Hodgess, Erin)
Date: Sat, 29 Dec 2012 00:09:48 +0000
Subject: [R-sig-Geo] calculating a variogram/semi-variogram
In-Reply-To: <CAHT1vpibag9OGm0THu72bgQLQwA4fFoO7w+PfQdUt-Uqfb8A3A@mail.gmail.com>
References: <FF9DB805FC41CC4E95825A50F6806302128FBB58@challenger.uhd.campus>,
	<CAHT1vpibag9OGm0THu72bgQLQwA4fFoO7w+PfQdUt-Uqfb8A3A@mail.gmail.com>
Message-ID: <FF9DB805FC41CC4E95825A50F6806302128FBC11@challenger.uhd.campus>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121229/aa01ba8b/attachment.pl>

From HodgessE at uhd.edu  Sat Dec 29 07:29:27 2012
From: HodgessE at uhd.edu (Hodgess, Erin)
Date: Sat, 29 Dec 2012 06:29:27 +0000
Subject: [R-sig-Geo] using rasterize
Message-ID: <FF9DB805FC41CC4E95825A50F6806302128FBCC6@challenger.uhd.campus>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121229/274a2b22/attachment.pl>

From HodgessE at uhd.edu  Sat Dec 29 07:58:23 2012
From: HodgessE at uhd.edu (Hodgess, Erin)
Date: Sat, 29 Dec 2012 06:58:23 +0000
Subject: [R-sig-Geo] using rasterize SOLVED
Message-ID: <FF9DB805FC41CC4E95825A50F6806302128FBD3B@challenger.uhd.campus>

Sorry to cause trouble...I figured it out
________________________________________
From: r-sig-geo-bounces at r-project.org [r-sig-geo-bounces at r-project.org] on behalf of Hodgess, Erin
Sent: Saturday, December 29, 2012 12:29 AM
To: r-sig-geo at r-project.org
Subject: [R-sig-Geo] using rasterize

Hello again:

I'm trying to rasterize a spatial points data frame and I seem to be missing something, as seen below:



> str(loc3)
Formal class 'SpatialPointsDataFrame' [package "sp"] with 5 slots
  ..@ data       :'data.frame':    477 obs. of  6 variables:
  .. ..$ ID      : num [1:477] 1 2 3 5 6 8 9 10 10 13 ...
  .. ..$ lonmin  : num [1:477] 141 112.9 -85.9 -106.6 -91.2 ...
  .. ..$ lonmax  : num [1:477] 153.6 159.1 -85.4 -93.5 -91 ...
  .. ..$ latmin  : num [1:477] -37.5 -54.8 38 25.8 30.4 ...
  .. ..$ latmax  : num [1:477] -28.16 -9.22 38.38 36.5 30.56 ...
  .. ..$ location: Factor w/ 275 levels "NSW","Australia",..: 1 2 3 5 6 8 9 10 10 13 ...
  ..@ coords.nrs : int [1:2] 3 2
  ..@ coords     : num [1:477, 1:2] -31.3 -25.3 38.3 32 30.5 ...
  .. ..- attr(*, "dimnames")=List of 2
  .. .. ..$ : NULL
  .. .. ..$ : chr [1:2] "lat" "lon"
  ..@ bbox       : num [1:2, 1:2] -37.8 -159.6 62.3 175.3
  .. ..- attr(*, "dimnames")=List of 2
  .. .. ..$ : chr [1:2] "lat" "lon"
  .. .. ..$ : chr [1:2] "min" "max"
  ..@ proj4string:Formal class 'CRS' [package "sp"] with 1 slots
  .. .. ..@ projargs: chr NA
> rasterize(loc3,field=location,fun=count,na.rm=TRUE)
Error in function (classes, fdef, mtable)  :
  unable to find an inherited method for function ?rasterize? for signature ?"SpatialPointsDataFrame", "missing"?
>

Do you have any ideas, please?  Could it be that the proj4string is NA, do you think, please?

Thanks,
Erin



        [[alternative HTML version deleted]]



From milansharma2012 at yahoo.com  Sat Dec 29 19:43:31 2012
From: milansharma2012 at yahoo.com (Milan Sharma)
Date: Sat, 29 Dec 2012 10:43:31 -0800 (PST)
Subject: [R-sig-Geo] fitting lag model in R
Message-ID: <1356806611.21515.YahooMailNeo@web162103.mail.bf1.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121229/11ff5e86/attachment.pl>

From HodgessE at uhd.edu  Sun Dec 30 00:02:12 2012
From: HodgessE at uhd.edu (Hodgess, Erin)
Date: Sat, 29 Dec 2012 23:02:12 +0000
Subject: [R-sig-Geo] back to variogram
Message-ID: <FF9DB805FC41CC4E95825A50F6806302128FBF9A@challenger.uhd.campus>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121229/73ed0974/attachment.pl>

From Tom_Roche at pobox.com  Sun Dec 30 06:40:55 2012
From: Tom_Roche at pobox.com (Tom Roche)
Date: Sun, 30 Dec 2012 00:40:55 -0500
Subject: [R-sig-Geo] function to convert 3D geographical coordinates to
	Cartesian?
Message-ID: <871ue8jdw8.fsf@pobox.com>


Is there packaged code to convert geographical coordinates (e.g.,
longitude, latitude, elevation) to Cartesian coordinates in 3-space?
The spherical-to-Cartesian math is straightforward enough, but there's
certainly scope for error, so I'd prefer to use tested, previously-used
code if available.

TIA, Tom Roche <Tom_Roche at pobox.com>


From edzer.pebesma at uni-muenster.de  Sun Dec 30 11:09:59 2012
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Sun, 30 Dec 2012 11:09:59 +0100
Subject: [R-sig-Geo] back to variogram
In-Reply-To: <FF9DB805FC41CC4E95825A50F6806302128FBF9A@challenger.uhd.campus>
References: <FF9DB805FC41CC4E95825A50F6806302128FBF9A@challenger.uhd.campus>
Message-ID: <50E012F7.4070003@uni-muenster.de>



On 12/30/2012 12:02 AM, Hodgess, Erin wrote:
> Hello yet again:
> 
> I have a little data set that I want to get a variogram for.  However, I keep getting an error.
> 
>> str(z1.df)
> Formal class 'SpatialPointsDataFrame' [package "sp"] with 5 slots
>   ..@ data       :'data.frame':    5 obs. of  1 variable:
>   .. ..$ x: num [1:5] 1.4228 0.0275 -0.3738 0.2812 0.2328
>   ..@ coords.nrs : int [1:2] 2 3
>   ..@ coords     : num [1:5, 1:2] 146.9 133.8 -85.8 -99.9 -91.1 ...
>   .. ..- attr(*, "dimnames")=List of 2
>   .. .. ..$ : NULL
>   .. .. ..$ : chr [1:2] "lon" "lat"
>   ..@ bbox       : num [1:2, 1:2] -99.9 -31.3 146.9 38.3
>   .. ..- attr(*, "dimnames")=List of 2
>   .. .. ..$ : chr [1:2] "lon" "lat"
>   .. .. ..$ : chr [1:2] "min" "max"
>   ..@ proj4string:Formal class 'CRS' [package "sp"] with 1 slots
>   .. .. ..@ projargs: chr NA
>> variogram(z1.df)
> Error in variogram.default(z1.df) :
>   argument object and locations should be lists
>>
> 
> Does this make any sense, please?

No. You can find this out by reading ?variogram and vignette("gstat") --
please report back if anything is not clear when working from there.

> 
> Thanks,
> Erin
> 
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From edzer.pebesma at uni-muenster.de  Sun Dec 30 11:11:19 2012
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Sun, 30 Dec 2012 11:11:19 +0100
Subject: [R-sig-Geo] function to convert 3D geographical coordinates to
 Cartesian?
In-Reply-To: <871ue8jdw8.fsf@pobox.com>
References: <871ue8jdw8.fsf@pobox.com>
Message-ID: <50E01347.6090405@uni-muenster.de>

Tom, I guess you are aware of rgdal::spTransform?

On 12/30/2012 06:40 AM, Tom Roche wrote:
> 
> Is there packaged code to convert geographical coordinates (e.g.,
> longitude, latitude, elevation) to Cartesian coordinates in 3-space?
> The spherical-to-Cartesian math is straightforward enough, but there's
> certainly scope for error, so I'd prefer to use tested, previously-used
> code if available.
> 
> TIA, Tom Roche <Tom_Roche at pobox.com>
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From Tom_Roche at pobox.com  Sun Dec 30 14:37:49 2012
From: Tom_Roche at pobox.com (Tom Roche)
Date: Sun, 30 Dec 2012 08:37:49 -0500
Subject: [R-sig-Geo] function to convert 3D geographical coordinates to
 Cartesian?
In-Reply-To: <50E01347.6090405@uni-muenster.de>
References: <50E01347.6090405@uni-muenster.de> <871ue8jdw8.fsf@pobox.com>
Message-ID: <87y5gfirte.fsf@pobox.com>


Tom Roche Sun, 30 Dec 2012 00:40:55 -0500
>> Is there packaged code to convert geographical coordinates (e.g.,
>> longitude, latitude, elevation) to [simple] Cartesian coordinates
>> in 3-space?

Edzer Pebesma Sun, 30 Dec 2012 11:11:19 +0100
> rgdal::spTransform?

I'm aware of that, but don't how to apply it to this case. I believe I
see how to create/specify the proj4string for the input: for input
coordinates of the form (longitude, latitude, elevation) one would use
CRS("+proj=longlat +ellps=WGS84") or similar. (Am I missing something?)

But I don't know how to specify the proj4string in order to get purely
Cartesian output, e.g., to get output coordinates like (x,y,z) relative
to (e.g.) the center of the ellipsoid. And my reading of the best PROJ
documentation of which I'm aware,

ftp://ftp.remotesensing.org/proj/OF90-284.pdf

, has not helped. Unless ... 

Is it the case that spTransform outputs Cartesian coordinates?
If so, relative to what origin?

TIA, Tom Roche <Tom_Roche at pobox.com>


From suzana.stutz at gmail.com  Sun Dec 30 14:55:52 2012
From: suzana.stutz at gmail.com (Suzana Stutz)
Date: Sun, 30 Dec 2012 11:55:52 -0200
Subject: [R-sig-Geo]  Doubts about GLM
Message-ID: <CABWNPhq45WemB+BR+hjt5bogzm2PQc724bpM-0u488x22_f+Sg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121230/d69def9e/attachment.pl>

From juantomas.sayago at gmail.com  Sun Dec 30 15:02:24 2012
From: juantomas.sayago at gmail.com (Juan Tomas Sayago Gomez)
Date: Sun, 30 Dec 2012 09:02:24 -0500
Subject: [R-sig-Geo] fitting lag model in R
In-Reply-To: <1356806611.21515.YahooMailNeo@web162103.mail.bf1.yahoo.com>
References: <1356806611.21515.YahooMailNeo@web162103.mail.bf1.yahoo.com>
Message-ID: <CAEOXpND-X6ePLMLDfHVSfqLjYg0b6ERzXcd0WFN8VmU2X9RZqA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121230/3cac3b0d/attachment.pl>

From Tom_Roche at pobox.com  Mon Dec 31 06:48:49 2012
From: Tom_Roche at pobox.com (Tom Roche)
Date: Mon, 31 Dec 2012 00:48:49 -0500
Subject: [R-sig-Geo] function to convert 3D geographical coordinates to
 Cartesian?
In-Reply-To: <87y5gfirte.fsf@pobox.com> 
References: <87y5gfirte.fsf@pobox.com> <50E01347.6090405@uni-muenster.de>
	<871ue8jdw8.fsf@pobox.com>
Message-ID: <87han2ixfi.fsf@pobox.com>


https://stat.ethz.ch/pipermail/r-sig-geo/2012-December/017102.html
> Is there packaged code to convert geographical coordinates (e.g.,
> longitude, latitude, elevation) to [simple] Cartesian coordinates
> in 3-space?

Just to clarify: I'm looking for code like that which follows my .sig
(to end of post), but which

* is much better tested/known/used (I just hacked the following this
  evening)

* _properly_ converts elevation to radial distance (from earth center),
  i.e., using a user-specified CRS. My function elev2rdist below is a
  blatant kludge, though it should work for the model for which I'm
  assimilating data.

This is such low-level functionality that I can't believe it's not API
somewhere, but I have looked at several packages and am not seeing it.
Is it so low-level that it's just not exposed as API? or am I just not
seeing it in package docs? or did I fail a spatial-intelligence test?

TIA, Tom Roche <Tom_Roche at pobox.com>----sample code follows to EOP----

# Convert geographic coordinates (lon, lat, elevation) to
# Cartesian coordinates (x, y, z) relative to earth center.
geo2cart <- function(lon.lat.elev) {
  library(pracma) # for sph2cart
  stopifnot(is.numeric(lon.lat.elev))
  return(sph2cart(geo2sph(lat.lon.elev)))
} # end function geo2cart(lon.lat.elev)

# Convert geographic coordinates (lon, lat, elevation) to
# spherical coordinates (azimuth/?, polar angle/?, radial distance/r),
# relative to earth center
geo2sph <- function(lon.lat.elev) {
  stopifnot(is.numeric(lon.lat.elev))

  # Use convention of package=pracma: see http://cran.r-project.org/web/packages/pracma/
  # same as described @ http://en.wikipedia.org/wiki/File:3D_Spherical_2.svg
  # convert
  # * longitude -> azimuth (?)
  # * latitude -> polar angle (?)
  # * elevation -> radial distance from earth center (r)
  if (is.vector(lon.lat.elev) && length(lon.lat.elev) == 3) {
    theta <- lon2azi(lon.lat.elev[1])
    phi <- lat2pol(lon.lat.elev[2])
    r <- elev2rdist(lon.lat.elev[3])
    m <- 1
  } else if (is.matrix(lon.lat.elev) && ncol(lon.lat.elev) == 3) {
    theta <- lon2azi(lon.lat.elev[,1])
    phi <- lat2pol(lon.lat.elev[,2])
    r <- elev2rdist(lon.lat.elev[,3])
    m <- nrow(lon.lat.elev)
  } else {
    stop('geo2sph: ERROR: input must be a vector of length 3 or a matrix with 3 columns.')
  }

  if (m == 1) {
    tpr <- c(theta, phi, r)
  } else {
    tpr <- cbind(theta, phi, r)
  }
  return(tpr)
} # end function geo2sph(lon.lat.elev)

# Filter and convert longitudes to radians.
# Much-too-simple tests:
# > lon2azi(c(seq(0, 180), seq(-179, -1)))/pi
# > lon2azi(c(0:359))
lon2azi <- function(lon) {
  library(pracma) # for deg2rad

  stopifnot(is.numeric(lon))
  # only handle vectors
  if (!is.vector(lon)) {
    lon.vec <- c(lon) 
  } else {
    lon.vec <- lon
  }

  # only take -180 <= lon.vec <= 180
  # TODO: better error messages
  stopifnot(length(lon.vec[lon.vec < -180]) == 0)
  stopifnot(length(lon.vec[lon.vec > 180]) == 0)

  # Convert to azimuth=? in radians.
  # Convert to 0 <= lon.vec <= 360 (hmm ...) e.g., -179 -> 181.
  lon.vec[lon.vec < 0] <- 360.0 + lon.vec[lon.vec < 0]
  theta.vec <- deg2rad(lon.vec)

  if (!is.vector(lon)) {
    return(theta.vec[1])
  } else {
    return(theta.vec)
  }
} # end function lon2azi(lon)

# Filter and convert latitudes to radians.
# Much-too-simple tests:
# > lat2pol(c(seq(90, 0), seq(-1, -90)))/pi
# > lat2pol(c(-100:100))
lat2pol <- function(lat) {
  library(pracma) # for deg2rad

  stopifnot(is.numeric(lat))
  # only handle vectors
  if (!is.vector(lat)) {
    lat.vec <- c(lat) 
  } else {
    lat.vec <- lat
  }

  # only take -90 <= lat.vec <= 90
  # TODO: better error messages
  stopifnot(length(lat.vec[lat.vec < -90]) == 0)
  stopifnot(length(lat.vec[lat.vec > 90]) == 0)

  # Convert to polar angle=? in radians.
  # northern hemisphere + equator:
#  lat.vec[lat.vec >= 0] <- 90.0 - lat.vec[lat.vec >= 0]
  # southern hemisphere:
#  lat.vec[lat.vec < 0] <- 90.0 - lat.vec[lat.vec < 0]
  phi.vec <- deg2rad(90.0 - lat.vec)

  if (!is.vector(lat)) {
    return(phi.vec[1])
  } else {
    return(phi.vec)
  }
} # end function lat2pol(lat)

# Convert elevation to radial distance
# Much-too-simple tests:
# > elev2rdist(c(seq(1000, by=1000, length=10)))
# > elev2rdist(c(seq(-1000, by=1000, length=10)))
elev2rdist <- function(elev) {
  r.earth.meters <- 6370000.0 # constant, kludge, see below

  stopifnot(is.numeric(elev))
  # only handle vectors
  if (!is.vector(elev)) {
    elev.vec <- c(elev) 
  } else {
    elev.vec <- elev
  }

  # Only take non-negative elevations.
  stopifnot(length(elev.vec[elev.vec < 0]) == 0)

  # Convert elevation to radial distance (from earth center).
  # TODO: use coordinate reference system.
  # Kludge: spherical earth with radius defined above.
  r.vec <- r.earth.meters + elev

  if (!is.vector(elev)) {
    return(r.vec[1])
  } else {
    return(r.vec)
  }
} # end function elev2rdist(elev)


From Roger.Bivand at nhh.no  Mon Dec 31 12:49:25 2012
From: Roger.Bivand at nhh.no (Roger Simon Bivand)
Date: Mon, 31 Dec 2012 11:49:25 +0000
Subject: [R-sig-Geo] fitting lag model in R
In-Reply-To: <1356806611.21515.YahooMailNeo@web162103.mail.bf1.yahoo.com>
References: <1356806611.21515.YahooMailNeo@web162103.mail.bf1.yahoo.com>
Message-ID: <E953A98FD6EAA7479A68EE8C24491F6B6C0A4B9D@COLON.valuta.nhh.no>

Please read ?lagsarlm under the tol.solve= item:

the tolerance for detecting linear dependencies in the columns of matrices to be inverted - passed to \code{solve()} (default=1.0e-10). This may be used if necessary to extract coefficient standard errors (for instance lowering to 1e-12), but errors in \code{solve()} may constitute indications of poorly scaled variables: if the variables have scales differing much from the autoregressive coefficient, the values in this matrix may be very different in scale, and inverting such a matrix is analytically possible by definition, but numerically unstable; rescaling the RHS variables alleviates this better than setting tol.solve to a very small value

Does that help?

--
Roger Bivand
NHH Norwegian School of Economics
Helleveien 30, 5045 Bergen, Norway
Roger.Bivand at nhh.no


________________________________________
Fra: r-sig-geo-bounces at r-project.org [r-sig-geo-bounces at r-project.org] p&#229; vegne av Milan Sharma [milansharma2012 at yahoo.com]
Sendt: 29. desember 2012 7:43
To: r-sig-geo at r-project.org
Emne: [R-sig-Geo] fitting lag model in R

Hi all,
can any one of you see whats wrong in the code below?
>  model<-lm(Tcrash~X100MVMT+Alcohol+Alignment+PVMT, data=data)#works
> sar<-spautolm(Tcrash~X100MVMT+Alcohol+Alignment+PVMT,listw=WI_queenW, data=data)#works
> lag <- lagsarlm(Tcrash~X100MVMT+Alcohol+Alignment+PVMT, data=data, listw=listwW)#shows error
Error in solve.default(inf, tol = tol.solve) :
  system is computationally singular: reciprocal condition number = 2.44638e-12
> lag <- lagsarlm(Tcrash~X100MVMT+Alcohol+Alignment+PVMT, data=data, listw=WI_queenW)
Error in solve.default(inf, tol = tol.solve) :
  system is computationally singular: reciprocal condition number = 1.51647e-13
> WI_queenW
Characteristics of weights list object:
Neighbour list object:
Number of regions: 71
Number of nonzero links: 364
Percentage nonzero weights: 7.22079
Average number of links: 5.126761

Weights style: B
Weights constants summary:
   n   nn  S0  S1   S2
B 71 5041 364 728 8160
.............................
 Milan
        [[alternative HTML version deleted]]



From lubinbin220 at gmail.com  Mon Dec 31 15:37:29 2012
From: lubinbin220 at gmail.com (binbin lu)
Date: Mon, 31 Dec 2012 14:37:29 +0000
Subject: [R-sig-Geo] Formula of function "lchoose"
Message-ID: <CANuoaEEuXTv1B5=fotUaRJXboM3pby_u7b77+kf56x-CLCC6vw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121231/5accdee9/attachment.pl>

From lucianolasala at yahoo.com.ar  Mon Dec 31 15:41:47 2012
From: lucianolasala at yahoo.com.ar (Luciano La Sala)
Date: Mon, 31 Dec 2012 11:41:47 -0300
Subject: [R-sig-Geo] Problem opening ASCII file
Message-ID: <002601cde764$f77b6f20$e6724d60$@com.ar>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20121231/a3a159fd/attachment.pl>

From mdsumner at gmail.com  Mon Dec 31 23:51:14 2012
From: mdsumner at gmail.com (Michael Sumner)
Date: Tue, 1 Jan 2013 09:51:14 +1100
Subject: [R-sig-Geo] Problem opening ASCII file
In-Reply-To: <002601cde764$f77b6f20$e6724d60$@com.ar>
References: <002601cde764$f77b6f20$e6724d60$@com.ar>
Message-ID: <CAAcGz9--i+gmjXxPaGWH9mFf6iKrgBQcpJzcr=ro7aozN3Z=6g@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20130101/94004bb9/attachment.pl>

