From B.Rowlingson at lancaster.ac.uk  Tue Oct  5 17:33:38 2004
From: B.Rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Tue, 05 Oct 2004 16:33:38 +0100
Subject: [R-sig-Geo] Geos library 
Message-ID: <4162BED2.2010802@lancaster.ac.uk>

Has anyone considered an R interface to the geos library:

http://geos.refractions.net/

GEOS (Geometry Engine - Open Source) is a C++ port of the Java Topology
Suite (JTS). As such, it aims to contain the complete functionality of 
JTS in C++. This includes all the OpenGIS "Simple Features for SQL" 
spatial predicate functions and spatial operators, as well as specific 
JTS topology functions such as IsValid().


  - now if we can link R spatial classes to this, we can build a 
complete set of spatial predicate functions and spatial operators in R....

Barry



From tkeitt at mail.utexas.edu  Tue Oct  5 18:18:13 2004
From: tkeitt at mail.utexas.edu (Timothy H. Keitt)
Date: Tue, 05 Oct 2004 11:18:13 -0500
Subject: [R-sig-Geo] Geos library
In-Reply-To: <4162BED2.2010802@lancaster.ac.uk>
References: <4162BED2.2010802@lancaster.ac.uk>
Message-ID: <1096993093.20837.20.camel@workstation-3>

Its a good thought. Not sure the best way to proceed. The OGR part of
GDAL now uses GEOS for spatial predicates, so wrapping OGR (which I
think is done?) would indirectly give you GEOS functions. The other
route is to give entry points to the geotools java libs. There seems to
be a lot of momentum behind geotools (used in JUMP and uDIG clients). Or
as you say, one could use R storage and wrap GEOS algorithms to work
directly on R data.

Tim

On Tue, 2004-10-05 at 10:33, Barry Rowlingson wrote:
> Has anyone considered an R interface to the geos library:
> 
> http://geos.refractions.net/
> 
> GEOS (Geometry Engine - Open Source) is a C++ port of the Java Topology
> Suite (JTS). As such, it aims to contain the complete functionality of 
> JTS in C++. This includes all the OpenGIS "Simple Features for SQL" 
> spatial predicate functions and spatial operators, as well as specific 
> JTS topology functions such as IsValid().
> 
> 
>   - now if we can link R spatial classes to this, we can build a 
> complete set of spatial predicate functions and spatial operators in R....
> 
> Barry
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
-- 
Timothy H. Keitt
Section of Integrative Biology
University of Texas at Austin
http://www.keittlab.org/



From hi_ono2001 at ybb.ne.jp  Tue Oct  5 19:10:25 2004
From: hi_ono2001 at ybb.ne.jp (Hisaji ONO)
Date: Wed, 6 Oct 2004 02:10:25 +0900
Subject: [R-sig-Geo] Geos library 
References: <4162BED2.2010802@lancaster.ac.uk>
Message-ID: <001401c4aafe$34a4b0c0$4a8001db@webgis>

 How about using PostGIS which has an interface to GEOS?

 And PostGIS's spatial indices has good performance for overlay analysises
and spatial queries.

 And R has a few interfaces to PostgreSQL.


> Has anyone considered an R interface to the geos library:
>
> http://geos.refractions.net/
>
> GEOS (Geometry Engine - Open Source) is a C++ port of the Java Topology
> Suite (JTS). As such, it aims to contain the complete functionality of
> JTS in C++. This includes all the OpenGIS "Simple Features for SQL"
> spatial predicate functions and spatial operators, as well as specific
> JTS topology functions such as IsValid().
>
>
>   - now if we can link R spatial classes to this, we can build a
> complete set of spatial predicate functions and spatial operators in R....
>
> Barry



From e.pebesma at geog.uu.nl  Tue Oct  5 19:54:57 2004
From: e.pebesma at geog.uu.nl (Edzer J. Pebesma)
Date: Tue, 05 Oct 2004 19:54:57 +0200
Subject: [R-sig-Geo] Geos library
In-Reply-To: <001401c4aafe$34a4b0c0$4a8001db@webgis>
References: <4162BED2.2010802@lancaster.ac.uk>
	<001401c4aafe$34a4b0c0$4a8001db@webgis>
Message-ID: <4162DFF1.2090009@geog.uu.nl>

Hisaji ONO wrote:

> How about using PostGIS which has an interface to GEOS?
>
> And PostGIS's spatial indices has good performance for overlay analysises
>and spatial queries.
>
> And R has a few interfaces to PostgreSQL.
>  
>
There's much to say for this. Maybe the question is whether we want to
implement a GIS or interface to GIS, using R. Of course both is possible,
but who would prefer using R over existing GIS for GIS functionality?
This question needs zooming in wrt different types of functionality.

I've been looking at GEOS in the past, and found it huge and complex.
Interfacing a major part of its functionality will be a large task, and then
running all the tests...

I think one of the first goals -- and we're working on this [1,2,3] -- 
must be
to provide suitable spatial classes, write package support for them so
that packages can use a common spatial data base, and provide convenient
GIS interface and visualisation functions. Of course, visualisation is part
of GIS as well, but then GIS don't have lattice and ... so on.
--
Edzer

[1] http://sourceforge.net/projects/r-spatial/
[2] http://elearning.maths.lancs.ac.uk:8080/RSpatial/
[3] any help is welcome!



From tkeitt at mail.utexas.edu  Tue Oct  5 21:06:46 2004
From: tkeitt at mail.utexas.edu (Timothy H. Keitt)
Date: Tue, 05 Oct 2004 14:06:46 -0500
Subject: [R-sig-Geo] Geos library
In-Reply-To: <4162DFF1.2090009@geog.uu.nl>
References: <4162BED2.2010802@lancaster.ac.uk>
	<001401c4aafe$34a4b0c0$4a8001db@webgis> <4162DFF1.2090009@geog.uu.nl>
Message-ID: <1097003206.20837.41.camel@workstation-3>

On Tue, 2004-10-05 at 12:54, Edzer J. Pebesma wrote:
> Hisaji ONO wrote:
> 
> > How about using PostGIS which has an interface to GEOS?
> >
> > And PostGIS's spatial indices has good performance for overlay analysises
> >and spatial queries.
> >
> > And R has a few interfaces to PostgreSQL.
> >  
> >
> There's much to say for this. Maybe the question is whether we want to
> implement a GIS or interface to GIS, using R. Of course both is possible,
> but who would prefer using R over existing GIS for GIS functionality?
> This question needs zooming in wrt different types of functionality.
> 

Yes, this is a key point. R could be converted into a pretty good GIS
platform, but how many would use it? Perhaps better is to hook R into a
client like UDIG (http://udig.refractions.net/). I'm imagining opening a
UDIG session for spatial preprocessing and then attaching an R session
with access to the UDIG data structures for model fitting. Of course,
one would still need proxy classes covering the geotools api.

T.

> I've been looking at GEOS in the past, and found it huge and complex.
> Interfacing a major part of its functionality will be a large task, and then
> running all the tests...
> 
> I think one of the first goals -- and we're working on this [1,2,3] -- 
> must be
> to provide suitable spatial classes, write package support for them so
> that packages can use a common spatial data base, and provide convenient
> GIS interface and visualisation functions. Of course, visualisation is part
> of GIS as well, but then GIS don't have lattice and ... so on.
> --
> Edzer
> 
> [1] http://sourceforge.net/projects/r-spatial/
> [2] http://elearning.maths.lancs.ac.uk:8080/RSpatial/
> [3] any help is welcome!
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
-- 
Timothy H. Keitt
Section of Integrative Biology
University of Texas at Austin
http://www.keittlab.org/



From B.Rowlingson at lancaster.ac.uk  Wed Oct  6 16:15:33 2004
From: B.Rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Wed, 06 Oct 2004 15:15:33 +0100
Subject: [R-sig-Geo] Geos library
In-Reply-To: <1097003206.20837.41.camel@workstation-3>
References: <4162BED2.2010802@lancaster.ac.uk>	<001401c4aafe$34a4b0c0$4a8001db@webgis>
	<4162DFF1.2090009@geog.uu.nl>
	<1097003206.20837.41.camel@workstation-3>
Message-ID: <4163FE05.6000701@lancaster.ac.uk>

Timothy H. Keitt wrote:

> Yes, this is a key point. R could be converted into a pretty good GIS
> platform, but how many would use it? Perhaps better is to hook R into a
> client like UDIG (http://udig.refractions.net/). I'm imagining opening a
> UDIG session for spatial preprocessing and then attaching an R session
> with access to the UDIG data structures for model fitting. Of course,
> one would still need proxy classes covering the geotools api.

  Have you got UDIG working? I've installed (I think) the java prereqs 
and other packages, including the Eclipse stuff referred to as the RCP 
Runtime Library. However the docs then go:

  * Unzip the RCP Runtime Binary where you would like to install UDIG 0.3
  * Download UDIG 0.3 is and unzip it into your RCP Runtime Binary folder
  * Run udig and enjoy

  Yet the precise meaning of 'run udig' isn't given. There's a few jars 
here and there, but no startup shell script....

Baz



From tkeitt at mail.utexas.edu  Wed Oct  6 16:37:48 2004
From: tkeitt at mail.utexas.edu (Timothy H. Keitt)
Date: Wed, 06 Oct 2004 09:37:48 -0500
Subject: [R-sig-Geo] Geos library
In-Reply-To: <4163FE05.6000701@lancaster.ac.uk>
References: <4162BED2.2010802@lancaster.ac.uk>
	<001401c4aafe$34a4b0c0$4a8001db@webgis> <4162DFF1.2090009@geog.uu.nl>
	<1097003206.20837.41.camel@workstation-3>
	<4163FE05.6000701@lancaster.ac.uk>
Message-ID: <1097073467.20837.75.camel@workstation-3>

Yes, its pretty rough now. I haven't run it myself, but have studied the
code a bit. I'm encouraged by the integration with eclipse and large
amount of code sharing across projects because of geotools2/geoAPI. I
have gotten JUMP (http://www.jump-project.org/) working and it looks OK.
I'm not sold though on it being swing based and having a relatively poor
architecture. My money is on UDIG in about a years time. I think we'll
see lots of momentum there. That motivated my suggestion of trying to be
compatible with geotools & UDIG.

T.

On Wed, 2004-10-06 at 09:15, Barry Rowlingson wrote:
> Timothy H. Keitt wrote:
> 
> > Yes, this is a key point. R could be converted into a pretty good GIS
> > platform, but how many would use it? Perhaps better is to hook R into a
> > client like UDIG (http://udig.refractions.net/). I'm imagining opening a
> > UDIG session for spatial preprocessing and then attaching an R session
> > with access to the UDIG data structures for model fitting. Of course,
> > one would still need proxy classes covering the geotools api.
> 
>   Have you got UDIG working? I've installed (I think) the java prereqs 
> and other packages, including the Eclipse stuff referred to as the RCP 
> Runtime Library. However the docs then go:
> 
>   * Unzip the RCP Runtime Binary where you would like to install UDIG 0.3
>   * Download UDIG 0.3 is and unzip it into your RCP Runtime Binary folder
>   * Run udig and enjoy
> 
>   Yet the precise meaning of 'run udig' isn't given. There's a few jars 
> here and there, but no startup shell script....
> 
> Baz
-- 
Timothy H. Keitt
Section of Integrative Biology
University of Texas at Austin
http://www.keittlab.org/



From tkeitt at mail.utexas.edu  Wed Oct 13 20:04:30 2004
From: tkeitt at mail.utexas.edu (Timothy H. Keitt)
Date: Wed, 13 Oct 2004 13:04:30 -0500
Subject: [R-sig-Geo] mapproj
Message-ID: <1097690670.12053.15.camel@workstation-3>

I noticed that there is no UTM option for mapproj. Or did I miss
something? I've been working in UTM zone 14 and it would be convenient
to have that available. Is there a workaround? (I guess proj on the
command line.)

THK

-- 
Timothy H. Keitt
Section of Integrative Biology
University of Texas at Austin
http://www.keittlab.org/



From emcintire at forestry.umt.edu  Thu Oct 14 18:50:30 2004
From: emcintire at forestry.umt.edu (Eliot McIntire)
Date: Thu, 14 Oct 2004 10:50:30 -0600
Subject: [R-sig-Geo] Fitting nested variograms to empirical variograms
Message-ID: <opsfvc2gulw3ajb1@smtp.umt.edu>

Hello,

I am new to the list, but I have searched for an answer to this question  
in the list archives and couldn't find anything.

Question:
Does anybody have experience with fitting nested variogram models in R?  I  
am not having success.

Details:
I am trying fit a nested variogram to an empirical variogram.  I have  
tried both gstat and geoR which appear able to do this, but I have come  
across these problems:

geoR: I can only run nested variogram models using cov.spatial and this is  
not suitable to fit a model to an empirical variogram.  In the help manual  
it says that I should inherit cov.spatial in the variofit function,  
however, it does not seem to work.  I get:
Error in match.arg(cov.model, choices = c("matern", "exponential",  
"gaussian",  :
         there is more than one match in match.arg
my code: F2.1Y.wls.exp = variofit(F2.1Y, ini.cov.pars=starting.values,  
fix.nugget=F,  nugget=starting.values.vec, cov.model=c("exp","spherical"))

gstat: I can run nested models using
F2.BA1.fit = fit.variogram (F2.BA1.variogram, vgm(psill=33,"Lin",6, add.to  
= vgm(psill=33,"Lin",6, nugget=20) )
                 , print.SSE=T, fit.sills=T, fit.ranges=T )


but I never seem to get a good fit, i.e., it always fails to fit the  
empirical variogram.

If anyone has a solution, I also need to calculate the Residual Sums of  
Squares to test for the relative fit.

Thank you,
Eliot

-- 
Eliot McIntire
NSERC Post Doctoral Fellow
Department of Ecosystems and Conservation Science
College of Forestry and Conservation
University of Montana, Missoula, MT 59812
406-243-5239
fax: 406-243-4557
emcintire at forestry.umt.edu



From olefc at daimi.au.dk  Thu Oct 14 19:22:08 2004
From: olefc at daimi.au.dk (Ole F. Christensen)
Date: Thu, 14 Oct 2004 19:22:08 +0200
Subject: [R-sig-Geo] Fitting nested variograms to empirical variograms
In-Reply-To: <opsfvc2gulw3ajb1@smtp.umt.edu>
References: <opsfvc2gulw3ajb1@smtp.umt.edu>
Message-ID: <416EB5C0.8060702@daimi.au.dk>

Dear Elliot

I can only comment on the geoR related question, since I am unfamiliar 
with gstat.

Reading the help-file for variofit, then I think it is rather clear that 
this functions assumes one variogram model [i.e. the format of the 
estimated parameters is a vector].
So fitting nested model using that function seems not possible.
I agree with you that the help-file for cov.spatial gives the impression 
that nested variables are allowed for that function.
And it also is bit misleading that  the help-file for variofit  refers 
to  cov.spatial, hinting that the full functionality of cov.spatial can 
be used in variofit.
I hope the author of the package can provide more details on this 
[therefore copy to him].

I have no experience fitting nested variogram models myself, but my 
general opinion is that nested variograms aren't really useful, since 
what matters the most is
to make a good fit of the empirical variogram near the origin. And if 
one really wants to make a very careful fit of a variogram-model to the 
data, then the likelihood function should be used rather than fitting to 
the empirical variogram.

Ole


Eliot McIntire wrote:

> Hello,
>
> I am new to the list, but I have searched for an answer to this 
> question  in the list archives and couldn't find anything.
>
> Question:
> Does anybody have experience with fitting nested variogram models in 
> R?  I  am not having success.
>
> Details:
> I am trying fit a nested variogram to an empirical variogram.  I have  
> tried both gstat and geoR which appear able to do this, but I have 
> come  across these problems:
>
> geoR: I can only run nested variogram models using cov.spatial and 
> this is  not suitable to fit a model to an empirical variogram.  In 
> the help manual  it says that I should inherit cov.spatial in the 
> variofit function,  however, it does not seem to work.  I get:
> Error in match.arg(cov.model, choices = c("matern", "exponential",  
> "gaussian",  :
>         there is more than one match in match.arg
> my code: F2.1Y.wls.exp = variofit(F2.1Y, 
> ini.cov.pars=starting.values,  fix.nugget=F,  
> nugget=starting.values.vec, cov.model=c("exp","spherical"))
>
> gstat: I can run nested models using
> F2.BA1.fit = fit.variogram (F2.BA1.variogram, vgm(psill=33,"Lin",6, 
> add.to  = vgm(psill=33,"Lin",6, nugget=20) )
>                 , print.SSE=T, fit.sills=T, fit.ranges=T )
>
>
> but I never seem to get a good fit, i.e., it always fails to fit the  
> empirical variogram.
>
> If anyone has a solution, I also need to calculate the Residual Sums 
> of  Squares to test for the relative fit.
>
> Thank you,
> Eliot
>

-- 
Ole F. Christensen
BiRC - Bioinformatics Research Center
University of Aarhus



From paulojus at est.ufpr.br  Thu Oct 14 20:56:49 2004
From: paulojus at est.ufpr.br (Paulo Justiniano Ribeiro Jr)
Date: Thu, 14 Oct 2004 15:56:49 -0300 (BRT)
Subject: [R-sig-Geo] Fitting nested variograms to empirical variograms
In-Reply-To: <416EB5C0.8060702@daimi.au.dk>
References: <opsfvc2gulw3ajb1@smtp.umt.edu> <416EB5C0.8060702@daimi.au.dk>
Message-ID: <Pine.LNX.4.58L0.0410141552100.14913@est.ufpr.br>

Dear Elliot

I entirely agree with Ole's comments and would just add the following:

- with geoR the only thing you can do is to overimpose to an epirical
variogram a theoretical nested variogram using lines.variomodel()
which internally calls cov.spatial()

- cov.spatial() is able to compute values of nested variogram, so you
could use it as ingredient for other computation
bearing in mind whether this is really useful and whether these things
are really estimable

best
P.J.

On Thu, 14 Oct 2004, Ole F. Christensen wrote:

> Dear Elliot
>
> I can only comment on the geoR related question, since I am unfamiliar
> with gstat.
>
> Reading the help-file for variofit, then I think it is rather clear that
> this functions assumes one variogram model [i.e. the format of the
> estimated parameters is a vector].
> So fitting nested model using that function seems not possible.
> I agree with you that the help-file for cov.spatial gives the impression
> that nested variables are allowed for that function.
> And it also is bit misleading that  the help-file for variofit  refers
> to  cov.spatial, hinting that the full functionality of cov.spatial can
> be used in variofit.
> I hope the author of the package can provide more details on this
> [therefore copy to him].
>
> I have no experience fitting nested variogram models myself, but my
> general opinion is that nested variograms aren't really useful, since
> what matters the most is
> to make a good fit of the empirical variogram near the origin. And if
> one really wants to make a very careful fit of a variogram-model to the
> data, then the likelihood function should be used rather than fitting to
> the empirical variogram.
>
> Ole
>
>
> Eliot McIntire wrote:
>
> > Hello,
> >
> > I am new to the list, but I have searched for an answer to this
> > question  in the list archives and couldn't find anything.
> >
> > Question:
> > Does anybody have experience with fitting nested variogram models in
> > R?  I  am not having success.
> >
> > Details:
> > I am trying fit a nested variogram to an empirical variogram.  I have
> > tried both gstat and geoR which appear able to do this, but I have
> > come  across these problems:
> >
> > geoR: I can only run nested variogram models using cov.spatial and
> > this is  not suitable to fit a model to an empirical variogram.  In
> > the help manual  it says that I should inherit cov.spatial in the
> > variofit function,  however, it does not seem to work.  I get:
> > Error in match.arg(cov.model, choices = c("matern", "exponential",
> > "gaussian",  :
> >         there is more than one match in match.arg
> > my code: F2.1Y.wls.exp = variofit(F2.1Y,
> > ini.cov.pars=starting.values,  fix.nugget=F,
> > nugget=starting.values.vec, cov.model=c("exp","spherical"))
> >
> > gstat: I can run nested models using
> > F2.BA1.fit = fit.variogram (F2.BA1.variogram, vgm(psill=33,"Lin",6,
> > add.to  = vgm(psill=33,"Lin",6, nugget=20) )
> >                 , print.SSE=T, fit.sills=T, fit.ranges=T )
> >
> >
> > but I never seem to get a good fit, i.e., it always fails to fit the
> > empirical variogram.
> >
> > If anyone has a solution, I also need to calculate the Residual Sums
> > of  Squares to test for the relative fit.
> >
> > Thank you,
> > Eliot
> >
>
> --
> Ole F. Christensen
> BiRC - Bioinformatics Research Center
> University of Aarhus
>
>
>
>

Paulo Justiniano Ribeiro Jr
Departamento de Estat?stica
Universidade Federal do Paran?
Caixa Postal 19.081
CEP 81.531-990
Curitiba, PR  -  Brasil
Tel: (+55) 41 361 3573
Fax: (+55) 41 361 3141
e-mail: paulojus at est.ufpr.br
http://www.est.ufpr.br/~paulojus

 /"\
 \ /  Campanha da fita ASCII - contra mail html
  X   ASCII ribbon campaign - against html mail
 / \



From Roger.Bivand at nhh.no  Thu Oct 14 22:38:52 2004
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 14 Oct 2004 22:38:52 +0200 (CEST)
Subject: [R-sig-Geo] mapproj (fwd)
Message-ID: <Pine.LNX.4.44.0410142236170.17547-100000@reclus.nhh.no>

I'm resending this posting because of the power outages in Zurich on 
Wednesday, which stopped it getting through to the list, I think.

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Breiviksveien 40, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 93 93
e-mail: Roger.Bivand at nhh.no


---------- Forwarded message ----------
Date: Wed, 13 Oct 2004 21:03:54 +0200 (CEST)
From: Roger Bivand <Roger.Bivand at nhh.no>
To: Timothy H. Keitt <tkeitt at mail.utexas.edu>
Cc: r-sig-geo at stat.math.ethz.ch
Subject: Re: [R-sig-Geo] mapproj

On Wed, 13 Oct 2004, Timothy H. Keitt wrote:

> I noticed that there is no UTM option for mapproj. Or did I miss
> something? I've been working in UTM zone 14 and it would be convenient
> to have that available. Is there a workaround? (I guess proj on the
> command line.)

Afraid not, doesn't seem to be an evident transverse mercator, which could 
be made to play if all the other arguments were known (and could be passed 
through). proj from system() should do it.

Roger

> 
> THK
> 
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Breiviksveien 40, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 93 93
e-mail: Roger.Bivand at nhh.no



From e.pebesma at geog.uu.nl  Sat Oct 16 10:49:17 2004
From: e.pebesma at geog.uu.nl (Edzer J. Pebesma)
Date: Sat, 16 Oct 2004 10:49:17 +0200
Subject: [R-sig-Geo] Fitting nested variograms to empirical variograms
In-Reply-To: <opsfvc2gulw3ajb1@smtp.umt.edu>
References: <opsfvc2gulw3ajb1@smtp.umt.edu>
Message-ID: <4170E08D.5090202@geog.uu.nl>



Eliot McIntire wrote:

>
> gstat: I can run nested models using
> F2.BA1.fit = fit.variogram (F2.BA1.variogram, vgm(psill=33,"Lin",6, 
> add.to  = vgm(psill=33,"Lin",6, nugget=20) )
>                 , print.SSE=T, fit.sills=T, fit.ranges=T )
>
>
> but I never seem to get a good fit, i.e., it always fails to fit the  
> empirical variogram.
>
> If anyone has a solution, I also need to calculate the Residual Sums 
> of  Squares to test for the relative fit.

The problem is your starting values for the ranges. Use the values that you
fit `by eye' from the sample variogram; they should be sufficiently distinct
(and present in the sample variogram) for gstat to fit them with success.

Also, be aware that the linear model with range is not a valid variogram
model for data in more than one dimension.

Best regards,
--
Edzer



From e.pebesma at geog.uu.nl  Sat Oct 16 11:14:31 2004
From: e.pebesma at geog.uu.nl (Edzer J. Pebesma)
Date: Sat, 16 Oct 2004 11:14:31 +0200
Subject: [R-sig-Geo] Fitting nested variograms to empirical variograms
In-Reply-To: <416EB5C0.8060702@daimi.au.dk>
References: <opsfvc2gulw3ajb1@smtp.umt.edu> <416EB5C0.8060702@daimi.au.dk>
Message-ID: <4170E677.6050203@geog.uu.nl>



Ole F. Christensen wrote:

>
> I have no experience fitting nested variogram models myself, but my 
> general opinion is that nested variograms aren't really useful, since 
> what matters the most is
> to make a good fit of the empirical variogram near the origin. And if 
> one really wants to make a very careful fit of a variogram-model to 
> the data, then the likelihood function should be used rather than 
> fitting to the empirical variogram.

This reasoning has been put forward in the 1999 book by Michael Stein which
contains besides this one a few very provocative statements, such as 
"forget about
sample variograms, only look at likelyhood profiles". Although I like 
the book,
the problem I have with it is that it contains hardly any analysis of 
real data. The
argument therefore is based on theory; mathematicians do that, and they 
may prove
right.

However, nested variograms have been very useful in the past, especially for
describing spatial variability in larger data sets. There are 
theoretical arguments
for using them, think e.g. of the nugget effect: it consists of 
measurement error
(a "true" nugget effect) and spatially correlated microvariation: a 
nested variogram
model with a range so small that it's usually not detected by the data; see
Cressie (1993) for more on this. Given it's not in the data, ML or REML 
will never pick
it up, it's only something you can (and should) impose when you know for
instance the true measurement error from other sources than the observed 
data.

I would like to see papers where both approaches (ML without nested vs.
nested models, traditionally fit) were compared with large data sets; I find
it hard to embrace theoretical ideas without having them seen work in 
practice.

Geostatistics is about modelling what's out there.
--
Edzer



From olefc at daimi.au.dk  Sat Oct 16 14:14:42 2004
From: olefc at daimi.au.dk (Ole F. Christensen)
Date: Sat, 16 Oct 2004 14:14:42 +0200
Subject: [R-sig-Geo] Fitting nested variograms to empirical variograms
In-Reply-To: <4170E677.6050203@geog.uu.nl>
References: <opsfvc2gulw3ajb1@smtp.umt.edu> <416EB5C0.8060702@daimi.au.dk>
	<4170E677.6050203@geog.uu.nl>
Message-ID: <417110B2.5010100@daimi.au.dk>

Dear Edzer

Thanks for your comment. I don't think we strongly disagree on these 
matters. I hope this response clarifies  my current view point.

* I certainly don't want to debunk the empirical variogram. I find it 
very useful as an exploratory tool. For example, the emperical variogram 
might reveal pseudo-periodicity in the data and it might reveal 
directional effects. For some projects there is also the questions 
whether there is actually any spatial structure in the data, which a 
variogram plot of residuals [or standardised residuals if you having a 
GLM model] would reveal. Also plotting the empirical variogram might 
reveal if something has gone wrong when fitting by m.l.e.
My recommandation : "Always plot the empirical variogram [of 
standardised residuals]"

* I agree that the micro-scale variation component may be an important 
component. Since the data does not contain any information about whether 
a non-spatial component is part of the signal of interest or just random 
noise then the user has to specify this himself. This is an issue no 
matter what inference-machinery you are using [m.l.e. or fitting to 
variograms].
I can't see we disagree about anything here [and if you see my paper in 
the september 2004 issue of Journal of computational and Graphical 
Statistics, then there is a discussion about micro-scale issues for 
likelihood inference in a spatial Poisson model].

* Nested variogram models. My objection to them is based on what I have 
sometimes seen : a very elaborate fitting to empirical variograms, where 
a lot of effort is going into fitting the variogram away from the 
origin, and where the number of variogram models used in the nested 
structure seems to decided by this fitting to the empirical variogram in 
mind.
A nested model for the variogram really says that the phenomenon we are 
modelling is Y(x) = Y_1(x) + Y_2(x) + Y_3(x) + Y_4(x) etc. , where the 
different components have different spatial structure.
Rather than letting the empirical variogram decide the number of 
components, then shouldn't we start thinking about at the data 
generating mechanisms instead ?
When having more than one spatial component Y_i(x), shouldn't we attempt 
interpreting the different components ?
How about the implicit additivity assumption of the components when 
using a nested model ? [The data generating mechanism may suggest 
otherwise ... ].
A blind use of nested variogram models seems silly to me.

* Fitting a nested variogram model. In case you want to use such a 
model, then you may fit the parameters by maximum likelihood, which was 
one point I tried to make in my previous mail. I see now that I may have 
stressed that point a bit too hard.
I expect that a procedure for finding the maximum of the likelihood, for 
some data sets might have convergence problems due to identifiability 
problems of parameters. So probably good starting values are needed, but 
from your previous e-mail I see that there seems to be a similar issue 
for fitting to variograms. As you wrote in your previous e-mail, good 
starting values can be found by fitting a nested model by eye. I also 
have to admit, that currently there seems to be no procedure available 
in packages in R for fitting nested variogram models using maximum 
likelihood [so we are lacking behind in that respect].

* Using the likelihood function : A certain type of books and papers 
about geostatistics may have emphasised the likelihood function too 
strongly.
 Being brought up as a statistician, then using the likelihood function 
for inference is the natural thing to me. But I have also been taught to 
be be careful about the model.
A model should catch the important structure of the data [here you need 
input from subject matter people]. Considering and investigating the 
structure of a model in many aspect is where we should spend our time.
 I give my applaud to the final sentence in your e-mail ``Geostatistics 
is about modelling what's out there."

* Last comment : Your suggested comparison  (ML without nested vs. 
nested models, traditionally fit) is missing the point entirely, since 
such a comparison would be a comparison of two different models, rather 
than two procedures for inference.


Best regards
Ole

Edzer J. Pebesma wrote:

>
>
> Ole F. Christensen wrote:
>
>>
>> I have no experience fitting nested variogram models myself, but my 
>> general opinion is that nested variograms aren't really useful, since 
>> what matters the most is
>> to make a good fit of the empirical variogram near the origin. And if 
>> one really wants to make a very careful fit of a variogram-model to 
>> the data, then the likelihood function should be used rather than 
>> fitting to the empirical variogram.
>
>
> This reasoning has been put forward in the 1999 book by Michael Stein 
> which
> contains besides this one a few very provocative statements, such as 
> "forget about
> sample variograms, only look at likelyhood profiles". Although I like 
> the book,
> the problem I have with it is that it contains hardly any analysis of 
> real data. The
> argument therefore is based on theory; mathematicians do that, and 
> they may prove
> right.
>
> However, nested variograms have been very useful in the past, 
> especially for
> describing spatial variability in larger data sets. There are 
> theoretical arguments
> for using them, think e.g. of the nugget effect: it consists of 
> measurement error
> (a "true" nugget effect) and spatially correlated microvariation: a 
> nested variogram
> model with a range so small that it's usually not detected by the 
> data; see
> Cressie (1993) for more on this. Given it's not in the data, ML or 
> REML will never pick
> it up, it's only something you can (and should) impose when you know for
> instance the true measurement error from other sources than the 
> observed data.
>
> I would like to see papers where both approaches (ML without nested vs.
> nested models, traditionally fit) were compared with large data sets; 
> I find
> it hard to embrace theoretical ideas without having them seen work in 
> practice.
>
> Geostatistics is about modelling what's out there.
> -- 
> Edzer
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>

-- 
Ole F. Christensen
BiRC - Bioinformatics Research Center
University of Aarhus



From emcintire at forestry.umt.edu  Mon Oct 18 16:57:24 2004
From: emcintire at forestry.umt.edu (Eliot McIntire)
Date: Mon, 18 Oct 2004 08:57:24 -0600
Subject: [R-sig-Geo] Summary: Fitting nested variograms to empirical
	variograms
In-Reply-To: <4170E08D.5090202@geog.uu.nl>
References: <opsfvc2gulw3ajb1@smtp.umt.edu> <4170E08D.5090202@geog.uu.nl>
Message-ID: <opsf2mhyivw3ajb1@smtp.umt.edu>

Thank you for your comments Edzer, Ole and Paulo,

Edzer:
> Also, be aware that the linear model with range is not a valid variogram
> model for data in more than one dimension.

Yes, for some reason, I copied the code for the Linear models.  I believe  
I had been trying nesting two exponentials or spherical and exponential,  
which was resulting in the error.  I tried to simplify the model by  
putting in the linear models and had the same problem.

Ole and Edzer:

> * Nested variogram models. My objection to them is based on what I have  
> sometimes seen : a very elaborate fitting to empirical variograms, where  
> a lot of effort is going into fitting the variogram away from the  
> origin, and where the number of variogram models used in the nested  
> structure seems to decided by this fitting to the empirical variogram in  
> mind.
> A nested model for the variogram really says that the phenomenon we are  
> modelling is Y(x) = Y_1(x) + Y_2(x) + Y_3(x) + Y_4(x) etc. , where the  
> different components have different spatial structure.
> Rather than letting the empirical variogram decide the number of  
> components, then shouldn't we start thinking about at the data  
> generating mechanisms instead ?
> When having more than one spatial component Y_i(x), shouldn't we attempt  
> interpreting the different components ?
> How about the implicit additivity assumption of the components when  
> using a nested model ? [The data generating mechanism may suggest  
> otherwise ... ].
> A blind use of nested variogram models seems silly to me.

I am an ecologist, and it is actually the mechanisms I am interested in,  
which is arguably more than "modeling what's out there".  The data that I  
am fitting using WLS fitted to empirical variograms or ML fit to the data  
are only just numbers.  They do, however, represent the outcome of  
potentially several underlying ecological mechanisms.  The context for  
this study is identifying competition among trees in plantations in  
Chile.  The expected variogram shape reflecting underlying environmental  
variation would be a traditional increasing function, like an exponential:  
closer points are more alike.  The expected variogram shape reflecting  
competition among trees (which is expected to be assymetrical, i.e., the  
larger tree negatively affects the smaller tree, the not the inverse) is  
more like a wave function: neighbouring trees are expected to have MORE  
variation than the average variation across the forest stand.  To test  
this mechanistic hypothesis, I have tree ring growth data from 7 different  
forests, so I have growth increment each year for every tree.  To test for  
competition, I would like to fit a wave function; to test for  
environmental variation, I would like to fit an exponential function; to  
test for the two, I would like to test a nested function.  I will be  
comparing the relative fits of these three models using AIC (since the  
nested model now has more parameters, an information criterion like AIC  
becomes appropriate).

I the end, I have decided to model my own variograms and fit them using  
weighted non-linear least squares, unrelated to the "built in" functions  
in geoR or gstat because I couldn't get them to work.  I am having success  
fitting the models in this way (i.e., coding my own functions).

Ole:
I am glad you do not bunk fitting empirical variograms, as you point out,  
there seems to be useful places for either approach.  And it seems to me  
that there are fewer distributional assumptions in fitting an empirical  
variogram using WLS, and that it does "a pretty good job" most of the time.

I still have not had a conclusive statement that I can model nested  
variograms in any of these R functions.  I will write the authors.

Thank you for your comments,
Eliot


On Sat, 16 Oct 2004 10:49:17 +0200, Edzer J. Pebesma  
<e.pebesma at geog.uu.nl> wrote:

>
>
> Eliot McIntire wrote:
>
>>
>> gstat: I can run nested models using
>> F2.BA1.fit = fit.variogram (F2.BA1.variogram, vgm(psill=33,"Lin",6,  
>> add.to  = vgm(psill=33,"Lin",6, nugget=20) )
>>                 , print.SSE=T, fit.sills=T, fit.ranges=T )
>>
>>
>> but I never seem to get a good fit, i.e., it always fails to fit the   
>> empirical variogram.
>>
>> If anyone has a solution, I also need to calculate the Residual Sums  
>> of  Squares to test for the relative fit.
>
> The problem is your starting values for the ranges. Use the values that  
> you
> fit `by eye' from the sample variogram; they should be sufficiently  
> distinct
> (and present in the sample variogram) for gstat to fit them with success.
>
>
> Best regards,
> --
> Edzer



-- 
Eliot McIntire
NSERC Post Doctoral Fellow
Department of Ecosystems and Conservation Science
College of Forestry and Conservation
University of Montana, Missoula, MT 59812
406-243-5239
fax: 406-243-4557
emcintire at forestry.umt.edu



From paulojus at est.ufpr.br  Mon Oct 18 18:38:17 2004
From: paulojus at est.ufpr.br (Paulo Justiniano Ribeiro Jr)
Date: Mon, 18 Oct 2004 14:38:17 -0200 (BRST)
Subject: [R-sig-Geo] Summary: Fitting nested variograms to empirical
	variograms
In-Reply-To: <opsf2mhyivw3ajb1@smtp.umt.edu>
References: <opsfvc2gulw3ajb1@smtp.umt.edu> <4170E08D.5090202@geog.uu.nl>
	<opsf2mhyivw3ajb1@smtp.umt.edu>
Message-ID: <Pine.LNX.4.58L0.0410181433060.27042@est.ufpr.br>

Eliot

Despite of the very interesting debate and exchange of ideias on
validity/merit etc
here it is example on how to overimpose  variograms variogram models
using nested models in geoR.
It's is a try and error exercise with lines.variomodel:
> data(s100)
> v <- variog(s100, max.d=1)
> plot(v)
# a single structure variogram
> lines.variomodel(seq(0,1,l=100), cov.model="exp", cov.pars=c(1, .25),
nug=0)
# a nested variogram model
> lines.variomodel(seq(0,1,l=100), cov.model="exp", cov.pars=rbind(c(.5,
.1), c(.5,.3)), nug=0, col=2)

Besides there is an tcl/tk based function with a menu and sliding bars.
The function is eyefit() and is based on lines.variomodel.
However it does not cope with nested models, but can be modifyed to do so


Best
P.J.




On Mon, 18 Oct 2004, Eliot McIntire wrote:

> Thank you for your comments Edzer, Ole and Paulo,
>
> Edzer:
> > Also, be aware that the linear model with range is not a valid variogram
> > model for data in more than one dimension.
>
> Yes, for some reason, I copied the code for the Linear models.  I believe
> I had been trying nesting two exponentials or spherical and exponential,
> which was resulting in the error.  I tried to simplify the model by
> putting in the linear models and had the same problem.
>
> Ole and Edzer:
>
> > * Nested variogram models. My objection to them is based on what I have
> > sometimes seen : a very elaborate fitting to empirical variograms, where
> > a lot of effort is going into fitting the variogram away from the
> > origin, and where the number of variogram models used in the nested
> > structure seems to decided by this fitting to the empirical variogram in
> > mind.
> > A nested model for the variogram really says that the phenomenon we are
> > modelling is Y(x) = Y_1(x) + Y_2(x) + Y_3(x) + Y_4(x) etc. , where the
> > different components have different spatial structure.
> > Rather than letting the empirical variogram decide the number of
> > components, then shouldn't we start thinking about at the data
> > generating mechanisms instead ?
> > When having more than one spatial component Y_i(x), shouldn't we attempt
> > interpreting the different components ?
> > How about the implicit additivity assumption of the components when
> > using a nested model ? [The data generating mechanism may suggest
> > otherwise ... ].
> > A blind use of nested variogram models seems silly to me.
>
> I am an ecologist, and it is actually the mechanisms I am interested in,
> which is arguably more than "modeling what's out there".  The data that I
> am fitting using WLS fitted to empirical variograms or ML fit to the data
> are only just numbers.  They do, however, represent the outcome of
> potentially several underlying ecological mechanisms.  The context for
> this study is identifying competition among trees in plantations in
> Chile.  The expected variogram shape reflecting underlying environmental
> variation would be a traditional increasing function, like an exponential:
> closer points are more alike.  The expected variogram shape reflecting
> competition among trees (which is expected to be assymetrical, i.e., the
> larger tree negatively affects the smaller tree, the not the inverse) is
> more like a wave function: neighbouring trees are expected to have MORE
> variation than the average variation across the forest stand.  To test
> this mechanistic hypothesis, I have tree ring growth data from 7 different
> forests, so I have growth increment each year for every tree.  To test for
> competition, I would like to fit a wave function; to test for
> environmental variation, I would like to fit an exponential function; to
> test for the two, I would like to test a nested function.  I will be
> comparing the relative fits of these three models using AIC (since the
> nested model now has more parameters, an information criterion like AIC
> becomes appropriate).
>
> I the end, I have decided to model my own variograms and fit them using
> weighted non-linear least squares, unrelated to the "built in" functions
> in geoR or gstat because I couldn't get them to work.  I am having success
> fitting the models in this way (i.e., coding my own functions).
>
> Ole:
> I am glad you do not bunk fitting empirical variograms, as you point out,
> there seems to be useful places for either approach.  And it seems to me
> that there are fewer distributional assumptions in fitting an empirical
> variogram using WLS, and that it does "a pretty good job" most of the time.
>
> I still have not had a conclusive statement that I can model nested
> variograms in any of these R functions.  I will write the authors.
>
> Thank you for your comments,
> Eliot
>
>
> On Sat, 16 Oct 2004 10:49:17 +0200, Edzer J. Pebesma
> <e.pebesma at geog.uu.nl> wrote:
>
> >
> >
> > Eliot McIntire wrote:
> >
> >>
> >> gstat: I can run nested models using
> >> F2.BA1.fit = fit.variogram (F2.BA1.variogram, vgm(psill=33,"Lin",6,
> >> add.to  = vgm(psill=33,"Lin",6, nugget=20) )
> >>                 , print.SSE=T, fit.sills=T, fit.ranges=T )
> >>
> >>
> >> but I never seem to get a good fit, i.e., it always fails to fit the
> >> empirical variogram.
> >>
> >> If anyone has a solution, I also need to calculate the Residual Sums
> >> of  Squares to test for the relative fit.
> >
> > The problem is your starting values for the ranges. Use the values that
> > you
> > fit `by eye' from the sample variogram; they should be sufficiently
> > distinct
> > (and present in the sample variogram) for gstat to fit them with success.
> >
> >
> > Best regards,
> > --
> > Edzer
>
>
>
> --
> Eliot McIntire
> NSERC Post Doctoral Fellow
> Department of Ecosystems and Conservation Science
> College of Forestry and Conservation
> University of Montana, Missoula, MT 59812
> 406-243-5239
> fax: 406-243-4557
> emcintire at forestry.umt.edu
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>

Paulo Justiniano Ribeiro Jr
Departamento de Estat?stica
Universidade Federal do Paran?
Caixa Postal 19.081
CEP 81.531-990
Curitiba, PR  -  Brasil
Tel: (+55) 41 361 3573
Fax: (+55) 41 361 3141
e-mail: paulojus at est.ufpr.br
http://www.est.ufpr.br/~paulojus

 /"\
 \ /  Campanha da fita ASCII - contra mail html
  X   ASCII ribbon campaign - against html mail
 / \



From olefc at daimi.au.dk  Mon Oct 18 19:18:06 2004
From: olefc at daimi.au.dk (Ole F. Christensen)
Date: Mon, 18 Oct 2004 19:18:06 +0200
Subject: [R-sig-Geo] Summary: Fitting nested variograms to
	empirical	variograms
In-Reply-To: <opsf2mhyivw3ajb1@smtp.umt.edu>
References: <opsfvc2gulw3ajb1@smtp.umt.edu> <4170E08D.5090202@geog.uu.nl>
	<opsf2mhyivw3ajb1@smtp.umt.edu>
Message-ID: <4173FACE.4080100@daimi.au.dk>

Dear Elliot

I am glad that there is an interpretation behind the the nested modellig 
you are doing.
Given that the likelihood approach to the nested variogram models is not 
implemented I would also do what do, fit by eye a variogram-model to the 
empirical variogram. [I just noticed that Paulo replied about how to do 
such things using his software]
Just a thought : Could there be some information in the locations of the 
trees, i.e. in the neighbourhood of a large three there would probably 
be no other trees at all ?
Marked point processes may (at least in principle) provide a framework 
for a type of modelling (but don't ask me, I don't know much about such 
models).

> Ole:
> I am glad you do not bunk fitting empirical variograms, as you point 
> out,  there seems to be useful places for either approach.  And it 
> seems to me  that there are fewer distributional assumptions in 
> fitting an empirical  variogram using WLS, and that it does "a pretty 
> good job" most of the time.


Well, I actually wrote that I do not bunk  the "empirical variogram". 
I don't really like the "fitting to empirical variograms".
Note the distinction here : I very am happy with the empirical 
variograms in themselfves but less happy with the fitting to them. When 
you use the likelihood function, you are fitting a model to the data, 
instead of fitting to a summary of the data [which emprirical variograms 
are]
I disagree with "there are fewer distributional assumptions in fitting 
an empirical variogram". When the distributional assumptions are not 
true, say Gaussian, you may still use that specific likelihood function 
estimate your parameters.
Neither the likelihood approach nor the fitting to empirical variograms 
have a theoretical justification when the model is wrong. The difference 
is that likelihood approach has a justification when the model is true.
In practice, where one should be worried, is when the distribution of 
the data is skewed. Here you should really transform the data [and it 
does not matter which approach you are using to estimate parameters].
The fitting to empirical variograms may do "a pretty good job" in 
practice, but actually you need to fit by likelihood before you can 
confirm this :-)


I have probably already written too much about likelihood ...... We seem 
to agree on modelling which is the important part.

Ole



From paulojus at est.ufpr.br  Tue Oct 19 02:56:33 2004
From: paulojus at est.ufpr.br (Paulo Justiniano Ribeiro Jr)
Date: Mon, 18 Oct 2004 22:56:33 -0200 (BRST)
Subject: [R-sig-Geo] Summary: Fitting nested variograms to empirical
	variograms
In-Reply-To: <opsf2t0iayw3ajb1@smtp.umt.edu>
References: <opsfvc2gulw3ajb1@smtp.umt.edu> <4170E08D.5090202@geog.uu.nl>
	<opsf2mhyivw3ajb1@smtp.umt.edu>
	<Pine.LNX.4.58L0.0410181433060.27042@est.ufpr.br>
	<opsf2t0iayw3ajb1@smtp.umt.edu>
Message-ID: <Pine.LNX.4.58L0.0410182249320.12210@est.ufpr.br>

Dear Eliot

I've been checking the geoR code and have now done a change for
lines.variomodel() be able to plot nested variograms models

You will need to update geoR from the version on its we-site
just loaded (1 min ago)
Below there is an example code on how to do that and also on how to
compute a "goodness-of- fit" measure (bearing in mind all the previous
debate on this list)

best
P.J.

require(geoR)
data(s100)
v <- variog(s100, max.dist=1)
plot(v)
## overimposing a variogram with a single structure
lines.variomodel(seq(0,1,l=101), cov.model="exp", cov.pars=c(1, .25),
nug=0)
## and accessing a "quality of fit" by sum of squares
teo1 <- cov.spatial(v$u, cov.model="exp", cov.pars=c(1, .25))
ss1 <- sum((v$v - teo1)^2)
ss1

## overimposing a variogram with two exponential structures
lines.variomodel(seq(0,1,l=101), cov.model="exp", cov.pars=rbind(c(0.6,
.15), c(0.4, .65)), nug=0, col=2)
teo2 <- cov.spatial(v$u, cov.model="exp", cov.pars=rbind(c(0.6, .15),
c(0.4, .65)))
ss2 <- sum((v$v - teo2)^2)
ss2

## overimposing a variogram with exponential and spherical structures
lines.variomodel(seq(0,1,l=101), cov.model=c("exp", "sph"),
cov.pars=rbind(c(0.6, .15), c(0.4, .65)), nug=0, col=3)
teo3 <- cov.spatial(v$u, cov.model=c("exp", "sph"), cov.pars=rbind(c(0.6,
.15), c(0.4, .65)))
ss3 <- sum((v$v - teo3)^2)
ss3


On Mon, 18 Oct 2004, Eliot McIntire wrote:

> Paulo,
>
> Sorry for one more follow-up...
>
> Your example here has a nested exponential within an exponential.  Is it
> possible to do two different models?
>
> Also, I can't see how this will help me arrive at a "quantitative" fit
> measurement, like residual sums of squares, that I can use to compare the
> fit of different models.  Am I corrent?
>
> Thank you,
> Eliot
>
> On Mon, 18 Oct 2004 14:38:17 -0200 (BRST), Paulo Justiniano Ribeiro Jr
> <paulojus at est.ufpr.br> wrote:
>
> > Eliot
> >
> > Despite of the very interesting debate and exchange of ideias on
> > validity/merit etc
> > here it is example on how to overimpose  variograms variogram models
> > using nested models in geoR.
> > It's is a try and error exercise with lines.variomodel:
> >> data(s100)
> >> v <- variog(s100, max.d=1)
> >> plot(v)
> > # a single structure variogram
> >> lines.variomodel(seq(0,1,l=100), cov.model="exp", cov.pars=c(1, .25),
> > nug=0)
> > # a nested variogram model
> >> lines.variomodel(seq(0,1,l=100), cov.model="exp", cov.pars=rbind(c(.5,
> > .1), c(.5,.3)), nug=0, col=2)
> >
> > Besides there is an tcl/tk based function with a menu and sliding bars.
> > The function is eyefit() and is based on lines.variomodel.
> > However it does not cope with nested models, but can be modifyed to do so
> >
> >
> > Best
> > P.J.
> >
> >
> >
> >
> > On Mon, 18 Oct 2004, Eliot McIntire wrote:
> >
> >> Thank you for your comments Edzer, Ole and Paulo,
> >>
> >> Edzer:
> >> > Also, be aware that the linear model with range is not a valid
> >> variogram
> >> > model for data in more than one dimension.
> >>
> >> Yes, for some reason, I copied the code for the Linear models.  I
> >> believe
> >> I had been trying nesting two exponentials or spherical and exponential,
> >> which was resulting in the error.  I tried to simplify the model by
> >> putting in the linear models and had the same problem.
> >>
> >> Ole and Edzer:
> >>
> >> > * Nested variogram models. My objection to them is based on what I
> >> have
> >> > sometimes seen : a very elaborate fitting to empirical variograms,
> >> where
> >> > a lot of effort is going into fitting the variogram away from the
> >> > origin, and where the number of variogram models used in the nested
> >> > structure seems to decided by this fitting to the empirical variogram
> >> in
> >> > mind.
> >> > A nested model for the variogram really says that the phenomenon we
> >> are
> >> > modelling is Y(x) = Y_1(x) + Y_2(x) + Y_3(x) + Y_4(x) etc. , where the
> >> > different components have different spatial structure.
> >> > Rather than letting the empirical variogram decide the number of
> >> > components, then shouldn't we start thinking about at the data
> >> > generating mechanisms instead ?
> >> > When having more than one spatial component Y_i(x), shouldn't we
> >> attempt
> >> > interpreting the different components ?
> >> > How about the implicit additivity assumption of the components when
> >> > using a nested model ? [The data generating mechanism may suggest
> >> > otherwise ... ].
> >> > A blind use of nested variogram models seems silly to me.
> >>
> >> I am an ecologist, and it is actually the mechanisms I am interested in,
> >> which is arguably more than "modeling what's out there".  The data that
> >> I
> >> am fitting using WLS fitted to empirical variograms or ML fit to the
> >> data
> >> are only just numbers.  They do, however, represent the outcome of
> >> potentially several underlying ecological mechanisms.  The context for
> >> this study is identifying competition among trees in plantations in
> >> Chile.  The expected variogram shape reflecting underlying environmental
> >> variation would be a traditional increasing function, like an
> >> exponential:
> >> closer points are more alike.  The expected variogram shape reflecting
> >> competition among trees (which is expected to be assymetrical, i.e., the
> >> larger tree negatively affects the smaller tree, the not the inverse) is
> >> more like a wave function: neighbouring trees are expected to have MORE
> >> variation than the average variation across the forest stand.  To test
> >> this mechanistic hypothesis, I have tree ring growth data from 7
> >> different
> >> forests, so I have growth increment each year for every tree.  To test
> >> for
> >> competition, I would like to fit a wave function; to test for
> >> environmental variation, I would like to fit an exponential function; to
> >> test for the two, I would like to test a nested function.  I will be
> >> comparing the relative fits of these three models using AIC (since the
> >> nested model now has more parameters, an information criterion like AIC
> >> becomes appropriate).
> >>
> >> I the end, I have decided to model my own variograms and fit them using
> >> weighted non-linear least squares, unrelated to the "built in" functions
> >> in geoR or gstat because I couldn't get them to work.  I am having
> >> success
> >> fitting the models in this way (i.e., coding my own functions).
> >>
> >> Ole:
> >> I am glad you do not bunk fitting empirical variograms, as you point
> >> out,
> >> there seems to be useful places for either approach.  And it seems to me
> >> that there are fewer distributional assumptions in fitting an empirical
> >> variogram using WLS, and that it does "a pretty good job" most of the
> >> time.
> >>
> >> I still have not had a conclusive statement that I can model nested
> >> variograms in any of these R functions.  I will write the authors.
> >>
> >> Thank you for your comments,
> >> Eliot
> >>
> >>
> >> On Sat, 16 Oct 2004 10:49:17 +0200, Edzer J. Pebesma
> >> <e.pebesma at geog.uu.nl> wrote:
> >>
> >> >
> >> >
> >> > Eliot McIntire wrote:
> >> >
> >> >>
> >> >> gstat: I can run nested models using
> >> >> F2.BA1.fit = fit.variogram (F2.BA1.variogram, vgm(psill=33,"Lin",6,
> >> >> add.to  = vgm(psill=33,"Lin",6, nugget=20) )
> >> >>                 , print.SSE=T, fit.sills=T, fit.ranges=T )
> >> >>
> >> >>
> >> >> but I never seem to get a good fit, i.e., it always fails to fit the
> >> >> empirical variogram.
> >> >>
> >> >> If anyone has a solution, I also need to calculate the Residual Sums
> >> >> of  Squares to test for the relative fit.
> >> >
> >> > The problem is your starting values for the ranges. Use the values
> >> that
> >> > you
> >> > fit `by eye' from the sample variogram; they should be sufficiently
> >> > distinct
> >> > (and present in the sample variogram) for gstat to fit them with
> >> success.
> >> >
> >> >
> >> > Best regards,
> >> > --
> >> > Edzer
> >>
> >>
> >>
> >> --
> >> Eliot McIntire
> >> NSERC Post Doctoral Fellow
> >> Department of Ecosystems and Conservation Science
> >> College of Forestry and Conservation
> >> University of Montana, Missoula, MT 59812
> >> 406-243-5239
> >> fax: 406-243-4557
> >> emcintire at forestry.umt.edu
> >>
> >> _______________________________________________
> >> R-sig-Geo mailing list
> >> R-sig-Geo at stat.math.ethz.ch
> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >>
> >>
> >
> > Paulo Justiniano Ribeiro Jr
> > Departamento de Estat?stica
> > Universidade Federal do Paran?
> > Caixa Postal 19.081
> > CEP 81.531-990
> > Curitiba, PR  -  Brasil
> > Tel: (+55) 41 361 3573
> > Fax: (+55) 41 361 3141
> > e-mail: paulojus at est.ufpr.br
> > http://www.est.ufpr.br/~paulojus
> >
> >  /"\
> >  \ /  Campanha da fita ASCII - contra mail html
> >   X   ASCII ribbon campaign - against html mail
> >  / \
> >
>
>
>
> --
> Eliot McIntire
> NSERC Post Doctoral Fellow
> Department of Ecosystems and Conservation Science
> College of Forestry and Conservation
> University of Montana, Missoula, MT 59812
> 406-243-5239
> fax: 406-243-4557
> emcintire at forestry.umt.edu
>
>

Paulo Justiniano Ribeiro Jr
Departamento de Estat?stica
Universidade Federal do Paran?
Caixa Postal 19.081
CEP 81.531-990
Curitiba, PR  -  Brasil
Tel: (+55) 41 361 3573
Fax: (+55) 41 361 3141
e-mail: paulojus at est.ufpr.br
http://www.est.ufpr.br/~paulojus

 /"\
 \ /  Campanha da fita ASCII - contra mail html
  X   ASCII ribbon campaign - against html mail
 / \



From HardistF at gwm.sc.edu  Tue Oct 19 16:20:39 2004
From: HardistF at gwm.sc.edu (Frank Hardisty)
Date: Tue, 19 Oct 2004 10:20:39 -0400
Subject: [R-sig-Geo] Recent highlights?
Message-ID: <s174ea84.001@gwm.sc.edu>

Dear R-Geo List Members,

I'm going to the GIScience meeting in Maryland, USA next week and
giving a demonstration on combining spatial statistics in R with
geographic visualization in Java. 

I've been using the spdep (for Moran's I), sp and spgwr packages (for
GWR), so I will mention those.

Are there any other advances in spatial analysis in R that someone
would like me to highlight or mention? 

regards,
-Frank Hardisty

~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Frank Hardisty
Department of Geography
University of South Carolina
hardisty at sc.edu
Office -- 803-777-5729 
Fax -- 803-777-4972
http://www.cla.sc.edu/geog/faculty/hardistf/



From e.pebesma at geog.uu.nl  Wed Oct 20 08:12:25 2004
From: e.pebesma at geog.uu.nl (Edzer J. Pebesma)
Date: Wed, 20 Oct 2004 08:12:25 +0200
Subject: [R-sig-Geo] Recent highlights?
In-Reply-To: <s174ea84.001@gwm.sc.edu>
References: <s174ea84.001@gwm.sc.edu>
Message-ID: <417601C9.2050109@geog.uu.nl>

Frank,

you could get some inspiration from the pages Roger compiled: follow
R home page -> related links -> R spatial projects.

There's a number of packages that link R to GIS, and there are a whole
bunch of packages either dealing with point patterns or with geostatistical
data. One thing we're less active in is image analysis, or did I miss
something?

Best regards,
--
Edzer

Frank Hardisty wrote:

>Dear R-Geo List Members,
>
>I'm going to the GIScience meeting in Maryland, USA next week and
>giving a demonstration on combining spatial statistics in R with
>geographic visualization in Java. 
>
>I've been using the spdep (for Moran's I), sp and spgwr packages (for
>GWR), so I will mention those.
>
>Are there any other advances in spatial analysis in R that someone
>would like me to highlight or mention? 
>
>regards,
>-Frank Hardisty
>
>~~~~~~~~~~~~~~~~~~~~~~~~~~~~
>Frank Hardisty
>Department of Geography
>University of South Carolina
>hardisty at sc.edu
>Office -- 803-777-5729 
>Fax -- 803-777-4972
>http://www.cla.sc.edu/geog/faculty/hardistf/
>
>_______________________________________________
>R-sig-Geo mailing list
>R-sig-Geo at stat.math.ethz.ch
>https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>  
>



From neteler at itc.it  Wed Oct 20 15:00:10 2004
From: neteler at itc.it (Markus Neteler)
Date: Wed, 20 Oct 2004 15:00:10 +0200
Subject: [R-sig-Geo] Recent highlights?
In-Reply-To: <417601C9.2050109@geog.uu.nl>
References: <s174ea84.001@gwm.sc.edu> <417601C9.2050109@geog.uu.nl>
Message-ID: <20041020130010.GC22301@thuille.itc.it>

On Wed, Oct 20, 2004 at 08:12:25AM +0200, Edzer J. Pebesma wrote:
> Frank,
> 
> you could get some inspiration from the pages Roger compiled: follow
> R home page -> related links -> R spatial projects.
> 
> There's a number of packages that link R to GIS, and there are a whole
> bunch of packages either dealing with point patterns or with geostatistical
> data. One thing we're less active in is image analysis, or did I miss
> something?

Edzer,

not sure if this is interesting, as only partially R based:

Here at ITC-irst we are doing multitemporal satellite image analysis
for epidemiology using GRASS and R (and PostgreSQL). Basically 
time series of land surface temperatures from MODIS (Terra and Aqua),
which gives us 4 maps per day (!). The amount of data to process is
in the multi-GB range.

Something is here (working on the pages currently):
http://mpa.itc.it/rs/
       -> MODIS

So, yes, it works well with a high degree of automation.
But it is not a R package of course.

Best regards,

 Markus

-- 
Markus Neteler     <neteler itc it>       http://mpa.itc.it
ITC-irst -  Centro per la Ricerca Scientifica e Tecnologica
MPBA - Predictive Models for Biol. & Environ. Data Analysis
Via Sommarive, 18        -       38050 Povo (Trento), Italy



From hi_ono2001 at yahoo.co.jp  Fri Oct 29 05:25:07 2004
From: hi_ono2001 at yahoo.co.jp (Hisaji ONO)
Date: Fri, 29 Oct 2004 12:25:07 +0900 (JST)
Subject: [R-sig-Geo] About dealing 2-byte code characters(ex. Japanese) in
	new maptools
Message-ID: <20041029032507.29943.qmail@web1702.mail.yahoo.co.jp>

Hello, Professor Bivand.

 Thank you for updating maptools.

 I've tried to use this.

 And I've noticed this couldn't deal with Japanese
Characters, which were included dbase files.


 Former version(0.3-8),

> raildb<-maptools:::dbf.read("/railway.dbf")
> raildb
                                        NAME
1                               ??????
2                               ??????

 In Japanese WinXP environment, these characters were
displayed correctly.


 However latest version(0.4-8),


> raildb<-read.dbf("/railway.dbf",as.is=TRUE)

> raildb$NAME[1:2]
[1] "&#8218;i&#8218;q??&#144;{?&ecirc;&#144;&uuml;"    
   
[2] "&#8218;i&#8218;q??&#144;{?&ecirc;&#144;&uuml;" 

 These aren't Japanese.

 How come?


 Regards.



From Roger.Bivand at nhh.no  Fri Oct 29 09:01:56 2004
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 29 Oct 2004 09:01:56 +0200 (CEST)
Subject: [R-sig-Geo] Re: About dealing 2-byte code characters(ex. Japanese)
	in new maptools
In-Reply-To: <20041029032507.29943.qmail@web1702.mail.yahoo.co.jp>
Message-ID: <Pine.LNX.4.44.0410290841010.30563-100000@reclus.nhh.no>

Dear Hisaji,

A couple of questions before we include Prof. Ripley, who put the 
functions into the foreign package:

Platform: OS version and R version? Did you install from source both 
times? If from source is the build train the same?

Can you help by trying to see what happens if you remove/install maptools, 
looking at http://cran.r-project.org/src/contrib/Archive, install 0.3-8, 
then step through to see whether the change in behaviour happened at the 
0.4-7/0.4-8 border, or maybe earlier (in which case I think it will be me, 
not him who did something). I'm afraid for Windows XP that you need to 
have the full package build train installed, which maybe you have anyway:

http://www.murdoch-sutherland.com/Rtools/

If something has changed in that, 0.3-8 would now give the non-2-byte 
characters.

I can understand that this is important, so I'd like to find out why - my 
first guess would be a change in your operating environment, but if a 
newly installed 0.3-8 on R 2.0.0 gives 2-byte characters on your system, 
then we can work forward and see where the change happened. I did make 
changes in reading character strings about 0.4-5 (Nicholas has hardcoded a 
maximum string length to 50 bytes, and a user file had a very long > 200 
single-byte character string value, so I checked the lengths of the 
strings first and allocated). This is in Rdbfread.c, traces at line about 
152 and about 195 - look in versions 0.4-4 and 0.4-5 to see the 
difference. If 0.4-4 still reads 2-byte, and 0.4-5 doesn't, that's it, and 
we can try to find out how to get the equivalent file in foreign to do the 
same.

Sorry for this inconvenience, but we'll need your help to find out what is 
going on here.

Best wishes,

Roger

On Fri, 29 Oct 2004, Hisaji ONO wrote:

> Hello, Professor Bivand.
> 
>  Thank you for updating maptools.
> 
>  I've tried to use this.
> 
>  And I've noticed this couldn't deal with Japanese
> Characters, which were included dbase files.
> 
> 
>  Former version(0.3-8),
> 
> > raildb<-maptools:::dbf.read("/railway.dbf")
> > raildb
>                                         NAME
> 1                               $B#J#R2#?\2l@~(B
> 2                               $B#J#R2#?\2l@~(B
> 
>  In Japanese WinXP environment, these characters were
> displayed correctly.
> 
> 
>  However latest version(0.4-8),
> 
> 
> > raildb<-read.dbf("/railway.dbf",as.is=TRUE)
> 
> > raildb$NAME[1:2]
> [1] "&#8218;i&#8218;q$B"s!#(B&#144;{$B"s(B&ecirc;&#144;&uuml;"    
>    
> [2] "&#8218;i&#8218;q$B"s!#(B&#144;{$B"s(B&ecirc;&#144;&uuml;" 
> 
>  These aren't Japanese.
> 
>  How come?
> 
> 
>  Regards.
> 
> 
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Breiviksveien 40, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 93 93
e-mail: Roger.Bivand at nhh.no



From stephane.dray at umontreal.ca  Fri Oct 29 18:32:56 2004
From: stephane.dray at umontreal.ca (Stephane DRAY)
Date: Fri, 29 Oct 2004 12:32:56 -0400
Subject: [R-sig-Geo] problems with dnearneigh of spdep
Message-ID: <5.2.1.1.0.20041029122738.00be6ec0@magellan.umontreal.ca>

Hello,
I have some strange results with the dnearneigh function.
I would like to have all points of grid linked. I do something like that:

 > xy=expand.grid(1:10,1:10)
 > mydnn=dnearneigh(as.matrix(xy),d1=0,d2=50)
 > mydnn
Neighbour list object:
Number of regions: 100
Number of nonzero links: 9896
Percentage nonzero weights: 98.96
Average number of links: 98.96
I assume to have 100*100-100=9900 links.

 > m01=nb2mat(mydnn,style="B")
 > apply(m01,1,sum)
   1   2   3   4   5   6   7   8   9  10  11  12  13  14  15  16  17  18 
19  20  21  22  23  24  25  26  27
  98  99  99  99  99  99  99  99  99  98  99  99  99  99  99  99  99  99 
99  99  99  99  99  99  99  99  99
  28  29  30  31  32  33  34  35  36  37  38  39  40  41  42  43  44  45 
46  47  48  49  50  51  52  53  54
  99  99  99  99  99  99  99  99  99  99  99  99  99  99  99  99  99  99 
99  99  99  99  99  99  99  99  99
  55  56  57  58  59  60  61  62  63  64  65  66  67  68  69  70  71  72 
73  74  75  76  77  78  79  80  81
  99  99  99  99  99  99  99  99  99  99  99  99  99  99  99  99  99  99 
99  99  99  99  99  99  99  99  99
  82  83  84  85  86  87  88  89  90  91  92  93  94  95  96  97  98  99 100
  99  99  99  99  99  99  99  99  99  98  99  99  99  99  99  99  99  99  98

It seems that the first and the last points are not linked. I have choose a 
value of d2 very high, and the distance between this two points is only 
sqrt(162)

Any ideas ?
Thanks
St?phane DRAY
-------------------------------------------------------------------------------------------------- 

D?partement des Sciences Biologiques
Universit? de Montr?al, C.P. 6128, succursale centre-ville
Montr?al, Qu?bec H3C 3J7, Canada

Tel : (514) 343-6111 poste 1233         Fax : (514) 343-2293
E-mail : stephane.dray at umontreal.ca
-------------------------------------------------------------------------------------------------- 

Web                                          http://www.steph280.freesurf.fr/



From Roger.Bivand at nhh.no  Fri Oct 29 19:01:55 2004
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 29 Oct 2004 19:01:55 +0200 (CEST)
Subject: [R-sig-Geo] problems with dnearneigh of spdep
In-Reply-To: <5.2.1.1.0.20041029122738.00be6ec0@magellan.umontreal.ca>
Message-ID: <Pine.LNX.4.44.0410291852310.31025-100000@reclus.nhh.no>

On Fri, 29 Oct 2004, Stephane DRAY wrote:

> Hello,
> I have some strange results with the dnearneigh function.
> I would like to have all points of grid linked. I do something like that:
> 
>  > xy=expand.grid(1:10,1:10)
>  > mydnn=dnearneigh(as.matrix(xy),d1=0,d2=50)
>  > mydnn
> Neighbour list object:
> Number of regions: 100
> Number of nonzero links: 9896
> Percentage nonzero weights: 98.96
> Average number of links: 98.96
> I assume to have 100*100-100=9900 links.
> 
>  > m01=nb2mat(mydnn,style="B")
>  > apply(m01,1,sum)
>    1   2   3   4   5   6   7   8   9  10  11  12  13  14  15  16  17  18 
> 19  20  21  22  23  24  25  26  27
>   98  99  99  99  99  99  99  99  99  98  99  99  99  99  99  99  99  99 
> 99  99  99  99  99  99  99  99  99
>   28  29  30  31  32  33  34  35  36  37  38  39  40  41  42  43  44  45 
> 46  47  48  49  50  51  52  53  54
>   99  99  99  99  99  99  99  99  99  99  99  99  99  99  99  99  99  99 
> 99  99  99  99  99  99  99  99  99
>   55  56  57  58  59  60  61  62  63  64  65  66  67  68  69  70  71  72 
> 73  74  75  76  77  78  79  80  81
>   99  99  99  99  99  99  99  99  99  99  99  99  99  99  99  99  99  99 
> 99  99  99  99  99  99  99  99  99
>   82  83  84  85  86  87  88  89  90  91  92  93  94  95  96  97  98  99 100
>   99  99  99  99  99  99  99  99  99  98  99  99  99  99  99  99  99  99  98
> 
> It seems that the first and the last points are not linked. I have choose a 
> value of d2 very high, and the distance between this two points is only 
> sqrt(162)

I can't replicate this:

> version
         _                
platform i686-pc-linux-gnu
arch     i686             
os       linux-gnu        
system   i686, linux-gnu  
status                    
major    2                
minor    0.0              
year     2004             
month    10               
day      04               
language R                
> library(spdep)
> spdep()
[1] "spdep, version 0.2-22, 2004-08-07"
> xy=expand.grid(1:10,1:10)
> mydnn=dnearneigh(as.matrix(xy),d1=0,d2=50)
> mydnn
Neighbour list object:
Number of regions: 100 
Number of nonzero links: 9900 
Percentage nonzero weights: 99 
Average number of links: 99 

The line "Number of nonzero links:" is calculated as:

> sum(card(mydnn))
[1] 9900

You can also look at:

> all(sapply(mydnn, length) == 99)
[1] TRUE
> which(sapply(mydnn, length) != 99)
numeric(0)

if you want to be sure it isn't card() getting it wrong. Puzzling. I don't 
think any of the relevant code has changed since September 2003.

Roger

> 
> Any ideas ?
> Thanks
> St?phane DRAY
> -------------------------------------------------------------------------------------------------- 
> 
> D?partement des Sciences Biologiques
> Universit? de Montr?al, C.P. 6128, succursale centre-ville
> Montr?al, Qu?bec H3C 3J7, Canada
> 
> Tel : (514) 343-6111 poste 1233         Fax : (514) 343-2293
> E-mail : stephane.dray at umontreal.ca
> -------------------------------------------------------------------------------------------------- 
> 
> Web                                          http://www.steph280.freesurf.fr/
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Breiviksveien 40, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 93 93
e-mail: Roger.Bivand at nhh.no



From stephane.dray at umontreal.ca  Fri Oct 29 19:39:46 2004
From: stephane.dray at umontreal.ca (Stephane DRAY)
Date: Fri, 29 Oct 2004 13:39:46 -0400
Subject: [R-sig-Geo] problems with dnearneigh of spdep
In-Reply-To: <Pine.LNX.4.44.0410291852310.31025-100000@reclus.nhh.no>
References: <5.2.1.1.0.20041029122738.00be6ec0@magellan.umontreal.ca>
Message-ID: <5.2.1.1.0.20041029133056.03d44bb0@biomserv.univ-lyon1.fr>

My version :

 > version
          _
platform i386-pc-mingw32
arch     i386
os       mingw32
system   i386, mingw32
status
major    1
minor    9.1
year     2004
month    06
day      21
language R
 > spdep()
[1] "spdep, version 0.2-18, 2004-05-25"
 > sum(card(mydnn))
[1] 9896
 > all(sapply(mydnn, length) == 99)
[1] FALSE

It is not the last one, I will try to update later. I think that the 
problem is in the calculation of neighbors. Perhaps, the fortran code has 
changed. I do not have the sources, so  I could not verify.

Thanks !



At 13:01 29/10/2004, Roger Bivand wrote:
>On Fri, 29 Oct 2004, Stephane DRAY wrote:
>
> > Hello,
> > I have some strange results with the dnearneigh function.
> > I would like to have all points of grid linked. I do something like that:
> >
> >  > xy=expand.grid(1:10,1:10)
> >  > mydnn=dnearneigh(as.matrix(xy),d1=0,d2=50)
> >  > mydnn
> > Neighbour list object:
> > Number of regions: 100
> > Number of nonzero links: 9896
> > Percentage nonzero weights: 98.96
> > Average number of links: 98.96
> > I assume to have 100*100-100=9900 links.
> >
> >  > m01=nb2mat(mydnn,style="B")
> >  > apply(m01,1,sum)
> >    1   2   3   4   5   6   7   8   9  10  11  12  13  14  15  16  17  18
> > 19  20  21  22  23  24  25  26  27
> >   98  99  99  99  99  99  99  99  99  98  99  99  99  99  99  99  99  99
> > 99  99  99  99  99  99  99  99  99
> >   28  29  30  31  32  33  34  35  36  37  38  39  40  41  42  43  44  45
> > 46  47  48  49  50  51  52  53  54
> >   99  99  99  99  99  99  99  99  99  99  99  99  99  99  99  99  99  99
> > 99  99  99  99  99  99  99  99  99
> >   55  56  57  58  59  60  61  62  63  64  65  66  67  68  69  70  71  72
> > 73  74  75  76  77  78  79  80  81
> >   99  99  99  99  99  99  99  99  99  99  99  99  99  99  99  99  99  99
> > 99  99  99  99  99  99  99  99  99
> >   82  83  84  85  86  87  88  89  90  91  92  93  94  95  96  97  98 
> 99 100
> >   99  99  99  99  99  99  99  99  99  98  99  99  99  99  99  99  99 
> 99  98
> >
> > It seems that the first and the last points are not linked. I have 
> choose a
> > value of d2 very high, and the distance between this two points is only
> > sqrt(162)
>
>I can't replicate this:
>
> > version
>          _
>platform i686-pc-linux-gnu
>arch     i686
>os       linux-gnu
>system   i686, linux-gnu
>status
>major    2
>minor    0.0
>year     2004
>month    10
>day      04
>language R
> > library(spdep)
> > spdep()
>[1] "spdep, version 0.2-22, 2004-08-07"
> > xy=expand.grid(1:10,1:10)
> > mydnn=dnearneigh(as.matrix(xy),d1=0,d2=50)
> > mydnn
>Neighbour list object:
>Number of regions: 100
>Number of nonzero links: 9900
>Percentage nonzero weights: 99
>Average number of links: 99
>
>The line "Number of nonzero links:" is calculated as:
>
> > sum(card(mydnn))
>[1] 9900
>
>You can also look at:
>
> > all(sapply(mydnn, length) == 99)
>[1] TRUE
> > which(sapply(mydnn, length) != 99)
>numeric(0)
>
>if you want to be sure it isn't card() getting it wrong. Puzzling. I don't
>think any of the relevant code has changed since September 2003.
>
>Roger
>
> >
> > Any ideas ?
> > Thanks
> > St?phane DRAY
> > 
> -------------------------------------------------------------------------------------------------- 
>
> >
> > D?partement des Sciences Biologiques
> > Universit? de Montr?al, C.P. 6128, succursale centre-ville
> > Montr?al, Qu?bec H3C 3J7, Canada
> >
> > Tel : (514) 343-6111 poste 1233         Fax : (514) 343-2293
> > E-mail : stephane.dray at umontreal.ca
> > 
> -------------------------------------------------------------------------------------------------- 
>
> >
> > 
> Web                                          http://www.steph280.freesurf.fr/
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at stat.math.ethz.ch
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
>
>--
>Roger Bivand
>Economic Geography Section, Department of Economics, Norwegian School of
>Economics and Business Administration, Breiviksveien 40, N-5045 Bergen,
>Norway. voice: +47 55 95 93 55; fax +47 55 95 93 93
>e-mail: Roger.Bivand at nhh.no
>
>_______________________________________________
>R-sig-Geo mailing list
>R-sig-Geo at stat.math.ethz.ch
>https://stat.ethz.ch/mailman/listinfo/r-sig-geo

St?phane DRAY
-------------------------------------------------------------------------------------------------- 

D?partement des Sciences Biologiques
Universit? de Montr?al, C.P. 6128, succursale centre-ville
Montr?al, Qu?bec H3C 3J7, Canada

Tel : (514) 343-6111 poste 1233         Fax : (514) 343-2293
E-mail : stephane.dray at umontreal.ca
-------------------------------------------------------------------------------------------------- 

Web                                          http://www.steph280.freesurf.fr/



From Roger.Bivand at nhh.no  Fri Oct 29 19:47:47 2004
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 29 Oct 2004 19:47:47 +0200 (CEST)
Subject: [R-sig-Geo] problems with dnearneigh of spdep
In-Reply-To: <5.2.1.1.0.20041029133056.03d44bb0@biomserv.univ-lyon1.fr>
Message-ID: <Pine.LNX.4.44.0410291946220.31073-100000@reclus.nhh.no>

On Fri, 29 Oct 2004, Stephane DRAY wrote:

> My version :
> 
>  > version
>           _
> platform i386-pc-mingw32
> arch     i386
> os       mingw32
> system   i386, mingw32
> status
> major    1
> minor    9.1
> year     2004
> month    06
> day      21
> language R
>  > spdep()
> [1] "spdep, version 0.2-18, 2004-05-25"
>  > sum(card(mydnn))
> [1] 9896
>  > all(sapply(mydnn, length) == 99)
> [1] FALSE

I can replicate on Windows, R 1.9.1, spdep 0.2-18. I'll report back on R 
2.0.0, spdep 0.2-22 in a little while.

Roger

> 
> It is not the last one, I will try to update later. I think that the 
> problem is in the calculation of neighbors. Perhaps, the fortran code has 
> changed. I do not have the sources, so  I could not verify.
> 
> Thanks !
> 
> 
> 
> At 13:01 29/10/2004, Roger Bivand wrote:
> >On Fri, 29 Oct 2004, Stephane DRAY wrote:
> >
> > > Hello,
> > > I have some strange results with the dnearneigh function.
> > > I would like to have all points of grid linked. I do something like that:
> > >
> > >  > xy=expand.grid(1:10,1:10)
> > >  > mydnn=dnearneigh(as.matrix(xy),d1=0,d2=50)
> > >  > mydnn
> > > Neighbour list object:
> > > Number of regions: 100
> > > Number of nonzero links: 9896
> > > Percentage nonzero weights: 98.96
> > > Average number of links: 98.96
> > > I assume to have 100*100-100=9900 links.
> > >
> > >  > m01=nb2mat(mydnn,style="B")
> > >  > apply(m01,1,sum)
> > >    1   2   3   4   5   6   7   8   9  10  11  12  13  14  15  16  17  18
> > > 19  20  21  22  23  24  25  26  27
> > >   98  99  99  99  99  99  99  99  99  98  99  99  99  99  99  99  99  99
> > > 99  99  99  99  99  99  99  99  99
> > >   28  29  30  31  32  33  34  35  36  37  38  39  40  41  42  43  44  45
> > > 46  47  48  49  50  51  52  53  54
> > >   99  99  99  99  99  99  99  99  99  99  99  99  99  99  99  99  99  99
> > > 99  99  99  99  99  99  99  99  99
> > >   55  56  57  58  59  60  61  62  63  64  65  66  67  68  69  70  71  72
> > > 73  74  75  76  77  78  79  80  81
> > >   99  99  99  99  99  99  99  99  99  99  99  99  99  99  99  99  99  99
> > > 99  99  99  99  99  99  99  99  99
> > >   82  83  84  85  86  87  88  89  90  91  92  93  94  95  96  97  98 
> > 99 100
> > >   99  99  99  99  99  99  99  99  99  98  99  99  99  99  99  99  99 
> > 99  98
> > >
> > > It seems that the first and the last points are not linked. I have 
> > choose a
> > > value of d2 very high, and the distance between this two points is only
> > > sqrt(162)
> >
> >I can't replicate this:
> >
> > > version
> >          _
> >platform i686-pc-linux-gnu
> >arch     i686
> >os       linux-gnu
> >system   i686, linux-gnu
> >status
> >major    2
> >minor    0.0
> >year     2004
> >month    10
> >day      04
> >language R
> > > library(spdep)
> > > spdep()
> >[1] "spdep, version 0.2-22, 2004-08-07"
> > > xy=expand.grid(1:10,1:10)
> > > mydnn=dnearneigh(as.matrix(xy),d1=0,d2=50)
> > > mydnn
> >Neighbour list object:
> >Number of regions: 100
> >Number of nonzero links: 9900
> >Percentage nonzero weights: 99
> >Average number of links: 99
> >
> >The line "Number of nonzero links:" is calculated as:
> >
> > > sum(card(mydnn))
> >[1] 9900
> >
> >You can also look at:
> >
> > > all(sapply(mydnn, length) == 99)
> >[1] TRUE
> > > which(sapply(mydnn, length) != 99)
> >numeric(0)
> >
> >if you want to be sure it isn't card() getting it wrong. Puzzling. I don't
> >think any of the relevant code has changed since September 2003.
> >
> >Roger
> >
> > >
> > > Any ideas ?
> > > Thanks
> > > St?phane DRAY
> > > 
> > -------------------------------------------------------------------------------------------------- 
> >
> > >
> > > D?partement des Sciences Biologiques
> > > Universit? de Montr?al, C.P. 6128, succursale centre-ville
> > > Montr?al, Qu?bec H3C 3J7, Canada
> > >
> > > Tel : (514) 343-6111 poste 1233         Fax : (514) 343-2293
> > > E-mail : stephane.dray at umontreal.ca
> > > 
> > -------------------------------------------------------------------------------------------------- 
> >
> > >
> > > 
> > Web                                          http://www.steph280.freesurf.fr/
> > >
> > > _______________________________________________
> > > R-sig-Geo mailing list
> > > R-sig-Geo at stat.math.ethz.ch
> > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > >
> >
> >--
> >Roger Bivand
> >Economic Geography Section, Department of Economics, Norwegian School of
> >Economics and Business Administration, Breiviksveien 40, N-5045 Bergen,
> >Norway. voice: +47 55 95 93 55; fax +47 55 95 93 93
> >e-mail: Roger.Bivand at nhh.no
> >
> >_______________________________________________
> >R-sig-Geo mailing list
> >R-sig-Geo at stat.math.ethz.ch
> >https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 
> St?phane DRAY
> -------------------------------------------------------------------------------------------------- 
> 
> D?partement des Sciences Biologiques
> Universit? de Montr?al, C.P. 6128, succursale centre-ville
> Montr?al, Qu?bec H3C 3J7, Canada
> 
> Tel : (514) 343-6111 poste 1233         Fax : (514) 343-2293
> E-mail : stephane.dray at umontreal.ca
> -------------------------------------------------------------------------------------------------- 
> 
> Web                                          http://www.steph280.freesurf.fr/
> -------------------------------------------------------------------------------------------------- 
> 
> 
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Breiviksveien 40, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 93 93
e-mail: Roger.Bivand at nhh.no



From Roger.Bivand at nhh.no  Sat Oct 30 09:12:25 2004
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sat, 30 Oct 2004 09:12:25 +0200 (CEST)
Subject: [R-sig-Geo] problems with dnearneigh of spdep
In-Reply-To: <Pine.LNX.4.44.0410291946220.31073-100000@reclus.nhh.no>
Message-ID: <Pine.LNX.4.44.0410300909500.31778-100000@reclus.nhh.no>

On Fri, 29 Oct 2004, Roger Bivand wrote:

> On Fri, 29 Oct 2004, Stephane DRAY wrote:
> 
> > My version :
> > 
> >  > version
> >           _
> > platform i386-pc-mingw32
> > arch     i386
> > os       mingw32
> > system   i386, mingw32
> > status
> > major    1
> > minor    9.1
> > year     2004
> > month    06
> > day      21
> > language R
> >  > spdep()
> > [1] "spdep, version 0.2-18, 2004-05-25"
> >  > sum(card(mydnn))
> > [1] 9896
> >  > all(sapply(mydnn, length) == 99)
> > [1] FALSE
> 
> I can replicate on Windows, R 1.9.1, spdep 0.2-18. I'll report back on R 
> 2.0.0, spdep 0.2-22 in a little while.

It also replicates with fresh binaries on:

> spdep()
[1] "spdep, version 0.2-22, 2004-08-07"
> version
         _              
platform i386-pc-mingw32
arch     i386           
os       mingw32        
system   i386, mingw32  
status                  
major    2              
minor    0.0            
year     2004           
month    10             
day      04             
language R       
> mydnn
Neighbour list object:
Number of regions: 100 
Number of nonzero links: 9896 
Percentage nonzero weights: 98.96 
Average number of links: 98.96 

I'll look and see what is going on, thanks for the bug report.

Roger

> 
> Roger
> 
> > 
> > It is not the last one, I will try to update later. I think that the 
> > problem is in the calculation of neighbors. Perhaps, the fortran code has 
> > changed. I do not have the sources, so  I could not verify.
> > 
> > Thanks !
> > 
> > 
> > 
> > At 13:01 29/10/2004, Roger Bivand wrote:
> > >On Fri, 29 Oct 2004, Stephane DRAY wrote:
> > >
> > > > Hello,
> > > > I have some strange results with the dnearneigh function.
> > > > I would like to have all points of grid linked. I do something like that:
> > > >
> > > >  > xy=expand.grid(1:10,1:10)
> > > >  > mydnn=dnearneigh(as.matrix(xy),d1=0,d2=50)
> > > >  > mydnn
> > > > Neighbour list object:
> > > > Number of regions: 100
> > > > Number of nonzero links: 9896
> > > > Percentage nonzero weights: 98.96
> > > > Average number of links: 98.96
> > > > I assume to have 100*100-100=9900 links.
> > > >
> > > >  > m01=nb2mat(mydnn,style="B")
> > > >  > apply(m01,1,sum)
> > > >    1   2   3   4   5   6   7   8   9  10  11  12  13  14  15  16  17  18
> > > > 19  20  21  22  23  24  25  26  27
> > > >   98  99  99  99  99  99  99  99  99  98  99  99  99  99  99  99  99  99
> > > > 99  99  99  99  99  99  99  99  99
> > > >   28  29  30  31  32  33  34  35  36  37  38  39  40  41  42  43  44  45
> > > > 46  47  48  49  50  51  52  53  54
> > > >   99  99  99  99  99  99  99  99  99  99  99  99  99  99  99  99  99  99
> > > > 99  99  99  99  99  99  99  99  99
> > > >   55  56  57  58  59  60  61  62  63  64  65  66  67  68  69  70  71  72
> > > > 73  74  75  76  77  78  79  80  81
> > > >   99  99  99  99  99  99  99  99  99  99  99  99  99  99  99  99  99  99
> > > > 99  99  99  99  99  99  99  99  99
> > > >   82  83  84  85  86  87  88  89  90  91  92  93  94  95  96  97  98 
> > > 99 100
> > > >   99  99  99  99  99  99  99  99  99  98  99  99  99  99  99  99  99 
> > > 99  98
> > > >
> > > > It seems that the first and the last points are not linked. I have 
> > > choose a
> > > > value of d2 very high, and the distance between this two points is only
> > > > sqrt(162)
> > >
> > >I can't replicate this:
> > >
> > > > version
> > >          _
> > >platform i686-pc-linux-gnu
> > >arch     i686
> > >os       linux-gnu
> > >system   i686, linux-gnu
> > >status
> > >major    2
> > >minor    0.0
> > >year     2004
> > >month    10
> > >day      04
> > >language R
> > > > library(spdep)
> > > > spdep()
> > >[1] "spdep, version 0.2-22, 2004-08-07"
> > > > xy=expand.grid(1:10,1:10)
> > > > mydnn=dnearneigh(as.matrix(xy),d1=0,d2=50)
> > > > mydnn
> > >Neighbour list object:
> > >Number of regions: 100
> > >Number of nonzero links: 9900
> > >Percentage nonzero weights: 99
> > >Average number of links: 99
> > >
> > >The line "Number of nonzero links:" is calculated as:
> > >
> > > > sum(card(mydnn))
> > >[1] 9900
> > >
> > >You can also look at:
> > >
> > > > all(sapply(mydnn, length) == 99)
> > >[1] TRUE
> > > > which(sapply(mydnn, length) != 99)
> > >numeric(0)
> > >
> > >if you want to be sure it isn't card() getting it wrong. Puzzling. I don't
> > >think any of the relevant code has changed since September 2003.
> > >
> > >Roger
> > >
> > > >
> > > > Any ideas ?
> > > > Thanks
> > > > St?phane DRAY
> > > > 
> > > -------------------------------------------------------------------------------------------------- 
> > >
> > > >
> > > > D?partement des Sciences Biologiques
> > > > Universit? de Montr?al, C.P. 6128, succursale centre-ville
> > > > Montr?al, Qu?bec H3C 3J7, Canada
> > > >
> > > > Tel : (514) 343-6111 poste 1233         Fax : (514) 343-2293
> > > > E-mail : stephane.dray at umontreal.ca
> > > > 
> > > -------------------------------------------------------------------------------------------------- 
> > >
> > > >
> > > > 
> > > Web                                          http://www.steph280.freesurf.fr/
> > > >
> > > > _______________________________________________
> > > > R-sig-Geo mailing list
> > > > R-sig-Geo at stat.math.ethz.ch
> > > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > > >
> > >
> > >--
> > >Roger Bivand
> > >Economic Geography Section, Department of Economics, Norwegian School of
> > >Economics and Business Administration, Breiviksveien 40, N-5045 Bergen,
> > >Norway. voice: +47 55 95 93 55; fax +47 55 95 93 93
> > >e-mail: Roger.Bivand at nhh.no
> > >
> > >_______________________________________________
> > >R-sig-Geo mailing list
> > >R-sig-Geo at stat.math.ethz.ch
> > >https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > 
> > St?phane DRAY
> > -------------------------------------------------------------------------------------------------- 
> > 
> > D?partement des Sciences Biologiques
> > Universit? de Montr?al, C.P. 6128, succursale centre-ville
> > Montr?al, Qu?bec H3C 3J7, Canada
> > 
> > Tel : (514) 343-6111 poste 1233         Fax : (514) 343-2293
> > E-mail : stephane.dray at umontreal.ca
> > -------------------------------------------------------------------------------------------------- 
> > 
> > Web                                          http://www.steph280.freesurf.fr/
> > -------------------------------------------------------------------------------------------------- 
> > 
> > 
> > 
> 
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Breiviksveien 40, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 93 93
e-mail: Roger.Bivand at nhh.no



From Roger.Bivand at nhh.no  Sat Oct 30 12:53:16 2004
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sat, 30 Oct 2004 12:53:16 +0200 (CEST)
Subject: [R-sig-Geo] problems with dnearneigh of spdep
In-Reply-To: <Pine.LNX.4.44.0410300909500.31778-100000@reclus.nhh.no>
Message-ID: <Pine.LNX.4.44.0410301234580.31836-100000@reclus.nhh.no>

St?phane:

A test new release source package is on:

http://spatial.nhh.no/R/spdep/spdep_0.2-23.tar.gz

and a test Windows binary package built for R 2.0.0:

http://spatial.nhh.no/R/spdep/spdep_0.2-23.zip

If you are on R < 2.0.0 and need to carry on using the Windows binary 
package you have, please edit the dnearneigh() function as follows:

    if (!lonlat) {
	for (i in 1:dimension) md <- sum(md, (diff(range(x[,i]))^2))
    	if (d2 > sqrt(md)) d2 <- sqrt(md)
    }

to:

    if (!lonlat) {
	for (i in 1:dimension) md <- sum(md, (diff(range(x[,i]))^2))
	md <- md + sqrt(.Machine$double.eps)
    	if (d2 > sqrt(md)) d2 <- sqrt(md)
    }

The additional line adds "fuzz" to the "sane" maximum distance to let 
tests of dist <= d2 pass when they are equal - I think some truncation 
beyond reasonable numerical precision is what is going on, and this sanity 
test for unreasonable distances then goes wrong. I've tried up to 40x40 
grids on i386 Linux and i386 Windows, now all numbers agree.

Please let me know if this fixed the problem for you,

Roger

On Sat, 30 Oct 2004, Roger Bivand wrote:

> On Fri, 29 Oct 2004, Roger Bivand wrote:
> 
> > On Fri, 29 Oct 2004, Stephane DRAY wrote:
> > 
> > > My version :
> > > 
> > >  > version
> > >           _
> > > platform i386-pc-mingw32
> > > arch     i386
> > > os       mingw32
> > > system   i386, mingw32
> > > status
> > > major    1
> > > minor    9.1
> > > year     2004
> > > month    06
> > > day      21
> > > language R
> > >  > spdep()
> > > [1] "spdep, version 0.2-18, 2004-05-25"
> > >  > sum(card(mydnn))
> > > [1] 9896
> > >  > all(sapply(mydnn, length) == 99)
> > > [1] FALSE
> > 
> > I can replicate on Windows, R 1.9.1, spdep 0.2-18. I'll report back on R 
> > 2.0.0, spdep 0.2-22 in a little while.
> 
> It also replicates with fresh binaries on:
> 
> > spdep()
> [1] "spdep, version 0.2-22, 2004-08-07"
> > version
>          _              
> platform i386-pc-mingw32
> arch     i386           
> os       mingw32        
> system   i386, mingw32  
> status                  
> major    2              
> minor    0.0            
> year     2004           
> month    10             
> day      04             
> language R       
> > mydnn
> Neighbour list object:
> Number of regions: 100 
> Number of nonzero links: 9896 
> Percentage nonzero weights: 98.96 
> Average number of links: 98.96 
> 
> I'll look and see what is going on, thanks for the bug report.
> 
> Roger
> 
> > 
> > Roger
> > 
> > > 
> > > It is not the last one, I will try to update later. I think that the 
> > > problem is in the calculation of neighbors. Perhaps, the fortran code has 
> > > changed. I do not have the sources, so  I could not verify.
> > > 
> > > Thanks !
> > > 
> > > 
> > > 
> > > At 13:01 29/10/2004, Roger Bivand wrote:
> > > >On Fri, 29 Oct 2004, Stephane DRAY wrote:
> > > >
> > > > > Hello,
> > > > > I have some strange results with the dnearneigh function.
> > > > > I would like to have all points of grid linked. I do something like that:
> > > > >
> > > > >  > xy=expand.grid(1:10,1:10)
> > > > >  > mydnn=dnearneigh(as.matrix(xy),d1=0,d2=50)
> > > > >  > mydnn
> > > > > Neighbour list object:
> > > > > Number of regions: 100
> > > > > Number of nonzero links: 9896
> > > > > Percentage nonzero weights: 98.96
> > > > > Average number of links: 98.96
> > > > > I assume to have 100*100-100=9900 links.
> > > > >
> > > > >  > m01=nb2mat(mydnn,style="B")
> > > > >  > apply(m01,1,sum)
> > > > >    1   2   3   4   5   6   7   8   9  10  11  12  13  14  15  16  17  18
> > > > > 19  20  21  22  23  24  25  26  27
> > > > >   98  99  99  99  99  99  99  99  99  98  99  99  99  99  99  99  99  99
> > > > > 99  99  99  99  99  99  99  99  99
> > > > >   28  29  30  31  32  33  34  35  36  37  38  39  40  41  42  43  44  45
> > > > > 46  47  48  49  50  51  52  53  54
> > > > >   99  99  99  99  99  99  99  99  99  99  99  99  99  99  99  99  99  99
> > > > > 99  99  99  99  99  99  99  99  99
> > > > >   55  56  57  58  59  60  61  62  63  64  65  66  67  68  69  70  71  72
> > > > > 73  74  75  76  77  78  79  80  81
> > > > >   99  99  99  99  99  99  99  99  99  99  99  99  99  99  99  99  99  99
> > > > > 99  99  99  99  99  99  99  99  99
> > > > >   82  83  84  85  86  87  88  89  90  91  92  93  94  95  96  97  98 
> > > > 99 100
> > > > >   99  99  99  99  99  99  99  99  99  98  99  99  99  99  99  99  99 
> > > > 99  98
> > > > >
> > > > > It seems that the first and the last points are not linked. I have 
> > > > choose a
> > > > > value of d2 very high, and the distance between this two points is only
> > > > > sqrt(162)
> > > >
> > > >I can't replicate this:
> > > >
> > > > > version
> > > >          _
> > > >platform i686-pc-linux-gnu
> > > >arch     i686
> > > >os       linux-gnu
> > > >system   i686, linux-gnu
> > > >status
> > > >major    2
> > > >minor    0.0
> > > >year     2004
> > > >month    10
> > > >day      04
> > > >language R
> > > > > library(spdep)
> > > > > spdep()
> > > >[1] "spdep, version 0.2-22, 2004-08-07"
> > > > > xy=expand.grid(1:10,1:10)
> > > > > mydnn=dnearneigh(as.matrix(xy),d1=0,d2=50)
> > > > > mydnn
> > > >Neighbour list object:
> > > >Number of regions: 100
> > > >Number of nonzero links: 9900
> > > >Percentage nonzero weights: 99
> > > >Average number of links: 99
> > > >
> > > >The line "Number of nonzero links:" is calculated as:
> > > >
> > > > > sum(card(mydnn))
> > > >[1] 9900
> > > >
> > > >You can also look at:
> > > >
> > > > > all(sapply(mydnn, length) == 99)
> > > >[1] TRUE
> > > > > which(sapply(mydnn, length) != 99)
> > > >numeric(0)
> > > >
> > > >if you want to be sure it isn't card() getting it wrong. Puzzling. I don't
> > > >think any of the relevant code has changed since September 2003.
> > > >
> > > >Roger
> > > >
> > > > >
> > > > > Any ideas ?
> > > > > Thanks
> > > > > St?phane DRAY
> > > > > 
> > > > -------------------------------------------------------------------------------------------------- 
> > > >
> > > > >
> > > > > D?partement des Sciences Biologiques
> > > > > Universit? de Montr?al, C.P. 6128, succursale centre-ville
> > > > > Montr?al, Qu?bec H3C 3J7, Canada
> > > > >
> > > > > Tel : (514) 343-6111 poste 1233         Fax : (514) 343-2293
> > > > > E-mail : stephane.dray at umontreal.ca
> > > > > 
> > > > -------------------------------------------------------------------------------------------------- 
> > > >
> > > > >
> > > > > 
> > > > Web                                          http://www.steph280.freesurf.fr/
> > > > >
> > > > > _______________________________________________
> > > > > R-sig-Geo mailing list
> > > > > R-sig-Geo at stat.math.ethz.ch
> > > > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > > > >
> > > >
> > > >--
> > > >Roger Bivand
> > > >Economic Geography Section, Department of Economics, Norwegian School of
> > > >Economics and Business Administration, Breiviksveien 40, N-5045 Bergen,
> > > >Norway. voice: +47 55 95 93 55; fax +47 55 95 93 93
> > > >e-mail: Roger.Bivand at nhh.no
> > > >
> > > >_______________________________________________
> > > >R-sig-Geo mailing list
> > > >R-sig-Geo at stat.math.ethz.ch
> > > >https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > > 
> > > St?phane DRAY
> > > -------------------------------------------------------------------------------------------------- 
> > > 
> > > D?partement des Sciences Biologiques
> > > Universit? de Montr?al, C.P. 6128, succursale centre-ville
> > > Montr?al, Qu?bec H3C 3J7, Canada
> > > 
> > > Tel : (514) 343-6111 poste 1233         Fax : (514) 343-2293
> > > E-mail : stephane.dray at umontreal.ca
> > > -------------------------------------------------------------------------------------------------- 
> > > 
> > > Web                                          http://www.steph280.freesurf.fr/
> > > -------------------------------------------------------------------------------------------------- 
> > > 
> > > 
> > > 
> > 
> > 
> 
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Breiviksveien 40, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 93 93
e-mail: Roger.Bivand at nhh.no



