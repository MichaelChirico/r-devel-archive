From Alexander.Herr at csiro.au  Wed Feb  1 06:43:00 2006
From: Alexander.Herr at csiro.au (Alexander.Herr at csiro.au)
Date: Wed, 1 Feb 2006 15:43:00 +1000
Subject: [R-sig-Geo] ?Plotting line segments of shapefile in different color
Message-ID: <062AE320EF971E40ACD0F6C93391D7697E1AB9@exqld1-tsv.nexus.csiro.au>

Hi List,

I am unsuccessfully trying to plot line segments of a shapefile with
different colors. Does anyone have a working example for segmented
lines?

Thanks
Herry



From Roger.Bivand at nhh.no  Wed Feb  1 08:36:25 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 1 Feb 2006 08:36:25 +0100 (CET)
Subject: [R-sig-Geo] ?Plotting line segments of shapefile in different
 color
In-Reply-To: <062AE320EF971E40ACD0F6C93391D7697E1AB9@exqld1-tsv.nexus.csiro.au>
Message-ID: <Pine.LNX.4.44.0602010821010.5933-100000@reclus.nhh.no>

On Wed, 1 Feb 2006 Alexander.Herr at csiro.au wrote:

> Hi List,
> 
> I am unsuccessfully trying to plot line segments of a shapefile with
> different colors. Does anyone have a working example for segmented
> lines?

If each line to be coloured is a separate Lines object:

library(maptools)
fn <- system.file("shapes/fylk-val.shp", package="maptools")[1]
xx <- readShapeLines(fn, proj4string=CRS("+proj=utm +zone=33 +datum=WGS84"))
plot(xx, col="blue") # all one colour
length(slot(xx, "lines")) # 97
plot(xx, col=colorRampPalette(c("green", "blue", "black"))(97))
length(colorRampPalette(c("green", "blue", "black"))(97)) # 97 colours

The col= argument is used if it is the same length as the number of 
lines; if the lengths differ, the first colour value is used for all 
lines.

If the shapes are not organised as separate Lines objects, then they will 
need to be cut up and re-created as such.

Roger


> 
> Thanks
> Herry
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From horacio at unm.edu  Wed Feb  1 11:03:54 2006
From: horacio at unm.edu (A Horacio Samaniego)
Date: Wed, 1 Feb 2006 03:03:54 -0700 (MST)
Subject: [R-sig-Geo] how to go from SpatialGrid to SpatialGridDataFrame ?
Message-ID: <Pine.LNX.4.62.0602010302430.13284@egor.unm.edu>


I wonder how I should go from a SpatialGrid to a SpatialGridDataFrame.

I have defined a grid using the functions from the sp, gstat and spgrass6 
packages:

G<-gmeta6()
kk<-SpatialGrid(GridTopology(c(G$south,G$west),c(G$nsres,G$ewres),c(G$rows,G$cols)),alb.proj)
> str(kk)
Formal class 'SpatialGrid' [package "sp"] with 5 slots
   ..@ grid       :Formal class 'GridTopology' [package "sp"] with 3 slots
   .. .. ..@ cellcentre.offset: num [1:2] -1333373 -2356259
   .. .. ..@ cellsize         : num [1:2] 1000 1000
   .. .. ..@ cells.dim        : int [1:2] 2899 4615
   ..@ grid.index : int(0)
   ..@ coords     : num [1:2, 1:2] -1333373  1564162 -2356259  2257928
   .. ..- attr(*, "dimnames")=List of 2
   .. .. ..$ : NULL
   .. .. ..$ : chr [1:2] "coords.x1" "coords.x2"
   ..@ bbox       : num [1:2, 1:2] -1333872 -2356759  1564662  2258428
   .. ..- attr(*, "dimnames")=List of 2
   .. .. ..$ : chr [1:2] "coords.x1" "coords.x2"
   .. .. ..$ : chr [1:2] "min" "max"
   ..@ proj4string:Formal class 'CRS' [package "sp"] with 1 slots
   .. .. ..@ projargs: chr "+proj=aea +lat_1=29.75 +lat_2=45.25 +lat_0=37.5 
+lon_0=-96 +x_0=0 +y_0=0 +no_defs +a=6378137 +rf=298.257222101 
+towgs84=0.000,0"| __truncated__

Now I try to interpolate on that grid, with no success:
interp.vals<-idw(var1~1,data,newdata=kk)
Error in idw(corrext ~ 1, data = data.new_alb[gd.glm, ], newdata = 
data.grd) :
 	no direct or inherited method for function 'idw' for this call

So, I guess that I need to have a 'SpatialGridDataFrame' instead of just 
'SpatialGrid' as the interpolation needs to be assigned to a spatial 
location

kk2<-as(kk,'SpatialGridDataFrame');
Formal class 'SpatialGridDataFrame' [package "sp"] with 6 slots
   ..@ data       :Formal class 'AttributeList' [package "sp"] with 1 slots
   .. .. ..@ att: list()
   ..@ grid       :Formal class 'GridTopology' [package "sp"] with 3 slots
   .. .. ..@ cellcentre.offset: num [1:2] -1333373 -2356259
   .. .. ..@ cellsize         : num [1:2] 1000 1000
   .. .. ..@ cells.dim        : int [1:2] 2899 4615
   ..@ grid.index : int(0)
   ..@ coords     : num [1:2, 1:2] -1333373  1564162 -2356259  2257928
   .. ..- attr(*, "dimnames")=List of 2
   .. .. ..$ : NULL
   .. .. ..$ : chr [1:2] "coords.x1" "coords.x2"
   ..@ bbox       : num [1:2, 1:2] -1333872 -2356759  1564662  2258428
   .. ..- attr(*, "dimnames")=List of 2
   .. .. ..$ : chr [1:2] "coords.x1" "coords.x2"
   .. .. ..$ : chr [1:2] "min" "max"
   ..@ proj4string:Formal class 'CRS' [package "sp"] with 1 slots
   .. .. ..@ projargs: chr "+proj=aea +lat_1=29.75 +lat_2=45.25 +lat_0=37.5 
+lon_0=-96 +x_0=0 +y_0=0 +no_defs +a=6378137 +rf=298.257222101 
+towgs84=0.000,0"| __truncated__

promotes the grid to the correct class SpatialGridDataFrame but do not 
assign to space for the variable. Is there any way to assign an empty 
"slot" just as we would do for a data.frame?

To sum.  I cant seem to be able to create a "slot" (or z dimension) to 
hold the output of my interpolation. Is there any trick out there that I 
am missing? Any help will be appreciated.

thanks,

H



From e.pebesma at geog.uu.nl  Wed Feb  1 12:54:06 2006
From: e.pebesma at geog.uu.nl (Edzer J. Pebesma)
Date: Wed, 01 Feb 2006 12:54:06 +0100
Subject: [R-sig-Geo] how to go from SpatialGrid to SpatialGridDataFrame ?
In-Reply-To: <Pine.LNX.4.62.0602010302430.13284@egor.unm.edu>
References: <Pine.LNX.4.62.0602010302430.13284@egor.unm.edu>
Message-ID: <43E0A15E.7080703@geog.uu.nl>

A Horacio Samaniego wrote:

>I wonder how I should go from a SpatialGrid to a SpatialGridDataFrame.
>
>  
>
Using for example the function SpatialGridDataFrame()

>I have defined a grid using the functions from the sp, gstat and spgrass6 
>packages:
>
>G<-gmeta6()
>kk<-SpatialGrid(GridTopology(c(G$south,G$west),c(G$nsres,G$ewres),c(G$rows,G$cols)),alb.proj)
>  
>
>>str(kk)
>>    
>>
>Formal class 'SpatialGrid' [package "sp"] with 5 slots
>   ..@ grid       :Formal class 'GridTopology' [package "sp"] with 3 slots
>   .. .. ..@ cellcentre.offset: num [1:2] -1333373 -2356259
>   .. .. ..@ cellsize         : num [1:2] 1000 1000
>   .. .. ..@ cells.dim        : int [1:2] 2899 4615
>   ..@ grid.index : int(0)
>   ..@ coords     : num [1:2, 1:2] -1333373  1564162 -2356259  2257928
>   .. ..- attr(*, "dimnames")=List of 2
>   .. .. ..$ : NULL
>   .. .. ..$ : chr [1:2] "coords.x1" "coords.x2"
>   ..@ bbox       : num [1:2, 1:2] -1333872 -2356759  1564662  2258428
>   .. ..- attr(*, "dimnames")=List of 2
>   .. .. ..$ : chr [1:2] "coords.x1" "coords.x2"
>   .. .. ..$ : chr [1:2] "min" "max"
>   ..@ proj4string:Formal class 'CRS' [package "sp"] with 1 slots
>   .. .. ..@ projargs: chr "+proj=aea +lat_1=29.75 +lat_2=45.25 +lat_0=37.5 
>+lon_0=-96 +x_0=0 +y_0=0 +no_defs +a=6378137 +rf=298.257222101 
>+towgs84=0.000,0"| __truncated__
>
>Now I try to interpolate on that grid, with no success:
>interp.vals<-idw(var1~1,data,newdata=kk)
>Error in idw(corrext ~ 1, data = data.new_alb[gd.glm, ], newdata = 
>data.grd) :
> 	no direct or inherited method for function 'idw' for this call
>
>So, I guess that I need to have a 'SpatialGridDataFrame' instead of just 
>'SpatialGrid' as the interpolation needs to be assigned to a spatial 
>location
>  
>
newdata can be of class SpatialGrid; probably idw fails because
of the data argument. What is the class of data.new_alb[gd.glm,] ?

>kk2<-as(kk,'SpatialGridDataFrame');
>Formal class 'SpatialGridDataFrame' [package "sp"] with 6 slots
>   ..@ data       :Formal class 'AttributeList' [package "sp"] with 1 slots
>   .. .. ..@ att: list()
>   ..@ grid       :Formal class 'GridTopology' [package "sp"] with 3 slots
>   .. .. ..@ cellcentre.offset: num [1:2] -1333373 -2356259
>   .. .. ..@ cellsize         : num [1:2] 1000 1000
>   .. .. ..@ cells.dim        : int [1:2] 2899 4615
>   ..@ grid.index : int(0)
>   ..@ coords     : num [1:2, 1:2] -1333373  1564162 -2356259  2257928
>   .. ..- attr(*, "dimnames")=List of 2
>   .. .. ..$ : NULL
>   .. .. ..$ : chr [1:2] "coords.x1" "coords.x2"
>   ..@ bbox       : num [1:2, 1:2] -1333872 -2356759  1564662  2258428
>   .. ..- attr(*, "dimnames")=List of 2
>   .. .. ..$ : chr [1:2] "coords.x1" "coords.x2"
>   .. .. ..$ : chr [1:2] "min" "max"
>   ..@ proj4string:Formal class 'CRS' [package "sp"] with 1 slots
>   .. .. ..@ projargs: chr "+proj=aea +lat_1=29.75 +lat_2=45.25 +lat_0=37.5 
>+lon_0=-96 +x_0=0 +y_0=0 +no_defs +a=6378137 +rf=298.257222101 
>+towgs84=0.000,0"| __truncated__
>
>promotes the grid to the correct class SpatialGridDataFrame but do not 
>assign to space for the variable. Is there any way to assign an empty 
>"slot" just as we would do for a data.frame?
>
>To sum.  I cant seem to be able to create a "slot" (or z dimension) to 
>hold the output of my interpolation. Is there any trick out there that I 
>am missing? Any help will be appreciated.
>
>thanks,
>
>H
>
>_______________________________________________
>R-sig-Geo mailing list
>R-sig-Geo at stat.math.ethz.ch
>https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>  
>



From horacio.samaniego at gmail.com  Wed Feb  1 13:33:20 2006
From: horacio.samaniego at gmail.com (Horacio Samaniego)
Date: Wed, 1 Feb 2006 13:33:20 +0100
Subject: [R-sig-Geo] how to go from SpatialGrid to SpatialGridDataFrame ?
In-Reply-To: <43E0A15E.7080703@geog.uu.nl>
References: <Pine.LNX.4.62.0602010302430.13284@egor.unm.edu>
	<43E0A15E.7080703@geog.uu.nl>
Message-ID: <9CF9FC28-8B39-4AFD-9596-F5F75C8A5A09@unm.edu>

Edzer,

the class is:

 > class(data.new_alb[gd.glm,])
[1] "SpatialPointsDataFrame"
attr(,"package")
[1] "sp"
 > class(data.grd)
[1] "SpatialGrid"
attr(,"package")
[1] "sp"

I use the [gd.glm,] to avoid the NA in the datasets for that  
variable. However, I get the same results when omitted
 > krige(glmpred~1,data=data.new_alb,newd=data.grd)
Error in krige(glmpred ~ 1, data = data.new_alb, newd = data.grd) :
	no direct or inherited method for function 'krige' for this call

this indicates that the problem is elsewhere.


If newdata accepts SpatialGrids will it output a SpatialGridDataFrame  
with the prediction as a dataframe of that?


Regarding the example, I am not quite sure that I understand how to  
adapt the example to my data. I have a generated a grid based on my  
grass extend, and I need the predictions from my model (idw in this  
'toy' example) to go in that grid. In the meuse.grid example, you  
have a regular grid of samples and make a grid based on that, I have  
irregular samples and need to create a continuous surface of those  
values. So, I chose to build the GridTopology from my grass location.

thanks

Horacio



On Feb 1, 2006, at 12:54 PM, Edzer J. Pebesma wrote:

A Horacio Samaniego wrote:

> I wonder how I should go from a SpatialGrid to a SpatialGridDataFrame.
>
>
Using for example the function SpatialGridDataFrame()

> I have defined a grid using the functions from the sp, gstat and  
> spgrass6 packages:
>
> G<-gmeta6()
> kk<-SpatialGrid(GridTopology(c(G$south,G$west),c(G$nsres,G$ewres),c 
> (G$rows,G$cols)),alb.proj)
>
>> str(kk)
>>
> Formal class 'SpatialGrid' [package "sp"] with 5 slots
>   ..@ grid       :Formal class 'GridTopology' [package "sp"] with 3  
> slots
>   .. .. ..@ cellcentre.offset: num [1:2] -1333373 -2356259
>   .. .. ..@ cellsize         : num [1:2] 1000 1000
>   .. .. ..@ cells.dim        : int [1:2] 2899 4615
>   ..@ grid.index : int(0)
>   ..@ coords     : num [1:2, 1:2] -1333373  1564162 -2356259  2257928
>   .. ..- attr(*, "dimnames")=List of 2
>   .. .. ..$ : NULL
>   .. .. ..$ : chr [1:2] "coords.x1" "coords.x2"
>   ..@ bbox       : num [1:2, 1:2] -1333872 -2356759  1564662  2258428
>   .. ..- attr(*, "dimnames")=List of 2
>   .. .. ..$ : chr [1:2] "coords.x1" "coords.x2"
>   .. .. ..$ : chr [1:2] "min" "max"
>   ..@ proj4string:Formal class 'CRS' [package "sp"] with 1 slots
>   .. .. ..@ projargs: chr "+proj=aea +lat_1=29.75 +lat_2=45.25  
> +lat_0=37.5 +lon_0=-96 +x_0=0 +y_0=0 +no_defs +a=6378137  
> +rf=298.257222101 +towgs84=0.000,0"| __truncated__
>
> Now I try to interpolate on that grid, with no success:
> interp.vals<-idw(var1~1,data,newdata=kk)
> Error in idw(corrext ~ 1, data = data.new_alb[gd.glm, ], newdata =  
> data.grd) :
> 	no direct or inherited method for function 'idw' for this call
>
> So, I guess that I need to have a 'SpatialGridDataFrame' instead of  
> just 'SpatialGrid' as the interpolation needs to be assigned to a  
> spatial location
>
newdata can be of class SpatialGrid; probably idw fails because
of the data argument. What is the class of data.new_alb[gd.glm,] ?

> kk2<-as(kk,'SpatialGridDataFrame');
> Formal class 'SpatialGridDataFrame' [package "sp"] with 6 slots
>   ..@ data       :Formal class 'AttributeList' [package "sp"] with  
> 1 slots
>   .. .. ..@ att: list()
>   ..@ grid       :Formal class 'GridTopology' [package "sp"] with 3  
> slots
>   .. .. ..@ cellcentre.offset: num [1:2] -1333373 -2356259
>   .. .. ..@ cellsize         : num [1:2] 1000 1000
>   .. .. ..@ cells.dim        : int [1:2] 2899 4615
>   ..@ grid.index : int(0)
>   ..@ coords     : num [1:2, 1:2] -1333373  1564162 -2356259  2257928
>   .. ..- attr(*, "dimnames")=List of 2
>   .. .. ..$ : NULL
>   .. .. ..$ : chr [1:2] "coords.x1" "coords.x2"
>   ..@ bbox       : num [1:2, 1:2] -1333872 -2356759  1564662  2258428
>   .. ..- attr(*, "dimnames")=List of 2
>   .. .. ..$ : chr [1:2] "coords.x1" "coords.x2"
>   .. .. ..$ : chr [1:2] "min" "max"
>   ..@ proj4string:Formal class 'CRS' [package "sp"] with 1 slots
>   .. .. ..@ projargs: chr "+proj=aea +lat_1=29.75 +lat_2=45.25  
> +lat_0=37.5 +lon_0=-96 +x_0=0 +y_0=0 +no_defs +a=6378137  
> +rf=298.257222101 +towgs84=0.000,0"| __truncated__
>
> promotes the grid to the correct class SpatialGridDataFrame but do  
> not assign to space for the variable. Is there any way to assign an  
> empty "slot" just as we would do for a data.frame?
>
> To sum.  I cant seem to be able to create a "slot" (or z dimension)  
> to hold the output of my interpolation. Is there any trick out  
> there that I am missing? Any help will be appreciated.
>
> thanks,
>
> H
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



From e.pebesma at geog.uu.nl  Wed Feb  1 13:41:40 2006
From: e.pebesma at geog.uu.nl (Edzer J. Pebesma)
Date: Wed, 01 Feb 2006 13:41:40 +0100
Subject: [R-sig-Geo] how to go from SpatialGrid to SpatialGridDataFrame ?
In-Reply-To: <9CF9FC28-8B39-4AFD-9596-F5F75C8A5A09@unm.edu>
References: <Pine.LNX.4.62.0602010302430.13284@egor.unm.edu>
	<43E0A15E.7080703@geog.uu.nl>
	<9CF9FC28-8B39-4AFD-9596-F5F75C8A5A09@unm.edu>
Message-ID: <43E0AC84.4080505@geog.uu.nl>

Horacio Samaniego wrote:

> Edzer,
>
> the class is:
>
> > class(data.new_alb[gd.glm,])
> [1] "SpatialPointsDataFrame"
> attr(,"package")
> [1] "sp"
> > class(data.grd)
> [1] "SpatialGrid"
> attr(,"package")
> [1] "sp"
>
> I use the [gd.glm,] to avoid the NA in the datasets for that  
> variable. However, I get the same results when omitted
> >

> Error in krige(glmpred ~ 1, data = data.new_alb, newd = data.grd) :
>     no direct or inherited method for function 'krige' for this call
>
> this indicates that the problem is elsewhere.

Yes; sorry it took me a while to recognize.
You should omit the "data =" in the call, i.e.
krige(glmpred~1,data.new_alb[gd.glm,],newd=data.grd)
will work. This is a change in interface, which I recently
posted to R-pkgs:
https://stat.ethz.ch/pipermail/r-packages/2006/000154.html

>
>
> If newdata accepts SpatialGrids will it output a SpatialGridDataFrame  
> with the prediction as a dataframe of that?

Yes.

>
>
> Regarding the example, I am not quite sure that I understand how to  
> adapt the example to my data. I have a generated a grid based on my  
> grass extend, and I need the predictions from my model (idw in this  
> 'toy' example) to go in that grid. In the meuse.grid example, you  
> have a regular grid of samples and make a grid based on that, I have  
> irregular samples and need to create a continuous surface of those  
> values. So, I chose to build the GridTopology from my grass location.

Should work.
--
Edzer

>
> thanks
>
> Horacio
>
>
>
> On Feb 1, 2006, at 12:54 PM, Edzer J. Pebesma wrote:
>
> A Horacio Samaniego wrote:
>
>> I wonder how I should go from a SpatialGrid to a SpatialGridDataFrame.
>>
>>
> Using for example the function SpatialGridDataFrame()
>
>> I have defined a grid using the functions from the sp, gstat and  
>> spgrass6 packages:
>>
>> G<-gmeta6()
>> kk<-SpatialGrid(GridTopology(c(G$south,G$west),c(G$nsres,G$ewres),c 
>> (G$rows,G$cols)),alb.proj)
>>
>>> str(kk)
>>>
>> Formal class 'SpatialGrid' [package "sp"] with 5 slots
>>   ..@ grid       :Formal class 'GridTopology' [package "sp"] with 3  
>> slots
>>   .. .. ..@ cellcentre.offset: num [1:2] -1333373 -2356259
>>   .. .. ..@ cellsize         : num [1:2] 1000 1000
>>   .. .. ..@ cells.dim        : int [1:2] 2899 4615
>>   ..@ grid.index : int(0)
>>   ..@ coords     : num [1:2, 1:2] -1333373  1564162 -2356259  2257928
>>   .. ..- attr(*, "dimnames")=List of 2
>>   .. .. ..$ : NULL
>>   .. .. ..$ : chr [1:2] "coords.x1" "coords.x2"
>>   ..@ bbox       : num [1:2, 1:2] -1333872 -2356759  1564662  2258428
>>   .. ..- attr(*, "dimnames")=List of 2
>>   .. .. ..$ : chr [1:2] "coords.x1" "coords.x2"
>>   .. .. ..$ : chr [1:2] "min" "max"
>>   ..@ proj4string:Formal class 'CRS' [package "sp"] with 1 slots
>>   .. .. ..@ projargs: chr "+proj=aea +lat_1=29.75 +lat_2=45.25  
>> +lat_0=37.5 +lon_0=-96 +x_0=0 +y_0=0 +no_defs +a=6378137  
>> +rf=298.257222101 +towgs84=0.000,0"| __truncated__
>>
>> Now I try to interpolate on that grid, with no success:
>> interp.vals<-idw(var1~1,data,newdata=kk)
>> Error in idw(corrext ~ 1, data = data.new_alb[gd.glm, ], newdata =  
>> data.grd) :
>>     no direct or inherited method for function 'idw' for this call
>>
>> So, I guess that I need to have a 'SpatialGridDataFrame' instead of  
>> just 'SpatialGrid' as the interpolation needs to be assigned to a  
>> spatial location
>>
> newdata can be of class SpatialGrid; probably idw fails because
> of the data argument. What is the class of data.new_alb[gd.glm,] ?
>
>> kk2<-as(kk,'SpatialGridDataFrame');
>> Formal class 'SpatialGridDataFrame' [package "sp"] with 6 slots
>>   ..@ data       :Formal class 'AttributeList' [package "sp"] with  1 
>> slots
>>   .. .. ..@ att: list()
>>   ..@ grid       :Formal class 'GridTopology' [package "sp"] with 3  
>> slots
>>   .. .. ..@ cellcentre.offset: num [1:2] -1333373 -2356259
>>   .. .. ..@ cellsize         : num [1:2] 1000 1000
>>   .. .. ..@ cells.dim        : int [1:2] 2899 4615
>>   ..@ grid.index : int(0)
>>   ..@ coords     : num [1:2, 1:2] -1333373  1564162 -2356259  2257928
>>   .. ..- attr(*, "dimnames")=List of 2
>>   .. .. ..$ : NULL
>>   .. .. ..$ : chr [1:2] "coords.x1" "coords.x2"
>>   ..@ bbox       : num [1:2, 1:2] -1333872 -2356759  1564662  2258428
>>   .. ..- attr(*, "dimnames")=List of 2
>>   .. .. ..$ : chr [1:2] "coords.x1" "coords.x2"
>>   .. .. ..$ : chr [1:2] "min" "max"
>>   ..@ proj4string:Formal class 'CRS' [package "sp"] with 1 slots
>>   .. .. ..@ projargs: chr "+proj=aea +lat_1=29.75 +lat_2=45.25  
>> +lat_0=37.5 +lon_0=-96 +x_0=0 +y_0=0 +no_defs +a=6378137  
>> +rf=298.257222101 +towgs84=0.000,0"| __truncated__
>>
>> promotes the grid to the correct class SpatialGridDataFrame but do  
>> not assign to space for the variable. Is there any way to assign an  
>> empty "slot" just as we would do for a data.frame?
>>
>> To sum.  I cant seem to be able to create a "slot" (or z dimension)  
>> to hold the output of my interpolation. Is there any trick out  there 
>> that I am missing? Any help will be appreciated.
>>
>> thanks,
>>
>> H
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>



From horacio.samaniego at gmail.com  Wed Feb  1 14:18:39 2006
From: horacio.samaniego at gmail.com (Horacio Samaniego)
Date: Wed, 1 Feb 2006 14:18:39 +0100
Subject: [R-sig-Geo] how to go from SpatialGrid to SpatialGridDataFrame ?
In-Reply-To: <43E0AC84.4080505@geog.uu.nl>
References: <Pine.LNX.4.62.0602010302430.13284@egor.unm.edu>
	<43E0A15E.7080703@geog.uu.nl>
	<9CF9FC28-8B39-4AFD-9596-F5F75C8A5A09@unm.edu>
	<43E0AC84.4080505@geog.uu.nl>
Message-ID: <CCF7318B-D646-4A87-8CBF-5591D777F354@unm.edu>

good, thanks...

however,  there seemed to be another problem.. of a different kind I  
fear...

I got:

 > kkp=idw(glmpred~1,data.new_alb[gd.glm,],data.grd)
Error in predict.gstat(g, newdata = newdata, block = block, nsim =  
nsim,  :
	data items in gstat object and newdata have different coordinate  
reference systems

Due to a simple space in the first coord definition... (perhaps easy  
to fix... by some string processing?)
 > rbind(proj4string(data.new_alb),proj4string(data.grd))
      [,1]
[1,] " +proj=aea +lat_1=29.75 +lat_2=45.25 +lat_0=37.5 +lon_0=-96  
+x_0=0 +y_0=0 +no_defs +a=6378137 +rf=298.257222101  
+towgs84=0.000,0.000,0.000"
[2,] "+proj=aea +lat_1=29.75 +lat_2=45.25 +lat_0=37.5 +lon_0=-96  
+x_0=0 +y_0=0 +no_defs +a=6378137 +rf=298.257222101  
+towgs84=0.000,0.000,0.000"



This was an easy problem that got solved using

 > proj4string(data.new_alb)<- CRS(proj4string(data.grd))
 > rbind(proj4string(data.new_alb),proj4string(data.grd))
      [,1]
[1,] "+proj=aea +lat_1=29.75 +lat_2=45.25 +lat_0=37.5 +lon_0=-96  
+x_0=0 +y_0=0 +no_defs +a=6378137 +rf=298.257222101  
+towgs84=0.000,0.000,0.000"
[2,] "+proj=aea +lat_1=29.75 +lat_2=45.25 +lat_0=37.5 +lon_0=-96  
+x_0=0 +y_0=0 +no_defs +a=6378137 +rf=298.257222101  
+towgs84=0.000,0.000,0.000"


Thanks Edzer!
--
Horacio Samaniego
Dept. Biology
University of New Mexico
Albuquerque 87106, NM

http://www.unm.edu/~horacio



On Feb 1, 2006, at 1:41 PM, Edzer J. Pebesma wrote:

Horacio Samaniego wrote:

> Edzer,
>
> the class is:
>
> > class(data.new_alb[gd.glm,])
> [1] "SpatialPointsDataFrame"
> attr(,"package")
> [1] "sp"
> > class(data.grd)
> [1] "SpatialGrid"
> attr(,"package")
> [1] "sp"
>
> I use the [gd.glm,] to avoid the NA in the datasets for that   
> variable. However, I get the same results when omitted
> >

> Error in krige(glmpred ~ 1, data = data.new_alb, newd = data.grd) :
>     no direct or inherited method for function 'krige' for this call
>
> this indicates that the problem is elsewhere.

Yes; sorry it took me a while to recognize.
You should omit the "data =" in the call, i.e.
krige(glmpred~1,data.new_alb[gd.glm,],newd=data.grd)
will work. This is a change in interface, which I recently
posted to R-pkgs:
https://stat.ethz.ch/pipermail/r-packages/2006/000154.html

>
>
> If newdata accepts SpatialGrids will it output a  
> SpatialGridDataFrame  with the prediction as a dataframe of that?

Yes.

>
>
> Regarding the example, I am not quite sure that I understand how  
> to  adapt the example to my data. I have a generated a grid based  
> on my  grass extend, and I need the predictions from my model (idw  
> in this  'toy' example) to go in that grid. In the meuse.grid  
> example, you  have a regular grid of samples and make a grid based  
> on that, I have  irregular samples and need to create a continuous  
> surface of those  values. So, I chose to build the GridTopology  
> from my grass location.

Should work.
--
Edzer

>
> thanks
>
> Horacio
>
>
>
> On Feb 1, 2006, at 12:54 PM, Edzer J. Pebesma wrote:
>
> A Horacio Samaniego wrote:
>
>> I wonder how I should go from a SpatialGrid to a  
>> SpatialGridDataFrame.
>>
>>
> Using for example the function SpatialGridDataFrame()
>
>> I have defined a grid using the functions from the sp, gstat and   
>> spgrass6 packages:
>>
>> G<-gmeta6()
>> kk<-SpatialGrid(GridTopology(c(G$south,G$west),c(G$nsres,G 
>> $ewres),c (G$rows,G$cols)),alb.proj)
>>
>>> str(kk)
>>>
>> Formal class 'SpatialGrid' [package "sp"] with 5 slots
>>   ..@ grid       :Formal class 'GridTopology' [package "sp"] with  
>> 3  slots
>>   .. .. ..@ cellcentre.offset: num [1:2] -1333373 -2356259
>>   .. .. ..@ cellsize         : num [1:2] 1000 1000
>>   .. .. ..@ cells.dim        : int [1:2] 2899 4615
>>   ..@ grid.index : int(0)
>>   ..@ coords     : num [1:2, 1:2] -1333373  1564162 -2356259  2257928
>>   .. ..- attr(*, "dimnames")=List of 2
>>   .. .. ..$ : NULL
>>   .. .. ..$ : chr [1:2] "coords.x1" "coords.x2"
>>   ..@ bbox       : num [1:2, 1:2] -1333872 -2356759  1564662  2258428
>>   .. ..- attr(*, "dimnames")=List of 2
>>   .. .. ..$ : chr [1:2] "coords.x1" "coords.x2"
>>   .. .. ..$ : chr [1:2] "min" "max"
>>   ..@ proj4string:Formal class 'CRS' [package "sp"] with 1 slots
>>   .. .. ..@ projargs: chr "+proj=aea +lat_1=29.75 +lat_2=45.25   
>> +lat_0=37.5 +lon_0=-96 +x_0=0 +y_0=0 +no_defs +a=6378137   
>> +rf=298.257222101 +towgs84=0.000,0"| __truncated__
>>
>> Now I try to interpolate on that grid, with no success:
>> interp.vals<-idw(var1~1,data,newdata=kk)
>> Error in idw(corrext ~ 1, data = data.new_alb[gd.glm, ], newdata  
>> =  data.grd) :
>>     no direct or inherited method for function 'idw' for this call
>>
>> So, I guess that I need to have a 'SpatialGridDataFrame' instead  
>> of  just 'SpatialGrid' as the interpolation needs to be assigned  
>> to a  spatial location
>>
> newdata can be of class SpatialGrid; probably idw fails because
> of the data argument. What is the class of data.new_alb[gd.glm,] ?
>
>> kk2<-as(kk,'SpatialGridDataFrame');
>> Formal class 'SpatialGridDataFrame' [package "sp"] with 6 slots
>>   ..@ data       :Formal class 'AttributeList' [package "sp"]  
>> with  1 slots
>>   .. .. ..@ att: list()
>>   ..@ grid       :Formal class 'GridTopology' [package "sp"] with  
>> 3  slots
>>   .. .. ..@ cellcentre.offset: num [1:2] -1333373 -2356259
>>   .. .. ..@ cellsize         : num [1:2] 1000 1000
>>   .. .. ..@ cells.dim        : int [1:2] 2899 4615
>>   ..@ grid.index : int(0)
>>   ..@ coords     : num [1:2, 1:2] -1333373  1564162 -2356259  2257928
>>   .. ..- attr(*, "dimnames")=List of 2
>>   .. .. ..$ : NULL
>>   .. .. ..$ : chr [1:2] "coords.x1" "coords.x2"
>>   ..@ bbox       : num [1:2, 1:2] -1333872 -2356759  1564662  2258428
>>   .. ..- attr(*, "dimnames")=List of 2
>>   .. .. ..$ : chr [1:2] "coords.x1" "coords.x2"
>>   .. .. ..$ : chr [1:2] "min" "max"
>>   ..@ proj4string:Formal class 'CRS' [package "sp"] with 1 slots
>>   .. .. ..@ projargs: chr "+proj=aea +lat_1=29.75 +lat_2=45.25   
>> +lat_0=37.5 +lon_0=-96 +x_0=0 +y_0=0 +no_defs +a=6378137   
>> +rf=298.257222101 +towgs84=0.000,0"| __truncated__
>>
>> promotes the grid to the correct class SpatialGridDataFrame but  
>> do  not assign to space for the variable. Is there any way to  
>> assign an  empty "slot" just as we would do for a data.frame?
>>
>> To sum.  I cant seem to be able to create a "slot" (or z  
>> dimension)  to hold the output of my interpolation. Is there any  
>> trick out  there that I am missing? Any help will be appreciated.
>>
>> thanks,
>>
>> H
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>



From mreisman at isis.wu-wien.ac.at  Wed Feb  1 17:27:40 2006
From: mreisman at isis.wu-wien.ac.at (Martin Reismann)
Date: Wed, 1 Feb 2006 17:27:40 +0100
Subject: [R-sig-Geo] 2 problems with errorsarlm(method="SparseM")
Message-ID: <cb44df220602010827i15dd5786tc9f887c0b46bccfc@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20060201/47b67718/attachment.pl>

From mreisman at isis.wu-wien.ac.at  Wed Feb  1 17:34:26 2006
From: mreisman at isis.wu-wien.ac.at (Martin Reismann)
Date: Wed, 1 Feb 2006 17:34:26 +0100 (MEZ)
Subject: [R-sig-Geo] 2 problems with errorsarlm(method="SparseM")
Message-ID: <Pine.A32.3.96.1060201173231.179736A-100000@isis.wu-wien.ac.at>

(1) When running a large SAR (weight matrix 12544 * 12544) with errorsarlm
and SparseM-method I ran into this error message:
 
> Error in .local(x, ...) : Increase nnzlmax
> Error in det(chol((I - lambda * csrw), tmpmax = tmpmax)) :
>         unable to find the argument 'x' in selecting a method for
function 'det' 
 
The listw-object stems from nb2listw and is style="W".
It happens on both Linux (32 bit, 4GB RAM) and Solaris (64 bit, 8GB RAM)
 
(2) Being able to use mat2listw instead of nb2listw would be preferable
because mat2listw allows matrix elements different from 0 and 1.
 
Unfortunately errorsarlm(..., method="SparseM") on a listw-object made by
mat2listw crashed in an early stage.
 
Error message:
> Error in validObject(.Object) : invalid class "matrix.csr" object:
> invalid object for slot "ja" in class "matrix.csr": 
> got class "numeric", should be or extend class "integer"

It might be because mat2listw creates listw-objects of weights style="M"
(underlying style unknown).
Is there a way to transform a listw-object created by mat2listw into a
"clean" one with proper weights style set?
 
 
I appreciate your help!
 
Martin


-- 
Mag. Martin Reismann
c/o
Institut fuer Wirtschaftsgeographie und Geoinformatik
Wirtschaftsuniversitaet Wien
Nordbergstrasse 15, 4. Stock, Kern A
A-1090 Wien

EMail: Martin.Reismann at wu-wien.ac.at
Tel +43-(0)-1-31336-5720
Fax +43-(0)-1-31336-703



From Roger.Bivand at nhh.no  Wed Feb  1 20:32:32 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 1 Feb 2006 20:32:32 +0100 (CET)
Subject: [R-sig-Geo] 2 problems with errorsarlm(method="SparseM")
In-Reply-To: <Pine.A32.3.96.1060201173231.179736A-100000@isis.wu-wien.ac.at>
Message-ID: <Pine.LNX.4.44.0602012004320.7295-100000@reclus.nhh.no>

On Wed, 1 Feb 2006, Martin Reismann wrote:

> (1) When running a large SAR (weight matrix 12544 * 12544) with errorsarlm
> and SparseM-method I ran into this error message:
>  
> > Error in .local(x, ...) : Increase nnzlmax
> > Error in det(chol((I - lambda * csrw), tmpmax = tmpmax)) :
> >         unable to find the argument 'x' in selecting a method for
> function 'det' 
>  
> The listw-object stems from nb2listw and is style="W".
> It happens on both Linux (32 bit, 4GB RAM) and Solaris (64 bit, 8GB RAM)

When in doubt, immediately after the error exit from an R function, type

> traceback()

which will list out the function calls back to the function in error. I 
think that the problem is that because of the density of your spatial 
weights matrix, chol() for sparse matrices is running out of working 
space, and that nnzlmax now needs setting (Danlin Yu reported a similar 
problem with tmpmax over a year ago).

Could you repeat the problem and then run and report traceback()? Could
you also report sum(card()) for your list of neighbours? I think your
matrix is quite dense, and knowing how dense it is will help work out how
big nnzlmax needs to be.

>  
> (2) Being able to use mat2listw instead of nb2listw would be preferable
> because mat2listw allows matrix elements different from 0 and 1.
>  

Why can't you use the glist= argument to nb2listw()?

Also note that method="SparseM" should only work with weights that are 
either symmetric or similar to symmetric - I'll make this clearer on the 
help page, and block style="M" for that method.

This means that symmetric general weights, like inverse distance, may be 
possible, but that both asymmetric neighbours and asymmetric general 
weights for symmetric neighbours are banned for method="SparseM" - 
obviously because chol() for sparse matrices only works when they are 
symmetric (row standardised symmetric neighbours are asymmetric weights, 
but the determinant is the same for the similar-to-symmetric version.

I guess the problem below will go away when I block the entrance.

Possibly the only weights matrix that could be tolerated is a fully 
symmetric neighbours matrix with symmetric general weights. There is 
different code in spautolm() doing much the same as errorsarlm(), but I'm 
not sure that both problems will not re-occur there until they are fixed. 
Getting nnzlmax right is possible, but chol() is just not going to work if 
the weights are neither symmetric nor similar-to-symmetric.

Roger

PS. Access to your data would speed up finding a solution, then I can run 
traceback() myself.

> Unfortunately errorsarlm(..., method="SparseM") on a listw-object made by
> mat2listw crashed in an early stage.
>  

PPS. In R, "crash" is reserved for R itself terminating and exiting with
data loss. Here, it just reported something wrong and returned to the
prompt, so the function did its best, with no "crash" as such.

> Error message:
> > Error in validObject(.Object) : invalid class "matrix.csr" object:
> > invalid object for slot "ja" in class "matrix.csr": 
> > got class "numeric", should be or extend class "integer"
> 
> It might be because mat2listw creates listw-objects of weights style="M"
> (underlying style unknown).
> Is there a way to transform a listw-object created by mat2listw into a
> "clean" one with proper weights style set?
>  
>  
> I appreciate your help!
>  
> Martin
> 
> 
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From Alexander.Herr at csiro.au  Thu Feb  2 03:20:36 2006
From: Alexander.Herr at csiro.au (Alexander.Herr at csiro.au)
Date: Thu, 2 Feb 2006 12:20:36 +1000
Subject: [R-sig-Geo] ?Plotting line segments of shapefile in different
	color
Message-ID: <062AE320EF971E40ACD0F6C93391D7697E1B94@exqld1-tsv.nexus.csiro.au>

Thanks Roger,

ColorRampPalette only allows for 255 colors, but since I want to show
only the difference between each adjacent segment, a few colors will do.
So the way to do this is

a) use readShapelines and repeat the color listing for the number of
line segments (ie length(slot(s2,"lines")/number of colors) and plot the
readShapeline object
library(maptools)
fn<-system.file("shapes/fylk-val.shp", package="maptools")
s2 <- readShapeLines(fn, proj4string=CRS("+proj=utm +zone=33
+datum=WGS84"))
length(slot(s2,"lines"))->len1
rep(c("green", "blue", "black", "red"), len=len1)->cols1
plot(s2, col=cols1)


b)use Map2lines and run a for loop on the length of the Map2lines object
and circle through the colors
library(maptools)
fn<-system.file("shapes/fylk-val.shp", package="maptools")
read.shape(fn)->xx
Map2lines(xx)->s3
xylims<-attr(s3, "maplim")
plot(xylims$x, xylims$y, asp=1, type='n', xlab="", ylab="")
cols1<-c("green", "blue", "black", "red")
j=0
for (i in 1:length(s3)) {
  if (j < 5) j = j+1 else j = 0
   lines(s3[[i]], col=cols1[j])
 }


Cheers
Herry
 
-----Original Message-----
From: Roger Bivand [mailto:Roger.Bivand at nhh.no] 
Sent: Wednesday, 1 February 2006 5:36 PM
To: Herr, Alexander Herr - Herry (CSE, Townsville)
Cc: r-sig-geo at stat.math.ethz.ch
Subject: Re: [R-sig-Geo] ?Plotting line segments of shapefile in
different color

On Wed, 1 Feb 2006 Alexander.Herr at csiro.au wrote:

> Hi List,
> 
> I am unsuccessfully trying to plot line segments of a shapefile with 
> different colors. Does anyone have a working example for segmented 
> lines?

If each line to be coloured is a separate Lines object:

library(maptools)
fn <- system.file("shapes/fylk-val.shp", package="maptools")[1] xx <-
readShapeLines(fn, proj4string=CRS("+proj=utm +zone=33 +datum=WGS84"))
plot(xx, col="blue") # all one colour length(slot(xx, "lines")) # 97
plot(xx, col=colorRampPalette(c("green", "blue", "black"))(97))
length(colorRampPalette(c("green", "blue", "black"))(97)) # 97 colours

The col= argument is used if it is the same length as the number of
lines; if the lengths differ, the first colour value is used for all
lines.

If the shapes are not organised as separate Lines objects, then they
will need to be cut up and re-created as such.

Roger


> 
> Thanks
> Herry
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

--
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From Alexander.Herr at csiro.au  Thu Feb  2 03:27:25 2006
From: Alexander.Herr at csiro.au (Alexander.Herr at csiro.au)
Date: Thu, 2 Feb 2006 12:27:25 +1000
Subject: [R-sig-Geo] ?Plotting line segments of shapefile in different
	color
Message-ID: <062AE320EF971E40ACD0F6C93391D7697E1B97@exqld1-tsv.nexus.csiro.au>

Oops, option b should read

b)use Map2lines and run a for loop on the length of the Map2lines object
and circle through the colors
library(maptools)
fn<-system.file("shapes/fylk-val.shp", package="maptools") 
read.shape(fn)->xx
Map2lines(xx)->s3
xylims<-attr(s3, "maplim")
plot(xylims$x, xylims$y, asp=1, type='n', xlab="", ylab="") 
cols1<-c("green", "blue", "black", "red") 
j=0 
for (i in 1:length(s3)) {
   if (j < 4) j = j+1 else j = 1
  lines(s3[[i]], col=cols1[j])
 }
 
Herry

-----Original Message-----
From: Herr, Alexander Herr - Herry (CSE, Townsville) 
Sent: Thursday, 2 February 2006 12:21 PM
To: 'r-sig-geo at stat.math.ethz.ch'
Cc: 'Roger.Bivand at nhh.no'
Subject: RE: [R-sig-Geo] ?Plotting line segments of shapefile in
different color

Thanks Roger,

ColorRampPalette only allows for 255 colors, but since I want to show
only the difference between each adjacent segment, a few colors will do.
So the way to do this is

a) use readShapelines and repeat the color listing for the number of
line segments (ie length(slot(s2,"lines")/number of colors) and plot the
readShapeline object
library(maptools)
fn<-system.file("shapes/fylk-val.shp", package="maptools")
s2 <- readShapeLines(fn, proj4string=CRS("+proj=utm +zone=33
+datum=WGS84"))
length(slot(s2,"lines"))->len1
rep(c("green", "blue", "black", "red"), len=len1)->cols1 plot(s2,
col=cols1)


b)use Map2lines and run a for loop on the length of the Map2lines object
and circle through the colors
library(maptools)
fn<-system.file("shapes/fylk-val.shp", package="maptools")
read.shape(fn)->xx
Map2lines(xx)->s3
xylims<-attr(s3, "maplim")
plot(xylims$x, xylims$y, asp=1, type='n', xlab="", ylab="")
cols1<-c("green", "blue", "black", "red") j=0 for (i in 1:length(s3)) {
  if (j < 5) j = j+1 else j = 0
   lines(s3[[i]], col=cols1[j])
 }


Cheers
Herry
 
-----Original Message-----
From: Roger Bivand [mailto:Roger.Bivand at nhh.no]
Sent: Wednesday, 1 February 2006 5:36 PM
To: Herr, Alexander Herr - Herry (CSE, Townsville)
Cc: r-sig-geo at stat.math.ethz.ch
Subject: Re: [R-sig-Geo] ?Plotting line segments of shapefile in
different color

On Wed, 1 Feb 2006 Alexander.Herr at csiro.au wrote:

> Hi List,
> 
> I am unsuccessfully trying to plot line segments of a shapefile with 
> different colors. Does anyone have a working example for segmented 
> lines?

If each line to be coloured is a separate Lines object:

library(maptools)
fn <- system.file("shapes/fylk-val.shp", package="maptools")[1] xx <-
readShapeLines(fn, proj4string=CRS("+proj=utm +zone=33 +datum=WGS84"))
plot(xx, col="blue") # all one colour length(slot(xx, "lines")) # 97
plot(xx, col=colorRampPalette(c("green", "blue", "black"))(97))
length(colorRampPalette(c("green", "blue", "black"))(97)) # 97 colours

The col= argument is used if it is the same length as the number of
lines; if the lengths differ, the first colour value is used for all
lines.

If the shapes are not organised as separate Lines objects, then they
will need to be cut up and re-created as such.

Roger


> 
> Thanks
> Herry
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

--
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From horacio at unm.edu  Mon Feb  6 12:46:39 2006
From: horacio at unm.edu (A Horacio Samaniego)
Date: Mon, 6 Feb 2006 04:46:39 -0700 (MST)
Subject: [R-sig-Geo] dumping interpolated results into grass6...
Message-ID: <Pine.LNX.4.62.0602060433440.13589@egor.unm.edu>

I wonder if there are any Xtra trick to dump a SpatialPixelDataFrame into 
grass6? I get the following error. (I seem to have rgdal up and running.)

> writeRast6sp(kk,"idw_hs",zcol="var1.pred",NODATA=-9999.99)
Error in writeRast6sp(kk, "idw_hs", zcol = "var1.pred", NODATA = -9999.99)
:
         only numeric columns may be exported


I have read the vignettes and 
http://grass.gdf-hannover.de/twiki/bin/view/GRASS/GrassSixTutorial#Mini_How_to_interpolate_using_kr 
carefully... And I'm not sure where ( and if?) I'm doing this wrong...


thanks!

H


Here is the full command sequence and checks:


> library(gstat)
Loading required package: sp
> library(spgrass6)
Loading required package: rgdal
Loading required package: abind
Loading required package: pixmap
Geospatial Data Abstraction Library extensions to R successfully loaded
> kk<-idw(glmpred~1,data.new_alb[gd.glm,],data.grd)
[inverse distance weighted interpolation]
> writeRast6sp(kk,"idw_hs",zcol="var1.pred",NODATA=-9999.99)
Error in writeRast6sp(kk, "idw_hs", zcol = "var1.pred", NODATA = -9999.99) 
:
 	only numeric columns may be exported
> str(kk)
Formal class 'SpatialPixelsDataFrame' [package "sp"] with 7 slots
   ..@ data       :Formal class 'AttributeList' [package "sp"] with 1 slots
   .. .. ..@ att:List of 2
   .. .. .. ..$ var1.pred: num [1:208874] 0.503 0.503 0.504 0.504 0.504 ...
   .. .. .. ..$ var1.var : num [1:208874] NA NA NA NA NA NA NA NA NA NA ...
   ..@ coords.nrs : num(0)
   ..@ grid       :Formal class 'GridTopology' [package "sp"] with 3 slots
   .. .. ..@ cellcentre.offset: Named num [1:2] -1333373 -2356259
   .. .. .. ..- attr(*, "names")= chr [1:2] "s1" "s2"
   .. .. ..@ cellsize         : Named num [1:2] 8007 7999
   .. .. .. ..- attr(*, "names")= chr [1:2] "s1" "s2"
   .. .. ..@ cells.dim        : Named int [1:2] 362 577
   .. .. .. ..- attr(*, "names")= chr [1:2] "s1" "s2"
   ..@ grid.index : int [1:208874] 1 2 3 4 5 6 7 8 9 10 ...
   ..@ coords     : num [1:208874, 1:2] -1333373 -1325366 -1317359 -1309352 
-1301345 ...
   .. ..- attr(*, "dimnames")=List of 2
   .. .. ..$ : NULL
   .. .. ..$ : chr [1:2] "s1" "s2"
   ..@ bbox       : num [1:2, 1:2] -1337376 -2360258  1561158  2254928
   .. ..- attr(*, "dimnames")=List of 2
   .. .. ..$ : chr [1:2] "s1" "s2"
   .. .. ..$ : chr [1:2] "min" "max"
   ..@ proj4string:Formal class 'CRS' [package "sp"] with 1 slots
   .. .. ..@ projargs: chr NA
>

> getGDALDriverNames()
  [1] "GRASS"     "VRT"       "GTiff"     "NITF"      "HFA"       "SAR_CEOS"
  [7] "CEOS"      "ELAS"      "AIG"       "AAIGrid"   "SDTS"      "OGDI"
[13] "DTED"      "PNG"       "JPEG"      "MEM"       "JDEM"      "GIF"
[19] "ESAT"      "BSB"       "XPM"       "BMP"       "AirSAR"    "RS2"
[25] "PCIDSK"    "PCRaster"  "ILWIS"     "RIK"       "GMT"       "netCDF"
[31] "HDF4"      "HDF4Image" "PNM"       "DOQ1"      "DOQ2"      "ENVI"
[37] "EHdr"      "PAux"      "MFF"       "MFF2"      "FujiBAS"   "GSC"
[43] "FAST"      "BT"        "LAN"       "CPG"       "IDA"       "NDF"
[49] "JPEG2000"  "L1B"       "FIT"       "RMF"       "USGSDEM"   "GXF"



From Roger.Bivand at nhh.no  Mon Feb  6 13:45:41 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 6 Feb 2006 13:45:41 +0100 (CET)
Subject: [R-sig-Geo] dumping interpolated results into grass6...
In-Reply-To: <Pine.LNX.4.62.0602060433440.13589@egor.unm.edu>
Message-ID: <Pine.LNX.4.44.0602061339510.3877-100000@reclus.nhh.no>

On Mon, 6 Feb 2006, A Horacio Samaniego wrote:

> I wonder if there are any Xtra trick to dump a SpatialPixelDataFrame into 
> grass6? I get the following error. (I seem to have rgdal up and running.)
> 
> > writeRast6sp(kk,"idw_hs",zcol="var1.pred",NODATA=-9999.99)
> Error in writeRast6sp(kk, "idw_hs", zcol = "var1.pred", NODATA = -9999.99)
> :
>          only numeric columns may be exported
> 
> 
> I have read the vignettes and 
> http://grass.gdf-hannover.de/twiki/bin/view/GRASS/GrassSixTutorial#Mini_How_to_interpolate_using_kr 
> carefully... And I'm not sure where ( and if?) I'm doing this wrong...
> 

Thanks for a full report. Could you attach (or put on a website) the file 
resulting from:

save(kk, file="kk.RData", compress=TRUE) 

to me *off* the list, please? str() below indicates that var1.pred is 
present, so the test inside writeRast6sp() seems to be getting things 
wrong.

Roger

> 
> thanks!
> 
> H
> 
> 
> Here is the full command sequence and checks:
> 
> 
> > library(gstat)
> Loading required package: sp
> > library(spgrass6)
> Loading required package: rgdal
> Loading required package: abind
> Loading required package: pixmap
> Geospatial Data Abstraction Library extensions to R successfully loaded
> > kk<-idw(glmpred~1,data.new_alb[gd.glm,],data.grd)
> [inverse distance weighted interpolation]
> > writeRast6sp(kk,"idw_hs",zcol="var1.pred",NODATA=-9999.99)
> Error in writeRast6sp(kk, "idw_hs", zcol = "var1.pred", NODATA = -9999.99) 
> :
>  	only numeric columns may be exported
> > str(kk)
> Formal class 'SpatialPixelsDataFrame' [package "sp"] with 7 slots
>    ..@ data       :Formal class 'AttributeList' [package "sp"] with 1 slots
>    .. .. ..@ att:List of 2
>    .. .. .. ..$ var1.pred: num [1:208874] 0.503 0.503 0.504 0.504 0.504 ...
>    .. .. .. ..$ var1.var : num [1:208874] NA NA NA NA NA NA NA NA NA NA ...
>    ..@ coords.nrs : num(0)
>    ..@ grid       :Formal class 'GridTopology' [package "sp"] with 3 slots
>    .. .. ..@ cellcentre.offset: Named num [1:2] -1333373 -2356259
>    .. .. .. ..- attr(*, "names")= chr [1:2] "s1" "s2"
>    .. .. ..@ cellsize         : Named num [1:2] 8007 7999
>    .. .. .. ..- attr(*, "names")= chr [1:2] "s1" "s2"
>    .. .. ..@ cells.dim        : Named int [1:2] 362 577
>    .. .. .. ..- attr(*, "names")= chr [1:2] "s1" "s2"
>    ..@ grid.index : int [1:208874] 1 2 3 4 5 6 7 8 9 10 ...
>    ..@ coords     : num [1:208874, 1:2] -1333373 -1325366 -1317359 -1309352 
> -1301345 ...
>    .. ..- attr(*, "dimnames")=List of 2
>    .. .. ..$ : NULL
>    .. .. ..$ : chr [1:2] "s1" "s2"
>    ..@ bbox       : num [1:2, 1:2] -1337376 -2360258  1561158  2254928
>    .. ..- attr(*, "dimnames")=List of 2
>    .. .. ..$ : chr [1:2] "s1" "s2"
>    .. .. ..$ : chr [1:2] "min" "max"
>    ..@ proj4string:Formal class 'CRS' [package "sp"] with 1 slots
>    .. .. ..@ projargs: chr NA
> >
> 
> > getGDALDriverNames()
>   [1] "GRASS"     "VRT"       "GTiff"     "NITF"      "HFA"       "SAR_CEOS"
>   [7] "CEOS"      "ELAS"      "AIG"       "AAIGrid"   "SDTS"      "OGDI"
> [13] "DTED"      "PNG"       "JPEG"      "MEM"       "JDEM"      "GIF"
> [19] "ESAT"      "BSB"       "XPM"       "BMP"       "AirSAR"    "RS2"
> [25] "PCIDSK"    "PCRaster"  "ILWIS"     "RIK"       "GMT"       "netCDF"
> [31] "HDF4"      "HDF4Image" "PNM"       "DOQ1"      "DOQ2"      "ENVI"
> [37] "EHdr"      "PAux"      "MFF"       "MFF2"      "FujiBAS"   "GSC"
> [43] "FAST"      "BT"        "LAN"       "CPG"       "IDA"       "NDF"
> [49] "JPEG2000"  "L1B"       "FIT"       "RMF"       "USGSDEM"   "GXF"
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From abunn at whrc.org  Tue Feb  7 16:08:37 2006
From: abunn at whrc.org (Andy Bunn)
Date: Tue, 7 Feb 2006 10:08:37 -0500
Subject: [R-sig-Geo] Writing a tif using rgdal
Message-ID: <NEBBIPHDAMMOKDKPOFFIGEENDPAA.abunn@whrc.org>

Howdy List:

I'm reading in a large number of satellite images and analyzing them in R. I
know how to read a tif into R using rgdal and manipulate it. Is there a good
way to write a new tif out using the projection data from the original?

So in the example below how can I write out z as a jpg using the metadata
and such from x?

-Andy


library(rgdal)
logo <- system.file("pictures/Rlogo.jpg", package="rgdal")[1]
x <- new("GDALReadOnlyDataset", logo)
displayDataset(x)
y <- getRasterData(x)
z <- rowMeans(y, dims=2)
dim(z)

> version
         _
platform i386-pc-mingw32
arch     i386
os       mingw32
system   i386, mingw32
status
major    2
minor    2.0
year     2005
month    10
day      06
svn rev  35749
language R



From Roger.Bivand at nhh.no  Tue Feb  7 20:19:40 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 7 Feb 2006 20:19:40 +0100 (CET)
Subject: [R-sig-Geo] Writing a tif using rgdal
In-Reply-To: <NEBBIPHDAMMOKDKPOFFIGEENDPAA.abunn@whrc.org>
Message-ID: <Pine.LNX.4.44.0602071954020.5276-100000@reclus.nhh.no>

On Tue, 7 Feb 2006, Andy Bunn wrote:

> Howdy List:
> 
> I'm reading in a large number of satellite images and analyzing them in R. I
> know how to read a tif into R using rgdal and manipulate it. Is there a good
> way to write a new tif out using the projection data from the original?
> 
> So in the example below how can I write out z as a jpg using the metadata
> and such from x?
> 
> -Andy
> 
> 
> library(rgdal)
> logo <- system.file("pictures/Rlogo.jpg", package="rgdal")[1]
> x <- new("GDALReadOnlyDataset", logo)
> displayDataset(x)
> y <- getRasterData(x)
> z <- rowMeans(y, dims=2)
> dim(z)

Taking a deep breath and remembering to do save.image() frequently 
[overwriting GDAL handles can give seg.faults]:

library(rgdal)
logo <- system.file("pictures/Rlogo.jpg", package="rgdal")[1]
x <- new("GDALReadOnlyDataset", logo)
displayDataset(x)
y <- getRasterData(x)
z <- rowMeans(y, dims=2)
dim(z)
GDAL.close(x)

tif_driver <- new("GDALDriver", "GTiff")
getDriverLongName(tif_driver)
tif2 <- new("GDALTransientDataset", tif_driver, 77, 101, 1, 'Float64')
bnd1 <- putRasterData(tif2, z)
displayDataset(tif2)
tif_file <- tempfile()
saveDataset(tif2, tif_file)
GDAL.close(tif2)
GDAL.close(tif_driver)
tif3 <- GDAL.open(tif_file)
displayDataset(tif3)
GDAL.close(tif3)

$ gdalinfo zlogo.tif
Driver: GTiff/GeoTIFF
Size is 101, 77
Coordinate System is `'
Corner Coordinates:
Upper Left  (    0.0,    0.0)
Lower Left  (    0.0,   77.0)
Upper Right (  101.0,    0.0)
Lower Right (  101.0,   77.0)
Center      (   50.5,   38.5)
Band 1 Block=101x10 Type=Float64, ColorInterp=Gray

(I was playing with filename zlogo.tif, it reads into GRASS OK, but 
that's using the same GDAL drivers.)

Well, it works, though it's a bit too exciting dodging the seg.faults 
coming from over-writing live object handles while experimenting. For 
determined users, deleteDataset() works too (oh yes!). I'll try to wrap it 
up to be a bit smoother. No world file yet, but I guess that could just be 
copied? Suggestions welcome.

Roger

> 
> > version
>          _
> platform i386-pc-mingw32
> arch     i386
> os       mingw32
> system   i386, mingw32
> status
> major    2
> minor    2.0
> year     2005
> month    10
> day      06
> svn rev  35749
> language R
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From tkeitt at mail.utexas.edu  Tue Feb  7 21:28:02 2006
From: tkeitt at mail.utexas.edu (Tim Keitt)
Date: Tue, 07 Feb 2006 14:28:02 -0600
Subject: [R-sig-Geo] Writing a tif using rgdal
In-Reply-To: <Pine.LNX.4.44.0602071954020.5276-100000@reclus.nhh.no>
References: <Pine.LNX.4.44.0602071954020.5276-100000@reclus.nhh.no>
Message-ID: <1139344082.28915.14.camel@patagonicus.keittlab.net>

I seem to remember writing a wrapper for the gdal copy function,
although none of that has be extensively tested. If you copy an existing
dataset to a writable dataset, you could then retrieve the data, operate
on it and write back to the new dataset. It should (?) then have all the
metadata copied from the original. Sorry, I didn't see in your code
where you were overwriting gdal pointers.

THK

On Tue, 2006-02-07 at 20:19 +0100, Roger Bivand wrote:
> On Tue, 7 Feb 2006, Andy Bunn wrote:
> 
> > Howdy List:
> > 
> > I'm reading in a large number of satellite images and analyzing them in R. I
> > know how to read a tif into R using rgdal and manipulate it. Is there a good
> > way to write a new tif out using the projection data from the original?
> > 
> > So in the example below how can I write out z as a jpg using the metadata
> > and such from x?
> > 
> > -Andy
> > 
> > 
> > library(rgdal)
> > logo <- system.file("pictures/Rlogo.jpg", package="rgdal")[1]
> > x <- new("GDALReadOnlyDataset", logo)
> > displayDataset(x)
> > y <- getRasterData(x)
> > z <- rowMeans(y, dims=2)
> > dim(z)
> 
> Taking a deep breath and remembering to do save.image() frequently 
> [overwriting GDAL handles can give seg.faults]:
> 
> library(rgdal)
> logo <- system.file("pictures/Rlogo.jpg", package="rgdal")[1]
> x <- new("GDALReadOnlyDataset", logo)
> displayDataset(x)
> y <- getRasterData(x)
> z <- rowMeans(y, dims=2)
> dim(z)
> GDAL.close(x)
> 
> tif_driver <- new("GDALDriver", "GTiff")
> getDriverLongName(tif_driver)
> tif2 <- new("GDALTransientDataset", tif_driver, 77, 101, 1, 'Float64')
> bnd1 <- putRasterData(tif2, z)
> displayDataset(tif2)
> tif_file <- tempfile()
> saveDataset(tif2, tif_file)
> GDAL.close(tif2)
> GDAL.close(tif_driver)
> tif3 <- GDAL.open(tif_file)
> displayDataset(tif3)
> GDAL.close(tif3)
> 
> $ gdalinfo zlogo.tif
> Driver: GTiff/GeoTIFF
> Size is 101, 77
> Coordinate System is `'
> Corner Coordinates:
> Upper Left  (    0.0,    0.0)
> Lower Left  (    0.0,   77.0)
> Upper Right (  101.0,    0.0)
> Lower Right (  101.0,   77.0)
> Center      (   50.5,   38.5)
> Band 1 Block=101x10 Type=Float64, ColorInterp=Gray
> 
> (I was playing with filename zlogo.tif, it reads into GRASS OK, but 
> that's using the same GDAL drivers.)
> 
> Well, it works, though it's a bit too exciting dodging the seg.faults 
> coming from over-writing live object handles while experimenting. For 
> determined users, deleteDataset() works too (oh yes!). I'll try to wrap it 
> up to be a bit smoother. No world file yet, but I guess that could just be 
> copied? Suggestions welcome.
> 
> Roger
> 
> > 
> > > version
> >          _
> > platform i386-pc-mingw32
> > arch     i386
> > os       mingw32
> > system   i386, mingw32
> > status
> > major    2
> > minor    2.0
> > year     2005
> > month    10
> > day      06
> > svn rev  35749
> > language R
> > 
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at stat.math.ethz.ch
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > 
> 
-- 
Timothy H. Keitt
Assistant Professor
http://www.keittlab.org/
http://www.utexas.edu/directory/index.php?q=Keitt



From Roger.Bivand at nhh.no  Tue Feb  7 22:25:41 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 7 Feb 2006 22:25:41 +0100 (CET)
Subject: [R-sig-Geo] Writing a tif using rgdal
In-Reply-To: <1139344082.28915.14.camel@patagonicus.keittlab.net>
Message-ID: <Pine.LNX.4.44.0602072200320.5276-100000@reclus.nhh.no>

On Tue, 7 Feb 2006, Tim Keitt wrote:

> I seem to remember writing a wrapper for the gdal copy function,
> although none of that has be extensively tested. If you copy an existing
> dataset to a writable dataset, you could then retrieve the data, operate
> on it and write back to the new dataset. It should (?) then have all the
> metadata copied from the original. 

Yes, copyDataset() is there, but won't it expect the type= argument to 
suit the data? My route as below lets you set up a transient dataset and 
then save it to a file, but I hadn't got the:

.Call("RGDAL_SetGeoTransform", dataset, numericvectorof6, PACKAGE="rgdal")

to set the starting point and cell sizes. I'll carry on trying.

> Sorry, I didn't see in your code
> where you were overwriting gdal pointers.
> 

No trouble - I think this hits me when I'm hurrying and I re-use a 
not-closed handle, filling it with another handle. I can't replicate now.

Roger

> THK
> 
> On Tue, 2006-02-07 at 20:19 +0100, Roger Bivand wrote:
> > On Tue, 7 Feb 2006, Andy Bunn wrote:
> > 
> > > Howdy List:
> > > 
> > > I'm reading in a large number of satellite images and analyzing them in R. I
> > > know how to read a tif into R using rgdal and manipulate it. Is there a good
> > > way to write a new tif out using the projection data from the original?
> > > 
> > > So in the example below how can I write out z as a jpg using the metadata
> > > and such from x?
> > > 
> > > -Andy
> > > 
> > > 
> > > library(rgdal)
> > > logo <- system.file("pictures/Rlogo.jpg", package="rgdal")[1]
> > > x <- new("GDALReadOnlyDataset", logo)
> > > displayDataset(x)
> > > y <- getRasterData(x)
> > > z <- rowMeans(y, dims=2)
> > > dim(z)
> > 
> > Taking a deep breath and remembering to do save.image() frequently 
> > [overwriting GDAL handles can give seg.faults]:
> > 
> > library(rgdal)
> > logo <- system.file("pictures/Rlogo.jpg", package="rgdal")[1]
> > x <- new("GDALReadOnlyDataset", logo)
> > displayDataset(x)
> > y <- getRasterData(x)
> > z <- rowMeans(y, dims=2)
> > dim(z)
> > GDAL.close(x)
> > 
> > tif_driver <- new("GDALDriver", "GTiff")
> > getDriverLongName(tif_driver)
> > tif2 <- new("GDALTransientDataset", tif_driver, 77, 101, 1, 'Float64')
> > bnd1 <- putRasterData(tif2, z)
> > displayDataset(tif2)
> > tif_file <- tempfile()
> > saveDataset(tif2, tif_file)
> > GDAL.close(tif2)
> > GDAL.close(tif_driver)
> > tif3 <- GDAL.open(tif_file)
> > displayDataset(tif3)
> > GDAL.close(tif3)
> > 
> > $ gdalinfo zlogo.tif
> > Driver: GTiff/GeoTIFF
> > Size is 101, 77
> > Coordinate System is `'
> > Corner Coordinates:
> > Upper Left  (    0.0,    0.0)
> > Lower Left  (    0.0,   77.0)
> > Upper Right (  101.0,    0.0)
> > Lower Right (  101.0,   77.0)
> > Center      (   50.5,   38.5)
> > Band 1 Block=101x10 Type=Float64, ColorInterp=Gray
> > 
> > (I was playing with filename zlogo.tif, it reads into GRASS OK, but 
> > that's using the same GDAL drivers.)
> > 
> > Well, it works, though it's a bit too exciting dodging the seg.faults 
> > coming from over-writing live object handles while experimenting. For 
> > determined users, deleteDataset() works too (oh yes!). I'll try to wrap it 
> > up to be a bit smoother. No world file yet, but I guess that could just be 
> > copied? Suggestions welcome.
> > 
> > Roger
> > 
> > > 
> > > > version
> > >          _
> > > platform i386-pc-mingw32
> > > arch     i386
> > > os       mingw32
> > > system   i386, mingw32
> > > status
> > > major    2
> > > minor    2.0
> > > year     2005
> > > month    10
> > > day      06
> > > svn rev  35749
> > > language R
> > > 
> > > _______________________________________________
> > > R-sig-Geo mailing list
> > > R-sig-Geo at stat.math.ethz.ch
> > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > > 
> > 
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From mfrankli at hsph.harvard.edu  Wed Feb  8 01:02:54 2006
From: mfrankli at hsph.harvard.edu (Meredith Franklin)
Date: Tue, 07 Feb 2006 19:02:54 -0500
Subject: [R-sig-Geo] problem with 'islands' in neighbourhood matrix
Message-ID: <43E9352E.8070504@hsph.harvard.edu>

I created a neighbourhood matrix in GeoDa and have read it into R using 
read.gal (spdep package).  I have a few zero-neighbour polygons and as a 
result I cannot apply nb2listw to my nb object.  Is there a way to get 
around this problem when reading in the .gal file or do these islands 
need to be removed before creating the matrix?
Thanks,
Meredith Franklin



From Roger.Bivand at nhh.no  Wed Feb  8 09:17:39 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 8 Feb 2006 09:17:39 +0100 (CET)
Subject: [R-sig-Geo] problem with 'islands' in neighbourhood matrix
In-Reply-To: <43E9352E.8070504@hsph.harvard.edu>
Message-ID: <Pine.LNX.4.44.0602080912150.6235-100000@reclus.nhh.no>

On Tue, 7 Feb 2006, Meredith Franklin wrote:

> I created a neighbourhood matrix in GeoDa and have read it into R using 
> read.gal (spdep package).  I have a few zero-neighbour polygons and as a 
> result I cannot apply nb2listw to my nb object.  Is there a way to get 
> around this problem when reading in the .gal file or do these islands 
> need to be removed before creating the matrix?

Functions in spdep use an argument called zero.policy=, set by default to 
FALSE, which stop you using neighbour or weights lists with zero-neighbour 
entities. You override this by saying zero.policy=TRUE.

An alternative is to subset your data and the neighbour list:

have_neighbours <- card(nb) > 0
sub_nb <- subset(nb, have_neighbours)
sub_data <- subset(data, have_neighbours)

So the problem can be handled internally. Finally, if you want to stitch 
them onto the graph of neighbours, have a look at ?edit.nb (you'll need 
the centroids of the polygons for this).

> Thanks,
> Meredith Franklin
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From tkeitt at mail.utexas.edu  Wed Feb  8 16:16:57 2006
From: tkeitt at mail.utexas.edu (Tim Keitt)
Date: Wed, 08 Feb 2006 09:16:57 -0600
Subject: [R-sig-Geo] Writing a tif using rgdal
In-Reply-To: <Pine.LNX.4.44.0602072200320.5276-100000@reclus.nhh.no>
References: <Pine.LNX.4.44.0602072200320.5276-100000@reclus.nhh.no>
Message-ID: <1139411817.4510.6.camel@patagonicus.keittlab.net>

On Tue, 2006-02-07 at 22:25 +0100, Roger Bivand wrote:
> No trouble - I think this hits me when I'm hurrying and I re-use a 
> not-closed handle, filling it with another handle. I can't replicate now.

Hmmm... I just realized that creating a raster band object and then
closing the associated dataset object might lead to all sorts of
fireworks. We may need some reference counting to avoid dereferencing
free'd pointers.

THK

-- 
Timothy H. Keitt
Assistant Professor
http://www.keittlab.org/
http://www.utexas.edu/directory/index.php?q=Keitt



From wl at eimb.ru  Wed Feb  8 17:23:08 2006
From: wl at eimb.ru (Wladimir Eremeev)
Date: Wed, 8 Feb 2006 19:23:08 +0300
Subject: [R-sig-Geo] envi clone in R
Message-ID: <172918418.20060208192308@eimb.ru>

Hello all,

  Research Systems (www.rsinc.com) have developed and distributes the language IDL,
  and the GIS ENVI, written in IDL.

  To my oppinion, R language is superior, compared to IDL, in all aspects.
  However, ENVI is the rather convenient and feature rich tool.

  Is anyone aware about any work, dedicated to the creation of
  something, similar to the ENVI, but in R?
  
  Also, recently, the R bindings to the GTK library have appeared...

---
Best regards,
Wladimir                mailto:wl at eimb.ru



From B.Rowlingson at lancaster.ac.uk  Wed Feb  8 19:09:19 2006
From: B.Rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Wed, 08 Feb 2006 18:09:19 +0000
Subject: [R-sig-Geo] envi clone in R
In-Reply-To: <172918418.20060208192308@eimb.ru>
References: <172918418.20060208192308@eimb.ru>
Message-ID: <43EA33CF.3080605@lancaster.ac.uk>

Wladimir Eremeev wrote:
> Hello all,
> 
>   Research Systems (www.rsinc.com) have developed and distributes the language IDL,
>   and the GIS ENVI, written in IDL.

  I find it hard to believe they wrote it all in IDL! I'm guessing its 
probably scriptable in IDL, but underneath its written in something 
else... I could be wrong though!

>   To my oppinion, R language is superior, compared to IDL, in all aspects.
>   However, ENVI is the rather convenient and feature rich tool.

  I clicked on 'Product Documentation' on the ENVI site and it wanted me 
to log in or create a new user. To see the documentation? To find out 
what the program is about?

  Oh, what I really wanted was the Feature Tour..

>   Is anyone aware about any work, dedicated to the creation of
>   something, similar to the ENVI, but in R?

  Last year I looked at GIS-R linkages, with the added criteria of being 
open source and cross-platform. There are now a few free GIS packages 
that can do this kind of thing, with a little added glue.

  I settled on OpenEV - it has vector and raster support, its extensible 
in Python and uses Gtk for dialogs which you can customise. All I needed 
was to get Python talking to R, so I wrote some Python bindings to 
Rserve. Now I've got a GIS with a menu that drops down, you choose the 
point layers you want to work on, click 'Go', and R does some analysis 
that ends up as a raster layer back in the GIS. The user doesnt care 
that R did it.

Other GIS solutions are available!

Barry



From ari.jolma at tkk.fi  Wed Feb  8 20:57:55 2006
From: ari.jolma at tkk.fi (Ari Jolma)
Date: Wed, 08 Feb 2006 21:57:55 +0200
Subject: [R-sig-Geo] Writing a tif using rgdal
In-Reply-To: <1139411817.4510.6.camel@patagonicus.keittlab.net>
References: <Pine.LNX.4.44.0602072200320.5276-100000@reclus.nhh.no>
	<1139411817.4510.6.camel@patagonicus.keittlab.net>
Message-ID: <43EA4D43.7070701@tkk.fi>

Tim Keitt kirjoitti:
> On Tue, 2006-02-07 at 22:25 +0100, Roger Bivand wrote:
>   
>> No trouble - I think this hits me when I'm hurrying and I re-use a 
>> not-closed handle, filling it with another handle. I can't replicate now.
>>     
>
> Hmmm... I just realized that creating a raster band object and then
> closing the associated dataset object might lead to all sorts of
> fireworks. We may need some reference counting to avoid dereferencing
> free'd pointers.
>   

I guess the fireworks is caused by gdal? This was discussed at length on 
the gdal-dev list in the fall. There is no easy way the fix this. 
Currently the best solution is to be careful with things like this.

Ari Jolma

> THK
>
>   


-- 
Prof. Ari Jolma
Kartografia ja Geoinformatiikka / Cartography and Geoinformatics
Teknillinen Korkeakoulu / Helsinki University of Technology
POBox 1200, 02015 TKK, Finland
Email: ari.jolma at tkk.fi URL: http://www.tkk.fi/~jolma



From pierces1 at msu.edu  Wed Feb  8 22:07:48 2006
From: pierces1 at msu.edu (Steven J. Pierce)
Date: Wed, 8 Feb 2006 16:07:48 -0500
Subject: [R-sig-Geo] Small sample sizes & Bayesian rates for zonal data
Message-ID: <000801c62cf3$b908e200$babe0b18@Maelstrom>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20060208/2d2f3351/attachment.pl>

From tkeitt at mail.utexas.edu  Wed Feb  8 22:09:03 2006
From: tkeitt at mail.utexas.edu (Tim Keitt)
Date: Wed, 08 Feb 2006 15:09:03 -0600
Subject: [R-sig-Geo] Writing a tif using rgdal
In-Reply-To: <43EA4D43.7070701@tkk.fi>
References: <Pine.LNX.4.44.0602072200320.5276-100000@reclus.nhh.no>
	<1139411817.4510.6.camel@patagonicus.keittlab.net>
	<43EA4D43.7070701@tkk.fi>
Message-ID: <1139432943.10999.21.camel@patagonicus.keittlab.net>

I'm holding out for the Boost Geospatial Library... :-)

THK

On Wed, 2006-02-08 at 21:57 +0200, Ari Jolma wrote:
> Tim Keitt kirjoitti:
> > On Tue, 2006-02-07 at 22:25 +0100, Roger Bivand wrote:
> >   
> >> No trouble - I think this hits me when I'm hurrying and I re-use a 
> >> not-closed handle, filling it with another handle. I can't replicate now.
> >>     
> >
> > Hmmm... I just realized that creating a raster band object and then
> > closing the associated dataset object might lead to all sorts of
> > fireworks. We may need some reference counting to avoid dereferencing
> > free'd pointers.
> >   
> 
> I guess the fireworks is caused by gdal? This was discussed at length on 
> the gdal-dev list in the fall. There is no easy way the fix this. 
> Currently the best solution is to be careful with things like this.
> 
> Ari Jolma
> 
> > THK
> >
> >   
> 
> 
-- 
Timothy H. Keitt
Assistant Professor
http://www.keittlab.org/
http://www.utexas.edu/directory/index.php?q=Keitt



From tkeitt at mail.utexas.edu  Wed Feb  8 22:13:44 2006
From: tkeitt at mail.utexas.edu (Tim Keitt)
Date: Wed, 08 Feb 2006 15:13:44 -0600
Subject: [R-sig-Geo] envi clone in R
In-Reply-To: <43EA33CF.3080605@lancaster.ac.uk>
References: <172918418.20060208192308@eimb.ru>
	<43EA33CF.3080605@lancaster.ac.uk>
Message-ID: <1139433224.10999.26.camel@patagonicus.keittlab.net>

Barry,

I hope you will share your code! We've been using QGIS and I have in
mind just such an interface to R.

We have ENVI in the lab and it is very powerful for image processing. It
would take many many person years to reproduce all of the advanced
algorithms in that package. (It does a lot of simple operations as well
and those could easily be recoded in R.)

THK

On Wed, 2006-02-08 at 18:09 +0000, Barry Rowlingson wrote:
> Wladimir Eremeev wrote:
> > Hello all,
> > 
> >   Research Systems (www.rsinc.com) have developed and distributes the language IDL,
> >   and the GIS ENVI, written in IDL.
> 
>   I find it hard to believe they wrote it all in IDL! I'm guessing its 
> probably scriptable in IDL, but underneath its written in something 
> else... I could be wrong though!
> 
> >   To my oppinion, R language is superior, compared to IDL, in all aspects.
> >   However, ENVI is the rather convenient and feature rich tool.
> 
>   I clicked on 'Product Documentation' on the ENVI site and it wanted me 
> to log in or create a new user. To see the documentation? To find out 
> what the program is about?
> 
>   Oh, what I really wanted was the Feature Tour..
> 
> >   Is anyone aware about any work, dedicated to the creation of
> >   something, similar to the ENVI, but in R?
> 
>   Last year I looked at GIS-R linkages, with the added criteria of being 
> open source and cross-platform. There are now a few free GIS packages 
> that can do this kind of thing, with a little added glue.
> 
>   I settled on OpenEV - it has vector and raster support, its extensible 
> in Python and uses Gtk for dialogs which you can customise. All I needed 
> was to get Python talking to R, so I wrote some Python bindings to 
> Rserve. Now I've got a GIS with a menu that drops down, you choose the 
> point layers you want to work on, click 'Go', and R does some analysis 
> that ends up as a raster layer back in the GIS. The user doesnt care 
> that R did it.
> 
> Other GIS solutions are available!
> 
> Barry
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
-- 
Timothy H. Keitt
Assistant Professor
http://www.keittlab.org/
http://www.utexas.edu/directory/index.php?q=Keitt



From mreisman at isis.wu-wien.ac.at  Wed Feb  8 23:38:14 2006
From: mreisman at isis.wu-wien.ac.at (Martin Reismann)
Date: Wed, 8 Feb 2006 23:38:14 +0100
Subject: [R-sig-Geo] 2 problems with errorsarlm(method="SparseM")
In-Reply-To: <Pine.LNX.4.44.0602012004320.7295-100000@reclus.nhh.no>
References: <Pine.A32.3.96.1060201173231.179736A-100000@isis.wu-wien.ac.at>
	<Pine.LNX.4.44.0602012004320.7295-100000@reclus.nhh.no>
Message-ID: <cb44df220602081438p6ee88030ja1e3d43ebf8f2109@mail.gmail.com>

Roger kindly provided solutions for both problems.
I write a short summary for the interested public:

> (1) When running a large SAR (weight matrix 12544 * 12544) with errorsarlm
> and SparseM-method I ran into this error message:
>
> > Error in .local(x, ...) : Increase nnzlmax
> > Error in det(chol((I - lambda * csrw), tmpmax = tmpmax)) :
> >         unable to find the argument 'x' in selecting a method for function 'det'

Quoting Roger Bivand:
> After making changes, the ML functions have a new argument allowing the
> memory allocation arguments for sparse Cholesky can be passed through and
> the defaults have been made larger.
> ...
> I'm attaching a draft source package for you to try out - see the help
> page for details on passing the arguments through cholAlloc=; in the
> defaults I've used multiples of sum(card(listw$neighbours)), the number of
> non-zero elements in the matrix.

The draft source package is spdep_0.3-20.tar.gz and most likely available
from Roger.


> (2) Being able to use mat2listw instead of nb2listw would be preferable
> because mat2listw allows matrix elements different from 0 and 1.

the glist= argument to nb2listw() allows to assign a weight to every
2-tuple of neighbours. Thus it can be used instead of mat2listw() for
preparing listw-objects for errorsarlm.

--
Mag. Martin Reismann
c/o
Institut fuer Wirtschaftsgeographie und Geoinformatik
Wirtschaftsuniversitaet Wien
Nordbergstrasse 15, 4. Stock, Kern A
A-1090 Wien

EMail: Martin.Reismann at wu-wien.ac.at
Tel +43-(0)-1-31336-5720
Fax +43-(0)-1-31336-703



From wl at eimb.ru  Thu Feb  9 08:58:28 2006
From: wl at eimb.ru (Wladimir Eremeev)
Date: Thu, 9 Feb 2006 10:58:28 +0300
Subject: [R-sig-Geo] envi clone in R
In-Reply-To: <43EA33CF.3080605@lancaster.ac.uk>
References: <172918418.20060208192308@eimb.ru>
	<43EA33CF.3080605@lancaster.ac.uk>
Message-ID: <5810595588.20060209105828@eimb.ru>

Dear Barry,

Wednesday, February 8, 2006, 9:09:19 PM, you wrote:

BR> Wladimir Eremeev wrote:
>> Hello all,
>> 
>>   Research Systems (www.rsinc.com) have developed and distributes the language IDL,
>>   and the GIS ENVI, written in IDL.

BR>   I find it hard to believe they wrote it all in IDL! I'm guessing its
BR> probably scriptable in IDL, but underneath its written in something
BR> else... I could be wrong though!

Well, not in IDL completely, I think, there is also C and Fortran code
underneath.

>>   To my oppinion, R language is superior, compared to IDL, in all aspects.
>>   However, ENVI is the rather convenient and feature rich tool.

By the way, even the interface to an external code is implemented in R
much more conveniently, compared to IDL.
It took me several hours to make IDL to call my C functions from DLL.
I have read the documentation carefully 2 or 3 times...

And I have done the same task in R in several minutes.

---
Best regards,
Wladimir                mailto:wl at eimb.ru



From wl at eimb.ru  Thu Feb  9 09:51:11 2006
From: wl at eimb.ru (Wladimir Eremeev)
Date: Thu, 9 Feb 2006 11:51:11 +0300
Subject: [R-sig-Geo] envi clone in R
In-Reply-To: <43EA33CF.3080605@lancaster.ac.uk>
References: <172918418.20060208192308@eimb.ru>
	<43EA33CF.3080605@lancaster.ac.uk>
Message-ID: <1574214371.20060209115111@eimb.ru>

Dear Barry,

By the way...
BR>   I settled on OpenEV - it has vector and raster support, its extensible
BR> in Python and uses Gtk for dialogs which you can customise.

I have seen OpenEV.
Unfortunately, I could not find a documentation or user guide for
quick start and had not too much time to realize what is what and
how to use its features with 'mouse point-and-click' :)

Do you have a link to such a document?

---
Best regards,
Wladimir                mailto:wl at eimb.ru



From creemts at TNC.ORG  Fri Feb 10 21:52:45 2006
From: creemts at TNC.ORG (Charlotte Reemts)
Date: Fri, 10 Feb 2006 14:52:45 -0600
Subject: [R-sig-Geo] envelopes for Kcross
Message-ID: <IHEPIDGPPELJMBFKIEBAEEPOCAAA.creemts@tnc.org>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20060210/8f00d3bc/attachment.pl>

From adrian at maths.uwa.edu.au  Mon Feb 13 03:31:24 2006
From: adrian at maths.uwa.edu.au (Adrian Baddeley)
Date: Mon, 13 Feb 2006 10:31:24 +0800
Subject: [R-sig-Geo] R-sig-Geo Digest, Vol 30, Issue 6
In-Reply-To: <mailman.15.1139655604.32453.r-sig-geo@stat.math.ethz.ch>
References: <mailman.15.1139655604.32453.r-sig-geo@stat.math.ethz.ch>
Message-ID: <17391.61308.580246.549960@maths.uwa.edu.au>


Charlotte Reemts writes:

 > I am conducting an analysis on disease spread in oak trees.  I have the
 > locations of symptomatic trees for two years (2004 and 2005) in an
 > irregularly-shaped polygon and want to know whether there is attraction or
 > repulsion between the two years.  The symptomatic trees are clustered within
 > a year.

 > I used Kcross to calculate the K statistic for my data

     First a warning. The usual interpretation of the bivariate K function is
     probably not appropriate in this application.
     It would not be appropriate to draw conclusions by 
     comparing the computed Kcross function with the curve K(r) = pi r^2.
     The trees do not move from year to year (oder?). 
     Presumably it is possible for a given tree to be symptomatic 
     in both years. So the two point patterns may share points in common.
     So the usual assumptions for the bivariate K function are false.
     
 > and would like to calculate simulation/confidence envelopes (for
 > the univariate data, I used Kenv). 

     OK, you can of course do a Monte Carlo test (using the envelopes)

 > I tried using Kenv.label, but based on my reading of the
 > literature, random labelling is not the appropriate test (see
 > Goreaud and Pelissier, 2003, Journal of Vegetation Science).
 > I cannot use Kenv.tor because my study area is not rectangular.

 > Next, I tried using this code:
 > kcross.envelope<-envelope(my.data, Kcross, correction="translate", nsim=99)

 > The result I get is reasonable, but I would like more information on how
 > 'envelope' generates the envelopes (and how it labels the points) and
 > whether this is an appropriate test for my data.

   envelope() is a function in the library `spatstat'. 

   help(envelope) explains that the random patterns used to calculate
   the envelopes are, **by default**, generated from a Poisson process
   with the same intensity as the data point pattern. If the data are
   a marked point pattern, this means that the random patterns are
   realisations of a Poisson MARKED point process - in other words,
   the locations of the points are Poisson (CSR), and their marks are
   independent random marks. The random patterns are
   randomly-labelled, completely random patterns.

   If this default behaviour is not what you want,
   then use the argument 'simulate' (of the envelope() function)
   to specify how you want the random patterns to be generated. 

   For example, if you wanted to randomly relabel the existing data pattern
   without changing the point locations, 

	   envelope(mydata, Kcross, simulate=expression(rlabel(mydata)))

   [Warning: this is in spatstat - be careful of the conflict with the 
   command 'rlabel' in splancs]

   > I cannot use Kenv.tor because my
   > study area is not rectangular.

   Apparently you want to generate envelopes based on randomly shifting
   the existing data pattern (points of each type shifted separately).

   The following will work (in spatstat). 

          rsh <- function(X, d) {
	      W <- X$window
	      B <- bounding.box(W)
	      XB <- X[,B]
	      Y <- rtoro(XB, radius=d)
	      Be <- erode.owin(W, d)
	      Y <- Y[,Be]
	      return(Y)
	      }

          rad <- 25
	  W <- rsh(mydata, rad)$window
	  M <- mydata[,W]

	  envelope(M, Kcross, simulate=expression(rsh(mydata, rad)))

   The new function rsh(X, d) applies random shifts
   to the sub-patterns of points of each type, with a maximum shift
   distance of d units (change this value 'rad' to a reasonable distance
   for your data). It returns a point pattern whose observation window
   has been eroded by a distance of d units. Thus, no toroidal wrapping
   is needed, and this function works even if X has a non-rectangular window.

   The point pattern M is just the restriction of 'mydata' to the 
   same eroded window, so that comparisons of the Kcross values are
   meaningful.

   This will become easier in spatstat 1.9.

HTH
Adrian Baddeley



From kissling at uni-mainz.de  Mon Feb 13 11:21:22 2006
From: kissling at uni-mainz.de (W. Daniel Kissling)
Date: Mon, 13 Feb 2006 11:21:22 +0100
Subject: [R-sig-Geo] envelopes for Kcross
In-Reply-To: <IHEPIDGPPELJMBFKIEBAEEPOCAAA.creemts@tnc.org>
Message-ID: <43F06BB2.31705.1FECE9@localhost>

Dear Charlotte Reemts & R users,

I have not used R to analyse point pattern, but I have done point pattern analyses with 
another free software called "Programita". If you are interested in it, see

http://www.thorsten-wiegand.de/towi_programita.html

There are also two articles I would recommend to read:

Wiegand T., and K. A. Moloney 2004. Rings, circles and null-models for point pattern 
analysis in ecology. Oikos 104: 209-229.

Wiegand, T., Kissling, W.D., Cipriotti, P.A., and Aguiar, M.R. 2006. Extending point 
pattern analysis to objects of finite size and irregular shape. Journal of Ecology, in 
press.

The latter one is in press in the Journal of Ecology. I can provide a preprint if you are 
interested in it.

Best regards
Daniel


--------------------------------------------------------------------
W. Daniel Kissling
Community & Macroecology Group
Institut f?r Zoologie, Abteilung ?kologie
Johannes Gutenberg-Universit?t Mainz
D-55099 Mainz, Germany

Tel. +49 (0)6131 3925200; Fax +49 (0)6131 3923731
e-mail: kissling at uni-mainz.de
web: http://www.oekologie.biologie.uni-mainz.de/people/daniel/main.html



From m_nica at hotmail.com  Thu Feb 16 12:16:53 2006
From: m_nica at hotmail.com (Mihai Nica)
Date: Thu, 16 Feb 2006 05:16:53 -0600
Subject: [R-sig-Geo] Map legend
Message-ID: <BAY105-F15AB778D608A8F3108E5E4F8FB0@phx.gbl>

Greetings:

I am unable to change the color to some sort of a gray scale in a map. Also, 
I have a hard time adding a meaningful legend to it. These must be ?for 
dummies? question. Looked it up everywhere, but could not find a solution 
(not even a similar question). The map is:


a=read.shape("Density.shp", dbf.data=TRUE, verbose=TRUE)
plot.Map(a, auxvar=pidg$AVG_IGR, xlab="AVG_IGR quintiles", ylab=" ",ol="NA", 
color="blue", nclass=4)

if I change:

color=?gray? or ?black?

Error in hsv(rep(color.list$hsvcol[cind], nclass), c(pr, 1)) :
        bad hsv to rgb color conversion

I am running last R in XP updated.

If anybody has a moment, I appreciate it a lot,


Mihai Nica

_________________________________________________________________
Don?t just search. Find. Check out the new MSN Search!



From Roger.Bivand at nhh.no  Thu Feb 16 13:18:45 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 16 Feb 2006 13:18:45 +0100 (CET)
Subject: [R-sig-Geo] Map legend
In-Reply-To: <BAY105-F15AB778D608A8F3108E5E4F8FB0@phx.gbl>
Message-ID: <Pine.LNX.4.44.0602161252040.813-100000@reclus.nhh.no>

On Thu, 16 Feb 2006, Mihai Nica wrote:

> Greetings:
> 
> I am unable to change the color to some sort of a gray scale in a map. Also, 
> I have a hard time adding a meaningful legend to it. These must be ?for 
> dummies? question. Looked it up everywhere, but could not find a solution 
> (not even a similar question). The map is:
> 
> 
> a=read.shape("Density.shp", dbf.data=TRUE, verbose=TRUE)
> plot.Map(a, auxvar=pidg$AVG_IGR, xlab="AVG_IGR quintiles", ylab=" ",ol="NA", 
> color="blue", nclass=4)
> 
> if I change:
> 
> color=?gray? or ?black?
> 
> Error in hsv(rep(color.list$hsvcol[cind], nclass), c(pr, 1)) :
>         bad hsv to rgb color conversion

It is much easier to use plot() methods for SpatialPolygon objects, and
those methods will be maintained, but plot.Map() isn't going anywhere - 
it tries to do too much with the wrong kinds of objects. 

The help page even explains that you can pass a vector of arbitrary
colours through the fg= argument. The reason for the color argument not
working is that only c("blue", "green", "yellow", "red") are allowed in
its internal color.ramp() function - it is hardcoded, and unnecessary now
that alternatives are available.

Here are the problems:

library(maptools)
x <- read.shape(system.file("shapes/sids.shp", package="maptools")[1])
plot.Map(x, auxvar=x$att.data$BIR74, ol=NA, color="blue", nclass=4) 
plot.Map(x, auxvar=x$att.data$BIR74, ol=NA, color="grey", nclass=4) 

because "grey" isn't in the hardwired list. But using the wonderful
colorRampPalette() function, rolling your own colours is easy, here 100
for one per county:

grays <- colorRampPalette(c("grey90", "grey10"))(100)
plot.Map(x, fg=grays[rank(x$att.data$BIR74)], ol=NA)

or four classes:

moregrays <- colorRampPalette(c("grey90", "grey10"))(4)
brks <- quantile(x$att.data$BIR74)
plot.Map(x, fg=moregrays[findInterval(x$att.data$BIR74, brks, 
  all.inside=TRUE)], ol=NA)

All of the maintained plot() methods - for old-style polylists and new 
style SpatialPolygons use external breaks and colours, because user needs 
differ and advances in R itself (like colorRampPalette()) mean that 
hardwiring things is not a robust option.

If maps need to be re-created often from the same arguments, a custom
function (placing the legend, choosing label sizes and placings, etc.) is
thw way to go using the ingredients above - a custom palette, custom
breaks - for instance using the same breaks on many different data sets,
and findInterval() for continuous-valued variables, and (with care)
as.integer() of factors for categorical variables.

Hope this helps - I think plot.Map will get a "deprecated" warning fairly 
soon!

> 
> I am running last R in XP updated.
> 
> If anybody has a moment, I appreciate it a lot,
> 
> 
> Mihai Nica
> 
> _________________________________________________________________
> Don?t just search. Find. Check out the new MSN Search!
> 
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From Asset_Ratio_golds at gmail.com  Wed Feb 22 18:14:41 2006
From: Asset_Ratio_golds at gmail.com (Garland Pearson)
Date: Wed, 22 Feb 2006 11:14:41 -0600
Subject: [R-sig-Geo] HRVEW  Harvey Electronics
Message-ID: <144818660459.XAA13898Asset_Ratio_golds@gmail.com>

Mikel,

HRVEW  Harvey Electronics - http://in.geocities.com/gradus71582

Garland Pearson
Acct. Rep. v5089984



From ahertel at atmos.uiuc.edu  Wed Feb 22 18:21:34 2006
From: ahertel at atmos.uiuc.edu (Anne Hertel)
Date: Wed, 22 Feb 2006 11:21:34 -0600
Subject: [R-sig-Geo] Polar mapping
Message-ID: <web-7555935@atmos.uiuc.edu>

Hi,

I have some geographical data for the Northern Hemisphere. It is a rectangular matrix with longitudes and latitudes. I would like to plot that so the resulting plot is a circle centered on the North Pole with contours, so you only see the Northern Hemisphere. Also I would like to overlay that with a map of the Northern Hemisphere continents.
Does anybody know if it is possible to create plots like that in R?

Thanks Anne Hertel


------------------------------------------------------------
Anne M. K. Hertel
Grad. Student & Research Assistant
Department of Atmospheric Sciences
University of Illinois at Urbana-Champaign
Annex II, room 204
Phone: (217) 333 6296



From Roger.Bivand at nhh.no  Wed Feb 22 19:49:17 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 22 Feb 2006 19:49:17 +0100 (CET)
Subject: [R-sig-Geo] Polar mapping
In-Reply-To: <web-7555935@atmos.uiuc.edu>
Message-ID: <Pine.LNX.4.44.0602221923370.30068-100000@reclus.nhh.no>

On Wed, 22 Feb 2006, Anne Hertel wrote:

> Hi,
> 
> I have some geographical data for the Northern Hemisphere. It is a
> rectangular matrix with longitudes and latitudes. I would like to plot
> that so the resulting plot is a circle centered on the North Pole with
> contours, so you only see the Northern Hemisphere. Also I would like to
> overlay that with a map of the Northern Hemisphere continents. Does
> anybody know if it is possible to create plots like that in R?

If the image at the foot of the spproj section of this:

http://r-spatial.sourceforge.net/xtra/xtra.RHnw.html

is anything like what you need, you'll see some code there for projecting 
an image (by making the rectangular grid cells into polygons). Projecting 
contours should work too - create them as a SpatialLinesDataFrame first 
with for example sp function contourLines2SLDF().

Which platform are you using? The spproj functions will soon(ish) become 
available in the rgdal package, which may make things easier.

> 
> Thanks Anne Hertel
> 
> 
> ------------------------------------------------------------
> Anne M. K. Hertel
> Grad. Student & Research Assistant
> Department of Atmospheric Sciences
> University of Illinois at Urbana-Champaign
> Annex II, room 204
> Phone: (217) 333 6296
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From osgis.lists at gmail.com  Fri Feb 24 20:08:50 2006
From: osgis.lists at gmail.com (David Bitner)
Date: Fri, 24 Feb 2006 13:08:50 -0600
Subject: [R-sig-Geo] Natural Breaks Classification
Message-ID: <71c3c6c50602241108p53a65c4bv7f2894c0b4310b60@mail.gmail.com>

I am trying to create some type of a Natural Breaks Classification in
PL/R  to classify data that I have in a PostgreSQL/PostGIS database. 
All that I really need so that I can pass information on to Mapserver
to display this data is the class break values (ie an array [3,5,7,9]
would mean show values 1-3 in blue, 4-5 in red, etc.).  I am
completely new to R, but have a fair bit of experience with the other
PL's in PostgreSQL, so the PL part shouldn't be too hard to figure
out.

I am thinking that kmeans should give me something close to what I
want.  My problem is that I am not quite sure to massage the output to
get my class breaks or what format to input the data.

For arguments, kmeans takes a matrix, number of classes, and a max
number of iterations --
last two are easy, but how do I convert (do I need to convert) an
array into a matrix (is matrix just R speak for an array?)  I will be
starting with a one dimension array ie ([1,4,1,1,1,6,4,9,9]).

The next issue is spitting the data out.  The docs tell me that I get
the centers of the clusters where what I really want are the
boundaries of the clusters, how could I get at the "break points" that
I am after?

Any help is appreciated,
David



From Roger.Bivand at nhh.no  Fri Feb 24 21:03:46 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 24 Feb 2006 21:03:46 +0100 (CET)
Subject: [R-sig-Geo] Natural Breaks Classification
In-Reply-To: <71c3c6c50602241108p53a65c4bv7f2894c0b4310b60@mail.gmail.com>
Message-ID: <Pine.LNX.4.44.0602242051430.14105-100000@reclus.nhh.no>

On Fri, 24 Feb 2006, David Bitner wrote:

> I am trying to create some type of a Natural Breaks Classification in
> PL/R  to classify data that I have in a PostgreSQL/PostGIS database. 
> All that I really need so that I can pass information on to Mapserver
> to display this data is the class break values (ie an array [3,5,7,9]
> would mean show values 1-3 in blue, 4-5 in red, etc.).  I am
> completely new to R, but have a fair bit of experience with the other
> PL's in PostgreSQL, so the PL part shouldn't be too hard to figure
> out.
> 
> I am thinking that kmeans should give me something close to what I
> want.  My problem is that I am not quite sure to massage the output to
> get my class breaks or what format to input the data.
> 
> For arguments, kmeans takes a matrix, number of classes, and a max
> number of iterations --
> last two are easy, but how do I convert (do I need to convert) an
> array into a matrix (is matrix just R speak for an array?)  I will be
> starting with a one dimension array ie ([1,4,1,1,1,6,4,9,9]).
> 
> The next issue is spitting the data out.  The docs tell me that I get
> the centers of the clusters where what I really want are the
> boundaries of the clusters, how could I get at the "break points" that
> I am after?

I think you may find some of the code in:

http://spatial.nhh.no/papers/aag04.pdf

useful (though dated). kmeans() and - my preference - bclust() in the 
e1071 package may fail when given too few values, but there are ways round 
that. You'll see code (for example at the top of p. 15) on how to get the 
class centres out - but they - as done there - still leave gaps between 
classes as can be seen from the ECDF plot below. As you can see, kmeans() 
manages with a vector OK.

It would be nice to follow this up as a single function - input the data 
vector and some preferences wrt. number of classes, and output as a number 
of (list of) class intervals with some fitness criterion, something like 
that?

I guess your colour palette is on the PL side?

Roger

> 
> Any help is appreciated,
> David
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From osgis.lists at gmail.com  Fri Feb 24 21:27:41 2006
From: osgis.lists at gmail.com (David Bitner)
Date: Fri, 24 Feb 2006 14:27:41 -0600
Subject: [R-sig-Geo] Natural Breaks Classification
In-Reply-To: <Pine.LNX.4.44.0602242051430.14105-100000@reclus.nhh.no>
References: <71c3c6c50602241108p53a65c4bv7f2894c0b4310b60@mail.gmail.com>
	<Pine.LNX.4.44.0602242051430.14105-100000@reclus.nhh.no>
Message-ID: <71c3c6c50602241227m57a5d62bie12e75089c755d53@mail.gmail.com>

I was actually already using that paper as a resource, but I am still
not quite understanding how to get just the breaks that I can use for
classification in an external mapping application.

Right now I am trying out some samples just to understand what's going on.

Using this array:
a<-c(11,1,3,3,4,4,4,4,4,4,5)
This gives me the vector (3,1,1,1,2,2,2,2,2,2,2)

ideally I want the output for this to be just (3,5,11)

Taking this with the min/max of my data I can create the classes
1-3,4-5,6-11



On 2/24/06, Roger Bivand <Roger.Bivand at nhh.no> wrote:
> On Fri, 24 Feb 2006, David Bitner wrote:
>
> > I am trying to create some type of a Natural Breaks Classification in
> > PL/R  to classify data that I have in a PostgreSQL/PostGIS database.
> > All that I really need so that I can pass information on to Mapserver
> > to display this data is the class break values (ie an array [3,5,7,9]
> > would mean show values 1-3 in blue, 4-5 in red, etc.).  I am
> > completely new to R, but have a fair bit of experience with the other
> > PL's in PostgreSQL, so the PL part shouldn't be too hard to figure
> > out.
> >
> > I am thinking that kmeans should give me something close to what I
> > want.  My problem is that I am not quite sure to massage the output to
> > get my class breaks or what format to input the data.
> >
> > For arguments, kmeans takes a matrix, number of classes, and a max
> > number of iterations --
> > last two are easy, but how do I convert (do I need to convert) an
> > array into a matrix (is matrix just R speak for an array?)  I will be
> > starting with a one dimension array ie ([1,4,1,1,1,6,4,9,9]).
> >
> > The next issue is spitting the data out.  The docs tell me that I get
> > the centers of the clusters where what I really want are the
> > boundaries of the clusters, how could I get at the "break points" that
> > I am after?
>
> I think you may find some of the code in:
>
> http://spatial.nhh.no/papers/aag04.pdf
>
> useful (though dated). kmeans() and - my preference - bclust() in the
> e1071 package may fail when given too few values, but there are ways round
> that. You'll see code (for example at the top of p. 15) on how to get the
> class centres out - but they - as done there - still leave gaps between
> classes as can be seen from the ECDF plot below. As you can see, kmeans()
> manages with a vector OK.
>
> It would be nice to follow this up as a single function - input the data
> vector and some preferences wrt. number of classes, and output as a number
> of (list of) class intervals with some fitness criterion, something like
> that?
>
> I guess your colour palette is on the PL side?
>
> Roger
>
> >
> > Any help is appreciated,
> > David
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at stat.math.ethz.ch
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
>
> --
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>
>



From Roger.Bivand at nhh.no  Fri Feb 24 22:49:51 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 24 Feb 2006 22:49:51 +0100 (CET)
Subject: [R-sig-Geo] Natural Breaks Classification
In-Reply-To: <71c3c6c50602241227m57a5d62bie12e75089c755d53@mail.gmail.com>
Message-ID: <Pine.LNX.4.44.0602242232350.14105-100000@reclus.nhh.no>

On Fri, 24 Feb 2006, David Bitner wrote:

> I was actually already using that paper as a resource, but I am still
> not quite understanding how to get just the breaks that I can use for
> classification in an external mapping application.
> 
> Right now I am trying out some samples just to understand what's going on.
> 
> Using this array:
> a<-c(11,1,3,3,4,4,4,4,4,4,5)
> This gives me the vector (3,1,1,1,2,2,2,2,2,2,2)
> 
> ideally I want the output for this to be just (3,5,11)
> 
> Taking this with the min/max of my data I can create the classes
> 1-3,4-5,6-11
> 

Next line on p. 15:

> a<-c(11,1,3,3,4,4,4,4,4,4,5)
> av <- kmeans(a, 3)
> str(av)
List of 4
 $ cluster : int [1:11] 3 1 1 1 2 2 2 2 2 2 ...
 $ centers : num [1:3, 1]  2.33  4.14 11.00
  ..- attr(*, "dimnames")=List of 2
  .. ..$ : chr [1:3] "1" "2" "3"
  .. ..$ : NULL
 $ withinss: num [1:3] 2.667 0.857 0.000
 $ size    : int [1:3] 3 7 1
 - attr(*, "class")= chr "kmeans"
> cols <- match(av$cluster, order(av$centers))
> cols
 [1] 3 1 1 1 2 2 2 2 2 2 2
> stbrks <- matrix(unlist(tapply(a, factor(cols), range)), ncol = 2, 
+ byrow = TRUE)
> stbrks
     [,1] [,2]
[1,]    1    3
[2,]    4    5
[3,]   11   11

which then needs unpacking:

> apply(stbrks, 1, function(x) paste(x, collapse="-"))
[1] "1-3"   "4-5"   "11-11"

but which isn't pretty, because there is a gap. As plot(ecdf(jitter(a)),
verticals=TRUE) shows, the gap is there in the data, so it is only a
matter of convention that class intervals are shown for values that are
not in the data, and my preference is to let the data do the talking (but
I'm in a minority!), and cartographic convention will probably mean
shifting the internal gaps to "look" smaller, and rounding the values to 
make them easier to handle. For larger numbers of data items, it may be 
necessary to get the breaks and re-assign the cols because of rounding.

The stbrks matrix is just the range within the class for each class for 
the cols resulting from the classification.

With kmeans, note that it can get stuck, so I'd put it inside try() and
copy jittered values onto the end of the data vector if it fails - simply
because kmeans seeds its classes at random first, and can be unlucky.

Please let the list know how you get on, I'm sure class intervals are an 
interesting topic.

Roger

> 
> 
> On 2/24/06, Roger Bivand <Roger.Bivand at nhh.no> wrote:
> > On Fri, 24 Feb 2006, David Bitner wrote:
> >
> > > I am trying to create some type of a Natural Breaks Classification in
> > > PL/R  to classify data that I have in a PostgreSQL/PostGIS database.
> > > All that I really need so that I can pass information on to Mapserver
> > > to display this data is the class break values (ie an array [3,5,7,9]
> > > would mean show values 1-3 in blue, 4-5 in red, etc.).  I am
> > > completely new to R, but have a fair bit of experience with the other
> > > PL's in PostgreSQL, so the PL part shouldn't be too hard to figure
> > > out.
> > >
> > > I am thinking that kmeans should give me something close to what I
> > > want.  My problem is that I am not quite sure to massage the output to
> > > get my class breaks or what format to input the data.
> > >
> > > For arguments, kmeans takes a matrix, number of classes, and a max
> > > number of iterations --
> > > last two are easy, but how do I convert (do I need to convert) an
> > > array into a matrix (is matrix just R speak for an array?)  I will be
> > > starting with a one dimension array ie ([1,4,1,1,1,6,4,9,9]).
> > >
> > > The next issue is spitting the data out.  The docs tell me that I get
> > > the centers of the clusters where what I really want are the
> > > boundaries of the clusters, how could I get at the "break points" that
> > > I am after?
> >
> > I think you may find some of the code in:
> >
> > http://spatial.nhh.no/papers/aag04.pdf
> >
> > useful (though dated). kmeans() and - my preference - bclust() in the
> > e1071 package may fail when given too few values, but there are ways round
> > that. You'll see code (for example at the top of p. 15) on how to get the
> > class centres out - but they - as done there - still leave gaps between
> > classes as can be seen from the ECDF plot below. As you can see, kmeans()
> > manages with a vector OK.
> >
> > It would be nice to follow this up as a single function - input the data
> > vector and some preferences wrt. number of classes, and output as a number
> > of (list of) class intervals with some fitness criterion, something like
> > that?
> >
> > I guess your colour palette is on the PL side?
> >
> > Roger
> >
> > >
> > > Any help is appreciated,
> > > David
> > >
> > > _______________________________________________
> > > R-sig-Geo mailing list
> > > R-sig-Geo at stat.math.ethz.ch
> > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > >
> >
> > --
> > Roger Bivand
> > Economic Geography Section, Department of Economics, Norwegian School of
> > Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> > Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> > e-mail: Roger.Bivand at nhh.no
> >
> >
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From osgis.lists at gmail.com  Fri Feb 24 23:28:53 2006
From: osgis.lists at gmail.com (David Bitner)
Date: Fri, 24 Feb 2006 16:28:53 -0600
Subject: [R-sig-Geo] Natural Breaks Classification
In-Reply-To: <Pine.LNX.4.44.0602242232350.14105-100000@reclus.nhh.no>
References: <71c3c6c50602241227m57a5d62bie12e75089c755d53@mail.gmail.com>
	<Pine.LNX.4.44.0602242232350.14105-100000@reclus.nhh.no>
Message-ID: <71c3c6c50602241428g4f722449p26e59c3839e4f63b@mail.gmail.com>

Most of my problem is that this is my first time using R, so I just
don't know the functions (or even really the semantic differences) for
dealing with vectors,arrays, and matrices.

Thank you very much for the code sample.  I have been looking around,
is there a good basic reference online to find out basic function
information so I can reference what things like order, match, unlist,
tapply, etc. are doing?  I have yet to find just a good functional
reference doc for R.

Given that I am not plotting my data in R, I think that you are going
further than what I actually need.  Given the small example data set,
all that I really need is just the two numbers 4 and 11 (before I had
said 3, but I realized the third is unnecessary). From these I plan to
construct my classes as <4,>=4 and <11, >=11 when I create my
classification in MapServer where I am doing the plotting.

David



On 2/24/06, Roger Bivand <Roger.Bivand at nhh.no> wrote:
> On Fri, 24 Feb 2006, David Bitner wrote:
>
> > I was actually already using that paper as a resource, but I am still
> > not quite understanding how to get just the breaks that I can use for
> > classification in an external mapping application.
> >
> > Right now I am trying out some samples just to understand what's going on.
> >
> > Using this array:
> > a<-c(11,1,3,3,4,4,4,4,4,4,5)
> > This gives me the vector (3,1,1,1,2,2,2,2,2,2,2)
> >
> > ideally I want the output for this to be just (3,5,11)
> >
> > Taking this with the min/max of my data I can create the classes
> > 1-3,4-5,6-11
> >
>
> Next line on p. 15:
>
> > a<-c(11,1,3,3,4,4,4,4,4,4,5)
> > av <- kmeans(a, 3)
> > str(av)
> List of 4
>  $ cluster : int [1:11] 3 1 1 1 2 2 2 2 2 2 ...
>  $ centers : num [1:3, 1]  2.33  4.14 11.00
>   ..- attr(*, "dimnames")=List of 2
>   .. ..$ : chr [1:3] "1" "2" "3"
>   .. ..$ : NULL
>  $ withinss: num [1:3] 2.667 0.857 0.000
>  $ size    : int [1:3] 3 7 1
>  - attr(*, "class")= chr "kmeans"
> > cols <- match(av$cluster, order(av$centers))
> > cols
>  [1] 3 1 1 1 2 2 2 2 2 2 2
> > stbrks <- matrix(unlist(tapply(a, factor(cols), range)), ncol = 2,
> + byrow = TRUE)
> > stbrks
>      [,1] [,2]
> [1,]    1    3
> [2,]    4    5
> [3,]   11   11
>
> which then needs unpacking:
>
> > apply(stbrks, 1, function(x) paste(x, collapse="-"))
> [1] "1-3"   "4-5"   "11-11"
>
> but which isn't pretty, because there is a gap. As plot(ecdf(jitter(a)),
> verticals=TRUE) shows, the gap is there in the data, so it is only a
> matter of convention that class intervals are shown for values that are
> not in the data, and my preference is to let the data do the talking (but
> I'm in a minority!), and cartographic convention will probably mean
> shifting the internal gaps to "look" smaller, and rounding the values to
> make them easier to handle. For larger numbers of data items, it may be
> necessary to get the breaks and re-assign the cols because of rounding.
>
> The stbrks matrix is just the range within the class for each class for
> the cols resulting from the classification.
>
> With kmeans, note that it can get stuck, so I'd put it inside try() and
> copy jittered values onto the end of the data vector if it fails - simply
> because kmeans seeds its classes at random first, and can be unlucky.
>
> Please let the list know how you get on, I'm sure class intervals are an
> interesting topic.
>
> Roger
>
> >
> >
> > On 2/24/06, Roger Bivand <Roger.Bivand at nhh.no> wrote:
> > > On Fri, 24 Feb 2006, David Bitner wrote:
> > >
> > > > I am trying to create some type of a Natural Breaks Classification in
> > > > PL/R  to classify data that I have in a PostgreSQL/PostGIS database.
> > > > All that I really need so that I can pass information on to Mapserver
> > > > to display this data is the class break values (ie an array [3,5,7,9]
> > > > would mean show values 1-3 in blue, 4-5 in red, etc.).  I am
> > > > completely new to R, but have a fair bit of experience with the other
> > > > PL's in PostgreSQL, so the PL part shouldn't be too hard to figure
> > > > out.
> > > >
> > > > I am thinking that kmeans should give me something close to what I
> > > > want.  My problem is that I am not quite sure to massage the output to
> > > > get my class breaks or what format to input the data.
> > > >
> > > > For arguments, kmeans takes a matrix, number of classes, and a max
> > > > number of iterations --
> > > > last two are easy, but how do I convert (do I need to convert) an
> > > > array into a matrix (is matrix just R speak for an array?)  I will be
> > > > starting with a one dimension array ie ([1,4,1,1,1,6,4,9,9]).
> > > >
> > > > The next issue is spitting the data out.  The docs tell me that I get
> > > > the centers of the clusters where what I really want are the
> > > > boundaries of the clusters, how could I get at the "break points" that
> > > > I am after?
> > >
> > > I think you may find some of the code in:
> > >
> > > http://spatial.nhh.no/papers/aag04.pdf
> > >
> > > useful (though dated). kmeans() and - my preference - bclust() in the
> > > e1071 package may fail when given too few values, but there are ways round
> > > that. You'll see code (for example at the top of p. 15) on how to get the
> > > class centres out - but they - as done there - still leave gaps between
> > > classes as can be seen from the ECDF plot below. As you can see, kmeans()
> > > manages with a vector OK.
> > >
> > > It would be nice to follow this up as a single function - input the data
> > > vector and some preferences wrt. number of classes, and output as a number
> > > of (list of) class intervals with some fitness criterion, something like
> > > that?
> > >
> > > I guess your colour palette is on the PL side?
> > >
> > > Roger
> > >
> > > >
> > > > Any help is appreciated,
> > > > David
> > > >
> > > > _______________________________________________
> > > > R-sig-Geo mailing list
> > > > R-sig-Geo at stat.math.ethz.ch
> > > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > > >
> > >
> > > --
> > > Roger Bivand
> > > Economic Geography Section, Department of Economics, Norwegian School of
> > > Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> > > Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> > > e-mail: Roger.Bivand at nhh.no
> > >
> > >
> >
>
> --
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>
>



From Roger.Bivand at nhh.no  Sat Feb 25 10:04:55 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sat, 25 Feb 2006 10:04:55 +0100 (CET)
Subject: [R-sig-Geo] Natural Breaks Classification
In-Reply-To: <71c3c6c50602241428g4f722449p26e59c3839e4f63b@mail.gmail.com>
Message-ID: <Pine.LNX.4.44.0602250954050.14729-100000@reclus.nhh.no>

On Fri, 24 Feb 2006, David Bitner wrote:

> Most of my problem is that this is my first time using R, so I just
> don't know the functions (or even really the semantic differences) for
> dealing with vectors,arrays, and matrices.

They are all vectors, but arrays and matrices have dimension attributes.

> 
> Thank you very much for the code sample.  I have been looking around,
> is there a good basic reference online to find out basic function
> information so I can reference what things like order, match, unlist,
> tapply, etc. are doing?  I have yet to find just a good functional
> reference doc for R.

http://cran.r-project.org/doc/manuals/R-lang.html

For the functions themselves, see their help pages. Of these four, only 
order is often used interactively, the others are usually within 
functions. match() is a well-written table look-up, unlist() turns a list 
of objects into a flat vector, and tapply() applies a function (defined 
here on the fly to a "ragged" array - the list made by choosing values of 
a for each separate index of cols. So order is fixing the arbitrary 
ordering of the cluster centres for matching with the cluster membership 
to get out cols ordered from lowest class to highest rather than in the 
arbitrary order (cluster numbering) output by kmeans. This is sensible 
because kmeans doesn't know that a has only one column and a natural 
odering - if a was k-dimensional, there would be no natural cluster 
ordering. From that we retrieve the min and max (range) for each cluster 
by using tapply(), and flatten the list it returns.

Hope this helps - I think you'll need a bit more than two numbers out - 
preferably a string saying how you found the breaks.

Roger

> 
> Given that I am not plotting my data in R, I think that you are going
> further than what I actually need.  Given the small example data set,
> all that I really need is just the two numbers 4 and 11 (before I had
> said 3, but I realized the third is unnecessary). From these I plan to
> construct my classes as <4,>=4 and <11, >=11 when I create my
> classification in MapServer where I am doing the plotting.
> 
> David
> 
> 
> 
> On 2/24/06, Roger Bivand <Roger.Bivand at nhh.no> wrote:
> > On Fri, 24 Feb 2006, David Bitner wrote:
> >
> > > I was actually already using that paper as a resource, but I am still
> > > not quite understanding how to get just the breaks that I can use for
> > > classification in an external mapping application.
> > >
> > > Right now I am trying out some samples just to understand what's going on.
> > >
> > > Using this array:
> > > a<-c(11,1,3,3,4,4,4,4,4,4,5)
> > > This gives me the vector (3,1,1,1,2,2,2,2,2,2,2)
> > >
> > > ideally I want the output for this to be just (3,5,11)
> > >
> > > Taking this with the min/max of my data I can create the classes
> > > 1-3,4-5,6-11
> > >
> >
> > Next line on p. 15:
> >
> > > a<-c(11,1,3,3,4,4,4,4,4,4,5)
> > > av <- kmeans(a, 3)
> > > str(av)
> > List of 4
> >  $ cluster : int [1:11] 3 1 1 1 2 2 2 2 2 2 ...
> >  $ centers : num [1:3, 1]  2.33  4.14 11.00
> >   ..- attr(*, "dimnames")=List of 2
> >   .. ..$ : chr [1:3] "1" "2" "3"
> >   .. ..$ : NULL
> >  $ withinss: num [1:3] 2.667 0.857 0.000
> >  $ size    : int [1:3] 3 7 1
> >  - attr(*, "class")= chr "kmeans"
> > > cols <- match(av$cluster, order(av$centers))
> > > cols
> >  [1] 3 1 1 1 2 2 2 2 2 2 2
> > > stbrks <- matrix(unlist(tapply(a, factor(cols), range)), ncol = 2,
> > + byrow = TRUE)
> > > stbrks
> >      [,1] [,2]
> > [1,]    1    3
> > [2,]    4    5
> > [3,]   11   11
> >
> > which then needs unpacking:
> >
> > > apply(stbrks, 1, function(x) paste(x, collapse="-"))
> > [1] "1-3"   "4-5"   "11-11"
> >
> > but which isn't pretty, because there is a gap. As plot(ecdf(jitter(a)),
> > verticals=TRUE) shows, the gap is there in the data, so it is only a
> > matter of convention that class intervals are shown for values that are
> > not in the data, and my preference is to let the data do the talking (but
> > I'm in a minority!), and cartographic convention will probably mean
> > shifting the internal gaps to "look" smaller, and rounding the values to
> > make them easier to handle. For larger numbers of data items, it may be
> > necessary to get the breaks and re-assign the cols because of rounding.
> >
> > The stbrks matrix is just the range within the class for each class for
> > the cols resulting from the classification.
> >
> > With kmeans, note that it can get stuck, so I'd put it inside try() and
> > copy jittered values onto the end of the data vector if it fails - simply
> > because kmeans seeds its classes at random first, and can be unlucky.
> >
> > Please let the list know how you get on, I'm sure class intervals are an
> > interesting topic.
> >
> > Roger
> >
> > >
> > >
> > > On 2/24/06, Roger Bivand <Roger.Bivand at nhh.no> wrote:
> > > > On Fri, 24 Feb 2006, David Bitner wrote:
> > > >
> > > > > I am trying to create some type of a Natural Breaks Classification in
> > > > > PL/R  to classify data that I have in a PostgreSQL/PostGIS database.
> > > > > All that I really need so that I can pass information on to Mapserver
> > > > > to display this data is the class break values (ie an array [3,5,7,9]
> > > > > would mean show values 1-3 in blue, 4-5 in red, etc.).  I am
> > > > > completely new to R, but have a fair bit of experience with the other
> > > > > PL's in PostgreSQL, so the PL part shouldn't be too hard to figure
> > > > > out.
> > > > >
> > > > > I am thinking that kmeans should give me something close to what I
> > > > > want.  My problem is that I am not quite sure to massage the output to
> > > > > get my class breaks or what format to input the data.
> > > > >
> > > > > For arguments, kmeans takes a matrix, number of classes, and a max
> > > > > number of iterations --
> > > > > last two are easy, but how do I convert (do I need to convert) an
> > > > > array into a matrix (is matrix just R speak for an array?)  I will be
> > > > > starting with a one dimension array ie ([1,4,1,1,1,6,4,9,9]).
> > > > >
> > > > > The next issue is spitting the data out.  The docs tell me that I get
> > > > > the centers of the clusters where what I really want are the
> > > > > boundaries of the clusters, how could I get at the "break points" that
> > > > > I am after?
> > > >
> > > > I think you may find some of the code in:
> > > >
> > > > http://spatial.nhh.no/papers/aag04.pdf
> > > >
> > > > useful (though dated). kmeans() and - my preference - bclust() in the
> > > > e1071 package may fail when given too few values, but there are ways round
> > > > that. You'll see code (for example at the top of p. 15) on how to get the
> > > > class centres out - but they - as done there - still leave gaps between
> > > > classes as can be seen from the ECDF plot below. As you can see, kmeans()
> > > > manages with a vector OK.
> > > >
> > > > It would be nice to follow this up as a single function - input the data
> > > > vector and some preferences wrt. number of classes, and output as a number
> > > > of (list of) class intervals with some fitness criterion, something like
> > > > that?
> > > >
> > > > I guess your colour palette is on the PL side?
> > > >
> > > > Roger
> > > >
> > > > >
> > > > > Any help is appreciated,
> > > > > David
> > > > >
> > > > > _______________________________________________
> > > > > R-sig-Geo mailing list
> > > > > R-sig-Geo at stat.math.ethz.ch
> > > > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > > > >
> > > >
> > > > --
> > > > Roger Bivand
> > > > Economic Geography Section, Department of Economics, Norwegian School of
> > > > Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> > > > Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> > > > e-mail: Roger.Bivand at nhh.no
> > > >
> > > >
> > >
> >
> > --
> > Roger Bivand
> > Economic Geography Section, Department of Economics, Norwegian School of
> > Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> > Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> > e-mail: Roger.Bivand at nhh.no
> >
> >
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From mihastaut at yahoo.co.uk  Mon Feb 27 20:47:56 2006
From: mihastaut at yahoo.co.uk (Miha Staut)
Date: Mon, 27 Feb 2006 19:47:56 +0000 (GMT)
Subject: [R-sig-Geo] Area cartograms
Message-ID: <20060227194756.67045.qmail@web25414.mail.ukl.yahoo.com>

Dear listers,

Does anybody know if any command is implemented in R for creating cartograms
where the area of the polygon reflects the size of the variable in question.
E.g. in a map of the countries of the world (projection should be equivalent of
course), the area of the country would indicate the size of the population of
the country, not the actual area. I would be happy with either contiguous
polygons with distortion of the shape or non contiguous polygons without shape
distortion.

Thanks,
Miha



From Roger.Bivand at nhh.no  Mon Feb 27 22:05:18 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 27 Feb 2006 22:05:18 +0100 (CET)
Subject: [R-sig-Geo] Area cartograms
In-Reply-To: <20060227194756.67045.qmail@web25414.mail.ukl.yahoo.com>
Message-ID: <Pine.LNX.4.44.0602272152210.699-100000@reclus.nhh.no>

On Mon, 27 Feb 2006, Miha Staut wrote:

> Dear listers,
> 
> Does anybody know if any command is implemented in R for creating
> cartograms where the area of the polygon reflects the size of the
> variable in question. E.g. in a map of the countries of the world
> (projection should be equivalent of course), the area of the country
> would indicate the size of the population of the country, not the actual
> area. I would be happy with either contiguous polygons with distortion
> of the shape or non contiguous polygons without shape distortion.

http://www.okada.jp.org/RWiki/index.php?Rmap%A4%F2%BB%C8%A4%C3%A4%BF%C3%CF%BF%DE%C9%BD%BC%A8

towards the bottom of the page is about what is known at the moment, it 
scales the polygon coordinates towards the centroid (assuming in the 
example that each data row is a single polygon). Has anyone any more ideas 
or code? The example is nice, and could be generalised for SpatialPolygons 
objects quite easily (because they have centroids and areas 
pre-calculated. 

Roger

> 
> Thanks,
> Miha
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



