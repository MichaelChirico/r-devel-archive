From rob00x @end|ng |rom gm@||@com  Sun Mar  1 17:43:33 2020
From: rob00x @end|ng |rom gm@||@com (Robin Lovelace)
Date: Sun, 1 Mar 2020 16:43:33 +0000
Subject: [R-sig-Geo] Recommended set-up for r-spatial packages on Linux
Message-ID: <CAF16KkVc9CESpLFdxf+8H3-jUAk_G+RX3t6qGYeuKb_vDbfRvg@mail.gmail.com>

I'm asking out of interest and in anticipation of students and others
asking, and am wondering if my default answer needs to be re-assessed. For
details see here: https://github.com/r-spatial/discuss/issues/35

Replies here very welcome.

Thanks.

	[[alternative HTML version deleted]]


From m@ur|z|o@m@rch| @end|ng |rom |bbr@cnr@|t  Mon Mar  2 13:03:29 2020
From: m@ur|z|o@m@rch| @end|ng |rom |bbr@cnr@|t (maurizio marchi)
Date: Mon, 2 Mar 2020 13:03:29 +0100
Subject: [R-sig-Geo] Recommended set-up for r-spatial packages on Linux
In-Reply-To: <mailman.27934.5.1583146802.28267.r-sig-geo@r-project.org>
References: <mailman.27934.5.1583146802.28267.r-sig-geo@r-project.org>
Message-ID: <e8c9d031-ea10-cf7f-14e5-141e900f2ed8@ibbr.cnr.it>

Hi Robin,
thanks for opening this discussion here too. Actually the right set-up 
is trivial for many of us.
I have always used the ubuntugis-unstable repository with the repository 
"https://cloud.r-project.org/bin/linux/ubuntu bionic-cran35/" for R. 
Everything worked fine for me since some weeks ago when I had troubles 
with sf using gdal 3.0.2 whcih made this problem occurring again 
(https://github.com/r-spatial/stars/issues/175)
I hope Ubuntu 20.04 will solve this
All my bests

-- 
*Maurizio Marchi,
PhD Forest Science - Ecological Mathematics*
Researcher
CNR - Institute of Biosciences and BioResources (IBBR), Florence 
division (Italy)
SkypeID: maurizioxyz
http://ibbr.cnr.it/ibbr/info/people/maurizio-marchi
#####------#####
EUFGIS National Focal Point for Italy (www.eufgis.org)
Scopus Author ID: 57188626512
ResearcherID: T-3813-2019
http://b4est.eu/ project
/...CPUs don't need to sleep.../

	[[alternative HTML version deleted]]


From @ndremm@rque@ @end|ng |rom y@hoo@com@br  Mon Mar  2 18:02:58 2020
From: @ndremm@rque@ @end|ng |rom y@hoo@com@br (=?UTF-8?Q?Andr=C3=A9_M=2E_Marques?=)
Date: Mon, 2 Mar 2020 17:02:58 +0000 (UTC)
Subject: [R-sig-Geo] Impact measures in spatial panels when regressors are
 endogenous. I need some help by a reproducible example.
References: <1584570425.4649277.1583168578387.ref@mail.yahoo.com>
Message-ID: <1584570425.4649277.1583168578387@mail.yahoo.com>

Dear all,
I am working on a research project that uses spatial panel econometric models.

At this moment I am facing some difficulties because I guess there are some issues with the function impacts() in spatialreg package and also with impacts.splm() of the splm package.

I already have used these codes previously.

But at this time I have endogenous regressors in Cliff-Ord spatial panel model.?
The major issue I have found is to calculate the impacts when I have one endogenous variable (~pcap) and two exogenous instruments (~hwy+water) in a SARAR spatial panel model.

Below I present a simple reproducible example:?library(plm)
library(splm)
library(spdep)data("Produc",package='plm') # Panel data.
head(Produc)data("usaww", package="splm")
head(usaww) ?usalw <- mat2listw(usaww,style='W') # mat2listw() X nb2listw() 
summary(usalw)fm <- log(gsp) ~ log(pcap) + log(pc) + log(emp) + unemp?GM_sarar.w2sls <- spgm(formula=fm,data=Produc,listw=usalw,lag=TRUE,
                 model="random",spatial.error=TRUE,
                 endog = ~pcap,instruments= ~hwy+water,
                 lag.instruments = TRUE,method="w2sls")
summary(GM_sarar.w2sls)?data(usaww)
lwstates <- mat2listw(usaww, style ="W")
sparse.W <- listw2dgCMatrix(lwstates)

time <- length(unique(Produc$year))
s.lwstates <- kronecker(Diagonal(time), sparse.W)

set.seed(12345)
trMatc <- spatialreg:::trW(s.lwstates, type="mult")
imp <- impacts(GM_sarar.w2sls, tr = trMatc, R = 200)
summary(imp, zstats=TRUE, short=T)

class(GM_sarar.ec2sls)

[1] "splm"??Could someone please try to solve this issue by a reproducible example?


Best regards,

Andr? M. Marques

Federal University of Paraiba
Department of Economics
Graduate Program of Economics

	[[alternative HTML version deleted]]


From Roger@B|v@nd @end|ng |rom nhh@no  Thu Mar  5 14:17:42 2020
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Thu, 5 Mar 2020 14:17:42 +0100
Subject: [R-sig-Geo] 
 Impact measures in spatial panels when regressors are
 endogenous. I need some help by a reproducible example.
In-Reply-To: <1584570425.4649277.1583168578387@mail.yahoo.com>
References: <1584570425.4649277.1583168578387.ref@mail.yahoo.com>
 <1584570425.4649277.1583168578387@mail.yahoo.com>
Message-ID: <alpine.LFD.2.21.2003051408400.167683@reclus.nhh.no>

On Mon, 2 Mar 2020, Andr? M. Marques via R-sig-Geo wrote:

> Dear all, I am working on a research project that uses spatial panel 
> econometric models.
>
> At this moment I am facing some difficulties because I guess there are 
> some issues with the function impacts() in spatialreg package and also 
> with impacts.splm() of the splm package.
>
> I already have used these codes previously.
>
> But at this time I have endogenous regressors in Cliff-Ord spatial panel 
> model. The major issue I have found is to calculate the impacts when I 
> have one endogenous variable (~pcap) and two exogenous instruments 
> (~hwy+water) in a SARAR spatial panel model.

I do not think that impacts methods have been implemented for this case. 
The error message should lead you through traceback() and 
debug(splm:::impacts.splm) to

Error in impacts.splm(GM_sarar.w2sls, tr = trMatc, R = 200) :
   object type not recognized

Contributions welcome!

Roger

PS. Do not post in HTML, as HTML always destroys the plain-text nature of 
code - this example was OK, but getting it to run cost a lot of 
unecessarily wasted time.

>
> Below I present a simple reproducible example:?library(plm)
> library(splm)
> library(spdep)data("Produc",package='plm') # Panel data.
> head(Produc)data("usaww", package="splm")
> head(usaww) ?usalw <- mat2listw(usaww,style='W') # mat2listw() X nb2listw()
> summary(usalw)fm <- log(gsp) ~ log(pcap) + log(pc) + log(emp) + unemp?GM_sarar.w2sls <- spgm(formula=fm,data=Produc,listw=usalw,lag=TRUE,
>                 model="random",spatial.error=TRUE,
>                 endog = ~pcap,instruments= ~hwy+water,
>                 lag.instruments = TRUE,method="w2sls")
> summary(GM_sarar.w2sls)?data(usaww)
> lwstates <- mat2listw(usaww, style ="W")
> sparse.W <- listw2dgCMatrix(lwstates)
>
> time <- length(unique(Produc$year))
> s.lwstates <- kronecker(Diagonal(time), sparse.W)
>
> set.seed(12345)
> trMatc <- spatialreg:::trW(s.lwstates, type="mult")
> imp <- impacts(GM_sarar.w2sls, tr = trMatc, R = 200)
> summary(imp, zstats=TRUE, short=T)
>
> class(GM_sarar.ec2sls)
>
> [1] "splm"  Could someone please try to solve this issue by a 
> reproducible example?
>
>
> Best regards,
>
> Andr? M. Marques
>
> Federal University of Paraiba
> Department of Economics
> Graduate Program of Economics
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

From bou@@r|@@@ @end|ng |rom ucd@@c@m@  Sun Mar  8 11:42:09 2020
From: bou@@r|@@@ @end|ng |rom ucd@@c@m@ (Abdelkrim Bouasria)
Date: Sun, 8 Mar 2020 11:42:09 +0100
Subject: [R-sig-Geo] There is any R package that Artificial Neural Network
 for spatial interpolation?
Message-ID: <CAE_p2aLwZpG3R_0p_T=O2Sx+SSTFr-rtaEpbQQkBOxJsODRopg@mail.gmail.com>

Dear all,

I am working on a digital soil fertility mapping project, and I would like
to make a comparison between the method of interpolation by kriging and the
interpolation by artificial neural networks.  And I wonder if there is a
package in R that allows spatial interpolation with neural networks.

Best regards.

____________________________
Abdelkrim BOUASRIA
Chouaib Doukkali University
El Jadida - Morocco

	[[alternative HTML version deleted]]


From j||oeter @end|ng |rom un|-h@mburg@de  Sun Mar  8 19:03:35 2020
From: j||oeter @end|ng |rom un|-h@mburg@de (Jens Floeter)
Date: Sun, 8 Mar 2020 19:03:35 +0100
Subject: [R-sig-Geo] 
 There is any R package that Artificial Neural Network
 for spatial interpolation?
In-Reply-To: <CAE_p2aLwZpG3R_0p_T=O2Sx+SSTFr-rtaEpbQQkBOxJsODRopg@mail.gmail.com>
References: <CAE_p2aLwZpG3R_0p_T=O2Sx+SSTFr-rtaEpbQQkBOxJsODRopg@mail.gmail.com>
Message-ID: <40dc3dcc-286b-b779-7981-e1a3c4f31cc5@uni-hamburg.de>

Hi Abdelkrim,

you may have a look into

Rammer W and Seidl R (2019) Harnessing Deep Learning in Ecology: An 
Example Predicting Bark Beetle Outbreaks. Front. Plant Sci. 10:1327.
doi: 10.3389/fpls.2019.01327

They used the H2O platform (H2O.ai, 2017), which provides a set of fast 
and scalable learning algorithms and is integrated within the R software 
and environment.

However, I have not used it myself.

best wishes !
Jens


Am 08.03.2020 um 11:42 schrieb Abdelkrim Bouasria:

> Dear all,
>
> I am working on a digital soil fertility mapping project, and I would like
> to make a comparison between the method of interpolation by kriging and the
> interpolation by artificial neural networks.  And I wonder if there is a
> package in R that allows spatial interpolation with neural networks.
>
> Best regards.
>
> ____________________________
> Abdelkrim BOUASRIA
> Chouaib Doukkali University
> El Jadida - Morocco
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From tom@heng| @end|ng |rom gm@||@com  Mon Mar  9 15:22:25 2020
From: tom@heng| @end|ng |rom gm@||@com (Tomislav Hengl)
Date: Mon, 9 Mar 2020 15:22:25 +0100
Subject: [R-sig-Geo] Problems installing rgdal on ubuntu 18.04 from
 ubuntu-unstable GDAL: 3.0.2 / PROJ version: 6.2.1
Message-ID: <31c7a4f9-2764-6884-37be-2af7f71e68e3@gmail.com>


I'm trying to install rgdal using ubuntu-unstable. First I do:

sudo apt-get install libproj-dev libgdal-dev

Then I get 2 different messages depending on the rgdal version:

R CMD INSTALL rgdal_1.4-8.tar.gz
* installing to library ?/home/tomislav/R/x86_64-pc-linux-gnu-library/3.5?
* installing *source* package ?rgdal? ...
** package ?rgdal? successfully unpacked and MD5 sums checked
configure: R_HOME: /opt/microsoft/ropen/3.5.1/lib64/R
configure: CC: gcc -std=gnu99
configure: CXX: g++
configure: C++11 support available
configure: rgdal: 1.4-7
checking for /usr/bin/svnversion... yes
configure: svn revision: 845
checking for gdal-config... /usr/bin/gdal-config
checking gdal-config usability... yes
configure: GDAL: 3.0.2
checking GDAL version >= 1.11.4... yes
checking GDAL version <= 2.5 or >= 3.0... yes
checking gdal: linking with --libs only... yes
checking GDAL: gdal-config data directory readable... yes
checking GDAL: /usr/share/gdal/pcs.csv readable... yes
configure: pkg-config proj exists, will use it
configure: PROJ version: 6.2.1
configure: Support for PROJ >= 6.0.0 not yet available, deprecated API 
defined
configure: proj CPP flags: -DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
configure: PROJ LIBS: -lproj
checking PROJ header API:... proj_api.h
checking proj_api.h presence and usability... yes
checking PROJ version agreement... no
configure: error: proj_api.h and pkg-config give different versions
ERROR: configuration failed for package ?rgdal?
* removing ?/home/tomislav/R/x86_64-pc-linux-gnu-library/3.5/rgdal?



 > install.packages("rgdal")
Installing package into ?/home/tomislav/R/x86_64-pc-linux-gnu-library/3.5?
(as ?lib? is unspecified)
   % Total    % Received % Xferd  Average Speed   Time    Time     Time 
Current
                                  Dload  Upload   Total   Spent    Left 
Speed
100 1631k  100 1631k    0     0   722k      0  0:00:02  0:00:02 --:--:-- 
  722k
* installing *source* package ?rgdal? ...
** package ?rgdal? successfully unpacked and MD5 sums checked
checking for g++... g++
checking whether the C++ compiler works... yes
checking for C++ compiler default output file name... a.out
checking for suffix of executables...
checking whether we are cross compiling... no
checking for suffix of object files... o
checking whether we are using the GNU C++ compiler... yes
checking whether g++ accepts -g... yes
configure: CC: gcc -std=gnu99
configure: CXX: g++
configure: rgdal: 1.3-3
checking for /usr/bin/svnversion... yes
configure: svn revision: 759
checking whether g++ supports C++11 features by default... yes
configure: C++11 support available
checking for gdal-config... /usr/bin/gdal-config
checking gdal-config usability... yes
configure: GDAL: 3.0.2
checking GDAL version >= 1.11.4... yes
checking gdal: linking with --libs only... yes
checking GDAL: /usr/share/gdal/pcs.csv readable... yes
configure: pkg-config proj exists, will use it
configure: PROJ version: 6.2.1
checking proj_api.h presence and usability... no
configure: error: proj_api.h not found in standard or given locations.
ERROR: configuration failed for package ?rgdal?
* removing ?/home/tomislav/R/x86_64-pc-linux-gnu-library/3.5/rgdal?
Warning in install.packages :
   installation of package ?rgdal? had non-zero exit status

The downloaded source packages are in
	?/data/RTMP/RtmpZtTz9T/downloaded_packages?


pkg-config proj --libs
-lproj

 > devtools::session_info()
Session info 
---------------------------------------------------------------------------------------------------
  setting  value
  version  R version 3.5.1 (2018-07-02)
  system   x86_64, linux-gnu
  ui       RStudio (1.2.1335)
  language en_US
  collate  en_US.UTF-8
  tz       Europe/Amsterdam
  date     2020-03-09

Packages 
-------------------------------------------------------------------------------------------------------
  package       * version date       source
  base          * 3.5.1   2018-08-05 local
  compiler        3.5.1   2018-08-05 local
  datasets      * 3.5.1   2018-08-05 local
  devtools        1.13.6  2018-06-27 CRAN (R 3.5.1)
  digest          0.6.18  2018-10-10 CRAN (R 3.5.1)
  graphics      * 3.5.1   2018-08-05 local
  grDevices     * 3.5.1   2018-08-05 local
  grid            3.5.1   2018-08-05 local
  lattice         0.20-35 2017-03-25 CRAN (R 3.5.1)
  memoise         1.1.0   2017-04-21 CRAN (R 3.5.1)
  methods       * 3.5.1   2018-08-05 local
  RevoUtils     * 11.0.1  2018-08-01 local
  RevoUtilsMath * 11.0.0  2018-08-01 local
  sp            * 1.3-1   2018-06-05 CRAN (R 3.5.1)
  stats         * 3.5.1   2018-08-05 local
  tools           3.5.1   2018-08-05 local
  utils         * 3.5.1   2018-08-05 local
  withr           2.1.2   2018-03-15 CRAN (R 3.5.1)


I have tried removing all installations of GDAL, proj and QGIS 2x but no 
luck - always the same problem with "proj_api.h". What are my best 
options? thank you!


From Roger@B|v@nd @end|ng |rom nhh@no  Mon Mar  9 15:28:41 2020
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Mon, 9 Mar 2020 14:28:41 +0000
Subject: [R-sig-Geo] Problems installing rgdal on ubuntu 18.04 from
 ubuntu-unstable GDAL: 3.0.2 / PROJ version: 6.2.1
Message-ID: <DM6PR02MB5690561CDAD9238E32BC23F0A3FE0@DM6PR02MB5690.namprd02.prod.outlook.com>

Sorry, no idea, only ever install PROJ and GDAL from source. Multiple PROJ installs? Does rgdal install from R-Forge?


Roger Bivand
Norwegian School of Economics
Bergen, Norway

________________________________
Fra: R-sig-Geo <r-sig-geo-bounces at r-project.org> p? vegne av Tomislav Hengl <tom.hengl at gmail.com>
Sendt: mandag 9. mars 2020, 15.23
Til: r-sig-geo at r-project.org
Emne: [R-sig-Geo] Problems installing rgdal on ubuntu 18.04 from ubuntu-unstable GDAL: 3.0.2 / PROJ version: 6.2.1

I'm trying to install rgdal using ubuntu-unstable. First I do: sudo apt-get install libproj-dev libgdal-dev Then I get 2 different messages depending on the rgdal version: R CMD INSTALL rgdal_1.4-8.tar.gz * installing to library ?/home/tomislav/R/x86_64-pc-linux-gnu-library/3.5? * installing *source* package ?rgdal? ... ** package ?rgdal? successfully unpacked and MD5 sums checked configure: R_HOME: /opt/microsoft/ropen/3.5.1/lib64/R configure: CC: gcc -std=gnu99 configure: CXX: g++ configure: C++11 support available configure: rgdal: 1.4-7 checking for /usr/bin/svnversion... yes configure: svn revision: 845 checking for gdal-config... /usr/bin/gdal-config checking gdal-config usability... yes configure: GDAL: 3.0.2 checking GDAL version >= 1.11.4... yes checking GDAL version <= 2.5 or >= 3.0... yes checking gdal: linking with --libs only... yes checking GDAL: gdal-config data directory readable... yes checking GDAL: /usr/share/gdal/pcs.csv readable... yes configure: pkg-config proj exists, will use it configure: PROJ version: 6.2.1 configure: Support for PROJ >= 6.0.0 not yet available, deprecated API defined configure: proj CPP flags: -DACCEPT_USE_OF_DEPRECATED_PROJ_API_H configure: PROJ LIBS: -lproj checking PROJ header API:... proj_api.h checking proj_api.h presence and usability... yes checking PROJ version agreement... no configure: error: proj_api.h and pkg-config give different versions ERROR: configuration failed for package ?rgdal? * removing ?/home/tomislav/R/x86_64-pc-linux-gnu-library/3.5/rgdal? > install.packages("rgdal") Installing package into ?/home/tomislav/R/x86_64-pc-linux-gnu-library/3.5? (as ?lib? is unspecified) % Total % Received % Xferd Average Speed Time Time Time Current Dload Upload Total Spent Left Speed 100 1631k 100 1631k 0 0 722k 0 0:00:02 0:00:02 --:--:-- 722k * installing *source* package ?rgdal? ... ** package ?rgdal? successfully unpacked and MD5 sums checked checking for g++... g++ checking whether the C++ compiler works... yes checking for C++ compiler default output file name... a.out checking for suffix of executables... checking whether we are cross compiling... no checking for suffix of object files... o checking whether we are using the GNU C++ compiler... yes checking whether g++ accepts -g... yes configure: CC: gcc -std=gnu99 configure: CXX: g++ configure: rgdal: 1.3-3 checking for /usr/bin/svnversion... yes configure: svn revision: 759 checking whether g++ supports C++11 features by default... yes configure: C++11 support available checking for gdal-config... /usr/bin/gdal-config checking gdal-config usability... yes configure: GDAL: 3.0.2 checking GDAL version >= 1.11.4... yes checking gdal: linking with --libs only... yes checking GDAL: /usr/share/gdal/pcs.csv readable... yes configure: pkg-config proj exists, will use it configure: PROJ version: 6.2.1 checking proj_api.h presence and usability... no configure: error: proj_api.h not found in standard or given locations. ERROR: configuration failed for package ?rgdal? * removing ?/home/tomislav/R/x86_64-pc-linux-gnu-library/3.5/rgdal? Warning in install.packages : installation of package ?rgdal? had non-zero exit status The downloaded source packages are in ?/data/RTMP/RtmpZtTz9T/downloaded_packages? pkg-config proj --libs -lproj > devtools::session_info() Session info --------------------------------------------------------------------------------------------------- setting value version R version 3.5.1 (2018-07-02) system x86_64, linux-gnu ui RStudio (1.2.1335) language en_US collate en_US.UTF-8 tz Europe/Amsterdam date 2020-03-09 Packages ------------------------------------------------------------------------------------------------------- package * version date source base * 3.5.1 2018-08-05 local compiler 3.5.1 2018-08-05 local datasets * 3.5.1 2018-08-05 local devtools 1.13.6 2018-06-27 CRAN (R 3.5.1) digest 0.6.18 2018-10-10 CRAN (R 3.5.1) graphics * 3.5.1 2018-08-05 local grDevices * 3.5.1 2018-08-05 local grid 3.5.1 2018-08-05 local lattice 0.20-35 2017-03-25 CRAN (R 3.5.1) memoise 1.1.0 2017-04-21 CRAN (R 3.5.1) methods * 3.5.1 2018-08-05 local RevoUtils * 11.0.1 2018-08-01 local RevoUtilsMath * 11.0.0 2018-08-01 local sp * 1.3-1 2018-06-05 CRAN (R 3.5.1) stats * 3.5.1 2018-08-05 local tools 3.5.1 2018-08-05 local utils * 3.5.1 2018-08-05 local withr 2.1.2 2018-03-15 CRAN (R 3.5.1) I have tried removing all installations of GDAL, proj and QGIS 2x but no luck - always the same problem with "proj_api.h". What are my best options? thank you! _______________________________________________ R-sig-Geo mailing list R-sig-Geo at r-project.org https://stat.ethz.ch/mailman/listinfo/r-sig-geo

	[[alternative HTML version deleted]]


From tom@heng| @end|ng |rom gm@||@com  Mon Mar  9 17:32:14 2020
From: tom@heng| @end|ng |rom gm@||@com (Tomislav Hengl)
Date: Mon, 9 Mar 2020 17:32:14 +0100
Subject: [R-sig-Geo] Problems installing rgdal on ubuntu 18.04 from
 ubuntu-unstable GDAL: 3.0.2 / PROJ version: 6.2.1
In-Reply-To: <DM6PR02MB5690561CDAD9238E32BC23F0A3FE0@DM6PR02MB5690.namprd02.prod.outlook.com>
References: <DM6PR02MB5690561CDAD9238E32BC23F0A3FE0@DM6PR02MB5690.namprd02.prod.outlook.com>
Message-ID: <4b13a06e-2d8d-636c-30a2-168836e9f8bc@gmail.com>


The example below is with the rgdal from R-Forge:

R CMD INSTALL rgdal_1.4-8.tar.gz
* installing to library ?/home/tomislav/R/x86_64-pc-linux-gnu-library/3.5?
* installing *source* package ?rgdal? ...
** package ?rgdal? successfully unpacked and MD5 sums checked
configure: R_HOME: /opt/microsoft/ropen/3.5.1/lib64/R
configure: CC: gcc -std=gnu99
configure: CXX: g++
configure: C++11 support available
configure: rgdal: 1.4-7
checking for /usr/bin/svnversion... yes
configure: svn revision: 845
checking for gdal-config... /usr/bin/gdal-config
checking gdal-config usability... yes
configure: GDAL: 3.0.2
checking GDAL version >= 1.11.4... yes
checking GDAL version <= 2.5 or >= 3.0... yes
checking gdal: linking with --libs only... yes
checking GDAL: gdal-config data directory readable... yes
checking GDAL: /usr/share/gdal/pcs.csv readable... yes
configure: pkg-config proj exists, will use it
configure: PROJ version: 6.2.1
configure: Support for PROJ >= 6.0.0 not yet available, deprecated API 
defined
configure: proj CPP flags: -DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
configure: PROJ LIBS: -lproj
checking PROJ header API:... proj_api.h
checking proj_api.h presence and usability... yes
checking PROJ version agreement... no
configure: error: proj_api.h and pkg-config give different versions
ERROR: configuration failed for package ?rgdal?
* removing ?/home/tomislav/R/x86_64-pc-linux-gnu-library/3.5/rgdal?


The error message suggests that I might have 2 versions of proj, but 
when I check pkg-config it all looks fine:

which proj
/usr/local/bin/proj

pkg-config --modversion proj
6.2.1


On 3/9/20 3:28 PM, Roger Bivand wrote:
> Sorry, no idea, only ever install PROJ and GDAL from source. Multiple 
> PROJ installs? Does rgdal install from R-Forge?
> 
> 
> Roger Bivand
> Norwegian School of Economics
> Bergen, Norway
> 
> ------------------------------------------------------------------------
> *Fra:* R-sig-Geo <r-sig-geo-bounces at r-project.org> p? vegne av Tomislav 
> Hengl <tom.hengl at gmail.com>
> *Sendt:* mandag 9. mars 2020, 15.23
> *Til:* r-sig-geo at r-project.org
> *Emne:* [R-sig-Geo] Problems installing rgdal on ubuntu 18.04 from 
> ubuntu-unstable GDAL: 3.0.2 / PROJ version: 6.2.1
> 
> I'm trying to install rgdal using ubuntu-unstable. First I do: sudo 
> apt-get install libproj-dev libgdal-dev Then I get 2 different messages 
> depending on the rgdal version: R CMD INSTALL rgdal_1.4-8.tar.gz * 
> installing to library ?/home/tomislav/R/x86_64-pc-linux-gnu-library/3.5? 
> * installing *source* package ?rgdal? ... ** package ?rgdal? 
> successfully unpacked and MD5 sums checked configure: R_HOME: 
> /opt/microsoft/ropen/3.5.1/lib64/R configure: CC: gcc -std=gnu99 
> configure: CXX: g++ configure: C++11 support available configure: rgdal: 
> 1.4-7 checking for /usr/bin/svnversion... yes configure: svn revision: 
> 845 checking for gdal-config... /usr/bin/gdal-config checking 
> gdal-config usability... yes configure: GDAL: 3.0.2 checking GDAL 
> version >= 1.11.4... yes checking GDAL version <= 2.5 or >= 3.0... yes 
> checking gdal: linking with --libs only... yes checking GDAL: 
> gdal-config data directory readable... yes checking GDAL: 
> /usr/share/gdal/pcs.csv readable... yes configure: pkg-config proj 
> exists, will use it configure: PROJ version: 6.2.1 configure: Support 
> for PROJ >= 6.0.0 not yet available, deprecated API defined configure: 
> proj CPP flags: -DACCEPT_USE_OF_DEPRECATED_PROJ_API_H configure: PROJ 
> LIBS: -lproj checking PROJ header API:... proj_api.h checking proj_api.h 
> presence and usability... yes checking PROJ version agreement... no 
> configure: error: proj_api.h and pkg-config give different versions 
> ERROR: configuration failed for package ?rgdal? * removing 
> ?/home/tomislav/R/x86_64-pc-linux-gnu-library/3.5/rgdal? > 
> install.packages("rgdal") Installing package into 
> ?/home/tomislav/R/x86_64-pc-linux-gnu-library/3.5? (as ?lib? is 
> unspecified) % Total % Received % Xferd Average Speed Time Time Time 
> Current Dload Upload Total Spent Left Speed 100 1631k 100 1631k 0 0 722k 
> 0 0:00:02 0:00:02 --:--:-- 722k * installing *source* package ?rgdal? 
> ... ** package ?rgdal? successfully unpacked and MD5 sums checked 
> checking for g++... g++ checking whether the C++ compiler works... yes 
> checking for C++ compiler default output file name... a.out checking for 
> suffix of executables... checking whether we are cross compiling... no 
> checking for suffix of object files... o checking whether we are using 
> the GNU C++ compiler... yes checking whether g++ accepts -g... yes 
> configure: CC: gcc -std=gnu99 configure: CXX: g++ configure: rgdal: 
> 1.3-3 checking for /usr/bin/svnversion... yes configure: svn revision: 
> 759 checking whether g++ supports C++11 features by default... yes 
> configure: C++11 support available checking for gdal-config... 
> /usr/bin/gdal-config checking gdal-config usability... yes configure: 
> GDAL: 3.0.2 checking GDAL version >= 1.11.4... yes checking gdal: 
> linking with --libs only... yes checking GDAL: /usr/share/gdal/pcs.csv 
> readable... yes configure: pkg-config proj exists, will use it 
> configure: PROJ version: 6.2.1 checking proj_api.h presence and 
> usability... no configure: error: proj_api.h not found in standard or 
> given locations. ERROR: configuration failed for package ?rgdal? * 
> removing ?/home/tomislav/R/x86_64-pc-linux-gnu-library/3.5/rgdal? 
> Warning in install.packages : installation of package ?rgdal? had 
> non-zero exit status The downloaded source packages are in 
> ?/data/RTMP/RtmpZtTz9T/downloaded_packages? pkg-config proj --libs 
> -lproj > devtools::session_info() Session info 
> --------------------------------------------------------------------------------------------------- 
> setting value version R version 3.5.1 (2018-07-02) system x86_64, 
> linux-gnu ui RStudio (1.2.1335) language en_US collate en_US.UTF-8 tz 
> Europe/Amsterdam date 2020-03-09 Packages 
> ------------------------------------------------------------------------------------------------------- 
> package * version date source base * 3.5.1 2018-08-05 local compiler 
> 3.5.1 2018-08-05 local datasets * 3.5.1 2018-08-05 local devtools 1.13.6 
> 2018-06-27 CRAN (R 3.5.1) digest 0.6.18 2018-10-10 CRAN (R 3.5.1) 
> graphics * 3.5.1 2018-08-05 local grDevices * 3.5.1 2018-08-05 local 
> grid 3.5.1 2018-08-05 local lattice 0.20-35 2017-03-25 CRAN (R 3.5.1) 
> memoise 1.1.0 2017-04-21 CRAN (R 3.5.1) methods * 3.5.1 2018-08-05 local 
> RevoUtils * 11.0.1 2018-08-01 local RevoUtilsMath * 11.0.0 2018-08-01 
> local sp * 1.3-1 2018-06-05 CRAN (R 3.5.1) stats * 3.5.1 2018-08-05 
> local tools 3.5.1 2018-08-05 local utils * 3.5.1 2018-08-05 local withr 
> 2.1.2 2018-03-15 CRAN (R 3.5.1) I have tried removing all installations 
> of GDAL, proj and QGIS 2x but no luck - always the same problem with 
> "proj_api.h". What are my best options? thank you! 
> _______________________________________________ R-sig-Geo mailing list 
> R-sig-Geo at r-project.org https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From Roger@B|v@nd @end|ng |rom nhh@no  Mon Mar  9 17:47:39 2020
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Mon, 9 Mar 2020 17:47:39 +0100
Subject: [R-sig-Geo] Problems installing rgdal on ubuntu 18.04 from
 ubuntu-unstable GDAL: 3.0.2 / PROJ version: 6.2.1
In-Reply-To: <4b13a06e-2d8d-636c-30a2-168836e9f8bc@gmail.com>
References: <DM6PR02MB5690561CDAD9238E32BC23F0A3FE0@DM6PR02MB5690.namprd02.prod.outlook.com>
 <4b13a06e-2d8d-636c-30a2-168836e9f8bc@gmail.com>
Message-ID: <alpine.LFD.2.21.2003091744120.283342@reclus.nhh.no>

On Mon, 9 Mar 2020, Tomislav Hengl wrote:

>
> The example below is with the rgdal from R-Forge:
>
> R CMD INSTALL rgdal_1.4-8.tar.gz
> * installing to library ?/home/tomislav/R/x86_64-pc-linux-gnu-library/3.5?
> * installing *source* package ?rgdal? ...
> ** package ?rgdal? successfully unpacked and MD5 sums checked
> configure:  R_HOME: /opt/microsoft/ropen/3.5.1/lib64/R
> configure:  CC: gcc -std=gnu99
> configure:  CXX: g++
> configure:  C++11 support available
> configure:  rgdal: 1.4-7
> checking for /usr/bin/svnversion... yes
> configure:  svn revision: 845
> checking for gdal-config... /usr/bin/gdal-config
> checking gdal-config usability... yes
> configure:  GDAL: 3.0.2
> checking GDAL version >= 1.11.4... yes
> checking GDAL version <= 2.5 or >= 3.0... yes
> checking gdal: linking with --libs only... yes
> checking GDAL: gdal-config data directory readable... yes
> checking GDAL: /usr/share/gdal/pcs.csv readable... yes
> configure:  pkg-config proj exists, will use it
> configure:  PROJ version: 6.2.1
> configure:  Support for PROJ >= 6.0.0 not yet available, deprecated API 
> defined
> configure:  proj CPP flags: -DACCEPT_USE_OF_DEPRECATED_PROJ_API_H
> configure:  PROJ LIBS: -lproj
> checking PROJ header API:... proj_api.h
> checking proj_api.h presence and usability... yes
> checking PROJ version agreement... no
> configure:  error: proj_api.h and pkg-config give different versions
> ERROR: configuration failed for package ?rgdal?
> * removing ?/home/tomislav/R/x86_64-pc-linux-gnu-library/3.5/rgdal?
>
>
> The error message suggests that I might have 2 versions of proj, but when I 
> check pkg-config it all looks fine:
>
> which proj
> /usr/local/bin/proj
>
> pkg-config --modversion proj
> 6.2.1

Look at about line 41 (search for PJ_VERSION) in all the files found by:

locate proj_api.h

The one pointed to by pkg-config --cflags proj is the one stating 621, but 
there must be another earlier in the includes search path.

Happy hunting!

Roger

>
>
> On 3/9/20 3:28 PM, Roger Bivand wrote:
>>  Sorry, no idea, only ever install PROJ and GDAL from source. Multiple PROJ
>>  installs? Does rgdal install from R-Forge?
>>
>>
>>  Roger Bivand
>>  Norwegian School of Economics
>>  Bergen, Norway
>>
>>  ------------------------------------------------------------------------
>>  *Fra:* R-sig-Geo <r-sig-geo-bounces at r-project.org> p? vegne av Tomislav
>>  Hengl <tom.hengl at gmail.com>
>>  *Sendt:* mandag 9. mars 2020, 15.23
>>  *Til:* r-sig-geo at r-project.org
>>  *Emne:* [R-sig-Geo] Problems installing rgdal on ubuntu 18.04 from
>>  ubuntu-unstable GDAL: 3.0.2 / PROJ version: 6.2.1
>>
>>  I'm trying to install rgdal using ubuntu-unstable. First I do: sudo
>>  apt-get install libproj-dev libgdal-dev Then I get 2 different messages
>>  depending on the rgdal version: R CMD INSTALL rgdal_1.4-8.tar.gz *
>>  installing to library ?/home/tomislav/R/x86_64-pc-linux-gnu-library/3.5? *
>>  installing *source* package ?rgdal? ... ** package ?rgdal? successfully
>>  unpacked and MD5 sums checked configure: R_HOME:
>>  /opt/microsoft/ropen/3.5.1/lib64/R configure: CC: gcc -std=gnu99 
>> configure:  CXX: g++ configure: C++11 support available configure: rgdal:
>>  1.4-7 checking for /usr/bin/svnversion... yes configure: svn revision: 845
>>  checking for gdal-config... /usr/bin/gdal-config checking gdal-config
>>  usability... yes configure: GDAL: 3.0.2 checking GDAL version >= 1.11.4...
>>  yes checking GDAL version <= 2.5 or >= 3.0... yes checking gdal: linking
>>  with --libs only... yes checking GDAL: gdal-config data directory
>>  readable... yes checking GDAL: /usr/share/gdal/pcs.csv readable... yes
>>  configure: pkg-config proj exists, will use it configure: PROJ version:
>>  6.2.1 configure: Support for PROJ >= 6.0.0 not yet available, deprecated
>>  API defined configure: proj CPP flags:
>>  -DACCEPT_USE_OF_DEPRECATED_PROJ_API_H configure: PROJ LIBS: -lproj
>>  checking PROJ header API:... proj_api.h checking proj_api.h presence and
>>  usability... yes checking PROJ version agreement... no 
>> configure:  error: proj_api.h and pkg-config give different versions
>>  ERROR: configuration failed for package ?rgdal? * removing
>>  ?/home/tomislav/R/x86_64-pc-linux-gnu-library/3.5/rgdal? >
>>  install.packages("rgdal") Installing package into
>>  ?/home/tomislav/R/x86_64-pc-linux-gnu-library/3.5? (as ?lib? is
>>  unspecified) % Total % Received % Xferd Average Speed Time Time Time
>>  Current Dload Upload Total Spent Left Speed 100 1631k 100 1631k 0 0 722k 0
>>  0:00:02 0:00:02 --:--:-- 722k * installing *source* package ?rgdal? ... **
>>  package ?rgdal? successfully unpacked and MD5 sums checked checking for
>>  g++... g++ checking whether the C++ compiler works... yes checking for C++
>>  compiler default output file name... a.out checking for suffix of
>>  executables... checking whether we are cross compiling... no checking for
>>  suffix of object files... o checking whether we are using the GNU C++
>>  compiler... yes checking whether g++ accepts -g... yes 
>> configure:  CC: gcc -std=gnu99 configure: CXX: g++ configure: rgdal:
>>  1.3-3 checking for /usr/bin/svnversion... yes configure: svn revision: 759
>>  checking whether g++ supports C++11 features by default... yes 
>> configure:  C++11 support available checking for gdal-config...
>>  /usr/bin/gdal-config checking gdal-config usability... yes configure:
>>  GDAL: 3.0.2 checking GDAL version >= 1.11.4... yes checking gdal: linking
>>  with --libs only... yes checking GDAL: /usr/share/gdal/pcs.csv readable...
>>  yes configure: pkg-config proj exists, will use it 
>> configure:  PROJ version: 6.2.1 checking proj_api.h presence and
>>  usability... no configure: error: proj_api.h not found in standard or
>>  given locations. ERROR: configuration failed for package ?rgdal? *
>>  removing ?/home/tomislav/R/x86_64-pc-linux-gnu-library/3.5/rgdal? Warning
>>  in install.packages : installation of package ?rgdal? had non-zero exit
>>  status The downloaded source packages are in
>>  ?/data/RTMP/RtmpZtTz9T/downloaded_packages? pkg-config proj --libs -lproj
>>  > devtools::session_info() Session info
>>  ---------------------------------------------------------------------------------------------------
>>  setting value version R version 3.5.1 (2018-07-02) system x86_64,
>>  linux-gnu ui RStudio (1.2.1335) language en_US collate en_US.UTF-8 tz
>>  Europe/Amsterdam date 2020-03-09 Packages
>>  -------------------------------------------------------------------------------------------------------
>>  package * version date source base * 3.5.1 2018-08-05 local compiler 3.5.1
>>  2018-08-05 local datasets * 3.5.1 2018-08-05 local devtools 1.13.6
>>  2018-06-27 CRAN (R 3.5.1) digest 0.6.18 2018-10-10 CRAN (R 3.5.1) graphics
>>  * 3.5.1 2018-08-05 local grDevices * 3.5.1 2018-08-05 local grid 3.5.1
>>  2018-08-05 local lattice 0.20-35 2017-03-25 CRAN (R 3.5.1) memoise 1.1.0
>>  2017-04-21 CRAN (R 3.5.1) methods * 3.5.1 2018-08-05 local RevoUtils *
>>  11.0.1 2018-08-01 local RevoUtilsMath * 11.0.0 2018-08-01 local sp * 1.3-1
>>  2018-06-05 CRAN (R 3.5.1) stats * 3.5.1 2018-08-05 local tools 3.5.1
>>  2018-08-05 local utils * 3.5.1 2018-08-05 local withr 2.1.2 2018-03-15
>>  CRAN (R 3.5.1) I have tried removing all installations of GDAL, proj and
>>  QGIS 2x but no luck - always the same problem with "proj_api.h". What are
>>  my best options? thank you!
>>  _______________________________________________ R-sig-Geo mailing list
>>  R-sig-Geo at r-project.org https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

From m||uj|@b @end|ng |rom gm@||@com  Tue Mar 10 08:10:35 2020
From: m||uj|@b @end|ng |rom gm@||@com (Miluji Sb)
Date: Tue, 10 Mar 2020 08:10:35 +0100
Subject: [R-sig-Geo] Match coordinates to regional polygon
Message-ID: <CAMLwc7P6HXBpyRQwkYGV2smYbtaTC2f0vL8AFOvcb8WfXNeLcw@mail.gmail.com>

Dear all,

Re-sending because the message was too big due to the attachment,

I am trying to match a large number of coordinates (attached) sub-national
regions using GADM shapefile.

Coordinates:
https://drive.google.com/file/d/1PUsi4d0wP7hB6Aps6UmpXsnIPSD3I1sT/view?usp=sharing

Shapefile:
https://drive.google.com/drive/folders/1DxyygjQNeg2GIS9doaFM8yM2LvBYZi8E?usp=sharing


This is the code I am using;

###
library(data.table)
library(ncdf4)
library(rgdal)
library(raster)
library(tidyverse)

## Read coordinates
coords <- read.csv("coords.csv")

## Read shapefile
world <-readOGR(dsn = "/gadm36_levels_shp", layer = "gadm36_2")

## Convert to spatial points
pts <- coords
coordinates(pts) <- ~lon+lat

## Provide the same CRS to the coordinates as the shapefile
proj4string(pts) <- proj4string(world)

## Use over function to match coordinates to polygons
pts_district <- over(pts, world)$NAME_1
###

However, less than 20% of the coordinates are matched to a polygon. What am
I doing wrong? Any help will be greatly appreciated.

Regards,

Milu

	[[alternative HTML version deleted]]


From Roger@B|v@nd @end|ng |rom nhh@no  Tue Mar 10 10:25:35 2020
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Tue, 10 Mar 2020 10:25:35 +0100
Subject: [R-sig-Geo] Match coordinates to regional polygon
In-Reply-To: <CAMLwc7P6HXBpyRQwkYGV2smYbtaTC2f0vL8AFOvcb8WfXNeLcw@mail.gmail.com>
References: <CAMLwc7P6HXBpyRQwkYGV2smYbtaTC2f0vL8AFOvcb8WfXNeLcw@mail.gmail.com>
Message-ID: <alpine.LFD.2.21.2003101007300.2811@reclus.nhh.no>

On Tue, 10 Mar 2020, Miluji Sb wrote:

> Dear all,
>
> Re-sending because the message was too big due to the attachment,
>
> I am trying to match a large number of coordinates (attached) sub-national
> regions using GADM shapefile.
>
> Coordinates:
> https://drive.google.com/file/d/1PUsi4d0wP7hB6Aps6UmpXsnIPSD3I1sT/view?usp=sharing
>
> Shapefile:
> https://drive.google.com/drive/folders/1DxyygjQNeg2GIS9doaFM8yM2LvBYZi8E?usp=sharing
>
>
> This is the code I am using;
>
> ###
> library(data.table)
> library(ncdf4)
> library(rgdal)
> library(raster)
> library(tidyverse)

Apart from rgdal, the remainer are pure distraction. Parsimony is 
important.

>
> ## Read coordinates
> coords <- read.csv("coords.csv")
>
> ## Read shapefile
> world <-readOGR(dsn = "/gadm36_levels_shp", layer = "gadm36_2")

This is the full GADM world map of admin units at level 2:

> dim(world)
[1] 45962    13


>
> ## Convert to spatial points
> pts <- coords
> coordinates(pts) <- ~lon+lat


This is a 0.5 degree world grid

> bbox(pts)
         min    max
lon -179.75 179.75
lat  -89.75  89.75

> SG <- as(as(pts, "SpatialPixelsDataFrame"), "SpatialGridDataFrame")
> gridparameters(SG)
     cellcentre.offset cellsize cells.dim
lon           -179.75      0.5       720
lat            -89.75      0.5       360
> bbox(pts)
         min    max
lon -179.75 179.75
lat  -89.75  89.75


>
> ## Provide the same CRS to the coordinates as the shapefile
> proj4string(pts) <- proj4string(world)
>
> ## Use over function to match coordinates to polygons
> pts_district <- over(pts, world)$NAME_1
> ###
>
> However, less than 20% of the coordinates are matched to a polygon. What am
> I doing wrong? Any help will be greatly appreciated.

plot(pts[!is.na(pts_district$GID_0),], axes=TRUE)

looks very much like world land mass to me. Oceans are big, your polygons 
omit Antarctica, and Plate Carree area (0.5x0.5 degree squares) is 
misleading.

Hope this clarifies,

Roger

>
> Regards,
>
> Milu
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en


From m@ur|z|o@m@rch| @end|ng |rom |bbr@cnr@|t  Tue Mar 10 12:20:36 2020
From: m@ur|z|o@m@rch| @end|ng |rom |bbr@cnr@|t (maurizio marchi)
Date: Tue, 10 Mar 2020 12:20:36 +0100
Subject: [R-sig-Geo] Problems installing rgdal on ubuntu 18.04 from,
 ubuntu-unstable GDAL: 3.0.2 / PROJ version: 6.2.1
In-Reply-To: <mailman.27945.3.1583838050.15788.r-sig-geo@r-project.org>
References: <mailman.27945.3.1583838050.15788.r-sig-geo@r-project.org>
Message-ID: <70cea52e-b63d-4003-c6a6-ee287f72c623@ibbr.cnr.it>

Hi, are you working on a fresh R system? This because some duplicated 
files might occur when adding new repositories such as the 
ubuntugis/unstable.
I suggest you to remove all the old installations linked with rgdal such 
as gdal, qgis, GRASS, proj4, PROJ etc then I suggest to repeat the 
installation. I also suggest you to use Ubuntu Cleaner to remove all the 
files left by the uninstalling procedure into the system (configurations 
etc.)

###---Ubuntu Cleaner
sudo apt install software-properties-common
sudo add-apt-repository ppa:gerardpuig/ppa
sudo apt update
sudo apt install ubuntu-cleaner

-- 
*Maurizio Marchi,
PhD Forest Science - Ecological Mathematics*
Researcher
CNR - Institute of Biosciences and BioResources (IBBR), Florence 
division (Italy)
SkypeID: maurizioxyz
http://ibbr.cnr.it/ibbr/info/people/maurizio-marchi
#####------#####
EUFGIS National Focal Point for Italy (www.eufgis.org)
Scopus Author ID: 57188626512
ResearcherID: T-3813-2019
http://b4est.eu/ project
/...CPUs don't need to sleep.../

	[[alternative HTML version deleted]]


From nev||@@mo@ @end|ng |rom gm@||@com  Wed Mar 11 02:59:19 2020
From: nev||@@mo@ @end|ng |rom gm@||@com (nevil amos)
Date: Wed, 11 Mar 2020 12:59:19 +1100
Subject: [R-sig-Geo] viewing locally hosted mbtiles vector tiles using
 leaflet.mapboxgl?
Message-ID: <CAN9eD7=PYNUiX8K3FHp+smXD38sAGUBb4YPshL4S7iCm0triKg@mail.gmail.com>

I am working on a shiny/ leaflet map project which requires display of a
large polygon dataset  (40,000 polygons ~92MB sf object).
Needless to say it take quite a time to render the sf object and zoom in
and out.

Simplifying the polygons is not an option.

leaflet.mapboxgl  https://github.com/rstudio/leaflet.mapboxgl package
allows adding of Mapbox GL layers to a leaflet map.

Since I am using my own local tiles  there should be no need for a maxbox
access token.

If possible I would like to make use of leaflet.mapboxgl: addMapboxGL() to
display vector tiles ( as .mbtiles) of the polygons that have been pre-
rendered from the polygon dataset using tippecanoe
https://github.com/mapbox/tippecanoe and served using mbtileserver
https://github.com/consbio/mbtileserver all on the same local machine.
mbtileserver is running from the project directory, and the mbtiles are  in
the path: <R project directory>/tilesets/mytiles.mbtiles
I can vie the preview in the bowser a
http://localhost:8000/services/myTiles/map

however the polygons do not dispay in leaflet in r

As this requires use of tippecanoe and mbtileserver I cannot post a repro,
however below is a pared down version fo the code I am using :


library(leaflet)
library(leaflet.mapboxgl)

options(mapbox.accessToken=NA)

base_map <- leaflet() %>%
 setView(lng = 145,lat = -37,zoom = 7)%>%
 addProviderTiles("Esri.WorldTopoMap", group = "ESRI Topo") %>%
  addMapox http://localhost:8000/services/myTiles ")

have I simply got the wrong format/ incomplete URL fo the  addMapboxGL ? If
so what should it be?

thanks

	[[alternative HTML version deleted]]


From t|m@@ppe|h@n@ @end|ng |rom gm@||@com  Wed Mar 11 11:34:08 2020
From: t|m@@ppe|h@n@ @end|ng |rom gm@||@com (Tim Salabim)
Date: Wed, 11 Mar 2020 11:34:08 +0100
Subject: [R-sig-Geo] viewing locally hosted mbtiles vector tiles using
 leaflet.mapboxgl?
In-Reply-To: <CAN9eD7=PYNUiX8K3FHp+smXD38sAGUBb4YPshL4S7iCm0triKg@mail.gmail.com>
References: <CAN9eD7=PYNUiX8K3FHp+smXD38sAGUBb4YPshL4S7iCm0triKg@mail.gmail.com>
Message-ID: <CAMbH+HhGQz2q5G7LFgBZNQ5cv_r7OasMyKjqx3GbT586B7T1sQ@mail.gmail.com>

Hi Nevil,
while not being able to help with mbtiles, maybe you want to try
leafgl to view your polygons.

https://github.com/r-spatial/leafgl

It should have no problems with 40k polygons.

Regarding RStudio's leaflet.mapboxgl, I don't think it is intended for
local use (though I might be wrong). For using locally stored tiles, I
think we would need something like
https://gitlab.com/IvanSanchez/Leaflet.TileLayer.MBTiles.

Out of interest, are you using tippercanoe from your command line or
do you have some code invoking it from R?

HTH,
Tim

On Wed, Mar 11, 2020 at 3:00 AM nevil amos <nevil.amos at gmail.com> wrote:
>
> I am working on a shiny/ leaflet map project which requires display of a
> large polygon dataset  (40,000 polygons ~92MB sf object).
> Needless to say it take quite a time to render the sf object and zoom in
> and out.
>
> Simplifying the polygons is not an option.
>
> leaflet.mapboxgl  https://github.com/rstudio/leaflet.mapboxgl package
> allows adding of Mapbox GL layers to a leaflet map.
>
> Since I am using my own local tiles  there should be no need for a maxbox
> access token.
>
> If possible I would like to make use of leaflet.mapboxgl: addMapboxGL() to
> display vector tiles ( as .mbtiles) of the polygons that have been pre-
> rendered from the polygon dataset using tippecanoe
> https://github.com/mapbox/tippecanoe and served using mbtileserver
> https://github.com/consbio/mbtileserver all on the same local machine.
> mbtileserver is running from the project directory, and the mbtiles are  in
> the path: <R project directory>/tilesets/mytiles.mbtiles
> I can vie the preview in the bowser a
> http://localhost:8000/services/myTiles/map
>
> however the polygons do not dispay in leaflet in r
>
> As this requires use of tippecanoe and mbtileserver I cannot post a repro,
> however below is a pared down version fo the code I am using :
>
>
> library(leaflet)
> library(leaflet.mapboxgl)
>
> options(mapbox.accessToken=NA)
>
> base_map <- leaflet() %>%
>  setView(lng = 145,lat = -37,zoom = 7)%>%
>  addProviderTiles("Esri.WorldTopoMap", group = "ESRI Topo") %>%
>   addMapox http://localhost:8000/services/myTiles ")
>
> have I simply got the wrong format/ incomplete URL fo the  addMapboxGL ? If
> so what should it be?
>
> thanks
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From nev||@@mo@ @end|ng |rom gm@||@com  Thu Mar 12 00:14:04 2020
From: nev||@@mo@ @end|ng |rom gm@||@com (nevil amos)
Date: Thu, 12 Mar 2020 10:14:04 +1100
Subject: [R-sig-Geo] viewing locally hosted mbtiles vector tiles using
 leaflet.mapboxgl?
In-Reply-To: <CAMbH+HhGQz2q5G7LFgBZNQ5cv_r7OasMyKjqx3GbT586B7T1sQ@mail.gmail.com>
References: <CAN9eD7=PYNUiX8K3FHp+smXD38sAGUBb4YPshL4S7iCm0triKg@mail.gmail.com>
 <CAMbH+HhGQz2q5G7LFgBZNQ5cv_r7OasMyKjqx3GbT586B7T1sQ@mail.gmail.com>
Message-ID: <CAN9eD7kS=9=KwzoKoo7BWH0Yup2xzGgsubk_CxZnDFGZomFhAQ@mail.gmail.com>

Hi Tim,

Thanks for you suggestions.  I have looked at the leafgl package, and yes
it does speed the rendering of  my polygons, however  it still has to
render them all, rather than using the tiling option, so is not as quick as
tiles would be ( if they worked!).

I have no problem locally serving  raster tiles to r leaflet(), this can be
achieved by running a simplserver, or the mbtilesserver, or inside a shiny
app by placing the tiles in the www directory.  The issue is getting any
vector tiles to dislay - the leaflet.mapboxgl packages is the only option I
have come across so far that suggests this may be a possibility.
I have been using tippecanoe from the linux terminal.

cheers

Nevil







On Wed, 11 Mar 2020 at 21:34, Tim Salabim <tim.appelhans at gmail.com> wrote:

> Hi Nevil,
> while not being able to help with mbtiles, maybe you want to try
> leafgl to view your polygons.
>
> https://github.com/r-spatial/leafgl
>
> It should have no problems with 40k polygons.
>
> Regarding RStudio's leaflet.mapboxgl, I don't think it is intended for
> local use (though I might be wrong). For using locally stored tiles, I
> think we would need something like
> https://gitlab.com/IvanSanchez/Leaflet.TileLayer.MBTiles.
>
> Out of interest, are you using tippercanoe from your command line or
> do you have some code invoking it from R?
>
> HTH,
> Tim
>
> On Wed, Mar 11, 2020 at 3:00 AM nevil amos <nevil.amos at gmail.com> wrote:
> >
> > I am working on a shiny/ leaflet map project which requires display of a
> > large polygon dataset  (40,000 polygons ~92MB sf object).
> > Needless to say it take quite a time to render the sf object and zoom in
> > and out.
> >
> > Simplifying the polygons is not an option.
> >
> > leaflet.mapboxgl  https://github.com/rstudio/leaflet.mapboxgl package
> > allows adding of Mapbox GL layers to a leaflet map.
> >
> > Since I am using my own local tiles  there should be no need for a maxbox
> > access token.
> >
> > If possible I would like to make use of leaflet.mapboxgl: addMapboxGL()
> to
> > display vector tiles ( as .mbtiles) of the polygons that have been pre-
> > rendered from the polygon dataset using tippecanoe
> > https://github.com/mapbox/tippecanoe and served using mbtileserver
> > https://github.com/consbio/mbtileserver all on the same local machine.
> > mbtileserver is running from the project directory, and the mbtiles are
> in
> > the path: <R project directory>/tilesets/mytiles.mbtiles
> > I can vie the preview in the bowser a
> > http://localhost:8000/services/myTiles/map
> >
> > however the polygons do not dispay in leaflet in r
> >
> > As this requires use of tippecanoe and mbtileserver I cannot post a
> repro,
> > however below is a pared down version fo the code I am using :
> >
> >
> > library(leaflet)
> > library(leaflet.mapboxgl)
> >
> > options(mapbox.accessToken=NA)
> >
> > base_map <- leaflet() %>%
> >  setView(lng = 145,lat = -37,zoom = 7)%>%
> >  addProviderTiles("Esri.WorldTopoMap", group = "ESRI Topo") %>%
> >   addMapox http://localhost:8000/services/myTiles ")
> >
> > have I simply got the wrong format/ incomplete URL fo the  addMapboxGL ?
> If
> > so what should it be?
> >
> > thanks
> >
> >         [[alternative HTML version deleted]]
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From kr@n@t@uber @end|ng |rom @b@mpg@de  Sat Mar 14 19:08:40 2020
From: kr@n@t@uber @end|ng |rom @b@mpg@de (Kranstauber, Bart)
Date: Sat, 14 Mar 2020 18:08:40 +0000
Subject: [R-sig-Geo] viewing locally hosted mbtiles vector tiles using
 leaflet.mapboxgl?
In-Reply-To: <CAN9eD7kS=9=KwzoKoo7BWH0Yup2xzGgsubk_CxZnDFGZomFhAQ@mail.gmail.com>
References: <CAN9eD7=PYNUiX8K3FHp+smXD38sAGUBb4YPshL4S7iCm0triKg@mail.gmail.com>
 <CAMbH+HhGQz2q5G7LFgBZNQ5cv_r7OasMyKjqx3GbT586B7T1sQ@mail.gmail.com>,
 <CAN9eD7kS=9=KwzoKoo7BWH0Yup2xzGgsubk_CxZnDFGZomFhAQ@mail.gmail.com>
Message-ID: <b78ecbcce7e54159a06ba828360f2212@ab.mpg.de>

Dear Nevil,

Regarding serving tiles locally a while ago I made a small package that can do this fully in R based on plumbr (https://gitlab.com/bartk/starsTileServer/). It is not really finished yet but I have found it to be a useful way to avoid prerendering a lot of tiles. I think it is most useful for raster data but if you can create tiles from your input data you can provide a custom function to generate tiles. If you find it useful I can wrap it up a bit more.

Best

Bart
________________________________________
From: R-sig-Geo <r-sig-geo-bounces at r-project.org> on behalf of nevil amos <nevil.amos at gmail.com>
Sent: 12 March 2020 00:14:04
To: Tim Salabim
Cc: r-sig-geo
Subject: Re: [R-sig-Geo] viewing locally hosted mbtiles vector tiles using leaflet.mapboxgl?

Hi Tim,

Thanks for you suggestions.  I have looked at the leafgl package, and yes
it does speed the rendering of  my polygons, however  it still has to
render them all, rather than using the tiling option, so is not as quick as
tiles would be ( if they worked!).

I have no problem locally serving  raster tiles to r leaflet(), this can be
achieved by running a simplserver, or the mbtilesserver, or inside a shiny
app by placing the tiles in the www directory.  The issue is getting any
vector tiles to dislay - the leaflet.mapboxgl packages is the only option I
have come across so far that suggests this may be a possibility.
I have been using tippecanoe from the linux terminal.

cheers

Nevil







On Wed, 11 Mar 2020 at 21:34, Tim Salabim <tim.appelhans at gmail.com> wrote:

> Hi Nevil,
> while not being able to help with mbtiles, maybe you want to try
> leafgl to view your polygons.
>
> https://github.com/r-spatial/leafgl
>
> It should have no problems with 40k polygons.
>
> Regarding RStudio's leaflet.mapboxgl, I don't think it is intended for
> local use (though I might be wrong). For using locally stored tiles, I
> think we would need something like
> https://gitlab.com/IvanSanchez/Leaflet.TileLayer.MBTiles.
>
> Out of interest, are you using tippercanoe from your command line or
> do you have some code invoking it from R?
>
> HTH,
> Tim
>
> On Wed, Mar 11, 2020 at 3:00 AM nevil amos <nevil.amos at gmail.com> wrote:
> >
> > I am working on a shiny/ leaflet map project which requires display of a
> > large polygon dataset  (40,000 polygons ~92MB sf object).
> > Needless to say it take quite a time to render the sf object and zoom in
> > and out.
> >
> > Simplifying the polygons is not an option.
> >
> > leaflet.mapboxgl  https://github.com/rstudio/leaflet.mapboxgl package
> > allows adding of Mapbox GL layers to a leaflet map.
> >
> > Since I am using my own local tiles  there should be no need for a maxbox
> > access token.
> >
> > If possible I would like to make use of leaflet.mapboxgl: addMapboxGL()
> to
> > display vector tiles ( as .mbtiles) of the polygons that have been pre-
> > rendered from the polygon dataset using tippecanoe
> > https://github.com/mapbox/tippecanoe and served using mbtileserver
> > https://github.com/consbio/mbtileserver all on the same local machine.
> > mbtileserver is running from the project directory, and the mbtiles are
> in
> > the path: <R project directory>/tilesets/mytiles.mbtiles
> > I can vie the preview in the bowser a
> > http://localhost:8000/services/myTiles/map
> >
> > however the polygons do not dispay in leaflet in r
> >
> > As this requires use of tippecanoe and mbtileserver I cannot post a
> repro,
> > however below is a pared down version fo the code I am using :
> >
> >
> > library(leaflet)
> > library(leaflet.mapboxgl)
> >
> > options(mapbox.accessToken=NA)
> >
> > base_map <- leaflet() %>%
> >  setView(lng = 145,lat = -37,zoom = 7)%>%
> >  addProviderTiles("Esri.WorldTopoMap", group = "ESRI Topo") %>%
> >   addMapox http://localhost:8000/services/myTiles ")
> >
> > have I simply got the wrong format/ incomplete URL fo the  addMapboxGL ?
> If
> > so what should it be?
> >
> > thanks
> >
> >         [[alternative HTML version deleted]]
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

        [[alternative HTML version deleted]]

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From pk@ge||z@ @end|ng |rom @tudent@@uonb|@@c@ke  Mon Mar 16 12:55:45 2020
From: pk@ge||z@ @end|ng |rom @tudent@@uonb|@@c@ke (PAMELLA KAGELIZA KILAVI)
Date: Mon, 16 Mar 2020 14:55:45 +0300
Subject: [R-sig-Geo] creating a data range for color coding and using it in
 color_manual_scale
Message-ID: <CAEQQd3JZpPQ3eQoT86Ara_8BfRh0uzxjDifkuwXEsfx6pGJ=PA@mail.gmail.com>

Dear All.

Kindly assist me with the proper code for the following. I have converted
the dose to factor and grouped it into 5 levels. I need to assign a color
code to each of the levels and use is for spatial mapping. Thank you

ggplot(Mrima, mapping=aes(x=lon,y=lat))+
geom_point(data=Mrima, aes(colour=factor(dose),
cut(dose,br=c(0,60,120,360,600,5144)))) +
scale_color_manual(my_col, values = c("#D01556#", "#DF785B","EFDC60",
"#B5D374","#7CCA89"),breaks=waiver(), aesthetics =c("colour","fill"))

This is the error I am getting

Error: Insufficient values in manual scale. 1806 needed but only 5 provided.

-- 

The University of Nairobi is ISO 9001:2015 certified.
Website: 
http://www.uonbi.ac.ke/ <http://www.uonbi.ac.ke/>
Facebook: 
https://www.facebook.com/uonbi.ac.ke <https://www.facebook.com/uonbi.ac.ke>

Twitter: @uonbi? https://twitter.com/uonb <https://twitter.com/uonb>

	[[alternative HTML version deleted]]


From Roger@B|v@nd @end|ng |rom nhh@no  Mon Mar 16 17:55:33 2020
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Mon, 16 Mar 2020 17:55:33 +0100
Subject: [R-sig-Geo] 
 creating a data range for color coding and using it in
 color_manual_scale
In-Reply-To: <CAEQQd3JZpPQ3eQoT86Ara_8BfRh0uzxjDifkuwXEsfx6pGJ=PA@mail.gmail.com>
References: <CAEQQd3JZpPQ3eQoT86Ara_8BfRh0uzxjDifkuwXEsfx6pGJ=PA@mail.gmail.com>
Message-ID: <alpine.LFD.2.21.2003161658370.995529@reclus.nhh.no>

On Mon, 16 Mar 2020, PAMELLA KAGELIZA KILAVI wrote:

> Dear All.
>
> Kindly assist me with the proper code for the following. I have converted
> the dose to factor and grouped it into 5 levels. I need to assign a color
> code to each of the levels and use is for spatial mapping. Thank you
>
> ggplot(Mrima, mapping=aes(x=lon,y=lat))+
> geom_point(data=Mrima, aes(colour=factor(dose),
> cut(dose,br=c(0,60,120,360,600,5144)))) +
> scale_color_manual(my_col, values = c("#D01556#", "#DF785B","EFDC60",
> "#B5D374","#7CCA89"),breaks=waiver(), aesthetics =c("colour","fill"))
>
> This is the error I am getting
>
> Error: Insufficient values in manual scale. 1806 needed but only 5 provided.
>

Please either make the Mrima object available for download (provide a URL, 
do not attach), or use a built-in data set to reproduce the problem. I 
think that the arguments to geom_point() are either not as expected, or 
should be named, or both. I further think that Mrima should be as sf 
object, and if you then use tmap (or tmap or mapview for webmaps), life 
may become much easier. See perhaps:
https://geocompr.robinlovelace.net/adv-map.html, 
https://www.r-spatial.org/r/2018/10/25/ggplot2-sf.html, 
https://r-spatial.github.io/sf/articles/sf5.html

Using the North Carolina SIDS data set, I get:

> library(sf)
Linking to GEOS 3.8.0, GDAL 3.1.0dev-e52a02d452, PROJ 7.0.0
> nc <- st_read(system.file("shape/nc.shp", package="sf"), quiet = TRUE)
> nc_sp <- st_transform(nc, 2264)
> nc_pts <- st_centroid(nc_sp)
Warning message:
In st_centroid.sf(nc_sp) :
   st_centroid assumes attributes are constant over geometries of x
> nc_df <- nc_pts
> pts <- st_coordinates(nc_df)
> st_geometry(nc_df) <- NULL
> nc_df$x <- pts[,1]
> nc_df$y <- pts[,2]
> library(ggplot2)
> ggplot(nc_df, mapping=aes(x=x, y=y)) + geom_point(data=nc_df, 
aes(colour=factor(BIR74), cut(BIR74, br=c(0, 1000, 2000, 3000, 4000, 
25000)))) + scale_colour_manual(my_col, values=c("#D01556#", 
"#DF785B","EFDC60","#B5D374","#7CCA89"),breaks=waiver(), aesthetics 
=c("colour","fill"))
Error in ggproto(NULL, super, call = match.call(), aesthetics = 
aesthetics,  :
   object 'my_col' not found
> ggplot(nc_df, mapping=aes(x=x, y=y)) + geom_point(data=nc_df, 
aes(colour=factor(BIR74), cut(BIR74, br=c(0, 1000, 2000, 3000, 4000, 
25000)))) + scale_colour_manual(values=c("#D01556#", 
"#DF785B","EFDC60","#B5D374","#7CCA89"),breaks=waiver(), aesthetics 
=c("colour","fill"))
Error: Insufficient values in manual scale. 100 needed but only 5 
provided.
> ggplot(nc_df, mapping=aes(x=x, y=y)) + geom_point(data=nc_df, 
aes(colour=factor(cut(BIR74, br=c(0, 1000, 2000, 3000, 4000, 25000))))) + 
scale_colour_manual(values=c("#D01556#", 
"#DF785B","EFDC60","#B5D374","#7CCA89"),breaks=waiver(), aesthetics 
=c("colour","fill"))
Error: Malformed colour string `#D01556#`. Must contain either 6 or 8 hex 
values
> ggplot(nc_df, mapping=aes(x=x, y=y)) + geom_point(data=nc_df, 
aes(colour=factor(cut(BIR74, br=c(0, 1000, 2000, 3000, 4000, 25000))))) + 
scale_colour_manual(values=c("#D01556", 
"#DF785B","EFDC60","#B5D374","#7CCA89"),breaks=waiver(), aesthetics 
=c("colour","fill"))
Error: Unknown colour name: EFDC60
> ggplot(nc_df, mapping=aes(x=x, y=y)) + geom_point(data=nc_df, 
aes(colour=factor(cut(BIR74, br=c(0, 1000, 2000, 3000, 4000, 25000))))) + 
scale_colour_manual(values=c("#D01556", 
"#DF785B","#EFDC60","#B5D374","#7CCA89"),breaks=waiver(), aesthetics 
=c("colour","fill"))
> nc_df$dose_f <- factor(cut(nc_df$BIR74, br=c(0, 1000, 2000, 3000, 4000, 
25000)))
> ggplot(nc_df, mapping=aes(x=x, y=y)) + geom_point(data=nc_df, 
aes(colour=dose_f)) + scale_colour_manual(values=c("#D01556", 
"#DF785B","#EFDC60","#B5D374","#7CCA89"),breaks=waiver(), aesthetics 
=c("colour","fill"))

As an alternative, since we already had an sf object:

> library(tmap)
> map <- tm_shape(nc_pts) + tm_symbols(size=0.5, col="BIR74", 
style="fixed", breaks=c(0, 1000, 2000, 3000, 4000, 25000),
palette=c("#D01556", "#DF785B","#EFDC60","#B5D374","#7CCA89")) +
tm_legend(outside=TRUE)
> map

Extra bonus:

> tmap_mode("view")
> map

> Mrima_sf <- st_as_sf(Mrima, coords=c("lon", "lat"), crs=4326)

will create an sf object defined in decimal degrees (possibly your lon and 
lat if they are decimal degrees).

Hope this helps,

Roger

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en


From pk@ge||z@ @end|ng |rom @tudent@@uonb|@@c@ke  Tue Mar 17 06:38:41 2020
From: pk@ge||z@ @end|ng |rom @tudent@@uonb|@@c@ke (PAMELLA KAGELIZA KILAVI)
Date: Tue, 17 Mar 2020 08:38:41 +0300
Subject: [R-sig-Geo] 
 creating a data range for color coding and using it in
 color_manual_scale
In-Reply-To: <alpine.LFD.2.21.2003161658370.995529@reclus.nhh.no>
References: <CAEQQd3JZpPQ3eQoT86Ara_8BfRh0uzxjDifkuwXEsfx6pGJ=PA@mail.gmail.com>
 <alpine.LFD.2.21.2003161658370.995529@reclus.nhh.no>
Message-ID: <CAEQQd3+9dzSV+XvOcriWns0n8CUjnKk1CrMYKYiSieOGn-y5Ag@mail.gmail.com>

Thank you. I actually have converted Mrima into sf to be able to use the
lon and lat after filtering it from the main file fetched by readxl of
different files downloaded from Safecast bGeiger nano Counter.

the continuous data on continuous scale worked out perfectly with
scale_color_viridis. However,  However, we are interested in highlighting
areas that are hot spots around the area. We, therefore, need the data such
that we classed kind of post map (as used in Surfer program) such that the
geo-referenced dose rates are grouped into coded discrete classes.

Let me try out. I will get back to you with the progress

Once again thank you for the feedback

On Mon, Mar 16, 2020 at 7:55 PM Roger Bivand <Roger.Bivand at nhh.no> wrote:

> On Mon, 16 Mar 2020, PAMELLA KAGELIZA KILAVI wrote:
>
> > Dear All.
> >
> > Kindly assist me with the proper code for the following. I have converted
> > the dose to factor and grouped it into 5 levels. I need to assign a color
> > code to each of the levels and use is for spatial mapping. Thank you
> >
> > ggplot(Mrima, mapping=aes(x=lon,y=lat))+
> > geom_point(data=Mrima, aes(colour=factor(dose),
> > cut(dose,br=c(0,60,120,360,600,5144)))) +
> > scale_color_manual(my_col, values = c("#D01556#", "#DF785B","EFDC60",
> > "#B5D374","#7CCA89"),breaks=waiver(), aesthetics =c("colour","fill"))
> >
> > This is the error I am getting
> >
> > Error: Insufficient values in manual scale. 1806 needed but only 5
> provided.
> >
>
> Please either make the Mrima object available for download (provide a URL,
> do not attach), or use a built-in data set to reproduce the problem. I
> think that the arguments to geom_point() are either not as expected, or
> should be named, or both. I further think that Mrima should be as sf
> object, and if you then use tmap (or tmap or mapview for webmaps), life
> may become much easier. See perhaps:
> https://geocompr.robinlovelace.net/adv-map.html,
> https://www.r-spatial.org/r/2018/10/25/ggplot2-sf.html,
> https://r-spatial.github.io/sf/articles/sf5.html
>
> Using the North Carolina SIDS data set, I get:
>
> > library(sf)
> Linking to GEOS 3.8.0, GDAL 3.1.0dev-e52a02d452, PROJ 7.0.0
> > nc <- st_read(system.file("shape/nc.shp", package="sf"), quiet = TRUE)
> > nc_sp <- st_transform(nc, 2264)
> > nc_pts <- st_centroid(nc_sp)
> Warning message:
> In st_centroid.sf(nc_sp) :
>    st_centroid assumes attributes are constant over geometries of x
> > nc_df <- nc_pts
> > pts <- st_coordinates(nc_df)
> > st_geometry(nc_df) <- NULL
> > nc_df$x <- pts[,1]
> > nc_df$y <- pts[,2]
> > library(ggplot2)
> > ggplot(nc_df, mapping=aes(x=x, y=y)) + geom_point(data=nc_df,
> aes(colour=factor(BIR74), cut(BIR74, br=c(0, 1000, 2000, 3000, 4000,
> 25000)))) + scale_colour_manual(my_col, values=c("#D01556#",
> "#DF785B","EFDC60","#B5D374","#7CCA89"),breaks=waiver(), aesthetics
> =c("colour","fill"))
> Error in ggproto(NULL, super, call = match.call(), aesthetics =
> aesthetics,  :
>    object 'my_col' not found
> > ggplot(nc_df, mapping=aes(x=x, y=y)) + geom_point(data=nc_df,
> aes(colour=factor(BIR74), cut(BIR74, br=c(0, 1000, 2000, 3000, 4000,
> 25000)))) + scale_colour_manual(values=c("#D01556#",
> "#DF785B","EFDC60","#B5D374","#7CCA89"),breaks=waiver(), aesthetics
> =c("colour","fill"))
> Error: Insufficient values in manual scale. 100 needed but only 5
> provided.
> > ggplot(nc_df, mapping=aes(x=x, y=y)) + geom_point(data=nc_df,
> aes(colour=factor(cut(BIR74, br=c(0, 1000, 2000, 3000, 4000, 25000))))) +
> scale_colour_manual(values=c("#D01556#",
> "#DF785B","EFDC60","#B5D374","#7CCA89"),breaks=waiver(), aesthetics
> =c("colour","fill"))
> Error: Malformed colour string `#D01556#`. Must contain either 6 or 8 hex
> values
> > ggplot(nc_df, mapping=aes(x=x, y=y)) + geom_point(data=nc_df,
> aes(colour=factor(cut(BIR74, br=c(0, 1000, 2000, 3000, 4000, 25000))))) +
> scale_colour_manual(values=c("#D01556",
> "#DF785B","EFDC60","#B5D374","#7CCA89"),breaks=waiver(), aesthetics
> =c("colour","fill"))
> Error: Unknown colour name: EFDC60
> > ggplot(nc_df, mapping=aes(x=x, y=y)) + geom_point(data=nc_df,
> aes(colour=factor(cut(BIR74, br=c(0, 1000, 2000, 3000, 4000, 25000))))) +
> scale_colour_manual(values=c("#D01556",
> "#DF785B","#EFDC60","#B5D374","#7CCA89"),breaks=waiver(), aesthetics
> =c("colour","fill"))
> > nc_df$dose_f <- factor(cut(nc_df$BIR74, br=c(0, 1000, 2000, 3000, 4000,
> 25000)))
> > ggplot(nc_df, mapping=aes(x=x, y=y)) + geom_point(data=nc_df,
> aes(colour=dose_f)) + scale_colour_manual(values=c("#D01556",
> "#DF785B","#EFDC60","#B5D374","#7CCA89"),breaks=waiver(), aesthetics
> =c("colour","fill"))
>
> As an alternative, since we already had an sf object:
>
> > library(tmap)
> > map <- tm_shape(nc_pts) + tm_symbols(size=0.5, col="BIR74",
> style="fixed", breaks=c(0, 1000, 2000, 3000, 4000, 25000),
> palette=c("#D01556", "#DF785B","#EFDC60","#B5D374","#7CCA89")) +
> tm_legend(outside=TRUE)
> > map
>
> Extra bonus:
>
> > tmap_mode("view")
> > map
>
> > Mrima_sf <- st_as_sf(Mrima, coords=c("lon", "lat"), crs=4326)
>
> will create an sf object defined in decimal degrees (possibly your lon and
> lat if they are decimal degrees).
>
> Hope this helps,
>
> Roger
>
> --
> Roger Bivand
> Department of Economics, Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
> https://orcid.org/0000-0003-2392-6140
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>

-- 

The University of Nairobi is ISO 9001:2015 certified.
Website: 
http://www.uonbi.ac.ke/ <http://www.uonbi.ac.ke/>
Facebook: 
https://www.facebook.com/uonbi.ac.ke <https://www.facebook.com/uonbi.ac.ke>

Twitter: @uonbi? https://twitter.com/uonb <https://twitter.com/uonb>

	[[alternative HTML version deleted]]


From ee|koudou@@ @end|ng |rom |ordh@m@edu  Tue Mar 17 15:27:56 2020
From: ee|koudou@@ @end|ng |rom |ordh@m@edu (El Mechry El Koudouss)
Date: Tue, 17 Mar 2020 10:27:56 -0400
Subject: [R-sig-Geo] Merging Shape files
Message-ID: <CABvzdCUxgNB7L5y5dvn3vgGviTzCHzBBEyv-rCcwKvntDO9BxQ@mail.gmail.com>

Dear readers,
I downloaded a shapefile with data on crime incidents in Washington DC in
2016 (available here:
https://opendata.dc.gov/datasets/crime-incidents-in-2016) and another
shapefile with data on parks and recreation areas, also in Washington DC
(available here: https://opendata.dc.gov/datasets/parks-and-recreation-areas).
I was able to read both shapefiles using st_read() from the sf package. My
question is, how can I merge the two data sets? I tried st_join() but it
simply resulted in empty columns from the parks dataset getting added to
the crime data. Any guidance would be much appreciated.
library(sf)
parks <- st_read("Parks_and_Recreation_Areas.shp")
crime <- st_read("Crime_Incidents_in_2016.shp")
df <- st_join(crime, parks)

-- 
El Mechry, El Koudouss (Meshry)
Graduate Research Assistant
Center for International Policy Studies
Fordham University
Department of Economics
Website: www.meshry.com

	[[alternative HTML version deleted]]


From m||uj|@b @end|ng |rom gm@||@com  Tue Mar 17 15:29:30 2020
From: m||uj|@b @end|ng |rom gm@||@com (Miluji Sb)
Date: Tue, 17 Mar 2020 15:29:30 +0100
Subject: [R-sig-Geo] Extract VIIRS data in R
Message-ID: <CAMLwc7OgUxHWk1Q+T4zNhG2FoTu_Gg+xHr37LvuFvJ3vm=B+BA@mail.gmail.com>

Dear all,

Hope everyone is keeping safe.

I am trying to extract/read VIIRS nighttime lights data but the output
seems rather strange.

I have uploaded the file here
<https://drive.google.com/open?id=1zpqXJ8AlEcnk6ApRb75tfQc4-Y8AfK5h> so as
not exceed the size limit of the email.

## Code ##
library(ncdf4)
library(rgdal)

netcdf_file <- c("VNP02DNB_NRT.A2020069.1048.001.nc")
nl <- brick(netcdf_file, lvar=0, values=TRUE,
varname="observation_data/DNB_observations")

## Detail ##
class      : RasterLayer
dimensions : 3232, 4064, 13134848  (nrow, ncol, ncell)
resolution : 1, 1  (x, y)
extent     : 0.5, 4064.5, 0.5, 3232.5  (xmin, xmax, ymin, ymax)
crs        : NA
source     : C:/Users/shour/Desktop/VNP02DNB_NRT.A2020069.1048.001.nc
names      : DNB.observations.at.pixel.locations
zvar       : observation_data/DNB_observations

The spatial resolution is supposed to be 750m but this shows 1?. What am I
doing wrong? Any help will be greatly appreciated. Thank you.

Sincerely,

Millu

	[[alternative HTML version deleted]]


From dexter@|ocke @end|ng |rom gm@||@com  Tue Mar 17 15:35:42 2020
From: dexter@|ocke @end|ng |rom gm@||@com (Dexter Locke)
Date: Tue, 17 Mar 2020 10:35:42 -0400
Subject: [R-sig-Geo] Merging Shape files
In-Reply-To: <CABvzdCUxgNB7L5y5dvn3vgGviTzCHzBBEyv-rCcwKvntDO9BxQ@mail.gmail.com>
References: <CABvzdCUxgNB7L5y5dvn3vgGviTzCHzBBEyv-rCcwKvntDO9BxQ@mail.gmail.com>
Message-ID: <CAA=SVwE=cN+CMtL3MhAHuHP8K7rqJ5RO+nOvKgtjtdtn4mgx_g@mail.gmail.com>

Within st_join() see the options like "left = TRUE".

You may also want to look at st_intersects()

Here are other helpful reference websites:
https://r-spatial.github.io/sf/reference/geos_binary_pred.html

https://cran.r-project.org/web/packages/sf/vignettes/sf3.html

-Dexter


On Tue, Mar 17, 2020 at 10:29 AM El Mechry El Koudouss <
eelkoudouss at fordham.edu> wrote:

> Dear readers,
> I downloaded a shapefile with data on crime incidents in Washington DC in
> 2016 (available here:
> https://opendata.dc.gov/datasets/crime-incidents-in-2016) and another
> shapefile with data on parks and recreation areas, also in Washington DC
> (available here:
> https://opendata.dc.gov/datasets/parks-and-recreation-areas).
> I was able to read both shapefiles using st_read() from the sf package. My
> question is, how can I merge the two data sets? I tried st_join() but it
> simply resulted in empty columns from the parks dataset getting added to
> the crime data. Any guidance would be much appreciated.
> library(sf)
> parks <- st_read("Parks_and_Recreation_Areas.shp")
> crime <- st_read("Crime_Incidents_in_2016.shp")
> df <- st_join(crime, parks)
>
> --
> El Mechry, El Koudouss (Meshry)
> Graduate Research Assistant
> Center for International Policy Studies
> Fordham University
> Department of Economics
> Website: www.meshry.com
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From Roger@B|v@nd @end|ng |rom nhh@no  Wed Mar 18 14:12:11 2020
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Wed, 18 Mar 2020 14:12:11 +0100
Subject: [R-sig-Geo] R spatial follows GDAL and PROJ development
Message-ID: <alpine.LFD.2.21.2003181410290.2563188@reclus.nhh.no>

A new blog: "R spatial follows GDAL and PROJ development" has been
published: https://www.r-spatial.org/r/2020/03/17/wkt.html.

Those maintaining packages using sf or sp/rgdal, and authors of scripts
using them should read the blog and be prepared to take rapid action when
sf 0.9 is released and built using PROJ >= 6 and GDAL >= 3. An early
release of rgdal (>= 1.5, probably 1.6.0, is also to be expected).

Roger

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en


From |v|@|e|ro @end|ng |rom gm@||@com  Wed Mar 18 14:33:58 2020
From: |v|@|e|ro @end|ng |rom gm@||@com (Frederico Faleiro)
Date: Wed, 18 Mar 2020 10:33:58 -0300
Subject: [R-sig-Geo] Extract VIIRS data in R
In-Reply-To: <CAMLwc7OgUxHWk1Q+T4zNhG2FoTu_Gg+xHr37LvuFvJ3vm=B+BA@mail.gmail.com>
References: <CAMLwc7OgUxHWk1Q+T4zNhG2FoTu_Gg+xHr37LvuFvJ3vm=B+BA@mail.gmail.com>
Message-ID: <CAL+ycWnZPpOTN8YW3Shaq_aYCV9szV_6n5cntfMeEx28NqTgLA@mail.gmail.com>

Hi Miluji,

the R in general do not handle very well with netCDF. However I
recommend you use the netcdf4 package before try others.
This link is a good start:
http://geog.uoregon.edu/bartlein/courses/geog490/week04-netCDF.html#get-coordinate-including-time-variables
.
The coordinates of this file is not in longitude and latitude, it use
"number_of_lines" for X Axis and "number_of_pixels" for Y Axis. This way
the difference between the cells is always one and raster package
interprete the difference as one degree and return an warning about it.
I open the file in the software Panoply (design to work with netCDF)  and
everything is OK apparently.
Check bellow some exploration of the data in R.

library(raster)
library(ncdf4)
library(rgdal)

# netcdf4 package
netcdf_file <- "VNP02DNB_NRT.A2020069.1048.001.nc"
nc <- nc_open(netcdf_file)
print(nc)
# check your variable is structured as:
observation_data/DNB_observations[number_of_pixels,number_of_lines]
# variables available
names(nc[["var"]])
# properties from your variable
ncatt_get(nc, "observation_data/DNB_observations")
# get the variables values and check the structure
obs_matrix <- ncvar_get(nc, "observation_data/DNB_observations")
str(obs_matrix)

# raster package
nc_r <- brick(netcdf_file, lvar=0, values=TRUE,
varname="observation_data/DNB_observations")
# [1] "vobjtovarid4: **** WARNING **** I was asked to get a varid for
dimension named number_of_pixels BUT this dimension HAS NO DIMVAR! Code
will probably fail at this point"
# [1] "vobjtovarid4: **** WARNING **** I was asked to get a varid for
dimension named number_of_lines BUT this dimension HAS NO DIMVAR! Code will
probably fail at this point"

Best regards,

Frederico Faleiro
Postdoctoral Researcher in the INCT-EECBio (https://www.eecbio.ufg.br/)
Federal University of Goi?s | Brazil
RG: https://www.researchgate.net/profile/Frederico_Faleiro

On Tue, Mar 17, 2020 at 11:39 AM Miluji Sb <milujisb at gmail.com> wrote:

> Dear all,
>
> Hope everyone is keeping safe.
>
> I am trying to extract/read VIIRS nighttime lights data but the output
> seems rather strange.
>
> I have uploaded the file here
> <https://drive.google.com/open?id=1zpqXJ8AlEcnk6ApRb75tfQc4-Y8AfK5h> so as
> not exceed the size limit of the email.
>
> ## Code ##
> library(ncdf4)
> library(rgdal)
>
> netcdf_file <- c("VNP02DNB_NRT.A2020069.1048.001.nc")
> nl <- brick(netcdf_file, lvar=0, values=TRUE,
> varname="observation_data/DNB_observations")
>
> ## Detail ##
> class      : RasterLayer
> dimensions : 3232, 4064, 13134848  (nrow, ncol, ncell)
> resolution : 1, 1  (x, y)
> extent     : 0.5, 4064.5, 0.5, 3232.5  (xmin, xmax, ymin, ymax)
> crs        : NA
> source     : C:/Users/shour/Desktop/VNP02DNB_NRT.A2020069.1048.001.nc
> names      : DNB.observations.at.pixel.locations
> zvar       : observation_data/DNB_observations
>
> The spatial resolution is supposed to be 750m but this shows 1?. What am I
> doing wrong? Any help will be greatly appreciated. Thank you.
>
> Sincerely,
>
> Millu
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From w||c|m @end|ng |rom hotm@||@com  Wed Mar 18 14:46:19 2020
From: w||c|m @end|ng |rom hotm@||@com (Washington Correia Filho)
Date: Wed, 18 Mar 2020 13:46:19 +0000
Subject: [R-sig-Geo] Extract VIIRS data in R
In-Reply-To: <CAMLwc7OgUxHWk1Q+T4zNhG2FoTu_Gg+xHr37LvuFvJ3vm=B+BA@mail.gmail.com>
References: <CAMLwc7OgUxHWk1Q+T4zNhG2FoTu_Gg+xHr37LvuFvJ3vm=B+BA@mail.gmail.com>
Message-ID: <SC1PR80MB435191B6AD188AC3053D9BC6DAF70@SC1PR80MB4351.lamprd80.prod.outlook.com>

Dear Millu,

The data they use is not with the CRS set, so the displayed result is showing the grid points (extent: 0.5, 4064.5, 0.5, 3232.5). Then you should consult the VIIRS data guide so that you can organize your data, to which you need to know the start data for both latitude and longitude, as well as the multiplication factor and so you will have your data readjusted. I also have a similar problem to solve, if I can, I can contact you and give you the data and the scheme I used. See you soon.

Sincerely,
Washington L.F. Correia Filho
Postdoctoral Research Fellowship in Meteorology, UFAL, Brazil
Dr. in Climate Sciences, UFRN, Brazil
http://lattes.cnpq.br/7596712599262929
ORCID: https://orcid.org/0000-0002-4029-4491/

________________________________
De: R-sig-Geo <r-sig-geo-bounces at r-project.org> em nome de Miluji Sb <milujisb at gmail.com>
Enviado: ter?a-feira, 17 de mar?o de 2020 11:29
Para: R-sig-geo mailing list <r-sig-geo at r-project.org>
Assunto: [R-sig-Geo] Extract VIIRS data in R

Dear all,

Hope everyone is keeping safe.

I am trying to extract/read VIIRS nighttime lights data but the output
seems rather strange.

I have uploaded the file here
<https://drive.google.com/open?id=1zpqXJ8AlEcnk6ApRb75tfQc4-Y8AfK5h> so as
not exceed the size limit of the email.

## Code ##
library(ncdf4)
library(rgdal)

netcdf_file <- c("VNP02DNB_NRT.A2020069.1048.001.nc")
nl <- brick(netcdf_file, lvar=0, values=TRUE,
varname="observation_data/DNB_observations")

## Detail ##
class      : RasterLayer
dimensions : 3232, 4064, 13134848  (nrow, ncol, ncell)
resolution : 1, 1  (x, y)
extent     : 0.5, 4064.5, 0.5, 3232.5  (xmin, xmax, ymin, ymax)
crs        : NA
source     : C:/Users/shour/Desktop/VNP02DNB_NRT.A2020069.1048.001.nc
names      : DNB.observations.at.pixel.locations
zvar       : observation_data/DNB_observations

The spatial resolution is supposed to be 750m but this shows 1?. What am I
doing wrong? Any help will be greatly appreciated. Thank you.

Sincerely,

Millu

        [[alternative HTML version deleted]]

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo

[https://ipmcdn.avast.com/images/icons/icon-envelope-tick-round-orange-animated-no-repeat-v1.gif]<https://www.avast.com/sig-email?utm_medium=email&utm_source=link&utm_campaign=sig-email&utm_content=webmail>  Livre de v?rus. www.avast.com<https://www.avast.com/sig-email?utm_medium=email&utm_source=link&utm_campaign=sig-email&utm_content=webmail>.

	[[alternative HTML version deleted]]


From jo@eph|ew|@1992 @end|ng |rom gm@||@com  Wed Mar 18 15:21:11 2020
From: jo@eph|ew|@1992 @end|ng |rom gm@||@com (Joe Lewis)
Date: Wed, 18 Mar 2020 14:21:11 +0000
Subject: [R-sig-Geo] rgdal travis error: configure: error: gdal-config not
 found or not executable.
Message-ID: <CAM0xMQ_pGKC4LdM_X6XuJ4gYE-=SFu8FEKcEYzk7Fs63WTr+9g@mail.gmail.com>

Hi,

I'm testing a package using travis and I keep getting an error message
about rgdal not being found or executable. I've been trying to piece
together things I've found online but to no avail.

https://travis-ci.org/github/josephlewis/leastcostpath/builds/663944787

travis.yml

# R for travis: see documentation at
https://docs.travis-ci.com/user/languages/r

language: R
sudo: false
cache: packages

repos:
  CRAN: https://cran.rstudio.com
  rforge: http://R-Forge.R-project.org

apt_packages:
    - gdal-bin

before_install:
install.packages("rgdal", repos="http://R-Forge.R-project.org")


Any help would be appreciated.

Thanks.

Kind regards,
Joseph Lewis

	[[alternative HTML version deleted]]


From md@umner @end|ng |rom gm@||@com  Wed Mar 18 15:29:05 2020
From: md@umner @end|ng |rom gm@||@com (Michael Sumner)
Date: Thu, 19 Mar 2020 01:29:05 +1100
Subject: [R-sig-Geo] Extract VIIRS data in R
In-Reply-To: <CAMLwc7OgUxHWk1Q+T4zNhG2FoTu_Gg+xHr37LvuFvJ3vm=B+BA@mail.gmail.com>
References: <CAMLwc7OgUxHWk1Q+T4zNhG2FoTu_Gg+xHr37LvuFvJ3vm=B+BA@mail.gmail.com>
Message-ID: <CAAcGz9-SiTFVEgV++H6U0P7QM3g=cC+__7qA6SyKJRFQ9J7xiA@mail.gmail.com>

You won't find much on this kind of file in the R community, this is
relatively new NetCDF-4 with "groups", and contains a satellite "granule" -
a kind of pre-mapping raw data array with only technical information about
where the scanning occurred.

In short, raster and stars package (and RNetCDF and ncdf4) will read the
data from this file, but give very little or no help for how to treat it
like a map. The spatial resolution and extent are purely nominal as shown
by raster, a spacing of 1 in two dimensions and extending from 0 to nrows,
0 to ncols (with a  half cell shift). There aren't any coordinate arrays in
the file, or any simple way to transform from this matrix-space to
geography as far as I know.  (Would love to be corrected on how to do
that).

You'd need to pursue domain-specific expertise to discover the mapping of
this, unless some kind soul turns up to help here. I expect you'll want to
find a product that has been converted into simpler form for these data.

Cheers, Mike.


On Wed, Mar 18, 2020 at 1:39 AM Miluji Sb <milujisb at gmail.com> wrote:

> Dear all,
>
> Hope everyone is keeping safe.
>
> I am trying to extract/read VIIRS nighttime lights data but the output
> seems rather strange.
>
> I have uploaded the file here
> <https://drive.google.com/open?id=1zpqXJ8AlEcnk6ApRb75tfQc4-Y8AfK5h> so as
> not exceed the size limit of the email.
>
> ## Code ##
> library(ncdf4)
> library(rgdal)
>
> netcdf_file <- c("VNP02DNB_NRT.A2020069.1048.001.nc")
> nl <- brick(netcdf_file, lvar=0, values=TRUE,
> varname="observation_data/DNB_observations")
>
> ## Detail ##
> class      : RasterLayer
> dimensions : 3232, 4064, 13134848  (nrow, ncol, ncell)
> resolution : 1, 1  (x, y)
> extent     : 0.5, 4064.5, 0.5, 3232.5  (xmin, xmax, ymin, ymax)
> crs        : NA
> source     : C:/Users/shour/Desktop/VNP02DNB_NRT.A2020069.1048.001.nc
> names      : DNB.observations.at.pixel.locations
> zvar       : observation_data/DNB_observations
>
> The spatial resolution is supposed to be 750m but this shows 1?. What am I
> doing wrong? Any help will be greatly appreciated. Thank you.
>
> Sincerely,
>
> Millu
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


-- 
Michael Sumner
Software and Database Engineer
Australian Antarctic Division
Hobart, Australia
e-mail: mdsumner at gmail.com

	[[alternative HTML version deleted]]


From z|@207 @end|ng |rom gm@||@com  Wed Mar 18 15:34:31 2020
From: z|@207 @end|ng |rom gm@||@com (Zia Ahmed)
Date: Wed, 18 Mar 2020 10:34:31 -0400
Subject: [R-sig-Geo] Extract VIIRS data in R
In-Reply-To: <CAL+ycWnZPpOTN8YW3Shaq_aYCV9szV_6n5cntfMeEx28NqTgLA@mail.gmail.com>
References: <CAMLwc7OgUxHWk1Q+T4zNhG2FoTu_Gg+xHr37LvuFvJ3vm=B+BA@mail.gmail.com>
 <CAL+ycWnZPpOTN8YW3Shaq_aYCV9szV_6n5cntfMeEx28NqTgLA@mail.gmail.com>
Message-ID: <CAKqUiGkSN9m2tc8e+Y4aPCV4K-Jx7ujMir+eQwoyYP=aYQDtew@mail.gmail.com>

This is might help you:

https://zia207.github.io/geospatial-r-github.io/netCDF-data-processing.html

Zia

On Wed, Mar 18, 2020, 9:34 AM Frederico Faleiro <fvfaleiro at gmail.com> wrote:

> Hi Miluji,
>
> the R in general do not handle very well with netCDF. However I
> recommend you use the netcdf4 package before try others.
> This link is a good start:
>
> http://geog.uoregon.edu/bartlein/courses/geog490/week04-netCDF.html#get-coordinate-including-time-variables
> .
> The coordinates of this file is not in longitude and latitude, it use
> "number_of_lines" for X Axis and "number_of_pixels" for Y Axis. This way
> the difference between the cells is always one and raster package
> interprete the difference as one degree and return an warning about it.
> I open the file in the software Panoply (design to work with netCDF)  and
> everything is OK apparently.
> Check bellow some exploration of the data in R.
>
> library(raster)
> library(ncdf4)
> library(rgdal)
>
> # netcdf4 package
> netcdf_file <- "VNP02DNB_NRT.A2020069.1048.001.nc"
> nc <- nc_open(netcdf_file)
> print(nc)
> # check your variable is structured as:
> observation_data/DNB_observations[number_of_pixels,number_of_lines]
> # variables available
> names(nc[["var"]])
> # properties from your variable
> ncatt_get(nc, "observation_data/DNB_observations")
> # get the variables values and check the structure
> obs_matrix <- ncvar_get(nc, "observation_data/DNB_observations")
> str(obs_matrix)
>
> # raster package
> nc_r <- brick(netcdf_file, lvar=0, values=TRUE,
> varname="observation_data/DNB_observations")
> # [1] "vobjtovarid4: **** WARNING **** I was asked to get a varid for
> dimension named number_of_pixels BUT this dimension HAS NO DIMVAR! Code
> will probably fail at this point"
> # [1] "vobjtovarid4: **** WARNING **** I was asked to get a varid for
> dimension named number_of_lines BUT this dimension HAS NO DIMVAR! Code will
> probably fail at this point"
>
> Best regards,
>
> Frederico Faleiro
> Postdoctoral Researcher in the INCT-EECBio (https://www.eecbio.ufg.br/)
> Federal University of Goi?s | Brazil
> RG: https://www.researchgate.net/profile/Frederico_Faleiro
>
> On Tue, Mar 17, 2020 at 11:39 AM Miluji Sb <milujisb at gmail.com> wrote:
>
> > Dear all,
> >
> > Hope everyone is keeping safe.
> >
> > I am trying to extract/read VIIRS nighttime lights data but the output
> > seems rather strange.
> >
> > I have uploaded the file here
> > <https://drive.google.com/open?id=1zpqXJ8AlEcnk6ApRb75tfQc4-Y8AfK5h> so
> as
> > not exceed the size limit of the email.
> >
> > ## Code ##
> > library(ncdf4)
> > library(rgdal)
> >
> > netcdf_file <- c("VNP02DNB_NRT.A2020069.1048.001.nc")
> > nl <- brick(netcdf_file, lvar=0, values=TRUE,
> > varname="observation_data/DNB_observations")
> >
> > ## Detail ##
> > class      : RasterLayer
> > dimensions : 3232, 4064, 13134848  (nrow, ncol, ncell)
> > resolution : 1, 1  (x, y)
> > extent     : 0.5, 4064.5, 0.5, 3232.5  (xmin, xmax, ymin, ymax)
> > crs        : NA
> > source     : C:/Users/shour/Desktop/VNP02DNB_NRT.A2020069.1048.001.nc
> > names      : DNB.observations.at.pixel.locations
> > zvar       : observation_data/DNB_observations
> >
> > The spatial resolution is supposed to be 750m but this shows 1?. What am
> I
> > doing wrong? Any help will be greatly appreciated. Thank you.
> >
> > Sincerely,
> >
> > Millu
> >
> >         [[alternative HTML version deleted]]
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From z|@207 @end|ng |rom gm@||@com  Wed Mar 18 15:37:09 2020
From: z|@207 @end|ng |rom gm@||@com (Zia Ahmed)
Date: Wed, 18 Mar 2020 10:37:09 -0400
Subject: [R-sig-Geo] Merging Shape files
In-Reply-To: <CAA=SVwE=cN+CMtL3MhAHuHP8K7rqJ5RO+nOvKgtjtdtn4mgx_g@mail.gmail.com>
References: <CABvzdCUxgNB7L5y5dvn3vgGviTzCHzBBEyv-rCcwKvntDO9BxQ@mail.gmail.com>
 <CAA=SVwE=cN+CMtL3MhAHuHP8K7rqJ5RO+nOvKgtjtdtn4mgx_g@mail.gmail.com>
Message-ID: <CAKqUiGn6gs386h7PYSnw35gsnEcxx4jYE-F395ZmZ9190w4Kcw@mail.gmail.com>

Please  check this:

https://zia207.github.io/geospatial-r-github.io/geoprocessing-vector-data.html
Best
Zia

On Tue, Mar 17, 2020, 10:39 AM Dexter Locke <dexter.locke at gmail.com> wrote:

> Within st_join() see the options like "left = TRUE".
>
> You may also want to look at st_intersects()
>
> Here are other helpful reference websites:
> https://r-spatial.github.io/sf/reference/geos_binary_pred.html
>
> https://cran.r-project.org/web/packages/sf/vignettes/sf3.html
>
> -Dexter
>
>
> On Tue, Mar 17, 2020 at 10:29 AM El Mechry El Koudouss <
> eelkoudouss at fordham.edu> wrote:
>
> > Dear readers,
> > I downloaded a shapefile with data on crime incidents in Washington DC in
> > 2016 (available here:
> > https://opendata.dc.gov/datasets/crime-incidents-in-2016) and another
> > shapefile with data on parks and recreation areas, also in Washington DC
> > (available here:
> > https://opendata.dc.gov/datasets/parks-and-recreation-areas).
> > I was able to read both shapefiles using st_read() from the sf package.
> My
> > question is, how can I merge the two data sets? I tried st_join() but it
> > simply resulted in empty columns from the parks dataset getting added to
> > the crime data. Any guidance would be much appreciated.
> > library(sf)
> > parks <- st_read("Parks_and_Recreation_Areas.shp")
> > crime <- st_read("Crime_Incidents_in_2016.shp")
> > df <- st_join(crime, parks)
> >
> > --
> > El Mechry, El Koudouss (Meshry)
> > Graduate Research Assistant
> > Center for International Policy Studies
> > Fordham University
> > Department of Economics
> > Website: www.meshry.com
> >
> >         [[alternative HTML version deleted]]
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From btupper @end|ng |rom b|ge|ow@org  Wed Mar 18 15:45:00 2020
From: btupper @end|ng |rom b|ge|ow@org (Ben Tupper)
Date: Wed, 18 Mar 2020 10:45:00 -0400
Subject: [R-sig-Geo] R spatial follows GDAL and PROJ development
In-Reply-To: <alpine.LFD.2.21.2003181410290.2563188@reclus.nhh.no>
References: <alpine.LFD.2.21.2003181410290.2563188@reclus.nhh.no>
Message-ID: <CALrbzg0pnJi-fwVvjxg0d8WoVOEJyh1O2kuFPcUab22DZ46dpg@mail.gmail.com>

This is very helpful - thank you!

On Wed, Mar 18, 2020 at 9:12 AM Roger Bivand <Roger.Bivand at nhh.no> wrote:

> A new blog: "R spatial follows GDAL and PROJ development" has been
> published: https://www.r-spatial.org/r/2020/03/17/wkt.html.
>
> Those maintaining packages using sf or sp/rgdal, and authors of scripts
> using them should read the blog and be prepared to take rapid action when
> sf 0.9 is released and built using PROJ >= 6 and GDAL >= 3. An early
> release of rgdal (>= 1.5, probably 1.6.0, is also to be expected).
>
> Roger
>
> --
> Roger Bivand
> Department of Economics, Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
> https://orcid.org/0000-0003-2392-6140
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


-- 
Ben Tupper
Bigelow Laboratory for Ocean Science
West Boothbay Harbor, Maine
http://www.bigelow.org/
https://eco.bigelow.org

	[[alternative HTML version deleted]]


From m||uj|@b @end|ng |rom gm@||@com  Wed Mar 18 15:49:18 2020
From: m||uj|@b @end|ng |rom gm@||@com (Miluji Sb)
Date: Wed, 18 Mar 2020 15:49:18 +0100
Subject: [R-sig-Geo] Extract VIIRS data in R
In-Reply-To: <CAKqUiGkSN9m2tc8e+Y4aPCV4K-Jx7ujMir+eQwoyYP=aYQDtew@mail.gmail.com>
References: <CAMLwc7OgUxHWk1Q+T4zNhG2FoTu_Gg+xHr37LvuFvJ3vm=B+BA@mail.gmail.com>
 <CAL+ycWnZPpOTN8YW3Shaq_aYCV9szV_6n5cntfMeEx28NqTgLA@mail.gmail.com>
 <CAKqUiGkSN9m2tc8e+Y4aPCV4K-Jx7ujMir+eQwoyYP=aYQDtew@mail.gmail.com>
Message-ID: <CAMLwc7Nks2wdxUh6JHXv3OYvwf7DExEPF=4PUsV-+53acTo3og@mail.gmail.com>

Dear all,

Thank you everyone. The issue (as pointed out) is the following;

# [1] "vobjtovarid4: **** WARNING **** I was asked to get a varid for
dimension named number_of_pixels BUT this dimension HAS NO DIMVAR! Code
will probably fail at this point"

I have contacted the VIIRS people and will keep you posted here. Thank you
again!

Best,

Milu

On Wed, Mar 18, 2020 at 3:34 PM Zia Ahmed <zia207 at gmail.com> wrote:

> This is might help you:
>
> https://zia207.github.io/geospatial-r-github.io/netCDF-data-processing.html
>
>
> Zia
>
> On Wed, Mar 18, 2020, 9:34 AM Frederico Faleiro <fvfaleiro at gmail.com>
> wrote:
>
>> Hi Miluji,
>>
>> the R in general do not handle very well with netCDF. However I
>> recommend you use the netcdf4 package before try others.
>> This link is a good start:
>>
>> http://geog.uoregon.edu/bartlein/courses/geog490/week04-netCDF.html#get-coordinate-including-time-variables
>> .
>> The coordinates of this file is not in longitude and latitude, it use
>> "number_of_lines" for X Axis and "number_of_pixels" for Y Axis. This way
>> the difference between the cells is always one and raster package
>> interprete the difference as one degree and return an warning about it.
>> I open the file in the software Panoply (design to work with netCDF)  and
>> everything is OK apparently.
>> Check bellow some exploration of the data in R.
>>
>> library(raster)
>> library(ncdf4)
>> library(rgdal)
>>
>> # netcdf4 package
>> netcdf_file <- "VNP02DNB_NRT.A2020069.1048.001.nc"
>> nc <- nc_open(netcdf_file)
>> print(nc)
>> # check your variable is structured as:
>> observation_data/DNB_observations[number_of_pixels,number_of_lines]
>> # variables available
>> names(nc[["var"]])
>> # properties from your variable
>> ncatt_get(nc, "observation_data/DNB_observations")
>> # get the variables values and check the structure
>> obs_matrix <- ncvar_get(nc, "observation_data/DNB_observations")
>> str(obs_matrix)
>>
>> # raster package
>> nc_r <- brick(netcdf_file, lvar=0, values=TRUE,
>> varname="observation_data/DNB_observations")
>> # [1] "vobjtovarid4: **** WARNING **** I was asked to get a varid for
>> dimension named number_of_pixels BUT this dimension HAS NO DIMVAR! Code
>> will probably fail at this point"
>> # [1] "vobjtovarid4: **** WARNING **** I was asked to get a varid for
>> dimension named number_of_lines BUT this dimension HAS NO DIMVAR! Code
>> will
>> probably fail at this point"
>>
>> Best regards,
>>
>> Frederico Faleiro
>> Postdoctoral Researcher in the INCT-EECBio (https://www.eecbio.ufg.br/)
>> Federal University of Goi?s | Brazil
>> RG: https://www.researchgate.net/profile/Frederico_Faleiro
>>
>> On Tue, Mar 17, 2020 at 11:39 AM Miluji Sb <milujisb at gmail.com> wrote:
>>
>> > Dear all,
>> >
>> > Hope everyone is keeping safe.
>> >
>> > I am trying to extract/read VIIRS nighttime lights data but the output
>> > seems rather strange.
>> >
>> > I have uploaded the file here
>> > <https://drive.google.com/open?id=1zpqXJ8AlEcnk6ApRb75tfQc4-Y8AfK5h>
>> so as
>> > not exceed the size limit of the email.
>> >
>> > ## Code ##
>> > library(ncdf4)
>> > library(rgdal)
>> >
>> > netcdf_file <- c("VNP02DNB_NRT.A2020069.1048.001.nc")
>> > nl <- brick(netcdf_file, lvar=0, values=TRUE,
>> > varname="observation_data/DNB_observations")
>> >
>> > ## Detail ##
>> > class      : RasterLayer
>> > dimensions : 3232, 4064, 13134848  (nrow, ncol, ncell)
>> > resolution : 1, 1  (x, y)
>> > extent     : 0.5, 4064.5, 0.5, 3232.5  (xmin, xmax, ymin, ymax)
>> > crs        : NA
>> > source     : C:/Users/shour/Desktop/VNP02DNB_NRT.A2020069.1048.001.nc
>> > names      : DNB.observations.at.pixel.locations
>> > zvar       : observation_data/DNB_observations
>> >
>> > The spatial resolution is supposed to be 750m but this shows 1?. What
>> am I
>> > doing wrong? Any help will be greatly appreciated. Thank you.
>> >
>> > Sincerely,
>> >
>> > Millu
>> >
>> >         [[alternative HTML version deleted]]
>> >
>> > _______________________________________________
>> > R-sig-Geo mailing list
>> > R-sig-Geo at r-project.org
>> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> >
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>

	[[alternative HTML version deleted]]


From z|@207 @end|ng |rom gm@||@com  Wed Mar 18 15:51:33 2020
From: z|@207 @end|ng |rom gm@||@com (Zia Ahmed)
Date: Wed, 18 Mar 2020 10:51:33 -0400
Subject: [R-sig-Geo] Merging Shape files
In-Reply-To: <CAA=SVwF7R4MuoarOfg-pzvJB1YjmrxOi7XGnUeSw3h--47WXjA@mail.gmail.com>
References: <CABvzdCUxgNB7L5y5dvn3vgGviTzCHzBBEyv-rCcwKvntDO9BxQ@mail.gmail.com>
 <CAA=SVwE=cN+CMtL3MhAHuHP8K7rqJ5RO+nOvKgtjtdtn4mgx_g@mail.gmail.com>
 <CAKqUiGn6gs386h7PYSnw35gsnEcxx4jYE-F395ZmZ9190w4Kcw@mail.gmail.com>
 <CAA=SVwF7R4MuoarOfg-pzvJB1YjmrxOi7XGnUeSw3h--47WXjA@mail.gmail.com>
Message-ID: <CAKqUiG=EE78yuetZzeFOmQnk4E9vuKXCkRy8+e7xk-6qMCjJyg@mail.gmail.com>

You welcome.

If you are interested in geospatial analysis in python, you check this:

https://zia207.github.io/geospatial-python.io/

Best
Zia

On Wed, Mar 18, 2020, 10:45 AM Dexter Locke <dexter.locke at gmail.com> wrote:

> Zia: this is a fabulous resource!!
>
> Thanks for sharing,
> Dexter
>
>
> On Wed, Mar 18, 2020 at 10:37 AM Zia Ahmed <zia207 at gmail.com> wrote:
>
>> Please  check this:
>>
>>
>> https://zia207.github.io/geospatial-r-github.io/geoprocessing-vector-data.html
>> Best
>> Zia
>>
>> On Tue, Mar 17, 2020, 10:39 AM Dexter Locke <dexter.locke at gmail.com>
>> wrote:
>>
>>> Within st_join() see the options like "left = TRUE".
>>>
>>> You may also want to look at st_intersects()
>>>
>>> Here are other helpful reference websites:
>>> https://r-spatial.github.io/sf/reference/geos_binary_pred.html
>>>
>>> https://cran.r-project.org/web/packages/sf/vignettes/sf3.html
>>>
>>> -Dexter
>>>
>>>
>>> On Tue, Mar 17, 2020 at 10:29 AM El Mechry El Koudouss <
>>> eelkoudouss at fordham.edu> wrote:
>>>
>>> > Dear readers,
>>> > I downloaded a shapefile with data on crime incidents in Washington DC
>>> in
>>> > 2016 (available here:
>>> > https://opendata.dc.gov/datasets/crime-incidents-in-2016) and another
>>> > shapefile with data on parks and recreation areas, also in Washington
>>> DC
>>> > (available here:
>>> > https://opendata.dc.gov/datasets/parks-and-recreation-areas).
>>> > I was able to read both shapefiles using st_read() from the sf
>>> package. My
>>> > question is, how can I merge the two data sets? I tried st_join() but
>>> it
>>> > simply resulted in empty columns from the parks dataset getting added
>>> to
>>> > the crime data. Any guidance would be much appreciated.
>>> > library(sf)
>>> > parks <- st_read("Parks_and_Recreation_Areas.shp")
>>> > crime <- st_read("Crime_Incidents_in_2016.shp")
>>> > df <- st_join(crime, parks)
>>> >
>>> > --
>>> > El Mechry, El Koudouss (Meshry)
>>> > Graduate Research Assistant
>>> > Center for International Policy Studies
>>> > Fordham University
>>> > Department of Economics
>>> > Website: www.meshry.com
>>> >
>>> >         [[alternative HTML version deleted]]
>>> >
>>> > _______________________________________________
>>> > R-sig-Geo mailing list
>>> > R-sig-Geo at r-project.org
>>> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>> >
>>>
>>>         [[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>

	[[alternative HTML version deleted]]


From edzer@pebe@m@ @end|ng |rom un|-muen@ter@de  Wed Mar 18 17:00:31 2020
From: edzer@pebe@m@ @end|ng |rom un|-muen@ter@de (Edzer Pebesma)
Date: Wed, 18 Mar 2020 17:00:31 +0100
Subject: [R-sig-Geo] 
 rgdal travis error: configure: error: gdal-config not
 found or not executable.
In-Reply-To: <CAM0xMQ_pGKC4LdM_X6XuJ4gYE-=SFu8FEKcEYzk7Fs63WTr+9g@mail.gmail.com>
References: <CAM0xMQ_pGKC4LdM_X6XuJ4gYE-=SFu8FEKcEYzk7Fs63WTr+9g@mail.gmail.com>
Message-ID: <0d4f9359-effb-fac1-a2b0-1a1756f16d34@uni-muenster.de>

At least libgdal-dev and libproj-dev are missing. You can have a look at
https://github.com/r-spatial/sf/blob/master/.travis.yml (but that tries
to do quite a bit more).

On 3/18/20 3:21 PM, Joe Lewis wrote:
> Hi,
> 
> I'm testing a package using travis and I keep getting an error message
> about rgdal not being found or executable. I've been trying to piece
> together things I've found online but to no avail.
> 
> https://travis-ci.org/github/josephlewis/leastcostpath/builds/663944787
> 
> travis.yml
> 
> # R for travis: see documentation at
> https://docs.travis-ci.com/user/languages/r
> 
> language: R
> sudo: false
> cache: packages
> 
> repos:
>   CRAN: https://cran.rstudio.com
>   rforge: http://R-Forge.R-project.org
> 
> apt_packages:
>     - gdal-bin
> 
> before_install:
> install.packages("rgdal", repos="http://R-Forge.R-project.org")
> 
> 
> Any help would be appreciated.
> 
> Thanks.
> 
> Kind regards,
> Joseph Lewis
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics
Heisenbergstrasse 2, 48149 Muenster, Germany
Phone: +49 251 8333081

-------------- next part --------------
A non-text attachment was scrubbed...
Name: pEpkey.asc
Type: application/pgp-keys
Size: 3110 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20200318/44e6f7e0/attachment.bin>

From edzer@pebe@m@ @end|ng |rom un|-muen@ter@de  Wed Mar 18 17:24:46 2020
From: edzer@pebe@m@ @end|ng |rom un|-muen@ter@de (Edzer Pebesma)
Date: Wed, 18 Mar 2020 17:24:46 +0100
Subject: [R-sig-Geo] Extract VIIRS data in R
In-Reply-To: <CAAcGz9-SiTFVEgV++H6U0P7QM3g=cC+__7qA6SyKJRFQ9J7xiA@mail.gmail.com>
References: <CAMLwc7OgUxHWk1Q+T4zNhG2FoTu_Gg+xHr37LvuFvJ3vm=B+BA@mail.gmail.com>
 <CAAcGz9-SiTFVEgV++H6U0P7QM3g=cC+__7qA6SyKJRFQ9J7xiA@mail.gmail.com>
Message-ID: <f22b7556-e17e-11f8-b7c5-95979fab9bf0@uni-muenster.de>

If the product info is in this document:
https://ladsweb.modaps.eosdis.nasa.gov/missions-and-measurements/viirs/NASAVIIRSL1BUGAug2019.pdf

then it sounds like these data are distributed as curvilinear grids,
meaning that there are two additional raster with for each pixel the
longitude and the latitude. The file you pointed to does not contain
these two grids, but you should be able to get them at the place where
you got the data. With that, you can use package stars to load them, and
e.g. resample to some (more) regular grid.

See e.g.
https://r-spatial.github.io/stars/articles/stars4.html#curvilinear-grids

On 3/18/20 3:29 PM, Michael Sumner wrote:
> You won't find much on this kind of file in the R community, this is
> relatively new NetCDF-4 with "groups", and contains a satellite "granule" -
> a kind of pre-mapping raw data array with only technical information about
> where the scanning occurred.
> 
> In short, raster and stars package (and RNetCDF and ncdf4) will read the
> data from this file, but give very little or no help for how to treat it
> like a map. The spatial resolution and extent are purely nominal as shown
> by raster, a spacing of 1 in two dimensions and extending from 0 to nrows,
> 0 to ncols (with a  half cell shift). There aren't any coordinate arrays in
> the file, or any simple way to transform from this matrix-space to
> geography as far as I know.  (Would love to be corrected on how to do
> that).
> 
> You'd need to pursue domain-specific expertise to discover the mapping of
> this, unless some kind soul turns up to help here. I expect you'll want to
> find a product that has been converted into simpler form for these data.
> 
> Cheers, Mike.
> 
> 
> On Wed, Mar 18, 2020 at 1:39 AM Miluji Sb <milujisb at gmail.com> wrote:
> 
>> Dear all,
>>
>> Hope everyone is keeping safe.
>>
>> I am trying to extract/read VIIRS nighttime lights data but the output
>> seems rather strange.
>>
>> I have uploaded the file here
>> <https://drive.google.com/open?id=1zpqXJ8AlEcnk6ApRb75tfQc4-Y8AfK5h> so as
>> not exceed the size limit of the email.
>>
>> ## Code ##
>> library(ncdf4)
>> library(rgdal)
>>
>> netcdf_file <- c("VNP02DNB_NRT.A2020069.1048.001.nc")
>> nl <- brick(netcdf_file, lvar=0, values=TRUE,
>> varname="observation_data/DNB_observations")
>>
>> ## Detail ##
>> class      : RasterLayer
>> dimensions : 3232, 4064, 13134848  (nrow, ncol, ncell)
>> resolution : 1, 1  (x, y)
>> extent     : 0.5, 4064.5, 0.5, 3232.5  (xmin, xmax, ymin, ymax)
>> crs        : NA
>> source     : C:/Users/shour/Desktop/VNP02DNB_NRT.A2020069.1048.001.nc
>> names      : DNB.observations.at.pixel.locations
>> zvar       : observation_data/DNB_observations
>>
>> The spatial resolution is supposed to be 750m but this shows 1?. What am I
>> doing wrong? Any help will be greatly appreciated. Thank you.
>>
>> Sincerely,
>>
>> Millu
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
> 
> 

-- 
Edzer Pebesma
Institute for Geoinformatics
Heisenbergstrasse 2, 48149 Muenster, Germany
Phone: +49 251 8333081

-------------- next part --------------
A non-text attachment was scrubbed...
Name: pEpkey.asc
Type: application/pgp-keys
Size: 3110 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20200318/e6388a96/attachment.bin>

From @|ex@ndre@@nto@br @end|ng |rom y@hoo@com@br  Thu Mar 19 13:45:20 2020
From: @|ex@ndre@@nto@br @end|ng |rom y@hoo@com@br (ASANTOS)
Date: Thu, 19 Mar 2020 08:45:20 -0400
Subject: [R-sig-Geo] Fitting an Inhomogeneous Poisson model
References: <d70006e7-e320-cf0e-cc03-d9f53a46bfe0.ref@yahoo.com.br>
Message-ID: <d70006e7-e320-cf0e-cc03-d9f53a46bfe0@yahoo.com.br>

Dear R-Sig-Geo members,

I've like to fitting an Inhomogeneous Poisson model and I have one 
question about better approaches and/or steps order for this.

### Simulating Inhomogeneous Poisson process
library(spatstat)
cI <- rpoispp(function(x, y) {200 * x^2}, lmax = 1000)
cII <- rpoispp(function(x, y) {50 * y^2}, lmax = 1000)
cIII <- rpoispp(function(x,y) {100 * exp(-3*x)}, lmax = 1000)
ant<-superimpose(cI=cI,cII=cII,cIII=cIII)

#Fitting a Poisson model with an intensity that is log-linear in the 
cartesian coordinates with marks
m1<-ppm(ant, ~x + y + marks) # Allows different (constant) intensity for 
each category

#Now I fitting a Inhomogeneous Poisson model with an intensity that is 
log-quadratic in the cartesian coordinates
#with marks

m2<-ppm(ant, ~polynom(x,y,2) + marks)

#Comparing the models
anova(m1,m2,test="Chi")
#Pr(>Chi) = 0.8497 No difference and I choose the more parsimonious 
model m1.

#But if I make the models coefficients inspection:
m1#First model
#????????????? Estimate????? S.E.????? CI95.lo??? CI95.hi Ztest????? Zval
#(Intercept)? 3.0370358 0.3075106? 2.434326133? 3.6397455?? *** 9.876199
#x??????????? 1.3466820 0.3453355? 0.669836907? 2.0235272?? *** 3.899634
#y??????????? 0.6497591 0.3338675 -0.004609147? 1.3041274 1.946159
#markscII??? -1.4190842 0.2877424 -1.983048959 -0.8551194?? *** -4.931787
#markscIII?? -0.6306268 0.2154810 -1.052961828 -0.2082918??? ** -2.926601
m2 #Second model
#?????????????? Estimate????? S.E.?? CI95.lo??? CI95.hi Ztest??????? Zval
#(Intercept)? 3.31439533 0.6095378? 2.119723? 4.5090674?? *** 5.43755529
#x??????????? 0.05883185 1.5736189 -3.025405? 3.1430683 0.03738634
#y??????????? 0.53037435 1.5536416 -2.514707? 3.5754559 0.34137497
#I(x^2)?????? 1.16253158 1.2939978 -1.373658? 3.6987207 0.89840303
#I(x * y)???? 0.04678026 1.1589111 -2.224644? 2.3182043 0.04036570
#I(y^2)?????? 0.08747001 1.2903205 -2.441512? 2.6164518 0.06778937
#markscII??? -1.41908418 0.2877424 -1.983049 -0.8551194?? *** -4.93178655
#markscIII?? -0.63062682 0.2154810 -1.052962 -0.2082918??? ** -2.92660056

I was so astonished with the no significance of I(x^2) by Ztest and my 
question is
whats is the better workflow for improve models of this nature:

1) Try the new models with several cartesian coordinates combinations 
and degrees (first),
2) Try the new models with pair-wise comparison between levels (marks) 
(second),
3) Comparing with null model.

or another approach and/or step order?

-- 
Alexandre dos Santos
Geotechnologies and Spatial Statistics applied to Forest Entomology
Instituto Federal de Mato Grosso (IFMT) - Campus Caceres
Caixa Postal 244 (PO Box)
Avenida dos Ramires, s/n - Vila Real
Caceres - MT - CEP 78201-380 (ZIP code)
Phone: (+55) 65 99686-6970 / (+55) 65 3221-2674
Lattes CV: http://lattes.cnpq.br/1360403201088680
OrcID: orcid.org/0000-0001-8232-6722
ResearchGate: www.researchgate.net/profile/Alexandre_Santos10
Publons: https://publons.com/researcher/3085587/alexandre-dos-santos/
--


	[[alternative HTML version deleted]]


From jo@eph|ew|@1992 @end|ng |rom gm@||@com  Thu Mar 19 20:26:38 2020
From: jo@eph|ew|@1992 @end|ng |rom gm@||@com (Joe Lewis)
Date: Thu, 19 Mar 2020 19:26:38 +0000
Subject: [R-sig-Geo] 
 rgdal travis error: configure: error: gdal-config not
 found or not executable.
In-Reply-To: <0d4f9359-effb-fac1-a2b0-1a1756f16d34@uni-muenster.de>
References: <CAM0xMQ_pGKC4LdM_X6XuJ4gYE-=SFu8FEKcEYzk7Fs63WTr+9g@mail.gmail.com>
 <0d4f9359-effb-fac1-a2b0-1a1756f16d34@uni-muenster.de>
Message-ID: <CAM0xMQ9Fpv5D5_JN1JSDBGD_6ZCQHCRvg-PxwtoyrNh=3qeTEQ@mail.gmail.com>

Hi,

Thanks for the help.

I've incorporated some from sf's travis file, but it's still failing
unfortunately.

# R for travis: see documentation at https://docs.travis-ci.com/user/languages/r

language: R
sudo: false
cache: packages

r:
  - oldrel
  - release
  - devel

repos:
  CRAN: https://cran.rstudio.com
  rforge: http://R-Forge.R-project.org

before_install:
  - R -e 'install.packages("rgdal", repos="http://R-Forge.R-project.org")'

apt_packages:
- gdal-bin
- libgdal-dev
- libxml2-dev
- libproj-dev
- libprotobuf-dev
- protobuf-compiler
- libv8-3.14-dev
- libjq-dev
- libudunits2-dev
- libproj-dev
- libgeos-dev
- libspatialite-dev
- libgdal-dev

- libjson-c-dev


https://travis-ci.org/github/josephlewis/leastcostpath/builds/664541703

Any ideas?

Thanks.

Kind regards,
Joseph Lewis

On Wed, Mar 18, 2020 at 4:04 PM Edzer Pebesma <edzer.pebesma at uni-muenster.de>
wrote:

> At least libgdal-dev and libproj-dev are missing. You can have a look at
> https://github.com/r-spatial/sf/blob/master/.travis.yml (but that tries
> to do quite a bit more).
>
> On 3/18/20 3:21 PM, Joe Lewis wrote:
> > Hi,
> >
> > I'm testing a package using travis and I keep getting an error message
> > about rgdal not being found or executable. I've been trying to piece
> > together things I've found online but to no avail.
> >
> > https://travis-ci.org/github/josephlewis/leastcostpath/builds/663944787
> >
> > travis.yml
> >
> > # R for travis: see documentation at
> > https://docs.travis-ci.com/user/languages/r
> >
> > language: R
> > sudo: false
> > cache: packages
> >
> > repos:
> >   CRAN: https://cran.rstudio.com
> >   rforge: http://R-Forge.R-project.org
> >
> > apt_packages:
> >     - gdal-bin
> >
> > before_install:
> > install.packages("rgdal", repos="http://R-Forge.R-project.org")
> >
> >
> > Any help would be appreciated.
> >
> > Thanks.
> >
> > Kind regards,
> > Joseph Lewis
> >
> >       [[alternative HTML version deleted]]
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
>
> --
> Edzer Pebesma
> Institute for Geoinformatics
> Heisenbergstrasse 2, 48149 Muenster, Germany
> Phone: +49 251 8333081
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From edzer@pebe@m@ @end|ng |rom un|-muen@ter@de  Thu Mar 19 22:29:46 2020
From: edzer@pebe@m@ @end|ng |rom un|-muen@ter@de (Edzer Pebesma)
Date: Thu, 19 Mar 2020 22:29:46 +0100
Subject: [R-sig-Geo] 
 rgdal travis error: configure: error: gdal-config not
 found or not executable.
In-Reply-To: <CAM0xMQ9Fpv5D5_JN1JSDBGD_6ZCQHCRvg-PxwtoyrNh=3qeTEQ@mail.gmail.com>
References: <CAM0xMQ_pGKC4LdM_X6XuJ4gYE-=SFu8FEKcEYzk7Fs63WTr+9g@mail.gmail.com>
 <0d4f9359-effb-fac1-a2b0-1a1756f16d34@uni-muenster.de>
 <CAM0xMQ9Fpv5D5_JN1JSDBGD_6ZCQHCRvg-PxwtoyrNh=3qeTEQ@mail.gmail.com>
Message-ID: <6ffedb13-44b8-de26-d304-00b3b94a2da0@uni-muenster.de>

Maybe this:
https://github.com/edzer/sf_dep/blob/master/.travis.yml

On 3/19/20 8:26 PM, Joe Lewis wrote:
> Hi,
> 
> Thanks for the help.
> 
> I've incorporated some from sf's travis file, but it's still failing
> unfortunately.
> 
> # R for travis: see documentation at https://docs.travis-ci.com/user/languages/r
> 
> language: R
> sudo: false
> cache: packages
> 
> r:
>   - oldrel
>   - release
>   - devel
> 
> repos:
>   CRAN: https://cran.rstudio.com
>   rforge: http://R-Forge.R-project.org
> 
> before_install:
>   - R -e 'install.packages("rgdal", repos="http://R-Forge.R-project.org")'
> 
> apt_packages:
> - gdal-bin
> - libgdal-dev
> - libxml2-dev
> - libproj-dev
> - libprotobuf-dev
> - protobuf-compiler
> - libv8-3.14-dev
> - libjq-dev
> - libudunits2-dev
> - libproj-dev
> - libgeos-dev
> - libspatialite-dev
> - libgdal-dev
> 
> - libjson-c-dev
> 
> 
> https://travis-ci.org/github/josephlewis/leastcostpath/builds/664541703
> 
> Any ideas?
> 
> Thanks.
> 
> Kind regards,
> Joseph Lewis
> 
> On Wed, Mar 18, 2020 at 4:04 PM Edzer Pebesma <edzer.pebesma at uni-muenster.de>
> wrote:
> 
>> At least libgdal-dev and libproj-dev are missing. You can have a look at
>> https://github.com/r-spatial/sf/blob/master/.travis.yml (but that tries
>> to do quite a bit more).
>>
>> On 3/18/20 3:21 PM, Joe Lewis wrote:
>>> Hi,
>>>
>>> I'm testing a package using travis and I keep getting an error message
>>> about rgdal not being found or executable. I've been trying to piece
>>> together things I've found online but to no avail.
>>>
>>> https://travis-ci.org/github/josephlewis/leastcostpath/builds/663944787
>>>
>>> travis.yml
>>>
>>> # R for travis: see documentation at
>>> https://docs.travis-ci.com/user/languages/r
>>>
>>> language: R
>>> sudo: false
>>> cache: packages
>>>
>>> repos:
>>>   CRAN: https://cran.rstudio.com
>>>   rforge: http://R-Forge.R-project.org
>>>
>>> apt_packages:
>>>     - gdal-bin
>>>
>>> before_install:
>>> install.packages("rgdal", repos="http://R-Forge.R-project.org")
>>>
>>>
>>> Any help would be appreciated.
>>>
>>> Thanks.
>>>
>>> Kind regards,
>>> Joseph Lewis
>>>
>>>       [[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>> --
>> Edzer Pebesma
>> Institute for Geoinformatics
>> Heisenbergstrasse 2, 48149 Muenster, Germany
>> Phone: +49 251 8333081
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics
Heisenbergstrasse 2, 48149 Muenster, Germany
Phone: +49 251 8333081

-------------- next part --------------
A non-text attachment was scrubbed...
Name: pEpkey.asc
Type: application/pgp-keys
Size: 3110 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20200319/7de24faf/attachment.bin>

From m||uj|@b @end|ng |rom gm@||@com  Fri Mar 20 16:11:43 2020
From: m||uj|@b @end|ng |rom gm@||@com (Miluji Sb)
Date: Fri, 20 Mar 2020 16:11:43 +0100
Subject: [R-sig-Geo] Extract VIIRS data in R
In-Reply-To: <513d3e4a-7620-9ddd-f691-0a1e92218c8c@uni-muenster.de>
References: <CAMLwc7OgUxHWk1Q+T4zNhG2FoTu_Gg+xHr37LvuFvJ3vm=B+BA@mail.gmail.com>
 <CAAcGz9-SiTFVEgV++H6U0P7QM3g=cC+__7qA6SyKJRFQ9J7xiA@mail.gmail.com>
 <f22b7556-e17e-11f8-b7c5-95979fab9bf0@uni-muenster.de>
 <CAMLwc7MXkf7AuvYJAxJM_t9uq-DHn7O9s9wFb6Th9pi0QrNMjA@mail.gmail.com>
 <513d3e4a-7620-9ddd-f691-0a1e92218c8c@uni-muenster.de>
Message-ID: <CAMLwc7PGGVXmS7fRhvhRAD953WaFOefpiX2BEwF6g=4QS0OqHQ@mail.gmail.com>

Dear Edzer,

Thank you for your reply and the suggestions. Apologies for not copying the
list, I forgot to hit 'reply all'.

The data is Nighttime lights from Black Marble.

Source of the geo-location data (VNP03DNB):
https://ladsweb.modaps.eosdis.nasa.gov/missions-and-measurements/products/VNP03DNB/
Observation data (VNP02DNB):
https://ladsweb.modaps.eosdis.nasa.gov/missions-and-measurements/products/VNP02DNB/


Thank you for the code, I only changed the path but I am getting the
following error when I run the following part;

latlon = read_stars(
c('NETCDF:"VNP03DNB.A2020015.0236.001.2020044182419.nc
":/geolocation_data/latitude',
'NETCDF:"VNP03DNB.A2020015.0236.001.2020044182419.nc
":/geolocation_data/longitude'))

"Error in CPL_read_gdal(as.character(x), as.character(options),
as.character(driver),  :  file not found"

I checked the path. Thank you again.

Best,

Milu

On Fri, Mar 20, 2020 at 9:27 AM Edzer Pebesma <edzer.pebesma at uni-muenster.de>
wrote:

> Dear Milu,
>
> It is more practical for yourself and more helpful for others when you
> reply to the list. I now Cc: the list, but that is not how it is
> supposed to work. Also, please use text mails, not html with inline
> links. Finally, your links point to things you downloaded and
> reuploaded, not to the place where you got the dataset from - for future
> users having the same problem and consulting mailing list archives this
> is also not really helpful.
>
> I tried this:
>
> # maybe: remotes::install_github("r-spatial/stars")
> library(stars)
> r = read_stars("VNP02DNB_NRT.A2020069.1048.001.nc")
> latlon = read_stars(
> c('NETCDF:"VNP03DNB.A2020015.0236.001.2020044182419.nc
> ":/geolocation_data/latitude',
>  'NETCDF:"VNP03DNB.A2020015.0236.001.2020044182419.nc
> ":/geolocation_data/longitude'))
> r_ll = st_as_stars(r,
>    curvilinear = list(x = latlon[[2]], y = latlon[[1]]))
> plot(r_ll, reset = FALSE, axes = TRUE)
> maps::map('world', add = TRUE, col = 'red')
>
> Although I don't really know what the data is about, the plot generated
> (attached) to me seems to indicate that you are trying to glue the wrong
> latitudes and longitudes to your measurements.
>
>
>
> On 3/19/20 11:29 PM, Miluji Sb wrote:
> > Thank you for your reply and the information.
> >
> > This file
> > <https://drive.google.com/open?id=1zpqXJ8AlEcnk6ApRb75tfQc4-Y8AfK5h
> > needs
> > to be combined with the geo-location data in this file
> > <https://drive.google.com/open?id=1jLmXLjG0WGgdH3g4pGJNz0ZOqXOfKpcW>. I
> > will try out the stars package, any suggestions will be highly
> appreciated.
> >
> > Thanks again and stay safe.
> >
> > Best,
> >
> > Milu
> >
> > On Wed, Mar 18, 2020 at 5:25 PM Edzer Pebesma
> > <edzer.pebesma at uni-muenster.de <mailto:edzer.pebesma at uni-muenster.de>>
> > wrote:
> >
> >     If the product info is in this document:
> >
> https://ladsweb.modaps.eosdis.nasa.gov/missions-and-measurements/viirs/NASAVIIRSL1BUGAug2019.pdf
> >
> >     then it sounds like these data are distributed as curvilinear grids,
> >     meaning that there are two additional raster with for each pixel the
> >     longitude and the latitude. The file you pointed to does not contain
> >     these two grids, but you should be able to get them at the place
> where
> >     you got the data. With that, you can use package stars to load them,
> and
> >     e.g. resample to some (more) regular grid.
> >
> >     See e.g.
> >
> https://r-spatial.github.io/stars/articles/stars4.html#curvilinear-grids
> >
> >     On 3/18/20 3:29 PM, Michael Sumner wrote:
> >     > You won't find much on this kind of file in the R community, this
> is
> >     > relatively new NetCDF-4 with "groups", and contains a satellite
> >     "granule" -
> >     > a kind of pre-mapping raw data array with only technical
> >     information about
> >     > where the scanning occurred.
> >     >
> >     > In short, raster and stars package (and RNetCDF and ncdf4) will
> >     read the
> >     > data from this file, but give very little or no help for how to
> >     treat it
> >     > like a map. The spatial resolution and extent are purely nominal
> >     as shown
> >     > by raster, a spacing of 1 in two dimensions and extending from 0
> >     to nrows,
> >     > 0 to ncols (with a  half cell shift). There aren't any coordinate
> >     arrays in
> >     > the file, or any simple way to transform from this matrix-space to
> >     > geography as far as I know.  (Would love to be corrected on how to
> do
> >     > that).
> >     >
> >     > You'd need to pursue domain-specific expertise to discover the
> >     mapping of
> >     > this, unless some kind soul turns up to help here. I expect you'll
> >     want to
> >     > find a product that has been converted into simpler form for these
> >     data.
> >     >
> >     > Cheers, Mike.
> >     >
> >     >
> >     > On Wed, Mar 18, 2020 at 1:39 AM Miluji Sb <milujisb at gmail.com
> >     <mailto:milujisb at gmail.com>> wrote:
> >     >
> >     >> Dear all,
> >     >>
> >     >> Hope everyone is keeping safe.
> >     >>
> >     >> I am trying to extract/read VIIRS nighttime lights data but the
> >     output
> >     >> seems rather strange.
> >     >>
> >     >> I have uploaded the file here
> >     >>
> >     <https://drive.google.com/open?id=1zpqXJ8AlEcnk6ApRb75tfQc4-Y8AfK5h>
> >     so as
> >     >> not exceed the size limit of the email.
> >     >>
> >     >> ## Code ##
> >     >> library(ncdf4)
> >     >> library(rgdal)
> >     >>
> >     >> netcdf_file <- c("VNP02DNB_NRT.A2020069.1048.001.nc
> >     <http://VNP02DNB_NRT.A2020069.1048.001.nc>")
> >     >> nl <- brick(netcdf_file, lvar=0, values=TRUE,
> >     >> varname="observation_data/DNB_observations")
> >     >>
> >     >> ## Detail ##
> >     >> class      : RasterLayer
> >     >> dimensions : 3232, 4064, 13134848  (nrow, ncol, ncell)
> >     >> resolution : 1, 1  (x, y)
> >     >> extent     : 0.5, 4064.5, 0.5, 3232.5  (xmin, xmax, ymin, ymax)
> >     >> crs        : NA
> >     >> source     :
> >     C:/Users/shour/Desktop/VNP02DNB_NRT.A2020069.1048.001.nc
> >     <http://VNP02DNB_NRT.A2020069.1048.001.nc>
> >     >> names      : DNB.observations.at.pixel.locations
> >     >> zvar       : observation_data/DNB_observations
> >     >>
> >     >> The spatial resolution is supposed to be 750m but this shows 1?.
> >     What am I
> >     >> doing wrong? Any help will be greatly appreciated. Thank you.
> >     >>
> >     >> Sincerely,
> >     >>
> >     >> Millu
> >     >>
> >     >>         [[alternative HTML version deleted]]
> >     >>
> >     >> _______________________________________________
> >     >> R-sig-Geo mailing list
> >     >> R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
> >     >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >     >>
> >     >
> >     >
> >
> >     --
> >     Edzer Pebesma
> >     Institute for Geoinformatics
> >     Heisenbergstrasse 2, 48149 Muenster, Germany
> >     Phone: +49 251 8333081
> >     _______________________________________________
> >     R-sig-Geo mailing list
> >     R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
> >     https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
>
> --
> Edzer Pebesma
> Institute for Geoinformatics
> Heisenbergstrasse 2, 48149 Muenster, Germany
> Phone: +49 251 8333081
>

	[[alternative HTML version deleted]]


From donghw79 @end|ng |rom hotm@||@com  Sat Mar 21 06:58:01 2020
From: donghw79 @end|ng |rom hotm@||@com (Gary Dong)
Date: Sat, 21 Mar 2020 05:58:01 +0000
Subject: [R-sig-Geo] "spdep": check whether a spatial model fully controls
 for spatial correlation
Message-ID: <BYAPR02MB576713CA1CEFD91737B6721CDCF20@BYAPR02MB5767.namprd02.prod.outlook.com>

Dear all,

I have estimated a spatial error model via the "spdep" package. The spatial weights are determined based on the inverse distance between an observation and its 50 nearest neighbors (knearneigh, k=50). Now I wonder if my spatial error model has FULLY controlled for spatial autocorrelation in the data. Is there a way to test it? I know I can use lm.morantest() to test spatial autocorrelation in residuals from an estimated OLS model. But I do not know if there is a similar test for a spatial error model. Any advice is greatly appreciated.

Best
Gary


	[[alternative HTML version deleted]]


From Roger@B|v@nd @end|ng |rom nhh@no  Sat Mar 21 11:07:16 2020
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Sat, 21 Mar 2020 11:07:16 +0100
Subject: [R-sig-Geo] 
 "spdep": check whether a spatial model fully controls
 for spatial correlation
In-Reply-To: <BYAPR02MB576713CA1CEFD91737B6721CDCF20@BYAPR02MB5767.namprd02.prod.outlook.com>
References: <BYAPR02MB576713CA1CEFD91737B6721CDCF20@BYAPR02MB5767.namprd02.prod.outlook.com>
Message-ID: <alpine.LFD.2.21.2003211057190.729923@reclus.nhh.no>

On Sat, 21 Mar 2020, Gary Dong wrote:

> Dear all,
>
> I have estimated a spatial error model via the "spdep" package. The 
> spatial weights are determined based on the inverse distance between an 
> observation and its 50 nearest neighbors (knearneigh, k=50). Now I 
> wonder if my spatial error model has FULLY controlled for spatial 
> autocorrelation in the data. Is there a way to test it? I know I can use 
> lm.morantest() to test spatial autocorrelation in residuals from an 
> estimated OLS model. But I do not know if there is a similar test for a 
> spatial error model. Any advice is greatly appreciated.

You will know that there is a Lagrange Multiplier test for spatial lag 
model residuals. There is however no test for the residuals of a spatial 
error model. IDW will not help either - the choice of W as a fixed graph 
stipulates that you definitely know that it is the way observations relate 
to each other. Even PCNM/MESF (spatial filtering with the eigenvectors of 
a centred weights matrix) still assumes that the weights matrix is known.

For spatial error models, you should always report the Hausman test. 
You can only accept that SEM is not misspecified if it confirms that the 
SEM and OLS coefficients are close. Unobserved covariates are a typical 
cause of trouble; adding WX (the SDEM, D for Durbin) may help. But if your 
phenomena exhibit different scaling in the footprints of their spatial 
processes, testing (if a test existed) with the same W wouldn't expose the 
problem.

Probably SLX and SDEM are worth exploring, and for SEM and SDEM, reporting 
the Hausman test.

There is a literature starting to appear on adaptive spatial weights, some 
functionality is in CARBayes.

Hope this helps,

Roger

>
> Best
> Gary
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en


From Eugene@H|ckey @end|ng |rom TUDub||n@|e  Sat Mar 21 19:06:14 2020
From: Eugene@H|ckey @end|ng |rom TUDub||n@|e (Eugene Hickey)
Date: Sat, 21 Mar 2020 18:06:14 +0000
Subject: [R-sig-Geo] astrophysics - transform sf from equatorial to galactic
 coordinates
Message-ID: <DB8PR05MB5961F742FE03BECC1CE3893AE3F20@DB8PR05MB5961.eurprd05.prod.outlook.com>

Hi
Does anyone know of a way to transform an sf from equatorial (RA, DEC) into galactic (b, l) coordinates please?


Thanks
Eugene

This email originated from TU Dublin. If you received this email in error, please delete it from your system. Please note that if you are not the named addressee, disclosing, copying, distributing or taking any action based on the contents of this email or attachments is prohibited.

Is ? OT Baile ?tha Cliath a th?inig an r?omhphost seo. M? fuair t? an r?omhphost seo tr? earr?id, scrios de do ch?ras ? le do thoil. Tabhair ar aird, mura t? an seola? ainmnithe, go bhfuil dianchosc ar aon nochtadh, aon ch?ipe?il, aon d?ileadh n? ar aon ghn?omh a dh?anfar bunaithe ar an ?bhar at? sa r?omhphost n? sna hiat?in seo.

	[[alternative HTML version deleted]]


From donghw79 @end|ng |rom hotm@||@com  Sun Mar 22 15:10:08 2020
From: donghw79 @end|ng |rom hotm@||@com (Gary Dong)
Date: Sun, 22 Mar 2020 14:10:08 +0000
Subject: [R-sig-Geo] 
 "spdep": check whether a spatial model fully controls
 for spatial correlation
In-Reply-To: <alpine.LFD.2.21.2003211057190.729923@reclus.nhh.no>
References: <BYAPR02MB576713CA1CEFD91737B6721CDCF20@BYAPR02MB5767.namprd02.prod.outlook.com>,
 <alpine.LFD.2.21.2003211057190.729923@reclus.nhh.no>
Message-ID: <BYAPR02MB576708B31349CC1E89009EB4DCF30@BYAPR02MB5767.namprd02.prod.outlook.com>

Dear Roger, thank you very much for your advice.

I ran Lagrange tests. The tests yielded very small p-values for both spatial lag and error models. Both RLMerr and RLMlag are all very significant (with very small p-values) and the p-value of RLMerr is even smaller. So I went with the spatial Durbin error model (SDEM). The regular spatial Durbin model (SDM) did not work (it produced many NAs in the estimates).

Because it is unclear how exactly my observations relate to each, I decide to test is out. I construct spatial weight matrices with different number of neighbors (k=10, 20, 50, &100). I run a SDEM with each spatial weight matrix and compare their AICs and log likelihoods. Oddly, SDEMs with smaller spatial weight matrix performed better (smaller AIC and higher log likelihood). This seems to suggest that in my case, the model works better when it considers a smaller number of neighboring observations. I also observe that SDEMs with larger weight matrices (e.g. k=50 or 100) tend to yield larger indirect effects (larger coefficients of lag.Xs). In some cases, the indirect effects are unreasonably large. This seems to confirm that with my data, SDEMs with smaller weight matrices perform better.

Is this somewhat counter-intuitive, given that the Moran's I test suggests very strong spatial auto-correlation in my data? Does this mean that I should go with the SDEM with k=10, or even decrease K number below 10?

Best
Gary


________________________________
From: Roger Bivand <Roger.Bivand at nhh.no>
Sent: Saturday, March 21, 2020 3:07 AM
To: Gary Dong <donghw79 at hotmail.com>
Cc: r-sig-geo at r-project.org <r-sig-geo at r-project.org>
Subject: Re: [R-sig-Geo] "spdep": check whether a spatial model fully controls for spatial correlation

On Sat, 21 Mar 2020, Gary Dong wrote:

> Dear all,
>
> I have estimated a spatial error model via the "spdep" package. The
> spatial weights are determined based on the inverse distance between an
> observation and its 50 nearest neighbors (knearneigh, k=50). Now I
> wonder if my spatial error model has FULLY controlled for spatial
> autocorrelation in the data. Is there a way to test it? I know I can use
> lm.morantest() to test spatial autocorrelation in residuals from an
> estimated OLS model. But I do not know if there is a similar test for a
> spatial error model. Any advice is greatly appreciated.

You will know that there is a Lagrange Multiplier test for spatial lag
model residuals. There is however no test for the residuals of a spatial
error model. IDW will not help either - the choice of W as a fixed graph
stipulates that you definitely know that it is the way observations relate
to each other. Even PCNM/MESF (spatial filtering with the eigenvectors of
a centred weights matrix) still assumes that the weights matrix is known.

For spatial error models, you should always report the Hausman test.
You can only accept that SEM is not misspecified if it confirms that the
SEM and OLS coefficients are close. Unobserved covariates are a typical
cause of trouble; adding WX (the SDEM, D for Durbin) may help. But if your
phenomena exhibit different scaling in the footprints of their spatial
processes, testing (if a test existed) with the same W wouldn't expose the
problem.

Probably SLX and SDEM are worth exploring, and for SEM and SDEM, reporting
the Hausman test.

There is a literature starting to appear on adaptive spatial weights, some
functionality is in CARBayes.

Hope this helps,

Roger

>
> Best
> Gary
>
>
>        [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

--
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

	[[alternative HTML version deleted]]


From Roger@B|v@nd @end|ng |rom nhh@no  Sun Mar 22 17:06:29 2020
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Sun, 22 Mar 2020 17:06:29 +0100
Subject: [R-sig-Geo] 
 "spdep": check whether a spatial model fully controls
 for spatial correlation
In-Reply-To: <BYAPR02MB576708B31349CC1E89009EB4DCF30@BYAPR02MB5767.namprd02.prod.outlook.com>
References: <BYAPR02MB576713CA1CEFD91737B6721CDCF20@BYAPR02MB5767.namprd02.prod.outlook.com>,
 <alpine.LFD.2.21.2003211057190.729923@reclus.nhh.no>
 <BYAPR02MB576708B31349CC1E89009EB4DCF30@BYAPR02MB5767.namprd02.prod.outlook.com>
Message-ID: <alpine.LFD.2.21.2003221657070.1760294@reclus.nhh.no>

On Sun, 22 Mar 2020, Gary Dong wrote:

> Dear Roger, thank you very much for your advice.
>
> I ran Lagrange tests. The tests yielded very small p-values for both 
> spatial lag and error models. Both RLMerr and RLMlag are all very 
> significant (with very small p-values) and the p-value of RLMerr is even 
> smaller. So I went with the spatial Durbin error model (SDEM). The 
> regular spatial Durbin model (SDM) did not work (it produced many NAs in 
> the estimates).

Not those LM tests. At the foot of the output of the 
summary method for spatialreg::lagsarlm, you see the output of the LM test 
for residual autocorrelation in a spatial lag model.

>
> Because it is unclear how exactly my observations relate to each, I 
> decide to test is out. I construct spatial weight matrices with 
> different number of neighbors (k=10, 20, 50, &100). I run a SDEM with 
> each spatial weight matrix and compare their AICs and log likelihoods. 
> Oddly, SDEMs with smaller spatial weight matrix performed better 
> (smaller AIC and higher log likelihood). This seems to suggest that in 
> my case, the model works better when it considers a smaller number of 
> neighboring observations. I also observe that SDEMs with larger weight 
> matrices (e.g. k=50 or 100) tend to yield larger indirect effects 
> (larger coefficients of lag.Xs). In some cases, the indirect effects are 
> unreasonably large. This seems to confirm that with my data, SDEMs with 
> smaller weight matrices perform better.
>

Usually, it is much better to use a simple graph between proximate 
neighbours. k-nearest neighbours appear asymmetric, but a SAR model makes 
them symmetric anyway. And the spatial process itself is dense (the 
variance-covariance matrix of observations). Having denser weights may 
well over-smooth as you see.

> Is this somewhat counter-intuitive, given that the Moran's I test 
> suggests very strong spatial auto-correlation in my data? Does this mean 
> that I should go with the SDEM with k=10, or even decrease K number 
> below 10?

Certainly reduce further, a graph-based measure will typically have about 
6 neighbours. LeSage & Pace have found that the choice of weights isn't so 
important, and any weights (even sparse) will do better than ignoring the 
spatial autocorrelation. Tony Smith has found that too dense weights may 
bias the fitted model.

Go with small k and SDEM, if the Hausman test doesn't indicate other 
misspecification. And use the impacts method to aggregate the X and WX 
contributions.

Hope this clarifies,

Roger

>
> Best
> Gary
>
>
> ________________________________
> From: Roger Bivand <Roger.Bivand at nhh.no>
> Sent: Saturday, March 21, 2020 3:07 AM
> To: Gary Dong <donghw79 at hotmail.com>
> Cc: r-sig-geo at r-project.org <r-sig-geo at r-project.org>
> Subject: Re: [R-sig-Geo] "spdep": check whether a spatial model fully controls for spatial correlation
>
> On Sat, 21 Mar 2020, Gary Dong wrote:
>
>> Dear all,
>>
>> I have estimated a spatial error model via the "spdep" package. The
>> spatial weights are determined based on the inverse distance between an
>> observation and its 50 nearest neighbors (knearneigh, k=50). Now I
>> wonder if my spatial error model has FULLY controlled for spatial
>> autocorrelation in the data. Is there a way to test it? I know I can use
>> lm.morantest() to test spatial autocorrelation in residuals from an
>> estimated OLS model. But I do not know if there is a similar test for a
>> spatial error model. Any advice is greatly appreciated.
>
> You will know that there is a Lagrange Multiplier test for spatial lag
> model residuals. There is however no test for the residuals of a spatial
> error model. IDW will not help either - the choice of W as a fixed graph
> stipulates that you definitely know that it is the way observations relate
> to each other. Even PCNM/MESF (spatial filtering with the eigenvectors of
> a centred weights matrix) still assumes that the weights matrix is known.
>
> For spatial error models, you should always report the Hausman test.
> You can only accept that SEM is not misspecified if it confirms that the
> SEM and OLS coefficients are close. Unobserved covariates are a typical
> cause of trouble; adding WX (the SDEM, D for Durbin) may help. But if your
> phenomena exhibit different scaling in the footprints of their spatial
> processes, testing (if a test existed) with the same W wouldn't expose the
> problem.
>
> Probably SLX and SDEM are worth exploring, and for SEM and SDEM, reporting
> the Hausman test.
>
> There is a literature starting to appear on adaptive spatial weights, some
> functionality is in CARBayes.
>
> Hope this helps,
>
> Roger
>
>>
>> Best
>> Gary
>>
>>
>>        [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> --
> Roger Bivand
> Department of Economics, Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
> https://orcid.org/0000-0003-2392-6140
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en


From donghw79 @end|ng |rom hotm@||@com  Sun Mar 22 18:59:19 2020
From: donghw79 @end|ng |rom hotm@||@com (Gary Dong)
Date: Sun, 22 Mar 2020 17:59:19 +0000
Subject: [R-sig-Geo] 
 "spdep": check whether a spatial model fully controls
 for spatial correlation
In-Reply-To: <alpine.LFD.2.21.2003221657070.1760294@reclus.nhh.no>
References: <BYAPR02MB576713CA1CEFD91737B6721CDCF20@BYAPR02MB5767.namprd02.prod.outlook.com>,
 <alpine.LFD.2.21.2003211057190.729923@reclus.nhh.no>
 <BYAPR02MB576708B31349CC1E89009EB4DCF30@BYAPR02MB5767.namprd02.prod.outlook.com>,
 <alpine.LFD.2.21.2003221657070.1760294@reclus.nhh.no>
Message-ID: <BYAPR02MB5767E4708BEA190B9AF45786DCF30@BYAPR02MB5767.namprd02.prod.outlook.com>

Thank you, Roger.

I ran Hausman.test() for both my spatial error model (p-value < 2.2e-16) and my spatial Durbin error model (p-value = 3.693e-11). My understanding of these two tests is that my SDEM performs better than my SEM, but there is still room for better specification of my SDEM. Is my understanding correct?

I know that the function "impacts()" applies to spatial lag models only. Is there a R function or a formula that I can use to compute the total impacts based on the X and lag.X coefficients in a SDEM?

Best
Gary


________________________________
From: Roger Bivand <Roger.Bivand at nhh.no>
Sent: Sunday, March 22, 2020 9:06 AM
To: Gary Dong <donghw79 at hotmail.com>
Cc: r-sig-geo at r-project.org <r-sig-geo at r-project.org>
Subject: Re: [R-sig-Geo] "spdep": check whether a spatial model fully controls for spatial correlation

On Sun, 22 Mar 2020, Gary Dong wrote:

> Dear Roger, thank you very much for your advice.
>
> I ran Lagrange tests. The tests yielded very small p-values for both
> spatial lag and error models. Both RLMerr and RLMlag are all very
> significant (with very small p-values) and the p-value of RLMerr is even
> smaller. So I went with the spatial Durbin error model (SDEM). The
> regular spatial Durbin model (SDM) did not work (it produced many NAs in
> the estimates).

Not those LM tests. At the foot of the output of the
summary method for spatialreg::lagsarlm, you see the output of the LM test
for residual autocorrelation in a spatial lag model.

>
> Because it is unclear how exactly my observations relate to each, I
> decide to test is out. I construct spatial weight matrices with
> different number of neighbors (k=10, 20, 50, &100). I run a SDEM with
> each spatial weight matrix and compare their AICs and log likelihoods.
> Oddly, SDEMs with smaller spatial weight matrix performed better
> (smaller AIC and higher log likelihood). This seems to suggest that in
> my case, the model works better when it considers a smaller number of
> neighboring observations. I also observe that SDEMs with larger weight
> matrices (e.g. k=50 or 100) tend to yield larger indirect effects
> (larger coefficients of lag.Xs). In some cases, the indirect effects are
> unreasonably large. This seems to confirm that with my data, SDEMs with
> smaller weight matrices perform better.
>

Usually, it is much better to use a simple graph between proximate
neighbours. k-nearest neighbours appear asymmetric, but a SAR model makes
them symmetric anyway. And the spatial process itself is dense (the
variance-covariance matrix of observations). Having denser weights may
well over-smooth as you see.

> Is this somewhat counter-intuitive, given that the Moran's I test
> suggests very strong spatial auto-correlation in my data? Does this mean
> that I should go with the SDEM with k=10, or even decrease K number
> below 10?

Certainly reduce further, a graph-based measure will typically have about
6 neighbours. LeSage & Pace have found that the choice of weights isn't so
important, and any weights (even sparse) will do better than ignoring the
spatial autocorrelation. Tony Smith has found that too dense weights may
bias the fitted model.

Go with small k and SDEM, if the Hausman test doesn't indicate other
misspecification. And use the impacts method to aggregate the X and WX
contributions.

Hope this clarifies,

Roger

>
> Best
> Gary
>
>
> ________________________________
> From: Roger Bivand <Roger.Bivand at nhh.no>
> Sent: Saturday, March 21, 2020 3:07 AM
> To: Gary Dong <donghw79 at hotmail.com>
> Cc: r-sig-geo at r-project.org <r-sig-geo at r-project.org>
> Subject: Re: [R-sig-Geo] "spdep": check whether a spatial model fully controls for spatial correlation
>
> On Sat, 21 Mar 2020, Gary Dong wrote:
>
>> Dear all,
>>
>> I have estimated a spatial error model via the "spdep" package. The
>> spatial weights are determined based on the inverse distance between an
>> observation and its 50 nearest neighbors (knearneigh, k=50). Now I
>> wonder if my spatial error model has FULLY controlled for spatial
>> autocorrelation in the data. Is there a way to test it? I know I can use
>> lm.morantest() to test spatial autocorrelation in residuals from an
>> estimated OLS model. But I do not know if there is a similar test for a
>> spatial error model. Any advice is greatly appreciated.
>
> You will know that there is a Lagrange Multiplier test for spatial lag
> model residuals. There is however no test for the residuals of a spatial
> error model. IDW will not help either - the choice of W as a fixed graph
> stipulates that you definitely know that it is the way observations relate
> to each other. Even PCNM/MESF (spatial filtering with the eigenvectors of
> a centred weights matrix) still assumes that the weights matrix is known.
>
> For spatial error models, you should always report the Hausman test.
> You can only accept that SEM is not misspecified if it confirms that the
> SEM and OLS coefficients are close. Unobserved covariates are a typical
> cause of trouble; adding WX (the SDEM, D for Durbin) may help. But if your
> phenomena exhibit different scaling in the footprints of their spatial
> processes, testing (if a test existed) with the same W wouldn't expose the
> problem.
>
> Probably SLX and SDEM are worth exploring, and for SEM and SDEM, reporting
> the Hausman test.
>
> There is a literature starting to appear on adaptive spatial weights, some
> functionality is in CARBayes.
>
> Hope this helps,
>
> Roger
>
>>
>> Best
>> Gary
>>
>>
>>        [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> --
> Roger Bivand
> Department of Economics, Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
> https://orcid.org/0000-0003-2392-6140
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>

--
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

	[[alternative HTML version deleted]]


From b@row||ng@on @end|ng |rom gm@||@com  Sun Mar 22 21:51:12 2020
From: b@row||ng@on @end|ng |rom gm@||@com (Barry Rowlingson)
Date: Sun, 22 Mar 2020 20:51:12 +0000
Subject: [R-sig-Geo] 
 astrophysics - transform sf from equatorial to galactic coordinates
In-Reply-To: <DB8PR05MB5961F742FE03BECC1CE3893AE3F20@DB8PR05MB5961.eurprd05.prod.outlook.com>
References: <DB8PR05MB5961F742FE03BECC1CE3893AE3F20@DB8PR05MB5961.eurprd05.prod.outlook.com>
Message-ID: <CANVKczNsA7xe0TJm9gLy-qqD90XSfjix1Fw9+ioyeYxpk8KD1A@mail.gmail.com>

Eugene,

I don't think this can be done using the PROJ library that does most
coordinate transformations for sf objects. The `astrolibR` package has
functions for converting coordinates on various astronomical systems

 https://cran.r-project.org/web/packages/astrolibR/astrolibR.pdf

but you have to feed it vectors of RA and declination rather than entire
spatial objects. This isn't much of a problem if you are dealing with
points (extract coords with st_coordinates, convert, make a new geometry)
but for lines of polygons you need to extract all the vertex points,
convert them, then rebuild the features.

You might also have problems if you have lines or polygons going across the
cosmic coordinate equivalent of the -180/+180 longitude line...

 Having another look, it *might* be possible to do this with PROJ by
constructing an appropriate spherical rotated coordinate system,  and you
might even be able to convert degrees to RA hours with a +units parameter...

Barry



On Sat, Mar 21, 2020 at 6:06 PM Eugene Hickey <Eugene.Hickey at tudublin.ie>
wrote:

> Hi
> Does anyone know of a way to transform an sf from equatorial (RA, DEC)
> into galactic (b, l) coordinates please?
>
>
> Thanks
> Eugene
>
> This email originated from TU Dublin. If you received this email in error,
> please delete it from your system. Please note that if you are not the
> named addressee, disclosing, copying, distributing or taking any action
> based on the contents of this email or attachments is prohibited.
>
> Is ? OT Baile ?tha Cliath a th?inig an r?omhphost seo. M? fuair t? an
> r?omhphost seo tr? earr?id, scrios de do ch?ras ? le do thoil. Tabhair ar
> aird, mura t? an seola? ainmnithe, go bhfuil dianchosc ar aon nochtadh, aon
> ch?ipe?il, aon d?ileadh n? ar aon ghn?omh a dh?anfar bunaithe ar an ?bhar
> at? sa r?omhphost n? sna hiat?in seo.
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From Roger@B|v@nd @end|ng |rom nhh@no  Mon Mar 23 09:19:03 2020
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Mon, 23 Mar 2020 09:19:03 +0100
Subject: [R-sig-Geo] 
 "spdep": check whether a spatial model fully controls
 for spatial correlation
In-Reply-To: <BYAPR02MB5767E4708BEA190B9AF45786DCF30@BYAPR02MB5767.namprd02.prod.outlook.com>
References: <BYAPR02MB576713CA1CEFD91737B6721CDCF20@BYAPR02MB5767.namprd02.prod.outlook.com>,
 <alpine.LFD.2.21.2003211057190.729923@reclus.nhh.no>
 <BYAPR02MB576708B31349CC1E89009EB4DCF30@BYAPR02MB5767.namprd02.prod.outlook.com>,
 <alpine.LFD.2.21.2003221657070.1760294@reclus.nhh.no>
 <BYAPR02MB5767E4708BEA190B9AF45786DCF30@BYAPR02MB5767.namprd02.prod.outlook.com>
Message-ID: <alpine.LFD.2.21.2003230905390.2312044@reclus.nhh.no>

On Sun, 22 Mar 2020, Gary Dong wrote:

> Thank you, Roger.
>
> I ran Hausman.test() for both my spatial error model (p-value < 2.2e-16) 
> and my spatial Durbin error model (p-value = 3.693e-11). My 
> understanding of these two tests is that my SDEM performs better than my 
> SEM, but there is still room for better specification of my SDEM. Is my 
> understanding correct?

>From your reading of Pace RK and LeSage J (2008) A spatial Hausman test. 
Economics Letters 101, 282-284, referenced from ?spatialreg::Hausman.test, 
you should rather conclude that both models are critically misspecified, 
as the OLS/SLX and SEM/SDEM coefficients differ more than the test expects 
(null hypothesis no big differences, alternative big differences).

>
> I know that the function "impacts()" applies to spatial lag models only. 
> Is there a R function or a formula that I can use to compute the total 
> impacts based on the X and lag.X coefficients in a SDEM?

impacts() of the fitted SLX/SDEM model, without simulation as the standard 
errors of the impacts are calculated by linear combination. Typically use 
the summary() method of the impacts as otherwise documented. But since the 
model is badly misspecified, it looks as though you'll need to go back to 
your input data anyway, so impacts are premature.

Roger

>
> Best
> Gary
>
>
> ________________________________
> From: Roger Bivand <Roger.Bivand at nhh.no>
> Sent: Sunday, March 22, 2020 9:06 AM
> To: Gary Dong <donghw79 at hotmail.com>
> Cc: r-sig-geo at r-project.org <r-sig-geo at r-project.org>
> Subject: Re: [R-sig-Geo] "spdep": check whether a spatial model fully controls for spatial correlation
>
> On Sun, 22 Mar 2020, Gary Dong wrote:
>
>> Dear Roger, thank you very much for your advice.
>>
>> I ran Lagrange tests. The tests yielded very small p-values for both
>> spatial lag and error models. Both RLMerr and RLMlag are all very
>> significant (with very small p-values) and the p-value of RLMerr is even
>> smaller. So I went with the spatial Durbin error model (SDEM). The
>> regular spatial Durbin model (SDM) did not work (it produced many NAs in
>> the estimates).
>
> Not those LM tests. At the foot of the output of the
> summary method for spatialreg::lagsarlm, you see the output of the LM test
> for residual autocorrelation in a spatial lag model.
>
>>
>> Because it is unclear how exactly my observations relate to each, I
>> decide to test is out. I construct spatial weight matrices with
>> different number of neighbors (k=10, 20, 50, &100). I run a SDEM with
>> each spatial weight matrix and compare their AICs and log likelihoods.
>> Oddly, SDEMs with smaller spatial weight matrix performed better
>> (smaller AIC and higher log likelihood). This seems to suggest that in
>> my case, the model works better when it considers a smaller number of
>> neighboring observations. I also observe that SDEMs with larger weight
>> matrices (e.g. k=50 or 100) tend to yield larger indirect effects
>> (larger coefficients of lag.Xs). In some cases, the indirect effects are
>> unreasonably large. This seems to confirm that with my data, SDEMs with
>> smaller weight matrices perform better.
>>
>
> Usually, it is much better to use a simple graph between proximate
> neighbours. k-nearest neighbours appear asymmetric, but a SAR model makes
> them symmetric anyway. And the spatial process itself is dense (the
> variance-covariance matrix of observations). Having denser weights may
> well over-smooth as you see.
>
>> Is this somewhat counter-intuitive, given that the Moran's I test
>> suggests very strong spatial auto-correlation in my data? Does this mean
>> that I should go with the SDEM with k=10, or even decrease K number
>> below 10?
>
> Certainly reduce further, a graph-based measure will typically have about
> 6 neighbours. LeSage & Pace have found that the choice of weights isn't so
> important, and any weights (even sparse) will do better than ignoring the
> spatial autocorrelation. Tony Smith has found that too dense weights may
> bias the fitted model.
>
> Go with small k and SDEM, if the Hausman test doesn't indicate other
> misspecification. And use the impacts method to aggregate the X and WX
> contributions.
>
> Hope this clarifies,
>
> Roger
>
>>
>> Best
>> Gary
>>
>>
>> ________________________________
>> From: Roger Bivand <Roger.Bivand at nhh.no>
>> Sent: Saturday, March 21, 2020 3:07 AM
>> To: Gary Dong <donghw79 at hotmail.com>
>> Cc: r-sig-geo at r-project.org <r-sig-geo at r-project.org>
>> Subject: Re: [R-sig-Geo] "spdep": check whether a spatial model fully controls for spatial correlation
>>
>> On Sat, 21 Mar 2020, Gary Dong wrote:
>>
>>> Dear all,
>>>
>>> I have estimated a spatial error model via the "spdep" package. The
>>> spatial weights are determined based on the inverse distance between an
>>> observation and its 50 nearest neighbors (knearneigh, k=50). Now I
>>> wonder if my spatial error model has FULLY controlled for spatial
>>> autocorrelation in the data. Is there a way to test it? I know I can use
>>> lm.morantest() to test spatial autocorrelation in residuals from an
>>> estimated OLS model. But I do not know if there is a similar test for a
>>> spatial error model. Any advice is greatly appreciated.
>>
>> You will know that there is a Lagrange Multiplier test for spatial lag
>> model residuals. There is however no test for the residuals of a spatial
>> error model. IDW will not help either - the choice of W as a fixed graph
>> stipulates that you definitely know that it is the way observations relate
>> to each other. Even PCNM/MESF (spatial filtering with the eigenvectors of
>> a centred weights matrix) still assumes that the weights matrix is known.
>>
>> For spatial error models, you should always report the Hausman test.
>> You can only accept that SEM is not misspecified if it confirms that the
>> SEM and OLS coefficients are close. Unobserved covariates are a typical
>> cause of trouble; adding WX (the SDEM, D for Durbin) may help. But if your
>> phenomena exhibit different scaling in the footprints of their spatial
>> processes, testing (if a test existed) with the same W wouldn't expose the
>> problem.
>>
>> Probably SLX and SDEM are worth exploring, and for SEM and SDEM, reporting
>> the Hausman test.
>>
>> There is a literature starting to appear on adaptive spatial weights, some
>> functionality is in CARBayes.
>>
>> Hope this helps,
>>
>> Roger
>>
>>>
>>> Best
>>> Gary
>>>
>>>
>>>        [[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>> --
>> Roger Bivand
>> Department of Economics, Norwegian School of Economics,
>> Helleveien 30, N-5045 Bergen, Norway.
>> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
>> https://orcid.org/0000-0003-2392-6140
>> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>>
>
> --
> Roger Bivand
> Department of Economics, Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
> https://orcid.org/0000-0003-2392-6140
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en


From @|ex@ndre@@nto@br @end|ng |rom y@hoo@com@br  Mon Mar 23 14:40:46 2020
From: @|ex@ndre@@nto@br @end|ng |rom y@hoo@com@br (ASANTOS)
Date: Mon, 23 Mar 2020 09:40:46 -0400
Subject: [R-sig-Geo] Modifications of the methods in resample() function
 using raster package
References: <b8be3171-cc85-cc3e-2cfb-973bb42a8eb6.ref@yahoo.com.br>
Message-ID: <b8be3171-cc85-cc3e-2cfb-973bb42a8eb6@yahoo.com.br>

Dear r-sig-geo members,

 ??? I?ve like to know the possibility of make some modifications in 
resample() function in raster package. First, in "bilinear" method by 
default is assigns a weighted average of the four nearest cells, and 
I?ll like to change for five and six nearest cells, too, is possible? 
Second, is it possible too to create the mean method to calculate the 
arithmetic average of the four, five, and six nearest cells?

Thanks in advanced,
Alexandre

-- 
Alexandre dos Santos
Geotechnologies and Spatial Statistics applied to Forest Entomology
Instituto Federal de Mato Grosso (IFMT) - Campus Caceres
Caixa Postal 244 (PO Box)
Avenida dos Ramires, s/n - Vila Real
Caceres - MT - CEP 78201-380 (ZIP code)
Phone: (+55) 65 99686-6970 / (+55) 65 3221-2674
Lattes CV: http://lattes.cnpq.br/1360403201088680
OrcID: orcid.org/0000-0001-8232-6722
ResearchGate: www.researchgate.net/profile/Alexandre_Santos10
Publons: https://publons.com/researcher/3085587/alexandre-dos-santos/
--


From ruth@ko@t @end|ng |rom u@@@k@c@  Mon Mar 23 16:36:01 2020
From: ruth@ko@t @end|ng |rom u@@@k@c@ (Aschim, Ruth)
Date: Mon, 23 Mar 2020 15:36:01 +0000
Subject: [R-sig-Geo] ENFA specialization values
Message-ID: <YTOPR0101MB1801758C94EF3EE5EC37B33D9FF00@YTOPR0101MB1801.CANPRD01.PROD.OUTLOOK.COM>

Hello,

I am running an ENFA analysis and am having trouble interpreting the specialization values. Do the specialization values correspond to each ecogeographical variable? If so they don't make sense in terms of what I am seeing for the marginality values, i.e. marginality value for water is high and displays a long arrow on the biplot. Therefore, I would think that the specialization value for water would be high, but if the vector of specialization values corresponds to each ecogeographical variable then this is not the case. Am I missing a line of code? An explanation of how to interpret the specialization values from the code and output below would be much appreciated.


slot(maps,"data")[,1:9] <- sqrt(slot(maps,"data")[,1:9])
hist(maps, type = "l")

## Prepare the data for the ENFA
tab <- slot(maps, "data")
pr <- slot(count.points(pipl, maps), "data")[,1]


## Perform the PCA before the ENFA
pc <- dudi.pca(tab, scannf = FALSE)
pc

(enfa1 <- enfa(pc, pr,scannf = FALSE))

enfa1$s #gives specialization values
enfa1$mar#gives marginality values

##OUTPUT##

> (enfa1 <- enfa(pc, pr,scannf = FALSE))
ENFA
$call: enfa(dudi = pc, pr = pr, scannf = FALSE)

marginality: 1.731
eigen values of specialization: 6.61 2.583 1.924 1.49 1.153 ...
$nf: 1 axis of specialization saved

  vector length mode    content
1 $pr    385923 numeric vector of presence
2 $lw    385923 numeric row weights
3 $cw    10     numeric column weights
4 $mar   10     numeric coordinates of the marginality vector
5 $s     9      numeric eigen values of specialization

  data.frame nrow   ncol content
1 $tab       385923 10   modified array
2 $li        385923 2    row coordinates
3 $co        10     2    column coordinates

> enfa1$s  #gives specialization values
[1] 6.6101077 2.5830759 1.9242150 1.4895781 1.1533000 1.0651184 0.8456433 0.7114272 0.4710257

> enfa1$mar #gives marginality values
           Annual         Perennial         Grassland         Deciduous        Coniferous
       0.38442513        0.33468805        0.62931566       -0.31320996       -0.55314134
            Mixed             Water           Wetland             Shrub Distance_to_Roads
      -0.53532160        0.55172030       -0.25751795        0.02533396       -0.11602451

Thank you
~Ruth








	[[alternative HTML version deleted]]


From |v|@|e|ro @end|ng |rom gm@||@com  Mon Mar 23 18:45:53 2020
From: |v|@|e|ro @end|ng |rom gm@||@com (Frederico Faleiro)
Date: Mon, 23 Mar 2020 14:45:53 -0300
Subject: [R-sig-Geo] Convert rectilinear to regular grid in R (stars and
 raster)
Message-ID: <CAL+ycWmLeAz-x+TkZcPgUEmmqnE0NB3wBUPk7gGdt5wpG70jcg@mail.gmail.com>

Dear all,

I am trying convert netCDF data from rectilinear to regular grid in R, but
I am not sure what is the best approach for it.
I would like to convert the grid modifying the original resolution only
when necessary. In some cases I must change resolution to keep regular cell
size and cover all the world extent.
I have tried without success st_warp from stars and I find a way with
rasterize from raster package (see script bellow).

I have the following questions:
1. What am I doing wrong in stars package (see script bellow)?
2. Is there a way to rasterize points to raster using metrics that consider
distance (e.g. bilinear, nearest neighbor, etc)? Note that I need
use points in raster package because it do not handle with rectilinear grid.
3. Do you recommend any other approach?

The data are available in:
GDrive:
https://drive.google.com/file/d/1HKxFpAwvY9k_cFbasagKHAwi1luzLv90/view?usp=sharing
CMIP5 portal (you must make a login):
http://aims3.llnl.gov/thredds/fileServer/cmip5_css01_data/cmip5/output1/BCC/bcc-csm1-1/rcp45/mon/atmos/Amon/r1i1p1/v20120705/pr/pr_Amon_bcc-csm1-1_rcp45_r1i1p1_200601-209912.nc

# script
library(stars)
library(raster)

# prepare data
bc <- read_ncdf("pr_Amon_bcc-csm1-1_rcp45_r1i1p1_200601-209912.nc")
# get coordinates and data from the first time period
bc1 <- as.data.frame(bc[, , , 1])
# convert longitude to variate between -180 and 180
bc1$lon <- ifelse(bc1$lon > 180, bc1$lon - 360, bc1$lon)

# original resolution
bc1$lon %>% diff %>% table
bc1$lat %>% diff %>% table
# new resolution
new_res <- c(2.8125, 2.8125)
# Is it multiple of 180 or 360?
180 %% new_res

# create a new standard grid
wgs84 <- "+proj=longlat +ellps=WGS84 +towgs84=0,0,0,0,0,0,0 +no_defs"
grid_r <- raster(res = new_res, crs = wgs84)
grid_st <- st_as_stars(grid_r)

# change from rectilinear to regular grid
# stars package: use st_warp to change from rectilinear to regular raster
with different methods
bc_reg <- bc %>% st_warp(grid_st, method = "average")
bc_reg <- bc %>% st_warp(grid_st, method = "near")
bc_reg <- bc %>% st_warp(grid_st, method = "bilinear")
# In all cases I have this error: Error in 1:prod(dims[dxy]) : NA/NaN
argument

# raster package: rasterize the points values to the new regular grid
bc1_sp <- bc1
coordinates(bc1_sp) <- ~ lon + lat
bc1_reg <- rasterize(bc1_sp, grid_r, field = "pr", fun = mean)

# plot the first time period
dev.new(title = "rectilinear")
plot(bc[, , , 1])
dev.new(title = "regular with raster package")
plot(bc1_mn_reg)

Best regards,

Frederico Faleiro
Postdoctoral Researcher in the INCT-EECBio (https://www.eecbio.ufg.br/)
Federal University of Goi?s | Brazil
RG: https://www.researchgate.net/profile/Frederico_Faleiro

	[[alternative HTML version deleted]]


From |v|@|e|ro @end|ng |rom gm@||@com  Mon Mar 23 19:23:49 2020
From: |v|@|e|ro @end|ng |rom gm@||@com (Frederico Faleiro)
Date: Mon, 23 Mar 2020 15:23:49 -0300
Subject: [R-sig-Geo] Modifications of the methods in resample() function
 using raster package
In-Reply-To: <b8be3171-cc85-cc3e-2cfb-973bb42a8eb6@yahoo.com.br>
References: <b8be3171-cc85-cc3e-2cfb-973bb42a8eb6.ref@yahoo.com.br>
 <b8be3171-cc85-cc3e-2cfb-973bb42a8eb6@yahoo.com.br>
Message-ID: <CAL+ycWmbFviOcu=6N_uWvY0zZkw0M=GgQei_ykNfO-C-TgiRJQ@mail.gmail.com>

Hi Alexandre,

you can use extract from raster (check the examples in the help page).
Depending of your data you can create a spatial polygon that cover the
number of cells you want and define the summary function or use the buffer
argument.

Best regards,

Frederico Faleiro
Postdoctoral Researcher in the INCT-EECBio (https://www.eecbio.ufg.br/)
Federal University of Goi?s | Brazil
RG: https://www.researchgate.net/profile/Frederico_Faleiro



Em seg., 23 de mar. de 2020 ?s 10:41, ASANTOS via R-sig-Geo <
r-sig-geo at r-project.org> escreveu:

> Dear r-sig-geo members,
>
>  ??? I?ve like to know the possibility of make some modifications in
> resample() function in raster package. First, in "bilinear" method by
> default is assigns a weighted average of the four nearest cells, and
> I?ll like to change for five and six nearest cells, too, is possible?
> Second, is it possible too to create the mean method to calculate the
> arithmetic average of the four, five, and six nearest cells?
>
> Thanks in advanced,
> Alexandre
>
> --
> Alexandre dos Santos
> Geotechnologies and Spatial Statistics applied to Forest Entomology
> Instituto Federal de Mato Grosso (IFMT) - Campus Caceres
> Caixa Postal 244 (PO Box)
> Avenida dos Ramires, s/n - Vila Real
> Caceres - MT - CEP 78201-380 (ZIP code)
> Phone: (+55) 65 99686-6970 / (+55) 65 3221-2674
> Lattes CV: http://lattes.cnpq.br/1360403201088680
> OrcID: orcid.org/0000-0001-8232-6722
> ResearchGate: www.researchgate.net/profile/Alexandre_Santos10
> Publons: https://publons.com/researcher/3085587/alexandre-dos-santos/
> --
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From |@@dr|@n@dw|putr@ @end|ng |rom gm@||@com  Mon Mar 23 19:37:27 2020
From: |@@dr|@n@dw|putr@ @end|ng |rom gm@||@com (Adrian Dwiputra)
Date: Mon, 23 Mar 2020 11:37:27 -0700
Subject: [R-sig-Geo] ENFA specialization values
Message-ID: <5e7901ea.1c69fb81.5c9a2.3603@mx.google.com>

An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20200323/60dbb834/attachment.html>

From @|ex@ndre@@nto@br @end|ng |rom y@hoo@com@br  Mon Mar 23 20:26:39 2020
From: @|ex@ndre@@nto@br @end|ng |rom y@hoo@com@br (ASANTOS)
Date: Mon, 23 Mar 2020 15:26:39 -0400
Subject: [R-sig-Geo] Modifications of the methods in resample() function
 using raster package
In-Reply-To: <CAL+ycWmbFviOcu=6N_uWvY0zZkw0M=GgQei_ykNfO-C-TgiRJQ@mail.gmail.com>
References: <b8be3171-cc85-cc3e-2cfb-973bb42a8eb6.ref@yahoo.com.br>
 <b8be3171-cc85-cc3e-2cfb-973bb42a8eb6@yahoo.com.br>
 <CAL+ycWmbFviOcu=6N_uWvY0zZkw0M=GgQei_ykNfO-C-TgiRJQ@mail.gmail.com>
Message-ID: <37ec9e7b-3f25-a9dc-0642-1d02eaffff35@yahoo.com.br>

Thanks Frederico,

But at this moment, I'll try to reduce steps (extract() - focal() - 
resample()) and using only resample() function to change the number of 
nearest cells, if is possible.

First, in "bilinear" method, I'll like to change the function for work 
with the different number of nearest cells and second I'll expected to 
create a mean method to calculate the arithmetic average of the n 
nearest cells too.

For example, in the first case for 25 nearest cells, I'll like to do 
something like resample (myraster, myresolution, window=matrix 
(nrow=5,nol=5), method="bilinear") and in the second case resample 
(myraster, myresolution, window=matrix (nrow=5,nol=5), fun=mean). But, 
obviously this commands doesn't work but expressed my general goal.

Best wishes,

Alexandre

-- 
Alexandre dos Santos
Geotechnologies and Spatial Statistics applied to Forest Entomology
Instituto Federal de Mato Grosso (IFMT) - Campus Caceres
Caixa Postal 244 (PO Box)
Avenida dos Ramires, s/n - Vila Real
Caceres - MT - CEP 78201-380 (ZIP code)
Phone: (+55) 65 99686-6970 / (+55) 65 3221-2674
Lattes CV: http://lattes.cnpq.br/1360403201088680
OrcID: orcid.org/0000-0001-8232-6722
ResearchGate: www.researchgate.net/profile/Alexandre_Santos10
Publons: https://publons.com/researcher/3085587/alexandre-dos-santos/
--

Em 23/03/2020 14:23, Frederico Faleiro escreveu:
> Hi Alexandre,
>
> you can use extract from raster (check the examples in the help page).
> Depending of your data you can create a spatial polygon that cover the 
> number of cells you want and define the summary function or use the 
> buffer argument.
>
> Best regards,
>
> Frederico Faleiro
> Postdoctoral Researcher in the INCT-EECBio?(https://www.eecbio.ufg.br/)
> Federal University of Goi?s | Brazil
> RG: https://www.researchgate.net/profile/Frederico_Faleiro
>
>
> Em seg., 23 de mar. de 2020 ?s 10:41, ASANTOS via R-sig-Geo 
> <r-sig-geo at r-project.org <mailto:r-sig-geo at r-project.org>> escreveu:
>
>     Dear r-sig-geo members,
>
>     ???? I?ve like to know the possibility of make some modifications in
>     resample() function in raster package. First, in "bilinear" method by
>     default is assigns a weighted average of the four nearest cells, and
>     I?ll like to change for five and six nearest cells, too, is possible?
>     Second, is it possible too to create the mean method to calculate the
>     arithmetic average of the four, five, and six nearest cells?
>
>     Thanks in advanced,
>     Alexandre
>
>     -- 
>     Alexandre dos Santos
>     Geotechnologies and Spatial Statistics applied to Forest Entomology
>     Instituto Federal de Mato Grosso (IFMT) - Campus Caceres
>     Caixa Postal 244 (PO Box)
>     Avenida dos Ramires, s/n - Vila Real
>     Caceres - MT - CEP 78201-380 (ZIP code)
>     Phone: (+55) 65 99686-6970 / (+55) 65 3221-2674
>     Lattes CV: http://lattes.cnpq.br/1360403201088680
>     OrcID: orcid.org/0000-0001-8232-6722
>     <http://orcid.org/0000-0001-8232-6722>
>     ResearchGate: www.researchgate.net/profile/Alexandre_Santos10
>     <http://www.researchgate.net/profile/Alexandre_Santos10>
>     Publons: https://publons.com/researcher/3085587/alexandre-dos-santos/
>     --
>
>     _______________________________________________
>     R-sig-Geo mailing list
>     R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
>     https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From @|ex@ndre@@nto@br @end|ng |rom y@hoo@com@br  Mon Mar 23 20:26:39 2020
From: @|ex@ndre@@nto@br @end|ng |rom y@hoo@com@br (ASANTOS)
Date: Mon, 23 Mar 2020 15:26:39 -0400
Subject: [R-sig-Geo] Modifications of the methods in resample() function
 using raster package
In-Reply-To: <CAL+ycWmbFviOcu=6N_uWvY0zZkw0M=GgQei_ykNfO-C-TgiRJQ@mail.gmail.com>
References: <b8be3171-cc85-cc3e-2cfb-973bb42a8eb6.ref@yahoo.com.br>
 <b8be3171-cc85-cc3e-2cfb-973bb42a8eb6@yahoo.com.br>
 <CAL+ycWmbFviOcu=6N_uWvY0zZkw0M=GgQei_ykNfO-C-TgiRJQ@mail.gmail.com>
Message-ID: <37ec9e7b-3f25-a9dc-0642-1d02eaffff35@yahoo.com.br>

Thanks Frederico,

But at this moment, I'll try to reduce steps (extract() - focal() - 
resample()) and using only resample() function to change the number of 
nearest cells, if is possible.

First, in "bilinear" method, I'll like to change the function for work 
with the different number of nearest cells and second I'll expected to 
create a mean method to calculate the arithmetic average of the n 
nearest cells too.

For example, in the first case for 25 nearest cells, I'll like to do 
something like resample (myraster, myresolution, window=matrix 
(nrow=5,nol=5), method="bilinear") and in the second case resample 
(myraster, myresolution, window=matrix (nrow=5,nol=5), fun=mean). But, 
obviously this commands doesn't work but expressed my general goal.

Best wishes,

Alexandre

-- 
Alexandre dos Santos
Geotechnologies and Spatial Statistics applied to Forest Entomology
Instituto Federal de Mato Grosso (IFMT) - Campus Caceres
Caixa Postal 244 (PO Box)
Avenida dos Ramires, s/n - Vila Real
Caceres - MT - CEP 78201-380 (ZIP code)
Phone: (+55) 65 99686-6970 / (+55) 65 3221-2674
Lattes CV: http://lattes.cnpq.br/1360403201088680
OrcID: orcid.org/0000-0001-8232-6722
ResearchGate: www.researchgate.net/profile/Alexandre_Santos10
Publons: https://publons.com/researcher/3085587/alexandre-dos-santos/
--

Em 23/03/2020 14:23, Frederico Faleiro escreveu:
> Hi Alexandre,
>
> you can use extract from raster (check the examples in the help page).
> Depending of your data you can create a spatial polygon that cover the 
> number of cells you want and define the summary function or use the 
> buffer argument.
>
> Best regards,
>
> Frederico Faleiro
> Postdoctoral Researcher in the INCT-EECBio?(https://www.eecbio.ufg.br/)
> Federal University of Goi?s | Brazil
> RG: https://www.researchgate.net/profile/Frederico_Faleiro
>
>
> Em seg., 23 de mar. de 2020 ?s 10:41, ASANTOS via R-sig-Geo 
> <r-sig-geo at r-project.org <mailto:r-sig-geo at r-project.org>> escreveu:
>
>     Dear r-sig-geo members,
>
>     ???? I?ve like to know the possibility of make some modifications in
>     resample() function in raster package. First, in "bilinear" method by
>     default is assigns a weighted average of the four nearest cells, and
>     I?ll like to change for five and six nearest cells, too, is possible?
>     Second, is it possible too to create the mean method to calculate the
>     arithmetic average of the four, five, and six nearest cells?
>
>     Thanks in advanced,
>     Alexandre
>
>     -- 
>     Alexandre dos Santos
>     Geotechnologies and Spatial Statistics applied to Forest Entomology
>     Instituto Federal de Mato Grosso (IFMT) - Campus Caceres
>     Caixa Postal 244 (PO Box)
>     Avenida dos Ramires, s/n - Vila Real
>     Caceres - MT - CEP 78201-380 (ZIP code)
>     Phone: (+55) 65 99686-6970 / (+55) 65 3221-2674
>     Lattes CV: http://lattes.cnpq.br/1360403201088680
>     OrcID: orcid.org/0000-0001-8232-6722
>     <http://orcid.org/0000-0001-8232-6722>
>     ResearchGate: www.researchgate.net/profile/Alexandre_Santos10
>     <http://www.researchgate.net/profile/Alexandre_Santos10>
>     Publons: https://publons.com/researcher/3085587/alexandre-dos-santos/
>     --
>
>     _______________________________________________
>     R-sig-Geo mailing list
>     R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
>     https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From vrg@||@no @end|ng |rom gm@||@com  Mon Mar 23 21:01:40 2020
From: vrg@||@no @end|ng |rom gm@||@com (Victor F. Rodriguez Galiano)
Date: Mon, 23 Mar 2020 21:01:40 +0100
Subject: [R-sig-Geo] issue when opening raster image in R,
 the pixel values a rescaled somehow
Message-ID: <CAG=LYAZOZo3m=7D6GFZwYqED4DHvXFhv+tJMCHz9a3DmSGR6Kg@mail.gmail.com>

I opened a Geotiff image in R using the raster function. However, the image
seems to be rescaled. The minimum and maximum values should be 13607 and
15461 but are 275 and 305. The Geotiff image when opened in a GIS is
correct but not in R.

This is my code:

Script:

library(raster)

trial<-raster("MOD11A2.A2000049.h17v05.006.2015058135048.tif",
datatype = "INT2U")

trial

plot(trial)

	[[alternative HTML version deleted]]


From Roger@B|v@nd @end|ng |rom nhh@no  Mon Mar 23 21:06:58 2020
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Mon, 23 Mar 2020 20:06:58 +0000
Subject: [R-sig-Geo] issue when opening raster image in R,
 the pixel values a rescaled somehow
Message-ID: <DM6PR02MB5690689BB1230DA7821BE3C5A3F00@DM6PR02MB5690.namprd02.prod.outlook.com>

Please make the file in question available for download (url), or the url you downloaded it from (no login), on this list. It looks as though the unsigned 16 bit integer is not right.

Roger Bivand
Norwegian School of Economics
Bergen, Norway

________________________________
Fra: R-sig-Geo <r-sig-geo-bounces at r-project.org> p? vegne av Victor F. Rodriguez Galiano <vrgaliano at gmail.com>
Sendt: mandag 23. mars 2020, 21.02
Til: r-sig-geo at r-project.org
Emne: [R-sig-Geo] issue when opening raster image in R, the pixel values a rescaled somehow

I opened a Geotiff image in R using the raster function. However, the image seems to be rescaled. The minimum and maximum values should be 13607 and 15461 but are 275 and 305. The Geotiff image when opened in a GIS is correct but not in R. This is my code: Script: library(raster) trial<-raster("MOD11A2.A2000049.h17v05.006.2015058135048.tif", datatype = "INT2U") trial plot(trial) [[alternative HTML version deleted]] _______________________________________________ R-sig-Geo mailing list R-sig-Geo at r-project.org https://stat.ethz.ch/mailman/listinfo/r-sig-geo

	[[alternative HTML version deleted]]


From bh@@k@r@ko|k@t@ @end|ng |rom gm@||@com  Mon Mar 23 22:52:37 2020
From: bh@@k@r@ko|k@t@ @end|ng |rom gm@||@com (Bhaskar Mitra)
Date: Mon, 23 Mar 2020 14:52:37 -0700
Subject: [R-sig-Geo] Request for help about running a loop and reading .NC
 files
Message-ID: <CAEGXkYXdnzxxKEVPWfWZr1qvuDAeXLAAz6Jv77VLiVJ+MWGPag@mail.gmail.com>

Hello Everyone,

I have written a loop which reads hundreds of .nc files
and extract information from each .nc file and
exports that corresponding information as a csv file.

The loop works fine until it encounters a .nc file which it cannot read
and the loop stops. I would appreciate if anyone can suggest how can I
modify
the loop, whereby the loop will continue to run by bypassing those
particular
files which it cannot read.

In the end I was also hoping to modify the loop such that it
will generate a report which will inform me which
files were not read by the loop.  The codes are given below

Thanks,
Bhaskar Mitra
NAU

#_------------------------------------------------------------------


library(ncdf4)
library(reshape2)
library(dplyr)
library(stringr)


setwd("directory path")

Output <- "directory path"

flist <- list.files(path ="NCFiles/", pattern = "^.*\\.(nc|NC|Nc|Nc)$")

for (i in 1: length(flist))
{

  nc <- nc_open(paste0("NCFiles/",flist[i]))
  mean1 <- ncvar_get(nc,attributes(nc$dim)$names[3])
  nc_close(nc)

  mean_chl_df <- melt(mean1)
  trial.table.df <-as.data.frame(mean_chl_df)

write.csv(trial.table.df,paste0(Output,"/",tools::file_path_sans_ext(flist[i]),".csv"))

}

	[[alternative HTML version deleted]]


From r@turner @end|ng |rom @uck|@nd@@c@nz  Mon Mar 23 23:36:10 2020
From: r@turner @end|ng |rom @uck|@nd@@c@nz (Rolf Turner)
Date: Tue, 24 Mar 2020 11:36:10 +1300
Subject: [R-sig-Geo] [FORGED] Request for help about running a loop and
 reading .NC files
In-Reply-To: <CAEGXkYXdnzxxKEVPWfWZr1qvuDAeXLAAz6Jv77VLiVJ+MWGPag@mail.gmail.com>
References: <CAEGXkYXdnzxxKEVPWfWZr1qvuDAeXLAAz6Jv77VLiVJ+MWGPag@mail.gmail.com>
Message-ID: <e709991a-aa8c-4194-fef5-cf54b807249a@auckland.ac.nz>


On 24/03/20 10:52 am, Bhaskar Mitra wrote:

> Hello Everyone,
> 
> I have written a loop which reads hundreds of .nc files
> and extract information from each .nc file and
> exports that corresponding information as a csv file.
> 
> The loop works fine until it encounters a .nc file which it cannot read
> and the loop stops. I would appreciate if anyone can suggest how can I
> modify
> the loop, whereby the loop will continue to run by bypassing those
> particular
> files which it cannot read.
> 
> In the end I was also hoping to modify the loop such that it
> will generate a report which will inform me which
> files were not read by the loop.  The codes are given below

Perhaps use try()???

cheers,

Rolf Turner

-- 
Honorary Research Fellow
Department of Statistics
University of Auckland
Phone: +64-9-373-7599 ext. 88276


From btupper @end|ng |rom b|ge|ow@org  Tue Mar 24 00:17:37 2020
From: btupper @end|ng |rom b|ge|ow@org (Ben Tupper)
Date: Mon, 23 Mar 2020 19:17:37 -0400
Subject: [R-sig-Geo] 
 Request for help about running a loop and reading .NC files
In-Reply-To: <CAEGXkYXdnzxxKEVPWfWZr1qvuDAeXLAAz6Jv77VLiVJ+MWGPag@mail.gmail.com>
References: <CAEGXkYXdnzxxKEVPWfWZr1qvuDAeXLAAz6Jv77VLiVJ+MWGPag@mail.gmail.com>
Message-ID: <CALrbzg3sC_wQseELeu6z4M7UeCifo0n4O05c8_X=2sgTQc7LQA@mail.gmail.com>

Hi,

Rolf is correct that you might consider enclosing your nc_open(...) with
try(nc_open(...)), and then testing if the value returned by try() inherits
from the "try-error" class. If there is no problem opening the NCDF file,
then it will return an "ncdf4" class object.

Also, you might isolate the file extraction stuff into a function to make
your life easier. Something like this (obviously not tested)...


### START
# extract data from a NCDF file
# @param filename the path and name of the file
# @return either NULL (for an exception) or a data.frame
extract_from_nc <- function(filename){

  nc <- try(nc_open(filename))
  if (inherits(nc, "try-error")){
    # if it isn't a healthy NCDF file you will be here
    x <- NULL
  } else {
    # otherwise you will be here and you can run your extraction
    mean1 <- ...
     ...
    x <- as.data.frame(mean_chl_df)
    write.csv(x, ... other stuff here ...)
    nc_close(nc)
  }
  return(x)
}

flist <- list.files(path ="NCFiles/", pattern = "^.*\\.(nc|NC|Nc|Nc)$",
full.names = TRUE)

xx <- lapply(flist, extract_from_nc)
ix <- sapply(xx, is.null)                    # find the NULLS
xx <- xx[!ix]                                # remove them (if any)
if (length(xx) > 0) x <- do.call(rbind, xx)  # row bind what remains into
one data frame (in case that is helpful)
### END

I hope that helps.

Cheers,
Ben





On Mon, Mar 23, 2020 at 5:53 PM Bhaskar Mitra <bhaskar.kolkata at gmail.com>
wrote:

> Hello Everyone,
>
> I have written a loop which reads hundreds of .nc files
> and extract information from each .nc file and
> exports that corresponding information as a csv file.
>
> The loop works fine until it encounters a .nc file which it cannot read
> and the loop stops. I would appreciate if anyone can suggest how can I
> modify
> the loop, whereby the loop will continue to run by bypassing those
> particular
> files which it cannot read.
>
> In the end I was also hoping to modify the loop such that it
> will generate a report which will inform me which
> files were not read by the loop.  The codes are given below
>
> Thanks,
> Bhaskar Mitra
> NAU
>
> #_------------------------------------------------------------------
>
>
> library(ncdf4)
> library(reshape2)
> library(dplyr)
> library(stringr)
>
>
> setwd("directory path")
>
> Output <- "directory path"
>
> flist <- list.files(path ="NCFiles/", pattern = "^.*\\.(nc|NC|Nc|Nc)$")
>
> for (i in 1: length(flist))
> {
>
>   nc <- nc_open(paste0("NCFiles/",flist[i]))
>   mean1 <- ncvar_get(nc,attributes(nc$dim)$names[3])
>   nc_close(nc)
>
>   mean_chl_df <- melt(mean1)
>   trial.table.df <-as.data.frame(mean_chl_df)
>
>
> write.csv(trial.table.df,paste0(Output,"/",tools::file_path_sans_ext(flist[i]),".csv"))
>
> }
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


-- 
Ben Tupper
Bigelow Laboratory for Ocean Science
East Boothbay, Maine
http://www.bigelow.org/
https://eco.bigelow.org

	[[alternative HTML version deleted]]


From bh@@k@r@ko|k@t@ @end|ng |rom gm@||@com  Tue Mar 24 01:30:54 2020
From: bh@@k@r@ko|k@t@ @end|ng |rom gm@||@com (Bhaskar Mitra)
Date: Mon, 23 Mar 2020 17:30:54 -0700
Subject: [R-sig-Geo] 
 Request for help about running a loop and reading .NC files
In-Reply-To: <CALrbzg3sC_wQseELeu6z4M7UeCifo0n4O05c8_X=2sgTQc7LQA@mail.gmail.com>
References: <CAEGXkYXdnzxxKEVPWfWZr1qvuDAeXLAAz6Jv77VLiVJ+MWGPag@mail.gmail.com>
 <CALrbzg3sC_wQseELeu6z4M7UeCifo0n4O05c8_X=2sgTQc7LQA@mail.gmail.com>
Message-ID: <CAEGXkYXgf-Jho7Q3zCx23Tu_5Yo-vtPoQeEgkwSB6QA-Yh-XPA@mail.gmail.com>

Hi Ben, Rolf,

Thanks for your help.

Ben : the code works perfectly.

thanks once again,

bhaskar

On Mon, Mar 23, 2020 at 4:17 PM Ben Tupper <btupper at bigelow.org> wrote:

> Hi,
>
> Rolf is correct that you might consider enclosing your nc_open(...) with
> try(nc_open(...)), and then testing if the value returned by try() inherits
> from the "try-error" class. If there is no problem opening the NCDF file,
> then it will return an "ncdf4" class object.
>
> Also, you might isolate the file extraction stuff into a function to make
> your life easier. Something like this (obviously not tested)...
>
>
> ### START
> # extract data from a NCDF file
> # @param filename the path and name of the file
> # @return either NULL (for an exception) or a data.frame
> extract_from_nc <- function(filename){
>
>   nc <- try(nc_open(filename))
>   if (inherits(nc, "try-error")){
>     # if it isn't a healthy NCDF file you will be here
>     x <- NULL
>   } else {
>     # otherwise you will be here and you can run your extraction
>     mean1 <- ...
>      ...
>     x <- as.data.frame(mean_chl_df)
>     write.csv(x, ... other stuff here ...)
>     nc_close(nc)
>   }
>   return(x)
> }
>
> flist <- list.files(path ="NCFiles/", pattern = "^.*\\.(nc|NC|Nc|Nc)$",
> full.names = TRUE)
>
> xx <- lapply(flist, extract_from_nc)
> ix <- sapply(xx, is.null)                    # find the NULLS
> xx <- xx[!ix]                                # remove them (if any)
> if (length(xx) > 0) x <- do.call(rbind, xx)  # row bind what remains into
> one data frame (in case that is helpful)
> ### END
>
> I hope that helps.
>
> Cheers,
> Ben
>
>
>
>
>
> On Mon, Mar 23, 2020 at 5:53 PM Bhaskar Mitra <bhaskar.kolkata at gmail.com>
> wrote:
>
>> Hello Everyone,
>>
>> I have written a loop which reads hundreds of .nc files
>> and extract information from each .nc file and
>> exports that corresponding information as a csv file.
>>
>> The loop works fine until it encounters a .nc file which it cannot read
>> and the loop stops. I would appreciate if anyone can suggest how can I
>> modify
>> the loop, whereby the loop will continue to run by bypassing those
>> particular
>> files which it cannot read.
>>
>> In the end I was also hoping to modify the loop such that it
>> will generate a report which will inform me which
>> files were not read by the loop.  The codes are given below
>>
>> Thanks,
>> Bhaskar Mitra
>> NAU
>>
>> #_------------------------------------------------------------------
>>
>>
>> library(ncdf4)
>> library(reshape2)
>> library(dplyr)
>> library(stringr)
>>
>>
>> setwd("directory path")
>>
>> Output <- "directory path"
>>
>> flist <- list.files(path ="NCFiles/", pattern = "^.*\\.(nc|NC|Nc|Nc)$")
>>
>> for (i in 1: length(flist))
>> {
>>
>>   nc <- nc_open(paste0("NCFiles/",flist[i]))
>>   mean1 <- ncvar_get(nc,attributes(nc$dim)$names[3])
>>   nc_close(nc)
>>
>>   mean_chl_df <- melt(mean1)
>>   trial.table.df <-as.data.frame(mean_chl_df)
>>
>>
>> write.csv(trial.table.df,paste0(Output,"/",tools::file_path_sans_ext(flist[i]),".csv"))
>>
>> }
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>
> --
> Ben Tupper
> Bigelow Laboratory for Ocean Science
> East Boothbay, Maine
> http://www.bigelow.org/
> https://eco.bigelow.org
>
>

	[[alternative HTML version deleted]]


From vrg@||@no @end|ng |rom gm@||@com  Tue Mar 24 09:43:47 2020
From: vrg@||@no @end|ng |rom gm@||@com (Victor F. Rodriguez Galiano)
Date: Tue, 24 Mar 2020 09:43:47 +0100
Subject: [R-sig-Geo] issue when opening raster image in R,
 the pixel values a rescaled somehow
In-Reply-To: <DM6PR02MB5690689BB1230DA7821BE3C5A3F00@DM6PR02MB5690.namprd02.prod.outlook.com>
References: <DM6PR02MB5690689BB1230DA7821BE3C5A3F00@DM6PR02MB5690.namprd02.prod.outlook.com>
Message-ID: <CAG=LYAZYBrbBgi1m8UibhWt9R3Fg=_aOiJifxyk+z3HU5qgrtw@mail.gmail.com>

Hi Roger, the link to he image is given below. This image was generated
from a .hdf file using the function gdal_translate.

gdal_translate(sds[1], dst_dataset=paste0(substr(filename, 1,
nchar(filename)-4) ,".tif", ))

https://wetransfer.com/downloads/4569e9a85c02faad5016b83d0b50217820200324084015/f2eafdfafaae74de9ac8e25017fc5cc520200324084015/e46e80


Thanks

Victor

El lun., 23 mar. 2020 a las 21:07, Roger Bivand (<Roger.Bivand at nhh.no>)
escribi?:

> Please make the file in question available for download (url), or the url
> you downloaded it from (no login), on this list. It looks as though the
> unsigned 16 bit integer is not right.
>
> Roger Bivand
> Norwegian School of Economics
> Bergen, Norway
>
> ------------------------------
> *Fra:* R-sig-Geo <r-sig-geo-bounces at r-project.org> p? vegne av Victor F.
> Rodriguez Galiano <vrgaliano at gmail.com>
> *Sendt:* mandag 23. mars 2020, 21.02
> *Til:* r-sig-geo at r-project.org
> *Emne:* [R-sig-Geo] issue when opening raster image in R, the pixel
> values a rescaled somehow
>
> I opened a Geotiff image in R using the raster function. However, the
> image seems to be rescaled. The minimum and maximum values should be 13607
> and 15461 but are 275 and 305. The Geotiff image when opened in a GIS is
> correct but not in R. This is my code: Script: library(raster)
> trial<-raster("MOD11A2.A2000049.h17v05.006.2015058135048.tif", datatype =
> "INT2U") trial plot(trial) [[alternative HTML version deleted]]
> _______________________________________________ R-sig-Geo mailing list
> R-sig-Geo at r-project.org https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From Roger@B|v@nd @end|ng |rom nhh@no  Tue Mar 24 09:47:31 2020
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Tue, 24 Mar 2020 09:47:31 +0100
Subject: [R-sig-Geo] issue when opening raster image in R,
 the pixel values a rescaled somehow
In-Reply-To: <CAG=LYAZYBrbBgi1m8UibhWt9R3Fg=_aOiJifxyk+z3HU5qgrtw@mail.gmail.com>
References: <DM6PR02MB5690689BB1230DA7821BE3C5A3F00@DM6PR02MB5690.namprd02.prod.outlook.com>
 <CAG=LYAZYBrbBgi1m8UibhWt9R3Fg=_aOiJifxyk+z3HU5qgrtw@mail.gmail.com>
Message-ID: <alpine.LFD.2.21.2003240945220.3149405@reclus.nhh.no>

Please put the original file on the link too, so that we can track where 
the misconfiguration occurs, and provide more of the workflow code. I 
think we'll also need sessionInfo() output and GDAL version, both as seen 
by gdalUtils, raster and rgdal.

Roger

On Tue, 24 Mar 2020, Victor F. Rodriguez Galiano wrote:

> Hi Roger, the link to he image is given below. This image was generated
> from a .hdf file using the function gdal_translate.
>
> gdal_translate(sds[1], dst_dataset=paste0(substr(filename, 1,
> nchar(filename)-4) ,".tif", ))
>
> https://wetransfer.com/downloads/4569e9a85c02faad5016b83d0b50217820200324084015/f2eafdfafaae74de9ac8e25017fc5cc520200324084015/e46e80
>
>
> Thanks
>
> Victor
>
> El lun., 23 mar. 2020 a las 21:07, Roger Bivand (<Roger.Bivand at nhh.no>)
> escribi?:
>
>> Please make the file in question available for download (url), or the url
>> you downloaded it from (no login), on this list. It looks as though the
>> unsigned 16 bit integer is not right.
>>
>> Roger Bivand
>> Norwegian School of Economics
>> Bergen, Norway
>>
>> ------------------------------
>> *Fra:* R-sig-Geo <r-sig-geo-bounces at r-project.org> p? vegne av Victor F.
>> Rodriguez Galiano <vrgaliano at gmail.com>
>> *Sendt:* mandag 23. mars 2020, 21.02
>> *Til:* r-sig-geo at r-project.org
>> *Emne:* [R-sig-Geo] issue when opening raster image in R, the pixel
>> values a rescaled somehow
>>
>> I opened a Geotiff image in R using the raster function. However, the
>> image seems to be rescaled. The minimum and maximum values should be 13607
>> and 15461 but are 275 and 305. The Geotiff image when opened in a GIS is
>> correct but not in R. This is my code: Script: library(raster)
>> trial<-raster("MOD11A2.A2000049.h17v05.006.2015058135048.tif", datatype =
>> "INT2U") trial plot(trial) [[alternative HTML version deleted]]
>> _______________________________________________ R-sig-Geo mailing list
>> R-sig-Geo at r-project.org https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

From Roger@B|v@nd @end|ng |rom nhh@no  Tue Mar 24 10:28:24 2020
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Tue, 24 Mar 2020 10:28:24 +0100
Subject: [R-sig-Geo] issue when opening raster image in R,
 the pixel values a rescaled somehow
In-Reply-To: <CAG=LYAZYBrbBgi1m8UibhWt9R3Fg=_aOiJifxyk+z3HU5qgrtw@mail.gmail.com>
References: <DM6PR02MB5690689BB1230DA7821BE3C5A3F00@DM6PR02MB5690.namprd02.prod.outlook.com>
 <CAG=LYAZYBrbBgi1m8UibhWt9R3Fg=_aOiJifxyk+z3HU5qgrtw@mail.gmail.com>
Message-ID: <alpine.LFD.2.21.2003241013100.3149405@reclus.nhh.no>

Opening in stars shows that the read data are interpreted as degrees 
Kelvin:

> library(stars)
> ss <- read_stars("MOD11A2.A2000049.h17v05.006.2015058135048.tif")
> print(ss, n=1e8)
stars object with 2 dimensions and 1 attribute
attribute(s):
  MOD11A2.A2000049.h17v05.006.2015058135048.tif [K]
  Min.   :272.1
  1st Qu.:293.3
  Median :296.5
  Mean   :296.1
  3rd Qu.:298.8
  Max.   :309.2
  NA's   :926190
dimension(s):
   from   to   offset    delta  refsys point values
x    1 1200 -1111951  926.625 unnamed FALSE   NULL [x]
y    1 1200  4447802 -926.625 unnamed FALSE   NULL [y]

The summary agrees with

> library(rgdal)
> o <- readGDAL("MOD11A2.A2000049.h17v05.006.2015058135048.tif")
> summary(o)
Object of class SpatialGridDataFrame
Coordinates:
        min     max
x -1111951       0
y  3335852 4447802
Is projected: TRUE
proj4string :
[+proj=sinu +lon_0=0 +x_0=0 +y_0=0 +R=6371007.181 +units=m +no_defs]
Grid attributes:
   cellcentre.offset cellsize cells.dim
x          -1111487 926.6254      1200
y           3336315 926.6254      1200
Data attributes:
      band1
  Min.   :272.1
  1st Qu.:293.3
  Median :296.5
  Mean   :296.1
  3rd Qu.:298.8
  Max.   :309.2
  NA's   :926190

and

> library(raster)
> r <- raster("MOD11A2.A2000049.h17v05.006.2015058135048.tif")
> summary(values(r))
    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's
   272.1   293.3   296.5   296.1   298.8   309.2  926190

So my feeling is that the representation is correct in degrees Kelvin.

Others please join in, I'm not familiar with MODIS HDF data. I think 
something gives the metadata in the GeoTIFF the wrong data bounds - they 
do seem to be UInt16. The output of gdalinfo (command line) includes:

...
   units=K
   valid_range=7500, 65535
...
Band 1 Block=1200x3 Type=UInt16, ColorInterp=Gray
   NoData Value=0
   Unit Type: K
...

Roger


On Tue, 24 Mar 2020, Victor F. Rodriguez Galiano wrote:

> Hi Roger, the link to he image is given below. This image was generated
> from a .hdf file using the function gdal_translate.
>
> gdal_translate(sds[1], dst_dataset=paste0(substr(filename, 1,
> nchar(filename)-4) ,".tif", ))
>
> https://wetransfer.com/downloads/4569e9a85c02faad5016b83d0b50217820200324084015/f2eafdfafaae74de9ac8e25017fc5cc520200324084015/e46e80
>
>
> Thanks
>
> Victor
>
> El lun., 23 mar. 2020 a las 21:07, Roger Bivand (<Roger.Bivand at nhh.no>)
> escribi?:
>
>> Please make the file in question available for download (url), or the url
>> you downloaded it from (no login), on this list. It looks as though the
>> unsigned 16 bit integer is not right.
>>
>> Roger Bivand
>> Norwegian School of Economics
>> Bergen, Norway
>>
>> ------------------------------
>> *Fra:* R-sig-Geo <r-sig-geo-bounces at r-project.org> p? vegne av Victor F.
>> Rodriguez Galiano <vrgaliano at gmail.com>
>> *Sendt:* mandag 23. mars 2020, 21.02
>> *Til:* r-sig-geo at r-project.org
>> *Emne:* [R-sig-Geo] issue when opening raster image in R, the pixel
>> values a rescaled somehow
>>
>> I opened a Geotiff image in R using the raster function. However, the
>> image seems to be rescaled. The minimum and maximum values should be 13607
>> and 15461 but are 275 and 305. The Geotiff image when opened in a GIS is
>> correct but not in R. This is my code: Script: library(raster)
>> trial<-raster("MOD11A2.A2000049.h17v05.006.2015058135048.tif", datatype =
>> "INT2U") trial plot(trial) [[alternative HTML version deleted]]
>> _______________________________________________ R-sig-Geo mailing list
>> R-sig-Geo at r-project.org https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

From Roger@B|v@nd @end|ng |rom nhh@no  Tue Mar 24 10:41:45 2020
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Tue, 24 Mar 2020 10:41:45 +0100
Subject: [R-sig-Geo] issue when opening raster image in R,
 the pixel values a rescaled somehow
In-Reply-To: <alpine.LFD.2.21.2003241013100.3149405@reclus.nhh.no>
References: <DM6PR02MB5690689BB1230DA7821BE3C5A3F00@DM6PR02MB5690.namprd02.prod.outlook.com>
 <CAG=LYAZYBrbBgi1m8UibhWt9R3Fg=_aOiJifxyk+z3HU5qgrtw@mail.gmail.com>
 <alpine.LFD.2.21.2003241013100.3149405@reclus.nhh.no>
Message-ID: <alpine.LFD.2.21.2003241036570.3149405@reclus.nhh.no>

On Tue, 24 Mar 2020, Roger Bivand wrote:

> Opening in stars shows that the read data are interpreted as degrees Kelvin:
>
>>  library(stars)
>>  ss <- read_stars("MOD11A2.A2000049.h17v05.006.2015058135048.tif")
>>  print(ss, n=1e8)
> stars object with 2 dimensions and 1 attribute
> attribute(s):
>  MOD11A2.A2000049.h17v05.006.2015058135048.tif [K]
>  Min.   :272.1
>  1st Qu.:293.3
>  Median :296.5
>  Mean   :296.1
>  3rd Qu.:298.8
>  Max.   :309.2
>  NA's   :926190
> dimension(s):
>  from   to   offset    delta  refsys point values
> x    1 1200 -1111951  926.625 unnamed FALSE   NULL [x]
> y    1 1200  4447802 -926.625 unnamed FALSE   NULL [y]
>
> The summary agrees with
>
>>  library(rgdal)
>>  o <- readGDAL("MOD11A2.A2000049.h17v05.006.2015058135048.tif")
>>  summary(o)
> Object of class SpatialGridDataFrame
> Coordinates:
>       min     max
> x -1111951       0
> y  3335852 4447802
> Is projected: TRUE
> proj4string :
> [+proj=sinu +lon_0=0 +x_0=0 +y_0=0 +R=6371007.181 +units=m +no_defs]
> Grid attributes:
>  cellcentre.offset cellsize cells.dim
> x          -1111487 926.6254      1200
> y           3336315 926.6254      1200
> Data attributes:
>      band1
>  Min.   :272.1
>  1st Qu.:293.3
>  Median :296.5
>  Mean   :296.1
>  3rd Qu.:298.8
>  Max.   :309.2
>  NA's   :926190
>
> and
>
>>  library(raster)
>>  r <- raster("MOD11A2.A2000049.h17v05.006.2015058135048.tif")
>>  summary(values(r))
>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's
>   272.1   293.3   296.5   296.1   298.8   309.2  926190
>
> So my feeling is that the representation is correct in degrees Kelvin.
>
> Others please join in, I'm not familiar with MODIS HDF data. I think 
> something gives the metadata in the GeoTIFF the wrong data bounds - they do 
> seem to be UInt16. The output of gdalinfo (command line) includes:
>
> ...
>   units=K
>   valid_range=7500, 65535
> ...
> Band 1 Block=1200x3 Type=UInt16, ColorInterp=Gray
>   NoData Value=0
>   Unit Type: K
> ...

I missed the next line with the scale in it:

$gdalinfo -stats MOD11A2.A2000049.h17v05.006.2015058135048.tif
...
Band 1 Block=1200x3 Type=UInt16, ColorInterp=Gray
   Minimum=13607.000, Maximum=15461.000, Mean=14804.047, StdDev=191.673
   NoData Value=0
   Unit Type: K
   Offset: 0,   Scale:0.02
   Metadata:
     DESCRIPTION=8-day daytime 1km grid Land-surface Temperature
     STATISTICS_MAXIMUM=15461
     STATISTICS_MEAN=14804.046793562
     STATISTICS_MINIMUM=13607
     STATISTICS_STDDEV=191.67312038983
     STATISTICS_VALID_PERCENT=35.68

and 13607*0.02 = 272.14, 15461*0.02 = 309.22, so GDAL and the R interfaces 
are using the scale factor to read the data as degrees Kelvin. Divide by 
the scale factor if you need the input values.

Roger

>
> Roger
>
>
> On Tue, 24 Mar 2020, Victor F. Rodriguez Galiano wrote:
>
>>  Hi Roger, the link to he image is given below. This image was generated
>>  from a .hdf file using the function gdal_translate.
>>
>>  gdal_translate(sds[1], dst_dataset=paste0(substr(filename, 1,
>>  nchar(filename)-4) ,".tif", ))
>>
>>  https://wetransfer.com/downloads/4569e9a85c02faad5016b83d0b50217820200324084015/f2eafdfafaae74de9ac8e25017fc5cc520200324084015/e46e80
>> 
>>
>>  Thanks
>>
>>  Victor
>>
>>  El lun., 23 mar. 2020 a las 21:07, Roger Bivand (<Roger.Bivand at nhh.no>)
>>  escribi?:
>>
>>>  Please make the file in question available for download (url), or the
>>>  url
>>>  you downloaded it from (no login), on this list. It looks as though the
>>>  unsigned 16 bit integer is not right.
>>>
>>>  Roger Bivand
>>>  Norwegian School of Economics
>>>  Bergen, Norway
>>>
>>>  ------------------------------
>>>  *Fra:* R-sig-Geo <r-sig-geo-bounces at r-project.org> p? vegne av Victor F.
>>>  Rodriguez Galiano <vrgaliano at gmail.com>
>>>  *Sendt:* mandag 23. mars 2020, 21.02
>>>  *Til:* r-sig-geo at r-project.org
>>>  *Emne:* [R-sig-Geo] issue when opening raster image in R, the pixel
>>>  values a rescaled somehow
>>>
>>>  I opened a Geotiff image in R using the raster function. However, the
>>>  image seems to be rescaled. The minimum and maximum values should be
>>>  13607
>>>  and 15461 but are 275 and 305. The Geotiff image when opened in a GIS is
>>>  correct but not in R. This is my code: Script: library(raster)
>>>  trial<-raster("MOD11A2.A2000049.h17v05.006.2015058135048.tif", datatype
>>>  =
>>>  "INT2U") trial plot(trial) [[alternative HTML version deleted]]
>>>  _______________________________________________ R-sig-Geo mailing list
>>>  R-sig-Geo at r-project.org https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>> 
>> 
>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

From edzer@pebe@m@ @end|ng |rom un|-muen@ter@de  Tue Mar 24 10:42:40 2020
From: edzer@pebe@m@ @end|ng |rom un|-muen@ter@de (Edzer Pebesma)
Date: Tue, 24 Mar 2020 10:42:40 +0100
Subject: [R-sig-Geo] issue when opening raster image in R,
 the pixel values a rescaled somehow
In-Reply-To: <alpine.LFD.2.21.2003241013100.3149405@reclus.nhh.no>
References: <DM6PR02MB5690689BB1230DA7821BE3C5A3F00@DM6PR02MB5690.namprd02.prod.outlook.com>
 <CAG=LYAZYBrbBgi1m8UibhWt9R3Fg=_aOiJifxyk+z3HU5qgrtw@mail.gmail.com>
 <alpine.LFD.2.21.2003241013100.3149405@reclus.nhh.no>
Message-ID: <598ef38a-b58c-a8cc-d320-4ee9a1cdcef7@uni-muenster.de>

I see at the end of the output obtained with running gdalinfo on the file:

Band 1 Block=1200x3 Type=UInt16, ColorInterp=Gray
  NoData Value=0
  Unit Type: K
  Offset: 0,   Scale:0.02
  Metadata:
    DESCRIPTION=8-day daytime 1km grid Land-surface Temperature

This means that Kelving values are obtained by computing

0 (offset) + 0.02 (scale) * pixel_value

packages stars and readGDAL do this transformation for you, so you get
actual Kelvin values, and represent them with doubles so there is no
rounding problem. Other, lower level tools may give you INT2 values
where you need to take care of the offset & scale yourself.

On 3/24/20 10:28 AM, Roger Bivand wrote:
> Opening in stars shows that the read data are interpreted as degrees
> Kelvin:
> 
>> library(stars)
>> ss <- read_stars("MOD11A2.A2000049.h17v05.006.2015058135048.tif")
>> print(ss, n=1e8)
> stars object with 2 dimensions and 1 attribute
> attribute(s):
> ?MOD11A2.A2000049.h17v05.006.2015058135048.tif [K]
> ?Min.?? :272.1
> ?1st Qu.:293.3
> ?Median :296.5
> ?Mean?? :296.1
> ?3rd Qu.:298.8
> ?Max.?? :309.2
> ?NA's?? :926190
> dimension(s):
> ? from?? to?? offset??? delta? refsys point values
> x??? 1 1200 -1111951? 926.625 unnamed FALSE?? NULL [x]
> y??? 1 1200? 4447802 -926.625 unnamed FALSE?? NULL [y]
> 
> The summary agrees with
> 
>> library(rgdal)
>> o <- readGDAL("MOD11A2.A2000049.h17v05.006.2015058135048.tif")
>> summary(o)
> Object of class SpatialGridDataFrame
> Coordinates:
> ?????? min???? max
> x -1111951?????? 0
> y? 3335852 4447802
> Is projected: TRUE
> proj4string :
> [+proj=sinu +lon_0=0 +x_0=0 +y_0=0 +R=6371007.181 +units=m +no_defs]
> Grid attributes:
> ? cellcentre.offset cellsize cells.dim
> x????????? -1111487 926.6254????? 1200
> y?????????? 3336315 926.6254????? 1200
> Data attributes:
> ???? band1
> ?Min.?? :272.1
> ?1st Qu.:293.3
> ?Median :296.5
> ?Mean?? :296.1
> ?3rd Qu.:298.8
> ?Max.?? :309.2
> ?NA's?? :926190
> 
> and
> 
>> library(raster)
>> r <- raster("MOD11A2.A2000049.h17v05.006.2015058135048.tif")
>> summary(values(r))
> ?? Min. 1st Qu.? Median??? Mean 3rd Qu.??? Max.??? NA's
> ? 272.1?? 293.3?? 296.5?? 296.1?? 298.8?? 309.2? 926190
> 
> So my feeling is that the representation is correct in degrees Kelvin.
> 
> Others please join in, I'm not familiar with MODIS HDF data. I think
> something gives the metadata in the GeoTIFF the wrong data bounds - they
> do seem to be UInt16. The output of gdalinfo (command line) includes:
> 
> ...
> ? units=K
> ? valid_range=7500, 65535
> ...
> Band 1 Block=1200x3 Type=UInt16, ColorInterp=Gray
> ? NoData Value=0
> ? Unit Type: K
> ...
> 
> Roger
> 
> 
> On Tue, 24 Mar 2020, Victor F. Rodriguez Galiano wrote:
> 
>> Hi Roger, the link to he image is given below. This image was generated
>> from a .hdf file using the function gdal_translate.
>>
>> gdal_translate(sds[1], dst_dataset=paste0(substr(filename, 1,
>> nchar(filename)-4) ,".tif", ))
>>
>> https://wetransfer.com/downloads/4569e9a85c02faad5016b83d0b50217820200324084015/f2eafdfafaae74de9ac8e25017fc5cc520200324084015/e46e80
>>
>>
>>
>> Thanks
>>
>> Victor
>>
>> El lun., 23 mar. 2020 a las 21:07, Roger Bivand (<Roger.Bivand at nhh.no>)
>> escribi?:
>>
>>> Please make the file in question available for download (url), or the
>>> url
>>> you downloaded it from (no login), on this list. It looks as though the
>>> unsigned 16 bit integer is not right.
>>>
>>> Roger Bivand
>>> Norwegian School of Economics
>>> Bergen, Norway
>>>
>>> ------------------------------
>>> *Fra:* R-sig-Geo <r-sig-geo-bounces at r-project.org> p? vegne av Victor F.
>>> Rodriguez Galiano <vrgaliano at gmail.com>
>>> *Sendt:* mandag 23. mars 2020, 21.02
>>> *Til:* r-sig-geo at r-project.org
>>> *Emne:* [R-sig-Geo] issue when opening raster image in R, the pixel
>>> values a rescaled somehow
>>>
>>> I opened a Geotiff image in R using the raster function. However, the
>>> image seems to be rescaled. The minimum and maximum values should be
>>> 13607
>>> and 15461 but are 275 and 305. The Geotiff image when opened in a GIS is
>>> correct but not in R. This is my code: Script: library(raster)
>>> trial<-raster("MOD11A2.A2000049.h17v05.006.2015058135048.tif",
>>> datatype =
>>> "INT2U") trial plot(trial) [[alternative HTML version deleted]]
>>> _______________________________________________ R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
> 
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics
Heisenbergstrasse 2, 48149 Muenster, Germany
Phone: +49 251 8333081

-------------- next part --------------
A non-text attachment was scrubbed...
Name: pEpkey.asc
Type: application/pgp-keys
Size: 3110 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20200324/7b7c1c4b/attachment.bin>

From edzer@pebe@m@ @end|ng |rom un|-muen@ter@de  Tue Mar 24 15:58:57 2020
From: edzer@pebe@m@ @end|ng |rom un|-muen@ter@de (Edzer Pebesma)
Date: Tue, 24 Mar 2020 15:58:57 +0100
Subject: [R-sig-Geo] Convert rectilinear to regular grid in R (stars and
 raster)
In-Reply-To: <CAL+ycWmLeAz-x+TkZcPgUEmmqnE0NB3wBUPk7gGdt5wpG70jcg@mail.gmail.com>
References: <CAL+ycWmLeAz-x+TkZcPgUEmmqnE0NB3wBUPk7gGdt5wpG70jcg@mail.gmail.com>
Message-ID: <40b2112d-e781-b7e9-6f64-96b93b13045f@uni-muenster.de>

The stars part of this question has also been sent as an issue on
github, and that is where it has been answered (partially solved):

https://github.com/r-spatial/stars/issues/264

please feel free to send follow-up's here, or there.

On 3/23/20 6:45 PM, Frederico Faleiro wrote:
> Dear all,
> 
> I am trying convert netCDF data from rectilinear to regular grid in R, but
> I am not sure what is the best approach for it.
> I would like to convert the grid modifying the original resolution only
> when necessary. In some cases I must change resolution to keep regular cell
> size and cover all the world extent.
> I have tried without success st_warp from stars and I find a way with
> rasterize from raster package (see script bellow).
> 
> I have the following questions:
> 1. What am I doing wrong in stars package (see script bellow)?
> 2. Is there a way to rasterize points to raster using metrics that consider
> distance (e.g. bilinear, nearest neighbor, etc)? Note that I need
> use points in raster package because it do not handle with rectilinear grid.
> 3. Do you recommend any other approach?
> 
> The data are available in:
> GDrive:
> https://drive.google.com/file/d/1HKxFpAwvY9k_cFbasagKHAwi1luzLv90/view?usp=sharing
> CMIP5 portal (you must make a login):
> http://aims3.llnl.gov/thredds/fileServer/cmip5_css01_data/cmip5/output1/BCC/bcc-csm1-1/rcp45/mon/atmos/Amon/r1i1p1/v20120705/pr/pr_Amon_bcc-csm1-1_rcp45_r1i1p1_200601-209912.nc
> 
> # script
> library(stars)
> library(raster)
> 
> # prepare data
> bc <- read_ncdf("pr_Amon_bcc-csm1-1_rcp45_r1i1p1_200601-209912.nc")
> # get coordinates and data from the first time period
> bc1 <- as.data.frame(bc[, , , 1])
> # convert longitude to variate between -180 and 180
> bc1$lon <- ifelse(bc1$lon > 180, bc1$lon - 360, bc1$lon)
> 
> # original resolution
> bc1$lon %>% diff %>% table
> bc1$lat %>% diff %>% table
> # new resolution
> new_res <- c(2.8125, 2.8125)
> # Is it multiple of 180 or 360?
> 180 %% new_res
> 
> # create a new standard grid
> wgs84 <- "+proj=longlat +ellps=WGS84 +towgs84=0,0,0,0,0,0,0 +no_defs"
> grid_r <- raster(res = new_res, crs = wgs84)
> grid_st <- st_as_stars(grid_r)
> 
> # change from rectilinear to regular grid
> # stars package: use st_warp to change from rectilinear to regular raster
> with different methods
> bc_reg <- bc %>% st_warp(grid_st, method = "average")
> bc_reg <- bc %>% st_warp(grid_st, method = "near")
> bc_reg <- bc %>% st_warp(grid_st, method = "bilinear")
> # In all cases I have this error: Error in 1:prod(dims[dxy]) : NA/NaN
> argument
> 
> # raster package: rasterize the points values to the new regular grid
> bc1_sp <- bc1
> coordinates(bc1_sp) <- ~ lon + lat
> bc1_reg <- rasterize(bc1_sp, grid_r, field = "pr", fun = mean)
> 
> # plot the first time period
> dev.new(title = "rectilinear")
> plot(bc[, , , 1])
> dev.new(title = "regular with raster package")
> plot(bc1_mn_reg)
> 
> Best regards,
> 
> Frederico Faleiro
> Postdoctoral Researcher in the INCT-EECBio (https://www.eecbio.ufg.br/)
> Federal University of Goi?s | Brazil
> RG: https://www.researchgate.net/profile/Frederico_Faleiro
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics
Heisenbergstrasse 2, 48149 Muenster, Germany
Phone: +49 251 8333081

-------------- next part --------------
A non-text attachment was scrubbed...
Name: pEpkey.asc
Type: application/pgp-keys
Size: 3110 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20200324/c58f7c25/attachment.bin>

From |v|@|e|ro @end|ng |rom gm@||@com  Wed Mar 25 00:37:12 2020
From: |v|@|e|ro @end|ng |rom gm@||@com (Frederico Faleiro)
Date: Tue, 24 Mar 2020 20:37:12 -0300
Subject: [R-sig-Geo] Convert rectilinear to regular grid in R (stars and
 raster)
In-Reply-To: <40b2112d-e781-b7e9-6f64-96b93b13045f@uni-muenster.de>
References: <CAL+ycWmLeAz-x+TkZcPgUEmmqnE0NB3wBUPk7gGdt5wpG70jcg@mail.gmail.com>
 <40b2112d-e781-b7e9-6f64-96b93b13045f@uni-muenster.de>
Message-ID: <CAL+ycWmdD7ZEjuEg8U3w65W4S9Xufu1BmPhuDxpj3qCaZw3+Lw@mail.gmail.com>

Hi Edzer,

thank you for your reply and modifications in the function.
Now the code is working fine, but the structure of the output was changed.
When I try extract the values converting to data.frame all values was
replaced by NA. However the plot is OK as you have tested.

1. How can I create a new grid with the new resolution in stars? Am I doing
it correctly (see bellow)?
2. How can I get the data.frame with the new values?
3. I have tried the function sf::st_interpolate_aw (see bellow), but there
is some warnings that I do not know the consequences for the calculation.

# update packages
library(devtools)
install_github("r-spatial/sf")
install_github("r-spatial/stars")

library(stars)

# read file
bc <- read_ncdf("pr_Amon_bcc-csm1-1_rcp45_r1i1p1_200601-209912.nc")
# create the new grid
grid_st <- st_as_stars(st_bbox(c(xmin=0,xmax=360,ymin=-90,ymax=90))) %>%
st_set_crs(4326)
# change resolution. Is it right?
attr(grid_st, "dimensions")[[1]]$delta <- 2.8125
attr(grid_st, "dimensions")[[2]]$delta <- - 2.8125

# change from rectilinear to regular grid with stars
bc_reg <- bc %>% st_warp(grid_st, method = "near")
# plot
plot(bc_reg[, , , 1:12])

# convert to data.frame
bc_reg_df <- as.data.frame(bc_reg_st)
# there is only NA in the variable
str(bc_reg_df)
range(bc_reg_df$pr)

# change from rectilinear to regular grid with sf
grid_sf <- st_as_sf(grid_st)
plot(grid_sf)
bc_sf <- st_as_sf(bc)
plot(bc_sf)
bc_sf_reg <- st_interpolate_aw(bc_sf, grid_sf, F)
#although coordinates are longitude/latitude, st_intersection assumes that
they are planar
#Warning message:
#In st_interpolate_aw.sf(bc_sf, grid_sf, F) :
#  st_interpolate_aw assumes attributes are constant over areas of x

Best regards,
Frederico Faleiro
Postdoctoral Researcher in the INCT-EECBio (https://www.eecbio.ufg.br/)
Federal University of Goi?s | Brazil
RG: https://www.researchgate.net/profile/Frederico_Faleiro


Em ter., 24 de mar. de 2020 ?s 11:59, Edzer Pebesma <
edzer.pebesma at uni-muenster.de> escreveu:

> The stars part of this question has also been sent as an issue on
> github, and that is where it has been answered (partially solved):
>
> https://github.com/r-spatial/stars/issues/264
>
> please feel free to send follow-up's here, or there.
>
> On 3/23/20 6:45 PM, Frederico Faleiro wrote:
> > Dear all,
> >
> > I am trying convert netCDF data from rectilinear to regular grid in R,
> but
> > I am not sure what is the best approach for it.
> > I would like to convert the grid modifying the original resolution only
> > when necessary. In some cases I must change resolution to keep regular
> cell
> > size and cover all the world extent.
> > I have tried without success st_warp from stars and I find a way with
> > rasterize from raster package (see script bellow).
> >
> > I have the following questions:
> > 1. What am I doing wrong in stars package (see script bellow)?
> > 2. Is there a way to rasterize points to raster using metrics that
> consider
> > distance (e.g. bilinear, nearest neighbor, etc)? Note that I need
> > use points in raster package because it do not handle with rectilinear
> grid.
> > 3. Do you recommend any other approach?
> >
> > The data are available in:
> > GDrive:
> >
> https://drive.google.com/file/d/1HKxFpAwvY9k_cFbasagKHAwi1luzLv90/view?usp=sharing
> > CMIP5 portal (you must make a login):
> >
> http://aims3.llnl.gov/thredds/fileServer/cmip5_css01_data/cmip5/output1/BCC/bcc-csm1-1/rcp45/mon/atmos/Amon/r1i1p1/v20120705/pr/pr_Amon_bcc-csm1-1_rcp45_r1i1p1_200601-209912.nc
> >
> > # script
> > library(stars)
> > library(raster)
> >
> > # prepare data
> > bc <- read_ncdf("pr_Amon_bcc-csm1-1_rcp45_r1i1p1_200601-209912.nc")
> > # get coordinates and data from the first time period
> > bc1 <- as.data.frame(bc[, , , 1])
> > # convert longitude to variate between -180 and 180
> > bc1$lon <- ifelse(bc1$lon > 180, bc1$lon - 360, bc1$lon)
> >
> > # original resolution
> > bc1$lon %>% diff %>% table
> > bc1$lat %>% diff %>% table
> > # new resolution
> > new_res <- c(2.8125, 2.8125)
> > # Is it multiple of 180 or 360?
> > 180 %% new_res
> >
> > # create a new standard grid
> > wgs84 <- "+proj=longlat +ellps=WGS84 +towgs84=0,0,0,0,0,0,0 +no_defs"
> > grid_r <- raster(res = new_res, crs = wgs84)
> > grid_st <- st_as_stars(grid_r)
> >
> > # change from rectilinear to regular grid
> > # stars package: use st_warp to change from rectilinear to regular raster
> > with different methods
> > bc_reg <- bc %>% st_warp(grid_st, method = "average")
> > bc_reg <- bc %>% st_warp(grid_st, method = "near")
> > bc_reg <- bc %>% st_warp(grid_st, method = "bilinear")
> > # In all cases I have this error: Error in 1:prod(dims[dxy]) : NA/NaN
> > argument
> >
> > # raster package: rasterize the points values to the new regular grid
> > bc1_sp <- bc1
> > coordinates(bc1_sp) <- ~ lon + lat
> > bc1_reg <- rasterize(bc1_sp, grid_r, field = "pr", fun = mean)
> >
> > # plot the first time period
> > dev.new(title = "rectilinear")
> > plot(bc[, , , 1])
> > dev.new(title = "regular with raster package")
> > plot(bc1_mn_reg)
> >
> > Best regards,
> >
> > Frederico Faleiro
> > Postdoctoral Researcher in the INCT-EECBio (https://www.eecbio.ufg.br/)
> > Federal University of Goi?s | Brazil
> > RG: https://www.researchgate.net/profile/Frederico_Faleiro
> >
> >       [[alternative HTML version deleted]]
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
>
> --
> Edzer Pebesma
> Institute for Geoinformatics
> Heisenbergstrasse 2, 48149 Muenster, Germany
> Phone: +49 251 8333081
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From Roger@B|v@nd @end|ng |rom nhh@no  Wed Mar 25 09:15:36 2020
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Wed, 25 Mar 2020 09:15:36 +0100
Subject: [R-sig-Geo] R spatial follows GDAL and PROJ development
In-Reply-To: <CALrbzg0pnJi-fwVvjxg0d8WoVOEJyh1O2kuFPcUab22DZ46dpg@mail.gmail.com>
References: <alpine.LFD.2.21.2003181410290.2563188@reclus.nhh.no>
 <CALrbzg0pnJi-fwVvjxg0d8WoVOEJyh1O2kuFPcUab22DZ46dpg@mail.gmail.com>
Message-ID: <alpine.LFD.2.21.2003250909080.3946169@reclus.nhh.no>

Thanks to the CRAN team, sf 0.9-0 has been published. Windows and OSX 
binaries should follow before long. Script authors and package 
maintainers using sf should note the changes in this version, which may 
require action - see the blog linked earlier in this thread. See also:

https://twitter.com/edzerpebesma/status/1242550145964806145
https://twitter.com/RogerBivand/status/1242551606505324544

Roger

On Wed, 18 Mar 2020, Ben Tupper wrote:

> This is very helpful - thank you!
>
> On Wed, Mar 18, 2020 at 9:12 AM Roger Bivand <Roger.Bivand at nhh.no> wrote:
>
>> A new blog: "R spatial follows GDAL and PROJ development" has been
>> published: https://www.r-spatial.org/r/2020/03/17/wkt.html.
>>
>> Those maintaining packages using sf or sp/rgdal, and authors of scripts
>> using them should read the blog and be prepared to take rapid action when
>> sf 0.9 is released and built using PROJ >= 6 and GDAL >= 3. An early
>> release of rgdal (>= 1.5, probably 1.6.0, is also to be expected).
>>
>> Roger
>>
>> --
>> Roger Bivand
>> Department of Economics, Norwegian School of Economics,
>> Helleveien 30, N-5045 Bergen, Norway.
>> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
>> https://orcid.org/0000-0003-2392-6140
>> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en


From pk@ge||z@ @end|ng |rom @tudent@@uonb|@@c@ke  Thu Mar 26 15:52:18 2020
From: pk@ge||z@ @end|ng |rom @tudent@@uonb|@@c@ke (PAMELLA KAGELIZA KILAVI)
Date: Thu, 26 Mar 2020 17:52:18 +0300
Subject: [R-sig-Geo] creating a data range for color coding and using it in
 color_manual_scale
Message-ID: <CAEQQd3KSPKXQuWbRPZP_x0Yh1O6pMm8bLSf=k0Jz05wRchCLiw@mail.gmail.com>

 Dear All

I have been able to move one step forward but still haven't been able to
assign the correct color to the levels created

The r-code is as below with the output  in the url
I assigned Blue, green, yellow, orange and red to the different levels.
Unfortunately, the output is not as expected.

#create the five levels
Mrima_levels<-cut(Mrima_sf$dose,breaks=c(0,114,228,570,2293,5144))

#assign color code to the levels
palette=c(Mrima_levels, seecol(pal_signal,n=5))

#Use the five levels and palette created to create a discrete map
ggplot(Mrima, mapping=aes(x=lon,y=lat))+geom_sf(data=Mrima_sf, inherit.aes
= FALSE)+
  geom_point(aes(colour=Mrima_levels),alpha=0.6, size=1)+
  scale_color_manual(values=palette, aesthetics =c("colours", "fill") ,
breaks=waiver())+
ylab("Latitude")+xlab("Longitude")

https://rpubs.com/pkageliza/589877

Kindly assist
Thank you

-- 

The University of Nairobi is ISO 9001:2015 certified.
Website: 
http://www.uonbi.ac.ke/ <http://www.uonbi.ac.ke/>
Facebook: 
https://www.facebook.com/uonbi.ac.ke <https://www.facebook.com/uonbi.ac.ke>

Twitter: @uonbi? https://twitter.com/uonb <https://twitter.com/uonb>

	[[alternative HTML version deleted]]


From n@|m|@b @end|ng |rom gm@||@com  Sun Mar 29 07:07:35 2020
From: n@|m|@b @end|ng |rom gm@||@com (Babak Naimi)
Date: Sun, 29 Mar 2020 08:07:35 +0300
Subject: [R-sig-Geo] Introducing new local spatial statistic, ELSA,
 and Entrogram (a variogram-like graph)
Message-ID: <CAGL-CGASk--Cx7yBMArR6-2gs7-_djwFZbvq+DRNt5wCQtMXDw@mail.gmail.com>

Dear All,

Hope you are safe and well!

I am writing to inform you that the new R package, elsa, is released on
CRAN. This package is a framework that provides the methods for quantifying
the new local spatial statictic, named "entropy-based local indicator of
spatial association" (ELSA), that can be used for both continuous and
categorical data. In addition, global spatial structure can be measured
using a new variogram-like diagram, called entrogram.

The package vignette provides a quick demonstration of some main functions
in the package:

https://cran.r-project.org/web/packages/elsa/vignettes/elsa.html

The paper that introduces ELSA is published in the journal of spatial
statistics and is available here:

https://www.sciencedirect.com/science/article/abs/pii/S2211675318300228

The package, elsa, is also followed with functions to calculate other LISAs
and global statistics for different types of spatial datasets (i.e.,
Raster, SpatialPointsDataFrame, SpatialPolygonsDataFrame).

Best regards,

Babak Naimi






*University Researcher, Department of Geosciences and Geography,The
University of Helsinki,Gustaf H?llstr?min Katu 2, 00014
HelsinkiFinlandHomepage I: http://r-gis.net <http://r-gis.net/>  Homepage
II: http://biogeoinformatics.org <http://biogeoinformatics.org/>  *

	[[alternative HTML version deleted]]


