From uclamathguy at gmail.com  Sun Jul  1 07:54:16 2007
From: uclamathguy at gmail.com (R R R)
Date: Sat, 30 Jun 2007 22:54:16 -0700
Subject: [R-sig-Geo] GWR.sel returning CV of NA, and Runtime
Message-ID: <72fc09510706302254q1f32e8fl596a89d2c282a9d3@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070630/07319073/attachment.pl>

From yud at mail.montclair.edu  Sun Jul  1 18:07:00 2007
From: yud at mail.montclair.edu (Danlin Yu)
Date: Sun, 01 Jul 2007 12:07:00 -0400
Subject: [R-sig-Geo] GWR.sel returning CV of NA, and Runtime
In-Reply-To: <72fc09510706302254q1f32e8fl596a89d2c282a9d3@mail.gmail.com>
References: <72fc09510706302254q1f32e8fl596a89d2c282a9d3@mail.gmail.com>
Message-ID: <4687D124.5070308@mail.montclair.edu>

Ryan:

1. The code you are giving actually doesn't use an adaptive kernel. You 
need to turn the adpt = True parameter on (its default is False), it 
should read like this:

col.d <- gwr.sel
(ResponseTime~IsRural+IsSemiRural,data=sb,coords=cbind(sb$Longitude,sb$Latitude),adapt = True, gweight= gwr.bisquare,longlat=TRUE)


2. Without seeing your data, it's hard to see why an "NA" is returned 
for your CV score, probably there is something wrong with your 
coordinates? Since you mentioned you were using like 19,000 data points, 
and using long. and lat. as coordinates. For 19,000 data points, I 
assume that they are very close to one another in space (in a city?), 
and the long. and lat. are recorded in decimal degrees? If so, one 
probability is that when the coordinates were generated by either R or 
some other program (ArcGIS, maybe?), due to trunctuation of the 
significant decimal points, coordinates for some points that are very 
close to one another might have the same values. This could be a 
problem. Maybe Roger can give more insights?

3. If you don't want to see the results being printed to the screen, you 
need to turn the verbose parameter off (its default is True), hence the 
code will read like this:

col.d <- gwr.sel
(ResponseTime~IsRural+IsSemiRural,data=sb,coords=cbind(sb$Longitude,sb$Latitude),adapt = True, gweight= gwr.bisquare,verbose=False, longlat=TRUE)

4. And yes, gwr is very time comsuming (not only gwr.sel). For 19,000 
data points, even using the cross-validation score method, it'll take a 
very long time even on a high speed machine. If you are using the AIC 
method (which is actually preferred), I am not even sure the code will run.

Hope this helps.

Cheers,
Danlin Yu

R R R wrote:

>Hi,
>
>I am trying to use a spatially adaptive kernel in spgwr and I have some
>questions.
>
>I am using the following code:
>col.d <- gwr.sel
>(ResponseTime~IsRural+IsSemiRural,data=sb,coords=cbind(sb$Longitude,sb$Latitude),gweight=
>gwr.bisquare,longlat=TRUE)
>
>First, I keep getting a CV score of "NA" for each result returned. What does
>this mean? I do not have any missing values in any observations. Also, while
>gwr.sel is running, results are printed to the screen, but what does each
>line of ouput represent? Each regression point?
>
>Finally, is gwr.sel expected to take a very long time to complete? I have
>19,000 data points that I am hoping to use for a GW regression but so far
>only two lines of output have been printed to the screen after about 4
>hours.
>
>I apologize in advance for the naivete of my questions, but I am a newbie
>;-).
>
>Thanks,
>Ryan
>
>	[[alternative HTML version deleted]]
>
>_______________________________________________
>R-sig-Geo mailing list
>R-sig-Geo at stat.math.ethz.ch
>https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>  
>

-- 
___________________________________________
Danlin Yu, Ph.D.
Assistant Professor
Department of Earth & Environmental Studies
Montclair State University
Montclair, NJ, 07043
Tel: 973-655-4313
Fax: 973-655-4072
email: yud at mail.montclair.edu



From uclamathguy at gmail.com  Sun Jul  1 19:05:23 2007
From: uclamathguy at gmail.com (Ryan Rosario)
Date: Sun, 1 Jul 2007 10:05:23 -0700
Subject: [R-sig-Geo] GWR.sel returning CV of NA, and Runtime
In-Reply-To: <4687D124.5070308@mail.montclair.edu>
References: <72fc09510706302254q1f32e8fl596a89d2c282a9d3@mail.gmail.com>
	<4687D124.5070308@mail.montclair.edu>
Message-ID: <72fc09510707011005m2a15085eu2e5e72d30d773b3a@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070701/dfe0fc73/attachment.pl>

From marco.helbich at gmx.at  Tue Jul  3 11:58:24 2007
From: marco.helbich at gmx.at (Marco Helbich)
Date: Tue, 03 Jul 2007 11:58:24 +0200
Subject: [R-sig-Geo] round class intervals in legend
Message-ID: <20070703095824.279480@gmx.net>

Dear list,

I've analysed my dataset with the fanny() cluster analysis function and now I want to visualise the membership values. My question is: how can I round the class interval values printed in the legend (e.g. 3 digits)? The round() function doesn't work within the classIntervals().

Below you can find an fictitious example with the sids dataset:

library(cluster)

xx <- readShapePoly(system.file("shapes/sids.shp", package="maptools")[1], IDvar="FIPSNO", proj4string=CRS("+proj=longlat +ellps=clrk66"))
plot(xx, border="blue", axes=TRUE, las=1)
names(xx)
dat <- cbind(xx$SID74, xx$NWBIR74, xx$BIR79)
fann <- fanny(dat, 3, maxit = 1000)

par(mar=c(0.5,0.5,0.5,0.5))
plotvar <- fann$membership[,1]
nclr <- 6
plotclr <- brewer.pal(nclr, "BuPu")
class <- classIntervals(plotvar, nclr, style = "quantile")
colcode <- findColours(class, plotclr)
plot(xx)
plot(xx, col = colcode, add = T)
legend("topleft", legend=names(attr(colcode, "table")),
    fill=attr(colcode, "palette"), cex = 0.75, bty = "n")

I appreciate every hint! Thanks.

Marco
__________________

Marco Helbich
ISR
Postgasse 7/4/2
A-1010, Vienna

-- 
Ist Ihr Browser Vista-kompatibel? Jetzt die neuesten 
Browser-Versionen downloaden: http://www.gmx.net/de/go/browser



From rbt501 at york.ac.uk  Tue Jul  3 14:13:49 2007
From: rbt501 at york.ac.uk (Taylor, RB)
Date: Tue, 03 Jul 2007 13:13:49 +0100
Subject: [R-sig-Geo] Reading text files in Spatstat
Message-ID: <468A3D7D.1020802@york.ac.uk>

Hello all,

I have x,y data with an associated mark. Is there a simple way of 
getting Spatstat to read this data? I have tried putting the x, y data 
in separate columns in Excel and ignoring the marks, saving it as a 
tab-delim text file (called "test"). However the as.ppp function fails 
to convert it into a ppp object.


 > test <- read.table("C:/temp/Rtest.txt")
 > as.ppp(test)
Error in as.ppp.default(test) : Can't interpret X as a point pattern


Perhaps someone can answer my simple question and tell me what I am 
doing wrong?

Thanks,
Rob
--



From macq at llnl.gov  Tue Jul  3 15:59:52 2007
From: macq at llnl.gov (Don MacQueen)
Date: Tue, 3 Jul 2007 06:59:52 -0700
Subject: [R-sig-Geo] Reading text files in Spatstat
In-Reply-To: <468A3D7D.1020802@york.ac.uk>
References: <468A3D7D.1020802@york.ac.uk>
Message-ID: <p06230901c2b0066386a6@[128.115.153.6]>

The help page for as.ppp() explains that in a case like yours (or 
what I assume is yours from your description), you also need to 
supply the W argument.

Try looking at the help page for the ppp() function.

-Don

At 1:13 PM +0100 7/3/07, Taylor, RB wrote:
>Hello all,
>
>I have x,y data with an associated mark. Is there a simple way of
>getting Spatstat to read this data? I have tried putting the x, y data
>in separate columns in Excel and ignoring the marks, saving it as a
>tab-delim text file (called "test"). However the as.ppp function fails
>to convert it into a ppp object.
>
>
>  > test <- read.table("C:/temp/Rtest.txt")
>  > as.ppp(test)
>Error in as.ppp.default(test) : Can't interpret X as a point pattern
>
>
>Perhaps someone can answer my simple question and tell me what I am
>doing wrong?
>
>Thanks,
>Rob
>--
>
>_______________________________________________
>R-sig-Geo mailing list
>R-sig-Geo at stat.math.ethz.ch
>https://stat.ethz.ch/mailman/listinfo/r-sig-geo


-- 
--------------------------------------
Don MacQueen
Environmental Protection Department
Lawrence Livermore National Laboratory
Livermore, CA, USA
925-423-1062



From rbt501 at york.ac.uk  Tue Jul  3 17:11:00 2007
From: rbt501 at york.ac.uk (Taylor, RB)
Date: Tue, 03 Jul 2007 16:11:00 +0100
Subject: [R-sig-Geo] Reading text files in Spatstat
In-Reply-To: <p06230901c2b0066386a6@[128.115.153.6]>
References: <468A3D7D.1020802@york.ac.uk>
	<p06230901c2b0066386a6@[128.115.153.6]>
Message-ID: <468A6704.90001@york.ac.uk>

Right, I have supplied the W argument now. Still no joy though....

 > as.ppp(test,c(0,10,0,10),fatal=TRUE)
Error in as.ppp.default(test, c(0, 10, 0, 10), fatal = TRUE) :
         Can't interpret X as a point pattern

Any ideas anyone?

Rob

Don MacQueen wrote:
> The help page for as.ppp() explains that in a case like yours (or what I 
> assume is yours from your description), you also need to supply the W 
> argument.
> 
> Try looking at the help page for the ppp() function.
> 
> -Don
> 
> At 1:13 PM +0100 7/3/07, Taylor, RB wrote:
>> Hello all,
>>
>> I have x,y data with an associated mark. Is there a simple way of
>> getting Spatstat to read this data? I have tried putting the x, y data
>> in separate columns in Excel and ignoring the marks, saving it as a
>> tab-delim text file (called "test"). However the as.ppp function fails
>> to convert it into a ppp object.
>>
>>
>>  > test <- read.table("C:/temp/Rtest.txt")
>>  > as.ppp(test)
>> Error in as.ppp.default(test) : Can't interpret X as a point pattern
>>
>>
>> Perhaps someone can answer my simple question and tell me what I am
>> doing wrong?
>>
>> Thanks,
>> Rob
>> -- 
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 
> 

-- 
Rob Taylor

University of York
Biology Department
PO Box 373
York
YO10 5YW
United Kingdom

Work +44 (0)1904 32 8557
Mob  +44 (0)777 258 5390



From Thierry.ONKELINX at inbo.be  Tue Jul  3 17:19:21 2007
From: Thierry.ONKELINX at inbo.be (ONKELINX, Thierry)
Date: Tue, 3 Jul 2007 17:19:21 +0200
Subject: [R-sig-Geo] Reading text files in Spatstat
In-Reply-To: <468A6704.90001@york.ac.uk>
References: <468A3D7D.1020802@york.ac.uk><p06230901c2b0066386a6@[128.115.153.6]>
	<468A6704.90001@york.ac.uk>
Message-ID: <2E9C414912813E4EB981326983E0A104032D9703@inboexch.inbo.be>

The problem is probably in "test". Try to give us a (small) sample of
test so we can reproduce your problem. Otherwise it will be hard to
discover the problem.

Thierry

------------------------------------------------------------------------
----
ir. Thierry Onkelinx
Instituut voor natuur- en bosonderzoek / Research Institute for Nature
and Forest
Cel biometrie, methodologie en kwaliteitszorg / Section biometrics,
methodology and quality assurance
Gaverstraat 4
9500 Geraardsbergen
Belgium
tel. + 32 54/436 185
Thierry.Onkelinx at inbo.be
www.inbo.be 

Do not put your faith in what statistics say until you have carefully
considered what they do not say.  ~William W. Watt
A statistical analysis, properly conducted, is a delicate dissection of
uncertainties, a surgery of suppositions. ~M.J.Moroney

 

> -----Oorspronkelijk bericht-----
> Van: r-sig-geo-bounces at stat.math.ethz.ch 
> [mailto:r-sig-geo-bounces at stat.math.ethz.ch] Namens Taylor, RB
> Verzonden: dinsdag 3 juli 2007 17:11
> Aan: r-sig-geo at stat.math.ethz.ch
> Onderwerp: Re: [R-sig-Geo] Reading text files in Spatstat
> 
> Right, I have supplied the W argument now. Still no joy though....
> 
>  > as.ppp(test,c(0,10,0,10),fatal=TRUE)
> Error in as.ppp.default(test, c(0, 10, 0, 10), fatal = TRUE) :
>          Can't interpret X as a point pattern
> 
> Any ideas anyone?
> 
> Rob
> 
> Don MacQueen wrote:
> > The help page for as.ppp() explains that in a case like 
> yours (or what 
> > I assume is yours from your description), you also need to 
> supply the 
> > W argument.
> > 
> > Try looking at the help page for the ppp() function.
> > 
> > -Don
> > 
> > At 1:13 PM +0100 7/3/07, Taylor, RB wrote:
> >> Hello all,
> >>
> >> I have x,y data with an associated mark. Is there a simple way of 
> >> getting Spatstat to read this data? I have tried putting the x, y 
> >> data in separate columns in Excel and ignoring the marks, 
> saving it 
> >> as a tab-delim text file (called "test"). However the 
> as.ppp function 
> >> fails to convert it into a ppp object.
> >>
> >>
> >>  > test <- read.table("C:/temp/Rtest.txt")  > as.ppp(test) 
> Error in 
> >> as.ppp.default(test) : Can't interpret X as a point pattern
> >>
> >>
> >> Perhaps someone can answer my simple question and tell me 
> what I am 
> >> doing wrong?
> >>
> >> Thanks,
> >> Rob
> >> --
> >>
> >> _______________________________________________
> >> R-sig-Geo mailing list
> >> R-sig-Geo at stat.math.ethz.ch
> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > 
> > 
> 
> --
> Rob Taylor
> 
> University of York
> Biology Department
> PO Box 373
> York
> YO10 5YW
> United Kingdom
> 
> Work +44 (0)1904 32 8557
> Mob  +44 (0)777 258 5390
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



From rbt501 at york.ac.uk  Tue Jul  3 17:31:39 2007
From: rbt501 at york.ac.uk (Taylor, RB)
Date: Tue, 03 Jul 2007 16:31:39 +0100
Subject: [R-sig-Geo] Reading text files in Spatstat
In-Reply-To: <2E9C414912813E4EB981326983E0A104032D9703@inboexch.inbo.be>
References: <468A3D7D.1020802@york.ac.uk><p06230901c2b0066386a6@[128.115.153.6]>
	<468A6704.90001@york.ac.uk>
	<2E9C414912813E4EB981326983E0A104032D9703@inboexch.inbo.be>
Message-ID: <468A6BDB.6070506@york.ac.uk>

Ok, "test" is just a small test data set of x, y coords.

3.45	5.34
2.78	5.67
3.89	1.345
2.34	3.78
3.45	5.34
2.78	5.67
3.89	1.345
2.34	3.78


You could make it easily in Excel or a similar program. x coords are in 
the first column, y coords are in the 2nd column. It is saved as a tab 
delimited text file called "test".


Cheers,
Rob

ONKELINX, Thierry wrote:
> The problem is probably in "test". Try to give us a (small) sample of
> test so we can reproduce your problem. Otherwise it will be hard to
> discover the problem.
> 
> Thierry
> 
> ------------------------------------------------------------------------
> ----
> ir. Thierry Onkelinx
> Instituut voor natuur- en bosonderzoek / Research Institute for Nature
> and Forest
> Cel biometrie, methodologie en kwaliteitszorg / Section biometrics,
> methodology and quality assurance
> Gaverstraat 4
> 9500 Geraardsbergen
> Belgium
> tel. + 32 54/436 185
> Thierry.Onkelinx at inbo.be
> www.inbo.be 
> 
> Do not put your faith in what statistics say until you have carefully
> considered what they do not say.  ~William W. Watt
> A statistical analysis, properly conducted, is a delicate dissection of
> uncertainties, a surgery of suppositions. ~M.J.Moroney
> 
>  
> 
>> -----Oorspronkelijk bericht-----
>> Van: r-sig-geo-bounces at stat.math.ethz.ch 
>> [mailto:r-sig-geo-bounces at stat.math.ethz.ch] Namens Taylor, RB
>> Verzonden: dinsdag 3 juli 2007 17:11
>> Aan: r-sig-geo at stat.math.ethz.ch
>> Onderwerp: Re: [R-sig-Geo] Reading text files in Spatstat
>>
>> Right, I have supplied the W argument now. Still no joy though....
>>
>>  > as.ppp(test,c(0,10,0,10),fatal=TRUE)
>> Error in as.ppp.default(test, c(0, 10, 0, 10), fatal = TRUE) :
>>          Can't interpret X as a point pattern
>>
>> Any ideas anyone?
>>
>> Rob
>>
>> Don MacQueen wrote:
>>> The help page for as.ppp() explains that in a case like 
>> yours (or what 
>>> I assume is yours from your description), you also need to 
>> supply the 
>>> W argument.
>>>
>>> Try looking at the help page for the ppp() function.
>>>
>>> -Don
>>>
>>> At 1:13 PM +0100 7/3/07, Taylor, RB wrote:
>>>> Hello all,
>>>>
>>>> I have x,y data with an associated mark. Is there a simple way of 
>>>> getting Spatstat to read this data? I have tried putting the x, y 
>>>> data in separate columns in Excel and ignoring the marks, 
>> saving it 
>>>> as a tab-delim text file (called "test"). However the 
>> as.ppp function 
>>>> fails to convert it into a ppp object.
>>>>
>>>>
>>>>  > test <- read.table("C:/temp/Rtest.txt")  > as.ppp(test) 
>> Error in 
>>>> as.ppp.default(test) : Can't interpret X as a point pattern
>>>>
>>>>
>>>> Perhaps someone can answer my simple question and tell me 
>> what I am 
>>>> doing wrong?
>>>>
>>>> Thanks,
>>>> Rob
>>>> --
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at stat.math.ethz.ch
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>> --
>> Rob Taylor
>>
>> University of York
>> Biology Department
>> PO Box 373
>> York
>> YO10 5YW
>> United Kingdom
>>
>> Work +44 (0)1904 32 8557
>> Mob  +44 (0)777 258 5390
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
> 

-- 
Rob Taylor

University of York
Biology Department
PO Box 373
York
YO10 5YW
United Kingdom

Work +44 (0)1904 32 8557
Mob  +44 (0)777 258 5390



From rbt501 at york.ac.uk  Tue Jul  3 17:37:53 2007
From: rbt501 at york.ac.uk (Taylor, RB)
Date: Tue, 03 Jul 2007 16:37:53 +0100
Subject: [R-sig-Geo] Reading text files in Spatstat
In-Reply-To: <2E9C414912813E4EB981326983E0A104032D9703@inboexch.inbo.be>
References: <468A3D7D.1020802@york.ac.uk><p06230901c2b0066386a6@[128.115.153.6]>
	<468A6704.90001@york.ac.uk>
	<2E9C414912813E4EB981326983E0A104032D9703@inboexch.inbo.be>
Message-ID: <468A6D51.5060501@york.ac.uk>

 > head(test)
[1] "C:/temp/Rtest.txt"



From Thierry.ONKELINX at inbo.be  Tue Jul  3 17:43:18 2007
From: Thierry.ONKELINX at inbo.be (ONKELINX, Thierry)
Date: Tue, 3 Jul 2007 17:43:18 +0200
Subject: [R-sig-Geo] Reading text files in Spatstat
In-Reply-To: <468A6BDB.6070506@york.ac.uk>
References: <468A3D7D.1020802@york.ac.uk><p06230901c2b0066386a6@[128.115.153.6]>
	<468A6704.90001@york.ac.uk>
	<2E9C414912813E4EB981326983E0A104032D9703@inboexch.inbo.be>
	<468A6BDB.6070506@york.ac.uk>
Message-ID: <2E9C414912813E4EB981326983E0A104032D970D@inboexch.inbo.be>

I've found your problem. Test must be a matrix and you probably have a
data.frame.
I hope you see the importance of a reproducibel example of your code.
You MUST define the data too.


This works.

> test <- matrix(runif(20, 0, 10), ncol = 2)
> as.ppp(test,c(0,10,0,10),fatal=TRUE)
 planar point pattern: 10 points 
window: rectangle = [0, 10] x [0, 10] units 

This doesn't work.

> test <- data.frame(test)
> as.ppp(test,c(0,10,0,10),fatal=TRUE)
Error in as.ppp.default(test, c(0, 10, 0, 10), fatal = TRUE) : 
        Can't interpret X as a point pattern


Cheers,

Thierry

------------------------------------------------------------------------
----
ir. Thierry Onkelinx
Instituut voor natuur- en bosonderzoek / Research Institute for Nature
and Forest
Cel biometrie, methodologie en kwaliteitszorg / Section biometrics,
methodology and quality assurance
Gaverstraat 4
9500 Geraardsbergen
Belgium
tel. + 32 54/436 185
Thierry.Onkelinx at inbo.be
www.inbo.be 

Do not put your faith in what statistics say until you have carefully
considered what they do not say.  ~William W. Watt
A statistical analysis, properly conducted, is a delicate dissection of
uncertainties, a surgery of suppositions. ~M.J.Moroney

 

> -----Oorspronkelijk bericht-----
> Van: Taylor, RB [mailto:rbt501 at york.ac.uk] 
> Verzonden: dinsdag 3 juli 2007 17:32
> Aan: ONKELINX, Thierry
> CC: r-sig-geo at stat.math.ethz.ch
> Onderwerp: Re: [R-sig-Geo] Reading text files in Spatstat
> 
> Ok, "test" is just a small test data set of x, y coords.
> 
> 3.45	5.34
> 2.78	5.67
> 3.89	1.345
> 2.34	3.78
> 3.45	5.34
> 2.78	5.67
> 3.89	1.345
> 2.34	3.78
> 
> 
> You could make it easily in Excel or a similar program. x 
> coords are in the first column, y coords are in the 2nd 
> column. It is saved as a tab delimited text file called "test".
> 
> 
> Cheers,
> Rob
> 
> ONKELINX, Thierry wrote:
> > The problem is probably in "test". Try to give us a (small) 
> sample of 
> > test so we can reproduce your problem. Otherwise it will be hard to 
> > discover the problem.
> > 
> > Thierry
> > 
> > 
> ----------------------------------------------------------------------
> > --
> > ----
> > ir. Thierry Onkelinx
> > Instituut voor natuur- en bosonderzoek / Research Institute 
> for Nature 
> > and Forest Cel biometrie, methodologie en kwaliteitszorg / Section 
> > biometrics, methodology and quality assurance Gaverstraat 4 9500 
> > Geraardsbergen Belgium tel. + 32 54/436 185 
> Thierry.Onkelinx at inbo.be 
> > www.inbo.be
> > 
> > Do not put your faith in what statistics say until you have 
> carefully 
> > considered what they do not say.  ~William W. Watt A statistical 
> > analysis, properly conducted, is a delicate dissection of 
> > uncertainties, a surgery of suppositions. ~M.J.Moroney
> > 
> >  
> > 
> >> -----Oorspronkelijk bericht-----
> >> Van: r-sig-geo-bounces at stat.math.ethz.ch
> >> [mailto:r-sig-geo-bounces at stat.math.ethz.ch] Namens Taylor, RB
> >> Verzonden: dinsdag 3 juli 2007 17:11
> >> Aan: r-sig-geo at stat.math.ethz.ch
> >> Onderwerp: Re: [R-sig-Geo] Reading text files in Spatstat
> >>
> >> Right, I have supplied the W argument now. Still no joy though....
> >>
> >>  > as.ppp(test,c(0,10,0,10),fatal=TRUE)
> >> Error in as.ppp.default(test, c(0, 10, 0, 10), fatal = TRUE) :
> >>          Can't interpret X as a point pattern
> >>
> >> Any ideas anyone?
> >>
> >> Rob
> >>
> >> Don MacQueen wrote:
> >>> The help page for as.ppp() explains that in a case like
> >> yours (or what
> >>> I assume is yours from your description), you also need to
> >> supply the
> >>> W argument.
> >>>
> >>> Try looking at the help page for the ppp() function.
> >>>
> >>> -Don
> >>>
> >>> At 1:13 PM +0100 7/3/07, Taylor, RB wrote:
> >>>> Hello all,
> >>>>
> >>>> I have x,y data with an associated mark. Is there a 
> simple way of 
> >>>> getting Spatstat to read this data? I have tried putting 
> the x, y 
> >>>> data in separate columns in Excel and ignoring the marks,
> >> saving it
> >>>> as a tab-delim text file (called "test"). However the
> >> as.ppp function
> >>>> fails to convert it into a ppp object.
> >>>>
> >>>>
> >>>>  > test <- read.table("C:/temp/Rtest.txt")  > as.ppp(test)
> >> Error in
> >>>> as.ppp.default(test) : Can't interpret X as a point pattern
> >>>>
> >>>>
> >>>> Perhaps someone can answer my simple question and tell me
> >> what I am
> >>>> doing wrong?
> >>>>
> >>>> Thanks,
> >>>> Rob
> >>>> --
> >>>>
> >>>> _______________________________________________
> >>>> R-sig-Geo mailing list
> >>>> R-sig-Geo at stat.math.ethz.ch
> >>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >>>
> >> --
> >> Rob Taylor
> >>
> >> University of York
> >> Biology Department
> >> PO Box 373
> >> York
> >> YO10 5YW
> >> United Kingdom
> >>
> >> Work +44 (0)1904 32 8557
> >> Mob  +44 (0)777 258 5390
> >>
> >> _______________________________________________
> >> R-sig-Geo mailing list
> >> R-sig-Geo at stat.math.ethz.ch
> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >>
> > 
> 
> --
> Rob Taylor
> 
> University of York
> Biology Department
> PO Box 373
> York
> YO10 5YW
> United Kingdom
> 
> Work +44 (0)1904 32 8557
> Mob  +44 (0)777 258 5390
>



From rbt501 at york.ac.uk  Tue Jul  3 17:46:52 2007
From: rbt501 at york.ac.uk (Taylor, RB)
Date: Tue, 03 Jul 2007 16:46:52 +0100
Subject: [R-sig-Geo] Reading text files in Spatstat
In-Reply-To: <2E9C414912813E4EB981326983E0A104032D970D@inboexch.inbo.be>
References: <468A3D7D.1020802@york.ac.uk><p06230901c2b0066386a6@[128.115.153.6]>
	<468A6704.90001@york.ac.uk>
	<2E9C414912813E4EB981326983E0A104032D9703@inboexch.inbo.be>
	<468A6BDB.6070506@york.ac.uk>
	<2E9C414912813E4EB981326983E0A104032D970D@inboexch.inbo.be>
Message-ID: <468A6F6C.6040006@york.ac.uk>

ah, thank you Thierry. As a fairly new R user, this is most helpful :)

Cheers,
Rob

ONKELINX, Thierry wrote:
> I've found your problem. Test must be a matrix and you probably have a
> data.frame.
> I hope you see the importance of a reproducibel example of your code.
> You MUST define the data too.
> 
> 
> This works.
> 
>> test <- matrix(runif(20, 0, 10), ncol = 2)
>> as.ppp(test,c(0,10,0,10),fatal=TRUE)
>  planar point pattern: 10 points 
> window: rectangle = [0, 10] x [0, 10] units 
> 
> This doesn't work.
> 
>> test <- data.frame(test)
>> as.ppp(test,c(0,10,0,10),fatal=TRUE)
> Error in as.ppp.default(test, c(0, 10, 0, 10), fatal = TRUE) : 
>         Can't interpret X as a point pattern
> 
> 
> Cheers,
> 
> Thierry
> 
> ------------------------------------------------------------------------
> ----
> ir. Thierry Onkelinx
> Instituut voor natuur- en bosonderzoek / Research Institute for Nature
> and Forest
> Cel biometrie, methodologie en kwaliteitszorg / Section biometrics,
> methodology and quality assurance
> Gaverstraat 4
> 9500 Geraardsbergen
> Belgium
> tel. + 32 54/436 185
> Thierry.Onkelinx at inbo.be
> www.inbo.be 
> 
> Do not put your faith in what statistics say until you have carefully
> considered what they do not say.  ~William W. Watt
> A statistical analysis, properly conducted, is a delicate dissection of
> uncertainties, a surgery of suppositions. ~M.J.Moroney
> 
>  
> 
>> -----Oorspronkelijk bericht-----
>> Van: Taylor, RB [mailto:rbt501 at york.ac.uk] 
>> Verzonden: dinsdag 3 juli 2007 17:32
>> Aan: ONKELINX, Thierry
>> CC: r-sig-geo at stat.math.ethz.ch
>> Onderwerp: Re: [R-sig-Geo] Reading text files in Spatstat
>>
>> Ok, "test" is just a small test data set of x, y coords.
>>
>> 3.45	5.34
>> 2.78	5.67
>> 3.89	1.345
>> 2.34	3.78
>> 3.45	5.34
>> 2.78	5.67
>> 3.89	1.345
>> 2.34	3.78
>>
>>
>> You could make it easily in Excel or a similar program. x 
>> coords are in the first column, y coords are in the 2nd 
>> column. It is saved as a tab delimited text file called "test".
>>
>>
>> Cheers,
>> Rob
>>
>> ONKELINX, Thierry wrote:
>>> The problem is probably in "test". Try to give us a (small) 
>> sample of 
>>> test so we can reproduce your problem. Otherwise it will be hard to 
>>> discover the problem.
>>>
>>> Thierry
>>>
>>>
>> ----------------------------------------------------------------------
>>> --
>>> ----
>>> ir. Thierry Onkelinx
>>> Instituut voor natuur- en bosonderzoek / Research Institute 
>> for Nature 
>>> and Forest Cel biometrie, methodologie en kwaliteitszorg / Section 
>>> biometrics, methodology and quality assurance Gaverstraat 4 9500 
>>> Geraardsbergen Belgium tel. + 32 54/436 185 
>> Thierry.Onkelinx at inbo.be 
>>> www.inbo.be
>>>
>>> Do not put your faith in what statistics say until you have 
>> carefully 
>>> considered what they do not say.  ~William W. Watt A statistical 
>>> analysis, properly conducted, is a delicate dissection of 
>>> uncertainties, a surgery of suppositions. ~M.J.Moroney
>>>
>>>  
>>>
>>>> -----Oorspronkelijk bericht-----
>>>> Van: r-sig-geo-bounces at stat.math.ethz.ch
>>>> [mailto:r-sig-geo-bounces at stat.math.ethz.ch] Namens Taylor, RB
>>>> Verzonden: dinsdag 3 juli 2007 17:11
>>>> Aan: r-sig-geo at stat.math.ethz.ch
>>>> Onderwerp: Re: [R-sig-Geo] Reading text files in Spatstat
>>>>
>>>> Right, I have supplied the W argument now. Still no joy though....
>>>>
>>>>  > as.ppp(test,c(0,10,0,10),fatal=TRUE)
>>>> Error in as.ppp.default(test, c(0, 10, 0, 10), fatal = TRUE) :
>>>>          Can't interpret X as a point pattern
>>>>
>>>> Any ideas anyone?
>>>>
>>>> Rob
>>>>
>>>> Don MacQueen wrote:
>>>>> The help page for as.ppp() explains that in a case like
>>>> yours (or what
>>>>> I assume is yours from your description), you also need to
>>>> supply the
>>>>> W argument.
>>>>>
>>>>> Try looking at the help page for the ppp() function.
>>>>>
>>>>> -Don
>>>>>
>>>>> At 1:13 PM +0100 7/3/07, Taylor, RB wrote:
>>>>>> Hello all,
>>>>>>
>>>>>> I have x,y data with an associated mark. Is there a 
>> simple way of 
>>>>>> getting Spatstat to read this data? I have tried putting 
>> the x, y 
>>>>>> data in separate columns in Excel and ignoring the marks,
>>>> saving it
>>>>>> as a tab-delim text file (called "test"). However the
>>>> as.ppp function
>>>>>> fails to convert it into a ppp object.
>>>>>>
>>>>>>
>>>>>>  > test <- read.table("C:/temp/Rtest.txt")  > as.ppp(test)
>>>> Error in
>>>>>> as.ppp.default(test) : Can't interpret X as a point pattern
>>>>>>
>>>>>>
>>>>>> Perhaps someone can answer my simple question and tell me
>>>> what I am
>>>>>> doing wrong?
>>>>>>
>>>>>> Thanks,
>>>>>> Rob
>>>>>> --
>>>>>>
>>>>>> _______________________________________________
>>>>>> R-sig-Geo mailing list
>>>>>> R-sig-Geo at stat.math.ethz.ch
>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>> --
>>>> Rob Taylor
>>>>
>>>> University of York
>>>> Biology Department
>>>> PO Box 373
>>>> York
>>>> YO10 5YW
>>>> United Kingdom
>>>>
>>>> Work +44 (0)1904 32 8557
>>>> Mob  +44 (0)777 258 5390
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at stat.math.ethz.ch
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>> --
>> Rob Taylor
>>
>> University of York
>> Biology Department
>> PO Box 373
>> York
>> YO10 5YW
>> United Kingdom
>>
>> Work +44 (0)1904 32 8557
>> Mob  +44 (0)777 258 5390
>>
> 

-- 
Rob Taylor

University of York
Biology Department
PO Box 373
York
YO10 5YW
United Kingdom

Work +44 (0)1904 32 8557
Mob  +44 (0)777 258 5390



From rbt501 at york.ac.uk  Wed Jul  4 11:55:23 2007
From: rbt501 at york.ac.uk (Taylor, RB)
Date: Wed, 04 Jul 2007 10:55:23 +0100
Subject: [R-sig-Geo] Reading text files in Spatstat
In-Reply-To: <468A6F6C.6040006@york.ac.uk>
References: <468A3D7D.1020802@york.ac.uk><p06230901c2b0066386a6@[128.115.153.6]>	<468A6704.90001@york.ac.uk>	<2E9C414912813E4EB981326983E0A104032D9703@inboexch.inbo.be>	<468A6BDB.6070506@york.ac.uk>	<2E9C414912813E4EB981326983E0A104032D970D@inboexch.inbo.be>
	<468A6F6C.6040006@york.ac.uk>
Message-ID: <468B6E8B.1040103@york.ac.uk>

Just to finally finish off the thread, here is the code I used.

# read in the text data into a dataframe. "Rtest" is just x,y coords
 > test <- read.table("C:/temp/Rtest.txt")

# convert the data frame to a numeric matrix
 > test.matrix <- data.matrix(test)

# coerce the data into a ppp object in Spatstat
 > as.ppp(test.matrix,c(0,10,0,10),fatal=TRUE)
planar point pattern: 8 points
window: rectangle = [0, 10] x [0, 10] units

Taylor, RB wrote:
> ah, thank you Thierry. As a fairly new R user, this is most helpful :)
> 
> Cheers,
> Rob
> 
> ONKELINX, Thierry wrote:
>> I've found your problem. Test must be a matrix and you probably have a
>> data.frame.
>> I hope you see the importance of a reproducibel example of your code.
>> You MUST define the data too.
>>
>>
>> This works.
>>
>>> test <- matrix(runif(20, 0, 10), ncol = 2)
>>> as.ppp(test,c(0,10,0,10),fatal=TRUE)
>>  planar point pattern: 10 points 
>> window: rectangle = [0, 10] x [0, 10] units 
>>
>> This doesn't work.
>>
>>> test <- data.frame(test)
>>> as.ppp(test,c(0,10,0,10),fatal=TRUE)
>> Error in as.ppp.default(test, c(0, 10, 0, 10), fatal = TRUE) : 
>>         Can't interpret X as a point pattern
>>
>>
>> Cheers,
>>
>> Thierry
>>
>> ------------------------------------------------------------------------
>> ----
>> ir. Thierry Onkelinx
>> Instituut voor natuur- en bosonderzoek / Research Institute for Nature
>> and Forest
>> Cel biometrie, methodologie en kwaliteitszorg / Section biometrics,
>> methodology and quality assurance
>> Gaverstraat 4
>> 9500 Geraardsbergen
>> Belgium
>> tel. + 32 54/436 185
>> Thierry.Onkelinx at inbo.be
>> www.inbo.be 
>>
>> Do not put your faith in what statistics say until you have carefully
>> considered what they do not say.  ~William W. Watt
>> A statistical analysis, properly conducted, is a delicate dissection of
>> uncertainties, a surgery of suppositions. ~M.J.Moroney
>>
>>  
>>
>>> -----Oorspronkelijk bericht-----
>>> Van: Taylor, RB [mailto:rbt501 at york.ac.uk] 
>>> Verzonden: dinsdag 3 juli 2007 17:32
>>> Aan: ONKELINX, Thierry
>>> CC: r-sig-geo at stat.math.ethz.ch
>>> Onderwerp: Re: [R-sig-Geo] Reading text files in Spatstat
>>>
>>> Ok, "test" is just a small test data set of x, y coords.
>>>
>>> 3.45	5.34
>>> 2.78	5.67
>>> 3.89	1.345
>>> 2.34	3.78
>>> 3.45	5.34
>>> 2.78	5.67
>>> 3.89	1.345
>>> 2.34	3.78
>>>
>>>
>>> You could make it easily in Excel or a similar program. x 
>>> coords are in the first column, y coords are in the 2nd 
>>> column. It is saved as a tab delimited text file called "test".
>>>
>>>
>>> Cheers,
>>> Rob
>>>
>>> ONKELINX, Thierry wrote:
>>>> The problem is probably in "test". Try to give us a (small) 
>>> sample of 
>>>> test so we can reproduce your problem. Otherwise it will be hard to 
>>>> discover the problem.
>>>>
>>>> Thierry
>>>>
>>>>
>>> ----------------------------------------------------------------------
>>>> --
>>>> ----
>>>> ir. Thierry Onkelinx
>>>> Instituut voor natuur- en bosonderzoek / Research Institute 
>>> for Nature 
>>>> and Forest Cel biometrie, methodologie en kwaliteitszorg / Section 
>>>> biometrics, methodology and quality assurance Gaverstraat 4 9500 
>>>> Geraardsbergen Belgium tel. + 32 54/436 185 
>>> Thierry.Onkelinx at inbo.be 
>>>> www.inbo.be
>>>>
>>>> Do not put your faith in what statistics say until you have 
>>> carefully 
>>>> considered what they do not say.  ~William W. Watt A statistical 
>>>> analysis, properly conducted, is a delicate dissection of 
>>>> uncertainties, a surgery of suppositions. ~M.J.Moroney
>>>>
>>>>  
>>>>
>>>>> -----Oorspronkelijk bericht-----
>>>>> Van: r-sig-geo-bounces at stat.math.ethz.ch
>>>>> [mailto:r-sig-geo-bounces at stat.math.ethz.ch] Namens Taylor, RB
>>>>> Verzonden: dinsdag 3 juli 2007 17:11
>>>>> Aan: r-sig-geo at stat.math.ethz.ch
>>>>> Onderwerp: Re: [R-sig-Geo] Reading text files in Spatstat
>>>>>
>>>>> Right, I have supplied the W argument now. Still no joy though....
>>>>>
>>>>>  > as.ppp(test,c(0,10,0,10),fatal=TRUE)
>>>>> Error in as.ppp.default(test, c(0, 10, 0, 10), fatal = TRUE) :
>>>>>          Can't interpret X as a point pattern
>>>>>
>>>>> Any ideas anyone?
>>>>>
>>>>> Rob
>>>>>
>>>>> Don MacQueen wrote:
>>>>>> The help page for as.ppp() explains that in a case like
>>>>> yours (or what
>>>>>> I assume is yours from your description), you also need to
>>>>> supply the
>>>>>> W argument.
>>>>>>
>>>>>> Try looking at the help page for the ppp() function.
>>>>>>
>>>>>> -Don
>>>>>>
>>>>>> At 1:13 PM +0100 7/3/07, Taylor, RB wrote:
>>>>>>> Hello all,
>>>>>>>
>>>>>>> I have x,y data with an associated mark. Is there a 
>>> simple way of 
>>>>>>> getting Spatstat to read this data? I have tried putting 
>>> the x, y 
>>>>>>> data in separate columns in Excel and ignoring the marks,
>>>>> saving it
>>>>>>> as a tab-delim text file (called "test"). However the
>>>>> as.ppp function
>>>>>>> fails to convert it into a ppp object.
>>>>>>>
>>>>>>>
>>>>>>>  > test <- read.table("C:/temp/Rtest.txt")  > as.ppp(test)
>>>>> Error in
>>>>>>> as.ppp.default(test) : Can't interpret X as a point pattern
>>>>>>>
>>>>>>>
>>>>>>> Perhaps someone can answer my simple question and tell me
>>>>> what I am
>>>>>>> doing wrong?
>>>>>>>
>>>>>>> Thanks,
>>>>>>> Rob
>>>>>>> --
>>>>>>>
>>>>>>> _______________________________________________
>>>>>>> R-sig-Geo mailing list
>>>>>>> R-sig-Geo at stat.math.ethz.ch
>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>> --
>>>>> Rob Taylor
>>>>>
>>>>> University of York
>>>>> Biology Department
>>>>> PO Box 373
>>>>> York
>>>>> YO10 5YW
>>>>> United Kingdom
>>>>>
>>>>> Work +44 (0)1904 32 8557
>>>>> Mob  +44 (0)777 258 5390
>>>>>
>>>>> _______________________________________________
>>>>> R-sig-Geo mailing list
>>>>> R-sig-Geo at stat.math.ethz.ch
>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>
>>> --
>>> Rob Taylor
>>>
>>> University of York
>>> Biology Department
>>> PO Box 373
>>> York
>>> YO10 5YW
>>> United Kingdom
>>>
>>> Work +44 (0)1904 32 8557
>>> Mob  +44 (0)777 258 5390
>>>
> 

-- 
Rob Taylor

University of York
Biology Department
PO Box 373
York
YO10 5YW
United Kingdom

Work +44 (0)1904 32 8557
Mob  +44 (0)777 258 5390



From Agustin.Lobo at ija.csic.es  Thu Jul  5 10:31:54 2007
From: Agustin.Lobo at ija.csic.es (Agustin Lobo)
Date: Thu, 05 Jul 2007 10:31:54 +0200
Subject: [R-sig-Geo] vector to raster
Message-ID: <468CAC7A.3090301@ija.csic.es>

Dear sig-geos,

is there any way of converting from vector
(imported with rgdal from a shp) to raster
within R?

Thanks!

Agus

-- 
Dr. Agustin Lobo
Institut de Ciencies de la Terra "Jaume Almera" (CSIC)
LLuis Sole Sabaris s/n
08028 Barcelona
Spain
Tel. 34 934095410
Fax. 34 934110012
email: Agustin.Lobo at ija.csic.es
http://www.ija.csic.es/gt/obster



From e.pebesma at geo.uu.nl  Thu Jul  5 13:56:05 2007
From: e.pebesma at geo.uu.nl (Edzer J. Pebesma)
Date: Thu, 05 Jul 2007 13:56:05 +0200
Subject: [R-sig-Geo] vector to raster
In-Reply-To: <468CAC7A.3090301@ija.csic.es>
References: <468CAC7A.3090301@ija.csic.es>
Message-ID: <468CDC55.1080902@geo.uu.nl>

Agustin Lobo wrote:
> Dear sig-geos,
>
> is there any way of converting from vector
> (imported with rgdal from a shp) to raster
> within R?
>
> Thanks!
>
> Agus
>
>   
Yes, using the classes and methods in sp -- you'd first have to create a 
grid e.g. with spsample, sampling type regular or makegrid. Next, if you 
want to have the polygon values at grid cell centres, overlay the 
polygons with the grid, using the overlay method.

 > library(sp)
 > data(meuse.riv)
 > meuse.sr = SpatialPolygons(list(Polygons(list(Polygon(meuse.riv)), "x")))
 >
 > plot(meuse.sr)
 > points(spsample(meuse.sr, n = 1000, "regular"), pch = 3)
 > class(meuse.sr)
[1] "SpatialPolygons"
attr(,"package")
[1] "sp"
 > pts = spsample(meuse.sr, n = 1000, "regular")
 > class(pts)
[1] "SpatialPoints"
attr(,"package")
[1] "sp"
 > gridded(pts)=T
 > class(pts)
[1] "SpatialPixels"
attr(,"package")
[1] "sp"

--
Edzer



From Agustin.Lobo at ija.csic.es  Thu Jul  5 14:37:06 2007
From: Agustin.Lobo at ija.csic.es (Agustin Lobo)
Date: Thu, 05 Jul 2007 14:37:06 +0200
Subject: [R-sig-Geo] spatstat objects and sp: distmap result to sp
Message-ID: <468CE5F2.2080200@ija.csic.es>

Dear Siggeos,

I'm having a hard time at converting
objects to use spatial functions in different
packages. With a lot of help from the list
I've been able to calculate a distmap (package spatstat).
Now I would like to export using rgdal, but
cannot figure out how to convert the object
resulting from distmap (class "im") to an
sp object. I've unsuccessfully tried  as.image.SpatialGridDataFrame.
Any ideas?

Thanks,

Agus

-- 
Dr. Agustin Lobo
Institut de Ciencies de la Terra "Jaume Almera" (CSIC)
LLuis Sole Sabaris s/n
08028 Barcelona
Spain
Tel. 34 934095410
Fax. 34 934110012
email: Agustin.Lobo at ija.csic.es
http://www.ija.csic.es/gt/obster



From Agustin.Lobo at ija.csic.es  Thu Jul  5 14:51:47 2007
From: Agustin.Lobo at ija.csic.es (Agustin Lobo)
Date: Thu, 05 Jul 2007 14:51:47 +0200
Subject: [R-sig-Geo] vector to raster
In-Reply-To: <468CDC55.1080902@geo.uu.nl>
References: <468CAC7A.3090301@ija.csic.es> <468CDC55.1080902@geo.uu.nl>
Message-ID: <468CE963.5090209@ija.csic.es>

I think I'm missing something here. Althoug I understand the general 
idea of making a regular grid of points within the boundaries of the
polygon, the final pts object of your example is not quite the idea I 
have of a raster. For example, how could you display pts using image() ? or
  how could you write pts as a geotif using rgdal?

Thanks!

Agus


Edzer J. Pebesma escribi?:
> Agustin Lobo wrote:
>> Dear sig-geos,
>>
>> is there any way of converting from vector
>> (imported with rgdal from a shp) to raster
>> within R?
>>
>> Thanks!
>>
>> Agus
>>
>>   
> Yes, using the classes and methods in sp -- you'd first have to create a 
> grid e.g. with spsample, sampling type regular or makegrid. Next, if you 
> want to have the polygon values at grid cell centres, overlay the 
> polygons with the grid, using the overlay method.
> 
>  > library(sp)
>  > data(meuse.riv)
>  > meuse.sr = SpatialPolygons(list(Polygons(list(Polygon(meuse.riv)), 
> "x")))
>  >
>  > plot(meuse.sr)
>  > points(spsample(meuse.sr, n = 1000, "regular"), pch = 3)
>  > class(meuse.sr)
> [1] "SpatialPolygons"
> attr(,"package")
> [1] "sp"
>  > pts = spsample(meuse.sr, n = 1000, "regular")
>  > class(pts)
> [1] "SpatialPoints"
> attr(,"package")
> [1] "sp"
>  > gridded(pts)=T
>  > class(pts)
> [1] "SpatialPixels"
> attr(,"package")
> [1] "sp"
> 
> -- 
> Edzer
> 

-- 
Dr. Agustin Lobo
Institut de Ciencies de la Terra "Jaume Almera" (CSIC)
LLuis Sole Sabaris s/n
08028 Barcelona
Spain
Tel. 34 934095410
Fax. 34 934110012
email: Agustin.Lobo at ija.csic.es
http://www.ija.csic.es/gt/obster



From Agustin.Lobo at ija.csic.es  Thu Jul  5 18:16:19 2007
From: Agustin.Lobo at ija.csic.es (Agustin Lobo)
Date: Thu, 05 Jul 2007 18:16:19 +0200
Subject: [R-sig-Geo] [Fwd: SpatialPolygons: Problems with cross overs?]
Message-ID: <468D1953.3090508@ija.csic.es>

Dear rsiggeos,

After importing an shp file with rgdal using
refG <-
readOGR("C:/ALOBO/dipu2006/espaisoberts_P037/GARRAF/GFO_EOA_TOTS_v4",layer="GFO_EOA_Acti_v4")

(I can send the shp file upon request)

I do

l2 <- as(as(refG, "SpatialPolygons"), "owin")

and get a report of problems that I summarize here:

Polygon 240 contains duplicated vertices
Polygon 240 is self-intersecting
Polygon 352 contains duplicated vertices
Polygon 352 is self-intersecting
Polygons 240 and 352 contain duplicated vertices
Polygons 240 and 352 are self-intersecting
Polygons 4 and 264 cross over
Polygons 4 and 334 cross over
Polygons 57 and 104 cross over
Polygons 141 and 142 cross over
Polygons 168 and 218 cross over
Polygons 174 and 177 cross over
Polygons 220 and 240 cross over
Polygons 224 and 229 cross over
Polygons 224 and 235 cross over
Polygons 225 and 240 cross over
Polygons 266 and 271 cross over
Polygons 274 and 277 cross over
Polygons 291 and 304 cross over
Polygons 325 and 334 cross over
Polygons 330 and 334 cross over
Polygons 341 and 361 cross over
Polygons 352 and 367 cross over
Polygons 352 and 387 cross over
Polygons 388 and 390 cross over

I've checked the cross overs, and the reported polygons
do not seem to have cross-overs at all. For an example,
just look at the attached file crov_352_387.jpg, plotted as

spplot(refG[c(352,387),],zcol="OBJECTID")

There are many like this: I've put all the polygons with cross-overs in
matrix crossov. You can check, for example:

spplot(refG[crossov[18,],],zcol="OBJECTID")
spplot(refG[crossov[4,],],zcol="OBJECTID")

etc.

(BTW, why the following code does not plot anything?:
for (i in 1:nrow(crossov)){
       print(crossov[i,])
       spplot(refG[crossov[i,],],zcol="OBJECTID")
       readline()
}

Thanks for any help!

Agus
-- 
Dr. Agustin Lobo
Institut de Ciencies de la Terra "Jaume Almera" (CSIC)
LLuis Sole Sabaris s/n
08028 Barcelona
Spain
Tel. 34 934095410
Fax. 34 934110012
email: Agustin.Lobo at ija.csic.es
http://www.ija.csic.es/gt/obster


-- 
Dr. Agustin Lobo
Institut de Ciencies de la Terra "Jaume Almera" (CSIC)
LLuis Sole Sabaris s/n
08028 Barcelona
Spain
Tel. 34 934095410
Fax. 34 934110012
email: Agustin.Lobo at ija.csic.es
http://www.ija.csic.es/gt/obster
-------------- next part --------------
A non-text attachment was scrubbed...
Name: crossov.rda
Type: application/octet-stream
Size: 191 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070705/81e7bb97/attachment.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: crov_352_387.jpg
Type: image/jpeg
Size: 21131 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070705/81e7bb97/attachment.jpg>

From e.pebesma at geo.uu.nl  Thu Jul  5 19:29:07 2007
From: e.pebesma at geo.uu.nl (Edzer J Pebesma)
Date: Thu, 05 Jul 2007 19:29:07 +0200
Subject: [R-sig-Geo] [Fwd: SpatialPolygons: Problems with cross overs?]
In-Reply-To: <468D1953.3090508@ija.csic.es>
References: <468D1953.3090508@ija.csic.es>
Message-ID: <468D2A63.2030204@geo.uu.nl>

Agustin,

I didn't look at the cross overs, but spplot inside a loop needs an 
explicit print(spplot(...)) around it to get the result printed 
(actually plotted); this is a lattice FAQ, spplot wraps xyplot or 
levelplot in lattice.
--
Edzer

Agustin Lobo wrote:

> Dear rsiggeos,
>
> After importing an shp file with rgdal using
> refG <-
> readOGR("C:/ALOBO/dipu2006/espaisoberts_P037/GARRAF/GFO_EOA_TOTS_v4",layer="GFO_EOA_Acti_v4") 
>
>
> (I can send the shp file upon request)
>
> I do
>
> l2 <- as(as(refG, "SpatialPolygons"), "owin")
>
> and get a report of problems that I summarize here:
>
> Polygon 240 contains duplicated vertices
> Polygon 240 is self-intersecting
> Polygon 352 contains duplicated vertices
> Polygon 352 is self-intersecting
> Polygons 240 and 352 contain duplicated vertices
> Polygons 240 and 352 are self-intersecting
> Polygons 4 and 264 cross over
> Polygons 4 and 334 cross over
> Polygons 57 and 104 cross over
> Polygons 141 and 142 cross over
> Polygons 168 and 218 cross over
> Polygons 174 and 177 cross over
> Polygons 220 and 240 cross over
> Polygons 224 and 229 cross over
> Polygons 224 and 235 cross over
> Polygons 225 and 240 cross over
> Polygons 266 and 271 cross over
> Polygons 274 and 277 cross over
> Polygons 291 and 304 cross over
> Polygons 325 and 334 cross over
> Polygons 330 and 334 cross over
> Polygons 341 and 361 cross over
> Polygons 352 and 367 cross over
> Polygons 352 and 387 cross over
> Polygons 388 and 390 cross over
>
> I've checked the cross overs, and the reported polygons
> do not seem to have cross-overs at all. For an example,
> just look at the attached file crov_352_387.jpg, plotted as
>
> spplot(refG[c(352,387),],zcol="OBJECTID")
>
> There are many like this: I've put all the polygons with cross-overs in
> matrix crossov. You can check, for example:
>
> spplot(refG[crossov[18,],],zcol="OBJECTID")
> spplot(refG[crossov[4,],],zcol="OBJECTID")
>
> etc.
>
> (BTW, why the following code does not plot anything?:
> for (i in 1:nrow(crossov)){
>       print(crossov[i,])
>       spplot(refG[crossov[i,],],zcol="OBJECTID")
>       readline()
> }
>
> Thanks for any help!
>
> Agus
>
> ------------------------------------------------------------------------
>
>------------------------------------------------------------------------
>
>_______________________________________________
>R-sig-Geo mailing list
>R-sig-Geo at stat.math.ethz.ch
>https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>  
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070705/1aba2f27/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/jpeg
Size: 21131 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070705/1aba2f27/attachment.jpe>

From david.march at uib.es  Fri Jul  6 18:05:20 2007
From: david.march at uib.es (=?ISO-8859-1?Q?David_March_Morl=E0?=)
Date: Fri, 06 Jul 2007 18:05:20 +0200
Subject: [R-sig-Geo] spatstat objects and sp: distmap result to sp
Message-ID: <468E6840.5080705@uib.es>

Dear Agus,

Maybe you can try this:
dist<-distmap(yourdata)
dist.grid<-as.SpatialGridDataFrame.im(dist)

Regards

-- 
David March Morl?
Doctorando / PhD student
Instituto Mediterraneo de Estudios Avanzados (UIB-CSIC)
C/Miquel Marqu?s, 21
07190 Esporles
Islas Baleares - Spain
Tel: +34 971 611 722
Fax: +34 971 611 761
Email: david.march at uib.es



From rmk at krugs.de  Thu Jul  5 10:49:48 2007
From: rmk at krugs.de (Rainer M. Krug)
Date: Thu, 05 Jul 2007 10:49:48 +0200
Subject: [R-sig-Geo] vector to raster
In-Reply-To: <468CAC7A.3090301@ija.csic.es>
References: <468CAC7A.3090301@ija.csic.es>
Message-ID: <468CB0AC.4020701@krugs.de>

Agustin Lobo wrote:
> Dear sig-geos,
> 
> is there any way of converting from vector
> (imported with rgdal from a shp) to raster
> within R?

I don't know about R, but there definitely is the possibility of using 
grass for doing this. When you are using spgrass6 you can integrate 
these two (grass into R)

Rainer

> 
> Thanks!
> 
> Agus
>



From epistat at gmail.com  Mon Jul  9 11:48:17 2007
From: epistat at gmail.com (zhijie zhang)
Date: Mon, 9 Jul 2007 17:48:17 +0800
Subject: [R-sig-Geo] Can R do the Cuzick and Edwards's test ?
Message-ID: <2fc17e30707090248v676491feueca75104c27f4a7@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070709/dafad91e/attachment.pl>

From Agustin.Lobo at ija.csic.es  Mon Jul  9 21:54:15 2007
From: Agustin.Lobo at ija.csic.es (Agustin Lobo)
Date: Mon, 09 Jul 2007 21:54:15 +0200
Subject: [R-sig-Geo] problems with writeGDAL (rgdal)
Message-ID: <46929267.8010603@ija.csic.es>

Hi rsiggeos,

I've found 2 problems with writeGDAL:

If I simply do:

refG25 <- readGDAL("GFOEOAActiv4_25.tif")
writeGDAL(refG25, "delme.tif", drivername = "GTiff", type = "Float32", 
mvFlag = NA, options=NULL)

where GFOEOAActiv4_25.tif is a geotif file,

1. delme.tif has no datum information (I've imported with 2 different 
programs, TNT and Global Mapper), despite the fact that
 > str(refG25)
Loading required package: sp
Formal class 'SpatialGridDataFrame' [package "sp"] with 6 slots
   ..@ data       :'data.frame': 843156 obs. of  1 variable:
   .. ..$ band1: int [1:843156] 0 0 0 0 0 0 0 0 0 0 ...
   ..@ grid       :Formal class 'GridTopology' [package "sp"] with 3 slots
   .. .. ..@ cellcentre.offset: Named num [1:2]  383088 4562588
   .. .. .. ..- attr(*, "names")= chr [1:2] "x" "y"
   .. .. ..@ cellsize         : num [1:2] 25 25
   .. .. ..@ cells.dim        : int [1:2] 1266 666
   ..@ grid.index : int(0)
   ..@ coords     : num [1:2, 1:2]  383088  414713 4562588 4579213
   .. ..- attr(*, "dimnames")=List of 2
   .. .. ..$ : NULL
   .. .. ..$ : chr [1:2] "x" "y"
   ..@ bbox       : num [1:2, 1:2]  383075 4562575  414725 4579225
   .. ..- attr(*, "dimnames")=List of 2
   .. .. ..$ : chr [1:2] "x" "y"
   .. .. ..$ : chr [1:2] "min" "max"
   ..@ proj4string:Formal class 'CRS' [package "sp"] with 1 slots
   .. .. ..@ projargs: chr " +proj=utm +zone=31 +ellps=intl +units=m 
+no_defs"

2. In most cases, the external programs fail reading unless I quit R. It 
seems like rgdal is not releasing the exported file?

Thanks!

Agus



-- 
Dr. Agustin Lobo
Institut de Ciencies de la Terra "Jaume Almera" (CSIC)
LLuis Sole Sabaris s/n
08028 Barcelona
Spain
Tel. 34 934095410
Fax. 34 934110012
email: Agustin.Lobo at ija.csic.es
http://www.ija.csic.es/gt/obster



From Agustin.Lobo at ija.csic.es  Mon Jul  9 21:55:43 2007
From: Agustin.Lobo at ija.csic.es (Agustin Lobo)
Date: Mon, 09 Jul 2007 21:55:43 +0200
Subject: [R-sig-Geo] [Fwd: Re: spatstat objects and sp: distmap result to sp]
Message-ID: <469292BF.4090303@ija.csic.es>

Gracias David, it works!

I just have some more problems with the georeferenciation
at writing with rgdal as geotif, but this is another issue.

Saludos,

Agus

David March Morl? escribi?:
> Dear Agus,
> 
> Maybe you can try this:
> dist<-distmap(yourdata)
> dist.grid<-as.SpatialGridDataFrame.im(dist)
> 
> Regards
> 

-- 
Dr. Agustin Lobo
Institut de Ciencies de la Terra "Jaume Almera" (CSIC)
LLuis Sole Sabaris s/n
08028 Barcelona
Spain
Tel. 34 934095410
Fax. 34 934110012
email: Agustin.Lobo at ija.csic.es
http://www.ija.csic.es/gt/obster



From debarchana.ghosh at gmail.com  Mon Jul  9 23:29:14 2007
From: debarchana.ghosh at gmail.com (Debarchana Ghosh)
Date: Mon, 9 Jul 2007 16:29:14 -0500
Subject: [R-sig-Geo] problem with writeGDAL,
	its reading as black box in ARcGIS
Message-ID: <d1b8ff630707091429q62e27787uf0d8376861d502f7@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070709/832dade8/attachment.pl>

From jytunitemprogop at unitempro.com  Tue Jul 10 01:09:22 2007
From: jytunitemprogop at unitempro.com (Jennifer Forrest)
Date: Mon, 9 Jul 2007 23:09:22 +0000
Subject: [R-sig-Geo] Olny this 5 days special price on pharma for you dear
	customer
Message-ID: <199457715.28844564241723@unitempro.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070709/4fb04d01/attachment.pl>

From e.pebesma at geo.uu.nl  Tue Jul 10 01:09:54 2007
From: e.pebesma at geo.uu.nl (Edzer J. Pebesma)
Date: Tue, 10 Jul 2007 01:09:54 +0200
Subject: [R-sig-Geo] problem with writeGDAL,
 its reading as black box in ARcGIS
In-Reply-To: <d1b8ff630707091429q62e27787uf0d8376861d502f7@mail.gmail.com>
References: <d1b8ff630707091429q62e27787uf0d8376861d502f7@mail.gmail.com>
Message-ID: <4692C042.2080601@geo.uu.nl>

Debs,

what does gdalinfo sayl about the .tif map? I wouldn't trust Arcmap as 
the ultimate referee to judge whether a geotiff is sound or not. It may 
dislike your floating point values, for example.
--
Edzer

Debarchana Ghosh wrote:
> Hello,
>
> I'm using Windows with 2 GB ram.
>
> I have created a SpatialGridDataFrame object by using the functions
> GridTopology and spkernel2d. I used writeGDAL to create a grid object
> readable in ArcGIS 9.2. But the output of the writeGDAL is a black box. I
> did try to switch from "stretched" to "categories" and I'm still getting a
> black box.
>
> Here is the code:
> bird06.xy<-coordinates(splanc_bird06[1:2])
> grd1<-GridTopology(c(419983.3, 4924198), c(30,30), c(3375,3499))
> k5000<-spkernel2d(bird06.xy, splanc_bird06$poly, h0=5000, grd1)
> df<-data.frame(k5000=k5000)
> kernel5000<-SpatialGridDataFrame(grd1, data=df)
> writeGDAL(kernel5000, fname="k2006.tif", drivername="GTiff")
>
> Also,
>
> The value of k2006.tif in Arcmap shows from High: 1.#QNAN to Low: 1.#QNAN
>
> But I know k5000 is not empty
>
> summary(k5000)
>
>         Min.      1st Qu.       Median         Mean      3rd Qu.
> Max.         NA's
> 0.000000e+00 0.000000e+00 1.240000e-08 6.191000e-08 5.724000e-08
> 6.325000e-07 3.248585e+06
>
> Thanks,
> Debs.
>
>



From Agustin.Lobo at ija.csic.es  Tue Jul 10 08:35:03 2007
From: Agustin.Lobo at ija.csic.es (Agustin Lobo)
Date: Tue, 10 Jul 2007 08:35:03 +0200
Subject: [R-sig-Geo] problem with writeGDAL,
 its reading as black box in ARcGIS
In-Reply-To: <4692C042.2080601@geo.uu.nl>
References: <d1b8ff630707091429q62e27787uf0d8376861d502f7@mail.gmail.com>
	<4692C042.2080601@geo.uu.nl>
Message-ID: <46932897.3040908@ija.csic.es>

I would use the trial version of global mapper for testing the geotif 
files (http://www.globalmapper.com).
Geotiff examiner is also useful
ftp://ftp.mentorsoftwareinc.com/public/freebies/geotiff/geotiffe.exe


Agus

Edzer J. Pebesma escribi?:
> Debs,
> 
> what does gdalinfo sayl about the .tif map? I wouldn't trust Arcmap as 
> the ultimate referee to judge whether a geotiff is sound or not. It may 
> dislike your floating point values, for example.
> --
> Edzer
> 
> Debarchana Ghosh wrote:
>> Hello,
>>
>> I'm using Windows with 2 GB ram.
>>
>> I have created a SpatialGridDataFrame object by using the functions
>> GridTopology and spkernel2d. I used writeGDAL to create a grid object
>> readable in ArcGIS 9.2. But the output of the writeGDAL is a black box. I
>> did try to switch from "stretched" to "categories" and I'm still getting a
>> black box.
>>
>> Here is the code:
>> bird06.xy<-coordinates(splanc_bird06[1:2])
>> grd1<-GridTopology(c(419983.3, 4924198), c(30,30), c(3375,3499))
>> k5000<-spkernel2d(bird06.xy, splanc_bird06$poly, h0=5000, grd1)
>> df<-data.frame(k5000=k5000)
>> kernel5000<-SpatialGridDataFrame(grd1, data=df)
>> writeGDAL(kernel5000, fname="k2006.tif", drivername="GTiff")
>>
>> Also,
>>
>> The value of k2006.tif in Arcmap shows from High: 1.#QNAN to Low: 1.#QNAN
>>
>> But I know k5000 is not empty
>>
>> summary(k5000)
>>
>>         Min.      1st Qu.       Median         Mean      3rd Qu.
>> Max.         NA's
>> 0.000000e+00 0.000000e+00 1.240000e-08 6.191000e-08 5.724000e-08
>> 6.325000e-07 3.248585e+06
>>
>> Thanks,
>> Debs.
>>
>>
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Dr. Agustin Lobo
Institut de Ciencies de la Terra "Jaume Almera" (CSIC)
LLuis Sole Sabaris s/n
08028 Barcelona
Spain
Tel. 34 934095410
Fax. 34 934110012
email: Agustin.Lobo at ija.csic.es
http://www.ija.csic.es/gt/obster



From pegorett at science.unitn.it  Tue Jul 10 09:37:03 2007
From: pegorett at science.unitn.it (Stefano Pegoretti)
Date: Tue, 10 Jul 2007 09:37:03 +0200
Subject: [R-sig-Geo] Cell Declustering
Message-ID: <4693371F.3000300@science.unitn.it>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070710/8cabcd97/attachment.pl>

From e.pebesma at geo.uu.nl  Tue Jul 10 11:21:37 2007
From: e.pebesma at geo.uu.nl (Edzer J. Pebesma)
Date: Tue, 10 Jul 2007 11:21:37 +0200
Subject: [R-sig-Geo] Cell Declustering
In-Reply-To: <4693371F.3000300@science.unitn.it>
References: <4693371F.3000300@science.unitn.it>
Message-ID: <46934FA1.9010608@geo.uu.nl>

Stefano,

I thought cell declustering meant finding the size of the region of 
influence for an observation and using that as weight in further 
analysis. An approach would be using voronoi diagrams (package deldir, 
and read the list archives), another using the number of nearest cells 
based on a regular discretization of the study area; for the latter you 
could misuse package gstat, interpolate record number with nmax=1 and 
compute a table of the resulting "prediction" grid. Ask me if you need 
an example.

The description you give sounds like spatial stratfied sampling, and can 
be accomplished by method spsample in package sp, type = "stratified".
--
Edzer

Stefano Pegoretti wrote:
> Dear List,
>     I have to perform a "cell spatial declustering" on my radon data,
> i.e. divide the study domain into a defined number of cell and for each
> of them randomly extracts a defined number of samples: does anybody know
> if there are function or packages in R to quickly to this?
>     Thanks, and have a good day!
>
>   
> ------------------------------------------------------------------------
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



From Agustin.Lobo at ija.csic.es  Tue Jul 10 12:49:03 2007
From: Agustin.Lobo at ija.csic.es (Agustin Lobo)
Date: Tue, 10 Jul 2007 12:49:03 +0200
Subject: [R-sig-Geo] Distmap: the way I could do it
Message-ID: <4693641F.4070305@ija.csic.es>

Finally, I've given up
using distmap on an object imported
from a shp file. Could not solve the casting
problem from the sp object to the owin object.

I've rasterized the vector prior to importing to R
and this is the way I calculate the distmap and export it.

refG25 <- readGDAL("GFOEOABUFActi25.tif")
a <- as.image.SpatialGridDataFrame(refG25) #here proj info is lost
ai <- as.im(a)
ai$v[ai$v==0]<-NA #0 values in the raster are the background
adist <- distmap(as.owin(ai))
adistlog <- adist
adistlog$v <- log(adistlog$v+1) #log transform

#Export works but Global Mapper claims there is no Datum
#TNT claims there is no Gereferenciation at all (not true!)
adistlogim <- as.SpatialGridDataFrame.im(adistlog)
adistlogim at proj4string <- refG25b at proj4string #Recover proj info
writeGDAL(adistlogim, "GFODISTLOG.tif", drivername = "GTiff", type = 
"Float32", mvFlag = NA, options=NULL)

#Another alternative, same result: Datum is lost
GFODISTLOG <- refG25
GFODISTLOG at data$band1 <- adistlogim at data$v
writeGDAL(GFODISTLOG, "GFODISTLOG.tif", drivername = "GTiff", type = 
"Float32", mvFlag = NA, options=NULL)

Hope this helps somebody else. Please let me know if you think of
a better way.

Agus
-- 
Dr. Agustin Lobo
Institut de Ciencies de la Terra "Jaume Almera" (CSIC)
LLuis Sole Sabaris s/n
08028 Barcelona
Spain
Tel. 34 934095410
Fax. 34 934110012
email: Agustin.Lobo at ija.csic.es
http://www.ija.csic.es/gt/obster



From milton_ruser at yahoo.com.br  Tue Jul 10 13:51:12 2007
From: milton_ruser at yahoo.com.br (Milton Cezar Ribeiro)
Date: Tue, 10 Jul 2007 04:51:12 -0700 (PDT)
Subject: [R-sig-Geo] Crossing native ArcGis GRID with a XY coordinate table
Message-ID: <151932.81076.qm@web56615.mail.re3.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070710/d6d54876/attachment.pl>

From albrecht.gebhardt at uni-klu.ac.at  Tue Jul 10 16:09:15 2007
From: albrecht.gebhardt at uni-klu.ac.at (Albrecht Gebhardt)
Date: Tue, 10 Jul 2007 16:09:15 +0200
Subject: [R-sig-Geo] library(shapefiles): write PolyLineZ or PolygonZ shapes?
Message-ID: <4693930B.5040202@uni-klu.ac.at>

hi,

I'm trying to write some 3D polygoins as ESRI shapefile.

While write.shp() has some code for type==13 or 15 (which is PolyLineZ
and PolygonZ), there is no such part in convert.to.shapefile().

example:

first generate some X,Y,Z data and triangulate it (only X and Y):

library(tripack)
xyz<-as.data.frame(cbind(runif(5),runif(5),rnorm(5)))
colnames(xyz)<-c("x","y","z")
t<-tri.mesh(xyz$x,xyz$y)
tr<-triangles(t)
# generate one polyline per triangle:
Id <- NULL; X <- NULL; Y <- NULL; Z <- NULL
for(i in 1:dim(tr)[1]) {
  Id <- c(Id,rep(i,3))
  X <- c(X, xyz$x[tr[i,1]], xyz$x[tr[i,2]], xyz$x[tr[i,3]])
  Y <- c(Y, xyz$y[tr[i,1]], xyz$y[tr[i,2]], xyz$y[tr[i,3]])
  Z <- c(Z, xyz$z[tr[i,1]], xyz$z[tr[i,2]], xyz$z[tr[i,3]])
}
dd <- data.frame(Id=Id,X=X,Y=Y, Z=Z)

dd contains now something like (three triangles):

  Id          X         Y          Z
1  1 0.47578460 0.7062264  1.7720352
2  1 0.07356501 0.6989611 -0.3850338
3  1 0.24476600 0.2560522  0.5450287
4  2 0.47578460 0.7062264  1.7720352
5  2 0.24476600 0.2560522  0.5450287
6  2 0.47912981 0.2355883 -0.2675531
7  3 0.47578460 0.7062264  1.7720352
8  3 0.47912981 0.2355883 -0.2675531
9  3 0.78672806 0.3244467  0.8620736

If I now try (in analogy to the write.shapefile PolyLine example)

library(shapefiles)
ddTable <- data.frame(Id=1:dim(tr)[1], Name=as.character(1:dim(tr)[1]))
ddShapefile <- convert.to.shapefile(dd, ddTable, "Id", 13)
write.shapefile(ddShapefile, "~/test/tri", arcgis=TRUE)

I get an error:

Fehler in "dimnames<-.data.frame"(`*tmp*`, value = list(c("1", "2", "3",  :
    ung?ltige 'dimnames' f?r data frame gegeben   # invalid dimnames

Now I tried to modify convert.to.shapefile() (see attachement) so that
it somehow handles the type==13/15 case (but it contains some blind
guesses regarding the content.sizes, I should read
http://www.esri.com/library/whitepapers/pdfs/shapefile.pdf more
precisely) and then at least it runs:

ddShapefile <- my.convert.to.shapefile(dd, ddTable, "Id", 13)
write.shapefile(ddShapefile, "~/test/tri", arcgis=TRUE)

I can even re-read this file with

f <- read.shapefile("~/test/tri")

and "f" looks identical (but I didnt compare it bit by bit) to
"ddShapefile"

But GRASS doesn't like it, it only reads the first triangle:

GRASS 6.0.1 (import_xy):~ > v.in.ogr dsn=~/test/tri.shp
output=tri_import min_area=0.0001 snap=-1 -z
Projection of input dataset and current location appear to match.
Proceeding with import...
Layer: tri
WARNING: 2 features without geometry.
-----------------------------------------------------
Building topology ...
1 primitives registered
Building areas:  100%
0 areas built
0 isles built
Attaching islands:
Attaching centroids:  100%
Topology was built.
Number of nodes     :   2
Number of primitives:   1
Number of points    :   0
Number of lines     :   1
Number of boundaries:   0
Number of centroids :   0
Number of areas     :   0
Number of isles     :   0





So my question is:

Is it really necessary to extend functionality of convert.to.shapefile()
to be able to write 3D polygons/polylines or am I simply missing the
correct function?



Thanks

Albrecht
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: my.convert.to.shapefile.R
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070710/02383d65/attachment.pl>

From lisbethii at yahoo.com  Mon Jul  9 14:40:30 2007
From: lisbethii at yahoo.com (Lisbeth Riis)
Date: Mon, 9 Jul 2007 05:40:30 -0700 (PDT)
Subject: [R-sig-Geo] Anisotropy How many metres in a day
Message-ID: <660445.49380.qm@web45208.mail.sp1.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070709/e3e7aa96/attachment.pl>

From e.pebesma at geo.uu.nl  Tue Jul 10 22:27:54 2007
From: e.pebesma at geo.uu.nl (Edzer J. Pebesma)
Date: Tue, 10 Jul 2007 22:27:54 +0200
Subject: [R-sig-Geo] Cell Declustering
In-Reply-To: <4693A52D.1020702@science.unitn.it>
References: <4693371F.3000300@science.unitn.it> <46934FA1.9010608@geo.uu.nl>
	<4693A52D.1020702@science.unitn.it>
Message-ID: <4693EBCA.2020802@geo.uu.nl>

Stefano, sorry for my rudeness to forward your private reply to r-sig-geo.

A quick and dirty answer would be to work with grids, and e.g. retain a 
single value in each grid cell.  Does anyone more familiar with the 
point pattern theory know of a more elegant way that does not need all 
kind of ad hoc grid choices? I believe the problem is thinning of a data 
set in areas where data are redundant.
--
Edzer

Stefano Pegoretti wrote:
> Dear Edzer,
>     many thanks for your very quick answer! Here is my "problem": I 
> have a large dataset of georeferenced samples, and I want to get a 
> smaller subset that must reproduce the same spatial pattern of the 
> biggest one; say it in another way, I want to "through away" randomly 
> some data, but honouring the spatial distribution of the starting 
> dataset. I don't know it's clear enough... :-P
>
>     Have a nice evening!
>
> stefano
>
>
> Edzer J. Pebesma ha scritto:
>> Stefano,
>>
>> I thought cell declustering meant finding the size of the region of 
>> influence for an observation and using that as weight in further 
>> analysis. An approach would be using voronoi diagrams (package 
>> deldir, and read the list archives), another using the number of 
>> nearest cells based on a regular discretization of the study area; 
>> for the latter you could misuse package gstat, interpolate record 
>> number with nmax=1 and compute a table of the resulting "prediction" 
>> grid. Ask me if you need an example.
>>
>> The description you give sounds like spatial stratfied sampling, and 
>> can be accomplished by method spsample in package sp, type = 
>> "stratified".
>> -- 
>> Edzer
>>
>> Stefano Pegoretti wrote:
>>> Dear List,
>>>     I have to perform a "cell spatial declustering" on my radon data,
>>> i.e. divide the study domain into a defined number of cell and for each
>>> of them randomly extracts a defined number of samples: does anybody 
>>> know
>>> if there are function or packages in R to quickly to this?
>>>     Thanks, and have a good day!
>>>
>>>   
>>> ------------------------------------------------------------------------ 
>>>
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>



From jsanchez at upei.ca  Wed Jul 11 02:59:03 2007
From: jsanchez at upei.ca (Javier Sanchez)
Date: Tue, 10 Jul 2007 21:59:03 -0300
Subject: [R-sig-Geo] out of the office (was: R-sig-Geo Digest, Vol 47,
	Issue 4)
Message-ID: <46942B57.4020206@upei.ca>

An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070710/a3a392f7/attachment.html>

From jsanchez at upei.ca  Wed Jul 11 03:00:17 2007
From: jsanchez at upei.ca (Javier Sanchez)
Date: Tue, 10 Jul 2007 22:00:17 -0300
Subject: [R-sig-Geo] out of the office (was: R-sig-Geo Digest, Vol 47,
	Issue 7)
Message-ID: <46942BA1.7030809@upei.ca>

An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070710/171abf02/attachment.html>

From jsanchez at upei.ca  Wed Jul 11 03:01:32 2007
From: jsanchez at upei.ca (Javier Sanchez)
Date: Tue, 10 Jul 2007 22:01:32 -0300
Subject: [R-sig-Geo] out of the office (was: R-sig-Geo Digest, Vol 47,
	Issue 5)
Message-ID: <46942BEC.6020104@upei.ca>

An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070710/d98e955b/attachment.html>

From jsanchez at upei.ca  Wed Jul 11 03:16:10 2007
From: jsanchez at upei.ca (Javier Sanchez)
Date: Tue, 10 Jul 2007 22:16:10 -0300
Subject: [R-sig-Geo] out of the office (was: R-sig-Geo Digest, Vol 46,
	Issue 26)
Message-ID: <46942F5A.5090801@upei.ca>

An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070710/d02e72ac/attachment.html>

From jsanchez at upei.ca  Wed Jul 11 03:16:48 2007
From: jsanchez at upei.ca (Javier Sanchez)
Date: Tue, 10 Jul 2007 22:16:48 -0300
Subject: [R-sig-Geo] out of the office (was: R-sig-Geo Digest, Vol 47,
	Issue 1)
Message-ID: <46942F80.6090709@upei.ca>

An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070710/295a440f/attachment.html>

From jsanchez at upei.ca  Wed Jul 11 03:17:37 2007
From: jsanchez at upei.ca (Javier Sanchez)
Date: Tue, 10 Jul 2007 22:17:37 -0300
Subject: [R-sig-Geo] out of the office (was: R-sig-Geo Digest, Vol 47,
	Issue 2)
Message-ID: <46942FB1.6040308@upei.ca>

An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070710/01d361ce/attachment.html>

From jsanchez at upei.ca  Wed Jul 11 03:21:15 2007
From: jsanchez at upei.ca (Javier Sanchez)
Date: Tue, 10 Jul 2007 22:21:15 -0300
Subject: [R-sig-Geo] out of the office (was: R-sig-Geo Digest, Vol 47,
	Issue 6)
Message-ID: <4694308B.90200@upei.ca>

An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070710/3d45b47f/attachment.html>

From jsanchez at upei.ca  Wed Jul 11 03:22:14 2007
From: jsanchez at upei.ca (Javier Sanchez)
Date: Tue, 10 Jul 2007 22:22:14 -0300
Subject: [R-sig-Geo] out of the office (was: R-sig-Geo Digest, Vol 47,
	Issue 3)
Message-ID: <469430C6.3040605@upei.ca>

An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070710/63f36115/attachment.html>

From tskam at smu.edu.sg  Wed Jul 11 04:33:32 2007
From: tskam at smu.edu.sg (KAM Tin Seong)
Date: Wed, 11 Jul 2007 10:33:32 +0800
Subject: [R-sig-Geo] Large dataset
Message-ID: <FA3090E732DC6A4EB8E2D875EEB486A562CC9A@EX01.staff.smu.edu.sg>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070711/8cdb3e44/attachment.pl>

From e.pebesma at geo.uu.nl  Wed Jul 11 08:56:14 2007
From: e.pebesma at geo.uu.nl (Edzer J. Pebesma)
Date: Wed, 11 Jul 2007 08:56:14 +0200
Subject: [R-sig-Geo] [R] Plot SpatialLinesDataFrame with xlim & ylim
Message-ID: <46947F0E.9020102@geo.uu.nl>

Michael,

The plot method for SpatialLinesDataFrame objects resides in package sp, 
and questions regarding it are easier noticed on the r-sig-geo mailing 
list.

The reason why they are plotted with aspect ratio 1 is that they are 
assumed to be spatial (geographical) data, and assume that 1 m north 
equals 1 m west -- think of a map. The exception is when the projection 
argument is set to longlat data (i.e. decimal degrees North/East), where 
the aspect ratio is computed differently, such that the argument above 
more or less holds.

You should be able to override the default aspect setting by explicitly 
passing the e.g. asp=0.5 argument to plot.

Here's the comment in the documentation of plot for Spatial objects 
(such as SpatialLinesDataFrame):

The default aspect for map plots is 1; if however data are not projected 
(coordinates are longlat), the aspect is by default set to 1/cos(My * 
pi)/180) with My the y coordinate of the middle of the map (the mean of 
ylim, which defaults to the y range of bounding box).

The argument |setParUsrBB| may be used to pass the logical value |TRUE| 
to functions within |plot.Spatial|. When set to |TRUE|, par(?usr?) will 
be overwritten with |c(xlim, ylim)|, which defaults to the bounding box 
of the spatial object. This is only needed in the particular context of 
graphic output to a specified device with given width and height, to be 
matched to the spatial object, when using par(?xaxs?) and par(?yaxs?) in 
addition to |par(mar=c(0,0,0,0))|.
--

Edzer

I'm running windows xp, R 2.3.1 with maptools 0.6-6, I guess. 
When plotting from a large SpatialLinesDataFrame and using xlim & ylim to reduce the area, the plot axes automatically have the same scale size, even if xlim and ylim ranges differ.  
E.g.:
tmp <- readShapeLines(filepath)
plot(tmp,xlim=c(-126,-119),ylim=c(50,51))

The y-axis range is actually 47-54, same range as the x-axis.  What am I doing wrong?  Should I be using a different object for simple coastline & river data?
Thanks in advance!
Michael



From Roger.Bivand at nhh.no  Wed Jul 11 10:25:38 2007
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 11 Jul 2007 10:25:38 +0200 (CEST)
Subject: [R-sig-Geo] Large dataset
In-Reply-To: <FA3090E732DC6A4EB8E2D875EEB486A562CC9A@EX01.staff.smu.edu.sg>
References: <FA3090E732DC6A4EB8E2D875EEB486A562CC9A@EX01.staff.smu.edu.sg>
Message-ID: <Pine.LNX.4.64.0707111015530.31223@reclus.nhh.no>

On Wed, 11 Jul 2007, KAM Tin Seong wrote:

> Hi all, I have a large dataset of 360,000 sample points.  When I perform
> analysis using Khat function of splancs, the following error messages
> prompted:
>
> Error: cannot allocate vector of size 589.6 Mb
> In addition: Warning messages:
> 1: Reached total allocation of 1013Mb: see help(memory.size)
>
> It would be very much appreciated if someone could advice me how to
> overcome this problem.

The obvious first question is why? If you take a sample of 10000 points, 
you will get a very good approximation of the khat value at the s-bins - 
so why try all 360K? Either take tiles of your data set, or some other 
partition - since you are assuming anyway that the process is the same 
over the whole area, aren't you? You will certainly find that simulating 
from a CSR for 360K to put an envelope on the result will also be memory 
intensive.

By the way, always include your specific code, and the output of 
sessionInfo(). It may be that you have a very complex polygon windoe, 
and/or too much detail in the s-bins. Do you get the same memory 
constraint in spatstat, or equivalently in spatial?

I assume that you are looking to see if the point pattern is clustered, is 
that correct? If you really need to use all the points, we'd need to debug 
the command to see where the memory allocation is occurring, since it may 
be an avoidable copying operation somewhere. More RAM is another option.

Roger

> Dr Kam Tin Seong
> Practice Associate Professor
> School of Information Systems
>
> Singapore Management University
> 80 Stamford Road
> Singapore 178902
> e-mail: tskam at smu.edu.sg
> DID: + 65 6828 0932
>
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From Roger.Bivand at nhh.no  Wed Jul 11 10:30:00 2007
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 11 Jul 2007 10:30:00 +0200 (CEST)
Subject: [R-sig-Geo] [R] Plot SpatialLinesDataFrame with xlim & ylim
In-Reply-To: <46947F0E.9020102@geo.uu.nl>
References: <46947F0E.9020102@geo.uu.nl>
Message-ID: <Pine.LNX.4.64.0707111026020.31223@reclus.nhh.no>

On Wed, 11 Jul 2007, Edzer J. Pebesma wrote:

> Michael,
>
> The plot method for SpatialLinesDataFrame objects resides in package sp,
> and questions regarding it are easier noticed on the r-sig-geo mailing
> list.
>
> The reason why they are plotted with aspect ratio 1 is that they are
> assumed to be spatial (geographical) data, and assume that 1 m north
> equals 1 m west -- think of a map. The exception is when the projection
> argument is set to longlat data (i.e. decimal degrees North/East), where
> the aspect ratio is computed differently, such that the argument above
> more or less holds.
>
> You should be able to override the default aspect setting by explicitly
> passing the e.g. asp=0.5 argument to plot.
>
> Here's the comment in the documentation of plot for Spatial objects
> (such as SpatialLinesDataFrame):
>
> The default aspect for map plots is 1; if however data are not projected
> (coordinates are longlat), the aspect is by default set to 1/cos(My *
> pi)/180) with My the y coordinate of the middle of the map (the mean of
> ylim, which defaults to the y range of bounding box).
>
> The argument |setParUsrBB| may be used to pass the logical value |TRUE|
> to functions within |plot.Spatial|. When set to |TRUE|, par(?usr?) will
> be overwritten with |c(xlim, ylim)|, which defaults to the bounding box
> of the spatial object. This is only needed in the particular context of
> graphic output to a specified device with given width and height, to be
> matched to the spatial object, when using par(?xaxs?) and par(?yaxs?) in
> addition to |par(mar=c(0,0,0,0))|.


Yes, if you look at how the GE_SpatialGrid() function in maptools works - 
you'll see how it meddles with the actual regional extents and the device 
size. I think Michael's data should also have been set to longlat:

proj4string(tmp) <- CRS("+proj=longlat")

The key is realising that the axes are driven by the device shape, not by 
the xlim/ylim as such, as Edzer says.

Roger


> --
>
> Edzer
>
> I'm running windows xp, R 2.3.1 with maptools 0.6-6, I guess.
> When plotting from a large SpatialLinesDataFrame and using xlim & ylim to reduce the area, the plot axes automatically have the same scale size, even if xlim and ylim ranges differ.
> E.g.:
> tmp <- readShapeLines(filepath)
> plot(tmp,xlim=c(-126,-119),ylim=c(50,51))
>
> The y-axis range is actually 47-54, same range as the x-axis.  What am I doing wrong?  Should I be using a different object for simple coastline & river data?
> Thanks in advance!
> Michael
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From dray at biomserv.univ-lyon1.fr  Wed Jul 11 13:17:17 2007
From: dray at biomserv.univ-lyon1.fr (=?ISO-8859-1?Q?St=E9phane_Dray?=)
Date: Wed, 11 Jul 2007 13:17:17 +0200
Subject: [R-sig-Geo] OT : get lat-long coordinates
Message-ID: <4694BC3D.70508@biomserv.univ-lyon1.fr>

Dear list,

I have a question, not directly linked to R, but I hope that some people 
could help me. I have a paper, where there are some data that I would 
like to analyse with spatial tools. In the appendix of the paper, for 
each site, there are some data... but I do not have the spatial 
coordinates of sites, I have only the name of the site, e.g. : Blue 
Lake, WA 4. I would like to obtain coordinates (latitude and longitude) 
for these sites. All the sites are in USA and Canada. I have two questions :
- what means the number in the address ? eg. what "4" means in Blue 
Lake, WA 4 ?
- Do you know some sites/free tools that can be used to obtain the 
spatial coordinates ?

Thanks in advance,

Sincerely.


-- 
St?phane DRAY (dray at biomserv.univ-lyon1.fr )
Laboratoire BBE-CNRS-UMR-5558, Univ. C. Bernard - Lyon I
43, Bd du 11 Novembre 1918, 69622 Villeurbanne Cedex, France
Tel: 33 4 72 43 27 57       Fax: 33 4 72 43 13 88
http://biomserv.univ-lyon1.fr/~dray/



From paciorek at hsph.harvard.edu  Wed Jul 11 14:28:15 2007
From: paciorek at hsph.harvard.edu (Christopher Paciorek)
Date: Wed, 11 Jul 2007 08:28:15 -0400
Subject: [R-sig-Geo] OT : get lat-long coordinates
In-Reply-To: <4694BC3D.70508@biomserv.univ-lyon1.fr>
References: <4694BC3D.70508@biomserv.univ-lyon1.fr>
Message-ID: <469493CB.10CD.002E.0@hsph.harvard.edu>

Hi St?phane,

For US locations, you might try www.nationalatlas.gov, click on MapMaker (upper left) and then 'Find' (upper right). 
It allows you to search by name of geographic features. I've found some small ponds by name and state using this.

-chris

 ----------------------------------------------------------------------------------------------
Chris Paciorek / Asst. Professor        Email: paciorek at hsph.harvard.edu
Department of Biostatistics             Voice: 617-432-4912
Harvard School of Public Health         Fax:   617-432-5619
655 Huntington Av., Bldg. 2-407         WWW: www.biostat.harvard.edu/~paciorek
Boston, MA 02115 USA                    Permanent forward: paciorek at alumni.cmu.edu

 
>>> St?phane Dray <dray at biomserv.univ-lyon1.fr> 07/11/07 7:17 AM >>> 
Dear list,

I have a question, not directly linked to R, but I hope that some people 
could help me. I have a paper, where there are some data that I would 
like to analyse with spatial tools. In the appendix of the paper, for 
each site, there are some data... but I do not have the spatial 
coordinates of sites, I have only the name of the site, e.g. : Blue 
Lake, WA 4. I would like to obtain coordinates (latitude and longitude) 
for these sites. All the sites are in USA and Canada. I have two questions :
-  what means the number in the address ? eg. what "4" means in Blue 
Lake, WA 4 ?
-  Do you know some sites/free tools that can be used to obtain the 
spatial coordinates ?

Thanks in advance,

Sincerely.


--  
St?phane DRAY (dray at biomserv.univ- lyon1.fr )
Laboratoire BBE- CNRS- UMR- 5558, Univ. C. Bernard -  Lyon I
43, Bd du 11 Novembre 1918, 69622 Villeurbanne Cedex, France
Tel: 33 4 72 43 27 57       Fax: 33 4 72 43 13 88
http://biomserv.univ- lyon1.fr/~dray/

_______________________________________________
R- sig- Geo mailing list
R- sig- Geo at stat.math.ethz.ch
https://stat.ethz.ch/mailman/listinfo/r- sig- geo



From landis at isciences.com  Wed Jul 11 16:04:40 2007
From: landis at isciences.com (Matthew Landis)
Date: Wed, 11 Jul 2007 10:04:40 -0400
Subject: [R-sig-Geo] reading img files with rgdal
Message-ID: <4694E378.2040304@isciences.com>

Dear R-sig-Geo,

I'm trying to get started with rgdal, and not having much luck so far.  
I'm running R 2.5.0 on an i386-pc-mingw32 with rgdal 0.5-9 and sp 0.9-14. 

For starters, I'd like to read in an .img file created in ArcGIS 9.2. As 
you can see below, the file is a global map in geographic coordinates 
with 0.5 degree resolution.

 > GDALinfo('swe20070615.img')
Closing GDAL dataset handle 0x020d8660...  destroyed ... done.
rows        360
columns     720
bands       1
ll.x        -180
ll.y        90.0321
res.x       0.5
res.y       0.5
oblique.x   0
oblique.y   0
driver      HFA
projection  +proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs
file        swe20070615.img

The result of readGDAL is initially promising, but ultimately fails, 
apparently due to a problem with the projection.

 > test <- readGDAL('swe20070615.img')
swe20070615.img has GDAL driver HFA
and has 360 rows and 720 columns
Closing GDAL dataset handle 0x056988a8...  destroyed ... done.
Closing GDAL dataset handle (nil)... done.
Closing GDAL dataset handle 0x020dade8...  destroyed ... done.
Closing GDAL dataset handle 0x05699470...  destroyed ... done.
Error in `proj4string<-`(`*tmp*`, value = <S4 object of class "CRS">) :
        Geographical CRS given to non-conformant data
 > str(test)
Error in str(test) : object "test" not found

Can anyone suggest what might be going wrong and how to fix it?

In addition, I've had some trouble finding a good point of entry for how 
to use rgdal.  I have checked the standard documentation in the R help 
files and the GDAL websites, but having a bit of trouble penetrating it 
all.  If anyone can point me to a concise overview of how to use rgdal, 
I'd be most grateful.

Many thanks in advance,

Sincerely,

Matt Landis

-- 
**********************************
Matthew Landis
Research Analyst
Isciences, LLC
61 Main St., Suite 200
Burlington VT 05401 USA



From Roger.Bivand at nhh.no  Wed Jul 11 16:56:01 2007
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 11 Jul 2007 16:56:01 +0200 (CEST)
Subject: [R-sig-Geo] reading img files with rgdal
In-Reply-To: <4694E378.2040304@isciences.com>
References: <4694E378.2040304@isciences.com>
Message-ID: <Pine.LNX.4.64.0707111648530.31223@reclus.nhh.no>

On Wed, 11 Jul 2007, Matthew Landis wrote:

> Dear R-sig-Geo,
>
> I'm trying to get started with rgdal, and not having much luck so far.
> I'm running R 2.5.0 on an i386-pc-mingw32 with rgdal 0.5-9 and sp 0.9-14.
>
> For starters, I'd like to read in an .img file created in ArcGIS 9.2. As
> you can see below, the file is a global map in geographic coordinates
> with 0.5 degree resolution.
>
> > GDALinfo('swe20070615.img')
> Closing GDAL dataset handle 0x020d8660...  destroyed ... done.
> rows        360
> columns     720
> bands       1
> ll.x        -180
> ll.y        90.0321

This is the problem, since > 90N is not defined for geographical 
coordinates, and leads to the projection being rejected. Why Arc wants to 
believe in > 90N is probably not known. If you can find out where the fuzz 
is coming from, perhaps you can remove it?  If correcting the data is not 
an option, please ask again, and a work-round may be possible (reading the 
data without its projection information, and placing it in a correct 
grid).

Roger

> res.x       0.5
> res.y       0.5
> oblique.x   0
> oblique.y   0
> driver      HFA
> projection  +proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs
> file        swe20070615.img
>
> The result of readGDAL is initially promising, but ultimately fails,
> apparently due to a problem with the projection.
>
> > test <- readGDAL('swe20070615.img')
> swe20070615.img has GDAL driver HFA
> and has 360 rows and 720 columns
> Closing GDAL dataset handle 0x056988a8...  destroyed ... done.
> Closing GDAL dataset handle (nil)... done.
> Closing GDAL dataset handle 0x020dade8...  destroyed ... done.
> Closing GDAL dataset handle 0x05699470...  destroyed ... done.
> Error in `proj4string<-`(`*tmp*`, value = <S4 object of class "CRS">) :
>        Geographical CRS given to non-conformant data
> > str(test)
> Error in str(test) : object "test" not found
>
> Can anyone suggest what might be going wrong and how to fix it?
>
> In addition, I've had some trouble finding a good point of entry for how
> to use rgdal.  I have checked the standard documentation in the R help
> files and the GDAL websites, but having a bit of trouble penetrating it
> all.  If anyone can point me to a concise overview of how to use rgdal,
> I'd be most grateful.
>
> Many thanks in advance,
>
> Sincerely,
>
> Matt Landis
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From Agustin.Lobo at ija.csic.es  Wed Jul 11 17:01:41 2007
From: Agustin.Lobo at ija.csic.es (Agustin Lobo)
Date: Wed, 11 Jul 2007 17:01:41 +0200
Subject: [R-sig-Geo] readOGR and nonASCII character
Message-ID: <4694F0D5.6090009@ija.csic.es>

Hi list,

Is there any way to get readOGR() to correctly read
non-ascii character strings from the dbf file? I've
checked and my dbf file correctly displays
names with accents, but once read into R
accents are substituted by wrong symbols.

Agus

-- 
Dr. Agustin Lobo
Institut de Ciencies de la Terra "Jaume Almera" (CSIC)
LLuis Sole Sabaris s/n
08028 Barcelona
Spain
Tel. 34 934095410
Fax. 34 934110012
email: Agustin.Lobo at ija.csic.es
http://www.ija.csic.es/gt/obster



From landis at isciences.com  Wed Jul 11 21:45:11 2007
From: landis at isciences.com (Matthew Landis)
Date: Wed, 11 Jul 2007 15:45:11 -0400
Subject: [R-sig-Geo] reading img files with rgdal
In-Reply-To: <Pine.LNX.4.64.0707111648530.31223@reclus.nhh.no>
References: <4694E378.2040304@isciences.com>
	<Pine.LNX.4.64.0707111648530.31223@reclus.nhh.no>
Message-ID: <46953347.1030107@isciences.com>

Dear Roger,

Many thanks for your rapid reply!  I guess I was so caught up in the 
details of rgdal that I completely failed to see that obvious problem.   
I've  managed to fix the coordinates, and now rgdal reads the image just 
fine. 

I'm still searching for a good overview of rgdal or gdal though - any 
pointers would be wonderful.

Sincerely,

Matt


Roger Bivand wrote:
> On Wed, 11 Jul 2007, Matthew Landis wrote:
>
>> Dear R-sig-Geo,
>>
>> I'm trying to get started with rgdal, and not having much luck so far.
>> I'm running R 2.5.0 on an i386-pc-mingw32 with rgdal 0.5-9 and sp 
>> 0.9-14.
>>
>> For starters, I'd like to read in an .img file created in ArcGIS 9.2. As
>> you can see below, the file is a global map in geographic coordinates
>> with 0.5 degree resolution.
>>
>> > GDALinfo('swe20070615.img')
>> Closing GDAL dataset handle 0x020d8660...  destroyed ... done.
>> rows        360
>> columns     720
>> bands       1
>> ll.x        -180
>> ll.y        90.0321
>
> This is the problem, since > 90N is not defined for geographical 
> coordinates, and leads to the projection being rejected. Why Arc wants 
> to believe in > 90N is probably not known. If you can find out where 
> the fuzz is coming from, perhaps you can remove it?  If correcting the 
> data is not an option, please ask again, and a work-round may be 
> possible (reading the data without its projection information, and 
> placing it in a correct grid).
>
> Roger
>
>> res.x       0.5
>> res.y       0.5
>> oblique.x   0
>> oblique.y   0
>> driver      HFA
>> projection  +proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs
>> file        swe20070615.img
>>
>> The result of readGDAL is initially promising, but ultimately fails,
>> apparently due to a problem with the projection.
>>
>> > test <- readGDAL('swe20070615.img')
>> swe20070615.img has GDAL driver HFA
>> and has 360 rows and 720 columns
>> Closing GDAL dataset handle 0x056988a8...  destroyed ... done.
>> Closing GDAL dataset handle (nil)... done.
>> Closing GDAL dataset handle 0x020dade8...  destroyed ... done.
>> Closing GDAL dataset handle 0x05699470...  destroyed ... done.
>> Error in `proj4string<-`(`*tmp*`, value = <S4 object of class "CRS">) :
>>        Geographical CRS given to non-conformant data
>> > str(test)
>> Error in str(test) : object "test" not found
>>
>> Can anyone suggest what might be going wrong and how to fix it?
>>
>> In addition, I've had some trouble finding a good point of entry for how
>> to use rgdal.  I have checked the standard documentation in the R help
>> files and the GDAL websites, but having a bit of trouble penetrating it
>> all.  If anyone can point me to a concise overview of how to use rgdal,
>> I'd be most grateful.
>>
>> Many thanks in advance,
>>
>> Sincerely,
>>
>> Matt Landis
>>
>>
>



From knussear at usgs.gov  Thu Jul 12 14:39:03 2007
From: knussear at usgs.gov (Ken Nussear)
Date: Thu, 12 Jul 2007 05:39:03 -0700
Subject: [R-sig-Geo] help with  likfit.glsm in package geoRglm
In-Reply-To: <mailman.19.1184234408.20964.r-sig-geo@stat.math.ethz.ch>
References: <mailman.19.1184234408.20964.r-sig-geo@stat.math.ethz.ch>
Message-ID: <69714EDC-C029-4BB7-8020-D14FA5E2185C@usgs.gov>

I'm trying to fit parameters in a spatial model using likfit.glsm and  
I'm getting an error. I wonder if anyone out there can help me figure  
out how to fix it.

the object WMgeo is a geospatial dataset and I have run successful  
models using likfit in the geoR package. I just cant get this one to go.

Please help!

 > WMmcmccontrl4 <- mcmc.control(S.scale = .00015, thin=1, phi.scale  
= 0.01)
 > WMliktrend4 <- trend.spatial(~TRAN_LNTH + GRSPSTBG + STAll, WMgeo)
 > WMmcmcmodel4 <- list(cov.pars = c(1,1), beta = c(1,1,1,1),  
family="binomial", trend= WMliktrend4)
 > WMmcmctest4 <- glsm.mcmc(WMgeo, model = WMmcmcmodel4,  
mcmc.input=WMmcmccontrl4)
iter. numb. 1000  : Acc.-rate =  0.66
MCMC performed: n.iter. =  1000 ; thinning =  1 ; burn.in =  0
 > WMmcmcprep4 <- prepare.likfit.glsm(WMmcmctest4, use.intensity=FALSE)
 > WMmcmclikfit4 <- likfit.glsm(WMmcmcprep4, cov.model="spherical",  
ini.phi=.1)
--------------------------------------------------------------------
likfit.glsm: likelihood maximisation using the function optim.
phi =  0.1 tausq.rel =  0
    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.
       0       0       0     Inf     Inf     Inf
Error in .func.val(SivS, SivD, DivD, beta.hat[ll, ], sigmasq.hat[ll],  :
	Some function values are not finite




Ken

--
Kenneth E. Nussear
Research Herpetologist, USGS
(702) 564-4515  Fax  (702) 564-4600
knussear at usgs.gov



From v.gomezrubio at imperial.ac.uk  Thu Jul 12 16:21:24 2007
From: v.gomezrubio at imperial.ac.uk (Virgilio Gomez-Rubio)
Date: Thu, 12 Jul 2007 15:21:24 +0100
Subject: [R-sig-Geo] [Fwd: One-day introductory course on spatial data
	analysis with	the R programming language]
Message-ID: <1184250084.27375.33.camel@fh-vrubio>

Dear all,

Apologies for this off-topic, but I thought this one-day course could be
of interest to the subscribers of this list. Please, reply to me and not
to the list if you are interested.

Best regards,

Virgilio

-------- Forwarded Message --------
Subject: One-day introductory course on spatial data analysis with the R
programming language
Date: Wed, 11 Jul 2007 18:23:36 +0100

ONE-DAY INTRODUCTORY COURSE ON SPATIAL DATA ANALYSIS WITH THE R
PROGRAMMING LANGUAGE

Faculty of Medicine 
Imperial College London 
St. Mary's Campus, London


9:00 - 17:00, 31 August 2007


*) Course outline

This one-day introductory course is aimed at researchers which have to
deal with the analysis of spatial data. The course will tackle  the
problem of analysing spatial data with the R programming language.
Different types of spatial data will be covered, such as point patterns,
lattice data and data coming from irregular measurements of continuos
processes (geostatistics). In addition, different worked examples will
be presented showing how to proceed with the analysis of a wide range of
spatial data sets.

The topics of the course will contain an introduction to various R
packages for the analysis of spatial data.  This includes data
import/export, data management and visualisation, and how to fit a broad
range of models for spatial data.  The worked examples will focus on
particular real data sets from Epidemiology, Environmental Sciences,
Ecology, Economics and others. 

Although most of the lectures will include live demonstrations of the
software, a working knowledge of the R software is desirable to follow
the examples. R is distributed as free software, and it can be
downloaded from http://cran.r-project.org .  Similarly, the course will
introduce the statistical concepts behind the analysis, but a basic
knowledge of statistics and regression analysis will be necessary.

The course will take place in the Hynds Computer Lab of the Faculty of
Medicine and the participants will be able to use these facilities. Note
that the course will take at the facilities of the Faculty of Medicine,
Imperial College London at St. Mary's Campus, and NOT at the main campus
in South Kensington.

The complete address is 

Faculty of Medicine
Imperial College London
St. Mary's Campus, Norfolk Place
W2 1PG London - UK

More information on how to arrive can be found at 

http://www1.imperial.ac.uk/medicine/contacts/campuses/stmarys/


This course is part of the ESRC National Centre for Research Methods
training activities and there are discount fees for ESRC-funded
researchers.



*) Summary of course contents

- Why spatial data in R? (0930-1000)
- Representing Spatial Data (1000-1030)
- Vizualising Spatial Data (1045-1115)
- Accessing spatial data (1115-1200)
- Worked example: Geostatistics (1400-1430)
- Worked example: Point Patterns (1430-1500)
- Worked example: Spatial Weights, Autocorrelation (1500-1530)
- Worked examples: Disease Mapping (1545-1615)
- Worked examples: Disease Mapping II (1615-1645)
- Worked example: Small Area Estimation (1645-1715)




*) Summary of course instructors

Prof. Roger Bivand, Norwegian School of Economics and Business
Administration
Dr. Virgilio G?mez-Rubio (course organiser), Imperial College London



*) Booking and course fees

Fees for the course are as follows: 

?20 or postgraduate students registered at UK academic institutions

?40 for staff at UK academic institutions, ESRC-funded researchers and
researchers from charity organisations 

?175 for all other participants

This includes the course materials, refreshment and a buffet lunch. In
order to book a place for the course, you should contact Virgilio
Gomez-Rubio  (v.gomezrubio at imperial.ac.uk).



*) More Info 

Additional information on the analysis of spatial data with R, including
a gallery of figures, can be found via 
http://cran.r-project.org/src/contrib/Views/Spatial.html.

You can find more information about the course at the following web
site:
   http://www.bias-project.org.uk



From debarchana.ghosh at gmail.com  Thu Jul 12 23:39:51 2007
From: debarchana.ghosh at gmail.com (Debarchana Ghosh)
Date: Thu, 12 Jul 2007 16:39:51 -0500
Subject: [R-sig-Geo] Spatial autocorrelation of binary data
Message-ID: <d1b8ff630707121439i300d9949w8bde3c503cd41a6b@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070712/92b7ebeb/attachment.pl>

From knussear at mac.com  Fri Jul 13 06:53:25 2007
From: knussear at mac.com (Ken Nussear)
Date: Thu, 12 Jul 2007 21:53:25 -0700
Subject: [R-sig-Geo] Spatial autocorrelation of binary data
Message-ID: <C6E4F0BA-A7B1-4EC1-B98D-464D3B6F6F4F@mac.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070712/560198c1/attachment.pl>

From knussear at mac.com  Fri Jul 13 06:55:21 2007
From: knussear at mac.com (Ken Nussear)
Date: Thu, 12 Jul 2007 21:55:21 -0700
Subject: [R-sig-Geo] help with likfit.glsm in package geoRglm
Message-ID: <14E18E96-0A5C-481A-B58A-4DE3AE12399D@mac.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070712/a582f98c/attachment.pl>

From dray at biomserv.univ-lyon1.fr  Fri Jul 13 10:08:14 2007
From: dray at biomserv.univ-lyon1.fr (=?UTF-8?B?U3TDqXBoYW5lIERyYXk=?=)
Date: Fri, 13 Jul 2007 10:08:14 +0200
Subject: [R-sig-Geo] Spatial autocorrelation of binary data
In-Reply-To: <d1b8ff630707121439i300d9949w8bde3c503cd41a6b@mail.gmail.com>
References: <d1b8ff630707121439i300d9949w8bde3c503cd41a6b@mail.gmail.com>
Message-ID: <469732EE.9050604@biomserv.univ-lyon1.fr>

Try spdep :
 > library(spdep)
 > apropos("joincount")
[1] "joincount.mc"    "joincount.multi" "joincount.test"

Cheers,

Debarchana Ghosh wrote:
> Hello,
>
> Is there any function in R which can do spatial autocorrelation of binary
> data or Joint-Count statistics? The data is in the format 1 and 0.
>
> Thanks in advance,
> Debs.
>
>   


-- 
St?phane DRAY (dray at biomserv.univ-lyon1.fr )
Laboratoire BBE-CNRS-UMR-5558, Univ. C. Bernard - Lyon I
43, Bd du 11 Novembre 1918, 69622 Villeurbanne Cedex, France
Tel: 33 4 72 43 27 57       Fax: 33 4 72 43 13 88
http://biomserv.univ-lyon1.fr/~dray/



From carlosguerra at esa.ipvc.pt  Fri Jul 13 16:08:43 2007
From: carlosguerra at esa.ipvc.pt (Carlos Guerra)
Date: Fri, 13 Jul 2007 15:08:43 +0100
Subject: [R-sig-Geo] deleting duplicates on a geodata object
Message-ID: <4697876B.9010106@esa.ipvc.pt>

Dear friends,
I am wondering if there is a quick method for deleting duplicates on a 
geodata object...
Can anyone point me in the right direction??

Best regards,
Carlos



From paulojus at c3sl.ufpr.br  Fri Jul 13 16:44:16 2007
From: paulojus at c3sl.ufpr.br (Paulo Justiniano Ribeiro Jr)
Date: Fri, 13 Jul 2007 11:44:16 -0300 (BRT)
Subject: [R-sig-Geo] deleting duplicates on a geodata object
In-Reply-To: <4697876B.9010106@esa.ipvc.pt>
References: <4697876B.9010106@esa.ipvc.pt>
Message-ID: <Pine.LNX.4.58.0707131142080.30293@talisker.c3sl.ufpr.br>

Hi Carlos

Yes, there are methods for dup() and duplicates() in geoR, for data of
class "geodata":

?dup.coords
?duplicated.geodata


Paulo Justiniano Ribeiro Jr
LEG (Laborat?rio de Estat?stica e Geoinforma??o)
Universidade Federal do Paran?
Caixa Postal 19.081
CEP 81.531-990
Curitiba, PR  -  Brasil
Tel: (+55) 41 3361 3573
Fax: (+55) 41 3361 3141
e-mail: paulojus AT  ufpr  br
http://www.leg.ufpr.br/~paulojus

On Fri, 13 Jul 2007, Carlos Guerra wrote:

> Dear friends,
> I am wondering if there is a quick method for deleting duplicates on a
> geodata object...
> Can anyone point me in the right direction??
>
> Best regards,
> Carlos
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



From landis at isciences.com  Fri Jul 13 16:59:49 2007
From: landis at isciences.com (Matthew Landis)
Date: Fri, 13 Jul 2007 10:59:49 -0400
Subject: [R-sig-Geo] intermittent writeGDAL problems
Message-ID: <46979365.1050605@isciences.com>

Hello again,

Now that I've managed to use readGDAL successfully, I'd really like to 
write some img files using writeGDAL, and I'm having some er, 
interesting problems that I can't quite understand.  Pardon the length 
of the message.

For the most part, writeGDAL successfully writes an IMG file that I can 
successfully read into ArcGIS, with projection and all.  But sometimes 
(from an identical writeGDAL command) the file comes up with no 
projection and data values of all zeros.  Checking this in R using 
GDALinfo or readGDAL reveals the same thing - proj4string is NA and all 
values are zero. 

BUT, if I use readGDAL again on the same file, it works, and, 
additionally, I can then successfully read it into ArcGIS.

I wonder if there is a buffer issue where the writeGDAL command doesn't 
quite finish it's business until I nudge it with some other GDAL 
commands.  If I close R before I get the file to read in properly, then 
no amount of readGDAL will get it to come in with projection and data 
values.

I think one solution is to figure out the lower level commands like 
GDAL.open and GDAL.close so I can close handles explicitly, but it would 
be nice to use writeGDAL.  Any ideas?

Here is a sample of the code that produced the problem.

 > library(rgdal)
Loading required package: sp
Geospatial Data Abstraction Library extensions to R successfully loaded

 > test <- readGDAL('swe20070220.img')
swe20070220.img has GDAL driver HFA
and has 360 rows and 720 columns
Closing GDAL dataset handle 0x0209ef78...  destroyed ... done.

 > summary(test)
Object of class SpatialGridDataFrame
Coordinates:
   min max
x -180 180
y  -90  90
Is projected: FALSE
proj4string :
[+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs +towgs84=0,0,0]
Number of points: 2
Grid attributes:
  cellcentre.offset cellsize cells.dim
x           -179.75      0.5       720
y            -89.75      0.5       360
Data attributes:
     band1         
 Min.   :     0.00 
 1st Qu.:    14.00 
 Median :    57.00 
 Mean   :    63.02 
 3rd Qu.:    98.00 
 Max.   :   480.00 
 NA's   :225758.00 

 > writeGDAL(test, 'swe20070220_TEST.img', driver = 'HFA')
 
 > test2 <- readGDAL('swe20070220_TEST.img')
swe20070220_TEST.img has GDAL driver HFA
and has 360 rows and 720 columns
Closing GDAL dataset handle 0x0218f760...  destroyed ... done.
Closing GDAL dataset handle 0x020b72f8...  destroyed ... done.
Closing GDAL dataset handle 0x0209f068...  destroyed ... done.
 > summary(test2)
Object of class SpatialGridDataFrame
Coordinates:
  min max
x   0 720
y   0 360
Is projected: NA
proj4string : [NA]
Number of points: 2
Grid attributes:
  cellcentre.offset cellsize cells.dim
x               0.5        1       720
y               0.5        1       360
Data attributes:
     band1 
 Min.   :0 
 1st Qu.:0 
 Median :0 
 Mean   :0 
 3rd Qu.:0 
 Max.   :0 
 > image(test2)
Closing GDAL dataset handle (nil)... done.
 
 > rm(test2)
 > test2 <- readGDAL('swe20070220_TEST.img')
swe20070220_TEST.img has GDAL driver HFA
and has 360 rows and 720 columns
Closing GDAL dataset handle 0x02187368...  destroyed ... done.
 > summary(test2)
Object of class SpatialGridDataFrame
Coordinates:
   min max
x -180 180
y  -90  90
Is projected: FALSE
proj4string :
[+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs +towgs84=0,0,0]
Number of points: 2
Grid attributes:
  cellcentre.offset cellsize cells.dim
x           -179.75      0.5       720
y            -89.75      0.5       360
Data attributes:
     band1         
 Min.   :     0.00 
 1st Qu.:    14.00 
 Median :    57.00 
 Mean   :    63.02 
 3rd Qu.:    98.00 
 Max.   :   480.00 
 NA's   :225758.00 

 > version              _                          
platform       i386-pc-mingw32            
arch           i386                       
os             mingw32                    
system         i386, mingw32              
status                                    
major          2                          
minor          5.0                        
year           2007                       
month          04                         
day            23                         
svn rev        41293                      
language       R                          
version.string R version 2.5.0 (2007-04-23)

Many thanks in advance

-- 
**********************************
Matthew Landis
Research Analyst
Isciences, LLC
61 Main St., Suite 200
Burlington VT 05401 USA



From dpleydel at univ-fcomte.fr  Fri Jul 13 17:16:22 2007
From: dpleydel at univ-fcomte.fr (David)
Date: Fri, 13 Jul 2007 17:16:22 +0200
Subject: [R-sig-Geo] out of the office (was: R-sig-Geo Digest, Vol 47,
In-Reply-To: <mailman.17.1184148013.29558.r-sig-geo@stat.math.ethz.ch>
References: <mailman.17.1184148013.29558.r-sig-geo@stat.math.ethz.ch>
Message-ID: <20070713151622.GF21449@univ-fcomte.fr>

Imagine if everybody on R-help automatically sent "out of the office"
replies to the list. R as we know it would cease to exist!

> Today's Topics:
> 
>    1. Distmap: the way I could do it (Agustin Lobo)
>    2. Crossing native ArcGis GRID with a XY coordinate table
>       (Milton Cezar Ribeiro)
>    3. library(shapefiles): write PolyLineZ or PolygonZ shapes?
>       (Albrecht Gebhardt)
>    4. Anisotropy How many metres in a day (Lisbeth Riis)
>    5. Re: Cell Declustering (Edzer J. Pebesma)
>    6. out of the office (was: R-sig-Geo Digest, Vol 47,	Issue 4)
>       (Javier Sanchez)
>    7. out of the office (was: R-sig-Geo Digest, Vol 47,	Issue 7)
>       (Javier Sanchez)
>    8. out of the office (was: R-sig-Geo Digest, Vol 47,	Issue 5)
>       (Javier Sanchez)
>    9. out of the office (was: R-sig-Geo Digest, Vol 46,	Issue 26)
>       (Javier Sanchez)
>   10. out of the office (was: R-sig-Geo Digest, Vol 47,	Issue 1)
>       (Javier Sanchez)
>   11. out of the office (was: R-sig-Geo Digest, Vol 47,	Issue 2)
>       (Javier Sanchez)
>   12. out of the office (was: R-sig-Geo Digest, Vol 47,	Issue 6)
>       (Javier Sanchez)
>   13. out of the office (was: R-sig-Geo Digest, Vol 47,	Issue 3)
>       (Javier Sanchez)
>   14. Re: Large dataset (KAM Tin Seong)
>   15. [R] Plot SpatialLinesDataFrame with xlim & ylim (Edzer J. Pebesma)
>   16. Re: Large dataset (Roger Bivand)
>   17. Re: [R] Plot SpatialLinesDataFrame with xlim & ylim (Roger Bivand)
> 


> ------------------------------
> 
> Message: 6
> Date: Tue, 10 Jul 2007 21:59:03 -0300
> From: Javier Sanchez <jsanchez at upei.ca>
> Subject: [R-sig-Geo] out of the office (was: R-sig-Geo Digest, Vol 47,
> 	Issue 4)
> To: r-sig-geo at stat.math.ethz.ch
> Message-ID: <46942B57.4020206 at upei.ca>
> Content-Type: text/plain; charset="us-ascii"
> 
> An HTML attachment was scrubbed...
> URL: https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070710/a3a392f7/attachment-0001.html 
> 
> ------------------------------
> 
> Message: 7
> Date: Tue, 10 Jul 2007 22:00:17 -0300
> From: Javier Sanchez <jsanchez at upei.ca>
> Subject: [R-sig-Geo] out of the office (was: R-sig-Geo Digest, Vol 47,
> 	Issue 7)
> To: r-sig-geo at stat.math.ethz.ch
> Message-ID: <46942BA1.7030809 at upei.ca>
> Content-Type: text/plain; charset="us-ascii"
> 
> An HTML attachment was scrubbed...
> URL: https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070710/171abf02/attachment-0001.html 
> 
> ------------------------------
> 
> Message: 8
> Date: Tue, 10 Jul 2007 22:01:32 -0300
> From: Javier Sanchez <jsanchez at upei.ca>
> Subject: [R-sig-Geo] out of the office (was: R-sig-Geo Digest, Vol 47,
> 	Issue 5)
> To: r-sig-geo at stat.math.ethz.ch
> Message-ID: <46942BEC.6020104 at upei.ca>
> Content-Type: text/plain; charset="us-ascii"
> 
> An HTML attachment was scrubbed...
> URL: https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070710/d98e955b/attachment-0001.html 
> 
> ------------------------------
> 
> Message: 9
> Date: Tue, 10 Jul 2007 22:16:10 -0300
> From: Javier Sanchez <jsanchez at upei.ca>
> Subject: [R-sig-Geo] out of the office (was: R-sig-Geo Digest, Vol 46,
> 	Issue 26)
> To: r-sig-geo at stat.math.ethz.ch
> Message-ID: <46942F5A.5090801 at upei.ca>
> Content-Type: text/plain; charset="us-ascii"
> 
> An HTML attachment was scrubbed...
> URL: https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070710/d02e72ac/attachment-0001.html 
> 
> ------------------------------
> 
> Message: 10
> Date: Tue, 10 Jul 2007 22:16:48 -0300
> From: Javier Sanchez <jsanchez at upei.ca>
> Subject: [R-sig-Geo] out of the office (was: R-sig-Geo Digest, Vol 47,
> 	Issue 1)
> To: r-sig-geo at stat.math.ethz.ch
> Message-ID: <46942F80.6090709 at upei.ca>
> Content-Type: text/plain; charset="us-ascii"
> 
> An HTML attachment was scrubbed...
> URL: https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070710/295a440f/attachment-0001.html 
> 
> ------------------------------
> 
> Message: 11
> Date: Tue, 10 Jul 2007 22:17:37 -0300
> From: Javier Sanchez <jsanchez at upei.ca>
> Subject: [R-sig-Geo] out of the office (was: R-sig-Geo Digest, Vol 47,
> 	Issue 2)
> To: r-sig-geo at stat.math.ethz.ch
> Message-ID: <46942FB1.6040308 at upei.ca>
> Content-Type: text/plain; charset="us-ascii"
> 
> An HTML attachment was scrubbed...
> URL: https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070710/01d361ce/attachment-0001.html 
> 
> ------------------------------
> 
> Message: 12
> Date: Tue, 10 Jul 2007 22:21:15 -0300
> From: Javier Sanchez <jsanchez at upei.ca>
> Subject: [R-sig-Geo] out of the office (was: R-sig-Geo Digest, Vol 47,
> 	Issue 6)
> To: r-sig-geo at stat.math.ethz.ch
> Message-ID: <4694308B.90200 at upei.ca>
> Content-Type: text/plain; charset="us-ascii"
> 
> An HTML attachment was scrubbed...
> URL: https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070710/3d45b47f/attachment-0001.html 
> 
> ------------------------------
> 
> Message: 13
> Date: Tue, 10 Jul 2007 22:22:14 -0300
> From: Javier Sanchez <jsanchez at upei.ca>
> Subject: [R-sig-Geo] out of the office (was: R-sig-Geo Digest, Vol 47,
> 	Issue 3)
> To: r-sig-geo at stat.math.ethz.ch
> Message-ID: <469430C6.3040605 at upei.ca>
> Content-Type: text/plain; charset="us-ascii"
> 
> An HTML attachment was scrubbed...
> URL: https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070710/63f36115/attachment-0001.html 
> 
> ------------------------------



From tkeitt at gmail.com  Fri Jul 13 18:40:20 2007
From: tkeitt at gmail.com (Tim Keitt)
Date: Fri, 13 Jul 2007 11:40:20 -0500
Subject: [R-sig-Geo] intermittent writeGDAL problems
In-Reply-To: <46979365.1050605@isciences.com>
References: <46979365.1050605@isciences.com>
Message-ID: <6262c54c0707130940x226b6938p3e4d25fe893b55ab@mail.gmail.com>

This is perhaps because the 'reg.finalizer' function in R did not
originally have the 'on.exit' option and so dangling handles would be
left at the end of an R  session. I just checked and the 'on.exit'
option is now available, so we need to enable it in the code. That
will force closing of all GDAL handles on exiting R and should solve
the problem.

However, the read/writeGDAL function should explicitly close handles
and not leave them to the gc. The (nil) pointer in the debugging
output below is worrisome.

THK

On 7/13/07, Matthew Landis <landis at isciences.com> wrote:
> Hello again,
>
> Now that I've managed to use readGDAL successfully, I'd really like to
> write some img files using writeGDAL, and I'm having some er,
> interesting problems that I can't quite understand.  Pardon the length
> of the message.
>
> For the most part, writeGDAL successfully writes an IMG file that I can
> successfully read into ArcGIS, with projection and all.  But sometimes
> (from an identical writeGDAL command) the file comes up with no
> projection and data values of all zeros.  Checking this in R using
> GDALinfo or readGDAL reveals the same thing - proj4string is NA and all
> values are zero.
>
> BUT, if I use readGDAL again on the same file, it works, and,
> additionally, I can then successfully read it into ArcGIS.
>
> I wonder if there is a buffer issue where the writeGDAL command doesn't
> quite finish it's business until I nudge it with some other GDAL
> commands.  If I close R before I get the file to read in properly, then
> no amount of readGDAL will get it to come in with projection and data
> values.
>
> I think one solution is to figure out the lower level commands like
> GDAL.open and GDAL.close so I can close handles explicitly, but it would
> be nice to use writeGDAL.  Any ideas?
>
> Here is a sample of the code that produced the problem.
>
>  > library(rgdal)
> Loading required package: sp
> Geospatial Data Abstraction Library extensions to R successfully loaded
>
>  > test <- readGDAL('swe20070220.img')
> swe20070220.img has GDAL driver HFA
> and has 360 rows and 720 columns
> Closing GDAL dataset handle 0x0209ef78...  destroyed ... done.
>
>  > summary(test)
> Object of class SpatialGridDataFrame
> Coordinates:
>    min max
> x -180 180
> y  -90  90
> Is projected: FALSE
> proj4string :
> [+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs +towgs84=0,0,0]
> Number of points: 2
> Grid attributes:
>   cellcentre.offset cellsize cells.dim
> x           -179.75      0.5       720
> y            -89.75      0.5       360
> Data attributes:
>      band1
>  Min.   :     0.00
>  1st Qu.:    14.00
>  Median :    57.00
>  Mean   :    63.02
>  3rd Qu.:    98.00
>  Max.   :   480.00
>  NA's   :225758.00
>
>  > writeGDAL(test, 'swe20070220_TEST.img', driver = 'HFA')
>
>  > test2 <- readGDAL('swe20070220_TEST.img')
> swe20070220_TEST.img has GDAL driver HFA
> and has 360 rows and 720 columns
> Closing GDAL dataset handle 0x0218f760...  destroyed ... done.
> Closing GDAL dataset handle 0x020b72f8...  destroyed ... done.
> Closing GDAL dataset handle 0x0209f068...  destroyed ... done.
>  > summary(test2)
> Object of class SpatialGridDataFrame
> Coordinates:
>   min max
> x   0 720
> y   0 360
> Is projected: NA
> proj4string : [NA]
> Number of points: 2
> Grid attributes:
>   cellcentre.offset cellsize cells.dim
> x               0.5        1       720
> y               0.5        1       360
> Data attributes:
>      band1
>  Min.   :0
>  1st Qu.:0
>  Median :0
>  Mean   :0
>  3rd Qu.:0
>  Max.   :0
>  > image(test2)
> Closing GDAL dataset handle (nil)... done.
>
>  > rm(test2)
>  > test2 <- readGDAL('swe20070220_TEST.img')
> swe20070220_TEST.img has GDAL driver HFA
> and has 360 rows and 720 columns
> Closing GDAL dataset handle 0x02187368...  destroyed ... done.
>  > summary(test2)
> Object of class SpatialGridDataFrame
> Coordinates:
>    min max
> x -180 180
> y  -90  90
> Is projected: FALSE
> proj4string :
> [+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs +towgs84=0,0,0]
> Number of points: 2
> Grid attributes:
>   cellcentre.offset cellsize cells.dim
> x           -179.75      0.5       720
> y            -89.75      0.5       360
> Data attributes:
>      band1
>  Min.   :     0.00
>  1st Qu.:    14.00
>  Median :    57.00
>  Mean   :    63.02
>  3rd Qu.:    98.00
>  Max.   :   480.00
>  NA's   :225758.00
>
>  > version              _
> platform       i386-pc-mingw32
> arch           i386
> os             mingw32
> system         i386, mingw32
> status
> major          2
> minor          5.0
> year           2007
> month          04
> day            23
> svn rev        41293
> language       R
> version.string R version 2.5.0 (2007-04-23)
>
> Many thanks in advance
>
> --
> **********************************
> Matthew Landis
> Research Analyst
> Isciences, LLC
> 61 Main St., Suite 200
> Burlington VT 05401 USA
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


-- 
Timothy H. Keitt, University of Texas at Austin
Contact info and schedule at http://www.keittlab.org/tkeitt/
Reprints at http://www.keittlab.org/tkeitt/papers/
ODF attachment? See http://www.openoffice.org/



From mgallay01 at Queens-Belfast.AC.UK  Sat Jul 14 09:12:25 2007
From: mgallay01 at Queens-Belfast.AC.UK (Michal Gallay)
Date: 14 Jul 2007 07:12:25 +0000
Subject: [R-sig-Geo] map algebra with ascii grid
Message-ID: <Prayer.1.0.12.0707140712250.16121@amos.qub.ac.uk>

Dear R Users,

could you please advise me on doing map algebra with spatial grids? It's 
the first time I am using spatial objects in R. I have imported an ascii 
grid file and wanted to round the values in it or sum with a value, but it 
gives an error message:

>require(maptools)
>x <- readAsciiGrid(fname="xxxx.asc")
> x+3
Error in x + 3 : non-numeric argument to binary operator 
> round(x,2)
Error in round(x, digits) : Non-numeric argument to mathematical function

Thank you for any suggestions.

Best wishes,

Michal



-- 
Michal Gallay

Postgraduate Research Student
School of Geography, Archaeology and Palaeoecology
Queen's University
Belfast BT7 1NN
Northern Ireland

Tel: +44(0)2890 273929
Fax: +44(0)2890 973212
email: mgallay01 at qub.ac.uk
www: www.qub.ac.uk/geog



From Roger.Bivand at nhh.no  Sat Jul 14 14:16:49 2007
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sat, 14 Jul 2007 14:16:49 +0200 (CEST)
Subject: [R-sig-Geo] map algebra with ascii grid
In-Reply-To: <Prayer.1.0.12.0707140712250.16121@amos.qub.ac.uk>
References: <Prayer.1.0.12.0707140712250.16121@amos.qub.ac.uk>
Message-ID: <Pine.LNX.4.64.0707141412100.7919@reclus.nhh.no>

On Sat, 14 Jul 2007, Michal Gallay wrote:

> Dear R Users,
>
> could you please advise me on doing map algebra with spatial grids? It's
> the first time I am using spatial objects in R. I have imported an ascii
> grid file and wanted to round the values in it or sum with a value, but it
> gives an error message:
>
>> require(maptools)
>> x <- readAsciiGrid(fname="xxxx.asc")
>> x+3
> Error in x + 3 : non-numeric argument to binary operator
>> round(x,2)
> Error in round(x, digits) : Non-numeric argument to mathematical function
>

Arithmetic operations are not defined for SpatialGridDataFrame operations, 
as the columns of the data frame (here a single column) may contain data 
of different classes. Do the operations on the columns directly:

names(x)

If there is a column called "band1", then

x$band1 + 3

will print "band1" + 3, and

x$band1 <- x$band1 + 3

will add 3 to the "band1" column. Think what would happen if band1 was 
categorical or logical to see why doing arithmetic directly isn't such a 
good idea.

Hope this helps,

Roger

> Thank you for any suggestions.
>
> Best wishes,
>
> Michal
>
>
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From priggs at cnr.colostate.edu  Sun Jul 15 15:40:12 2007
From: priggs at cnr.colostate.edu (Philip Riggs)
Date: Sun, 15 Jul 2007 07:40:12 -0600
Subject: [R-sig-Geo]  map algebra with ascii grid
In-Reply-To: <mailman.13.1184493605.23531.r-sig-geo@stat.math.ethz.ch>
References: <mailman.13.1184493605.23531.r-sig-geo@stat.math.ethz.ch>
Message-ID: <3513F1E2-D6E1-4B2B-89E8-D0B00C2804B7@cnr.colostate.edu>

>> Dear R Users,
>>
>> could you please advise me on doing map algebra with spatial  
>> grids? It's
>> the first time I am using spatial objects in R. I have imported an  
>> ascii
>> grid file and wanted to round the values in it or sum with a  
>> value, but it
>> gives an error message:
>>
>>> require(maptools)
>>> x <- readAsciiGrid(fname="xxxx.asc")
>>> x+3
>> Error in x + 3 : non-numeric argument to binary operator
>>> round(x,2)
>> Error in round(x, digits) : Non-numeric argument to mathematical  
>> function
>>
>
> Arithmetic operations are not defined for SpatialGridDataFrame  
> operations,
> as the columns of the data frame (here a single column) may contain  
> data
> of different classes. Do the operations on the columns directly:
>
> names(x)
>
> If there is a column called "band1", then
>
> x$band1 + 3
>
> will print "band1" + 3, and
>
> x$band1 <- x$band1 + 3
>
> will add 3 to the "band1" column. Think what would happen if band1 was
> categorical or logical to see why doing arithmetic directly isn't  
> such a
> good idea.
>
> Hope this helps,
>
> Roger
>
>> Thank you for any suggestions.
>>
>> Best wishes,
>>
>> Michal
>>

I use Python with Numpy/GDAL python bindings all the time to do  
spatial algebra and manipulate grids. It has all the math functions,  
and in the case of categorical data you can reassign values. Then I  
use rpy to do any statistical analyses in R. You could also do your  
manipulation in Python, then save the grid in an appropriate format  
for import into R to do the statistical analyses.

Philip



From Agustin.Lobo at ija.csic.es  Sun Jul 15 18:03:15 2007
From: Agustin.Lobo at ija.csic.es (Agustin Lobo)
Date: Sun, 15 Jul 2007 18:03:15 +0200
Subject: [R-sig-Geo] map algebra with ascii grid
In-Reply-To: <Pine.LNX.4.64.0707141412100.7919@reclus.nhh.no>
References: <Prayer.1.0.12.0707140712250.16121@amos.qub.ac.uk>
	<Pine.LNX.4.64.0707141412100.7919@reclus.nhh.no>
Message-ID: <469A4543.60801@ija.csic.es>

Roger,

I think that having Arithmetic operations defined for 
SpatialGridDataFrame objects would be very useful.
May be I'm missing something, but the argument that "columns of the data 
frame (here a single column) may contain data of different classes" does 
not seem a valid one to me, as
this is the case for any dataframe object in R while arithmetic 
operations are
defined for them, just yielding the proper results and warnigs,i.e.:

 > d <- data.frame(cbind(x=1, y=1:10), fac=sample(L3, 10, repl=TRUE))
    x  y fac
1  1  1   C
2  1  2   A
3  1  3   A
4  1  4   A
5  1  5   A
6  1  6   A
7  1  7   A
8  1  8   C
9  1  9   A
10 1 10   C

 > d+3
    x  y fac
1  4  4  NA
2  4  5  NA
3  4  6  NA
4  4  7  NA
5  4  8  NA
6  4  9  NA
7  4 10  NA
8  4 11  NA
9  4 12  NA
10 4 13  NA
Warning message:
+ not meaningful for factors in: Ops.factor(left, right)

So I would be most happy with such a feature added to spatial objects.
The "solution" of using other tools (i.e., python, cf. message by 
Philip, but this can also be done with grass and many other GIS) is not 
optimal at all, as we keep having copies of the same information in 
different formats for different tools.

Agus


Roger Bivand escribi?:
> On Sat, 14 Jul 2007, Michal Gallay wrote:
> 
>> Dear R Users,
>>
>> could you please advise me on doing map algebra with spatial grids? It's
>> the first time I am using spatial objects in R. I have imported an ascii
>> grid file and wanted to round the values in it or sum with a value, but it
>> gives an error message:
>>
>>> require(maptools)
>>> x <- readAsciiGrid(fname="xxxx.asc")
>>> x+3
>> Error in x + 3 : non-numeric argument to binary operator
>>> round(x,2)
>> Error in round(x, digits) : Non-numeric argument to mathematical function
>>
> 
> Arithmetic operations are not defined for SpatialGridDataFrame operations, 
> as the columns of the data frame (here a single column) may contain data 
> of different classes. Do the operations on the columns directly:
> 
> names(x)
> 
> If there is a column called "band1", then
> 
> x$band1 + 3
> 
> will print "band1" + 3, and
> 
> x$band1 <- x$band1 + 3
> 
> will add 3 to the "band1" column. Think what would happen if band1 was 
> categorical or logical to see why doing arithmetic directly isn't such a 
> good idea.
> 
> Hope this helps,
> 
> Roger
> 
>> Thank you for any suggestions.
>>
>> Best wishes,
>>
>> Michal
>>
>>
>>
>>
> 

-- 
Dr. Agustin Lobo
Institut de Ciencies de la Terra "Jaume Almera" (CSIC)
LLuis Sole Sabaris s/n
08028 Barcelona
Spain
Tel. 34 934095410
Fax. 34 934110012
email: Agustin.Lobo at ija.csic.es
http://www.ija.csic.es/gt/obster



From uclamathguy at gmail.com  Sun Jul 15 19:28:00 2007
From: uclamathguy at gmail.com (Ryan Rosario)
Date: Sun, 15 Jul 2007 10:28:00 -0700
Subject: [R-sig-Geo] Robust GWR
Message-ID: <72fc09510707151028u297e5b6dxa5683e8e85e31f40@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070715/134e0c74/attachment.pl>

From mgallay01 at Queens-Belfast.AC.UK  Sun Jul 15 19:44:37 2007
From: mgallay01 at Queens-Belfast.AC.UK (Michal Gallay)
Date: 15 Jul 2007 18:44:37 +0100
Subject: [R-sig-Geo] map algebra with ascii grid
In-Reply-To: <469A4543.60801@ija.csic.es>
References: <Prayer.1.0.12.0707140712250.16121@amos.qub.ac.uk>
	<Pine.LNX.4.64.0707141412100.7919@reclus.nhh.no>
	<469A4543.60801@ija.csic.es>
Message-ID: <Prayer.1.0.12.0707151844370.12882@localhost.localdomain>

Thank you very much to All ,

Roger's hint doest the thing I need. I am working with DEMs and instead of 
processing them partially in a GIS, I wanted to do everything in R as most 
of the analyses are carried out in R.

I'm sure I will have more questions in the future:) I appreciate all the 
advice.

Michal

On Jul 15 2007, Agustin Lobo wrote:

> Roger,
> 
> I think that having Arithmetic operations defined for 
> SpatialGridDataFrame objects would be very useful.
> May be I'm missing something, but the argument that "columns of the data 
> frame (here a single column) may contain data of different classes" does 
> not seem a valid one to me, as
> this is the case for any dataframe object in R while arithmetic 
> operations are
> defined for them, just yielding the proper results and warnigs,i.e.:
> 
>  > d <- data.frame(cbind(x=1, y=1:10), fac=sample(L3, 10, repl=TRUE))
>     x  y fac
> 1  1  1   C
> 2  1  2   A
> 3  1  3   A
> 4  1  4   A
> 5  1  5   A
> 6  1  6   A
> 7  1  7   A
> 8  1  8   C
> 9  1  9   A
> 10 1 10   C
> 
>  > d+3
>     x  y fac
> 1  4  4  NA
> 2  4  5  NA
> 3  4  6  NA
> 4  4  7  NA
> 5  4  8  NA
> 6  4  9  NA
> 7  4 10  NA
> 8  4 11  NA
> 9  4 12  NA
> 10 4 13  NA
> Warning message:
> + not meaningful for factors in: Ops.factor(left, right)
> 
> So I would be most happy with such a feature added to spatial objects.
> The "solution" of using other tools (i.e., python, cf. message by 
> Philip, but this can also be done with grass and many other GIS) is not 
> optimal at all, as we keep having copies of the same information in 
> different formats for different tools.
> 
> Agus
> 
> 
> Roger Bivand escribi?:
> > On Sat, 14 Jul 2007, Michal Gallay wrote:
> > 
> >> Dear R Users,
> >>
> >> could you please advise me on doing map algebra with spatial grids? 
> >> It's the first time I am using spatial objects in R. I have imported 
> >> an ascii grid file and wanted to round the values in it or sum with a 
> >> value, but it gives an error message:
> >>
> >>> require(maptools)
> >>> x <- readAsciiGrid(fname="xxxx.asc")
> >>> x+3
> >> Error in x + 3 : non-numeric argument to binary operator
> >>> round(x,2)
> >> Error in round(x, digits) : Non-numeric argument to mathematical 
> >> function
> >>
> > 
> > Arithmetic operations are not defined for SpatialGridDataFrame 
> > operations, as the columns of the data frame (here a single column) may 
> > contain data of different classes. Do the operations on the columns 
> > directly:
> > 
> > names(x)
> > 
> > If there is a column called "band1", then
> > 
> > x$band1 + 3
> > 
> > will print "band1" + 3, and
> > 
> > x$band1 <- x$band1 + 3
> > 
> > will add 3 to the "band1" column. Think what would happen if band1 was 
> > categorical or logical to see why doing arithmetic directly isn't such 
> > a good idea.
> > 
> > Hope this helps,
> > 
> > Roger
> > 
> >> Thank you for any suggestions.
> >>
> >> Best wishes,
> >>
> >> Michal
> >>
> >>
> >>
> >>
> > 
> 
> 

-- 
Michal Gallay

Postgraduate Research Student
School of Geography, Archaeology and Palaeoecology
Queen's University
Belfast BT7 1NN
Northern Ireland

Tel: +44(0)2890 273929
Fax: +44(0)2890 973212
email: mgallay01 at qub.ac.uk
www: www.qub.ac.uk/geog



From b.rowlingson at lancaster.ac.uk  Sun Jul 15 20:22:49 2007
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Sun, 15 Jul 2007 19:22:49 +0100
Subject: [R-sig-Geo] map algebra with ascii grid
In-Reply-To: <469A4543.60801@ija.csic.es>
References: <Prayer.1.0.12.0707140712250.16121@amos.qub.ac.uk>	<Pine.LNX.4.64.0707141412100.7919@reclus.nhh.no>
	<469A4543.60801@ija.csic.es>
Message-ID: <469A65F9.1000108@lancaster.ac.uk>

Agustin Lobo wrote:
> Roger,
> 
> I think that having Arithmetic operations defined for 
> SpatialGridDataFrame objects would be very useful.

  The problem is that SpatialSomethingDataFrame objects don't inherit 
data.frame's behaviour (with respect to mathematical operators). Perhaps 
if R's OO implementation was a bit more conventional you'd get this for 
free by subclassing data.frame.

  But data.frame isn't subclassable properly. A SpatialPointsDataFrame 
is an S4 object with a data frame in the @data member. In order to 
implement data.frame-like behaviour, it is necessary to implement 
methods for SpatialPointsDataFrame that work on the @data object - for 
example, dim:

dim.SpatialPointsDataFrame = function(x) dim(x at data)

  It should be almost as equally trivial to implement the arithmetic 
operators - they would work on the @data member and leave the 
coordinates untouched. Although what happens to the coordinates if you 
add two spatial data frames with different coordinates (but the same 
shape of data frame)? I would be tempted to either make sdf1 + sdf2 
return a plain data frame - and if the user wants to slap coordinates on 
it they can take it from sdf1 or sdf2 - or always use the coords from 
the first argument.

Barry



From tkeitt at gmail.com  Mon Jul 16 02:21:03 2007
From: tkeitt at gmail.com (Tim Keitt)
Date: Sun, 15 Jul 2007 19:21:03 -0500
Subject: [R-sig-Geo] map algebra with ascii grid
In-Reply-To: <Pine.LNX.4.64.0707141412100.7919@reclus.nhh.no>
References: <Prayer.1.0.12.0707140712250.16121@amos.qub.ac.uk>
	<Pine.LNX.4.64.0707141412100.7919@reclus.nhh.no>
Message-ID: <6262c54c0707151721m6100767ahfdec3e8882cc5122@mail.gmail.com>

On 7/14/07, Roger Bivand <Roger.Bivand at nhh.no> wrote:
> On Sat, 14 Jul 2007, Michal Gallay wrote:
>
> > Dear R Users,
> >
> > could you please advise me on doing map algebra with spatial grids? It's
> > the first time I am using spatial objects in R. I have imported an ascii
> > grid file and wanted to round the values in it or sum with a value, but it
> > gives an error message:
> >
> >> require(maptools)
> >> x <- readAsciiGrid(fname="xxxx.asc")
> >> x+3
> > Error in x + 3 : non-numeric argument to binary operator
> >> round(x,2)
> > Error in round(x, digits) : Non-numeric argument to mathematical function
> >
>
> Arithmetic operations are not defined for SpatialGridDataFrame operations,
> as the columns of the data frame (here a single column) may contain data
> of different classes. Do the operations on the columns directly:
>
> names(x)
>
> If there is a column called "band1", then
>
> x$band1 + 3
>
> will print "band1" + 3, and
>
> x$band1 <- x$band1 + 3
>
> will add 3 to the "band1" column. Think what would happen if band1 was
> categorical or logical to see why doing arithmetic directly isn't such a
> good idea.

Roger,

While I agree that arithmetic directly on S?DF objects does not make a
lot of sense, I have always taken the view that if the name of a type
includes "data frame", then you are implicitly promising that the
object is substitutable for any other data.frame class object in a
function call. So if S?DF is meant to inherit (formally or informally)
from data.frame, one should be able to use a S?DF anywhere you could
use an ordinary data.frame object without changing the result. Of
course, I realize that S?DF is not mean to inherit directly from
data.frame (so it is clear from the programming standpoint, ie there
is no "inherits" relationship between data.frame and S?DF). Perhaps it
would be more clear to users if a different naming scheme were used?

THK

>
> Hope this helps,
>
> Roger
>
> > Thank you for any suggestions.
> >
> > Best wishes,
> >
> > Michal
> >
> >
> >
> >
>
> --
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


-- 
Timothy H. Keitt, University of Texas at Austin
Contact info and schedule at http://www.keittlab.org/tkeitt/
Reprints at http://www.keittlab.org/tkeitt/papers/
ODF attachment? See http://www.openoffice.org/



From rbt501 at york.ac.uk  Mon Jul 16 14:45:39 2007
From: rbt501 at york.ac.uk (Taylor, RB)
Date: Mon, 16 Jul 2007 13:45:39 +0100
Subject: [R-sig-Geo] Converting a dataframe to a character vector
Message-ID: <469B6873.2090307@york.ac.uk>

Hello all,

This isn't quite a spatially related question but perhaps someone can 
help me with this problem?

I have some species name recorded in a tab delim text file. They are all 
just one word long as seen below. I want to put them into a vector for 
use in Spatstat, which as far as I can see means reading the data into a 
data frame and then converting it to a character vector.

So first I read the file into R.

 > df <- read.table("C:\\temp\\test.txt")
 > df
           V1
1     Repens
2 Laurifolia
3     Repens
4 Laurifolia
5 Laurifolia

# just to check it's a data frame
 > is.data.frame(df)
[1] TRUE

#so far so good, now to try to convert to a vector, preserving the 
#species names...
 > v <- as.vector(df)
 > is.vector(v)
[1] FALSE

Why will it not convert it to a character vector automatically? Ok after 
consulting the help file I use the "mode" feature to attempt to force it 
to convert to a character string.

 > v <- as.vector(df, mode = "character")
 > is.vector(v)
[1] TRUE

ok some progress .... but then

 > v
[1] "c(2, 1, 2, 1, 1)"

ok I'm confused at this point. What is it actually telling me? That I 
have a vector with the text string "c(2, 1, 2, 1, 1)" in it?

OK, so to be clear I want a vector that looks like this:
[1] "Repens" "Laurifolia" "Repens" "Laurifolia" "Laurifolia"


Any help would be appreciated.
Thanks,
Rob

-- 
Rob Taylor

University of York
Biology Department
PO Box 373
York
YO10 5YW
United Kingdom

Work +44 (0)1904 32 8557
Mob  +44 (0)777 258 5390



From ggrothendieck at gmail.com  Mon Jul 16 15:32:11 2007
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Mon, 16 Jul 2007 09:32:11 -0400
Subject: [R-sig-Geo] Converting a dataframe to a character vector
In-Reply-To: <469B6873.2090307@york.ac.uk>
References: <469B6873.2090307@york.ac.uk>
Message-ID: <971536df0707160632l1b2f17e2xf8cdef2fc3d0fab6@mail.gmail.com>

Try this:

> Lines <- "Repens
+  Laurifolia
+      Repens
+  Laurifolia
+  Laurifolia
+ "
> # replace next line with v <- scan("myfile.dat", what = "")
> v <- scan(textConnection(Lines), what = "")
Read 5 items
> is.vector(v)
[1] TRUE
> class(v)
[1] "character"
> str(v)
 chr [1:5] "Repens" "Laurifolia" "Repens" "Laurifolia" ...


On 7/16/07, Taylor, RB <rbt501 at york.ac.uk> wrote:
> Hello all,
>
> This isn't quite a spatially related question but perhaps someone can
> help me with this problem?
>
> I have some species name recorded in a tab delim text file. They are all
> just one word long as seen below. I want to put them into a vector for
> use in Spatstat, which as far as I can see means reading the data into a
> data frame and then converting it to a character vector.
>
> So first I read the file into R.
>
>  > df <- read.table("C:\\temp\\test.txt")
>  > df
>           V1
> 1     Repens
> 2 Laurifolia
> 3     Repens
> 4 Laurifolia
> 5 Laurifolia
>
> # just to check it's a data frame
>  > is.data.frame(df)
> [1] TRUE
>
> #so far so good, now to try to convert to a vector, preserving the
> #species names...
>  > v <- as.vector(df)
>  > is.vector(v)
> [1] FALSE
>
> Why will it not convert it to a character vector automatically? Ok after
> consulting the help file I use the "mode" feature to attempt to force it
> to convert to a character string.
>
>  > v <- as.vector(df, mode = "character")
>  > is.vector(v)
> [1] TRUE
>
> ok some progress .... but then
>
>  > v
> [1] "c(2, 1, 2, 1, 1)"
>
> ok I'm confused at this point. What is it actually telling me? That I
> have a vector with the text string "c(2, 1, 2, 1, 1)" in it?
>
> OK, so to be clear I want a vector that looks like this:
> [1] "Repens" "Laurifolia" "Repens" "Laurifolia" "Laurifolia"
>
>
> Any help would be appreciated.
> Thanks,
> Rob
>
> --
> Rob Taylor
>
> University of York
> Biology Department
> PO Box 373
> York
> YO10 5YW
> United Kingdom
>
> Work +44 (0)1904 32 8557
> Mob  +44 (0)777 258 5390
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



From rbt501 at york.ac.uk  Mon Jul 16 15:38:12 2007
From: rbt501 at york.ac.uk (Taylor, RB)
Date: Mon, 16 Jul 2007 14:38:12 +0100
Subject: [R-sig-Geo] Converting a dataframe to a character vector
In-Reply-To: <971536df0707160632l1b2f17e2xf8cdef2fc3d0fab6@mail.gmail.com>
References: <469B6873.2090307@york.ac.uk>
	<971536df0707160632l1b2f17e2xf8cdef2fc3d0fab6@mail.gmail.com>
Message-ID: <469B74C4.9060707@york.ac.uk>

Thanks Gabor for your help. Is there a way to avoid this section?

 > Lines <- "Repens
 > +  Laurifolia
 > +      Repens
 > +  Laurifolia
 > +  Laurifolia
 > + "

I have simplified the dataset somewhat. The real dataset has over 100 
entries and it would be rather tedious to have to enter each one separately.

Thanks,
Rob Taylor

Gabor Grothendieck wrote:
> Try this:
> 
>> Lines <- "Repens
> +  Laurifolia
> +      Repens
> +  Laurifolia
> +  Laurifolia
> + "
>> # replace next line with v <- scan("myfile.dat", what = "")
>> v <- scan(textConnection(Lines), what = "")
> Read 5 items
>> is.vector(v)
> [1] TRUE
>> class(v)
> [1] "character"
>> str(v)
> chr [1:5] "Repens" "Laurifolia" "Repens" "Laurifolia" ...
> 
> 
> On 7/16/07, Taylor, RB <rbt501 at york.ac.uk> wrote:
>> Hello all,
>>
>> This isn't quite a spatially related question but perhaps someone can
>> help me with this problem?
>>
>> I have some species name recorded in a tab delim text file. They are all
>> just one word long as seen below. I want to put them into a vector for
>> use in Spatstat, which as far as I can see means reading the data into a
>> data frame and then converting it to a character vector.
>>
>> So first I read the file into R.
>>
>>  > df <- read.table("C:\\temp\\test.txt")
>>  > df
>>           V1
>> 1     Repens
>> 2 Laurifolia
>> 3     Repens
>> 4 Laurifolia
>> 5 Laurifolia
>>
>> # just to check it's a data frame
>>  > is.data.frame(df)
>> [1] TRUE
>>
>> #so far so good, now to try to convert to a vector, preserving the
>> #species names...
>>  > v <- as.vector(df)
>>  > is.vector(v)
>> [1] FALSE
>>
>> Why will it not convert it to a character vector automatically? Ok after
>> consulting the help file I use the "mode" feature to attempt to force it
>> to convert to a character string.
>>
>>  > v <- as.vector(df, mode = "character")
>>  > is.vector(v)
>> [1] TRUE
>>
>> ok some progress .... but then
>>
>>  > v
>> [1] "c(2, 1, 2, 1, 1)"
>>
>> ok I'm confused at this point. What is it actually telling me? That I
>> have a vector with the text string "c(2, 1, 2, 1, 1)" in it?
>>
>> OK, so to be clear I want a vector that looks like this:
>> [1] "Repens" "Laurifolia" "Repens" "Laurifolia" "Laurifolia"
>>
>>
>> Any help would be appreciated.
>> Thanks,
>> Rob
>>
>> -- 
>> Rob Taylor
>>
>> University of York
>> Biology Department
>> PO Box 373
>> York
>> YO10 5YW
>> United Kingdom
>>
>> Work +44 (0)1904 32 8557
>> Mob  +44 (0)777 258 5390
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>

-- 
Rob Taylor

University of York
Biology Department
PO Box 373
York
YO10 5YW
United Kingdom

Work +44 (0)1904 32 8557
Mob  +44 (0)777 258 5390



From ggrothendieck at gmail.com  Mon Jul 16 15:38:54 2007
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Mon, 16 Jul 2007 09:38:54 -0400
Subject: [R-sig-Geo] Converting a dataframe to a character vector
In-Reply-To: <469B74C4.9060707@york.ac.uk>
References: <469B6873.2090307@york.ac.uk>
	<971536df0707160632l1b2f17e2xf8cdef2fc3d0fab6@mail.gmail.com>
	<469B74C4.9060707@york.ac.uk>
Message-ID: <971536df0707160638o6d271948o6e04610e78296b51@mail.gmail.com>

See the comment.

On 7/16/07, Taylor, RB <rbt501 at york.ac.uk> wrote:
> Thanks Gabor for your help. Is there a way to avoid this section?
>
>  > Lines <- "Repens
>  > +  Laurifolia
>  > +      Repens
>  > +  Laurifolia
>  > +  Laurifolia
>  > + "
>
> I have simplified the dataset somewhat. The real dataset has over 100
> entries and it would be rather tedious to have to enter each one separately.
>
> Thanks,
> Rob Taylor
>
> Gabor Grothendieck wrote:
> > Try this:
> >
> >> Lines <- "Repens
> > +  Laurifolia
> > +      Repens
> > +  Laurifolia
> > +  Laurifolia
> > + "
> >> # replace next line with v <- scan("myfile.dat", what = "")
> >> v <- scan(textConnection(Lines), what = "")
> > Read 5 items
> >> is.vector(v)
> > [1] TRUE
> >> class(v)
> > [1] "character"
> >> str(v)
> > chr [1:5] "Repens" "Laurifolia" "Repens" "Laurifolia" ...
> >
> >
> > On 7/16/07, Taylor, RB <rbt501 at york.ac.uk> wrote:
> >> Hello all,
> >>
> >> This isn't quite a spatially related question but perhaps someone can
> >> help me with this problem?
> >>
> >> I have some species name recorded in a tab delim text file. They are all
> >> just one word long as seen below. I want to put them into a vector for
> >> use in Spatstat, which as far as I can see means reading the data into a
> >> data frame and then converting it to a character vector.
> >>
> >> So first I read the file into R.
> >>
> >>  > df <- read.table("C:\\temp\\test.txt")
> >>  > df
> >>           V1
> >> 1     Repens
> >> 2 Laurifolia
> >> 3     Repens
> >> 4 Laurifolia
> >> 5 Laurifolia
> >>
> >> # just to check it's a data frame
> >>  > is.data.frame(df)
> >> [1] TRUE
> >>
> >> #so far so good, now to try to convert to a vector, preserving the
> >> #species names...
> >>  > v <- as.vector(df)
> >>  > is.vector(v)
> >> [1] FALSE
> >>
> >> Why will it not convert it to a character vector automatically? Ok after
> >> consulting the help file I use the "mode" feature to attempt to force it
> >> to convert to a character string.
> >>
> >>  > v <- as.vector(df, mode = "character")
> >>  > is.vector(v)
> >> [1] TRUE
> >>
> >> ok some progress .... but then
> >>
> >>  > v
> >> [1] "c(2, 1, 2, 1, 1)"
> >>
> >> ok I'm confused at this point. What is it actually telling me? That I
> >> have a vector with the text string "c(2, 1, 2, 1, 1)" in it?
> >>
> >> OK, so to be clear I want a vector that looks like this:
> >> [1] "Repens" "Laurifolia" "Repens" "Laurifolia" "Laurifolia"
> >>
> >>
> >> Any help would be appreciated.
> >> Thanks,
> >> Rob
> >>
> >> --
> >> Rob Taylor
> >>
> >> University of York
> >> Biology Department
> >> PO Box 373
> >> York
> >> YO10 5YW
> >> United Kingdom
> >>
> >> Work +44 (0)1904 32 8557
> >> Mob  +44 (0)777 258 5390
> >>
> >> _______________________________________________
> >> R-sig-Geo mailing list
> >> R-sig-Geo at stat.math.ethz.ch
> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >>
>
> --
> Rob Taylor
>
> University of York
> Biology Department
> PO Box 373
> York
> YO10 5YW
> United Kingdom
>
> Work +44 (0)1904 32 8557
> Mob  +44 (0)777 258 5390
>



From rbt501 at york.ac.uk  Mon Jul 16 15:59:28 2007
From: rbt501 at york.ac.uk (Taylor, RB)
Date: Mon, 16 Jul 2007 14:59:28 +0100
Subject: [R-sig-Geo] Converting a dataframe to a character vector
In-Reply-To: <971536df0707160638o6d271948o6e04610e78296b51@mail.gmail.com>
References: <469B6873.2090307@york.ac.uk>	
	<971536df0707160632l1b2f17e2xf8cdef2fc3d0fab6@mail.gmail.com>	
	<469B74C4.9060707@york.ac.uk>
	<971536df0707160638o6d271948o6e04610e78296b51@mail.gmail.com>
Message-ID: <469B79C0.1000204@york.ac.uk>

Thank Gabor. This worked for me:

 > v <- scan("C:\\temp\\test.txt", what ="")
Read 5 items
 > is.vector(v)
[1] TRUE
 > class(v)
[1] "character"
 > str(v)
  chr [1:5] "Repens" "Laurifolia" "Repens" "Laurifolia" ...

Cheers,
Rob

Gabor Grothendieck wrote:
> See the comment.
> 
> On 7/16/07, Taylor, RB <rbt501 at york.ac.uk> wrote:
>> Thanks Gabor for your help. Is there a way to avoid this section?
>>
>>  > Lines <- "Repens
>>  > +  Laurifolia
>>  > +      Repens
>>  > +  Laurifolia
>>  > +  Laurifolia
>>  > + "
>>
>> I have simplified the dataset somewhat. The real dataset has over 100
>> entries and it would be rather tedious to have to enter each one 
>> separately.
>>
>> Thanks,
>> Rob Taylor
>>
>> Gabor Grothendieck wrote:
>> > Try this:
>> >
>> >> Lines <- "Repens
>> > +  Laurifolia
>> > +      Repens
>> > +  Laurifolia
>> > +  Laurifolia
>> > + "
>> >> # replace next line with v <- scan("myfile.dat", what = "")
>> >> v <- scan(textConnection(Lines), what = "")
>> > Read 5 items
>> >> is.vector(v)
>> > [1] TRUE
>> >> class(v)
>> > [1] "character"
>> >> str(v)
>> > chr [1:5] "Repens" "Laurifolia" "Repens" "Laurifolia" ...
>> >
>> >
>> > On 7/16/07, Taylor, RB <rbt501 at york.ac.uk> wrote:
>> >> Hello all,
>> >>
>> >> This isn't quite a spatially related question but perhaps someone can
>> >> help me with this problem?
>> >>
>> >> I have some species name recorded in a tab delim text file. They 
>> are all
>> >> just one word long as seen below. I want to put them into a vector for
>> >> use in Spatstat, which as far as I can see means reading the data 
>> into a
>> >> data frame and then converting it to a character vector.
>> >>
>> >> So first I read the file into R.
>> >>
>> >>  > df <- read.table("C:\\temp\\test.txt")
>> >>  > df
>> >>           V1
>> >> 1     Repens
>> >> 2 Laurifolia
>> >> 3     Repens
>> >> 4 Laurifolia
>> >> 5 Laurifolia
>> >>
>> >> # just to check it's a data frame
>> >>  > is.data.frame(df)
>> >> [1] TRUE
>> >>
>> >> #so far so good, now to try to convert to a vector, preserving the
>> >> #species names...
>> >>  > v <- as.vector(df)
>> >>  > is.vector(v)
>> >> [1] FALSE
>> >>
>> >> Why will it not convert it to a character vector automatically? Ok 
>> after
>> >> consulting the help file I use the "mode" feature to attempt to 
>> force it
>> >> to convert to a character string.
>> >>
>> >>  > v <- as.vector(df, mode = "character")
>> >>  > is.vector(v)
>> >> [1] TRUE
>> >>
>> >> ok some progress .... but then
>> >>
>> >>  > v
>> >> [1] "c(2, 1, 2, 1, 1)"
>> >>
>> >> ok I'm confused at this point. What is it actually telling me? That I
>> >> have a vector with the text string "c(2, 1, 2, 1, 1)" in it?
>> >>
>> >> OK, so to be clear I want a vector that looks like this:
>> >> [1] "Repens" "Laurifolia" "Repens" "Laurifolia" "Laurifolia"
>> >>
>> >>
>> >> Any help would be appreciated.
>> >> Thanks,
>> >> Rob
>> >>
>> >> --
>> >> Rob Taylor
>> >>
>> >> University of York
>> >> Biology Department
>> >> PO Box 373
>> >> York
>> >> YO10 5YW
>> >> United Kingdom
>> >>
>> >> Work +44 (0)1904 32 8557
>> >> Mob  +44 (0)777 258 5390
>> >>
>> >> _______________________________________________
>> >> R-sig-Geo mailing list
>> >> R-sig-Geo at stat.math.ethz.ch
>> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> >>
>>
>> -- 
>> Rob Taylor
>>
>> University of York
>> Biology Department
>> PO Box 373
>> York
>> YO10 5YW
>> United Kingdom
>>
>> Work +44 (0)1904 32 8557
>> Mob  +44 (0)777 258 5390
>>

-- 
Rob Taylor

University of York
Biology Department
PO Box 373
York
YO10 5YW
United Kingdom

Work +44 (0)1904 32 8557
Mob  +44 (0)777 258 5390



From Roger.Bivand at nhh.no  Mon Jul 16 19:41:10 2007
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 16 Jul 2007 19:41:10 +0200 (CEST)
Subject: [R-sig-Geo] map algebra with ascii grid
In-Reply-To: <6262c54c0707151721m6100767ahfdec3e8882cc5122@mail.gmail.com>
References: <Prayer.1.0.12.0707140712250.16121@amos.qub.ac.uk> 
	<Pine.LNX.4.64.0707141412100.7919@reclus.nhh.no>
	<6262c54c0707151721m6100767ahfdec3e8882cc5122@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0707161928440.3407@reclus.nhh.no>

On Sun, 15 Jul 2007, Tim Keitt wrote:

> On 7/14/07, Roger Bivand <Roger.Bivand at nhh.no> wrote:
>>  On Sat, 14 Jul 2007, Michal Gallay wrote:
>> 
>> >  Dear R Users,
>> > 
>> >  could you please advise me on doing map algebra with spatial grids? It's
>> >  the first time I am using spatial objects in R. I have imported an ascii
>> >  grid file and wanted to round the values in it or sum with a value, but 
>> >  it
>> >  gives an error message:
>> > 
>> > >  require(maptools)
>> > >  x <- readAsciiGrid(fname="xxxx.asc")
>> > >  x+3
>> >  Error in x + 3 : non-numeric argument to binary operator
>> > >  round(x,2)
>> >  Error in round(x, digits) : Non-numeric argument to mathematical 
>> >  function
>> > 
>>
>>  Arithmetic operations are not defined for SpatialGridDataFrame operations,
>>  as the columns of the data frame (here a single column) may contain data
>>  of different classes. Do the operations on the columns directly:
>>
>>  names(x)
>>
>>  If there is a column called "band1", then
>>
>>  x$band1 + 3
>>
>>  will print "band1" + 3, and
>>
>>  x$band1 <- x$band1 + 3
>>
>>  will add 3 to the "band1" column. Think what would happen if band1 was
>>  categorical or logical to see why doing arithmetic directly isn't such a
>>  good idea.
>
> Roger,
>
> While I agree that arithmetic directly on S?DF objects does not make a
> lot of sense, I have always taken the view that if the name of a type
> includes "data frame", then you are implicitly promising that the
> object is substitutable for any other data.frame class object in a
> function call. So if S?DF is meant to inherit (formally or informally)
> from data.frame, one should be able to use a S?DF anywhere you could
> use an ordinary data.frame object without changing the result. Of
> course, I realize that S?DF is not mean to inherit directly from
> data.frame (so it is clear from the programming standpoint, ie there
> is no "inherits" relationship between data.frame and S?DF). Perhaps it
> would be more clear to users if a different naming scheme were used?

Tim,

While there is something in your suggestion, my understanding of the White 
Book (1992) introduction of data frames is that they are lists of vectors 
of varying types but of equal lengths, and that they should play well with 
formulae. The current Spatial*DataFrame do indeed do this, and you can use 
them with model.frame() inside for example lm(), gstat(), and generally 
almost everywhere a real data frame is needed as a data= argument. I 
cannot recall ever using an arithmetic operation on a data frame myself, 
although I may be an exception (I coerse to matrix).

Rather than trying to inherit from data.frame, the methods ($,[, [[, and 
assignment versions) provide data.frame operability.

Certainly I can see that there are differences of approach here, 
especially if remote sensing data are never going to have factors (unlike 
say GIS integration, where categorical data do occur). The exchange on the 
list earlier today (about why read.table() returns a data.frame and by 
default converts a character vector to a factor) seems to back me up (from 
my point of view, of course!).

Best wishes,

Roger

>
> THK
>
>>
>>  Hope this helps,
>>
>>  Roger
>> 
>> >  Thank you for any suggestions.
>> > 
>> >  Best wishes,
>> > 
>> >  Michal
>> > 
>> > 
>> > 
>> > 
>>
>>  --
>>  Roger Bivand
>>  Economic Geography Section, Department of Economics, Norwegian School of
>>  Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>>  Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>>  e-mail: Roger.Bivand at nhh.no
>>
>>  _______________________________________________
>>  R-sig-Geo mailing list
>>  R-sig-Geo at stat.math.ethz.ch
>>  https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> 
>
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From tkeitt at gmail.com  Mon Jul 16 19:49:30 2007
From: tkeitt at gmail.com (Tim Keitt)
Date: Mon, 16 Jul 2007 12:49:30 -0500
Subject: [R-sig-Geo] map algebra with ascii grid
In-Reply-To: <Pine.LNX.4.64.0707161928440.3407@reclus.nhh.no>
References: <Prayer.1.0.12.0707140712250.16121@amos.qub.ac.uk>
	<Pine.LNX.4.64.0707141412100.7919@reclus.nhh.no>
	<6262c54c0707151721m6100767ahfdec3e8882cc5122@mail.gmail.com>
	<Pine.LNX.4.64.0707161928440.3407@reclus.nhh.no>
Message-ID: <6262c54c0707161049p499f9fddje7476720fcff1f9e@mail.gmail.com>

On 7/16/07, Roger Bivand <Roger.Bivand at nhh.no> wrote:
> On Sun, 15 Jul 2007, Tim Keitt wrote:
>
> > On 7/14/07, Roger Bivand <Roger.Bivand at nhh.no> wrote:
> >>  On Sat, 14 Jul 2007, Michal Gallay wrote:
> >>
> >> >  Dear R Users,
> >> >
> >> >  could you please advise me on doing map algebra with spatial grids? It's
> >> >  the first time I am using spatial objects in R. I have imported an ascii
> >> >  grid file and wanted to round the values in it or sum with a value, but
> >> >  it
> >> >  gives an error message:
> >> >
> >> > >  require(maptools)
> >> > >  x <- readAsciiGrid(fname="xxxx.asc")
> >> > >  x+3
> >> >  Error in x + 3 : non-numeric argument to binary operator
> >> > >  round(x,2)
> >> >  Error in round(x, digits) : Non-numeric argument to mathematical
> >> >  function
> >> >
> >>
> >>  Arithmetic operations are not defined for SpatialGridDataFrame operations,
> >>  as the columns of the data frame (here a single column) may contain data
> >>  of different classes. Do the operations on the columns directly:
> >>
> >>  names(x)
> >>
> >>  If there is a column called "band1", then
> >>
> >>  x$band1 + 3
> >>
> >>  will print "band1" + 3, and
> >>
> >>  x$band1 <- x$band1 + 3
> >>
> >>  will add 3 to the "band1" column. Think what would happen if band1 was
> >>  categorical or logical to see why doing arithmetic directly isn't such a
> >>  good idea.
> >
> > Roger,
> >
> > While I agree that arithmetic directly on S?DF objects does not make a
> > lot of sense, I have always taken the view that if the name of a type
> > includes "data frame", then you are implicitly promising that the
> > object is substitutable for any other data.frame class object in a
> > function call. So if S?DF is meant to inherit (formally or informally)
> > from data.frame, one should be able to use a S?DF anywhere you could
> > use an ordinary data.frame object without changing the result. Of
> > course, I realize that S?DF is not mean to inherit directly from
> > data.frame (so it is clear from the programming standpoint, ie there
> > is no "inherits" relationship between data.frame and S?DF). Perhaps it
> > would be more clear to users if a different naming scheme were used?
>
> Tim,
>
> While there is something in your suggestion, my understanding of the White
> Book (1992) introduction of data frames is that they are lists of vectors
> of varying types but of equal lengths, and that they should play well with
> formulae. The current Spatial*DataFrame do indeed do this, and you can use
> them with model.frame() inside for example lm(), gstat(), and generally
> almost everywhere a real data frame is needed as a data= argument. I
> cannot recall ever using an arithmetic operation on a data frame myself,
> although I may be an exception (I coerse to matrix).
>
> Rather than trying to inherit from data.frame, the methods ($,[, [[, and
> assignment versions) provide data.frame operability.

Ah. OK. That satisfies my concern. I didn't pay close attention to
which operators were being discussed or whether they were within the
formal definition of "data frame". Sounds like the implementation is
meeting its naming "obligations."

THK

> Certainly I can see that there are differences of approach here,
> especially if remote sensing data are never going to have factors (unlike
> say GIS integration, where categorical data do occur). The exchange on the
> list earlier today (about why read.table() returns a data.frame and by
> default converts a character vector to a factor) seems to back me up (from
> my point of view, of course!).
>
> Best wishes,
>
> Roger
>
> >
> > THK
> >
> >>
> >>  Hope this helps,
> >>
> >>  Roger
> >>
> >> >  Thank you for any suggestions.
> >> >
> >> >  Best wishes,
> >> >
> >> >  Michal
> >> >
> >> >
> >> >
> >> >
> >>
> >>  --
> >>  Roger Bivand
> >>  Economic Geography Section, Department of Economics, Norwegian School of
> >>  Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> >>  Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> >>  e-mail: Roger.Bivand at nhh.no
> >>
> >>  _______________________________________________
> >>  R-sig-Geo mailing list
> >>  R-sig-Geo at stat.math.ethz.ch
> >>  https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >>
> >
> >
> >
>
> --
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>


-- 
Timothy H. Keitt, University of Texas at Austin
Contact info and schedule at http://www.keittlab.org/tkeitt/
Reprints at http://www.keittlab.org/tkeitt/papers/
ODF attachment? See http://www.openoffice.org/



From Robert.Denham at nrw.qld.gov.au  Tue Jul 17 01:02:45 2007
From: Robert.Denham at nrw.qld.gov.au (Denham Robert)
Date: Tue, 17 Jul 2007 09:02:45 +1000
Subject: [R-sig-Geo] map algebra with ascii grid
Message-ID: <66CE7F4ACF0C74439F9F6E0A5682930202D291B7@INDMAIL.lands.resnet.qg>

  
Philip,
      this sounds like an interesting approach.  Do you do anything in
particular to handle larger datasets?  How large are your images?

Robert Denham
Environmental Statistician
Remote Sensing Centre
Telephone 07 3896 9899 
www.nrw.qld.gov.au
 
Department of Natural Resources & Water
QScape Building, 80 Meiers Road, Indooroopilly Qld 4068
----------------------------------------------------------------------

Message: 1
Date: Sun, 15 Jul 2007 07:40:12 -0600
From: Philip Riggs <priggs at cnr.colostate.edu>
Subject: [R-sig-Geo]  map algebra with ascii grid
To: r-sig-geo at stat.math.ethz.ch
Message-ID: <3513F1E2-D6E1-4B2B-89E8-D0B00C2804B7 at cnr.colostate.edu>
Content-Type: text/plain; charset=US-ASCII; delsp=yes; format=flowed

>> Dear R Users,
>>
>> could you please advise me on doing map algebra with spatial grids? 
>> It's the first time I am using spatial objects in R. I have imported 
>> an ascii grid file and wanted to round the values in it or sum with a

>> value, but it gives an error message:
>>

>I use Python with Numpy/GDAL python bindings all the time to do spatial
algebra and manipulate grids.
>It has all the math functions, and in the case of categorical data you
can reassign values. Then I
>use rpy to do any statistical analyses in R. You could also do your
manipulation in Python, then 
>save the grid in an appropriate format for import into R to do the
statistical analyses.

> Philip




************************************************************************
The information in this email together with any attachments is
intended only for the person or entity to which it is addressed
and may contain confidential and/or privileged material.
Any form of review, disclosure, modification, distribution
and/or publication of this email message is prohibited, unless
as a necessary part of Departmental business.
If you have received this message in error, you are asked to
inform the sender as quickly as possible and delete this message
and any copies of this message from your computer and/or your
computer system network.



From tkeitt at gmail.com  Tue Jul 17 03:55:14 2007
From: tkeitt at gmail.com (Tim Keitt)
Date: Mon, 16 Jul 2007 20:55:14 -0500
Subject: [R-sig-Geo] map algebra with ascii grid
In-Reply-To: <66CE7F4ACF0C74439F9F6E0A5682930202D291B7@INDMAIL.lands.resnet.qg>
References: <66CE7F4ACF0C74439F9F6E0A5682930202D291B7@INDMAIL.lands.resnet.qg>
Message-ID: <6262c54c0707161855j2dedf79o8224c6408238868e@mail.gmail.com>

Any algebraic operation supported by R can easily be applied to a GDAL
image using rgdal -- size is virtually unlimited if you pull in data
as raster lines or tiles. The approach is to create an output image
and then use getRasterData and putRasterData to read chunks of data,
operate on them, and then write back to disk. I can work up an example
if anyone is interested.

THK

On 7/16/07, Denham Robert <Robert.Denham at nrw.qld.gov.au> wrote:
>
> Philip,
>       this sounds like an interesting approach.  Do you do anything in
> particular to handle larger datasets?  How large are your images?
>
> Robert Denham
> Environmental Statistician
> Remote Sensing Centre
> Telephone 07 3896 9899
> www.nrw.qld.gov.au
>
> Department of Natural Resources & Water
> QScape Building, 80 Meiers Road, Indooroopilly Qld 4068
> ----------------------------------------------------------------------
>
> Message: 1
> Date: Sun, 15 Jul 2007 07:40:12 -0600
> From: Philip Riggs <priggs at cnr.colostate.edu>
> Subject: [R-sig-Geo]  map algebra with ascii grid
> To: r-sig-geo at stat.math.ethz.ch
> Message-ID: <3513F1E2-D6E1-4B2B-89E8-D0B00C2804B7 at cnr.colostate.edu>
> Content-Type: text/plain; charset=US-ASCII; delsp=yes; format=flowed
>
> >> Dear R Users,
> >>
> >> could you please advise me on doing map algebra with spatial grids?
> >> It's the first time I am using spatial objects in R. I have imported
> >> an ascii grid file and wanted to round the values in it or sum with a
>
> >> value, but it gives an error message:
> >>
>
> >I use Python with Numpy/GDAL python bindings all the time to do spatial
> algebra and manipulate grids.
> >It has all the math functions, and in the case of categorical data you
> can reassign values. Then I
> >use rpy to do any statistical analyses in R. You could also do your
> manipulation in Python, then
> >save the grid in an appropriate format for import into R to do the
> statistical analyses.
>
> > Philip
>
>
>
>
> ************************************************************************
> The information in this email together with any attachments is
> intended only for the person or entity to which it is addressed
> and may contain confidential and/or privileged material.
> Any form of review, disclosure, modification, distribution
> and/or publication of this email message is prohibited, unless
> as a necessary part of Departmental business.
> If you have received this message in error, you are asked to
> inform the sender as quickly as possible and delete this message
> and any copies of this message from your computer and/or your
> computer system network.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


-- 
Timothy H. Keitt, University of Texas at Austin
Contact info and schedule at http://www.keittlab.org/tkeitt/
Reprints at http://www.keittlab.org/tkeitt/papers/
ODF attachment? See http://www.openoffice.org/



From adrian at maths.uwa.edu.au  Tue Jul 17 05:09:46 2007
From: adrian at maths.uwa.edu.au (adrian at maths.uwa.edu.au)
Date: Tue, 17 Jul 2007 11:09:46 +0800 (WST)
Subject: [R-sig-Geo] Calculations with images
In-Reply-To: <mailman.17.1184148013.29558.r-sig-geo@stat.math.ethz.ch>
References: <mailman.17.1184148013.29558.r-sig-geo@stat.math.ethz.ch>
Message-ID: <46715.130.95.98.17.1184641786.squirrel@130.95.98.17>

Agustin Lobo <Agustin.Lobo at ija.csic.es> writes:

> ai <- as.im(a)
> ai$v[ai$v==0]<-NA #0 values in the raster are the background
> adist <- distmap(as.owin(ai))
> adistlog <- adist
> adistlog$v <- log(adistlog$v+1) #log transform

In spatstat you can also use 'solutionset' to find the pixels that satisfy
a logical statement, and `eval.im' to do calculations with pixel values.
The code above is equivalent to

   ai <- as.im(a)
   aw <- solutionset(ai != 0)
   adist <- distmap(aw)
   adistlog <- eval.im(log(adist)+1)

Adrian Baddeley



From e.pebesma at geo.uu.nl  Tue Jul 17 08:50:31 2007
From: e.pebesma at geo.uu.nl (Edzer J. Pebesma)
Date: Tue, 17 Jul 2007 08:50:31 +0200
Subject: [R-sig-Geo] map algebra with ascii grid
In-Reply-To: <6262c54c0707161855j2dedf79o8224c6408238868e@mail.gmail.com>
References: <66CE7F4ACF0C74439F9F6E0A5682930202D291B7@INDMAIL.lands.resnet.qg>
	<6262c54c0707161855j2dedf79o8224c6408238868e@mail.gmail.com>
Message-ID: <469C66B7.8080401@geo.uu.nl>

As Roger mentioned, we did try to make the Spatial*DataFrame objects 
behave like a data.frame but indeed not with respect to applying direct 
arithmetric on them. I do agree with Tim that if a is a single-band 
SpatialGridDataFrame, then

a = a + 1

is more straightforward than

a$band1 = a$band1 + 1

although the latter does better reveal what's going on inside; the full 
story is of course that

a at data$band1 = a at data$band1 + 1

which make things pretty unreadable. In addition, if b is a single-band 
SpatialGridDataFrame only

a = a + b

could allow for checking that a and b are identical spatial grids, in 
contrast to

a$band1 = a$band1 + b$band1

So, yes, I like it, and it will break where a or b contain mixed double 
and factor variables, as it should.

The full map algebra, as I have been taught, includes besides 
arithmetical and logical operation the full set of useful functions (for 
both floats and factors) that take neighbouring cells into account, 
where neighbourhood can be global, a regular window or defined by 
another map (e.g. the land use category we're in). For an example of a 
list of functions, see for instance the work of my Utrecht colleagues:

http://pcraster.geog.uu.nl/documentation/pcrman/r2850.htm

where e.g. distance calculation is called "spread" with a constant 
friction map.

Now that would be nice to have in R.
--
Edzer


Tim Keitt wrote:
> Any algebraic operation supported by R can easily be applied to a GDAL
> image using rgdal -- size is virtually unlimited if you pull in data
> as raster lines or tiles. The approach is to create an output image
> and then use getRasterData and putRasterData to read chunks of data,
> operate on them, and then write back to disk. I can work up an example
> if anyone is interested.
>
> THK
>
> On 7/16/07, Denham Robert <Robert.Denham at nrw.qld.gov.au> wrote:
>   
>> Philip,
>>       this sounds like an interesting approach.  Do you do anything in
>> particular to handle larger datasets?  How large are your images?
>>
>> Robert Denham
>> Environmental Statistician
>> Remote Sensing Centre
>> Telephone 07 3896 9899
>> www.nrw.qld.gov.au
>>
>> Department of Natural Resources & Water
>> QScape Building, 80 Meiers Road, Indooroopilly Qld 4068
>> ----------------------------------------------------------------------
>>
>> Message: 1
>> Date: Sun, 15 Jul 2007 07:40:12 -0600
>> From: Philip Riggs <priggs at cnr.colostate.edu>
>> Subject: [R-sig-Geo]  map algebra with ascii grid
>> To: r-sig-geo at stat.math.ethz.ch
>> Message-ID: <3513F1E2-D6E1-4B2B-89E8-D0B00C2804B7 at cnr.colostate.edu>
>> Content-Type: text/plain; charset=US-ASCII; delsp=yes; format=flowed
>>
>>     
>>>> Dear R Users,
>>>>
>>>> could you please advise me on doing map algebra with spatial grids?
>>>> It's the first time I am using spatial objects in R. I have imported
>>>> an ascii grid file and wanted to round the values in it or sum with a
>>>>         
>>>> value, but it gives an error message:
>>>>
>>>>         
>>> I use Python with Numpy/GDAL python bindings all the time to do spatial
>>>       
>> algebra and manipulate grids.
>>     
>>> It has all the math functions, and in the case of categorical data you
>>>       
>> can reassign values. Then I
>>     
>>> use rpy to do any statistical analyses in R. You could also do your
>>>       
>> manipulation in Python, then
>>     
>>> save the grid in an appropriate format for import into R to do the
>>>       
>> statistical analyses.
>>
>>     
>>> Philip
>>>       
>>
>>
>> ************************************************************************
>> The information in this email together with any attachments is
>> intended only for the person or entity to which it is addressed
>> and may contain confidential and/or privileged material.
>> Any form of review, disclosure, modification, distribution
>> and/or publication of this email message is prohibited, unless
>> as a necessary part of Departmental business.
>> If you have received this message in error, you are asked to
>> inform the sender as quickly as possible and delete this message
>> and any copies of this message from your computer and/or your
>> computer system network.
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>     
>
>
>



From Roger.Bivand at nhh.no  Tue Jul 17 15:21:23 2007
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 17 Jul 2007 15:21:23 +0200 (CEST)
Subject: [R-sig-Geo] round class intervals in legend
In-Reply-To: <20070703095824.279480@gmx.net>
References: <20070703095824.279480@gmx.net>
Message-ID: <Pine.LNX.4.64.0707171516540.6471@reclus.nhh.no>

On Tue, 3 Jul 2007, Marco Helbich wrote:

> Dear list,
>
> I've analysed my dataset with the fanny() cluster analysis function and now I want to visualise the membership values. My question is: how can I round the class interval values printed in the legend (e.g. 3 digits)? The round() function doesn't work within the classIntervals().
>
> Below you can find an fictitious example with the sids dataset:
>
> library(cluster)
>
> xx <- readShapePoly(system.file("shapes/sids.shp", package="maptools")[1], IDvar="FIPSNO", proj4string=CRS("+proj=longlat +ellps=clrk66"))
> plot(xx, border="blue", axes=TRUE, las=1)
> names(xx)
> dat <- cbind(xx$SID74, xx$NWBIR74, xx$BIR79)
> fann <- fanny(dat, 3, maxit = 1000)
>
> par(mar=c(0.5,0.5,0.5,0.5))
> plotvar <- fann$membership[,1]
> nclr <- 6
> plotclr <- brewer.pal(nclr, "BuPu")
> class <- classIntervals(plotvar, nclr, style = "quantile")
> colcode <- findColours(class, plotclr)
> plot(xx)
> plot(xx, col = colcode, add = T)
> legend("topleft", legend=names(attr(colcode, "table")),
>    fill=attr(colcode, "palette"), cex = 0.75, bty = "n")
>
> I appreciate every hint! Thanks.

Sorry for the long delay, and thanks for the clear example. Use the 
"fixed" style to insert the fixed breaks - rounding the legend might be 
misleading, since some objects might change class:

brks <- round(class$brks, 3)
brks
class <- classIntervals(plotvar, nclr, style = "fixed",
   fixedBreaks = brks)
colcode <- findColours(class, plotclr)
plot(xx, col = colcode)
legend("topleft", legend=names(attr(colcode, "table")),
   fill=attr(colcode, "palette"), cex = 0.75, bty = "n")

looks OK, but beware of the largest and smallest breaks "orphaning" data 
at the edges through rounding.

Hope this helps,

Roger


>
> Marco
> __________________
>
> Marco Helbich
> ISR
> Postgasse 7/4/2
> A-1010, Vienna
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From Roger.Bivand at nhh.no  Tue Jul 17 16:14:17 2007
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 17 Jul 2007 16:14:17 +0200 (CEST)
Subject: [R-sig-Geo] library(shapefiles): write PolyLineZ or PolygonZ
 shapes?
In-Reply-To: <4693930B.5040202@uni-klu.ac.at>
References: <4693930B.5040202@uni-klu.ac.at>
Message-ID: <Pine.LNX.4.64.0707171608230.6471@reclus.nhh.no>

On Tue, 10 Jul 2007, Albrecht Gebhardt wrote:

> hi,
>
> I'm trying to write some 3D polygons as ESRI shapefile.

I think that this is quite hazardous. We do see 3D shapefiles in the wild, 
usually with Z=0 for all coordinates. I guess that something could be done 
in maptools, but not using sp classes, which are 2D for lines and 
polygons. I'm not sure if the shapefiles package author tracks this list 
regularly, so I've added him to this reply.

Roger

>
> While write.shp() has some code for type==13 or 15 (which is PolyLineZ
> and PolygonZ), there is no such part in convert.to.shapefile().
>
> example:
>
> first generate some X,Y,Z data and triangulate it (only X and Y):
>
> library(tripack)
> xyz<-as.data.frame(cbind(runif(5),runif(5),rnorm(5)))
> colnames(xyz)<-c("x","y","z")
> t<-tri.mesh(xyz$x,xyz$y)
> tr<-triangles(t)
> # generate one polyline per triangle:
> Id <- NULL; X <- NULL; Y <- NULL; Z <- NULL
> for(i in 1:dim(tr)[1]) {
>  Id <- c(Id,rep(i,3))
>  X <- c(X, xyz$x[tr[i,1]], xyz$x[tr[i,2]], xyz$x[tr[i,3]])
>  Y <- c(Y, xyz$y[tr[i,1]], xyz$y[tr[i,2]], xyz$y[tr[i,3]])
>  Z <- c(Z, xyz$z[tr[i,1]], xyz$z[tr[i,2]], xyz$z[tr[i,3]])
> }
> dd <- data.frame(Id=Id,X=X,Y=Y, Z=Z)
>
> dd contains now something like (three triangles):
>
>  Id          X         Y          Z
> 1  1 0.47578460 0.7062264  1.7720352
> 2  1 0.07356501 0.6989611 -0.3850338
> 3  1 0.24476600 0.2560522  0.5450287
> 4  2 0.47578460 0.7062264  1.7720352
> 5  2 0.24476600 0.2560522  0.5450287
> 6  2 0.47912981 0.2355883 -0.2675531
> 7  3 0.47578460 0.7062264  1.7720352
> 8  3 0.47912981 0.2355883 -0.2675531
> 9  3 0.78672806 0.3244467  0.8620736
>
> If I now try (in analogy to the write.shapefile PolyLine example)
>
> library(shapefiles)
> ddTable <- data.frame(Id=1:dim(tr)[1], Name=as.character(1:dim(tr)[1]))
> ddShapefile <- convert.to.shapefile(dd, ddTable, "Id", 13)
> write.shapefile(ddShapefile, "~/test/tri", arcgis=TRUE)
>
> I get an error:
>
> Fehler in "dimnames<-.data.frame"(`*tmp*`, value = list(c("1", "2", "3",  :
>    ung?ltige 'dimnames' f?r data frame gegeben   # invalid dimnames
>
> Now I tried to modify convert.to.shapefile() (see attachement) so that
> it somehow handles the type==13/15 case (but it contains some blind
> guesses regarding the content.sizes, I should read
> http://www.esri.com/library/whitepapers/pdfs/shapefile.pdf more
> precisely) and then at least it runs:
>
> ddShapefile <- my.convert.to.shapefile(dd, ddTable, "Id", 13)
> write.shapefile(ddShapefile, "~/test/tri", arcgis=TRUE)
>
> I can even re-read this file with
>
> f <- read.shapefile("~/test/tri")
>
> and "f" looks identical (but I didnt compare it bit by bit) to
> "ddShapefile"
>
> But GRASS doesn't like it, it only reads the first triangle:
>
> GRASS 6.0.1 (import_xy):~ > v.in.ogr dsn=~/test/tri.shp
> output=tri_import min_area=0.0001 snap=-1 -z
> Projection of input dataset and current location appear to match.
> Proceeding with import...
> Layer: tri
> WARNING: 2 features without geometry.
> -----------------------------------------------------
> Building topology ...
> 1 primitives registered
> Building areas:  100%
> 0 areas built
> 0 isles built
> Attaching islands:
> Attaching centroids:  100%
> Topology was built.
> Number of nodes     :   2
> Number of primitives:   1
> Number of points    :   0
> Number of lines     :   1
> Number of boundaries:   0
> Number of centroids :   0
> Number of areas     :   0
> Number of isles     :   0
>
>
>
>
>
> So my question is:
>
> Is it really necessary to extend functionality of convert.to.shapefile()
> to be able to write 3D polygons/polylines or am I simply missing the
> correct function?
>
>
>
> Thanks
>
> Albrecht
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From Roger.Bivand at nhh.no  Tue Jul 17 18:49:38 2007
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 17 Jul 2007 18:49:38 +0200 (CEST)
Subject: [R-sig-Geo] readOGR and nonASCII character
In-Reply-To: <4694F0D5.6090009@ija.csic.es>
References: <4694F0D5.6090009@ija.csic.es>
Message-ID: <Pine.LNX.4.64.0707171846350.6471@reclus.nhh.no>

On Wed, 11 Jul 2007, Agustin Lobo wrote:

> Hi list,
>
> Is there any way to get readOGR() to correctly read
> non-ascii character strings from the dbf file? I've
> checked and my dbf file correctly displays
> names with accents, but once read into R
> accents are substituted by wrong symbols.

We are dependent on what GDAL/OGR gives us here. Please try the equivalent 
function in maptools for your shapefile, and see whether the read.dbf() in 
foreign does any better. I'm assuming that you know the locale settings of 
your platform, and of the originating platform from sessionInfo()?

Roger

>
> Agus
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From rossiter at itc.nl  Wed Jul 18 09:17:27 2007
From: rossiter at itc.nl (David Rossiter)
Date: Wed, 18 Jul 2007 09:17:27 +0200
Subject: [R-sig-Geo] Non-symmetric variogram map in gstat
Message-ID: <5AF149DBB6DFE24AA3F4F53201E539ADB03F1A@itcnt24.itc.nl>

I've found a quite puzzling behaviour in gstat's variogram method, with
the map=T argument. I believe the result should be a symmetric map
because all the semivariances are squared differences. This is indeed
the case if I try an example from the Meuse set:

> library(gstat)
> data(meuse)
> coordinates(meuse) <- ~x + y
> class(meuse)
[1] "SpatialPointsDataFrame"
attr(,"package")
[1] "sp"
> v <- variogram(log(lead) ~ 1, meuse, cutoff=1000, width=200, map=T)
> plot(v)
> # symmetric plot as expected, confirm by looking at array
> v$map at data$var1
  [1] 0.241586 0.875118 1.329685 0.978228 0.877734 0.854946 0.628017
0.356488  0.323171 0.299103 0.389137
...
[111] 0.387982 0.302654 0.319343 0.356488 0.630622 0.862242 0.877734
0.978228  1.329685 0.875118 0.241586
> # and the number of pairs:
> v$map at data$np.var1
  [1]   2  10  13  36  44  63  86 137 141 122 123   3   7  26  53  60
92 123  150 156 123  87   4  12  41  61
 ...
[105]  92  61  53  26   7   3 122 122 143 137  87  64  44  36  13  10
2

BUT ... when I try with the Jura dataset I get non-symmetric results:

> data(jura)
> coordinates(jura.pred) <- ~Xloc + Yloc
> class(jura.pred)
[1] "SpatialPointsDataFrame"
attr(,"package")
[1] "sp"
> v <- variogram(Ni ~ 1, jura.pred, cutoff=1.2, width=0.18, map=T)
> plot(v)
# not symmetric! Confirm with array:
> v$map at data$var1
  [1]  89.5503  59.3319  88.4276  79.4282  75.1518 147.6931  55.4805
43.6888   70.5159  86.9107  59.5392
...
[188] 105.4008  48.2219  72.3849  35.7244  66.7842  62.4743  72.9742
72.6469   70.9808
> # and the number of pairs
> v$map at data$np.var1
  [1]  42  78  54  97 124  39 159  82  92  62  79  70  93  68 114  78
177  86   92  72  59  82 192  95 192  79
...
[183]  73 135  72  72  97 101  76 137  39 111 105 132  94  31

Clearly both the number of pairs and the resulting average semivariance
are not symmetric!

Both of the objects are converted to SpatialPointsDataFrames. I can see
no obvious reason for this discrepency.

D G Rossiter
Senior University Lecturer
Department of Earth Systems Analysis (DESA)
International Institute for Geo-Information Science and Earth
Observation (ITC)
mailto:rossiter at itc.nl,  Internet: http://www.itc.nl/personal/rossiter



From uclamathguy at gmail.com  Wed Jul 18 09:39:23 2007
From: uclamathguy at gmail.com (Ryan Rosario)
Date: Wed, 18 Jul 2007 00:39:23 -0700
Subject: [R-sig-Geo] The sum.w Field in SDF
Message-ID: <72fc09510707180039k2e04dcaarb13c0184d843a484@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070718/e52a4249/attachment.pl>

From e.pebesma at geo.uu.nl  Wed Jul 18 11:19:13 2007
From: e.pebesma at geo.uu.nl (Edzer J. Pebesma)
Date: Wed, 18 Jul 2007 11:19:13 +0200
Subject: [R-sig-Geo] Non-symmetric variogram map in gstat
In-Reply-To: <5AF149DBB6DFE24AA3F4F53201E539ADB03F1A@itcnt24.itc.nl>
References: <5AF149DBB6DFE24AA3F4F53201E539ADB03F1A@itcnt24.itc.nl>
Message-ID: <469DDB11.5010709@geo.uu.nl>

David, you may also notice that the map produced does not have a cell 
centre or cell 'crossing' at (0,0). Of course you'd assume enough 
cleverness that this would be enforced automatically, but too bad. Try

 v <- variogram(Ni ~ 1, jura.pred, cutoff=1.8, width=0.18, map=T)

(making sure that the cutoff is a multiple of the width) and you'll see 
something symmetric.

Best wishes,
--
Edzer

David Rossiter wrote:
> I've found a quite puzzling behaviour in gstat's variogram method, with
> the map=T argument. I believe the result should be a symmetric map
> because all the semivariances are squared differences. This is indeed
> the case if I try an example from the Meuse set:
>
>   
>> library(gstat)
>> data(meuse)
>> coordinates(meuse) <- ~x + y
>> class(meuse)
>>     
> [1] "SpatialPointsDataFrame"
> attr(,"package")
> [1] "sp"
>   
>> v <- variogram(log(lead) ~ 1, meuse, cutoff=1000, width=200, map=T)
>> plot(v)
>> # symmetric plot as expected, confirm by looking at array
>> v$map at data$var1
>>     
>   [1] 0.241586 0.875118 1.329685 0.978228 0.877734 0.854946 0.628017
> 0.356488  0.323171 0.299103 0.389137
> ...
> [111] 0.387982 0.302654 0.319343 0.356488 0.630622 0.862242 0.877734
> 0.978228  1.329685 0.875118 0.241586
>   
>> # and the number of pairs:
>> v$map at data$np.var1
>>     
>   [1]   2  10  13  36  44  63  86 137 141 122 123   3   7  26  53  60
> 92 123  150 156 123  87   4  12  41  61
>  ...
> [105]  92  61  53  26   7   3 122 122 143 137  87  64  44  36  13  10
> 2
>
> BUT ... when I try with the Jura dataset I get non-symmetric results:
>
>   
>> data(jura)
>> coordinates(jura.pred) <- ~Xloc + Yloc
>> class(jura.pred)
>>     
> [1] "SpatialPointsDataFrame"
> attr(,"package")
> [1] "sp"
>   
>> v <- variogram(Ni ~ 1, jura.pred, cutoff=1.2, width=0.18, map=T)
>> plot(v)
>>     
> # not symmetric! Confirm with array:
>   
>> v$map at data$var1
>>     
>   [1]  89.5503  59.3319  88.4276  79.4282  75.1518 147.6931  55.4805
> 43.6888   70.5159  86.9107  59.5392
> ...
> [188] 105.4008  48.2219  72.3849  35.7244  66.7842  62.4743  72.9742
> 72.6469   70.9808
>   
>> # and the number of pairs
>> v$map at data$np.var1
>>     
>   [1]  42  78  54  97 124  39 159  82  92  62  79  70  93  68 114  78
> 177  86   92  72  59  82 192  95 192  79
> ...
> [183]  73 135  72  72  97 101  76 137  39 111 105 132  94  31
>
> Clearly both the number of pairs and the resulting average semivariance
> are not symmetric!
>
> Both of the objects are converted to SpatialPointsDataFrames. I can see
> no obvious reason for this discrepency.
>
> D G Rossiter
> Senior University Lecturer
> Department of Earth Systems Analysis (DESA)
> International Institute for Geo-Information Science and Earth
> Observation (ITC)
> mailto:rossiter at itc.nl,  Internet: http://www.itc.nl/personal/rossiter
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



From rossiter at itc.nl  Wed Jul 18 14:23:28 2007
From: rossiter at itc.nl (David Rossiter)
Date: Wed, 18 Jul 2007 14:23:28 +0200
Subject: [R-sig-Geo] Non-symmetric variogram map in gstat
Message-ID: <5AF149DBB6DFE24AA3F4F53201E539ADB03F20@itcnt24.itc.nl>

Edzer Pebesma wrote:

> David, you may also notice that the map produced does not have a cell 
> centre or cell 'crossing' at (0,0). Of course you'd assume enough 
> cleverness that this would be enforced automatically, but too bad. Try
>
> v <- variogram(Ni ~ 1, jura.pred, cutoff=1.8, width=0.18, map=T)
>
> (making sure that the cutoff is a multiple of the width) and you'll
see 
> something symmetric.

Edzer,

Thanks for the quick response. That was pretty stupid of me, not
noticing that there was a discrepency in the parameters. I should have
considered something like that; the different dataset should not affect
the algorithm!

Indeed looking at v$map at coords[92,] in my example I see 0.06  0.06; this
is the closest to (0,0). If I try an even multiple:

v <- variogram(Ni ~ 1, jura.pred, cutoff=0.9, width=0.18, map=T)

I get one of the cells as [61,] -2.77556e-17 -8.32667e-17

which I guess is (0, 0) for all practical purposes!

Thanks again,

D G Rossiter
http://www.itc.nl/personal/rossiter



From tkeitt at gmail.com  Wed Jul 18 17:09:34 2007
From: tkeitt at gmail.com (Tim Keitt)
Date: Wed, 18 Jul 2007 10:09:34 -0500
Subject: [R-sig-Geo] Group-wise error variance and autocorrelation
Message-ID: <6262c54c0707180809v4b7a1318o2547c793f5e45e48@mail.gmail.com>

I'm trying to specify a model where the fixed effects are

dep ~ group + group:indep

and the error variance and spatial autocorrelation vary by group. I've
tried lme but AFAICT it only supports heteroscedasticity and
autocorrelation within groups. Any pointers?

THK

-- 
Timothy H. Keitt, University of Texas at Austin
Contact info and schedule at http://www.keittlab.org/tkeitt/
Reprints at http://www.keittlab.org/tkeitt/papers/
ODF attachment? See http://www.openoffice.org/



From Roger.Bivand at nhh.no  Wed Jul 18 18:03:57 2007
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 18 Jul 2007 18:03:57 +0200 (CEST)
Subject: [R-sig-Geo] The sum.w Field in SDF
In-Reply-To: <72fc09510707180039k2e04dcaarb13c0184d843a484@mail.gmail.com>
References: <72fc09510707180039k2e04dcaarb13c0184d843a484@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0707181752540.10580@reclus.nhh.no>

On Wed, 18 Jul 2007, Ryan Rosario wrote:

> I understand that the sum.w field is the sum of the weights associated with
> a particular observation/location.

This is apparently a follow-up to a question on 15 July about robust GWR. 
GWR is seriously affected by multicollinearity anyway (see Wheeler & 
Tiefelsdorf refered to on the gwr() help page), so trying this may be a 
waste of time.

>
> But what is this sum taken over? Is there a way to access the individual
> weights before they are summed?
>

It is simply the sum of weights for that fit point - with fixed bandwidth, 
the weights sums vary, so that is why it is reported.

> Basically, I need a single weight for each observation (not a sum), so that
> I can use the robust GWR method presented by Brundsdon et. al. So I need to
> divide sum.w by some number N. This will give me an average weight (more
> importantly, it is a single weight). In this case, what does N represent?
> The number of observations, or is it some number of iterations for a
> numerical method used in GWR?

No, you need to modify both gwr.sel() and gwr() to take a weights= 
argument like lm, and them multiply the geographical weights by the case 
weights for each fit point. Then you can use the formula you cite to 
construct case weights, but only for data points.

Note that you are mixing up data points and fit points - there are *no* 
residuals at fit points unless the fit points are data points. You can 
only try this trick if you force data and fit points to be the same (as 
when computing the hat matrix).

If you'd like to contribute patches for adding a weights= argument, I 
could look and see if they seem to work.

Roger

>
> Ryan
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From Jeff.Jorgensen at noaa.gov  Wed Jul 18 19:30:09 2007
From: Jeff.Jorgensen at noaa.gov (Jeff Jorgensen)
Date: Wed, 18 Jul 2007 10:30:09 -0700
Subject: [R-sig-Geo] plot.polylist polygon plot order
Message-ID: <469E4E21.4080909@noaa.gov>

Hello,

I've imported a shapefile of polygons (R v2.5.1 winxp, maptools v0.6-13) 
and I'm trying to assign colors to polygons in plot.polylist().  Is 
there a way to force the order in which polygons are plotted get the 
correct color associations to the corresponding polygons?

Best regards,

Jeff


-- 
Jeff Jorgensen
Northwest Fisheries Science Center
National Marine Fisheries Service
NOAA Fisheries
2725 Montlake Blvd. E.
Seattle, WA  98112

jeff.jorgensen at noaa.gov
ph:   206.860.3286
FAX:  206.860.3400



From robert.sutherland at alaska.gov  Wed Jul 18 19:56:32 2007
From: robert.sutherland at alaska.gov (Sutherland, Robert D (DFG))
Date: Wed, 18 Jul 2007 09:56:32 -0800
Subject: [R-sig-Geo] plot.polylist polygon plot order
In-Reply-To: <469E4E21.4080909@noaa.gov>
References: <469E4E21.4080909@noaa.gov>
Message-ID: <FC9D0A4DDB7D5040A9EF833049B61347231375@SOAANCMSG02.soa.alaska.gov>

Hi Jeff,

This is what I did.

HistBreaks<-quantile(datafileDf$nhunters,probs=c(0.1,0.2,
0.4,0.6,0.8,0.9,1.0),na.rm=TRUE)
np<-findInterval(datafileDf$nhunters, histBreaks, all.inside=TRUE)
colorsToUse<-colorSchemeV5
plot.polylist(datafilePolys, col=colorsToUse[np],  forcefill=FALSE)
plot.polylist(datafilePolys,  density = c(-1,20,20,-1,-1,-1,-1)[np],
angle=c(0,0,90,0,0,0,0)[np], forcefill=FALSE,add=TRUE)

the first plot.polylist plots the outline of the polygon, the second
call "colors" the polygon.

I hope this helps.

Bob

-----Original Message-----
From: r-sig-geo-bounces at stat.math.ethz.ch
[mailto:r-sig-geo-bounces at stat.math.ethz.ch] On Behalf Of Jeff Jorgensen
Sent: Wednesday, July 18, 2007 9:30 AM
To: r-sig-geo at stat.math.ethz.ch
Subject: [R-sig-Geo] plot.polylist polygon plot order

Hello,

I've imported a shapefile of polygons (R v2.5.1 winxp, maptools v0.6-13)

and I'm trying to assign colors to polygons in plot.polylist().  Is 
there a way to force the order in which polygons are plotted get the 
correct color associations to the corresponding polygons?

Best regards,

Jeff


-- 
Jeff Jorgensen
Northwest Fisheries Science Center
National Marine Fisheries Service
NOAA Fisheries
2725 Montlake Blvd. E.
Seattle, WA  98112

jeff.jorgensen at noaa.gov
ph:   206.860.3286
FAX:  206.860.3400

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at stat.math.ethz.ch
https://stat.ethz.ch/mailman/listinfo/r-sig-geo



From Jeff.Jorgensen at noaa.gov  Thu Jul 19 00:55:55 2007
From: Jeff.Jorgensen at noaa.gov (Jeff Jorgensen)
Date: Wed, 18 Jul 2007 15:55:55 -0700
Subject: [R-sig-Geo]  plot.polylist polygon plot order
References: <469E4E21.4080909@noaa.gov>
Message-ID: <469E9A7B.3020400@noaa.gov>

Hi Bob,

Thanks for the suggestion.

I figured out a way to force the polygon plot order, by referencing one 
of the attributes of the imported shapefile.  The polygons I used were 
6th field HUCs and I was able to use this attribute to order plotting:

shape<-readShapePoly(shapefile)#shapefile has a HUC6 column
plot(shape,col=colorlist[shape$HUC6[1:n]])# where n is the total
                                          # number of polygons


I used your suggestion to add lines to polygons with no data (NA, i.e., 
no color), using a second plot call with your suggestions for density 
and angle, also with the "[shape$HUC6[1:n]]" suffix as above with 
colorlist, and set add = T.  Worked like a charm.


Thanks so much.

Jeff





#####################################
Hi Jeff,

This is what I did.

HistBreaks<-quantile(datafileDf$nhunters,probs=c(0.1,0.2,
0.4,0.6,0.8,0.9,1.0),na.rm=TRUE)
np<-findInterval(datafileDf$nhunters, histBreaks, all.inside=TRUE)
colorsToUse<-colorSchemeV5
plot.polylist(datafilePolys, col=colorsToUse[np],  forcefill=FALSE)
plot.polylist(datafilePolys,  density = c(-1,20,20,-1,-1,-1,-1)[np],
angle=c(0,0,90,0,0,0,0)[np], forcefill=FALSE,add=TRUE)

the first plot.polylist plots the outline of the polygon, the second
call "colors" the polygon.

I hope this helps.

Bob

-----Original Message-----
From: r-sig-geo-bounces at stat.math.ethz.ch
[mailto:r-sig-geo-bounces at stat.math.ethz.ch] On Behalf Of Jeff Jorgensen
Sent: Wednesday, July 18, 2007 9:30 AM
To: r-sig-geo at stat.math.ethz.ch
Subject: [R-sig-Geo] plot.polylist polygon plot order

Hello,

I've imported a shapefile of polygons (R v2.5.1 winxp, maptools v0.6-13)

and I'm trying to assign colors to polygons in plot.polylist().  Is
there a way to force the order in which polygons are plotted get the
correct color associations to the corresponding polygons?

Best regards,

Jeff


-- 
Jeff Jorgensen
Northwest Fisheries Science Center
National Marine Fisheries Service
NOAA Fisheries
2725 Montlake Blvd. E.
Seattle, WA  98112

jeff.jorgensen at noaa.gov
ph:   206.860.3286
FAX:  206.860.3400



From sbegueria at eead.csic.es  Thu Jul 19 13:16:15 2007
From: sbegueria at eead.csic.es (=?ISO-8859-15?Q?Santiago_Beguer=EDa_Portugu=E9s?=)
Date: Thu, 19 Jul 2007 13:16:15 +0200
Subject: [R-sig-Geo] Group-wise error variance and autocorrelation
In-Reply-To: <mailman.17.1184839206.23896.r-sig-geo@stat.math.ethz.ch>
References: <mailman.17.1184839206.23896.r-sig-geo@stat.math.ethz.ch>
Message-ID: <469F47FF.7080909@eead.csic.es>

Hi Tim,

The nlme package allows to model the variance structure of the
within-group errors. It also allows to include spatial correlation
structures, in principle it is possible to define a grouping factor too,
although I've never used it.

Santiago Beguer?a Portugu?s


> Date: Wed, 18 Jul 2007 10:09:34 -0500
> From: "Tim Keitt" <tkeitt at gmail.com>
> Subject: [R-sig-Geo] Group-wise error variance and autocorrelation
> To: "R geostat list" <r-sig-geo at stat.math.ethz.ch>
> Message-ID:
> 	<6262c54c0707180809v4b7a1318o2547c793f5e45e48 at mail.gmail.com>
> Content-Type: text/plain; charset=ISO-8859-1; format=flowed
>
> I'm trying to specify a model where the fixed effects are
>
> dep ~ group + group:indep
>
> and the error variance and spatial autocorrelation vary by group. I've
> tried lme but AFAICT it only supports heteroscedasticity and
> autocorrelation within groups. Any pointers?
>
> THK
>
>   


-- 

---------------------------------

_PLEASE, TAKE NOTE OF MY NEW EMAIL_
_ADDRESS AND CONTACT DETAILS!_

Santiago Beguer?a Portugu?s (PhD)

Researcher

Estaci?n Experimental de Aula Dei - CSIC
(Aula Dei Experimental Station,
Spanish National Research Council)

Campus de Aula Dei,
Avda. Monta?ana, 1005
50059 - Zaragoza (Spain)

P.O. Box 202, 50080 - Zaragoza (Spain)

T (+34) 976 716 107
T (+34) 976 716 100 / ext. 2356
F (+34) 976 716 145

http://www.santiagobegueria.net


-------------- next part --------------
A non-text attachment was scrubbed...
Name: sbegueria.vcf
Type: text/x-vcard
Size: 435 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070719/7cc52ba9/attachment.vcf>

From tkeitt at gmail.com  Thu Jul 19 18:51:42 2007
From: tkeitt at gmail.com (Tim Keitt)
Date: Thu, 19 Jul 2007 11:51:42 -0500
Subject: [R-sig-Geo] Group-wise error variance and autocorrelation
In-Reply-To: <469F47FF.7080909@eead.csic.es>
References: <mailman.17.1184839206.23896.r-sig-geo@stat.math.ethz.ch>
	<469F47FF.7080909@eead.csic.es>
Message-ID: <6262c54c0707190951l685270b9lf551e05a6ead8760@mail.gmail.com>

Sorry, I've got Pinheiro and Bates sitting on my desk and should have
reread some chapters before posting -- it looks like I can accomplish
the task by building some custom pdMat classes.

THK

On 7/19/07, Santiago Beguer?a Portugu?s <sbegueria at eead.csic.es> wrote:
> Hi Tim,
>
> The nlme package allows to model the variance structure of the
> within-group errors. It also allows to include spatial correlation
> structures, in principle it is possible to define a grouping factor too,
> although I've never used it.
>
> Santiago Beguer?a Portugu?s
>
>
> > Date: Wed, 18 Jul 2007 10:09:34 -0500
> > From: "Tim Keitt" <tkeitt at gmail.com>
> > Subject: [R-sig-Geo] Group-wise error variance and autocorrelation
> > To: "R geostat list" <r-sig-geo at stat.math.ethz.ch>
> > Message-ID:
> >       <6262c54c0707180809v4b7a1318o2547c793f5e45e48 at mail.gmail.com>
> > Content-Type: text/plain; charset=ISO-8859-1; format=flowed
> >
> > I'm trying to specify a model where the fixed effects are
> >
> > dep ~ group + group:indep
> >
> > and the error variance and spatial autocorrelation vary by group. I've
> > tried lme but AFAICT it only supports heteroscedasticity and
> > autocorrelation within groups. Any pointers?
> >
> > THK
> >
> >
>
>
> --
>
> ---------------------------------
>
> _PLEASE, TAKE NOTE OF MY NEW EMAIL_
> _ADDRESS AND CONTACT DETAILS!_
>
> Santiago Beguer?a Portugu?s (PhD)
>
> Researcher
>
> Estaci?n Experimental de Aula Dei - CSIC
> (Aula Dei Experimental Station,
> Spanish National Research Council)
>
> Campus de Aula Dei,
> Avda. Monta?ana, 1005
> 50059 - Zaragoza (Spain)
>
> P.O. Box 202, 50080 - Zaragoza (Spain)
>
> T (+34) 976 716 107
> T (+34) 976 716 100 / ext. 2356
> F (+34) 976 716 145
>
> http://www.santiagobegueria.net
>
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
>


-- 
Timothy H. Keitt, University of Texas at Austin
Contact info and schedule at http://www.keittlab.org/tkeitt/
Reprints at http://www.keittlab.org/tkeitt/papers/
ODF attachment? See http://www.openoffice.org/



From t.szegvary at unibas.ch  Fri Jul 20 13:38:45 2007
From: t.szegvary at unibas.ch (Thomas Szegvary)
Date: Fri, 20 Jul 2007 13:38:45 +0200
Subject: [R-sig-Geo] Adding R-square to linear regression
Message-ID: <000701c7cac2$87dc0cc0$44349883@D59QMB1J>

Dear R users

I want to produce scatter plots from the following data set, using R 2.5.0

summary(comps)
OBS           TM5_STAND      
Min.   :  0.250   Min.   : 4.223 
1st Qu.:  2.440   1st Qu.: 5.539 
Median :  3.936   Median : 6.449 
Mean   :  4.475   Mean   : 6.748 
3rd Qu.:  5.790   3rd Qu.: 7.637
Max.   : 13.283   Max.   :15.452

A simple scatter plot, where I added a linear regression. Here is the code:

plot(comps$OBS,comps$TM5_STAND,xlab="observation",ylab="222-Rn
model",main="TM5_STAND")
abline(lm(comps$TM5_STAND ~ comps$OBS,data=comps))

But as i have to do this for a lot of datasets, I want to compare the
R-square and therefore would like to add the R-Square to the plot
automatically. I have checked faq and a lot of r-sig-geo messages but
haven't found a solution, for this I think trivial problem.

Does someone knows a code for this?
Many thanks

Thomas

__

Thomas Szegvary
Institute of Environmental Geosciences
Department of Geosciences
University of Basel
Bernoullistrasse 30
CH - 4056 Basel

Tel.  41-61-267 04 82
Fax. 41-61-267 04 79
Email: t.szegvary at unibas.ch
www.radon.unibas.ch
www.unibas.ch/environment



From rob.robinson at bto.org  Fri Jul 20 14:01:58 2007
From: rob.robinson at bto.org (Rob Robinson)
Date: Fri, 20 Jul 2007 13:01:58 +0100
Subject: [R-sig-Geo] Adding R-square to linear regression
In-Reply-To: <000701c7cac2$87dc0cc0$44349883@D59QMB1J>
Message-ID: <002501c7cac5$c66a93f0$5285c3c1@btodomain.bto.org>

Thomas,
 Can you not use text() to add a label? If you are using lm() to generate
the regression you can get at the R.sq by calling summary:
summary(c)$r.squared [there's also an adj.r.squared, have a look at
summary.lm]
So something along the lines of
text(x=xpos,y=ypos,summary(obj)$r.squared)
ought to work, see code below
Hth
rob


a=c(1,2,3,4,5)
b=c(1,3,2,5,4)
c=lm(a~b)
summary(c)$r.squared
plot(a~b)
text(x=2,y=2,summary(c)$r.squared)

*** Want to know about Britain's birds? Try  www.bto.org/birdfacts ***

Dr Rob Robinson, Senior Population Biologist
British Trust for Ornithology, The Nunnery, Thetford, Norfolk, IP24 2PU
Ph: +44 (0)1842 750050         E: rob.robinson at bto.org
Fx: +44 (0)1842 750030         W: http://www.bto.org
eSafe scanned this email for viruses, vandals and malicious content (!)

==== "How can anyone be enlightened, when truth is so poorly lit" =====
  

> -----Original Message-----
> From: r-sig-geo-bounces at stat.math.ethz.ch 
> [mailto:r-sig-geo-bounces at stat.math.ethz.ch] On Behalf Of 
> Thomas Szegvary
> Sent: 20 July 2007 12:39
> To: r-sig-geo at stat.math.ethz.ch
> Subject: [R-sig-Geo] Adding R-square to linear regression
> 
> Dear R users
> 
> I want to produce scatter plots from the following data set, 
> using R 2.5.0
> 
> summary(comps)
> OBS           TM5_STAND      
> Min.   :  0.250   Min.   : 4.223 
> 1st Qu.:  2.440   1st Qu.: 5.539 
> Median :  3.936   Median : 6.449 
> Mean   :  4.475   Mean   : 6.748 
> 3rd Qu.:  5.790   3rd Qu.: 7.637
> Max.   : 13.283   Max.   :15.452
> 
> A simple scatter plot, where I added a linear regression. 
> Here is the code:
> 
> plot(comps$OBS,comps$TM5_STAND,xlab="observation",ylab="222-Rn
> model",main="TM5_STAND")
> abline(lm(comps$TM5_STAND ~ comps$OBS,data=comps))
> 
> But as i have to do this for a lot of datasets, I want to 
> compare the R-square and therefore would like to add the 
> R-Square to the plot automatically. I have checked faq and a 
> lot of r-sig-geo messages but haven't found a solution, for 
> this I think trivial problem.
> 
> Does someone knows a code for this?
> Many thanks
> 
> Thomas
> 
> __
> 
> Thomas Szegvary
> Institute of Environmental Geosciences
> Department of Geosciences
> University of Basel
> Bernoullistrasse 30
> CH - 4056 Basel
> 
> Tel.  41-61-267 04 82
> Fax. 41-61-267 04 79
> Email: t.szegvary at unibas.ch
> www.radon.unibas.ch
> www.unibas.ch/environment
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



From andrew.niccolai at yale.edu  Fri Jul 20 14:29:37 2007
From: andrew.niccolai at yale.edu (Andrew Niccolai)
Date: Fri, 20 Jul 2007 08:29:37 -0400
Subject: [R-sig-Geo] Adding R-square to linear regression
In-Reply-To: <002501c7cac5$c66a93f0$5285c3c1@btodomain.bto.org>
References: <000701c7cac2$87dc0cc0$44349883@D59QMB1J>
	<002501c7cac5$c66a93f0$5285c3c1@btodomain.bto.org>
Message-ID: <000001c7cac9$a8d29a00$0302a8c0@D3K86YB1>

I would merely add to Rob's reply that the text line can be modified to the
following:

text(x=2,y=2, paste("R squared = ", summary(c)$r.squared, sep="")) 


Does anyone know the expression function that would produce an R squared
symbol?  I tried expression(R^2) and that seems to only works correctly if
you have a follow on formula such as expression(x^2 == sum(over(x[i], n),
i==1, n).  Any ideas? 


Andrew Niccolai
Doctoral Candidate
Yale School of Forestry


 
-----Original Message-----
From: r-sig-geo-bounces at stat.math.ethz.ch
[mailto:r-sig-geo-bounces at stat.math.ethz.ch] On Behalf Of Rob Robinson
Sent: Friday, July 20, 2007 8:02 AM
To: 'Thomas Szegvary'; r-sig-geo at stat.math.ethz.ch
Subject: Re: [R-sig-Geo] Adding R-square to linear regression

Thomas,
 Can you not use text() to add a label? If you are using lm() to generate
the regression you can get at the R.sq by calling summary:
summary(c)$r.squared [there's also an adj.r.squared, have a look at
summary.lm] So something along the lines of
text(x=xpos,y=ypos,summary(obj)$r.squared)
ought to work, see code below
Hth
rob


a=c(1,2,3,4,5)
b=c(1,3,2,5,4)
c=lm(a~b)
summary(c)$r.squared
plot(a~b)
text(x=2,y=2,summary(c)$r.squared)

*** Want to know about Britain's birds? Try  www.bto.org/birdfacts ***

Dr Rob Robinson, Senior Population Biologist British Trust for Ornithology,
The Nunnery, Thetford, Norfolk, IP24 2PU
Ph: +44 (0)1842 750050         E: rob.robinson at bto.org
Fx: +44 (0)1842 750030         W: http://www.bto.org
eSafe scanned this email for viruses, vandals and malicious content (!)

==== "How can anyone be enlightened, when truth is so poorly lit" =====
  

> -----Original Message-----
> From: r-sig-geo-bounces at stat.math.ethz.ch
> [mailto:r-sig-geo-bounces at stat.math.ethz.ch] On Behalf Of Thomas 
> Szegvary
> Sent: 20 July 2007 12:39
> To: r-sig-geo at stat.math.ethz.ch
> Subject: [R-sig-Geo] Adding R-square to linear regression
> 
> Dear R users
> 
> I want to produce scatter plots from the following data set, using R 
> 2.5.0
> 
> summary(comps)
> OBS           TM5_STAND      
> Min.   :  0.250   Min.   : 4.223 
> 1st Qu.:  2.440   1st Qu.: 5.539 
> Median :  3.936   Median : 6.449 
> Mean   :  4.475   Mean   : 6.748 
> 3rd Qu.:  5.790   3rd Qu.: 7.637
> Max.   : 13.283   Max.   :15.452
> 
> A simple scatter plot, where I added a linear regression. 
> Here is the code:
> 
> plot(comps$OBS,comps$TM5_STAND,xlab="observation",ylab="222-Rn
> model",main="TM5_STAND")
> abline(lm(comps$TM5_STAND ~ comps$OBS,data=comps))
> 
> But as i have to do this for a lot of datasets, I want to compare the 
> R-square and therefore would like to add the R-Square to the plot 
> automatically. I have checked faq and a lot of r-sig-geo messages but 
> haven't found a solution, for this I think trivial problem.
> 
> Does someone knows a code for this?
> Many thanks
> 
> Thomas
> 
> __
> 
> Thomas Szegvary
> Institute of Environmental Geosciences Department of Geosciences 
> University of Basel Bernoullistrasse 30 CH - 4056 Basel
> 
> Tel.  41-61-267 04 82
> Fax. 41-61-267 04 79
> Email: t.szegvary at unibas.ch
> www.radon.unibas.ch
> www.unibas.ch/environment
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at stat.math.ethz.ch
https://stat.ethz.ch/mailman/listinfo/r-sig-geo



From t.szegvary at unibas.ch  Fri Jul 20 15:26:09 2007
From: t.szegvary at unibas.ch (Thomas Szegvary)
Date: Fri, 20 Jul 2007 15:26:09 +0200
Subject: [R-sig-Geo] Adding R-square to linear regression
In-Reply-To: <000001c7cac9$a8d29a00$0302a8c0@D3K86YB1>
Message-ID: <000c01c7cad1$89181160$44349883@D59QMB1J>

 except for the R^2 symbol...I found that problem else where too, but have
no solution yet.




__

Thomas Szegvary
Institute of Environmental Geosciences
Department of Geosciences
University of Basel
Bernoullistrasse 30
CH - 4056 Basel

Tel.  41-61-267 04 82
Fax. 41-61-267 04 79
Email: t.szegvary at unibas.ch
www.radon.unibas.ch
www.unibas.ch/environment


 
-----Urspr?ngliche Nachricht-----
Von: Andrew Niccolai [mailto:andrew.niccolai at yale.edu] 
Gesendet: Freitag, 20. Juli 2007 14:30
An: rob.robinson at bto.org; 'Thomas Szegvary'; r-sig-geo at stat.math.ethz.ch
Betreff: RE: [R-sig-Geo] Adding R-square to linear regression

I would merely add to Rob's reply that the text line can be modified to the
following:

text(x=2,y=2, paste("R squared = ", summary(c)$r.squared, sep="")) 


Does anyone know the expression function that would produce an R squared
symbol?  I tried expression(R^2) and that seems to only works correctly if
you have a follow on formula such as expression(x^2 == sum(over(x[i], n),
i==1, n).  Any ideas? 


Andrew Niccolai
Doctoral Candidate
Yale School of Forestry


 
-----Original Message-----
From: r-sig-geo-bounces at stat.math.ethz.ch
[mailto:r-sig-geo-bounces at stat.math.ethz.ch] On Behalf Of Rob Robinson
Sent: Friday, July 20, 2007 8:02 AM
To: 'Thomas Szegvary'; r-sig-geo at stat.math.ethz.ch
Subject: Re: [R-sig-Geo] Adding R-square to linear regression

Thomas,
 Can you not use text() to add a label? If you are using lm() to generate
the regression you can get at the R.sq by calling summary:
summary(c)$r.squared [there's also an adj.r.squared, have a look at
summary.lm] So something along the lines of
text(x=xpos,y=ypos,summary(obj)$r.squared)
ought to work, see code below
Hth
rob


a=c(1,2,3,4,5)
b=c(1,3,2,5,4)
c=lm(a~b)
summary(c)$r.squared
plot(a~b)
text(x=2,y=2,summary(c)$r.squared)

*** Want to know about Britain's birds? Try  www.bto.org/birdfacts ***

Dr Rob Robinson, Senior Population Biologist British Trust for Ornithology,
The Nunnery, Thetford, Norfolk, IP24 2PU
Ph: +44 (0)1842 750050         E: rob.robinson at bto.org
Fx: +44 (0)1842 750030         W: http://www.bto.org
eSafe scanned this email for viruses, vandals and malicious content (!)

==== "How can anyone be enlightened, when truth is so poorly lit" =====
  

> -----Original Message-----
> From: r-sig-geo-bounces at stat.math.ethz.ch
> [mailto:r-sig-geo-bounces at stat.math.ethz.ch] On Behalf Of Thomas 
> Szegvary
> Sent: 20 July 2007 12:39
> To: r-sig-geo at stat.math.ethz.ch
> Subject: [R-sig-Geo] Adding R-square to linear regression
> 
> Dear R users
> 
> I want to produce scatter plots from the following data set, using R 
> 2.5.0
> 
> summary(comps)
> OBS           TM5_STAND      
> Min.   :  0.250   Min.   : 4.223 
> 1st Qu.:  2.440   1st Qu.: 5.539 
> Median :  3.936   Median : 6.449 
> Mean   :  4.475   Mean   : 6.748 
> 3rd Qu.:  5.790   3rd Qu.: 7.637
> Max.   : 13.283   Max.   :15.452
> 
> A simple scatter plot, where I added a linear regression. 
> Here is the code:
> 
> plot(comps$OBS,comps$TM5_STAND,xlab="observation",ylab="222-Rn
> model",main="TM5_STAND")
> abline(lm(comps$TM5_STAND ~ comps$OBS,data=comps))
> 
> But as i have to do this for a lot of datasets, I want to compare the 
> R-square and therefore would like to add the R-Square to the plot 
> automatically. I have checked faq and a lot of r-sig-geo messages but 
> haven't found a solution, for this I think trivial problem.
> 
> Does someone knows a code for this?
> Many thanks
> 
> Thomas
> 
> __
> 
> Thomas Szegvary
> Institute of Environmental Geosciences Department of Geosciences 
> University of Basel Bernoullistrasse 30 CH - 4056 Basel
> 
> Tel.  41-61-267 04 82
> Fax. 41-61-267 04 79
> Email: t.szegvary at unibas.ch
> www.radon.unibas.ch
> www.unibas.ch/environment
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at stat.math.ethz.ch
https://stat.ethz.ch/mailman/listinfo/r-sig-geo



From h.wickham at gmail.com  Fri Jul 20 16:27:53 2007
From: h.wickham at gmail.com (hadley wickham)
Date: Fri, 20 Jul 2007 16:27:53 +0200
Subject: [R-sig-Geo] Adding R-square to linear regression
In-Reply-To: <000c01c7cad1$89181160$44349883@D59QMB1J>
References: <000001c7cac9$a8d29a00$0302a8c0@D3K86YB1>
	<000c01c7cad1$89181160$44349883@D59QMB1J>
Message-ID: <f8e6ff050707200727g540380e6q47dd47de4a58de98@mail.gmail.com>

On 7/20/07, Thomas Szegvary <t.szegvary at unibas.ch> wrote:
>  except for the R^2 symbol...I found that problem else where too, but have
> no solution yet.

Have a look at ?plotmath.

Hadley



From t.szegvary at unibas.ch  Fri Jul 20 16:47:44 2007
From: t.szegvary at unibas.ch (Thomas Szegvary)
Date: Fri, 20 Jul 2007 16:47:44 +0200
Subject: [R-sig-Geo] Adding R-square to linear regression
In-Reply-To: <f8e6ff050707200727g540380e6q47dd47de4a58de98@mail.gmail.com>
Message-ID: <001101c7cadc$eed4ae40$44349883@D59QMB1J>

Thanks, I already checked plotmath. But the problem is that the symbol
itself works fine with expression(R^2), but if you want to combine plain
text with the symbol, expression() doesn't work. But I found a solution,
bquote is the magic word:


mtext(line= -1,side=3,bquote(R^2
==.(round(summary(lm4)$r.squared,3))),col="red",cex=0.7)



Thomas
 




__

Thomas Szegvary
Institute of Environmental Geosciences
Department of Geosciences
University of Basel
Bernoullistrasse 30
CH - 4056 Basel

Tel.  41-61-267 04 82
Fax. 41-61-267 04 79
Email: t.szegvary at unibas.ch
www.radon.unibas.ch
www.unibas.ch/environment


 
-----Urspr?ngliche Nachricht-----
Von: hadley wickham [mailto:h.wickham at gmail.com] 
Gesendet: Freitag, 20. Juli 2007 16:28
An: Thomas Szegvary
Cc: Andrew Niccolai; rob.robinson at bto.org; r-sig-geo at stat.math.ethz.ch
Betreff: Re: [R-sig-Geo] Adding R-square to linear regression

On 7/20/07, Thomas Szegvary <t.szegvary at unibas.ch> wrote:
>  except for the R^2 symbol...I found that problem else where too, but 
> have no solution yet.

Have a look at ?plotmath.

Hadley



From andrew.niccolai at yale.edu  Sat Jul 21 00:02:30 2007
From: andrew.niccolai at yale.edu (Andrew Niccolai)
Date: Fri, 20 Jul 2007 18:02:30 -0400
Subject: [R-sig-Geo] EBImage: converting watershed IndexedImage to polygons
In-Reply-To: <Pine.LNX.4.64.0707181752540.10580@reclus.nhh.no>
References: <72fc09510707180039k2e04dcaarb13c0184d843a484@mail.gmail.com>
	<Pine.LNX.4.64.0707181752540.10580@reclus.nhh.no>
Message-ID: <000101c7cb19$ab071ee0$0302a8c0@D3K86YB1>

Hello R-spatial group, I hope this email finds everyone well.  I have been
using the R package EBImage to convert .tif/.jpg images of forests into
watershed segmentation rasters.  However, I am having difficulty converting
these watershed images into polygons.  For those not familiar with EBImage
or watershed segmentation, the package essentially does an iterative series
of image erosion and dilating to try to create boundaries between objects
within an image that "bleed" into each other.  However, these images create
objects without any label values so within any image object resides several
similar but slightly different values encapsulated by an edge with much
lower (but slightly different) values.

I was wondering if anyone had any thoughts/suggestions for converting
IndexedImages to polygons?  I have an IndexedImage created using code along
these lines:

rgb <- abs(img.red - img.green)
#display(rgb)
rgb.u <- umask(rgb, r=11, s=5)
#display(rgb.u)

t <- thresh( blur(rgb.u, 4, 2), 15, 15)
t <- opening( closing(t, morphKern(9)) ) t <- erode(t,morphKern(9), iter=5)
#display(t)

w <- watershed( distmap(t) )
#display(normalize(w))
w2 <- getFeatures(w)

When I run getFeatures, I can see 362 rows in the array.  This corresponds
to what I assume are the number of objects in my watershed image.  However,
when I try to write out either w or normalize(w) I get either a binary image
(w) or an image with normalized values within each object and not a uniform
label id with each object.  Ideally, I would like to create an image with
362 objects with each object "filled" with a label value representing that
unique object.  Then I think I can convert the raster image to polygons
(although suggestions here are welcome as well).


Any help would be greatly appreciated.

Thank you,
Andrew 


Andrew Niccolai
Doctoral Candidate
Yale School of Forestry



From ddlg at milwpc.com  Sun Jul 22 18:00:44 2007
From: ddlg at milwpc.com (Gwendolen)
Date: Sun, 22 Jul 2007 23:00:44 +0700
Subject: [R-sig-Geo] publication
Message-ID: <46A37F2C.5070206@milwpc.com>


-------------- next part --------------
A non-text attachment was scrubbed...
Name: publication.pdf
Type: application/pdf
Size: 3356 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070722/9d7a750c/attachment.pdf>

From Agustin.Lobo at ija.csic.es  Sun Jul 22 19:07:53 2007
From: Agustin.Lobo at ija.csic.es (Agustin Lobo)
Date: Sun, 22 Jul 2007 19:07:53 +0200
Subject: [R-sig-Geo] Distmap Inconsistency?
Message-ID: <46A38EE9.1080809@ija.csic.es>

Dear list,

I have 2 raster (im) objects (ai and escenai) which
are identical except by 1 single pixel
at position 356,777:

 > ai$v[356,777]
[1] 255
 > escenai$v[356,777]
[1] NA

I calculate distmap for both:

refdist <- distmap(as.owin(ai))
adist630 <- distmap(as.owin(escenai))

As the only difference is that ai$v has a filled cell
at position 356,777, and distmap calculates distances to the
nearest not NA cell, values of adist630 should be either
equal or higher than refdist values. Nevertheless, this is not
the case for few cells:

dif <- (refdist$v - adist630$v)
 > range(dif)
[1] -25.01976  30.44687
 > dif[dif>0]
  [1]  6.638003 30.446868 29.122913 27.613710 25.879159 23.867316 
21.509986 18.716394
  [9] 15.364044 11.285587  6.250307

Is this a problem with distmap or am I misunderstanding something?
I can send the rda file upon request if anybody can help.

Agus

-- 
Dr. Agustin Lobo
Institut de Ciencies de la Terra "Jaume Almera" (CSIC)
LLuis Sole Sabaris s/n
08028 Barcelona
Spain
Tel. 34 934095410
Fax. 34 934110012
email: Agustin.Lobo at ija.csic.es
http://www.ija.csic.es/gt/obster



From Agustin.Lobo at ija.csic.es  Mon Jul 23 08:32:36 2007
From: Agustin.Lobo at ija.csic.es (Agustin Lobo)
Date: Mon, 23 Jul 2007 08:32:36 +0200
Subject: [R-sig-Geo] readOGR and nonASCII character
In-Reply-To: <Pine.LNX.4.64.0707171846350.6471@reclus.nhh.no>
References: <4694F0D5.6090009@ija.csic.es>
	<Pine.LNX.4.64.0707171846350.6471@reclus.nhh.no>
Message-ID: <46A44B84.8080706@ija.csic.es>

Roger,

read.shapefile() and read.dbf() yields weird symbols for non-ascii 
characters in the input file also.
Exporting to csv and reading in with read.csv(filename,sep=";") works 
fine (yes, it's odd, excel puts ";" instead of "," for CSV in spanish 
locale as
"," could be used for decimal separation)

My session.info output is:

 > sessionInfo()
R version 2.5.0 (2007-04-23)
i386-pc-mingw32

locale:
LC_COLLATE=Spanish_Spain.1252;LC_CTYPE=Spanish_Spain.1252;LC_MONETARY=Spanish_Spain.1252;LC_NUMERIC=C;LC_TIME=Spanish_Spain.1252

attached base packages:
[1] "stats"     "graphics"  "grDevices" "utils"     "datasets" 
"methods"   "base"

other attached packages:
   spatstat       mgcv shapefiles   maptools    foreign      rgdal 
    sp
   "1.11-7"   "1.3-23"      "0.6"   "0.6-13"   "0.8-20"   "0.5-13" 
"0.9-14"

Agus

Roger Bivand escribi?:
> On Wed, 11 Jul 2007, Agustin Lobo wrote:
> 
>> Hi list,
>>
>> Is there any way to get readOGR() to correctly read
>> non-ascii character strings from the dbf file? I've
>> checked and my dbf file correctly displays
>> names with accents, but once read into R
>> accents are substituted by wrong symbols.
> 
> We are dependent on what GDAL/OGR gives us here. Please try the 
> equivalent function in maptools for your shapefile, and see whether the 
> read.dbf() in foreign does any better. I'm assuming that you know the 
> locale settings of your platform, and of the originating platform from 
> sessionInfo()?
> 
> Roger
> 
>>
>> Agus
>>
>>
> 

-- 
Dr. Agustin Lobo
Institut de Ciencies de la Terra "Jaume Almera" (CSIC)
LLuis Sole Sabaris s/n
08028 Barcelona
Spain
Tel. 34 934095410
Fax. 34 934110012
email: Agustin.Lobo at ija.csic.es
http://www.ija.csic.es/gt/obster



From panp at netcabo.pt  Mon Jul 23 09:24:27 2007
From: panp at netcabo.pt (Paulo)
Date: Mon, 23 Jul 2007 08:24:27 +0100
Subject: [R-sig-Geo] =?windows-1252?q?l=92Euromillions=2E=2E=2E_il_r=E9sul?=
	=?windows-1252?q?te_!?=
Message-ID: <28362167336001902231678@computador>

Tu ne peux pas rester indiff?rent ? ceci !

... ?vous qaqnez un prix m?me quand vous n'avez qu'un num?ro.?

... ni ? cela : introduit membres, en r?alit? vous jouez GRATUITEMENT

http://www.pauloportal.pt.vu

Salut !

D?abord : si ? la fin de cet email, au cas o? ne sois pas int?ress?, ou m?me au d?but (si tu n?as pas envie de continuer ? lire)? tu le renvoies ? Je te prie de le faire et je te le remercie tout de suite.

Je fais passer cette information car je crois ? sa potentialit? ; moi, probablement comme toi, je suis un sceptique de ce genre de choses, mais cette fois-ci j?ai essay? de courir le risque (j?en ai marre de lire dans les revues les cas des gens qui gagnent de l?argent par le net !).

Je peux avancer que tout dans le site me para?t s?rieux et professionnel.

Merci de ta patience ( au cas o? tu n?as pas assez de temps ou de patience maintenant, garde pour plus tard quand tu seras plus calme, pour explorer le site ; c?est ce que j?ai fait? Je ne le nie pas, j?ai ? perdu ? une demi-heure, mais en lisant et en ayant compris le sch?ma, il n?y a plus rien ? penser !).

Noter bien : Lire avec beaucoup de soin, dans le site, le s?parateur Opportunit? d?Affaires.

 

Les phrases du site que je mettrais en relief :

? Devenez Membre joueur et nous vous attribuerons imm?diatement une position parmi les 39 joueurs ?

? Vous n?avez qu?? jouer avec 5 num?ros. Car ces 5 num?ros ? vos principaux num?ros comme on les appelle ? sont des combinaisons avec toutes les ?changes des 9 num?ros Etoile dans un mod?le math?matique sp?cifique, de fa?on que vous saurez au pr?alable que vous allez toucher sur les deux num?ros Etoile dans tous les concours. ?

? Avec deux num?ros de moins que l?habitude pour toucher, non seulement vous avez plus de chances de gagner le Jackpot, comme votre chance de gagner un prix augmente. ?

Pour que le syst?me fonctionne ? pour assurer ces num?ros ?toile vitaux garantis ? vous avez besoin de 36 cl?s simples pour chaque concours d?Euromillions ?

? Ce qui signifie que vous avez 36 opportunit?s de gagner ? chaque tirage ! ?

? Les trente-six cl?s signifient aussi que vous b?n?ficiez d?une capacit? du syst?me ? laquelle nous appelons la M?thode Multi-Prix ? - Il y a une d?monstration tr?s simple de son fonctionnement.

Au-del? de ce que tu pourras  (en ?liminant la crainte des payements avec des cartes par le net) et finalement si tu y arrives !!!

En revenant au d?but? Tu n?as aucun int?r?t ?... N?oublie pas dans ce cas de renvoyer le mail. Merci beaucoup.


 

Paulo Portal (Portugal)

http://www.pauloportal.pt.vu

 

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070723/ddab1f6f/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Mail Vencedor e Arvore_1semana.jpg
Type: image/jpeg
Size: 91905 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070723/ddab1f6f/attachment.jpg>

From t.szegvary at unibas.ch  Mon Jul 23 16:32:47 2007
From: t.szegvary at unibas.ch (Thomas Szegvary)
Date: Mon, 23 Jul 2007 16:32:47 +0200
Subject: [R-sig-Geo] Get lm formula
Message-ID: <001901c7cd36$571c9ed0$44349883@D59QMB1J>

I have several plots where I'd like to add the formula from the linear model
automatically, i.e. in form of y=ax+b, to the plot. I used lm() for a simple
scatter plot.
I was able to add the r-sqare to the plot, using summary(lm$r.square) to
extract the value for r^2. but for the coefficients a and b I couldn't
extract the values like for r-square. I can check the values using coef(lm),
but to be able to write it as text to the plot I should extract the values,
am I right? Or is there a better solution? Does anyone has an idea? I
couldn't find any yet...

Thanks a lot,Thomas



__

Thomas Szegvary
Institute of Environmental Geosciences
Department of Geosciences
University of Basel
Bernoullistrasse 30
CH - 4056 Basel

Tel.  41-61-267 04 82
Fax. 41-61-267 04 79
Email: t.szegvary at unibas.ch
www.radon.unibas.ch
www.unibas.ch/environment



From Thierry.ONKELINX at inbo.be  Mon Jul 23 17:15:21 2007
From: Thierry.ONKELINX at inbo.be (ONKELINX, Thierry)
Date: Mon, 23 Jul 2007 17:15:21 +0200
Subject: [R-sig-Geo] Get lm formula
In-Reply-To: <001901c7cd36$571c9ed0$44349883@D59QMB1J>
References: <001901c7cd36$571c9ed0$44349883@D59QMB1J>
Message-ID: <2E9C414912813E4EB981326983E0A10403585AD9@inboexch.inbo.be>

You'll need something like

x <- rnorm(100)
y <- 0.5 * x + rnorm(100) + 1
fit <- lm(y ~x)
paste("y =", round(fit$coef[2], 2), "x +", round(fit$coef[1], 2))

Please note that this is R-sig-geo, the R mailing list dedicated to
spatial issues. For more general questions (like this one) you'll get
more respons from R-help (r-help at stat.math.ethz.ch).

Cheers,

Thierry

------------------------------------------------------------------------
----
ir. Thierry Onkelinx
Instituut voor natuur- en bosonderzoek / Research Institute for Nature
and Forest
Cel biometrie, methodologie en kwaliteitszorg / Section biometrics,
methodology and quality assurance
Gaverstraat 4
9500 Geraardsbergen
Belgium
tel. + 32 54/436 185
Thierry.Onkelinx at inbo.be
www.inbo.be 

Do not put your faith in what statistics say until you have carefully
considered what they do not say.  ~William W. Watt
A statistical analysis, properly conducted, is a delicate dissection of
uncertainties, a surgery of suppositions. ~M.J.Moroney

 

> -----Oorspronkelijk bericht-----
> Van: r-sig-geo-bounces at stat.math.ethz.ch 
> [mailto:r-sig-geo-bounces at stat.math.ethz.ch] Namens Thomas Szegvary
> Verzonden: maandag 23 juli 2007 16:33
> Aan: r-sig-geo at stat.math.ethz.ch
> Onderwerp: [R-sig-Geo] Get lm formula
> 
> I have several plots where I'd like to add the formula from 
> the linear model automatically, i.e. in form of y=ax+b, to 
> the plot. I used lm() for a simple scatter plot.
> I was able to add the r-sqare to the plot, using 
> summary(lm$r.square) to extract the value for r^2. but for 
> the coefficients a and b I couldn't extract the values like 
> for r-square. I can check the values using coef(lm), but to 
> be able to write it as text to the plot I should extract the 
> values, am I right? Or is there a better solution? Does 
> anyone has an idea? I couldn't find any yet...
> 
> Thanks a lot,Thomas
> 
> 
> 
> __
> 
> Thomas Szegvary
> Institute of Environmental Geosciences
> Department of Geosciences
> University of Basel
> Bernoullistrasse 30
> CH - 4056 Basel
> 
> Tel.  41-61-267 04 82
> Fax. 41-61-267 04 79
> Email: t.szegvary at unibas.ch
> www.radon.unibas.ch
> www.unibas.ch/environment
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



From Brian.J.GREGOR at odot.state.or.us  Mon Jul 23 17:51:43 2007
From: Brian.J.GREGOR at odot.state.or.us (GREGOR Brian J)
Date: Mon, 23 Jul 2007 08:51:43 -0700
Subject: [R-sig-Geo] Triangular Tessellation of Polygon
Message-ID: <85F22579B2F963468877EC90D4A5DEB202232B51@EX-SALEMREV-4.odot.state.or.us>

I am developing functions to plot 3d maps using the rgl package. I'm
approaching the problem of plotting polygons by dividing polygons into
triangular facets that then can be plotted as surfaces using the
triangles3d function. This has turned out to be somewhat cumbersome
using my approach which is as follows:
1) Use read.shape from maptools to read in a polygon shapefile
2) For each group of vertices describing a polygon:
	a) Apply the delaunayn function in the geometry package to get a
Delaunay tessellation
	b) Remove triangles that have any segments whose center points
are outside the polygon (using the point.in.polygon function from the sp
package to identify these)
	c) Remove triangles that have any segments that cross a line
segment comprising the polygon (using the crossing.psp function from the
spatstat package to identify crossings)
	d) Build new triangles for polygon segments that were orphaned
by steps b and c (to be done).

This would be much simpler if there were a function to limit the
tessellation to the interior of the polygon in the first place. Does
anyone have or know of such a function? (Although there might be GIS
tools to do this, I am only interested in a solution in R so that it can
be used in R scripts.)

Brian Gregor, P.E.
Transportation Planning Analysis Unit
Oregon Department of Transportation
Brian.J.GREGOR at odot.state.or.us
(503) 986-4120



From Roger.Bivand at nhh.no  Mon Jul 23 21:17:03 2007
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 23 Jul 2007 21:17:03 +0200 (CEST)
Subject: [R-sig-Geo] readOGR and nonASCII character
In-Reply-To: <46A44B84.8080706@ija.csic.es>
References: <4694F0D5.6090009@ija.csic.es>
	<Pine.LNX.4.64.0707171846350.6471@reclus.nhh.no>
	<46A44B84.8080706@ija.csic.es>
Message-ID: <Pine.LNX.4.64.0707232107340.5847@reclus.nhh.no>

On Mon, 23 Jul 2007, Agustin Lobo wrote:

> Roger,
>
> read.shapefile() and read.dbf() yields weird symbols for non-ascii characters 
> in the input file also.
> Exporting to csv and reading in with read.csv(filename,sep=";") works fine 
> (yes, it's odd, excel puts ";" instead of "," for CSV in spanish locale as
> "," could be used for decimal separation)

(See read.csv2())

So a possible work-around is to use CSV or text files to transfer the 
affected character values. There are lots of possible difficulties when 
the data are generated by one program making some assumptions and then 
read by a different program with different assumptions. read.table() and 
friends do have an encoding= argument to assign a known code to character 
strings. There is a short note in the Data Import-Export manual, and much 
more about locales in the installation and administration manual.

Roger


>
> My session.info output is:
>
>>  sessionInfo()
> R version 2.5.0 (2007-04-23)
> i386-pc-mingw32
>
> locale:
> LC_COLLATE=Spanish_Spain.1252;LC_CTYPE=Spanish_Spain.1252;LC_MONETARY=Spanish_Spain.1252;LC_NUMERIC=C;LC_TIME=Spanish_Spain.1252
>
> attached base packages:
> [1] "stats"     "graphics"  "grDevices" "utils"     "datasets" "methods" 
> "base"
>
> other attached packages:
>   spatstat       mgcv shapefiles   maptools    foreign      rgdal sp
>  "1.11-7"   "1.3-23"      "0.6"   "0.6-13"   "0.8-20"   "0.5-13" "0.9-14"
>
> Agus
>
> Roger Bivand escribi?:
>>  On Wed, 11 Jul 2007, Agustin Lobo wrote:
>> 
>> >  Hi list,
>> > 
>> >  Is there any way to get readOGR() to correctly read
>> >  non-ascii character strings from the dbf file? I've
>> >  checked and my dbf file correctly displays
>> >  names with accents, but once read into R
>> >  accents are substituted by wrong symbols.
>>
>>  We are dependent on what GDAL/OGR gives us here. Please try the equivalent
>>  function in maptools for your shapefile, and see whether the read.dbf() in
>>  foreign does any better. I'm assuming that you know the locale settings of
>>  your platform, and of the originating platform from sessionInfo()?
>>
>>  Roger
>> 
>> > 
>> >  Agus
>> > 
>> >
>> 
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From Ailsa.Kerswell at environment.gov.au  Tue Jul 24 10:30:32 2007
From: Ailsa.Kerswell at environment.gov.au (Kerswell, Ailsa)
Date: Tue, 24 Jul 2007 18:30:32 +1000
Subject: [R-sig-Geo]  ask for help in using geoR [SEC=UNCLASSIFIED]
Message-ID: <B74177E7151DDD45B65711827F4960AD47DC1C@ACT01VEXCCL01.internal.govt>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070724/03e44e35/attachment.pl>

From legros at inrets.fr  Tue Jul 24 11:55:18 2007
From: legros at inrets.fr (legros)
Date: Tue, 24 Jul 2007 11:55:18 +0200
Subject: [R-sig-Geo]  points in shape file
Message-ID: <46A5CC86.5090207@inrets.fr>

Dear Roger Bivand,
I am using you R code called "shp2bnd".
However when I use it I have the following error message " Erreur : 
tentative de s?lectionner moins d'un ?l?ment".
I tried many things but nothing work.
Could you, please, help me?
Thanks you;
Di?go Legros



From Thierry.ONKELINX at inbo.be  Tue Jul 24 12:09:38 2007
From: Thierry.ONKELINX at inbo.be (ONKELINX, Thierry)
Date: Tue, 24 Jul 2007 12:09:38 +0200
Subject: [R-sig-Geo] points in shape file
In-Reply-To: <46A5CC86.5090207@inrets.fr>
References: <46A5CC86.5090207@inrets.fr>
Message-ID: <2E9C414912813E4EB981326983E0A10403585C20@inboexch.inbo.be>

Diego,

You should provide us with a reproducible sample of your code (even if it's not working). Reproducing the errors you get makes it easier for us to find the sollution.

Cheers,

Thierry

----------------------------------------------------------------------------
ir. Thierry Onkelinx
Instituut voor natuur- en bosonderzoek / Research Institute for Nature and Forest
Cel biometrie, methodologie en kwaliteitszorg / Section biometrics, methodology and quality assurance
Gaverstraat 4
9500 Geraardsbergen
Belgium
tel. + 32 54/436 185
Thierry.Onkelinx at inbo.be
www.inbo.be 

Do not put your faith in what statistics say until you have carefully considered what they do not say.  ~William W. Watt
A statistical analysis, properly conducted, is a delicate dissection of uncertainties, a surgery of suppositions. ~M.J.Moroney

 

> -----Oorspronkelijk bericht-----
> Van: r-sig-geo-bounces at stat.math.ethz.ch 
> [mailto:r-sig-geo-bounces at stat.math.ethz.ch] Namens legros
> Verzonden: dinsdag 24 juli 2007 11:55
> Aan: r-sig-geo at stat.math.ethz.ch
> Onderwerp: [R-sig-Geo] points in shape file
> 
> Dear Roger Bivand,
> I am using you R code called "shp2bnd".
> However when I use it I have the following error message " Erreur : 
> tentative de s?lectionner moins d'un ?l?ment".
> I tried many things but nothing work.
> Could you, please, help me?
> Thanks you;
> Di?go Legros
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



From Agustin.Lobo at ija.csic.es  Tue Jul 24 18:52:53 2007
From: Agustin.Lobo at ija.csic.es (Agustin Lobo)
Date: Tue, 24 Jul 2007 18:52:53 +0200
Subject: [R-sig-Geo] readOGR and nonASCII character
In-Reply-To: <Pine.LNX.4.64.0707232107340.5847@reclus.nhh.no>
References: <4694F0D5.6090009@ija.csic.es>
	<Pine.LNX.4.64.0707171846350.6471@reclus.nhh.no>
	<46A44B84.8080706@ija.csic.es>
	<Pine.LNX.4.64.0707232107340.5847@reclus.nhh.no>
Message-ID: <46A62E65.9050606@ija.csic.es>

This is what I do as a work-around:

ActiG <- 
readOGR("C:/ALOBO/dipu2006/espaisoberts_P037/GARRAF/GFO_EOA_TOTS_v4",layer="GFO_EOA_Acti_v4")
delme2 <- 
read.csv("C:/ALOBO/dipu2006/espaisoberts_P037/GARRAF/GFO_EOA_TOTS_v4/GFO_EOA_Acti_v4.csv",sep=";") 

ActiG at data$NOM_FINCA <- delme2$NOM_FINCA

but wanted to highlight the problem of non ascii characters. Also,
note that writeOGR works fine. After this, the dbf written by

writeOGR(pepa,layer="ActiG",driver="ESRI 
Shapefile",dsn="C:/ALOBO/dipu2006/espaisoberts_P037/GARRAF/GFO_EOA_TOTS_v4")

has accents, ?, and all the catalan subtleties!

Thanks for your patience

Agus


Roger Bivand escribi?:
> On Mon, 23 Jul 2007, Agustin Lobo wrote:
> 
>> Roger,
>>
>> read.shapefile() and read.dbf() yields weird symbols for non-ascii 
>> characters in the input file also.
>> Exporting to csv and reading in with read.csv(filename,sep=";") works 
>> fine (yes, it's odd, excel puts ";" instead of "," for CSV in spanish 
>> locale as
>> "," could be used for decimal separation)
> 
> (See read.csv2())
> 
> So a possible work-around is to use CSV or text files to transfer the 
> affected character values. There are lots of possible difficulties when 
> the data are generated by one program making some assumptions and then 
> read by a different program with different assumptions. read.table() and 
> friends do have an encoding= argument to assign a known code to 
> character strings. There is a short note in the Data Import-Export 
> manual, and much more about locales in the installation and 
> administration manual.
> 
> Roger
> 
> 
>>
>> My session.info output is:
>>
>>>  sessionInfo()
>> R version 2.5.0 (2007-04-23)
>> i386-pc-mingw32
>>
>> locale:
>> LC_COLLATE=Spanish_Spain.1252;LC_CTYPE=Spanish_Spain.1252;LC_MONETARY=Spanish_Spain.1252;LC_NUMERIC=C;LC_TIME=Spanish_Spain.1252 
>>
>>
>> attached base packages:
>> [1] "stats"     "graphics"  "grDevices" "utils"     "datasets" 
>> "methods" "base"
>>
>> other attached packages:
>>   spatstat       mgcv shapefiles   maptools    foreign      rgdal sp
>>  "1.11-7"   "1.3-23"      "0.6"   "0.6-13"   "0.8-20"   "0.5-13" "0.9-14"
>>
>> Agus
>>
>> Roger Bivand escribi?:
>>>  On Wed, 11 Jul 2007, Agustin Lobo wrote:
>>>
>>> >  Hi list,
>>> > >  Is there any way to get readOGR() to correctly read
>>> >  non-ascii character strings from the dbf file? I've
>>> >  checked and my dbf file correctly displays
>>> >  names with accents, but once read into R
>>> >  accents are substituted by wrong symbols.
>>>
>>>  We are dependent on what GDAL/OGR gives us here. Please try the 
>>> equivalent
>>>  function in maptools for your shapefile, and see whether the 
>>> read.dbf() in
>>>  foreign does any better. I'm assuming that you know the locale 
>>> settings of
>>>  your platform, and of the originating platform from sessionInfo()?
>>>
>>>  Roger
>>>
>>> > >  Agus
>>> > >
>>>
>>
>>
> 

-- 
Dr. Agustin Lobo
Institut de Ciencies de la Terra "Jaume Almera" (CSIC)
LLuis Sole Sabaris s/n
08028 Barcelona
Spain
Tel. 34 934095410
Fax. 34 934110012
email: Agustin.Lobo at ija.csic.es
http://www.ija.csic.es/gt/obster



From Roger.Bivand at nhh.no  Tue Jul 24 19:43:35 2007
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 24 Jul 2007 19:43:35 +0200 (CEST)
Subject: [R-sig-Geo] points in shape file
In-Reply-To: <2E9C414912813E4EB981326983E0A10403585C20@inboexch.inbo.be>
References: <46A5CC86.5090207@inrets.fr>
	<2E9C414912813E4EB981326983E0A10403585C20@inboexch.inbo.be>
Message-ID: <Pine.LNX.4.64.0707241936560.8461@reclus.nhh.no>

On Tue, 24 Jul 2007, ONKELINX, Thierry wrote:

> Diego,
>
> You should provide us with a reproducible sample of your code (even if 
> it's not working). Reproducing the errors you get makes it easier for us 
> to find the sollution.

Indeed. The code is in fact from the BayesX website, and isn't in any CRAN 
package as far as I know.

http://www.stat.uni-muenchen.de/~bayesx/maps/shp2bnd.r

Diego will need to enter traceback() immediately after the error, and add 
the output of sessionInfo(), to have any hope of getting helpful advice.

Roger

>
> Cheers,
>
> Thierry
>
> ----------------------------------------------------------------------------
> ir. Thierry Onkelinx
> Instituut voor natuur- en bosonderzoek / Research Institute for Nature and Forest
> Cel biometrie, methodologie en kwaliteitszorg / Section biometrics, methodology and quality assurance
> Gaverstraat 4
> 9500 Geraardsbergen
> Belgium
> tel. + 32 54/436 185
> Thierry.Onkelinx at inbo.be
> www.inbo.be
>
> Do not put your faith in what statistics say until you have carefully considered what they do not say.  ~William W. Watt
> A statistical analysis, properly conducted, is a delicate dissection of uncertainties, a surgery of suppositions. ~M.J.Moroney
>
>
>
>> -----Oorspronkelijk bericht-----
>> Van: r-sig-geo-bounces at stat.math.ethz.ch
>> [mailto:r-sig-geo-bounces at stat.math.ethz.ch] Namens legros
>> Verzonden: dinsdag 24 juli 2007 11:55
>> Aan: r-sig-geo at stat.math.ethz.ch
>> Onderwerp: [R-sig-Geo] points in shape file
>>
>> Dear Roger Bivand,
>> I am using you R code called "shp2bnd".
>> However when I use it I have the following error message " Erreur :
>> tentative de s?lectionner moins d'un ?l?ment".
>> I tried many things but nothing work.
>> Could you, please, help me?
>> Thanks you;
>> Di?go Legros
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From Roger.Bivand at nhh.no  Tue Jul 24 20:17:20 2007
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 24 Jul 2007 20:17:20 +0200 (CEST)
Subject: [R-sig-Geo] Triangular Tessellation of Polygon
In-Reply-To: <85F22579B2F963468877EC90D4A5DEB202232B51@EX-SALEMREV-4.odot.state.or.us>
References: <85F22579B2F963468877EC90D4A5DEB202232B51@EX-SALEMREV-4.odot.state.or.us>
Message-ID: <Pine.LNX.4.64.0707242010150.8461@reclus.nhh.no>

On Mon, 23 Jul 2007, GREGOR Brian J wrote:

> I am developing functions to plot 3d maps using the rgl package. I'm
> approaching the problem of plotting polygons by dividing polygons into
> triangular facets that then can be plotted as surfaces using the
> triangles3d function. This has turned out to be somewhat cumbersome
> using my approach which is as follows:
> 1) Use read.shape from maptools to read in a polygon shapefile
> 2) For each group of vertices describing a polygon:
> 	a) Apply the delaunayn function in the geometry package to get a
> Delaunay tessellation
> 	b) Remove triangles that have any segments whose center points
> are outside the polygon (using the point.in.polygon function from the sp
> package to identify these)
> 	c) Remove triangles that have any segments that cross a line
> segment comprising the polygon (using the crossing.psp function from the
> spatstat package to identify crossings)
> 	d) Build new triangles for polygon segments that were orphaned
> by steps b and c (to be done).
>
> This would be much simpler if there were a function to limit the
> tessellation to the interior of the polygon in the first place. Does
> anyone have or know of such a function? (Although there might be GIS
> tools to do this, I am only interested in a solution in R so that it can
> be used in R scripts.)

Have you looked at the triangulation code in the gpclib package, even 
though it is only 2D? Would it help pick out the internal triangles?

Roger

>
> Brian Gregor, P.E.
> Transportation Planning Analysis Unit
> Oregon Department of Transportation
> Brian.J.GREGOR at odot.state.or.us
> (503) 986-4120
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From Brian.J.GREGOR at odot.state.or.us  Tue Jul 24 21:28:23 2007
From: Brian.J.GREGOR at odot.state.or.us (GREGOR Brian J)
Date: Tue, 24 Jul 2007 12:28:23 -0700
Subject: [R-sig-Geo] Triangular Tessellation of Polygon
In-Reply-To: <Pine.LNX.4.64.0707242010150.8461@reclus.nhh.no>
Message-ID: <85F22579B2F963468877EC90D4A5DEB202232B5C@EX-SALEMREV-4.odot.state.or.us>

Thank you very much. The triangulate method is exactly what I was
looking for.

Brian Gregor, P.E.
Transportation Planning Analysis Unit
Oregon Department of Transportation
Brian.J.GREGOR at odot.state.or.us
(503) 986-4120


> -----Original Message-----
> From: Roger Bivand [mailto:Roger.Bivand at nhh.no] 
> Sent: Tuesday, July 24, 2007 11:17 AM
> To: GREGOR Brian J
> Cc: r-sig-geo at stat.math.ethz.ch
> Subject: Re: [R-sig-Geo] Triangular Tessellation of Polygon
> 
> 
> On Mon, 23 Jul 2007, GREGOR Brian J wrote:
> 
> > I am developing functions to plot 3d maps using the rgl package. I'm
> > approaching the problem of plotting polygons by dividing 
> polygons into
> > triangular facets that then can be plotted as surfaces using the
> > triangles3d function. This has turned out to be somewhat cumbersome
> > using my approach which is as follows:
> > 1) Use read.shape from maptools to read in a polygon shapefile
> > 2) For each group of vertices describing a polygon:
> > 	a) Apply the delaunayn function in the geometry package to get a
> > Delaunay tessellation
> > 	b) Remove triangles that have any segments whose center points
> > are outside the polygon (using the point.in.polygon 
> function from the sp
> > package to identify these)
> > 	c) Remove triangles that have any segments that cross a line
> > segment comprising the polygon (using the crossing.psp 
> function from the
> > spatstat package to identify crossings)
> > 	d) Build new triangles for polygon segments that were orphaned
> > by steps b and c (to be done).
> >
> > This would be much simpler if there were a function to limit the
> > tessellation to the interior of the polygon in the first place. Does
> > anyone have or know of such a function? (Although there might be GIS
> > tools to do this, I am only interested in a solution in R 
> so that it can
> > be used in R scripts.)
> 
> Have you looked at the triangulation code in the gpclib package, even 
> though it is only 2D? Would it help pick out the internal triangles?
> 
> Roger
> 
> >
> > Brian Gregor, P.E.
> > Transportation Planning Analysis Unit
> > Oregon Department of Transportation
> > Brian.J.GREGOR at odot.state.or.us
> > (503) 986-4120
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at stat.math.ethz.ch
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
> 
> -- 
> Roger Bivand
> Economic Geography Section, Department of Economics, 
> Norwegian School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>



From lisbethii at yahoo.com  Thu Jul 26 08:31:12 2007
From: lisbethii at yahoo.com (Lisbeth Riis)
Date: Wed, 25 Jul 2007 23:31:12 -0700 (PDT)
Subject: [R-sig-Geo] calculating anisotropy ratio
Message-ID: <281385.88293.qm@web45215.mail.sp1.yahoo.com>

I'm trying to work out a way to calculate anisotropy
ratios in a simple case with the direction of the
greatest and smallest continuity at right angles to
each other. I thought that I would do this by
minimizing the standard error of the variogram as in
the following:

library(sp)
data(meuse)
coordinates(meuse) =~ x+y
meuse = meuse["zinc"]
meuse$zinc = log(meuse$zinc)
data(meuse.grid)
gridded(meuse.grid) =~ x+y

library(automap) # available at
http://intamap.geo.uu.nl/~paul/Downloads.html

"f" <-
function(ani, z, data)
{
  data at coords[, 2] <- data at coords[, 2] * ani
  variogram = autofitVariogram(z, data)
  attr(variogram$var_model, "SSErr")
}

ani <- optimize(f, c(0, 100), maximum = FALSE, tol =
1, z = log(zinc)~1, data = meuse)
meuseA <- meuse
meuseA at coords[, 2] <- meuseA at coords[, 2] * ani$minimum
kriging_resultA <- autoKrige(meuse, meuse.grid,
meuseA)
plot(kriging_resultA) 

# without anisotropy
kriging_result = autoKrige(meuse, meuse.grid)
plot(kriging_result)

However, minimizing the standard error doesn't seem to
be the right thing to do, as the larger I make the
ratio, the smaller the standard error. Is there
another measure I should be using?? 

Lisbeth,

PS. Sorry, the meuse data set isn't the best example
as it doesn't fit my assumption about anisotropy ratio
at right angles, but everyone has access to it.

Lisbeth R.i.i.s.
S-c-a-r-a-b  C-o-n-s-u-l-t




      ____________________________________________________________________________________
Luggage? GPS? Comic books?



From mrufino at cripsul.ipimar.pt  Thu Jul 26 13:42:50 2007
From: mrufino at cripsul.ipimar.pt (Marta Rufino)
Date: Thu, 26 Jul 2007 12:42:50 +0100
Subject: [R-sig-Geo] azymuth error, polygons and Lisbon projection
Message-ID: <46A888BA.7010304@cripsul.ipimar.pt>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070726/8cb601ec/attachment.pl>

From Roger.Bivand at nhh.no  Thu Jul 26 17:59:08 2007
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 26 Jul 2007 17:59:08 +0200 (CEST)
Subject: [R-sig-Geo] azymuth error, polygons and Lisbon projection
In-Reply-To: <46A888BA.7010304@cripsul.ipimar.pt>
References: <46A888BA.7010304@cripsul.ipimar.pt>
Message-ID: <Pine.LNX.4.64.0707261728150.21064@reclus.nhh.no>

On Thu, 26 Jul 2007, Marta Rufino wrote:

> Hello,
>
>
> I have four doubts:
>
> 1)
> why gzAzymuth is giving me Northern direction in this case, for example?

gzAzymuth() in the maptools package is for geographical coordinates, as 
its help page says, and yours seem to be projected.

>
> require(sp); require(rgdal)
>
> kk=data.frame(x=c(575552.8,576295.9), y=c(4103900,4103611))
> coordinates(kk)=~x+y
> plot(kk, typ="o", col=4)
> gzAzimuth(coordinates(kk)[1,], coordinates(kk)[2,])
>
> 2) how to cut a polygon (for example a border file) into chuncks? (i.e.
> separate areas, according to a line)

With difficulty, probably using functions in the gpclib package to 
intersect the polygon with a rectangle. There is code inside Rgshhs() in 
maptools that uses this approach - the difficulty is that the polygon 
border may cross the line several times, creating multiple included 
fragments.

>
> 3) how to create multiple polygons, from a grid file, according to a
> criteria. For example, :
>
> require(gstat)
> data(meuse)
> coordinates(meuse) = ~x+y
> data(meuse.grid)
> gridded(meuse.grid) = ~x+y
> m <- vgm(.59, "Sph", 874, .04) # ordinary kriging:
> x <- krige(log(zinc)~1, meuse, meuse.grid, model = m)
> spplot(x["var1.pred"], main = "ordinary kriging predictions")
> # how to create a polygon with the areas greater than 5...

t1 <- as.SpatialPolygons.SpatialPixels(x)
df <- slot(x, "data")
rownames(df) <- sapply(slot(t1, "polygons"), function(x) slot(x, "ID"))
t2 <- SpatialPolygonsDataFrame(t1, data=df)
library(maptools)
library(gpclib)
t3 <- unionSpatialPolygons(t2, t2$var1.pred > 5)
spl1 <- list("sp.polygons", t3, lwd=2, col="blue")
spplot(t2, "var1.pred", sp.layout=list(spl1))

>
>
> 4) Is it defined in proj4, the datum lisboa, Sistema of Hayford- Gauss
> Militar? and UTM, using zone 29N (29 is down here, for example...)?
> CRS("+proj=utm +zone=29 +datum=WGS84")

Maybe you should cross-check on Grids & Datums:

http://www.asprs.org/resources/GRIDS/

April 2002. It seems to have most of what you need to construct a proj4 
encoding for the Lisboa datum, Hayford-Gauss system maps, but you'll need 
to be careful, and check with other users. It looks very like 
"+init=epsg:20790" without a datum, but the G&D and EPSG reverse the false 
eastings and northings.

>
> How do we specify it?
>
>

Hope this helps,

Roger

> Thank you very much in advance,... any help will be much appreciated...
> Best regards,
> Marta
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From helber at nrlssc.navy.mil  Thu Jul 26 22:25:14 2007
From: helber at nrlssc.navy.mil (Robert Helber)
Date: Thu, 26 Jul 2007 15:25:14 -0500
Subject: [R-sig-Geo] Kriging
Message-ID: <46A9032A.90902@nrlssc.navy.mil>

I am attempting to krige a very large 2D region using the geoR package 
(http://cran.ssds.ucdavis.edu/).  The geoR kriging works well for 
regions that have stationary data.  My big region has areas where the 
trend and possibly the variogram changes.  Because of this I am trying 
to split up the big region into smaller regions that have more 
stationary data so that I can krige each region separately.  The problem 
I'm having is that sub-regions that are too small have too little data 
to make a good variogram.  I need to choose the correct size sub-region. 
  My total region is very big and need to automate the process.  Is 
there R software out there that will help with this?  Is there a way to 
choose the size of the subregion in a systematic and logical way?

Thanks.



From Thierry.ONKELINX at inbo.be  Fri Jul 27 10:43:54 2007
From: Thierry.ONKELINX at inbo.be (ONKELINX, Thierry)
Date: Fri, 27 Jul 2007 10:43:54 +0200
Subject: [R-sig-Geo] Kriging
In-Reply-To: <46A9032A.90902@nrlssc.navy.mil>
References: <46A9032A.90902@nrlssc.navy.mil>
Message-ID: <2E9C414912813E4EB981326983E0A104036A2D8C@inboexch.inbo.be>

Dear Robert,

In my opinion you need to look for some secundary information that will
allow you to split your data into subregions. Trying some arbitairy
dvisions and then choosing the one with the best fit may lead to an
overfit of the data.

If the phenomenom that you're studying depends on the geology then you
could look for a stratification by e.g. rocktype.

HTH,

Thierry

------------------------------------------------------------------------
----
ir. Thierry Onkelinx
Instituut voor natuur- en bosonderzoek / Research Institute for Nature
and Forest
Cel biometrie, methodologie en kwaliteitszorg / Section biometrics,
methodology and quality assurance
Gaverstraat 4
9500 Geraardsbergen
Belgium
tel. + 32 54/436 185
Thierry.Onkelinx at inbo.be
www.inbo.be 

Do not put your faith in what statistics say until you have carefully
considered what they do not say.  ~William W. Watt
A statistical analysis, properly conducted, is a delicate dissection of
uncertainties, a surgery of suppositions. ~M.J.Moroney

 

> -----Oorspronkelijk bericht-----
> Van: r-sig-geo-bounces at stat.math.ethz.ch 
> [mailto:r-sig-geo-bounces at stat.math.ethz.ch] Namens Robert Helber
> Verzonden: donderdag 26 juli 2007 22:25
> Aan: R geo
> Onderwerp: [R-sig-Geo] Kriging
> 
> I am attempting to krige a very large 2D region using the 
> geoR package (http://cran.ssds.ucdavis.edu/).  The geoR 
> kriging works well for regions that have stationary data.  My 
> big region has areas where the trend and possibly the 
> variogram changes.  Because of this I am trying to split up 
> the big region into smaller regions that have more stationary 
> data so that I can krige each region separately.  The problem 
> I'm having is that sub-regions that are too small have too 
> little data to make a good variogram.  I need to choose the 
> correct size sub-region. 
>   My total region is very big and need to automate the 
> process.  Is there R software out there that will help with 
> this?  Is there a way to choose the size of the subregion in 
> a systematic and logical way?
> 
> Thanks.
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



From sibonile at gmail.com  Tue Jul 31 15:04:13 2007
From: sibonile at gmail.com (sibonile sibanda)
Date: Tue, 31 Jul 2007 15:04:13 +0200
Subject: [R-sig-Geo] Moving Average/Surface
Message-ID: <4a9be9480707310604q4bece62apa2eaee3980fb07f8@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070731/938d4a0b/attachment.pl>

