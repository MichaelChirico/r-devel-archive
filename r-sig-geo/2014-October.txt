From thi_veloso at yahoo.com.br  Wed Oct  1 00:16:50 2014
From: thi_veloso at yahoo.com.br (Thiago V. dos Santos)
Date: Tue, 30 Sep 2014 15:16:50 -0700
Subject: [R-sig-Geo] Fill levelplot with pattern instead of color
Message-ID: <1412115410.31587.YahooMailNeo@web121904.mail.ne1.yahoo.com>

Dear all,
I am using level plots from the R rasterVis package to plot land use classes as categorical data. The example from the function help can be used to create some categorical data:
r <- raster(nrow=10, ncol=10)
r[] = 1
r[51:100] = 3
r[3:6, 1:5] = 5
r <- ratify(r)
rat <- levels(r)[[1]]

rat$landcover <- c('Pine', 'Oak', 'Meadow')
rat$class <- c('A1', 'B2', 'C3')
levels(r) <- rat
levelplot(r, col.regions=c('white', 'grey', 'black'))

My problem is that the classes in my dataset are more subtle, and therefore grey levels do not properly show some of them (it lacks contrast). As an alternative, I wonder if there is some way to fill a specific class (in the example above, let's say 'Meadow') with patterns (say, hatched) instead of colors.

A good example of what I mean by pattern is this map: http://www.ucl.ac.uk/~ucfbpve/papers/VermeeschIGR2003/chinazones2.jpg
Thanks in advance for any direction. 
Greetings,
--
Thiago V. dos Santos
PhD student
Land and Atmospheric Science
University of Minnesota
http://www.laas.umn.edu/CurrentStudents/MeettheStudents/ThiagodosSantos/index.htm
Phone: (612) 323 9898
	[[alternative HTML version deleted]]


From eneko.bachiller at imr.no  Wed Oct  1 11:12:37 2014
From: eneko.bachiller at imr.no (Bachiller Eneko)
Date: Wed, 1 Oct 2014 09:12:37 +0000
Subject: [R-sig-Geo] FW: Re: Load a map png in ggplot2 (workaround for
 missing world map support in ggmap)
Message-ID: <B0C6D1CBA16AD24BA204698A4722B5D45EB93732@EXMBX2.imr.no>

Dear Markus,

I have found the same problem and I would like to know if you found out any solution...
I mean, I have some maps (from Surfer) that I would like to import to ggmap. The point would be to be able to import the basemap and georeference that (adjust x/y axes) in order to plot my spatial data there.
I guess this is the same question you made in this blog in Oct 2013 but I ignore if you solved that...

I would be very grateful if you could help me with some ideas and/or possible alternative options.
Thank you very much ended.
Kindest regards,

Dr. Eneko Bachiller
Institute of Marine Research
Bergen, Norway

	[[alternative HTML version deleted]]


From Roger.Bivand at nhh.no  Wed Oct  1 11:24:56 2014
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 1 Oct 2014 11:24:56 +0200
Subject: [R-sig-Geo] FW: Re: Load a map png in ggplot2 (workaround for
 missing world map support in ggmap)
In-Reply-To: <B0C6D1CBA16AD24BA204698A4722B5D45EB93732@EXMBX2.imr.no>
References: <B0C6D1CBA16AD24BA204698A4722B5D45EB93732@EXMBX2.imr.no>
Message-ID: <alpine.LRH.2.03.1410011119570.5199@reclus.nhh.no>

On Wed, 1 Oct 2014, Bachiller Eneko wrote:

> Dear Markus,
>
> I have found the same problem and I would like to know if you found out 
> any solution... I mean, I have some maps (from Surfer) that I would like 
> to import to ggmap. The point would be to be able to import the basemap 
> and georeference that (adjust x/y axes) in order to plot my spatial data 
> there. I guess this is the same question you made in this blog in Oct 
> 2013 but I ignore if you solved that...

I don't think anyone here knows what blog, and I don't see a link to it. 
Note that this list is plain text only, and your posting is HTML.

Please consult Oscar Perpig?an's book, in which he explains that what you 
are trying to do isn't smart, and shows how to use his package rasterVis. 
You need to import the raster file as a georeferenced raster file - 
guessing where things are may be acceptable for artistic wallpaper, but is 
no use in analysis.

Hope this helps,

Roger

>
> I would be very grateful if you could help me with some ideas and/or 
> possible alternative options. Thank you very much ended. Kindest 
> regards,
>
> Dr. Eneko Bachiller
> Institute of Marine Research
> Bergen, Norway
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no

From eneko.bachiller at imr.no  Wed Oct  1 11:30:45 2014
From: eneko.bachiller at imr.no (Bachiller Eneko)
Date: Wed, 1 Oct 2014 09:30:45 +0000
Subject: [R-sig-Geo] FW: Re: Load a map png in ggplot2 (workaround for
 missing world map support in ggmap)
In-Reply-To: <alpine.LRH.2.03.1410011119570.5199@reclus.nhh.no>
References: <B0C6D1CBA16AD24BA204698A4722B5D45EB93732@EXMBX2.imr.no>
	<alpine.LRH.2.03.1410011119570.5199@reclus.nhh.no>
Message-ID: <B0C6D1CBA16AD24BA204698A4722B5D45EB9375B@EXMBX2.imr.no>

Hi Roger,
This is the website I was talking about...
https://stat.ethz.ch/pipermail/r-sig-geo/2013-October/019635.html

I guess this is the correct email group for my question. If not please let me know.
Apologizes for any inconvenient and thanks for your suggestion.
All the best,

Eneko

-----Original Message-----
From: Roger Bivand [mailto:Roger.Bivand at nhh.no] 
Sent: Wednesday, October 01, 2014 11:25 AM
To: Bachiller Eneko
Cc: r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] FW: Re: Load a map png in ggplot2 (workaround for missing world map support in ggmap)

On Wed, 1 Oct 2014, Bachiller Eneko wrote:

> Dear Markus,
>
> I have found the same problem and I would like to know if you found 
> out any solution... I mean, I have some maps (from Surfer) that I 
> would like to import to ggmap. The point would be to be able to import 
> the basemap and georeference that (adjust x/y axes) in order to plot 
> my spatial data there. I guess this is the same question you made in 
> this blog in Oct
> 2013 but I ignore if you solved that...

I don't think anyone here knows what blog, and I don't see a link to it. 
Note that this list is plain text only, and your posting is HTML.

Please consult Oscar Perpig?an's book, in which he explains that what you are trying to do isn't smart, and shows how to use his package rasterVis. 
You need to import the raster file as a georeferenced raster file - guessing where things are may be acceptable for artistic wallpaper, but is no use in analysis.

Hope this helps,

Roger

>
> I would be very grateful if you could help me with some ideas and/or 
> possible alternative options. Thank you very much ended. Kindest 
> regards,
>
> Dr. Eneko Bachiller
> Institute of Marine Research
> Bergen, Norway
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

--
Roger Bivand
Department of Economics, Norwegian School of Economics, Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no


From Roger.Bivand at nhh.no  Wed Oct  1 11:39:57 2014
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 1 Oct 2014 11:39:57 +0200
Subject: [R-sig-Geo] FW: Re: Load a map png in ggplot2 (workaround for
 missing world map support in ggmap)
In-Reply-To: <B0C6D1CBA16AD24BA204698A4722B5D45EB9375B@EXMBX2.imr.no>
References: <B0C6D1CBA16AD24BA204698A4722B5D45EB93732@EXMBX2.imr.no>
	<alpine.LRH.2.03.1410011119570.5199@reclus.nhh.no>
	<B0C6D1CBA16AD24BA204698A4722B5D45EB9375B@EXMBX2.imr.no>
Message-ID: <alpine.LRH.2.03.1410011131200.4200@reclus.nhh.no>

On Wed, 1 Oct 2014, Bachiller Eneko wrote:

> Hi Roger,
> This is the website I was talking about...
> https://stat.ethz.ch/pipermail/r-sig-geo/2013-October/019635.html
>
> I guess this is the correct email group for my question. If not please 
> let me know.

Likely correct group, but that link was necessary to see the context from 
before your posting. However, it is unlikely that ggmap/ggplot2 is the 
tool that is needed here, they does not "understand" spatial data or 
spatial reference systems well. Please find the book I refered to, or 
borrow it via IMR from NILU (there is ebrary access at H?gskolen i 
S?r-Tr?ndelag). Books still beat blogs in consistency and completeness.

Roger

> Apologizes for any inconvenient and thanks for your suggestion.
> All the best,
>
> Eneko
>
> -----Original Message-----
> From: Roger Bivand [mailto:Roger.Bivand at nhh.no]
> Sent: Wednesday, October 01, 2014 11:25 AM
> To: Bachiller Eneko
> Cc: r-sig-geo at r-project.org
> Subject: Re: [R-sig-Geo] FW: Re: Load a map png in ggplot2 (workaround for missing world map support in ggmap)
>
> On Wed, 1 Oct 2014, Bachiller Eneko wrote:
>
>> Dear Markus,
>>
>> I have found the same problem and I would like to know if you found
>> out any solution... I mean, I have some maps (from Surfer) that I
>> would like to import to ggmap. The point would be to be able to import
>> the basemap and georeference that (adjust x/y axes) in order to plot
>> my spatial data there. I guess this is the same question you made in
>> this blog in Oct
>> 2013 but I ignore if you solved that...
>
> I don't think anyone here knows what blog, and I don't see a link to it.
> Note that this list is plain text only, and your posting is HTML.
>
> Please consult Oscar Perpig?an's book, in which he explains that what you are trying to do isn't smart, and shows how to use his package rasterVis.
> You need to import the raster file as a georeferenced raster file - guessing where things are may be acceptable for artistic wallpaper, but is no use in analysis.
>
> Hope this helps,
>
> Roger
>
>>
>> I would be very grateful if you could help me with some ideas and/or
>> possible alternative options. Thank you very much ended. Kindest
>> regards,
>>
>> Dr. Eneko Bachiller
>> Institute of Marine Research
>> Bergen, Norway
>>
>> 	[[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> --
> Roger Bivand
> Department of Economics, Norwegian School of Economics, Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; fax +47 55 95 91 00
> e-mail: Roger.Bivand at nhh.no
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no

From paul.feichtinger at tum.de  Thu Oct  2 21:00:30 2014
From: paul.feichtinger at tum.de (Feichtinger, Paul)
Date: Thu, 2 Oct 2014 19:00:30 +0000
Subject: [R-sig-Geo] specification tests
Message-ID: <9aec5a22ca03469486a26d953bcd7fb3@BADWLRZ-SW13MB1.ads.mwn.de>

Dear mailing list members,



we estimate a general spatial model to investigate the determinants of agricultural land prices. The functional form is a log-log specification. In testing we perform, among others, "spatial-tests" like Moran's I and LM tests. Our question is, are there any possibilities to test for misspecification  of the functional form (e.g., log-log vs. semi-log vs. linear) 1) which make sense in this circumstances and 2) which are available in R packages like sphet?



Any comments would be of great help!



Thank you,



Paul


---
Technische Universit?t M?nchen - TUM
Paul Feichtinger
Lehrstuhl f?r Volkswirtschaftslehre, Umwelt?konomie und Agrarpolitik

Alte Akademie 14
85354 Freising
Tel: +49.8161.71.3574
Fax: +49.8161.71.3408
e-mail: Paul.Feichtinger at tum.de


	[[alternative HTML version deleted]]


From alessandracarioli at gmail.com  Fri Oct  3 13:32:39 2014
From: alessandracarioli at gmail.com (Alessandra Carioli)
Date: Fri, 3 Oct 2014 13:32:39 +0200
Subject: [R-sig-Geo] projecting shape files, in R?
In-Reply-To: <mailman.15.1412330404.25191.r-sig-geo@r-project.org>
References: <mailman.15.1412330404.25191.r-sig-geo@r-project.org>
Message-ID: <0A114832-F81A-4B1D-8B9C-8F26DBF3C686@gmail.com>

Dear Mailing list members,

I need a projected shape file but I don?t have the .prj information and I was wondering if anything like projecting a shape file to obtain coordinates in longitude and latitude can be done. My issue is that I am producing semivariograms and, although I think distances are in meters, I want to be 100% sure. Also, being the considered area rather big (Europe) considering the projected coordinated would make my computation more precise.

Any ideas?

Ale

From janka.vanschoenwinkel at uhasselt.be  Fri Oct  3 13:54:16 2014
From: janka.vanschoenwinkel at uhasselt.be (Janka Vanschoenwinkel)
Date: Fri, 3 Oct 2014 13:54:16 +0200
Subject: [R-sig-Geo] projecting shape files, in R?
In-Reply-To: <0A114832-F81A-4B1D-8B9C-8F26DBF3C686@gmail.com>
References: <mailman.15.1412330404.25191.r-sig-geo@r-project.org>
	<0A114832-F81A-4B1D-8B9C-8F26DBF3C686@gmail.com>
Message-ID: <CAHymutJEhjpZZyh_vMCF12LdqPwv9VXgMtyBj-wzSPREn-kV8w@mail.gmail.com>

Dear Alessandra,

I am still relatively new in using R, but I can make my .prj files myself.
By using the following command, I can make a shapefile with the information
I already uploaded. It gives me the .dbf, .prj, .shp and .shx files.


writeOGR(data, dsn = ".", layer ='choose name', driver = 'ESRI Shapefile')


You didn't give a lot of information so I don't know exactly if this line
is also applicable to your case. I think it depends on your data, but maybe
somebody more experienced can give additional or other advice. Or you can
look up the code line I wrote in the help box!

Good luck!

Janka


2014-10-03 13:32 GMT+02:00 Alessandra Carioli <alessandracarioli at gmail.com>:

> Dear Mailing list members,
>
> I need a projected shape file but I don?t have the .prj information and I
> was wondering if anything like projecting a shape file to obtain
> coordinates in longitude and latitude can be done. My issue is that I am
> producing semivariograms and, although I think distances are in meters, I
> want to be 100% sure. Also, being the considered area rather big (Europe)
> considering the projected coordinated would make my computation more
> precise.
>
> Any ideas?
>
> Ale
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From mdsumner at gmail.com  Fri Oct  3 14:09:49 2014
From: mdsumner at gmail.com (Michael Sumner)
Date: Fri, 3 Oct 2014 22:09:49 +1000
Subject: [R-sig-Geo] projecting shape files, in R?
In-Reply-To: <0A114832-F81A-4B1D-8B9C-8F26DBF3C686@gmail.com>
References: <mailman.15.1412330404.25191.r-sig-geo@r-project.org>
	<0A114832-F81A-4B1D-8B9C-8F26DBF3C686@gmail.com>
Message-ID: <CAAcGz9-8AfMyCat3Z6XkYB0kz+-kx3iaWFa8mCdokqC6RbLu+w@mail.gmail.com>

It's not really possible to guess from a literally infinite number of
possible projections. Usually there is some information, or you can
infer it from context. Really you need at least the family of the
projection, then you can maybe guess at the details until you find a
good match. Experience can provide the family by looking at the data,
but only careful hunting can find the details. It's important to find
and tell the story of what the data are, clues are hidden in many
ways.

For example, this map was fairly simple to work out (for me, given my
background, the people I know, the stuff I've seen 'around here'):

http://www.bom.gov.au/ant/seaice/

Through experience I know that 71 S is a commonly used latitude for
the "true scale" of a Polar Stereographic projection, and that Polar
Stereographic (the family) is pretty popular for Antarctic data. (It's
because the coast of Antarctica is roughly "averagely" at 70S, and
secant-slicing the ellipsoid at this latitude provides a better fit
for areas around the coast, a good compromise compared to the single
tangent at the south pole). But, perspective on this aspect of PS is
relatively new for me. The rest was easy, I can find two points with
the printed graticule, and also determine the central longitude at
110E and so with tools to transform longlat to PS I can fully
georeference this image - well good enough that I cannot see a
problem. I cannot see any of this metadata on the web page, so I had
to resort to personal experience and socio-historical heuristics. (I'm
still not sure if this uses WGS84, a sphere, or maybe Hughes 1980 - I
have to do some more tests to be sure, but maybe it's not answerable
or maybe doesn't even matter).

So, you need to go hunting in your own social context, show us the
map, give us more clues. It's possible to guess/get lucky, but you
really need to find out all the details. Guessing from nothing is a
no-hope. There are some CRS that won't be candidates given the range
though, for example it's unlikely that for all of Europe that UTM is
used so you need some idea about the sensible scope for different
families - clues in one direction - as well as knowledge about the
data, what it's used for, and so on - from the other direction.

Cheers, Mike.



On Fri, Oct 3, 2014 at 9:32 PM, Alessandra Carioli
<alessandracarioli at gmail.com> wrote:
> Dear Mailing list members,
>
> I need a projected shape file but I don?t have the .prj information and I was wondering if anything like projecting a shape file to obtain coordinates in longitude and latitude can be done. My issue is that I am producing semivariograms and, although I think distances are in meters, I want to be 100% sure. Also, being the considered area rather big (Europe) considering the projected coordinated would make my computation more precise.
>
> Any ideas?
>
> Ale
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



-- 
Michael Sumner
Software and Database Engineer
Australian Antarctic Division
Hobart, Australia
e-mail: mdsumner at gmail.com


From richard.zijdeman at gmail.com  Fri Oct  3 16:27:12 2014
From: richard.zijdeman at gmail.com (Richard Zijdeman)
Date: Fri, 3 Oct 2014 16:27:12 +0200
Subject: [R-sig-Geo] how to directly merge JSON data with geoJSON file?
Message-ID: <587EDA2D-F1FE-435C-8BF9-2376B19C508C@gmail.com>

Dear list,

I'm trying to add data in json format to a geojson file. I realise that one way of doing this, is to transform the geojson file into a shape file, the data in an R object, and merge the two, as attempted here: http://stackoverflow.com/questions/17181339/r-geojson-and-leaflet . However, I was wondering whether this is possible without switching 'back' to a shape file. Here's the code to obtain the geojson file and data file:

##########################################
library(leafletR)
library(jsonlite)

# obtaining map
 download.file("http://node-128.dev.socialhistoryservices.org/api/maps?year=1937",
                    destfile = paste0("testmap", ".json"))
 map <- leaflet("./testmap.json")
 map # displays map in browser

# obtaining data
 testdata <- 
 fromJSON("http://node-128.dev.socialhistoryservices.org/api/data?code=TXCU?)
##########################################

Note: the 'key' in both files is 'amsterdam_code'

Best wishes,

Richard

ps: I am guilty of cross-posting this message on stack overflow, but I have had no response:http://stackoverflow.com/questions/26109260/how-to-add-json-data-to-geojson-map-without-going-back-to-shape-files
	[[alternative HTML version deleted]]


From gray.vanderlinde at gmail.com  Fri Oct  3 21:15:56 2014
From: gray.vanderlinde at gmail.com (GraysonLee08)
Date: Fri, 3 Oct 2014 12:15:56 -0700 (PDT)
Subject: [R-sig-Geo] readOGR cannot open .shp file
Message-ID: <1412363756476-7587228.post@n2.nabble.com>

I'm certain this is just user error however I can't seem to load a specific
shape file into my current project. Any assistance would be greatly
appreciated. 

To start off, I'm trying to load the 2010 census tracts for the city of
Chicago so I can show population density. I've installed and loaded the
following packages: 

     ## Install packages
     install.packages("rgdal")

     ## Load packages
     library(rgdal)
     library(ggplot2)
     library(rgeos)
     library(map tools)
     library(ggmap)


In the loading process for rgdal I notice that the version of rgdal that was
loaded is 0.9-1 and the version of GDAL is 1.9.2. Additionally, Path to GDAL
shared files is
/Library/Frameworks/R.framework/Versions/3.1/Resources/library/rgdal/gdal

Loaded PROJ.4 runtime: Rel. 4.8.0
Path to PROJ.4 shared files:
/Library/Frameworks/R.framework/Versions/3.1/Resources/library/rgdal/prom

I've set my working directory to the location of the .shp file 
     getwd()
     [1] "/Users/Gray/Dropbox/School/Food Desert"

and use the following command to store my shape file:
     ChicagoCensusTract2010 <- readOGR(dsn = ".", "ChicagoCensusTract")

I'm receiving the following error and am not really sure what to do next. 
     Error in ogrInfo(dsn = dsn, layer = layer, encoding = encoding,
use_iconv = use_iconv,  : 
       Cannot open file

I'd really appreciate any help I can get on this. 



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/readOGR-cannot-open-shp-file-tp7587228.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From afischbach at usgs.gov  Fri Oct  3 21:32:16 2014
From: afischbach at usgs.gov (Anthony Fischbach)
Date: Fri, 3 Oct 2014 12:32:16 -0700 (PDT)
Subject: [R-sig-Geo] plotKML organizing folders
In-Reply-To: <54196219.3060305@spatial-analyst.net>
References: <1410545664528-7587119.post@n2.nabble.com>
	<54196219.3060305@spatial-analyst.net>
Message-ID: <1412364736780-7587229.post@n2.nabble.com>

This is very helpful having the ability to specify folder names.
It would be helpful to have this facility for all the spatial classes
handled by plotKML.

Now I wish to apply differing sizes for points based on their properties.
This should be possibly by specifying the size parameter.  However this
appears to fail when applied to individual folders within a multi-part kml.  
The example below fails to create the unique points sizes.

## KML_Folder_problem.r
require(plotKML)
require(sp)
setwd('D:/Walrus/Haulout_Locations/rCode')  ## house keeping specify working
directory
data(bigfoot) ## Load a data frame with point features
bigfootA<-head(bigfoot)
bigfootB<-tail(bigfoot)
coordinates(bigfootA)<-c('Lon','Lat') ## Cast a spatial points dataframe
proj4string(bigfootA)<-CRS("+proj=longlat +ellps=WGS84 +datum=WGS84
+no_defs")  ## assign a coordinate reference system
bigfootA at data$SymbolSize<-3  ## Assign the symbol size to a variable 
coordinates(bigfootB)<-c('Lon','Lat') ## Cast a spatial points dataframe
proj4string(bigfootB)<-CRS("+proj=longlat +ellps=WGS84 +datum=WGS84
+no_defs")  ## assign a coordinate reference system
bigfootB at data$SymbolSize<-1  ## Assign the symbol size to a variable 

kml_open(file.name='BigWithFolders.kml', folder.name = 'Big Foot',
kml_visibility=TRUE )
	## Build the points by each class

		kml_layer.SpatialPoints(obj=bigfootA, subfolder.name= 'A', 
			points_names=bigfootA at data$NAMES, size=SymbolSize, ## specify the symbol
size
			colour='green',  LabelScale=0.8, 
			shape='http://plotkml.r-forge.r-project.org/3Dballyellow.png',
			alpha=0.6, balloon=TRUE) ##  
		kml_layer.SpatialPoints(obj=bigfootB, subfolder.name= 'B',
			points_names=bigfootB at data$NAMES, size=SymbolSize,
			colour='yellow',  LabelScale=0.8, 
			shape='http://plotkml.r-forge.r-project.org/3Dballyellow.png',
			alpha=0.6, balloon=TRUE) ##  
			
kml_close(file.name='BigWithFolders.kml')
#

The resultant kml has all points specified with a symbol size of 1.5.



-----
Tony Fischbach, Wildlife Biologist
Walrus Research Program
Alaska Science Center
U.S. Geological Survey
4210 University Drive
Anchorage, AK 99508-4650

AFischbach at usgs.gov
http://alaska.usgs.gov/science/biology/walrus
--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/plotKML-organizing-folders-tp7587119p7587229.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From macqueen1 at llnl.gov  Fri Oct  3 23:22:23 2014
From: macqueen1 at llnl.gov (MacQueen, Don)
Date: Fri, 3 Oct 2014 21:22:23 +0000
Subject: [R-sig-Geo] readOGR cannot open .shp file
In-Reply-To: <1412363756476-7587228.post@n2.nabble.com>
References: <1412363756476-7587228.post@n2.nabble.com>
Message-ID: <D0546080.10DEE8%macqueen1@llnl.gov>

What does
  list.files()
show ? after having set the working directory, of course.

Have you successfully loaded other shape files before, or is this the
first time?

Do any of the shape file examples in ?readOGR succeed?

Is the shape file complete? That is, are the .prj, .dbf, .shx, and so on,
files there?
(I?m not sure what the complete required list is)

-Don

-- 
Don MacQueen

Lawrence Livermore National Laboratory
7000 East Ave., L-627
Livermore, CA 94550
925-423-1062





On 10/3/14, 12:15 PM, "GraysonLee08" <gray.vanderlinde at gmail.com> wrote:

>I'm certain this is just user error however I can't seem to load a
>specific
>shape file into my current project. Any assistance would be greatly
>appreciated. 
>
>To start off, I'm trying to load the 2010 census tracts for the city of
>Chicago so I can show population density. I've installed and loaded the
>following packages:
>
>     ## Install packages
>     install.packages("rgdal")
>
>     ## Load packages
>     library(rgdal)
>     library(ggplot2)
>     library(rgeos)
>     library(map tools)
>     library(ggmap)
>
>
>In the loading process for rgdal I notice that the version of rgdal that
>was
>loaded is 0.9-1 and the version of GDAL is 1.9.2. Additionally, Path to
>GDAL
>shared files is
>/Library/Frameworks/R.framework/Versions/3.1/Resources/library/rgdal/gdal
>
>Loaded PROJ.4 runtime: Rel. 4.8.0
>Path to PROJ.4 shared files:
>/Library/Frameworks/R.framework/Versions/3.1/Resources/library/rgdal/prom
>
>I've set my working directory to the location of the .shp file
>     getwd()
>     [1] "/Users/Gray/Dropbox/School/Food Desert"
>
>and use the following command to store my shape file:
>     ChicagoCensusTract2010 <- readOGR(dsn = ".", "ChicagoCensusTract")
>
>I'm receiving the following error and am not really sure what to do next.
>     Error in ogrInfo(dsn = dsn, layer = layer, encoding = encoding,
>use_iconv = use_iconv,  :
>       Cannot open file
>
>I'd really appreciate any help I can get on this.
>
>
>
>--
>View this message in context:
>http://r-sig-geo.2731867.n2.nabble.com/readOGR-cannot-open-shp-file-tp7587
>228.html
>Sent from the R-sig-geo mailing list archive at Nabble.com.
>
>_______________________________________________
>R-sig-Geo mailing list
>R-sig-Geo at r-project.org
>https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From gray.vanderlinde at gmail.com  Sat Oct  4 01:20:00 2014
From: gray.vanderlinde at gmail.com (GraysonLee08)
Date: Fri, 3 Oct 2014 16:20:00 -0700 (PDT)
Subject: [R-sig-Geo] readOGR cannot open .shp file
In-Reply-To: <D0546080.10DEE8%macqueen1@llnl.gov>
References: <1412363756476-7587228.post@n2.nabble.com>
	<D0546080.10DEE8%macqueen1@llnl.gov>
Message-ID: <1412378400328-7587231.post@n2.nabble.com>

And that would be user error. I didn't know that I needed all of the files in
order to plot a shape file. Thanks!



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/readOGR-cannot-open-shp-file-tp7587228p7587231.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From mauriziomarchi85 at gmail.com  Sat Oct  4 20:55:21 2014
From: mauriziomarchi85 at gmail.com (Maurizio Marchi)
Date: Sat, 4 Oct 2014 20:55:21 +0200
Subject: [R-sig-Geo] projecting shape files, in R?
Message-ID: <CANJhsN2HWwYiOYfWWgDZuG+kw_WTgm+RngvMo9W4_kDCzMkMng@mail.gmail.com>

Hi Alessandra,
As suggested by other persone before me, it is not easy to recognize the
projection but it is possible. My suggestion in to use a GIS software (such
as QGIS or ArcGIS) to interact with the shapefile, compareing your file
with other known projection and, in the end, to save it (again) as a NEW
file with the .prj
In my experience, European data are usually projected in WGS84 reference
system and coordinates are latitude and longitude.
If you want I can try it for you if your data is not too big and it can be
sent attached to an email.

Bests,
Maurizio



-- 
Maurizio Marchi, Ph.D. student
Florence, Italy
ID skype: maurizioxyz
Ubuntu 14.04 LTS
linux user 552742

	[[alternative HTML version deleted]]


From alyssonstege at gmail.com  Sun Oct  5 03:15:56 2014
From: alyssonstege at gmail.com (Alysson Luiz Stege)
Date: Sat, 4 Oct 2014 22:15:56 -0300
Subject: [R-sig-Geo] loglik parameter from splm package
Message-ID: <CAMKsCCPvMywJaZcDt4e6HUiEEzDuVDM_Ni7sQKm6YaRBqx-BvQ@mail.gmail.com>

Dear Users

I'm using the R package  splm (Spatial Panel Data Models) version 1.3.3  .
I'm estimating my model using SPML command that makes the estimation using
ML implementation .
I need the value of the log likelihood for the Akaike and Bayesian
information criteria test.
Upon command below, he says that does not provide this value. But the ML
estimation generates the value of the log likelihood, but does not appear
in the results
I wonder if this package does not actually provides the value of log
likelihood

Thanks


Routine

library(spatial)
library(spdep)
library(sphet)
library(plm)
library(splm)



eflag<-spml(ef2~ lfinto + lvbpaae + laltem + larnagri+lidhm +
pluvc+dummy2010, data=todos.painel,listw=vizi5, model="within",
spatial.error="none", lag="TRUE")

logLik(eflag)
Error in UseMethod("logLik") :
no applicable method for 'logLik' applied to an object of class "splm"

	[[alternative HTML version deleted]]


From leigh.kroeger at gmail.com  Sun Oct  5 12:01:48 2014
From: leigh.kroeger at gmail.com (leigh.kroeger)
Date: Sun, 5 Oct 2014 03:01:48 -0700 (PDT)
Subject: [R-sig-Geo] coordinates
Message-ID: <1412503308419-7587234.post@n2.nabble.com>

Hello R sig-geo,

I have a shapefile that has been loaded into R of the Mediterranean basin. I
plan to plan environmental data onto this, and fish species occurrence data
from GBIF. 

I have successfully loaded the file into R, and transformed the both the
shapefile projection and my GBIF occurrence data into Behrmann coordinates: 

projection for both files reads:
>"+proj=cea +lat_ts=30 +ellps=WGS84"

However, they will not plot onto one another! I called up
View(coordinates(behr, srtobehr):
Here are examples of the coordinates:

Coordinates example for shapefile (V1, V2) after projection changed to
Behrmann:
       -13640884	 3659427

Coordinates example for GBIF data (lon, lat) after projection changed to
Behrmann. I have subsetted the entire GBIF dataset for this species to only
include species point occurrence data from the Mediterranean:
	3372195	3608795

If someone has seen these type of coordinates before, please help! 




--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/coordinates-tp7587234.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From leigh.kroeger at gmail.com  Sun Oct  5 17:18:45 2014
From: leigh.kroeger at gmail.com (Leigh Kroeger)
Date: Sun, 5 Oct 2014 18:18:45 +0300
Subject: [R-sig-Geo] Changing coordinates in shapefile
Message-ID: <CAObCpXNUMuXTTaJ_6-z3CALHUPOVX87kF+QKhTeBTcRx7-t+Zw@mail.gmail.com>

Hello all,

I have realised that the coordinates data in my shapefile is incorrect.

It shows coordinates that are 180 degrees off. Put simply... -140 needs 180
added to it in each cell in column 1 to read 40.

I am at a loss to understand how to add 180 to each cell. Please advise.

-- 
*Leigh A. Kroeger*
<*)))><

*PhD Candidate - Marine Ecology*
?????? ????? ?????
?????????? ?? ????
Dept. of Zoology
Tel Aviv University
Tel Aviv, 69978
Israel
Tel: +03 640-7830

http://belmaker.weebly.com/members.html
http://www.linkedin.com/profile/view?id=144722403&trk=nav_responsive_tab_profile_pic

	[[alternative HTML version deleted]]


From mdsumner at gmail.com  Mon Oct  6 21:01:23 2014
From: mdsumner at gmail.com (Michael Sumner)
Date: Tue, 7 Oct 2014 06:01:23 +1100
Subject: [R-sig-Geo] projecting shape files, in R?
In-Reply-To: <7355D715-5DC9-4AD6-8C25-1EC8F84EFCD0@gmail.com>
References: <7355D715-5DC9-4AD6-8C25-1EC8F84EFCD0@gmail.com>
Message-ID: <CAAcGz98C6+6O3s8b-q+zzeeQ6kP54UB7C_ZR0diDEe-2FLSHmQ@mail.gmail.com>

All this information is relevant and belongs in the thread. Please stay
on-list.

Showing us the map would help someone help you. With the actual coordinates
some one could even have a stab at guessing. This is no more doable in
ArcGis than any other program - the history and clues are all that matters.

Cheers, Mike
On 7 Oct 2014 00:42, "Alessandra Carioli" <alessandracarioli at gmail.com>
wrote:

> Thanks for your answers. Mine was a general question with a more
> particular need behind, more into detail I am dealing with a map of Spain
> with ?custom made? polygons, where I have 910 centroids with some
> coordinates in a unit that should be meters. I say should be because it
> looks like meters, I?ve calculated distances between cities and it makes
> sense, but I have no absolute proof (no ?read me? note with ?distances are
> in meters").
> My centroids are cities and I know all of them.
> Of course if I googled the name of each and every city I would know the
> exact latitude and longitude, but I want to have that information in a prj
> file (plus googling 910 times and creating long-lat vectors is time
> consuming) so that my map would be in a mercator style, while right now is
> in a
>
> I know this can be done in Arcgis but I'd like to be R-sufficient.
>
> If I had the .prj file this would not be an issue, but I don?t.
>
>
> Message: 1
> Date: Fri, 3 Oct 2014 13:32:39 +0200
> From: Alessandra Carioli <alessandracarioli at gmail.com>
> To: r-sig-geo at r-project.org
> Subject: [R-sig-Geo] projecting shape files, in R?
> Message-ID: <0A114832-F81A-4B1D-8B9C-8F26DBF3C686 at gmail.com>
> Content-Type: text/plain; charset=windows-1252
>
> Dear Mailing list members,
>
> I need a projected shape file but I don?t have the .prj information and I
> was wondering if anything like projecting a shape file to obtain
> coordinates in longitude and latitude can be done. My issue is that I am
> producing semivariograms and, although I think distances are in meters, I
> want to be 100% sure. Also, being the considered area rather big (Europe)
> considering the projected coordinated would make my computation more
> precise.
>
> Any ideas?
>
> Ale
>
>
> ------------------------------
>
> Message: 2
> Date: Fri, 3 Oct 2014 13:54:16 +0200
> From: Janka Vanschoenwinkel <janka.vanschoenwinkel at uhasselt.be>
> To: Alessandra Carioli <alessandracarioli at gmail.com>
> Cc: "r-sig-geo at r-project.org" <r-sig-geo at r-project.org>
> Subject: Re: [R-sig-Geo] projecting shape files, in R?
> Message-ID:
> <CAHymutJEhjpZZyh_vMCF12LdqPwv9VXgMtyBj-wzSPREn-kV8w at mail.gmail.com>
> Content-Type: text/plain; charset="UTF-8"
>
> Dear Alessandra,
>
> I am still relatively new in using R, but I can make my .prj files myself.
> By using the following command, I can make a shapefile with the information
> I already uploaded. It gives me the .dbf, .prj, .shp and .shx files.
>
>
> writeOGR(data, dsn = ".", layer ='choose name', driver = 'ESRI Shapefile')
>
>
> You didn't give a lot of information so I don't know exactly if this line
> is also applicable to your case. I think it depends on your data, but maybe
> somebody more experienced can give additional or other advice. Or you can
> look up the code line I wrote in the help box!
>
> Good luck!
>
> Janka
>
>
> 2014-10-03 13:32 GMT+02:00 Alessandra Carioli <alessandracarioli at gmail.com
> >:
>
> Dear Mailing list members,
>
> I need a projected shape file but I don?t have the .prj information and I
> was wondering if anything like projecting a shape file to obtain
> coordinates in longitude and latitude can be done. My issue is that I am
> producing semivariograms and, although I think distances are in meters, I
> want to be 100% sure. Also, being the considered area rather big (Europe)
> considering the projected coordinated would make my computation more
> precise.
>
> Any ideas?
>
> Ale
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
> [[alternative HTML version deleted]]
>
>
>
> ------------------------------
>
> Message: 3
> Date: Fri, 3 Oct 2014 22:09:49 +1000
> From: Michael Sumner <mdsumner at gmail.com>
> To: Alessandra Carioli <alessandracarioli at gmail.com>
> Cc: RsigGeo <r-sig-geo at r-project.org>
> Subject: Re: [R-sig-Geo] projecting shape files, in R?
> Message-ID:
> <CAAcGz9-8AfMyCat3Z6XkYB0kz+-kx3iaWFa8mCdokqC6RbLu+w at mail.gmail.com>
> Content-Type: text/plain; charset=UTF-8
>
> It's not really possible to guess from a literally infinite number of
> possible projections. Usually there is some information, or you can
> infer it from context. Really you need at least the family of the
> projection, then you can maybe guess at the details until you find a
> good match. Experience can provide the family by looking at the data,
> but only careful hunting can find the details. It's important to find
> and tell the story of what the data are, clues are hidden in many
> ways.
>
> For example, this map was fairly simple to work out (for me, given my
> background, the people I know, the stuff I've seen 'around here'):
>
> http://www.bom.gov.au/ant/seaice/
>
> Through experience I know that 71 S is a commonly used latitude for
> the "true scale" of a Polar Stereographic projection, and that Polar
> Stereographic (the family) is pretty popular for Antarctic data. (It's
> because the coast of Antarctica is roughly "averagely" at 70S, and
> secant-slicing the ellipsoid at this latitude provides a better fit
> for areas around the coast, a good compromise compared to the single
> tangent at the south pole). But, perspective on this aspect of PS is
> relatively new for me. The rest was easy, I can find two points with
> the printed graticule, and also determine the central longitude at
> 110E and so with tools to transform longlat to PS I can fully
> georeference this image - well good enough that I cannot see a
> problem. I cannot see any of this metadata on the web page, so I had
> to resort to personal experience and socio-historical heuristics. (I'm
> still not sure if this uses WGS84, a sphere, or maybe Hughes 1980 - I
> have to do some more tests to be sure, but maybe it's not answerable
> or maybe doesn't even matter).
>
> So, you need to go hunting in your own social context, show us the
> map, give us more clues. It's possible to guess/get lucky, but you
> really need to find out all the details. Guessing from nothing is a
> no-hope. There are some CRS that won't be candidates given the range
> though, for example it's unlikely that for all of Europe that UTM is
> used so you need some idea about the sensible scope for different
> families - clues in one direction - as well as knowledge about the
> data, what it's used for, and so on - from the other direction.
>
> Cheers, Mike.
>
>
>
>

	[[alternative HTML version deleted]]


From juta.kawalerowicz at nuffield.ox.ac.uk  Mon Oct  6 12:12:30 2014
From: juta.kawalerowicz at nuffield.ox.ac.uk (Juta Kawalerowicz)
Date: Mon, 6 Oct 2014 11:12:30 +0100
Subject: [R-sig-Geo] Changing coordinates in shapefile
In-Reply-To: <a4080dab-2eb5-438d-8f86-44f5676e8c2b@HUB01.ad.oak.ox.ac.uk>
References: <a4080dab-2eb5-438d-8f86-44f5676e8c2b@HUB01.ad.oak.ox.ac.uk>
Message-ID: <CAHMizkPgy2Kyco9ScCZ76gpuMf0dsnfYUVqDHEYxzMTOwjE5-Q@mail.gmail.com>

Leigh,

If you simply want to add 180 to each element in a vector try
new data<-sapply((your data), function(x) x+180)

Juta

On Sun, Oct 5, 2014 at 4:18 PM, Leigh Kroeger <leigh.kroeger at gmail.com>
wrote:

> Hello all,
>
> I have realised that the coordinates data in my shapefile is incorrect.
>
> It shows coordinates that are 180 degrees off. Put simply... -140 needs 180
> added to it in each cell in column 1 to read 40.
>
> I am at a loss to understand how to add 180 to each cell. Please advise.
>
> --
> *Leigh A. Kroeger*
> <*)))><
>
> *PhD Candidate - Marine Ecology*
> ?????? ????? ?????
> ?????????? ?? ????
> Dept. of Zoology
> Tel Aviv University
> Tel Aviv, 69978
> Israel
> Tel: +03 640-7830
>
> http://belmaker.weebly.com/members.html
>
> http://www.linkedin.com/profile/view?id=144722403&trk=nav_responsive_tab_profile_pic
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From r.hijmans at gmail.com  Mon Oct  6 14:31:08 2014
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Mon, 6 Oct 2014 05:31:08 -0700
Subject: [R-sig-Geo] Changing coordinates in shapefile
In-Reply-To: <CAObCpXNUMuXTTaJ_6-z3CALHUPOVX87kF+QKhTeBTcRx7-t+Zw@mail.gmail.com>
References: <CAObCpXNUMuXTTaJ_6-z3CALHUPOVX87kF+QKhTeBTcRx7-t+Zw@mail.gmail.com>
Message-ID: <CANtt_hySXA-Eg0NUSYKiTw7_gK5XrTtUwQyU56VbkAJK=HfcVA@mail.gmail.com>

Leigh,
I am at loss by what you mean with "shapefile" in this context
(SpatalPolygons object? or raster data given your reference to
cells?), but raster::shift is probably the function you are looking
for.
Robert

On Sun, Oct 5, 2014 at 8:18 AM, Leigh Kroeger <leigh.kroeger at gmail.com> wrote:
> Hello all,
>
> I have realised that the coordinates data in my shapefile is incorrect.
>
> It shows coordinates that are 180 degrees off. Put simply... -140 needs 180
> added to it in each cell in column 1 to read 40.
>
> I am at a loss to understand how to add 180 to each cell. Please advise.
>
> --
> *Leigh A. Kroeger*
> <*)))><
>
> *PhD Candidate - Marine Ecology*
> ?????? ????? ?????
> ?????????? ?? ????
> Dept. of Zoology
> Tel Aviv University
> Tel Aviv, 69978
> Israel
> Tel: +03 640-7830
>
> http://belmaker.weebly.com/members.html
> http://www.linkedin.com/profile/view?id=144722403&trk=nav_responsive_tab_profile_pic
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From Roger.Bivand at nhh.no  Mon Oct  6 22:56:37 2014
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 6 Oct 2014 22:56:37 +0200
Subject: [R-sig-Geo] Changing coordinates in shapefile
In-Reply-To: <CAObCpXNUMuXTTaJ_6-z3CALHUPOVX87kF+QKhTeBTcRx7-t+Zw@mail.gmail.com>
References: <CAObCpXNUMuXTTaJ_6-z3CALHUPOVX87kF+QKhTeBTcRx7-t+Zw@mail.gmail.com>
Message-ID: <alpine.LRH.2.03.1410062240360.12091@reclus.nhh.no>

On Sun, 5 Oct 2014, Leigh Kroeger wrote:

> Hello all,
>
> I have realised that the coordinates data in my shapefile is incorrect.

No, the description of the coordinate reference system may be incorrect. 
However, it strikes me as very unlikely that the prime meridian has been 
shifted as you describe. If the CRS is geographic not projected, it is 
very rarely the case that a non-standard prime medidian is used. 
Historically, many were used, but most are well known.

You have also thread-hopped - in your previous thread, you give a value 
of:

"+proj=cea +lat_ts=30 +ellps=WGS84"

but do not expand on what you say is Behrmann. If the shapefile was in 
projected coordinates, your units are not in degrees, so until you can 
establish authority for what you say you want to do, I'd say nothing is by 
far the best option. Establish the correct metadata for the shapefile, or 
find out from its originators what the correct metadata is.

So accept that nothing in cartography is as simple as it seems to 
non-cartographers, then that in geodetics things get an order of magnitude 
worse. To use spatial data, you either accept confusion or the need to 
spend the time it takes to get the metadata right, because everything elae 
depends on them.

Hope this clarifies,

Roger

>
> It shows coordinates that are 180 degrees off. Put simply... -140 needs 180
> added to it in each cell in column 1 to read 40.
>
> I am at a loss to understand how to add 180 to each cell. Please advise.
>
> -- 
> *Leigh A. Kroeger*
> <*)))><
>
> *PhD Candidate - Marine Ecology*
> ?????? ????? ?????
> ?????????? ?? ????
> Dept. of Zoology
> Tel Aviv University
> Tel Aviv, 69978
> Israel
> Tel: +03 640-7830
>
> http://belmaker.weebly.com/members.html
> http://www.linkedin.com/profile/view?id=144722403&trk=nav_responsive_tab_profile_pic
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no

From hengl at spatial-analyst.net  Tue Oct  7 16:31:56 2014
From: hengl at spatial-analyst.net (Tomislav Hengl)
Date: Tue, 07 Oct 2014 16:31:56 +0200
Subject: [R-sig-Geo] plotKML organizing folders
In-Reply-To: <1412364736780-7587229.post@n2.nabble.com>
References: <1410545664528-7587119.post@n2.nabble.com>	<54196219.3060305@spatial-analyst.net>
	<1412364736780-7587229.post@n2.nabble.com>
Message-ID: <5433F95C.8030300@spatial-analyst.net>


Hi Tony,

The easiest thing is that you set the size using actual numeric vectors 
(or a constant value):

R> require(plotKML)
R> require(sp)
R> data(bigfoot)
R> bigfootA <- head(bigfoot)
R> bigfootB <- tail(bigfoot)
R> coordinates(bigfootA) <- c('Lon','Lat')
R> proj4string(bigfootA) <- CRS("+proj=longlat +ellps=WGS84 +datum=WGS84 
+no_defs")
R> coordinates(bigfootB) <- c('Lon','Lat')
R> proj4string(bigfootB) <- bigfootA at proj4string
R> shape <- 'http://plotkml.r-forge.r-project.org/3Dballyellow.png'
R> kml_open(file.name='BigWithFolders.kml', folder.name='Big Foot', 
kml_visibility=TRUE)
KML file opened for writing...
R> kml_layer.SpatialPoints(obj=bigfootA, subfolder.name='A', 
points_names=bigfootA at data$NAMES, size=3, colour='green', LabelScale=0.8 
.... [TRUNCATED]
Writing to KML...
R> kml_layer.SpatialPoints(obj=bigfootB, subfolder.name='B', 
points_names=bigfootB at data$NAMES, size=1, colour='green', LabelScale=0.8 
.... [TRUNCATED]
Writing to KML...
R> kml_close(file.name='BigWithFolders.kml')
Closing  BigWithFolders.kml

I've also added functionality to plotKML v0.4-6 which you can install 
from R-forge:

R> install.packages("plotKML", repos="http://R-Forge.R-project.org", 
type="source")

I will soon commit the v0.4-6 also to CRAN.

all the best with your work,

T. Hengl

On 3-10-2014 21:32, Anthony Fischbach wrote:
> This is very helpful having the ability to specify folder names.
> It would be helpful to have this facility for all the spatial classes
> handled by plotKML.
>
> Now I wish to apply differing sizes for points based on their properties.
> This should be possibly by specifying the size parameter.  However this
> appears to fail when applied to individual folders within a multi-part kml.
> The example below fails to create the unique points sizes.
>
> ## KML_Folder_problem.r
> require(plotKML)
> require(sp)
> setwd('D:/Walrus/Haulout_Locations/rCode')  ## house keeping specify working
> directory
> data(bigfoot) ## Load a data frame with point features
> bigfootA<-head(bigfoot)
> bigfootB<-tail(bigfoot)
> coordinates(bigfootA)<-c('Lon','Lat') ## Cast a spatial points dataframe
> proj4string(bigfootA)<-CRS("+proj=longlat +ellps=WGS84 +datum=WGS84
> +no_defs")  ## assign a coordinate reference system
> bigfootA at data$SymbolSize<-3  ## Assign the symbol size to a variable
> coordinates(bigfootB)<-c('Lon','Lat') ## Cast a spatial points dataframe
> proj4string(bigfootB)<-CRS("+proj=longlat +ellps=WGS84 +datum=WGS84
> +no_defs")  ## assign a coordinate reference system
> bigfootB at data$SymbolSize<-1  ## Assign the symbol size to a variable
>
> kml_open(file.name='BigWithFolders.kml', folder.name = 'Big Foot',
> kml_visibility=TRUE )
> 	## Build the points by each class
>
> 		kml_layer.SpatialPoints(obj=bigfootA, subfolder.name= 'A',
> 			points_names=bigfootA at data$NAMES, size=SymbolSize, ## specify the symbol
> size
> 			colour='green',  LabelScale=0.8,
> 			shape='http://plotkml.r-forge.r-project.org/3Dballyellow.png',
> 			alpha=0.6, balloon=TRUE) ##
> 		kml_layer.SpatialPoints(obj=bigfootB, subfolder.name= 'B',
> 			points_names=bigfootB at data$NAMES, size=SymbolSize,
> 			colour='yellow',  LabelScale=0.8,
> 			shape='http://plotkml.r-forge.r-project.org/3Dballyellow.png',
> 			alpha=0.6, balloon=TRUE) ##
> 			
> kml_close(file.name='BigWithFolders.kml')
> #
>
> The resultant kml has all points specified with a symbol size of 1.5.
>
>
>
> -----
> Tony Fischbach, Wildlife Biologist
> Walrus Research Program
> Alaska Science Center
> U.S. Geological Survey
> 4210 University Drive
> Anchorage, AK 99508-4650
>
> AFischbach at usgs.gov
> http://alaska.usgs.gov/science/biology/walrus
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/plotKML-organizing-folders-tp7587119p7587229.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From jgrn at illinois.edu  Tue Oct  7 17:56:45 2014
From: jgrn at illinois.edu (Jonathan Greenberg)
Date: Tue, 7 Oct 2014 10:56:45 -0500
Subject: [R-sig-Geo] gdal --config options
In-Reply-To: <BLU178-W24FA28B5227A074E197BB4E4BA0@phx.gbl>
References: <BLU178-W5144BBCB629DCB1ADCC8A6E4BF0@phx.gbl>
	<CABG0rfvH=YQoc_=YnPJL9XhrZ=Vgd672YepJGZyeD5S2ogjwog@mail.gmail.com>
	<BLU178-W24FA28B5227A074E197BB4E4BA0@phx.gbl>
Message-ID: <CABG0rfvaHJCkk4mj0zgkCcRdDnSnQEAZXgAvQdEnkPpWNqk2Bg@mail.gmail.com>

(cc'ing r-sig-geo to preserve the answer)

AH, ok, so gdalUtils DOES support this option, in theory.  If you look
at the help for gdal_translate, for instance, you can see you can use
the "co" flag.  Again, in theory (haven't tested this out) you could
do something like:

gdal_translate(...,co="COMPRESS_OVERVIEW DEFLATE")

Note that all I've done is wrap gdal parameters with R, so anything
GDAL can do, the R wrapper should do as well.  If you look at:
http://www.gdal.org/gdal_translate.html

you'll see the "-co" flag listed there.  In addition, if there are
ever any functions that are missing from my wrappers, you can pass
them along to the various gdalUtils functions with the
"additional_commands" flag, so you could also have done:

gdal_translate(...,additional_commands="-co COMPRESS_OVERVIEW DEFLATE")

Let me know if this works and, if not, drop a sample file someplace so
I can replicate the problem.  Cheers!

--j


On Mon, Sep 29, 2014 at 7:18 AM, Stephen Roecker
<stephen.roecker at outlook.com> wrote:
> I realize gdalwarp doesn't have a config flag, but the raster drivers that
> you can write to from gdalwarp, such as GeoTIFF, do. For example the
> gdaladdo utility help page demonstrates the use of --config to calculate
> comressed overviews (i.e pyramids) for .img files. gdaladdo -ro --config
> COMPRESS_OVERVIEW DEFLATE erdas.img 2 4 8 16 Also the GeoTIFF driver has
> configuration options (--config) such as GTIFF_POINT_GEO_IGNORE
> (http://www.gdal.org/frmt_gtiff.html) to ignore the shift applied to pixels
> defined as AREA. Thus their is some functionality to be gained by specifying
> --config arguements. I'm new to them myself, but am finding some interesting
> options as I did deeper. Thus I would like to know how to using gdalUtils,
> raster, or rgdal to accomplish this. Any example would be appreciated.
> Stephen > Date: Sat, 27 Sep 2014 22:52:19 -0500 > Subject: Re: [R-sig-Geo]
> gdal --config options > From: jgrn at illinois.edu > To:
> stephen.roecker at outlook.com > CC: r-sig-geo at r-project.org > > Stephen: > >
> Can you expand on this a bit? What, exactly, are you trying to do? I > don't
> see a config flag in gdalwarp: > http://www.gdal.org/gdalwarp.html > > --j >
>> On Fri, Sep 26, 2014 at 9:34 AM, Stephen Roecker > wrote: >> I'm using the
> gdaUtils and raster packages and was wondering if it's >> possible to
> specify --config options, using any of their functions >> (e.g. gdalwarp,
> writeRaster, etc)? I've tried accomplishing this using >> the
> additional_commands arguement in gdawarp with no success. Can >> someone
> provide an example? >> >> Stephen >> [[alternative HTML version deleted]] >>
>>> _______________________________________________ >> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org >>
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo > > > > -- > Jonathan A.
> Greenberg, PhD > Assistant Professor > Global Environmental Analysis and
> Remote Sensing (GEARS) Laboratory > Department of Geography and Geographic
> Information Science > University of Illinois at Urbana-Champaign > 259
> Computing Applications Building, MC-150 > 605 East Springfield Avenue >
> Champaign, IL 61820-6371 > Phone: 217-300-1924 >
> http://www.geog.illinois.edu/~jgrn/ > AIM: jgrn307, MSN:
> jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007



-- 
Jonathan A. Greenberg, PhD
Assistant Professor
Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
Department of Geography and Geographic Information Science
University of Illinois at Urbana-Champaign
259 Computing Applications Building, MC-150
605 East Springfield Avenue
Champaign, IL  61820-6371
Phone: 217-300-1924
http://www.geog.illinois.edu/~jgrn/
AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007


From estefania.vergaracobos at gmail.com  Wed Oct  8 04:04:15 2014
From: estefania.vergaracobos at gmail.com (Estefania Vergara)
Date: Tue, 7 Oct 2014 22:04:15 -0400
Subject: [R-sig-Geo] Geolife dataset
Message-ID: <CANbDMBOwuyE78FF5dDTukR1stGWKkpqgtQHXSVzirjT--A=S4Q@mail.gmail.com>

Dear mailing list members,

I am currently working with the Geolife dataset from Microsoft Asia (About
17.000 trajectories, mostly Beijing area). I want to analyze route usage
(for now only basic descriptives: how many trajectories use one same route,
hours of the day in which those routes are more popular). I want to ask you
if there is any specific package I should look at (so far I have seen
packages that only built a dataframe and make some basic plots).

Any ideas?

Best regards,

EV

	[[alternative HTML version deleted]]


From roman.lustrik at gmail.com  Wed Oct  8 07:27:33 2014
From: roman.lustrik at gmail.com (=?UTF-8?Q?Roman_Lu=C5=A1trik?=)
Date: Wed, 8 Oct 2014 07:27:33 +0200
Subject: [R-sig-Geo] Geolife dataset
In-Reply-To: <CANbDMBOwuyE78FF5dDTukR1stGWKkpqgtQHXSVzirjT--A=S4Q@mail.gmail.com>
References: <CANbDMBOwuyE78FF5dDTukR1stGWKkpqgtQHXSVzirjT--A=S4Q@mail.gmail.com>
Message-ID: <CAHT1vpjei4hS3zBFXbOzO9G0mRdPOZ3UdWcwQGj1Y-O59gjsvg@mail.gmail.com>

I suggest you peruse through the Spatial task view (
http://cran.r-project.org/web/views/Spatial.html). Package `sp` lays down
the ground work (spatial classes like SpatialLines, SpatialPoints,
SpatialPolygons...), and there's a plethora of packages to tinker with this
or that.

Cheers,
Roman

On Wed, Oct 8, 2014 at 4:04 AM, Estefania Vergara <
estefania.vergaracobos at gmail.com> wrote:

> Dear mailing list members,
>
> I am currently working with the Geolife dataset from Microsoft Asia (About
> 17.000 trajectories, mostly Beijing area). I want to analyze route usage
> (for now only basic descriptives: how many trajectories use one same route,
> hours of the day in which those routes are more popular). I want to ask you
> if there is any specific package I should look at (so far I have seen
> packages that only built a dataframe and make some basic plots).
>
> Any ideas?
>
> Best regards,
>
> EV
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



-- 
In God we trust, all others bring data.

	[[alternative HTML version deleted]]


From frtog at vestas.com  Wed Oct  8 07:44:17 2014
From: frtog at vestas.com (=?iso-8859-1?Q?Frede_Aakmann_T=F8gersen?=)
Date: Wed, 8 Oct 2014 07:44:17 +0200
Subject: [R-sig-Geo] Geolife dataset
In-Reply-To: <CANbDMBOwuyE78FF5dDTukR1stGWKkpqgtQHXSVzirjT--A=S4Q@mail.gmail.com>
References: <CANbDMBOwuyE78FF5dDTukR1stGWKkpqgtQHXSVzirjT--A=S4Q@mail.gmail.com>
Message-ID: <B078CDF40DFE4045AF172A8B4F68FC4857C8090D93@DKRDSEXC016.vestas.net>

Hi

It is difficult to tell from your email which packages you have been exploring so far. Perhaps the trajectories package? Did you have a look at the adehabitatLT package? See e.g. http://cran.r-project.org/web/packages/adehabitatLT/vignettes/adehabitatLT.pdf. 

Yours sincerely / Med venlig hilsen


Frede Aakmann T?gersen
Specialist, M.Sc., Ph.D.
Plant Performance & Modeling

Technology & Service Solutions
T +45 9730 5135
M +45 2547 6050
frtog at vestas.com
http://www.vestas.com

Company reg. name: Vestas Wind Systems A/S
This e-mail is subject to our e-mail disclaimer statement.
Please refer to www.vestas.com/legal/notice
If you have received this e-mail in error please contact the sender. 


> -----Original Message-----
> From: r-sig-geo-bounces at r-project.org [mailto:r-sig-geo-bounces at r-
> project.org] On Behalf Of Estefania Vergara
> Sent: 8. oktober 2014 04:04
> To: r-sig-geo at r-project.org
> Subject: [R-sig-Geo] Geolife dataset
> 
> Dear mailing list members,
> 
> I am currently working with the Geolife dataset from Microsoft Asia (About
> 17.000 trajectories, mostly Beijing area). I want to analyze route usage
> (for now only basic descriptives: how many trajectories use one same route,
> hours of the day in which those routes are more popular). I want to ask you
> if there is any specific package I should look at (so far I have seen
> packages that only built a dataframe and make some basic plots).
> 
> Any ideas?
> 
> Best regards,
> 
> EV
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From edzer.pebesma at uni-muenster.de  Wed Oct  8 09:37:07 2014
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Wed, 08 Oct 2014 10:37:07 +0300
Subject: [R-sig-Geo] Geolife dataset
In-Reply-To: <CANbDMBOwuyE78FF5dDTukR1stGWKkpqgtQHXSVzirjT--A=S4Q@mail.gmail.com>
References: <CANbDMBOwuyE78FF5dDTukR1stGWKkpqgtQHXSVzirjT--A=S4Q@mail.gmail.com>
Message-ID: <5434E9A3.4000409@uni-muenster.de>

when you are in the top directory of the geolife data set, start R, then

library(trajectories)
demo(geolife)

will read part of the data set. Copy the script [1] to this directory,
and start editing. Read the package vignettes to see what the package
can do for you.

Don't forget to report back to the list what the package can not do for
you, or consider contributing back to the package!

With best regards,

[1] found in the demo directory of the package, or alternatively on
https://github.com/edzer/trajectories/blob/master/demo/geolife.R


On 10/08/2014 05:04 AM, Estefania Vergara wrote:
> Dear mailing list members,
> 
> I am currently working with the Geolife dataset from Microsoft Asia (About
> 17.000 trajectories, mostly Beijing area). I want to analyze route usage
> (for now only basic descriptives: how many trajectories use one same route,
> hours of the day in which those routes are more popular). I want to ask you
> if there is any specific package I should look at (so far I have seen
> packages that only built a dataframe and make some basic plots).
> 
> Any ideas?
> 
> Best regards,
> 
> EV
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
83 33081 http://ifgi.uni-muenster.de GPG key ID 0xAC227795

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 490 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20141008/c27ca402/attachment.bin>

From mauriziomarchi85 at gmail.com  Wed Oct  8 13:13:23 2014
From: mauriziomarchi85 at gmail.com (Maurizio Marchi)
Date: Wed, 8 Oct 2014 13:13:23 +0200
Subject: [R-sig-Geo] ROC or TSS?
Message-ID: <CANJhsN2PEsdQzdzQqx_F+4F2gHySNw7YV2M41-D4XkNa+ptn9w@mail.gmail.com>

Dear List Members,
I have some troubles with models evaluation. I'm using biomod2 package and
I'm comparing 7 models with an Evaluation dataset. I obtain very different
results between ROC and TSS as shown here:

> myBiomodModelEval["ROC","Evaluating.data",,,]
               RUN1  RUN2  RUN3  Full
GLM        0.642 0.651 0.673 0.654
GAM        0.522 0.493 0.495 0.509
GBM        0.582 0.576 0.580 0.581
ANN         0.760 0.613 0.671 0.801
MARS      0.902 0.892 0.898 0.902
RF            0.814 0.809 0.770 0.800
MAXENT 0.638 0.616 0.606 0.614

> myBiomodModelEval["TSS","Evaluating.data",,,]
                RUN1   RUN2   RUN3   Full
GLM        0.023  0.014  0.000  0.007
GAM       -0.093 -0.095 -0.095 -0.099
GBM         0.202 -0.134  0.244  0.204
ANN          0.386  0.311  0.257  0.469
MARS       0.614  0.402  0.608  0.634
RF            0.469  0.389  0.349  0.406
MAXENT  0.219  0.326  0.259  0.280

How good are my models? Should I use ROC or TSS?

Many thanks,

-- 
Maurizio Marchi, Ph.D. student
Florence, Italy
ID skype: maurizioxyz
Ubuntu 14.04 LTS
linux user 552742

	[[alternative HTML version deleted]]


From wilfried.thuiller at ujf-grenoble.fr  Wed Oct  8 13:18:49 2014
From: wilfried.thuiller at ujf-grenoble.fr (Wilfried Thuiller)
Date: Wed, 8 Oct 2014 13:18:49 +0200
Subject: [R-sig-Geo] ROC or TSS?
In-Reply-To: <CANJhsN2PEsdQzdzQqx_F+4F2gHySNw7YV2M41-D4XkNa+ptn9w@mail.gmail.com>
References: <CANJhsN2PEsdQzdzQqx_F+4F2gHySNw7YV2M41-D4XkNa+ptn9w@mail.gmail.com>
Message-ID: <DF7A927C-6F0F-40CF-BC94-2A3F0D163287@ujf-grenoble.fr>

Dear Maurizio,

Both measures give somehow similar results. A AUC close to 0.5 means your models are not better than random predictions. A TSS close to 0 means the same.`
In other words, your models are generally not very good, excepted MARS and Random Forest, using both evaluation metrics.

HIH,
Wilfried

 


Le 8 oct. 2014 ? 13:13, Maurizio Marchi <mauriziomarchi85 at gmail.com> a ?crit :

> Dear List Members,
> I have some troubles with models evaluation. I'm using biomod2 package and
> I'm comparing 7 models with an Evaluation dataset. I obtain very different
> results between ROC and TSS as shown here:
> 
>> myBiomodModelEval["ROC","Evaluating.data",,,]
>               RUN1  RUN2  RUN3  Full
> GLM        0.642 0.651 0.673 0.654
> GAM        0.522 0.493 0.495 0.509
> GBM        0.582 0.576 0.580 0.581
> ANN         0.760 0.613 0.671 0.801
> MARS      0.902 0.892 0.898 0.902
> RF            0.814 0.809 0.770 0.800
> MAXENT 0.638 0.616 0.606 0.614
> 
>> myBiomodModelEval["TSS","Evaluating.data",,,]
>                RUN1   RUN2   RUN3   Full
> GLM        0.023  0.014  0.000  0.007
> GAM       -0.093 -0.095 -0.095 -0.099
> GBM         0.202 -0.134  0.244  0.204
> ANN          0.386  0.311  0.257  0.469
> MARS       0.614  0.402  0.608  0.634
> RF            0.469  0.389  0.349  0.406
> MAXENT  0.219  0.326  0.259  0.280
> 
> How good are my models? Should I use ROC or TSS?
> 
> Many thanks,
> 
> -- 
> Maurizio Marchi, Ph.D. student
> Florence, Italy
> ID skype: maurizioxyz
> Ubuntu 14.04 LTS
> linux user 552742
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-----------------------------
Dr. Wilfried Thuiller
Laboratoire d'Ecologie Alpine, UMR CNRS 5553
Universit? Joseph Fourier
BP53, 38041 Grenoble cedex 9, France
tel: +33 (0)4 76 51 44 97
fax: +33 (0)4 76 51 42 79

Email: wilfried.thuiller at ujf-grenoble.fr
Personal website: http://www.will.chez-alice.fr
Team website: http://www-leca.ujf-grenoble.fr/equipes/emabio.htm

ERC Starting Grant TEEMBIO project: http://www.will.chez-alice.fr/Research.html


From mauriziomarchi85 at gmail.com  Wed Oct  8 13:58:38 2014
From: mauriziomarchi85 at gmail.com (Maurizio Marchi)
Date: Wed, 8 Oct 2014 13:58:38 +0200
Subject: [R-sig-Geo] ROC or TSS?
Message-ID: <CANJhsN14n1MhmZJYz4_19YNrV0H6f-z3QPWGQe+-rzFFbkguag@mail.gmail.com>

Perfect! Thank you again!!

-- 
Maurizio Marchi, Ph.D. student
Florence, Italy
ID skype: maurizioxyz
Ubuntu 14.04 LTS
linux user 552742

	[[alternative HTML version deleted]]


From nunocesardesa at gmail.com  Wed Oct  8 23:23:54 2014
From: nunocesardesa at gmail.com (=?UTF-8?B?TnVubyBTw6E=?=)
Date: Wed, 8 Oct 2014 22:23:54 +0100
Subject: [R-sig-Geo] Mann-kendall
Message-ID: <CAB-ux0DKL8czbFC4p-i9NsgHj64_db4Dusmp8tYwkaN5=rbFfA@mail.gmail.com>

Hello!

I've been trying for two days to implement the Mann-Kendall test. It is
available in IDRISI and it would be cool that it would be available here.

I believe I made part of it correctly but I am stuck in two steps.

1. Calculating the ties/NA coefficients. (Algorithm problem..)

2. Estimating the p-value on the last step (Lack of statistical knowledge
problem maybe)

So here it goes what I have so far. Bear with me that I have tried to keep
my variables names with a certain "instant" meaning.

---------------------- Problem here, is identifying the coefficients for
the ties/NA -------------------

dummy.stack <- raster(stack.ndvi,layer=1) #required to initiate stack
within loop
mtx <- matrix(0,ncol=nlayers(stack.ndvi),nrow=(nlayers(stack.ndvi)-1))
#this allows the construction of a matrix with tie values signalled to 1

for (i in 1:(nlayers(stack.ndvi)-1)){

  print("----- i ----")
  print(i)
  for (j in (i+1):nlayers(stack.ndvi)){

    print(j)

    dummy.stack <-
stack(dummy.stack,sign(raster(stack.ndvi,layer=i)-raster(stack.ndvi,layer=j)))
    tie.break <-
sign(raster(stack.ndvi,layer=i)-raster(stack.ndvi,layer=j)) == 0
    cc <- maxValue(tie.break)
    if( cc == 1){
      mtx[i,j-1]=1
    }
  }
}

S.stack <- dropLayer(dummy.stack,1) #removing dummy

S.stati <- raster(S.stack,layer=1) #for the somatory - initiating in the
second term (can be substituted by in-built overlay function)

for (i in 2:nlayers(S.stack)){

  S.stati <- S.stati + raster(S.stack,layer=i)
}

-----------------------------------------------------------------------

#Ignoring the existence of ties/na (which I've read is acceptable for large
enough datasets)
#then:

  var.mk.sqr <- sqrt(n*(n-1)*(2*n+5)/18)

  S.c1 <- ((S.stati > 0)*S.stati - 1 )/ var.mk.sqr
  S.c2 <- (S.stati ==0)*S.stati* 0
  S.c3 <- ((S.stati < 0)*S.stati + 1 )/ var.mk.sqr

  Z.combi <- overlay(S.c1,S.c2,S.c3,fun="sum")

#"The P value (probability value p) of the MK statistic S of sample data can
be estimated using the normal cumulative distribution function:" (Yue,2002
and Neeti, 2011)
# So, how to implement the CDF using raster data? Am I forced to do series
expansions? would this not be to slow with raster? Or is there a quicker
way to iterate pixel by pixel?

Sorry for the long email and thank you in advance for any
comments/corrections/recommendations!

Best regards to all,
Nuno S?


-- 

Nuno C?sar de S?
+351 91 961 90 37

	[[alternative HTML version deleted]]


From nunocesardesa at gmail.com  Thu Oct  9 00:02:27 2014
From: nunocesardesa at gmail.com (=?UTF-8?B?TnVubyBTw6E=?=)
Date: Wed, 8 Oct 2014 23:02:27 +0100
Subject: [R-sig-Geo] Mann-kendall
In-Reply-To: <CAB-ux0DKL8czbFC4p-i9NsgHj64_db4Dusmp8tYwkaN5=rbFfA@mail.gmail.com>
References: <CAB-ux0DKL8czbFC4p-i9NsgHj64_db4Dusmp8tYwkaN5=rbFfA@mail.gmail.com>
Message-ID: <CAB-ux0DVC3YViSSKW0A9-xz_-1ZMZEvYVjVG4R2-tzoO7y+EzQ@mail.gmail.com>

Hello

Using the integration by part summation was quite fast (I owe a beer to the
ones who've developed the raster package!!)

So, let variable Z.combi be the Z value of the Mann-kendall.

And PHI(x) be the CDF of the Standar normal distribution w/ mean 0 and var
1.

According to Neeti the p-value is given by:

p = 2 * (1 - PHI(|Z|)

Now, on the code, using the integral expansion:

-----------------------

library(phangorn) #to have double factorials

phi.aprox <- 0.5+exp((-1/2)*abs(Z.combi)^2)/sqrt(2*pi)
phi.integ <- 0

for (n in 1:100){

  phi.integ <- phi.integ + Z.combi^(2*n+1)/dfactorial(2*n+1)
}

phi.aprox <- phi-aprox*phi.integ

p.value.rst.neeti <- 2*(1-phi.aprox)

-------------------

The result falls within 0 to 1 which is a good indication. But all depends
on everything I've asked before.

Thank you!



On 8 October 2014 22:23, Nuno S? <nunocesardesa at gmail.com> wrote:

> Hello!
>
> I've been trying for two days to implement the Mann-Kendall test. It is
> available in IDRISI and it would be cool that it would be available here.
>
> I believe I made part of it correctly but I am stuck in two steps.
>
> 1. Calculating the ties/NA coefficients. (Algorithm problem..)
>
> 2. Estimating the p-value on the last step (Lack of statistical knowledge
> problem maybe)
>
> So here it goes what I have so far. Bear with me that I have tried to keep
> my variables names with a certain "instant" meaning.
>
> ---------------------- Problem here, is identifying the coefficients for
> the ties/NA -------------------
>
> dummy.stack <- raster(stack.ndvi,layer=1) #required to initiate stack
> within loop
> mtx <- matrix(0,ncol=nlayers(stack.ndvi),nrow=(nlayers(stack.ndvi)-1))
> #this allows the construction of a matrix with tie values signalled to 1
>
> for (i in 1:(nlayers(stack.ndvi)-1)){
>
>   print("----- i ----")
>   print(i)
>   for (j in (i+1):nlayers(stack.ndvi)){
>
>     print(j)
>
>     dummy.stack <-
> stack(dummy.stack,sign(raster(stack.ndvi,layer=i)-raster(stack.ndvi,layer=j)))
>     tie.break <-
> sign(raster(stack.ndvi,layer=i)-raster(stack.ndvi,layer=j)) == 0
>     cc <- maxValue(tie.break)
>     if( cc == 1){
>       mtx[i,j-1]=1
>     }
>   }
> }
>
> S.stack <- dropLayer(dummy.stack,1) #removing dummy
>
> S.stati <- raster(S.stack,layer=1) #for the somatory - initiating in the
> second term (can be substituted by in-built overlay function)
>
> for (i in 2:nlayers(S.stack)){
>
>   S.stati <- S.stati + raster(S.stack,layer=i)
> }
>
> -----------------------------------------------------------------------
>
> #Ignoring the existence of ties/na (which I've read is acceptable for
> large enough datasets)
> #then:
>
>   var.mk.sqr <- sqrt(n*(n-1)*(2*n+5)/18)
>
>   S.c1 <- ((S.stati > 0)*S.stati - 1 )/ var.mk.sqr
>   S.c2 <- (S.stati ==0)*S.stati* 0
>   S.c3 <- ((S.stati < 0)*S.stati + 1 )/ var.mk.sqr
>
>   Z.combi <- overlay(S.c1,S.c2,S.c3,fun="sum")
>
> #"The P value (probability value p) of the MK statistic S of sample data
> can
> be estimated using the normal cumulative distribution function:" (Yue,2002
> and Neeti, 2011)
> # So, how to implement the CDF using raster data? Am I forced to do series
> expansions? would this not be to slow with raster? Or is there a quicker
> way to iterate pixel by pixel?
>
> Sorry for the long email and thank you in advance for any
> comments/corrections/recommendations!
>
> Best regards to all,
> Nuno S?
>
>
> --
>
> Nuno C?sar de S?
> +351 91 961 90 37
>
>


-- 

Nuno C?sar de S?
+351 91 961 90 37

	[[alternative HTML version deleted]]


From forrest at ufl.edu  Thu Oct  9 01:26:06 2014
From: forrest at ufl.edu (Forrest Stevens)
Date: Wed, 8 Oct 2014 19:26:06 -0400
Subject: [R-sig-Geo] Mann-kendall
In-Reply-To: <CAB-ux0DVC3YViSSKW0A9-xz_-1ZMZEvYVjVG4R2-tzoO7y+EzQ@mail.gmail.com>
References: <CAB-ux0DKL8czbFC4p-i9NsgHj64_db4Dusmp8tYwkaN5=rbFfA@mail.gmail.com>
	<CAB-ux0DVC3YViSSKW0A9-xz_-1ZMZEvYVjVG4R2-tzoO7y+EzQ@mail.gmail.com>
Message-ID: <CAEBQMMnvtXQ6ZzL++ZWy2Ov_sk0zF=ET5kXXHddG8P58FicUNg@mail.gmail.com>

Not to dissuade any interesting new algorithm development, and I may
be missing something in the motivation for what you're trying to
accomplish, but have you looked at the Kendall package and tried using
it on your raster object?  I've been pleasantly surprised at its
efficiency for at least moderately sized raster stacks.  I've
implemented something like the following on real MODIS time series and
it works well (simulated data provided here):


#install.packages("Kendall")

require(raster)
require(Kendall)

## Simulate a small 25x25x25 raster with uncorrelated but trended series:
set.seed(2002)
slopes <- matrix(rnorm(625, 0, 1), nrow=25, ncol=25)

r <- raster(slopes*1+matrix(rnorm(625, 0, 1), nrow=25, ncol=25))
s <- stack(r)

for (i in 2:25) {
r <- raster(slopes*i+matrix(rnorm(625, 0, 1), nrow=25, ncol=25))
s <- addLayer(s, r)
}


## Confirm on a series with a high slope:
slopes[1,3]
plot(1:25, s[1,3,])
MannKendall(s[1,3,])

## vs. one that has a very small slope:
slopes[1,1]
plot(1:25, s[1,1,])
MannKendall(s[1,1,])


## Mann-Kendall on one pixel:
MannKendall(s[1,1,])


## Perform Mann-Kendall on all pixels:
a <- calc(s, fun=function(x) { return(unlist(MannKendall(x)))})

## Plot pixel-level Kendall Tau and p-values:
plot(a$tau)
plot(a$sl)



Again, I might be missing something about your goals but hopefully
this helps someone out there with similar problems.

Sincerely,
Forrest

--
Forrest R. Stevens
Ph.D. Candidate, QSE3 IGERT Fellow
Department of Geography
Land Use and Environmental Change Institute
University of Florida
www.clas.ufl.edu/users/forrest


On Wed, Oct 8, 2014 at 6:02 PM, Nuno S? <nunocesardesa at gmail.com> wrote:
> Hello
>
> Using the integration by part summation was quite fast (I owe a beer to the
> ones who've developed the raster package!!)
>
> So, let variable Z.combi be the Z value of the Mann-kendall.
>
> And PHI(x) be the CDF of the Standar normal distribution w/ mean 0 and var
> 1.
>
> According to Neeti the p-value is given by:
>
> p = 2 * (1 - PHI(|Z|)
>
> Now, on the code, using the integral expansion:
>
> -----------------------
>
> library(phangorn) #to have double factorials
>
> phi.aprox <- 0.5+exp((-1/2)*abs(Z.combi)^2)/sqrt(2*pi)
> phi.integ <- 0
>
> for (n in 1:100){
>
>   phi.integ <- phi.integ + Z.combi^(2*n+1)/dfactorial(2*n+1)
> }
>
> phi.aprox <- phi-aprox*phi.integ
>
> p.value.rst.neeti <- 2*(1-phi.aprox)
>
> -------------------
>
> The result falls within 0 to 1 which is a good indication. But all depends
> on everything I've asked before.
>
> Thank you!
>
>
>
> On 8 October 2014 22:23, Nuno S? <nunocesardesa at gmail.com> wrote:
>
>> Hello!
>>
>> I've been trying for two days to implement the Mann-Kendall test. It is
>> available in IDRISI and it would be cool that it would be available here.
>>
>> I believe I made part of it correctly but I am stuck in two steps.
>>
>> 1. Calculating the ties/NA coefficients. (Algorithm problem..)
>>
>> 2. Estimating the p-value on the last step (Lack of statistical knowledge
>> problem maybe)
>>
>> So here it goes what I have so far. Bear with me that I have tried to keep
>> my variables names with a certain "instant" meaning.
>>
>> ---------------------- Problem here, is identifying the coefficients for
>> the ties/NA -------------------
>>
>> dummy.stack <- raster(stack.ndvi,layer=1) #required to initiate stack
>> within loop
>> mtx <- matrix(0,ncol=nlayers(stack.ndvi),nrow=(nlayers(stack.ndvi)-1))
>> #this allows the construction of a matrix with tie values signalled to 1
>>
>> for (i in 1:(nlayers(stack.ndvi)-1)){
>>
>>   print("----- i ----")
>>   print(i)
>>   for (j in (i+1):nlayers(stack.ndvi)){
>>
>>     print(j)
>>
>>     dummy.stack <-
>> stack(dummy.stack,sign(raster(stack.ndvi,layer=i)-raster(stack.ndvi,layer=j)))
>>     tie.break <-
>> sign(raster(stack.ndvi,layer=i)-raster(stack.ndvi,layer=j)) == 0
>>     cc <- maxValue(tie.break)
>>     if( cc == 1){
>>       mtx[i,j-1]=1
>>     }
>>   }
>> }
>>
>> S.stack <- dropLayer(dummy.stack,1) #removing dummy
>>
>> S.stati <- raster(S.stack,layer=1) #for the somatory - initiating in the
>> second term (can be substituted by in-built overlay function)
>>
>> for (i in 2:nlayers(S.stack)){
>>
>>   S.stati <- S.stati + raster(S.stack,layer=i)
>> }
>>
>> -----------------------------------------------------------------------
>>
>> #Ignoring the existence of ties/na (which I've read is acceptable for
>> large enough datasets)
>> #then:
>>
>>   var.mk.sqr <- sqrt(n*(n-1)*(2*n+5)/18)
>>
>>   S.c1 <- ((S.stati > 0)*S.stati - 1 )/ var.mk.sqr
>>   S.c2 <- (S.stati ==0)*S.stati* 0
>>   S.c3 <- ((S.stati < 0)*S.stati + 1 )/ var.mk.sqr
>>
>>   Z.combi <- overlay(S.c1,S.c2,S.c3,fun="sum")
>>
>> #"The P value (probability value p) of the MK statistic S of sample data
>> can
>> be estimated using the normal cumulative distribution function:" (Yue,2002
>> and Neeti, 2011)
>> # So, how to implement the CDF using raster data? Am I forced to do series
>> expansions? would this not be to slow with raster? Or is there a quicker
>> way to iterate pixel by pixel?
>>
>> Sorry for the long email and thank you in advance for any
>> comments/corrections/recommendations!
>>
>> Best regards to all,
>> Nuno S?
>>
>>
>> --
>>
>> Nuno C?sar de S?
>> +351 91 961 90 37
>>
>>
>
>
> --
>
> Nuno C?sar de S?
> +351 91 961 90 37
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From nunocesardesa at gmail.com  Thu Oct  9 01:58:35 2014
From: nunocesardesa at gmail.com (=?UTF-8?B?TnVubyBTw6E=?=)
Date: Thu, 9 Oct 2014 00:58:35 +0100
Subject: [R-sig-Geo] Mann-kendall
In-Reply-To: <CAEBQMMnvtXQ6ZzL++ZWy2Ov_sk0zF=ET5kXXHddG8P58FicUNg@mail.gmail.com>
References: <CAB-ux0DKL8czbFC4p-i9NsgHj64_db4Dusmp8tYwkaN5=rbFfA@mail.gmail.com>
	<CAB-ux0DVC3YViSSKW0A9-xz_-1ZMZEvYVjVG4R2-tzoO7y+EzQ@mail.gmail.com>
	<CAEBQMMnvtXQ6ZzL++ZWy2Ov_sk0zF=ET5kXXHddG8P58FicUNg@mail.gmail.com>
Message-ID: <CAB-ux0DUXbw6bX21ZCvxHp=zhndyhCt7i9jvcDsMqq1zO85zOQ@mail.gmail.com>

Hello!

ah! that "return(unlist(MannKendall(x)))" might have been why i didn't
manage to do it with the calc function,  will try it out, thank you!

I have a landsat image of a large study area, about 1 092 005 cells by 7
"measurements", hence my avoidance of pixel by pixel but I am going to try
yours. (I also know I shouldn't be using this test for significance of the
MK here but this is just a test set that I am using for developing the
algorithm). Thank you also for the suggestion on how to generate the data.

I'm going to leave the kendall you sugested running through the night. I
have the following warning though:

WARNING: Error exit, tauk2, IFAULT =  10

I've been reading and it might be related to the low number of n for my
testing case.
Found online in a response from the package maintainer A.I. McLeod:

"Thank you though for your comments.  So I will improve the documentation
for Kendall by terminating the program with an error message when n<=3
(this case is of no interest to me) and warning message when n<12 that the
p-values may be inaccurate."


Thank you for everything!
Nuno


On 9 October 2014 00:26, Forrest Stevens <forrest at ufl.edu> wrote:

> Not to dissuade any interesting new algorithm development, and I may
> be missing something in the motivation for what you're trying to
> accomplish, but have you looked at the Kendall package and tried using
> it on your raster object?  I've been pleasantly surprised at its
> efficiency for at least moderately sized raster stacks.  I've
> implemented something like the following on real MODIS time series and
> it works well (simulated data provided here):
>
>
> #install.packages("Kendall")
>
> require(raster)
> require(Kendall)
>
> ## Simulate a small 25x25x25 raster with uncorrelated but trended series:
> set.seed(2002)
> slopes <- matrix(rnorm(625, 0, 1), nrow=25, ncol=25)
>
> r <- raster(slopes*1+matrix(rnorm(625, 0, 1), nrow=25, ncol=25))
> s <- stack(r)
>
> for (i in 2:25) {
> r <- raster(slopes*i+matrix(rnorm(625, 0, 1), nrow=25, ncol=25))
> s <- addLayer(s, r)
> }
>
>
> ## Confirm on a series with a high slope:
> slopes[1,3]
> plot(1:25, s[1,3,])
> MannKendall(s[1,3,])
>
> ## vs. one that has a very small slope:
> slopes[1,1]
> plot(1:25, s[1,1,])
> MannKendall(s[1,1,])
>
>
> ## Mann-Kendall on one pixel:
> MannKendall(s[1,1,])
>
>
> ## Perform Mann-Kendall on all pixels:
> a <- calc(s, fun=function(x) { return(unlist(MannKendall(x)))})
>
> ## Plot pixel-level Kendall Tau and p-values:
> plot(a$tau)
> plot(a$sl)
>
>
>
> Again, I might be missing something about your goals but hopefully
> this helps someone out there with similar problems.
>
> Sincerely,
> Forrest
>
> --
> Forrest R. Stevens
> Ph.D. Candidate, QSE3 IGERT Fellow
> Department of Geography
> Land Use and Environmental Change Institute
> University of Florida
> www.clas.ufl.edu/users/forrest
>
>
> On Wed, Oct 8, 2014 at 6:02 PM, Nuno S? <nunocesardesa at gmail.com> wrote:
> > Hello
> >
> > Using the integration by part summation was quite fast (I owe a beer to
> the
> > ones who've developed the raster package!!)
> >
> > So, let variable Z.combi be the Z value of the Mann-kendall.
> >
> > And PHI(x) be the CDF of the Standar normal distribution w/ mean 0 and
> var
> > 1.
> >
> > According to Neeti the p-value is given by:
> >
> > p = 2 * (1 - PHI(|Z|)
> >
> > Now, on the code, using the integral expansion:
> >
> > -----------------------
> >
> > library(phangorn) #to have double factorials
> >
> > phi.aprox <- 0.5+exp((-1/2)*abs(Z.combi)^2)/sqrt(2*pi)
> > phi.integ <- 0
> >
> > for (n in 1:100){
> >
> >   phi.integ <- phi.integ + Z.combi^(2*n+1)/dfactorial(2*n+1)
> > }
> >
> > phi.aprox <- phi-aprox*phi.integ
> >
> > p.value.rst.neeti <- 2*(1-phi.aprox)
> >
> > -------------------
> >
> > The result falls within 0 to 1 which is a good indication. But all
> depends
> > on everything I've asked before.
> >
> > Thank you!
> >
> >
> >
> > On 8 October 2014 22:23, Nuno S? <nunocesardesa at gmail.com> wrote:
> >
> >> Hello!
> >>
> >> I've been trying for two days to implement the Mann-Kendall test. It is
> >> available in IDRISI and it would be cool that it would be available
> here.
> >>
> >> I believe I made part of it correctly but I am stuck in two steps.
> >>
> >> 1. Calculating the ties/NA coefficients. (Algorithm problem..)
> >>
> >> 2. Estimating the p-value on the last step (Lack of statistical
> knowledge
> >> problem maybe)
> >>
> >> So here it goes what I have so far. Bear with me that I have tried to
> keep
> >> my variables names with a certain "instant" meaning.
> >>
> >> ---------------------- Problem here, is identifying the coefficients for
> >> the ties/NA -------------------
> >>
> >> dummy.stack <- raster(stack.ndvi,layer=1) #required to initiate stack
> >> within loop
> >> mtx <- matrix(0,ncol=nlayers(stack.ndvi),nrow=(nlayers(stack.ndvi)-1))
> >> #this allows the construction of a matrix with tie values signalled to 1
> >>
> >> for (i in 1:(nlayers(stack.ndvi)-1)){
> >>
> >>   print("----- i ----")
> >>   print(i)
> >>   for (j in (i+1):nlayers(stack.ndvi)){
> >>
> >>     print(j)
> >>
> >>     dummy.stack <-
> >>
> stack(dummy.stack,sign(raster(stack.ndvi,layer=i)-raster(stack.ndvi,layer=j)))
> >>     tie.break <-
> >> sign(raster(stack.ndvi,layer=i)-raster(stack.ndvi,layer=j)) == 0
> >>     cc <- maxValue(tie.break)
> >>     if( cc == 1){
> >>       mtx[i,j-1]=1
> >>     }
> >>   }
> >> }
> >>
> >> S.stack <- dropLayer(dummy.stack,1) #removing dummy
> >>
> >> S.stati <- raster(S.stack,layer=1) #for the somatory - initiating in the
> >> second term (can be substituted by in-built overlay function)
> >>
> >> for (i in 2:nlayers(S.stack)){
> >>
> >>   S.stati <- S.stati + raster(S.stack,layer=i)
> >> }
> >>
> >> -----------------------------------------------------------------------
> >>
> >> #Ignoring the existence of ties/na (which I've read is acceptable for
> >> large enough datasets)
> >> #then:
> >>
> >>   var.mk.sqr <- sqrt(n*(n-1)*(2*n+5)/18)
> >>
> >>   S.c1 <- ((S.stati > 0)*S.stati - 1 )/ var.mk.sqr
> >>   S.c2 <- (S.stati ==0)*S.stati* 0
> >>   S.c3 <- ((S.stati < 0)*S.stati + 1 )/ var.mk.sqr
> >>
> >>   Z.combi <- overlay(S.c1,S.c2,S.c3,fun="sum")
> >>
> >> #"The P value (probability value p) of the MK statistic S of sample data
> >> can
> >> be estimated using the normal cumulative distribution function:"
> (Yue,2002
> >> and Neeti, 2011)
> >> # So, how to implement the CDF using raster data? Am I forced to do
> series
> >> expansions? would this not be to slow with raster? Or is there a quicker
> >> way to iterate pixel by pixel?
> >>
> >> Sorry for the long email and thank you in advance for any
> >> comments/corrections/recommendations!
> >>
> >> Best regards to all,
> >> Nuno S?
> >>
> >>
> >> --
> >>
> >> Nuno C?sar de S?
> >> +351 91 961 90 37
> >>
> >>
> >
> >
> > --
> >
> > Nuno C?sar de S?
> > +351 91 961 90 37
> >
> >         [[alternative HTML version deleted]]
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



-- 

Nuno C?sar de S?
+351 91 961 90 37

	[[alternative HTML version deleted]]


From forrest at ufl.edu  Thu Oct  9 04:17:45 2014
From: forrest at ufl.edu (Forrest Stevens)
Date: Wed, 8 Oct 2014 22:17:45 -0400
Subject: [R-sig-Geo] Mann-kendall
In-Reply-To: <CAB-ux0DUXbw6bX21ZCvxHp=zhndyhCt7i9jvcDsMqq1zO85zOQ@mail.gmail.com>
References: <CAB-ux0DKL8czbFC4p-i9NsgHj64_db4Dusmp8tYwkaN5=rbFfA@mail.gmail.com>
	<CAB-ux0DVC3YViSSKW0A9-xz_-1ZMZEvYVjVG4R2-tzoO7y+EzQ@mail.gmail.com>
	<CAEBQMMnvtXQ6ZzL++ZWy2Ov_sk0zF=ET5kXXHddG8P58FicUNg@mail.gmail.com>
	<CAB-ux0DUXbw6bX21ZCvxHp=zhndyhCt7i9jvcDsMqq1zO85zOQ@mail.gmail.com>
Message-ID: <CAEBQMMnECDXqWOjW4jZCYEKooQ+SHVovO2svTU3o-QcjZycdcg@mail.gmail.com>

You're welcome!  I'm glad you found it useful. I agree that the
MannKendall package and functions could use slightly more informative
warnings, though many packages won't give you any such warnings at
all. At least M-K clues you in that you may be making a statistical
error rather than letting one run on completely uninformed. Good luck
getting it all running!

Sincerely,
Forrest
--
Forrest R. Stevens
Ph.D. Candidate, QSE3 IGERT Fellow
Department of Geography
Land Use and Environmental Change Institute
University of Florida
www.clas.ufl.edu/users/forrest


On Wed, Oct 8, 2014 at 7:58 PM, Nuno S? <nunocesardesa at gmail.com> wrote:
> Hello!
>
> ah! that "return(unlist(MannKendall(x)))" might have been why i didn't
> manage to do it with the calc function,  will try it out, thank you!
>
> I have a landsat image of a large study area, about 1 092 005 cells by 7
> "measurements", hence my avoidance of pixel by pixel but I am going to try
> yours. (I also know I shouldn't be using this test for significance of the
> MK here but this is just a test set that I am using for developing the
> algorithm). Thank you also for the suggestion on how to generate the data.
>
> I'm going to leave the kendall you sugested running through the night. I
> have the following warning though:
>
> WARNING: Error exit, tauk2, IFAULT =  10
>
> I've been reading and it might be related to the low number of n for my
> testing case.
> Found online in a response from the package maintainer A.I. McLeod:
>
> "Thank you though for your comments.  So I will improve the documentation
> for Kendall by terminating the program with an error message when n<=3
> (this case is of no interest to me) and warning message when n<12 that the
> p-values may be inaccurate."
>
>
> Thank you for everything!
> Nuno
>
>
> On 9 October 2014 00:26, Forrest Stevens <forrest at ufl.edu> wrote:
>>
>> Not to dissuade any interesting new algorithm development, and I may
>> be missing something in the motivation for what you're trying to
>> accomplish, but have you looked at the Kendall package and tried using
>> it on your raster object?  I've been pleasantly surprised at its
>> efficiency for at least moderately sized raster stacks.  I've
>> implemented something like the following on real MODIS time series and
>> it works well (simulated data provided here):
>>
>>
>> #install.packages("Kendall")
>>
>> require(raster)
>> require(Kendall)
>>
>> ## Simulate a small 25x25x25 raster with uncorrelated but trended series:
>> set.seed(2002)
>> slopes <- matrix(rnorm(625, 0, 1), nrow=25, ncol=25)
>>
>> r <- raster(slopes*1+matrix(rnorm(625, 0, 1), nrow=25, ncol=25))
>> s <- stack(r)
>>
>> for (i in 2:25) {
>> r <- raster(slopes*i+matrix(rnorm(625, 0, 1), nrow=25, ncol=25))
>> s <- addLayer(s, r)
>> }
>>
>>
>> ## Confirm on a series with a high slope:
>> slopes[1,3]
>> plot(1:25, s[1,3,])
>> MannKendall(s[1,3,])
>>
>> ## vs. one that has a very small slope:
>> slopes[1,1]
>> plot(1:25, s[1,1,])
>> MannKendall(s[1,1,])
>>
>>
>> ## Mann-Kendall on one pixel:
>> MannKendall(s[1,1,])
>>
>>
>> ## Perform Mann-Kendall on all pixels:
>> a <- calc(s, fun=function(x) { return(unlist(MannKendall(x)))})
>>
>> ## Plot pixel-level Kendall Tau and p-values:
>> plot(a$tau)
>> plot(a$sl)
>>
>>
>>
>> Again, I might be missing something about your goals but hopefully
>> this helps someone out there with similar problems.
>>
>> Sincerely,
>> Forrest
>>
>> --
>> Forrest R. Stevens
>> Ph.D. Candidate, QSE3 IGERT Fellow
>> Department of Geography
>> Land Use and Environmental Change Institute
>> University of Florida
>> www.clas.ufl.edu/users/forrest
>>
>>
>> On Wed, Oct 8, 2014 at 6:02 PM, Nuno S? <nunocesardesa at gmail.com> wrote:
>> > Hello
>> >
>> > Using the integration by part summation was quite fast (I owe a beer to
>> > the
>> > ones who've developed the raster package!!)
>> >
>> > So, let variable Z.combi be the Z value of the Mann-kendall.
>> >
>> > And PHI(x) be the CDF of the Standar normal distribution w/ mean 0 and
>> > var
>> > 1.
>> >
>> > According to Neeti the p-value is given by:
>> >
>> > p = 2 * (1 - PHI(|Z|)
>> >
>> > Now, on the code, using the integral expansion:
>> >
>> > -----------------------
>> >
>> > library(phangorn) #to have double factorials
>> >
>> > phi.aprox <- 0.5+exp((-1/2)*abs(Z.combi)^2)/sqrt(2*pi)
>> > phi.integ <- 0
>> >
>> > for (n in 1:100){
>> >
>> >   phi.integ <- phi.integ + Z.combi^(2*n+1)/dfactorial(2*n+1)
>> > }
>> >
>> > phi.aprox <- phi-aprox*phi.integ
>> >
>> > p.value.rst.neeti <- 2*(1-phi.aprox)
>> >
>> > -------------------
>> >
>> > The result falls within 0 to 1 which is a good indication. But all
>> > depends
>> > on everything I've asked before.
>> >
>> > Thank you!
>> >
>> >
>> >
>> > On 8 October 2014 22:23, Nuno S? <nunocesardesa at gmail.com> wrote:
>> >
>> >> Hello!
>> >>
>> >> I've been trying for two days to implement the Mann-Kendall test. It is
>> >> available in IDRISI and it would be cool that it would be available
>> >> here.
>> >>
>> >> I believe I made part of it correctly but I am stuck in two steps.
>> >>
>> >> 1. Calculating the ties/NA coefficients. (Algorithm problem..)
>> >>
>> >> 2. Estimating the p-value on the last step (Lack of statistical
>> >> knowledge
>> >> problem maybe)
>> >>
>> >> So here it goes what I have so far. Bear with me that I have tried to
>> >> keep
>> >> my variables names with a certain "instant" meaning.
>> >>
>> >> ---------------------- Problem here, is identifying the coefficients
>> >> for
>> >> the ties/NA -------------------
>> >>
>> >> dummy.stack <- raster(stack.ndvi,layer=1) #required to initiate stack
>> >> within loop
>> >> mtx <- matrix(0,ncol=nlayers(stack.ndvi),nrow=(nlayers(stack.ndvi)-1))
>> >> #this allows the construction of a matrix with tie values signalled to
>> >> 1
>> >>
>> >> for (i in 1:(nlayers(stack.ndvi)-1)){
>> >>
>> >>   print("----- i ----")
>> >>   print(i)
>> >>   for (j in (i+1):nlayers(stack.ndvi)){
>> >>
>> >>     print(j)
>> >>
>> >>     dummy.stack <-
>> >>
>> >> stack(dummy.stack,sign(raster(stack.ndvi,layer=i)-raster(stack.ndvi,layer=j)))
>> >>     tie.break <-
>> >> sign(raster(stack.ndvi,layer=i)-raster(stack.ndvi,layer=j)) == 0
>> >>     cc <- maxValue(tie.break)
>> >>     if( cc == 1){
>> >>       mtx[i,j-1]=1
>> >>     }
>> >>   }
>> >> }
>> >>
>> >> S.stack <- dropLayer(dummy.stack,1) #removing dummy
>> >>
>> >> S.stati <- raster(S.stack,layer=1) #for the somatory - initiating in
>> >> the
>> >> second term (can be substituted by in-built overlay function)
>> >>
>> >> for (i in 2:nlayers(S.stack)){
>> >>
>> >>   S.stati <- S.stati + raster(S.stack,layer=i)
>> >> }
>> >>
>> >> -----------------------------------------------------------------------
>> >>
>> >> #Ignoring the existence of ties/na (which I've read is acceptable for
>> >> large enough datasets)
>> >> #then:
>> >>
>> >>   var.mk.sqr <- sqrt(n*(n-1)*(2*n+5)/18)
>> >>
>> >>   S.c1 <- ((S.stati > 0)*S.stati - 1 )/ var.mk.sqr
>> >>   S.c2 <- (S.stati ==0)*S.stati* 0
>> >>   S.c3 <- ((S.stati < 0)*S.stati + 1 )/ var.mk.sqr
>> >>
>> >>   Z.combi <- overlay(S.c1,S.c2,S.c3,fun="sum")
>> >>
>> >> #"The P value (probability value p) of the MK statistic S of sample
>> >> data
>> >> can
>> >> be estimated using the normal cumulative distribution function:"
>> >> (Yue,2002
>> >> and Neeti, 2011)
>> >> # So, how to implement the CDF using raster data? Am I forced to do
>> >> series
>> >> expansions? would this not be to slow with raster? Or is there a
>> >> quicker
>> >> way to iterate pixel by pixel?
>> >>
>> >> Sorry for the long email and thank you in advance for any
>> >> comments/corrections/recommendations!
>> >>
>> >> Best regards to all,
>> >> Nuno S?
>> >>
>> >>
>> >> --
>> >>
>> >> Nuno C?sar de S?
>> >> +351 91 961 90 37
>> >>
>> >>
>> >
>> >
>> > --
>> >
>> > Nuno C?sar de S?
>> > +351 91 961 90 37
>> >
>> >         [[alternative HTML version deleted]]
>> >
>> > _______________________________________________
>> > R-sig-Geo mailing list
>> > R-sig-Geo at r-project.org
>> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
>
>
> --
>
> Nuno C?sar de S?
> +351 91 961 90 37
>


From nunocesardesa at gmail.com  Thu Oct  9 11:22:22 2014
From: nunocesardesa at gmail.com (=?UTF-8?B?TnVubyBTw6E=?=)
Date: Thu, 9 Oct 2014 10:22:22 +0100
Subject: [R-sig-Geo] Mann-kendall
In-Reply-To: <CAEBQMMnECDXqWOjW4jZCYEKooQ+SHVovO2svTU3o-QcjZycdcg@mail.gmail.com>
References: <CAB-ux0DKL8czbFC4p-i9NsgHj64_db4Dusmp8tYwkaN5=rbFfA@mail.gmail.com>
	<CAB-ux0DVC3YViSSKW0A9-xz_-1ZMZEvYVjVG4R2-tzoO7y+EzQ@mail.gmail.com>
	<CAEBQMMnvtXQ6ZzL++ZWy2Ov_sk0zF=ET5kXXHddG8P58FicUNg@mail.gmail.com>
	<CAB-ux0DUXbw6bX21ZCvxHp=zhndyhCt7i9jvcDsMqq1zO85zOQ@mail.gmail.com>
	<CAEBQMMnECDXqWOjW4jZCYEKooQ+SHVovO2svTU3o-QcjZycdcg@mail.gmail.com>
Message-ID: <CAB-ux0CN123b2u8NUpuFkh90+=YmUCw_66QFQ0oD-7ccRgpWLQ@mail.gmail.com>

Yep, it is very cool from the package maintaner.

Ok, I've used your suggestion and it works quite faster than I anticipated,
so for my current work I'll keep to it.

Before this I also calculated a simple linear regression using only the
rasters which was quite effective.

I tested for some random values and I got the slope and intercept with
correct values so I'm happy about it.

I did thought about using calc before but since I had a million pixels and
I didn't manage to make this one work for the whole raster, I ended up just
doing it using raster operations only. (The example on the page I took the
following code works, but not for my own data)

# get multiple layers, e.g. the slope _and_ intercept
fun <- function <http://inside-r.org/r-doc/base/function>(x) { lm
<http://inside-r.org/r-doc/stats/lm>(x ~ time
<http://inside-r.org/r-doc/stats/time>)$coefficients }
x3 <- calc(s <http://inside-r.org/r-doc/mgcv/s>, fun)




On 9 October 2014 03:17, Forrest Stevens <forrest at ufl.edu> wrote:

> You're welcome!  I'm glad you found it useful. I agree that the
> MannKendall package and functions could use slightly more informative
> warnings, though many packages won't give you any such warnings at
> all. At least M-K clues you in that you may be making a statistical
> error rather than letting one run on completely uninformed. Good luck
> getting it all running!
>
> Sincerely,
> Forrest
> --
> Forrest R. Stevens
> Ph.D. Candidate, QSE3 IGERT Fellow
> Department of Geography
> Land Use and Environmental Change Institute
> University of Florida
> www.clas.ufl.edu/users/forrest
>
>
> On Wed, Oct 8, 2014 at 7:58 PM, Nuno S? <nunocesardesa at gmail.com> wrote:
> > Hello!
> >
> > ah! that "return(unlist(MannKendall(x)))" might have been why i didn't
> > manage to do it with the calc function,  will try it out, thank you!
> >
> > I have a landsat image of a large study area, about 1 092 005 cells by 7
> > "measurements", hence my avoidance of pixel by pixel but I am going to
> try
> > yours. (I also know I shouldn't be using this test for significance of
> the
> > MK here but this is just a test set that I am using for developing the
> > algorithm). Thank you also for the suggestion on how to generate the
> data.
> >
> > I'm going to leave the kendall you sugested running through the night. I
> > have the following warning though:
> >
> > WARNING: Error exit, tauk2, IFAULT =  10
> >
> > I've been reading and it might be related to the low number of n for my
> > testing case.
> > Found online in a response from the package maintainer A.I. McLeod:
> >
> > "Thank you though for your comments.  So I will improve the documentation
> > for Kendall by terminating the program with an error message when n<=3
> > (this case is of no interest to me) and warning message when n<12 that
> the
> > p-values may be inaccurate."
> >
> >
> > Thank you for everything!
> > Nuno
> >
> >
> > On 9 October 2014 00:26, Forrest Stevens <forrest at ufl.edu> wrote:
> >>
> >> Not to dissuade any interesting new algorithm development, and I may
> >> be missing something in the motivation for what you're trying to
> >> accomplish, but have you looked at the Kendall package and tried using
> >> it on your raster object?  I've been pleasantly surprised at its
> >> efficiency for at least moderately sized raster stacks.  I've
> >> implemented something like the following on real MODIS time series and
> >> it works well (simulated data provided here):
> >>
> >>
> >> #install.packages("Kendall")
> >>
> >> require(raster)
> >> require(Kendall)
> >>
> >> ## Simulate a small 25x25x25 raster with uncorrelated but trended
> series:
> >> set.seed(2002)
> >> slopes <- matrix(rnorm(625, 0, 1), nrow=25, ncol=25)
> >>
> >> r <- raster(slopes*1+matrix(rnorm(625, 0, 1), nrow=25, ncol=25))
> >> s <- stack(r)
> >>
> >> for (i in 2:25) {
> >> r <- raster(slopes*i+matrix(rnorm(625, 0, 1), nrow=25, ncol=25))
> >> s <- addLayer(s, r)
> >> }
> >>
> >>
> >> ## Confirm on a series with a high slope:
> >> slopes[1,3]
> >> plot(1:25, s[1,3,])
> >> MannKendall(s[1,3,])
> >>
> >> ## vs. one that has a very small slope:
> >> slopes[1,1]
> >> plot(1:25, s[1,1,])
> >> MannKendall(s[1,1,])
> >>
> >>
> >> ## Mann-Kendall on one pixel:
> >> MannKendall(s[1,1,])
> >>
> >>
> >> ## Perform Mann-Kendall on all pixels:
> >> a <- calc(s, fun=function(x) { return(unlist(MannKendall(x)))})
> >>
> >> ## Plot pixel-level Kendall Tau and p-values:
> >> plot(a$tau)
> >> plot(a$sl)
> >>
> >>
> >>
> >> Again, I might be missing something about your goals but hopefully
> >> this helps someone out there with similar problems.
> >>
> >> Sincerely,
> >> Forrest
> >>
> >> --
> >> Forrest R. Stevens
> >> Ph.D. Candidate, QSE3 IGERT Fellow
> >> Department of Geography
> >> Land Use and Environmental Change Institute
> >> University of Florida
> >> www.clas.ufl.edu/users/forrest
> >>
> >>
> >> On Wed, Oct 8, 2014 at 6:02 PM, Nuno S? <nunocesardesa at gmail.com>
> wrote:
> >> > Hello
> >> >
> >> > Using the integration by part summation was quite fast (I owe a beer
> to
> >> > the
> >> > ones who've developed the raster package!!)
> >> >
> >> > So, let variable Z.combi be the Z value of the Mann-kendall.
> >> >
> >> > And PHI(x) be the CDF of the Standar normal distribution w/ mean 0 and
> >> > var
> >> > 1.
> >> >
> >> > According to Neeti the p-value is given by:
> >> >
> >> > p = 2 * (1 - PHI(|Z|)
> >> >
> >> > Now, on the code, using the integral expansion:
> >> >
> >> > -----------------------
> >> >
> >> > library(phangorn) #to have double factorials
> >> >
> >> > phi.aprox <- 0.5+exp((-1/2)*abs(Z.combi)^2)/sqrt(2*pi)
> >> > phi.integ <- 0
> >> >
> >> > for (n in 1:100){
> >> >
> >> >   phi.integ <- phi.integ + Z.combi^(2*n+1)/dfactorial(2*n+1)
> >> > }
> >> >
> >> > phi.aprox <- phi-aprox*phi.integ
> >> >
> >> > p.value.rst.neeti <- 2*(1-phi.aprox)
> >> >
> >> > -------------------
> >> >
> >> > The result falls within 0 to 1 which is a good indication. But all
> >> > depends
> >> > on everything I've asked before.
> >> >
> >> > Thank you!
> >> >
> >> >
> >> >
> >> > On 8 October 2014 22:23, Nuno S? <nunocesardesa at gmail.com> wrote:
> >> >
> >> >> Hello!
> >> >>
> >> >> I've been trying for two days to implement the Mann-Kendall test. It
> is
> >> >> available in IDRISI and it would be cool that it would be available
> >> >> here.
> >> >>
> >> >> I believe I made part of it correctly but I am stuck in two steps.
> >> >>
> >> >> 1. Calculating the ties/NA coefficients. (Algorithm problem..)
> >> >>
> >> >> 2. Estimating the p-value on the last step (Lack of statistical
> >> >> knowledge
> >> >> problem maybe)
> >> >>
> >> >> So here it goes what I have so far. Bear with me that I have tried to
> >> >> keep
> >> >> my variables names with a certain "instant" meaning.
> >> >>
> >> >> ---------------------- Problem here, is identifying the coefficients
> >> >> for
> >> >> the ties/NA -------------------
> >> >>
> >> >> dummy.stack <- raster(stack.ndvi,layer=1) #required to initiate stack
> >> >> within loop
> >> >> mtx <-
> matrix(0,ncol=nlayers(stack.ndvi),nrow=(nlayers(stack.ndvi)-1))
> >> >> #this allows the construction of a matrix with tie values signalled
> to
> >> >> 1
> >> >>
> >> >> for (i in 1:(nlayers(stack.ndvi)-1)){
> >> >>
> >> >>   print("----- i ----")
> >> >>   print(i)
> >> >>   for (j in (i+1):nlayers(stack.ndvi)){
> >> >>
> >> >>     print(j)
> >> >>
> >> >>     dummy.stack <-
> >> >>
> >> >>
> stack(dummy.stack,sign(raster(stack.ndvi,layer=i)-raster(stack.ndvi,layer=j)))
> >> >>     tie.break <-
> >> >> sign(raster(stack.ndvi,layer=i)-raster(stack.ndvi,layer=j)) == 0
> >> >>     cc <- maxValue(tie.break)
> >> >>     if( cc == 1){
> >> >>       mtx[i,j-1]=1
> >> >>     }
> >> >>   }
> >> >> }
> >> >>
> >> >> S.stack <- dropLayer(dummy.stack,1) #removing dummy
> >> >>
> >> >> S.stati <- raster(S.stack,layer=1) #for the somatory - initiating in
> >> >> the
> >> >> second term (can be substituted by in-built overlay function)
> >> >>
> >> >> for (i in 2:nlayers(S.stack)){
> >> >>
> >> >>   S.stati <- S.stati + raster(S.stack,layer=i)
> >> >> }
> >> >>
> >> >>
> -----------------------------------------------------------------------
> >> >>
> >> >> #Ignoring the existence of ties/na (which I've read is acceptable for
> >> >> large enough datasets)
> >> >> #then:
> >> >>
> >> >>   var.mk.sqr <- sqrt(n*(n-1)*(2*n+5)/18)
> >> >>
> >> >>   S.c1 <- ((S.stati > 0)*S.stati - 1 )/ var.mk.sqr
> >> >>   S.c2 <- (S.stati ==0)*S.stati* 0
> >> >>   S.c3 <- ((S.stati < 0)*S.stati + 1 )/ var.mk.sqr
> >> >>
> >> >>   Z.combi <- overlay(S.c1,S.c2,S.c3,fun="sum")
> >> >>
> >> >> #"The P value (probability value p) of the MK statistic S of sample
> >> >> data
> >> >> can
> >> >> be estimated using the normal cumulative distribution function:"
> >> >> (Yue,2002
> >> >> and Neeti, 2011)
> >> >> # So, how to implement the CDF using raster data? Am I forced to do
> >> >> series
> >> >> expansions? would this not be to slow with raster? Or is there a
> >> >> quicker
> >> >> way to iterate pixel by pixel?
> >> >>
> >> >> Sorry for the long email and thank you in advance for any
> >> >> comments/corrections/recommendations!
> >> >>
> >> >> Best regards to all,
> >> >> Nuno S?
> >> >>
> >> >>
> >> >> --
> >> >>
> >> >> Nuno C?sar de S?
> >> >> +351 91 961 90 37
> >> >>
> >> >>
> >> >
> >> >
> >> > --
> >> >
> >> > Nuno C?sar de S?
> >> > +351 91 961 90 37
> >> >
> >> >         [[alternative HTML version deleted]]
> >> >
> >> > _______________________________________________
> >> > R-sig-Geo mailing list
> >> > R-sig-Geo at r-project.org
> >> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
> >
> >
> >
> > --
> >
> > Nuno C?sar de S?
> > +351 91 961 90 37
> >
>



-- 

Nuno C?sar de S?
+351 91 961 90 37

	[[alternative HTML version deleted]]


From wolz1 at illinois.edu  Fri Oct 10 00:07:41 2014
From: wolz1 at illinois.edu (Kevin Wolz)
Date: Thu, 9 Oct 2014 17:07:41 -0500
Subject: [R-sig-Geo] gstat package on Mac Mavericks
Message-ID: <CAL0dvJ_-r7obx_2muqOAUx5J36Ereo6NwM9Hr6K-iRELS-7YKA@mail.gmail.com>

Trying to get the "gstat" package installed on R 3.1.0 running on mac OSX
Mavericks, for which a binary has not yet been built. A previous R-SIG-Mac
thread (see link below) provided a good solution for "rgeos" and "rgdal",
but this doesn't work for "gstat". Any suggestions?

I'm trying to install from source, but R isn't liking the fact that gstat
is from source but the dependencies are in CRAN. Also, I think that one or
more of the dependencies don't have Mavericks binaries yet either!

Solution for other packages:
https://stat.ethz.ch/pipermail/r-sig-mac/2014-May/010871.html

Thanks,
Kevin

--
Kevin Wolz

PhD Student, DeLucia Lab
University of Illinois at Urbana-Champaign

	[[alternative HTML version deleted]]


From tea3rd at gmail.com  Fri Oct 10 02:59:08 2014
From: tea3rd at gmail.com (Thomas Adams)
Date: Thu, 9 Oct 2014 18:59:08 -0600
Subject: [R-sig-Geo] gstat package on Mac Mavericks
In-Reply-To: <CAL0dvJ_-r7obx_2muqOAUx5J36Ereo6NwM9Hr6K-iRELS-7YKA@mail.gmail.com>
References: <CAL0dvJ_-r7obx_2muqOAUx5J36Ereo6NwM9Hr6K-iRELS-7YKA@mail.gmail.com>
Message-ID: <CAGxgkWiL92SR1XTbi8mH9-sWuBJzRcUUwNuUk=yP91uPAZPadg@mail.gmail.com>

Kevin,

My experience has been that it's far better to install the gstat binary and
dependencies; get *gdal* from here: http://grassmac.wikidot.com/frameworks
, then install gstat with all dependencies.

Tom

On Thu, Oct 9, 2014 at 4:07 PM, Kevin Wolz <wolz1 at illinois.edu> wrote:

> Trying to get the "gstat" package installed on R 3.1.0 running on mac OSX
> Mavericks, for which a binary has not yet been built. A previous R-SIG-Mac
> thread (see link below) provided a good solution for "rgeos" and "rgdal",
> but this doesn't work for "gstat". Any suggestions?
>
> I'm trying to install from source, but R isn't liking the fact that gstat
> is from source but the dependencies are in CRAN. Also, I think that one or
> more of the dependencies don't have Mavericks binaries yet either!
>
> Solution for other packages:
> https://stat.ethz.ch/pipermail/r-sig-mac/2014-May/010871.html
>
> Thanks,
> Kevin
>
> --
> Kevin Wolz
>
> PhD Student, DeLucia Lab
> University of Illinois at Urbana-Champaign
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From carolina.lang at ifop.cl  Fri Oct 10 20:16:30 2014
From: carolina.lang at ifop.cl (carolina.lang at ifop.cl)
Date: Fri, 10 Oct 2014 15:16:30 -0300 (CLST)
Subject: [R-sig-Geo] query about fitting a model variogram
In-Reply-To: <CABG0rfvaHJCkk4mj0zgkCcRdDnSnQEAZXgAvQdEnkPpWNqk2Bg@mail.gmail.com>
References: <BLU178-W5144BBCB629DCB1ADCC8A6E4BF0@phx.gbl>
	<CABG0rfvH=YQoc_=YnPJL9XhrZ=Vgd672YepJGZyeD5S2ogjwog@mail.gmail.com>
	<BLU178-W24FA28B5227A074E197BB4E4BA0@phx.gbl>
	<CABG0rfvaHJCkk4mj0zgkCcRdDnSnQEAZXgAvQdEnkPpWNqk2Bg@mail.gmail.com>
Message-ID: <404053612.2308139.1412964990472.JavaMail.zimbra@ifop.cl>

Dear list, 
	
I need some advices, i??m trying to fit a model with the variofit and the likfit method, but before i fit some initial values with the help of the eyefit function, then the parameters fitted with this methods do not fit very well, so i want to limit the sill and the range of the model, I found a function call par.limits but it does not work very well because take the minimun values. Can anybody help me with this???

Cheers, Carolina


------------------------------------------------------------------------------------------------
Certificaci?n ISO 9001/2008: Sistema de Datos Bio-Pesqueros ( Arica, Iquique, Coquimbo, Valpara?so, San Antonio, Talcahuano y Calbuco, pesquer?as industriales y artesanales)


     


From carolina.lang at ifop.cl  Fri Oct 10 20:19:40 2014
From: carolina.lang at ifop.cl (carolina.lang at ifop.cl)
Date: Fri, 10 Oct 2014 15:19:40 -0300 (CLST)
Subject: [R-sig-Geo] query about fitting a model variogram
In-Reply-To: <404053612.2308139.1412964990472.JavaMail.zimbra@ifop.cl>
References: <BLU178-W5144BBCB629DCB1ADCC8A6E4BF0@phx.gbl>
	<CABG0rfvH=YQoc_=YnPJL9XhrZ=Vgd672YepJGZyeD5S2ogjwog@mail.gmail.com>
	<BLU178-W24FA28B5227A074E197BB4E4BA0@phx.gbl>
	<CABG0rfvaHJCkk4mj0zgkCcRdDnSnQEAZXgAvQdEnkPpWNqk2Bg@mail.gmail.com>
	<404053612.2308139.1412964990472.JavaMail.zimbra@ifop.cl>
Message-ID: <142604547.2308935.1412965180157.JavaMail.zimbra@ifop.cl>


Dear list, 
	
I need some advices, i??m trying to fit a model with the variofit and the likfit method, but before i fit some initial values with the help of the eyefit function, then the parameters fitted with this methods do not fit very well, so i want to limit the sill and the range of the model, I found a function call par.limits but it does not work very well because take the minimun values. Can anybody help me with this???

Cheers, Carolina



------------------------------------------------------------------------------------------------
Certificaci?n ISO 9001/2008: Sistema de Datos Bio-Pesqueros ( Arica, Iquique, Coquimbo, Valpara?so, San Antonio, Talcahuano y Calbuco, pesquer?as industriales y artesanales)


     


From carolina.lang at ifop.cl  Fri Oct 10 20:24:03 2014
From: carolina.lang at ifop.cl (carolina.lang at ifop.cl)
Date: Fri, 10 Oct 2014 15:24:03 -0300 (CLST)
Subject: [R-sig-Geo] query about variogram model fitting
In-Reply-To: <850176129.2309162.1412965259019.JavaMail.zimbra@ifop.cl>
Message-ID: <1139607900.2310231.1412965443545.JavaMail.zimbra@ifop.cl>

Dear list, 

I need some advices, i??m trying to fit a model with the variofit and the likfit method, but before i fit some initial values with the help of the eyefit function, then the parameters fitted with this methods do not fit very well, so i want to limit the sill and the range of the model, I found a function call par.limits but it does not work very well because take the minimun values. Can anybody help me with this??? 

Sorry if anybody received this mail more than one time, something was wrong with the mail address 
Cheers, Carolina 

	

Carolina Lang Abarz??a 
Investigador 
Instituto de Fomento Pesquero 
Av. Blanco #839, Valparaiso, Chile. 
Fono: (32) 2151572 
www.ifop.cl 





------------------------------------------------------------------------------------------------
Certificaci?n ISO 9001/2008: Sistema de Datos Bio-Pesqueros ( Arica, Iquique, Coquimbo, Valpara?so, San Antonio, Talcahuano y Calbuco, pesquer?as industriales y artesanales)


     


	[[alternative HTML version deleted]]


From afischbach at usgs.gov  Fri Oct 10 23:32:03 2014
From: afischbach at usgs.gov (Anthony Fischbach)
Date: Fri, 10 Oct 2014 14:32:03 -0700 (PDT)
Subject: [R-sig-Geo] raster working with netCDF files that have indexed
	geography
Message-ID: <1412976723290-7587261.post@n2.nabble.com>

In working with Global Circulation Model datasets from the Earth System Grid
Federation (http://pcmdi9.llnl.gov/esgf-web-fe/), and am struggling to
efficiently pull in the geography of the netCDF files.
My first efforts are based on the sea ice concentration (variable = sic)
projected by the NCAR rcp8.5 through the end of this century.

Optimally we should be able to follow the eloquent code available in the
raster package to read in the files.
## Create a raster brick from the netCDF 
b<-brick(x='filesic_OImon_CCSM4_rcp85_r1i1p1_200601-210012.nc',
varname='sic') 
##
This quickly reads in the netCDF file, however, it fails to read in the true
geography.
Even as it reports the projection as geographic (+proj=longlat
+ellps=WGS84), a quick plot shows this to not be the case.
<http://r-sig-geo.2731867.n2.nabble.com/file/n7587261/image822.png> 

Rather than being geographic coordinates, the coordinate values index to the
netCDF "lon" and "lat" values.
I can turn to ncdf4 to read the netCDF so as to read in the longitude and
latitude values for each indexed cell.  
The following code does this and casts all the data along with the actual
coordinates into a data frame, but it runs very slow.
Could there be a better way within the context of the raster package?

############# ncdf4 code that works, but is very slow (~16 hours of
processing) ##########
nc<-nc_open(filename=x)
nc
## has dimension time, j (384) cell index along second dimension, and i
(320) cell index along first dimension
dataLon <- ncvar_get( nc, "lon" )	# get the longitude lookup values
dim(dataLon)
dataLat <- ncvar_get( nc, "lat" )	# get the latitude lookup values
dim(dataLat)

###  Using nested loops, walk through the data frame inserting the lat and
lon values from the netCDF file
for(x in min(SICdf$xIndex):max(SICdf$xIndex)){  ## step through the time
steps and fill in the data
	for(y in min(SICdf$yIndex):max(SICdf$yIndex)){
		cat(x, y, fill=T)
		SICdf[SICdf$xIndex==x & SICdf$yIndex==y,]$lat<-dataLat[x,y][1]
		SICdf[SICdf$xIndex==x & SICdf$yIndex==y,]$lon<-dataLon[x,y][1]
	}
}
################################################################



-----
Tony Fischbach, Wildlife Biologist
Walrus Research Program
Alaska Science Center
U.S. Geological Survey
4210 University Drive
Anchorage, AK 99508-4650

AFischbach at usgs.gov
http://alaska.usgs.gov/science/biology/walrus
--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/raster-working-with-netCDF-files-that-have-indexed-geography-tp7587261.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From mdsumner at gmail.com  Sat Oct 11 00:07:42 2014
From: mdsumner at gmail.com (Michael Sumner)
Date: Sat, 11 Oct 2014 09:07:42 +1100
Subject: [R-sig-Geo] raster working with netCDF files that have indexed
	geography
In-Reply-To: <1412976723290-7587261.post@n2.nabble.com>
References: <1412976723290-7587261.post@n2.nabble.com>
Message-ID: <CAAcGz99GfFswQ+ULWcTg9gAqH8cP_5x9tf8g_OGZtmyoe33DoQ@mail.gmail.com>

Hi Tony, could you give more details about how to find that specific
file from the site?

Cheers, Mike

On Sat, Oct 11, 2014 at 8:32 AM, Anthony Fischbach <afischbach at usgs.gov> wrote:
> In working with Global Circulation Model datasets from the Earth System Grid
> Federation (http://pcmdi9.llnl.gov/esgf-web-fe/), and am struggling to
> efficiently pull in the geography of the netCDF files.
> My first efforts are based on the sea ice concentration (variable = sic)
> projected by the NCAR rcp8.5 through the end of this century.
>
> Optimally we should be able to follow the eloquent code available in the
> raster package to read in the files.
> ## Create a raster brick from the netCDF
> b<-brick(x='filesic_OImon_CCSM4_rcp85_r1i1p1_200601-210012.nc',
> varname='sic')
> ##
> This quickly reads in the netCDF file, however, it fails to read in the true
> geography.
> Even as it reports the projection as geographic (+proj=longlat
> +ellps=WGS84), a quick plot shows this to not be the case.
> <http://r-sig-geo.2731867.n2.nabble.com/file/n7587261/image822.png>
>
> Rather than being geographic coordinates, the coordinate values index to the
> netCDF "lon" and "lat" values.
> I can turn to ncdf4 to read the netCDF so as to read in the longitude and
> latitude values for each indexed cell.
> The following code does this and casts all the data along with the actual
> coordinates into a data frame, but it runs very slow.
> Could there be a better way within the context of the raster package?
>
> ############# ncdf4 code that works, but is very slow (~16 hours of
> processing) ##########
> nc<-nc_open(filename=x)
> nc
> ## has dimension time, j (384) cell index along second dimension, and i
> (320) cell index along first dimension
> dataLon <- ncvar_get( nc, "lon" )       # get the longitude lookup values
> dim(dataLon)
> dataLat <- ncvar_get( nc, "lat" )       # get the latitude lookup values
> dim(dataLat)
>
> ###  Using nested loops, walk through the data frame inserting the lat and
> lon values from the netCDF file
> for(x in min(SICdf$xIndex):max(SICdf$xIndex)){  ## step through the time
> steps and fill in the data
>         for(y in min(SICdf$yIndex):max(SICdf$yIndex)){
>                 cat(x, y, fill=T)
>                 SICdf[SICdf$xIndex==x & SICdf$yIndex==y,]$lat<-dataLat[x,y][1]
>                 SICdf[SICdf$xIndex==x & SICdf$yIndex==y,]$lon<-dataLon[x,y][1]
>         }
> }
> ################################################################
>
>
>
> -----
> Tony Fischbach, Wildlife Biologist
> Walrus Research Program
> Alaska Science Center
> U.S. Geological Survey
> 4210 University Drive
> Anchorage, AK 99508-4650
>
> AFischbach at usgs.gov
> http://alaska.usgs.gov/science/biology/walrus
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/raster-working-with-netCDF-files-that-have-indexed-geography-tp7587261.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



-- 
Michael Sumner
Software and Database Engineer
Australian Antarctic Division
Hobart, Australia
e-mail: mdsumner at gmail.com


From tyler.j.frazier at icloud.com  Sat Oct 11 02:02:04 2014
From: tyler.j.frazier at icloud.com (Tyler Frazier)
Date: Sat, 11 Oct 2014 02:02:04 +0200
Subject: [R-sig-Geo] raster working with netCDF files that have indexed
 geography
In-Reply-To: <1412976723290-7587261.post@n2.nabble.com>
References: <1412976723290-7587261.post@n2.nabble.com>
Message-ID: <08DF9F8F-837F-4483-8E47-078EF2340829@icloud.com>

Hi Tony: Previously I used layer1 <- readGDAL(?*myfile.nc") then <- raster() and then <- stack(layer(length(1:n)) but then it turned out stack() should have worked just fine to being with and I had my syntax a bit off.  I?m not sure in your case, but crs(my_file) <- ?+proj?? could be of use.  Also, are you concatenating a bunch of files from ESGF after the wget?  Maybe something is going on with the original file.  16 hours seems like an awful long time to bring the file into R using ncdf4::  HTH , Tyler

On 10 Oct 2014, at 11:32 pm, Anthony Fischbach <afischbach at usgs.gov> wrote:

> In working with Global Circulation Model datasets from the Earth System Grid
> Federation (http://pcmdi9.llnl.gov/esgf-web-fe/), and am struggling to
> efficiently pull in the geography of the netCDF files.
> My first efforts are based on the sea ice concentration (variable = sic)
> projected by the NCAR rcp8.5 through the end of this century.
> 
> Optimally we should be able to follow the eloquent code available in the
> raster package to read in the files.
> ## Create a raster brick from the netCDF 
> b<-brick(x='filesic_OImon_CCSM4_rcp85_r1i1p1_200601-210012.nc',
> varname='sic') 
> ##
> This quickly reads in the netCDF file, however, it fails to read in the true
> geography.
> Even as it reports the projection as geographic (+proj=longlat
> +ellps=WGS84), a quick plot shows this to not be the case.
> <http://r-sig-geo.2731867.n2.nabble.com/file/n7587261/image822.png> 
> 
> Rather than being geographic coordinates, the coordinate values index to the
> netCDF "lon" and "lat" values.
> I can turn to ncdf4 to read the netCDF so as to read in the longitude and
> latitude values for each indexed cell.  
> The following code does this and casts all the data along with the actual
> coordinates into a data frame, but it runs very slow.
> Could there be a better way within the context of the raster package?
> 
> ############# ncdf4 code that works, but is very slow (~16 hours of
> processing) ##########
> nc<-nc_open(filename=x)
> nc
> ## has dimension time, j (384) cell index along second dimension, and i
> (320) cell index along first dimension
> dataLon <- ncvar_get( nc, "lon" )	# get the longitude lookup values
> dim(dataLon)
> dataLat <- ncvar_get( nc, "lat" )	# get the latitude lookup values
> dim(dataLat)
> 
> ###  Using nested loops, walk through the data frame inserting the lat and
> lon values from the netCDF file
> for(x in min(SICdf$xIndex):max(SICdf$xIndex)){  ## step through the time
> steps and fill in the data
> 	for(y in min(SICdf$yIndex):max(SICdf$yIndex)){
> 		cat(x, y, fill=T)
> 		SICdf[SICdf$xIndex==x & SICdf$yIndex==y,]$lat<-dataLat[x,y][1]
> 		SICdf[SICdf$xIndex==x & SICdf$yIndex==y,]$lon<-dataLon[x,y][1]
> 	}
> }
> ################################################################
> 
> 
> 
> -----
> Tony Fischbach, Wildlife Biologist
> Walrus Research Program
> Alaska Science Center
> U.S. Geological Survey
> 4210 University Drive
> Anchorage, AK 99508-4650
> 
> AFischbach at usgs.gov
> http://alaska.usgs.gov/science/biology/walrus
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/raster-working-with-netCDF-files-that-have-indexed-geography-tp7587261.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From darunabas at gmail.com  Sun Oct 12 00:46:04 2014
From: darunabas at gmail.com (Barnabas Daru)
Date: Sun, 12 Oct 2014 00:46:04 +0200
Subject: [R-sig-Geo] Automate the extraction of climate variable at
	different time depths from netcdf in r
In-Reply-To: <CANtt_hykKBtGFPvvuSJfku6hyW-YtNUhonKYSfo8OQXCR5fKow@mail.gmail.com>
References: <CA+R607EimFZvQXjmjp0B1KSQgmaXz6=n8zZsCJ+AS4Ccsix+_g@mail.gmail.com>
	<CANtt_hzyrcRhqgYtAnkwT+waY03vD6N5w2PKjjPyFsEpXwBWLQ@mail.gmail.com>
	<DBB31DC6-0AAE-4258-8E23-2B7B66650F76@gmail.com>
	<CANtt_hykKBtGFPvvuSJfku6hyW-YtNUhonKYSfo8OQXCR5fKow@mail.gmail.com>
Message-ID: <4904A8F5-9021-48F6-98E9-43CA10EF7FE0@gmail.com>

Hi Robert,
Thank you very much for the code. It works.
Thanks and kind regards
Barnabas Daru


  \-/
   /\
  /--|    
 /---/ Barnabas Daru
 |--/  PhD Candidate,
 \-/   African Centre for DNA Barcoding,
 /\    University of Johannesburg,
/--\   PO Box 524, Auckland Park, 2006,
|---\  Johannesburg, South Africa.
 \---\ Lab: +27 11 559 3477        
  \--| Mobile: +277 3818 9583
   \-/ Website: www.barnabasdaru.com
   /\        
  /--\ 
 
#?if you can think it, you can do it.
 




On Sep 11, 2014, at 6:47 PM, Robert J. Hijmans wrote:

> Barnabas,
> I doubt you will need to "delete one-by-one, the values for the years
> that I do not desire". There surely are basic R tricks for that.
> Perhaps the below example can get you there:
> 
> ## example data
> #raster
> b <- brick(system.file("external/rlogo.grd", package="raster"))
> # points
> set.seed(0)
> p <- xyFromCell(b, sample(ncell(b), 10))
> # "years"
> y <- cbind(y1=sample(0:1, 10, replace=TRUE), y2=sample(0:1, 10,
> replace=TRUE), y3=sample(0:1, 10, replace=TRUE))
> 
> 
> # extract all
> e <- extract(b, p)
> # combine data
> x <- data.frame(x=p[,1], y=p[,2], year=rep(1:3, each=nrow(p)),
> include=as.vector(y), value=as.vector(e))
> # select values you want
> x[x$include==1, ]
> 
> Whether the above works for you really depends on how you need to get
> the values for further processing.
> 
> Robert
> 
> 
> 
> On Sun, Sep 7, 2014 at 8:58 AM, Barnabas Daru <darunabas at gmail.com> wrote:
>> Hi Robert,
>> Thanks very much for your suggestion.
>> I tried the code you provided and it work! Many thanks.
>> However, it tends to extract the SST values for all the points and for time
>> periods including even the years that I don't desire. This means I will have
>> to delete one-by-one, the values for the years that I do not desire and keep
>> only the ones I want.
>> I thought there is a way I could simply ask R to print in one column, the
>> extracted values associated with only the years for which point data is
>> available.
>> Thanks and kind regards
>> Barnabas
>> 
>> 
>> 
>>  \-/
>>   /\
>>  /--|
>> /---/ Barnabas Daru
>> |--/  PhD Candidate,
>> \-/   African Centre for DNA Barcoding,
>> /\    University of Johannesburg,
>> /--\   PO Box 524, Auckland Park, 2006,
>> |---\  Johannesburg, South Africa.
>> \---\ Lab: +27 11 559 3477
>>  \--| Mobile: +277 3818 9583
>>   \-/ Website: www.barnabasdaru.com
>>   /\
>>  /--\
>> 
>> #?if you can think it, you can do it.
>> 
>> 
>> 
>> 
>> 
>> On Sep 7, 2014, at 5:23 AM, Robert J. Hijmans wrote:
>> 
>> Barnabas, ,
>> You can try something like this:
>> 
>> b <- brick("~sst.mnmean.nc", varname="sst")
>> # loop over species, or combine all species into one data.frame?
>> mydata <- read.csv("~Species one.csv")
>> extract.mydata <- extract(b, mydata[,5:6])
>> write.csv(extract.mydata, file = "Species_one_extracted.csv")
>> 
>> Robert
>> 
>> 


	[[alternative HTML version deleted]]


From arnold_salvacion at yahoo.com  Sun Oct 12 17:20:38 2014
From: arnold_salvacion at yahoo.com (Arnold Salvacion)
Date: Sun, 12 Oct 2014 23:20:38 +0800
Subject: [R-sig-Geo] Clustering Distance at Different Time
Message-ID: <1413127238.35641.YahooMailNeo@web192705.mail.sg3.yahoo.com>

Dear Colleagues,

Good day!

I would  very much appreciate if you could provide me an idea on how to implement the analysis I am thinking in R. My objective to determine the rate on how a plant disease progresses in time (e.g. t0 - t4) and space (e.g. 3m per week). I am thinking to use K-function to determine point pattern per time event and have started using spatstat Kest (initial diseased plants) and Kcross function (initial vs. succeeding disease plants). However, my problems are:

1. I do not know how to extract clustering distance (distance where the pattern is  clustered - assuming it is).
2. If the methodology I am thinking is valid.

Any help will is very much appreciated. 

Thanks in advance.

Arnold
	[[alternative HTML version deleted]]


From r.rhodes at pgr.reading.ac.uk  Mon Oct 13 12:54:12 2014
From: r.rhodes at pgr.reading.ac.uk (Ruari Rhodes)
Date: Mon, 13 Oct 2014 11:54:12 +0100
Subject: [R-sig-Geo] Shortest distance between points within a polygon
Message-ID: <543BAF54.9010507@pgr.reading.ac.uk>

Hi all,

I need to find the distance between two spatial points which lie within 
a polygon, via the shortest path which lies entirely within the polygon. 
Can anyone suggest a method? I need to find something which requires 
minimal computing resources.

I have some examples of the points and polygons here, both in lonlat format:
http://www.met.reading.ac.uk/~jb013101/files/R/datasets/poly.RData 
("poly", a SpatialPolygonsDataFrame)
http://www.met.reading.ac.uk/~jb013101/files/R/datasets/pts.RData 
("pts", a SpatialPoints object)

Many thanks for your help.

-- 
*Ruari Rhodes*
PhD Student
/European precipitation accumulation extremes/
Room 1U09 - Dept. of Meteorology
University of Reading,
Earley Gate, Reading, RG6 6BB
r.rhodes at pgr.reading.ac.uk
http://www.met.reading.ac.uk/~jb013101

	[[alternative HTML version deleted]]


From roman.lustrik at gmail.com  Mon Oct 13 13:12:59 2014
From: roman.lustrik at gmail.com (=?UTF-8?Q?Roman_Lu=C5=A1trik?=)
Date: Mon, 13 Oct 2014 13:12:59 +0200
Subject: [R-sig-Geo] Shortest distance between points within a polygon
In-Reply-To: <543BAF54.9010507@pgr.reading.ac.uk>
References: <543BAF54.9010507@pgr.reading.ac.uk>
Message-ID: <CAHT1vpgxiLHoNjRDadzqPf=nQou=qCkTpEpUtoaiGYEcXnb7KQ@mail.gmail.com>

One way would be to calculate the distance and see if the line connecting
the dots intersects with the polygon edge. `rgeos` package would be the
tool of trade for this.

Cheers,
Roman

On Mon, Oct 13, 2014 at 12:54 PM, Ruari Rhodes <r.rhodes at pgr.reading.ac.uk>
wrote:

> Hi all,
>
> I need to find the distance between two spatial points which lie within
> a polygon, via the shortest path which lies entirely within the polygon.
> Can anyone suggest a method? I need to find something which requires
> minimal computing resources.
>
> I have some examples of the points and polygons here, both in lonlat
> format:
> http://www.met.reading.ac.uk/~jb013101/files/R/datasets/poly.RData
> ("poly", a SpatialPolygonsDataFrame)
> http://www.met.reading.ac.uk/~jb013101/files/R/datasets/pts.RData
> ("pts", a SpatialPoints object)
>
> Many thanks for your help.
>
> --
> *Ruari Rhodes*
> PhD Student
> /European precipitation accumulation extremes/
> Room 1U09 - Dept. of Meteorology
> University of Reading,
> Earley Gate, Reading, RG6 6BB
> r.rhodes at pgr.reading.ac.uk
> http://www.met.reading.ac.uk/~jb013101
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



-- 
In God we trust, all others bring data.

	[[alternative HTML version deleted]]


From b.rowlingson at lancaster.ac.uk  Mon Oct 13 19:12:06 2014
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Mon, 13 Oct 2014 18:12:06 +0100
Subject: [R-sig-Geo] Shortest distance between points within a polygon
In-Reply-To: <33edb49d3781470d8ad7628abe19c960@EX-0-HT0.lancs.local>
References: <543BAF54.9010507@pgr.reading.ac.uk>
	<33edb49d3781470d8ad7628abe19c960@EX-0-HT0.lancs.local>
Message-ID: <CANVKczO-Z72JunZegveJdASqv4Ck7m4GCNQitHUzXx=-7RRi0w@mail.gmail.com>

On Mon, Oct 13, 2014 at 12:12 PM, Roman Lu?trik <roman.lustrik at gmail.com> wrote:
> One way would be to calculate the distance and see if the line connecting
> the dots intersects with the polygon edge. `rgeos` package would be the
> tool of trade for this.
>

 I can't see how that works...

 A solution would be to rasterise your polygon and use `gdistance` to
compute a cost-weighted minimum distance on the raster - you'd set the
cost on the transition surface outside your polygon to +Inf and inside
the polygon to +1, or maybe its zero cost inside the polygon and
anything finite outside.

The gdistance vignette has an example of travelling between places in
Europe where travel is restricted to the land mass only.

The precision of your raster will determine the precision of your
result, but finer rasters will take longer.

Barry


From dwkang1982 at gmail.com  Mon Oct 13 20:04:30 2014
From: dwkang1982 at gmail.com (Dongwoo Kang)
Date: Mon, 13 Oct 2014 11:04:30 -0700 (PDT)
Subject: [R-sig-Geo] Statistical inference about spatially varying
 coefficients of a mixed GWR model
Message-ID: <1413223470670-7587270.post@n2.nabble.com>

Dear R-sig-geo list,

Hi everyone, can I ask your help about statistical inference of a mixed GWR
model?
Thank you so much in advance.

I am working on my PhD dissertation and it is about the spatial
heterogeneity of regional knowledge producing based on the data of 3,109 US
counties.

My response variable is "the number of patents per capita" and I am
controlling 11 explanatory variables including constant term.

By using the Monte Carlo simulation function "montecarlo.gwr" in "GWmodel"
of R package, 
I identify 4 global variables and 7 spatially varying variables.

Following Mei, Wang, and Zhang (2006), I could calculate the p-values for 4
global variables by using a 
bootstrap method. In other words, I run an unrestricted MGWR as an
alternative hypothesis and compare its RSS with the RSS of restricted MGWR
for each global variables as an null hypothesis of beta=0.

But my question is how to calculate the p-values for each local estimates of
spatially varying coefficients.
In my case, I have 7 spatially varying variables and 3,109 observations,
thus I want to get the p-values of 21,763 local estimates.

In addition, when I run a basic GWR model by using "gwr.basic" function of
"GWmodel" package,
"gwr.t.adjust" function allows us to get adjusted p-values for each local
spatially varying coefficients by using Bonferroni type standard error
correction.

Ultimately, I want to calculate Bonferroni correction standard errors and
adjusted p-values for each spatially varying local coefficients in my mixed
GWR model.

If you have any idea about my questions, please help me.

Thank you!

With best regards,
Dongwoo Kang


References
Mei, C. L., N. Wang and W. X. Zhang (2006). "Testing the importance of the
explanatory variables in a mixed geographically weighted regression model."
Environment and Planning A 38(3): 587-598.





--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Statistical-inference-about-spatially-varying-coefficients-of-a-mixed-GWR-model-tp7587270.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From roman.lustrik at gmail.com  Mon Oct 13 20:13:56 2014
From: roman.lustrik at gmail.com (=?UTF-8?Q?Roman_Lu=C5=A1trik?=)
Date: Mon, 13 Oct 2014 20:13:56 +0200
Subject: [R-sig-Geo] Shortest distance between points within a polygon
In-Reply-To: <CANVKczO-Z72JunZegveJdASqv4Ck7m4GCNQitHUzXx=-7RRi0w@mail.gmail.com>
References: <543BAF54.9010507@pgr.reading.ac.uk>
	<33edb49d3781470d8ad7628abe19c960@EX-0-HT0.lancs.local>
	<CANVKczO-Z72JunZegveJdASqv4Ck7m4GCNQitHUzXx=-7RRi0w@mail.gmail.com>
Message-ID: <CAHT1vpjr1bke_ZX5-DKq4VqCkXO_e+QA4z6w2JzJNCDyVXCQ_Q@mail.gmail.com>

I was thinking along the lines of this example from `gCrosses`. If
line crosses the shape, it returns TRUE. If not, you've got your
distance. I can't speak for the performance part, you better do some
field testing.

require(rgeos)

l1 = readWKT("LINESTRING(0 3,1 1,2 2,3 0)")
l2 = readWKT("LINESTRING(0 0.5,1 1,2 2,3 2.5)")
l3 = readWKT("LINESTRING(1 3,1.5 1,2.5 2)")

pt1 = readWKT("MULTIPOINT(1 1,3 0)")
pt2 = readWKT("MULTIPOINT(1 1,3 0,1 2)")

p1 = readWKT("POLYGON((0 0,0 2,1 3.5,3 3,4 1,3 0,0 0))")
p2 = readWKT("POLYGON((2 2,3 4,4 1,4 0,2 2))")


plot(p1,border='blue',col='blue');plot(l1,add=TRUE)
title(paste("Crosses:",gCrosses(p1,l1),
            "\nOverlaps:",gOverlaps(p1,l1)))

Cheers,
Roman


On Mon, Oct 13, 2014 at 7:12 PM, Barry Rowlingson
<b.rowlingson at lancaster.ac.uk> wrote:
> On Mon, Oct 13, 2014 at 12:12 PM, Roman Lu?trik <roman.lustrik at gmail.com> wrote:
>> One way would be to calculate the distance and see if the line connecting
>> the dots intersects with the polygon edge. `rgeos` package would be the
>> tool of trade for this.
>>
>
>  I can't see how that works...
>
>  A solution would be to rasterise your polygon and use `gdistance` to
> compute a cost-weighted minimum distance on the raster - you'd set the
> cost on the transition surface outside your polygon to +Inf and inside
> the polygon to +1, or maybe its zero cost inside the polygon and
> anything finite outside.
>
> The gdistance vignette has an example of travelling between places in
> Europe where travel is restricted to the land mass only.
>
> The precision of your raster will determine the precision of your
> result, but finer rasters will take longer.
>
> Barry



-- 
In God we trust, all others bring data.


From r.hijmans at gmail.com  Mon Oct 13 20:31:36 2014
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Mon, 13 Oct 2014 11:31:36 -0700
Subject: [R-sig-Geo] Shortest distance between points within a polygon
In-Reply-To: <CAHT1vpjr1bke_ZX5-DKq4VqCkXO_e+QA4z6w2JzJNCDyVXCQ_Q@mail.gmail.com>
References: <543BAF54.9010507@pgr.reading.ac.uk>
	<33edb49d3781470d8ad7628abe19c960@EX-0-HT0.lancs.local>
	<CANVKczO-Z72JunZegveJdASqv4Ck7m4GCNQitHUzXx=-7RRi0w@mail.gmail.com>
	<CAHT1vpjr1bke_ZX5-DKq4VqCkXO_e+QA4z6w2JzJNCDyVXCQ_Q@mail.gmail.com>
Message-ID: <CANtt_hwAPtGNuYbQAenjQUTw8oRcmitjTVXvuRKhAxJGPhvong@mail.gmail.com>

Ruari, You might be able to use gCrosses together with optim or
another optimization function to find the best route. Below is a very
simple example. For more complex polygons you may need to allow for
several intermediate points (perhaps following the polygon boundary at
times). Unless you want to spend a lot of time on this, gDistance is
probably the safer way to go.  Robert


library(raster)
library(rgeos)

opfun <- function(p) {
if (p[1] < xmin(e) | p[1] > xmax(e) | p[2] < ymin(e) | p[2] > ymax(e)) {
return(Inf)
}
via <- cbind(p[1], p[2])
line <- SpatialLines(list(Lines(list(Line(rbind(from, via, to))), "1")))
if (gCrosses(line, pol)) {
return(Inf)
}
d1 <- pointDistance(from, via, lonlat=TRUE)
d2 <- pointDistance(via, to, lonlat=TRUE)
d1 + d2
}


pol <- matrix(c(-79.49102, 11.152694, -60.77844, 50.074852, -33.08383,
5.913173, 43.26348, 2.919161, -27.84431, -29.266470, -48.80240,
-68.188628, -73.50300, -32.260482, -108.68264, -42.739525, -84.73054,
-14.296409, -110.17965, 26.122755, -79.49102, 11.152694), ncol=2,
byrow=TRUE)
pol <- Polygons(list(Polygon(pol)), 1)
pol <- SpatialPolygons( list( pol) )
e <- extent(pol)
from <- c(-95, 11)
to <- c(-59, 40)

op <- optim(as.vector(coordinates(gCentroid(pol))), fun)

via <- rbind(op$par)
opline <- SpatialLines(list(Lines(list(Line(rbind(from, via, to))), "1")))

plot(pol, border='red')
x <- rbind(from, via, to)
points(x, pch=20)
lines(x, col='blue', lwd=2)

distance <- op$value
distance


On Mon, Oct 13, 2014 at 11:13 AM, Roman Lu?trik <roman.lustrik at gmail.com> wrote:
> I was thinking along the lines of this example from `gCrosses`. If
> line crosses the shape, it returns TRUE. If not, you've got your
> distance. I can't speak for the performance part, you better do some
> field testing.
>
> require(rgeos)
>
> l1 = readWKT("LINESTRING(0 3,1 1,2 2,3 0)")
> l2 = readWKT("LINESTRING(0 0.5,1 1,2 2,3 2.5)")
> l3 = readWKT("LINESTRING(1 3,1.5 1,2.5 2)")
>
> pt1 = readWKT("MULTIPOINT(1 1,3 0)")
> pt2 = readWKT("MULTIPOINT(1 1,3 0,1 2)")
>
> p1 = readWKT("POLYGON((0 0,0 2,1 3.5,3 3,4 1,3 0,0 0))")
> p2 = readWKT("POLYGON((2 2,3 4,4 1,4 0,2 2))")
>
>
> plot(p1,border='blue',col='blue');plot(l1,add=TRUE)
> title(paste("Crosses:",gCrosses(p1,l1),
>             "\nOverlaps:",gOverlaps(p1,l1)))
>
> Cheers,
> Roman
>
>
> On Mon, Oct 13, 2014 at 7:12 PM, Barry Rowlingson
> <b.rowlingson at lancaster.ac.uk> wrote:
>> On Mon, Oct 13, 2014 at 12:12 PM, Roman Lu?trik <roman.lustrik at gmail.com> wrote:
>>> One way would be to calculate the distance and see if the line connecting
>>> the dots intersects with the polygon edge. `rgeos` package would be the
>>> tool of trade for this.
>>>
>>
>>  I can't see how that works...
>>
>>  A solution would be to rasterise your polygon and use `gdistance` to
>> compute a cost-weighted minimum distance on the raster - you'd set the
>> cost on the transition surface outside your polygon to +Inf and inside
>> the polygon to +1, or maybe its zero cost inside the polygon and
>> anything finite outside.
>>
>> The gdistance vignette has an example of travelling between places in
>> Europe where travel is restricted to the land mass only.
>>
>> The precision of your raster will determine the precision of your
>> result, but finer rasters will take longer.
>>
>> Barry
>
>
>
> --
> In God we trust, all others bring data.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From zoeeeregister at gmail.com  Tue Oct 14 00:00:29 2014
From: zoeeeregister at gmail.com (Chane)
Date: Mon, 13 Oct 2014 17:00:29 -0500
Subject: [R-sig-Geo] convert multiple dimension array to raster
	object/.png/.tif
Message-ID: <CAPAa6LWzho+t5nFFUnH=+RFnMSuVVBGd1A6CiTDy9K4g2_O8yQ@mail.gmail.com>

Dear list,

I have a multiple dimension array (9 x 9 x 7) and I would like to convert
it to a raster object. I want the dim of the raster object to be the same
as the dim of the array; the values in each pixel in the raster object to
be the same value as they are in the array. It seems that as.raster()
function could only convert array with dim of d x d x 3(or4) but can not
deal with array with dim of d x d x n. Eventually, I would like to export
this array/raster as a image file (.png or .tif) - with no geographic
information attached. Any help would be greatly appreciated.

Here is what my array looks like:

> formated_array
, , 1

      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9]
 [1,]  285  269  326  390  386  301  327  457  559
 [2,]  714  891  927  890  884  894  809  703  666
 [3,]  526  289  236  425  430  511  554  611  621
 [4,]  436  345  530  718  757  729  709  673  703
 [5,]  774  717  505  261  147  153  667  816  783
 [6,]  816  778  882  794  439  356  401  358  372
 [7,]  428  376  388  483  486  326  166  151  216
 [8,]  886  950 1009  945  876  830  773  596  321
 [9,]  225  266  270  242  252  276  284  344  304

, , 2

      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9]
 [1,]  285  269  326  390  386  301  327  457  559
 [2,]  714  891  927  890  884  894  809  703  666
 [3,]  526  289  236  425  430  511  554  611  621
 [4,]  436  345  530  718  757  729  709  673  703
 [5,]  774  717  505  261  147  153  667  816  783
 [6,]  816  778  882  794  439  356  401  358  372
 [7,]  428  376  388  483  486  326  166  151  216
 [8,]  886  950 1009  945  876  830  773  596  321
 [9,]  225  266  270  242  252  276  284  344  304

, , 3

      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9]
 [1,]  285  269  326  390  386  301  327  457  559
 [2,]  714  891  927  890  884  894  809  703  666
 [3,]  526  289  236  425  430  511  554  611  621
 [4,]  436  345  530  718  757  729  709  673  703
 [5,]  774  717  505  261  147  153  667  816  783
 [6,]  816  778  882  794  439  356  401  358  372
 [7,]  428  376  388  483  486  326  166  151  216
 [8,]  886  950 1009  945  876  830  773  596  321
 [9,]  225  266  270  242  252  276  284  344  304

, , 4

      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9]
 [1,]  285  269  326  390  386  301  327  457  559
 [2,]  714  891  927  890  884  894  809  703  666
 [3,]  526  289  236  425  430  511  554  611  621
 [4,]  436  345  530  718  757  729  709  673  703
 [5,]  774  717  505  261  147  153  667  816  783
 [6,]  816  778  882  794  439  356  401  358  372
 [7,]  428  376  388  483  486  326  166  151  216
 [8,]  886  950 1009  945  876  830  773  596  321
 [9,]  225  266  270  242  252  276  284  344  304

, , 5

      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9]
 [1,]  285  269  326  390  386  301  327  457  559
 [2,]  714  891  927  890  884  894  809  703  666
 [3,]  526  289  236  425  430  511  554  611  621
 [4,]  436  345  530  718  757  729  709  673  703
 [5,]  774  717  505  261  147  153  667  816  783
 [6,]  816  778  882  794  439  356  401  358  372
 [7,]  428  376  388  483  486  326  166  151  216
 [8,]  886  950 1009  945  876  830  773  596  321
 [9,]  225  266  270  242  252  276  284  344  304

, , 6

      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9]
 [1,]  285  269  326  390  386  301  327  457  559
 [2,]  714  891  927  890  884  894  809  703  666
 [3,]  526  289  236  425  430  511  554  611  621
 [4,]  436  345  530  718  757  729  709  673  703
 [5,]  774  717  505  261  147  153  667  816  783
 [6,]  816  778  882  794  439  356  401  358  372
 [7,]  428  376  388  483  486  326  166  151  216
 [8,]  886  950 1009  945  876  830  773  596  321
 [9,]  225  266  270  242  252  276  284  344  304

, , 7

      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9]
 [1,]  285  269  326  390  386  301  327  457  559
 [2,]  714  891  927  890  884  894  809  703  666
 [3,]  526  289  236  425  430  511  554  611  621
 [4,]  436  345  530  718  757  729  709  673  703
 [5,]  774  717  505  261  147  153  667  816  783
 [6,]  816  778  882  794  439  356  401  358  372
 [7,]  428  376  388  483  486  326  166  151  216
 [8,]  886  950 1009  945  876  830  773  596  321
 [9,]  225  266  270  242  252  276  284  344  304


Thanks,
Chane

	[[alternative HTML version deleted]]


From r.hijmans at gmail.com  Tue Oct 14 00:35:39 2014
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Mon, 13 Oct 2014 15:35:39 -0700
Subject: [R-sig-Geo] convert multiple dimension array to raster
	object/.png/.tif
In-Reply-To: <CAPAa6LWzho+t5nFFUnH=+RFnMSuVVBGd1A6CiTDy9K4g2_O8yQ@mail.gmail.com>
References: <CAPAa6LWzho+t5nFFUnH=+RFnMSuVVBGd1A6CiTDy9K4g2_O8yQ@mail.gmail.com>
Message-ID: <CANtt_hwgbp=FEb5fERoCZg6mL+p1CONSFcUBx4+8Gt+yome_0Q@mail.gmail.com>

Chane,
You can use   b <- brick(array)

# for example
library(raster)
r <- raster(ncol=3, nrow=3)
r[] <- 1:ncell(r)
s <- stack(r,r*2,r*3)
a <- as.array(s)
brick(a)


Robert

On Mon, Oct 13, 2014 at 3:00 PM, Chane <zoeeeregister at gmail.com> wrote:
> Dear list,
>
> I have a multiple dimension array (9 x 9 x 7) and I would like to convert
> it to a raster object. I want the dim of the raster object to be the same
> as the dim of the array; the values in each pixel in the raster object to
> be the same value as they are in the array. It seems that as.raster()
> function could only convert array with dim of d x d x 3(or4) but can not
> deal with array with dim of d x d x n. Eventually, I would like to export
> this array/raster as a image file (.png or .tif) - with no geographic
> information attached. Any help would be greatly appreciated.
>
> Here is what my array looks like:
>
>> formated_array
> , , 1
>
>       [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9]
>  [1,]  285  269  326  390  386  301  327  457  559
>  [2,]  714  891  927  890  884  894  809  703  666
>  [3,]  526  289  236  425  430  511  554  611  621
>  [4,]  436  345  530  718  757  729  709  673  703
>  [5,]  774  717  505  261  147  153  667  816  783
>  [6,]  816  778  882  794  439  356  401  358  372
>  [7,]  428  376  388  483  486  326  166  151  216
>  [8,]  886  950 1009  945  876  830  773  596  321
>  [9,]  225  266  270  242  252  276  284  344  304
>
> , , 2
>
>       [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9]
>  [1,]  285  269  326  390  386  301  327  457  559
>  [2,]  714  891  927  890  884  894  809  703  666
>  [3,]  526  289  236  425  430  511  554  611  621
>  [4,]  436  345  530  718  757  729  709  673  703
>  [5,]  774  717  505  261  147  153  667  816  783
>  [6,]  816  778  882  794  439  356  401  358  372
>  [7,]  428  376  388  483  486  326  166  151  216
>  [8,]  886  950 1009  945  876  830  773  596  321
>  [9,]  225  266  270  242  252  276  284  344  304
>
> , , 3
>
>       [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9]
>  [1,]  285  269  326  390  386  301  327  457  559
>  [2,]  714  891  927  890  884  894  809  703  666
>  [3,]  526  289  236  425  430  511  554  611  621
>  [4,]  436  345  530  718  757  729  709  673  703
>  [5,]  774  717  505  261  147  153  667  816  783
>  [6,]  816  778  882  794  439  356  401  358  372
>  [7,]  428  376  388  483  486  326  166  151  216
>  [8,]  886  950 1009  945  876  830  773  596  321
>  [9,]  225  266  270  242  252  276  284  344  304
>
> , , 4
>
>       [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9]
>  [1,]  285  269  326  390  386  301  327  457  559
>  [2,]  714  891  927  890  884  894  809  703  666
>  [3,]  526  289  236  425  430  511  554  611  621
>  [4,]  436  345  530  718  757  729  709  673  703
>  [5,]  774  717  505  261  147  153  667  816  783
>  [6,]  816  778  882  794  439  356  401  358  372
>  [7,]  428  376  388  483  486  326  166  151  216
>  [8,]  886  950 1009  945  876  830  773  596  321
>  [9,]  225  266  270  242  252  276  284  344  304
>
> , , 5
>
>       [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9]
>  [1,]  285  269  326  390  386  301  327  457  559
>  [2,]  714  891  927  890  884  894  809  703  666
>  [3,]  526  289  236  425  430  511  554  611  621
>  [4,]  436  345  530  718  757  729  709  673  703
>  [5,]  774  717  505  261  147  153  667  816  783
>  [6,]  816  778  882  794  439  356  401  358  372
>  [7,]  428  376  388  483  486  326  166  151  216
>  [8,]  886  950 1009  945  876  830  773  596  321
>  [9,]  225  266  270  242  252  276  284  344  304
>
> , , 6
>
>       [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9]
>  [1,]  285  269  326  390  386  301  327  457  559
>  [2,]  714  891  927  890  884  894  809  703  666
>  [3,]  526  289  236  425  430  511  554  611  621
>  [4,]  436  345  530  718  757  729  709  673  703
>  [5,]  774  717  505  261  147  153  667  816  783
>  [6,]  816  778  882  794  439  356  401  358  372
>  [7,]  428  376  388  483  486  326  166  151  216
>  [8,]  886  950 1009  945  876  830  773  596  321
>  [9,]  225  266  270  242  252  276  284  344  304
>
> , , 7
>
>       [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9]
>  [1,]  285  269  326  390  386  301  327  457  559
>  [2,]  714  891  927  890  884  894  809  703  666
>  [3,]  526  289  236  425  430  511  554  611  621
>  [4,]  436  345  530  718  757  729  709  673  703
>  [5,]  774  717  505  261  147  153  667  816  783
>  [6,]  816  778  882  794  439  356  401  358  372
>  [7,]  428  376  388  483  486  326  166  151  216
>  [8,]  886  950 1009  945  876  830  773  596  321
>  [9,]  225  266  270  242  252  276  284  344  304
>
>
> Thanks,
> Chane
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From vitale232 at gmail.com  Tue Oct 14 01:23:34 2014
From: vitale232 at gmail.com (Andrew Vitale)
Date: Mon, 13 Oct 2014 16:23:34 -0700
Subject: [R-sig-Geo] spacetime EOF error "variable names are limited to
	10000 bytes"
Message-ID: <CAFTcopeGkXSY-jor+EsuL6y8iQ_vX6HO+zPQQpXsjG3ebCLdfQ@mail.gmail.com>

Hello,

I have a raster brick of sea level pressure anomalies that I would like to
analyze using empirical orthogonal functions.  Each layer of the brick
represents a daily observation, with a total of 20,718 days worth of
observations (nlayer=20,718).

I can easily coerce the raster brick to a spacetime STFDF object.  However,
when I try to run the spacetime:::EOF function, I get the following error:
"Error in eval(as.call(c(expression(data.frame), x, check.names =
!optional,  :
   variable names are limited to 10000 bytes"

It seems that the error originates from the third line of the EOF code,
where the STFDF is coerced to an xts object.

Does anyone know of a workaround for this error, or is this merely a
limitation of R?

Here's a code that mimics my issue and my sessionInfo():

library(raster)
library(spacetime)

## Create a raster object that mimics my data
## I actually have 20,708 layers in the raster stack
a = array(rnorm(9*9*10000), c(9,9,10000))
b = brick(a)
b = setValues(b, a)
z = seq(as.Date('1980-01-01'), as.Date('2007-05-18'),
        by = 'day')
b = setZ(b, z)

## coerce the raster stack to an STFDF object
stfdf = as(b, 'STFDF')

## attempt to compute EOFs
eof_time = EOF(stfdf, 'temporal')
eof_space = EOF(stfdf, 'space')

#### restultant error:
# Error in eval(as.call(c(expression(data.frame), x, check.names =
!optional,  :
#   variable names are limited to 10000 bytes

# > sessionInfo()
# R version 3.1.1 (2014-07-10)
# Platform: x86_64-pc-linux-gnu (64-bit)

# locale:
#  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
#  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
#  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
#  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C
#  [9] LC_ADDRESS=C               LC_TELEPHONE=C
# [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C

# attached base packages:
# [1] grid      stats     graphics  grDevices utils     datasets  methods
# [8] base

# other attached packages:
# [1] spacetime_1.1-0 ncdf4_1.13      fields_7.1      maps_2.3-7
# [5] spam_1.0-1      rgdal_0.8-16    raster_2.2-31   sp_1.0-15

# loaded via a namespace (and not attached):
# [1] intervals_0.14.0 lattice_0.20-29  rgeos_0.3-4      tcltk_3.1.1
# [5] tools_3.1.1      xts_0.9-7        zoo_1.7-11




Thanks,
Andrew
-- 
*Andrew P. Vitale*
Masters Student
Department of Geography
University of Nevada, Reno
vitale232 at gmail.com

	[[alternative HTML version deleted]]


From frtog at vestas.com  Tue Oct 14 08:00:44 2014
From: frtog at vestas.com (=?iso-8859-1?Q?Frede_Aakmann_T=F8gersen?=)
Date: Tue, 14 Oct 2014 08:00:44 +0200
Subject: [R-sig-Geo] spacetime EOF error "variable names are limited
	to	10000 bytes"
In-Reply-To: <CAFTcopeGkXSY-jor+EsuL6y8iQ_vX6HO+zPQQpXsjG3ebCLdfQ@mail.gmail.com>
References: <CAFTcopeGkXSY-jor+EsuL6y8iQ_vX6HO+zPQQpXsjG3ebCLdfQ@mail.gmail.com>
Message-ID: <B078CDF40DFE4045AF172A8B4F68FC4857C8AEB134@DKRDSEXC016.vestas.net>

Hi Andrew

Try this

> nchar(names(stfdf at data))
[1] 108893
>

Really long name. Here is a snipped version.

> names(stfdf at data)
[1] "layer.1.layer.2.layer.3.layer.4.layer.5.layer.6.layer.7.layer.8.layer.9.layer.10.layer.11.layer.12.layer.13.layer.14.layer.15.layer.16.layer.17.layer.18.layer.19.layer.20.layer.21.layer.22.layer.23.layer.24.layer.25.layer.26.layer.27.layer.28.layer.29.layer.30.layer.31.layer.32.layer.33.layer.34.layer.35.layer.36.layer.37.layer.38.layer.39.layer.40.layer.41.layer.42.layer.43.layer.44.layer.45.layer.46.layer.47.layer.48.layer.49.layer.50.layer.51.layer.52.layer.53.layer.54.layer.55.layer.56.layer.57.layer.58.layer.59.layer.60.layer.61.layer.62.layer.63.layer.64.layer.65.layer.66.layer.67.layer.68.layer.69.layer.70.layer.71.layer.72.layer.73.layer.74.layer.75.layer.76.layer.77.layer.78.layer.79.layer.80.layer.81.layer.82.layer.83.layer.84.layer.85.layer.86.layer.87.layer.88.layer.89.layer.90.layer.91.layer.92.layer.93.layer.94.layer.95.layer.96.layer.97.layer.98.layer.99.layer.100.layer.101.layer.102.layer.103.layer.104.layer.105.layer.106.layer.107.layer.108.layer.109.layer.110.layer.111.layer.112.layer.113.layer.114.layer.115.layer.116.layer.117.layer.118.layer.119.layer.120.layer.121.layer.122.layer.123.layer.124.layer.125.layer.126.layer.127.layer.128.layer.129.layer.130.layer.131.layer.132.layer.133.layer.134.layer.135.layer.136.layer.137.layer.138.layer.139.layer.140.lay
 < SNIP> 946.layer.9947.layer.9948.layer.9949.layer.9950.layer.9951.layer.9952.layer.9953.layer.9954.layer.9955.layer.9956.layer.9957.layer.9958.layer.9959.layer.9960.layer.9961.layer.9962.layer.9963.layer.9964.layer.9965.layer.9966.layer.9967.layer.9968.layer.9969.layer.9970.layer.9971.layer.9972.layer.9973.layer.9974.layer.9975.layer.9976.layer.9977.layer.9978.layer.9979.layer.9980.layer.9981.layer.9982.layer.9983.layer.9984.layer.9985.layer.9986.layer.9987.layer.9988.layer.9989.layer.9990.layer.9991.layer.9992.layer.9993.layer.9994.layer.9995.layer.9996.layer.9997.layer.9998.layer.9999.layer.10000"
>

If you do this:

names(stfdf at data) <- "all_layers"

EOF() will work.


Yours sincerely / Med venlig hilsen


Frede Aakmann T?gersen
Specialist, M.Sc., Ph.D.
Plant Performance & Modeling

Technology & Service Solutions
T +45 9730 5135
M +45 2547 6050
frtog at vestas.com
http://www.vestas.com

Company reg. name: Vestas Wind Systems A/S
This e-mail is subject to our e-mail disclaimer statement.
Please refer to www.vestas.com/legal/notice
If you have received this e-mail in error please contact the sender. 

> -----Original Message-----
> From: r-sig-geo-bounces at r-project.org [mailto:r-sig-geo-bounces at r-
> project.org] On Behalf Of Andrew Vitale
> Sent: 14. oktober 2014 01:24
> To: r-sig-geo
> Subject: [R-sig-Geo] spacetime EOF error "variable names are limited to
> 10000 bytes"
> 
> Hello,
> 
> I have a raster brick of sea level pressure anomalies that I would like to
> analyze using empirical orthogonal functions.  Each layer of the brick
> represents a daily observation, with a total of 20,718 days worth of
> observations (nlayer=20,718).
> 
> I can easily coerce the raster brick to a spacetime STFDF object.  However,
> when I try to run the spacetime:::EOF function, I get the following error:
> "Error in eval(as.call(c(expression(data.frame), x, check.names =
> !optional,  :
>    variable names are limited to 10000 bytes"
> 
> It seems that the error originates from the third line of the EOF code,
> where the STFDF is coerced to an xts object.
> 
> Does anyone know of a workaround for this error, or is this merely a
> limitation of R?
> 
> Here's a code that mimics my issue and my sessionInfo():
> 
> library(raster)
> library(spacetime)
> 
> ## Create a raster object that mimics my data
> ## I actually have 20,708 layers in the raster stack
> a = array(rnorm(9*9*10000), c(9,9,10000))
> b = brick(a)
> b = setValues(b, a)
> z = seq(as.Date('1980-01-01'), as.Date('2007-05-18'),
>         by = 'day')
> b = setZ(b, z)
> 
> ## coerce the raster stack to an STFDF object
> stfdf = as(b, 'STFDF')
> 
> ## attempt to compute EOFs
> eof_time = EOF(stfdf, 'temporal')
> eof_space = EOF(stfdf, 'space')
> 
> #### restultant error:
> # Error in eval(as.call(c(expression(data.frame), x, check.names =
> !optional,  :
> #   variable names are limited to 10000 bytes
> 
> # > sessionInfo()
> # R version 3.1.1 (2014-07-10)
> # Platform: x86_64-pc-linux-gnu (64-bit)
> 
> # locale:
> #  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
> #  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
> #  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
> #  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C
> #  [9] LC_ADDRESS=C               LC_TELEPHONE=C
> # [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C
> 
> # attached base packages:
> # [1] grid      stats     graphics  grDevices utils     datasets  methods
> # [8] base
> 
> # other attached packages:
> # [1] spacetime_1.1-0 ncdf4_1.13      fields_7.1      maps_2.3-7
> # [5] spam_1.0-1      rgdal_0.8-16    raster_2.2-31   sp_1.0-15
> 
> # loaded via a namespace (and not attached):
> # [1] intervals_0.14.0 lattice_0.20-29  rgeos_0.3-4      tcltk_3.1.1
> # [5] tools_3.1.1      xts_0.9-7        zoo_1.7-11
> 
> 
> 
> 
> Thanks,
> Andrew
> --
> *Andrew P. Vitale*
> Masters Student
> Department of Geography
> University of Nevada, Reno
> vitale232 at gmail.com
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From edzer.pebesma at uni-muenster.de  Tue Oct 14 09:27:00 2014
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Tue, 14 Oct 2014 09:27:00 +0200
Subject: [R-sig-Geo] spacetime EOF error "variable names are limited to
 10000 bytes"
In-Reply-To: <B078CDF40DFE4045AF172A8B4F68FC4857C8AEB134@DKRDSEXC016.vestas.net>
References: <CAFTcopeGkXSY-jor+EsuL6y8iQ_vX6HO+zPQQpXsjG3ebCLdfQ@mail.gmail.com>
	<B078CDF40DFE4045AF172A8B4F68FC4857C8AEB134@DKRDSEXC016.vestas.net>
Message-ID: <543CD044.5080205@uni-muenster.de>

Thanks for the clear example & diagnostic.

I committed a patch (github) that now uses the first name only to
address all layers (i.e.: "layer.1"). I'm all ears for a better suggestion!

On 10/14/2014 08:00 AM, Frede Aakmann T?gersen wrote:
> Hi Andrew
> 
> Try this
> 
>> nchar(names(stfdf at data))
> [1] 108893
>>
> 
> Really long name. Here is a snipped version.
> 
>> names(stfdf at data)
> [1] "layer.1.layer.2.layer.3.layer.4.layer.5.layer.6.layer.7.layer.8.layer.9.layer.10.layer.11.layer.12.layer.13.layer.14.layer.15.layer.16.layer.17.layer.18.layer.19.layer.20.layer.21.layer.22.layer.23.layer.24.layer.25.layer.26.layer.27.layer.28.layer.29.layer.30.layer.31.layer.32.layer.33.layer.34.layer.35.layer.36.layer.37.layer.38.layer.39.layer.40.layer.41.layer.42.layer.43.layer.44.layer.45.layer.46.layer.47.layer.48.layer.49.layer.50.layer.51.layer.52.layer.53.layer.54.layer.55.layer.56.layer.57.layer.58.layer.59.layer.60.layer.61.layer.62.layer.63.layer.64.layer.65.layer.66.layer.67.layer.68.layer.69.layer.70.layer.71.layer.72.layer.73.layer.74.layer.75.layer.76.layer.77.layer.78.layer.79.layer.80.layer.81.layer.82.layer.83.layer.84.layer.85.layer.86.layer.87.layer.88.layer.89.layer.90.layer.91.layer.92.layer.93.layer.94.layer.95.layer.96.layer.97.layer.98.layer.99.layer.100.layer.101.layer.102.layer.103.layer.104.layer.105.layer.106.layer.107.layer.108.layer.109.layer.110.
layer.111.layer.112.layer.113.layer.114.layer.115.layer.116.layer.117.layer.118.layer.119.layer.120.layer.121.layer.122.layer.123.layer.124.layer.125.layer.126.layer.127.layer.128.layer.129.layer.130.layer.131.layer.132.layer.133.layer.134.layer.135.layer.136.layer.137.layer.138.layer.139.layer.140.lay
>  < SNIP> 946.layer.9947.layer.9948.layer.9949.layer.9950.layer.9951.layer.9952.layer.9953.layer.9954.layer.9955.layer.9956.layer.9957.layer.9958.layer.9959.layer.9960.layer.9961.layer.9962.layer.9963.layer.9964.layer.9965.layer.9966.layer.9967.layer.9968.layer.9969.layer.9970.layer.9971.layer.9972.layer.9973.layer.9974.layer.9975.layer.9976.layer.9977.layer.9978.layer.9979.layer.9980.layer.9981.layer.9982.layer.9983.layer.9984.layer.9985.layer.9986.layer.9987.layer.9988.layer.9989.layer.9990.layer.9991.layer.9992.layer.9993.layer.9994.layer.9995.layer.9996.layer.9997.layer.9998.layer.9999.layer.10000"
>>
> 
> If you do this:
> 
> names(stfdf at data) <- "all_layers"
> 
> EOF() will work.
> 
> 
> Yours sincerely / Med venlig hilsen
> 
> 
> Frede Aakmann T?gersen
> Specialist, M.Sc., Ph.D.
> Plant Performance & Modeling
> 
> Technology & Service Solutions
> T +45 9730 5135
> M +45 2547 6050
> frtog at vestas.com
> http://www.vestas.com
> 
> Company reg. name: Vestas Wind Systems A/S
> This e-mail is subject to our e-mail disclaimer statement.
> Please refer to www.vestas.com/legal/notice
> If you have received this e-mail in error please contact the sender. 
> 
>> -----Original Message-----
>> From: r-sig-geo-bounces at r-project.org [mailto:r-sig-geo-bounces at r-
>> project.org] On Behalf Of Andrew Vitale
>> Sent: 14. oktober 2014 01:24
>> To: r-sig-geo
>> Subject: [R-sig-Geo] spacetime EOF error "variable names are limited to
>> 10000 bytes"
>>
>> Hello,
>>
>> I have a raster brick of sea level pressure anomalies that I would like to
>> analyze using empirical orthogonal functions.  Each layer of the brick
>> represents a daily observation, with a total of 20,718 days worth of
>> observations (nlayer=20,718).
>>
>> I can easily coerce the raster brick to a spacetime STFDF object.  However,
>> when I try to run the spacetime:::EOF function, I get the following error:
>> "Error in eval(as.call(c(expression(data.frame), x, check.names =
>> !optional,  :
>>    variable names are limited to 10000 bytes"
>>
>> It seems that the error originates from the third line of the EOF code,
>> where the STFDF is coerced to an xts object.
>>
>> Does anyone know of a workaround for this error, or is this merely a
>> limitation of R?
>>
>> Here's a code that mimics my issue and my sessionInfo():
>>
>> library(raster)
>> library(spacetime)
>>
>> ## Create a raster object that mimics my data
>> ## I actually have 20,708 layers in the raster stack
>> a = array(rnorm(9*9*10000), c(9,9,10000))
>> b = brick(a)
>> b = setValues(b, a)
>> z = seq(as.Date('1980-01-01'), as.Date('2007-05-18'),
>>         by = 'day')
>> b = setZ(b, z)
>>
>> ## coerce the raster stack to an STFDF object
>> stfdf = as(b, 'STFDF')
>>
>> ## attempt to compute EOFs
>> eof_time = EOF(stfdf, 'temporal')
>> eof_space = EOF(stfdf, 'space')
>>
>> #### restultant error:
>> # Error in eval(as.call(c(expression(data.frame), x, check.names =
>> !optional,  :
>> #   variable names are limited to 10000 bytes
>>
>> # > sessionInfo()
>> # R version 3.1.1 (2014-07-10)
>> # Platform: x86_64-pc-linux-gnu (64-bit)
>>
>> # locale:
>> #  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
>> #  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
>> #  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
>> #  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C
>> #  [9] LC_ADDRESS=C               LC_TELEPHONE=C
>> # [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C
>>
>> # attached base packages:
>> # [1] grid      stats     graphics  grDevices utils     datasets  methods
>> # [8] base
>>
>> # other attached packages:
>> # [1] spacetime_1.1-0 ncdf4_1.13      fields_7.1      maps_2.3-7
>> # [5] spam_1.0-1      rgdal_0.8-16    raster_2.2-31   sp_1.0-15
>>
>> # loaded via a namespace (and not attached):
>> # [1] intervals_0.14.0 lattice_0.20-29  rgeos_0.3-4      tcltk_3.1.1
>> # [5] tools_3.1.1      xts_0.9-7        zoo_1.7-11
>>
>>
>>
>>
>> Thanks,
>> Andrew
>> --
>> *Andrew P. Vitale*
>> Masters Student
>> Department of Geography
>> University of Nevada, Reno
>> vitale232 at gmail.com
>>
>> 	[[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma,  Co-Editor-in-Chief Computers & Geosciences
Institute for Geoinformatics (ifgi), University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
83 33081 http://ifgi.uni-muenster.de GPG key ID 0xAC227795

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 490 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20141014/e9b7c01d/attachment.bin>

From jl.iccp at gmail.com  Tue Oct 14 12:56:48 2014
From: jl.iccp at gmail.com (Jue Lin-Ye)
Date: Tue, 14 Oct 2014 12:56:48 +0200
Subject: [R-sig-Geo] Fix extreme values on legend
Message-ID: <CAAMkPW9dHQfWTdZ=m=uFpdz6zSt91AazJwppOtExncJdxhi9og@mail.gmail.com>

Greetings!

I have been using spplot to draw maps of the NW Mediterranean and
sub-regions. I would like to compare them, so I need the same range of
values to be displayed on the legends. I know that I can manually fix the
*colors*, but I do not know if I can fix the extreme *values* on spplot (I
know that I can do so with image.plot, but it is not what I desire).

Thank you in advance!

-- 
Jue Lin-Ye

	[[alternative HTML version deleted]]


From edzer.pebesma at uni-muenster.de  Tue Oct 14 14:47:02 2014
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Tue, 14 Oct 2014 14:47:02 +0200
Subject: [R-sig-Geo] Fix extreme values on legend
In-Reply-To: <CAAMkPW9dHQfWTdZ=m=uFpdz6zSt91AazJwppOtExncJdxhi9og@mail.gmail.com>
References: <CAAMkPW9dHQfWTdZ=m=uFpdz6zSt91AazJwppOtExncJdxhi9og@mail.gmail.com>
Message-ID: <543D1B46.4080206@uni-muenster.de>

You can use the at argument, as in

spplot(obj, at = c(0,1,2,3))

to specify the values at which colours change. Its range determines the
value range.

On 10/14/2014 12:56 PM, Jue Lin-Ye wrote:
> Greetings!
> 
> I have been using spplot to draw maps of the NW Mediterranean and
> sub-regions. I would like to compare them, so I need the same range of
> values to be displayed on the legends. I know that I can manually fix the
> *colors*, but I do not know if I can fix the extreme *values* on spplot (I
> know that I can do so with image.plot, but it is not what I desire).
> 
> Thank you in advance!
> 

-- 
Edzer Pebesma,  Co-Editor-in-Chief Computers & Geosciences
Institute for Geoinformatics (ifgi), University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
83 33081 http://ifgi.uni-muenster.de GPG key ID 0xAC227795

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 490 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20141014/d8e105c8/attachment.bin>

From afischbach at usgs.gov  Tue Oct 14 19:38:09 2014
From: afischbach at usgs.gov (Anthony Fischbach)
Date: Tue, 14 Oct 2014 10:38:09 -0700 (PDT)
Subject: [R-sig-Geo] raster working with netCDF files that have indexed
	geography
In-Reply-To: <CAAcGz99GfFswQ+ULWcTg9gAqH8cP_5x9tf8g_OGZtmyoe33DoQ@mail.gmail.com>
References: <1412976723290-7587261.post@n2.nabble.com>
	<CAAcGz99GfFswQ+ULWcTg9gAqH8cP_5x9tf8g_OGZtmyoe33DoQ@mail.gmail.com>
Message-ID: <1413308289657-7587280.post@n2.nabble.com>

This netCDF of the is described  here
<http://tds.ucar.edu/thredds/esgcet/20/cmip5.output1.NCAR.CCSM4.rcp85.mon.seaIce.OImon.r1i1p1.v20121031.xml#cmip5.output1.NCAR.CCSM4.rcp85.mon.seaIce.OImon.r1i1p1.v20121031|application/xml+thredds|Catalog> 
.  
Access is restricted to registered users of the Earth System Grid Federation
(http://pcmdi9.llnl.gov/esgf-web-fe/) which distributes netCDF copies of
climate model projections.
To allow others within the r-sig-geo group to access the file for the sake
of working out the r code, please contact me for a temporary web link from
which it may be downloaded.



-----
Tony Fischbach, Wildlife Biologist
Walrus Research Program
Alaska Science Center
U.S. Geological Survey
4210 University Drive
Anchorage, AK 99508-4650

AFischbach at usgs.gov
http://alaska.usgs.gov/science/biology/walrus
--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/raster-working-with-netCDF-files-that-have-indexed-geography-tp7587261p7587280.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From vitale232 at gmail.com  Tue Oct 14 20:48:21 2014
From: vitale232 at gmail.com (Andrew Vitale)
Date: Tue, 14 Oct 2014 11:48:21 -0700
Subject: [R-sig-Geo] spacetime EOF error "variable names are limited to
 10000 bytes"
In-Reply-To: <543CD044.5080205@uni-muenster.de>
References: <CAFTcopeGkXSY-jor+EsuL6y8iQ_vX6HO+zPQQpXsjG3ebCLdfQ@mail.gmail.com>
	<B078CDF40DFE4045AF172A8B4F68FC4857C8AEB134@DKRDSEXC016.vestas.net>
	<543CD044.5080205@uni-muenster.de>
Message-ID: <CAFTcopc_vsMZSNL=kHNyWDTJhB-1EDvGodbesrM05WrmYJ4KUg@mail.gmail.com>

Thanks for the quick fix, Edzer!

I was unfamiliar with installing a development version of a package from
GitHub.  If anyone comes across this, it's pretty easy with the devtools
library:


library(raster)
library(spacetime)
library(devtools)

## Create a raster object that mimics my data
## I actually have 20,708 layers in the raster stack
a = array(rnorm(9*9*10000), c(9,9,10000))
b = brick(a)
b = setValues(b, a)
z = seq(as.Date('1980-01-01'), as.Date('2007-05-18'),
        by = 'day')
b = setZ(b, z)

## Turn on dev_mode in devtools to easily
## compile spacetime from GitHub
dev_mode(on=TRUE)
install_github('edzer/spacetime')

## coerce the raster stack to an STFDF object
stfdf = as(b, 'STFDF')

## attempt to compute EOFs
eof_time = EOF(stfdf, 'temporal')
eof_space = EOF(stfdf, 'spatial')


On Tue, Oct 14, 2014 at 12:27 AM, Edzer Pebesma <
edzer.pebesma at uni-muenster.de> wrote:

> Thanks for the clear example & diagnostic.
>
> I committed a patch (github) that now uses the first name only to
> address all layers (i.e.: "layer.1"). I'm all ears for a better suggestion!
>
> On 10/14/2014 08:00 AM, Frede Aakmann T?gersen wrote:
> > Hi Andrew
> >
> > Try this
> >
> >> nchar(names(stfdf at data))
> > [1] 108893
> >>
> >
> > Really long name. Here is a snipped version.
> >
> >> names(stfdf at data)
> > [1]
> "layer.1.layer.2.layer.3.layer.4.layer.5.layer.6.layer.7.layer.8.layer.9.layer.10.layer.11.layer.12.layer.13.layer.14.layer.15.layer.16.layer.17.layer.18.layer.19.layer.20.layer.21.layer.22.layer.23.layer.24.layer.25.layer.26.layer.27.layer.28.layer.29.layer.30.layer.31.layer.32.layer.33.layer.34.layer.35.layer.36.layer.37.layer.38.layer.39.layer.40.layer.41.layer.42.layer.43.layer.44.layer.45.layer.46.layer.47.layer.48.layer.49.layer.50.layer.51.layer.52.layer.53.layer.54.layer.55.layer.56.layer.57.layer.58.layer.59.layer.60.layer.61.layer.62.layer.63.layer.64.layer.65.layer.66.layer.67.layer.68.layer.69.layer.70.layer.71.layer.72.layer.73.layer.74.layer.75.layer.76.layer.77.layer.78.layer.79.layer.80.layer.81.layer.82.layer.83.layer.84.layer.85.layer.86.layer.87.layer.88.layer.89.layer.90.layer.91.layer.92.layer.93.layer.94.layer.95.layer.96.layer.97.layer.98.layer.99.layer.100.layer.101.layer.102.layer.103.layer.104.layer.105.layer.106.layer.107.layer.108.layer.109.layer.110.
>
> layer.111.layer.112.layer.113.layer.114.layer.115.layer.116.layer.117.layer.118.layer.119.layer.120.layer.121.layer.122.layer.123.layer.124.layer.125.layer.126.layer.127.layer.128.layer.129.layer.130.layer.131.layer.132.layer.133.layer.134.layer.135.layer.136.layer.137.layer.138.layer.139.layer.140.lay
> >  < SNIP>
> 946.layer.9947.layer.9948.layer.9949.layer.9950.layer.9951.layer.9952.layer.9953.layer.9954.layer.9955.layer.9956.layer.9957.layer.9958.layer.9959.layer.9960.layer.9961.layer.9962.layer.9963.layer.9964.layer.9965.layer.9966.layer.9967.layer.9968.layer.9969.layer.9970.layer.9971.layer.9972.layer.9973.layer.9974.layer.9975.layer.9976.layer.9977.layer.9978.layer.9979.layer.9980.layer.9981.layer.9982.layer.9983.layer.9984.layer.9985.layer.9986.layer.9987.layer.9988.layer.9989.layer.9990.layer.9991.layer.9992.layer.9993.layer.9994.layer.9995.layer.9996.layer.9997.layer.9998.layer.9999.layer.10000"
> >>
> >
> > If you do this:
> >
> > names(stfdf at data) <- "all_layers"
> >
> > EOF() will work.
> >
> >
> > Yours sincerely / Med venlig hilsen
> >
> >
> > Frede Aakmann T?gersen
> > Specialist, M.Sc., Ph.D.
> > Plant Performance & Modeling
> >
> > Technology & Service Solutions
> > T +45 9730 5135
> > M +45 2547 6050
> > frtog at vestas.com
> > http://www.vestas.com
> >
> > Company reg. name: Vestas Wind Systems A/S
> > This e-mail is subject to our e-mail disclaimer statement.
> > Please refer to www.vestas.com/legal/notice
> > If you have received this e-mail in error please contact the sender.
> >
> >> -----Original Message-----
> >> From: r-sig-geo-bounces at r-project.org [mailto:r-sig-geo-bounces at r-
> >> project.org] On Behalf Of Andrew Vitale
> >> Sent: 14. oktober 2014 01:24
> >> To: r-sig-geo
> >> Subject: [R-sig-Geo] spacetime EOF error "variable names are limited to
> >> 10000 bytes"
> >>
> >> Hello,
> >>
> >> I have a raster brick of sea level pressure anomalies that I would like
> to
> >> analyze using empirical orthogonal functions.  Each layer of the brick
> >> represents a daily observation, with a total of 20,718 days worth of
> >> observations (nlayer=20,718).
> >>
> >> I can easily coerce the raster brick to a spacetime STFDF object.
> However,
> >> when I try to run the spacetime:::EOF function, I get the following
> error:
> >> "Error in eval(as.call(c(expression(data.frame), x, check.names =
> >> !optional,  :
> >>    variable names are limited to 10000 bytes"
> >>
> >> It seems that the error originates from the third line of the EOF code,
> >> where the STFDF is coerced to an xts object.
> >>
> >> Does anyone know of a workaround for this error, or is this merely a
> >> limitation of R?
> >>
> >> Here's a code that mimics my issue and my sessionInfo():
> >>
> >> library(raster)
> >> library(spacetime)
> >>
> >> ## Create a raster object that mimics my data
> >> ## I actually have 20,708 layers in the raster stack
> >> a = array(rnorm(9*9*10000), c(9,9,10000))
> >> b = brick(a)
> >> b = setValues(b, a)
> >> z = seq(as.Date('1980-01-01'), as.Date('2007-05-18'),
> >>         by = 'day')
> >> b = setZ(b, z)
> >>
> >> ## coerce the raster stack to an STFDF object
> >> stfdf = as(b, 'STFDF')
> >>
> >> ## attempt to compute EOFs
> >> eof_time = EOF(stfdf, 'temporal')
> >> eof_space = EOF(stfdf, 'space')
> >>
> >> #### restultant error:
> >> # Error in eval(as.call(c(expression(data.frame), x, check.names =
> >> !optional,  :
> >> #   variable names are limited to 10000 bytes
> >>
> >> # > sessionInfo()
> >> # R version 3.1.1 (2014-07-10)
> >> # Platform: x86_64-pc-linux-gnu (64-bit)
> >>
> >> # locale:
> >> #  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
> >> #  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
> >> #  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
> >> #  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C
> >> #  [9] LC_ADDRESS=C               LC_TELEPHONE=C
> >> # [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C
> >>
> >> # attached base packages:
> >> # [1] grid      stats     graphics  grDevices utils     datasets
> methods
> >> # [8] base
> >>
> >> # other attached packages:
> >> # [1] spacetime_1.1-0 ncdf4_1.13      fields_7.1      maps_2.3-7
> >> # [5] spam_1.0-1      rgdal_0.8-16    raster_2.2-31   sp_1.0-15
> >>
> >> # loaded via a namespace (and not attached):
> >> # [1] intervals_0.14.0 lattice_0.20-29  rgeos_0.3-4      tcltk_3.1.1
> >> # [5] tools_3.1.1      xts_0.9-7        zoo_1.7-11
> >>
> >>
> >>
> >>
> >> Thanks,
> >> Andrew
> >> --
> >> *Andrew P. Vitale*
> >> Masters Student
> >> Department of Geography
> >> University of Nevada, Reno
> >> vitale232 at gmail.com
> >>
> >>      [[alternative HTML version deleted]]
> >>
> >> _______________________________________________
> >> R-sig-Geo mailing list
> >> R-sig-Geo at r-project.org
> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
>
> --
> Edzer Pebesma,  Co-Editor-in-Chief Computers & Geosciences
> Institute for Geoinformatics (ifgi), University of M?nster
> Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
> 83 33081 http://ifgi.uni-muenster.de GPG key ID 0xAC227795
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>


-- 
*Andrew P. Vitale*
Masters Student
Department of Geography
University of Nevada, Reno
vitale232 at gmail.com

	[[alternative HTML version deleted]]


From mdsumner at gmail.com  Wed Oct 15 06:20:51 2014
From: mdsumner at gmail.com (Michael Sumner)
Date: Wed, 15 Oct 2014 15:20:51 +1100
Subject: [R-sig-Geo] subdatasets in rgdal/raster
Message-ID: <CAAcGz980P1Zp+u9VCYzXGWZdzD=aiNkQZNsNgGJcViFPFxUn5g@mail.gmail.com>

Hello,

As far as I know there's nothing in rgdal to determine existing
subdatasets (SDS) in HDF (or NetCDF for that matter).

In raster, raster(x) will read from the first candidate *variable*,
and list the others with a warning, which is analogous to an SDS but
of course it's always providing this via ncdf/ncdf4 rather than via
rgdal.

Is it true there's no way to find out SDS from HDF or NetCDF in rgdal?

I've not really explored this before much since compiling HDF was
unavailable to me. gdalUtils fills a gap but only by running the
installed command line tools, which obviously can be avoided with the
right features in rgdal/raster. I personally have always run the
command line tools and then jumped back to R (if I could).

(The vector analogy in rgdal to listing SDS would be ogrListLayers).

This is a missing capability in the raster package, somewhat disguised
because of the independent support for NetCDF. I guess hardly anyone
is using HDF? That's a shame since these R tools really help.  It's a
pretty complicated story all round and I keep re/discovering
interesting corners. If anyone is writing anything significant about
all this I'd be keen to be involved.

Cheers, Mike.

-- 
Michael Sumner
Software and Database Engineer
Australian Antarctic Division
Hobart, Australia
e-mail: mdsumner at gmail.com


From Roger.Bivand at nhh.no  Wed Oct 15 08:50:52 2014
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 15 Oct 2014 08:50:52 +0200
Subject: [R-sig-Geo] subdatasets in rgdal/raster
In-Reply-To: <CAAcGz980P1Zp+u9VCYzXGWZdzD=aiNkQZNsNgGJcViFPFxUn5g@mail.gmail.com>
References: <CAAcGz980P1Zp+u9VCYzXGWZdzD=aiNkQZNsNgGJcViFPFxUn5g@mail.gmail.com>
Message-ID: <alpine.LRH.2.03.1410150838400.4732@reclus.nhh.no>

On Wed, 15 Oct 2014, Michael Sumner wrote:

> Hello,
>
> As far as I know there's nothing in rgdal to determine existing
> subdatasets (SDS) in HDF (or NetCDF for that matter).
>
> In raster, raster(x) will read from the first candidate *variable*,
> and list the others with a warning, which is analogous to an SDS but
> of course it's always providing this via ncdf/ncdf4 rather than via
> rgdal.
>
> Is it true there's no way to find out SDS from HDF or NetCDF in rgdal?

Because these formats are poorly organised (an XML tree describing the 
internal structure would be easy to parse, but self-descriptive metadata 
isn't usual here), GDALinfo() does not provide much.

If you start by identifying the incantation used by command line gdalinfo 
to report the SDS metadata, then look at its source code, it should be 
possible to make some progress. I don't use either if I can help it, and 
do not have the necessary trial set of sample files. You'd need to find a 
robust route covering a wide range of files seen in the wild to allow for 
oddities in the ways things are organised. It is unfortunate to have to 
branch code on the selected driver, but here it is hard to avoid. Once 
GDALinfo is reporting the metadata in a predictable way, the other 
functions can be given appropriate argument values.

Also consider looking at this from the point of view of rgdal2 in addition 
to rgdal; it could possibly be "closer" there and looking at both may 
make it easier to spot:

https://github.com/thk686/rgdal2

Contributions welcome!

Roger

>
> I've not really explored this before much since compiling HDF was
> unavailable to me. gdalUtils fills a gap but only by running the
> installed command line tools, which obviously can be avoided with the
> right features in rgdal/raster. I personally have always run the
> command line tools and then jumped back to R (if I could).
>
> (The vector analogy in rgdal to listing SDS would be ogrListLayers).
>
> This is a missing capability in the raster package, somewhat disguised
> because of the independent support for NetCDF. I guess hardly anyone
> is using HDF? That's a shame since these R tools really help.  It's a
> pretty complicated story all round and I keep re/discovering
> interesting corners. If anyone is writing anything significant about
> all this I'd be keen to be involved.
>
> Cheers, Mike.
>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no


From nunocesardesa at gmail.com  Wed Oct 15 12:16:38 2014
From: nunocesardesa at gmail.com (=?UTF-8?B?TnVubyBTw6E=?=)
Date: Wed, 15 Oct 2014 11:16:38 +0100
Subject: [R-sig-Geo] Landsat ETM+ Gap filling & WELD data
Message-ID: <CAB-ux0DJz95N629daSmmhhfxOKgsMen5=S+-G4VN1x3c7M19EA@mail.gmail.com>

Hey

So, the first question is - is there an implementation of the newer
algorithms for Gap filling in any R package?

If not, I would be available to work with an expert to try to develop it
here - some of the actual IDL code is available through Dr. Xiaolin Zhu's
page: http://geography.osu.edu/grads/xzhu/ , so would it be so costly to do
it here?

The second is WELD data, I am absolutely confused on what is the projection
they use on that dataset.. can anybody enlighten me?


All the best!
Nuno


-- 

Nuno C?sar de S?
+351 91 961 90 37

	[[alternative HTML version deleted]]


From mdsumner at gmail.com  Wed Oct 15 13:23:49 2014
From: mdsumner at gmail.com (Michael Sumner)
Date: Wed, 15 Oct 2014 22:23:49 +1100
Subject: [R-sig-Geo] subdatasets in rgdal/raster
In-Reply-To: <alpine.LRH.2.03.1410150838400.4732@reclus.nhh.no>
References: <CAAcGz980P1Zp+u9VCYzXGWZdzD=aiNkQZNsNgGJcViFPFxUn5g@mail.gmail.com>
	<alpine.LRH.2.03.1410150838400.4732@reclus.nhh.no>
Message-ID: <CAAcGz99CFT-yxHDax+SnPP1WBavpdCTBbZcvbBP3VENmxNAmeg@mail.gmail.com>

Thanks Roger, I'm still hoping to be able to code at this level one day.

I have gone off half-cocked, confusing things. I can get SDS from
NetCDF and HDF files with GDALinfo() with no problems - I just had to
turn off returnScaleOffset, which I think has a confounding of nbands
and subdatasets - since a datasource with SDS has no bands, but I need
to explore this more to be sure.

Cheers, Mike.





On Wed, Oct 15, 2014 at 5:50 PM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
> On Wed, 15 Oct 2014, Michael Sumner wrote:
>
>> Hello,
>>
>> As far as I know there's nothing in rgdal to determine existing
>> subdatasets (SDS) in HDF (or NetCDF for that matter).
>>
>> In raster, raster(x) will read from the first candidate *variable*,
>> and list the others with a warning, which is analogous to an SDS but
>> of course it's always providing this via ncdf/ncdf4 rather than via
>> rgdal.
>>
>> Is it true there's no way to find out SDS from HDF or NetCDF in rgdal?
>
>
> Because these formats are poorly organised (an XML tree describing the
> internal structure would be easy to parse, but self-descriptive metadata
> isn't usual here), GDALinfo() does not provide much.
>
> If you start by identifying the incantation used by command line gdalinfo to
> report the SDS metadata, then look at its source code, it should be possible
> to make some progress. I don't use either if I can help it, and do not have
> the necessary trial set of sample files. You'd need to find a robust route
> covering a wide range of files seen in the wild to allow for oddities in the
> ways things are organised. It is unfortunate to have to branch code on the
> selected driver, but here it is hard to avoid. Once GDALinfo is reporting
> the metadata in a predictable way, the other functions can be given
> appropriate argument values.
>
> Also consider looking at this from the point of view of rgdal2 in addition
> to rgdal; it could possibly be "closer" there and looking at both may make
> it easier to spot:
>
> https://github.com/thk686/rgdal2
>
> Contributions welcome!
>
> Roger
>
>
>>
>> I've not really explored this before much since compiling HDF was
>> unavailable to me. gdalUtils fills a gap but only by running the
>> installed command line tools, which obviously can be avoided with the
>> right features in rgdal/raster. I personally have always run the
>> command line tools and then jumped back to R (if I could).
>>
>> (The vector analogy in rgdal to listing SDS would be ogrListLayers).
>>
>> This is a missing capability in the raster package, somewhat disguised
>> because of the independent support for NetCDF. I guess hardly anyone
>> is using HDF? That's a shame since these R tools really help.  It's a
>> pretty complicated story all round and I keep re/discovering
>> interesting corners. If anyone is writing anything significant about
>> all this I'd be keen to be involved.
>>
>> Cheers, Mike.
>>
>>
>
> --
> Roger Bivand
> Department of Economics, Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; fax +47 55 95 91 00
> e-mail: Roger.Bivand at nhh.no
>



-- 
Michael Sumner
Software and Database Engineer
Australian Antarctic Division
Hobart, Australia
e-mail: mdsumner at gmail.com


From eric.j.christeson at gmail.com  Wed Oct 15 16:52:16 2014
From: eric.j.christeson at gmail.com (ejc)
Date: Wed, 15 Oct 2014 09:52:16 -0500
Subject: [R-sig-Geo] Landsat ETM+ Gap filling & WELD data
In-Reply-To: <CAB-ux0DJz95N629daSmmhhfxOKgsMen5=S+-G4VN1x3c7M19EA@mail.gmail.com>
References: <CAB-ux0DJz95N629daSmmhhfxOKgsMen5=S+-G4VN1x3c7M19EA@mail.gmail.com>
Message-ID: <CAFUr27DvTCMbGTAS+QvoCErzGTFxsNr4OV-N_rR5-wa-pN_4kA@mail.gmail.com>

For the WELD data question.
According to: http://globalmonitoring.sdstate.edu/projects/weld/ Section
"Version 1.5 Product Documentation", subsection "Product Map Projections",
 they use an Albers Equal Area projection.

Thanks,
Eric

On Wed, Oct 15, 2014 at 5:16 AM, Nuno S? <nunocesardesa at gmail.com> wrote:

> Hey
>
> So, the first question is - is there an implementation of the newer
> algorithms for Gap filling in any R package?
>
> If not, I would be available to work with an expert to try to develop it
> here - some of the actual IDL code is available through Dr. Xiaolin Zhu's
> page: http://geography.osu.edu/grads/xzhu/ , so would it be so costly to
> do
> it here?
>
> The second is WELD data, I am absolutely confused on what is the projection
> they use on that dataset.. can anybody enlighten me?
>
>
> All the best!
> Nuno
>
>
> --
>
> Nuno C?sar de S?
> +351 91 961 90 37
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From jgrn at illinois.edu  Wed Oct 15 17:27:02 2014
From: jgrn at illinois.edu (Jonathan Greenberg)
Date: Wed, 15 Oct 2014 10:27:02 -0500
Subject: [R-sig-Geo] subdatasets in rgdal/raster
In-Reply-To: <CAAcGz99CFT-yxHDax+SnPP1WBavpdCTBbZcvbBP3VENmxNAmeg@mail.gmail.com>
References: <CAAcGz980P1Zp+u9VCYzXGWZdzD=aiNkQZNsNgGJcViFPFxUn5g@mail.gmail.com>
	<alpine.LRH.2.03.1410150838400.4732@reclus.nhh.no>
	<CAAcGz99CFT-yxHDax+SnPP1WBavpdCTBbZcvbBP3VENmxNAmeg@mail.gmail.com>
Message-ID: <CABG0rfsWFrGry-2QtZVs0KJj8Ysk1GyiU2=-LW=HwtSMoBrjzg@mail.gmail.com>

Mike:

Have you taken a look at gdalUtils?  This is a wrapper for all the
GDAL binaries (I am still working on adding in all those new tools
that were recently released with version 1.11.1, but it should be up
to date as of v 1.10.1).  gdalinfo that is part of gdalUtils gives you
the full info dump (more, if less clean, output than rgdal's gdalInfo
will give you), which you could parse for the info you wanted.  I also
have a custom function "get_subdatasets" which sounds a lot like what
you are describing.

Give it a shot!  You will need to install GDAL yourself first -- check
the help for suggestions on which flavor of GDAL I recommend.

--j

On Wed, Oct 15, 2014 at 6:23 AM, Michael Sumner <mdsumner at gmail.com> wrote:
> Thanks Roger, I'm still hoping to be able to code at this level one day.
>
> I have gone off half-cocked, confusing things. I can get SDS from
> NetCDF and HDF files with GDALinfo() with no problems - I just had to
> turn off returnScaleOffset, which I think has a confounding of nbands
> and subdatasets - since a datasource with SDS has no bands, but I need
> to explore this more to be sure.
>
> Cheers, Mike.
>
>
>
>
>
> On Wed, Oct 15, 2014 at 5:50 PM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
>> On Wed, 15 Oct 2014, Michael Sumner wrote:
>>
>>> Hello,
>>>
>>> As far as I know there's nothing in rgdal to determine existing
>>> subdatasets (SDS) in HDF (or NetCDF for that matter).
>>>
>>> In raster, raster(x) will read from the first candidate *variable*,
>>> and list the others with a warning, which is analogous to an SDS but
>>> of course it's always providing this via ncdf/ncdf4 rather than via
>>> rgdal.
>>>
>>> Is it true there's no way to find out SDS from HDF or NetCDF in rgdal?
>>
>>
>> Because these formats are poorly organised (an XML tree describing the
>> internal structure would be easy to parse, but self-descriptive metadata
>> isn't usual here), GDALinfo() does not provide much.
>>
>> If you start by identifying the incantation used by command line gdalinfo to
>> report the SDS metadata, then look at its source code, it should be possible
>> to make some progress. I don't use either if I can help it, and do not have
>> the necessary trial set of sample files. You'd need to find a robust route
>> covering a wide range of files seen in the wild to allow for oddities in the
>> ways things are organised. It is unfortunate to have to branch code on the
>> selected driver, but here it is hard to avoid. Once GDALinfo is reporting
>> the metadata in a predictable way, the other functions can be given
>> appropriate argument values.
>>
>> Also consider looking at this from the point of view of rgdal2 in addition
>> to rgdal; it could possibly be "closer" there and looking at both may make
>> it easier to spot:
>>
>> https://github.com/thk686/rgdal2
>>
>> Contributions welcome!
>>
>> Roger
>>
>>
>>>
>>> I've not really explored this before much since compiling HDF was
>>> unavailable to me. gdalUtils fills a gap but only by running the
>>> installed command line tools, which obviously can be avoided with the
>>> right features in rgdal/raster. I personally have always run the
>>> command line tools and then jumped back to R (if I could).
>>>
>>> (The vector analogy in rgdal to listing SDS would be ogrListLayers).
>>>
>>> This is a missing capability in the raster package, somewhat disguised
>>> because of the independent support for NetCDF. I guess hardly anyone
>>> is using HDF? That's a shame since these R tools really help.  It's a
>>> pretty complicated story all round and I keep re/discovering
>>> interesting corners. If anyone is writing anything significant about
>>> all this I'd be keen to be involved.
>>>
>>> Cheers, Mike.
>>>
>>>
>>
>> --
>> Roger Bivand
>> Department of Economics, Norwegian School of Economics,
>> Helleveien 30, N-5045 Bergen, Norway.
>> voice: +47 55 95 93 55; fax +47 55 95 91 00
>> e-mail: Roger.Bivand at nhh.no
>>
>
>
>
> --
> Michael Sumner
> Software and Database Engineer
> Australian Antarctic Division
> Hobart, Australia
> e-mail: mdsumner at gmail.com
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



-- 
Jonathan A. Greenberg, PhD
Assistant Professor
Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
Department of Geography and Geographic Information Science
University of Illinois at Urbana-Champaign
259 Computing Applications Building, MC-150
605 East Springfield Avenue
Champaign, IL  61820-6371
Phone: 217-300-1924
http://www.geog.illinois.edu/~jgrn/
AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007


From nunocesardesa at gmail.com  Wed Oct 15 17:29:16 2014
From: nunocesardesa at gmail.com (=?UTF-8?B?TnVubyBTw6E=?=)
Date: Wed, 15 Oct 2014 16:29:16 +0100
Subject: [R-sig-Geo] Landsat ETM+ Gap filling & WELD data
In-Reply-To: <CAFUr27DvTCMbGTAS+QvoCErzGTFxsNr4OV-N_rR5-wa-pN_4kA@mail.gmail.com>
References: <CAB-ux0DJz95N629daSmmhhfxOKgsMen5=S+-G4VN1x3c7M19EA@mail.gmail.com>
	<CAFUr27DvTCMbGTAS+QvoCErzGTFxsNr4OV-N_rR5-wa-pN_4kA@mail.gmail.com>
Message-ID: <CAB-ux0AZ02q1KQ+vivq8MCi0SomankKXC3hTWAfRTTBEDgxRDw@mail.gmail.com>

Hello Eric

Thank you, I had seen it though. Are you aware if the rgdal able to
reproject it into UTM?

All the best,
Nuno

On 15 October 2014 15:52, ejc <eric.j.christeson at gmail.com> wrote:

> For the WELD data question.
> According to: http://globalmonitoring.sdstate.edu/projects/weld/ Section
> "Version 1.5 Product Documentation", subsection "Product Map Projections",
>  they use an Albers Equal Area projection.
>
> Thanks,
> Eric
>
> On Wed, Oct 15, 2014 at 5:16 AM, Nuno S? <nunocesardesa at gmail.com> wrote:
>
>> Hey
>>
>> So, the first question is - is there an implementation of the newer
>> algorithms for Gap filling in any R package?
>>
>> If not, I would be available to work with an expert to try to develop it
>> here - some of the actual IDL code is available through Dr. Xiaolin Zhu's
>> page: http://geography.osu.edu/grads/xzhu/ , so would it be so costly to
>> do
>> it here?
>>
>> The second is WELD data, I am absolutely confused on what is the
>> projection
>> they use on that dataset.. can anybody enlighten me?
>>
>>
>> All the best!
>> Nuno
>>
>>
>> --
>>
>> Nuno C?sar de S?
>> +351 91 961 90 37
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>


-- 

Nuno C?sar de S?
+351 91 961 90 37

	[[alternative HTML version deleted]]


From miguel.fiandor.gutierrez at gmail.com  Wed Oct 15 21:02:28 2014
From: miguel.fiandor.gutierrez at gmail.com (=?UTF-8?Q?Miguel_Fiandor_Guti=C3=A9rrez?=)
Date: Wed, 15 Oct 2014 21:02:28 +0200
Subject: [R-sig-Geo]  RCharts+Leaflet+Shiny
Message-ID: <CANmgL7fj7vN5y9Gjv1HHdA9t1JaV5JgoVRDUiVWiVm2Dfm5ADg@mail.gmail.com>

Hi,

I'm trying to draw traffic cameras and air quality measure stations from
Madrid in a shiny app, using RCharts with leaflet
<https://github.com/ramnathv/rCharts>.

The author has many examples there, some doesn't work to me, some other
does. He has a very cool project working about citybikes in github too ->
https://github.com/ramnathv/bikeshare/ . This one works to me locally.

However, I'm not able to replicate the succeed on my project, I do render a
map in shiny, and I have added markers for some points, but now, I want to
use circles instead of markers because you can decide the color of it
depending on a variable.
I've never managed to plot these circles.

Since the problem involves data, libraries, and code, I share my app on
github:
https://github.com/ADIRSE/maddata

Most of the code is in the app/global.R file, at the bottom is the
plotMap() function.

The github project is a bit ahead of what I've deployed on shinyapps.io,
but you can have a glance of it too -> https://adirse.shinyapps.io/maddata/

Very welcome on advance!

Cheers,

Miguel

	[[alternative HTML version deleted]]


From mdsumner at gmail.com  Thu Oct 16 01:26:45 2014
From: mdsumner at gmail.com (Michael Sumner)
Date: Thu, 16 Oct 2014 10:26:45 +1100
Subject: [R-sig-Geo] Landsat ETM+ Gap filling & WELD data
In-Reply-To: <CAB-ux0AZ02q1KQ+vivq8MCi0SomankKXC3hTWAfRTTBEDgxRDw@mail.gmail.com>
References: <CAB-ux0DJz95N629daSmmhhfxOKgsMen5=S+-G4VN1x3c7M19EA@mail.gmail.com>
	<CAFUr27DvTCMbGTAS+QvoCErzGTFxsNr4OV-N_rR5-wa-pN_4kA@mail.gmail.com>
	<CAB-ux0AZ02q1KQ+vivq8MCi0SomankKXC3hTWAfRTTBEDgxRDw@mail.gmail.com>
Message-ID: <CAAcGz9_121dzSjGA2rApecZVJB2uKe8NTiZp5Dm6Wp1i-hPSiw@mail.gmail.com>

Re. your second q, please provide links to or instructions for
obtaining one of these files and someone could have a go.

Generally I would recommend *not* warping to UTM, or any other
projection, unless you really need to since much of the data
extraction and merging can be done without such a destructive process.
You haven't provided any ideas about what you are trying to do though.

Converting code is about as hard as the original code is to
understand, so I would highly recommend that you try to do that first
so you can break down the the tasks and address them individually.
It's too much to ask a general question about doing that, and there is
a lot you could do first.

Cheers, Mike.



On Thu, Oct 16, 2014 at 2:29 AM, Nuno S? <nunocesardesa at gmail.com> wrote:
> Hello Eric
>
> Thank you, I had seen it though. Are you aware if the rgdal able to
> reproject it into UTM?
>
> All the best,
> Nuno
>
> On 15 October 2014 15:52, ejc <eric.j.christeson at gmail.com> wrote:
>
>> For the WELD data question.
>> According to: http://globalmonitoring.sdstate.edu/projects/weld/ Section
>> "Version 1.5 Product Documentation", subsection "Product Map Projections",
>>  they use an Albers Equal Area projection.
>>
>> Thanks,
>> Eric
>>
>> On Wed, Oct 15, 2014 at 5:16 AM, Nuno S? <nunocesardesa at gmail.com> wrote:
>>
>>> Hey
>>>
>>> So, the first question is - is there an implementation of the newer
>>> algorithms for Gap filling in any R package?
>>>
>>> If not, I would be available to work with an expert to try to develop it
>>> here - some of the actual IDL code is available through Dr. Xiaolin Zhu's
>>> page: http://geography.osu.edu/grads/xzhu/ , so would it be so costly to
>>> do
>>> it here?
>>>
>>> The second is WELD data, I am absolutely confused on what is the
>>> projection
>>> they use on that dataset.. can anybody enlighten me?
>>>
>>>
>>> All the best!
>>> Nuno
>>>
>>>
>>> --
>>>
>>> Nuno C?sar de S?
>>> +351 91 961 90 37
>>>
>>>         [[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>>
>
>
> --
>
> Nuno C?sar de S?
> +351 91 961 90 37
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



-- 
Michael Sumner
Software and Database Engineer
Australian Antarctic Division
Hobart, Australia
e-mail: mdsumner at gmail.com


From nunocesardesa at gmail.com  Thu Oct 16 01:37:17 2014
From: nunocesardesa at gmail.com (=?UTF-8?B?TnVubyBTw6E=?=)
Date: Thu, 16 Oct 2014 00:37:17 +0100
Subject: [R-sig-Geo] Landsat ETM+ Gap filling & WELD data
In-Reply-To: <CAAcGz9_121dzSjGA2rApecZVJB2uKe8NTiZp5Dm6Wp1i-hPSiw@mail.gmail.com>
References: <CAB-ux0DJz95N629daSmmhhfxOKgsMen5=S+-G4VN1x3c7M19EA@mail.gmail.com>
	<CAFUr27DvTCMbGTAS+QvoCErzGTFxsNr4OV-N_rR5-wa-pN_4kA@mail.gmail.com>
	<CAB-ux0AZ02q1KQ+vivq8MCi0SomankKXC3hTWAfRTTBEDgxRDw@mail.gmail.com>
	<CAAcGz9_121dzSjGA2rApecZVJB2uKe8NTiZp5Dm6Wp1i-hPSiw@mail.gmail.com>
Message-ID: <CAB-ux0AKn=RUr8-aMGts7Oe7TvqvwpTsrJQjM2qzDe+EJy+VHw@mail.gmail.com>

Hey

Thank you for the heads up!

WELD data is available here: http://weld.cr.usgs.gov/

Data extraction cannot be done here since need a longer time series. All I
want is to extract values from the LS images at a certain number of months.

All the best!
Nuno


On 16 October 2014 00:26, Michael Sumner <mdsumner at gmail.com> wrote:

> Re. your second q, please provide links to or instructions for
> obtaining one of these files and someone could have a go.
>
> Generally I would recommend *not* warping to UTM, or any other
> projection, unless you really need to since much of the data
> extraction and merging can be done without such a destructive process.
> You haven't provided any ideas about what you are trying to do though.
>
> Converting code is about as hard as the original code is to
> understand, so I would highly recommend that you try to do that first
> so you can break down the the tasks and address them individually.
> It's too much to ask a general question about doing that, and there is
> a lot you could do first.
>
> Cheers, Mike.
>
>
>
> On Thu, Oct 16, 2014 at 2:29 AM, Nuno S? <nunocesardesa at gmail.com> wrote:
> > Hello Eric
> >
> > Thank you, I had seen it though. Are you aware if the rgdal able to
> > reproject it into UTM?
> >
> > All the best,
> > Nuno
> >
> > On 15 October 2014 15:52, ejc <eric.j.christeson at gmail.com> wrote:
> >
> >> For the WELD data question.
> >> According to: http://globalmonitoring.sdstate.edu/projects/weld/
> Section
> >> "Version 1.5 Product Documentation", subsection "Product Map
> Projections",
> >>  they use an Albers Equal Area projection.
> >>
> >> Thanks,
> >> Eric
> >>
> >> On Wed, Oct 15, 2014 at 5:16 AM, Nuno S? <nunocesardesa at gmail.com>
> wrote:
> >>
> >>> Hey
> >>>
> >>> So, the first question is - is there an implementation of the newer
> >>> algorithms for Gap filling in any R package?
> >>>
> >>> If not, I would be available to work with an expert to try to develop
> it
> >>> here - some of the actual IDL code is available through Dr. Xiaolin
> Zhu's
> >>> page: http://geography.osu.edu/grads/xzhu/ , so would it be so costly
> to
> >>> do
> >>> it here?
> >>>
> >>> The second is WELD data, I am absolutely confused on what is the
> >>> projection
> >>> they use on that dataset.. can anybody enlighten me?
> >>>
> >>>
> >>> All the best!
> >>> Nuno
> >>>
> >>>
> >>> --
> >>>
> >>> Nuno C?sar de S?
> >>> +351 91 961 90 37
> >>>
> >>>         [[alternative HTML version deleted]]
> >>>
> >>> _______________________________________________
> >>> R-sig-Geo mailing list
> >>> R-sig-Geo at r-project.org
> >>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >>>
> >>
> >>
> >
> >
> > --
> >
> > Nuno C?sar de S?
> > +351 91 961 90 37
> >
> >         [[alternative HTML version deleted]]
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
>
> --
> Michael Sumner
> Software and Database Engineer
> Australian Antarctic Division
> Hobart, Australia
> e-mail: mdsumner at gmail.com
>



-- 

Nuno C?sar de S?
+351 91 961 90 37

	[[alternative HTML version deleted]]


From leigh.kroeger at gmail.com  Wed Oct 15 10:33:47 2014
From: leigh.kroeger at gmail.com (Leigh Kroeger)
Date: Wed, 15 Oct 2014 11:33:47 +0300
Subject: [R-sig-Geo] Shifting x coordinates by 180
Message-ID: <CAObCpXOYhm_UbKAN0-oLpyR8SJZG-KvkJM_SwocegK7O3zmEDA@mail.gmail.com>

Hello,

I have the following shapefile imported into R:

> summary(grid)
Object of class SpatialPolygonsDataFrame
Coordinates:
         min        max
x -165.73220 -123.23912
y   29.55567   46.44211
Is projected: FALSE
proj4string : [+proj=longlat +ellps=WGS84]

I need to shift 'x' by adding 180 to the data column. I think the 'elide'
function in maptools can accomplish this but the following error comes up
when I start the code:

>coordinates(grid) <- c("x", "y")
Error in `coordinates<-`(`*tmp*`, value = c("x", "y")) :   setting
coordinates cannot be done on Spatial objects, where they have already been
set

My intended outcome is to be able to plot occurrence data from GBIF onto
the polygon shapefile.

Regards,

-- 
*Leigh A. Kroeger*
<*)))><

*PhD Candidate - Marine Ecology*
?????? ????? ?????
?????????? ?? ????
Dept. of Zoology
Tel Aviv University
Tel Aviv, 69978
Israel
Tel: +03 640-7830

http://belmaker.weebly.com/members.html
http://www.linkedin.com/profile/view?id=144722403&trk=nav_responsive_tab_profile_pic

	[[alternative HTML version deleted]]


From roland.harhoff at uni-muenster.de  Thu Oct 16 09:36:18 2014
From: roland.harhoff at uni-muenster.de (Roland Harhoff)
Date: Thu, 16 Oct 2014 09:36:18 +0200 (CEST)
Subject: [R-sig-Geo] Shifting x coordinates by 180
In-Reply-To: <CAObCpXOYhm_UbKAN0-oLpyR8SJZG-KvkJM_SwocegK7O3zmEDA@mail.gmail.com>
Message-ID: <permail-20141016073618fe5316b6000037ce-rolandh@message-id.uni-muenster.de>

Hello Leigh,

the error message clearly states the problem. A workaround would maybe to
extract the coordinates (Try to use function lapply due to the polygons slot
is a list.). Then change the coordinates as desired and create a new
SpatialPolygons object. In the end create a new SpatialPolygonsDataFrame out
of the new SpatialPolygons and the original data.

It is just an idea and not tested ; ) .

See also
?SpatialPolygonsDataFrame
?SpatialPolygons
etc.

With best regards

Roland


Leigh Kroeger schrieb am 2014-10-15:
> Hello,

> I have the following shapefile imported into R:

> > summary(grid)
> Object of class SpatialPolygonsDataFrame
> Coordinates:
>          min        max
> x -165.73220 -123.23912
> y   29.55567   46.44211
> Is projected: FALSE
> proj4string : [+proj=longlat +ellps=WGS84]

> I need to shift 'x' by adding 180 to the data column. I think the
> 'elide'
> function in maptools can accomplish this but the following error
> comes up
> when I start the code:

> >coordinates(grid) <- c("x", "y")
> Error in `coordinates<-`(`*tmp*`, value = c("x", "y")) :   setting
> coordinates cannot be done on Spatial objects, where they have
> already been
> set

> My intended outcome is to be able to plot occurrence data from GBIF
> onto
> the polygon shapefile.

> Regards,

> --
> *Leigh A. Kroeger*
> <*)))><

> *PhD Candidate - Marine Ecology*
> ?????? ????? ?????
> ?????????? ?? ????
> Dept. of Zoology
> Tel Aviv University
> Tel Aviv, 69978
> Israel
> Tel: +03 640-7830

> http://belmaker.weebly.com/members.html
> http://www.linkedin.com/profile/view?id=144722403&trk=nav_responsive_tab_profile_pic

>         [[alternative HTML version deleted]]

> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From mdsumner at gmail.com  Thu Oct 16 10:52:58 2014
From: mdsumner at gmail.com (Michael Sumner)
Date: Thu, 16 Oct 2014 19:52:58 +1100
Subject: [R-sig-Geo] Shifting x coordinates by 180
In-Reply-To: <CAObCpXOYhm_UbKAN0-oLpyR8SJZG-KvkJM_SwocegK7O3zmEDA@mail.gmail.com>
References: <CAObCpXOYhm_UbKAN0-oLpyR8SJZG-KvkJM_SwocegK7O3zmEDA@mail.gmail.com>
Message-ID: <CAAcGz984e2QQvkGX8OTKfwhrMpdYvKurzpouzbUSqaUP8LrsOA@mail.gmail.com>

Why not just use elide as you stated?

Why are you using coordinates()<-?

??



On Wed, Oct 15, 2014 at 7:33 PM, Leigh Kroeger <leigh.kroeger at gmail.com> wrote:
> Hello,
>
> I have the following shapefile imported into R:
>
>> summary(grid)
> Object of class SpatialPolygonsDataFrame
> Coordinates:
>          min        max
> x -165.73220 -123.23912
> y   29.55567   46.44211
> Is projected: FALSE
> proj4string : [+proj=longlat +ellps=WGS84]
>
> I need to shift 'x' by adding 180 to the data column. I think the 'elide'
> function in maptools can accomplish this but the following error comes up
> when I start the code:
>
>>coordinates(grid) <- c("x", "y")
> Error in `coordinates<-`(`*tmp*`, value = c("x", "y")) :   setting
> coordinates cannot be done on Spatial objects, where they have already been
> set
>
> My intended outcome is to be able to plot occurrence data from GBIF onto
> the polygon shapefile.
>
> Regards,
>
> --
> *Leigh A. Kroeger*
> <*)))><
>
> *PhD Candidate - Marine Ecology*
> ?????? ????? ?????
> ?????????? ?? ????
> Dept. of Zoology
> Tel Aviv University
> Tel Aviv, 69978
> Israel
> Tel: +03 640-7830
>
> http://belmaker.weebly.com/members.html
> http://www.linkedin.com/profile/view?id=144722403&trk=nav_responsive_tab_profile_pic
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



-- 
Michael Sumner
Software and Database Engineer
Australian Antarctic Division
Hobart, Australia
e-mail: mdsumner at gmail.com


From r.rhodes at pgr.reading.ac.uk  Thu Oct 16 12:53:07 2014
From: r.rhodes at pgr.reading.ac.uk (Ruari Rhodes)
Date: Thu, 16 Oct 2014 11:53:07 +0100
Subject: [R-sig-Geo] Shortest distance between points within a polygon
In-Reply-To: <543BAF54.9010507@pgr.reading.ac.uk>
References: <543BAF54.9010507@pgr.reading.ac.uk>
Message-ID: <543FA393.3070005@pgr.reading.ac.uk>

Thanks for the help Robert, Roman and Barry.
Barry's suggestion with gDistance is quite effective; the processing 
time required to rasterize the polygons is a bit of a hinderance, but 
the result is good. If anyone's interested, the code I ended up with 
(based on the shortestPath examples) is as follows:


library(raster)
library(gdistance)

load( '~/poly.RData')
load( '~/pts.RData')

#Create raster from polygon with 0.25 deg resolution
ext <- extent( poly)
r <- raster( ext=ext, resolution=0.25 )
polyRaster <- rasterize( poly, r, field=1, background=-Inf)

#Create transition layer. 1/mean(x) generates a conductance layer.
T <- transition(polyRaster, function(x) 1/mean(x), 8)

#Correct transition layer for geography. "c" indicates "least cost" method.
T <- geoCorrection(T, type="c")

#Find shortest path and output SpatialLines object
sPath1 <- shortestPath(T, pts[1], pts[2], output="SpatialLines")

#Plotting
plot(polyRaster)
points( pts)
lines(sPath1)




*Ruari Rhodes*
PhD Student
/European precipitation accumulation extremes/
Room 1U09 - Dept. of Meteorology
University of Reading,
Earley Gate, Reading, RG6 6BB
r.rhodes at pgr.reading.ac.uk
http://www.met.reading.ac.uk/~jb013101

On 10/13/14 11:54, Ruari Rhodes wrote:
> Hi all,
>
> I need to find the distance between two spatial points which lie within
> a polygon, via the shortest path which lies entirely within the polygon.
> Can anyone suggest a method? I need to find something which requires
> minimal computing resources.
>
> I have some examples of the points and polygons here, both in lonlat format:
> http://www.met.reading.ac.uk/~jb013101/files/R/datasets/poly.RData
> ("poly", a SpatialPolygonsDataFrame)
> http://www.met.reading.ac.uk/~jb013101/files/R/datasets/pts.RData
> ("pts", a SpatialPoints object)
>
> Many thanks for your help.
>

	[[alternative HTML version deleted]]


From marcel.au at web.de  Fri Oct 17 10:43:45 2014
From: marcel.au at web.de (Marcel)
Date: Fri, 17 Oct 2014 01:43:45 -0700 (PDT)
Subject: [R-sig-Geo] RasterStack on file disk
Message-ID: <1413535425515-7587297.post@n2.nabble.com>

Hello,

i would like to develop an action to store a RasterStack on file disk
instead of memory.

The images are transferred from a stack or virtual stack from ImageJ in
different types.

For a stack of RGB images the images are split into three integer matrices
and added to a RasterStack:

rasterStackFromIJ<-stack()
..........

imageMatrix<-.....from ImageJ.....

r<-matrix(imageMatrix[,1],nrow=xxx, ncol=yyy)
rasterStackFromIJ <- stack(rasterStackFromIJ,raster(r))
g<-matrix(imageMatrix[,2],nrow=xxx, ncol=yyy)
rasterStackFromIJ <- stack(rasterStackFromIJ,raster(g))
b<-matrix(imageMatrix[,3],nrow=xxx, ncol=yyy)
rasterStackFromIJ <- stack(rasterStackFromIJ,raster(b))
......

This works quite well for a bunch of images if enough RAM is available
(Created e.g. stack size: 4096:3072:21 from 7 RGB images)

However it would be nice to have an option to store and access the
RasterLayer to and from the file disk for huge stacks.

Is this possible for a RasterLayer?

Any information is appreciated!



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/RasterStack-on-file-disk-tp7587297.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From marcel.au at web.de  Fri Oct 17 10:54:45 2014
From: marcel.au at web.de (marcel Austenfeld)
Date: Fri, 17 Oct 2014 10:54:45 +0200
Subject: [R-sig-Geo] RasterStack on file disk
Message-ID: <trinity-68f08377-5f45-4472-92e5-4bc91350d739-1413536085040@3capp-webde-bs60>

Hello,

i would like to develop an action to store a RasterStack on file disk instead of memory.
The images are transferred from a stack or virtual stack from ImageJ in different types.

For a stack of RGB images the images are split into three integer matrices and added to a RasterStack:

rasterStackFromIJ<-stack()

..........
imageMatrix<-.....from ImageJ.....

r<-matrix(imageMatrix[,1],nrow=xxx, ncol=yyy)
rasterStackFromIJ <- stack(rasterStackFromIJ,raster(r))

g<-matrix(imageMatrix[,2],nrow=xxx, ncol=yyy)
rasterStackFromIJ <- stack(rasterStackFromIJ,raster(g))

b<-matrix(imageMatrix[,3],nrow=xxx, ncol=yyy)
rasterStackFromIJ <- stack(rasterStackFromIJ,raster(b))
......

This works quite well for a bunch of images if enough RAM is available (Created e.g. stack size: 4096:3072:21 from 7 RGB images)

However it would be nice to have an option to store and access the RasterLayer to and from the file disk for huge stacks.

Is this possible for a RasterLayer?

Any information is appreciated!


From kirsty.fulton at hotmail.co.uk  Fri Oct 17 15:01:28 2014
From: kirsty.fulton at hotmail.co.uk (kirsty fulton)
Date: Fri, 17 Oct 2014 13:01:28 +0000
Subject: [R-sig-Geo] Multiple legends with levelplot and spplot
Message-ID: <DUB122-W11949F0D0DE44AC9589092B8A80@phx.gbl>

I am trying to overlay two shapefiles on a raster grid. The raster is a digital elevation model. The first shapefile is a polygon, which shows the outline of a country, and the second shapefile is a polyline, which represents rivers. I am currently using levelplot to plot the raster and spplot to overlay the polyline and polygon. The polyline is coloured according to the attribute table using the STATUS column - this plots "perennial" status as blue and "ephemeral" status as orange. My code is shown below. This produces a plot with a colorkey for the raster, but I can't work out how to add a key for the polyline. Apologies if this is very obvious but I can't seem to find an answer on any existing threads.
Any help would be much appreciated. 

The code is as follows:
# Read rasterdata_location_DEM1 <- "E:/AGA_ProcessDatasets/DEM_Data/gt30e020n40.tif"iDEM <- raster(data_location_DEM1)
# Read shapefilesioutlineCountry <- readOGR(dsn = "E:/AGA_ProcessDatasets", layer = "UNAfricanCountries_Final_Buffer100m")proj4string(ioutlineCountry) <- CRS("+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0")
irivers <- readOGR(dsn = "E:/AGA_ProcessDatasets/Hydrology_Data", layer = "Rivers_Africa_37333_ForPlotting_Split")proj4string(irivers) <- CRS("+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0")
# define colours for riversrivercolours <- c("orange","blue")
# define colours for DEMcols <- gray.colors(128,start=1,end=0)
# define extents for plottingplotmin <- cellStats(iDEM,stat='min')plotmax <- cellStats(iDEM,stat='max')breaks <- (plotmax - plotmin)/128legendbreaks <- round((plotmax - plotmin)/5,0)scale <- seq(plotmin, plotmax, by=breaks)xmin <- iDEM at extent@xminxmax <- iDEM at extent@xmaxymin <- iDEM at extent@yminymax <- iDEM at extent@ymax
# define output png filefilenamePre = paste(iCountryName,"_Hydrology2.png",sep="")png(filename="Hydrology.png",width=1000,height=486,units="px")
# plot dataa<-levelplot(iDEM,margin=FALSE,xlab="",ylab="",at=scale,col.regions=cols,             colorkey=list(space="right",width=0.75,height=0.75)) +   spplot(irivers,zcol="STATUS",col.regions=rivercolours) +   spplot(ioutlineCountry,zcol="NAME_0",fill="transparent",col="black") # add title to legend a$legend$right <-   list(fun = mergedTrellisLegendGrob(a$legend$right,list(fun = textGrob,args = list("maSL",rot = 0)),vertical = FALSE))
# printprint(a,split=c(1,1,2,1),newpage=FALSE)
dev.off()

 		 	   		  
	[[alternative HTML version deleted]]


From Nicolas.Meurisse at scionresearch.com  Mon Oct 20 06:03:00 2014
From: Nicolas.Meurisse at scionresearch.com (Nicolas Meurisse)
Date: Mon, 20 Oct 2014 17:03:00 +1300
Subject: [R-sig-Geo] sample with varying intensity according to local density
Message-ID: <D05D4B7D92946E468CA98F578A0D739F10E495C41B@v-rot-exch01.scion.local>

Hi all,

I want to sample locations within a defined area, but also optimize the spatial arrangement of my sample locations in order to:

1.       sample some parts of the area more intensively (e.g. as a function of previous findings intensity, as it could be illustrated by a density map)

2.       sample at regular intervals within each area, as opposed to pure random sampling (e.g. "regular" or "stratified random" as defined in sp package)

Here an example dataset:
n <- 10000
x1  <- matrix(rnorm(n), ncol = 2)
x2  <- matrix(rnorm(n, mean = 3, sd = 1.5), ncol = 2)
x   <- rbind(x1, x2)
# scatterplot with smoothed densities color representation
smoothScatter(x)
# random sampling (not appropriate, as we want an arrangement that optimizes conditions 1 and 2)
points(sample(x[,1],20), sample(x[,2],20), col="red", pch=16)

I would greatly appreciate any insight someone might have as it seems there are lot of potential applications using  such "stratified" sampling.

Many thanks !

Nicolas

________________________________


This e-mail and any attachments may contain information ...{{dropped:10}}


From r.turner at auckland.ac.nz  Mon Oct 20 10:09:34 2014
From: r.turner at auckland.ac.nz (Rolf Turner)
Date: Mon, 20 Oct 2014 21:09:34 +1300
Subject: [R-sig-Geo] sample with varying intensity according to local
 density
In-Reply-To: <D05D4B7D92946E468CA98F578A0D739F10E495C41B@v-rot-exch01.scion.local>
References: <D05D4B7D92946E468CA98F578A0D739F10E495C41B@v-rot-exch01.scion.local>
Message-ID: <5444C33E.3010702@auckland.ac.nz>

On 20/10/14 17:03, Nicolas Meurisse wrote:
> Hi all,
>
> I want to sample locations within a defined area, but also optimize
> the spatial arrangement of my sample locations in order to:
>
> 1.       sample some parts of the area more intensively (e.g. as a
> function of previous findings intensity, as it could be illustrated
> by a density map)
>
> 2.       sample at regular intervals within each area, as opposed to
> pure random sampling (e.g. "regular" or "stratified random" as
> defined in sp package)
>
> Here an example dataset:
> n <- 10000
> x1  <- matrix(rnorm(n), ncol = 2)
> x2  <- matrix(rnorm(n, mean = 3, sd = 1.5), ncol = 2)
> x   <- rbind(x1, x2)
> # scatterplot with smoothed densities color representation
> smoothScatter(x)
> # random sampling (not appropriate, as we want an arrangement that optimizes conditions 1 and 2)
> points(sample(x[,1],20), sample(x[,2],20), col="red", pch=16)
>
> I would greatly appreciate any insight someone might have as it seems
> there are lot of potential applications using  such "stratified"
> sampling.

It seems to that desideratum #1 can easily be effected using the rthin()
function from the spatstat package.

I'm not clear what you actually want to do in respect of desideratum #2, 
but it is at least conceivable that this could be effected in the same 
way:  Provide an image or function specifying the intervals (regions?) 
from which you wish to sample.  I.e. make an image (object of class 
"im") or function which takes the value 1 within the regions from which 
you wish to sample and 0 outside those regions.

cheers,

Rolf Turner

-- 
Rolf Turner
Technical Editor ANZJS


From Navinder.Singh at slu.se  Sat Oct 18 01:49:43 2014
From: Navinder.Singh at slu.se (Navinder Singh)
Date: Fri, 17 Oct 2014 23:49:43 +0000
Subject: [R-sig-Geo] Order raster images in a levelplot
Message-ID: <2DEBFCEA-DA32-4593-88C8-FD2DA59012B0@slu.se>

Hi,
Two questions.

1. Does someone have any suggestions on how i can order the sequence of images in a ?levelplot" made using rasterVis.
Specifically, i have months i need to arrange in the normal sequence, as the plot currently aligns them in an alphabetical order. Does ?levelplot? works the same way as xyplots in lattice?

2. Have there been more developments on the zApply function in the raster package? I am trying to make basic statistical summaries for mean monthly (eg. NDVI values) form a multi annual time series.
How does one go about using the ?by" Indexing in this case.

Thanks,


Navinder J Singh
Associate Professor
Department of Wildlife, Fish, and Environmental Studies
Faculty of Forest Sciences
Swedish University of Agricultural Sciences
SE-901 83 Umea, Sweden
O: +46 (0)90 786 8538;
M: +46 (0)70 676 0103
email: navinder.singh at slu.se<mailto:navinder.singh at slu.se>
Web: navinderjsingh.weebly.com<http://navinderjsingh.weebly.com/>






	[[alternative HTML version deleted]]


From tephilippi at gmail.com  Mon Oct 20 18:12:07 2014
From: tephilippi at gmail.com (Tom Philippi)
Date: Mon, 20 Oct 2014 09:12:07 -0700
Subject: [R-sig-Geo] sample with varying intensity according to local
	density
In-Reply-To: <5444C33E.3010702@auckland.ac.nz>
References: <D05D4B7D92946E468CA98F578A0D739F10E495C41B@v-rot-exch01.scion.local>
	<5444C33E.3010702@auckland.ac.nz>
Message-ID: <CALyPt8zrfAezQMcC405oW-S-Hqqs2gGiBsMFgjAESSBeTVwh2A@mail.gmail.com>

Nicholas--
You might also want to consider the spsurvey package (in the spatial task
view or http://cran.r-project.org/web/packages/spsurvey/index.html).  It
supports stratified and unstratified unequal probability independent random
sampling, which is how I interpret your first aspect if it is stand-alone.

If you need #1 and #2 in the same sample design, spsurvey also supports
generalized random tessellation stratified (GRTS) sampling, which is a
slick and useful design that is almost as spatially-balanced or spread as
grid sampling, but is also a probability design, so it works well for both
design-based estimators and model-based estimators such as kriging.  GRTS
samples are also easy to enlarge or reduce if some points are unsampleable,
which isn't possible with grid sampling.  GRTS works for sampling from both
continuous domains (e.g., areas) or finite domains (sets of spatial
locations), and supports stratification as well as unequal probability
sampling within and between strata.  And, the package includes functions
for analyses of the resulting data, including a neighborhood variance
estimator for GRTS.  It might not meet your needs, but I recommend you
consider it.

Tom 2

On Mon, Oct 20, 2014 at 1:09 AM, Rolf Turner <r.turner at auckland.ac.nz>
wrote:

> On 20/10/14 17:03, Nicolas Meurisse wrote:
>
>> Hi all,
>>
>> I want to sample locations within a defined area, but also optimize
>> the spatial arrangement of my sample locations in order to:
>>
>> 1.       sample some parts of the area more intensively (e.g. as a
>> function of previous findings intensity, as it could be illustrated
>> by a density map)
>>
>> 2.       sample at regular intervals within each area, as opposed to
>> pure random sampling (e.g. "regular" or "stratified random" as
>> defined in sp package)
>>
>> Here an example dataset:
>> n <- 10000
>> x1  <- matrix(rnorm(n), ncol = 2)
>> x2  <- matrix(rnorm(n, mean = 3, sd = 1.5), ncol = 2)
>> x   <- rbind(x1, x2)
>> # scatterplot with smoothed densities color representation
>> smoothScatter(x)
>> # random sampling (not appropriate, as we want an arrangement that
>> optimizes conditions 1 and 2)
>> points(sample(x[,1],20), sample(x[,2],20), col="red", pch=16)
>>
>> I would greatly appreciate any insight someone might have as it seems
>> there are lot of potential applications using  such "stratified"
>> sampling.
>>
>
> It seems to that desideratum #1 can easily be effected using the rthin()
> function from the spatstat package.
>
> I'm not clear what you actually want to do in respect of desideratum #2,
> but it is at least conceivable that this could be effected in the same
> way:  Provide an image or function specifying the intervals (regions?) from
> which you wish to sample.  I.e. make an image (object of class "im") or
> function which takes the value 1 within the regions from which you wish to
> sample and 0 outside those regions.
>
> cheers,
>
> Rolf Turner
>
> --
> Rolf Turner
> Technical Editor ANZJS
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From agg18 at pitt.edu  Mon Oct 20 20:21:42 2014
From: agg18 at pitt.edu (alannie)
Date: Mon, 20 Oct 2014 11:21:42 -0700 (PDT)
Subject: [R-sig-Geo] Error In proj4string
Message-ID: <1413829302864-7587305.post@n2.nabble.com>

Hi list!

I have been trying to run some code that I have run tons of times before,
only to get a warning message:

##add in ASCII raster maps bio1-11
> bio1 <- readGDAL("bio1.asc") 
bio1.asc has GDAL driver AAIGrid 
and has 1486 rows and 1347 columns
> bio2 <- readGDAL("bio2.asc") 
bio2.asc has GDAL driver AAIGrid 
and has 1486 rows and 1347 columns
> bio3 <- readGDAL("bio3.asc") 
bio3.asc has GDAL driver AAIGrid 
and has 1486 rows and 1347 columns
> bio4 <- readGDAL("bio4.asc") 
bio4.asc has GDAL driver AAIGrid 
and has 1486 rows and 1347 columns
> bio5 <- readGDAL("bio5.asc") 
bio5.asc has GDAL driver AAIGrid 
and has 1486 rows and 1347 columns
> bio6 <- readGDAL("bio6.asc")
bio6.asc has GDAL driver AAIGrid 
and has 1486 rows and 1347 columns
> bio7 <- readGDAL("bio7.asc")  
bio7.asc has GDAL driver AAIGrid 
and has 1486 rows and 1347 columns
> bio8 <- readGDAL("bio8.asc")
bio8.asc has GDAL driver AAIGrid 
and has 1486 rows and 1347 columns
> bio9 <- readGDAL("bio9.asc")
bio9.asc has GDAL driver AAIGrid 
and has 1486 rows and 1347 columns
> bio10 <- readGDAL("bio10.asc")
bio10.asc has GDAL driver AAIGrid 
and has 1486 rows and 1347 columns
> bio11 <- readGDAL("bio11.asc")
bio11.asc has GDAL driver AAIGrid 
and has 1486 rows and 1347 columns
###combine raster maps
> temp <- cbind("bio1", "bio2", "bio3",
> "bio4","bio5","bio6","bio7","bio8","bio9","bio10","bio11")
> names(temp) <- c("bio1", "bio2", "bio3",
> "bio4","bio5","bio6","bio7","bio8","bio9","bio10","bio11") 
###read in point file lin.shp
> lin <- readShapePoints("lin.shp")
###set proj4strings to the same proj4string: *this is where the issue is*
> proj4string(lin)= proj4string(temp)
*Error in (function (classes, fdef, mtable)  : 
  unable to find an inherited method for function ?proj4string? for
signature ?"matrix"?*
###what is in "temp" ?
> temp
     [,1]   [,2]   [,3]   [,4]   [,5]   [,6]   [,7]   [,8]   [,9]   [,10]  
[,11]  
[1,] "bio1" "bio2" "bio3" "bio4" "bio5" "bio6" "bio7" "bio8" "bio9" "bio10"
"bio11"
attr(,"names")
 [1] "bio1"  "bio2"  "bio3"  "bio4"  "bio5"  "bio6"  "bio7"  "bio8"  "bio9" 
"bio10" "bio11"
> class(temp)
[1] "character"
###end

I am not sure why this issue is occurring. 
I have checked all the projections - all files are in the same projection.
I have restarted R - nothing gets better.
I have tried data for a different organism (it is the same data, but
belonging to a different species) - this does not work.
I have the following packages loaded:
library(maptools)
library(adehabitatHS)
library(SDMTools)
library(spatial)
library(sp)
library(rgdal)
library(dismo)
library(shapefiles)


Thanks, List!

 







--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Error-In-proj4string-tp7587305.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From villers.alexandre at gmail.com  Mon Oct 20 20:46:45 2014
From: villers.alexandre at gmail.com (Alexandre Villers)
Date: Mon, 20 Oct 2014 20:46:45 +0200
Subject: [R-sig-Geo] Error In proj4string
In-Reply-To: <1413829302864-7587305.post@n2.nabble.com>
References: <1413829302864-7587305.post@n2.nabble.com>
Message-ID: <CAFrtd2N_2DXh2n+xiS0uvOc8X+rPVfTTX42KiK4tdFkafBDayQ@mail.gmail.com>

Good evening !

You should either read a bit more about S4 sp object (in particular,
if you want to combine object that have exactly the same structure) or
use the stack function of the raster package
(st.bio<-stack("bio1.asc", bio2.asc", ..., "bio11.asc")).
You can't just cbind() Spatial Objects (someone might correct this
statment if not true). SpatialGridDataFrames as the ones produced with
readGDAL() have a data slot where you can store different vectors of
values.
With some googling, you should find what you are looking for.

HTH

Alex


2014-10-20 20:21 GMT+02:00 alannie <agg18 at pitt.edu>:
> Hi list!
>
> I have been trying to run some code that I have run tons of times before,
> only to get a warning message:
>
> ##add in ASCII raster maps bio1-11
>> bio1 <- readGDAL("bio1.asc")
> bio1.asc has GDAL driver AAIGrid
> and has 1486 rows and 1347 columns
>> bio2 <- readGDAL("bio2.asc")
> bio2.asc has GDAL driver AAIGrid
> and has 1486 rows and 1347 columns
>> bio3 <- readGDAL("bio3.asc")
> bio3.asc has GDAL driver AAIGrid
> and has 1486 rows and 1347 columns
>> bio4 <- readGDAL("bio4.asc")
> bio4.asc has GDAL driver AAIGrid
> and has 1486 rows and 1347 columns
>> bio5 <- readGDAL("bio5.asc")
> bio5.asc has GDAL driver AAIGrid
> and has 1486 rows and 1347 columns
>> bio6 <- readGDAL("bio6.asc")
> bio6.asc has GDAL driver AAIGrid
> and has 1486 rows and 1347 columns
>> bio7 <- readGDAL("bio7.asc")
> bio7.asc has GDAL driver AAIGrid
> and has 1486 rows and 1347 columns
>> bio8 <- readGDAL("bio8.asc")
> bio8.asc has GDAL driver AAIGrid
> and has 1486 rows and 1347 columns
>> bio9 <- readGDAL("bio9.asc")
> bio9.asc has GDAL driver AAIGrid
> and has 1486 rows and 1347 columns
>> bio10 <- readGDAL("bio10.asc")
> bio10.asc has GDAL driver AAIGrid
> and has 1486 rows and 1347 columns
>> bio11 <- readGDAL("bio11.asc")
> bio11.asc has GDAL driver AAIGrid
> and has 1486 rows and 1347 columns
> ###combine raster maps
>> temp <- cbind("bio1", "bio2", "bio3",
>> "bio4","bio5","bio6","bio7","bio8","bio9","bio10","bio11")
>> names(temp) <- c("bio1", "bio2", "bio3",
>> "bio4","bio5","bio6","bio7","bio8","bio9","bio10","bio11")
> ###read in point file lin.shp
>> lin <- readShapePoints("lin.shp")
> ###set proj4strings to the same proj4string: *this is where the issue is*
>> proj4string(lin)= proj4string(temp)
> *Error in (function (classes, fdef, mtable)  :
>   unable to find an inherited method for function ?proj4string? for
> signature ?"matrix"?*
> ###what is in "temp" ?
>> temp
>      [,1]   [,2]   [,3]   [,4]   [,5]   [,6]   [,7]   [,8]   [,9]   [,10]
> [,11]
> [1,] "bio1" "bio2" "bio3" "bio4" "bio5" "bio6" "bio7" "bio8" "bio9" "bio10"
> "bio11"
> attr(,"names")
>  [1] "bio1"  "bio2"  "bio3"  "bio4"  "bio5"  "bio6"  "bio7"  "bio8"  "bio9"
> "bio10" "bio11"
>> class(temp)
> [1] "character"
> ###end
>
> I am not sure why this issue is occurring.
> I have checked all the projections - all files are in the same projection.
> I have restarted R - nothing gets better.
> I have tried data for a different organism (it is the same data, but
> belonging to a different species) - this does not work.
> I have the following packages loaded:
> library(maptools)
> library(adehabitatHS)
> library(SDMTools)
> library(spatial)
> library(sp)
> library(rgdal)
> library(dismo)
> library(shapefiles)
>
>
> Thanks, List!
>
>
>
>
>
>
>
>
>
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Error-In-proj4string-tp7587305.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



-- 
Alexandre Villers, PhD.
Postdoctoral researcher
Team Agripop
CEBC-CNRS, UMR 7372
79360 Beauvoir sur Niort, FR


From edzer.pebesma at uni-muenster.de  Mon Oct 20 20:55:30 2014
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Mon, 20 Oct 2014 20:55:30 +0200
Subject: [R-sig-Geo] Error In proj4string
In-Reply-To: <1413829302864-7587305.post@n2.nabble.com>
References: <1413829302864-7587305.post@n2.nabble.com>
Message-ID: <54455AA2.1010003@uni-muenster.de>

Alannie, you get an error, not a warning, and I doubt this code has ever
worked before. Read on:

On 10/20/2014 08:21 PM, alannie wrote:
> Hi list!
> 
> I have been trying to run some code that I have run tons of times before,
> only to get a warning message:
> 
> ##add in ASCII raster maps bio1-11
>> bio1 <- readGDAL("bio1.asc") 
> bio1.asc has GDAL driver AAIGrid 
> and has 1486 rows and 1347 columns
>> bio2 <- readGDAL("bio2.asc") 
> bio2.asc has GDAL driver AAIGrid 
> and has 1486 rows and 1347 columns
>> bio3 <- readGDAL("bio3.asc") 
> bio3.asc has GDAL driver AAIGrid 
> and has 1486 rows and 1347 columns
>> bio4 <- readGDAL("bio4.asc") 
> bio4.asc has GDAL driver AAIGrid 
> and has 1486 rows and 1347 columns
>> bio5 <- readGDAL("bio5.asc") 
> bio5.asc has GDAL driver AAIGrid 
> and has 1486 rows and 1347 columns
>> bio6 <- readGDAL("bio6.asc")
> bio6.asc has GDAL driver AAIGrid 
> and has 1486 rows and 1347 columns
>> bio7 <- readGDAL("bio7.asc")  
> bio7.asc has GDAL driver AAIGrid 
> and has 1486 rows and 1347 columns
>> bio8 <- readGDAL("bio8.asc")
> bio8.asc has GDAL driver AAIGrid 
> and has 1486 rows and 1347 columns
>> bio9 <- readGDAL("bio9.asc")
> bio9.asc has GDAL driver AAIGrid 
> and has 1486 rows and 1347 columns
>> bio10 <- readGDAL("bio10.asc")
> bio10.asc has GDAL driver AAIGrid 
> and has 1486 rows and 1347 columns
>> bio11 <- readGDAL("bio11.asc")
> bio11.asc has GDAL driver AAIGrid 
> and has 1486 rows and 1347 columns
> ###combine raster maps
>> temp <- cbind("bio1", "bio2", "bio3",
>> "bio4","bio5","bio6","bio7","bio8","bio9","bio10","bio11")

You are cbind-ing length-one character vectors, but you probably want to:

temp <- cbind(bio1, bio2, bio3) # etc

i.e. cbind-ing the SpatialGridDataFrame objects. Indeed,

> library(sp)
> methods(cbind)
[1] cbind.data.frame            cbind.SpatialGridDataFrame*
[3] cbind.ts*

sp provides a method for this. After this, the rest should work.

>> names(temp) <- c("bio1", "bio2", "bio3",
>> "bio4","bio5","bio6","bio7","bio8","bio9","bio10","bio11") 
> ###read in point file lin.shp
>> lin <- readShapePoints("lin.shp")
> ###set proj4strings to the same proj4string: *this is where the issue is*
>> proj4string(lin)= proj4string(temp)
> *Error in (function (classes, fdef, mtable)  : 
>   unable to find an inherited method for function ?proj4string? for
> signature ?"matrix"?*
> ###what is in "temp" ?
>> temp
>      [,1]   [,2]   [,3]   [,4]   [,5]   [,6]   [,7]   [,8]   [,9]   [,10]  
> [,11]  
> [1,] "bio1" "bio2" "bio3" "bio4" "bio5" "bio6" "bio7" "bio8" "bio9" "bio10"
> "bio11"
> attr(,"names")
>  [1] "bio1"  "bio2"  "bio3"  "bio4"  "bio5"  "bio6"  "bio7"  "bio8"  "bio9" 
> "bio10" "bio11"
>> class(temp)
> [1] "character"
> ###end
> 
> I am not sure why this issue is occurring. 
> I have checked all the projections - all files are in the same projection.
> I have restarted R - nothing gets better.
> I have tried data for a different organism (it is the same data, but
> belonging to a different species) - this does not work.
> I have the following packages loaded:
> library(maptools)
> library(adehabitatHS)
> library(SDMTools)
> library(spatial)
> library(sp)
> library(rgdal)
> library(dismo)
> library(shapefiles)
> 
> 
> Thanks, List!
> 
>  
> 
> 
> 
> 
> 
> 
> 
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Error-In-proj4string-tp7587305.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma,  Co-Editor-in-Chief Computers & Geosciences
Institute for Geoinformatics (ifgi), University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
83 33081 http://ifgi.uni-muenster.de GPG key ID 0xAC227795

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 490 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20141020/ae324244/attachment.bin>

From agg18 at pitt.edu  Mon Oct 20 21:09:57 2014
From: agg18 at pitt.edu (alannie)
Date: Mon, 20 Oct 2014 12:09:57 -0700 (PDT)
Subject: [R-sig-Geo] Error In proj4string
In-Reply-To: <54455AA2.1010003@uni-muenster.de>
References: <1413829302864-7587305.post@n2.nabble.com>
	<54455AA2.1010003@uni-muenster.de>
Message-ID: <1413832155458.46900@pitt.edu>

Thanks, Ebzer!


I see the issue now. I have no idea how my code became messed up that way. You are 100% correct, as the correct version that you provided is what has worked in the past and not the cbind("bio1","bio2").


Appreciate your response!

Alannie

________________________________
From: edzer [via R-sig-geo] <ml-node+s2731867n7587307h51 at n2.nabble.com>
Sent: Monday, October 20, 2014 2:57 PM
To: Grant, Alannie Grace Gabrielle
Subject: Re: Error In proj4string

Alannie, you get an error, not a warning, and I doubt this code has ever
worked before. Read on:

On 10/20/2014 08:21 PM, alannie wrote:

> Hi list!
>
> I have been trying to run some code that I have run tons of times before,
> only to get a warning message:
>
> ##add in ASCII raster maps bio1-11
>> bio1 <- readGDAL("bio1.asc")
> bio1.asc has GDAL driver AAIGrid
> and has 1486 rows and 1347 columns
>> bio2 <- readGDAL("bio2.asc")
> bio2.asc has GDAL driver AAIGrid
> and has 1486 rows and 1347 columns
>> bio3 <- readGDAL("bio3.asc")
> bio3.asc has GDAL driver AAIGrid
> and has 1486 rows and 1347 columns
>> bio4 <- readGDAL("bio4.asc")
> bio4.asc has GDAL driver AAIGrid
> and has 1486 rows and 1347 columns
>> bio5 <- readGDAL("bio5.asc")
> bio5.asc has GDAL driver AAIGrid
> and has 1486 rows and 1347 columns
>> bio6 <- readGDAL("bio6.asc")
> bio6.asc has GDAL driver AAIGrid
> and has 1486 rows and 1347 columns
>> bio7 <- readGDAL("bio7.asc")
> bio7.asc has GDAL driver AAIGrid
> and has 1486 rows and 1347 columns
>> bio8 <- readGDAL("bio8.asc")
> bio8.asc has GDAL driver AAIGrid
> and has 1486 rows and 1347 columns
>> bio9 <- readGDAL("bio9.asc")
> bio9.asc has GDAL driver AAIGrid
> and has 1486 rows and 1347 columns
>> bio10 <- readGDAL("bio10.asc")
> bio10.asc has GDAL driver AAIGrid
> and has 1486 rows and 1347 columns
>> bio11 <- readGDAL("bio11.asc")
> bio11.asc has GDAL driver AAIGrid
> and has 1486 rows and 1347 columns
> ###combine raster maps
>> temp <- cbind("bio1", "bio2", "bio3",
>> "bio4","bio5","bio6","bio7","bio8","bio9","bio10","bio11")
You are cbind-ing length-one character vectors, but you probably want to:

temp <- cbind(bio1, bio2, bio3) # etc

i.e. cbind-ing the SpatialGridDataFrame objects. Indeed,

> library(sp)
> methods(cbind)
[1] cbind.data.frame            cbind.SpatialGridDataFrame*
[3] cbind.ts*

sp provides a method for this. After this, the rest should work.

>> names(temp) <- c("bio1", "bio2", "bio3",
>> "bio4","bio5","bio6","bio7","bio8","bio9","bio10","bio11")
> ###read in point file lin.shp
>> lin <- readShapePoints("lin.shp")
> ###set proj4strings to the same proj4string: *this is where the issue is*
>> proj4string(lin)= proj4string(temp)
> *Error in (function (classes, fdef, mtable)  :
>   unable to find an inherited method for function ?proj4string? for
> signature ?"matrix"?*
> ###what is in "temp" ?
>> temp
>      [,1]   [,2]   [,3]   [,4]   [,5]   [,6]   [,7]   [,8]   [,9]   [,10]
> [,11]
> [1,] "bio1" "bio2" "bio3" "bio4" "bio5" "bio6" "bio7" "bio8" "bio9" "bio10"
> "bio11"
> attr(,"names")
>  [1] "bio1"  "bio2"  "bio3"  "bio4"  "bio5"  "bio6"  "bio7"  "bio8"  "bio9"
> "bio10" "bio11"
>> class(temp)
> [1] "character"
> ###end
>
> I am not sure why this issue is occurring.
> I have checked all the projections - all files are in the same projection.
> I have restarted R - nothing gets better.
> I have tried data for a different organism (it is the same data, but
> belonging to a different species) - this does not work.
> I have the following packages loaded:
> library(maptools)
> library(adehabitatHS)
> library(SDMTools)
> library(spatial)
> library(sp)
> library(rgdal)
> library(dismo)
> library(shapefiles)
>
>
> Thanks, List!
>
>
>
>
>
>
>
>
>
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Error-In-proj4string-tp7587305.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
>
> _______________________________________________
> R-sig-Geo mailing list
> [hidden email]</user/SendEmail.jtp?type=node&node=7587307&i=0>
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
--
Edzer Pebesma,  Co-Editor-in-Chief Computers & Geosciences
Institute for Geoinformatics (ifgi), University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
83 33081 http://ifgi.uni-muenster.de GPG key ID 0xAC227795


_______________________________________________
R-sig-Geo mailing list
[hidden email]</user/SendEmail.jtp?type=node&node=7587307&i=1>
https://stat.ethz.ch/mailman/listinfo/r-sig-geo

[http://r-sig-geo.2731867.n2.nabble.com/images/icon_attachment.gif] signature.asc (501 bytes) Download Attachment<http://r-sig-geo.2731867.n2.nabble.com/attachment/7587307/0/signature.asc>


________________________________
If you reply to this email, your message will be added to the discussion below:
http://r-sig-geo.2731867.n2.nabble.com/Error-In-proj4string-tp7587305p7587307.html
To start a new topic under R-sig-geo, email ml-node+s2731867n2731867h11 at n2.nabble.com
To unsubscribe from Error In proj4string, click here<http://r-sig-geo.2731867.n2.nabble.com/template/NamlServlet.jtp?macro=unsubscribe_by_code&node=7587305&code=YWdnMThAcGl0dC5lZHV8NzU4NzMwNXwtMjAxOTYzNDk0MQ==>.
NAML<http://r-sig-geo.2731867.n2.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&id=instant_html%21nabble%3Aemail.naml&base=nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.NodeNamespace&breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml>




--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Error-In-proj4string-tp7587305p7587308.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From tephilippi at gmail.com  Mon Oct 20 21:10:13 2014
From: tephilippi at gmail.com (Tom Philippi)
Date: Mon, 20 Oct 2014 12:10:13 -0700
Subject: [R-sig-Geo] Error In proj4string
In-Reply-To: <1413829302864-7587305.post@n2.nabble.com>
References: <1413829302864-7587305.post@n2.nabble.com>
Message-ID: <CALyPt8xKKHpy4-7R1w3vYBEjEuLwHV4-9A=UVMvBadwsfk-D=g@mail.gmail.com>

Without more information, we can't give you a definitive answer.

Try removing the quotes from your cbind.
temp <- cbind(bio1, bio2, bio3,
           bio4, bio5, bio6, bio7, bio8, bio9, bio10, bio11)

Another possibility is that one or more of your 11 grids has a different
topology, although that might throw an error at cbind rather than produce a
different class of object.

You might consider the raster package, as I think you are attempting to
stack the grid values into a raster brick or raster stack.

I hope that this helps...

Tom 2


On Mon, Oct 20, 2014 at 11:21 AM, alannie <agg18 at pitt.edu> wrote:

> Hi list!
>
> I have been trying to run some code that I have run tons of times before,
> only to get a warning message:
>
> ##add in ASCII raster maps bio1-11
> > bio1 <- readGDAL("bio1.asc")
> bio1.asc has GDAL driver AAIGrid
> and has 1486 rows and 1347 columns
> > bio2 <- readGDAL("bio2.asc")
> bio2.asc has GDAL driver AAIGrid
> and has 1486 rows and 1347 columns
> > bio3 <- readGDAL("bio3.asc")
> bio3.asc has GDAL driver AAIGrid
> and has 1486 rows and 1347 columns
> > bio4 <- readGDAL("bio4.asc")
> bio4.asc has GDAL driver AAIGrid
> and has 1486 rows and 1347 columns
> > bio5 <- readGDAL("bio5.asc")
> bio5.asc has GDAL driver AAIGrid
> and has 1486 rows and 1347 columns
> > bio6 <- readGDAL("bio6.asc")
> bio6.asc has GDAL driver AAIGrid
> and has 1486 rows and 1347 columns
> > bio7 <- readGDAL("bio7.asc")
> bio7.asc has GDAL driver AAIGrid
> and has 1486 rows and 1347 columns
> > bio8 <- readGDAL("bio8.asc")
> bio8.asc has GDAL driver AAIGrid
> and has 1486 rows and 1347 columns
> > bio9 <- readGDAL("bio9.asc")
> bio9.asc has GDAL driver AAIGrid
> and has 1486 rows and 1347 columns
> > bio10 <- readGDAL("bio10.asc")
> bio10.asc has GDAL driver AAIGrid
> and has 1486 rows and 1347 columns
> > bio11 <- readGDAL("bio11.asc")
> bio11.asc has GDAL driver AAIGrid
> and has 1486 rows and 1347 columns
> ###combine raster maps
> > temp <- cbind("bio1", "bio2", "bio3",
> > "bio4","bio5","bio6","bio7","bio8","bio9","bio10","bio11")
> > names(temp) <- c("bio1", "bio2", "bio3",
> > "bio4","bio5","bio6","bio7","bio8","bio9","bio10","bio11")
> ###read in point file lin.shp
> > lin <- readShapePoints("lin.shp")
> ###set proj4strings to the same proj4string: *this is where the issue is*
> > proj4string(lin)= proj4string(temp)
> *Error in (function (classes, fdef, mtable)  :
>   unable to find an inherited method for function ?proj4string? for
> signature ?"matrix"?*
> ###what is in "temp" ?
> > temp
>      [,1]   [,2]   [,3]   [,4]   [,5]   [,6]   [,7]   [,8]   [,9]   [,10]
> [,11]
> [1,] "bio1" "bio2" "bio3" "bio4" "bio5" "bio6" "bio7" "bio8" "bio9" "bio10"
> "bio11"
> attr(,"names")
>  [1] "bio1"  "bio2"  "bio3"  "bio4"  "bio5"  "bio6"  "bio7"  "bio8"  "bio9"
> "bio10" "bio11"
> > class(temp)
> [1] "character"
> ###end
>
> I am not sure why this issue is occurring.
> I have checked all the projections - all files are in the same projection.
> I have restarted R - nothing gets better.
> I have tried data for a different organism (it is the same data, but
> belonging to a different species) - this does not work.
> I have the following packages loaded:
> library(maptools)
> library(adehabitatHS)
> library(SDMTools)
> library(spatial)
> library(sp)
> library(rgdal)
> library(dismo)
> library(shapefiles)
>
>
> Thanks, List!
>
>
>
>
>
>
>
>
>
> --
> View this message in context:
> http://r-sig-geo.2731867.n2.nabble.com/Error-In-proj4string-tp7587305.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From agg18 at pitt.edu  Mon Oct 20 21:16:50 2014
From: agg18 at pitt.edu (alannie)
Date: Mon, 20 Oct 2014 12:16:50 -0700 (PDT)
Subject: [R-sig-Geo] Error In proj4string
In-Reply-To: <CAFrtd2N_2DXh2n+xiS0uvOc8X+rPVfTTX42KiK4tdFkafBDayQ@mail.gmail.com>
References: <1413829302864-7587305.post@n2.nabble.com>
	<CAFrtd2N_2DXh2n+xiS0uvOc8X+rPVfTTX42KiK4tdFkafBDayQ@mail.gmail.com>
Message-ID: <1413832595594.15282@pitt.edu>

Thanks Alexandre!


I was able to get the assistance for this issue. I have never used the stack function, but I will try it since it is such a pain to deal with memory an rasters.


Thanks again!


Alannie

________________________________
From: Alexandre Villers-2 [via R-sig-geo] <ml-node+s2731867n7587306h20 at n2.nabble.com>
Sent: Monday, October 20, 2014 2:47 PM
To: Grant, Alannie Grace Gabrielle
Subject: Re: Error In proj4string

Good evening !

You should either read a bit more about S4 sp object (in particular,
if you want to combine object that have exactly the same structure) or
use the stack function of the raster package
(st.bio<-stack("bio1.asc", bio2.asc", ..., "bio11.asc")).
You can't just cbind() Spatial Objects (someone might correct this
statment if not true). SpatialGridDataFrames as the ones produced with
readGDAL() have a data slot where you can store different vectors of
values.
With some googling, you should find what you are looking for.

HTH

Alex


2014-10-20 20:21 GMT+02:00 alannie <[hidden email]</user/SendEmail.jtp?type=node&node=7587306&i=0>>:

> Hi list!
>
> I have been trying to run some code that I have run tons of times before,
> only to get a warning message:
>
> ##add in ASCII raster maps bio1-11
>> bio1 <- readGDAL("bio1.asc")
> bio1.asc has GDAL driver AAIGrid
> and has 1486 rows and 1347 columns
>> bio2 <- readGDAL("bio2.asc")
> bio2.asc has GDAL driver AAIGrid
> and has 1486 rows and 1347 columns
>> bio3 <- readGDAL("bio3.asc")
> bio3.asc has GDAL driver AAIGrid
> and has 1486 rows and 1347 columns
>> bio4 <- readGDAL("bio4.asc")
> bio4.asc has GDAL driver AAIGrid
> and has 1486 rows and 1347 columns
>> bio5 <- readGDAL("bio5.asc")
> bio5.asc has GDAL driver AAIGrid
> and has 1486 rows and 1347 columns
>> bio6 <- readGDAL("bio6.asc")
> bio6.asc has GDAL driver AAIGrid
> and has 1486 rows and 1347 columns
>> bio7 <- readGDAL("bio7.asc")
> bio7.asc has GDAL driver AAIGrid
> and has 1486 rows and 1347 columns
>> bio8 <- readGDAL("bio8.asc")
> bio8.asc has GDAL driver AAIGrid
> and has 1486 rows and 1347 columns
>> bio9 <- readGDAL("bio9.asc")
> bio9.asc has GDAL driver AAIGrid
> and has 1486 rows and 1347 columns
>> bio10 <- readGDAL("bio10.asc")
> bio10.asc has GDAL driver AAIGrid
> and has 1486 rows and 1347 columns
>> bio11 <- readGDAL("bio11.asc")
> bio11.asc has GDAL driver AAIGrid
> and has 1486 rows and 1347 columns
> ###combine raster maps
>> temp <- cbind("bio1", "bio2", "bio3",
>> "bio4","bio5","bio6","bio7","bio8","bio9","bio10","bio11")
>> names(temp) <- c("bio1", "bio2", "bio3",
>> "bio4","bio5","bio6","bio7","bio8","bio9","bio10","bio11")
> ###read in point file lin.shp
>> lin <- readShapePoints("lin.shp")
> ###set proj4strings to the same proj4string: *this is where the issue is*
>> proj4string(lin)= proj4string(temp)
> *Error in (function (classes, fdef, mtable)  :
>   unable to find an inherited method for function ?proj4string? for
> signature ?"matrix"?*
> ###what is in "temp" ?
>> temp
>      [,1]   [,2]   [,3]   [,4]   [,5]   [,6]   [,7]   [,8]   [,9]   [,10]
> [,11]
> [1,] "bio1" "bio2" "bio3" "bio4" "bio5" "bio6" "bio7" "bio8" "bio9" "bio10"
> "bio11"
> attr(,"names")
>  [1] "bio1"  "bio2"  "bio3"  "bio4"  "bio5"  "bio6"  "bio7"  "bio8"  "bio9"
> "bio10" "bio11"
>> class(temp)
> [1] "character"
> ###end
>
> I am not sure why this issue is occurring.
> I have checked all the projections - all files are in the same projection.
> I have restarted R - nothing gets better.
> I have tried data for a different organism (it is the same data, but
> belonging to a different species) - this does not work.
> I have the following packages loaded:
> library(maptools)
> library(adehabitatHS)
> library(SDMTools)
> library(spatial)
> library(sp)
> library(rgdal)
> library(dismo)
> library(shapefiles)
>
>
> Thanks, List!
>
>
>
>
>
>
>
>
>
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Error-In-proj4string-tp7587305.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
>
> _______________________________________________
> R-sig-Geo mailing list
> [hidden email]</user/SendEmail.jtp?type=node&node=7587306&i=1>
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



--
Alexandre Villers, PhD.
Postdoctoral researcher
Team Agripop
CEBC-CNRS, UMR 7372
79360 Beauvoir sur Niort, FR

_______________________________________________
R-sig-Geo mailing list
[hidden email]</user/SendEmail.jtp?type=node&node=7587306&i=2>
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


________________________________
If you reply to this email, your message will be added to the discussion below:
http://r-sig-geo.2731867.n2.nabble.com/Error-In-proj4string-tp7587305p7587306.html
To start a new topic under R-sig-geo, email ml-node+s2731867n2731867h11 at n2.nabble.com
To unsubscribe from Error In proj4string, click here<http://r-sig-geo.2731867.n2.nabble.com/template/NamlServlet.jtp?macro=unsubscribe_by_code&node=7587305&code=YWdnMThAcGl0dC5lZHV8NzU4NzMwNXwtMjAxOTYzNDk0MQ==>.
NAML<http://r-sig-geo.2731867.n2.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&id=instant_html%21nabble%3Aemail.naml&base=nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.NodeNamespace&breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml>




--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Error-In-proj4string-tp7587305p7587310.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From l.hilger at ku.de  Mon Oct 20 21:44:57 2014
From: l.hilger at ku.de (Ludwig Hilger)
Date: Mon, 20 Oct 2014 12:44:57 -0700 (PDT)
Subject: [R-sig-Geo] Error In proj4string
In-Reply-To: <1413829302864-7587305.post@n2.nabble.com>
References: <1413829302864-7587305.post@n2.nabble.com>
Message-ID: <5445662D.4050407@ku.de>

Hi,

i guess it is not working because temp is class character and therefore 
does not have a spatial reference slot. I would use the raster package 
to combine all these layers.

regards,
Ludwig

Am 20.10.2014 20:21, schrieb alannie [via R-sig-geo]:
> Hi list!
>
> I have been trying to run some code that I have run tons of times 
> before, only to get a warning message:
>
> ##add in ASCII raster maps bio1-11
> > bio1 <- readGDAL("bio1.asc")
> bio1.asc has GDAL driver AAIGrid
> and has 1486 rows and 1347 columns
> > bio2 <- readGDAL("bio2.asc")
> bio2.asc has GDAL driver AAIGrid
> and has 1486 rows and 1347 columns
> > bio3 <- readGDAL("bio3.asc")
> bio3.asc has GDAL driver AAIGrid
> and has 1486 rows and 1347 columns
> > bio4 <- readGDAL("bio4.asc")
> bio4.asc has GDAL driver AAIGrid
> and has 1486 rows and 1347 columns
> > bio5 <- readGDAL("bio5.asc")
> bio5.asc has GDAL driver AAIGrid
> and has 1486 rows and 1347 columns
> > bio6 <- readGDAL("bio6.asc")
> bio6.asc has GDAL driver AAIGrid
> and has 1486 rows and 1347 columns
> > bio7 <- readGDAL("bio7.asc")
> bio7.asc has GDAL driver AAIGrid
> and has 1486 rows and 1347 columns
> > bio8 <- readGDAL("bio8.asc")
> bio8.asc has GDAL driver AAIGrid
> and has 1486 rows and 1347 columns
> > bio9 <- readGDAL("bio9.asc")
> bio9.asc has GDAL driver AAIGrid
> and has 1486 rows and 1347 columns
> > bio10 <- readGDAL("bio10.asc")
> bio10.asc has GDAL driver AAIGrid
> and has 1486 rows and 1347 columns
> > bio11 <- readGDAL("bio11.asc")
> bio11.asc has GDAL driver AAIGrid
> and has 1486 rows and 1347 columns
> ###combine raster maps
> > temp <- cbind("bio1", "bio2", "bio3", 
> "bio4","bio5","bio6","bio7","bio8","bio9","bio10","bio11")
> > names(temp) <- c("bio1", "bio2", "bio3", 
> "bio4","bio5","bio6","bio7","bio8","bio9","bio10","bio11")
> ###read in point file lin.shp
> > lin <- readShapePoints("lin.shp")
> ###set proj4strings to the same proj4string: *this is where the issue is*
> > proj4string(lin)= proj4string(temp)
> *Error in (function (classes, fdef, mtable)  :
>   unable to find an inherited method for function ?proj4string? for 
> signature ?"matrix"?*
> ###what is in "temp" ?
> > temp
>      [,1]   [,2]   [,3]   [,4]   [,5]   [,6]   [,7]   [,8]   [,9]   
> [,10]   [,11]
> [1,] "bio1" "bio2" "bio3" "bio4" "bio5" "bio6" "bio7" "bio8" "bio9" 
> "bio10" "bio11"
> attr(,"names")
>  [1] "bio1"  "bio2"  "bio3"  "bio4"  "bio5"  "bio6"  "bio7"  "bio8" 
>  "bio9"  "bio10" "bio11"
> > class(temp)
> [1] "character"
> ###end
>
> I am not sure why this issue is occurring.
> I have checked all the projections - all files are in the same 
> projection.
> I have restarted R - nothing gets better.
> I have tried data for a different organism (it is the same data, but 
> belonging to a different species) - this does not work.
> I have the following packages loaded:
> library(maptools)
> library(adehabitatHS)
> library(SDMTools)
> library(spatial)
> library(sp)
> library(rgdal)
> library(dismo)
> library(shapefiles)
>
>
> Thanks, List!
>
>
>
>
>
>
>
> ------------------------------------------------------------------------
> If you reply to this email, your message will be added to the 
> discussion below:
> http://r-sig-geo.2731867.n2.nabble.com/Error-In-proj4string-tp7587305.html 
>
> To unsubscribe from R-sig-geo, click here 
> <http://r-sig-geo.2731867.n2.nabble.com/template/NamlServlet.jtp?macro=unsubscribe_by_code&node=2731867&code=bC5oaWxnZXJAa3UuZGV8MjczMTg2N3wtODM0Mzg5NjIw>.
> NAML 
> <http://r-sig-geo.2731867.n2.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&id=instant_html%21nabble%3Aemail.naml&base=nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.NodeNamespace&breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml> 
>

-- 
Dipl. Geogr. Ludwig Hilger
Wiss. MA
Lehrstuhl f?r Physische Geographie
Katholische Universit?t Eichst?tt-Ingolstadt
Ostenstra?e 18
85072 Eichst?tt

Tel.: 08421-93-23011





-----
Dipl. Geogr. Ludwig Hilger
Wiss. MA
Lehrstuhl f?r Physische Geographie
Katholische Universit?t Eichst?tt-Ingolstadt
Ostenstra?e 18
85072 Eichst?tt

Tel.: 08421-93-1180 
--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Error-In-proj4string-tp7587305p7587311.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From agg18 at pitt.edu  Mon Oct 20 23:20:09 2014
From: agg18 at pitt.edu (alannie)
Date: Mon, 20 Oct 2014 14:20:09 -0700 (PDT)
Subject: [R-sig-Geo] Error In proj4string
In-Reply-To: <5445662D.4050407@ku.de>
References: <1413829302864-7587305.post@n2.nabble.com> <5445662D.4050407@ku.de>
Message-ID: <1413839981895.68946@pitt.edu>

Thanks Ludwig!


I will see if I can fix that.


Alannie

________________________________
From: Ludwig Hilger [via R-sig-geo] <ml-node+s2731867n7587311h75 at n2.nabble.com>
Sent: Monday, October 20, 2014 3:44 PM
To: Grant, Alannie Grace Gabrielle
Subject: Re: Error In proj4string

Hi,

i guess it is not working because temp is class character and therefore does not have a spatial reference slot. I would use the raster package to combine all these layers.

regards,
Ludwig

Am 20.10.2014 20:21, schrieb alannie [via R-sig-geo]:
Hi list!

I have been trying to run some code that I have run tons of times before, only to get a warning message:

##add in ASCII raster maps bio1-11
> bio1 <- readGDAL("bio1.asc")
bio1.asc has GDAL driver AAIGrid
and has 1486 rows and 1347 columns
> bio2 <- readGDAL("bio2.asc")
bio2.asc has GDAL driver AAIGrid
and has 1486 rows and 1347 columns
> bio3 <- readGDAL("bio3.asc")
bio3.asc has GDAL driver AAIGrid
and has 1486 rows and 1347 columns
> bio4 <- readGDAL("bio4.asc")
bio4.asc has GDAL driver AAIGrid
and has 1486 rows and 1347 columns
> bio5 <- readGDAL("bio5.asc")
bio5.asc has GDAL driver AAIGrid
and has 1486 rows and 1347 columns
> bio6 <- readGDAL("bio6.asc")
bio6.asc has GDAL driver AAIGrid
and has 1486 rows and 1347 columns
> bio7 <- readGDAL("bio7.asc")
bio7.asc has GDAL driver AAIGrid
and has 1486 rows and 1347 columns
> bio8 <- readGDAL("bio8.asc")
bio8.asc has GDAL driver AAIGrid
and has 1486 rows and 1347 columns
> bio9 <- readGDAL("bio9.asc")
bio9.asc has GDAL driver AAIGrid
and has 1486 rows and 1347 columns
> bio10 <- readGDAL("bio10.asc")
bio10.asc has GDAL driver AAIGrid
and has 1486 rows and 1347 columns
> bio11 <- readGDAL("bio11.asc")
bio11.asc has GDAL driver AAIGrid
and has 1486 rows and 1347 columns
###combine raster maps
> temp <- cbind("bio1", "bio2", "bio3", "bio4","bio5","bio6","bio7","bio8","bio9","bio10","bio11")
> names(temp) <- c("bio1", "bio2", "bio3", "bio4","bio5","bio6","bio7","bio8","bio9","bio10","bio11")
###read in point file lin.shp
> lin <- readShapePoints("lin.shp")
###set proj4strings to the same proj4string: this is where the issue is
> proj4string(lin)= proj4string(temp)
Error in (function (classes, fdef, mtable)  :
  unable to find an inherited method for function ?proj4string? for signature ?"matrix"?
###what is in "temp" ?
> temp
     [,1]   [,2]   [,3]   [,4]   [,5]   [,6]   [,7]   [,8]   [,9]   [,10]   [,11]
[1,] "bio1" "bio2" "bio3" "bio4" "bio5" "bio6" "bio7" "bio8" "bio9" "bio10" "bio11"
attr(,"names")
 [1] "bio1"  "bio2"  "bio3"  "bio4"  "bio5"  "bio6"  "bio7"  "bio8"  "bio9"  "bio10" "bio11"
> class(temp)
[1] "character"
###end

I am not sure why this issue is occurring.
I have checked all the projections - all files are in the same projection.
I have restarted R - nothing gets better.
I have tried data for a different organism (it is the same data, but belonging to a different species) - this does not work.
I have the following packages loaded:
library(maptools)
library(adehabitatHS)
library(SDMTools)
library(spatial)
library(sp)
library(rgdal)
library(dismo)
library(shapefiles)


Thanks, List!







________________________________
If you reply to this email, your message will be added to the discussion below:
http://r-sig-geo.2731867.n2.nabble.com/Error-In-proj4string-tp7587305.html
To unsubscribe from R-sig-geo, click here.
NAML<http://r-sig-geo.2731867.n2.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&id=instant_html%21nabble%3Aemail.naml&base=nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.NodeNamespace&breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml>


--
Dipl. Geogr. Ludwig Hilger
Wiss. MA
Lehrstuhl f?r Physische Geographie
Katholische Universit?t Eichst?tt-Ingolstadt
Ostenstra?e 18
85072 Eichst?tt

Tel.: 08421-93-23011

Dipl. Geogr. Ludwig Hilger
Wiss. MA
Lehrstuhl f?r Physische Geographie
Katholische Universit?t Eichst?tt-Ingolstadt
Ostenstra?e 18
85072 Eichst?tt

Tel.: 08421-93-1180


________________________________
If you reply to this email, your message will be added to the discussion below:
http://r-sig-geo.2731867.n2.nabble.com/Error-In-proj4string-tp7587305p7587311.html
To start a new topic under R-sig-geo, email ml-node+s2731867n2731867h11 at n2.nabble.com
To unsubscribe from Error In proj4string, click here<http://r-sig-geo.2731867.n2.nabble.com/template/NamlServlet.jtp?macro=unsubscribe_by_code&node=7587305&code=YWdnMThAcGl0dC5lZHV8NzU4NzMwNXwtMjAxOTYzNDk0MQ==>.
NAML<http://r-sig-geo.2731867.n2.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&id=instant_html%21nabble%3Aemail.naml&base=nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.NodeNamespace&breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml>




--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Error-In-proj4string-tp7587305p7587312.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From oscar.perpinan at upm.es  Tue Oct 21 07:45:50 2014
From: oscar.perpinan at upm.es (Oscar =?utf-8?B?UGVycGnDscOhbg==?= Lamigueiro)
Date: Tue, 21 Oct 2014 07:45:50 +0200
Subject: [R-sig-Geo] Multiple legends with levelplot and spplot
In-Reply-To: <DUB122-W11949F0D0DE44AC9589092B8A80@phx.gbl>
References: <DUB122-W11949F0D0DE44AC9589092B8A80@phx.gbl>
Message-ID: <87r3y2ht45.fsf@upm.es>

Hello,

You could try to define the legend for the Spatial* object inside the
levelplot call using the `key` argument. For example:

library(sp)
library(raster)
library(rasterVis)

f <- system.file("external/test.grd", package="raster")
r <- raster(f)

data(meuse)
coordinates(meuse) = c("x", "y")
meuse$class <- cut(meuse$zinc, 3)

ptsCols <- c('black', 'red', 'blue')

lvp <- levelplot(r, margin = FALSE,
                 ## Define the legend for the spplot graphic
                 key = list(space = 'top', text = list(levels(meuse$class)),
                     points = list(pch = 21, fill = ptsCols)),
                 ## Legend for the Raster object
                 colorkey=list(space="right",width=0.75,height=0.75))

spp <- spplot(meuse["class"], col.regions = ptsCols)

lvp + spp


Best,

Oscar.
-- 
Oscar Perpi??n Lamigueiro
Dpto. Ingenier?a El?ctrica (ETSIDI-UPM)
Grupo de Sistemas Fotovoltaicos (IES-UPM)
URL: http://oscarperpinan.github.io


From oscar.perpinan at upm.es  Tue Oct 21 07:50:27 2014
From: oscar.perpinan at upm.es (Oscar =?utf-8?B?UGVycGnDscOhbg==?= Lamigueiro)
Date: Tue, 21 Oct 2014 07:50:27 +0200
Subject: [R-sig-Geo] Order raster images in a levelplot
In-Reply-To: <2DEBFCEA-DA32-4593-88C8-FD2DA59012B0@slu.se>
References: <2DEBFCEA-DA32-4593-88C8-FD2DA59012B0@slu.se>
Message-ID: <87ppdmhsrb.fsf@upm.es>

Hi,

> 1. Does someone have any suggestions on how i can order the sequence
> of images in a ?levelplot" made using rasterVis.  Specifically, i
> have months i need to arrange in the normal sequence, as the plot
> currently aligns them in an alphabetical order. Does ?levelplot?
> works the same way as xyplots in lattice?

levelplot methods defined in rasterVis are based on lattice graphics. 
Most of the arguments provided by lattice::xyplot and
lattice::levelplot are also available. For this issue you could try
these arguments: perm.cond, index.cond, as.table. All of them are
described in the help page of lattice::xyplot.

> 2. Have there been more developments on the zApply function in the
> raster package? I am trying to make basic statistical summaries for
> mean monthly (eg. NDVI values) form a multi annual time series.  How
> does one go about using the ?by" Indexing in this case.

Could you post a reproducible example? I have used zApply for similar
tasks without problems.

Best,

Oscar.

-- 
Oscar Perpi??n Lamigueiro
Dpto. Ingenier?a El?ctrica (ETSIDI-UPM)
Grupo de Sistemas Fotovoltaicos (IES-UPM)
URL: http://oscarperpinan.github.io


From jh.eco.cas at gmail.com  Tue Oct 21 08:40:00 2014
From: jh.eco.cas at gmail.com (Jianhua Huang)
Date: Mon, 20 Oct 2014 23:40:00 -0700
Subject: [R-sig-Geo] weird ncdf4 output 9.969210e+36
Message-ID: <00e501cfecf9$d7842fd0$868c8f70$@gmail.com>

Hi All:

 

I am trying to create a 3 dimensional (200*200*8760) netCdf file using the
ncdf4 package. Everything goes fine, except some unexpected outputs. Here is
tail of the result in one grid cell. I cbind the original values and the
output read from the nc file. 

              

        Original   ncdf4

[8755,] 70.47247 7.047247e+01

[8756,] 47.10336 4.710336e+01

[8757,] 38.70509 3.870509e+01

[8758,] 32.86281 3.286281e+01

[8759,] 21.90854 9.969210e+36

[8760,] 10.95427 9.969210e+36

 

Most ncdf4 data matches with the original data, except the last two values.
There are extremely large values: 9.969210e+36

 

I have no idea where these huge values come from, and can't figure out where
is wrong at all.

Any one met the same problem before? Thanks for any suggestion, and I really
appreciate any help.

 

Thanks

 

Jianhua

 

 


	[[alternative HTML version deleted]]


From kridox at ymail.com  Tue Oct 21 08:46:18 2014
From: kridox at ymail.com (Pascal Oettli)
Date: Tue, 21 Oct 2014 15:46:18 +0900
Subject: [R-sig-Geo] weird ncdf4 output 9.969210e+36
In-Reply-To: <00e501cfecf9$d7842fd0$868c8f70$@gmail.com>
References: <00e501cfecf9$d7842fd0$868c8f70$@gmail.com>
Message-ID: <CAAcyNCzNhOBP7LAPH0+yGGxD2GPV=zrEcBppKW-N-vKu91zpKA@mail.gmail.com>

Hi,

This is the number for missing value in most of NetCDF files.
http://www.unidata.ucar.edu/software/netcdf/docs/BestPractices.html#Missing%20Data%20Values

This means you missed to provide/utilize the missing value attribute
when you read your file.

Regards,
Pascal

On Tue, Oct 21, 2014 at 3:40 PM, Jianhua Huang <jh.eco.cas at gmail.com> wrote:
> Hi All:
>
>
>
> I am trying to create a 3 dimensional (200*200*8760) netCdf file using the
> ncdf4 package. Everything goes fine, except some unexpected outputs. Here is
> tail of the result in one grid cell. I cbind the original values and the
> output read from the nc file.
>
>
>
>         Original   ncdf4
>
> [8755,] 70.47247 7.047247e+01
>
> [8756,] 47.10336 4.710336e+01
>
> [8757,] 38.70509 3.870509e+01
>
> [8758,] 32.86281 3.286281e+01
>
> [8759,] 21.90854 9.969210e+36
>
> [8760,] 10.95427 9.969210e+36
>
>
>
> Most ncdf4 data matches with the original data, except the last two values.
> There are extremely large values: 9.969210e+36
>
>
>
> I have no idea where these huge values come from, and can't figure out where
> is wrong at all.
>
> Any one met the same problem before? Thanks for any suggestion, and I really
> appreciate any help.
>
>
>
> Thanks
>
>
>
> Jianhua
>
>
>
>
>
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



-- 
Pascal Oettli
Project Scientist
JAMSTEC
Yokohama, Japan


From frtog at vestas.com  Tue Oct 21 08:53:51 2014
From: frtog at vestas.com (=?utf-8?B?RnJlZGUgQWFrbWFubiBUw7hnZXJzZW4=?=)
Date: Tue, 21 Oct 2014 08:53:51 +0200
Subject: [R-sig-Geo] Order raster images in a levelplot
In-Reply-To: <87ppdmhsrb.fsf@upm.es>
References: <2DEBFCEA-DA32-4593-88C8-FD2DA59012B0@slu.se>
	<87ppdmhsrb.fsf@upm.es>
Message-ID: <B078CDF40DFE4045AF172A8B4F68FC4857C965FB06@DKRDSEXC016.vestas.net>

Hi

Since no code example was provided we'll have to guess. I suppose it has to do with the way factor() works.

Here is the built-in list of month names in R:

> month.name
 [1] "January"   "February"  "March"     "April"     "May"       "June"     
 [7] "July"      "August"    "September" "October"   "November"  "December" 

Now show this as a factor:

> factor(month.name)
[1] January   February  March     April     May       June      July     
 [8] August    September October   November  December 
12 Levels: April August December February January July June March ... September

See how factor() is using lexicographical order for the labels of the factor levels.

Now do this  instead:

> factor(month.name, labels = month.name)
[1] May       April     August    January   September July      June     
 [8] February  December  November  October   March    
12 Levels: January February March April May June July August ... December

Now the order of the labels of the levels is the same as that of month.name.

Here is an example:

testdata <- data.frame(x = 1, y = 1, Month = factor(month.name))

### order of panels is that of order(month.name)
xyplot(y ~ x|Month, data = testdata)

testdata <- data.frame(x = 1, y = 1, Month = factor(month.name, labels = month.name))

### order of panels is that of month.name
### January in bottom left and Deccember in top right panel
xyplot(y ~ x|Month, data = testdata)

### use the as.table argument to get January in top left and December in bottom right
xyplot(y ~ x|Month, data = testdata, as.table = TRUE)


Yours sincerely / Med venlig hilsen


Frede Aakmann T?gersen
Specialist, M.Sc., Ph.D.
Plant Performance & Modeling

Technology & Service Solutions
T +45 9730 5135
M +45 2547 6050
frtog at vestas.com
http://www.vestas.com

Company reg. name: Vestas Wind Systems A/S
This e-mail is subject to our e-mail disclaimer statement.
Please refer to www.vestas.com/legal/notice
If you have received this e-mail in error please contact the sender. 


> -----Original Message-----
> From: r-sig-geo-bounces at r-project.org [mailto:r-sig-geo-bounces at r-
> project.org] On Behalf Of Oscar Perpi??n Lamigueiro
> Sent: 21. oktober 2014 07:50
> To: Navinder Singh
> Cc: r-sig-geo at r-project.org
> Subject: Re: [R-sig-Geo] Order raster images in a levelplot
> 
> Hi,
> 
> > 1. Does someone have any suggestions on how i can order the sequence
> > of images in a ?levelplot" made using rasterVis.  Specifically, i
> > have months i need to arrange in the normal sequence, as the plot
> > currently aligns them in an alphabetical order. Does ?levelplot?
> > works the same way as xyplots in lattice?
> 
> levelplot methods defined in rasterVis are based on lattice graphics.
> Most of the arguments provided by lattice::xyplot and
> lattice::levelplot are also available. For this issue you could try
> these arguments: perm.cond, index.cond, as.table. All of them are
> described in the help page of lattice::xyplot.
> 
> > 2. Have there been more developments on the zApply function in the
> > raster package? I am trying to make basic statistical summaries for
> > mean monthly (eg. NDVI values) form a multi annual time series.  How
> > does one go about using the ?by" Indexing in this case.
> 
> Could you post a reproducible example? I have used zApply for similar
> tasks without problems.
> 
> Best,
> 
> Oscar.
> 
> --
> Oscar Perpi??n Lamigueiro
> Dpto. Ingenier?a El?ctrica (ETSIDI-UPM)
> Grupo de Sistemas Fotovoltaicos (IES-UPM)
> URL: http://oscarperpinan.github.io
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

From mdsumner at gmail.com  Tue Oct 21 09:17:56 2014
From: mdsumner at gmail.com (Michael Sumner)
Date: Tue, 21 Oct 2014 18:17:56 +1100
Subject: [R-sig-Geo] subdatasets in rgdal/raster
In-Reply-To: <CABG0rfsWFrGry-2QtZVs0KJj8Ysk1GyiU2=-LW=HwtSMoBrjzg@mail.gmail.com>
References: <CAAcGz980P1Zp+u9VCYzXGWZdzD=aiNkQZNsNgGJcViFPFxUn5g@mail.gmail.com>
	<alpine.LRH.2.03.1410150838400.4732@reclus.nhh.no>
	<CAAcGz99CFT-yxHDax+SnPP1WBavpdCTBbZcvbBP3VENmxNAmeg@mail.gmail.com>
	<CABG0rfsWFrGry-2QtZVs0KJj8Ysk1GyiU2=-LW=HwtSMoBrjzg@mail.gmail.com>
Message-ID: <CAAcGz9_-uVfZpPceNUC=NPRi1b1rB5e5jrtbkhD4LJ9mXyQ=0g@mail.gmail.com>

I have, and it's good but it's not what I am after here.

I really want access to HDF4 via tight-coupling. It does work well in
R when you build GDAL right, especially with raster over the top to
clean everything up. If you can compile those drivers into GDAL it
does beg the question why have a wrapper like gdalUtils. (My take on
this is that Windows-support stops at the CRAN binary, and again this
is why raster has its own NetCDF wrapper).

Ultimately the logic for these rogue files belongs in GDAL and
rgdal/raster should just reflect that: rgdal2 is essentially that, but
doesn't offer much more and it's not clear how to "rasterize"
everything again.

:)



On Thu, Oct 16, 2014 at 2:27 AM, Jonathan Greenberg <jgrn at illinois.edu> wrote:
> Mike:
>
> Have you taken a look at gdalUtils?  This is a wrapper for all the
> GDAL binaries (I am still working on adding in all those new tools
> that were recently released with version 1.11.1, but it should be up
> to date as of v 1.10.1).  gdalinfo that is part of gdalUtils gives you
> the full info dump (more, if less clean, output than rgdal's gdalInfo
> will give you), which you could parse for the info you wanted.  I also
> have a custom function "get_subdatasets" which sounds a lot like what
> you are describing.
>
> Give it a shot!  You will need to install GDAL yourself first -- check
> the help for suggestions on which flavor of GDAL I recommend.
>
> --j
>
> On Wed, Oct 15, 2014 at 6:23 AM, Michael Sumner <mdsumner at gmail.com> wrote:
>> Thanks Roger, I'm still hoping to be able to code at this level one day.
>>
>> I have gone off half-cocked, confusing things. I can get SDS from
>> NetCDF and HDF files with GDALinfo() with no problems - I just had to
>> turn off returnScaleOffset, which I think has a confounding of nbands
>> and subdatasets - since a datasource with SDS has no bands, but I need
>> to explore this more to be sure.
>>
>> Cheers, Mike.
>>
>>
>>
>>
>>
>> On Wed, Oct 15, 2014 at 5:50 PM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
>>> On Wed, 15 Oct 2014, Michael Sumner wrote:
>>>
>>>> Hello,
>>>>
>>>> As far as I know there's nothing in rgdal to determine existing
>>>> subdatasets (SDS) in HDF (or NetCDF for that matter).
>>>>
>>>> In raster, raster(x) will read from the first candidate *variable*,
>>>> and list the others with a warning, which is analogous to an SDS but
>>>> of course it's always providing this via ncdf/ncdf4 rather than via
>>>> rgdal.
>>>>
>>>> Is it true there's no way to find out SDS from HDF or NetCDF in rgdal?
>>>
>>>
>>> Because these formats are poorly organised (an XML tree describing the
>>> internal structure would be easy to parse, but self-descriptive metadata
>>> isn't usual here), GDALinfo() does not provide much.
>>>
>>> If you start by identifying the incantation used by command line gdalinfo to
>>> report the SDS metadata, then look at its source code, it should be possible
>>> to make some progress. I don't use either if I can help it, and do not have
>>> the necessary trial set of sample files. You'd need to find a robust route
>>> covering a wide range of files seen in the wild to allow for oddities in the
>>> ways things are organised. It is unfortunate to have to branch code on the
>>> selected driver, but here it is hard to avoid. Once GDALinfo is reporting
>>> the metadata in a predictable way, the other functions can be given
>>> appropriate argument values.
>>>
>>> Also consider looking at this from the point of view of rgdal2 in addition
>>> to rgdal; it could possibly be "closer" there and looking at both may make
>>> it easier to spot:
>>>
>>> https://github.com/thk686/rgdal2
>>>
>>> Contributions welcome!
>>>
>>> Roger
>>>
>>>
>>>>
>>>> I've not really explored this before much since compiling HDF was
>>>> unavailable to me. gdalUtils fills a gap but only by running the
>>>> installed command line tools, which obviously can be avoided with the
>>>> right features in rgdal/raster. I personally have always run the
>>>> command line tools and then jumped back to R (if I could).
>>>>
>>>> (The vector analogy in rgdal to listing SDS would be ogrListLayers).
>>>>
>>>> This is a missing capability in the raster package, somewhat disguised
>>>> because of the independent support for NetCDF. I guess hardly anyone
>>>> is using HDF? That's a shame since these R tools really help.  It's a
>>>> pretty complicated story all round and I keep re/discovering
>>>> interesting corners. If anyone is writing anything significant about
>>>> all this I'd be keen to be involved.
>>>>
>>>> Cheers, Mike.
>>>>
>>>>
>>>
>>> --
>>> Roger Bivand
>>> Department of Economics, Norwegian School of Economics,
>>> Helleveien 30, N-5045 Bergen, Norway.
>>> voice: +47 55 95 93 55; fax +47 55 95 91 00
>>> e-mail: Roger.Bivand at nhh.no
>>>
>>
>>
>>
>> --
>> Michael Sumner
>> Software and Database Engineer
>> Australian Antarctic Division
>> Hobart, Australia
>> e-mail: mdsumner at gmail.com
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
>
> --
> Jonathan A. Greenberg, PhD
> Assistant Professor
> Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
> Department of Geography and Geographic Information Science
> University of Illinois at Urbana-Champaign
> 259 Computing Applications Building, MC-150
> 605 East Springfield Avenue
> Champaign, IL  61820-6371
> Phone: 217-300-1924
> http://www.geog.illinois.edu/~jgrn/
> AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007



-- 
Michael Sumner
Software and Database Engineer
Australian Antarctic Division
Hobart, Australia
e-mail: mdsumner at gmail.com


From jl.iccp at gmail.com  Tue Oct 21 12:17:18 2014
From: jl.iccp at gmail.com (Jue Lin-Ye)
Date: Tue, 21 Oct 2014 12:17:18 +0200
Subject: [R-sig-Geo] pieSP: non-finite coordinates
Message-ID: <CAAMkPW9bOR-wmX3YgckA_p2r0hh7QcMtfMfRpmTPXNL2ZECOzA@mail.gmail.com>

Greetings!

I am working with the following code. I am having an error called
"non-finite coordinates". May you tell me what does it exactly mean and how
to fix it?

On the other hand, I see that my original percentages in "pie.chart" is
changed when converting to "pies" (I have written them both in boldface).
Why does this happen and how can I fix it?

Thank you in advance!


>* pie.chart*
        wana long   lat prob1 prob2 prob3 prob4

*[1,] 2125149 3.42 42.42   106  5292  5198     0[2,] 2125147 3.42 42.25
15  4241  5205     0*
> pie.chart<-data.frame(pie.chart)
> coordinates(pie.chart)<-~long+lat
> proj4string(pie.chart) <-llCRS
> pie.chart
class       : SpatialPointsDataFrame
features    : 2
extent      : 3.42, 3.42, 42.25, 42.42  (xmin, xmax, ymin, ymax)
coord. ref. : +proj=longlat +ellps=WGS84
variables   : 5
names       :    wana, prob1, prob2, prob3, prob4
min values  : 2125147,    15,  4241,  5198,     0
max values  : 2125149,   106,  5292,  5205,     0
>
pies<-pieSP(pie.chart,zcol=c(paste0("prob",c(1:length(SUB.COL.NAMES)))),max.radius=10000)
*Error in .local(obj, ...) : non-finite coordinates*
> *pies*
class       : SpatialPolygonsDataFrame
features    : 8
extent      : 3.298831, 3.540708, 42.16017, 42.47187  (xmin, xmax, ymin,
ymax)
coord. ref. : +proj=longlat +ellps=WGS84
variables   : 8
names       : id,    wana, prob1, prob2, prob3, prob4,   pie, pie2

*min values  :  1, 2125147,    10,   489,  5379,  3071, prob1,    1 max
values  :  2, 2125149,    17,   598,  5775,  4718, prob4,    4 *
>

-- 
Jue Lin-Ye

	[[alternative HTML version deleted]]


From milan.kili11 at gmail.com  Tue Oct 21 12:34:16 2014
From: milan.kili11 at gmail.com (Milan Kilibarda)
Date: Tue, 21 Oct 2014 12:34:16 +0200
Subject: [R-sig-Geo] pieSP: non-finite coordinates
In-Reply-To: <CAAMkPW9bOR-wmX3YgckA_p2r0hh7QcMtfMfRpmTPXNL2ZECOzA@mail.gmail.com>
References: <CAAMkPW9bOR-wmX3YgckA_p2r0hh7QcMtfMfRpmTPXNL2ZECOzA@mail.gmail.com>
Message-ID: <CAPSaU-_Ra_e+y7QOOwQytw5qMArUJE2CZ0ng7uVw-yr8YRrYDA@mail.gmail.com>

Dear Jue,

Please try to clearly define a reproducible example, next time.
The problem is column with 0 values. Function pieSP can not generate
coordinates for attributes of zero values.

Best,
Milan

On Tue, Oct 21, 2014 at 12:17 PM, Jue Lin-Ye <jl.iccp at gmail.com> wrote:
> Greetings!
>
> I am working with the following code. I am having an error called
> "non-finite coordinates". May you tell me what does it exactly mean and how
> to fix it?
>
> On the other hand, I see that my original percentages in "pie.chart" is
> changed when converting to "pies" (I have written them both in boldface).
> Why does this happen and how can I fix it?
>
> Thank you in advance!
>
>
>>* pie.chart*
>         wana long   lat prob1 prob2 prob3 prob4
>
> *[1,] 2125149 3.42 42.42   106  5292  5198     0[2,] 2125147 3.42 42.25
> 15  4241  5205     0*
>> pie.chart<-data.frame(pie.chart)
>> coordinates(pie.chart)<-~long+lat
>> proj4string(pie.chart) <-llCRS
>> pie.chart
> class       : SpatialPointsDataFrame
> features    : 2
> extent      : 3.42, 3.42, 42.25, 42.42  (xmin, xmax, ymin, ymax)
> coord. ref. : +proj=longlat +ellps=WGS84
> variables   : 5
> names       :    wana, prob1, prob2, prob3, prob4
> min values  : 2125147,    15,  4241,  5198,     0
> max values  : 2125149,   106,  5292,  5205,     0
>>
> pies<-pieSP(pie.chart,zcol=c(paste0("prob",c(1:length(SUB.COL.NAMES)))),max.radius=10000)
> *Error in .local(obj, ...) : non-finite coordinates*
>> *pies*
> class       : SpatialPolygonsDataFrame
> features    : 8
> extent      : 3.298831, 3.540708, 42.16017, 42.47187  (xmin, xmax, ymin,
> ymax)
> coord. ref. : +proj=longlat +ellps=WGS84
> variables   : 8
> names       : id,    wana, prob1, prob2, prob3, prob4,   pie, pie2
>
> *min values  :  1, 2125147,    10,   489,  5379,  3071, prob1,    1 max
> values  :  2, 2125149,    17,   598,  5775,  4718, prob4,    4 *
>>
>
> --
> Jue Lin-Ye
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



-- 
Dr. Milan Kilibarda
Assistant professor
University of Belgrade,
Faculty of Civil Engineering,
Department of Geodesy and Geoinformatics,
Address: Bulevar kralja Aleksandra 73  11000 Belgrade, Serbia,
Mail:  kili at grf.bg.ac.rs
Web: http://www.grf.bg.ac.rs/fakultet/pro/e?nid=168 ;  http://dailymeteo.org/
Pub: http://scholar.google.com/citations?user=Zl2MZ3AAAAAJ&hl=en
tel:+381 11 3218630


From Navinder.Singh at slu.se  Tue Oct 21 12:45:11 2014
From: Navinder.Singh at slu.se (Navinder Singh)
Date: Tue, 21 Oct 2014 10:45:11 +0000
Subject: [R-sig-Geo]  Order raster images in a levelplot
In-Reply-To: <804C9698-7BCF-4C91-87DC-D3BFEC671EEB@slu.se>
References: <2DEBFCEA-DA32-4593-88C8-FD2DA59012B0@slu.se>
	<87ppdmhsrb.fsf@upm.es>
	<B078CDF40DFE4045AF172A8B4F68FC4857C965FB06@DKRDSEXC016.vestas.net>
	<804C9698-7BCF-4C91-87DC-D3BFEC671EEB@slu.se>
Message-ID: <3055E4D2865EED429B17F80FF667E35723BEA04F@exchange2-2>


Dear Both,
Thank you for your responses.
Oscar- I am still trying to get the indexing going. Hope it will be sorted out soon.
Just to provide some more background on my code- here is an example.

library(raster)
library(rasterVis)
library(raster)
library(rgdal)
library(zoo)

setwd("/Users/nasi/Google Drive/5KMNDVI_Monthly")

modis = stack(list.files(pattern='NDVI.tif'))
modis
names(modis)
d<-seq(as.Date("2010-01-01"),as.Date("2014-08-01"),by="month")
names(modis)<-d
NDVImod<-setZ(modis,d)
e<-extent(-17.96, 43.135, -30.055, 67.08)
NDVImodis<-crop(NDVImod,e)
NDVImodis[NDVImodis<0]<-0
NDVImodis<-setZ(NDVImodis,d)
names(NDVImodis)<-d

# The first problem occurs below. I am trying to get monthly means and other quantities. Although the function does give me an output, but the results are completely wrong. As it seems to be averaging the wrong months together. Can?t really paste the image here i suppose.

year.mon.max<-zApply(NDVImodis, by=months, fun=max, name="months")
year.mon.min<-zApply(NDVImodis, by=months, fun=min, name="months")
year.mon.diff<-year.mon.max-year.mon.min
year.mon.sd<-zApply(NDVImodis, by=months, fun=sd, name="months")
year.mon.cv<-zApply(NDVImodis, by=months, fun=cv, name="months?)

# I only manage to rearrange this one using the code after these lines. But since the images are wrong, its not of much use. Perhaps my use of ?by? argument above is not correct. Or my naming of the rasters isn?t either.

print(levelplot(year.mon.mean[[c(6,2,12,11,10,3,5,4,8,1,9,7)]], main="Mean Monthly NDVI (2010-2014)", par.settings=myTheme))

# perhaps here is where i need to use the par.cond
# I tried using ?index.cond? here like below:

levelplot(year.mon.mean, index.cond=list(c("January","February","March", "April", "May", "June","July", "August", "Septmeber", "Ocotber","November", "December")), par.settings=myTheme)

#But this doesn?t plot anything. Even the maps disappear. Perhaps this again has to do with the naming in the rasters.

#Anyhow, i would like to match these monthly images with data on spatial observations of animals where i have an x,y and a date matching the date of the raster.

#I tried doing this below -
df$layer<-lapply(df$month, function(x) which(grepl(tolower(x), tolower(names(year.mon.mean)))))
df$meanNDVI<-sapply(seq_len(nrow(df)), function(x) extract(mean.year.mon[[df$layer[x]]], df[x,1:2])) # 1,2 are columns with x and y.

#This also doesn?t work, perhaps also has to do with the names in the raster.

Your help is much appreciated.
Ill keep trying the par.cond argument in the meanwhile.

Best wishes,

Navinder
















Navinder J Singh
Associate Professor
Department of Wildlife, Fish, and Environmental Studies
Faculty of Forest Sciences
Swedish University of Agricultural Sciences
SE-901 83 Umea, Sweden
O: +46 (0)90 786 8538;
M: +46 (0)70 676 0103
email: navinder.singh at slu.se<mailto:navinder.singh at slu.se>
Web: navinderjsingh.weebly.com<http://navinderjsingh.weebly.com/>

www.slu.se/viltfiskmiljo/navinder_singh<http://www.slu.se/viltfiskmiljo/navinder_singh>
http://slu-se.academia.edu/NSingh



On 21 Oct 2014, at 08:53, Frede Aakmann T?gersen <frtog at vestas.com<mailto:frtog at vestas.com>> wrote:


Hi

Since no code example was provided we'll have to guess. I suppose it has to do with the way factor() works.

Here is the built-in list of month names in R:


month.name
[1] "January"   "February"  "March"     "April"     "May"       "June"
[7] "July"      "August"    "September" "October"   "November"  "December"

Now show this as a factor:


factor(month.name)
[1] January   February  March     April     May       June      July
[8] August    September October   November  December
12 Levels: April August December February January July June March ... September

See how factor() is using lexicographical order for the labels of the factor levels.

Now do this  instead:


factor(month.name, labels = month.name)
[1] May       April     August    January   September July      June
[8] February  December  November  October   March
12 Levels: January February March April May June July August ... December

Now the order of the labels of the levels is the same as that of month.name.

Here is an example:

testdata <- data.frame(x = 1, y = 1, Month = factor(month.name))

### order of panels is that of order(month.name)
xyplot(y ~ x|Month, data = testdata)

testdata <- data.frame(x = 1, y = 1, Month = factor(month.name, labels = month.name))

### order of panels is that of month.name
### January in bottom left and Deccember in top right panel
xyplot(y ~ x|Month, data = testdata)

### use the as.table argument to get January in top left and December in bottom right
xyplot(y ~ x|Month, data = testdata, as.table = TRUE)


Yours sincerely / Med venlig hilsen


Frede Aakmann T?gersen
Specialist, M.Sc., Ph.D.
Plant Performance & Modeling

Technology & Service Solutions
T +45 9730 5135
M +45 2547 6050
frtog at vestas.com<mailto:frtog at vestas.com>
http://www.vestas.com

Company reg. name: Vestas Wind Systems A/S
This e-mail is subject to our e-mail disclaimer statement.
Please refer to www.vestas.com/legal/notice<http://www.vestas.com/legal/notice>
If you have received this e-mail in error please contact the sender.



-----Original Message-----
From: r-sig-geo-bounces at r-project.org<mailto:r-sig-geo-bounces at r-project.org> [mailto:r-sig-geo-bounces at r-
project.org<mailto:r-sig-geo-bounces at r-%0bproject.org>] On Behalf Of Oscar Perpi??n Lamigueiro
Sent: 21. oktober 2014 07:50
To: Navinder Singh
Cc: r-sig-geo at r-project.org<mailto:r-sig-geo at r-project.org>
Subject: Re: [R-sig-Geo] Order raster images in a levelplot

Hi,


1. Does someone have any suggestions on how i can order the sequence
of images in a ?levelplot" made using rasterVis.  Specifically, i
have months i need to arrange in the normal sequence, as the plot
currently aligns them in an alphabetical order. Does ?levelplot?
works the same way as xyplots in lattice?

levelplot methods defined in rasterVis are based on lattice graphics.
Most of the arguments provided by lattice::xyplot and
lattice::levelplot are also available. For this issue you could try
these arguments: perm.cond, index.cond, as.table. All of them are
described in the help page of lattice::xyplot.


2. Have there been more developments on the zApply function in the
raster package? I am trying to make basic statistical summaries for
mean monthly (eg. NDVI values) form a multi annual time series.  How
does one go about using the ?by" Indexing in this case.

Could you post a reproducible example? I have used zApply for similar
tasks without problems.

Best,

Oscar.

--
Oscar Perpi??n Lamigueiro
Dpto. Ingenier?a El?ctrica (ETSIDI-UPM)
Grupo de Sistemas Fotovoltaicos (IES-UPM)
URL: http://oscarperpinan.github.io

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org<mailto:R-sig-Geo at r-project.org>
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


	[[alternative HTML version deleted]]


From frtog at vestas.com  Tue Oct 21 13:10:27 2014
From: frtog at vestas.com (=?utf-8?B?RnJlZGUgQWFrbWFubiBUw7hnZXJzZW4=?=)
Date: Tue, 21 Oct 2014 13:10:27 +0200
Subject: [R-sig-Geo] Order raster images in a levelplot
In-Reply-To: <3055E4D2865EED429B17F80FF667E35723BEA04F@exchange2-2>
References: <2DEBFCEA-DA32-4593-88C8-FD2DA59012B0@slu.se>
	<87ppdmhsrb.fsf@upm.es>
	<B078CDF40DFE4045AF172A8B4F68FC4857C965FB06@DKRDSEXC016.vestas.net>
	<804C9698-7BCF-4C91-87DC-D3BFEC671EEB@slu.se>
	<3055E4D2865EED429B17F80FF667E35723BEA04F@exchange2-2>
Message-ID: <B078CDF40DFE4045AF172A8B4F68FC4857C965FD3D@DKRDSEXC016.vestas.net>

Hi

Since I don?t have your data I cannot say anything about your use of zApply. For the levelplot() problem I think you can use the layer arguments to levelplot() from rasterVis package. Something like this:


f <- system.file("external/test.grd", package="raster")

d <- seq(as.Date("2010-01-01"),as.Date("2014-08-01"),by="month")

rr <- stack(rep(f,length(d)))
names(rr) <- d

rr <- setZ(rr, d, name = 'Month')

rr.mean <- zApply(rrr, by = months, fun = mean, name = "Month")

levelplot(rr.mean, margin = FALSE, layer = unique(months(d)), layout = c(3,4))

Yours sincerely / Med venlig hilsen


Frede Aakmann T?gersen
Specialist, M.Sc., Ph.D.
Plant Performance & Modeling

Technology & Service Solutions
T +45 9730 5135
M +45 2547 6050
frtog at vestas.com<mailto:frtog at vestas.com>
http://www.vestas.com<http://www.vestas.com/>

Company reg. name: Vestas Wind Systems A/S
This e-mail is subject to our e-mail disclaimer statement.
Please refer to www.vestas.com/legal/notice<http://www.vestas.com/legal/notice>
If you have received this e-mail in error please contact the sender.

From: Navinder Singh [mailto:Navinder.Singh at slu.se]
Sent: 21. oktober 2014 12:45
To: r-sig-geo at r-project.org
Cc: oscar.perpinan at upm.es; Frede Aakmann T?gersen
Subject: [R-sig-Geo] Order raster images in a levelplot


Dear Both,
Thank you for your responses.
Oscar- I am still trying to get the indexing going. Hope it will be sorted out soon.
Just to provide some more background on my code- here is an example.

library(raster)
library(rasterVis)
library(raster)
library(rgdal)
library(zoo)

setwd("/Users/nasi/Google Drive/5KMNDVI_Monthly")

modis = stack(list.files(pattern='NDVI.tif'))
modis
names(modis)
d<-seq(as.Date("2010-01-01"),as.Date("2014-08-01"),by="month")
names(modis)<-d
NDVImod<-setZ(modis,d)
e<-extent(-17.96, 43.135, -30.055, 67.08)
NDVImodis<-crop(NDVImod,e)
NDVImodis[NDVImodis<0]<-0
NDVImodis<-setZ(NDVImodis,d)
names(NDVImodis)<-d

# The first problem occurs below. I am trying to get monthly means and other quantities. Although the function does give me an output, but the results are completely wrong. As it seems to be averaging the wrong months together. Can?t really paste the image here i suppose.

year.mon.max<-zApply(NDVImodis, by=months, fun=max, name="months")
year.mon.min<-zApply(NDVImodis, by=months, fun=min, name="months")
year.mon.diff<-year.mon.max-year.mon.min
year.mon.sd<-zApply(NDVImodis, by=months, fun=sd, name="months")
year.mon.cv<-zApply(NDVImodis, by=months, fun=cv, name="months?)

# I only manage to rearrange this one using the code after these lines. But since the images are wrong, its not of much use. Perhaps my use of ?by? argument above is not correct. Or my naming of the rasters isn?t either.

print(levelplot(year.mon.mean[[c(6,2,12,11,10,3,5,4,8,1,9,7)]], main="Mean Monthly NDVI (2010-2014)", par.settings=myTheme))

# perhaps here is where i need to use the par.cond
# I tried using ?index.cond? here like below:

levelplot(year.mon.mean, index.cond=list(c("January","February","March", "April", "May", "June","July", "August", "Septmeber", "Ocotber","November", "December")), par.settings=myTheme)

#But this doesn?t plot anything. Even the maps disappear. Perhaps this again has to do with the naming in the rasters.

#Anyhow, i would like to match these monthly images with data on spatial observations of animals where i have an x,y and a date matching the date of the raster.

#I tried doing this below -
df$layer<-lapply(df$month, function(x) which(grepl(tolower(x), tolower(names(year.mon.mean)))))
df$meanNDVI<-sapply(seq_len(nrow(df)), function(x) extract(mean.year.mon[[df$layer[x]]], df[x,1:2])) # 1,2 are columns with x and y.

#This also doesn?t work, perhaps also has to do with the names in the raster.

Your help is much appreciated.
Ill keep trying the par.cond argument in the meanwhile.

Best wishes,

Navinder
















Navinder J Singh
Associate Professor
Department of Wildlife, Fish, and Environmental Studies
Faculty of Forest Sciences
Swedish University of Agricultural Sciences
SE-901 83 Umea, Sweden
O: +46 (0)90 786 8538;
M: +46 (0)70 676 0103
email: navinder.singh at slu.se<mailto:navinder.singh at slu.se>
Web: navinderjsingh.weebly.com<http://navinderjsingh.weebly.com/>

www.slu.se/viltfiskmiljo/navinder_singh<http://www.slu.se/viltfiskmiljo/navinder_singh>
http://slu-se.academia.edu/NSingh



On 21 Oct 2014, at 08:53, Frede Aakmann T?gersen <frtog at vestas.com<mailto:frtog at vestas.com>> wrote:

Hi

Since no code example was provided we'll have to guess. I suppose it has to do with the way factor() works.

Here is the built-in list of month names in R:

month.name
[1] "January"   "February"  "March"     "April"     "May"       "June"
[7] "July"      "August"    "September" "October"   "November"  "December"

Now show this as a factor:

factor(month.name)
[1] January   February  March     April     May       June      July
[8] August    September October   November  December
12 Levels: April August December February January July June March ... September

See how factor() is using lexicographical order for the labels of the factor levels.

Now do this  instead:

factor(month.name, labels = month.name)
[1] May       April     August    January   September July      June
[8] February  December  November  October   March
12 Levels: January February March April May June July August ... December

Now the order of the labels of the levels is the same as that of month.name.

Here is an example:

testdata <- data.frame(x = 1, y = 1, Month = factor(month.name))

### order of panels is that of order(month.name)
xyplot(y ~ x|Month, data = testdata)

testdata <- data.frame(x = 1, y = 1, Month = factor(month.name, labels = month.name))

### order of panels is that of month.name
### January in bottom left and Deccember in top right panel
xyplot(y ~ x|Month, data = testdata)

### use the as.table argument to get January in top left and December in bottom right
xyplot(y ~ x|Month, data = testdata, as.table = TRUE)


Yours sincerely / Med venlig hilsen


Frede Aakmann T?gersen
Specialist, M.Sc., Ph.D.
Plant Performance & Modeling

Technology & Service Solutions
T +45 9730 5135
M +45 2547 6050
frtog at vestas.com<mailto:frtog at vestas.com>
http://www.vestas.com

Company reg. name: Vestas Wind Systems A/S
This e-mail is subject to our e-mail disclaimer statement.
Please refer to www.vestas.com/legal/notice<http://www.vestas.com/legal/notice>
If you have received this e-mail in error please contact the sender.


-----Original Message-----
From: r-sig-geo-bounces at r-project.org<mailto:r-sig-geo-bounces at r-project.org> [mailto:r-sig-geo-bounces at r-
project.org<mailto:r-sig-geo-bounces at r-%0bproject.org>] On Behalf Of Oscar Perpi??n Lamigueiro
Sent: 21. oktober 2014 07:50
To: Navinder Singh
Cc: r-sig-geo at r-project.org<mailto:r-sig-geo at r-project.org>
Subject: Re: [R-sig-Geo] Order raster images in a levelplot

Hi,

1. Does someone have any suggestions on how i can order the sequence
of images in a ?levelplot" made using rasterVis.  Specifically, i
have months i need to arrange in the normal sequence, as the plot
currently aligns them in an alphabetical order. Does ?levelplot?
works the same way as xyplots in lattice?

levelplot methods defined in rasterVis are based on lattice graphics.
Most of the arguments provided by lattice::xyplot and
lattice::levelplot are also available. For this issue you could try
these arguments: perm.cond, index.cond, as.table. All of them are
described in the help page of lattice::xyplot.

2. Have there been more developments on the zApply function in the
raster package? I am trying to make basic statistical summaries for
mean monthly (eg. NDVI values) form a multi annual time series.  How
does one go about using the ?by" Indexing in this case.

Could you post a reproducible example? I have used zApply for similar
tasks without problems.

Best,

Oscar.

--
Oscar Perpi??n Lamigueiro
Dpto. Ingenier?a El?ctrica (ETSIDI-UPM)
Grupo de Sistemas Fotovoltaicos (IES-UPM)
URL: http://oscarperpinan.github.io

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org<mailto:R-sig-Geo at r-project.org>
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


	[[alternative HTML version deleted]]


From frtog at vestas.com  Tue Oct 21 13:30:37 2014
From: frtog at vestas.com (=?iso-8859-1?Q?Frede_Aakmann_T=F8gersen?=)
Date: Tue, 21 Oct 2014 13:30:37 +0200
Subject: [R-sig-Geo] Order raster images in a levelplot
In-Reply-To: <F0148F09-B265-480D-918D-EC07468A3A61@slu.se>
References: <2DEBFCEA-DA32-4593-88C8-FD2DA59012B0@slu.se>
	<87ppdmhsrb.fsf@upm.es>
	<B078CDF40DFE4045AF172A8B4F68FC4857C965FB06@DKRDSEXC016.vestas.net>
	<804C9698-7BCF-4C91-87DC-D3BFEC671EEB@slu.se>
	<3055E4D2865EED429B17F80FF667E35723BEA04F@exchange2-2>
	<B078CDF40DFE4045AF172A8B4F68FC4857C965FD3D@DKRDSEXC016.vestas.net>
	<F0148F09-B265-480D-918D-EC07468A3A61@slu.se>
Message-ID: <B078CDF40DFE4045AF172A8B4F68FC4857C965FD6F@DKRDSEXC016.vestas.net>

Please remember to post to the list as well since this was there this thread startet.

Dows it have something to do with you not setting the name argument of setZ()?

You are doing:

NDVImodis<-setZ(NDVImodis,d)
names(NDVImodis)<-d

Perhaps you should do:

NDVImodis<-setZ(NDVImodis,d, name = "Months")

And then e.g.

zApply(NDVImodis, by=months, fun=mean, name="Months")

?????

Yours sincerely / Med venlig hilsen


Frede Aakmann T?gersen
Specialist, M.Sc., Ph.D.
Plant Performance & Modeling

Technology & Service Solutions
T +45 9730 5135
M +45 2547 6050
frtog at vestas.com<mailto:frtog at vestas.com>
http://www.vestas.com<http://www.vestas.com/>

Company reg. name: Vestas Wind Systems A/S
This e-mail is subject to our e-mail disclaimer statement.
Please refer to www.vestas.com/legal/notice<http://www.vestas.com/legal/notice>
If you have received this e-mail in error please contact the sender.

From: Navinder Singh [mailto:Navinder.Singh at slu.se]
Sent: 21. oktober 2014 13:22
To: Frede Aakmann T?gersen
Subject: Re: [R-sig-Geo] Order raster images in a levelplot

Thanks Frede, it worked perfectly.
However, i have problems using the 'by=months', since it is not estimating the monthly means as i want.
i want the monthly means across years.i.e means of january, feb and so on. And 'by=months' is dining some averaging but it is averaging the wrong months. Perhaps it has o do something with my naming? Below is what i did.
I couldn't send you the entire dataset, as they are global images with each 14MB size and they run monthly for 5 years.
I also posted a message on R-sig.
Thanks for your help.
Best wishes,
Navinder

setwd("/Users/nasi/Google Drive/5KMNDVI_Monthly")

modis = stack(list.files(pattern='NDVI.tif'))
modis
names(modis)
d<-seq(as.Date("2010-01-01"),as.Date("2014-08-01"),by="month")
names(modis)<-d
NDVImod<-setZ(modis,d)
e<-extent(-17.96, 43.135, -30.055, 67.08)
NDVImodis<-crop(NDVImod,e)
NDVImodis[NDVImodis<0]<-0
NDVImodis<-setZ(NDVImodis,d)
names(NDVImodis)<-d

# The first problem occurs below. I am trying to get monthly means and other quantities. Although the function does give me an output, but the results are completely wrong. As it seems to be averaging the wrong months together. Can't really paste the image here i suppose.

year.mon.max<-zApply(NDVImodis, by=months, fun=max, name="months")
year.mon.min<-zApply(NDVImodis, by=months, fun=min, name="months")
year.mon.diff<-year.mon.max-year.mon.min
year.mon.sd<-zApply(NDVImodis, by=months, fun=sd, name="months")
year.mon.cv<-zApply(NDVImodis, by=months, fun=cv, name="months")

# I only manage to rearrange this one using the code after these lines. But since the images are wrong, its not of much use. Perhaps my use of 'by' argument above is not correct. Or my naming of the rasters isn't either.

print(levelplot(year.mon.mean[[c(6,2,12,11,10,3,5,4,8,1,9,7)]], main="Mean Monthly NDVI (2010-2014)", par.settings=myTheme))

# perhaps here is where i need to use the par.cond
# I tried using 'index.cond' here like below:

levelplot(year.mon.mean, index.cond=list(c("January","February","March", "April", "May", "June","July", "August", "Septmeber", "Ocotber","November","December")), par.settings=myTheme)

#But this doesn't plot anything. Even the maps disappear. Perhaps this again has to do with the naming in the rasters.

#Anyhow, i would like to match these monthly images with data on spatial observations of animals where i have an x,y and a date matching the date of the raster.

#I tried doing this below -
df$layer<-lapply(df$month, function(x) which(grepl(tolower(x), tolower(names(year.mon.mean)))))
df$meanNDVI<-sapply(seq_len(nrow(df)), function(x) extract(mean.year.mon[[df$layer[x]]], df[x,1:2])) # 1,2 are columns with x and y.

#This also doesn't work, perhaps also has to do with the names in the raster.

Your help is much appreciated.
Ill keep trying the par.cond argument in the meanwhile.

Best wishes,

Navinder




Navinder J Singh
Associate Professor
Department of Wildlife, Fish, and Environmental Studies
Faculty of Forest Sciences
Swedish University of Agricultural Sciences
SE-901 83 Umea, Sweden
O: +46 (0)90 786 8538;
M: +46 (0)70 676 0103
email: navinder.singh at slu.se<mailto:navinder.singh at slu.se>
Web: navinderjsingh.weebly.com<http://navinderjsingh.weebly.com/>

www.slu.se/viltfiskmiljo/navinder_singh<http://www.slu.se/viltfiskmiljo/navinder_singh>
http://slu-se.academia.edu/NSingh



On 21 Oct 2014, at 13:10, Frede Aakmann T?gersen <frtog at vestas.com<mailto:frtog at vestas.com>> wrote:


Hi

Since I don't have your data I cannot say anything about your use of zApply. For the levelplot() problem I think you can use the layer arguments to levelplot() from rasterVis package. Something like this:


f <- system.file("external/test.grd", package="raster")

d <- seq(as.Date("2010-01-01"),as.Date("2014-08-01"),by="month")

rr <- stack(rep(f,length(d)))
names(rr) <- d

rr <- setZ(rr, d, name = 'Month')

rr.mean <- zApply(rrr, by = months, fun = mean, name = "Month")

levelplot(rr.mean, margin = FALSE, layer = unique(months(d)), layout = c(3,4))

Yours sincerely / Med venlig hilsen


Frede Aakmann T?gersen
Specialist, M.Sc., Ph.D.
Plant Performance & Modeling

Technology & Service Solutions
T +45 9730 5135
M +45 2547 6050
frtog at vestas.com<mailto:frtog at vestas.com>
http://www.vestas.com<http://www.vestas.com/>

Company reg. name: Vestas Wind Systems A/S
This e-mail is subject to our e-mail disclaimer statement.
Please refer to www.vestas.com/legal/notice<http://www.vestas.com/legal/notice>
If you have received this e-mail in error please contact the sender.

From: Navinder Singh [mailto:Navinder.Singh at slu.se]
Sent: 21. oktober 2014 12:45
To: r-sig-geo at r-project.org<mailto:r-sig-geo at r-project.org>
Cc: oscar.perpinan at upm.es<mailto:oscar.perpinan at upm.es>; Frede Aakmann T?gersen
Subject: [R-sig-Geo] Order raster images in a levelplot


Dear Both,
Thank you for your responses.
Oscar- I am still trying to get the indexing going. Hope it will be sorted out soon.
Just to provide some more background on my code- here is an example.

library(raster)
library(rasterVis)
library(raster)
library(rgdal)
library(zoo)

setwd("/Users/nasi/Google Drive/5KMNDVI_Monthly")

modis = stack(list.files(pattern='NDVI.tif'))
modis
names(modis)
d<-seq(as.Date("2010-01-01"),as.Date("2014-08-01"),by="month")
names(modis)<-d
NDVImod<-setZ(modis,d)
e<-extent(-17.96, 43.135, -30.055, 67.08)
NDVImodis<-crop(NDVImod,e)
NDVImodis[NDVImodis<0]<-0
NDVImodis<-setZ(NDVImodis,d)
names(NDVImodis)<-d

# The first problem occurs below. I am trying to get monthly means and other quantities. Although the function does give me an output, but the results are completely wrong. As it seems to be averaging the wrong months together. Can't really paste the image here i suppose.

year.mon.max<-zApply(NDVImodis, by=months, fun=max, name="months")
year.mon.min<-zApply(NDVImodis, by=months, fun=min, name="months")
year.mon.diff<-year.mon.max-year.mon.min
year.mon.sd<-zApply(NDVImodis, by=months, fun=sd, name="months")
year.mon.cv<-zApply(NDVImodis, by=months, fun=cv, name="months")

# I only manage to rearrange this one using the code after these lines. But since the images are wrong, its not of much use. Perhaps my use of 'by' argument above is not correct. Or my naming of the rasters isn't either.

print(levelplot(year.mon.mean[[c(6,2,12,11,10,3,5,4,8,1,9,7)]], main="Mean Monthly NDVI (2010-2014)", par.settings=myTheme))

# perhaps here is where i need to use the par.cond
# I tried using 'index.cond' here like below:

levelplot(year.mon.mean, index.cond=list(c("January","February","March", "April", "May", "June","July", "August", "Septmeber", "Ocotber","November", "December")),par.settings=myTheme)

#But this doesn't plot anything. Even the maps disappear. Perhaps this again has to do with the naming in the rasters.

#Anyhow, i would like to match these monthly images with data on spatial observations of animals where i have an x,y and a date matching the date of the raster.

#I tried doing this below -
df$layer<-lapply(df$month, function(x) which(grepl(tolower(x), tolower(names(year.mon.mean)))))
df$meanNDVI<-sapply(seq_len(nrow(df)), function(x) extract(mean.year.mon[[df$layer[x]]], df[x,1:2])) # 1,2 are columns with x and y.

#This also doesn't work, perhaps also has to do with the names in the raster.

Your help is much appreciated.
Ill keep trying the par.cond argument in the meanwhile.

Best wishes,

Navinder
















Navinder J Singh
Associate Professor
Department of Wildlife, Fish, and Environmental Studies
Faculty of Forest Sciences
Swedish University of Agricultural Sciences
SE-901 83 Umea, Sweden
O: +46 (0)90 786 8538;
M: +46 (0)70 676 0103
email: navinder.singh at slu.se<mailto:navinder.singh at slu.se>
Web: navinderjsingh.weebly.com<http://navinderjsingh.weebly.com/>

www.slu.se/viltfiskmiljo/navinder_singh<http://www.slu.se/viltfiskmiljo/navinder_singh>
http://slu-se.academia.edu/NSingh



On 21 Oct 2014, at 08:53, Frede Aakmann T?gersen <frtog at vestas.com<mailto:frtog at vestas.com>> wrote:

Hi

Since no code example was provided we'll have to guess. I suppose it has to do with the way factor() works.

Here is the built-in list of month names in R:


month.name
[1] "January"   "February"  "March"     "April"     "May"       "June"
[7] "July"      "August"    "September" "October"   "November"  "December"

Now show this as a factor:


factor(month.name)
[1] January   February  March     April     May       June      July
[8] August    September October   November  December
12 Levels: April August December February January July June March ... September

See how factor() is using lexicographical order for the labels of the factor levels.

Now do this  instead:


factor(month.name, labels = month.name)
[1] May       April     August    January   September July      June
[8] February  December  November  October   March
12 Levels: January February March April May June July August ... December

Now the order of the labels of the levels is the same as that of month.name.

Here is an example:

testdata <- data.frame(x = 1, y = 1, Month = factor(month.name))

### order of panels is that of order(month.name)
xyplot(y ~ x|Month, data = testdata)

testdata <- data.frame(x = 1, y = 1, Month = factor(month.name, labels = month.name))

### order of panels is that of month.name
### January in bottom left and Deccember in top right panel
xyplot(y ~ x|Month, data = testdata)

### use the as.table argument to get January in top left and December in bottom right
xyplot(y ~ x|Month, data = testdata, as.table = TRUE)


Yours sincerely / Med venlig hilsen


Frede Aakmann T?gersen
Specialist, M.Sc., Ph.D.
Plant Performance & Modeling

Technology & Service Solutions
T +45 9730 5135
M +45 2547 6050
frtog at vestas.com<mailto:frtog at vestas.com>
http://www.vestas.com<http://www.vestas.com/>

Company reg. name: Vestas Wind Systems A/S
This e-mail is subject to our e-mail disclaimer statement.
Please refer to www.vestas.com/legal/notice<http://www.vestas.com/legal/notice>
If you have received this e-mail in error please contact the sender.



-----Original Message-----
From: r-sig-geo-bounces at r-project.org<mailto:r-sig-geo-bounces at r-project.org> [mailto:r-sig-geo-bounces at r-
project.org<mailto:r-sig-geo-bounces at r-%0bproject.org>] On Behalf Of Oscar Perpi??n Lamigueiro
Sent: 21. oktober 2014 07:50
To: Navinder Singh
Cc: r-sig-geo at r-project.org<mailto:r-sig-geo at r-project.org>
Subject: Re: [R-sig-Geo] Order raster images in a levelplot

Hi,


1. Does someone have any suggestions on how i can order the sequence
of images in a "levelplot" made using rasterVis.  Specifically, i
have months i need to arrange in the normal sequence, as the plot
currently aligns them in an alphabetical order. Does "levelplot"
works the same way as xyplots in lattice?

levelplot methods defined in rasterVis are based on lattice graphics.
Most of the arguments provided by lattice::xyplot and
lattice::levelplot are also available. For this issue you could try
these arguments: perm.cond, index.cond, as.table. All of them are
described in the help page of lattice::xyplot.


2. Have there been more developments on the zApply function in the
raster package? I am trying to make basic statistical summaries for
mean monthly (eg. NDVI values) form a multi annual time series.  How
does one go about using the "by" Indexing in this case.

Could you post a reproducible example? I have used zApply for similar
tasks without problems.

Best,

Oscar.

--
Oscar Perpi??n Lamigueiro
Dpto. Ingenier?a El?ctrica (ETSIDI-UPM)
Grupo de Sistemas Fotovoltaicos (IES-UPM)
URL: http://oscarperpinan.github.io<http://oscarperpinan.github.io/>

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org<mailto:R-sig-Geo at r-project.org>
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


	[[alternative HTML version deleted]]


From Navinder.Singh at slu.se  Tue Oct 21 14:29:43 2014
From: Navinder.Singh at slu.se (Navinder Singh)
Date: Tue, 21 Oct 2014 12:29:43 +0000
Subject: [R-sig-Geo] Order raster images in a levelplot
In-Reply-To: <B078CDF40DFE4045AF172A8B4F68FC4857C965FD6F@DKRDSEXC016.vestas.net>
References: <2DEBFCEA-DA32-4593-88C8-FD2DA59012B0@slu.se>
	<87ppdmhsrb.fsf@upm.es>
	<B078CDF40DFE4045AF172A8B4F68FC4857C965FB06@DKRDSEXC016.vestas.net>
	<804C9698-7BCF-4C91-87DC-D3BFEC671EEB@slu.se>
	<3055E4D2865EED429B17F80FF667E35723BEA04F@exchange2-2>
	<B078CDF40DFE4045AF172A8B4F68FC4857C965FD3D@DKRDSEXC016.vestas.net>
	<F0148F09-B265-480D-918D-EC07468A3A61@slu.se>
	<B078CDF40DFE4045AF172A8B4F68FC4857C965FD6F@DKRDSEXC016.vestas.net>
Message-ID: <158CF4D8-815C-4C8B-9EED-BDAE74706833@slu.se>

Dear Frede,
The problem still persists. It does make a plot, but then summarises using the wrong layers.

setwd("/Users/nasi/Google Drive/5KMNDVI_Monthly")
modis = stack(list.files(pattern='NDVI.tif'))
modis
names(modis)
d<-seq(as.Date("2010-01-01"),as.Date("2014-08-01"),by="month?)
d
 [1] "2010-01-01" "2010-02-01" "2010-03-01" "2010-04-01" "2010-05-01" "2010-06-01"
 [7] "2010-07-01" "2010-08-01" "2010-09-01" "2010-10-01" "2010-11-01" "2010-12-01"
[13] "2011-01-01" "2011-02-01" "2011-03-01" "2011-04-01" "2011-05-01" "2011-06-01"
[19] "2011-07-01" "2011-08-01" "2011-09-01" "2011-10-01" "2011-11-01" "2011-12-01"
[25] "2012-01-01" "2012-02-01" "2012-03-01" "2012-04-01" "2012-05-01" "2012-06-01"
[31] "2012-07-01" "2012-08-01" "2012-09-01" "2012-10-01" "2012-11-01" "2012-12-01"
[37] "2013-01-01" "2013-02-01" "2013-03-01" "2013-04-01" "2013-05-01" "2013-06-01"
[43] "2013-07-01" "2013-08-01" "2013-09-01" "2013-10-01" "2013-11-01" "2013-12-01"
[49] "2014-01-01" "2014-02-01" "2014-03-01" "2014-04-01" "2014-05-01" "2014-06-01"
[55] "2014-07-01" "2014-08-01?

names(modis)<-d
NDVImod<-setZ(modis,d, name="months")

names(NDVImod)
 [1] "X2010.01.01" "X2010.02.01" "X2010.03.01" "X2010.04.01" "X2010.05.01" "X2010.06.01"
 [7] "X2010.07.01" "X2010.08.01" "X2010.09.01" "X2010.10.01" "X2010.11.01" "X2010.12.01"
[13] "X2011.01.01" "X2011.02.01" "X2011.03.01" "X2011.04.01" "X2011.05.01" "X2011.06.01"
[19] "X2011.07.01" "X2011.08.01" "X2011.09.01" "X2011.10.01" "X2011.11.01" "X2011.12.01"
[25] "X2012.01.01" "X2012.02.01" "X2012.03.01" "X2012.04.01" "X2012.05.01" "X2012.06.01"
[31] "X2012.07.01" "X2012.08.01" "X2012.09.01" "X2012.10.01" "X2012.11.01" "X2012.12.01"
[37] "X2013.01.01" "X2013.02.01" "X2013.03.01" "X2013.04.01" "X2013.05.01" "X2013.06.01"
[43] "X2013.07.01" "X2013.08.01" "X2013.09.01" "X2013.10.01" "X2013.11.01" "X2013.12.01"
[49] "X2014.01.01" "X2014.02.01" "X2014.03.01" "X2014.04.01" "X2014.05.01" "X2014.06.01"
[55] "X2014.07.01" ?X2014.08.01?

e<-extent(-17.96, 43.135, -30.055, 67.08)

NDVImodis<-crop(NDVImod,e) # cropping the layer to extent

NDVImodis[NDVImodis<0]<-0 # setting values below 0 as 0.

NDVImodis<-setZ(NDVImodis,d,name="months")

year.mon.mean<-zApply(NDVImodis, by=months, fun=mean, name="months")

levelplot(year.mon.mean, main="meanNDVI 2010-2014)", par.settings=myTheme)


everything seems to be going all right with the code, but i am not sure where things are going wrong- in picking out the right months to merge together.

If i were to do it manually- it works very well-

mean.jan<-mean(NDVImodis[[c(1,11,24,36,48)]])
#plot(mean.jan)
mean.feb<-mean(NDVImodis[[c(2,13,25,37,49)]])
mean.mar<-mean(NDVImodis[[c(3,14,26,38,50)]])
mean.apr<-mean(NDVImodis[[c(4,15,27,39,51)]])
mean.may<-mean(NDVImodis[[c(5,16,28,40,52)]])
mean.jun<-mean(NDVImodis[[c(17,29,41,53)]])
mean.jul<-mean(NDVImodis[[c(6,18,30,42,54)]])
mean.aug<-mean(NDVImodis[[c(7,19,31,43,55)]])
mean.sep<-mean(NDVImodis[[c(8,20,32,44)]])
mean.oct<-mean(NDVImodis[[c(9,21,33,45)]])
mean.nov<-mean(NDVImodis[[c(10,22,34,46)]])
mean.dec<-mean(NDVImodis[[c(11,23,35,47)]])

# Means
mean.year.mon<-stack(mean.jan,mean.feb,mean.mar,mean.apr,mean.may,mean.jun,
mean.jul,mean.aug,mean.sep,mean.oct,mean.nov,mean.dec)
levelplot(mean.year.mon, par.settings=myTheme)



Navinder


On 21 Oct 2014, at 13:30, Frede Aakmann T?gersen <frtog at vestas.com<mailto:frtog at vestas.com>> wrote:

Please remember to post to the list as well since this was there this thread startet.

Dows it have something to do with you not setting the name argument of setZ()?

You are doing:

NDVImodis<-setZ(NDVImodis,d)
names(NDVImodis)<-d

Perhaps you should do:

NDVImodis<-setZ(NDVImodis,d, name = ?Months?)

And then e.g.

zApply(NDVImodis, by=months, fun=mean, name="Months")

?????

Yours sincerely / Med venlig hilsen


Frede Aakmann T?gersen
Specialist, M.Sc., Ph.D.
Plant Performance & Modeling

Technology & Service Solutions
T +45 9730 5135
M +45 2547 6050
frtog at vestas.com<mailto:frtog at vestas.com>
http://www.vestas.com<http://www.vestas.com/>

Company reg. name: Vestas Wind Systems A/S
This e-mail is subject to our e-mail disclaimer statement.
Please refer to www.vestas.com/legal/notice<http://www.vestas.com/legal/notice>
If you have received this e-mail in error please contact the sender.

From: Navinder Singh [mailto:Navinder.Singh at slu.se]
Sent: 21. oktober 2014 13:22
To: Frede Aakmann T?gersen
Subject: Re: [R-sig-Geo] Order raster images in a levelplot

Thanks Frede, it worked perfectly.
However, i have problems using the 'by=months', since it is not estimating the monthly means as i want.
i want the monthly means across years.i.e means of january, feb and so on. And ?by=months? is dining some averaging but it is averaging the wrong months. Perhaps it has o do something with my naming? Below is what i did.
I couldn?t send you the entire dataset, as they are global images with each 14MB size and they run monthly for 5 years.
I also posted a message on R-sig.
Thanks for your help.
Best wishes,
Navinder

setwd("/Users/nasi/Google Drive/5KMNDVI_Monthly")

modis = stack(list.files(pattern='NDVI.tif'))
modis
names(modis)
d<-seq(as.Date("2010-01-01"),as.Date("2014-08-01"),by="month")
names(modis)<-d
NDVImod<-setZ(modis,d)
e<-extent(-17.96, 43.135, -30.055, 67.08)
NDVImodis<-crop(NDVImod,e)
NDVImodis[NDVImodis<0]<-0
NDVImodis<-setZ(NDVImodis,d)
names(NDVImodis)<-d

# The first problem occurs below. I am trying to get monthly means and other quantities. Although the function does give me an output, but the results are completely wrong. As it seems to be averaging the wrong months together. Can?t really paste the image here i suppose.

year.mon.max<-zApply(NDVImodis, by=months, fun=max, name="months")
year.mon.min<-zApply(NDVImodis, by=months, fun=min, name="months")
year.mon.diff<-year.mon.max-year.mon.min
year.mon.sd<-zApply(NDVImodis, by=months, fun=sd, name="months")
year.mon.cv<-zApply(NDVImodis, by=months, fun=cv, name="months?)

# I only manage to rearrange this one using the code after these lines. But since the images are wrong, its not of much use. Perhaps my use of ?by? argument above is not correct. Or my naming of the rasters isn?t either.

print(levelplot(year.mon.mean[[c(6,2,12,11,10,3,5,4,8,1,9,7)]], main="Mean Monthly NDVI (2010-2014)", par.settings=myTheme))

# perhaps here is where i need to use the par.cond
# I tried using ?index.cond? here like below:

levelplot(year.mon.mean, index.cond=list(c("January","February","March", "April", "May", "June","July", "August", "Septmeber", "Ocotber","November","December")), par.settings=myTheme)

#But this doesn?t plot anything. Even the maps disappear. Perhaps this again has to do with the naming in the rasters.

#Anyhow, i would like to match these monthly images with data on spatial observations of animals where i have an x,y and a date matching the date of the raster.

#I tried doing this below -
df$layer<-lapply(df$month, function(x) which(grepl(tolower(x), tolower(names(year.mon.mean)))))
df$meanNDVI<-sapply(seq_len(nrow(df)), function(x) extract(mean.year.mon[[df$layer[x]]], df[x,1:2])) # 1,2 are columns with x and y.

#This also doesn?t work, perhaps also has to do with the names in the raster.

Your help is much appreciated.
Ill keep trying the par.cond argument in the meanwhile.

Best wishes,

Navinder




Navinder J Singh
Associate Professor
Department of Wildlife, Fish, and Environmental Studies
Faculty of Forest Sciences
Swedish University of Agricultural Sciences
SE-901 83 Umea, Sweden
O: +46 (0)90 786 8538;
M: +46 (0)70 676 0103
email: navinder.singh at slu.se<mailto:navinder.singh at slu.se>
Web: navinderjsingh.weebly.com<http://navinderjsingh.weebly.com/>

www.slu.se/viltfiskmiljo/navinder_singh<http://www.slu.se/viltfiskmiljo/navinder_singh>
http://slu-se.academia.edu/NSingh



On 21 Oct 2014, at 13:10, Frede Aakmann T?gersen <frtog at vestas.com<mailto:frtog at vestas.com>> wrote:


Hi

Since I don?t have your data I cannot say anything about your use of zApply. For the levelplot() problem I think you can use the layer arguments to levelplot() from rasterVis package. Something like this:


f <- system.file("external/test.grd", package="raster")

d <- seq(as.Date("2010-01-01"),as.Date("2014-08-01"),by="month")

rr <- stack(rep(f,length(d)))
names(rr) <- d

rr <- setZ(rr, d, name = 'Month')

rr.mean <- zApply(rrr, by = months, fun = mean, name = "Month")

levelplot(rr.mean, margin = FALSE, layer = unique(months(d)), layout = c(3,4))

Yours sincerely / Med venlig hilsen


Frede Aakmann T?gersen
Specialist, M.Sc., Ph.D.
Plant Performance & Modeling

Technology & Service Solutions
T +45 9730 5135
M +45 2547 6050
frtog at vestas.com<mailto:frtog at vestas.com>
http://www.vestas.com<http://www.vestas.com/>

Company reg. name: Vestas Wind Systems A/S
This e-mail is subject to our e-mail disclaimer statement.
Please refer to www.vestas.com/legal/notice<http://www.vestas.com/legal/notice>
If you have received this e-mail in error please contact the sender.

From: Navinder Singh [mailto:Navinder.Singh at slu.se]
Sent: 21. oktober 2014 12:45
To: r-sig-geo at r-project.org<mailto:r-sig-geo at r-project.org>
Cc: oscar.perpinan at upm.es<mailto:oscar.perpinan at upm.es>; Frede Aakmann T?gersen
Subject: [R-sig-Geo] Order raster images in a levelplot


Dear Both,
Thank you for your responses.
Oscar- I am still trying to get the indexing going. Hope it will be sorted out soon.
Just to provide some more background on my code- here is an example.

library(raster)
library(rasterVis)
library(raster)
library(rgdal)
library(zoo)

setwd("/Users/nasi/Google Drive/5KMNDVI_Monthly")

modis = stack(list.files(pattern='NDVI.tif'))
modis
names(modis)
d<-seq(as.Date("2010-01-01"),as.Date("2014-08-01"),by="month")
names(modis)<-d
NDVImod<-setZ(modis,d)
e<-extent(-17.96, 43.135, -30.055, 67.08)
NDVImodis<-crop(NDVImod,e)
NDVImodis[NDVImodis<0]<-0
NDVImodis<-setZ(NDVImodis,d)
names(NDVImodis)<-d

# The first problem occurs below. I am trying to get monthly means and other quantities. Although the function does give me an output, but the results are completely wrong. As it seems to be averaging the wrong months together. Can?t really paste the image here i suppose.

year.mon.max<-zApply(NDVImodis, by=months, fun=max, name="months")
year.mon.min<-zApply(NDVImodis, by=months, fun=min, name="months")
year.mon.diff<-year.mon.max-year.mon.min
year.mon.sd<-zApply(NDVImodis, by=months, fun=sd, name="months")
year.mon.cv<-zApply(NDVImodis, by=months, fun=cv, name="months?)

# I only manage to rearrange this one using the code after these lines. But since the images are wrong, its not of much use. Perhaps my use of ?by? argument above is not correct. Or my naming of the rasters isn?t either.

print(levelplot(year.mon.mean[[c(6,2,12,11,10,3,5,4,8,1,9,7)]], main="Mean Monthly NDVI (2010-2014)", par.settings=myTheme))

# perhaps here is where i need to use the par.cond
# I tried using ?index.cond? here like below:

levelplot(year.mon.mean, index.cond=list(c("January","February","March", "April", "May", "June","July", "August", "Septmeber", "Ocotber","November", "December")),par.settings=myTheme)

#But this doesn?t plot anything. Even the maps disappear. Perhaps this again has to do with the naming in the rasters.

#Anyhow, i would like to match these monthly images with data on spatial observations of animals where i have an x,y and a date matching the date of the raster.

#I tried doing this below -
df$layer<-lapply(df$month, function(x) which(grepl(tolower(x), tolower(names(year.mon.mean)))))
df$meanNDVI<-sapply(seq_len(nrow(df)), function(x) extract(mean.year.mon[[df$layer[x]]], df[x,1:2])) # 1,2 are columns with x and y.

#This also doesn?t work, perhaps also has to do with the names in the raster.

Your help is much appreciated.
Ill keep trying the par.cond argument in the meanwhile.

Best wishes,

Navinder
















Navinder J Singh
Associate Professor
Department of Wildlife, Fish, and Environmental Studies
Faculty of Forest Sciences
Swedish University of Agricultural Sciences
SE-901 83 Umea, Sweden
O: +46 (0)90 786 8538;
M: +46 (0)70 676 0103
email: navinder.singh at slu.se<mailto:navinder.singh at slu.se>
Web: navinderjsingh.weebly.com<http://navinderjsingh.weebly.com/>

www.slu.se/viltfiskmiljo/navinder_singh<http://www.slu.se/viltfiskmiljo/navinder_singh>
http://slu-se.academia.edu/NSingh



On 21 Oct 2014, at 08:53, Frede Aakmann T?gersen <frtog at vestas.com<mailto:frtog at vestas.com>> wrote:

Hi

Since no code example was provided we'll have to guess. I suppose it has to do with the way factor() works.

Here is the built-in list of month names in R:


month.name
[1] "January"   "February"  "March"     "April"     "May"       "June"
[7] "July"      "August"    "September" "October"   "November"  "December"

Now show this as a factor:


factor(month.name)
[1] January   February  March     April     May       June      July
[8] August    September October   November  December
12 Levels: April August December February January July June March ... September

See how factor() is using lexicographical order for the labels of the factor levels.

Now do this  instead:


factor(month.name, labels = month.name)
[1] May       April     August    January   September July      June
[8] February  December  November  October   March
12 Levels: January February March April May June July August ... December

Now the order of the labels of the levels is the same as that of month.name.

Here is an example:

testdata <- data.frame(x = 1, y = 1, Month = factor(month.name))

### order of panels is that of order(month.name)
xyplot(y ~ x|Month, data = testdata)

testdata <- data.frame(x = 1, y = 1, Month = factor(month.name, labels = month.name))

### order of panels is that of month.name
### January in bottom left and Deccember in top right panel
xyplot(y ~ x|Month, data = testdata)

### use the as.table argument to get January in top left and December in bottom right
xyplot(y ~ x|Month, data = testdata, as.table = TRUE)


Yours sincerely / Med venlig hilsen


Frede Aakmann T?gersen
Specialist, M.Sc., Ph.D.
Plant Performance & Modeling

Technology & Service Solutions
T +45 9730 5135
M +45 2547 6050
frtog at vestas.com<mailto:frtog at vestas.com>
http://www.vestas.com<http://www.vestas.com/>

Company reg. name: Vestas Wind Systems A/S
This e-mail is subject to our e-mail disclaimer statement.
Please refer to www.vestas.com/legal/notice<http://www.vestas.com/legal/notice>
If you have received this e-mail in error please contact the sender.



-----Original Message-----
From: r-sig-geo-bounces at r-project.org<mailto:r-sig-geo-bounces at r-project.org> [mailto:r-sig-geo-bounces at r-
project.org<mailto:r-sig-geo-bounces at r-%0bproject.org>] On Behalf Of Oscar Perpi??n Lamigueiro
Sent: 21. oktober 2014 07:50
To: Navinder Singh
Cc: r-sig-geo at r-project.org<mailto:r-sig-geo at r-project.org>
Subject: Re: [R-sig-Geo] Order raster images in a levelplot

Hi,


1. Does someone have any suggestions on how i can order the sequence
of images in a ?levelplot" made using rasterVis.  Specifically, i
have months i need to arrange in the normal sequence, as the plot
currently aligns them in an alphabetical order. Does ?levelplot?
works the same way as xyplots in lattice?

levelplot methods defined in rasterVis are based on lattice graphics.
Most of the arguments provided by lattice::xyplot and
lattice::levelplot are also available. For this issue you could try
these arguments: perm.cond, index.cond, as.table. All of them are
described in the help page of lattice::xyplot.


2. Have there been more developments on the zApply function in the
raster package? I am trying to make basic statistical summaries for
mean monthly (eg. NDVI values) form a multi annual time series.  How
does one go about using the ?by" Indexing in this case.

Could you post a reproducible example? I have used zApply for similar
tasks without problems.

Best,

Oscar.

--
Oscar Perpi??n Lamigueiro
Dpto. Ingenier?a El?ctrica (ETSIDI-UPM)
Grupo de Sistemas Fotovoltaicos (IES-UPM)
URL: http://oscarperpinan.github.io<http://oscarperpinan.github.io/>

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org<mailto:R-sig-Geo at r-project.org>
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


	[[alternative HTML version deleted]]


From frtog at vestas.com  Tue Oct 21 15:27:03 2014
From: frtog at vestas.com (=?iso-8859-1?Q?Frede_Aakmann_T=F8gersen?=)
Date: Tue, 21 Oct 2014 15:27:03 +0200
Subject: [R-sig-Geo] Order raster images in a levelplot
In-Reply-To: <158CF4D8-815C-4C8B-9EED-BDAE74706833@slu.se>
References: <2DEBFCEA-DA32-4593-88C8-FD2DA59012B0@slu.se>
	<87ppdmhsrb.fsf@upm.es>
	<B078CDF40DFE4045AF172A8B4F68FC4857C965FB06@DKRDSEXC016.vestas.net>
	<804C9698-7BCF-4C91-87DC-D3BFEC671EEB@slu.se>
	<3055E4D2865EED429B17F80FF667E35723BEA04F@exchange2-2>
	<B078CDF40DFE4045AF172A8B4F68FC4857C965FD3D@DKRDSEXC016.vestas.net>
	<F0148F09-B265-480D-918D-EC07468A3A61@slu.se>
	<B078CDF40DFE4045AF172A8B4F68FC4857C965FD6F@DKRDSEXC016.vestas.net>
	<158CF4D8-815C-4C8B-9EED-BDAE74706833@slu.se>
Message-ID: <B078CDF40DFE4045AF172A8B4F68FC4857C965FE61@DKRDSEXC016.vestas.net>

Hi

Could it be that you are stacking the tif files in a wrong order. So that it does not correspond to your 'd' vector? Please show us the result from list.files(pattern='NDVI.tif').
I suppose that the file names will tell us something about the date for each particular file. We need to compare that to you 'd' vector.


Yours sincerely / Med venlig hilsen


Frede Aakmann T?gersen
Specialist, M.Sc., Ph.D.
Plant Performance & Modeling

Technology & Service Solutions
T +45 9730 5135
M +45 2547 6050
frtog at vestas.com<mailto:frtog at vestas.com>
http://www.vestas.com<http://www.vestas.com/>

Company reg. name: Vestas Wind Systems A/S
This e-mail is subject to our e-mail disclaimer statement.
Please refer to www.vestas.com/legal/notice<http://www.vestas.com/legal/notice>
If you have received this e-mail in error please contact the sender.

From: Navinder Singh [mailto:Navinder.Singh at slu.se]
Sent: 21. oktober 2014 14:30
To: Frede Aakmann T?gersen; Oscar Perpi??n Lamigueiro
Cc: r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] Order raster images in a levelplot

Dear Frede,
The problem still persists. It does make a plot, but then summarises using the wrong layers.

setwd("/Users/nasi/Google Drive/5KMNDVI_Monthly")
modis = stack(list.files(pattern='NDVI.tif'))
modis
names(modis)
d<-seq(as.Date("2010-01-01"),as.Date("2014-08-01"),by="month")
d
 [1] "2010-01-01" "2010-02-01" "2010-03-01" "2010-04-01" "2010-05-01" "2010-06-01"
 [7] "2010-07-01" "2010-08-01" "2010-09-01" "2010-10-01" "2010-11-01" "2010-12-01"
[13] "2011-01-01" "2011-02-01" "2011-03-01" "2011-04-01" "2011-05-01" "2011-06-01"
[19] "2011-07-01" "2011-08-01" "2011-09-01" "2011-10-01" "2011-11-01" "2011-12-01"
[25] "2012-01-01" "2012-02-01" "2012-03-01" "2012-04-01" "2012-05-01" "2012-06-01"
[31] "2012-07-01" "2012-08-01" "2012-09-01" "2012-10-01" "2012-11-01" "2012-12-01"
[37] "2013-01-01" "2013-02-01" "2013-03-01" "2013-04-01" "2013-05-01" "2013-06-01"
[43] "2013-07-01" "2013-08-01" "2013-09-01" "2013-10-01" "2013-11-01" "2013-12-01"
[49] "2014-01-01" "2014-02-01" "2014-03-01" "2014-04-01" "2014-05-01" "2014-06-01"
[55] "2014-07-01" "2014-08-01"

names(modis)<-d
NDVImod<-setZ(modis,d, name="months")

names(NDVImod)
 [1] "X2010.01.01" "X2010.02.01" "X2010.03.01" "X2010.04.01" "X2010.05.01" "X2010.06.01"
 [7] "X2010.07.01" "X2010.08.01" "X2010.09.01" "X2010.10.01" "X2010.11.01" "X2010.12.01"
[13] "X2011.01.01" "X2011.02.01" "X2011.03.01" "X2011.04.01" "X2011.05.01" "X2011.06.01"
[19] "X2011.07.01" "X2011.08.01" "X2011.09.01" "X2011.10.01" "X2011.11.01" "X2011.12.01"
[25] "X2012.01.01" "X2012.02.01" "X2012.03.01" "X2012.04.01" "X2012.05.01" "X2012.06.01"
[31] "X2012.07.01" "X2012.08.01" "X2012.09.01" "X2012.10.01" "X2012.11.01" "X2012.12.01"
[37] "X2013.01.01" "X2013.02.01" "X2013.03.01" "X2013.04.01" "X2013.05.01" "X2013.06.01"
[43] "X2013.07.01" "X2013.08.01" "X2013.09.01" "X2013.10.01" "X2013.11.01" "X2013.12.01"
[49] "X2014.01.01" "X2014.02.01" "X2014.03.01" "X2014.04.01" "X2014.05.01" "X2014.06.01"
[55] "X2014.07.01" "X2014.08.01"

e<-extent(-17.96, 43.135, -30.055, 67.08)

NDVImodis<-crop(NDVImod,e) # cropping the layer to extent

NDVImodis[NDVImodis<0]<-0 # setting values below 0 as 0.

NDVImodis<-setZ(NDVImodis,d,name="months")

year.mon.mean<-zApply(NDVImodis, by=months, fun=mean, name="months")

levelplot(year.mon.mean, main="meanNDVI 2010-2014)", par.settings=myTheme)


everything seems to be going all right with the code, but i am not sure where things are going wrong- in picking out the right months to merge together.

If i were to do it manually- it works very well-

mean.jan<-mean(NDVImodis[[c(1,11,24,36,48)]])
#plot(mean.jan)
mean.feb<-mean(NDVImodis[[c(2,13,25,37,49)]])
mean.mar<-mean(NDVImodis[[c(3,14,26,38,50)]])
mean.apr<-mean(NDVImodis[[c(4,15,27,39,51)]])
mean.may<-mean(NDVImodis[[c(5,16,28,40,52)]])
mean.jun<-mean(NDVImodis[[c(17,29,41,53)]])
mean.jul<-mean(NDVImodis[[c(6,18,30,42,54)]])
mean.aug<-mean(NDVImodis[[c(7,19,31,43,55)]])
mean.sep<-mean(NDVImodis[[c(8,20,32,44)]])
mean.oct<-mean(NDVImodis[[c(9,21,33,45)]])
mean.nov<-mean(NDVImodis[[c(10,22,34,46)]])
mean.dec<-mean(NDVImodis[[c(11,23,35,47)]])

# Means
mean.year.mon<-stack(mean.jan,mean.feb,mean.mar,mean.apr,mean.may,mean.jun,
mean.jul,mean.aug,mean.sep,mean.oct,mean.nov,mean.dec)
levelplot(mean.year.mon, par.settings=myTheme)





Navinder


On 21 Oct 2014, at 13:30, Frede Aakmann T?gersen <frtog at vestas.com<mailto:frtog at vestas.com>> wrote:


Please remember to post to the list as well since this was there this thread startet.

Dows it have something to do with you not setting the name argument of setZ()?

You are doing:

NDVImodis<-setZ(NDVImodis,d)
names(NDVImodis)<-d

Perhaps you should do:

NDVImodis<-setZ(NDVImodis,d, name = "Months")

And then e.g.

zApply(NDVImodis, by=months, fun=mean, name="Months")

?????

Yours sincerely / Med venlig hilsen


Frede Aakmann T?gersen
Specialist, M.Sc., Ph.D.
Plant Performance & Modeling

Technology & Service Solutions
T +45 9730 5135
M +45 2547 6050
frtog at vestas.com<mailto:frtog at vestas.com>
http://www.vestas.com<http://www.vestas.com/>

Company reg. name: Vestas Wind Systems A/S
This e-mail is subject to our e-mail disclaimer statement.
Please refer to www.vestas.com/legal/notice<http://www.vestas.com/legal/notice>
If you have received this e-mail in error please contact the sender.

From: Navinder Singh [mailto:Navinder.Singh at slu.se]
Sent: 21. oktober 2014 13:22
To: Frede Aakmann T?gersen
Subject: Re: [R-sig-Geo] Order raster images in a levelplot

Thanks Frede, it worked perfectly.
However, i have problems using the 'by=months', since it is not estimating the monthly means as i want.
i want the monthly means across years.i.e means of january, feb and so on. And 'by=months' is dining some averaging but it is averaging the wrong months. Perhaps it has o do something with my naming? Below is what i did.
I couldn't send you the entire dataset, as they are global images with each 14MB size and they run monthly for 5 years.
I also posted a message on R-sig.
Thanks for your help.
Best wishes,
Navinder

setwd("/Users/nasi/Google Drive/5KMNDVI_Monthly")

modis = stack(list.files(pattern='NDVI.tif'))
modis
names(modis)
d<-seq(as.Date("2010-01-01"),as.Date("2014-08-01"),by="month")
names(modis)<-d
NDVImod<-setZ(modis,d)
e<-extent(-17.96, 43.135, -30.055, 67.08)
NDVImodis<-crop(NDVImod,e)
NDVImodis[NDVImodis<0]<-0
NDVImodis<-setZ(NDVImodis,d)
names(NDVImodis)<-d

# The first problem occurs below. I am trying to get monthly means and other quantities. Although the function does give me an output, but the results are completely wrong. As it seems to be averaging the wrong months together. Can't really paste the image here i suppose.

year.mon.max<-zApply(NDVImodis, by=months, fun=max, name="months")
year.mon.min<-zApply(NDVImodis, by=months, fun=min, name="months")
year.mon.diff<-year.mon.max-year.mon.min
year.mon.sd<-zApply(NDVImodis, by=months, fun=sd, name="months")
year.mon.cv<-zApply(NDVImodis, by=months, fun=cv, name="months")

# I only manage to rearrange this one using the code after these lines. But since the images are wrong, its not of much use. Perhaps my use of 'by' argument above is not correct. Or my naming of the rasters isn't either.

print(levelplot(year.mon.mean[[c(6,2,12,11,10,3,5,4,8,1,9,7)]], main="Mean Monthly NDVI (2010-2014)", par.settings=myTheme))

# perhaps here is where i need to use the par.cond
# I tried using 'index.cond' here like below:

levelplot(year.mon.mean, index.cond=list(c("January","February","March", "April", "May", "June","July", "August", "Septmeber", "Ocotber","November","December")), par.settings=myTheme)

#But this doesn't plot anything. Even the maps disappear. Perhaps this again has to do with the naming in the rasters.

#Anyhow, i would like to match these monthly images with data on spatial observations of animals where i have an x,y and a date matching the date of the raster.

#I tried doing this below -
df$layer<-lapply(df$month, function(x) which(grepl(tolower(x), tolower(names(year.mon.mean)))))
df$meanNDVI<-sapply(seq_len(nrow(df)), function(x) extract(mean.year.mon[[df$layer[x]]], df[x,1:2])) # 1,2 are columns with x and y.

#This also doesn't work, perhaps also has to do with the names in the raster.

Your help is much appreciated.
Ill keep trying the par.cond argument in the meanwhile.

Best wishes,

Navinder




Navinder J Singh
Associate Professor
Department of Wildlife, Fish, and Environmental Studies
Faculty of Forest Sciences
Swedish University of Agricultural Sciences
SE-901 83 Umea, Sweden
O: +46 (0)90 786 8538;
M: +46 (0)70 676 0103
email: navinder.singh at slu.se<mailto:navinder.singh at slu.se>
Web: navinderjsingh.weebly.com<http://navinderjsingh.weebly.com/>

www.slu.se/viltfiskmiljo/navinder_singh<http://www.slu.se/viltfiskmiljo/navinder_singh>
http://slu-se.academia.edu/NSingh



On 21 Oct 2014, at 13:10, Frede Aakmann T?gersen <frtog at vestas.com<mailto:frtog at vestas.com>> wrote:



Hi

Since I don't have your data I cannot say anything about your use of zApply. For the levelplot() problem I think you can use the layer arguments to levelplot() from rasterVis package. Something like this:


f <- system.file("external/test.grd", package="raster")

d <- seq(as.Date("2010-01-01"),as.Date("2014-08-01"),by="month")

rr <- stack(rep(f,length(d)))
names(rr) <- d

rr <- setZ(rr, d, name = 'Month')

rr.mean <- zApply(rrr, by = months, fun = mean, name = "Month")

levelplot(rr.mean, margin = FALSE, layer = unique(months(d)), layout = c(3,4))

Yours sincerely / Med venlig hilsen


Frede Aakmann T?gersen
Specialist, M.Sc., Ph.D.
Plant Performance & Modeling

Technology & Service Solutions
T +45 9730 5135
M +45 2547 6050
frtog at vestas.com<mailto:frtog at vestas.com>
http://www.vestas.com<http://www.vestas.com/>

Company reg. name: Vestas Wind Systems A/S
This e-mail is subject to our e-mail disclaimer statement.
Please refer to www.vestas.com/legal/notice<http://www.vestas.com/legal/notice>
If you have received this e-mail in error please contact the sender.

From: Navinder Singh [mailto:Navinder.Singh at slu.se]
Sent: 21. oktober 2014 12:45
To: r-sig-geo at r-project.org<mailto:r-sig-geo at r-project.org>
Cc: oscar.perpinan at upm.es<mailto:oscar.perpinan at upm.es>; Frede Aakmann T?gersen
Subject: [R-sig-Geo] Order raster images in a levelplot


Dear Both,
Thank you for your responses.
Oscar- I am still trying to get the indexing going. Hope it will be sorted out soon.
Just to provide some more background on my code- here is an example.

library(raster)
library(rasterVis)
library(raster)
library(rgdal)
library(zoo)

setwd("/Users/nasi/Google Drive/5KMNDVI_Monthly")

modis = stack(list.files(pattern='NDVI.tif'))
modis
names(modis)
d<-seq(as.Date("2010-01-01"),as.Date("2014-08-01"),by="month")
names(modis)<-d
NDVImod<-setZ(modis,d)
e<-extent(-17.96, 43.135, -30.055, 67.08)
NDVImodis<-crop(NDVImod,e)
NDVImodis[NDVImodis<0]<-0
NDVImodis<-setZ(NDVImodis,d)
names(NDVImodis)<-d

# The first problem occurs below. I am trying to get monthly means and other quantities. Although the function does give me an output, but the results are completely wrong. As it seems to be averaging the wrong months together. Can't really paste the image here i suppose.

year.mon.max<-zApply(NDVImodis, by=months, fun=max, name="months")
year.mon.min<-zApply(NDVImodis, by=months, fun=min, name="months")
year.mon.diff<-year.mon.max-year.mon.min
year.mon.sd<-zApply(NDVImodis, by=months, fun=sd, name="months")
year.mon.cv<-zApply(NDVImodis, by=months, fun=cv, name="months")

# I only manage to rearrange this one using the code after these lines. But since the images are wrong, its not of much use. Perhaps my use of 'by' argument above is not correct. Or my naming of the rasters isn't either.

print(levelplot(year.mon.mean[[c(6,2,12,11,10,3,5,4,8,1,9,7)]], main="Mean Monthly NDVI (2010-2014)", par.settings=myTheme))

# perhaps here is where i need to use the par.cond
# I tried using 'index.cond' here like below:

levelplot(year.mon.mean, index.cond=list(c("January","February","March", "April", "May", "June","July", "August", "Septmeber", "Ocotber","November", "December")),par.settings=myTheme)

#But this doesn't plot anything. Even the maps disappear. Perhaps this again has to do with the naming in the rasters.

#Anyhow, i would like to match these monthly images with data on spatial observations of animals where i have an x,y and a date matching the date of the raster.

#I tried doing this below -
df$layer<-lapply(df$month, function(x) which(grepl(tolower(x), tolower(names(year.mon.mean)))))
df$meanNDVI<-sapply(seq_len(nrow(df)), function(x) extract(mean.year.mon[[df$layer[x]]], df[x,1:2])) # 1,2 are columns with x and y.

#This also doesn't work, perhaps also has to do with the names in the raster.

Your help is much appreciated.
Ill keep trying the par.cond argument in the meanwhile.

Best wishes,

Navinder
















Navinder J Singh
Associate Professor
Department of Wildlife, Fish, and Environmental Studies
Faculty of Forest Sciences
Swedish University of Agricultural Sciences
SE-901 83 Umea, Sweden
O: +46 (0)90 786 8538;
M: +46 (0)70 676 0103
email: navinder.singh at slu.se<mailto:navinder.singh at slu.se>
Web: navinderjsingh.weebly.com<http://navinderjsingh.weebly.com/>

www.slu.se/viltfiskmiljo/navinder_singh<http://www.slu.se/viltfiskmiljo/navinder_singh>
http://slu-se.academia.edu/NSingh



On 21 Oct 2014, at 08:53, Frede Aakmann T?gersen <frtog at vestas.com<mailto:frtog at vestas.com>> wrote:

Hi

Since no code example was provided we'll have to guess. I suppose it has to do with the way factor() works.

Here is the built-in list of month names in R:



month.name
[1] "January"   "February"  "March"     "April"     "May"       "June"
[7] "July"      "August"    "September" "October"   "November"  "December"

Now show this as a factor:



factor(month.name)
[1] January   February  March     April     May       June      July
[8] August    September October   November  December
12 Levels: April August December February January July June March ... September

See how factor() is using lexicographical order for the labels of the factor levels.

Now do this  instead:



factor(month.name, labels = month.name)
[1] May       April     August    January   September July      June
[8] February  December  November  October   March
12 Levels: January February March April May June July August ... December

Now the order of the labels of the levels is the same as that of month.name.

Here is an example:

testdata <- data.frame(x = 1, y = 1, Month = factor(month.name))

### order of panels is that of order(month.name)
xyplot(y ~ x|Month, data = testdata)

testdata <- data.frame(x = 1, y = 1, Month = factor(month.name, labels = month.name))

### order of panels is that of month.name
### January in bottom left and Deccember in top right panel
xyplot(y ~ x|Month, data = testdata)

### use the as.table argument to get January in top left and December in bottom right
xyplot(y ~ x|Month, data = testdata, as.table = TRUE)


Yours sincerely / Med venlig hilsen


Frede Aakmann T?gersen
Specialist, M.Sc., Ph.D.
Plant Performance & Modeling

Technology & Service Solutions
T +45 9730 5135
M +45 2547 6050
frtog at vestas.com<mailto:frtog at vestas.com>
http://www.vestas.com<http://www.vestas.com/>

Company reg. name: Vestas Wind Systems A/S
This e-mail is subject to our e-mail disclaimer statement.
Please refer to www.vestas.com/legal/notice<http://www.vestas.com/legal/notice>
If you have received this e-mail in error please contact the sender.




-----Original Message-----
From: r-sig-geo-bounces at r-project.org<mailto:r-sig-geo-bounces at r-project.org> [mailto:r-sig-geo-bounces at r-
project.org<mailto:r-sig-geo-bounces at r-%0bproject.org>] On Behalf Of Oscar Perpi??n Lamigueiro
Sent: 21. oktober 2014 07:50
To: Navinder Singh
Cc: r-sig-geo at r-project.org<mailto:r-sig-geo at r-project.org>
Subject: Re: [R-sig-Geo] Order raster images in a levelplot

Hi,



1. Does someone have any suggestions on how i can order the sequence
of images in a "levelplot" made using rasterVis.  Specifically, i
have months i need to arrange in the normal sequence, as the plot
currently aligns them in an alphabetical order. Does "levelplot"
works the same way as xyplots in lattice?

levelplot methods defined in rasterVis are based on lattice graphics.
Most of the arguments provided by lattice::xyplot and
lattice::levelplot are also available. For this issue you could try
these arguments: perm.cond, index.cond, as.table. All of them are
described in the help page of lattice::xyplot.



2. Have there been more developments on the zApply function in the
raster package? I am trying to make basic statistical summaries for
mean monthly (eg. NDVI values) form a multi annual time series.  How
does one go about using the "by" Indexing in this case.

Could you post a reproducible example? I have used zApply for similar
tasks without problems.

Best,

Oscar.

--
Oscar Perpi??n Lamigueiro
Dpto. Ingenier?a El?ctrica (ETSIDI-UPM)
Grupo de Sistemas Fotovoltaicos (IES-UPM)
URL: http://oscarperpinan.github.io<http://oscarperpinan.github.io/>

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org<mailto:R-sig-Geo at r-project.org>
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


	[[alternative HTML version deleted]]


From frtog at vestas.com  Tue Oct 21 21:12:53 2014
From: frtog at vestas.com (=?iso-8859-1?Q?Frede_Aakmann_T=F8gersen?=)
Date: Tue, 21 Oct 2014 21:12:53 +0200
Subject: [R-sig-Geo] Order raster images in a levelplot
In-Reply-To: <FBCCC8C5-D1E9-439D-B440-EC7E402E5A36@slu.se>
References: <2DEBFCEA-DA32-4593-88C8-FD2DA59012B0@slu.se>
	<87ppdmhsrb.fsf@upm.es>
	<B078CDF40DFE4045AF172A8B4F68FC4857C965FB06@DKRDSEXC016.vestas.net>
	<804C9698-7BCF-4C91-87DC-D3BFEC671EEB@slu.se>
	<3055E4D2865EED429B17F80FF667E35723BEA04F@exchange2-2>
	<B078CDF40DFE4045AF172A8B4F68FC4857C965FD3D@DKRDSEXC016.vestas.net>
	<F0148F09-B265-480D-918D-EC07468A3A61@slu.se>
	<B078CDF40DFE4045AF172A8B4F68FC4857C965FD6F@DKRDSEXC016.vestas.net>
	<158CF4D8-815C-4C8B-9EED-BDAE74706833@slu.se>
	<B078CDF40DFE4045AF172A8B4F68FC4857C965FE61@DKRDSEXC016.vestas.net>
	<FBCCC8C5-D1E9-439D-B440-EC7E402E5A36@slu.se>
Message-ID: <B078CDF40DFE4045AF172A8B4F68FC4857C965FF2D@DKRDSEXC016.vestas.net>

Hi

I give up. You'll have to approach the maintainer of the raster package directly.

As far as I can see there is no difference in the order of your stack(files) and 'd'.

Here is my documentation of that:

ndvif <- c( # output from names(modis)
"MOD13C2.A2010001.CMG_0.05_Deg_Monthly_NDVI",
"MOD13C2.A2010032.CMG_0.05_Deg_Monthly_NDVI",
"MOD13C2.A2010060.CMG_0.05_Deg_Monthly_NDVI",
"MOD13C2.A2010091.CMG_0.05_Deg_Monthly_NDVI",
"MOD13C2.A2010121.CMG_0.05_Deg_Monthly_NDVI",
"MOD13C2.A2010152.CMG_0.05_Deg_Monthly_NDVI",
"MOD13C2.A2010182.CMG_0.05_Deg_Monthly_NDVI",
"MOD13C2.A2010213.CMG_0.05_Deg_Monthly_NDVI",
"MOD13C2.A2010244.CMG_0.05_Deg_Monthly_NDVI",
"MOD13C2.A2010274.CMG_0.05_Deg_Monthly_NDVI",
"MOD13C2.A2010305.CMG_0.05_Deg_Monthly_NDVI",
"MOD13C2.A2010335.CMG_0.05_Deg_Monthly_NDVI",
"MOD13C2.A2011001.CMG_0.05_Deg_Monthly_NDVI",
"MOD13C2.A2011032.CMG_0.05_Deg_Monthly_NDVI",
"MOD13C2.A2011060.CMG_0.05_Deg_Monthly_NDVI",
"MOD13C2.A2011091.CMG_0.05_Deg_Monthly_NDVI",
"MOD13C2.A2011121.CMG_0.05_Deg_Monthly_NDVI",
"MOD13C2.A2011152.CMG_0.05_Deg_Monthly_NDVI",
"MOD13C2.A2011182.CMG_0.05_Deg_Monthly_NDVI",
"MOD13C2.A2011213.CMG_0.05_Deg_Monthly_NDVI",
"MOD13C2.A2011244.CMG_0.05_Deg_Monthly_NDVI",
"MOD13C2.A2011274.CMG_0.05_Deg_Monthly_NDVI",
"MOD13C2.A2011305.CMG_0.05_Deg_Monthly_NDVI",
"MOD13C2.A2011335.CMG_0.05_Deg_Monthly_NDVI",
"MOD13C2.A2012001.CMG_0.05_Deg_Monthly_NDVI",
"MOD13C2.A2012032.CMG_0.05_Deg_Monthly_NDVI",
"MOD13C2.A2012061.CMG_0.05_Deg_Monthly_NDVI",
"MOD13C2.A2012092.CMG_0.05_Deg_Monthly_NDVI",
"MOD13C2.A2012122.CMG_0.05_Deg_Monthly_NDVI",
"MOD13C2.A2012153.CMG_0.05_Deg_Monthly_NDVI",
"MOD13C2.A2012183.CMG_0.05_Deg_Monthly_NDVI",
"MOD13C2.A2012214.CMG_0.05_Deg_Monthly_NDVI",
"MOD13C2.A2012245.CMG_0.05_Deg_Monthly_NDVI",
"MOD13C2.A2012275.CMG_0.05_Deg_Monthly_NDVI",
"MOD13C2.A2012306.CMG_0.05_Deg_Monthly_NDVI",
"MOD13C2.A2012336.CMG_0.05_Deg_Monthly_NDVI",
"MOD13C2.A2013001.CMG_0.05_Deg_Monthly_NDVI",
"MOD13C2.A2013032.CMG_0.05_Deg_Monthly_NDVI",
"MOD13C2.A2013060.CMG_0.05_Deg_Monthly_NDVI",
"MOD13C2.A2013091.CMG_0.05_Deg_Monthly_NDVI",
"MOD13C2.A2013121.CMG_0.05_Deg_Monthly_NDVI",
"MOD13C2.A2013152.CMG_0.05_Deg_Monthly_NDVI",
"MOD13C2.A2013182.CMG_0.05_Deg_Monthly_NDVI",
"MOD13C2.A2013213.CMG_0.05_Deg_Monthly_NDVI",
"MOD13C2.A2013244.CMG_0.05_Deg_Monthly_NDVI",
"MOD13C2.A2013274.CMG_0.05_Deg_Monthly_NDVI",
"MOD13C2.A2013305.CMG_0.05_Deg_Monthly_NDVI",
"MOD13C2.A2013335.CMG_0.05_Deg_Monthly_NDVI",
"MOD13C2.A2014001.CMG_0.05_Deg_Monthly_NDVI",
"MOD13C2.A2014032.CMG_0.05_Deg_Monthly_NDVI",
"MOD13C2.A2014060.CMG_0.05_Deg_Monthly_NDVI",
"MOD13C2.A2014091.CMG_0.05_Deg_Monthly_NDVI",
"MOD13C2.A2014121.CMG_0.05_Deg_Monthly_NDVI",
"MOD13C2.A2014152.CMG_0.05_Deg_Monthly_NDVI",
"MOD13C2.A2014182.CMG_0.05_Deg_Monthly_NDVI",
"MOD13C2.A2014213.CMG_0.05_Deg_Monthly_NDVI")

ftimes <- substring(ndvif, 10, 16)

ftimes <- strptime(ftimes, format = "%Y%j")

d <- seq(as.Date("2010-01-01"), as.Date("2014-08-01"), by="month")

m1 <- months(ftimes)
m2 <- months(d)

cbind(m1, m2)


Yours sincerely / Med venlig hilsen


Frede Aakmann T?gersen
Specialist, M.Sc., Ph.D.
Plant Performance & Modeling

Technology & Service Solutions
T +45 9730 5135
M +45 2547 6050
frtog at vestas.com<mailto:frtog at vestas.com>
http://www.vestas.com<http://www.vestas.com/>

Company reg. name: Vestas Wind Systems A/S
This e-mail is subject to our e-mail disclaimer statement.
Please refer to www.vestas.com/legal/notice<http://www.vestas.com/legal/notice>
If you have received this e-mail in error please contact the sender.

From: Navinder Singh [mailto:Navinder.Singh at slu.se]
Sent: 21. oktober 2014 15:45
To: Frede Aakmann T?gersen
Cc: Oscar Perpi??n Lamigueiro; r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] Order raster images in a levelplot

Here's what the stack looks like:
setwd("C:\\Users\\nasi\\Google<smb://Users/nasi/Google> Drive\\5KMNDVI_Monthly")
modis = stack(list.files(pattern='NDVI.tif'))

> names(modis)
 [1] "MOD13C2.A2010001.CMG_0.05_Deg_Monthly_NDVI"
 [2] "MOD13C2.A2010032.CMG_0.05_Deg_Monthly_NDVI"
 [3] "MOD13C2.A2010060.CMG_0.05_Deg_Monthly_NDVI"
 [4] "MOD13C2.A2010091.CMG_0.05_Deg_Monthly_NDVI"
 [5] "MOD13C2.A2010121.CMG_0.05_Deg_Monthly_NDVI"
 [6] "MOD13C2.A2010152.CMG_0.05_Deg_Monthly_NDVI"
 [7] "MOD13C2.A2010182.CMG_0.05_Deg_Monthly_NDVI"
 [8] "MOD13C2.A2010213.CMG_0.05_Deg_Monthly_NDVI"
 [9] "MOD13C2.A2010244.CMG_0.05_Deg_Monthly_NDVI"
[10] "MOD13C2.A2010274.CMG_0.05_Deg_Monthly_NDVI"
[11] "MOD13C2.A2010305.CMG_0.05_Deg_Monthly_NDVI"
[12] "MOD13C2.A2010335.CMG_0.05_Deg_Monthly_NDVI"
[13] "MOD13C2.A2011001.CMG_0.05_Deg_Monthly_NDVI"
[14] "MOD13C2.A2011032.CMG_0.05_Deg_Monthly_NDVI"
[15] "MOD13C2.A2011060.CMG_0.05_Deg_Monthly_NDVI"
[16] "MOD13C2.A2011091.CMG_0.05_Deg_Monthly_NDVI"
[17] "MOD13C2.A2011121.CMG_0.05_Deg_Monthly_NDVI"
[18] "MOD13C2.A2011152.CMG_0.05_Deg_Monthly_NDVI"
[19] "MOD13C2.A2011182.CMG_0.05_Deg_Monthly_NDVI"
[20] "MOD13C2.A2011213.CMG_0.05_Deg_Monthly_NDVI"
[21] "MOD13C2.A2011244.CMG_0.05_Deg_Monthly_NDVI"
[22] "MOD13C2.A2011274.CMG_0.05_Deg_Monthly_NDVI"
[23] "MOD13C2.A2011305.CMG_0.05_Deg_Monthly_NDVI"
[24] "MOD13C2.A2011335.CMG_0.05_Deg_Monthly_NDVI"
[25] "MOD13C2.A2012001.CMG_0.05_Deg_Monthly_NDVI"
[26] "MOD13C2.A2012032.CMG_0.05_Deg_Monthly_NDVI"
[27] "MOD13C2.A2012061.CMG_0.05_Deg_Monthly_NDVI"
[28] "MOD13C2.A2012092.CMG_0.05_Deg_Monthly_NDVI"
[29] "MOD13C2.A2012122.CMG_0.05_Deg_Monthly_NDVI"
[30] "MOD13C2.A2012153.CMG_0.05_Deg_Monthly_NDVI"
[31] "MOD13C2.A2012183.CMG_0.05_Deg_Monthly_NDVI"
[32] "MOD13C2.A2012214.CMG_0.05_Deg_Monthly_NDVI"
[33] "MOD13C2.A2012245.CMG_0.05_Deg_Monthly_NDVI"
[34] "MOD13C2.A2012275.CMG_0.05_Deg_Monthly_NDVI"
[35] "MOD13C2.A2012306.CMG_0.05_Deg_Monthly_NDVI"
[36] "MOD13C2.A2012336.CMG_0.05_Deg_Monthly_NDVI"
[37] "MOD13C2.A2013001.CMG_0.05_Deg_Monthly_NDVI"
[38] "MOD13C2.A2013032.CMG_0.05_Deg_Monthly_NDVI"
[39] "MOD13C2.A2013060.CMG_0.05_Deg_Monthly_NDVI"
[40] "MOD13C2.A2013091.CMG_0.05_Deg_Monthly_NDVI"
[41] "MOD13C2.A2013121.CMG_0.05_Deg_Monthly_NDVI"
[42] "MOD13C2.A2013152.CMG_0.05_Deg_Monthly_NDVI"
[43] "MOD13C2.A2013182.CMG_0.05_Deg_Monthly_NDVI"
[44] "MOD13C2.A2013213.CMG_0.05_Deg_Monthly_NDVI"
[45] "MOD13C2.A2013244.CMG_0.05_Deg_Monthly_NDVI"
[46] "MOD13C2.A2013274.CMG_0.05_Deg_Monthly_NDVI"
[47] "MOD13C2.A2013305.CMG_0.05_Deg_Monthly_NDVI"
[48] "MOD13C2.A2013335.CMG_0.05_Deg_Monthly_NDVI"
[49] "MOD13C2.A2014001.CMG_0.05_Deg_Monthly_NDVI"
[50] "MOD13C2.A2014032.CMG_0.05_Deg_Monthly_NDVI"
[51] "MOD13C2.A2014060.CMG_0.05_Deg_Monthly_NDVI"
[52] "MOD13C2.A2014091.CMG_0.05_Deg_Monthly_NDVI"
[53] "MOD13C2.A2014121.CMG_0.05_Deg_Monthly_NDVI"
[54] "MOD13C2.A2014152.CMG_0.05_Deg_Monthly_NDVI"
[55] "MOD13C2.A2014182.CMG_0.05_Deg_Monthly_NDVI"
[56] "MOD13C2.A2014213.CMG_0.05_Deg_Monthly_NDVI"

d<-seq(as.Date("2010-01-01"),as.Date("2014-08-01"),by="month")
d


Navinder J Singh
Associate Professor
Department of Wildlife, Fish, and Environmental Studies
Faculty of Forest Sciences
Swedish University of Agricultural Sciences
SE-901 83 Umea, Sweden
O: +46 (0)90 786 8538;
M: +46 (0)70 676 0103
email: navinder.singh at slu.se<mailto:navinder.singh at slu.se>
Web: navinderjsingh.weebly.com<http://navinderjsingh.weebly.com/>

www.slu.se/viltfiskmiljo/navinder_singh<http://www.slu.se/viltfiskmiljo/navinder_singh>
http://slu-se.academia.edu/NSingh



On 21 Oct 2014, at 15:27, Frede Aakmann T?gersen <frtog at vestas.com<mailto:frtog at vestas.com>> wrote:


Hi

Could it be that you are stacking the tif files in a wrong order. So that it does not correspond to your 'd' vector? Please show us the result from list.files(pattern='NDVI.tif').
I suppose that the file names will tell us something about the date for each particular file. We need to compare that to you 'd' vector.


Yours sincerely / Med venlig hilsen


Frede Aakmann T?gersen
Specialist, M.Sc., Ph.D.
Plant Performance & Modeling

Technology & Service Solutions
T +45 9730 5135
M +45 2547 6050
frtog at vestas.com<mailto:frtog at vestas.com>
http://www.vestas.com<http://www.vestas.com/>

Company reg. name: Vestas Wind Systems A/S
This e-mail is subject to our e-mail disclaimer statement.
Please refer to www.vestas.com/legal/notice<http://www.vestas.com/legal/notice>
If you have received this e-mail in error please contact the sender.

From: Navinder Singh [mailto:Navinder.Singh at slu.se]
Sent: 21. oktober 2014 14:30
To: Frede Aakmann T?gersen; Oscar Perpi??n Lamigueiro
Cc: r-sig-geo at r-project.org<mailto:r-sig-geo at r-project.org>
Subject: Re: [R-sig-Geo] Order raster images in a levelplot

Dear Frede,
The problem still persists. It does make a plot, but then summarises using the wrong layers.

setwd("/Users/nasi/Google Drive/5KMNDVI_Monthly")
modis = stack(list.files(pattern='NDVI.tif'))
modis
names(modis)
d<-seq(as.Date("2010-01-01"),as.Date("2014-08-01"),by="month")
d
 [1] "2010-01-01" "2010-02-01" "2010-03-01" "2010-04-01" "2010-05-01" "2010-06-01"
 [7] "2010-07-01" "2010-08-01" "2010-09-01" "2010-10-01" "2010-11-01" "2010-12-01"
[13] "2011-01-01" "2011-02-01" "2011-03-01" "2011-04-01" "2011-05-01" "2011-06-01"
[19] "2011-07-01" "2011-08-01" "2011-09-01" "2011-10-01" "2011-11-01" "2011-12-01"
[25] "2012-01-01" "2012-02-01" "2012-03-01" "2012-04-01" "2012-05-01" "2012-06-01"
[31] "2012-07-01" "2012-08-01" "2012-09-01" "2012-10-01" "2012-11-01" "2012-12-01"
[37] "2013-01-01" "2013-02-01" "2013-03-01" "2013-04-01" "2013-05-01" "2013-06-01"
[43] "2013-07-01" "2013-08-01" "2013-09-01" "2013-10-01" "2013-11-01" "2013-12-01"
[49] "2014-01-01" "2014-02-01" "2014-03-01" "2014-04-01" "2014-05-01" "2014-06-01"
[55] "2014-07-01" "2014-08-01"

names(modis)<-d
NDVImod<-setZ(modis,d, name="months")

names(NDVImod)
 [1] "X2010.01.01" "X2010.02.01" "X2010.03.01" "X2010.04.01" "X2010.05.01" "X2010.06.01"
 [7] "X2010.07.01" "X2010.08.01" "X2010.09.01" "X2010.10.01" "X2010.11.01" "X2010.12.01"
[13] "X2011.01.01" "X2011.02.01" "X2011.03.01" "X2011.04.01" "X2011.05.01" "X2011.06.01"
[19] "X2011.07.01" "X2011.08.01" "X2011.09.01" "X2011.10.01" "X2011.11.01" "X2011.12.01"
[25] "X2012.01.01" "X2012.02.01" "X2012.03.01" "X2012.04.01" "X2012.05.01" "X2012.06.01"
[31] "X2012.07.01" "X2012.08.01" "X2012.09.01" "X2012.10.01" "X2012.11.01" "X2012.12.01"
[37] "X2013.01.01" "X2013.02.01" "X2013.03.01" "X2013.04.01" "X2013.05.01" "X2013.06.01"
[43] "X2013.07.01" "X2013.08.01" "X2013.09.01" "X2013.10.01" "X2013.11.01" "X2013.12.01"
[49] "X2014.01.01" "X2014.02.01" "X2014.03.01" "X2014.04.01" "X2014.05.01" "X2014.06.01"
[55] "X2014.07.01" "X2014.08.01"

e<-extent(-17.96, 43.135, -30.055, 67.08)

NDVImodis<-crop(NDVImod,e) # cropping the layer to extent

NDVImodis[NDVImodis<0]<-0 # setting values below 0 as 0.

NDVImodis<-setZ(NDVImodis,d,name="months")

year.mon.mean<-zApply(NDVImodis, by=months, fun=mean, name="months")

levelplot(year.mon.mean, main="meanNDVI 2010-2014)", par.settings=myTheme)


everything seems to be going all right with the code, but i am not sure where things are going wrong- in picking out the right months to merge together.

If i were to do it manually- it works very well-

mean.jan<-mean(NDVImodis[[c(1,11,24,36,48)]])
#plot(mean.jan)
mean.feb<-mean(NDVImodis[[c(2,13,25,37,49)]])
mean.mar<-mean(NDVImodis[[c(3,14,26,38,50)]])
mean.apr<-mean(NDVImodis[[c(4,15,27,39,51)]])
mean.may<-mean(NDVImodis[[c(5,16,28,40,52)]])
mean.jun<-mean(NDVImodis[[c(17,29,41,53)]])
mean.jul<-mean(NDVImodis[[c(6,18,30,42,54)]])
mean.aug<-mean(NDVImodis[[c(7,19,31,43,55)]])
mean.sep<-mean(NDVImodis[[c(8,20,32,44)]])
mean.oct<-mean(NDVImodis[[c(9,21,33,45)]])
mean.nov<-mean(NDVImodis[[c(10,22,34,46)]])
mean.dec<-mean(NDVImodis[[c(11,23,35,47)]])

# Means
mean.year.mon<-stack(mean.jan,mean.feb,mean.mar,mean.apr,mean.may,mean.jun,
mean.jul,mean.aug,mean.sep,mean.oct,mean.nov,mean.dec)
levelplot(mean.year.mon, par.settings=myTheme)







Navinder


On 21 Oct 2014, at 13:30, Frede Aakmann T?gersen <frtog at vestas.com<mailto:frtog at vestas.com>> wrote:



Please remember to post to the list as well since this was there this thread startet.

Dows it have something to do with you not setting the name argument of setZ()?

You are doing:

NDVImodis<-setZ(NDVImodis,d)
names(NDVImodis)<-d

Perhaps you should do:

NDVImodis<-setZ(NDVImodis,d, name = "Months")

And then e.g.

zApply(NDVImodis, by=months, fun=mean, name="Months")

?????

Yours sincerely / Med venlig hilsen


Frede Aakmann T?gersen
Specialist, M.Sc., Ph.D.
Plant Performance & Modeling

Technology & Service Solutions
T +45 9730 5135
M +45 2547 6050
frtog at vestas.com<mailto:frtog at vestas.com>
http://www.vestas.com<http://www.vestas.com/>

Company reg. name: Vestas Wind Systems A/S
This e-mail is subject to our e-mail disclaimer statement.
Please refer to www.vestas.com/legal/notice<http://www.vestas.com/legal/notice>
If you have received this e-mail in error please contact the sender.

From: Navinder Singh [mailto:Navinder.Singh at slu.se]
Sent: 21. oktober 2014 13:22
To: Frede Aakmann T?gersen
Subject: Re: [R-sig-Geo] Order raster images in a levelplot

Thanks Frede, it worked perfectly.
However, i have problems using the 'by=months', since it is not estimating the monthly means as i want.
i want the monthly means across years.i.e means of january, feb and so on. And 'by=months' is dining some averaging but it is averaging the wrong months. Perhaps it has o do something with my naming? Below is what i did.
I couldn't send you the entire dataset, as they are global images with each 14MB size and they run monthly for 5 years.
I also posted a message on R-sig.
Thanks for your help.
Best wishes,
Navinder

setwd("/Users/nasi/Google Drive/5KMNDVI_Monthly")

modis = stack(list.files(pattern='NDVI.tif'))
modis
names(modis)
d<-seq(as.Date("2010-01-01"),as.Date("2014-08-01"),by="month")
names(modis)<-d
NDVImod<-setZ(modis,d)
e<-extent(-17.96, 43.135, -30.055, 67.08)
NDVImodis<-crop(NDVImod,e)
NDVImodis[NDVImodis<0]<-0
NDVImodis<-setZ(NDVImodis,d)
names(NDVImodis)<-d

# The first problem occurs below. I am trying to get monthly means and other quantities. Although the function does give me an output, but the results are completely wrong. As it seems to be averaging the wrong months together. Can't really paste the image here i suppose.

year.mon.max<-zApply(NDVImodis, by=months, fun=max, name="months")
year.mon.min<-zApply(NDVImodis, by=months, fun=min, name="months")
year.mon.diff<-year.mon.max-year.mon.min
year.mon.sd<-zApply(NDVImodis, by=months, fun=sd, name="months")
year.mon.cv<-zApply(NDVImodis, by=months, fun=cv, name="months")

# I only manage to rearrange this one using the code after these lines. But since the images are wrong, its not of much use. Perhaps my use of 'by' argument above is not correct. Or my naming of the rasters isn't either.

print(levelplot(year.mon.mean[[c(6,2,12,11,10,3,5,4,8,1,9,7)]], main="Mean Monthly NDVI (2010-2014)", par.settings=myTheme))

# perhaps here is where i need to use the par.cond
# I tried using 'index.cond' here like below:

levelplot(year.mon.mean, index.cond=list(c("January","February","March", "April", "May", "June","July", "August", "Septmeber", "Ocotber","November","December")), par.settings=myTheme)

#But this doesn't plot anything. Even the maps disappear. Perhaps this again has to do with the naming in the rasters.

#Anyhow, i would like to match these monthly images with data on spatial observations of animals where i have an x,y and a date matching the date of the raster.

#I tried doing this below -
df$layer<-lapply(df$month, function(x) which(grepl(tolower(x), tolower(names(year.mon.mean)))))
df$meanNDVI<-sapply(seq_len(nrow(df)), function(x) extract(mean.year.mon[[df$layer[x]]], df[x,1:2])) # 1,2 are columns with x and y.

#This also doesn't work, perhaps also has to do with the names in the raster.

Your help is much appreciated.
Ill keep trying the par.cond argument in the meanwhile.

Best wishes,

Navinder




Navinder J Singh
Associate Professor
Department of Wildlife, Fish, and Environmental Studies
Faculty of Forest Sciences
Swedish University of Agricultural Sciences
SE-901 83 Umea, Sweden
O: +46 (0)90 786 8538;
M: +46 (0)70 676 0103
email: navinder.singh at slu.se<mailto:navinder.singh at slu.se>
Web: navinderjsingh.weebly.com<http://navinderjsingh.weebly.com/>

www.slu.se/viltfiskmiljo/navinder_singh<http://www.slu.se/viltfiskmiljo/navinder_singh>
http://slu-se.academia.edu/NSingh



On 21 Oct 2014, at 13:10, Frede Aakmann T?gersen <frtog at vestas.com<mailto:frtog at vestas.com>> wrote:




Hi

Since I don't have your data I cannot say anything about your use of zApply. For the levelplot() problem I think you can use the layer arguments to levelplot() from rasterVis package. Something like this:


f <- system.file("external/test.grd", package="raster")

d <- seq(as.Date("2010-01-01"),as.Date("2014-08-01"),by="month")

rr <- stack(rep(f,length(d)))
names(rr) <- d

rr <- setZ(rr, d, name = 'Month')

rr.mean <- zApply(rrr, by = months, fun = mean, name = "Month")

levelplot(rr.mean, margin = FALSE, layer = unique(months(d)), layout = c(3,4))

Yours sincerely / Med venlig hilsen


Frede Aakmann T?gersen
Specialist, M.Sc., Ph.D.
Plant Performance & Modeling

Technology & Service Solutions
T +45 9730 5135
M +45 2547 6050
frtog at vestas.com<mailto:frtog at vestas.com>
http://www.vestas.com<http://www.vestas.com/>

Company reg. name: Vestas Wind Systems A/S
This e-mail is subject to our e-mail disclaimer statement.
Please refer to www.vestas.com/legal/notice<http://www.vestas.com/legal/notice>
If you have received this e-mail in error please contact the sender.

From: Navinder Singh [mailto:Navinder.Singh at slu.se]
Sent: 21. oktober 2014 12:45
To: r-sig-geo at r-project.org<mailto:r-sig-geo at r-project.org>
Cc: oscar.perpinan at upm.es<mailto:oscar.perpinan at upm.es>; Frede Aakmann T?gersen
Subject: [R-sig-Geo] Order raster images in a levelplot


Dear Both,
Thank you for your responses.
Oscar- I am still trying to get the indexing going. Hope it will be sorted out soon.
Just to provide some more background on my code- here is an example.

library(raster)
library(rasterVis)
library(raster)
library(rgdal)
library(zoo)

setwd("/Users/nasi/Google Drive/5KMNDVI_Monthly")

modis = stack(list.files(pattern='NDVI.tif'))
modis
names(modis)
d<-seq(as.Date("2010-01-01"),as.Date("2014-08-01"),by="month")
names(modis)<-d
NDVImod<-setZ(modis,d)
e<-extent(-17.96, 43.135, -30.055, 67.08)
NDVImodis<-crop(NDVImod,e)
NDVImodis[NDVImodis<0]<-0
NDVImodis<-setZ(NDVImodis,d)
names(NDVImodis)<-d

# The first problem occurs below. I am trying to get monthly means and other quantities. Although the function does give me an output, but the results are completely wrong. As it seems to be averaging the wrong months together. Can't really paste the image here i suppose.

year.mon.max<-zApply(NDVImodis, by=months, fun=max, name="months")
year.mon.min<-zApply(NDVImodis, by=months, fun=min, name="months")
year.mon.diff<-year.mon.max-year.mon.min
year.mon.sd<-zApply(NDVImodis, by=months, fun=sd, name="months")
year.mon.cv<-zApply(NDVImodis, by=months, fun=cv, name="months")

# I only manage to rearrange this one using the code after these lines. But since the images are wrong, its not of much use. Perhaps my use of 'by' argument above is not correct. Or my naming of the rasters isn't either.

print(levelplot(year.mon.mean[[c(6,2,12,11,10,3,5,4,8,1,9,7)]], main="Mean Monthly NDVI (2010-2014)", par.settings=myTheme))

# perhaps here is where i need to use the par.cond
# I tried using 'index.cond' here like below:

levelplot(year.mon.mean, index.cond=list(c("January","February","March", "April", "May", "June","July", "August", "Septmeber", "Ocotber","November", "December")),par.settings=myTheme)

#But this doesn't plot anything. Even the maps disappear. Perhaps this again has to do with the naming in the rasters.

#Anyhow, i would like to match these monthly images with data on spatial observations of animals where i have an x,y and a date matching the date of the raster.

#I tried doing this below -
df$layer<-lapply(df$month, function(x) which(grepl(tolower(x), tolower(names(year.mon.mean)))))
df$meanNDVI<-sapply(seq_len(nrow(df)), function(x) extract(mean.year.mon[[df$layer[x]]], df[x,1:2])) # 1,2 are columns with x and y.

#This also doesn't work, perhaps also has to do with the names in the raster.

Your help is much appreciated.
Ill keep trying the par.cond argument in the meanwhile.

Best wishes,

Navinder
















Navinder J Singh
Associate Professor
Department of Wildlife, Fish, and Environmental Studies
Faculty of Forest Sciences
Swedish University of Agricultural Sciences
SE-901 83 Umea, Sweden
O: +46 (0)90 786 8538;
M: +46 (0)70 676 0103
email: navinder.singh at slu.se<mailto:navinder.singh at slu.se>
Web: navinderjsingh.weebly.com<http://navinderjsingh.weebly.com/>

www.slu.se/viltfiskmiljo/navinder_singh<http://www.slu.se/viltfiskmiljo/navinder_singh>
http://slu-se.academia.edu/NSingh



On 21 Oct 2014, at 08:53, Frede Aakmann T?gersen <frtog at vestas.com<mailto:frtog at vestas.com>> wrote:

Hi

Since no code example was provided we'll have to guess. I suppose it has to do with the way factor() works.

Here is the built-in list of month names in R:




month.name
[1] "January"   "February"  "March"     "April"     "May"       "June"
[7] "July"      "August"    "September" "October"   "November"  "December"

Now show this as a factor:




factor(month.name)
[1] January   February  March     April     May       June      July
[8] August    September October   November  December
12 Levels: April August December February January July June March ... September

See how factor() is using lexicographical order for the labels of the factor levels.

Now do this  instead:




factor(month.name, labels = month.name)
[1] May       April     August    January   September July      June
[8] February  December  November  October   March
12 Levels: January February March April May June July August ... December

Now the order of the labels of the levels is the same as that of month.name.

Here is an example:

testdata <- data.frame(x = 1, y = 1, Month = factor(month.name))

### order of panels is that of order(month.name)
xyplot(y ~ x|Month, data = testdata)

testdata <- data.frame(x = 1, y = 1, Month = factor(month.name, labels = month.name))

### order of panels is that of month.name
### January in bottom left and Deccember in top right panel
xyplot(y ~ x|Month, data = testdata)

### use the as.table argument to get January in top left and December in bottom right
xyplot(y ~ x|Month, data = testdata, as.table = TRUE)


Yours sincerely / Med venlig hilsen


Frede Aakmann T?gersen
Specialist, M.Sc., Ph.D.
Plant Performance & Modeling

Technology & Service Solutions
T +45 9730 5135
M +45 2547 6050
frtog at vestas.com<mailto:frtog at vestas.com>
http://www.vestas.com<http://www.vestas.com/>

Company reg. name: Vestas Wind Systems A/S
This e-mail is subject to our e-mail disclaimer statement.
Please refer to www.vestas.com/legal/notice<http://www.vestas.com/legal/notice>
If you have received this e-mail in error please contact the sender.





-----Original Message-----
From: r-sig-geo-bounces at r-project.org<mailto:r-sig-geo-bounces at r-project.org> [mailto:r-sig-geo-bounces at r-
project.org<mailto:r-sig-geo-bounces at r-%0bproject.org>] On Behalf Of Oscar Perpi??n Lamigueiro
Sent: 21. oktober 2014 07:50
To: Navinder Singh
Cc: r-sig-geo at r-project.org<mailto:r-sig-geo at r-project.org>
Subject: Re: [R-sig-Geo] Order raster images in a levelplot

Hi,




1. Does someone have any suggestions on how i can order the sequence
of images in a "levelplot" made using rasterVis.  Specifically, i
have months i need to arrange in the normal sequence, as the plot
currently aligns them in an alphabetical order. Does "levelplot"
works the same way as xyplots in lattice?

levelplot methods defined in rasterVis are based on lattice graphics.
Most of the arguments provided by lattice::xyplot and
lattice::levelplot are also available. For this issue you could try
these arguments: perm.cond, index.cond, as.table. All of them are
described in the help page of lattice::xyplot.




2. Have there been more developments on the zApply function in the
raster package? I am trying to make basic statistical summaries for
mean monthly (eg. NDVI values) form a multi annual time series.  How
does one go about using the "by" Indexing in this case.

Could you post a reproducible example? I have used zApply for similar
tasks without problems.

Best,

Oscar.

--
Oscar Perpi??n Lamigueiro
Dpto. Ingenier?a El?ctrica (ETSIDI-UPM)
Grupo de Sistemas Fotovoltaicos (IES-UPM)
URL: http://oscarperpinan.github.io<http://oscarperpinan.github.io/>

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org<mailto:R-sig-Geo at r-project.org>
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


	[[alternative HTML version deleted]]


From jh.eco.cas at gmail.com  Tue Oct 21 21:47:47 2014
From: jh.eco.cas at gmail.com (Jianhua Huang)
Date: Tue, 21 Oct 2014 12:47:47 -0700
Subject: [R-sig-Geo] weird ncdf4 output 9.969210e+36
In-Reply-To: <CAAcyNCzNhOBP7LAPH0+yGGxD2GPV=zrEcBppKW-N-vKu91zpKA@mail.gmail.com>
References: <00e501cfecf9$d7842fd0$868c8f70$@gmail.com>
	<CAAcyNCzNhOBP7LAPH0+yGGxD2GPV=zrEcBppKW-N-vKu91zpKA@mail.gmail.com>
Message-ID: <027e01cfed67$e5270db0$af752910$@gmail.com>

Thanks so much, Pascal. It solve the problem by adding the argument  missval = NA to the ncvar_def function when writing the nc file. 

-----Original Message-----
From: skalp.oettli at gmail.com [mailto:skalp.oettli at gmail.com] On Behalf Of Pascal Oettli
Sent: Monday, October 20, 2014 11:46 PM
To: Jianhua Huang
Cc: r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] weird ncdf4 output 9.969210e+36

Hi,

This is the number for missing value in most of NetCDF files.
http://www.unidata.ucar.edu/software/netcdf/docs/BestPractices.html#Missing%20Data%20Values

This means you missed to provide/utilize the missing value attribute when you read your file.

Regards,
Pascal

On Tue, Oct 21, 2014 at 3:40 PM, Jianhua Huang <jh.eco.cas at gmail.com> wrote:
> Hi All:
>
>
>
> I am trying to create a 3 dimensional (200*200*8760) netCdf file using 
> the
> ncdf4 package. Everything goes fine, except some unexpected outputs. 
> Here is tail of the result in one grid cell. I cbind the original 
> values and the output read from the nc file.
>
>
>
>         Original   ncdf4
>
> [8755,] 70.47247 7.047247e+01
>
> [8756,] 47.10336 4.710336e+01
>
> [8757,] 38.70509 3.870509e+01
>
> [8758,] 32.86281 3.286281e+01
>
> [8759,] 21.90854 9.969210e+36
>
> [8760,] 10.95427 9.969210e+36
>
>
>
> Most ncdf4 data matches with the original data, except the last two values.
> There are extremely large values: 9.969210e+36
>
>
>
> I have no idea where these huge values come from, and can't figure out 
> where is wrong at all.
>
> Any one met the same problem before? Thanks for any suggestion, and I 
> really appreciate any help.
>
>
>
> Thanks
>
>
>
> Jianhua
>
>
>
>
>
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



--
Pascal Oettli
Project Scientist
JAMSTEC
Yokohama, Japan


From Navinder.Singh at slu.se  Tue Oct 21 15:45:08 2014
From: Navinder.Singh at slu.se (Navinder Singh)
Date: Tue, 21 Oct 2014 13:45:08 +0000
Subject: [R-sig-Geo] Order raster images in a levelplot
In-Reply-To: <B078CDF40DFE4045AF172A8B4F68FC4857C965FE61@DKRDSEXC016.vestas.net>
References: <2DEBFCEA-DA32-4593-88C8-FD2DA59012B0@slu.se>
	<87ppdmhsrb.fsf@upm.es>
	<B078CDF40DFE4045AF172A8B4F68FC4857C965FB06@DKRDSEXC016.vestas.net>
	<804C9698-7BCF-4C91-87DC-D3BFEC671EEB@slu.se>
	<3055E4D2865EED429B17F80FF667E35723BEA04F@exchange2-2>
	<B078CDF40DFE4045AF172A8B4F68FC4857C965FD3D@DKRDSEXC016.vestas.net>
	<F0148F09-B265-480D-918D-EC07468A3A61@slu.se>
	<B078CDF40DFE4045AF172A8B4F68FC4857C965FD6F@DKRDSEXC016.vestas.net>
	<158CF4D8-815C-4C8B-9EED-BDAE74706833@slu.se>
	<B078CDF40DFE4045AF172A8B4F68FC4857C965FE61@DKRDSEXC016.vestas.net>
Message-ID: <FBCCC8C5-D1E9-439D-B440-EC7E402E5A36@slu.se>

Here?s what the stack looks like:
setwd("C:\\Users\\nasi\\Google<smb://Users//nasi//Google> Drive\\5KMNDVI_Monthly")
modis = stack(list.files(pattern='NDVI.tif'))

> names(modis)
 [1] "MOD13C2.A2010001.CMG_0.05_Deg_Monthly_NDVI"
 [2] "MOD13C2.A2010032.CMG_0.05_Deg_Monthly_NDVI"
 [3] "MOD13C2.A2010060.CMG_0.05_Deg_Monthly_NDVI"
 [4] "MOD13C2.A2010091.CMG_0.05_Deg_Monthly_NDVI"
 [5] "MOD13C2.A2010121.CMG_0.05_Deg_Monthly_NDVI"
 [6] "MOD13C2.A2010152.CMG_0.05_Deg_Monthly_NDVI"
 [7] "MOD13C2.A2010182.CMG_0.05_Deg_Monthly_NDVI"
 [8] "MOD13C2.A2010213.CMG_0.05_Deg_Monthly_NDVI"
 [9] "MOD13C2.A2010244.CMG_0.05_Deg_Monthly_NDVI"
[10] "MOD13C2.A2010274.CMG_0.05_Deg_Monthly_NDVI"
[11] "MOD13C2.A2010305.CMG_0.05_Deg_Monthly_NDVI"
[12] "MOD13C2.A2010335.CMG_0.05_Deg_Monthly_NDVI"
[13] "MOD13C2.A2011001.CMG_0.05_Deg_Monthly_NDVI"
[14] "MOD13C2.A2011032.CMG_0.05_Deg_Monthly_NDVI"
[15] "MOD13C2.A2011060.CMG_0.05_Deg_Monthly_NDVI"
[16] "MOD13C2.A2011091.CMG_0.05_Deg_Monthly_NDVI"
[17] "MOD13C2.A2011121.CMG_0.05_Deg_Monthly_NDVI"
[18] "MOD13C2.A2011152.CMG_0.05_Deg_Monthly_NDVI"
[19] "MOD13C2.A2011182.CMG_0.05_Deg_Monthly_NDVI"
[20] "MOD13C2.A2011213.CMG_0.05_Deg_Monthly_NDVI"
[21] "MOD13C2.A2011244.CMG_0.05_Deg_Monthly_NDVI"
[22] "MOD13C2.A2011274.CMG_0.05_Deg_Monthly_NDVI"
[23] "MOD13C2.A2011305.CMG_0.05_Deg_Monthly_NDVI"
[24] "MOD13C2.A2011335.CMG_0.05_Deg_Monthly_NDVI"
[25] "MOD13C2.A2012001.CMG_0.05_Deg_Monthly_NDVI"
[26] "MOD13C2.A2012032.CMG_0.05_Deg_Monthly_NDVI"
[27] "MOD13C2.A2012061.CMG_0.05_Deg_Monthly_NDVI"
[28] "MOD13C2.A2012092.CMG_0.05_Deg_Monthly_NDVI"
[29] "MOD13C2.A2012122.CMG_0.05_Deg_Monthly_NDVI"
[30] "MOD13C2.A2012153.CMG_0.05_Deg_Monthly_NDVI"
[31] "MOD13C2.A2012183.CMG_0.05_Deg_Monthly_NDVI"
[32] "MOD13C2.A2012214.CMG_0.05_Deg_Monthly_NDVI"
[33] "MOD13C2.A2012245.CMG_0.05_Deg_Monthly_NDVI"
[34] "MOD13C2.A2012275.CMG_0.05_Deg_Monthly_NDVI"
[35] "MOD13C2.A2012306.CMG_0.05_Deg_Monthly_NDVI"
[36] "MOD13C2.A2012336.CMG_0.05_Deg_Monthly_NDVI"
[37] "MOD13C2.A2013001.CMG_0.05_Deg_Monthly_NDVI"
[38] "MOD13C2.A2013032.CMG_0.05_Deg_Monthly_NDVI"
[39] "MOD13C2.A2013060.CMG_0.05_Deg_Monthly_NDVI"
[40] "MOD13C2.A2013091.CMG_0.05_Deg_Monthly_NDVI"
[41] "MOD13C2.A2013121.CMG_0.05_Deg_Monthly_NDVI"
[42] "MOD13C2.A2013152.CMG_0.05_Deg_Monthly_NDVI"
[43] "MOD13C2.A2013182.CMG_0.05_Deg_Monthly_NDVI"
[44] "MOD13C2.A2013213.CMG_0.05_Deg_Monthly_NDVI"
[45] "MOD13C2.A2013244.CMG_0.05_Deg_Monthly_NDVI"
[46] "MOD13C2.A2013274.CMG_0.05_Deg_Monthly_NDVI"
[47] "MOD13C2.A2013305.CMG_0.05_Deg_Monthly_NDVI"
[48] "MOD13C2.A2013335.CMG_0.05_Deg_Monthly_NDVI"
[49] "MOD13C2.A2014001.CMG_0.05_Deg_Monthly_NDVI"
[50] "MOD13C2.A2014032.CMG_0.05_Deg_Monthly_NDVI"
[51] "MOD13C2.A2014060.CMG_0.05_Deg_Monthly_NDVI"
[52] "MOD13C2.A2014091.CMG_0.05_Deg_Monthly_NDVI"
[53] "MOD13C2.A2014121.CMG_0.05_Deg_Monthly_NDVI"
[54] "MOD13C2.A2014152.CMG_0.05_Deg_Monthly_NDVI"
[55] "MOD13C2.A2014182.CMG_0.05_Deg_Monthly_NDVI"
[56] "MOD13C2.A2014213.CMG_0.05_Deg_Monthly_NDVI"

d<-seq(as.Date("2010-01-01"),as.Date("2014-08-01"),by="month")
d


Navinder J Singh
Associate Professor
Department of Wildlife, Fish, and Environmental Studies
Faculty of Forest Sciences
Swedish University of Agricultural Sciences
SE-901 83 Umea, Sweden
O: +46 (0)90 786 8538;
M: +46 (0)70 676 0103
email: navinder.singh at slu.se<mailto:navinder.singh at slu.se>
Web: navinderjsingh.weebly.com<http://navinderjsingh.weebly.com/>

www.slu.se/viltfiskmiljo/navinder_singh<http://www.slu.se/viltfiskmiljo/navinder_singh>
http://slu-se.academia.edu/NSingh




On 21 Oct 2014, at 15:27, Frede Aakmann T?gersen <frtog at vestas.com<mailto:frtog at vestas.com>> wrote:

Hi

Could it be that you are stacking the tif files in a wrong order. So that it does not correspond to your ?d? vector? Please show us the result from list.files(pattern='NDVI.tif').
I suppose that the file names will tell us something about the date for each particular file. We need to compare that to you ?d? vector.


Yours sincerely / Med venlig hilsen


Frede Aakmann T?gersen
Specialist, M.Sc., Ph.D.
Plant Performance & Modeling

Technology & Service Solutions
T +45 9730 5135
M +45 2547 6050
frtog at vestas.com<mailto:frtog at vestas.com>
http://www.vestas.com<http://www.vestas.com/>

Company reg. name: Vestas Wind Systems A/S
This e-mail is subject to our e-mail disclaimer statement.
Please refer to www.vestas.com/legal/notice<http://www.vestas.com/legal/notice>
If you have received this e-mail in error please contact the sender.

From: Navinder Singh [mailto:Navinder.Singh at slu.se]
Sent: 21. oktober 2014 14:30
To: Frede Aakmann T?gersen; Oscar Perpi??n Lamigueiro
Cc: r-sig-geo at r-project.org<mailto:r-sig-geo at r-project.org>
Subject: Re: [R-sig-Geo] Order raster images in a levelplot

Dear Frede,
The problem still persists. It does make a plot, but then summarises using the wrong layers.

setwd("/Users/nasi/Google Drive/5KMNDVI_Monthly")
modis = stack(list.files(pattern='NDVI.tif'))
modis
names(modis)
d<-seq(as.Date("2010-01-01"),as.Date("2014-08-01"),by="month?)
d
 [1] "2010-01-01" "2010-02-01" "2010-03-01" "2010-04-01" "2010-05-01" "2010-06-01"
 [7] "2010-07-01" "2010-08-01" "2010-09-01" "2010-10-01" "2010-11-01" "2010-12-01"
[13] "2011-01-01" "2011-02-01" "2011-03-01" "2011-04-01" "2011-05-01" "2011-06-01"
[19] "2011-07-01" "2011-08-01" "2011-09-01" "2011-10-01" "2011-11-01" "2011-12-01"
[25] "2012-01-01" "2012-02-01" "2012-03-01" "2012-04-01" "2012-05-01" "2012-06-01"
[31] "2012-07-01" "2012-08-01" "2012-09-01" "2012-10-01" "2012-11-01" "2012-12-01"
[37] "2013-01-01" "2013-02-01" "2013-03-01" "2013-04-01" "2013-05-01" "2013-06-01"
[43] "2013-07-01" "2013-08-01" "2013-09-01" "2013-10-01" "2013-11-01" "2013-12-01"
[49] "2014-01-01" "2014-02-01" "2014-03-01" "2014-04-01" "2014-05-01" "2014-06-01"
[55] "2014-07-01" "2014-08-01?

names(modis)<-d
NDVImod<-setZ(modis,d, name="months")

names(NDVImod)
 [1] "X2010.01.01" "X2010.02.01" "X2010.03.01" "X2010.04.01" "X2010.05.01" "X2010.06.01"
 [7] "X2010.07.01" "X2010.08.01" "X2010.09.01" "X2010.10.01" "X2010.11.01" "X2010.12.01"
[13] "X2011.01.01" "X2011.02.01" "X2011.03.01" "X2011.04.01" "X2011.05.01" "X2011.06.01"
[19] "X2011.07.01" "X2011.08.01" "X2011.09.01" "X2011.10.01" "X2011.11.01" "X2011.12.01"
[25] "X2012.01.01" "X2012.02.01" "X2012.03.01" "X2012.04.01" "X2012.05.01" "X2012.06.01"
[31] "X2012.07.01" "X2012.08.01" "X2012.09.01" "X2012.10.01" "X2012.11.01" "X2012.12.01"
[37] "X2013.01.01" "X2013.02.01" "X2013.03.01" "X2013.04.01" "X2013.05.01" "X2013.06.01"
[43] "X2013.07.01" "X2013.08.01" "X2013.09.01" "X2013.10.01" "X2013.11.01" "X2013.12.01"
[49] "X2014.01.01" "X2014.02.01" "X2014.03.01" "X2014.04.01" "X2014.05.01" "X2014.06.01"
[55] "X2014.07.01" ?X2014.08.01?

e<-extent(-17.96, 43.135, -30.055, 67.08)

NDVImodis<-crop(NDVImod,e) # cropping the layer to extent

NDVImodis[NDVImodis<0]<-0 # setting values below 0 as 0.

NDVImodis<-setZ(NDVImodis,d,name="months")

year.mon.mean<-zApply(NDVImodis, by=months, fun=mean, name="months")

levelplot(year.mon.mean, main="meanNDVI 2010-2014)", par.settings=myTheme)


everything seems to be going all right with the code, but i am not sure where things are going wrong- in picking out the right months to merge together.

If i were to do it manually- it works very well-

mean.jan<-mean(NDVImodis[[c(1,11,24,36,48)]])
#plot(mean.jan)
mean.feb<-mean(NDVImodis[[c(2,13,25,37,49)]])
mean.mar<-mean(NDVImodis[[c(3,14,26,38,50)]])
mean.apr<-mean(NDVImodis[[c(4,15,27,39,51)]])
mean.may<-mean(NDVImodis[[c(5,16,28,40,52)]])
mean.jun<-mean(NDVImodis[[c(17,29,41,53)]])
mean.jul<-mean(NDVImodis[[c(6,18,30,42,54)]])
mean.aug<-mean(NDVImodis[[c(7,19,31,43,55)]])
mean.sep<-mean(NDVImodis[[c(8,20,32,44)]])
mean.oct<-mean(NDVImodis[[c(9,21,33,45)]])
mean.nov<-mean(NDVImodis[[c(10,22,34,46)]])
mean.dec<-mean(NDVImodis[[c(11,23,35,47)]])

# Means
mean.year.mon<-stack(mean.jan,mean.feb,mean.mar,mean.apr,mean.may,mean.jun,
mean.jul,mean.aug,mean.sep,mean.oct,mean.nov,mean.dec)
levelplot(mean.year.mon, par.settings=myTheme)





Navinder


On 21 Oct 2014, at 13:30, Frede Aakmann T?gersen <frtog at vestas.com<mailto:frtog at vestas.com>> wrote:


Please remember to post to the list as well since this was there this thread startet.

Dows it have something to do with you not setting the name argument of setZ()?

You are doing:

NDVImodis<-setZ(NDVImodis,d)
names(NDVImodis)<-d

Perhaps you should do:

NDVImodis<-setZ(NDVImodis,d, name = ?Months?)

And then e.g.

zApply(NDVImodis, by=months, fun=mean, name="Months")

?????

Yours sincerely / Med venlig hilsen


Frede Aakmann T?gersen
Specialist, M.Sc., Ph.D.
Plant Performance & Modeling

Technology & Service Solutions
T +45 9730 5135
M +45 2547 6050
frtog at vestas.com<mailto:frtog at vestas.com>
http://www.vestas.com<http://www.vestas.com/>

Company reg. name: Vestas Wind Systems A/S
This e-mail is subject to our e-mail disclaimer statement.
Please refer to www.vestas.com/legal/notice<http://www.vestas.com/legal/notice>
If you have received this e-mail in error please contact the sender.

From: Navinder Singh [mailto:Navinder.Singh at slu.se]
Sent: 21. oktober 2014 13:22
To: Frede Aakmann T?gersen
Subject: Re: [R-sig-Geo] Order raster images in a levelplot

Thanks Frede, it worked perfectly.
However, i have problems using the 'by=months', since it is not estimating the monthly means as i want.
i want the monthly means across years.i.e means of january, feb and so on. And ?by=months? is dining some averaging but it is averaging the wrong months. Perhaps it has o do something with my naming? Below is what i did.
I couldn?t send you the entire dataset, as they are global images with each 14MB size and they run monthly for 5 years.
I also posted a message on R-sig.
Thanks for your help.
Best wishes,
Navinder

setwd("/Users/nasi/Google Drive/5KMNDVI_Monthly")

modis = stack(list.files(pattern='NDVI.tif'))
modis
names(modis)
d<-seq(as.Date("2010-01-01"),as.Date("2014-08-01"),by="month")
names(modis)<-d
NDVImod<-setZ(modis,d)
e<-extent(-17.96, 43.135, -30.055, 67.08)
NDVImodis<-crop(NDVImod,e)
NDVImodis[NDVImodis<0]<-0
NDVImodis<-setZ(NDVImodis,d)
names(NDVImodis)<-d

# The first problem occurs below. I am trying to get monthly means and other quantities. Although the function does give me an output, but the results are completely wrong. As it seems to be averaging the wrong months together. Can?t really paste the image here i suppose.

year.mon.max<-zApply(NDVImodis, by=months, fun=max, name="months")
year.mon.min<-zApply(NDVImodis, by=months, fun=min, name="months")
year.mon.diff<-year.mon.max-year.mon.min
year.mon.sd<-zApply(NDVImodis, by=months, fun=sd, name="months")
year.mon.cv<-zApply(NDVImodis, by=months, fun=cv, name="months?)

# I only manage to rearrange this one using the code after these lines. But since the images are wrong, its not of much use. Perhaps my use of ?by? argument above is not correct. Or my naming of the rasters isn?t either.

print(levelplot(year.mon.mean[[c(6,2,12,11,10,3,5,4,8,1,9,7)]], main="Mean Monthly NDVI (2010-2014)", par.settings=myTheme))

# perhaps here is where i need to use the par.cond
# I tried using ?index.cond? here like below:

levelplot(year.mon.mean, index.cond=list(c("January","February","March", "April", "May", "June","July", "August", "Septmeber", "Ocotber","November","December")), par.settings=myTheme)

#But this doesn?t plot anything. Even the maps disappear. Perhaps this again has to do with the naming in the rasters.

#Anyhow, i would like to match these monthly images with data on spatial observations of animals where i have an x,y and a date matching the date of the raster.

#I tried doing this below -
df$layer<-lapply(df$month, function(x) which(grepl(tolower(x), tolower(names(year.mon.mean)))))
df$meanNDVI<-sapply(seq_len(nrow(df)), function(x) extract(mean.year.mon[[df$layer[x]]], df[x,1:2])) # 1,2 are columns with x and y.

#This also doesn?t work, perhaps also has to do with the names in the raster.

Your help is much appreciated.
Ill keep trying the par.cond argument in the meanwhile.

Best wishes,

Navinder




Navinder J Singh
Associate Professor
Department of Wildlife, Fish, and Environmental Studies
Faculty of Forest Sciences
Swedish University of Agricultural Sciences
SE-901 83 Umea, Sweden
O: +46 (0)90 786 8538;
M: +46 (0)70 676 0103
email: navinder.singh at slu.se<mailto:navinder.singh at slu.se>
Web: navinderjsingh.weebly.com<http://navinderjsingh.weebly.com/>

www.slu.se/viltfiskmiljo/navinder_singh<http://www.slu.se/viltfiskmiljo/navinder_singh>
http://slu-se.academia.edu/NSingh



On 21 Oct 2014, at 13:10, Frede Aakmann T?gersen <frtog at vestas.com<mailto:frtog at vestas.com>> wrote:



Hi

Since I don?t have your data I cannot say anything about your use of zApply. For the levelplot() problem I think you can use the layer arguments to levelplot() from rasterVis package. Something like this:


f <- system.file("external/test.grd", package="raster")

d <- seq(as.Date("2010-01-01"),as.Date("2014-08-01"),by="month")

rr <- stack(rep(f,length(d)))
names(rr) <- d

rr <- setZ(rr, d, name = 'Month')

rr.mean <- zApply(rrr, by = months, fun = mean, name = "Month")

levelplot(rr.mean, margin = FALSE, layer = unique(months(d)), layout = c(3,4))

Yours sincerely / Med venlig hilsen


Frede Aakmann T?gersen
Specialist, M.Sc., Ph.D.
Plant Performance & Modeling

Technology & Service Solutions
T +45 9730 5135
M +45 2547 6050
frtog at vestas.com<mailto:frtog at vestas.com>
http://www.vestas.com<http://www.vestas.com/>

Company reg. name: Vestas Wind Systems A/S
This e-mail is subject to our e-mail disclaimer statement.
Please refer to www.vestas.com/legal/notice<http://www.vestas.com/legal/notice>
If you have received this e-mail in error please contact the sender.

From: Navinder Singh [mailto:Navinder.Singh at slu.se]
Sent: 21. oktober 2014 12:45
To: r-sig-geo at r-project.org<mailto:r-sig-geo at r-project.org>
Cc: oscar.perpinan at upm.es<mailto:oscar.perpinan at upm.es>; Frede Aakmann T?gersen
Subject: [R-sig-Geo] Order raster images in a levelplot


Dear Both,
Thank you for your responses.
Oscar- I am still trying to get the indexing going. Hope it will be sorted out soon.
Just to provide some more background on my code- here is an example.

library(raster)
library(rasterVis)
library(raster)
library(rgdal)
library(zoo)

setwd("/Users/nasi/Google Drive/5KMNDVI_Monthly")

modis = stack(list.files(pattern='NDVI.tif'))
modis
names(modis)
d<-seq(as.Date("2010-01-01"),as.Date("2014-08-01"),by="month")
names(modis)<-d
NDVImod<-setZ(modis,d)
e<-extent(-17.96, 43.135, -30.055, 67.08)
NDVImodis<-crop(NDVImod,e)
NDVImodis[NDVImodis<0]<-0
NDVImodis<-setZ(NDVImodis,d)
names(NDVImodis)<-d

# The first problem occurs below. I am trying to get monthly means and other quantities. Although the function does give me an output, but the results are completely wrong. As it seems to be averaging the wrong months together. Can?t really paste the image here i suppose.

year.mon.max<-zApply(NDVImodis, by=months, fun=max, name="months")
year.mon.min<-zApply(NDVImodis, by=months, fun=min, name="months")
year.mon.diff<-year.mon.max-year.mon.min
year.mon.sd<-zApply(NDVImodis, by=months, fun=sd, name="months")
year.mon.cv<-zApply(NDVImodis, by=months, fun=cv, name="months?)

# I only manage to rearrange this one using the code after these lines. But since the images are wrong, its not of much use. Perhaps my use of ?by? argument above is not correct. Or my naming of the rasters isn?t either.

print(levelplot(year.mon.mean[[c(6,2,12,11,10,3,5,4,8,1,9,7)]], main="Mean Monthly NDVI (2010-2014)", par.settings=myTheme))

# perhaps here is where i need to use the par.cond
# I tried using ?index.cond? here like below:

levelplot(year.mon.mean, index.cond=list(c("January","February","March", "April", "May", "June","July", "August", "Septmeber", "Ocotber","November", "December")),par.settings=myTheme)

#But this doesn?t plot anything. Even the maps disappear. Perhaps this again has to do with the naming in the rasters.

#Anyhow, i would like to match these monthly images with data on spatial observations of animals where i have an x,y and a date matching the date of the raster.

#I tried doing this below -
df$layer<-lapply(df$month, function(x) which(grepl(tolower(x), tolower(names(year.mon.mean)))))
df$meanNDVI<-sapply(seq_len(nrow(df)), function(x) extract(mean.year.mon[[df$layer[x]]], df[x,1:2])) # 1,2 are columns with x and y.

#This also doesn?t work, perhaps also has to do with the names in the raster.

Your help is much appreciated.
Ill keep trying the par.cond argument in the meanwhile.

Best wishes,

Navinder
















Navinder J Singh
Associate Professor
Department of Wildlife, Fish, and Environmental Studies
Faculty of Forest Sciences
Swedish University of Agricultural Sciences
SE-901 83 Umea, Sweden
O: +46 (0)90 786 8538;
M: +46 (0)70 676 0103
email: navinder.singh at slu.se<mailto:navinder.singh at slu.se>
Web: navinderjsingh.weebly.com<http://navinderjsingh.weebly.com/>

www.slu.se/viltfiskmiljo/navinder_singh<http://www.slu.se/viltfiskmiljo/navinder_singh>
http://slu-se.academia.edu/NSingh



On 21 Oct 2014, at 08:53, Frede Aakmann T?gersen <frtog at vestas.com<mailto:frtog at vestas.com>> wrote:

Hi

Since no code example was provided we'll have to guess. I suppose it has to do with the way factor() works.

Here is the built-in list of month names in R:



month.name
[1] "January"   "February"  "March"     "April"     "May"       "June"
[7] "July"      "August"    "September" "October"   "November"  "December"

Now show this as a factor:



factor(month.name)
[1] January   February  March     April     May       June      July
[8] August    September October   November  December
12 Levels: April August December February January July June March ... September

See how factor() is using lexicographical order for the labels of the factor levels.

Now do this  instead:



factor(month.name, labels = month.name)
[1] May       April     August    January   September July      June
[8] February  December  November  October   March
12 Levels: January February March April May June July August ... December

Now the order of the labels of the levels is the same as that of month.name.

Here is an example:

testdata <- data.frame(x = 1, y = 1, Month = factor(month.name))

### order of panels is that of order(month.name)
xyplot(y ~ x|Month, data = testdata)

testdata <- data.frame(x = 1, y = 1, Month = factor(month.name, labels = month.name))

### order of panels is that of month.name
### January in bottom left and Deccember in top right panel
xyplot(y ~ x|Month, data = testdata)

### use the as.table argument to get January in top left and December in bottom right
xyplot(y ~ x|Month, data = testdata, as.table = TRUE)


Yours sincerely / Med venlig hilsen


Frede Aakmann T?gersen
Specialist, M.Sc., Ph.D.
Plant Performance & Modeling

Technology & Service Solutions
T +45 9730 5135
M +45 2547 6050
frtog at vestas.com<mailto:frtog at vestas.com>
http://www.vestas.com<http://www.vestas.com/>

Company reg. name: Vestas Wind Systems A/S
This e-mail is subject to our e-mail disclaimer statement.
Please refer to www.vestas.com/legal/notice<http://www.vestas.com/legal/notice>
If you have received this e-mail in error please contact the sender.




-----Original Message-----
From: r-sig-geo-bounces at r-project.org<mailto:r-sig-geo-bounces at r-project.org> [mailto:r-sig-geo-bounces at r-
project.org<mailto:r-sig-geo-bounces at r-%0bproject.org>] On Behalf Of Oscar Perpi??n Lamigueiro
Sent: 21. oktober 2014 07:50
To: Navinder Singh
Cc: r-sig-geo at r-project.org<mailto:r-sig-geo at r-project.org>
Subject: Re: [R-sig-Geo] Order raster images in a levelplot

Hi,



1. Does someone have any suggestions on how i can order the sequence
of images in a ?levelplot" made using rasterVis.  Specifically, i
have months i need to arrange in the normal sequence, as the plot
currently aligns them in an alphabetical order. Does ?levelplot?
works the same way as xyplots in lattice?

levelplot methods defined in rasterVis are based on lattice graphics.
Most of the arguments provided by lattice::xyplot and
lattice::levelplot are also available. For this issue you could try
these arguments: perm.cond, index.cond, as.table. All of them are
described in the help page of lattice::xyplot.



2. Have there been more developments on the zApply function in the
raster package? I am trying to make basic statistical summaries for
mean monthly (eg. NDVI values) form a multi annual time series.  How
does one go about using the ?by" Indexing in this case.

Could you post a reproducible example? I have used zApply for similar
tasks without problems.

Best,

Oscar.

--
Oscar Perpi??n Lamigueiro
Dpto. Ingenier?a El?ctrica (ETSIDI-UPM)
Grupo de Sistemas Fotovoltaicos (IES-UPM)
URL: http://oscarperpinan.github.io<http://oscarperpinan.github.io/>

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org<mailto:R-sig-Geo at r-project.org>
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


	[[alternative HTML version deleted]]


From oscar.perpinan at upm.es  Wed Oct 22 12:07:34 2014
From: oscar.perpinan at upm.es (Oscar =?utf-8?B?UGVycGnDscOhbg==?= Lamigueiro)
Date: Wed, 22 Oct 2014 12:07:34 +0200
Subject: [R-sig-Geo] Order raster images in a levelplot
In-Reply-To: <B078CDF40DFE4045AF172A8B4F68FC4857C965FF2D@DKRDSEXC016.vestas.net>
References: <2DEBFCEA-DA32-4593-88C8-FD2DA59012B0@slu.se>
	<87ppdmhsrb.fsf@upm.es>
	<B078CDF40DFE4045AF172A8B4F68FC4857C965FB06@DKRDSEXC016.vestas.net>
	<804C9698-7BCF-4C91-87DC-D3BFEC671EEB@slu.se>
	<3055E4D2865EED429B17F80FF667E35723BEA04F@exchange2-2>
	<B078CDF40DFE4045AF172A8B4F68FC4857C965FD3D@DKRDSEXC016.vestas.net>
	<F0148F09-B265-480D-918D-EC07468A3A61@slu.se>
	<B078CDF40DFE4045AF172A8B4F68FC4857C965FD6F@DKRDSEXC016.vestas.net>
	<158CF4D8-815C-4C8B-9EED-BDAE74706833@slu.se>
	<B078CDF40DFE4045AF172A8B4F68FC4857C965FE61@DKRDSEXC016.vestas.net>
	<FBCCC8C5-D1E9-439D-B440-EC7E402E5A36@slu.se>
	<B078CDF40DFE4045AF172A8B4F68FC4857C965FF2D@DKRDSEXC016.vestas.net>
Message-ID: <87siigs86f.fsf@IES-INVERSOR.upm.es>

Hello,

Navinder, when you say "picking out the right months to merge together",
how do you know which layers are the right ones?. In your code, you are
using the layer 11 both for January and December. Besides, you are not
using the layers 12 and 56.

On the other hand, following the code proposed by Frede, I send some
more lines to clarify why the result of zApply is ordered alphabetically
if you use `months`. You will obtain more useful results working with
zoo::as.yearmon for the index of your data, and defining your own
function with format.POSIXct instead of `months`:

First an example using only time series with the zoo package:

library(zoo)

d <- seq(as.Date("2010-01-01"),as.Date("2014-08-01"),by="month")

vals <- rnorm(length(d))
z <- zoo(vals, d)

## The result is a zoo object, whose index is ordered alphabetically.
aggregate(z, by = months)
## Same result
aggregate(z, by = function(x)format(x, "%B"))
## Now, with months as numbers the index is correctly ordered.
aggregate(z, by = function(x)format(x, "%m"))

Now let's use raster data with the code posted by Frede:

f <- system.file("external/test.grd", package="raster")
## The yearmon class is useful for this data
d <- as.yearmon(d)
rr <- stack(rep(f,length(d)))
names(rr) <- d

rr <- setZ(rr, d, name = 'Month')

## Months as character
rrMonCh <- zApply(rr, by = function(x) format(x, '%b'))
getZ(rrMonCh)
levelplot(rrMonCh)

## Months as numbers
rrMonNum <- zApply(rr, by = function(x)format(x, '%m'))
names(rrMonNum) <- month.abb
getZ(rrMonNum)
levelplot(rrMonNum)

Hope it helps.

Oscar.

> Hi
>
> I give up. You'll have to approach the maintainer of the raster package directly.
>
> As far as I can see there is no difference in the order of your stack(files) and 'd'.
>
> Here is my documentation of that:
>
> ndvif <- c( # output from names(modis)
> "MOD13C2.A2010001.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2010032.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2010060.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2010091.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2010121.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2010152.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2010182.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2010213.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2010244.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2010274.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2010305.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2010335.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2011001.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2011032.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2011060.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2011091.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2011121.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2011152.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2011182.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2011213.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2011244.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2011274.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2011305.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2011335.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2012001.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2012032.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2012061.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2012092.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2012122.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2012153.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2012183.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2012214.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2012245.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2012275.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2012306.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2012336.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2013001.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2013032.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2013060.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2013091.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2013121.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2013152.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2013182.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2013213.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2013244.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2013274.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2013305.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2013335.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2014001.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2014032.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2014060.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2014091.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2014121.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2014152.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2014182.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2014213.CMG_0.05_Deg_Monthly_NDVI")
>
> ftimes <- substring(ndvif, 10, 16)
>
> ftimes <- strptime(ftimes, format = "%Y%j")
>
> d <- seq(as.Date("2010-01-01"), as.Date("2014-08-01"), by="month")
>
> m1 <- months(ftimes)
> m2 <- months(d)
>
> cbind(m1, m2)
>
>
> Yours sincerely / Med venlig hilsen
>
>
> Frede Aakmann T?gersen
> Specialist, M.Sc., Ph.D.
> Plant Performance & Modeling
>
> Technology & Service Solutions
> T +45 9730 5135
> M +45 2547 6050
> frtog at vestas.com<mailto:frtog at vestas.com>
> http://www.vestas.com<http://www.vestas.com/>
>
> Company reg. name: Vestas Wind Systems A/S
> This e-mail is subject to our e-mail disclaimer statement.
> Please refer to www.vestas.com/legal/notice<http://www.vestas.com/legal/notice>
> If you have received this e-mail in error please contact the sender.
>
> From: Navinder Singh [mailto:Navinder.Singh at slu.se]
> Sent: 21. oktober 2014 15:45
> To: Frede Aakmann T?gersen
> Cc: Oscar Perpi??n Lamigueiro; r-sig-geo at r-project.org
> Subject: Re: [R-sig-Geo] Order raster images in a levelplot
>
> Here's what the stack looks like:
> setwd("C:\\Users\\nasi\\Google<smb://Users/nasi/Google> Drive\\5KMNDVI_Monthly")
> modis = stack(list.files(pattern='NDVI.tif'))
>
>> names(modis)
>  [1] "MOD13C2.A2010001.CMG_0.05_Deg_Monthly_NDVI"
>  [2] "MOD13C2.A2010032.CMG_0.05_Deg_Monthly_NDVI"
>  [3] "MOD13C2.A2010060.CMG_0.05_Deg_Monthly_NDVI"
>  [4] "MOD13C2.A2010091.CMG_0.05_Deg_Monthly_NDVI"
>  [5] "MOD13C2.A2010121.CMG_0.05_Deg_Monthly_NDVI"
>  [6] "MOD13C2.A2010152.CMG_0.05_Deg_Monthly_NDVI"
>  [7] "MOD13C2.A2010182.CMG_0.05_Deg_Monthly_NDVI"
>  [8] "MOD13C2.A2010213.CMG_0.05_Deg_Monthly_NDVI"
>  [9] "MOD13C2.A2010244.CMG_0.05_Deg_Monthly_NDVI"
> [10] "MOD13C2.A2010274.CMG_0.05_Deg_Monthly_NDVI"
> [11] "MOD13C2.A2010305.CMG_0.05_Deg_Monthly_NDVI"
> [12] "MOD13C2.A2010335.CMG_0.05_Deg_Monthly_NDVI"
> [13] "MOD13C2.A2011001.CMG_0.05_Deg_Monthly_NDVI"
> [14] "MOD13C2.A2011032.CMG_0.05_Deg_Monthly_NDVI"
> [15] "MOD13C2.A2011060.CMG_0.05_Deg_Monthly_NDVI"
> [16] "MOD13C2.A2011091.CMG_0.05_Deg_Monthly_NDVI"
> [17] "MOD13C2.A2011121.CMG_0.05_Deg_Monthly_NDVI"
> [18] "MOD13C2.A2011152.CMG_0.05_Deg_Monthly_NDVI"
> [19] "MOD13C2.A2011182.CMG_0.05_Deg_Monthly_NDVI"
> [20] "MOD13C2.A2011213.CMG_0.05_Deg_Monthly_NDVI"
> [21] "MOD13C2.A2011244.CMG_0.05_Deg_Monthly_NDVI"
> [22] "MOD13C2.A2011274.CMG_0.05_Deg_Monthly_NDVI"
> [23] "MOD13C2.A2011305.CMG_0.05_Deg_Monthly_NDVI"
> [24] "MOD13C2.A2011335.CMG_0.05_Deg_Monthly_NDVI"
> [25] "MOD13C2.A2012001.CMG_0.05_Deg_Monthly_NDVI"
> [26] "MOD13C2.A2012032.CMG_0.05_Deg_Monthly_NDVI"
> [27] "MOD13C2.A2012061.CMG_0.05_Deg_Monthly_NDVI"
> [28] "MOD13C2.A2012092.CMG_0.05_Deg_Monthly_NDVI"
> [29] "MOD13C2.A2012122.CMG_0.05_Deg_Monthly_NDVI"
> [30] "MOD13C2.A2012153.CMG_0.05_Deg_Monthly_NDVI"
> [31] "MOD13C2.A2012183.CMG_0.05_Deg_Monthly_NDVI"
> [32] "MOD13C2.A2012214.CMG_0.05_Deg_Monthly_NDVI"
> [33] "MOD13C2.A2012245.CMG_0.05_Deg_Monthly_NDVI"
> [34] "MOD13C2.A2012275.CMG_0.05_Deg_Monthly_NDVI"
> [35] "MOD13C2.A2012306.CMG_0.05_Deg_Monthly_NDVI"
> [36] "MOD13C2.A2012336.CMG_0.05_Deg_Monthly_NDVI"
> [37] "MOD13C2.A2013001.CMG_0.05_Deg_Monthly_NDVI"
> [38] "MOD13C2.A2013032.CMG_0.05_Deg_Monthly_NDVI"
> [39] "MOD13C2.A2013060.CMG_0.05_Deg_Monthly_NDVI"
> [40] "MOD13C2.A2013091.CMG_0.05_Deg_Monthly_NDVI"
> [41] "MOD13C2.A2013121.CMG_0.05_Deg_Monthly_NDVI"
> [42] "MOD13C2.A2013152.CMG_0.05_Deg_Monthly_NDVI"
> [43] "MOD13C2.A2013182.CMG_0.05_Deg_Monthly_NDVI"
> [44] "MOD13C2.A2013213.CMG_0.05_Deg_Monthly_NDVI"
> [45] "MOD13C2.A2013244.CMG_0.05_Deg_Monthly_NDVI"
> [46] "MOD13C2.A2013274.CMG_0.05_Deg_Monthly_NDVI"
> [47] "MOD13C2.A2013305.CMG_0.05_Deg_Monthly_NDVI"
> [48] "MOD13C2.A2013335.CMG_0.05_Deg_Monthly_NDVI"
> [49] "MOD13C2.A2014001.CMG_0.05_Deg_Monthly_NDVI"
> [50] "MOD13C2.A2014032.CMG_0.05_Deg_Monthly_NDVI"
> [51] "MOD13C2.A2014060.CMG_0.05_Deg_Monthly_NDVI"
> [52] "MOD13C2.A2014091.CMG_0.05_Deg_Monthly_NDVI"
> [53] "MOD13C2.A2014121.CMG_0.05_Deg_Monthly_NDVI"
> [54] "MOD13C2.A2014152.CMG_0.05_Deg_Monthly_NDVI"
> [55] "MOD13C2.A2014182.CMG_0.05_Deg_Monthly_NDVI"
> [56] "MOD13C2.A2014213.CMG_0.05_Deg_Monthly_NDVI"
>
> d<-seq(as.Date("2010-01-01"),as.Date("2014-08-01"),by="month")
> d
>
>
> Navinder J Singh
> Associate Professor
> Department of Wildlife, Fish, and Environmental Studies
> Faculty of Forest Sciences
> Swedish University of Agricultural Sciences
> SE-901 83 Umea, Sweden
> O: +46 (0)90 786 8538;
> M: +46 (0)70 676 0103
> email: navinder.singh at slu.se<mailto:navinder.singh at slu.se>
> Web: navinderjsingh.weebly.com<http://navinderjsingh.weebly.com/>
>
> www.slu.se/viltfiskmiljo/navinder_singh<http://www.slu.se/viltfiskmiljo/navinder_singh>
> http://slu-se.academia.edu/NSingh
>
>
>
> On 21 Oct 2014, at 15:27, Frede Aakmann T?gersen <frtog at vestas.com<mailto:frtog at vestas.com>> wrote:
>
>
> Hi
>
> Could it be that you are stacking the tif files in a wrong order. So that it does not correspond to your 'd' vector? Please show us the result from list.files(pattern='NDVI.tif').
> I suppose that the file names will tell us something about the date for each particular file. We need to compare that to you 'd' vector.
>
>
> Yours sincerely / Med venlig hilsen
>
>
> Frede Aakmann T?gersen
> Specialist, M.Sc., Ph.D.
> Plant Performance & Modeling
>
> Technology & Service Solutions
> T +45 9730 5135
> M +45 2547 6050
> frtog at vestas.com<mailto:frtog at vestas.com>
> http://www.vestas.com<http://www.vestas.com/>
>
> Company reg. name: Vestas Wind Systems A/S
> This e-mail is subject to our e-mail disclaimer statement.
> Please refer to www.vestas.com/legal/notice<http://www.vestas.com/legal/notice>
> If you have received this e-mail in error please contact the sender.
>
> From: Navinder Singh [mailto:Navinder.Singh at slu.se]
> Sent: 21. oktober 2014 14:30
> To: Frede Aakmann T?gersen; Oscar Perpi??n Lamigueiro
> Cc: r-sig-geo at r-project.org<mailto:r-sig-geo at r-project.org>
> Subject: Re: [R-sig-Geo] Order raster images in a levelplot
>
> Dear Frede,
> The problem still persists. It does make a plot, but then summarises using the wrong layers.
>
> setwd("/Users/nasi/Google Drive/5KMNDVI_Monthly")
> modis = stack(list.files(pattern='NDVI.tif'))
> modis
> names(modis)
> d<-seq(as.Date("2010-01-01"),as.Date("2014-08-01"),by="month")
> d
>  [1] "2010-01-01" "2010-02-01" "2010-03-01" "2010-04-01" "2010-05-01" "2010-06-01"
>  [7] "2010-07-01" "2010-08-01" "2010-09-01" "2010-10-01" "2010-11-01" "2010-12-01"
> [13] "2011-01-01" "2011-02-01" "2011-03-01" "2011-04-01" "2011-05-01" "2011-06-01"
> [19] "2011-07-01" "2011-08-01" "2011-09-01" "2011-10-01" "2011-11-01" "2011-12-01"
> [25] "2012-01-01" "2012-02-01" "2012-03-01" "2012-04-01" "2012-05-01" "2012-06-01"
> [31] "2012-07-01" "2012-08-01" "2012-09-01" "2012-10-01" "2012-11-01" "2012-12-01"
> [37] "2013-01-01" "2013-02-01" "2013-03-01" "2013-04-01" "2013-05-01" "2013-06-01"
> [43] "2013-07-01" "2013-08-01" "2013-09-01" "2013-10-01" "2013-11-01" "2013-12-01"
> [49] "2014-01-01" "2014-02-01" "2014-03-01" "2014-04-01" "2014-05-01" "2014-06-01"
> [55] "2014-07-01" "2014-08-01"
>
> names(modis)<-d
> NDVImod<-setZ(modis,d, name="months")
>
> names(NDVImod)
>  [1] "X2010.01.01" "X2010.02.01" "X2010.03.01" "X2010.04.01" "X2010.05.01" "X2010.06.01"
>  [7] "X2010.07.01" "X2010.08.01" "X2010.09.01" "X2010.10.01" "X2010.11.01" "X2010.12.01"
> [13] "X2011.01.01" "X2011.02.01" "X2011.03.01" "X2011.04.01" "X2011.05.01" "X2011.06.01"
> [19] "X2011.07.01" "X2011.08.01" "X2011.09.01" "X2011.10.01" "X2011.11.01" "X2011.12.01"
> [25] "X2012.01.01" "X2012.02.01" "X2012.03.01" "X2012.04.01" "X2012.05.01" "X2012.06.01"
> [31] "X2012.07.01" "X2012.08.01" "X2012.09.01" "X2012.10.01" "X2012.11.01" "X2012.12.01"
> [37] "X2013.01.01" "X2013.02.01" "X2013.03.01" "X2013.04.01" "X2013.05.01" "X2013.06.01"
> [43] "X2013.07.01" "X2013.08.01" "X2013.09.01" "X2013.10.01" "X2013.11.01" "X2013.12.01"
> [49] "X2014.01.01" "X2014.02.01" "X2014.03.01" "X2014.04.01" "X2014.05.01" "X2014.06.01"
> [55] "X2014.07.01" "X2014.08.01"
>
> e<-extent(-17.96, 43.135, -30.055, 67.08)
>
> NDVImodis<-crop(NDVImod,e) # cropping the layer to extent
>
> NDVImodis[NDVImodis<0]<-0 # setting values below 0 as 0.
>
> NDVImodis<-setZ(NDVImodis,d,name="months")
>
> year.mon.mean<-zApply(NDVImodis, by=months, fun=mean, name="months")
>
> levelplot(year.mon.mean, main="meanNDVI 2010-2014)", par.settings=myTheme)
>
>
> everything seems to be going all right with the code, but i am not sure where things are going wrong- in picking out the right months to merge together.
>
> If i were to do it manually- it works very well-
>
> mean.jan<-mean(NDVImodis[[c(1,11,24,36,48)]])
> #plot(mean.jan)
> mean.feb<-mean(NDVImodis[[c(2,13,25,37,49)]])
> mean.mar<-mean(NDVImodis[[c(3,14,26,38,50)]])
> mean.apr<-mean(NDVImodis[[c(4,15,27,39,51)]])
> mean.may<-mean(NDVImodis[[c(5,16,28,40,52)]])
> mean.jun<-mean(NDVImodis[[c(17,29,41,53)]])
> mean.jul<-mean(NDVImodis[[c(6,18,30,42,54)]])
> mean.aug<-mean(NDVImodis[[c(7,19,31,43,55)]])
> mean.sep<-mean(NDVImodis[[c(8,20,32,44)]])
> mean.oct<-mean(NDVImodis[[c(9,21,33,45)]])
> mean.nov<-mean(NDVImodis[[c(10,22,34,46)]])
> mean.dec<-mean(NDVImodis[[c(11,23,35,47)]])
>
> # Means
> mean.year.mon<-stack(mean.jan,mean.feb,mean.mar,mean.apr,mean.may,mean.jun,
> mean.jul,mean.aug,mean.sep,mean.oct,mean.nov,mean.dec)
> levelplot(mean.year.mon, par.settings=myTheme)
>
>
>
>
>
>
>
> Navinder
>
>
> On 21 Oct 2014, at 13:30, Frede Aakmann T?gersen <frtog at vestas.com<mailto:frtog at vestas.com>> wrote:
>
>
>
> Please remember to post to the list as well since this was there this thread startet.
>
> Dows it have something to do with you not setting the name argument of setZ()?
>
> You are doing:
>
> NDVImodis<-setZ(NDVImodis,d)
> names(NDVImodis)<-d
>
> Perhaps you should do:
>
> NDVImodis<-setZ(NDVImodis,d, name = "Months")
>
> And then e.g.
>
> zApply(NDVImodis, by=months, fun=mean, name="Months")
>
> ?????
>
> Yours sincerely / Med venlig hilsen
>
>
> Frede Aakmann T?gersen
> Specialist, M.Sc., Ph.D.
> Plant Performance & Modeling
>
> Technology & Service Solutions
> T +45 9730 5135
> M +45 2547 6050
> frtog at vestas.com<mailto:frtog at vestas.com>
> http://www.vestas.com<http://www.vestas.com/>
>
> Company reg. name: Vestas Wind Systems A/S
> This e-mail is subject to our e-mail disclaimer statement.
> Please refer to www.vestas.com/legal/notice<http://www.vestas.com/legal/notice>
> If you have received this e-mail in error please contact the sender.
>
> From: Navinder Singh [mailto:Navinder.Singh at slu.se]
> Sent: 21. oktober 2014 13:22
> To: Frede Aakmann T?gersen
> Subject: Re: [R-sig-Geo] Order raster images in a levelplot
>
> Thanks Frede, it worked perfectly.
> However, i have problems using the 'by=months', since it is not estimating the monthly means as i want.
> i want the monthly means across years.i.e means of january, feb and so on. And 'by=months' is dining some averaging but it is averaging the wrong months. Perhaps it has o do something with my naming? Below is what i did.
> I couldn't send you the entire dataset, as they are global images with each 14MB size and they run monthly for 5 years.
> I also posted a message on R-sig.
> Thanks for your help.
> Best wishes,
> Navinder
>
> setwd("/Users/nasi/Google Drive/5KMNDVI_Monthly")
>
> modis = stack(list.files(pattern='NDVI.tif'))
> modis
> names(modis)
> d<-seq(as.Date("2010-01-01"),as.Date("2014-08-01"),by="month")
> names(modis)<-d
> NDVImod<-setZ(modis,d)
> e<-extent(-17.96, 43.135, -30.055, 67.08)
> NDVImodis<-crop(NDVImod,e)
> NDVImodis[NDVImodis<0]<-0
> NDVImodis<-setZ(NDVImodis,d)
> names(NDVImodis)<-d
>
> # The first problem occurs below. I am trying to get monthly means and other quantities. Although the function does give me an output, but the results are completely wrong. As it seems to be averaging the wrong months together. Can't really paste the image here i suppose.
>
> year.mon.max<-zApply(NDVImodis, by=months, fun=max, name="months")
> year.mon.min<-zApply(NDVImodis, by=months, fun=min, name="months")
> year.mon.diff<-year.mon.max-year.mon.min
> year.mon.sd<-zApply(NDVImodis, by=months, fun=sd, name="months")
> year.mon.cv<-zApply(NDVImodis, by=months, fun=cv, name="months")
>
> # I only manage to rearrange this one using the code after these lines. But since the images are wrong, its not of much use. Perhaps my use of 'by' argument above is not correct. Or my naming of the rasters isn't either.
>
> print(levelplot(year.mon.mean[[c(6,2,12,11,10,3,5,4,8,1,9,7)]], main="Mean Monthly NDVI (2010-2014)", par.settings=myTheme))
>
> # perhaps here is where i need to use the par.cond
> # I tried using 'index.cond' here like below:
>
> levelplot(year.mon.mean, index.cond=list(c("January","February","March", "April", "May", "June","July", "August", "Septmeber", "Ocotber","November","December")), par.settings=myTheme)
>
> #But this doesn't plot anything. Even the maps disappear. Perhaps this again has to do with the naming in the rasters.
>
> #Anyhow, i would like to match these monthly images with data on spatial observations of animals where i have an x,y and a date matching the date of the raster.
>
> #I tried doing this below -
> df$layer<-lapply(df$month, function(x) which(grepl(tolower(x), tolower(names(year.mon.mean)))))
> df$meanNDVI<-sapply(seq_len(nrow(df)), function(x) extract(mean.year.mon[[df$layer[x]]], df[x,1:2])) # 1,2 are columns with x and y.
>
> #This also doesn't work, perhaps also has to do with the names in the raster.
>
> Your help is much appreciated.
> Ill keep trying the par.cond argument in the meanwhile.
>
> Best wishes,
>
> Navinder
>
>
>
>
> Navinder J Singh
> Associate Professor
> Department of Wildlife, Fish, and Environmental Studies
> Faculty of Forest Sciences
> Swedish University of Agricultural Sciences
> SE-901 83 Umea, Sweden
> O: +46 (0)90 786 8538;
> M: +46 (0)70 676 0103
> email: navinder.singh at slu.se<mailto:navinder.singh at slu.se>
> Web: navinderjsingh.weebly.com<http://navinderjsingh.weebly.com/>
>
> www.slu.se/viltfiskmiljo/navinder_singh<http://www.slu.se/viltfiskmiljo/navinder_singh>
> http://slu-se.academia.edu/NSingh
>
>
>
> On 21 Oct 2014, at 13:10, Frede Aakmann T?gersen <frtog at vestas.com<mailto:frtog at vestas.com>> wrote:
>
>
>
>
> Hi
>
> Since I don't have your data I cannot say anything about your use of zApply. For the levelplot() problem I think you can use the layer arguments to levelplot() from rasterVis package. Something like this:
>
>
> f <- system.file("external/test.grd", package="raster")
>
> d <- seq(as.Date("2010-01-01"),as.Date("2014-08-01"),by="month")
>
> rr <- stack(rep(f,length(d)))
> names(rr) <- d
>
> rr <- setZ(rr, d, name = 'Month')
>
> rr.mean <- zApply(rrr, by = months, fun = mean, name = "Month")
>
> levelplot(rr.mean, margin = FALSE, layer = unique(months(d)), layout = c(3,4))
>
> Yours sincerely / Med venlig hilsen
>
>
> Frede Aakmann T?gersen
> Specialist, M.Sc., Ph.D.
> Plant Performance & Modeling
>
> Technology & Service Solutions
> T +45 9730 5135
> M +45 2547 6050
> frtog at vestas.com<mailto:frtog at vestas.com>
> http://www.vestas.com<http://www.vestas.com/>
>
> Company reg. name: Vestas Wind Systems A/S
> This e-mail is subject to our e-mail disclaimer statement.
> Please refer to www.vestas.com/legal/notice<http://www.vestas.com/legal/notice>
> If you have received this e-mail in error please contact the sender.
>
> From: Navinder Singh [mailto:Navinder.Singh at slu.se]
> Sent: 21. oktober 2014 12:45
> To: r-sig-geo at r-project.org<mailto:r-sig-geo at r-project.org>
> Cc: oscar.perpinan at upm.es<mailto:oscar.perpinan at upm.es>; Frede Aakmann T?gersen
> Subject: [R-sig-Geo] Order raster images in a levelplot
>
>
> Dear Both,
> Thank you for your responses.
> Oscar- I am still trying to get the indexing going. Hope it will be sorted out soon.
> Just to provide some more background on my code- here is an example.
>
> library(raster)
> library(rasterVis)
> library(raster)
> library(rgdal)
> library(zoo)
>
> setwd("/Users/nasi/Google Drive/5KMNDVI_Monthly")
>
> modis = stack(list.files(pattern='NDVI.tif'))
> modis
> names(modis)
> d<-seq(as.Date("2010-01-01"),as.Date("2014-08-01"),by="month")
> names(modis)<-d
> NDVImod<-setZ(modis,d)
> e<-extent(-17.96, 43.135, -30.055, 67.08)
> NDVImodis<-crop(NDVImod,e)
> NDVImodis[NDVImodis<0]<-0
> NDVImodis<-setZ(NDVImodis,d)
> names(NDVImodis)<-d
>
> # The first problem occurs below. I am trying to get monthly means and other quantities. Although the function does give me an output, but the results are completely wrong. As it seems to be averaging the wrong months together. Can't really paste the image here i suppose.
>
> year.mon.max<-zApply(NDVImodis, by=months, fun=max, name="months")
> year.mon.min<-zApply(NDVImodis, by=months, fun=min, name="months")
> year.mon.diff<-year.mon.max-year.mon.min
> year.mon.sd<-zApply(NDVImodis, by=months, fun=sd, name="months")
> year.mon.cv<-zApply(NDVImodis, by=months, fun=cv, name="months")
>
> # I only manage to rearrange this one using the code after these lines. But since the images are wrong, its not of much use. Perhaps my use of 'by' argument above is not correct. Or my naming of the rasters isn't either.
>
> print(levelplot(year.mon.mean[[c(6,2,12,11,10,3,5,4,8,1,9,7)]], main="Mean Monthly NDVI (2010-2014)", par.settings=myTheme))
>
> # perhaps here is where i need to use the par.cond
> # I tried using 'index.cond' here like below:
>
> levelplot(year.mon.mean, index.cond=list(c("January","February","March", "April", "May", "June","July", "August", "Septmeber", "Ocotber","November", "December")),par.settings=myTheme)
>
> #But this doesn't plot anything. Even the maps disappear. Perhaps this again has to do with the naming in the rasters.
>
> #Anyhow, i would like to match these monthly images with data on spatial observations of animals where i have an x,y and a date matching the date of the raster.
>
> #I tried doing this below -
> df$layer<-lapply(df$month, function(x) which(grepl(tolower(x), tolower(names(year.mon.mean)))))
> df$meanNDVI<-sapply(seq_len(nrow(df)), function(x) extract(mean.year.mon[[df$layer[x]]], df[x,1:2])) # 1,2 are columns with x and y.
>
> #This also doesn't work, perhaps also has to do with the names in the raster.
>
> Your help is much appreciated.
> Ill keep trying the par.cond argument in the meanwhile.
>
> Best wishes,
>
> Navinder
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
> Navinder J Singh
> Associate Professor
> Department of Wildlife, Fish, and Environmental Studies
> Faculty of Forest Sciences
> Swedish University of Agricultural Sciences
> SE-901 83 Umea, Sweden
> O: +46 (0)90 786 8538;
> M: +46 (0)70 676 0103
> email: navinder.singh at slu.se<mailto:navinder.singh at slu.se>
> Web: navinderjsingh.weebly.com<http://navinderjsingh.weebly.com/>
>
> www.slu.se/viltfiskmiljo/navinder_singh<http://www.slu.se/viltfiskmiljo/navinder_singh>
> http://slu-se.academia.edu/NSingh
>
>
>
> On 21 Oct 2014, at 08:53, Frede Aakmann T?gersen <frtog at vestas.com<mailto:frtog at vestas.com>> wrote:
>
> Hi
>
> Since no code example was provided we'll have to guess. I suppose it has to do with the way factor() works.
>
> Here is the built-in list of month names in R:
>
>
>
>
> month.name
> [1] "January"   "February"  "March"     "April"     "May"       "June"
> [7] "July"      "August"    "September" "October"   "November"  "December"
>
> Now show this as a factor:
>
>
>
>
> factor(month.name)
> [1] January   February  March     April     May       June      July
> [8] August    September October   November  December
> 12 Levels: April August December February January July June March ... September
>
> See how factor() is using lexicographical order for the labels of the factor levels.
>
> Now do this  instead:
>
>
>
>
> factor(month.name, labels = month.name)
> [1] May       April     August    January   September July      June
> [8] February  December  November  October   March
> 12 Levels: January February March April May June July August ... December
>
> Now the order of the labels of the levels is the same as that of month.name.
>
> Here is an example:
>
> testdata <- data.frame(x = 1, y = 1, Month = factor(month.name))
>
> ### order of panels is that of order(month.name)
> xyplot(y ~ x|Month, data = testdata)
>
> testdata <- data.frame(x = 1, y = 1, Month = factor(month.name, labels = month.name))
>
> ### order of panels is that of month.name
> ### January in bottom left and Deccember in top right panel
> xyplot(y ~ x|Month, data = testdata)
>
> ### use the as.table argument to get January in top left and December in bottom right
> xyplot(y ~ x|Month, data = testdata, as.table = TRUE)
>
>
> Yours sincerely / Med venlig hilsen
>
>
> Frede Aakmann T?gersen
> Specialist, M.Sc., Ph.D.
> Plant Performance & Modeling
>
> Technology & Service Solutions
> T +45 9730 5135
> M +45 2547 6050
> frtog at vestas.com<mailto:frtog at vestas.com>
> http://www.vestas.com<http://www.vestas.com/>
>
> Company reg. name: Vestas Wind Systems A/S
> This e-mail is subject to our e-mail disclaimer statement.
> Please refer to www.vestas.com/legal/notice<http://www.vestas.com/legal/notice>
> If you have received this e-mail in error please contact the sender.
>
>
>
>
>
> -----Original Message-----
> From: r-sig-geo-bounces at r-project.org<mailto:r-sig-geo-bounces at r-project.org> [mailto:r-sig-geo-bounces at r-
> project.org<mailto:r-sig-geo-bounces at r-%0bproject.org>] On Behalf Of Oscar Perpi??n Lamigueiro
> Sent: 21. oktober 2014 07:50
> To: Navinder Singh
> Cc: r-sig-geo at r-project.org<mailto:r-sig-geo at r-project.org>
> Subject: Re: [R-sig-Geo] Order raster images in a levelplot
>
> Hi,
>
>
>
>
> 1. Does someone have any suggestions on how i can order the sequence
> of images in a "levelplot" made using rasterVis.  Specifically, i
> have months i need to arrange in the normal sequence, as the plot
> currently aligns them in an alphabetical order. Does "levelplot"
> works the same way as xyplots in lattice?
>
> levelplot methods defined in rasterVis are based on lattice graphics.
> Most of the arguments provided by lattice::xyplot and
> lattice::levelplot are also available. For this issue you could try
> these arguments: perm.cond, index.cond, as.table. All of them are
> described in the help page of lattice::xyplot.
>
>
>
>
> 2. Have there been more developments on the zApply function in the
> raster package? I am trying to make basic statistical summaries for
> mean monthly (eg. NDVI values) form a multi annual time series.  How
> does one go about using the "by" Indexing in this case.
>
> Could you post a reproducible example? I have used zApply for similar
> tasks without problems.
>
> Best,
>
> Oscar.

-- 
Oscar Perpi??n Lamigueiro
Dpto. Ingenier?a El?ctrica (ETSIDI-UPM)
Grupo de Sistemas Fotovoltaicos (IES-UPM)
URL: http://oscarperpinan.github.io


From Navinder.Singh at slu.se  Wed Oct 22 13:45:40 2014
From: Navinder.Singh at slu.se (Navinder Singh)
Date: Wed, 22 Oct 2014 11:45:40 +0000
Subject: [R-sig-Geo] Order raster images in a levelplot
In-Reply-To: <87siigs86f.fsf@IES-INVERSOR.upm.es>
References: <2DEBFCEA-DA32-4593-88C8-FD2DA59012B0@slu.se>
	<87ppdmhsrb.fsf@upm.es>
	<B078CDF40DFE4045AF172A8B4F68FC4857C965FB06@DKRDSEXC016.vestas.net>
	<804C9698-7BCF-4C91-87DC-D3BFEC671EEB@slu.se>
	<3055E4D2865EED429B17F80FF667E35723BEA04F@exchange2-2>
	<B078CDF40DFE4045AF172A8B4F68FC4857C965FD3D@DKRDSEXC016.vestas.net>
	<F0148F09-B265-480D-918D-EC07468A3A61@slu.se>
	<B078CDF40DFE4045AF172A8B4F68FC4857C965FD6F@DKRDSEXC016.vestas.net>
	<158CF4D8-815C-4C8B-9EED-BDAE74706833@slu.se>
	<B078CDF40DFE4045AF172A8B4F68FC4857C965FE61@DKRDSEXC016.vestas.net>
	<FBCCC8C5-D1E9-439D-B440-EC7E402E5A36@slu.se>
	<B078CDF40DFE4045AF172A8B4F68FC4857C965FF2D@DKRDSEXC016.vestas.net>
	<87siigs86f.fsf@IES-INVERSOR.upm.es>
Message-ID: <3055E4D2865EED429B17F80FF667E35723BF3A94@exchange2-2>

Dear Oscar and Frede,
Thanks for the replies. It really helped to understand how dates are being assigned within the raster stack and why things mess up. 
The months as numbers as suggested by Oscar worked perfectly. 
Thank you both for your time. 
Best wishes,
Navinder


-----Original Message-----
From: Oscar Perpi?an [mailto:oscar.perpinan at gmail.com] On Behalf Of Oscar Perpi??n Lamigueiro
Sent: den 22 oktober 2014 12:08
To: Navinder Singh
Cc: Frede Aakmann T?gersen; r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] Order raster images in a levelplot

Hello,

Navinder, when you say "picking out the right months to merge together", how do you know which layers are the right ones?. In your code, you are using the layer 11 both for January and December. Besides, you are not using the layers 12 and 56.

On the other hand, following the code proposed by Frede, I send some more lines to clarify why the result of zApply is ordered alphabetically if you use `months`. You will obtain more useful results working with zoo::as.yearmon for the index of your data, and defining your own function with format.POSIXct instead of `months`:

First an example using only time series with the zoo package:

library(zoo)

d <- seq(as.Date("2010-01-01"),as.Date("2014-08-01"),by="month")

vals <- rnorm(length(d))
z <- zoo(vals, d)

## The result is a zoo object, whose index is ordered alphabetically.
aggregate(z, by = months)
## Same result
aggregate(z, by = function(x)format(x, "%B")) ## Now, with months as numbers the index is correctly ordered.
aggregate(z, by = function(x)format(x, "%m"))

Now let's use raster data with the code posted by Frede:

f <- system.file("external/test.grd", package="raster") ## The yearmon class is useful for this data d <- as.yearmon(d) rr <- stack(rep(f,length(d)))
names(rr) <- d

rr <- setZ(rr, d, name = 'Month')

## Months as character
rrMonCh <- zApply(rr, by = function(x) format(x, '%b'))
getZ(rrMonCh)
levelplot(rrMonCh)

## Months as numbers
rrMonNum <- zApply(rr, by = function(x)format(x, '%m'))
names(rrMonNum) <- month.abb
getZ(rrMonNum)
levelplot(rrMonNum)

Hope it helps.

Oscar.

> Hi
>
> I give up. You'll have to approach the maintainer of the raster package directly.
>
> As far as I can see there is no difference in the order of your stack(files) and 'd'.
>
> Here is my documentation of that:
>
> ndvif <- c( # output from names(modis) 
> "MOD13C2.A2010001.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2010032.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2010060.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2010091.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2010121.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2010152.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2010182.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2010213.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2010244.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2010274.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2010305.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2010335.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2011001.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2011032.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2011060.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2011091.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2011121.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2011152.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2011182.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2011213.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2011244.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2011274.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2011305.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2011335.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2012001.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2012032.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2012061.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2012092.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2012122.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2012153.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2012183.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2012214.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2012245.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2012275.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2012306.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2012336.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2013001.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2013032.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2013060.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2013091.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2013121.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2013152.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2013182.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2013213.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2013244.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2013274.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2013305.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2013335.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2014001.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2014032.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2014060.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2014091.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2014121.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2014152.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2014182.CMG_0.05_Deg_Monthly_NDVI",
> "MOD13C2.A2014213.CMG_0.05_Deg_Monthly_NDVI")
>
> ftimes <- substring(ndvif, 10, 16)
>
> ftimes <- strptime(ftimes, format = "%Y%j")
>
> d <- seq(as.Date("2010-01-01"), as.Date("2014-08-01"), by="month")
>
> m1 <- months(ftimes)
> m2 <- months(d)
>
> cbind(m1, m2)
>
>
> Yours sincerely / Med venlig hilsen
>
>
> Frede Aakmann T?gersen
> Specialist, M.Sc., Ph.D.
> Plant Performance & Modeling
>
> Technology & Service Solutions
> T +45 9730 5135
> M +45 2547 6050
> frtog at vestas.com<mailto:frtog at vestas.com>
> http://www.vestas.com<http://www.vestas.com/>
>
> Company reg. name: Vestas Wind Systems A/S This e-mail is subject to 
> our e-mail disclaimer statement.
> Please refer to 
> www.vestas.com/legal/notice<http://www.vestas.com/legal/notice>
> If you have received this e-mail in error please contact the sender.
>
> From: Navinder Singh [mailto:Navinder.Singh at slu.se]
> Sent: 21. oktober 2014 15:45
> To: Frede Aakmann T?gersen
> Cc: Oscar Perpi??n Lamigueiro; r-sig-geo at r-project.org
> Subject: Re: [R-sig-Geo] Order raster images in a levelplot
>
> Here's what the stack looks like:
> setwd("C:\\Users\\nasi\\Google<smb://Users/nasi/Google> 
> Drive\\5KMNDVI_Monthly") modis = stack(list.files(pattern='NDVI.tif'))
>
>> names(modis)
>  [1] "MOD13C2.A2010001.CMG_0.05_Deg_Monthly_NDVI"
>  [2] "MOD13C2.A2010032.CMG_0.05_Deg_Monthly_NDVI"
>  [3] "MOD13C2.A2010060.CMG_0.05_Deg_Monthly_NDVI"
>  [4] "MOD13C2.A2010091.CMG_0.05_Deg_Monthly_NDVI"
>  [5] "MOD13C2.A2010121.CMG_0.05_Deg_Monthly_NDVI"
>  [6] "MOD13C2.A2010152.CMG_0.05_Deg_Monthly_NDVI"
>  [7] "MOD13C2.A2010182.CMG_0.05_Deg_Monthly_NDVI"
>  [8] "MOD13C2.A2010213.CMG_0.05_Deg_Monthly_NDVI"
>  [9] "MOD13C2.A2010244.CMG_0.05_Deg_Monthly_NDVI"
> [10] "MOD13C2.A2010274.CMG_0.05_Deg_Monthly_NDVI"
> [11] "MOD13C2.A2010305.CMG_0.05_Deg_Monthly_NDVI"
> [12] "MOD13C2.A2010335.CMG_0.05_Deg_Monthly_NDVI"
> [13] "MOD13C2.A2011001.CMG_0.05_Deg_Monthly_NDVI"
> [14] "MOD13C2.A2011032.CMG_0.05_Deg_Monthly_NDVI"
> [15] "MOD13C2.A2011060.CMG_0.05_Deg_Monthly_NDVI"
> [16] "MOD13C2.A2011091.CMG_0.05_Deg_Monthly_NDVI"
> [17] "MOD13C2.A2011121.CMG_0.05_Deg_Monthly_NDVI"
> [18] "MOD13C2.A2011152.CMG_0.05_Deg_Monthly_NDVI"
> [19] "MOD13C2.A2011182.CMG_0.05_Deg_Monthly_NDVI"
> [20] "MOD13C2.A2011213.CMG_0.05_Deg_Monthly_NDVI"
> [21] "MOD13C2.A2011244.CMG_0.05_Deg_Monthly_NDVI"
> [22] "MOD13C2.A2011274.CMG_0.05_Deg_Monthly_NDVI"
> [23] "MOD13C2.A2011305.CMG_0.05_Deg_Monthly_NDVI"
> [24] "MOD13C2.A2011335.CMG_0.05_Deg_Monthly_NDVI"
> [25] "MOD13C2.A2012001.CMG_0.05_Deg_Monthly_NDVI"
> [26] "MOD13C2.A2012032.CMG_0.05_Deg_Monthly_NDVI"
> [27] "MOD13C2.A2012061.CMG_0.05_Deg_Monthly_NDVI"
> [28] "MOD13C2.A2012092.CMG_0.05_Deg_Monthly_NDVI"
> [29] "MOD13C2.A2012122.CMG_0.05_Deg_Monthly_NDVI"
> [30] "MOD13C2.A2012153.CMG_0.05_Deg_Monthly_NDVI"
> [31] "MOD13C2.A2012183.CMG_0.05_Deg_Monthly_NDVI"
> [32] "MOD13C2.A2012214.CMG_0.05_Deg_Monthly_NDVI"
> [33] "MOD13C2.A2012245.CMG_0.05_Deg_Monthly_NDVI"
> [34] "MOD13C2.A2012275.CMG_0.05_Deg_Monthly_NDVI"
> [35] "MOD13C2.A2012306.CMG_0.05_Deg_Monthly_NDVI"
> [36] "MOD13C2.A2012336.CMG_0.05_Deg_Monthly_NDVI"
> [37] "MOD13C2.A2013001.CMG_0.05_Deg_Monthly_NDVI"
> [38] "MOD13C2.A2013032.CMG_0.05_Deg_Monthly_NDVI"
> [39] "MOD13C2.A2013060.CMG_0.05_Deg_Monthly_NDVI"
> [40] "MOD13C2.A2013091.CMG_0.05_Deg_Monthly_NDVI"
> [41] "MOD13C2.A2013121.CMG_0.05_Deg_Monthly_NDVI"
> [42] "MOD13C2.A2013152.CMG_0.05_Deg_Monthly_NDVI"
> [43] "MOD13C2.A2013182.CMG_0.05_Deg_Monthly_NDVI"
> [44] "MOD13C2.A2013213.CMG_0.05_Deg_Monthly_NDVI"
> [45] "MOD13C2.A2013244.CMG_0.05_Deg_Monthly_NDVI"
> [46] "MOD13C2.A2013274.CMG_0.05_Deg_Monthly_NDVI"
> [47] "MOD13C2.A2013305.CMG_0.05_Deg_Monthly_NDVI"
> [48] "MOD13C2.A2013335.CMG_0.05_Deg_Monthly_NDVI"
> [49] "MOD13C2.A2014001.CMG_0.05_Deg_Monthly_NDVI"
> [50] "MOD13C2.A2014032.CMG_0.05_Deg_Monthly_NDVI"
> [51] "MOD13C2.A2014060.CMG_0.05_Deg_Monthly_NDVI"
> [52] "MOD13C2.A2014091.CMG_0.05_Deg_Monthly_NDVI"
> [53] "MOD13C2.A2014121.CMG_0.05_Deg_Monthly_NDVI"
> [54] "MOD13C2.A2014152.CMG_0.05_Deg_Monthly_NDVI"
> [55] "MOD13C2.A2014182.CMG_0.05_Deg_Monthly_NDVI"
> [56] "MOD13C2.A2014213.CMG_0.05_Deg_Monthly_NDVI"
>
> d<-seq(as.Date("2010-01-01"),as.Date("2014-08-01"),by="month")
> d
>
>
> Navinder J Singh
> Associate Professor
> Department of Wildlife, Fish, and Environmental Studies Faculty of 
> Forest Sciences Swedish University of Agricultural Sciences
> SE-901 83 Umea, Sweden
> O: +46 (0)90 786 8538;
> M: +46 (0)70 676 0103
> email: navinder.singh at slu.se<mailto:navinder.singh at slu.se>
> Web: navinderjsingh.weebly.com<http://navinderjsingh.weebly.com/>
>
> www.slu.se/viltfiskmiljo/navinder_singh<http://www.slu.se/viltfiskmilj
> o/navinder_singh>
> http://slu-se.academia.edu/NSingh
>
>
>
> On 21 Oct 2014, at 15:27, Frede Aakmann T?gersen <frtog at vestas.com<mailto:frtog at vestas.com>> wrote:
>
>
> Hi
>
> Could it be that you are stacking the tif files in a wrong order. So that it does not correspond to your 'd' vector? Please show us the result from list.files(pattern='NDVI.tif').
> I suppose that the file names will tell us something about the date for each particular file. We need to compare that to you 'd' vector.
>
>
> Yours sincerely / Med venlig hilsen
>
>
> Frede Aakmann T?gersen
> Specialist, M.Sc., Ph.D.
> Plant Performance & Modeling
>
> Technology & Service Solutions
> T +45 9730 5135
> M +45 2547 6050
> frtog at vestas.com<mailto:frtog at vestas.com>
> http://www.vestas.com<http://www.vestas.com/>
>
> Company reg. name: Vestas Wind Systems A/S This e-mail is subject to 
> our e-mail disclaimer statement.
> Please refer to 
> www.vestas.com/legal/notice<http://www.vestas.com/legal/notice>
> If you have received this e-mail in error please contact the sender.
>
> From: Navinder Singh [mailto:Navinder.Singh at slu.se]
> Sent: 21. oktober 2014 14:30
> To: Frede Aakmann T?gersen; Oscar Perpi??n Lamigueiro
> Cc: r-sig-geo at r-project.org<mailto:r-sig-geo at r-project.org>
> Subject: Re: [R-sig-Geo] Order raster images in a levelplot
>
> Dear Frede,
> The problem still persists. It does make a plot, but then summarises using the wrong layers.
>
> setwd("/Users/nasi/Google Drive/5KMNDVI_Monthly") modis = 
> stack(list.files(pattern='NDVI.tif'))
> modis
> names(modis)
> d<-seq(as.Date("2010-01-01"),as.Date("2014-08-01"),by="month")
> d
>  [1] "2010-01-01" "2010-02-01" "2010-03-01" "2010-04-01" "2010-05-01" "2010-06-01"
>  [7] "2010-07-01" "2010-08-01" "2010-09-01" "2010-10-01" "2010-11-01" "2010-12-01"
> [13] "2011-01-01" "2011-02-01" "2011-03-01" "2011-04-01" "2011-05-01" "2011-06-01"
> [19] "2011-07-01" "2011-08-01" "2011-09-01" "2011-10-01" "2011-11-01" "2011-12-01"
> [25] "2012-01-01" "2012-02-01" "2012-03-01" "2012-04-01" "2012-05-01" "2012-06-01"
> [31] "2012-07-01" "2012-08-01" "2012-09-01" "2012-10-01" "2012-11-01" "2012-12-01"
> [37] "2013-01-01" "2013-02-01" "2013-03-01" "2013-04-01" "2013-05-01" "2013-06-01"
> [43] "2013-07-01" "2013-08-01" "2013-09-01" "2013-10-01" "2013-11-01" "2013-12-01"
> [49] "2014-01-01" "2014-02-01" "2014-03-01" "2014-04-01" "2014-05-01" "2014-06-01"
> [55] "2014-07-01" "2014-08-01"
>
> names(modis)<-d
> NDVImod<-setZ(modis,d, name="months")
>
> names(NDVImod)
>  [1] "X2010.01.01" "X2010.02.01" "X2010.03.01" "X2010.04.01" "X2010.05.01" "X2010.06.01"
>  [7] "X2010.07.01" "X2010.08.01" "X2010.09.01" "X2010.10.01" "X2010.11.01" "X2010.12.01"
> [13] "X2011.01.01" "X2011.02.01" "X2011.03.01" "X2011.04.01" "X2011.05.01" "X2011.06.01"
> [19] "X2011.07.01" "X2011.08.01" "X2011.09.01" "X2011.10.01" "X2011.11.01" "X2011.12.01"
> [25] "X2012.01.01" "X2012.02.01" "X2012.03.01" "X2012.04.01" "X2012.05.01" "X2012.06.01"
> [31] "X2012.07.01" "X2012.08.01" "X2012.09.01" "X2012.10.01" "X2012.11.01" "X2012.12.01"
> [37] "X2013.01.01" "X2013.02.01" "X2013.03.01" "X2013.04.01" "X2013.05.01" "X2013.06.01"
> [43] "X2013.07.01" "X2013.08.01" "X2013.09.01" "X2013.10.01" "X2013.11.01" "X2013.12.01"
> [49] "X2014.01.01" "X2014.02.01" "X2014.03.01" "X2014.04.01" "X2014.05.01" "X2014.06.01"
> [55] "X2014.07.01" "X2014.08.01"
>
> e<-extent(-17.96, 43.135, -30.055, 67.08)
>
> NDVImodis<-crop(NDVImod,e) # cropping the layer to extent
>
> NDVImodis[NDVImodis<0]<-0 # setting values below 0 as 0.
>
> NDVImodis<-setZ(NDVImodis,d,name="months")
>
> year.mon.mean<-zApply(NDVImodis, by=months, fun=mean, name="months")
>
> levelplot(year.mon.mean, main="meanNDVI 2010-2014)", 
> par.settings=myTheme)
>
>
> everything seems to be going all right with the code, but i am not sure where things are going wrong- in picking out the right months to merge together.
>
> If i were to do it manually- it works very well-
>
> mean.jan<-mean(NDVImodis[[c(1,11,24,36,48)]])
> #plot(mean.jan)
> mean.feb<-mean(NDVImodis[[c(2,13,25,37,49)]])
> mean.mar<-mean(NDVImodis[[c(3,14,26,38,50)]])
> mean.apr<-mean(NDVImodis[[c(4,15,27,39,51)]])
> mean.may<-mean(NDVImodis[[c(5,16,28,40,52)]])
> mean.jun<-mean(NDVImodis[[c(17,29,41,53)]])
> mean.jul<-mean(NDVImodis[[c(6,18,30,42,54)]])
> mean.aug<-mean(NDVImodis[[c(7,19,31,43,55)]])
> mean.sep<-mean(NDVImodis[[c(8,20,32,44)]])
> mean.oct<-mean(NDVImodis[[c(9,21,33,45)]])
> mean.nov<-mean(NDVImodis[[c(10,22,34,46)]])
> mean.dec<-mean(NDVImodis[[c(11,23,35,47)]])
>
> # Means
> mean.year.mon<-stack(mean.jan,mean.feb,mean.mar,mean.apr,mean.may,mean
> .jun,
> mean.jul,mean.aug,mean.sep,mean.oct,mean.nov,mean.dec)
> levelplot(mean.year.mon, par.settings=myTheme)
>
>
>
>
>
>
>
> Navinder
>
>
> On 21 Oct 2014, at 13:30, Frede Aakmann T?gersen <frtog at vestas.com<mailto:frtog at vestas.com>> wrote:
>
>
>
> Please remember to post to the list as well since this was there this thread startet.
>
> Dows it have something to do with you not setting the name argument of setZ()?
>
> You are doing:
>
> NDVImodis<-setZ(NDVImodis,d)
> names(NDVImodis)<-d
>
> Perhaps you should do:
>
> NDVImodis<-setZ(NDVImodis,d, name = "Months")
>
> And then e.g.
>
> zApply(NDVImodis, by=months, fun=mean, name="Months")
>
> ?????
>
> Yours sincerely / Med venlig hilsen
>
>
> Frede Aakmann T?gersen
> Specialist, M.Sc., Ph.D.
> Plant Performance & Modeling
>
> Technology & Service Solutions
> T +45 9730 5135
> M +45 2547 6050
> frtog at vestas.com<mailto:frtog at vestas.com>
> http://www.vestas.com<http://www.vestas.com/>
>
> Company reg. name: Vestas Wind Systems A/S This e-mail is subject to 
> our e-mail disclaimer statement.
> Please refer to 
> www.vestas.com/legal/notice<http://www.vestas.com/legal/notice>
> If you have received this e-mail in error please contact the sender.
>
> From: Navinder Singh [mailto:Navinder.Singh at slu.se]
> Sent: 21. oktober 2014 13:22
> To: Frede Aakmann T?gersen
> Subject: Re: [R-sig-Geo] Order raster images in a levelplot
>
> Thanks Frede, it worked perfectly.
> However, i have problems using the 'by=months', since it is not estimating the monthly means as i want.
> i want the monthly means across years.i.e means of january, feb and so on. And 'by=months' is dining some averaging but it is averaging the wrong months. Perhaps it has o do something with my naming? Below is what i did.
> I couldn't send you the entire dataset, as they are global images with each 14MB size and they run monthly for 5 years.
> I also posted a message on R-sig.
> Thanks for your help.
> Best wishes,
> Navinder
>
> setwd("/Users/nasi/Google Drive/5KMNDVI_Monthly")
>
> modis = stack(list.files(pattern='NDVI.tif'))
> modis
> names(modis)
> d<-seq(as.Date("2010-01-01"),as.Date("2014-08-01"),by="month")
> names(modis)<-d
> NDVImod<-setZ(modis,d)
> e<-extent(-17.96, 43.135, -30.055, 67.08)
> NDVImodis<-crop(NDVImod,e)
> NDVImodis[NDVImodis<0]<-0
> NDVImodis<-setZ(NDVImodis,d)
> names(NDVImodis)<-d
>
> # The first problem occurs below. I am trying to get monthly means and other quantities. Although the function does give me an output, but the results are completely wrong. As it seems to be averaging the wrong months together. Can't really paste the image here i suppose.
>
> year.mon.max<-zApply(NDVImodis, by=months, fun=max, name="months") 
> year.mon.min<-zApply(NDVImodis, by=months, fun=min, name="months") 
> year.mon.diff<-year.mon.max-year.mon.min
> year.mon.sd<-zApply(NDVImodis, by=months, fun=sd, name="months") 
> year.mon.cv<-zApply(NDVImodis, by=months, fun=cv, name="months")
>
> # I only manage to rearrange this one using the code after these lines. But since the images are wrong, its not of much use. Perhaps my use of 'by' argument above is not correct. Or my naming of the rasters isn't either.
>
> print(levelplot(year.mon.mean[[c(6,2,12,11,10,3,5,4,8,1,9,7)]], 
> main="Mean Monthly NDVI (2010-2014)", par.settings=myTheme))
>
> # perhaps here is where i need to use the par.cond # I tried using 
> 'index.cond' here like below:
>
> levelplot(year.mon.mean, 
> index.cond=list(c("January","February","March", "April", "May", 
> "June","July", "August", "Septmeber", 
> "Ocotber","November","December")), par.settings=myTheme)
>
> #But this doesn't plot anything. Even the maps disappear. Perhaps this again has to do with the naming in the rasters.
>
> #Anyhow, i would like to match these monthly images with data on spatial observations of animals where i have an x,y and a date matching the date of the raster.
>
> #I tried doing this below -
> df$layer<-lapply(df$month, function(x) which(grepl(tolower(x), 
> tolower(names(year.mon.mean))))) df$meanNDVI<-sapply(seq_len(nrow(df)), function(x) extract(mean.year.mon[[df$layer[x]]], df[x,1:2])) # 1,2 are columns with x and y.
>
> #This also doesn't work, perhaps also has to do with the names in the raster.
>
> Your help is much appreciated.
> Ill keep trying the par.cond argument in the meanwhile.
>
> Best wishes,
>
> Navinder
>
>
>
>
> Navinder J Singh
> Associate Professor
> Department of Wildlife, Fish, and Environmental Studies Faculty of 
> Forest Sciences Swedish University of Agricultural Sciences
> SE-901 83 Umea, Sweden
> O: +46 (0)90 786 8538;
> M: +46 (0)70 676 0103
> email: navinder.singh at slu.se<mailto:navinder.singh at slu.se>
> Web: navinderjsingh.weebly.com<http://navinderjsingh.weebly.com/>
>
> www.slu.se/viltfiskmiljo/navinder_singh<http://www.slu.se/viltfiskmilj
> o/navinder_singh>
> http://slu-se.academia.edu/NSingh
>
>
>
> On 21 Oct 2014, at 13:10, Frede Aakmann T?gersen <frtog at vestas.com<mailto:frtog at vestas.com>> wrote:
>
>
>
>
> Hi
>
> Since I don't have your data I cannot say anything about your use of zApply. For the levelplot() problem I think you can use the layer arguments to levelplot() from rasterVis package. Something like this:
>
>
> f <- system.file("external/test.grd", package="raster")
>
> d <- seq(as.Date("2010-01-01"),as.Date("2014-08-01"),by="month")
>
> rr <- stack(rep(f,length(d)))
> names(rr) <- d
>
> rr <- setZ(rr, d, name = 'Month')
>
> rr.mean <- zApply(rrr, by = months, fun = mean, name = "Month")
>
> levelplot(rr.mean, margin = FALSE, layer = unique(months(d)), layout = 
> c(3,4))
>
> Yours sincerely / Med venlig hilsen
>
>
> Frede Aakmann T?gersen
> Specialist, M.Sc., Ph.D.
> Plant Performance & Modeling
>
> Technology & Service Solutions
> T +45 9730 5135
> M +45 2547 6050
> frtog at vestas.com<mailto:frtog at vestas.com>
> http://www.vestas.com<http://www.vestas.com/>
>
> Company reg. name: Vestas Wind Systems A/S This e-mail is subject to 
> our e-mail disclaimer statement.
> Please refer to 
> www.vestas.com/legal/notice<http://www.vestas.com/legal/notice>
> If you have received this e-mail in error please contact the sender.
>
> From: Navinder Singh [mailto:Navinder.Singh at slu.se]
> Sent: 21. oktober 2014 12:45
> To: r-sig-geo at r-project.org<mailto:r-sig-geo at r-project.org>
> Cc: oscar.perpinan at upm.es<mailto:oscar.perpinan at upm.es>; Frede Aakmann 
> T?gersen
> Subject: [R-sig-Geo] Order raster images in a levelplot
>
>
> Dear Both,
> Thank you for your responses.
> Oscar- I am still trying to get the indexing going. Hope it will be sorted out soon.
> Just to provide some more background on my code- here is an example.
>
> library(raster)
> library(rasterVis)
> library(raster)
> library(rgdal)
> library(zoo)
>
> setwd("/Users/nasi/Google Drive/5KMNDVI_Monthly")
>
> modis = stack(list.files(pattern='NDVI.tif'))
> modis
> names(modis)
> d<-seq(as.Date("2010-01-01"),as.Date("2014-08-01"),by="month")
> names(modis)<-d
> NDVImod<-setZ(modis,d)
> e<-extent(-17.96, 43.135, -30.055, 67.08)
> NDVImodis<-crop(NDVImod,e)
> NDVImodis[NDVImodis<0]<-0
> NDVImodis<-setZ(NDVImodis,d)
> names(NDVImodis)<-d
>
> # The first problem occurs below. I am trying to get monthly means and other quantities. Although the function does give me an output, but the results are completely wrong. As it seems to be averaging the wrong months together. Can't really paste the image here i suppose.
>
> year.mon.max<-zApply(NDVImodis, by=months, fun=max, name="months") 
> year.mon.min<-zApply(NDVImodis, by=months, fun=min, name="months") 
> year.mon.diff<-year.mon.max-year.mon.min
> year.mon.sd<-zApply(NDVImodis, by=months, fun=sd, name="months") 
> year.mon.cv<-zApply(NDVImodis, by=months, fun=cv, name="months")
>
> # I only manage to rearrange this one using the code after these lines. But since the images are wrong, its not of much use. Perhaps my use of 'by' argument above is not correct. Or my naming of the rasters isn't either.
>
> print(levelplot(year.mon.mean[[c(6,2,12,11,10,3,5,4,8,1,9,7)]], 
> main="Mean Monthly NDVI (2010-2014)", par.settings=myTheme))
>
> # perhaps here is where i need to use the par.cond # I tried using 
> 'index.cond' here like below:
>
> levelplot(year.mon.mean, 
> index.cond=list(c("January","February","March", "April", "May", 
> "June","July", "August", "Septmeber", "Ocotber","November", 
> "December")),par.settings=myTheme)
>
> #But this doesn't plot anything. Even the maps disappear. Perhaps this again has to do with the naming in the rasters.
>
> #Anyhow, i would like to match these monthly images with data on spatial observations of animals where i have an x,y and a date matching the date of the raster.
>
> #I tried doing this below -
> df$layer<-lapply(df$month, function(x) which(grepl(tolower(x), 
> tolower(names(year.mon.mean))))) df$meanNDVI<-sapply(seq_len(nrow(df)), function(x) extract(mean.year.mon[[df$layer[x]]], df[x,1:2])) # 1,2 are columns with x and y.
>
> #This also doesn't work, perhaps also has to do with the names in the raster.
>
> Your help is much appreciated.
> Ill keep trying the par.cond argument in the meanwhile.
>
> Best wishes,
>
> Navinder
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
> Navinder J Singh
> Associate Professor
> Department of Wildlife, Fish, and Environmental Studies Faculty of 
> Forest Sciences Swedish University of Agricultural Sciences
> SE-901 83 Umea, Sweden
> O: +46 (0)90 786 8538;
> M: +46 (0)70 676 0103
> email: navinder.singh at slu.se<mailto:navinder.singh at slu.se>
> Web: navinderjsingh.weebly.com<http://navinderjsingh.weebly.com/>
>
> www.slu.se/viltfiskmiljo/navinder_singh<http://www.slu.se/viltfiskmilj
> o/navinder_singh>
> http://slu-se.academia.edu/NSingh
>
>
>
> On 21 Oct 2014, at 08:53, Frede Aakmann T?gersen <frtog at vestas.com<mailto:frtog at vestas.com>> wrote:
>
> Hi
>
> Since no code example was provided we'll have to guess. I suppose it has to do with the way factor() works.
>
> Here is the built-in list of month names in R:
>
>
>
>
> month.name
> [1] "January"   "February"  "March"     "April"     "May"       "June"
> [7] "July"      "August"    "September" "October"   "November"  "December"
>
> Now show this as a factor:
>
>
>
>
> factor(month.name)
> [1] January   February  March     April     May       June      July
> [8] August    September October   November  December
> 12 Levels: April August December February January July June March ... 
> September
>
> See how factor() is using lexicographical order for the labels of the factor levels.
>
> Now do this  instead:
>
>
>
>
> factor(month.name, labels = month.name)
> [1] May       April     August    January   September July      June
> [8] February  December  November  October   March
> 12 Levels: January February March April May June July August ... 
> December
>
> Now the order of the labels of the levels is the same as that of month.name.
>
> Here is an example:
>
> testdata <- data.frame(x = 1, y = 1, Month = factor(month.name))
>
> ### order of panels is that of order(month.name) xyplot(y ~ x|Month, 
> data = testdata)
>
> testdata <- data.frame(x = 1, y = 1, Month = factor(month.name, labels 
> = month.name))
>
> ### order of panels is that of month.name ### January in bottom left 
> and Deccember in top right panel xyplot(y ~ x|Month, data = testdata)
>
> ### use the as.table argument to get January in top left and December 
> in bottom right xyplot(y ~ x|Month, data = testdata, as.table = TRUE)
>
>
> Yours sincerely / Med venlig hilsen
>
>
> Frede Aakmann T?gersen
> Specialist, M.Sc., Ph.D.
> Plant Performance & Modeling
>
> Technology & Service Solutions
> T +45 9730 5135
> M +45 2547 6050
> frtog at vestas.com<mailto:frtog at vestas.com>
> http://www.vestas.com<http://www.vestas.com/>
>
> Company reg. name: Vestas Wind Systems A/S This e-mail is subject to 
> our e-mail disclaimer statement.
> Please refer to 
> www.vestas.com/legal/notice<http://www.vestas.com/legal/notice>
> If you have received this e-mail in error please contact the sender.
>
>
>
>
>
> -----Original Message-----
> From: 
> r-sig-geo-bounces at r-project.org<mailto:r-sig-geo-bounces at r-project.org
> > [mailto:r-sig-geo-bounces at r- 
> project.org<mailto:r-sig-geo-bounces at r-%0bproject.org>] On Behalf Of 
> Oscar Perpi??n Lamigueiro
> Sent: 21. oktober 2014 07:50
> To: Navinder Singh
> Cc: r-sig-geo at r-project.org<mailto:r-sig-geo at r-project.org>
> Subject: Re: [R-sig-Geo] Order raster images in a levelplot
>
> Hi,
>
>
>
>
> 1. Does someone have any suggestions on how i can order the sequence 
> of images in a "levelplot" made using rasterVis.  Specifically, i have 
> months i need to arrange in the normal sequence, as the plot currently 
> aligns them in an alphabetical order. Does "levelplot"
> works the same way as xyplots in lattice?
>
> levelplot methods defined in rasterVis are based on lattice graphics.
> Most of the arguments provided by lattice::xyplot and 
> lattice::levelplot are also available. For this issue you could try 
> these arguments: perm.cond, index.cond, as.table. All of them are 
> described in the help page of lattice::xyplot.
>
>
>
>
> 2. Have there been more developments on the zApply function in the 
> raster package? I am trying to make basic statistical summaries for 
> mean monthly (eg. NDVI values) form a multi annual time series.  How 
> does one go about using the "by" Indexing in this case.
>
> Could you post a reproducible example? I have used zApply for similar 
> tasks without problems.
>
> Best,
>
> Oscar.

--
Oscar Perpi??n Lamigueiro
Dpto. Ingenier?a El?ctrica (ETSIDI-UPM)
Grupo de Sistemas Fotovoltaicos (IES-UPM)
URL: http://oscarperpinan.github.io

From jl.iccp at gmail.com  Wed Oct 22 14:33:57 2014
From: jl.iccp at gmail.com (Jue Lin-Ye)
Date: Wed, 22 Oct 2014 14:33:57 +0200
Subject: [R-sig-Geo] pieSP: pie charts on map
In-Reply-To: <CAAMkPW_d8m=4FV9xEYL6SSbikrNns4UgvKp_qjx+q8Jc+4Gtog@mail.gmail.com>
References: <CAAMkPW9Ftg8yq=bJGogg8i52PmkbqOeWZcCSoP-obOit+Ws1dA@mail.gmail.com>
	<CAAMkPW_d8m=4FV9xEYL6SSbikrNns4UgvKp_qjx+q8Jc+4Gtog@mail.gmail.com>
Message-ID: <CAAMkPW8szOpm+T=T8JE84+XVmWJNBpARzasiU_G7RYR2Fs+Oew@mail.gmail.com>

Dear list members,

I am working on the following code.
https://dl.dropboxusercontent.com/u/61881075/R-geo-help/question_draw_pie.v1.R
https://dl.dropboxusercontent.com/u/61881075/R-geo-help/Question_Tr_1_.H0_2.3m.v8.txt
https://dl.dropboxusercontent.com/u/61881075/R-geo-help/Question_Tr_2_.H0_2.3m.v8.txt
https://dl.dropboxusercontent.com/u/61881075/R-geo-help/Question_wana_coord.3.txt

(this might be erased after solution of problem)


 I am characterizing marine storms. There are four variables: slogE,
sloguE, slogT and slogD.

I would like to do the following

-draw a map for every return period (Tr) and every variable
 - have a pie chart for every WANA node (Here I have two nodes. The node
names are shown on the first column of Data.1.txt)
-Use the same colors for every variable. I mean, for Tr=1 through 50 years,
all the variables increase with return period, but I would like to have the
same colors for the same value ranges, in order to compare the maps. That
is, if return period 1year has slogE within the ranges (0,1] and (1,2] and
return period =2 years has slogE within the ranges (1,2] and (2,3], I would
like to take all (0,1]=blue, (1,2]=green and (2,3]=red and have two slices
of blue-green in Tr=1 year and two slices of green-red in Tr=2 years.

like this

http://alaska.usgs.gov/science/biology/seabirds_foragefish/foragefish/images/beach_seine_comp_pie_charts_sm.gif

I would also like to

-Show a legend on one side.

?Comments:

-I often have problems with zeroes, I would like the code to ignore zeroes
and just not to plot them.?

Please contact me for any doubt.

?Jue Lin-Ye?

	[[alternative HTML version deleted]]


From mathieu.rajerison at gmail.com  Wed Oct 22 17:12:08 2014
From: mathieu.rajerison at gmail.com (Mathieu Rajerison)
Date: Wed, 22 Oct 2014 17:12:08 +0200
Subject: [R-sig-Geo] Kernel Density Estimation with Border Bias Correction
Message-ID: <CAGfc75n6Cj1PL_3giK_Xbe9yYkC494n6BXmAQLUjt-8dY-dSjQ@mail.gmail.com>

Hello,

Some people here might be interested by this :
https://github.com/ripleyCorr/Kernel_density_ripley

"This page proposes some R codes to compute the kernel density estimates of
two-dimensional data points, using an extension of Ripley's circumference
method to correct for border bias"

Best regards,

Mathieu

	[[alternative HTML version deleted]]


From jgrn at illinois.edu  Wed Oct 22 17:33:12 2014
From: jgrn at illinois.edu (Jonathan Greenberg)
Date: Wed, 22 Oct 2014 10:33:12 -0500
Subject: [R-sig-Geo] subdatasets in rgdal/raster
In-Reply-To: <CAAcGz9_-uVfZpPceNUC=NPRi1b1rB5e5jrtbkhD4LJ9mXyQ=0g@mail.gmail.com>
References: <CAAcGz980P1Zp+u9VCYzXGWZdzD=aiNkQZNsNgGJcViFPFxUn5g@mail.gmail.com>
	<alpine.LRH.2.03.1410150838400.4732@reclus.nhh.no>
	<CAAcGz99CFT-yxHDax+SnPP1WBavpdCTBbZcvbBP3VENmxNAmeg@mail.gmail.com>
	<CABG0rfsWFrGry-2QtZVs0KJj8Ysk1GyiU2=-LW=HwtSMoBrjzg@mail.gmail.com>
	<CAAcGz9_-uVfZpPceNUC=NPRi1b1rB5e5jrtbkhD4LJ9mXyQ=0g@mail.gmail.com>
Message-ID: <CABG0rfuZC8xbM9vW+76T=P_Wnd_LdVjqpLqTL1n24a92FpDe7Q@mail.gmail.com>

I think Roger has mentioned a few times over the years his reticence
to build in the HDF4 drivers into the Windows gdal binary (Roger,
perhaps you can discuss why this is a problem)-- I actually built
gdalUtils for this exact purpose -- the need to access MODIS and
Landsat HDFs in Windows.

One thing that may be worth considering is if Roger is open to it is
having someone work to get the Windows binaries that come along with
rgdal so they support a wider range of formats (specifically getting
HDF4 and 5 and NetCDF functional)?  Others have already solved this
satisfactorily (osgeo4w has all of the key formats supported, for
instance), so it should be doable.

Also, to respond to your question about why have gdalUtils at all -- I
don't think every function that the base gdal utilities is available
in rgdal (correct me if I'm wrong), so I wanted a way to bring them to
R users in a (relatively) easy to use fashion -- I've seen gdalUtills
as a complementary package to rgdal.

--j

On Tue, Oct 21, 2014 at 2:17 AM, Michael Sumner <mdsumner at gmail.com> wrote:
> I have, and it's good but it's not what I am after here.
>
> I really want access to HDF4 via tight-coupling. It does work well in
> R when you build GDAL right, especially with raster over the top to
> clean everything up. If you can compile those drivers into GDAL it
> does beg the question why have a wrapper like gdalUtils. (My take on
> this is that Windows-support stops at the CRAN binary, and again this
> is why raster has its own NetCDF wrapper).
>
> Ultimately the logic for these rogue files belongs in GDAL and
> rgdal/raster should just reflect that: rgdal2 is essentially that, but
> doesn't offer much more and it's not clear how to "rasterize"
> everything again.
>
> :)
>
>
>
> On Thu, Oct 16, 2014 at 2:27 AM, Jonathan Greenberg <jgrn at illinois.edu> wrote:
>> Mike:
>>
>> Have you taken a look at gdalUtils?  This is a wrapper for all the
>> GDAL binaries (I am still working on adding in all those new tools
>> that were recently released with version 1.11.1, but it should be up
>> to date as of v 1.10.1).  gdalinfo that is part of gdalUtils gives you
>> the full info dump (more, if less clean, output than rgdal's gdalInfo
>> will give you), which you could parse for the info you wanted.  I also
>> have a custom function "get_subdatasets" which sounds a lot like what
>> you are describing.
>>
>> Give it a shot!  You will need to install GDAL yourself first -- check
>> the help for suggestions on which flavor of GDAL I recommend.
>>
>> --j
>>
>> On Wed, Oct 15, 2014 at 6:23 AM, Michael Sumner <mdsumner at gmail.com> wrote:
>>> Thanks Roger, I'm still hoping to be able to code at this level one day.
>>>
>>> I have gone off half-cocked, confusing things. I can get SDS from
>>> NetCDF and HDF files with GDALinfo() with no problems - I just had to
>>> turn off returnScaleOffset, which I think has a confounding of nbands
>>> and subdatasets - since a datasource with SDS has no bands, but I need
>>> to explore this more to be sure.
>>>
>>> Cheers, Mike.
>>>
>>>
>>>
>>>
>>>
>>> On Wed, Oct 15, 2014 at 5:50 PM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
>>>> On Wed, 15 Oct 2014, Michael Sumner wrote:
>>>>
>>>>> Hello,
>>>>>
>>>>> As far as I know there's nothing in rgdal to determine existing
>>>>> subdatasets (SDS) in HDF (or NetCDF for that matter).
>>>>>
>>>>> In raster, raster(x) will read from the first candidate *variable*,
>>>>> and list the others with a warning, which is analogous to an SDS but
>>>>> of course it's always providing this via ncdf/ncdf4 rather than via
>>>>> rgdal.
>>>>>
>>>>> Is it true there's no way to find out SDS from HDF or NetCDF in rgdal?
>>>>
>>>>
>>>> Because these formats are poorly organised (an XML tree describing the
>>>> internal structure would be easy to parse, but self-descriptive metadata
>>>> isn't usual here), GDALinfo() does not provide much.
>>>>
>>>> If you start by identifying the incantation used by command line gdalinfo to
>>>> report the SDS metadata, then look at its source code, it should be possible
>>>> to make some progress. I don't use either if I can help it, and do not have
>>>> the necessary trial set of sample files. You'd need to find a robust route
>>>> covering a wide range of files seen in the wild to allow for oddities in the
>>>> ways things are organised. It is unfortunate to have to branch code on the
>>>> selected driver, but here it is hard to avoid. Once GDALinfo is reporting
>>>> the metadata in a predictable way, the other functions can be given
>>>> appropriate argument values.
>>>>
>>>> Also consider looking at this from the point of view of rgdal2 in addition
>>>> to rgdal; it could possibly be "closer" there and looking at both may make
>>>> it easier to spot:
>>>>
>>>> https://github.com/thk686/rgdal2
>>>>
>>>> Contributions welcome!
>>>>
>>>> Roger
>>>>
>>>>
>>>>>
>>>>> I've not really explored this before much since compiling HDF was
>>>>> unavailable to me. gdalUtils fills a gap but only by running the
>>>>> installed command line tools, which obviously can be avoided with the
>>>>> right features in rgdal/raster. I personally have always run the
>>>>> command line tools and then jumped back to R (if I could).
>>>>>
>>>>> (The vector analogy in rgdal to listing SDS would be ogrListLayers).
>>>>>
>>>>> This is a missing capability in the raster package, somewhat disguised
>>>>> because of the independent support for NetCDF. I guess hardly anyone
>>>>> is using HDF? That's a shame since these R tools really help.  It's a
>>>>> pretty complicated story all round and I keep re/discovering
>>>>> interesting corners. If anyone is writing anything significant about
>>>>> all this I'd be keen to be involved.
>>>>>
>>>>> Cheers, Mike.
>>>>>
>>>>>
>>>>
>>>> --
>>>> Roger Bivand
>>>> Department of Economics, Norwegian School of Economics,
>>>> Helleveien 30, N-5045 Bergen, Norway.
>>>> voice: +47 55 95 93 55; fax +47 55 95 91 00
>>>> e-mail: Roger.Bivand at nhh.no
>>>>
>>>
>>>
>>>
>>> --
>>> Michael Sumner
>>> Software and Database Engineer
>>> Australian Antarctic Division
>>> Hobart, Australia
>>> e-mail: mdsumner at gmail.com
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>
>>
>> --
>> Jonathan A. Greenberg, PhD
>> Assistant Professor
>> Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
>> Department of Geography and Geographic Information Science
>> University of Illinois at Urbana-Champaign
>> 259 Computing Applications Building, MC-150
>> 605 East Springfield Avenue
>> Champaign, IL  61820-6371
>> Phone: 217-300-1924
>> http://www.geog.illinois.edu/~jgrn/
>> AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007
>
>
>
> --
> Michael Sumner
> Software and Database Engineer
> Australian Antarctic Division
> Hobart, Australia
> e-mail: mdsumner at gmail.com



-- 
Jonathan A. Greenberg, PhD
Assistant Professor
Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
Department of Geography and Geographic Information Science
University of Illinois at Urbana-Champaign
259 Computing Applications Building, MC-150
605 East Springfield Avenue
Champaign, IL  61820-6371
Phone: 217-300-1924
http://www.geog.illinois.edu/~jgrn/
AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007


From corderos at umich.edu  Wed Oct 22 20:01:18 2014
From: corderos at umich.edu (Silvia Cordero-Sancho)
Date: Wed, 22 Oct 2014 14:01:18 -0400
Subject: [R-sig-Geo] Kest (spatstat) and "r" values
Message-ID: <CAORmci_N0CYTFrD3HdNMeeTBi_wBH=TEN_MshfhWnZifpqW6mw@mail.gmail.com>

Hello,

I am employing the Ripley's K function to evaluate my data and have some
concerns regarding the maximum distance reported.

My data was collected in 7 different sites. At each site we recorded the
location x-y of the events. The 7 sites were had *"similar conditions"
*but their
extent vary, and in addition, not all sites presented the same number of
events (number of events per site vary from 92 to up to 400 ).

Each site was evaluated independently, meaning that Site-1 had their on set
of events and own window of observation (W). I used the *ripras* function
to define *W, *(for all sites, W is an irregular shaped window).

I have run two first order exploratory  tools
(quadrat.test, clarkevans.test). The overall results is that my
observations are not random and show aggregation tendencies for all sites.


I applied the function* Kest* to all my seven sites to explore the second
order properties, I did not provide a *r* value (as recommended in the help
section) and here is the "curious" outcome. Indifferently of the area of W
or the number  of events per site, the maximum r-values reported for all
sites is very similar (between 5000 m to  6140 m). I am trying to
understand the reason behind these results. Is this an overall
characteristic of my pattern OR is a result of the algorithm that spatstat
employs to define r (e.g. it has a maximum threshold)

Here my code:

K2<-Kest(site2,correction="best"); where site2 is mydata
max(K2$r) = 5,260 m

Here the maximum distance values (in meters) for the other sites

max(K1$r) = 6,140
max(K3$r) = 5,148
max(K4$r) = 5,016
max(K5$r) = 5,194
max(K6$r) = 5,055
max(K3$r) = 5,317

PS: I used the extent of the observation window for site 2 to create a
random set of x-y locations (n=182, same than the observed number of events
in this site). I run the test and the maximum distance was the same (5,260
m)

I cannot find information how r is defined in the function Kest

If any one any comment I will appreciate

Thank you!

Silvia Cordero-Sancho

	[[alternative HTML version deleted]]


From marcelino.delacruz at upm.es  Wed Oct 22 21:59:28 2014
From: marcelino.delacruz at upm.es (Marcelino de la Cruz)
Date: Wed, 22 Oct 2014 21:59:28 +0200
Subject: [R-sig-Geo] Kest (spatstat) and "r" values
In-Reply-To: <CAORmci_N0CYTFrD3HdNMeeTBi_wBH=TEN_MshfhWnZifpqW6mw@mail.gmail.com>
References: <CAORmci_N0CYTFrD3HdNMeeTBi_wBH=TEN_MshfhWnZifpqW6mw@mail.gmail.com>
Message-ID: <54480CA0.6080401@upm.es>

Maybe the information related to r you are looking for is in the Warning 
section:

"Warnings

The estimator of K(r) is approximately unbiased for each fixed r. Bias 
increases with r and depends on the window geometry. For a rectangular 
window it is prudent to restrict the r values to a maximum of 1/4 of the 
smaller side length of the rectangle".

Maybe I'm wrong but I think that  Kest computest K(r) by default for r 
up to 1/4 of the shorter side of the *enclosing rectangle* of your window.

HTH,

Marcelino



El 22/10/2014 a las 20:01, Silvia Cordero-Sancho escribi?:
> Hello,
>
> I am employing the Ripley's K function to evaluate my data and have some
> concerns regarding the maximum distance reported.
>
> My data was collected in 7 different sites. At each site we recorded the
> location x-y of the events. The 7 sites were had *"similar conditions"
> *but their
> extent vary, and in addition, not all sites presented the same number of
> events (number of events per site vary from 92 to up to 400 ).
>
> Each site was evaluated independently, meaning that Site-1 had their on set
> of events and own window of observation (W). I used the *ripras* function
> to define *W, *(for all sites, W is an irregular shaped window).
>
> I have run two first order exploratory  tools
> (quadrat.test, clarkevans.test). The overall results is that my
> observations are not random and show aggregation tendencies for all sites.
>
>
> I applied the function* Kest* to all my seven sites to explore the second
> order properties, I did not provide a *r* value (as recommended in the help
> section) and here is the "curious" outcome. Indifferently of the area of W
> or the number  of events per site, the maximum r-values reported for all
> sites is very similar (between 5000 m to  6140 m). I am trying to
> understand the reason behind these results. Is this an overall
> characteristic of my pattern OR is a result of the algorithm that spatstat
> employs to define r (e.g. it has a maximum threshold)
>
> Here my code:
>
> K2<-Kest(site2,correction="best"); where site2 is mydata
> max(K2$r) = 5,260 m
>
> Here the maximum distance values (in meters) for the other sites
>
> max(K1$r) = 6,140
> max(K3$r) = 5,148
> max(K4$r) = 5,016
> max(K5$r) = 5,194
> max(K6$r) = 5,055
> max(K3$r) = 5,317
>
> PS: I used the extent of the observation window for site 2 to create a
> random set of x-y locations (n=182, same than the observed number of events
> in this site). I run the test and the maximum distance was the same (5,260
> m)
>
> I cannot find information how r is defined in the function Kest
>
> If any one any comment I will appreciate
>
> Thank you!
>
> Silvia Cordero-Sancho
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>


From jecogeo at gmail.com  Wed Oct 22 22:29:40 2014
From: jecogeo at gmail.com (Jefferson Ferreira-Ferreira)
Date: Wed, 22 Oct 2014 17:29:40 -0300
Subject: [R-sig-Geo] Loading Rasters in Revolution R
Message-ID: <CAFFT+Y5Y+UayEU-5r4FgX_aKE+vLKR9TGcybiaXr0LYVAkhqGg@mail.gmail.com>

Hi all,

I'm wondering how to load rasters as xdf files using rxImport. I have a big
raster with 9 layers/bands and I need to do perform a logistic regression
for each pixel throughout bands. So It's a huge processing, and why I'm
testing Revolution R Enterprise.
However I don't know how to import as xdf files to perform parallel
processing inside it. Almost blogs and tutorials deals with ordinary csv
files.

Could anybody give me any guidance?

Regards


-- 

*Jefferson Ferreira-Ferreira*

Ge?grafo ? GEOPROCESSAMENTO IDSM | Coordenadoria de TI


Jefferson.ferreira at mamiraua.org.br

*Instituto de Desenvolvimento Sustent?vel Mamirau?*

Minist?rio da Ci?ncia, Tecnologia e Inova??o

Telefone: +55 97 3343-9710

*Google Maps* - Mapas deste e-mail:

Exibir mapa ampliado
<https://maps.google.com.br/maps?q=-3.355557,-64.731151&ll=-3.355471,-64.731145&spn=0.004632,0.006968&num=1&t=h&z=18>


*Contatos particulares:*
*(55) 9615-0100*

	[[alternative HTML version deleted]]


From Navinder.Singh at slu.se  Wed Oct 22 23:57:23 2014
From: Navinder.Singh at slu.se (Navinder Singh)
Date: Wed, 22 Oct 2014 21:57:23 +0000
Subject: [R-sig-Geo] Overlaying time designated spatial points from a data
 frame to match the time of a raster image in a rasterStack
Message-ID: <C580CF2D-39B3-489E-9824-9B65DB882A5E@slu.se>

Hi,

I have a level plot with a number of rasters (monthly rasters for a year- generated with kind help from Oscar). Basically a raster stack.

I would like to overlay spatial points on this raster stack, but would like to overlay only those points that belong to the month matching the raster stack. For e.g. The points form January should fall on the raster from January, those from february should fall on February raster as so on. I am drowning in the ?lattice' literature but have not succeeded till now.

I am running the following code but not sure how to assign an index which can delegate the points from respective months to their rasters in the layer + sp. points argument from rasterVis package.

My data frame has the following columns:
df= X, Y, date (POSIXct), month (month.abb), id (animalID), SITE (a factor with origin area)

The rasters also have names in the format of month.abb.

And the code i am using is:

rrMean is a raster stack of monthly means. dfSp is a SpatialPointDataFrame with above fields.

p<-levelplot(rrMean, main="Mean Monthly NDVI (2010-2014)", par.settings=myTheme)
p+layer(sp.points(dfSp,col=dfSp$SITE))

# I understand that col argument just changes the colours but still plots all points on all rasters, but i guess i need something specified
in sp.points(dfSp,col=dfSp$SITE).

Thanks for any suggestions.

Best wishes,

Navinder
email: navinder.singh at slu.se<mailto:navinder.singh at slu.se>





	[[alternative HTML version deleted]]


From istazahn at gmail.com  Thu Oct 23 01:59:42 2014
From: istazahn at gmail.com (Ista Zahn)
Date: Wed, 22 Oct 2014 19:59:42 -0400
Subject: [R-sig-Geo] Loading Rasters in Revolution R
In-Reply-To: <CAFFT+Y5Y+UayEU-5r4FgX_aKE+vLKR9TGcybiaXr0LYVAkhqGg@mail.gmail.com>
References: <CAFFT+Y5Y+UayEU-5r4FgX_aKE+vLKR9TGcybiaXr0LYVAkhqGg@mail.gmail.com>
Message-ID: <CA+vqiLExpSVmBPfAEz0sLu6+ux2vZ=GFf4qPLpScOme0pvtyuw@mail.gmail.com>

Sounds like a question for Revolution...

Best,
Ista

On Wed, Oct 22, 2014 at 4:29 PM, Jefferson Ferreira-Ferreira
<jecogeo at gmail.com> wrote:
> Hi all,
>
> I'm wondering how to load rasters as xdf files using rxImport. I have a big
> raster with 9 layers/bands and I need to do perform a logistic regression
> for each pixel throughout bands. So It's a huge processing, and why I'm
> testing Revolution R Enterprise.
> However I don't know how to import as xdf files to perform parallel
> processing inside it. Almost blogs and tutorials deals with ordinary csv
> files.
>
> Could anybody give me any guidance?
>
> Regards
>
>
> --
>
> *Jefferson Ferreira-Ferreira*
>
> Ge?grafo ? GEOPROCESSAMENTO IDSM | Coordenadoria de TI
>
>
> Jefferson.ferreira at mamiraua.org.br
>
> *Instituto de Desenvolvimento Sustent?vel Mamirau?*
>
> Minist?rio da Ci?ncia, Tecnologia e Inova??o
>
> Telefone: +55 97 3343-9710
>
> *Google Maps* - Mapas deste e-mail:
>
> Exibir mapa ampliado
> <https://maps.google.com.br/maps?q=-3.355557,-64.731151&ll=-3.355471,-64.731145&spn=0.004632,0.006968&num=1&t=h&z=18>
>
>
> *Contatos particulares:*
> *(55) 9615-0100*
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From r.turner at auckland.ac.nz  Thu Oct 23 03:07:14 2014
From: r.turner at auckland.ac.nz (Rolf Turner)
Date: Thu, 23 Oct 2014 14:07:14 +1300
Subject: [R-sig-Geo] Kest (spatstat) and "r" values
In-Reply-To: <54480CA0.6080401@upm.es>
References: <CAORmci_N0CYTFrD3HdNMeeTBi_wBH=TEN_MshfhWnZifpqW6mw@mail.gmail.com>
	<54480CA0.6080401@upm.es>
Message-ID: <544854C2.6090707@auckland.ac.nz>

On 23/10/14 08:59, Marcelino de la Cruz wrote:
> Maybe the information related to r you are looking for is in the Warning
> section:
>
> "Warnings
>
> The estimator of K(r) is approximately unbiased for each fixed r. Bias
> increases with r and depends on the window geometry. For a rectangular
> window it is prudent to restrict the r values to a maximum of 1/4 of the
> smaller side length of the rectangle".
>
> Maybe I'm wrong but I think that  Kest computest K(r) by default for r
> up to 1/4 of the shorter side of the *enclosing rectangle* of your window.

That is indeed correct, modulo a possible adjustment (which I believe 
rarely gets applied in practice) in terms of the estimated intensity of
the process.  See the code for rmax.rule() if you are interested in the 
details.

cheers,

Rolf

-- 
Rolf Turner
Technical Editor ANZJS


From frtog at vestas.com  Thu Oct 23 08:18:37 2014
From: frtog at vestas.com (=?utf-8?B?RnJlZGUgQWFrbWFubiBUw7hnZXJzZW4=?=)
Date: Thu, 23 Oct 2014 08:18:37 +0200
Subject: [R-sig-Geo] Overlaying time designated spatial points from a
 data frame to match the time of a raster image in a rasterStack
In-Reply-To: <C580CF2D-39B3-489E-9824-9B65DB882A5E@slu.se>
References: <C580CF2D-39B3-489E-9824-9B65DB882A5E@slu.se>
Message-ID: <B078CDF40DFE4045AF172A8B4F68FC4857C9660402@DKRDSEXC016.vestas.net>

Hi

Is it something like this you want to have?


library(raster)
library(latticeExtra)

f <- system.file("external/test.grd", package="raster")

d <- seq(as.Date("2010-01-01"),as.Date("2014-08-01"),by="month")

rr <- stack(rep(f,length(d)))
names(rr) <- d

rr <- setZ(rr, d, name = 'Month')

rr.mean <- zApply(rr, by = function(x)format(x, '%m'), fun = mean, name = "Month")
names(rr.mean) <- month.abb

### For each date sample 10 points from the rasterbrick
pdat <- NULL
for (i in 1:length(d)){
    cells <- sample(1:ncell(rr[[1]]), 10)
    xy <- xyFromCell(rr, cells)
    tmp <- data.frame(x = xy[,"x"], y = xy[, "y"], Month = format(d[i], '%m'), CellId = cells)
    pdat <- rbind(pdat, tmp)
}

levelplot(rr.mean) + xyplot(y ~ x|Month, data = pdat, pch = 13, col = "black")

Yours sincerely / Med venlig hilsen


Frede Aakmann T?gersen
Specialist, M.Sc., Ph.D.
Plant Performance & Modeling

Technology & Service Solutions
T +45 9730 5135
M +45 2547 6050
frtog at vestas.com
http://www.vestas.com

Company reg. name: Vestas Wind Systems A/S
This e-mail is subject to our e-mail disclaimer statement.
Please refer to www.vestas.com/legal/notice
If you have received this e-mail in error please contact the sender. 


> -----Original Message-----
> From: r-sig-geo-bounces at r-project.org [mailto:r-sig-geo-bounces at r-
> project.org] On Behalf Of Navinder Singh
> Sent: 22. oktober 2014 23:57
> To: r-sig-geo at r-project.org
> Cc: oscar.perpinan at upm.es
> Subject: [R-sig-Geo] Overlaying time designated spatial points from a data
> frame to match the time of a raster image in a rasterStack
> 
> Hi,
> 
> I have a level plot with a number of rasters (monthly rasters for a year-
> generated with kind help from Oscar). Basically a raster stack.
> 
> I would like to overlay spatial points on this raster stack, but would like to
> overlay only those points that belong to the month matching the raster stack.
> For e.g. The points form January should fall on the raster from January, those
> from february should fall on February raster as so on. I am drowning in the
> ?lattice' literature but have not succeeded till now.
> 
> I am running the following code but not sure how to assign an index which
> can delegate the points from respective months to their rasters in the layer +
> sp. points argument from rasterVis package.
> 
> My data frame has the following columns:
> df= X, Y, date (POSIXct), month (month.abb), id (animalID), SITE (a factor
> with origin area)
> 
> The rasters also have names in the format of month.abb.
> 
> And the code i am using is:
> 
> rrMean is a raster stack of monthly means. dfSp is a SpatialPointDataFrame
> with above fields.
> 
> p<-levelplot(rrMean, main="Mean Monthly NDVI (2010-2014)",
> par.settings=myTheme)
> p+layer(sp.points(dfSp,col=dfSp$SITE))
> 
> # I understand that col argument just changes the colours but still plots all
> points on all rasters, but i guess i need something specified
> in sp.points(dfSp,col=dfSp$SITE).
> 
> Thanks for any suggestions.
> 
> Best wishes,
> 
> Navinder
> email: navinder.singh at slu.se<mailto:navinder.singh at slu.se>
> 
> 
> 
> 
> 
> 	[[alternative HTML version deleted]]


From Navinder.Singh at slu.se  Thu Oct 23 08:52:30 2014
From: Navinder.Singh at slu.se (Navinder Singh)
Date: Thu, 23 Oct 2014 06:52:30 +0000
Subject: [R-sig-Geo] Overlaying time designated spatial points from a
 data frame to match the time of a raster image in a rasterStack
In-Reply-To: <B078CDF40DFE4045AF172A8B4F68FC4857C9660402@DKRDSEXC016.vestas.net>
References: <C580CF2D-39B3-489E-9824-9B65DB882A5E@slu.se>
	<B078CDF40DFE4045AF172A8B4F68FC4857C9660402@DKRDSEXC016.vestas.net>
Message-ID: <87ED5E8F-0FC5-465F-8644-64569BE42CE0@slu.se>

Works great Frede. Didn?t think that xyplot could just be overlaid like this on a raster stack. Got carried away by the example Oscar has in the rasterVis tutorial, where "sp. points" is used within a layer.
Thanks a lot.
Best wishes,
Navinder





Navinder J Singh
Associate Professor
Department of Wildlife, Fish, and Environmental Studies
Faculty of Forest Sciences
Swedish University of Agricultural Sciences
SE-901 83 Umea, Sweden
O: +46 (0)90 786 8538;
M: +46 (0)70 676 0103
email: navinder.singh at slu.se<mailto:navinder.singh at slu.se>
Web: navinderjsingh.weebly.com<http://navinderjsingh.weebly.com/>

www.slu.se/viltfiskmiljo/navinder_singh<http://www.slu.se/viltfiskmiljo/navinder_singh>
http://slu-se.academia.edu/NSingh




On 23 Oct 2014, at 08:18, Frede Aakmann T?gersen <frtog at vestas.com<mailto:frtog at vestas.com>> wrote:

Hi

Is it something like this you want to have?


library(raster)
library(latticeExtra)

f <- system.file("external/test.grd", package="raster")

d <- seq(as.Date("2010-01-01"),as.Date("2014-08-01"),by="month")

rr <- stack(rep(f,length(d)))
names(rr) <- d

rr <- setZ(rr, d, name = 'Month')

rr.mean <- zApply(rr, by = function(x)format(x, '%m'), fun = mean, name = "Month")
names(rr.mean) <- month.abb

### For each date sample 10 points from the rasterbrick
pdat <- NULL
for (i in 1:length(d)){
   cells <- sample(1:ncell(rr[[1]]), 10)
   xy <- xyFromCell(rr, cells)
   tmp <- data.frame(x = xy[,"x"], y = xy[, "y"], Month = format(d[i], '%m'), CellId = cells)
   pdat <- rbind(pdat, tmp)
}

levelplot(rr.mean) + xyplot(y ~ x|Month, data = pdat, pch = 13, col = "black")

Yours sincerely / Med venlig hilsen


Frede Aakmann T?gersen
Specialist, M.Sc., Ph.D.
Plant Performance & Modeling

Technology & Service Solutions
T +45 9730 5135
M +45 2547 6050
frtog at vestas.com<mailto:frtog at vestas.com>
http://www.vestas.com<http://www.vestas.com/>

Company reg. name: Vestas Wind Systems A/S
This e-mail is subject to our e-mail disclaimer statement.
Please refer to www.vestas.com/legal/notice<http://www.vestas.com/legal/notice>
If you have received this e-mail in error please contact the sender.


-----Original Message-----
From: r-sig-geo-bounces at r-project.org<mailto:r-sig-geo-bounces at r-project.org> [mailto:r-sig-geo-bounces at r-
project.org<http://project.org/>] On Behalf Of Navinder Singh
Sent: 22. oktober 2014 23:57
To: r-sig-geo at r-project.org<mailto:r-sig-geo at r-project.org>
Cc: oscar.perpinan at upm.es<mailto:oscar.perpinan at upm.es>
Subject: [R-sig-Geo] Overlaying time designated spatial points from a data
frame to match the time of a raster image in a rasterStack

Hi,

I have a level plot with a number of rasters (monthly rasters for a year-
generated with kind help from Oscar). Basically a raster stack.

I would like to overlay spatial points on this raster stack, but would like to
overlay only those points that belong to the month matching the raster stack.
For e.g. The points form January should fall on the raster from January, those
from february should fall on February raster as so on. I am drowning in the
?lattice' literature but have not succeeded till now.

I am running the following code but not sure how to assign an index which
can delegate the points from respective months to their rasters in the layer +
sp. points argument from rasterVis package.

My data frame has the following columns:
df= X, Y, date (POSIXct), month (month.abb), id (animalID), SITE (a factor
with origin area)

The rasters also have names in the format of month.abb.

And the code i am using is:

rrMean is a raster stack of monthly means. dfSp is a SpatialPointDataFrame
with above fields.

p<-levelplot(rrMean, main="Mean Monthly NDVI (2010-2014)",
par.settings=myTheme)
p+layer(sp.points(dfSp,col=dfSp$SITE))

# I understand that col argument just changes the colours but still plots all
points on all rasters, but i guess i need something specified
in sp.points(dfSp,col=dfSp$SITE).

Thanks for any suggestions.

Best wishes,

Navinder
email: navinder.singh at slu.se<mailto:navinder.singh at slu.se><mailto:navinder.singh at slu.se>





[[alternative HTML version deleted]]


	[[alternative HTML version deleted]]


From oscar.perpinan at upm.es  Thu Oct 23 10:47:12 2014
From: oscar.perpinan at upm.es (Oscar =?utf-8?B?UGVycGnDscOhbg==?= Lamigueiro)
Date: Thu, 23 Oct 2014 10:47:12 +0200
Subject: [R-sig-Geo] Overlaying time designated spatial points from a
	data frame to match the time of a raster image in a rasterStack
In-Reply-To: <87ED5E8F-0FC5-465F-8644-64569BE42CE0@slu.se>
References: <C580CF2D-39B3-489E-9824-9B65DB882A5E@slu.se>
	<B078CDF40DFE4045AF172A8B4F68FC4857C9660402@DKRDSEXC016.vestas.net>
	<87ED5E8F-0FC5-465F-8644-64569BE42CE0@slu.se>
Message-ID: <87r3xzw4lk.fsf@OPL-EUITI.upm.es>

Hi,

> Works great Frede. Didn?t think that xyplot could just be overlaid
> like this on a raster stack. Got carried away by the example Oscar has
> in the rasterVis tutorial, where "sp. points" is used within a layer.

With the latticeExtra::+.trellis function you can overlay trellis
objects. You have to use the latticeExtra::layer function if you need a
function that don't produce a complete trellis object such as panel.text
or sp.points.

Yet another way to get what Frede posted. Here I am using sampleRandom
to sample the RasterStack and get a list of SpatialPointsDataFrame. With
latticeExtra::xyplot.list and sp::spplot you print this list.

sPoints <- lapply(1:12, FUN = function(i) sampleRandom(rr.mean[[i]],
                            size = 10, sp = TRUE))

levelplot(rr.mean) + xyplot.list(sPoints, FUN = spplot, pch = 13, col.regions = 'black')

Best,

Oscar.
-- 
Oscar Perpi??n Lamigueiro
Dpto. Ingenier?a El?ctrica (ETSIDI-UPM)
Grupo de Sistemas Fotovoltaicos (IES-UPM)
URL: http://oscarperpinan.github.io


From alessandracarioli at gmail.com  Thu Oct 23 12:48:11 2014
From: alessandracarioli at gmail.com (Alessandra Carioli)
Date: Thu, 23 Oct 2014 12:48:11 +0200
Subject: [R-sig-Geo] distance between centroids
In-Reply-To: <mailman.13.1414058404.29667.r-sig-geo@r-project.org>
References: <mailman.13.1414058404.29667.r-sig-geo@r-project.org>
Message-ID: <6A309390-CD1B-4DAE-A4BC-46AF11746AF1@gmail.com>

Dear all,

I am trying to compute the average distance between centroids and between neighbors, starting from a spatial polygon shape file.
What I am doing is compute the average distance between all centroids and compute the average distance between neighbors for different regions in order to better compare them. (Some are densely populated and have more centroids, others are the opposite).
Does anyone have any ideas? I am sure it should be pretty simple.

So far I have used dist but does not give me what I want.

Bests,

Ale
	[[alternative HTML version deleted]]


From ajdamico at gmail.com  Thu Oct 23 15:01:02 2014
From: ajdamico at gmail.com (Anthony Damico)
Date: Thu, 23 Oct 2014 09:01:02 -0400
Subject: [R-sig-Geo] fattening certain portions of a city map in R with
	using projections
Message-ID: <CAOwvMDwm=1PjCXChQyBcZ7WuKvpvsKz__nJ5qPCumjSJCMriug@mail.gmail.com>

hi, i'm trying to map new york city and wondering if it's possible to pick
a projection that will have an effect that brings the map a bit closer to
the shapes seen in the nyc mta subway map  (
http://i.stack.imgur.com/YT50F.jpg).

the bonne and azimuthal projections on this page (
https://en.wikipedia.org/wiki/List_of_map_projections) really appear to
inflate africa the same way that i would like to inflate either manhattan
or perhaps manhattan + brooklyn.


i've posted reproducible code and some example images here--

http://stackoverflow.com/questions/26493524/what-projections-in-r-will-fatten-a-city-map


i understand what i'm trying to do could be accomplished as a cartogram,
but i'm curious if - since i don't really care about population- or
count-based weighting - a smart projection selection might save me a lot of
time.

thank you!!

	[[alternative HTML version deleted]]


From mspinola10 at gmail.com  Thu Oct 23 16:10:12 2014
From: mspinola10 at gmail.com (=?UTF-8?Q?Manuel_Sp=C3=ADnola?=)
Date: Thu, 23 Oct 2014 08:10:12 -0600
Subject: [R-sig-Geo] How to segment or split a spatial line in R
Message-ID: <CABkCotR_vPeu0DbJu9fdqQrvpCCgW2+StPeyD9BZJzGYxnRorw@mail.gmail.com>

Dear list members,

How to segment or split a spatial line in shorter equal segments, and also,
how to get the mid point of ecah segment.

Best,

Manuel

-- 
*Manuel Sp?nola, Ph.D.*
Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
Universidad Nacional
Apartado 1350-3000
Heredia
COSTA RICA
mspinola at una.ac.cr
mspinola10 at gmail.com
Tel?fono: (506) 2277-3598
Fax: (506) 2237-7036
Personal website: Lobito de r?o <https://sites.google.com/site/lobitoderio/>
Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>

	[[alternative HTML version deleted]]


From mathieu.rajerison at gmail.com  Thu Oct 23 16:48:19 2014
From: mathieu.rajerison at gmail.com (Mathieu Rajerison)
Date: Thu, 23 Oct 2014 16:48:19 +0200
Subject: [R-sig-Geo] How to segment or split a spatial line in R
In-Reply-To: <CABkCotR_vPeu0DbJu9fdqQrvpCCgW2+StPeyD9BZJzGYxnRorw@mail.gmail.com>
References: <CABkCotR_vPeu0DbJu9fdqQrvpCCgW2+StPeyD9BZJzGYxnRorw@mail.gmail.com>
Message-ID: <CAGfc75=g5H0h9ucdTF2hCc0NDeqJZ5ehs_fFhnE+yxgBwkeJ5A@mail.gmail.com>

Hi,

With spatstat, you can find the mid point of line segments
http://lojze.lugos.si/~darja/software/r/library/spatstat/html/midpoints.psp.html

But I don't know any package that would split your line into equal segments.

One method would be to arrange equally spaced points along your line with
spatstat::pointsOnLinesthen reconstruct lines from these points.

There may be a better method than mine...

2014-10-23 16:10 GMT+02:00 Manuel Sp?nola <mspinola10 at gmail.com>:

> Dear list members,
>
> How to segment or split a spatial line in shorter equal segments, and also,
> how to get the mid point of ecah segment.
>
> Best,
>
> Manuel
>
> --
> *Manuel Sp?nola, Ph.D.*
> Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
> Universidad Nacional
> Apartado 1350-3000
> Heredia
> COSTA RICA
> mspinola at una.ac.cr
> mspinola10 at gmail.com
> Tel?fono: (506) 2277-3598
> Fax: (506) 2237-7036
> Personal website: Lobito de r?o <
> https://sites.google.com/site/lobitoderio/>
> Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From basille.web at ase-research.org  Thu Oct 23 17:21:17 2014
From: basille.web at ase-research.org (Mathieu Basille)
Date: Thu, 23 Oct 2014 11:21:17 -0400
Subject: [R-sig-Geo] How to segment or split a spatial line in R
In-Reply-To: <CABkCotR_vPeu0DbJu9fdqQrvpCCgW2+StPeyD9BZJzGYxnRorw@mail.gmail.com>
References: <CABkCotR_vPeu0DbJu9fdqQrvpCCgW2+StPeyD9BZJzGYxnRorw@mail.gmail.com>
Message-ID: <54491CED.7040807@ase-research.org>

May be a little bit far fetched, but maybe check 'redisltraj' from the 
adehabitatLT package (and section 4.2.2 of the vignette [1]). Note that it 
was intended for animal trajectories so might be a little bit out of scope 
for you.

Mathieu.


[1] 
http://cran.r-project.org/web/packages/adehabitatLT/vignettes/adehabitatLT.pdf

Le 23/10/2014 10:10, Manuel Sp?nola a ?crit :
> Dear list members,
>
> How to segment or split a spatial line in shorter equal segments, and also,
> how to get the mid point of ecah segment.
>
> Best,
>
> Manuel
>

-- 

~$ whoami
Mathieu Basille
http://ase-research.org/basille

~$ locate --details
University of Florida \\
Fort Lauderdale Research and Education Center
(+1) 954-577-6314

~$ fortune
? Le tout est de tout dire, et je manque de mots
Et je manque de temps, et je manque d'audace. ?
  -- Paul ?luard


From edzer.pebesma at uni-muenster.de  Thu Oct 23 17:56:38 2014
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Thu, 23 Oct 2014 17:56:38 +0200
Subject: [R-sig-Geo] How to segment or split a spatial line in R
In-Reply-To: <54491CED.7040807@ase-research.org>
References: <CABkCotR_vPeu0DbJu9fdqQrvpCCgW2+StPeyD9BZJzGYxnRorw@mail.gmail.com>
	<54491CED.7040807@ase-research.org>
Message-ID: <54492536.3000700@uni-muenster.de>

sp::spsample also offers regular sampling of points on SpatialLines objects.

On 10/23/2014 05:21 PM, Mathieu Basille wrote:
> May be a little bit far fetched, but maybe check 'redisltraj' from the
> adehabitatLT package (and section 4.2.2 of the vignette [1]). Note that
> it was intended for animal trajectories so might be a little bit out of
> scope for you.
> 
> Mathieu.
> 
> 
> [1]
> http://cran.r-project.org/web/packages/adehabitatLT/vignettes/adehabitatLT.pdf
> 
> 
> Le 23/10/2014 10:10, Manuel Sp?nola a ?crit :
>> Dear list members,
>>
>> How to segment or split a spatial line in shorter equal segments, and
>> also,
>> how to get the mid point of ecah segment.
>>
>> Best,
>>
>> Manuel
>>
> 

-- 
Edzer Pebesma,  Co-Editor-in-Chief Computers & Geosciences
Institute for Geoinformatics (ifgi), University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
83 33081 http://ifgi.uni-muenster.de GPG key ID 0xAC227795

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 490 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20141023/7c85c5e2/attachment.bin>

From r.hijmans at gmail.com  Thu Oct 23 18:46:49 2014
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Thu, 23 Oct 2014 09:46:49 -0700
Subject: [R-sig-Geo] How to segment or split a spatial line in R
In-Reply-To: <54492536.3000700@uni-muenster.de>
References: <CABkCotR_vPeu0DbJu9fdqQrvpCCgW2+StPeyD9BZJzGYxnRorw@mail.gmail.com>
	<54491CED.7040807@ase-research.org>
	<54492536.3000700@uni-muenster.de>
Message-ID: <CANtt_hwiCZGvVDrbyXKfF5fvHGubgC_KoDC4K1CnmVzzkoch3g@mail.gmail.com>

I think the below is a solution:

library(raster)
# create some lines
cds1 <- rbind(c(-180,-20), c(-140,55), c(10, 0), c(-140,-60))
cds2 <- rbind(c(-10,0), c(140,60), c(160,0), c(140,-55))
cds3 <- rbind(c(-125,0), c(0,60), c(40,5), c(15,-45))
lns <- SpatialLines(list(Lines(list(Line(cds1)), "1"),
     Lines(list(Line(cds2)), "2"), Lines(list(Line(cds3)), "3") ))


# get coordinates
xy <- as.data.frame(lns, xy=TRUE)

# get midpoints
x <- xy$x[-1] + (xy$x[-nrow(xy)] - xy$x[-1]) / 2
y <- xy$y[-1] + (xy$y[-nrow(xy)] - xy$y[-1]) / 2
m <- cbind(x,y)

# remove mid-points between non-segments
i <- xy$cump[-1] == xy$cump[-nrow(xy)]
m <- m[i,]

plot(lns)
points(m)


On Thu, Oct 23, 2014 at 8:56 AM, Edzer Pebesma
<edzer.pebesma at uni-muenster.de> wrote:
> sp::spsample also offers regular sampling of points on SpatialLines objects.
>
> On 10/23/2014 05:21 PM, Mathieu Basille wrote:
>> May be a little bit far fetched, but maybe check 'redisltraj' from the
>> adehabitatLT package (and section 4.2.2 of the vignette [1]). Note that
>> it was intended for animal trajectories so might be a little bit out of
>> scope for you.
>>
>> Mathieu.
>>
>>
>> [1]
>> http://cran.r-project.org/web/packages/adehabitatLT/vignettes/adehabitatLT.pdf
>>
>>
>> Le 23/10/2014 10:10, Manuel Sp?nola a ?crit :
>>> Dear list members,
>>>
>>> How to segment or split a spatial line in shorter equal segments, and
>>> also,
>>> how to get the mid point of ecah segment.
>>>
>>> Best,
>>>
>>> Manuel
>>>
>>
>
> --
> Edzer Pebesma,  Co-Editor-in-Chief Computers & Geosciences
> Institute for Geoinformatics (ifgi), University of M?nster
> Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
> 83 33081 http://ifgi.uni-muenster.de GPG key ID 0xAC227795
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From r.hijmans at gmail.com  Thu Oct 23 18:50:48 2014
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Thu, 23 Oct 2014 09:50:48 -0700
Subject: [R-sig-Geo] How to segment or split a spatial line in R
In-Reply-To: <CANtt_hwiCZGvVDrbyXKfF5fvHGubgC_KoDC4K1CnmVzzkoch3g@mail.gmail.com>
References: <CABkCotR_vPeu0DbJu9fdqQrvpCCgW2+StPeyD9BZJzGYxnRorw@mail.gmail.com>
	<54491CED.7040807@ase-research.org>
	<54492536.3000700@uni-muenster.de>
	<CANtt_hwiCZGvVDrbyXKfF5fvHGubgC_KoDC4K1CnmVzzkoch3g@mail.gmail.com>
Message-ID: <CANtt_hzfPACRN3d6mCAD=AAgM98EhcPYJsZYKiB_OCrsDu9zTg@mail.gmail.com>

I should add that you can use geosphere::midPoint if you wanted the
great circle (longitude/latitude) mid-point instead of the Cartesian
midpoint.
But I now also see that you did not ask for splitting into
pre-existing segments, but into new ones ---- Edzer's solution seems
appropriate for that...
Robert

On Thu, Oct 23, 2014 at 9:46 AM, Robert J. Hijmans <r.hijmans at gmail.com> wrote:
> I think the below is a solution:
>
> library(raster)
> # create some lines
> cds1 <- rbind(c(-180,-20), c(-140,55), c(10, 0), c(-140,-60))
> cds2 <- rbind(c(-10,0), c(140,60), c(160,0), c(140,-55))
> cds3 <- rbind(c(-125,0), c(0,60), c(40,5), c(15,-45))
> lns <- SpatialLines(list(Lines(list(Line(cds1)), "1"),
>      Lines(list(Line(cds2)), "2"), Lines(list(Line(cds3)), "3") ))
>
>
> # get coordinates
> xy <- as.data.frame(lns, xy=TRUE)
>
> # get midpoints
> x <- xy$x[-1] + (xy$x[-nrow(xy)] - xy$x[-1]) / 2
> y <- xy$y[-1] + (xy$y[-nrow(xy)] - xy$y[-1]) / 2
> m <- cbind(x,y)
>
> # remove mid-points between non-segments
> i <- xy$cump[-1] == xy$cump[-nrow(xy)]
> m <- m[i,]
>
> plot(lns)
> points(m)
>
>
> On Thu, Oct 23, 2014 at 8:56 AM, Edzer Pebesma
> <edzer.pebesma at uni-muenster.de> wrote:
>> sp::spsample also offers regular sampling of points on SpatialLines objects.
>>
>> On 10/23/2014 05:21 PM, Mathieu Basille wrote:
>>> May be a little bit far fetched, but maybe check 'redisltraj' from the
>>> adehabitatLT package (and section 4.2.2 of the vignette [1]). Note that
>>> it was intended for animal trajectories so might be a little bit out of
>>> scope for you.
>>>
>>> Mathieu.
>>>
>>>
>>> [1]
>>> http://cran.r-project.org/web/packages/adehabitatLT/vignettes/adehabitatLT.pdf
>>>
>>>
>>> Le 23/10/2014 10:10, Manuel Sp?nola a ?crit :
>>>> Dear list members,
>>>>
>>>> How to segment or split a spatial line in shorter equal segments, and
>>>> also,
>>>> how to get the mid point of ecah segment.
>>>>
>>>> Best,
>>>>
>>>> Manuel
>>>>
>>>
>>
>> --
>> Edzer Pebesma,  Co-Editor-in-Chief Computers & Geosciences
>> Institute for Geoinformatics (ifgi), University of M?nster
>> Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
>> 83 33081 http://ifgi.uni-muenster.de GPG key ID 0xAC227795
>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>


From r.hijmans at gmail.com  Thu Oct 23 19:00:39 2014
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Thu, 23 Oct 2014 10:00:39 -0700
Subject: [R-sig-Geo] distance between centroids
In-Reply-To: <6A309390-CD1B-4DAE-A4BC-46AF11746AF1@gmail.com>
References: <mailman.13.1414058404.29667.r-sig-geo@r-project.org>
	<6A309390-CD1B-4DAE-A4BC-46AF11746AF1@gmail.com>
Message-ID: <CANtt_hz1SqfJ8M1PTVS7rUbY-yzbRHWDJCGK2qQqXFMUWOEneg@mail.gmail.com>

Alessandra,

This is pretty straightforward but you need to do your part (show us
what you have done) using a simple reproducible example. For example,
you can use the North Carolina data that comes with spdep. That
package also allows you to identify neighbors.


library(spdep)
library(raster)
nc <- shapefile(system.file("etc/shapes/sids.shp", package="spdep"))
crs(nc) <- "+proj=longlat +ellps=clrk66"


?poly2nb

....

Robert


On Thu, Oct 23, 2014 at 3:48 AM, Alessandra Carioli
<alessandracarioli at gmail.com> wrote:
> Dear all,
>
> I am trying to compute the average distance between centroids and between neighbors, starting from a spatial polygon shape file.
> What I am doing is compute the average distance between all centroids and compute the average distance between neighbors for different regions in order to better compare them. (Some are densely populated and have more centroids, others are the opposite).
> Does anyone have any ideas? I am sure it should be pretty simple.
>
> So far I have used dist but does not give me what I want.
>
> Bests,
>
> Ale
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From ferra.xu at yahoo.com  Thu Oct 23 19:51:34 2014
From: ferra.xu at yahoo.com (Ferra Xu)
Date: Thu, 23 Oct 2014 10:51:34 -0700
Subject: [R-sig-Geo] visualizing a 5D kernel density estimation
Message-ID: <1414086694.62919.YahooMailNeo@web125102.mail.ne1.yahoo.com>

I have a question regarding kernel density estimation in R. I have a 5-dimensional data, which consists of (x,y,z) locations, time of happening and size of some events (for example earthquake). I wrote the following code in R in order to find the 5D kernel density estimation:

library(ks) 
library(rgl)
kern <- read.table(file.choose(), sep=",")
evpts <- do.call(expand.grid,  lapply(kern,quantile, prob=c(.1,.15,.2,.25,.3,.35,.4,.45,.5,.55,.6,.65,.7,.75,.8,.85,.9,.95)))
hat <- kde(kern, eval.points= evpts)
str(hat)


Now, I'd like to visualize the kernel density estimation. I prefer to show the kernel regarding all 5 dimensions in one plot (by using different colors or sizes for point) or at least regarding three dimensions separately. Do you have any suggestion for me?

Here is the dataset:

   x          y          z            time         size
422.697323  164.19886   2.457419    8.083796636  0.83367586
423.008236  163.32434   0.5551326   37.58477455  0.893893903
204.733908  218.36365   1.9397874   37.88324312  0.912809449
203.963056  218.4808    0.3723791   43.21775903  0.926406005
100.727581  46.60876    1.4022341   49.41510519  0.782807523
453.335182  244.25521   1.6292517   51.73779175  0.903910803
134.909462  210.96333   2.2389119   53.13433521  0.896529401
135.300562  212.02055   0.6739541   67.55073745  0.748783521
258.237117  134.29735   2.1205291   76.34032587  0.735699304
341.305271  149.26953   3.718958    94.33975483  0.849509216
307.138925  59.60571    0.6311074   106.9636715  0.987923188
307.76875   58.91453    2.6496741   113.8515307  0.802115718
415.025535  217.17398   1.7155688   115.7464603  0.875580325
414.977687  216.73327   1.7107369   115.9776948  0.767143582
311.006135  173.24378   2.7819572   120.8079566  0.925380118
310.116929  174.28122   4.3318722   129.2648401  0.776528535
347.260911  37.34946    3.5155427   136.7851291  0.851787115
351.317624  33.65703    0.5806926   138.7349284  0.909723017
4.471892    59.42068    1.4062959   139.0543783  0.967270976
5.480223    59.72857    2.7326106   139.2114277  0.987787428
199.513023  21.53302    2.5163259   143.5895625  0.864164659
198.718031  23.50163    0.4801849   147.2280466  0.741587333
26.650517   35.2019     0.8246514   150.4876506  0.744788202
25.089379   90.47825    0.8700944   152.1944046  0.777252476
26.307439   88.41552    2.4422487   155.9090026  0.952215177
234.282901  236.11422   1.8115261   155.9658144  0.776284654
235.052948  236.77437   1.9644963   156.6900297  0.944285448
23.048202   98.6261     3.4573048   159.7700912  0.773057491
21.516695   98.05431    2.5029284   160.8202997  0.978779087
213.936324  151.87013   3.1042192   161.0612489  0.80499513
277.887935  197.25753   1.3659279   163.673142   0.758978575
277.239746  197.54001   2.2109361   166.2629868  0.775325157

I really appreciate your help in advance,
	[[alternative HTML version deleted]]


From vitale232 at gmail.com  Fri Oct 24 00:04:06 2014
From: vitale232 at gmail.com (Andrew Vitale)
Date: Thu, 23 Oct 2014 15:04:06 -0700
Subject: [R-sig-Geo] spacetime EOF implementation - interpretation question
Message-ID: <CAFTcopdoKkxSnMdBA=OQRs+5_ZwRtB6Na6ZD7U3br4dOdeZVgw@mail.gmail.com>

Hello,

I'm performing an empirical orthogonal function analysis on sea level
pressure using the spacetime package, and I'm having trouble determining
which elements of the function output I should use to interpret the results.

It seems that most examples in the literature calculate empirical
orthogonal functions (EOFs) and their associated principle component (PC)
time series (e.g. http://www.met.reading.ac.uk/~han/Monitor/eofprimer.pdf ,
pp 11-12, Fig. 2, 3).  As far as I can tell, I should be able to extract
all of the relevant information using only the spatial mode in the
spacetime:::EOF function.  However, the ambiguous terminology in the
literature and the availability of the "temporal" mode in spacetime:::EOF
have me uncertain of my interpretation.

I have been treating the output of spacetime:::EOF with
returnPredictions=TRUE as the EOFs, and I have been treating the
spacetime:::EOF $rotation element with returnPredictions=FALSE as the PCs.

Am I extracting the proper information from the spacetime:::EOF results?
Are the results of the spatial and temporal modes of spacetime:::EOF both
required to perform an EOF analysis of a sea level pressure field, or are
these two separate analyses?

Below is a small example of how I am currently extracting the spatial EOFs
and their associated PCs.

Thanks for any comments,
Andrew Vitale


library(raster)
library(spacetime)

## Create a raster object that mimics my data
## which is actually a raster stack of 20,718
## daily sea level pressure anomolies
a = array(rnorm(9*9*100), c(9,9,100))
b = brick(a)
b = setValues(b, a)
z = seq(as.Date('1980-01-01'), as.Date('1980-04-09'),
        by = 'day')
b = setZ(b, z)

## coerce the raster stack to an STFDF object
st = as(b, 'STFDF')

## calculate EOFs in spatial mode using spacetime
seof = EOF(st, how='spatial', returnPredictions=FALSE, scale.=TRUE)
seof_preds = EOF(st, how='spatial', returnPredictions=TRUE, scale.=TRUE)

## Create a raster stack of the predictions, which seem to be
## generally referred to as EOFs in the literature
EOFs = stack(seof_preds)
## extract and standardize the rotation element of the
## seof object, which seems to be the eigenvectors, which seem
## to also be referred to as PCs in the literature
PCs = apply(seof$rotation, 2, function(x) (x - mean(x)) / sd(x))

## Plot the EOFs as maps (seof_preds)
plot(EOFs)

## Plot the first PC (seof$rotation [standardized])
x11(height=7, width=10)
plot(x=as.Date(row.names(PCs), format='X%Y.%m.%d'),
     y=PCs[ , 1], type='l', xlab='Date', ylab='Standardized PC1')


-- 
*Andrew P. Vitale*
Masters Student
Department of Geography
University of Nevada, Reno
vitale232 at gmail.com

	[[alternative HTML version deleted]]


From Roger.Bivand at nhh.no  Fri Oct 24 09:45:45 2014
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 24 Oct 2014 09:45:45 +0200
Subject: [R-sig-Geo] subdatasets in rgdal/raster
In-Reply-To: <CABG0rfuZC8xbM9vW+76T=P_Wnd_LdVjqpLqTL1n24a92FpDe7Q@mail.gmail.com>
References: <CAAcGz980P1Zp+u9VCYzXGWZdzD=aiNkQZNsNgGJcViFPFxUn5g@mail.gmail.com>
	<alpine.LRH.2.03.1410150838400.4732@reclus.nhh.no>
	<CAAcGz99CFT-yxHDax+SnPP1WBavpdCTBbZcvbBP3VENmxNAmeg@mail.gmail.com>
	<CABG0rfsWFrGry-2QtZVs0KJj8Ysk1GyiU2=-LW=HwtSMoBrjzg@mail.gmail.com>
	<CAAcGz9_-uVfZpPceNUC=NPRi1b1rB5e5jrtbkhD4LJ9mXyQ=0g@mail.gmail.com>
	<CABG0rfuZC8xbM9vW+76T=P_Wnd_LdVjqpLqTL1n24a92FpDe7Q@mail.gmail.com>
Message-ID: <alpine.LRH.2.03.1410232254150.817@reclus.nhh.no>

On Wed, 22 Oct 2014, Jonathan Greenberg wrote:

> I think Roger has mentioned a few times over the years his reticence
> to build in the HDF4 drivers into the Windows gdal binary (Roger,
> perhaps you can discuss why this is a problem)-- I actually built
> gdalUtils for this exact purpose -- the need to access MODIS and
> Landsat HDFs in Windows.

The CRAN Windows binaries are built by statically linking to both 32-bit 
and 64-bit builds of GDAL, PROJ.4, and a small selection of (partly 
platform dependent) other libraries. These GDAL etc. binaries are prepared 
by Brian Ripley and Uwe Ligges, as they have write access to the 
win-builder and CRAN servers (the same relationship exists for rgeos). 
Some years ago, I prepared 32-bit DLLs, which were then used in a CRAN 
binary that shipped with those libraries. The CRAN administrators found 
that this was much less satisfactory than a static build, to avoid 
possible interference between multiple installs of DLLs on this platform 
among other reasons. HDF and NetCDF are seen as substantially more complex 
external dependencies, so have not been seriously considered for inclusion 
in the GDAL binaries used in preparing rgdal for Windows.

This isn't impossible, but volunteering other peoples' time and insight 
seems unfortunate. If interested people would like to work up a route to 
including these extra libraries, in the knowledge that both have had 
portability issues (see clang), then in time it might be possible to make 
progress.

Another avenue is to support the OSGeo4W project in its attempts to 
provide R with rgdal and rgeos, and thus get the drivers that way.

Neither will happen without a longer term commitment.

Roger

>
> One thing that may be worth considering is if Roger is open to it is
> having someone work to get the Windows binaries that come along with
> rgdal so they support a wider range of formats (specifically getting
> HDF4 and 5 and NetCDF functional)?  Others have already solved this
> satisfactorily (osgeo4w has all of the key formats supported, for
> instance), so it should be doable.
>
> Also, to respond to your question about why have gdalUtils at all -- I
> don't think every function that the base gdal utilities is available
> in rgdal (correct me if I'm wrong), so I wanted a way to bring them to
> R users in a (relatively) easy to use fashion -- I've seen gdalUtills
> as a complementary package to rgdal.
>
> --j
>
> On Tue, Oct 21, 2014 at 2:17 AM, Michael Sumner <mdsumner at gmail.com> wrote:
>> I have, and it's good but it's not what I am after here.
>>
>> I really want access to HDF4 via tight-coupling. It does work well in
>> R when you build GDAL right, especially with raster over the top to
>> clean everything up. If you can compile those drivers into GDAL it
>> does beg the question why have a wrapper like gdalUtils. (My take on
>> this is that Windows-support stops at the CRAN binary, and again this
>> is why raster has its own NetCDF wrapper).
>>
>> Ultimately the logic for these rogue files belongs in GDAL and
>> rgdal/raster should just reflect that: rgdal2 is essentially that, but
>> doesn't offer much more and it's not clear how to "rasterize"
>> everything again.
>>
>> :)
>>
>>
>>
>> On Thu, Oct 16, 2014 at 2:27 AM, Jonathan Greenberg <jgrn at illinois.edu> wrote:
>>> Mike:
>>>
>>> Have you taken a look at gdalUtils?  This is a wrapper for all the
>>> GDAL binaries (I am still working on adding in all those new tools
>>> that were recently released with version 1.11.1, but it should be up
>>> to date as of v 1.10.1).  gdalinfo that is part of gdalUtils gives you
>>> the full info dump (more, if less clean, output than rgdal's gdalInfo
>>> will give you), which you could parse for the info you wanted.  I also
>>> have a custom function "get_subdatasets" which sounds a lot like what
>>> you are describing.
>>>
>>> Give it a shot!  You will need to install GDAL yourself first -- check
>>> the help for suggestions on which flavor of GDAL I recommend.
>>>
>>> --j
>>>
>>> On Wed, Oct 15, 2014 at 6:23 AM, Michael Sumner <mdsumner at gmail.com> wrote:
>>>> Thanks Roger, I'm still hoping to be able to code at this level one day.
>>>>
>>>> I have gone off half-cocked, confusing things. I can get SDS from
>>>> NetCDF and HDF files with GDALinfo() with no problems - I just had to
>>>> turn off returnScaleOffset, which I think has a confounding of nbands
>>>> and subdatasets - since a datasource with SDS has no bands, but I need
>>>> to explore this more to be sure.
>>>>
>>>> Cheers, Mike.
>>>>
>>>>
>>>>
>>>>
>>>>
>>>> On Wed, Oct 15, 2014 at 5:50 PM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
>>>>> On Wed, 15 Oct 2014, Michael Sumner wrote:
>>>>>
>>>>>> Hello,
>>>>>>
>>>>>> As far as I know there's nothing in rgdal to determine existing
>>>>>> subdatasets (SDS) in HDF (or NetCDF for that matter).
>>>>>>
>>>>>> In raster, raster(x) will read from the first candidate *variable*,
>>>>>> and list the others with a warning, which is analogous to an SDS but
>>>>>> of course it's always providing this via ncdf/ncdf4 rather than via
>>>>>> rgdal.
>>>>>>
>>>>>> Is it true there's no way to find out SDS from HDF or NetCDF in rgdal?
>>>>>
>>>>>
>>>>> Because these formats are poorly organised (an XML tree describing the
>>>>> internal structure would be easy to parse, but self-descriptive metadata
>>>>> isn't usual here), GDALinfo() does not provide much.
>>>>>
>>>>> If you start by identifying the incantation used by command line gdalinfo to
>>>>> report the SDS metadata, then look at its source code, it should be possible
>>>>> to make some progress. I don't use either if I can help it, and do not have
>>>>> the necessary trial set of sample files. You'd need to find a robust route
>>>>> covering a wide range of files seen in the wild to allow for oddities in the
>>>>> ways things are organised. It is unfortunate to have to branch code on the
>>>>> selected driver, but here it is hard to avoid. Once GDALinfo is reporting
>>>>> the metadata in a predictable way, the other functions can be given
>>>>> appropriate argument values.
>>>>>
>>>>> Also consider looking at this from the point of view of rgdal2 in addition
>>>>> to rgdal; it could possibly be "closer" there and looking at both may make
>>>>> it easier to spot:
>>>>>
>>>>> https://github.com/thk686/rgdal2
>>>>>
>>>>> Contributions welcome!
>>>>>
>>>>> Roger
>>>>>
>>>>>
>>>>>>
>>>>>> I've not really explored this before much since compiling HDF was
>>>>>> unavailable to me. gdalUtils fills a gap but only by running the
>>>>>> installed command line tools, which obviously can be avoided with the
>>>>>> right features in rgdal/raster. I personally have always run the
>>>>>> command line tools and then jumped back to R (if I could).
>>>>>>
>>>>>> (The vector analogy in rgdal to listing SDS would be ogrListLayers).
>>>>>>
>>>>>> This is a missing capability in the raster package, somewhat disguised
>>>>>> because of the independent support for NetCDF. I guess hardly anyone
>>>>>> is using HDF? That's a shame since these R tools really help.  It's a
>>>>>> pretty complicated story all round and I keep re/discovering
>>>>>> interesting corners. If anyone is writing anything significant about
>>>>>> all this I'd be keen to be involved.
>>>>>>
>>>>>> Cheers, Mike.
>>>>>>
>>>>>>
>>>>>
>>>>> --
>>>>> Roger Bivand
>>>>> Department of Economics, Norwegian School of Economics,
>>>>> Helleveien 30, N-5045 Bergen, Norway.
>>>>> voice: +47 55 95 93 55; fax +47 55 95 91 00
>>>>> e-mail: Roger.Bivand at nhh.no
>>>>>
>>>>
>>>>
>>>>
>>>> --
>>>> Michael Sumner
>>>> Software and Database Engineer
>>>> Australian Antarctic Division
>>>> Hobart, Australia
>>>> e-mail: mdsumner at gmail.com
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at r-project.org
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>>
>>>
>>> --
>>> Jonathan A. Greenberg, PhD
>>> Assistant Professor
>>> Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
>>> Department of Geography and Geographic Information Science
>>> University of Illinois at Urbana-Champaign
>>> 259 Computing Applications Building, MC-150
>>> 605 East Springfield Avenue
>>> Champaign, IL  61820-6371
>>> Phone: 217-300-1924
>>> http://www.geog.illinois.edu/~jgrn/
>>> AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007
>>
>>
>>
>> --
>> Michael Sumner
>> Software and Database Engineer
>> Australian Antarctic Division
>> Hobart, Australia
>> e-mail: mdsumner at gmail.com
>
>
>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no


From aaf11 at psu.edu  Fri Oct 24 17:12:43 2014
From: aaf11 at psu.edu (Angel Ferrero)
Date: Fri, 24 Oct 2014 11:12:43 -0400
Subject: [R-sig-Geo] Error: identicalCRS(x,
	y) is not TRUE after using the over() command
Message-ID: <F2736006-C401-4531-B8C2-B1F7FE2EDDD1@psu.edu>


Hi everyone, 

I am new to doing this kind of thing in R, but I have been trying to perform co-kriging for a set of datapoints in relation to climate from the worldclim project based on a previous example I found using the meuse shp.

This is my code, and at the end of it, you can see the error I get: identicalCRS(x, y) is not TRUE after using the over() command.

I would appreciate if anybody could help me out this this.

Best

?ngel


#Let's first create a prediction grid for the interpolation, starting from the shape file


setwd(?*")
data<-read.table(?/*",header=T) 
 
coordinates(data)=~long+lat

proj4string(data)=CRS("+proj=longlat +ellps=WGS84 +datum=WGS84")

border0<-readOGR("country.shp","country")
border <- spTransform(border0, CRS("+proj=longlat +ellps=WGS84 +datum=WGS84"))
proj4string(border)=CRS("+proj=longlat +ellps=WGS84 +datum=WGS84")

bio <- getData("worldclim", var="bio", res=10)   # this will download global data on minimum temperature at 10 min resolution
# can also get other climatic data, elevation, administrative boundaries, etc
bio1 <- raster(?*/wc10/bio1.bil")   # Tmin for January
fromDisk(bio1)  # values are stored on disk instead of memory! (useful for
bio1 <-bio1/10    # Worldclim temperature data come in decimal degrees
bio1
proj4string(bio1)=CRS("+proj=longlat +ellps=WGS84 +datum=WGS84")


data <- spTransform(data, CRS("+proj=longlat +ellps=GRS80"))
border <- spTransform(border, CRS("+proj=longlat +ellps=GRS80"))


vals <-border at bbox
deltaLong <- as.integer((vals[1,2] - vals[1,1]) + 1.5)
deltaLat <- as.integer((vals[2,2] - vals[2,1]) + 1.5)
gridRes <-20   #change this value to change the grid size (in metres)
gridSizeX <- deltaLong / gridRes
gridSizeY <- deltaLat / gridRes
grd <- GridTopology(vals[,1],c(gridRes,gridRes),c(gridSizeX,gridSizeY))
pts <- SpatialPoints(coordinates(grd))
pts1 <- SpatialPointsDataFrame(as.data.frame(pts), data=as.data.frame(rep(1,nrow(as.data.frame(pts)))))
Over=over(pts1,border)
pts$border=Over
espinete<-na.exclude(as.data.frame(pts1))
coordinates(nona)=~x+y
gridded(espinete) <- TRUE
proj4string(espinete)=CRS("+proj=longlat +ellps=GRS80")  
writeAsciiGrid(nona,"prediction_grid.asc")

When I run the
Over=over(pts1,border)
command, I get this error:
Error: identicalCRS(x, y) is not TRUE


From jgrn at illinois.edu  Fri Oct 24 17:57:25 2014
From: jgrn at illinois.edu (Jonathan Greenberg)
Date: Fri, 24 Oct 2014 10:57:25 -0500
Subject: [R-sig-Geo] Loading Rasters in Revolution R
In-Reply-To: <CA+vqiLExpSVmBPfAEz0sLu6+ux2vZ=GFf4qPLpScOme0pvtyuw@mail.gmail.com>
References: <CAFFT+Y5Y+UayEU-5r4FgX_aKE+vLKR9TGcybiaXr0LYVAkhqGg@mail.gmail.com>
	<CA+vqiLExpSVmBPfAEz0sLu6+ux2vZ=GFf4qPLpScOme0pvtyuw@mail.gmail.com>
Message-ID: <CABG0rfuiSLq=YLpsBgyka0BddjcrvZG8V1w2KSY_OtdZfmrMYw@mail.gmail.com>

I'll mention the problem you are describing is what I designed
"rasterEngine" (part of the spatial.tools package) for.  It will allow
you to do parallel processing of rasters with arbitrarily complex
functions applied to pixels or focal windows.  Don't even need
Revolution to use it, just good 'ol base R!

--j

On Wed, Oct 22, 2014 at 6:59 PM, Ista Zahn <istazahn at gmail.com> wrote:
> Sounds like a question for Revolution...
>
> Best,
> Ista
>
> On Wed, Oct 22, 2014 at 4:29 PM, Jefferson Ferreira-Ferreira
> <jecogeo at gmail.com> wrote:
>> Hi all,
>>
>> I'm wondering how to load rasters as xdf files using rxImport. I have a big
>> raster with 9 layers/bands and I need to do perform a logistic regression
>> for each pixel throughout bands. So It's a huge processing, and why I'm
>> testing Revolution R Enterprise.
>> However I don't know how to import as xdf files to perform parallel
>> processing inside it. Almost blogs and tutorials deals with ordinary csv
>> files.
>>
>> Could anybody give me any guidance?
>>
>> Regards
>>
>>
>> --
>>
>> *Jefferson Ferreira-Ferreira*
>>
>> Ge?grafo ? GEOPROCESSAMENTO IDSM | Coordenadoria de TI
>>
>>
>> Jefferson.ferreira at mamiraua.org.br
>>
>> *Instituto de Desenvolvimento Sustent?vel Mamirau?*
>>
>> Minist?rio da Ci?ncia, Tecnologia e Inova??o
>>
>> Telefone: +55 97 3343-9710
>>
>> *Google Maps* - Mapas deste e-mail:
>>
>> Exibir mapa ampliado
>> <https://maps.google.com.br/maps?q=-3.355557,-64.731151&ll=-3.355471,-64.731145&spn=0.004632,0.006968&num=1&t=h&z=18>
>>
>>
>> *Contatos particulares:*
>> *(55) 9615-0100*
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



-- 
Jonathan A. Greenberg, PhD
Assistant Professor
Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
Department of Geography and Geographic Information Science
University of Illinois at Urbana-Champaign
259 Computing Applications Building, MC-150
605 East Springfield Avenue
Champaign, IL  61820-6371
Phone: 217-300-1924
http://www.geog.illinois.edu/~jgrn/
AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007


From mdsumner at gmail.com  Sat Oct 25 03:20:17 2014
From: mdsumner at gmail.com (Michael Sumner)
Date: Sat, 25 Oct 2014 12:20:17 +1100
Subject: [R-sig-Geo] subdatasets in rgdal/raster
In-Reply-To: <alpine.LRH.2.03.1410232254150.817@reclus.nhh.no>
References: <CAAcGz980P1Zp+u9VCYzXGWZdzD=aiNkQZNsNgGJcViFPFxUn5g@mail.gmail.com>
	<alpine.LRH.2.03.1410150838400.4732@reclus.nhh.no>
	<CAAcGz99CFT-yxHDax+SnPP1WBavpdCTBbZcvbBP3VENmxNAmeg@mail.gmail.com>
	<CABG0rfsWFrGry-2QtZVs0KJj8Ysk1GyiU2=-LW=HwtSMoBrjzg@mail.gmail.com>
	<CAAcGz9_-uVfZpPceNUC=NPRi1b1rB5e5jrtbkhD4LJ9mXyQ=0g@mail.gmail.com>
	<CABG0rfuZC8xbM9vW+76T=P_Wnd_LdVjqpLqTL1n24a92FpDe7Q@mail.gmail.com>
	<alpine.LRH.2.03.1410232254150.817@reclus.nhh.no>
Message-ID: <CAAcGz9-dencH5CGHsQ_fju_EBuHxneptvuiHi4PinnJ5HLXvwA@mail.gmail.com>

Thank Roger, I'm keen and I have support for the long term, I just
need to learn how the build actually gets done so I can do it myself.
I'm sorry this is such an ongoing topic but I do have the resources, I
just lack some key skills.

Is the win-builder setup documented? If it is I cannot find it. Prof.
Ripley publishes the sources that are used but not the details of the
build afaik, I have an early set of notes using cross-compilation
which I have used to build GDAL for Windows on Linux with
HDF4/5/NetCDF etc, I just do not know how that gets bundled together
into the static Windows rgdal. (I may be missing something really
simple and obvious).

I'm also concerned about the NetCDF support generally in R, there are
file types that none of the 3 packages suppport so that really needs
fixing. I'll get to it eventually but if anyone reading this is keen
please contact me. We  would like to improve the support that is
already there and make sure it has longevity.

Cheers, Mike.

On Fri, Oct 24, 2014 at 6:45 PM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
> On Wed, 22 Oct 2014, Jonathan Greenberg wrote:
>
>> I think Roger has mentioned a few times over the years his reticence
>> to build in the HDF4 drivers into the Windows gdal binary (Roger,
>> perhaps you can discuss why this is a problem)-- I actually built
>> gdalUtils for this exact purpose -- the need to access MODIS and
>> Landsat HDFs in Windows.
>
>
> The CRAN Windows binaries are built by statically linking to both 32-bit and
> 64-bit builds of GDAL, PROJ.4, and a small selection of (partly platform
> dependent) other libraries. These GDAL etc. binaries are prepared by Brian
> Ripley and Uwe Ligges, as they have write access to the win-builder and CRAN
> servers (the same relationship exists for rgeos). Some years ago, I prepared
> 32-bit DLLs, which were then used in a CRAN binary that shipped with those
> libraries. The CRAN administrators found that this was much less
> satisfactory than a static build, to avoid possible interference between
> multiple installs of DLLs on this platform among other reasons. HDF and
> NetCDF are seen as substantially more complex external dependencies, so have
> not been seriously considered for inclusion in the GDAL binaries used in
> preparing rgdal for Windows.
>
> This isn't impossible, but volunteering other peoples' time and insight
> seems unfortunate. If interested people would like to work up a route to
> including these extra libraries, in the knowledge that both have had
> portability issues (see clang), then in time it might be possible to make
> progress.
>
> Another avenue is to support the OSGeo4W project in its attempts to provide
> R with rgdal and rgeos, and thus get the drivers that way.
>
> Neither will happen without a longer term commitment.
>
> Roger
>
>
>>
>> One thing that may be worth considering is if Roger is open to it is
>> having someone work to get the Windows binaries that come along with
>> rgdal so they support a wider range of formats (specifically getting
>> HDF4 and 5 and NetCDF functional)?  Others have already solved this
>> satisfactorily (osgeo4w has all of the key formats supported, for
>> instance), so it should be doable.
>>
>> Also, to respond to your question about why have gdalUtils at all -- I
>> don't think every function that the base gdal utilities is available
>> in rgdal (correct me if I'm wrong), so I wanted a way to bring them to
>> R users in a (relatively) easy to use fashion -- I've seen gdalUtills
>> as a complementary package to rgdal.
>>
>> --j
>>
>> On Tue, Oct 21, 2014 at 2:17 AM, Michael Sumner <mdsumner at gmail.com>
>> wrote:
>>>
>>> I have, and it's good but it's not what I am after here.
>>>
>>> I really want access to HDF4 via tight-coupling. It does work well in
>>> R when you build GDAL right, especially with raster over the top to
>>> clean everything up. If you can compile those drivers into GDAL it
>>> does beg the question why have a wrapper like gdalUtils. (My take on
>>> this is that Windows-support stops at the CRAN binary, and again this
>>> is why raster has its own NetCDF wrapper).
>>>
>>> Ultimately the logic for these rogue files belongs in GDAL and
>>> rgdal/raster should just reflect that: rgdal2 is essentially that, but
>>> doesn't offer much more and it's not clear how to "rasterize"
>>> everything again.
>>>
>>> :)
>>>
>>>
>>>
>>> On Thu, Oct 16, 2014 at 2:27 AM, Jonathan Greenberg <jgrn at illinois.edu>
>>> wrote:
>>>>
>>>> Mike:
>>>>
>>>> Have you taken a look at gdalUtils?  This is a wrapper for all the
>>>> GDAL binaries (I am still working on adding in all those new tools
>>>> that were recently released with version 1.11.1, but it should be up
>>>> to date as of v 1.10.1).  gdalinfo that is part of gdalUtils gives you
>>>> the full info dump (more, if less clean, output than rgdal's gdalInfo
>>>> will give you), which you could parse for the info you wanted.  I also
>>>> have a custom function "get_subdatasets" which sounds a lot like what
>>>> you are describing.
>>>>
>>>> Give it a shot!  You will need to install GDAL yourself first -- check
>>>> the help for suggestions on which flavor of GDAL I recommend.
>>>>
>>>> --j
>>>>
>>>> On Wed, Oct 15, 2014 at 6:23 AM, Michael Sumner <mdsumner at gmail.com>
>>>> wrote:
>>>>>
>>>>> Thanks Roger, I'm still hoping to be able to code at this level one
>>>>> day.
>>>>>
>>>>> I have gone off half-cocked, confusing things. I can get SDS from
>>>>> NetCDF and HDF files with GDALinfo() with no problems - I just had to
>>>>> turn off returnScaleOffset, which I think has a confounding of nbands
>>>>> and subdatasets - since a datasource with SDS has no bands, but I need
>>>>> to explore this more to be sure.
>>>>>
>>>>> Cheers, Mike.
>>>>>
>>>>>
>>>>>
>>>>>
>>>>>
>>>>> On Wed, Oct 15, 2014 at 5:50 PM, Roger Bivand <Roger.Bivand at nhh.no>
>>>>> wrote:
>>>>>>
>>>>>> On Wed, 15 Oct 2014, Michael Sumner wrote:
>>>>>>
>>>>>>> Hello,
>>>>>>>
>>>>>>> As far as I know there's nothing in rgdal to determine existing
>>>>>>> subdatasets (SDS) in HDF (or NetCDF for that matter).
>>>>>>>
>>>>>>> In raster, raster(x) will read from the first candidate *variable*,
>>>>>>> and list the others with a warning, which is analogous to an SDS but
>>>>>>> of course it's always providing this via ncdf/ncdf4 rather than via
>>>>>>> rgdal.
>>>>>>>
>>>>>>> Is it true there's no way to find out SDS from HDF or NetCDF in
>>>>>>> rgdal?
>>>>>>
>>>>>>
>>>>>>
>>>>>> Because these formats are poorly organised (an XML tree describing the
>>>>>> internal structure would be easy to parse, but self-descriptive
>>>>>> metadata
>>>>>> isn't usual here), GDALinfo() does not provide much.
>>>>>>
>>>>>> If you start by identifying the incantation used by command line
>>>>>> gdalinfo to
>>>>>> report the SDS metadata, then look at its source code, it should be
>>>>>> possible
>>>>>> to make some progress. I don't use either if I can help it, and do not
>>>>>> have
>>>>>> the necessary trial set of sample files. You'd need to find a robust
>>>>>> route
>>>>>> covering a wide range of files seen in the wild to allow for oddities
>>>>>> in the
>>>>>> ways things are organised. It is unfortunate to have to branch code on
>>>>>> the
>>>>>> selected driver, but here it is hard to avoid. Once GDALinfo is
>>>>>> reporting
>>>>>> the metadata in a predictable way, the other functions can be given
>>>>>> appropriate argument values.
>>>>>>
>>>>>> Also consider looking at this from the point of view of rgdal2 in
>>>>>> addition
>>>>>> to rgdal; it could possibly be "closer" there and looking at both may
>>>>>> make
>>>>>> it easier to spot:
>>>>>>
>>>>>> https://github.com/thk686/rgdal2
>>>>>>
>>>>>> Contributions welcome!
>>>>>>
>>>>>> Roger
>>>>>>
>>>>>>
>>>>>>>
>>>>>>> I've not really explored this before much since compiling HDF was
>>>>>>> unavailable to me. gdalUtils fills a gap but only by running the
>>>>>>> installed command line tools, which obviously can be avoided with the
>>>>>>> right features in rgdal/raster. I personally have always run the
>>>>>>> command line tools and then jumped back to R (if I could).
>>>>>>>
>>>>>>> (The vector analogy in rgdal to listing SDS would be ogrListLayers).
>>>>>>>
>>>>>>> This is a missing capability in the raster package, somewhat
>>>>>>> disguised
>>>>>>> because of the independent support for NetCDF. I guess hardly anyone
>>>>>>> is using HDF? That's a shame since these R tools really help.  It's a
>>>>>>> pretty complicated story all round and I keep re/discovering
>>>>>>> interesting corners. If anyone is writing anything significant about
>>>>>>> all this I'd be keen to be involved.
>>>>>>>
>>>>>>> Cheers, Mike.
>>>>>>>
>>>>>>>
>>>>>>
>>>>>> --
>>>>>> Roger Bivand
>>>>>> Department of Economics, Norwegian School of Economics,
>>>>>> Helleveien 30, N-5045 Bergen, Norway.
>>>>>> voice: +47 55 95 93 55; fax +47 55 95 91 00
>>>>>> e-mail: Roger.Bivand at nhh.no
>>>>>>
>>>>>
>>>>>
>>>>>
>>>>> --
>>>>> Michael Sumner
>>>>> Software and Database Engineer
>>>>> Australian Antarctic Division
>>>>> Hobart, Australia
>>>>> e-mail: mdsumner at gmail.com
>>>>>
>>>>> _______________________________________________
>>>>> R-sig-Geo mailing list
>>>>> R-sig-Geo at r-project.org
>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>>
>>>>
>>>>
>>>> --
>>>> Jonathan A. Greenberg, PhD
>>>> Assistant Professor
>>>> Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
>>>> Department of Geography and Geographic Information Science
>>>> University of Illinois at Urbana-Champaign
>>>> 259 Computing Applications Building, MC-150
>>>> 605 East Springfield Avenue
>>>> Champaign, IL  61820-6371
>>>> Phone: 217-300-1924
>>>> http://www.geog.illinois.edu/~jgrn/
>>>> AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007
>>>
>>>
>>>
>>>
>>> --
>>> Michael Sumner
>>> Software and Database Engineer
>>> Australian Antarctic Division
>>> Hobart, Australia
>>> e-mail: mdsumner at gmail.com
>>
>>
>>
>>
>>
>
> --
> Roger Bivand
> Department of Economics, Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; fax +47 55 95 91 00
> e-mail: Roger.Bivand at nhh.no



-- 
Michael Sumner
Software and Database Engineer
Australian Antarctic Division
Hobart, Australia
e-mail: mdsumner at gmail.com


From jon.skoien at jrc.ec.europa.eu  Mon Oct 27 08:49:12 2014
From: jon.skoien at jrc.ec.europa.eu (Jon Skoien)
Date: Mon, 27 Oct 2014 08:49:12 +0100
Subject: [R-sig-Geo] Error: identicalCRS(x,
 y) is not TRUE after using the over() command
In-Reply-To: <F2736006-C401-4531-B8C2-B1F7FE2EDDD1@psu.edu>
References: <F2736006-C401-4531-B8C2-B1F7FE2EDDD1@psu.edu>
Message-ID: <544DF8F8.1050808@jrc.ec.europa.eu>

Hi Angel,

We cannot reproduce your problem as we dont have access to your files, 
but it seems only one of the objects in your over-command is projected 
(border). Probably it will work better if you set proj4string also for 
pts1.

Cheers,
Jon



On 10/24/2014 5:12 PM, Angel Ferrero wrote:
>
> Hi everyone,
>
> I am new to doing this kind of thing in R, but I have been trying to perform co-kriging for a set of datapoints in relation to climate from the worldclim project based on a previous example I found using the meuse shp.
>
> This is my code, and at the end of it, you can see the error I get: identicalCRS(x, y) is not TRUE after using the over() command.
>
> I would appreciate if anybody could help me out this this.
>
> Best
>
> ?ngel
>
>
> #Let's first create a prediction grid for the interpolation, starting from the shape file
>
>
> setwd(?*")
> data<-read.table(?/*",header=T)
>
> coordinates(data)=~long+lat
>
> proj4string(data)=CRS("+proj=longlat +ellps=WGS84 +datum=WGS84")
>
> border0<-readOGR("country.shp","country")
> border <- spTransform(border0, CRS("+proj=longlat +ellps=WGS84 +datum=WGS84"))
> proj4string(border)=CRS("+proj=longlat +ellps=WGS84 +datum=WGS84")
>
> bio <- getData("worldclim", var="bio", res=10)   # this will download global data on minimum temperature at 10 min resolution
> # can also get other climatic data, elevation, administrative boundaries, etc
> bio1 <- raster(?*/wc10/bio1.bil")   # Tmin for January
> fromDisk(bio1)  # values are stored on disk instead of memory! (useful for
> bio1 <-bio1/10    # Worldclim temperature data come in decimal degrees
> bio1
> proj4string(bio1)=CRS("+proj=longlat +ellps=WGS84 +datum=WGS84")
>
>
> data <- spTransform(data, CRS("+proj=longlat +ellps=GRS80"))
> border <- spTransform(border, CRS("+proj=longlat +ellps=GRS80"))
>
>
> vals <-border at bbox
> deltaLong <- as.integer((vals[1,2] - vals[1,1]) + 1.5)
> deltaLat <- as.integer((vals[2,2] - vals[2,1]) + 1.5)
> gridRes <-20   #change this value to change the grid size (in metres)
> gridSizeX <- deltaLong / gridRes
> gridSizeY <- deltaLat / gridRes
> grd <- GridTopology(vals[,1],c(gridRes,gridRes),c(gridSizeX,gridSizeY))
> pts <- SpatialPoints(coordinates(grd))
> pts1 <- SpatialPointsDataFrame(as.data.frame(pts), data=as.data.frame(rep(1,nrow(as.data.frame(pts)))))
> Over=over(pts1,border)
> pts$border=Over
> espinete<-na.exclude(as.data.frame(pts1))
> coordinates(nona)=~x+y
> gridded(espinete) <- TRUE
> proj4string(espinete)=CRS("+proj=longlat +ellps=GRS80")
> writeAsciiGrid(nona,"prediction_grid.asc")
>
> When I run the
> Over=over(pts1,border)
> command, I get this error:
> Error: identicalCRS(x, y) is not TRUE
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Jon Olav Sk?ien
Joint Research Centre - European Commission
Institute for Environment and Sustainability (IES)
Climate Risk Management Unit

Via Fermi 2749, TP 100-01,  I-21027 Ispra (VA), ITALY

jon.skoien at jrc.ec.europa.eu
Tel:  +39 0332 789205

Disclaimer: Views expressed in this email are those of the individual 
and do not necessarily represent official views of the European Commission.


From Navinder.Singh at slu.se  Mon Oct 27 13:50:04 2014
From: Navinder.Singh at slu.se (Navinder Singh)
Date: Mon, 27 Oct 2014 12:50:04 +0000
Subject: [R-sig-Geo] Space-time movement Trajectory on a hovmoller plot
Message-ID: <334DA1F7-609C-4917-B563-49EDF5494DC2@slu.se>

Dear List,
Is there a way to plot spatio-temporal x,y/long-lat co-ordinates over a hovmoller diagram available in the rasterVis package.
I have some animal movement data which has x,y and time (as.Date) object attached to it and is from the same time period as snow.
Now i have created a ?hovmoller? plot from the rasterVis with interpolated snow data for an entire year with daily resolution and would like to overlay the animal locations during that period with respect to snow.
Is there a straightforward way to do it by using sp/raster/rasterVis/?.
Thanks,
Navinder





Navinder J Singh
Associate Professor
Department of Wildlife, Fish, and Environmental Studies
Faculty of Forest Sciences
Swedish University of Agricultural Sciences
SE-901 83 Umea, Sweden
O: +46 (0)90 786 8538;
M: +46 (0)70 676 0103
email: navinder.singh at slu.se<mailto:navinder.singh at slu.se>
Web: navinderjsingh.weebly.com<http://navinderjsingh.weebly.com/>

www.slu.se/viltfiskmiljo/navinder_singh<http://www.slu.se/viltfiskmiljo/navinder_singh>
http://slu-se.academia.edu/NSingh





	[[alternative HTML version deleted]]


From frtog at vestas.com  Mon Oct 27 15:08:25 2014
From: frtog at vestas.com (=?utf-8?B?RnJlZGUgQWFrbWFubiBUw7hnZXJzZW4=?=)
Date: Mon, 27 Oct 2014 15:08:25 +0100
Subject: [R-sig-Geo] Space-time movement Trajectory on a hovmoller plot
In-Reply-To: <334DA1F7-609C-4917-B563-49EDF5494DC2@slu.se>
References: <334DA1F7-609C-4917-B563-49EDF5494DC2@slu.se>
Message-ID: <B078CDF40DFE4045AF172A8B4F68FC4857C9956AB2@DKRDSEXC016.vestas.net>

Hi Navinder

You are starting a new thread here so I guess it is somewhat impolite of you to sort of requesting help from Oscar by including him on CC (so I have deleted from the CC).

Also please provide some code. Don't expect that people will respond to your questions if they have to do more involved work in order to show how to do the job.

The easiest answer from me to your question is to use some of the methods that Oscar and I already have shown you. Since a hovmoller diagram is based on the lattice functions contourplot() and levelplot() then you can use something like

hovmoller() + xyplot().

Yes that is easy. In any case here is an example from the man page of hovmoller():

library(rasterVis)
library(latticeExtra)
library(zoo)

url <- "ftp://ftp.wiley.com/public/sci_tech_med/spatio_temporal_data/"
sst.dat = read.table(paste(url, "SST011970_032003.dat", sep=''), header = FALSE) 
sst.ll = read.table(paste(url, "SSTlonlat.dat", sep=''), header = FALSE)

spSST <- SpatialPointsDataFrame(sst.ll, sst.dat)
gridded(spSST) <- TRUE
proj4string(spSST) = "+proj=longlat +datum=WGS84"
SST <- brick(spSST)

idx <- seq(as.Date('1970-01-01'), as.Date('2003-03-01'), by='month')
idx <- as.yearmon(idx)
SST <- setZ(SST, idx)
names(SST) <- as.character(idx)

### dummy points
somepoints <- data.frame(Time = as.yearmon(seq(as.Date("1980-01-01"),as.Date("1990-01-01"),by="6 month")),
                         Latitude = -10:10)

hovmoller(SST, panel=panel.levelplot.raster,
          xscale.components=xscale.raster.subticks,
          interpolate=TRUE, par.settings=RdBuTheme) +
              xyplot(Time ~ Latitude, data = somepoints, pch = 19, col = "black", cex = 1)
  

Yours sincerely / Med venlig hilsen


Frede Aakmann T?gersen
Specialist, M.Sc., Ph.D.
Plant Performance & Modeling

Technology & Service Solutions
T +45 9730 5135
M +45 2547 6050
frtog at vestas.com
http://www.vestas.com

Company reg. name: Vestas Wind Systems A/S
This e-mail is subject to our e-mail disclaimer statement.
Please refer to www.vestas.com/legal/notice
If you have received this e-mail in error please contact the sender. 


> -----Original Message-----
> From: r-sig-geo-bounces at r-project.org [mailto:r-sig-geo-bounces at r-
> project.org] On Behalf Of Navinder Singh
> Sent: 27. oktober 2014 13:50
> To: r-sig-geo at r-project.org; Oscar Perpi??n Lamigueiro
> Subject: [R-sig-Geo] Space-time movement Trajectory on a hovmoller plot
> 
> Dear List,
> Is there a way to plot spatio-temporal x,y/long-lat co-ordinates over a
> hovmoller diagram available in the rasterVis package.
> I have some animal movement data which has x,y and time (as.Date) object
> attached to it and is from the same time period as snow.
> Now i have created a ?hovmoller? plot from the rasterVis with interpolated
> snow data for an entire year with daily resolution and would like to overlay
> the animal locations during that period with respect to snow.
> Is there a straightforward way to do it by using sp/raster/rasterVis/?.
> Thanks,
> Navinder
> 
> 
> 
> 
> 
> Navinder J Singh
> Associate Professor
> Department of Wildlife, Fish, and Environmental Studies
> Faculty of Forest Sciences
> Swedish University of Agricultural Sciences
> SE-901 83 Umea, Sweden
> O: +46 (0)90 786 8538;
> M: +46 (0)70 676 0103
> email: navinder.singh at slu.se<mailto:navinder.singh at slu.se>
> Web: navinderjsingh.weebly.com<http://navinderjsingh.weebly.com/>
> 
> www.slu.se/viltfiskmiljo/navinder_singh<http://www.slu.se/viltfiskmiljo/na
> vinder_singh>
> http://slu-se.academia.edu/NSingh
> 
> 
> 
> 
> 
> 	[[alternative HTML version deleted]]


From st_john_brown at yahoo.com  Mon Oct 27 15:49:48 2014
From: st_john_brown at yahoo.com (St John Brown)
Date: Mon, 27 Oct 2014 07:49:48 -0700
Subject: [R-sig-Geo] Calculate the length of hail paths
Message-ID: <1414421388.24883.YahooMailNeo@web122406.mail.ne1.yahoo.com>

Hello,

I am trying to calculate the the length of the trajectory of historic hail storms in the United States. I have written the R code to do this but my results do not seem valid. The majority of my results are around 14 meters which does not seem correct.

My data comes from the NOAA in the form of a shape file (hail.zip) [1]. When I read the shape file I have an object of class SpatialLinesDataframe. The individual lines represent the paths of the historic hail storms.

Below I have created an example SpatialLines object with lines from the original data and my method for calculating the path length. As you can see the results are around 14 meters. Am I calculating the distances correctly?

I appreciate any help!

[1] http://www.spc.noaa.gov/gis/svrgis/

library(sp)
library(geosphere)

#create example SpatialLines obj
myLines1 = Lines(list(Line(matrix(c(-519049.1, -519039.1, -736427.4, -736417.4), nrow=2, ncol=2))), ID="1")
myLines2 = Lines(list(Line(matrix(c(527165, 527175, 261338.5, 261348.5), nrow=2, ncol=2))), ID="2")
proj_str_lcc = CRS("+proj=lcc +lat_1=33 +lat_2=45 +lat_0=39 +lon_0=-96 +x_0=0 +y_0=0 +datum=NAD83 +units=m +no_defs +ellps=GRS80 +towgs84=0,0,0")
mySpLines = SpatialLines(list(myLines1,myLines2), proj4string=proj_str_lcc)

#calculate distance of line paths
proj.str.alb = CRS("+proj=longlat +datum=WGS84")
mySpLines_alb = spTransform(mySpLines, CRS=proj.str.alb)

res = lapply(slot(mySpLines_alb, "lines"), function(x) lapply(slot(x, "Lines"),function(y) slot(y, "coords")))

f = function(i){
  end_pnts = unlist(res[i],use.names = F)
  p1 = end_pnts[c(1,3)]
  p2 = end_pnts[c(2,4)]
  return(distCosine(p1,p2)) #meters
}

d = sapply(1:length(res), FUN=f)

> d
[1] 14.14557 14.21278 #meters


From Sarah.Schmid at unil.ch  Mon Oct 27 16:30:26 2014
From: Sarah.Schmid at unil.ch (Schmid Sarah)
Date: Mon, 27 Oct 2014 15:30:26 +0000
Subject: [R-sig-Geo] Package Ncf and p-value
Message-ID: <9268B8F7-ACE9-4952-B336-E1C452E12911@unil.ch>

Dear list, 

I?m new in spatial analysis and I?m currently working on a project to test spatial autocorrelation. To do that, I tested different packages. I?m now working with the package NCF and I used the functions ? correlog ? and ? plot correlog ? to create a spatial correlogram. The ? correlog ? function gives an output like this:

$n
 1  2  3  4  5  6  7  8  9 10 11 12 13 
10 30 34 34 37 16 12 12 16  4  1  2  2 

$mean.of.class
        1         2         3         4         5         6         7         8         9 
 1549.835  3943.671  6244.956  8892.066 11016.439 13612.315 16021.493 18720.450 21273.439 
       10        11        12        13 
23958.896 25387.395 28385.142 31038.719 

$correlation
          1           2           3           4           5           6           7 
 0.33199900 -0.27605309 -0.11705592  0.08689537  0.08344518 -0.37666967 -0.08440457 
          8           9          10          11          12          13 
-0.18318189  0.12377523 -0.35018005 -0.24026463  0.86372582 -0.21476426 

$x.intercept
(Intercept) 
   2636.626 

$p
 [1] 0.09490509 0.08591409 0.31968032 0.17882118 0.18781219 0.08591409 0.47352647 0.29570430
 [9] 0.17582418 0.25474525 0.40159840 0.07192807 0.34465534

So, my question is about the p-value. Are they already corrected for multiple tests or should I use a a method like the Holm?s correction procedure?  

Thank you very much for your help 

Sarah 

From edzer.pebesma at uni-muenster.de  Mon Oct 27 19:32:45 2014
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Mon, 27 Oct 2014 19:32:45 +0100
Subject: [R-sig-Geo] spacetime EOF implementation - interpretation
	question
In-Reply-To: <CAFTcopdoKkxSnMdBA=OQRs+5_ZwRtB6Na6ZD7U3br4dOdeZVgw@mail.gmail.com>
References: <CAFTcopdoKkxSnMdBA=OQRs+5_ZwRtB6Na6ZD7U3br4dOdeZVgw@mail.gmail.com>
Message-ID: <544E8FCD.90600@uni-muenster.de>

Thanks for bringing this up, Andrew, for the note, and for the example.
I looked into the note, into Wilks, and into Cressie & Wikle, which I
tried to follow when I wrote EOF.

I decided to deprecate spacetime::EOF. It computes principle component
scores from the m x p space-time matrix or its transpose, which might be
useful to some, but what it does is too far from the EOF literature to
be helpful. In particular, it confused "spatial" and "temporal" modes,
as C & W use these terms.

I added a new function, spacetime::eof, which should do what the
literature describes as EOF: return the eigenvector coefficients of the
rotation matrix. Argument returnEOFs = FALSE gives back the prcomp
object, feeding that to predict() gives the scores.

Reproducing the figures in C & W Ch 5 looks now better, up to expected
sign changes, but the numerical ranges are still different.

Please reinstall spacetime from github, use eof, and see if things now
work as expected. demo(CressieWikle) is now updated as well.

In your example below, you normalize by

> PCs = apply(seof$rotation, 2, function(x) (x - mean(x)) / sd(x))

but why? Eigenvectors are already standardized, but to unit length; is
this another convention of the EOF world?

With best regards,

On 10/24/2014 12:04 AM, Andrew Vitale wrote:
> Hello,
> 
> I'm performing an empirical orthogonal function analysis on sea level
> pressure using the spacetime package, and I'm having trouble determining
> which elements of the function output I should use to interpret the results.
> 
> It seems that most examples in the literature calculate empirical
> orthogonal functions (EOFs) and their associated principle component (PC)
> time series (e.g. http://www.met.reading.ac.uk/~han/Monitor/eofprimer.pdf ,
> pp 11-12, Fig. 2, 3).  As far as I can tell, I should be able to extract
> all of the relevant information using only the spatial mode in the
> spacetime:::EOF function.  However, the ambiguous terminology in the
> literature and the availability of the "temporal" mode in spacetime:::EOF
> have me uncertain of my interpretation.
> 
> I have been treating the output of spacetime:::EOF with
> returnPredictions=TRUE as the EOFs, and I have been treating the
> spacetime:::EOF $rotation element with returnPredictions=FALSE as the PCs.
> 
> Am I extracting the proper information from the spacetime:::EOF results?
> Are the results of the spatial and temporal modes of spacetime:::EOF both
> required to perform an EOF analysis of a sea level pressure field, or are
> these two separate analyses?
> 
> Below is a small example of how I am currently extracting the spatial EOFs
> and their associated PCs.
> 
> Thanks for any comments,
> Andrew Vitale
> 
> 
> library(raster)
> library(spacetime)
> 
> ## Create a raster object that mimics my data
> ## which is actually a raster stack of 20,718
> ## daily sea level pressure anomolies
> a = array(rnorm(9*9*100), c(9,9,100))
> b = brick(a)
> b = setValues(b, a)
> z = seq(as.Date('1980-01-01'), as.Date('1980-04-09'),
>         by = 'day')
> b = setZ(b, z)
> 
> ## coerce the raster stack to an STFDF object
> st = as(b, 'STFDF')
> 
> ## calculate EOFs in spatial mode using spacetime
> seof = EOF(st, how='spatial', returnPredictions=FALSE, scale.=TRUE)
> seof_preds = EOF(st, how='spatial', returnPredictions=TRUE, scale.=TRUE)
> 
> ## Create a raster stack of the predictions, which seem to be
> ## generally referred to as EOFs in the literature
> EOFs = stack(seof_preds)
> ## extract and standardize the rotation element of the
> ## seof object, which seems to be the eigenvectors, which seem
> ## to also be referred to as PCs in the literature
> PCs = apply(seof$rotation, 2, function(x) (x - mean(x)) / sd(x))
> 
> ## Plot the EOFs as maps (seof_preds)
> plot(EOFs)
> 
> ## Plot the first PC (seof$rotation [standardized])
> x11(height=7, width=10)
> plot(x=as.Date(row.names(PCs), format='X%Y.%m.%d'),
>      y=PCs[ , 1], type='l', xlab='Date', ylab='Standardized PC1')
> 
> 

-- 
Edzer Pebesma,  Co-Editor-in-Chief Computers & Geosciences
Institute for Geoinformatics (ifgi), University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
83 33081 http://ifgi.uni-muenster.de GPG key ID 0xAC227795

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 490 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20141027/86148ae8/attachment.bin>

From steven.ranney at gmail.com  Tue Oct 28 01:43:52 2014
From: steven.ranney at gmail.com (Steven Ranney)
Date: Mon, 27 Oct 2014 18:43:52 -0600
Subject: [R-sig-Geo] Generate a vector of names of intersecting polgons
Message-ID: <CANDt99r7MiwrQL0nY+wT0zsm9A7hM8qsL3UszOcksNew1XVvWA@mail.gmail.com>

All -

As a disclaimer, I admit that I am relatively new to spatial data
manipulation with R.  I am familiar with some of the more basic functions
and packages but need some guidance.

What I want to do:

I have two .shp files, shpA and shpB, both of which contain many polygons.
I would like to overlay shpA on shpB and get a vector of the polygon names
in shpB that intersect with polygons in shpA.  In a perfect world, I would
then be able to join the vector of names to each polygon in shpA as a new
attribute.

I tried using over() but over() didn't like the fact that both of my .shp
files were SpatialPolygonsDataFrames.

Is there a simple way to do this?  Can anyone offer some advice?

Thanks -

SR
Steven H. Ranney

	[[alternative HTML version deleted]]


From r.hijmans at gmail.com  Tue Oct 28 04:04:15 2014
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Mon, 27 Oct 2014 20:04:15 -0700
Subject: [R-sig-Geo] Generate a vector of names of intersecting polgons
In-Reply-To: <CANDt99r7MiwrQL0nY+wT0zsm9A7hM8qsL3UszOcksNew1XVvWA@mail.gmail.com>
References: <CANDt99r7MiwrQL0nY+wT0zsm9A7hM8qsL3UszOcksNew1XVvWA@mail.gmail.com>
Message-ID: <CANtt_hyji4_5zK2f6CGxzJfUBPSO0a-=B3BXwy_BJvRWOFCBxA@mail.gmail.com>

Steven, I believe you can use something like the below

library(raster)
# example data (p, d)
p <- shapefile(system.file("external/lux.shp", package="raster"))
r <- raster(p)
values(r) <- 1:ncell(r)
d <- as(r, 'SpatialPolygonsDataFrame')

# approach 1
x <- intersect(p, d)

# approach 2
y <- union(p,d)
y <- y[!is.na(y$ID_1), ])

The approach to take depends on the case (does B fall entirely within A?)



On Mon, Oct 27, 2014 at 5:43 PM, Steven Ranney <steven.ranney at gmail.com> wrote:
> All -
>
> As a disclaimer, I admit that I am relatively new to spatial data
> manipulation with R.  I am familiar with some of the more basic functions
> and packages but need some guidance.
>
> What I want to do:
>
> I have two .shp files, shpA and shpB, both of which contain many polygons.
> I would like to overlay shpA on shpB and get a vector of the polygon names
> in shpB that intersect with polygons in shpA.  In a perfect world, I would
> then be able to join the vector of names to each polygon in shpA as a new
> attribute.
>
> I tried using over() but over() didn't like the fact that both of my .shp
> files were SpatialPolygonsDataFrames.
>
> Is there a simple way to do this?  Can anyone offer some advice?
>
> Thanks -
>
> SR
> Steven H. Ranney
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From frtog at vestas.com  Tue Oct 28 08:08:55 2014
From: frtog at vestas.com (=?iso-8859-1?Q?Frede_Aakmann_T=F8gersen?=)
Date: Tue, 28 Oct 2014 08:08:55 +0100
Subject: [R-sig-Geo] Calculate the length of hail paths
In-Reply-To: <1414421388.24883.YahooMailNeo@web122406.mail.ne1.yahoo.com>
References: <1414421388.24883.YahooMailNeo@web122406.mail.ne1.yahoo.com>
Message-ID: <B078CDF40DFE4045AF172A8B4F68FC4857C9956C0D@DKRDSEXC016.vestas.net>

Hi

Why not check your results with calculators for great-circle distance like http://www.movable-type.co.uk/scripts/latlong.html. There the haversine formula is used. Using 

> res[[1]]
[[1]]
          [,1]    [,2]
[1,] -101.5000 32.2000
[2,] -101.4999 32.2001

> res[[2]]
[[1]]
          [,1]     [,2]
[1,] -89.68000 41.20000
[2,] -89.67987 41.20008

I get the distances 0.01457 km and 0.01405 km from that homepage.

Using the distHaversine() instead of distCosine() (see the above URL for the difference) then I get the distances 14.14557 and 14.21278 in meters. However the above homepage uses 6371 km as the radius of the earth whereas geosphere uses 6378137 m. There could be other subtleties having influence on the decimal precision. 

Yours sincerely / Med venlig hilsen


Frede Aakmann T?gersen
Specialist, M.Sc., Ph.D.
Plant Performance & Modeling

Technology & Service Solutions
T +45 9730 5135
M +45 2547 6050
frtog at vestas.com
http://www.vestas.com

Company reg. name: Vestas Wind Systems A/S
This e-mail is subject to our e-mail disclaimer statement.
Please refer to www.vestas.com/legal/notice
If you have received this e-mail in error please contact the sender. 


> -----Original Message-----
> From: r-sig-geo-bounces at r-project.org [mailto:r-sig-geo-bounces at r-
> project.org] On Behalf Of St John Brown
> Sent: 27. oktober 2014 15:50
> To: r-sig-geo at r-project.org
> Subject: [R-sig-Geo] Calculate the length of hail paths
> 
> Hello,
> 
> I am trying to calculate the the length of the trajectory of historic hail storms
> in the United States. I have written the R code to do this but my results do
> not seem valid. The majority of my results are around 14 meters which does
> not seem correct.
> 
> My data comes from the NOAA in the form of a shape file (hail.zip) [1]. When
> I read the shape file I have an object of class SpatialLinesDataframe. The
> individual lines represent the paths of the historic hail storms.
> 
> Below I have created an example SpatialLines object with lines from the
> original data and my method for calculating the path length. As you can see
> the results are around 14 meters. Am I calculating the distances correctly?
> 
> I appreciate any help!
> 
> [1] http://www.spc.noaa.gov/gis/svrgis/
> 
> library(sp)
> library(geosphere)
> 
> #create example SpatialLines obj
> myLines1 = Lines(list(Line(matrix(c(-519049.1, -519039.1, -736427.4, -
> 736417.4), nrow=2, ncol=2))), ID="1")
> myLines2 = Lines(list(Line(matrix(c(527165, 527175, 261338.5, 261348.5),
> nrow=2, ncol=2))), ID="2")
> proj_str_lcc = CRS("+proj=lcc +lat_1=33 +lat_2=45 +lat_0=39 +lon_0=-96
> +x_0=0 +y_0=0 +datum=NAD83 +units=m +no_defs +ellps=GRS80
> +towgs84=0,0,0")
> mySpLines = SpatialLines(list(myLines1,myLines2), proj4string=proj_str_lcc)
> 
> #calculate distance of line paths
> proj.str.alb = CRS("+proj=longlat +datum=WGS84")
> mySpLines_alb = spTransform(mySpLines, CRS=proj.str.alb)
> 
> res = lapply(slot(mySpLines_alb, "lines"), function(x) lapply(slot(x,
> "Lines"),function(y) slot(y, "coords")))
> 
> f = function(i){
>   end_pnts = unlist(res[i],use.names = F)
>   p1 = end_pnts[c(1,3)]
>   p2 = end_pnts[c(2,4)]
>   return(distCosine(p1,p2)) #meters
> }
> 
> d = sapply(1:length(res), FUN=f)
> 
> > d
> [1] 14.14557 14.21278 #meters
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From Navinder.Singh at slu.se  Mon Oct 27 16:15:09 2014
From: Navinder.Singh at slu.se (Navinder Singh)
Date: Mon, 27 Oct 2014 15:15:09 +0000
Subject: [R-sig-Geo] Space-time movement Trajectory on a hovmoller plot
In-Reply-To: <B078CDF40DFE4045AF172A8B4F68FC4857C9956AB2@DKRDSEXC016.vestas.net>
References: <334DA1F7-609C-4917-B563-49EDF5494DC2@slu.se>
	<B078CDF40DFE4045AF172A8B4F68FC4857C9956AB2@DKRDSEXC016.vestas.net>
Message-ID: <71B34D45-6985-444F-9C04-DE0FAEDBA1C1@slu.se>

Sorry Frede,
Since Oscar was the one writing the rasterVis package, i thought i could specifically include him as well.
Also, i had not yet given a try with the code, so i couldn?t post it. Ill now give a try to your suggestion.
Thanks again.


Navinder J Singh
Associate Professor
Department of Wildlife, Fish, and Environmental Studies
Faculty of Forest Sciences
Swedish University of Agricultural Sciences
SE-901 83 Umea, Sweden
O: +46 (0)90 786 8538;
M: +46 (0)70 676 0103
email: navinder.singh at slu.se<mailto:navinder.singh at slu.se>
Web: navinderjsingh.weebly.com<http://navinderjsingh.weebly.com/>

www.slu.se/viltfiskmiljo/navinder_singh<http://www.slu.se/viltfiskmiljo/navinder_singh>
http://slu-se.academia.edu/NSingh




On 27 Oct 2014, at 15:08, Frede Aakmann T?gersen <frtog at vestas.com<mailto:frtog at vestas.com>> wrote:

library(rasterVis)
library(latticeExtra)
library(zoo)

url <- "ftp://ftp.wiley.com/public/sci_tech_med/spatio_temporal_data/"
sst.dat = read.table(paste(url, "SST011970_032003.dat", sep=''), header = FALSE)
sst.ll = read.table(paste(url, "SSTlonlat.dat", sep=''), header = FALSE)

spSST <- SpatialPointsDataFrame(sst.ll, sst.dat)
gridded(spSST) <- TRUE
proj4string(spSST) = "+proj=longlat +datum=WGS84"
SST <- brick(spSST)

idx <- seq(as.Date('1970-01-01'), as.Date('2003-03-01'), by='month')
idx <- as.yearmon(idx)
SST <- setZ(SST, idx)
names(SST) <- as.character(idx)

### dummy points
somepoints <- data.frame(Time = as.yearmon(seq(as.Date("1980-01-01"),as.Date("1990-01-01"),by="6 month")),
                        Latitude = -10:10)

hovmoller(SST, panel=panel.levelplot.raster,
         xscale.components=xscale.raster.subticks,
         interpolate=TRUE, par.settings=RdBuTheme) +
             xyplot(Time ~ Latitude, data = somepoints, pch = 19, col = "black", cex = 1)



	[[alternative HTML version deleted]]


From b.rowlingson at lancaster.ac.uk  Tue Oct 28 10:24:55 2014
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Tue, 28 Oct 2014 09:24:55 +0000
Subject: [R-sig-Geo] Calculate the length of hail paths
In-Reply-To: <1e2cb969f24441959f7c87d0170a33eb@EX-1-HT0.lancs.local>
References: <1414421388.24883.YahooMailNeo@web122406.mail.ne1.yahoo.com>
	<1e2cb969f24441959f7c87d0170a33eb@EX-1-HT0.lancs.local>
Message-ID: <CANVKczNQBti=ZW34htE=pC5AtjdG+KziraXtt2tqX5zUEMe-nA@mail.gmail.com>

On this small scale, you can almost use pythagoras to see that the answer
is about 14 metres:

myLines1 = Lines(list(Line(matrix(c(-
519049.1, -519039.1, -736427.4, -736417.4), nrow=2, ncol=2))), ID="1")

the change in X is 10, the change in Y is 10, hence the distance is
sqrt(10^2 + 10^2) which is 10*sqrt(2) = 14.1. You say your original units
are in metres, so the answer is in metres.

Is your problem that you were expecting tracks to be kilometres long? In
which case either your units are wrong or this is just a segment of a track
and you need to piece together a whole bunch of them. I've not looked at
the shapefile yet...


Barry



On Tue, Oct 28, 2014 at 7:08 AM, Frede Aakmann T?gersen <frtog at vestas.com>
wrote:

> Hi
>
> Why not check your results with calculators for great-circle distance like
> http://www.movable-type.co.uk/scripts/latlong.html. There the haversine
> formula is used. Using
>
> > res[[1]]
> [[1]]
>           [,1]    [,2]
> [1,] -101.5000 32.2000
> [2,] -101.4999 32.2001
>
> > res[[2]]
> [[1]]
>           [,1]     [,2]
> [1,] -89.68000 41.20000
> [2,] -89.67987 41.20008
>
> I get the distances 0.01457 km and 0.01405 km from that homepage.
>
> Using the distHaversine() instead of distCosine() (see the above URL for
> the difference) then I get the distances 14.14557 and 14.21278 in meters.
> However the above homepage uses 6371 km as the radius of the earth whereas
> geosphere uses 6378137 m. There could be other subtleties having influence
> on the decimal precision.
>
> Yours sincerely / Med venlig hilsen
>
>
> Frede Aakmann T?gersen
> Specialist, M.Sc., Ph.D.
> Plant Performance & Modeling
>
> Technology & Service Solutions
> T +45 9730 5135
> M +45 2547 6050
> frtog at vestas.com
> http://www.vestas.com
>
> Company reg. name: Vestas Wind Systems A/S
> This e-mail is subject to our e-mail disclaimer statement.
> Please refer to www.vestas.com/legal/notice
> If you have received this e-mail in error please contact the sender.
>
>
> > -----Original Message-----
> > From: r-sig-geo-bounces at r-project.org [mailto:r-sig-geo-bounces at r-
> > project.org] On Behalf Of St John Brown
> > Sent: 27. oktober 2014 15:50
> > To: r-sig-geo at r-project.org
> > Subject: [R-sig-Geo] Calculate the length of hail paths
> >
> > Hello,
> >
> > I am trying to calculate the the length of the trajectory of historic
> hail storms
> > in the United States. I have written the R code to do this but my
> results do
> > not seem valid. The majority of my results are around 14 meters which
> does
> > not seem correct.
> >
> > My data comes from the NOAA in the form of a shape file (hail.zip) [1].
> When
> > I read the shape file I have an object of class SpatialLinesDataframe.
> The
> > individual lines represent the paths of the historic hail storms.
> >
> > Below I have created an example SpatialLines object with lines from the
> > original data and my method for calculating the path length. As you can
> see
> > the results are around 14 meters. Am I calculating the distances
> correctly?
> >
> > I appreciate any help!
> >
> > [1] http://www.spc.noaa.gov/gis/svrgis/
> >
> > library(sp)
> > library(geosphere)
> >
> > #create example SpatialLines obj
> > myLines1 = Lines(list(Line(matrix(c(-519049.1, -519039.1, -736427.4, -
> > 736417.4), nrow=2, ncol=2))), ID="1")
> > myLines2 = Lines(list(Line(matrix(c(527165, 527175, 261338.5, 261348.5),
> > nrow=2, ncol=2))), ID="2")
> > proj_str_lcc = CRS("+proj=lcc +lat_1=33 +lat_2=45 +lat_0=39 +lon_0=-96
> > +x_0=0 +y_0=0 +datum=NAD83 +units=m +no_defs +ellps=GRS80
> > +towgs84=0,0,0")
> > mySpLines = SpatialLines(list(myLines1,myLines2),
> proj4string=proj_str_lcc)
> >
> > #calculate distance of line paths
> > proj.str.alb = CRS("+proj=longlat +datum=WGS84")
> > mySpLines_alb = spTransform(mySpLines, CRS=proj.str.alb)
> >
> > res = lapply(slot(mySpLines_alb, "lines"), function(x) lapply(slot(x,
> > "Lines"),function(y) slot(y, "coords")))
> >
> > f = function(i){
> >   end_pnts = unlist(res[i],use.names = F)
> >   p1 = end_pnts[c(1,3)]
> >   p2 = end_pnts[c(2,4)]
> >   return(distCosine(p1,p2)) #meters
> > }
> >
> > d = sapply(1:length(res), FUN=f)
> >
> > > d
> > [1] 14.14557 14.21278 #meters
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From b.rowlingson at lancaster.ac.uk  Tue Oct 28 10:47:29 2014
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Tue, 28 Oct 2014 09:47:29 +0000
Subject: [R-sig-Geo] Calculate the length of hail paths
In-Reply-To: <34dc2e6818764b43b15a39fd8e425986@EX-0-HT0.lancs.local>
References: <34dc2e6818764b43b15a39fd8e425986@EX-0-HT0.lancs.local>
Message-ID: <CANVKczOP4oZ1MG51NO-pCyh_-Crb65YMcZo0_ZY-uRZURBs=iw@mail.gmail.com>

I downloaded the hail and tornado shapefile It looks like hailstorms in the
original data files don't really move, except maybe one 10m grid square.
This first one from 2013 goes nowhere:

Slot "coords":
         [,1]      [,2]
[1,] 185758.3 -246307.6
[2,] 185758.3 -246307.6

I reckon theyve tried to use the same format as the tornado data, which can
have quite large differences between start and end point, but hailstorms
are such a short intense event that the motion isn't important relative to
the size.

So I don't think there's essentially any "track" information in the data,
and it should be considered point events.

Barry




On Mon, Oct 27, 2014 at 2:49 PM, St John Brown <st_john_brown at yahoo.com>
wrote:

> Hello,
>
> I am trying to calculate the the length of the trajectory of historic hail
> storms in the United States. I have written the R code to do this but my
> results do not seem valid. The majority of my results are around 14 meters
> which does not seem correct.
>
> My data comes from the NOAA in the form of a shape file (hail.zip) [1].
> When I read the shape file I have an object of class SpatialLinesDataframe.
> The individual lines represent the paths of the historic hail storms.
>
> Below I have created an example SpatialLines object with lines from the
> original data and my method for calculating the path length. As you can see
> the results are around 14 meters. Am I calculating the distances correctly?
>
> I appreciate any help!
>
> [1] http://www.spc.noaa.gov/gis/svrgis/
>
> library(sp)
> library(geosphere)
>
> #create example SpatialLines obj
> myLines1 = Lines(list(Line(matrix(c(-519049.1, -519039.1, -736427.4,
> -736417.4), nrow=2, ncol=2))), ID="1")
> myLines2 = Lines(list(Line(matrix(c(527165, 527175, 261338.5, 261348.5),
> nrow=2, ncol=2))), ID="2")
> proj_str_lcc = CRS("+proj=lcc +lat_1=33 +lat_2=45 +lat_0=39 +lon_0=-96
> +x_0=0 +y_0=0 +datum=NAD83 +units=m +no_defs +ellps=GRS80 +towgs84=0,0,0")
> mySpLines = SpatialLines(list(myLines1,myLines2), proj4string=proj_str_lcc)
>
> #calculate distance of line paths
> proj.str.alb = CRS("+proj=longlat +datum=WGS84")
> mySpLines_alb = spTransform(mySpLines, CRS=proj.str.alb)
>
> res = lapply(slot(mySpLines_alb, "lines"), function(x) lapply(slot(x,
> "Lines"),function(y) slot(y, "coords")))
>
> f = function(i){
>   end_pnts = unlist(res[i],use.names = F)
>   p1 = end_pnts[c(1,3)]
>   p2 = end_pnts[c(2,4)]
>   return(distCosine(p1,p2)) #meters
> }
>
> d = sapply(1:length(res), FUN=f)
>
> > d
> [1] 14.14557 14.21278 #meters
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From marceivissa at gmail.com  Tue Oct 28 15:12:29 2014
From: marceivissa at gmail.com (=?UTF-8?Q?Marc_Mar=C3=AD_Dell=27Olmo?=)
Date: Tue, 28 Oct 2014 15:12:29 +0100
Subject: [R-sig-Geo] gUnion error -> TopologyException: side location
	conflict at...
Message-ID: <CAAZSCQ4oXJcCevRsnn7qEgEQfCOxmE9WdCq3wCyDY-B9ODs9+g@mail.gmail.com>

Dear all,

I would like to join the polygons of two maps (with
SpatialPolygonsDataFrame format). I was trying to use gUnion funcition
(rgeos library) but I obtained the following error:

> setwd("R:/CARTOGRAFIA/Barcelona")
>
> BCN.SC<-readShapeSpatial("barcelona_SC2001.shp")
> proj4string(BCN.SC) <- CRS("+proj=merc +datum=WGS84 +units=m")
> BCN.SC<- spTransform(BCN.SC, CRS("+init=epsg:23031")) #ED50
> BCN.CP<-readShapeSpatial("Dist_postals_BCN.shp") #ED50
> proj4string(BCN.CP) <- CRS("+init=epsg:23031")
>
> gIsValid(BCN.CP)
[1] TRUE
> gIsValid(BCN.SC)
[1] TRUE
>
>
> aux <- gUnion(BCN.SC,BCN.CP)
Error in RGEOSBinTopoFunc(spgeom1, spgeom2, byid, id, drop_lower_td,
"rgeos_union") :
  TopologyException: side location conflict at 425106.60792063997
4583876.4374835696

I can't understand what's happening, glsValid is true for both shp
files. Moreover, I've made a zoom to this point and I can see anything
wrong.

Thank you for your help,

Marc


From st_john_brown at yahoo.com  Tue Oct 28 18:29:19 2014
From: st_john_brown at yahoo.com (St John Brown)
Date: Tue, 28 Oct 2014 10:29:19 -0700
Subject: [R-sig-Geo] Calculate the length of hail paths
In-Reply-To: <CANVKczOP4oZ1MG51NO-pCyh_-Crb65YMcZo0_ZY-uRZURBs=iw@mail.gmail.com>
References: <34dc2e6818764b43b15a39fd8e425986@EX-0-HT0.lancs.local>
	<CANVKczOP4oZ1MG51NO-pCyh_-Crb65YMcZo0_ZY-uRZURBs=iw@mail.gmail.com>
Message-ID: <1414517359.29961.YahooMailNeo@web122402.mail.ne1.yahoo.com>

Frede and Barry,

Thank you very much for your responses. I spoke directly with the NOAA person responsible for maintaining the data. He said that the spatial lines do not represent paths, but point observations. I made an assumption that the lines were hail paths because there was no text describing the data. I close my question.

Thank you,

St. John


On Tuesday, October 28, 2014 4:47 AM, Barry Rowlingson <b.rowlingson at lancaster.ac.uk> wrote:
 


I downloaded the hail and tornado shapefile It looks like hailstorms in the original data files don't really move, except maybe one 10m grid square. This first one from 2013 goes nowhere:

Slot "coords":
         [,1]      [,2]
[1,] 185758.3 -246307.6
[2,] 185758.3 -246307.6

I reckon theyve tried to use the same format as the tornado data, which can have quite large differences between start and end point, but hailstorms are such a short intense event that the motion isn't important relative to the size. 

So I don't think there's essentially any "track" information in the data, and it should be considered point events.

Barry






On Mon, Oct 27, 2014 at 2:49 PM, St John Brown <st_john_brown at yahoo.com> wrote:

Hello,
>
>I am trying to calculate the the length of the trajectory of historic hail storms in the United States. I have written the R code to do this but my results do not seem valid. The majority of my results are around 14 meters which does not seem correct.
>
>My data comes from the NOAA in the form of a shape file (hail.zip) [1]. When I read the shape file I have an object of class SpatialLinesDataframe. The individual lines represent the paths of the historic hail storms.
>
>Below I have created an example SpatialLines object with lines from the original data and my method for calculating the path length. As you can see the results are around 14 meters. Am I calculating the distances correctly?
>
>I appreciate any help!
>
>[1] http://www.spc.noaa.gov/gis/svrgis/
>
>library(sp)
>library(geosphere)
>
>#create example SpatialLines obj
>myLines1 = Lines(list(Line(matrix(c(-519049.1, -519039.1, -736427.4, -736417.4), nrow=2, ncol=2))), ID="1")
>myLines2 = Lines(list(Line(matrix(c(527165, 527175, 261338.5, 261348.5), nrow=2, ncol=2))), ID="2")
>proj_str_lcc = CRS("+proj=lcc +lat_1=33 +lat_2=45 +lat_0=39 +lon_0=-96 +x_0=0 +y_0=0 +datum=NAD83 +units=m +no_defs +ellps=GRS80 +towgs84=0,0,0")
>mySpLines = SpatialLines(list(myLines1,myLines2), proj4string=proj_str_lcc)
>
>#calculate distance of line paths
>proj.str.alb = CRS("+proj=longlat +datum=WGS84")
>mySpLines_alb = spTransform(mySpLines, CRS=proj.str.alb)
>
>res = lapply(slot(mySpLines_alb, "lines"), function(x) lapply(slot(x, "Lines"),function(y) slot(y, "coords")))
>
>f = function(i){
>  end_pnts = unlist(res[i],use.names = F)
>  p1 = end_pnts[c(1,3)]
>  p2 = end_pnts[c(2,4)]
>  return(distCosine(p1,p2)) #meters
>}
>
>d = sapply(1:length(res), FUN=f)
>
>> d
>[1] 14.14557 14.21278 #meters
>
>_______________________________________________
>R-sig-Geo mailing list
>R-sig-Geo at r-project.org
>https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
	[[alternative HTML version deleted]]


From mdsumner at gmail.com  Tue Oct 28 22:43:56 2014
From: mdsumner at gmail.com (Michael Sumner)
Date: Wed, 29 Oct 2014 08:43:56 +1100
Subject: [R-sig-Geo] gUnion error -> TopologyException: side location
 conflict at...
In-Reply-To: <CAAZSCQ4oXJcCevRsnn7qEgEQfCOxmE9WdCq3wCyDY-B9ODs9+g@mail.gmail.com>
References: <CAAZSCQ4oXJcCevRsnn7qEgEQfCOxmE9WdCq3wCyDY-B9ODs9+g@mail.gmail.com>
Message-ID: <CAAcGz99VGJkr=L0RVUw4CVbLfAC3odDrTChuR2XU0jVEA0KDgQ@mail.gmail.com>

I've found you can get around this error from some rgeos functions
(like gIntersection) by using the byid = TRUE argument, and in the
extreme you can iterate over one or both sets individually and collate
the results. I haven't been able to construct a clear example to
isolate the cause of the problem.

Since it's a union perhaps you can gUnaryUnion each object together
first. But is that the goal? One big union object, or a per-ID union
matching objects from the two sets? (I think I understand this, but
again I'd like to build a set of examples that make it clear).

Cheers, Mike.

On Wed, Oct 29, 2014 at 1:12 AM, Marc Mar? Dell'Olmo
<marceivissa at gmail.com> wrote:
> Dear all,
>
> I would like to join the polygons of two maps (with
> SpatialPolygonsDataFrame format). I was trying to use gUnion funcition
> (rgeos library) but I obtained the following error:
>
>> setwd("R:/CARTOGRAFIA/Barcelona")
>>
>> BCN.SC<-readShapeSpatial("barcelona_SC2001.shp")
>> proj4string(BCN.SC) <- CRS("+proj=merc +datum=WGS84 +units=m")
>> BCN.SC<- spTransform(BCN.SC, CRS("+init=epsg:23031")) #ED50
>> BCN.CP<-readShapeSpatial("Dist_postals_BCN.shp") #ED50
>> proj4string(BCN.CP) <- CRS("+init=epsg:23031")
>>
>> gIsValid(BCN.CP)
> [1] TRUE
>> gIsValid(BCN.SC)
> [1] TRUE
>>
>>
>> aux <- gUnion(BCN.SC,BCN.CP)
> Error in RGEOSBinTopoFunc(spgeom1, spgeom2, byid, id, drop_lower_td,
> "rgeos_union") :
>   TopologyException: side location conflict at 425106.60792063997
> 4583876.4374835696
>
> I can't understand what's happening, glsValid is true for both shp
> files. Moreover, I've made a zoom to this point and I can see anything
> wrong.
>
> Thank you for your help,
>
> Marc
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



-- 
Michael Sumner
Software and Database Engineer
Australian Antarctic Division
Hobart, Australia
e-mail: mdsumner at gmail.com


From vitale232 at gmail.com  Wed Oct 29 02:45:11 2014
From: vitale232 at gmail.com (Andrew Vitale)
Date: Tue, 28 Oct 2014 18:45:11 -0700
Subject: [R-sig-Geo] spacetime EOF implementation - interpretation
	question
In-Reply-To: <544E8FCD.90600@uni-muenster.de>
References: <CAFTcopdoKkxSnMdBA=OQRs+5_ZwRtB6Na6ZD7U3br4dOdeZVgw@mail.gmail.com>
	<544E8FCD.90600@uni-muenster.de>
Message-ID: <CAFTcopf0U1eo9eOdYZ66q7fooxWYYzfVEJtXGsJfqUKq62rYZg@mail.gmail.com>

Edzer,

Thanks a bunch for looking in to this!

Just to double check that everything looked correct, I conducted an EOF
analysis on the same data with the R spacetime package on GitHub
<https://github.com/edzer/spacetime> and with the Python eofs
<http://ajdawson.github.io/eofs/api/eofs.standard.html#eofs.standard.Eof>
package.

Here is a link
<https://plus.google.com/u/0/photos/+AndrewVitale/albums/6075420991607598513/6075420995240106354?pid=6075420995240106354&oid=106112792577057082777>
to an album of figures (if you end up checking out the figures, note that
you can zoom in with the mouse wheel).  I've plotted out the first 4 EOFs
(maps) from R and Python, the entirety of the first four PCs (time series)
from R and Python, and the last 365 days of the PCs time series from both R
and Python.  The spatial and temporal patterns look to be qualitatively
similar, although I haven't had a chance to compare them quantitatively yet.

The only reason I decided to normalize the PCs was to try and make it look
more like some papers/books I've seen.  My uncertainty surrounding the
range of PC values was the biggest reason I came to the list with my
questions.  The "EOF Primer" that I sent in my original message (
http://www.met.reading.ac.uk/~han/Monitor/eofprimer.pdf , pp 11-12, Fig. 2,
3) claims to "standardi[ze the PCs] to have zero mean and unit variance",
and the Python eofs module includes the option of returning scaled PC and
EOF values with two different methods.  It seems that the biggest source of
confusion throughout the process of this analysis has been varying
terminology and slightly different methods all thrown under the EOF blanket.

Thanks again for looking in to this and making such a speedy correction to
the source code.  You've helped tremendously.

-Andrew

On Mon, Oct 27, 2014 at 11:32 AM, Edzer Pebesma <
edzer.pebesma at uni-muenster.de> wrote:

> Thanks for bringing this up, Andrew, for the note, and for the example.
> I looked into the note, into Wilks, and into Cressie & Wikle, which I
> tried to follow when I wrote EOF.
>
> I decided to deprecate spacetime::EOF. It computes principle component
> scores from the m x p space-time matrix or its transpose, which might be
> useful to some, but what it does is too far from the EOF literature to
> be helpful. In particular, it confused "spatial" and "temporal" modes,
> as C & W use these terms.
>
> I added a new function, spacetime::eof, which should do what the
> literature describes as EOF: return the eigenvector coefficients of the
> rotation matrix. Argument returnEOFs = FALSE gives back the prcomp
> object, feeding that to predict() gives the scores.
>
> Reproducing the figures in C & W Ch 5 looks now better, up to expected
> sign changes, but the numerical ranges are still different.
>
> Please reinstall spacetime from github, use eof, and see if things now
> work as expected. demo(CressieWikle) is now updated as well.
>
> In your example below, you normalize by
>
> > PCs = apply(seof$rotation, 2, function(x) (x - mean(x)) / sd(x))
>
> but why? Eigenvectors are already standardized, but to unit length; is
> this another convention of the EOF world?
>
> With best regards,
>
> On 10/24/2014 12:04 AM, Andrew Vitale wrote:
> > Hello,
> >
> > I'm performing an empirical orthogonal function analysis on sea level
> > pressure using the spacetime package, and I'm having trouble determining
> > which elements of the function output I should use to interpret the
> results.
> >
> > It seems that most examples in the literature calculate empirical
> > orthogonal functions (EOFs) and their associated principle component (PC)
> > time series (e.g.
> http://www.met.reading.ac.uk/~han/Monitor/eofprimer.pdf ,
> > pp 11-12, Fig. 2, 3).  As far as I can tell, I should be able to extract
> > all of the relevant information using only the spatial mode in the
> > spacetime:::EOF function.  However, the ambiguous terminology in the
> > literature and the availability of the "temporal" mode in spacetime:::EOF
> > have me uncertain of my interpretation.
> >
> > I have been treating the output of spacetime:::EOF with
> > returnPredictions=TRUE as the EOFs, and I have been treating the
> > spacetime:::EOF $rotation element with returnPredictions=FALSE as the
> PCs.
> >
> > Am I extracting the proper information from the spacetime:::EOF results?
> > Are the results of the spatial and temporal modes of spacetime:::EOF both
> > required to perform an EOF analysis of a sea level pressure field, or are
> > these two separate analyses?
> >
> > Below is a small example of how I am currently extracting the spatial
> EOFs
> > and their associated PCs.
> >
> > Thanks for any comments,
> > Andrew Vitale
> >
> >
> > library(raster)
> > library(spacetime)
> >
> > ## Create a raster object that mimics my data
> > ## which is actually a raster stack of 20,718
> > ## daily sea level pressure anomolies
> > a = array(rnorm(9*9*100), c(9,9,100))
> > b = brick(a)
> > b = setValues(b, a)
> > z = seq(as.Date('1980-01-01'), as.Date('1980-04-09'),
> >         by = 'day')
> > b = setZ(b, z)
> >
> > ## coerce the raster stack to an STFDF object
> > st = as(b, 'STFDF')
> >
> > ## calculate EOFs in spatial mode using spacetime
> > seof = EOF(st, how='spatial', returnPredictions=FALSE, scale.=TRUE)
> > seof_preds = EOF(st, how='spatial', returnPredictions=TRUE, scale.=TRUE)
> >
> > ## Create a raster stack of the predictions, which seem to be
> > ## generally referred to as EOFs in the literature
> > EOFs = stack(seof_preds)
> > ## extract and standardize the rotation element of the
> > ## seof object, which seems to be the eigenvectors, which seem
> > ## to also be referred to as PCs in the literature
> > PCs = apply(seof$rotation, 2, function(x) (x - mean(x)) / sd(x))
> >
> > ## Plot the EOFs as maps (seof_preds)
> > plot(EOFs)
> >
> > ## Plot the first PC (seof$rotation [standardized])
> > x11(height=7, width=10)
> > plot(x=as.Date(row.names(PCs), format='X%Y.%m.%d'),
> >      y=PCs[ , 1], type='l', xlab='Date', ylab='Standardized PC1')
> >
> >
>
> --
> Edzer Pebesma,  Co-Editor-in-Chief Computers & Geosciences
> Institute for Geoinformatics (ifgi), University of M?nster
> Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
> 83 33081 http://ifgi.uni-muenster.de GPG key ID 0xAC227795
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>


-- 
*Andrew P. Vitale*
Masters Student
Department of Geography
University of Nevada, Reno
vitale232 at gmail.com

	[[alternative HTML version deleted]]


From paul.hewson at plymouth.ac.uk  Thu Oct 30 19:14:25 2014
From: paul.hewson at plymouth.ac.uk (Paul hewson)
Date: Thu, 30 Oct 2014 11:14:25 -0700 (PDT)
Subject: [R-sig-Geo] Strange Rgdal compile error (possibly three)
Message-ID: <1414692865798-7587374.post@n2.nabble.com>

I'm trying to install rgdal on Kubuntu 14.04 and R 3.1.1; I have spent a lot
of time following up various online suggestions for the problems I think I'm
seeing but am currently rather baffled.   I'd be very grateful for a hint.  
I am using R CMD INSTALL ......

libgdal1-dev is installed, mariadb is installed, and armadillo/poppler etc
are installed (although ld can't find them).

To date, I have followed
- Old postings about GDALAllRegister not found
http://stackoverflow.com/questions/15569720/install-rgdal-library-in-rstudio-gdalallregister-not-found-in-libgdal
- not relevant here (I have compiliers)
- GDAL stuff on the amadillo / poppler missing (they are not - there might
be some ubuntu packaging issue here if I'm reading launchpad right)
https://bugs.launchpad.net/ubuntu/+source/gdal/+bug/1194082
- There is some stuff on MySQL / mariadb compatibility.
https://github.com/Homebrew/homebrew/issues/32973

If anyone has any hints about what I should do next I'd be really grateful.  
For example, I don't know whether to knock out mariadb to see whether/how
that helps, but there seem to be orthogonal warnings.


checking gdal: linking with --libs only... no
checking gdal: linking with --libs and --dep-libs... no

/usr/lib/libgdal.so: undefined reference to `mysql_error at libmysqlclient_18'
/usr/lib/libgdal.so: undefined reference to
`mysql_options at libmysqlclient_18'
/usr/lib/libgdal.so: undefined reference to
`mysql_fetch_lengths at libmysqlclient_18'
/usr/lib/libgdal.so: undefined reference to
`mysql_real_connect at libmysqlclient_18'
/usr/lib/libgdal.so: undefined reference to `mysql_query at libmysqlclient_18'
/usr/lib/libgdal.so: undefined reference to
`mysql_free_result at libmysqlclient_18'
/usr/lib/libgdal.so: undefined reference to `my_init at libmysqlclient_18'
/usr/lib/libgdal.so: undefined reference to
`mysql_field_seek at libmysqlclient_18'
/usr/lib/libgdal.so: undefined reference to
`mysql_num_rows at libmysqlclient_18'
/usr/lib/libgdal.so: undefined reference to
`mysql_num_fields at libmysqlclient_18'
/usr/lib/libgdal.so: undefined reference to `mysql_close at libmysqlclient_18'
/usr/lib/libgdal.so: undefined reference to
`mysql_field_count at libmysqlclient_18'
/usr/lib/libgdal.so: undefined reference to
`free_defaults at libmysqlclient_18'
/usr/lib/libgdal.so: undefined reference to `mysql_init at libmysqlclient_18'
/usr/lib/libgdal.so: undefined reference to
`mysql_fetch_row at libmysqlclient_18'
/usr/lib/libgdal.so: undefined reference to
`mysql_fetch_field at libmysqlclient_18'
/usr/lib/libgdal.so: undefined reference to `mysql_errno at libmysqlclient_18'
/usr/lib/libgdal.so: undefined reference to
`mysql_insert_id at libmysqlclient_18'
/usr/lib/libgdal.so: undefined reference to
`mysql_use_result at libmysqlclient_18'
/usr/lib/libgdal.so: undefined reference to
`mysql_store_result at libmysqlclient_18'
/usr/lib/libgdal.so: undefined reference to
`load_defaults at libmysqlclient_18'
/usr/lib/libgdal.so: undefined reference to
`mysql_affected_rows at libmysqlclient_18'
collect2: error: ld returned 1 exit status

/usr/bin/ld: cannot find -larmadillo
/usr/bin/ld: cannot find -lproj
/usr/bin/ld: cannot find -lpoppler
/usr/bin/ld: cannot find -lfreexl
/usr/bin/ld: cannot find -lepsilon
/usr/bin/ld: cannot find -lkmldom
/usr/bin/ld: cannot find -lkmlbase
/usr/bin/ld: cannot find -lkmlengine
/usr/bin/ld: cannot find -lkmlconvenience
/usr/bin/ld: cannot find -lminizip
/usr/bin/ld: cannot find -luriparser
collect2: error: ld returned 1 exit status

configure: Install failure: compilation and/or linkage problems.

configure: error: GDALAllRegister not found in libgdal.




--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Strange-Rgdal-compile-error-possibly-three-tp7587374.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From mw.moni.wagner at gmail.com  Fri Oct 31 11:08:23 2014
From: mw.moni.wagner at gmail.com (Monika Wagner)
Date: Fri, 31 Oct 2014 11:08:23 +0100
Subject: [R-sig-Geo] Antarctica map
Message-ID: <CAAimqCm1uUb=BpjP8vgmUfEUyF8wSWzgNT+Z17-rY6J5cBRAaQ@mail.gmail.com>

Hi,

I've a problem mapping the antarctica with data from
http://www.gadm.org/download. I used this code:

library(ggplot2)

load("ATA_adm0.RData")
an<-gadm

antmap<-ggplot()+
  geom_path(data=an,aes(x=long,y=lat,group=group))+
  scale_y_continuous(limits=c(-90,-50)) +
  scale_x_continuous(limits=c(-175,186))

antmap + coord_map("ortho", orientation=c(-90, 0, 0))

Apparently, there is data missing, thus the plot shows some kind of dud
coordinate at the center.  Can I somehow delete it and connect the
"beginning" and "end" of the coast line?

Thanks!
Monika

	[[alternative HTML version deleted]]


From mdsumner at gmail.com  Fri Oct 31 12:00:50 2014
From: mdsumner at gmail.com (Michael Sumner)
Date: Fri, 31 Oct 2014 22:00:50 +1100
Subject: [R-sig-Geo] Antarctica map
In-Reply-To: <CAAimqCm1uUb=BpjP8vgmUfEUyF8wSWzgNT+Z17-rY6J5cBRAaQ@mail.gmail.com>
References: <CAAimqCm1uUb=BpjP8vgmUfEUyF8wSWzgNT+Z17-rY6J5cBRAaQ@mail.gmail.com>
Message-ID: <CAAcGz9_cSyskyVSOWfUZOJ-2=aDjOa7CefZJPewdUCDp5xZmBw@mail.gmail.com>

On Fri, Oct 31, 2014 at 9:08 PM, Monika Wagner <mw.moni.wagner at gmail.com> wrote:
> Hi,
>
> I've a problem mapping the antarctica with data from
> http://www.gadm.org/download. I used this code:
>

Hello, basically there are dummy points to extend the "longlat" view
of the world to the pole. Obviously these dummy vertices aren't needed
in Orthographic projection, since the polygon surrounds the pole
(rather than trying to traverse a line around a point smeared
impossibly in the plane) but without a reverse pathway to remove them
we have to mess around a bit to hide the tear. You can also turn off
the border colouring and the "tear" becomes invisible (well it does in
base plot, I don't know how to get ggplot2 to do that).

library(raster)
an <- getData("GADM", country = "ATA", level = 0)

## quick check for most southerly lats
lats <- coordinates(as(as(an, "SpatialLines"), "SpatialPoints"))[,2]
## note that lat has been interpolated from the pole to around -86.4

## find the latitude to trim to
nthlat <- 71
latlimit <- min(lats[lats > sort(lats)[nthlat]] )
plot(head(sort(lats), 100))
abline(h = latlimit)

## build a raster to shortcut SpatialPolygons creation
r <- raster(extent(-180, 180, latlimit, 90))
cr <- as(extent(r), "SpatialPolygons")
proj4string(cr) <- CRS(proj4string(an))

library(rgeos)
an0 <- gIntersection(an, cr, byid = TRUE)

## I don't get what happens with geom_path when
## nthlat = 71 (?) but consider using these sources instead:
## https://gis.ccamlr.org/home
## http://www.quantarctica.org/
## or https://data.aad.gov.au/ (offline right this minute)

## set nthlat to 70 for use with geom_path


## another reprojection pathway to prove the point
library(rgdal)
an2 <- spTransform(an0, CRS("+proj=ortho +lat_0=-90 +ellps=WGS84
+datum=WGS84 +no_defs +towgs84=0,0,0"))
plot(an2)


The layer wrld_simpl is a bit tidyier with only the dummy points at
the extremes, these data have been "densified" to insert these
redundant vertices so it looks ok in many (not all) other projections.

There's very good discussions about the ultimate source of the problem here:

http://bost.ocks.org/mike/example/

http://vimeo.com/106198518

BTW, I'm happy to help with any Southern Ocean mapping issues, I've
learnt a whole lot of tricks in recent months.

Cheers, Mike.




> library(ggplot2)
>
> load("ATA_adm0.RData")
> an<-gadm
>
> antmap<-ggplot()+
>   geom_path(data=an,aes(x=long,y=lat,group=group))+
>   scale_y_continuous(limits=c(-90,-50)) +
>   scale_x_continuous(limits=c(-175,186))
>
> antmap + coord_map("ortho", orientation=c(-90, 0, 0))
>
> Apparently, there is data missing, thus the plot shows some kind of dud
> coordinate at the center.  Can I somehow delete it and connect the
> "beginning" and "end" of the coast line?
>
> Thanks!
> Monika
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



-- 
Michael Sumner
Software and Database Engineer
Australian Antarctic Division
Hobart, Australia
e-mail: mdsumner at gmail.com


From f.calboli at imperial.ac.uk  Fri Oct 31 12:50:03 2014
From: f.calboli at imperial.ac.uk (Federico Calboli)
Date: Fri, 31 Oct 2014 11:50:03 +0000
Subject: [R-sig-Geo] spplot: getting proportional col.regions across
	different plots
Message-ID: <4E6DFCDE-128C-4029-83EB-7C84BD6D41BB@imperial.ac.uk>

Hi All,

I am doing some kriging (on the heat loss of a floor) and I am producing three plots.

This code

spplot(res.bare$krige_output[,1], col.regions = rev(heat.colors(100)), sp.layout = c('sp.points', R.bare2, col='black', pch=16))

works flawlessly.  The main problem I have is that

col.regions = rev(heat.colors(100))

gives me the exact color scale across the three plots, while my ranges are quite different:

plot 1 0.4318156 1.8557941
plot 2 2.318537 4.237029
plot 3 9.861249 12.438198

Overall my heat loss goes from 0.4318156 to 12.438198 across the three maps.  I would like to now change the col.regions = rev(heat.colors(100)) so that the colors reflect this fact: if we assume that 0.4318156 == white and 12.438198 == full red I want the colours in each map to take this into account.

I have tried to partition the heat.colors(100) output across the three maps thus:

col.regions = rev(heat.colors(100)[1:15])

but it does not work.  Any ideas on how to achieve what I am describing?  BTW I am happy to expand the palette (say from blue to red) if that makes it simpler.

BW

F


From f.calboli at imperial.ac.uk  Fri Oct 31 13:01:02 2014
From: f.calboli at imperial.ac.uk (Federico Calboli)
Date: Fri, 31 Oct 2014 12:01:02 +0000
Subject: [R-sig-Geo] spplot: getting proportional col.regions across
	different plots
In-Reply-To: <4E6DFCDE-128C-4029-83EB-7C84BD6D41BB@imperial.ac.uk>
References: <4E6DFCDE-128C-4029-83EB-7C84BD6D41BB@imperial.ac.uk>
Message-ID: <BF9C420A-123C-43E1-834F-DC1690126050@imperial.ac.uk>

I think I found an answer:

mycols = colorRampPalette(c("blue", "cyan", "yellow", "red"), bias=1)

spplot(res.bare$krige_output[,1], col.regions = mycols(100)[1:15], sp.layout = c('sp.points', R.bare2, col='black', pch=16))

or thereabouts ? I have something to work with anyway.

BW

F


On 31 Oct 2014, at 11:50, Federico Calboli <f.calboli at imperial.ac.uk> wrote:

> Hi All,
> 
> I am doing some kriging (on the heat loss of a floor) and I am producing three plots.
> 
> This code
> 
> spplot(res.bare$krige_output[,1], col.regions = rev(heat.colors(100)), sp.layout = c('sp.points', R.bare2, col='black', pch=16))
> 
> works flawlessly.  The main problem I have is that
> 
> col.regions = rev(heat.colors(100))
> 
> gives me the exact color scale across the three plots, while my ranges are quite different:
> 
> plot 1 0.4318156 1.8557941
> plot 2 2.318537 4.237029
> plot 3 9.861249 12.438198
> 
> Overall my heat loss goes from 0.4318156 to 12.438198 across the three maps.  I would like to now change the col.regions = rev(heat.colors(100)) so that the colors reflect this fact: if we assume that 0.4318156 == white and 12.438198 == full red I want the colours in each map to take this into account.
> 
> I have tried to partition the heat.colors(100) output across the three maps thus:
> 
> col.regions = rev(heat.colors(100)[1:15])
> 
> but it does not work.  Any ideas on how to achieve what I am describing?  BTW I am happy to expand the palette (say from blue to red) if that makes it simpler.
> 
> BW
> 
> F
> 
> 


