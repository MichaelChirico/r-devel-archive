From mspinola10 at gmail.com  Wed Mar  1 05:33:05 2017
From: mspinola10 at gmail.com (=?UTF-8?Q?Manuel_Sp=C3=ADnola?=)
Date: Tue, 28 Feb 2017 22:33:05 -0600
Subject: [R-sig-Geo] spsample: defining the size of the cell in an hexagonal
	grid
Message-ID: <CABkCotQUijVg70JbLAfaEQHJ0kpkAnaS2WmSo3mei9Vs8k_sdg@mail.gmail.com>

Dear list members,

How can I define the size in hectares of the cell when doingan hexagonal
grid with the function spsample.  What it means "cellsize"?  I want to
create cell sizes according to some specific number of hectares.  How can I
do it?


data(meuse.grid)
gridded(meuse.grid) = ~x+y
plot(meuse.grid)
HexPts <-spsample(meuse.grid, type="hexagonal", cellsize=1000)
HexPols <- HexPoints2SpatialPolygons(HexPts)
plot(HexPols[meuse.grid,], add=TRUE)


-- 
*Manuel Sp?nola, Ph.D.*
Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
Universidad Nacional
Apartado 1350-3000
Heredia
COSTA RICA
mspinola at una.cr <mspinola at una.ac.cr>
mspinola10 at gmail.com
Tel?fono: (506) 8706 - 4662
Personal website: Lobito de r?o <https://sites.google.com/site/lobitoderio/>
Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>

	[[alternative HTML version deleted]]


From r.turner at auckland.ac.nz  Wed Mar  1 09:03:43 2017
From: r.turner at auckland.ac.nz (Rolf Turner)
Date: Wed, 1 Mar 2017 21:03:43 +1300
Subject: [R-sig-Geo] [FORGED] spsample: defining the size of the cell in
 an hexagonal grid
In-Reply-To: <CABkCotQUijVg70JbLAfaEQHJ0kpkAnaS2WmSo3mei9Vs8k_sdg@mail.gmail.com>
References: <CABkCotQUijVg70JbLAfaEQHJ0kpkAnaS2WmSo3mei9Vs8k_sdg@mail.gmail.com>
Message-ID: <33832440-3cd1-c71f-e1c6-e07f41bb97df@auckland.ac.nz>

On 01/03/17 17:33, Manuel Sp?nola wrote:
> Dear list members,
>
> How can I define the size in hectares of the cell when doingan hexagonal
> grid with the function spsample.  What it means "cellsize"?  I want to
> create cell sizes according to some specific number of hectares.  How can I
> do it?
>
>
> data(meuse.grid)
> gridded(meuse.grid) = ~x+y
> plot(meuse.grid)
> HexPts <-spsample(meuse.grid, type="hexagonal", cellsize=1000)
> HexPols <- HexPoints2SpatialPolygons(HexPts)
> plot(HexPols[meuse.grid,], add=TRUE)


I have no knowledge of spsample() nor of its argument cellsize (doesn't 
the help for spsample() tell you what this argument means?) but it might 
be useful for you to realise (if you are not already aware of this) that 
the area of a regular hexagon is

     A = 3*sqrt(3)*s^2/2

where s is the length of side of the hexagon.  So if you want hexagons 
of area 42 hectares you would take their sides to be of length 402.0673 
metres.

cheers,

Rolf Turner

-- 
Technical Editor ANZJS
Department of Statistics
University of Auckland
Phone: +64-9-373-7599 ext. 88276


From martazores at gmail.com  Wed Mar  1 15:15:27 2017
From: martazores at gmail.com (marta azores)
Date: Wed, 1 Mar 2017 13:15:27 -0100
Subject: [R-sig-Geo] split SLDF with attributes
In-Reply-To: <2a9c2dbe-9197-1e8f-6d8d-63861d42943d@mbacou.com>
References: <CAE3WKgS9ynXxcLTv1st3b_PDiSuNCYVxPsWsickB+Gai=GvKkA@mail.gmail.com>
	<172de96d-0a8d-d7aa-4706-5d2cac7caa0c@mbacou.com>
	<CAE3WKgSvGOjrJoPJmTeofzsUcF+fw53CqqgjUw5FW_g10FKsYw@mail.gmail.com>
	<2a9c2dbe-9197-1e8f-6d8d-63861d42943d@mbacou.com>
Message-ID: <CAE3WKgSizNpqPTy+U+CF72_-12PAkvijU3-m2R8USxRTDVm1gA@mail.gmail.com>

*Hi Melanie,*

*Sorry for the delayed response. Your loop made exactly what I want it.
Thanks Mel, it's really helpful.*
*Now, I'm trying to manipulated the function last.merge to join my segments
by length. My aim is dividing the transects by 10km (n segments). However,
If the last segment is shorter than 5km, I have two options: *


*option 1)W*e can distribute the remainder among the n segments
(segments>10km).
raw-lines: 10+10+2
output-1:   11+11


*option 2)*  We can add 1 segment(n+1), and divided by segments smaller
than 10km.
raw-lines: 10+10+7
process: 27/3
output-2:     9+9+9

*I think my main aim is still far away. Then I decided to start with
something simple, the function **SegmentSpatialLines split the segments *
*effectively* *in the 10km and merge the last segment with the penultimate.
**I thought it would be easy define a cut-off to decide if the shorter
segments can be merge, but I was wrong.*

*1) First,* the transects were divided by length(10km) into segments.
segments:
10+10+6+10+3

*2) Second*, the length of transects is not a multiple of given
length(10km), if last segment is shorter we can merge it with penultimate
segment, if we wish(merge.last=T).
10+16+13

*3) Third*, I would like merge the sorter last segment with the penultimate
segment, only if the length is <5km.
segments:
10+10+null+13

*#I try to include a cut-off with these modifications:*
#*A)*      if ((merge.last && length(segments) <5000))#5km cut-off
##But the output of A was the same as if ((merge.last && length(segments)
>1)) and merge.last=F
#
I thought may be the length(segments) here is only to give you the nrow and
not the length of the segments. And I decided to use other ways to
calculate the length. The funcion gLenght of the rgeos package, it's not
possible because the segments in the function SegmentSpatialLines are in a
list. I also projected the segments on the loop before the last.merge, but
without success.  Then I try an other option with the total_lenght.
#*B)*
##change segmentspatilines function
SegmentSpatialLines <- function(sl, length = 0, n.parts = 0, merge.last =
F) {
 stopifnot((length > 0 || n.parts > 0))
 id <- 0
 newlines <- list()
 sl <- as(sl, "SpatialLines")
 for (lines in sl at lines) {
   for (line in lines at Lines) {
     crds <- line at coords
     # create segments
     segments <- CreateSegments(coords = crds, length, n.parts)
     # calculate total length line
       total_length <- 0
     for (i in 1:(nrow(crds) - 1)) {
       d <- sqrt((crds[i, 1] - crds[i + 1, 1])^2 + (crds[i, 2] - crds[i +
1, 2])^2)
       total_length <- total_length + d
     }

     if ((merge.last && length(segments) >1) &
(total_length(segments)<5000))

       {
       # in case there is only one segment, merging would result into error
       segments <- MergeLast(segments)
     }
     # transform segments to lineslist for SpatialLines object
     for (segment in segments) {
       newlines <- c(newlines, Lines(list(Line(unlist(segment))), ID =
as.character(id)))
       id <- id + 1
     }
   }
 }
 return(SpatialLines(newlines))
}




##But the output of B was the same as if ((merge.last && length(segments)
>1)) and merge.last=F

Thanks in advance,

Marta

>
>>
>

	[[alternative HTML version deleted]]


From edzer.pebesma at uni-muenster.de  Wed Mar  1 17:59:57 2017
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Wed, 1 Mar 2017 17:59:57 +0100
Subject: [R-sig-Geo] =?utf-8?q?EGU=3A_R=E2=80=99s_deliberate_role_in_Earth?=
	=?utf-8?q?_sciences?=
Message-ID: <afadfe4b-342b-f642-110a-65436febc545@uni-muenster.de>

This year's EGU meeting has a session with 16 presentation on "R?s
deliberate role in Earth sciences"; for the program see:

http://meetingorganizer.copernicus.org/EGU2017/pico/24971
-- 
Edzer Pebesma
Institute for Geoinformatics  (ifgi),  University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany; +49 251 83 33081
Journal of Statistical Software:   http://www.jstatsoft.org/
Computers & Geosciences:   http://elsevier.com/locate/cageo/

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 473 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20170301/a1155ff4/attachment.bin>

From tristan.bourgeois at gmail.com  Wed Mar  1 19:05:23 2017
From: tristan.bourgeois at gmail.com (Tristan Bourgeois)
Date: Wed, 1 Mar 2017 19:05:23 +0100
Subject: [R-sig-Geo] SpatialDataFrame List Union
Message-ID: <CACNjsfVTgrC3aTfMvbq92W+UboNBS=qS7iWRr113ex5Q4E8edg@mail.gmail.com>

Dear all,

I'm working on a code and I don't understand something probably related to
the writting rules of R

My code :

library(rgdal)

shp_paths = list.files(path = "X:/IGN/BDTOPO_V2.1", pattern
="TRONCON_COURS_EAU.SHP",
                       full.names = T,recursive = T,include.dirs = F)

shp_objects <- lapply(shp_paths, function(x) {readOGR(dsn=x,
                       layer=ogrListLayers(x))}) ### Liste de
SpatialLineDataFrames


"shp_objects" is a large list of 16 elements (192 Mb)

What I want to do is an union of these 16 elements.

Does anybody has a pist ?

Thanks !

Cheers

Tristan
Hydromorphologist Engineer
Seine Normandie Water Agency
Rouen, France
-- 
Tristan Bourgeois

	[[alternative HTML version deleted]]


From mtreglia at gmail.com  Thu Mar  2 04:53:24 2017
From: mtreglia at gmail.com (Michael Treglia)
Date: Wed, 1 Mar 2017 22:53:24 -0500
Subject: [R-sig-Geo] Suggestions for irregular grid netCDF data?
Message-ID: <CAPKp32uabsKVJoq=Sc+rfdcpsYzU9wQrftN57bdqPub2TzZDJw@mail.gmail.com>

?Hi all,

I've been trying to work with a somewhat complex netCDF dataset, and wanted
to see if anybody has suggestions.

The data are for marine variables in the form of a remote netCDF served
through OPENDAP. One of the complexities is that it comes in an irregular
grid, as fine as 25m and as coarse as 400m (coarser as you move further
from the coast) - this variable spacing makes it tough to work with in the
raster package, which seems like it would be the easiet.  Is there a
straightforward, relatively simple way to work with a dataset like this,
getting entire layers at a time? The data have a slew of different
variables, some of which also have time steps and different depth horizons.

So far, I?ve been able to connect to the data using the ncdf4 package in R,
and load simple, 3 dimensional data (e.g., depth). I can also force layers
to load using the raster package, adding the argument
?stopIfNotEqualSpaced=FALSE', though that obviously has issues with the
irregular grid (though if it worked, would make it easier to pull
information by date and depth horizons). I'm having a tough time getting
data via the ncdf4 package for specific dates/depth horizons though. [note:
I end up having to use R in a linux environment for this, as I understand
the windows implementation for is more limited, and throws an ?Unknown file
format? error.]

The data are here:
http://colossus.dl.stevens-tech.edu/thredds/dodsC/LISS/Hindcast/all_nb_mon_81.nc,
and here?s the web-interface for the data:
http://colossus.dl.stevens-tech.edu/thredds/dodsC/LISS/Hindcast/all_nb_mon_81.nc.html.
I've included some sample R code below - and am totally open to alternative
ways that might be better for working with these data [still new-ish to
netCDFs, and have mainly dealt with much simpler, soil or climate datasets].

Thanks!
Mike


Sample R Code:
#Load and work w/ data in ncdf4
library(ncdf4)

nyhops.nc <- nc_open("
http://colossus.dl.stevens-tech.edu/thredds/dodsC/LISS/Hindcast/all_nb_mon_81.nc
")

#Get Point Data with Depth Measurements
depth.nc <- ncvar_get(nyhops.nc, 'depth')
lat.nc <- ncvar_get(nyhops.nc, 'lat')
long.nc <- ncvar_get(nyhops.nc, 'lon')

depth.df <- data.frame(lat=as.vector(lat.nc), long=as.vector(long.nc),
depth=as.vector(depth.nc)) #Can then be exported, or converted to spatial
object

#Trying to get the entirety of a single time point and depth horizon, but
not quite getting the start/count args - this gets a single data point it
seems
temp.nc <- ncvar_get(nyhops.nc, 'temp', start=c(10,10,1,1),
count=c(1,1,1,1))



#Load layers w/ raster package.
library(raster)
nyhops.url <- "
http://colossus.dl.stevens-tech.edu/thredds/dodsC/LISS/Hindcast/all_nb_mon_81.nc
"
depth <- raster(nyhops.url, varname="depth", lvar=1, level=1,
stopIfNotEqualSpaced=FALSE) #Forcing it to read layer despite unequal
spacing of coords
plot(depth) #Plot looks distorted, as expected given irregular grid
spacing. [I realize the data aren't projected at this point]

	[[alternative HTML version deleted]]


From mdsumner at gmail.com  Thu Mar  2 05:43:00 2017
From: mdsumner at gmail.com (Michael Sumner)
Date: Thu, 02 Mar 2017 04:43:00 +0000
Subject: [R-sig-Geo] Suggestions for irregular grid netCDF data?
In-Reply-To: <CAPKp32uabsKVJoq=Sc+rfdcpsYzU9wQrftN57bdqPub2TzZDJw@mail.gmail.com>
References: <CAPKp32uabsKVJoq=Sc+rfdcpsYzU9wQrftN57bdqPub2TzZDJw@mail.gmail.com>
Message-ID: <CAAcGz9-ceH9rFyceFmgQ4b2KF2Sj_9SH7_wDU7WxkU_Hzk8EZQ@mail.gmail.com>

Hi there,

my general advice is

* use raster to read the data layers (including the coordinates, which in
this context are just data)
* treat each layer "index space", i.e. setExtent(r, extent(0, nrow(x), 0,
ncol(x)) (or possibly transpose for some NetCDF files)
* use raster's cell-index logic to do extractions and aggregations in that
index space, it's neat because cropping inherits the parent georeference so
it's "global"
* use resampling to put real-world data objects into that index space for
extractions (you have to worry about the resolution and the boundary to do
that)

I have a few R packages that do this for ROMS and CMIP5 that can be
generally applied, but there not in great shape atm.

This rough document shows some of what you can do, it was written for a
particular purpose I had exploring leaflet which is on the backburner for
now, so it doesn't really go anywhere.

http://rpubs.com/cyclemumner/roms0

I'm happy to help you get what you need though, we deal with scads of this
kind of data and it doesn't fit any good mould except the "code it
yourself" club. It's not a huge amount of code but the "many coordinate
systems" can be bewildering and it's really specifically bound to the
intricacies of raster and sp and rgdal and ncdf4.

I'll try to look at your examples sometime soon.

Cheers, Mike.


On Thu, 2 Mar 2017 at 14:53 Michael Treglia <mtreglia at gmail.com> wrote:

> ?Hi all,
>
> I've been trying to work with a somewhat complex netCDF dataset, and wanted
> to see if anybody has suggestions.
>
> The data are for marine variables in the form of a remote netCDF served
> through OPENDAP. One of the complexities is that it comes in an irregular
> grid, as fine as 25m and as coarse as 400m (coarser as you move further
> from the coast) - this variable spacing makes it tough to work with in the
> raster package, which seems like it would be the easiet.  Is there a
> straightforward, relatively simple way to work with a dataset like this,
> getting entire layers at a time? The data have a slew of different
> variables, some of which also have time steps and different depth horizons.
>
> So far, I?ve been able to connect to the data using the ncdf4 package in R,
> and load simple, 3 dimensional data (e.g., depth). I can also force layers
> to load using the raster package, adding the argument
> ?stopIfNotEqualSpaced=FALSE', though that obviously has issues with the
> irregular grid (though if it worked, would make it easier to pull
> information by date and depth horizons). I'm having a tough time getting
> data via the ncdf4 package for specific dates/depth horizons though. [note:
> I end up having to use R in a linux environment for this, as I understand
> the windows implementation for is more limited, and throws an ?Unknown file
> format? error.]
>
> The data are here:
>
> http://colossus.dl.stevens-tech.edu/thredds/dodsC/LISS/Hindcast/all_nb_mon_81.nc
> ,
> and here?s the web-interface for the data:
>
> http://colossus.dl.stevens-tech.edu/thredds/dodsC/LISS/Hindcast/all_nb_mon_81.nc.html
> .
> I've included some sample R code below - and am totally open to alternative
> ways that might be better for working with these data [still new-ish to
> netCDFs, and have mainly dealt with much simpler, soil or climate
> datasets].
>
> Thanks!
> Mike
>
>
> Sample R Code:
> #Load and work w/ data in ncdf4
> library(ncdf4)
>
> nyhops.nc <- nc_open("
>
> http://colossus.dl.stevens-tech.edu/thredds/dodsC/LISS/Hindcast/all_nb_mon_81.nc
> ")
>
> #Get Point Data with Depth Measurements
> depth.nc <- ncvar_get(nyhops.nc, 'depth')
> lat.nc <- ncvar_get(nyhops.nc, 'lat')
> long.nc <- ncvar_get(nyhops.nc, 'lon')
>
> depth.df <- data.frame(lat=as.vector(lat.nc), long=as.vector(long.nc),
> depth=as.vector(depth.nc)) #Can then be exported, or converted to spatial
> object
>
> #Trying to get the entirety of a single time point and depth horizon, but
> not quite getting the start/count args - this gets a single data point it
> seems
> temp.nc <- ncvar_get(nyhops.nc, 'temp', start=c(10,10,1,1),
> count=c(1,1,1,1))
>
>
>
> #Load layers w/ raster package.
> library(raster)
> nyhops.url <- "
>
> http://colossus.dl.stevens-tech.edu/thredds/dodsC/LISS/Hindcast/all_nb_mon_81.nc
> "
> depth <- raster(nyhops.url, varname="depth", lvar=1, level=1,
> stopIfNotEqualSpaced=FALSE) #Forcing it to read layer despite unequal
> spacing of coords
> plot(depth) #Plot looks distorted, as expected given irregular grid
> spacing. [I realize the data aren't projected at this point]
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Dr. Michael Sumner
Software and Database Engineer
Australian Antarctic Division
203 Channel Highway
Kingston Tasmania 7050 Australia

	[[alternative HTML version deleted]]


From mspinola10 at gmail.com  Thu Mar  2 14:01:34 2017
From: mspinola10 at gmail.com (=?UTF-8?Q?Manuel_Sp=C3=ADnola?=)
Date: Thu, 2 Mar 2017 07:01:34 -0600
Subject: [R-sig-Geo] [FORGED] spsample: defining the size of the cell in
 an hexagonal grid
In-Reply-To: <33832440-3cd1-c71f-e1c6-e07f41bb97df@auckland.ac.nz>
References: <CABkCotQUijVg70JbLAfaEQHJ0kpkAnaS2WmSo3mei9Vs8k_sdg@mail.gmail.com>
	<33832440-3cd1-c71f-e1c6-e07f41bb97df@auckland.ac.nz>
Message-ID: <CABkCotTp4opnXwZ=FBKg+bMsMqUyv0+fu0QXZK7AV-EHU=rfFw@mail.gmail.com>

Thank you very much Rolf.

Manuel

2017-03-01 2:03 GMT-06:00 Rolf Turner <r.turner at auckland.ac.nz>:

> On 01/03/17 17:33, Manuel Sp?nola wrote:
>
>> Dear list members,
>>
>> How can I define the size in hectares of the cell when doingan hexagonal
>> grid with the function spsample.  What it means "cellsize"?  I want to
>> create cell sizes according to some specific number of hectares.  How can
>> I
>> do it?
>>
>>
>> data(meuse.grid)
>> gridded(meuse.grid) = ~x+y
>> plot(meuse.grid)
>> HexPts <-spsample(meuse.grid, type="hexagonal", cellsize=1000)
>> HexPols <- HexPoints2SpatialPolygons(HexPts)
>> plot(HexPols[meuse.grid,], add=TRUE)
>>
>
>
> I have no knowledge of spsample() nor of its argument cellsize (doesn't
> the help for spsample() tell you what this argument means?) but it might be
> useful for you to realise (if you are not already aware of this) that the
> area of a regular hexagon is
>
>     A = 3*sqrt(3)*s^2/2
>
> where s is the length of side of the hexagon.  So if you want hexagons of
> area 42 hectares you would take their sides to be of length 402.0673 metres.
>
> cheers,
>
> Rolf Turner
>
> --
> Technical Editor ANZJS
> Department of Statistics
> University of Auckland
> Phone: +64-9-373-7599 ext. 88276
>



-- 
*Manuel Sp?nola, Ph.D.*
Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
Universidad Nacional
Apartado 1350-3000
Heredia
COSTA RICA
mspinola at una.cr <mspinola at una.ac.cr>
mspinola10 at gmail.com
Tel?fono: (506) 8706 - 4662
Personal website: Lobito de r?o <https://sites.google.com/site/lobitoderio/>
Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>

	[[alternative HTML version deleted]]


From Jodi_Norris at nps.gov  Thu Mar  2 14:52:09 2017
From: Jodi_Norris at nps.gov (Jodi Norris)
Date: Thu, 2 Mar 2017 06:52:09 -0700
Subject: [R-sig-Geo] ApproxNA producing different and incorrect results in
	stacks of large rasters
Message-ID: <38e5d8d953cced84fb0b1fcdf9edad3a@mail.gmail.com>

Hello, I?m trying to confirm if there is a bug or at least unexplained
change in behavior in the function approxNA in the most recent version of
the R Raster package (Raster 2.5-8).



I have a small reproducible example below. The original symptoms (too large
to share) were that most the output of the approxNA command appeared to be
the same as the input ? it had lots and lots of NA values that had not been
interpolated? but when I switched back to an older version of the package
(2.3-12) and an older version of R (3.3.1) it returns the correct
interpolated results.  I have tried it with raster datatype set to INT2S
and with no particular raster datatype set.



I have checked the documentation in case there is some reason that I should
expect the results to differ but there are no changes between the old
package version that worked correctly and the new package version.



In my reproducible example there are fewer errors but they are quite
obvious to see just from the plotting view (included in the example). In
these plots you can see that the northern parts of several layers have NA
values remaining that should have been interpolated.



Official system bug report details are shown at the bottom of this email;
I?m running 64-bit Windows 7 and 64-bit R 3.3.2 with raster 2.5-8 with an
R-Studio interface, but I have tested also on R-console with the same
results and on a different computer that has the same configuration, I have
also tested in 32-bit R with the same results.



A trigger seems to be the presence of NA values in the first or last layer,
but the errors occur in cells that do not have NA values in the first or
last layer: for example the top left cells are only missing in layer 2 in
the original stack, so it should be a very simple interpolation for those
cells from layer 1 to layer 3.



I did follow the R instructions for submitting a bug report a couple of
weeks ago but I?m not sure if that contact info is correct, or if it might
have gone into a spam folder.



Best regards, and thanks for any suggestions



Jodi



##### start  Reproducible example



library(raster)

# make a large raster, it must be quite big to have a problem

r <- raster(ncols=8142, nrows=3285)

# make six rasters to stack, use different ranges to better see the
interpolation results

r1 <- setValues(r, round(10 * runif(ncell(r)),0))

r2 <- setValues(r, NA)

r3 <- setValues(r, round(100 * runif(ncell(r)),0))

r4 <- setValues(r, round(1000 * runif(ncell(r)),0))

r5 <- setValues(r, round(50 * runif(ncell(r)),0))

r6 <- setValues(r, round(100 * runif(ncell(r)),0))



# insert some NA values

r1[100:600,] <- NA

r3[,1500:1950] <- NA

r5[,400:800] <- NA

r6[2500:2900,] <- NA



# insert some constant values to make it easier to see if interpolation is
working

r4[300:500,] <- 750

r6[300:400,] <- 20

r6[400:500,] <- 100

# make a stack

s <- stack(r1,r2,r3,r4,r5,r6)



# see what the pre-interpolation stack looks like

plot(s)



# interpolate, this takes a while

x2 <- approxNA(s, method = "linear", rule=2)



# see what the post interpolation looks like, there should be filled in
values for all parts of all layers

# but instead it?s retaining many of the NA values

plot(x2)



## End reproducible example







--please do not edit the information below--

Package: raster
 Version: 2.5-8
 Maintainer: Robert J. Hijmans <r.hijmans at gmail.com>
 Built: R 3.3.1; x86_64-w64-mingw32; 2016-07-19 01:23:33 UTC; windows

R Version:
 platform = x86_64-w64-mingw32
 arch = x86_64
 os = mingw32
 system = x86_64, mingw32
 status =
 major = 3
 minor = 3.2
 year = 2016
 month = 10
 day = 31
 svn rev = 71607
 language = R
 version.string = R version 3.3.2 (2016-10-31)
 nickname = Sincere Pumpkin Patch

Windows 7 x64 (build 7601) Service Pack 1

Locale:
 LC_COLLATE=English_United States.1252;LC_CTYPE=English_United
States.1252;LC_MONETARY=English_United
States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252

Search Path:
 .GlobalEnv, package:raster, package:sp, package:stats,
 package:graphics, package:grDevices, package:utils, package:datasets,
 package:methods, Autoloads, package:base







Jodi_Norris at nps.gov
Landscape and Quantitative Ecologist
Inventory and Monitoring Program
Southern Colorado Plateau Network
(928)-523-6142


National Park Service SCPN
Northern Arizona University
525 S Beaver, Bldg 20, Rm 131
PO Box 5663
Flagstaff, AZ, 86011-5663

	[[alternative HTML version deleted]]


From mtreglia at gmail.com  Thu Mar  2 14:58:54 2017
From: mtreglia at gmail.com (Michael Treglia)
Date: Thu, 2 Mar 2017 08:58:54 -0500
Subject: [R-sig-Geo] Suggestions for irregular grid netCDF data?
In-Reply-To: <CAAcGz9-ceH9rFyceFmgQ4b2KF2Sj_9SH7_wDU7WxkU_Hzk8EZQ@mail.gmail.com>
References: <CAPKp32uabsKVJoq=Sc+rfdcpsYzU9wQrftN57bdqPub2TzZDJw@mail.gmail.com>
	<CAAcGz9-ceH9rFyceFmgQ4b2KF2Sj_9SH7_wDU7WxkU_Hzk8EZQ@mail.gmail.com>
Message-ID: <CAPKp32vCAmQdW97mYRp-H8L+BXvFgSGPfud-gPNHgi=iy-7YqA@mail.gmail.com>

Thanks Mike!

This is helpful, so far at least to see/think about different ways to work
with the data, as I wade through this structure and understand how
different R packages handle it.

I'll give things a go, and follow up, and will keep an eye out for any
other suggestions. And if you catch anything I'm missing if you go through
the example code, I'm all ears.  This isn't pressing on my end, but working
through this dataset (and similarly structured ones) will ultimately be
really useful.

Thanks again,
Mike T

Please pardon any typos, this message was sent from a mobile device.

On Mar 1, 2017 11:43 PM, "Michael Sumner" <mdsumner at gmail.com> wrote:

> Hi there,
>
> my general advice is
>
> * use raster to read the data layers (including the coordinates, which in
> this context are just data)
> * treat each layer "index space", i.e. setExtent(r, extent(0, nrow(x), 0,
> ncol(x)) (or possibly transpose for some NetCDF files)
> * use raster's cell-index logic to do extractions and aggregations in that
> index space, it's neat because cropping inherits the parent georeference so
> it's "global"
> * use resampling to put real-world data objects into that index space for
> extractions (you have to worry about the resolution and the boundary to do
> that)
>
> I have a few R packages that do this for ROMS and CMIP5 that can be
> generally applied, but there not in great shape atm.
>
> This rough document shows some of what you can do, it was written for a
> particular purpose I had exploring leaflet which is on the backburner for
> now, so it doesn't really go anywhere.
>
> http://rpubs.com/cyclemumner/roms0
>
> I'm happy to help you get what you need though, we deal with scads of this
> kind of data and it doesn't fit any good mould except the "code it
> yourself" club. It's not a huge amount of code but the "many coordinate
> systems" can be bewildering and it's really specifically bound to the
> intricacies of raster and sp and rgdal and ncdf4.
>
> I'll try to look at your examples sometime soon.
>
> Cheers, Mike.
>
>
> On Thu, 2 Mar 2017 at 14:53 Michael Treglia <mtreglia at gmail.com> wrote:
>
>> ?Hi all,
>>
>> I've been trying to work with a somewhat complex netCDF dataset, and
>> wanted
>> to see if anybody has suggestions.
>>
>> The data are for marine variables in the form of a remote netCDF served
>> through OPENDAP. One of the complexities is that it comes in an irregular
>> grid, as fine as 25m and as coarse as 400m (coarser as you move further
>> from the coast) - this variable spacing makes it tough to work with in the
>> raster package, which seems like it would be the easiet.  Is there a
>> straightforward, relatively simple way to work with a dataset like this,
>> getting entire layers at a time? The data have a slew of different
>> variables, some of which also have time steps and different depth
>> horizons.
>>
>> So far, I?ve been able to connect to the data using the ncdf4 package in
>> R,
>> and load simple, 3 dimensional data (e.g., depth). I can also force layers
>> to load using the raster package, adding the argument
>> ?stopIfNotEqualSpaced=FALSE', though that obviously has issues with the
>> irregular grid (though if it worked, would make it easier to pull
>> information by date and depth horizons). I'm having a tough time getting
>> data via the ncdf4 package for specific dates/depth horizons though.
>> [note:
>> I end up having to use R in a linux environment for this, as I understand
>> the windows implementation for is more limited, and throws an ?Unknown
>> file
>> format? error.]
>>
>> The data are here:
>> http://colossus.dl.stevens-tech.edu/thredds/dodsC/LISS/
>> Hindcast/all_nb_mon_81.nc,
>> and here?s the web-interface for the data:
>> http://colossus.dl.stevens-tech.edu/thredds/dodsC/LISS/
>> Hindcast/all_nb_mon_81.nc.html.
>> I've included some sample R code below - and am totally open to
>> alternative
>> ways that might be better for working with these data [still new-ish to
>> netCDFs, and have mainly dealt with much simpler, soil or climate
>> datasets].
>>
>> Thanks!
>> Mike
>>
>>
>> Sample R Code:
>> #Load and work w/ data in ncdf4
>> library(ncdf4)
>>
>> nyhops.nc <- nc_open("
>> http://colossus.dl.stevens-tech.edu/thredds/dodsC/LISS/
>> Hindcast/all_nb_mon_81.nc
>> ")
>>
>> #Get Point Data with Depth Measurements
>> depth.nc <- ncvar_get(nyhops.nc, 'depth')
>> lat.nc <- ncvar_get(nyhops.nc, 'lat')
>> long.nc <- ncvar_get(nyhops.nc, 'lon')
>>
>> depth.df <- data.frame(lat=as.vector(lat.nc), long=as.vector(long.nc),
>> depth=as.vector(depth.nc)) #Can then be exported, or converted to spatial
>> object
>>
>> #Trying to get the entirety of a single time point and depth horizon, but
>> not quite getting the start/count args - this gets a single data point it
>> seems
>> temp.nc <- ncvar_get(nyhops.nc, 'temp', start=c(10,10,1,1),
>> count=c(1,1,1,1))
>>
>>
>>
>> #Load layers w/ raster package.
>> library(raster)
>> nyhops.url <- "
>> http://colossus.dl.stevens-tech.edu/thredds/dodsC/LISS/
>> Hindcast/all_nb_mon_81.nc
>> "
>> depth <- raster(nyhops.url, varname="depth", lvar=1, level=1,
>> stopIfNotEqualSpaced=FALSE) #Forcing it to read layer despite unequal
>> spacing of coords
>> plot(depth) #Plot looks distorted, as expected given irregular grid
>> spacing. [I realize the data aren't projected at this point]
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> --
> Dr. Michael Sumner
> Software and Database Engineer
> Australian Antarctic Division
> 203 Channel Highway
> Kingston Tasmania 7050 Australia
>
>

	[[alternative HTML version deleted]]


From tristan.bourgeois at gmail.com  Thu Mar  2 17:53:11 2017
From: tristan.bourgeois at gmail.com (Tristan Bourgeois)
Date: Thu, 2 Mar 2017 17:53:11 +0100
Subject: [R-sig-Geo] Create Nodes at lines' segments extremities.
Message-ID: <CACNjsfVyS7jX2kKA_v95j7vrhor2Hm1BuVkbEJc=rgeQh4vugw@mail.gmail.com>

Hi everybody,

I can't find any infomation about the gis manipulation I want to process on
R. Even if there are similar posts on r-sig-geo archives...


My issue is the following one :

>*myline<-readOGR(dsn = "./shapes/shp_tr_topo",layer =
"TRONCON_TOPO_Bresle" ) is a spatial polyline which is composed of :*

> *length(line at lines)*
[1] 585                   => 585 segments


It seems that each of those 585 lines are acually a serie of points :

*> line at lines[[1]]@Lines*
[[1]]
An object of class "Line"
Slot "coords":
          [,1]    [,2]
 [1,] 609046.7 6956543
 [2,] 609057.3 6956543
 [3,] 609077.6 6956546
 [4,] 609103.2 6956553
 [5,] 609132.5 6956561
 [6,] 609146.0 6956568
 [7,] 609157.4 6956574
 [8,] 609167.0 6956577
 [9,] 609176.9 6956581
[10,] 609184.4 6956585
[11,] 609191.9 6956588
[12,] 609199.3 6956591
[13,] 609205.7 6956594
[14,] 609212.6 6956599
[15,] 609216.6 6956604
[16,] 609222.6 6956609
[17,] 609229.0 6956613
[18,] 609237.9 6956619
[19,] 609244.4 6956623
[20,] 609253.5 6956626
[21,] 609265.2 6956631
[22,] 609276.5 6956636
[23,] 609287.4 6956639
[24,] 609296.9 6956644
[25,] 609305.1 6956647
[26,] 609308.6 6956653

What I want to obtain are the coordinates of each segments extremities. So
for a segment I should have 2 points with X,Y values.
I tried to apply the rgeos Gnode function but nothing appears as changed.
Maybe there's something to do with the min and max X,Y of each segments ?


Does somebody has already done /wrote a similar script to process that ??


Thank you in advance for the helpfull advices.

Cheers.

Tristan Bourgeois
Hydromorphologist Engineer
Seine Normandie Water Agency
Rouen, France

	[[alternative HTML version deleted]]


From mtreglia at gmail.com  Fri Mar  3 05:11:07 2017
From: mtreglia at gmail.com (Michael Treglia)
Date: Thu, 2 Mar 2017 23:11:07 -0500
Subject: [R-sig-Geo] Suggestions for irregular grid netCDF data?
In-Reply-To: <CAPKp32vCAmQdW97mYRp-H8L+BXvFgSGPfud-gPNHgi=iy-7YqA@mail.gmail.com>
References: <CAPKp32uabsKVJoq=Sc+rfdcpsYzU9wQrftN57bdqPub2TzZDJw@mail.gmail.com>
	<CAAcGz9-ceH9rFyceFmgQ4b2KF2Sj_9SH7_wDU7WxkU_Hzk8EZQ@mail.gmail.com>
	<CAPKp32vCAmQdW97mYRp-H8L+BXvFgSGPfud-gPNHgi=iy-7YqA@mail.gmail.com>
Message-ID: <CAPKp32tijyJHeK4wnUDD7=e8yK_w-oT9bUB+JW80VgbjBdOXDg@mail.gmail.com>

Hi again,

Just to follow-up - got this working without too much issue... as of now, I
have the data values associated w/ the center lat/long of each grid cell.
There are also lat/long vertices for polygons associated with each grid
cell, but that'll take more working through it to get it together. However,
for now this largely suits my needs, and for now I can approximate the grid
cells using voronoi polygons for the grid cell centroids.

Here's some working code [I stop at creating dataframes, but going the next
steps for spatial objects is pretty easy - either sp or simple features
(still learning the latter)].

Thanks again!
Mike

#Sample Code
#Gets netCDF data for lat/long points
library(ncdf4)

#Connect to netCDF
nyhops.nc <- nc_open("
http://colossus.dl.stevens-tech.edu/thredds/dodsC/LISS/Hindcast/all_nb_mon_81.nc
")

##To get 'simple', 3D variale (e.g., depth)
#Load depth, lat, and long
depth.nc <- ncvar_get(nyhops.nc, 'depth')
lat.nc <- ncvar_get(nyhops.nc, 'lat')
long.nc <- ncvar_get(nyhops.nc, 'lon')

#Create dataframe
depth.df <- data.frame(lat=as.vector(lat.nc), long=as.vector(long.nc),
depth=as.vector(depth.nc))

#Remove NA values
depth.df <- depth.df[!is.na(depth.df$depth),]
#Can then convert to spatial object, export as table, etc.

##Example getting data involving a vertical horizon dimension and a date
dimension
#Fetch the temperature data; start is the starting position for x, y,
sigma, date; count is how many
# here, all rows & columns, and one horizon (horizon 3) and date (394)
temp.nc <- ncvar_get(nyhops.nc, 'temp', start=c(1,1,3,394),
count=c(147,452,1,1))

#Can Find out how many dimensions and entries:
nyhops.nc$var[['temp']]$varsize
#Output: [1] 147 452  11 394
#147 rows; 452 columns; 11 horizons; 394 dates/times

#Create dataframe w/ lat, long, temp
temp.df <- data.frame(cbind(long=as.vector(long.nc), lat=as.vector(lat.nc),
temp=as.vector(temp.nc)))

#remove NA rows for temp
temp.df <- temp.df[!is.na(temp.df$temp),] #Can conver to spatial object,
export as table, etc.

##Can plot, just as a non-spatial object for now.
#assign color ramp
rbPal <- colorRampPalette(c('blue',  'red'))

#Adds a column of color values based on the temp values
temp.df$Col <- rbPal(10)[as.numeric(cut(temp.df$temp,breaks = 10))]

plot(temp.df$long, temp.df$lat, col=temp.df$Col)


##Next step - use lon_vertices and lat_vertices to get polygons associated
with each point


On Thu, Mar 2, 2017 at 8:58 AM, Michael Treglia <mtreglia at gmail.com> wrote:

> Thanks Mike!
>
> This is helpful, so far at least to see/think about different ways to work
> with the data, as I wade through this structure and understand how
> different R packages handle it.
>
> I'll give things a go, and follow up, and will keep an eye out for any
> other suggestions. And if you catch anything I'm missing if you go through
> the example code, I'm all ears.  This isn't pressing on my end, but working
> through this dataset (and similarly structured ones) will ultimately be
> really useful.
>
> Thanks again,
> Mike T
>
> Please pardon any typos, this message was sent from a mobile device.
>
> On Mar 1, 2017 11:43 PM, "Michael Sumner" <mdsumner at gmail.com> wrote:
>
>> Hi there,
>>
>> my general advice is
>>
>> * use raster to read the data layers (including the coordinates, which in
>> this context are just data)
>> * treat each layer "index space", i.e. setExtent(r, extent(0, nrow(x), 0,
>> ncol(x)) (or possibly transpose for some NetCDF files)
>> * use raster's cell-index logic to do extractions and aggregations in
>> that index space, it's neat because cropping inherits the parent
>> georeference so it's "global"
>> * use resampling to put real-world data objects into that index space for
>> extractions (you have to worry about the resolution and the boundary to do
>> that)
>>
>> I have a few R packages that do this for ROMS and CMIP5 that can be
>> generally applied, but there not in great shape atm.
>>
>> This rough document shows some of what you can do, it was written for a
>> particular purpose I had exploring leaflet which is on the backburner for
>> now, so it doesn't really go anywhere.
>>
>> http://rpubs.com/cyclemumner/roms0
>>
>> I'm happy to help you get what you need though, we deal with scads of
>> this kind of data and it doesn't fit any good mould except the "code it
>> yourself" club. It's not a huge amount of code but the "many coordinate
>> systems" can be bewildering and it's really specifically bound to the
>> intricacies of raster and sp and rgdal and ncdf4.
>>
>> I'll try to look at your examples sometime soon.
>>
>> Cheers, Mike.
>>
>>
>> On Thu, 2 Mar 2017 at 14:53 Michael Treglia <mtreglia at gmail.com> wrote:
>>
>>> ?Hi all,
>>>
>>> I've been trying to work with a somewhat complex netCDF dataset, and
>>> wanted
>>> to see if anybody has suggestions.
>>>
>>> The data are for marine variables in the form of a remote netCDF served
>>> through OPENDAP. One of the complexities is that it comes in an irregular
>>> grid, as fine as 25m and as coarse as 400m (coarser as you move further
>>> from the coast) - this variable spacing makes it tough to work with in
>>> the
>>> raster package, which seems like it would be the easiet.  Is there a
>>> straightforward, relatively simple way to work with a dataset like this,
>>> getting entire layers at a time? The data have a slew of different
>>> variables, some of which also have time steps and different depth
>>> horizons.
>>>
>>> So far, I?ve been able to connect to the data using the ncdf4 package in
>>> R,
>>> and load simple, 3 dimensional data (e.g., depth). I can also force
>>> layers
>>> to load using the raster package, adding the argument
>>> ?stopIfNotEqualSpaced=FALSE', though that obviously has issues with the
>>> irregular grid (though if it worked, would make it easier to pull
>>> information by date and depth horizons). I'm having a tough time getting
>>> data via the ncdf4 package for specific dates/depth horizons though.
>>> [note:
>>> I end up having to use R in a linux environment for this, as I understand
>>> the windows implementation for is more limited, and throws an ?Unknown
>>> file
>>> format? error.]
>>>
>>> The data are here:
>>> http://colossus.dl.stevens-tech.edu/thredds/dodsC/LISS/Hindc
>>> ast/all_nb_mon_81.nc,
>>> and here?s the web-interface for the data:
>>> http://colossus.dl.stevens-tech.edu/thredds/dodsC/LISS/Hindc
>>> ast/all_nb_mon_81.nc.html.
>>> I've included some sample R code below - and am totally open to
>>> alternative
>>> ways that might be better for working with these data [still new-ish to
>>> netCDFs, and have mainly dealt with much simpler, soil or climate
>>> datasets].
>>>
>>> Thanks!
>>> Mike
>>>
>>>
>>> Sample R Code:
>>> #Load and work w/ data in ncdf4
>>> library(ncdf4)
>>>
>>> nyhops.nc <- nc_open("
>>> http://colossus.dl.stevens-tech.edu/thredds/dodsC/LISS/Hindc
>>> ast/all_nb_mon_81.nc
>>> ")
>>>
>>> #Get Point Data with Depth Measurements
>>> depth.nc <- ncvar_get(nyhops.nc, 'depth')
>>> lat.nc <- ncvar_get(nyhops.nc, 'lat')
>>> long.nc <- ncvar_get(nyhops.nc, 'lon')
>>>
>>> depth.df <- data.frame(lat=as.vector(lat.nc), long=as.vector(long.nc),
>>> depth=as.vector(depth.nc)) #Can then be exported, or converted to
>>> spatial
>>> object
>>>
>>> #Trying to get the entirety of a single time point and depth horizon, but
>>> not quite getting the start/count args - this gets a single data point it
>>> seems
>>> temp.nc <- ncvar_get(nyhops.nc, 'temp', start=c(10,10,1,1),
>>> count=c(1,1,1,1))
>>>
>>>
>>>
>>> #Load layers w/ raster package.
>>> library(raster)
>>> nyhops.url <- "
>>> http://colossus.dl.stevens-tech.edu/thredds/dodsC/LISS/Hindc
>>> ast/all_nb_mon_81.nc
>>> "
>>> depth <- raster(nyhops.url, varname="depth", lvar=1, level=1,
>>> stopIfNotEqualSpaced=FALSE) #Forcing it to read layer despite unequal
>>> spacing of coords
>>> plot(depth) #Plot looks distorted, as expected given irregular grid
>>> spacing. [I realize the data aren't projected at this point]
>>>
>>>         [[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>> --
>> Dr. Michael Sumner
>> Software and Database Engineer
>> Australian Antarctic Division
>> 203 Channel Highway
>> Kingston Tasmania 7050 Australia
>>
>>

	[[alternative HTML version deleted]]


From edzer.pebesma at uni-muenster.de  Fri Mar  3 15:09:39 2017
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Fri, 3 Mar 2017 15:09:39 +0100
Subject: [R-sig-Geo] Create Nodes at lines' segments extremities.
In-Reply-To: <CACNjsfVyS7jX2kKA_v95j7vrhor2Hm1BuVkbEJc=rgeQh4vugw@mail.gmail.com>
References: <CACNjsfVyS7jX2kKA_v95j7vrhor2Hm1BuVkbEJc=rgeQh4vugw@mail.gmail.com>
Message-ID: <f2f20c94-4dc7-f686-d503-c6c6ab587695@uni-muenster.de>


(after receiving the data, off-list):

library(sp)
library(rgdal)
x = readOGR("TRONCON_TOPO_Bresle.shp")

lapply(x at lines, function(y) lapply(y at Lines, function(z) apply(z at coords,
2, range)))

gives you the bounding box of each individual Line element, as a nested
list (similar to how x at lines is nested).



On 02/03/17 17:53, Tristan Bourgeois wrote:
> Hi everybody,
> 
> I can't find any infomation about the gis manipulation I want to process on
> R. Even if there are similar posts on r-sig-geo archives...
> 
> 
> My issue is the following one :
> 
>> *myline<-readOGR(dsn = "./shapes/shp_tr_topo",layer =
> "TRONCON_TOPO_Bresle" ) is a spatial polyline which is composed of :*
> 
>> *length(line at lines)*
> [1] 585                   => 585 segments
> 
> 
> It seems that each of those 585 lines are acually a serie of points :
> 
> *> line at lines[[1]]@Lines*
> [[1]]
> An object of class "Line"
> Slot "coords":
>           [,1]    [,2]
>  [1,] 609046.7 6956543
>  [2,] 609057.3 6956543
>  [3,] 609077.6 6956546
>  [4,] 609103.2 6956553
>  [5,] 609132.5 6956561
>  [6,] 609146.0 6956568
>  [7,] 609157.4 6956574
>  [8,] 609167.0 6956577
>  [9,] 609176.9 6956581
> [10,] 609184.4 6956585
> [11,] 609191.9 6956588
> [12,] 609199.3 6956591
> [13,] 609205.7 6956594
> [14,] 609212.6 6956599
> [15,] 609216.6 6956604
> [16,] 609222.6 6956609
> [17,] 609229.0 6956613
> [18,] 609237.9 6956619
> [19,] 609244.4 6956623
> [20,] 609253.5 6956626
> [21,] 609265.2 6956631
> [22,] 609276.5 6956636
> [23,] 609287.4 6956639
> [24,] 609296.9 6956644
> [25,] 609305.1 6956647
> [26,] 609308.6 6956653
> 
> What I want to obtain are the coordinates of each segments extremities. So
> for a segment I should have 2 points with X,Y values.
> I tried to apply the rgeos Gnode function but nothing appears as changed.
> Maybe there's something to do with the min and max X,Y of each segments ?
> 
> 
> Does somebody has already done /wrote a similar script to process that ??
> 
> 
> Thank you in advance for the helpfull advices.
> 
> Cheers.
> 
> Tristan Bourgeois
> Hydromorphologist Engineer
> Seine Normandie Water Agency
> Rouen, France
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics  (ifgi),  University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany; +49 251 83 33081
Journal of Statistical Software:   http://www.jstatsoft.org/
Computers & Geosciences:   http://elsevier.com/locate/cageo/

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 473 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20170303/c7e92b81/attachment.bin>

From mspinola10 at gmail.com  Fri Mar  3 20:03:38 2017
From: mspinola10 at gmail.com (=?UTF-8?Q?Manuel_Sp=C3=ADnola?=)
Date: Fri, 3 Mar 2017 13:03:38 -0600
Subject: [R-sig-Geo] Making an hexagonal grid using spsample
Message-ID: <CABkCotQgV7Oi0cijTq=nNM7kUX=E-1gWGA1fs0x42XyYWZDCrA@mail.gmail.com>

Dear list members,

I am trying to make an spatial hexagonal grid in R using the spsample
function. I would like hexagons of 1 ha = 10000 sq meters.


First I used a cell size of 62.04 m as the side of the hexagon.

data(meuse.grid)
gridded(meuse.grid) = ~x + y
proj4string(meuse.grid) <- CRS("+init=epsg:28992")
xx <- spsample(meuse.grid, type = "hexagonal", cellsize = 62.04)
xx <- HexPoints2SpatialPolygons(xx)
rgeos::gArea(xx, byid=TRUE)

It gave me an area per hexagon = 3333.299

Second I used a cell size of 62.04 * 2 = 124.08 m as the long diagonal of
the hexagon

data(meuse.grid)
gridded(meuse.grid) = ~x + y
proj4string(meuse.grid) <- CRS("+init=epsg:28992")
xx <- spsample(meuse.grid, type = "hexagonal", cellsize = 62.04*2)
xx <- HexPoints2SpatialPolygons(xx)
rgeos::gArea(xx, byid=TRUE)

It gave me an area per hexagon = 13333.19

Both results are wrong, because I was expecting close to 10000.

How can I make a spatial grid of 1 ha (or other size) in R?

Manuel

-- 
*Manuel Sp?nola, Ph.D.*
Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
Universidad Nacional
Apartado 1350-3000
Heredia
COSTA RICA
mspinola at una.cr <mspinola at una.ac.cr>
mspinola10 at gmail.com
Tel?fono: (506) 8706 - 4662
Personal website: Lobito de r?o <https://sites.google.com/site/lobitoderio/>
Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>

	[[alternative HTML version deleted]]


From marcelino.delacruz at urjc.es  Fri Mar  3 20:38:24 2017
From: marcelino.delacruz at urjc.es (Marcelino de la Cruz Rot)
Date: Fri, 3 Mar 2017 20:38:24 +0100
Subject: [R-sig-Geo] Making an hexagonal grid using spsample
In-Reply-To: <CABkCotQgV7Oi0cijTq=nNM7kUX=E-1gWGA1fs0x42XyYWZDCrA@mail.gmail.com>
References: <CABkCotQgV7Oi0cijTq=nNM7kUX=E-1gWGA1fs0x42XyYWZDCrA@mail.gmail.com>
Message-ID: <6c1d588d-aea3-c11e-77fd-da72a3c2fbf6@urjc.es>

Hi  Manuel,

I do answer to the question "How can I make a spatial grid of 1 ha (or 
other size) in R?"

You can use function hextess in spatstat

library(spatstat)

# some arbitrary area, with coordinates in hectometres
  W <- Window(chorley)

# As Rolf said, hexagons of 1ha should have side of 402.0673 metres, so, 
in hectometres:

s <- 4.020673

plot(hextess(W, s))
plot(hexgrid(W, s), add=TRUE)


Cheers,

Marcelino

El 03/03/2017 a las 20:03, Manuel Sp?nola escribi?:
> Dear list members,
>
> I am trying to make an spatial hexagonal grid in R using the spsample
> function. I would like hexagons of 1 ha = 10000 sq meters.
>
>
> First I used a cell size of 62.04 m as the side of the hexagon.
>
> data(meuse.grid)
> gridded(meuse.grid) = ~x + y
> proj4string(meuse.grid) <- CRS("+init=epsg:28992")
> xx <- spsample(meuse.grid, type = "hexagonal", cellsize = 62.04)
> xx <- HexPoints2SpatialPolygons(xx)
> rgeos::gArea(xx, byid=TRUE)
>
> It gave me an area per hexagon = 3333.299
>
> Second I used a cell size of 62.04 * 2 = 124.08 m as the long diagonal of
> the hexagon
>
> data(meuse.grid)
> gridded(meuse.grid) = ~x + y
> proj4string(meuse.grid) <- CRS("+init=epsg:28992")
> xx <- spsample(meuse.grid, type = "hexagonal", cellsize = 62.04*2)
> xx <- HexPoints2SpatialPolygons(xx)
> rgeos::gArea(xx, byid=TRUE)
>
> It gave me an area per hexagon = 13333.19
>
> Both results are wrong, because I was expecting close to 10000.
>
> How can I make a spatial grid of 1 ha (or other size) in R?
>
> Manuel
>


-- 
Marcelino de la Cruz Rot
Depto. de Biolog?a y Geolog?a
F?sica y Qu?mica Inorg?nica
Universidad Rey Juan Carlos
M?stoles Espa?a


From r.turner at auckland.ac.nz  Sat Mar  4 02:31:29 2017
From: r.turner at auckland.ac.nz (Rolf Turner)
Date: Sat, 4 Mar 2017 14:31:29 +1300
Subject: [R-sig-Geo] [FORGED] Re: Making an hexagonal grid using spsample
In-Reply-To: <6c1d588d-aea3-c11e-77fd-da72a3c2fbf6@urjc.es>
References: <CABkCotQgV7Oi0cijTq=nNM7kUX=E-1gWGA1fs0x42XyYWZDCrA@mail.gmail.com>
	<6c1d588d-aea3-c11e-77fd-da72a3c2fbf6@urjc.es>
Message-ID: <bc708952-1422-5f80-b6e7-72f5dcfe47fa@auckland.ac.nz>

On 04/03/17 08:38, Marcelino de la Cruz Rot wrote:
> Hi  Manuel,
>
> I do answer to the question "How can I make a spatial grid of 1 ha (or
> other size) in R?"
>
> You can use function hextess in spatstat
>
> library(spatstat)
>
> # some arbitrary area, with coordinates in hectometres
>  W <- Window(chorley)
>
> # As Rolf said, hexagons of 1ha should have side of 402.0673 metres, so,
> in hectometres:
>
> s <- 4.020673
>
> plot(hextess(W, s))
> plot(hexgrid(W, s), add=TRUE)

Marcelino,

Actually I said hexagons of area *42* ha should have side length equal 
to 402.0673 metres.

Moreover the Chorley data set has units of *kilometres* not hectometres,
so that should be s <- 0.4020673.  Or, to avoid just a touch of 
round-off error, s <- sqrt(2*0.42)/3^0.75.

Note that if you then do

xxx <- hextess(W,s,trim=FALSE)
unique(sapply(tiles(xxx),area.owin))

you get 0.42 --- i.e. 0.42 square kilometres, or 42 hectares.

cheers,

Rolf

-- 
Technical Editor ANZJS
Department of Statistics
University of Auckland
Phone: +64-9-373-7599 ext. 88276


From marcelino.delacruz at urjc.es  Sat Mar  4 13:35:01 2017
From: marcelino.delacruz at urjc.es (Marcelino de la Cruz Rot)
Date: Sat, 4 Mar 2017 13:35:01 +0100
Subject: [R-sig-Geo] [FORGED] Re: Making an hexagonal grid using spsample
In-Reply-To: <bc708952-1422-5f80-b6e7-72f5dcfe47fa@auckland.ac.nz>
References: <CABkCotQgV7Oi0cijTq=nNM7kUX=E-1gWGA1fs0x42XyYWZDCrA@mail.gmail.com>
	<6c1d588d-aea3-c11e-77fd-da72a3c2fbf6@urjc.es>
	<bc708952-1422-5f80-b6e7-72f5dcfe47fa@auckland.ac.nz>
Message-ID: <542fe436-c8e4-71e8-7d91-3e73e5ce152b@urjc.es>

My apologies for such a pair (or more) of embarrassing mistakes!

I should read a bit more these days...


Marcelino



El 04/03/2017 a las 2:31, Rolf Turner escribi?:
> On 04/03/17 08:38, Marcelino de la Cruz Rot wrote:
>> Hi  Manuel,
>>
>> I do answer to the question "How can I make a spatial grid of 1 ha (or
>> other size) in R?"
>>
>> You can use function hextess in spatstat
>>
>> library(spatstat)
>>
>> # some arbitrary area, with coordinates in hectometres
>>  W <- Window(chorley)
>>
>> # As Rolf said, hexagons of 1ha should have side of 402.0673 metres, so,
>> in hectometres:
>>
>> s <- 4.020673
>>
>> plot(hextess(W, s))
>> plot(hexgrid(W, s), add=TRUE)
>
> Marcelino,
>
> Actually I said hexagons of area *42* ha should have side length equal 
> to 402.0673 metres.
>
> Moreover the Chorley data set has units of *kilometres* not hectometres,
> so that should be s <- 0.4020673.  Or, to avoid just a touch of 
> round-off error, s <- sqrt(2*0.42)/3^0.75.
>
> Note that if you then do
>
> xxx <- hextess(W,s,trim=FALSE)
> unique(sapply(tiles(xxx),area.owin))
>
> you get 0.42 --- i.e. 0.42 square kilometres, or 42 hectares.
>
> cheers,
>
> Rolf
>


-- 
Marcelino de la Cruz Rot
Depto. de Biolog?a y Geolog?a
F?sica y Qu?mica Inorg?nica
Universidad Rey Juan Carlos
M?stoles Espa?a


From mspinola10 at gmail.com  Sat Mar  4 15:10:06 2017
From: mspinola10 at gmail.com (=?UTF-8?Q?Manuel_Sp=C3=ADnola?=)
Date: Sat, 4 Mar 2017 08:10:06 -0600
Subject: [R-sig-Geo] [FORGED] Re: Making an hexagonal grid using spsample
In-Reply-To: <542fe436-c8e4-71e8-7d91-3e73e5ce152b@urjc.es>
References: <CABkCotQgV7Oi0cijTq=nNM7kUX=E-1gWGA1fs0x42XyYWZDCrA@mail.gmail.com>
	<6c1d588d-aea3-c11e-77fd-da72a3c2fbf6@urjc.es>
	<bc708952-1422-5f80-b6e7-72f5dcfe47fa@auckland.ac.nz>
	<542fe436-c8e4-71e8-7d91-3e73e5ce152b@urjc.es>
Message-ID: <CABkCotQ5hNMKHGJxbZQ=URpgm-bSQBd5+7hnnKqQ5y+WJe0KLg@mail.gmail.com>

Thank you very much to both.

Manuel

2017-03-04 6:35 GMT-06:00 Marcelino de la Cruz Rot <
marcelino.delacruz at urjc.es>:

> My apologies for such a pair (or more) of embarrassing mistakes!
>
> I should read a bit more these days...
>
>
> Marcelino
>
>
>
>
> El 04/03/2017 a las 2:31, Rolf Turner escribi?:
>
>> On 04/03/17 08:38, Marcelino de la Cruz Rot wrote:
>>
>>> Hi  Manuel,
>>>
>>> I do answer to the question "How can I make a spatial grid of 1 ha (or
>>> other size) in R?"
>>>
>>> You can use function hextess in spatstat
>>>
>>> library(spatstat)
>>>
>>> # some arbitrary area, with coordinates in hectometres
>>>  W <- Window(chorley)
>>>
>>> # As Rolf said, hexagons of 1ha should have side of 402.0673 metres, so,
>>> in hectometres:
>>>
>>> s <- 4.020673
>>>
>>> plot(hextess(W, s))
>>> plot(hexgrid(W, s), add=TRUE)
>>>
>>
>> Marcelino,
>>
>> Actually I said hexagons of area *42* ha should have side length equal to
>> 402.0673 metres.
>>
>> Moreover the Chorley data set has units of *kilometres* not hectometres,
>> so that should be s <- 0.4020673.  Or, to avoid just a touch of round-off
>> error, s <- sqrt(2*0.42)/3^0.75.
>>
>> Note that if you then do
>>
>> xxx <- hextess(W,s,trim=FALSE)
>> unique(sapply(tiles(xxx),area.owin))
>>
>> you get 0.42 --- i.e. 0.42 square kilometres, or 42 hectares.
>>
>> cheers,
>>
>> Rolf
>>
>>
>
> --
> Marcelino de la Cruz Rot
> Depto. de Biolog?a y Geolog?a
> F?sica y Qu?mica Inorg?nica
> Universidad Rey Juan Carlos
> M?stoles Espa?a
>
>


-- 
*Manuel Sp?nola, Ph.D.*
Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
Universidad Nacional
Apartado 1350-3000
Heredia
COSTA RICA
mspinola at una.cr <mspinola at una.ac.cr>
mspinola10 at gmail.com
Tel?fono: (506) 8706 - 4662
Personal website: Lobito de r?o <https://sites.google.com/site/lobitoderio/>
Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>

	[[alternative HTML version deleted]]


From kmb56 at berkeley.edu  Sun Mar  5 01:27:09 2017
From: kmb56 at berkeley.edu (Kenny Bell)
Date: Sat, 4 Mar 2017 16:27:09 -0800
Subject: [R-sig-Geo] Bug in raster::canProcessInMemory?
Message-ID: <CALOjXYSj_ZaUaoqCMDNDMV9G=q01EG9_JZ=dvwkPuW5fXEKaUg@mail.gmail.com>

The current code is:

```
function(x, n=4) {

if (.toDisk()) {
return(FALSE)
}
n <- n + nlayers(x) - 1
cells <- round( 1.1 * ncell(x) ) * n

if ( cells > .maxmemory() ) {
return(FALSE)
} else {
return(TRUE)
}
}
```
The line ``n <- n + nlayers(x) - 1`` seems like it should be ``n <- n *
nlayers(x)``.

Better yet, I'd remove that line and change the next to: ``cells <- round(
1.1 * ncell(x) * nlayers(x) ) * n``

Hope this helps,
Kenny

-- 
Kendon Bell
Email: kmb56 at berkeley.edu
Phone: (510) 612-3375

Ph.D. Candidate
Department of Agricultural & Resource Economics
University of California, Berkeley

	[[alternative HTML version deleted]]


From r.turner at auckland.ac.nz  Sun Mar  5 02:12:34 2017
From: r.turner at auckland.ac.nz (Rolf Turner)
Date: Sun, 5 Mar 2017 14:12:34 +1300
Subject: [R-sig-Geo] [FORGED] Re: Making an hexagonal grid using spsample
In-Reply-To: <542fe436-c8e4-71e8-7d91-3e73e5ce152b@urjc.es>
References: <CABkCotQgV7Oi0cijTq=nNM7kUX=E-1gWGA1fs0x42XyYWZDCrA@mail.gmail.com>
	<6c1d588d-aea3-c11e-77fd-da72a3c2fbf6@urjc.es>
	<bc708952-1422-5f80-b6e7-72f5dcfe47fa@auckland.ac.nz>
	<542fe436-c8e4-71e8-7d91-3e73e5ce152b@urjc.es>
Message-ID: <2acfa55d-0cee-1ec8-7e77-9a45e5b319c0@auckland.ac.nz>


On 05/03/17 01:35, Marcelino de la Cruz Rot wrote:

> My apologies for such a pair (or more) of embarrassing mistakes!
>
> I should read a bit more these days...


I'm just happy to see that this sort of mistake happens to others as 
well as to my very good self! :-)

cheers,

Rolf


-- 
Technical Editor ANZJS
Department of Statistics
University of Auckland
Phone: +64-9-373-7599 ext. 88276


From tom.hengl at gmail.com  Mon Mar  6 09:58:32 2017
From: tom.hengl at gmail.com (Tomislav Hengl)
Date: Mon, 6 Mar 2017 09:58:32 +0100
Subject: [R-sig-Geo] GEOSTAT Summer School for PhD students | 13-19 August
 2017 | MEDILS Split
In-Reply-To: <9aaeb793-4db7-5669-2079-5edee312428d@spatial-analyst.net>
References: <9aaeb793-4db7-5669-2079-5edee312428d@spatial-analyst.net>
Message-ID: <dcc8495e-7c34-7687-f758-2b965f130916@gmail.com>


The GEOSTAT Split 2017 Summer School will be held this year at the 
Mediterranean Institute for Life Sciences (MEDILS) Split, Croatia in the 
period 13-19 August 2017. MEDILS is an international centre of 
excellence for molecular biology and is located in a nature park in a 
near proximity of the historic town Split. It has in-house accommodation 
and numerous facilities including its own park and sport facilities.

The registrations are now open. To register for this Summer School 
please visit:

https://geostat-course.org/2017

This summer school is limited to 55 participants. In the case of higher 
number of registrations, applicants will be ranked based on (1) their 
contribution to the FOSS, (2) academic output, (3) distance to the venue 
and (4) time of registration. The registrations fees are usually around 
550 EUR (invoice will be sent after registrations). Registration fees 
cover costs of using facilities, lunch and coffee breaks and costs of 
travel and accommodation for lecturers. Participants from ODA countries 
(employed by an organization or company in ODA-listed country) typically 
receive a subsidized price for the accommodation and registration costs. 
GEOSTAT makes no profit. All lecturers are volunteers. None of the 
lecturers receives any honorarium payment or is contracted by the local 
organizers.

This years topics include:
- Application of R+OSGeo tools in: spatio-temporal monitoring, 
geostatistical mapping, point pattern analysis, epidemiology...
- Machine Learning methods for spatial and spatio-temporal data,
- QGIS and RQGIS tutorials,
- RMarkdown/Sweave tutorials,
- Visualization of spatio-temporal data,

Lecturers:
- Barry Rowlingson (Lancaster Medical School, Lancaster University),
- Virgilio Gomez Rubio (Deparment of Mathematics, Universidad de 
Castilla-La Mancha),
- Jannes Muenchow (Department of GIScience, University of Jena),
- Daniel N?st (Institute for Geoinformatics, University of M?nster)
- Tomislav Hengl (ISRIC - World Soil Information),

Registration deadline is:

- April 15th 2017

hope to see you in Split,

T. Hengl
http://www.wageningenur.nl/en/Persons/dr.-T-Tom-Hengl.htm


From martazores at gmail.com  Mon Mar  6 12:51:45 2017
From: martazores at gmail.com (marta azores)
Date: Mon, 6 Mar 2017 10:51:45 -0100
Subject: [R-sig-Geo] loop memory problem
Message-ID: <CAE3WKgQPSYMxSzTSarj9Ee2xrkjcWg4fQYZJESvxnOnGkGBeZg@mail.gmail.com>

Hi all the members,

I have an script with a loop. It's working properly with a few points.
However, when I tried to run all my database 90.000 points, the loop
stopped each 3.000 points. And it takes 8hours for run 3.000 points.

My computer has 32GB of RAM, intel corei7 6700HQ CPU @ 2.60GHz .

Do you think it can be a memory problem? Is there anyway to make it faster??

Thanks you in advance,

Marta

####files
https://drive.google.com/open?id=0BwqSBe1Yq-FBUWVBOUdvaThEU1k
##############the script
library(sp)
library(gdistance)
library(rgeos)
### define data folder
path_data<-"C:/Users/Q11/"

#debug test# tormenta1
tor<- read.table(paste0(path_data,"tormenta1.csv"), header=TRUE, sep=",",
na.strings="NA", dec=".", strip.white=TRUE)
#transition layer
costa6Azo<- raster(paste0(path_data,"costa6Azo_projected.tif"))#wgs84
transitioncosta6Azo <- transition(costa6Azo, min, directions=16)#porque
min????
trCostS16 <- gdistance::geoCorrection(transitioncosta6Azo, type="c")
#

effortSP_tormentapos_1_1<-as.data.frame(cbind(tor$Lat1,tor$Long1,tor$transect))

str(effortSP_tormentapos_1_1)
sp::coordinates(effortSP_tormentapos_1_1) <- ~V2+V1
sp::proj4string(effortSP_tormentapos_1_1) <-CRS("+proj=longlat +datum=WGS84
+no_defs")

effortSP_tormenta <-sp::spTransform(effortSP_tormentapos_1_1,
CRS("+proj=utm +zone=26 +ellps=intl +towgs84=-104,167,-38,0,0,0,0 +units=m
+no_defs"))

#effortSP_tormenta#to keep the same names
plot(effortSP_tormentapos_1_1,axes=TRUE,add=TRUE)
# calculating the first segment of the whole sailing path# 10 total points
tormenta<- gdistance::shortestPath(trCostS16, effortSP_tormenta at coords
[1,],effortSP_tormenta at coords[2,], output="SpatialLines")
gLength(tormenta)
lines(tormenta,col=5)

### here we start with the for-loop :
for (i in (seq(2,length(effortSP_tormenta)-1))) { {
  print(tormenta)
  nextSegment<- gdistance::shortestPath(trCostS16, effortSP_tormenta at coords
[i,],effortSP_tormenta at coords[i+1,], output="SpatialLines")
  # simple addition combines the single spatialline segements
  tormenta <- nextSegment + tormenta
  # we plot each new segement
  lines(nextSegment)
  gLength(nextSegment)

}}
####################################

	[[alternative HTML version deleted]]


From ticianaz at hotmail.com  Mon Mar  6 15:12:36 2017
From: ticianaz at hotmail.com (Ticiana Grecco Zanon)
Date: Mon, 6 Mar 2017 14:12:36 +0000
Subject: [R-sig-Geo] Model -  SAR Poisson GLM
In-Reply-To: <CAE3WKgQPSYMxSzTSarj9Ee2xrkjcWg4fQYZJESvxnOnGkGBeZg@mail.gmail.com>
References: <CAE3WKgQPSYMxSzTSarj9Ee2xrkjcWg4fQYZJESvxnOnGkGBeZg@mail.gmail.com>
Message-ID: <DM3PR17MB07794311227B03E8E82D2431CC2C0@DM3PR17MB0779.namprd17.prod.outlook.com>

Hello everybody,


I am estimating a doubly constrained model with Poisson (Quasi-Poisson) but I would like to include a spatial lag variable to account to spatial dependence. My data is not zero-inflated but it is overdispersed.


Thanks in advance,

Ticiana



	[[alternative HTML version deleted]]


From timothee.giraud at cnrs.fr  Mon Mar  6 16:42:50 2017
From: timothee.giraud at cnrs.fr (=?UTF-8?Q?Timoth=c3=a9e_Giraud?=)
Date: Mon, 6 Mar 2017 16:42:50 +0100
Subject: [R-sig-Geo] Making an hexagonal grid using spsample
In-Reply-To: <5e463995-7460-abe7-a430-77233481687c@cnrs.fr>
References: <mailman.6.1488711602.24447.r-sig-geo@r-project.org>
	<5e463995-7460-abe7-a430-77233481687c@cnrs.fr>
Message-ID: <e10477db-04f2-2eb6-be92-e813188e92dd@cnrs.fr>

Hi,

I understand you find a solution via hextess from spatstat.

However, this is a solution with spsample from sp.

Actually, the cellsize argument of spsample defines the distance between 
the center of consecutives hexagons.
So it is the length of 2 medians of one of the 6 equilateral triangles 
composing the hexagon.

You can obtain the correct cellsize with:
- the formula that calculates the median length for a given equilateral 
triangle length size,
- the formula that calculate the area of an hexagon with a given side 
length.


library(sp)
data(meuse.grid)
gridded(meuse.grid) = ~x+y
plot(meuse.grid)

# targeted area in meters
A <- 10000
# Corresponding cellsize :
CS <- 2 * sqrt(A/((3*sqrt(3)/2))) * sqrt(3)/2

# hexagons
HexPts <-spsample(x = meuse.grid, type = "hexagonal", cellsize = CS)
HexPols <- HexPoints2SpatialPolygons(HexPts)

plot(HexPols, add=TRUE)

# check
rgeos::gArea(HexPols, byid = T)[1:10]




Since you asked me about getGridLayer via PM, this function of the 
cartography package uses spsample with its cellsize argument, maybe I 
should add a "targeted area" argument...


From tkeitt at utexas.edu  Mon Mar  6 21:18:20 2017
From: tkeitt at utexas.edu (Tim Keitt)
Date: Mon, 6 Mar 2017 14:18:20 -0600
Subject: [R-sig-Geo] Making an hexagonal grid using spsample
In-Reply-To: <CABkCotQgV7Oi0cijTq=nNM7kUX=E-1gWGA1fs0x42XyYWZDCrA@mail.gmail.com>
References: <CABkCotQgV7Oi0cijTq=nNM7kUX=E-1gWGA1fs0x42XyYWZDCrA@mail.gmail.com>
Message-ID: <CANnL8gowmMVcfJ98YmyUSvY-3smf06g+h2jikwZMcvd8C2wY_A@mail.gmail.com>

http://www.keittlab.org/

On Fri, Mar 3, 2017 at 1:03 PM, Manuel Sp?nola <mspinola10 at gmail.com> wrote:

> Dear list members,
>
> I am trying to make an spatial hexagonal grid in R using the spsample
> function. I would like hexagons of 1 ha = 10000 sq meters.
>
>
> First I used a cell size of 62.04 m as the side of the hexagon.
>
> data(meuse.grid)
> gridded(meuse.grid) = ~x + y
> proj4string(meuse.grid) <- CRS("+init=epsg:28992")
> xx <- spsample(meuse.grid, type = "hexagonal", cellsize = 62.04)
> xx <- HexPoints2SpatialPolygons(xx)
> rgeos::gArea(xx, byid=TRUE)
>
> It gave me an area per hexagon = 3333.299
>
> Second I used a cell size of 62.04 * 2 = 124.08 m as the long diagonal of
> the hexagon
>
> data(meuse.grid)
> gridded(meuse.grid) = ~x + y
> proj4string(meuse.grid) <- CRS("+init=epsg:28992")
> xx <- spsample(meuse.grid, type = "hexagonal", cellsize = 62.04*2)
> xx <- HexPoints2SpatialPolygons(xx)
> rgeos::gArea(xx, byid=TRUE)
>
> It gave me an area per hexagon = 13333.19
>
> Both results are wrong, because I was expecting close to 10000.
>
> How can I make a spatial grid of 1 ha (or other size) in R?
>

You might search the list. I posted R code a long time ago that builds a
hexagonal tessellation over a rectangle. I think Edzer used that to add the
hexagonal option to spsample.

THK


>
> Manuel
>
> --
> *Manuel Sp?nola, Ph.D.*
> Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
> Universidad Nacional
> Apartado 1350-3000
> Heredia
> COSTA RICA
> mspinola at una.cr <mspinola at una.ac.cr>
> mspinola10 at gmail.com
> Tel?fono: (506) 8706 - 4662
> Personal website: Lobito de r?o <https://sites.google.com/
> site/lobitoderio/>
> Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

	[[alternative HTML version deleted]]


From tkeitt at utexas.edu  Mon Mar  6 21:20:33 2017
From: tkeitt at utexas.edu (Tim Keitt)
Date: Mon, 6 Mar 2017 14:20:33 -0600
Subject: [R-sig-Geo] Making an hexagonal grid using spsample
In-Reply-To: <CANnL8gowmMVcfJ98YmyUSvY-3smf06g+h2jikwZMcvd8C2wY_A@mail.gmail.com>
References: <CABkCotQgV7Oi0cijTq=nNM7kUX=E-1gWGA1fs0x42XyYWZDCrA@mail.gmail.com>
	<CANnL8gowmMVcfJ98YmyUSvY-3smf06g+h2jikwZMcvd8C2wY_A@mail.gmail.com>
Message-ID: <CANnL8goSJ1bmobkLaBfZumJZy1_p3_O9q-T7kPSTA2U6ccu1PQ@mail.gmail.com>

On Mon, Mar 6, 2017 at 2:18 PM, Tim Keitt <tkeitt at utexas.edu> wrote:

> You might search the list


https://stat.ethz.ch/pipermail/r-sig-geo/2007-March/001791.html

http://www.keittlab.org/

	[[alternative HTML version deleted]]


From mspinola10 at gmail.com  Tue Mar  7 00:56:01 2017
From: mspinola10 at gmail.com (=?UTF-8?Q?Manuel_Sp=C3=ADnola?=)
Date: Mon, 6 Mar 2017 17:56:01 -0600
Subject: [R-sig-Geo] Making an hexagonal grid using spsample
In-Reply-To: <e10477db-04f2-2eb6-be92-e813188e92dd@cnrs.fr>
References: <mailman.6.1488711602.24447.r-sig-geo@r-project.org>
	<5e463995-7460-abe7-a430-77233481687c@cnrs.fr>
	<e10477db-04f2-2eb6-be92-e813188e92dd@cnrs.fr>
Message-ID: <CABkCotSQ19x=x7q-sopQ7T9xgxEHTrC422DsZ-59mAeED_svmw@mail.gmail.com>

Thank you very much Timoth?e.

That works.

Manuel

2017-03-06 9:42 GMT-06:00 Timoth?e Giraud <timothee.giraud at cnrs.fr>:

> Hi,
>
> I understand you find a solution via hextess from spatstat.
>
> However, this is a solution with spsample from sp.
>
> Actually, the cellsize argument of spsample defines the distance between
> the center of consecutives hexagons.
> So it is the length of 2 medians of one of the 6 equilateral triangles
> composing the hexagon.
>
> You can obtain the correct cellsize with:
> - the formula that calculates the median length for a given equilateral
> triangle length size,
> - the formula that calculate the area of an hexagon with a given side
> length.
>
>
> library(sp)
> data(meuse.grid)
> gridded(meuse.grid) = ~x+y
> plot(meuse.grid)
>
> # targeted area in meters
> A <- 10000
> # Corresponding cellsize :
> CS <- 2 * sqrt(A/((3*sqrt(3)/2))) * sqrt(3)/2
>
> # hexagons
> HexPts <-spsample(x = meuse.grid, type = "hexagonal", cellsize = CS)
> HexPols <- HexPoints2SpatialPolygons(HexPts)
>
> plot(HexPols, add=TRUE)
>
> # check
> rgeos::gArea(HexPols, byid = T)[1:10]
>
>
>
>
> Since you asked me about getGridLayer via PM, this function of the
> cartography package uses spsample with its cellsize argument, maybe I
> should add a "targeted area" argument...
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



-- 
*Manuel Sp?nola, Ph.D.*
Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
Universidad Nacional
Apartado 1350-3000
Heredia
COSTA RICA
mspinola at una.cr <mspinola at una.ac.cr>
mspinola10 at gmail.com
Tel?fono: (506) 8706 - 4662
Personal website: Lobito de r?o <https://sites.google.com/site/lobitoderio/>
Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>

	[[alternative HTML version deleted]]


From mspinola10 at gmail.com  Tue Mar  7 01:11:40 2017
From: mspinola10 at gmail.com (=?UTF-8?Q?Manuel_Sp=C3=ADnola?=)
Date: Mon, 6 Mar 2017 18:11:40 -0600
Subject: [R-sig-Geo] Making an hexagonal grid using spsample
In-Reply-To: <CANnL8goSJ1bmobkLaBfZumJZy1_p3_O9q-T7kPSTA2U6ccu1PQ@mail.gmail.com>
References: <CABkCotQgV7Oi0cijTq=nNM7kUX=E-1gWGA1fs0x42XyYWZDCrA@mail.gmail.com>
	<CANnL8gowmMVcfJ98YmyUSvY-3smf06g+h2jikwZMcvd8C2wY_A@mail.gmail.com>
	<CANnL8goSJ1bmobkLaBfZumJZy1_p3_O9q-T7kPSTA2U6ccu1PQ@mail.gmail.com>
Message-ID: <CABkCotQ9G_yWZ2hx0jiY9kZyerMZ2V6X7S30nfPsD6GdrhB5Fg@mail.gmail.com>

Thank you very much Tim.

Manuel

2017-03-06 14:20 GMT-06:00 Tim Keitt <tkeitt at utexas.edu>:

>
> On Mon, Mar 6, 2017 at 2:18 PM, Tim Keitt <tkeitt at utexas.edu> wrote:
>
>> You might search the list
>
>
> https://stat.ethz.ch/pipermail/r-sig-geo/2007-March/001791.html
>
> http://www.keittlab.org/
>



-- 
*Manuel Sp?nola, Ph.D.*
Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
Universidad Nacional
Apartado 1350-3000
Heredia
COSTA RICA
mspinola at una.cr <mspinola at una.ac.cr>
mspinola10 at gmail.com
Tel?fono: (506) 8706 - 4662
Personal website: Lobito de r?o <https://sites.google.com/site/lobitoderio/>
Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>

	[[alternative HTML version deleted]]


From gangwism at informatik.uni-freiburg.de  Tue Mar  7 10:00:44 2017
From: gangwism at informatik.uni-freiburg.de (Marcel Gangwisch)
Date: Tue, 7 Mar 2017 10:00:44 +0100
Subject: [R-sig-Geo] loop memory problem
In-Reply-To: <CAE3WKgQPSYMxSzTSarj9Ee2xrkjcWg4fQYZJESvxnOnGkGBeZg@mail.gmail.com>
References: <CAE3WKgQPSYMxSzTSarj9Ee2xrkjcWg4fQYZJESvxnOnGkGBeZg@mail.gmail.com>
Message-ID: <8ca347cd-2fb9-2443-ff38-b5c59f4d9950@informatik.uni-freiburg.de>

Hi Marta,

for your loop:
1) maybe you can first make your calculations and afterwards plot the 
result.
It might be faster this way.

2) maybe you can use the parallel for each loop in order to use the 
whole performance of your cpu

3) loops in R are really slow in general.. you could also think about 
some fancy stuff like some R compiler or Rcpp package

4) in order to analyze your memory consumption, you should have a view 
on your system resources (depending on your OS: task manager (win) or 
htop (linux))

Best regards,
Marcel


On 06.03.2017 12:51, marta azores wrote:
> Hi all the members,
>
> I have an script with a loop. It's working properly with a few points.
> However, when I tried to run all my database 90.000 points, the loop
> stopped each 3.000 points. And it takes 8hours for run 3.000 points.
>
> My computer has 32GB of RAM, intel corei7 6700HQ CPU @ 2.60GHz .
>
> Do you think it can be a memory problem? Is there anyway to make it faster??
>
> Thanks you in advance,
>
> Marta
>
> ####files
> https://drive.google.com/open?id=0BwqSBe1Yq-FBUWVBOUdvaThEU1k
> ##############the script
> library(sp)
> library(gdistance)
> library(rgeos)
> ### define data folder
> path_data<-"C:/Users/Q11/"
>
> #debug test# tormenta1
> tor<- read.table(paste0(path_data,"tormenta1.csv"), header=TRUE, sep=",",
> na.strings="NA", dec=".", strip.white=TRUE)
> #transition layer
> costa6Azo<- raster(paste0(path_data,"costa6Azo_projected.tif"))#wgs84
> transitioncosta6Azo <- transition(costa6Azo, min, directions=16)#porque
> min????
> trCostS16 <- gdistance::geoCorrection(transitioncosta6Azo, type="c")
> #
>
> effortSP_tormentapos_1_1<-as.data.frame(cbind(tor$Lat1,tor$Long1,tor$transect))
>
> str(effortSP_tormentapos_1_1)
> sp::coordinates(effortSP_tormentapos_1_1) <- ~V2+V1
> sp::proj4string(effortSP_tormentapos_1_1) <-CRS("+proj=longlat +datum=WGS84
> +no_defs")
>
> effortSP_tormenta <-sp::spTransform(effortSP_tormentapos_1_1,
> CRS("+proj=utm +zone=26 +ellps=intl +towgs84=-104,167,-38,0,0,0,0 +units=m
> +no_defs"))
>
> #effortSP_tormenta#to keep the same names
> plot(effortSP_tormentapos_1_1,axes=TRUE,add=TRUE)
> # calculating the first segment of the whole sailing path# 10 total points
> tormenta<- gdistance::shortestPath(trCostS16, effortSP_tormenta at coords
> [1,],effortSP_tormenta at coords[2,], output="SpatialLines")
> gLength(tormenta)
> lines(tormenta,col=5)
>
> ### here we start with the for-loop :
> for (i in (seq(2,length(effortSP_tormenta)-1))) { {
>    print(tormenta)
>    nextSegment<- gdistance::shortestPath(trCostS16, effortSP_tormenta at coords
> [i,],effortSP_tormenta at coords[i+1,], output="SpatialLines")
>    # simple addition combines the single spatialline segements
>    tormenta <- nextSegment + tormenta
>    # we plot each new segement
>    lines(nextSegment)
>    gLength(nextSegment)
>
> }}
> ####################################
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From gangwism at informatik.uni-freiburg.de  Tue Mar  7 10:11:05 2017
From: gangwism at informatik.uni-freiburg.de (Marcel Gangwisch)
Date: Tue, 7 Mar 2017 10:11:05 +0100
Subject: [R-sig-Geo] loop memory problem
In-Reply-To: <8ca347cd-2fb9-2443-ff38-b5c59f4d9950@informatik.uni-freiburg.de>
References: <CAE3WKgQPSYMxSzTSarj9Ee2xrkjcWg4fQYZJESvxnOnGkGBeZg@mail.gmail.com>
	<8ca347cd-2fb9-2443-ff38-b5c59f4d9950@informatik.uni-freiburg.de>
Message-ID: <882f4b60-060b-df3f-9405-a04fdc6bff7b@informatik.uni-freiburg.de>

Hi Marta,

for your loop:
1) maybe you can first make your calculations and afterwards plot the 
result.
It might be faster this way.

2) maybe you can use the parallel for each loop in order to use the 
whole performance of your cpu

3) loops in R are really slow in general.. you could also think about 
some fancy stuff like some R compiler or Rcpp package

4) in order to analyze your memory consumption, you should have a view 
on your system resources (depending on your OS: task manager (win) or 
htop (linux))

Best regards,
Marcel



On 06.03.2017 12:51, marta azores wrote:
> Hi all the members,
>
> I have an script with a loop. It's working properly with a few points.
> However, when I tried to run all my database 90.000 points, the loop
> stopped each 3.000 points. And it takes 8hours for run 3.000 points.
>
> My computer has 32GB of RAM, intel corei7 6700HQ CPU @ 2.60GHz .
>
> Do you think it can be a memory problem? Is there anyway to make it 
> faster??
>
> Thanks you in advance,
>
> Marta
>
> ####files
> https://drive.google.com/open?id=0BwqSBe1Yq-FBUWVBOUdvaThEU1k
> ##############the script
> library(sp)
> library(gdistance)
> library(rgeos)
> ### define data folder
> path_data<-"C:/Users/Q11/"
>
> #debug test# tormenta1
> tor<- read.table(paste0(path_data,"tormenta1.csv"), header=TRUE, sep=",",
> na.strings="NA", dec=".", strip.white=TRUE)
> #transition layer
> costa6Azo<- raster(paste0(path_data,"costa6Azo_projected.tif"))#wgs84
> transitioncosta6Azo <- transition(costa6Azo, min, directions=16)#porque
> min????
> trCostS16 <- gdistance::geoCorrection(transitioncosta6Azo, type="c")
> #
>
> effortSP_tormentapos_1_1<-as.data.frame(cbind(tor$Lat1,tor$Long1,tor$transect)) 
>
>
> str(effortSP_tormentapos_1_1)
> sp::coordinates(effortSP_tormentapos_1_1) <- ~V2+V1
> sp::proj4string(effortSP_tormentapos_1_1) <-CRS("+proj=longlat 
> +datum=WGS84
> +no_defs")
>
> effortSP_tormenta <-sp::spTransform(effortSP_tormentapos_1_1,
> CRS("+proj=utm +zone=26 +ellps=intl +towgs84=-104,167,-38,0,0,0,0 
> +units=m
> +no_defs"))
>
> #effortSP_tormenta#to keep the same names
> plot(effortSP_tormentapos_1_1,axes=TRUE,add=TRUE)
> # calculating the first segment of the whole sailing path# 10 total 
> points
> tormenta<- gdistance::shortestPath(trCostS16, effortSP_tormenta at coords
> [1,],effortSP_tormenta at coords[2,], output="SpatialLines")
> gLength(tormenta)
> lines(tormenta,col=5)
>
> ### here we start with the for-loop :
> for (i in (seq(2,length(effortSP_tormenta)-1))) { {
>    print(tormenta)
>    nextSegment<- gdistance::shortestPath(trCostS16, 
> effortSP_tormenta at coords
> [i,],effortSP_tormenta at coords[i+1,], output="SpatialLines")
>    # simple addition combines the single spatialline segements
>    tormenta <- nextSegment + tormenta
>    # we plot each new segement
>    lines(nextSegment)
>    gLength(nextSegment)
>
> }}
> ####################################
>
>     [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From corey.sparks at utsa.edu  Tue Mar  7 16:46:19 2017
From: corey.sparks at utsa.edu (Corey Sparks)
Date: Tue, 7 Mar 2017 15:46:19 +0000
Subject: [R-sig-Geo] Model -  SAR Poisson GLM (Ticiana Grecco Zanon)
Message-ID: <em2a93126b-8254-43c5-a6f4-f501c9a85def@coreysparks>

Hello, there is such a thing as an auto-Poisson model. I have an rpub here
http://rpubs.com/corey_sparks/250410

and towards the bottom, I show how to lag the count outcome and include it in the model. You could do this with any variable in your model (create a lag of it), by using the lag.listw() function in spdep.

You can also include the lag term in a negative binomial if you want to include overdispersion, without resorting to the 'quasi' distributions.
Best,
Corey

Corey Sparks, Ph.D.
Associate Professor
Graduate Advisor of Record
Department of Demography
The University of Texas at San Antonio
501 West Cesar E Chavez Blvd
corey.sparks 'at' utsa.edu<http://t.sidekickopen55.com/e1t/c/5/f18dQhb0S7lC8dDMPbW2n0x6l2B9nMJW7t5XZs3LQ7cCN63RMPbd7cf-W8qlRZx56dPL4f2wwDQl02?si=5625354980425728&pi=3F5E8B84-79AC-4CDA-8B3A-E2CA0310971B&t=http%3A%2F%2Futsa%2Eedu>
coreysparks.weebly.com<http://t.sidekickopen55.com/e1t/c/5/f18dQhb0S7lC8dDMPbW2n0x6l2B9nMJW7t5XZs3LQ7cCN63RMPbd7cf-W8qlRZx56dPL4f2wwDQl02?si=5625354980425728&pi=3F5E8B84-79AC-4CDA-8B3A-E2CA0310971B&t=http%3A%2F%2Fcoreysparks%2Eweebly%2Ecom>


	[[alternative HTML version deleted]]


From mirzaceng at gmail.com  Tue Mar  7 17:33:09 2017
From: mirzaceng at gmail.com (Mirza Cengic)
Date: Tue, 7 Mar 2017 17:33:09 +0100
Subject: [R-sig-Geo] Interesection between spatial points and a raster
Message-ID: <CAJAunffApMfWv89pT2C8bh6qesr4UCkB4jbcdA9A1uxOgwnQBw@mail.gmail.com>

Hi all,

I'm in a need of a function (or a solution with the same results), which
would do something that might look like a spatial full outer join between
spatial points and a raster (in a similar way that .sp::over() kinda does
left outer join).

The raster::extract() function will extract raster values, and put it into
dataframe with the argument df = TRUE, but I would like to have a dataframe
which has the same number of rows as the number of cells of the raster from
which the values were extracted.
Ideally, I would like to have an output such as the variable df in the
example below, but have an extra column where I have TRUE/FALSE for example
if the sp falls in the cell.
I tried different things, but couldn't get a satisfactory result, so I
would appreciate some tips on this.

Thanks,
Mirza.

Below is a reproducible example to get things going:

# ----
library(raster)
# Create raster
r <- raster(nrow = 20, ncol = 20)
r[] <- rnorm(ncell(r))

# Create points
sp <- data.frame(nrow = ncell(r)/20, ncol = 2)
# jitter introduced since points shouldn't fall in the cell center in
reality
x <- jitter(sample(df[, "x"], ncell(r)/20))
y <- jitter(sample(df[, "y"], ncell(r)/20))

sp <- as.data.frame(cbind(x, y))
coordinates(sp) <- ~x+y
proj4string(sp) <- crs(r, asText = TRUE)

#
df <- raster::as.data.frame(r, xy = TRUE)
# Ideally, a column where observation is boolean of whether the point falls
in the cell or not
# df$is_sp <- solution()
# ----

	[[alternative HTML version deleted]]


From alexandresantosbr at yahoo.com.br  Tue Mar  7 17:07:29 2017
From: alexandresantosbr at yahoo.com.br (ASANTOS)
Date: Tue, 7 Mar 2017 12:07:29 -0400
Subject: [R-sig-Geo] Create a georeferenced PDF with shapefile,
 points of interest and values in R
In-Reply-To: <a6a58f77-47ae-53d8-66d5-ca8363ebe69e@yahoo.com.br>
References: <a6a58f77-47ae-53d8-66d5-ca8363ebe69e@yahoo.com.br>
Message-ID: <4fbe0635-cdcd-52c8-bdab-95b0484b27cc@yahoo.com.br>


Dear Members,

I created a georeferenced PDF using a shapefile and OK no problem, but 
I'd like to know if is possible to insert a title inside a output pdf 
(in top position "My geo PDF"), points of interest (pts.sampling) and 
values too.

In my example:

#Packages

|require(rgdal)require(maptools)|

#Create 2 polygons

|sr 
<-SpatialPolygons(list(Polygons(list(Polygon(cbind(c(180114,180553,181127,181477,181294,181007,180409,180162,180114),c(332349,332057,332342,333250,333558,333676,332618,332413,332349)))),'1'),Polygons(list(Polygon(cbind(c(180042,180545,180553,180314,179955,179142,179437,179524,179979,180042),c(332373,332026,331426,330889,330683,331133,331623,332152,332357,332373)))),'2')))|

#Convert in spatial polygon

|srdf=SpatialPolygonsDataFrame(sr,data.frame(row.names=c('1','2'),PIDS=1:2))srdf at data 
proj4string(srdf)<-CRS("+proj=utm +zone=21 +south +datum=WGS84 +units=m 
+no_defs")|

#Create shapefile

|writeOGR(srdf,getwd(),'ARS','ESRI Shapefile')|

#Read shapefile

|contorno_line<-readShapeLines ("ARS.shp")|

#Plot

|plot(contorno_line,main="My geo PDF")|

#Points of interest and values

|x<-c(180684.2,179786.2,180766.4,180335.5,181392.6,180881.9,181167.9,180544.5,180680.9,180259.6)y<-c(332264.8,331057.3,332190.5,331643.7,333384.4,333444.8,333381.6,332607.9,332625.9,331867.7)Class<-c(5,5,3,1,2,3,5,5,2,2)pts<-cbind(x,y,Class)pts.sampling 
=SpatialPoints(pts,proj4string=CRS("+proj=utm +zone=21 +south 
+datum=WGS84 +units=m 
+no_defs"))points(pts.sampling,col="red")text(pts.sampling,labels=paste(pts.sampling$Class),cex=0.7,pos=3)|

#Create a geoPDF

|writeOGR(contorno_line,dsn ="mygeoPDF",layer ="contorno_geo",driver ="PDF")|

But my problem is, how I can put|main="My geo PDF"|, 
points(|pts.sampling, col="red"|) 
and|text(pts.sampling,labels=paste(pts.sampling$Class), cex= 
0.7,pos=3)|inside the mygeoPDF.pdf created?


-- 
======================================================================
Alexandre dos Santos
Prote??o Florestal
IFMT - Instituto Federal de Educa??o, Ci?ncia e Tecnologia de Mato Grosso
Campus C?ceres
Caixa Postal 244
Avenida dos Ramires, s/n
Bairro: Distrito Industrial
C?ceres - MT                      CEP: 78.200-000
Fone: (+55) 65 99686-6970 (VIVO) (+55) 65 3221-2674 (FIXO)

         alexandre.santos at cas.ifmt.edu.br  
Lattes:http://lattes.cnpq.br/1360403201088680  
OrcID: orcid.org/0000-0001-8232-6722   -   ResearcherID: A-5790-2016
Researchgate:www.researchgate.net/profile/Alexandre_Santos10                        
LinkedIn: br.linkedin.com/in/alexandre-dos-santos-87961635
Mendeley:www.mendeley.com/profiles/alexandre-dos-santos6/
======================================================================


	[[alternative HTML version deleted]]


From mirzaceng at gmail.com  Tue Mar  7 22:23:37 2017
From: mirzaceng at gmail.com (Mirza Cengic)
Date: Tue, 7 Mar 2017 22:23:37 +0100
Subject: [R-sig-Geo] Retrieving rasters from ESRI geodabase
Message-ID: <CAJAunfe74pe+=8C1q6S-eSk4+SHo_9u3srQvVdNL5Us7yD2FBA@mail.gmail.com>

Hi all,

I was wondering if there is a tool in R with which it is possible to load
rasters from ESRI geodatabase (file gdb).
I know a few years ago this was not really possible (to my knowledge), but
I'm wondering if there was something developed recently?

Thank you in advance for the replies,
Mirza.

	[[alternative HTML version deleted]]


From nlee at valleywater.org  Tue Mar  7 23:18:20 2017
From: nlee at valleywater.org (Nahm Lee)
Date: Tue, 7 Mar 2017 22:18:20 +0000
Subject: [R-sig-Geo] Retrieving rasters from ESRI geodabase
In-Reply-To: <CAJAunfe74pe+=8C1q6S-eSk4+SHo_9u3srQvVdNL5Us7yD2FBA@mail.gmail.com>
References: <CAJAunfe74pe+=8C1q6S-eSk4+SHo_9u3srQvVdNL5Us7yD2FBA@mail.gmail.com>
Message-ID: <4F96A3E542010442B8785D2CC2384147CCE13576@SRVEXCHMBX2.scvwd.gov>

http://gis.stackexchange.com/questions/184013/read-a-table-from-an-esri-file-geodatabase-gdb-using-r

FYI

-Nahm Lee
________________________________________
From: R-sig-Geo [r-sig-geo-bounces at r-project.org] on behalf of Mirza Cengic [mirzaceng at gmail.com]
Sent: Tuesday, March 07, 2017 1:23 PM
To: r-sig-geo at r-project.org
Subject: [R-sig-Geo] Retrieving rasters from ESRI geodabase

Hi all,

I was wondering if there is a tool in R with which it is possible to load
rasters from ESRI geodatabase (file gdb).
I know a few years ago this was not really possible (to my knowledge), but
I'm wondering if there was something developed recently?

Thank you in advance for the replies,
Mirza.

        [[alternative HTML version deleted]]

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From mirzaceng at gmail.com  Tue Mar  7 23:33:47 2017
From: mirzaceng at gmail.com (Mirza Cengic)
Date: Tue, 7 Mar 2017 23:33:47 +0100
Subject: [R-sig-Geo] Retrieving rasters from ESRI geodabase
In-Reply-To: <4F96A3E542010442B8785D2CC2384147CCE13576@SRVEXCHMBX2.scvwd.gov>
References: <CAJAunfe74pe+=8C1q6S-eSk4+SHo_9u3srQvVdNL5Us7yD2FBA@mail.gmail.com>
	<4F96A3E542010442B8785D2CC2384147CCE13576@SRVEXCHMBX2.scvwd.gov>
Message-ID: <CAJAunfeLYH1ENnxE1ijjcH4b9Msois0WEDp4xLs76MeUT0v-8g@mail.gmail.com>

Thanks Andrew and Nahm for the suggestions, but these links still only are
for reading feature classes and tables, I still cannot find any details for
rasters.

Mirza.

On Tue, Mar 7, 2017 at 11:18 PM, Nahm Lee <nlee at valleywater.org> wrote:

> http://gis.stackexchange.com/questions/184013/read-a-table-
> from-an-esri-file-geodatabase-gdb-using-r
>
> FYI
>
> -Nahm Lee
> ________________________________________
> From: R-sig-Geo [r-sig-geo-bounces at r-project.org] on behalf of Mirza
> Cengic [mirzaceng at gmail.com]
> Sent: Tuesday, March 07, 2017 1:23 PM
> To: r-sig-geo at r-project.org
> Subject: [R-sig-Geo] Retrieving rasters from ESRI geodabase
>
> Hi all,
>
> I was wondering if there is a tool in R with which it is possible to load
> rasters from ESRI geodatabase (file gdb).
> I know a few years ago this was not really possible (to my knowledge), but
> I'm wondering if there was something developed recently?
>
> Thank you in advance for the replies,
> Mirza.
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



-- 
*Mirza ?engi?*

*Junior Researcher | Department of Environmental Science*
Radboud University | Heyendaalseweg 135
6525 AJ Nijmegen | The Netherlands

+31 657020823 | +38761908392
Skype: mirzacengic
<https://www.linkedin.com/in/mirzacengic>

	[[alternative HTML version deleted]]


From katakagi at bu.edu  Wed Mar  8 02:12:58 2017
From: katakagi at bu.edu (Kenneth Takagi)
Date: Tue, 7 Mar 2017 20:12:58 -0500
Subject: [R-sig-Geo] Retrieving rasters from ESRI
In-Reply-To: <CAOz3_FY=sgXGEUhxxJTPKHQdSR780M1GPyfbaGhjgOH6knjiHA@mail.gmail.com>
References: <CAOz3_FbL3VdZttmkuzK_95n=Hc8H0pbVzW+vuiTshbXFLtbV2w@mail.gmail.com>
	<CAOz3_FbyuGYXy0h3J7zorHu6BYtT+v0tpZfzv3Gcr5fdxFnybw@mail.gmail.com>
	<CAOz3_FayLW16oXJ3M=yuLRfYwR50JXENZ12Xgowa7m5ZgzeSZA@mail.gmail.com>
	<CAOz3_FaCRtQ0E6eRjtbZ8TcjV4GQ278+qRsAdURVLEAM4h+BGQ@mail.gmail.com>
	<CAOz3_FbDAsjxd+xWvLXd9NcnEPeO4mkfZVN7FMbykfAgWrm56A@mail.gmail.com>
	<CAOz3_Fawjjji=BJgLN9AQ_Osn+1WjdVYXYF5-6MV_RidtfjErg@mail.gmail.com>
	<CAOz3_FY=cEH9o5tEg+vDSSfKFe+4ydRLpgVhUsnr0CoP_0Mq_A@mail.gmail.com>
	<CAOz3_FZpP8760JxvO4wZkm9dO+aasB=qg29=eXzmht_-6VtBGA@mail.gmail.com>
	<CAOz3_Fa17Azku0CCAaUHz7QEq8iYHtByqRcVgQrnkr0c2tqCgw@mail.gmail.com>
	<CAOz3_FbpcdFksGFxSiqmJW=GKRP9Rz28WQLWqS7c_FPuoSmHkA@mail.gmail.com>
	<CAOz3_FY9N3xCiBfhf+RmWtDnSVQNrXzGNPjK3XV7G=6CY2NZXQ@mail.gmail.com>
	<CAOz3_FYx3kZiYvTKDTN0QTNzeBx89uj49S_1rszz-cmWVe1OLQ@mail.gmail.com>
	<CAOz3_FYSnLvDV3PDTPNBRf82YCTzZ1Meb_4rNRp_Pnv3+Kfk+A@mail.gmail.com>
	<CAOz3_FY=sgXGEUhxxJTPKHQdSR780M1GPyfbaGhjgOH6knjiHA@mail.gmail.com>
Message-ID: <CAOz3_FZTLbbye+gAT9ubE4TnF1t5eu90e840y-3e-+SHZRhtBw@mail.gmail.com>

I faced a similar situation recently, and it turns out that ESRI has not
released the API for exporting rasters from a geodatabase.  Interestingly,
they have released the API for vector files.  Here is some additional info:
http://gis.stackexchange.com/questions/129423/how-to-
access-file-geodatabase-gdb-rasters-with-gdal

If you have access to ArcGIS and ArcPy, there are Python scripts to export
rasters out of geodatabases that can then be imported into R using the
raster package, etc.  Otherwise, you may be out of luck unless ESRI has a
change of heart.

	[[alternative HTML version deleted]]


From rameshv at caryinstitute.org  Tue Mar  7 19:13:25 2017
From: rameshv at caryinstitute.org (Vijay Ramesh)
Date: Tue, 7 Mar 2017 13:13:25 -0500
Subject: [R-sig-Geo] How many polygons does a single polygon intersect with?
Message-ID: <CAOGv6M_a-4my-b9OzGe4tiO5p2A_P=8kn36JdGnuqs+yt8Yc+A@mail.gmail.com>

I currently possess a shapefile that consists of >5000 polygons. I would
like to know, for each polygon, how many other polygons it intersects with
and the names of each polygon it intersects with?

My output should be something like this:

[image: enter image description here] <https://i.stack.imgur.com/ELv3T.png>

Based on Jeffrey Evans suggestion on using gIntersects, I have tried the
following below. But, the process has been running continuously without
stopping for the last 5 hours. Any suggestions?

Here's the code I ran in R:

require(rgdal)
library(maptools)
library(rgeos)
library(GISTools)
Poly <- readOGR("C:\\Users\\rameshv\\Terrestrial_dissolved_multipart.shp")
Poly_join <- gIntersects(Poly)

Regards,
Vijay
-- 
Data Manager,
Barbara Han Lab,
Cary Institute of Ecosystem Studies,
2801 Sharon Turnpike, Millbrook, NY 12545
Lab Site : http://www.hanlab.science/
Personal Site : http://evolecol.weebly.com/
Phone : (845)-677-7600 Ext: 241

	[[alternative HTML version deleted]]


From rameshv at caryinstitute.org  Tue Mar  7 19:06:37 2017
From: rameshv at caryinstitute.org (Vijay Ramesh)
Date: Tue, 7 Mar 2017 13:06:37 -0500
Subject: [R-sig-Geo] Error in writeRaster for signature RasterPCA
Message-ID: <CAOGv6M8siZNSknthVrxC8QzQPiPUKXF-M-=dd8YODwbmyrXZqg@mail.gmail.com>

I am currently trying to obtain two rasters that are the Principal
component axes 1 and 2 for a list of bioclimatic variables that I am using.
I am using the rasterPCA() function that exists in the RStoolbox in R, but
I am unable to write it to a raster. Below is the code and the error that I
am getting:

library(raster)
library(RStoolbox)
##Loading the variables and then creating a raster stack, followed by a PCA
bio3 <- raster("C:\\Users\\rameshv\\bio3")
bio4 <- raster("C:\\Users\\rameshv\\bio4")
bio5 <- raster("C:\\Users\\rameshv\\bio5")
bio6 <- raster("C:\\Users\\rameshv\\bio6")
bio14 <- raster("C:\\Users\\rameshv\\bio_14")

pres_stack <- stack(bio3, bio4,bio5,bio6,bio14)

pre_pca <-  rasterPCA(pres_stack, nComp = 2)

writeRaster(pre_pca, "C:\\Users\\rameshv\\PC.tif")

Error in (function (classes, fdef, mtable) : unable to find an inherited
method for function ?writeRaster? for signature ?"rasterPCA", "character"?

I even tried a modification of the above code

writeRaster(pre_pca,"C:\\Users\\rameshv\\4_PCAforR\\PC.asc",
format="ascii", bylayer=T)

Getting the same error as above: Error in (function (classes, fdef, mtable)
: unable to find an inherited method for function ?writeRaster? for
signature ?"rasterPCA", "character"?

Any suggestions?
Vijay
-- 
Data Manager,
Barbara Han Lab,
Cary Institute of Ecosystem Studies,
2801 Sharon Turnpike, Millbrook, NY 12545
Lab Site : http://www.hanlab.science/
Personal Site : http://evolecol.weebly.com/
Phone : (845)-677-7600 Ext: 241

	[[alternative HTML version deleted]]


From ticianaz at hotmail.com  Tue Mar  7 19:27:35 2017
From: ticianaz at hotmail.com (Ticiana Grecco Zanon)
Date: Tue, 7 Mar 2017 18:27:35 +0000
Subject: [R-sig-Geo] Model -  SAR Poisson GLM (Ticiana Grecco Zanon)
In-Reply-To: <em2a93126b-8254-43c5-a6f4-f501c9a85def@coreysparks>
References: <em2a93126b-8254-43c5-a6f4-f501c9a85def@coreysparks>
Message-ID: <DM3PR17MB07797D39FD862F00B708B2D4CC2F0@DM3PR17MB0779.namprd17.prod.outlook.com>

Hello Corey,

Yes, this is what I needed! Thank you so much, I will prove it with my data.

Regards,
Ticiana Grecco Zanon Moura
UESC - Universidade Estadual de Santa Cruz
http://www.uesc.br
REGIOlab - Laboratorio de An?lisis Econ?mico Regional
http://www.uniovi.net/regiolab
________________________________


De: Corey Sparks <corey.sparks at utsa.edu>
Enviado: ter?a-feira, 7 de mar?o de 2017 12:46:19
Para: r-sig-geo at r-project.org
Cc: ticianaz at hotmail.com
Assunto: RE: Model - SAR Poisson GLM (Ticiana Grecco Zanon)

Hello, there is such a thing as an auto-Poisson model. I have an rpub here
http://rpubs.com/corey_sparks/250410

and towards the bottom, I show how to lag the count outcome and include it in the model. You could do this with any variable in your model (create a lag of it), by using the lag.listw() function in spdep.

You can also include the lag term in a negative binomial if you want to include overdispersion, without resorting to the 'quasi' distributions.
Best,
Corey

Corey Sparks, Ph.D.
Associate Professor
Graduate Advisor of Record
Department of Demography
The University of Texas at San Antonio
501 West Cesar E Chavez Blvd
corey.sparks 'at' utsa.edu<http://t.sidekickopen55.com/e1t/c/5/f18dQhb0S7lC8dDMPbW2n0x6l2B9nMJW7t5XZs3LQ7cCN63RMPbd7cf-W8qlRZx56dPL4f2wwDQl02?si=5625354980425728&pi=3F5E8B84-79AC-4CDA-8B3A-E2CA0310971B&t=http%3A%2F%2Futsa%2Eedu>
coreysparks.weebly.com<http://t.sidekickopen55.com/e1t/c/5/f18dQhb0S7lC8dDMPbW2n0x6l2B9nMJW7t5XZs3LQ7cCN63RMPbd7cf-W8qlRZx56dPL4f2wwDQl02?si=5625354980425728&pi=3F5E8B84-79AC-4CDA-8B3A-E2CA0310971B&t=http%3A%2F%2Fcoreysparks%2Eweebly%2Ecom>


From edzer.pebesma at uni-muenster.de  Wed Mar  8 11:27:38 2017
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Wed, 8 Mar 2017 11:27:38 +0100
Subject: [R-sig-Geo] How many polygons does a single polygon intersect
 with?
In-Reply-To: <CAOGv6M_a-4my-b9OzGe4tiO5p2A_P=8kn36JdGnuqs+yt8Yc+A@mail.gmail.com>
References: <CAOGv6M_a-4my-b9OzGe4tiO5p2A_P=8kn36JdGnuqs+yt8Yc+A@mail.gmail.com>
Message-ID: <8f1f6313-5f6c-3554-d1b0-3636f3105869@uni-muenster.de>



On 07/03/17 19:13, Vijay Ramesh via R-sig-Geo wrote:
> I currently possess a shapefile that consists of >5000 polygons. I would
> like to know, for each polygon, how many other polygons it intersects with
> and the names of each polygon it intersects with?
> 
> My output should be something like this:
> 
> [image: enter image description here] <https://i.stack.imgur.com/ELv3T.png>
> 
> Based on Jeffrey Evans suggestion on using gIntersects, I have tried the

If you follow up on exchanges on stack overflow, please provide the link
to it here.

> following below. But, the process has been running continuously without
> stopping for the last 5 hours. Any suggestions?

Patience?

> 
> Here's the code I ran in R:
> 
> require(rgdal)
> library(maptools)
> library(rgeos)
> library(GISTools)
> Poly <- readOGR("C:\\Users\\rameshv\\Terrestrial_dissolved_multipart.shp")
> Poly_join <- gIntersects(Poly)
> 
> Regards,
> Vijay
> 

-- 
Edzer Pebesma
Institute for Geoinformatics  (ifgi),  University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany; +49 251 83 33081
Journal of Statistical Software:   http://www.jstatsoft.org/
Computers & Geosciences:   http://elsevier.com/locate/cageo/

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 473 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20170308/c35867e6/attachment.bin>

From mel at mbacou.com  Wed Mar  8 14:23:08 2017
From: mel at mbacou.com (Melanie Bacou)
Date: Wed, 8 Mar 2017 08:23:08 -0500
Subject: [R-sig-Geo] Error in writeRaster for signature RasterPCA
In-Reply-To: <CAOGv6M8siZNSknthVrxC8QzQPiPUKXF-M-=dd8YODwbmyrXZqg@mail.gmail.com>
References: <CAOGv6M8siZNSknthVrxC8QzQPiPUKXF-M-=dd8YODwbmyrXZqg@mail.gmail.com>
Message-ID: <d666b27d-0539-ae48-637f-eef2a2a2ee75@mbacou.com>

Vijay,

`rasterPCA` returns an object of class `rasterPCA` (a list). The actual 
raster layers (components) can be accessed via its `map` element. See 
example below.

--Mel.

library(raster)
library(RStoolbox)

bio <- getData("worldclim", var="bio", res=10, path="~/WorldClim")

# You can use `filename=` arg to save the resulting rasters
pre_pca <- rasterPCA(bio, nComp=2, filename="~/PC.tif")

class(pre_pca)
## [1] "rasterPCA" "RStoolbox"

summary(pre_pca)
##       Length  Class       Mode
## call        4 -none-      call
## model       7 princomp    list
## map   3888000 RasterBrick S4

dim(pre_pca$map)
## [1]  900 2160    2

# Plot the 1st comp.
ggR(pre_pca$map[[1]])


On 03/07/2017 01:06 PM, Vijay Ramesh via R-sig-Geo wrote:
> I am currently trying to obtain two rasters that are the Principal
> component axes 1 and 2 for a list of bioclimatic variables that I am using.
> I am using the rasterPCA() function that exists in the RStoolbox in R, but
> I am unable to write it to a raster. Below is the code and the error that I
> am getting:
>
> library(raster)
> library(RStoolbox)
> ##Loading the variables and then creating a raster stack, followed by a PCA
> bio3 <- raster("C:\\Users\\rameshv\\bio3")
> bio4 <- raster("C:\\Users\\rameshv\\bio4")
> bio5 <- raster("C:\\Users\\rameshv\\bio5")
> bio6 <- raster("C:\\Users\\rameshv\\bio6")
> bio14 <- raster("C:\\Users\\rameshv\\bio_14")
>
> pres_stack <- stack(bio3, bio4,bio5,bio6,bio14)
>
> pre_pca <-  rasterPCA(pres_stack, nComp = 2)
>
> writeRaster(pre_pca, "C:\\Users\\rameshv\\PC.tif")
>
> Error in (function (classes, fdef, mtable) : unable to find an inherited
> method for function ?writeRaster? for signature ?"rasterPCA", "character"?
>
> I even tried a modification of the above code
>
> writeRaster(pre_pca,"C:\\Users\\rameshv\\4_PCAforR\\PC.asc",
> format="ascii", bylayer=T)
>
> Getting the same error as above: Error in (function (classes, fdef, mtable)
> : unable to find an inherited method for function ?writeRaster? for
> signature ?"rasterPCA", "character"?
>
> Any suggestions?
> Vijay


	[[alternative HTML version deleted]]


From payneb at post.bgu.ac.il  Wed Mar  8 14:45:45 2017
From: payneb at post.bgu.ac.il (Brandon Payne)
Date: Wed, 08 Mar 2017 15:45:45 +0200
Subject: [R-sig-Geo] noob question: access single region from .shp file
In-Reply-To: <mailman.0.1488978608.1467.r-sig-geo@r-project.org>
References: <mailman.0.1488978608.1467.r-sig-geo@r-project.org>
Message-ID: <m28tofq3ue.fsf@post.bgu.ac.il>

How do you access a single region in a shape file?

<begin pseudo code:>
if (Israelshape2$NAME_1=="Golan") {
Color= "Red"}
</end>

<begin real code:>
#! /usr/bin/R

## grab shape file
download.file("http://biogeo.ucdavis.edu/data/diva/adm/ISR_adm.zip", 
              "./includes/ISR_adm.zip")
              
unzip("./includes/ISR_adm.zip", files=Sys.glob(".shp"),
      unzip="internal",       exdir = "./shapeFiles")

## libraries
library(maptools)
library(RColorBrewer)
colors <- brewer.pal(9, "BuGn")
library(ggmap)

## google maps
mapImageData3 <- get_map(location = c(lon = 35.1660235,
                                      lat = 31.32226),
                         color="color",
                         source = "google",
                         maptype = "satellite",
                         zoom = 7)

## read shape file
IsraelPolygon <- readShapePoly("./includes/ISR_adm/ISR_adm1.shp")
IsraelPoints  <- fortify(IsraelPolygon)

## plot shapes on top of map, output to graphics device
ggmap(mapImageData3,
    extent = "device",
    ylab = "Latitude",
    xlab = "Longitude") +
  geom_polygon(aes(x=long,
                   y=lat,
                   group=group),
               data=IsraelPoints,
               color=colors[9],
               fil=  colors[6],
               alpha=0.5) +
  labs(x="Longitude",
       y="Latitude")
#############################       
ILshape2 <- rgdal::readOGR(dsn="./includes/ISR_adm", layer="ISR_adm1")
rgdal::readOGR(dsn="./includes/ISR_adm", layer="ISR_adm1",
disambiguateFIDs = TRUE)




</end>
>> output:graphic:  map w/ lightly colored polygons overlayed.
>> output:text:
OGR data source with driver: ESRI Shapefile 
Source: "./includes/ISR_adm", layer: "ISR_adm1"
with 7 features
It has 9 fields
An object of class "SpatialPolygonsDataFrame"
Slot "data":
  ID_0 ISO NAME_0 ID_1    NAME_1 TYPE_1 ENGTYPE_1 NL_NAME_1
0  111 ISR Israel    1     Golan  Mehoz  District      <NA>
1  111 ISR Israel    2   HaDarom  Mehoz  District      <NA>
2  111 ISR Israel    3     Haifa  Mehoz  District      <NA>
3  111 ISR Israel    4  HaMerkaz  Mehoz  District      <NA>
4  111 ISR Israel    5   HaZafon  Mehoz  District      <NA>
5  111 ISR Israel    6 Jerusalem  Mehoz  District      <NA>
6  111 ISR Israel    7  Tel Aviv  Mehoz  District      <NA>
             VARNAME_1
0                 <NA>
1    Southern District
2                 Hefa
3     Central District
4             Northern
5 Al-Quds|Yerushalayim
6                 <NA>


From rameshv at caryinstitute.org  Wed Mar  8 14:47:07 2017
From: rameshv at caryinstitute.org (Vijay Ramesh)
Date: Wed, 8 Mar 2017 08:47:07 -0500
Subject: [R-sig-Geo] Error in writeRaster for signature RasterPCA
In-Reply-To: <d666b27d-0539-ae48-637f-eef2a2a2ee75@mbacou.com>
References: <CAOGv6M8siZNSknthVrxC8QzQPiPUKXF-M-=dd8YODwbmyrXZqg@mail.gmail.com>
	<d666b27d-0539-ae48-637f-eef2a2a2ee75@mbacou.com>
Message-ID: <CAOGv6M-2hBg7KxW1pVfyKor685CkYhZg8dB_+__gdKi8X5nPvg@mail.gmail.com>

Thank you Melanie.

I failed to see that it gives out a list and I was giving the wrong call.

Vijay

On Wed, Mar 8, 2017 at 8:23 AM, Melanie Bacou <mel at mbacou.com> wrote:

> Vijay,
>
> `rasterPCA` returns an object of class `rasterPCA` (a list). The actual
> raster layers (components) can be accessed via its `map` element. See
> example below.
>
> --Mel.
>
> library(raster)
> library(RStoolbox)
>
> bio <- getData("worldclim", var="bio", res=10, path="~/WorldClim")
>
> # You can use `filename=` arg to save the resulting rasters
> pre_pca <- rasterPCA(bio, nComp=2, filename="~/PC.tif")
>
> class(pre_pca)
> ## [1] "rasterPCA" "RStoolbox"
>
> summary(pre_pca)
> ##       Length  Class       Mode
> ## call        4 -none-      call
> ## model       7 princomp    list
> ## map   3888000 RasterBrick S4
>
> dim(pre_pca$map)
> ## [1]  900 2160    2
>
> # Plot the 1st comp.
> ggR(pre_pca$map[[1]])
>
> On 03/07/2017 01:06 PM, Vijay Ramesh via R-sig-Geo wrote:
>
> I am currently trying to obtain two rasters that are the Principal
> component axes 1 and 2 for a list of bioclimatic variables that I am using.
> I am using the rasterPCA() function that exists in the RStoolbox in R, but
> I am unable to write it to a raster. Below is the code and the error that I
> am getting:
>
> library(raster)
> library(RStoolbox)
> ##Loading the variables and then creating a raster stack, followed by a PCA
> bio3 <- raster("C:\\Users\\rameshv\\bio3")
> bio4 <- raster("C:\\Users\\rameshv\\bio4")
> bio5 <- raster("C:\\Users\\rameshv\\bio5")
> bio6 <- raster("C:\\Users\\rameshv\\bio6")
> bio14 <- raster("C:\\Users\\rameshv\\bio_14")
>
> pres_stack <- stack(bio3, bio4,bio5,bio6,bio14)
>
> pre_pca <-  rasterPCA(pres_stack, nComp = 2)
>
> writeRaster(pre_pca, "C:\\Users\\rameshv\\PC.tif")
>
> Error in (function (classes, fdef, mtable) : unable to find an inherited
> method for function ?writeRaster? for signature ?"rasterPCA", "character"?
>
> I even tried a modification of the above code
>
> writeRaster(pre_pca,"C:\\Users\\rameshv\\4_PCAforR\\PC.asc",
> format="ascii", bylayer=T)
>
> Getting the same error as above: Error in (function (classes, fdef, mtable)
> : unable to find an inherited method for function ?writeRaster? for
> signature ?"rasterPCA", "character"?
>
> Any suggestions?
> Vijay
>
>
>


-- 
Data Manager,
Barbara Han Lab,
Cary Institute of Ecosystem Studies,
2801 Sharon Turnpike, Millbrook, NY 12545
Lab Site : http://www.hanlab.science/
Personal Site : http://evolecol.weebly.com/
Phone : (845)-677-7600 Ext: 241

	[[alternative HTML version deleted]]


From rbarnes at umn.edu  Wed Mar  8 18:29:39 2017
From: rbarnes at umn.edu (Richard Barnes)
Date: Wed, 8 Mar 2017 09:29:39 -0800
Subject: [R-sig-Geo] Retrieving rasters from ESRI geodabase
In-Reply-To: <mailman.13.1488970803.22032.r-sig-geo@r-project.org>
References: <mailman.13.1488970803.22032.r-sig-geo@r-project.org>
Message-ID: <49eba280-b524-2159-42e0-38bbd69cc3b3@umn.edu>

Mirza,
ESRI has not released an API to extract rasters from geodatabases.

However, building on work by Even Roualt and James Ramm, I've recently
released Arc Raster Rescue, a C++ program for extracting rasters from
ESRI geodatabases into GeoTIFF files. I imagine limited work would be
necessary to convert this into an R package either by wrapping the
command line calls or by converting the program into a library.

The code is available at: https://github.com/r-barnes/ArcRasterRescue

Best regards,
Richard


From englishchristophera at gmail.com  Thu Mar  9 03:53:30 2017
From: englishchristophera at gmail.com (chris english)
Date: Wed, 8 Mar 2017 21:53:30 -0500
Subject: [R-sig-Geo] sf attribute-geometry-relationship
Message-ID: <CAASFQpRtxX-ZUgS6gDcxfERU+7+dg2qRznz2kcjALTgqE2KyaA@mail.gmail.com>

Dear Members,

After joining discrete line segments (groups of rows) into a multiline (a
row) as a kind of summary, I was wondering how i might extend sf
st_geometry()/st_agr() to report an array that would couple my segments
with their columner attribute geometry relationships (somewhat like a
subtotal applied to each line segment component of the multiline).

I ask as I note the dplyr verbs, which both encourage and daunt, but
suggest with the right incantation I might get there; the fact that the sf
result should be a WKT, which leads me to think vector rather than array,
which suggests I won't get there.

My wish for an array is that I don't, won't know in advance how many
segments, their valance (one, another, or yet another kind of attribute),
their order, & etc except as is found in the column that described their
creation as line segment (and may eventually be determined nearly real
time), which makes meuse seem both very stable and ex post facto in
comparison.

Thanking you in advance for your thoughts on this matter that I hope is
sufficiently clear.

Chris

	[[alternative HTML version deleted]]


From mdsumner at gmail.com  Thu Mar  9 11:44:00 2017
From: mdsumner at gmail.com (Michael Sumner)
Date: Thu, 09 Mar 2017 10:44:00 +0000
Subject: [R-sig-Geo] sf attribute-geometry-relationship
In-Reply-To: <CAASFQpRtxX-ZUgS6gDcxfERU+7+dg2qRznz2kcjALTgqE2KyaA@mail.gmail.com>
References: <CAASFQpRtxX-ZUgS6gDcxfERU+7+dg2qRznz2kcjALTgqE2KyaA@mail.gmail.com>
Message-ID: <CAAcGz9_xV8LmVd=VZty+tgeiNMdQ4GAD1Omre83Vvfw1o6XxKQ@mail.gmail.com>

Hi Chris,

where do you start here, is it a table of segments, with four columns for
the two x/y start and end coordinates, and other columns. Or is it a table
of ordered pairs of rows, or a table of grouped paths of coordinates?

If I read correctly, you can't bend simple features into what you want
here. You'll end up with another object to index the first, but no
structures in the standard or in sf to store the information. You can infer
it with st_intersection and st_relate, but then there's nowhere to put data
on the primitives or vertices.

 You can bend igraph (and the future tidygraph) for this purpose though,
and if you explore the dozens of "tracking" packages on CRAN you'll find
many similar examples. If you look at rgl you'll see primitives in "mesh3d"
with its transpose arrays of homogeneous coordinates with an index array,
but there's no classed version for segments - these are dealt with in more
raw form as pairs of indexes. rgl is no good for this since while it does
have primitive-level data (aesthetics) it only has "structural indexing",
i.e. you cannot easily subset or combine data sets without complex
re-indexing, and igraph is not enough because it doesn't have higher
groupings (like paths, arcs, rings, or features and their ever higher
analogs).

I now routinely turn these more general data structures into a set of
tables, unique coordinates indexed by primitives (segments in your case),
with group tables - including the special case of  "features". I'm still
figuring out the best component tools to work with these, but the crossover
with igraph and dplyr verbs is now clear and I'll follow the design in
tidygraph for where it goes next.

If you have a table of segments, it's easy enough to split that as two
tables. If you have implicit pairs as a path, it needs first to be
re-arranged to ensure the right attributes go to the right entity. If you
have an example data set I can illustrate, but you'll have to put up with
dev code.

Cheers, Mike.




On Thu, 9 Mar 2017 at 13:54 chris english <englishchristophera at gmail.com>
wrote:

> Dear Members,
>
> After joining discrete line segments (groups of rows) into a multiline (a
> row) as a kind of summary, I was wondering how i might extend sf
> st_geometry()/st_agr() to report an array that would couple my segments
> with their columner attribute geometry relationships (somewhat like a
> subtotal applied to each line segment component of the multiline).
>
> I ask as I note the dplyr verbs, which both encourage and daunt, but
> suggest with the right incantation I might get there; the fact that the sf
> result should be a WKT, which leads me to think vector rather than array,
> which suggests I won't get there.
>
> My wish for an array is that I don't, won't know in advance how many
> segments, their valance (one, another, or yet another kind of attribute),
> their order, & etc except as is found in the column that described their
> creation as line segment (and may eventually be determined nearly real
> time), which makes meuse seem both very stable and ex post facto in
> comparison.
>
> Thanking you in advance for your thoughts on this matter that I hope is
> sufficiently clear.
>
> Chris
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
-- 
Dr. Michael Sumner
Software and Database Engineer
Australian Antarctic Division
203 Channel Highway
Kingston Tasmania 7050 Australia

	[[alternative HTML version deleted]]


From philipova at imbm.bas.bg  Thu Mar  9 15:12:18 2017
From: philipova at imbm.bas.bg (philipova at imbm.bas.bg)
Date: Thu, 9 Mar 2017 16:12:18 +0200
Subject: [R-sig-Geo] How to install R packages
Message-ID: <f910de25002de8f17cbc225d61094fad.squirrel@info.imbm.bas.bg>

Dear R-users,
Please tell me how to install R packages. I have downloaded source files
of some packages (*.tar files). I put them in a directory in my computer.
The computer asked me whether to make personal library.
I tried with:
install.packages(pkgs='pastecs', lib='C;/User/doktorant-220/My
Documents/R/win-library/3.3/pastecs_1.3-18.tar',repos=NULL,type="source")

R gives me the following message:
Warning in install.packages(pkgs = "pastecs", lib =
"C:/User/doktorant-220/My Documents/R/win-library/3.3/pastecs_1.3-18.tar",
 :
  'lib = "C:/User/doktorant-220/My
Documents/R/win-library/3.3/pastecs_1.3-18.tar"' is not writable
Warning: invalid package 'pastecs'
Error: ERROR: no packages specified
Warning messages:
1: running command '"C:/PROGRA~1/R/R-33~1.3/bin/i386/R" CMD INSTALL -l
"C:\Users\doktorant-220\Documents\R\win-library\3.3" "pastecs"' had status
1
2: In install.packages(pkgs = "pastecs", lib = "C:/User/doktorant-220/My
Documents/R/win-library/3.3/pastecs_1.3-18.tar",  :
  installation of package ?pastecs? had non-zero exit statu

I will be grateful for your help!
Nina


From roman.lustrik at gmail.com  Thu Mar  9 16:04:41 2017
From: roman.lustrik at gmail.com (=?UTF-8?Q?Roman_Lu=C5=A1trik?=)
Date: Thu, 9 Mar 2017 16:04:41 +0100
Subject: [R-sig-Geo] How to install R packages
In-Reply-To: <f910de25002de8f17cbc225d61094fad.squirrel@info.imbm.bas.bg>
References: <f910de25002de8f17cbc225d61094fad.squirrel@info.imbm.bas.bg>
Message-ID: <CAHT1vphR1_gsLy8v+nF-qGA45VHVQW5n3ZveG41JDSo3kgixkw@mail.gmail.com>

If the package is on CRAN, you should just do

install.packages("pastecs")

and R will install the package. You can then use it by calling it with

library(pastecs)

This is the preferred way of installing packages for novice users. If this
is insufficient for you, read on.




To compile from source, you will need a bit more tools. It would appear you
are on Windows. You need to install Rtools to be able to compile and
install R packages.

First try installing package devtools

install.packages("devtools")

During the installation, the interface should ask you if you want to
install RTools. Say yes.

Once finished and assuming everything went well, you should be able to
install from local, github... whatever

install_local("c:/users...path/to/file.tar.gz")

or

install_github("cran/pastacs")

Cheers,
Roman

On Thu, Mar 9, 2017 at 3:12 PM, <philipova at imbm.bas.bg> wrote:

> Dear R-users,
> Please tell me how to install R packages. I have downloaded source files
> of some packages (*.tar files). I put them in a directory in my computer.
> The computer asked me whether to make personal library.
> I tried with:
> install.packages(pkgs='pastecs', lib='C;/User/doktorant-220/My
> Documents/R/win-library/3.3/pastecs_1.3-18.tar',repos=NULL,type="source")
>
> R gives me the following message:
> Warning in install.packages(pkgs = "pastecs", lib =
> "C:/User/doktorant-220/My Documents/R/win-library/3.3/pastecs_1.3-18.tar",
>  :
>   'lib = "C:/User/doktorant-220/My
> Documents/R/win-library/3.3/pastecs_1.3-18.tar"' is not writable
> Warning: invalid package 'pastecs'
> Error: ERROR: no packages specified
> Warning messages:
> 1: running command '"C:/PROGRA~1/R/R-33~1.3/bin/i386/R" CMD INSTALL -l
> "C:\Users\doktorant-220\Documents\R\win-library\3.3" "pastecs"' had status
> 1
> 2: In install.packages(pkgs = "pastecs", lib = "C:/User/doktorant-220/My
> Documents/R/win-library/3.3/pastecs_1.3-18.tar",  :
>   installation of package ?pastecs? had non-zero exit statu
>
> I will be grateful for your help!
> Nina
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo




-- 
In God we trust, all others bring data.

	[[alternative HTML version deleted]]


From kent3737 at gmail.com  Fri Mar 10 04:22:18 2017
From: kent3737 at gmail.com (Kent Johnson)
Date: Thu, 9 Mar 2017 22:22:18 -0500
Subject: [R-sig-Geo] noob question: access single region from .shp file
Message-ID: <CAPP0wyhbnGhXhdLL9AzF54XD2FnuQ75+UsRVYnyCn2-2u+0_pQ@mail.gmail.com>

On Thu, Mar 9, 2017 at 6:00 AM, <r-sig-geo-request at r-project.org> wrote:
>
> Message: 2
> Date: Wed, 08 Mar 2017 15:45:45 +0200
> From: Brandon Payne <payneb at post.bgu.ac.il>
> To: r-sig-geo at r-project.org
> Subject: [R-sig-Geo] noob question: access single region from .shp
>         file
> Message-ID: <m28tofq3ue.fsf at post.bgu.ac.il>
> Content-Type: text/plain
>
> How do you access a single region in a shape file?
>

See changes below.

Kent

## libraries
> library(maptools)
> library(RColorBrewer)
> colors <- brewer.pal(9, "BuGn")
> library(ggmap)
>
> ## google maps
> mapImageData3 <- get_map(location = c(lon = 35.1660235,
>                                       lat = 31.32226),
>                          color="color",
>                          source = "google",
>                          maptype = "satellite",
>                          zoom = 7)
>
> ## read shape file
> IsraelPolygon <- readShapePoly("./includes/ISR_adm/ISR_adm1.shp")
> IsraelPoints  <- fortify(IsraelPolygon)
>

IsraelPoints <- fortify(IsraelPolygon, , region='NAME_1')

## plot shapes on top of map, output to graphics device
> ggmap(mapImageData3,
>     extent = "device",
>     ylab = "Latitude",
>     xlab = "Longitude") +
>   geom_polygon(aes(x=long,
>                    y=lat,
>                    group=group),
>                data=IsraelPoints,
>                color=colors[9],
>                fil=  colors[6],
>

fill=  ifelse(IsraelPoints$id=='Golan', 'red', colors[6]),


>                alpha=0.5) +
>   labs(x="Longitude",
>        y="Latitude"

	[[alternative HTML version deleted]]


From mauriziomarchi85 at gmail.com  Fri Mar 10 19:16:17 2017
From: mauriziomarchi85 at gmail.com (Maurizio Marchi)
Date: Fri, 10 Mar 2017 19:16:17 +0100
Subject: [R-sig-Geo] Global and Local Moran: how can I calculate them with
 different spatial threshold?
Message-ID: <CANJhsN3PsDbYS9z9eGUBqhSGww6yex2D+GbxKZhNvvAQUfcmCA@mail.gmail.com>

Hello everybody,
I need to calculate the Global and Local Moran indices in R using a
variable distance as threshold: I have a SpatialPointsDataFrame with
almost 300 points and I want to calculate the Global Moran index using
4 different distances (e.g 5 km - 10 km - 50 km - 100 km).
I know the 'ape' and 'spdep' packages but it seems that no adjustment
can be done concerning the spatial width to be considered...
Thanks

-- 
Maurizio Marchi
Skype ID: maurizioxyz
linux user 552742


From Roger.Bivand at nhh.no  Fri Mar 10 21:44:00 2017
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 10 Mar 2017 21:44:00 +0100
Subject: [R-sig-Geo] Global and Local Moran: how can I calculate them
 with different spatial threshold?
In-Reply-To: <CANJhsN3PsDbYS9z9eGUBqhSGww6yex2D+GbxKZhNvvAQUfcmCA@mail.gmail.com>
References: <CANJhsN3PsDbYS9z9eGUBqhSGww6yex2D+GbxKZhNvvAQUfcmCA@mail.gmail.com>
Message-ID: <alpine.LFD.2.20.1703102135030.29126@reclus.nhh.no>

On Fri, 10 Mar 2017, Maurizio Marchi wrote:

> Hello everybody,
> I need to calculate the Global and Local Moran indices in R using a
> variable distance as threshold: I have a SpatialPointsDataFrame with
> almost 300 points and I want to calculate the Global Moran index using
> 4 different distances (e.g 5 km - 10 km - 50 km - 100 km).
> I know the 'ape' and 'spdep' packages but it seems that no adjustment
> can be done concerning the spatial width to be considered...

Please examine ?spdep::dnearneigh, especially d1= and d2=, which do 
exactly what you ask for. The functions in spdep are modularised, first 
construct the neighbour object, then the weights list object, then the 
Moran tests. Note that Moran tests should really be run on regression 
residuals (lm.morantest(), localmoran.sad() or localmoran.exact()), and 
remember to adjust p.values for banded local tests (many tests using the 
same data affect tabulated significance levels). The ape function makes 
undocumented assumptions about what you may want, spdep requires that you 
know what you want to do.

Hope this clarifies,

Roger

> Thanks
>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
Editor-in-Chief of The R Journal, https://journal.r-project.org/index.html
http://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
http://depsy.org/person/444584


From mauriziomarchi85 at gmail.com  Sat Mar 11 00:45:08 2017
From: mauriziomarchi85 at gmail.com (Maurizio Marchi)
Date: Fri, 10 Mar 2017 23:45:08 +0000
Subject: [R-sig-Geo] Global and Local Moran: how can I calculate them
 with different spatial threshold?
In-Reply-To: <alpine.LFD.2.20.1703102135030.29126@reclus.nhh.no>
References: <CANJhsN3PsDbYS9z9eGUBqhSGww6yex2D+GbxKZhNvvAQUfcmCA@mail.gmail.com>
	<alpine.LFD.2.20.1703102135030.29126@reclus.nhh.no>
Message-ID: <CANJhsN0wLdcW2R-a6OGitPScgv6wdDyGhrc-wPcMu3VGrqEcOg@mail.gmail.com>

Perfect, thank you very much to everybody,
Next week I will work on my data. Now everything is much clearer!

Regards

Il giorno ven 10 mar 2017 alle 21:44 Roger Bivand <Roger.Bivand at nhh.no> ha
scritto:

> On Fri, 10 Mar 2017, Maurizio Marchi wrote:
>
> > Hello everybody,
> > I need to calculate the Global and Local Moran indices in R using a
> > variable distance as threshold: I have a SpatialPointsDataFrame with
> > almost 300 points and I want to calculate the Global Moran index using
> > 4 different distances (e.g 5 km - 10 km - 50 km - 100 km).
> > I know the 'ape' and 'spdep' packages but it seems that no adjustment
> > can be done concerning the spatial width to be considered...
>
> Please examine ?spdep::dnearneigh, especially d1= and d2=, which do
> exactly what you ask for. The functions in spdep are modularised, first
> construct the neighbour object, then the weights list object, then the
> Moran tests. Note that Moran tests should really be run on regression
> residuals (lm.morantest(), localmoran.sad() or localmoran.exact()), and
> remember to adjust p.values for banded local tests (many tests using the
> same data affect tabulated significance levels). The ape function makes
> undocumented assumptions about what you may want, spdep requires that you
> know what you want to do.
>
> Hope this clarifies,
>
> Roger
>
> > Thanks
> >
> >
>
> --
> Roger Bivand
> Department of Economics, Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
> Editor-in-Chief of The R Journal, https://journal.r-project.org/index.html
> http://orcid.org/0000-0003-2392-6140
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
> http://depsy.org/person/444584
>
-- 
Maurizio Marchi
Skype ID: maurizioxyz
linux user 552742

	[[alternative HTML version deleted]]


From philipova at imbm.bas.bg  Sat Mar 11 13:38:03 2017
From: philipova at imbm.bas.bg (philipova at imbm.bas.bg)
Date: Sat, 11 Mar 2017 14:38:03 +0200
Subject: [R-sig-Geo] Error in bbox(newdata) : object not a >= 2-column array
Message-ID: <ec3c4a96ea1d89b386fd4cc29f227f78.squirrel@info.imbm.bas.bg>

Dear R-Users,
Please anyone to help me with this error:

kriged=krige(Nmin~1,locationsDD,grid,model=vgm(1,"Exp",150,1))
Error in bbox(newdata) : object not a >= 2-column array

Thank you so much in advance!
Kind Regards
Nina Philipova
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: variogram2.txt
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20170311/e1ac2840/attachment.txt>

From b.rowlingson at lancaster.ac.uk  Sat Mar 11 15:03:24 2017
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Sat, 11 Mar 2017 14:03:24 +0000
Subject: [R-sig-Geo] Error in bbox(newdata) : object not a >= 2-column
	array
In-Reply-To: <ec3c4a96ea1d89b386fd4cc29f227f78.squirrel@info.imbm.bas.bg>
References: <ec3c4a96ea1d89b386fd4cc29f227f78.squirrel@info.imbm.bas.bg>
Message-ID: <CANVKczMFDcenpniBVGB6tE1M30x-7X+XHY+sJQt2j4+_iuW2Ow@mail.gmail.com>

On Sat, Mar 11, 2017 at 12:38 PM,  <philipova at imbm.bas.bg> wrote:
> Dear R-Users,
> Please anyone to help me with this error:
>
> kriged=krige(Nmin~1,locationsDD,grid,model=vgm(1,"Exp",150,1))
> Error in bbox(newdata) : object not a >= 2-column array
>
> Thank you so much in advance!

 Hard to debug without your data. The error message is telling us that
something is wrong with your input, but we can't see your data....

 If you can't share your data, at least share what you get from
summary(grid) and summary(locationsDD).

 You should also confirm what package `krige` is coming from - I
assume its gstat.

If you can get back to the mailing list with this information, we
might be able to help, otherwise we're guessing!

Barry


From dmwarner at usgs.gov  Sat Mar 11 16:13:44 2017
From: dmwarner at usgs.gov (Warner, David)
Date: Sat, 11 Mar 2017 10:13:44 -0500
Subject: [R-sig-Geo] Error in bbox(newdata) : object not a >= 2-column
	array
In-Reply-To: <ec3c4a96ea1d89b386fd4cc29f227f78.squirrel@info.imbm.bas.bg>
References: <ec3c4a96ea1d89b386fd4cc29f227f78.squirrel@info.imbm.bas.bg>
Message-ID: <CA+Y23tY0pVar95e7iF7O383+cpDUje9oBGpzfu5BXEi90aOg=A@mail.gmail.com>

I was getting this error as well.  The cause was either not having the
coordinates and coordinate reference system (CRS) set or having the wrong
CRS.  I did both at the same time so I am not sure which it was.

Is your 'grid' a SpatialPixels object?

Did you run a line like 'coordinates(grid) <- ~x + y'  ?

If so, did you then set the CRS?



On Sat, Mar 11, 2017 at 7:38 AM, <philipova at imbm.bas.bg> wrote:

> Dear R-Users,
> Please anyone to help me with this error:
>
> kriged=krige(Nmin~1,locationsDD,grid,model=vgm(1,"Exp",150,1))
> Error in bbox(newdata) : object not a >= 2-column array
>
> Thank you so much in advance!
> Kind Regards
> Nina Philipova
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



-- 
David Warner
Research Fisheries Biologist
U.S.G.S. Great Lakes Science Center
1451 Green Road
Ann Arbor, MI 48105
734-214-9392

	[[alternative HTML version deleted]]


From mspinola10 at gmail.com  Sun Mar 12 14:29:09 2017
From: mspinola10 at gmail.com (=?UTF-8?Q?Manuel_Sp=C3=ADnola?=)
Date: Sun, 12 Mar 2017 07:29:09 -0600
Subject: [R-sig-Geo] Does ggmap work with sf objects through geom_sf?
Message-ID: <CABkCotSUkzoUGgJ9Qfk91pY-piV=69xKDn6Jv=gsthGGavRp5w@mail.gmail.com>

Dear list members,

Does ggmap work with sf objects through geom_sf?

I got the following error:

nc <- st_read(system.file("shape/nc.shp", package="sf"))

nclocation <- c(-80, 34)

ncmap <- get_map(location = nclocation, zoom = 6)

ggmap(ncmap) + geom_sf(data = nc)

Error in eval(expr, envir, enclos) : object 'lon' not found


-- 
*Manuel Sp?nola, Ph.D.*
Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
Universidad Nacional
Apartado 1350-3000
Heredia
COSTA RICA
mspinola at una.cr <mspinola at una.ac.cr>
mspinola10 at gmail.com
Tel?fono: (506) 8706 - 4662
Personal website: Lobito de r?o <https://sites.google.com/site/lobitoderio/>
Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>

	[[alternative HTML version deleted]]


From alobolistas at gmail.com  Mon Mar 13 12:10:42 2017
From: alobolistas at gmail.com (Agustin Lobo)
Date: Mon, 13 Mar 2017 12:10:42 +0100
Subject: [R-sig-Geo] Avoid axis labels, ticks and marks in ggRGB() plot
Message-ID: <CAG4NReJCEQaLip-YcuJ+TbFHCheo8GWsqny6nBNKg_GBtAmTng@mail.gmail.com>

In order to save space, I prefer to avoid coordinates in the plot
generated by ggRGB. Is there any way? I've tried:

ggplot() +
ggRGB(rlogo, r=1, g=2, b=3,ggLayer=TRUE) +
  theme(
    axis.text = element_blank(),
    axis.ticks = element_blank(),
    axis.title = element_blank())

but get an empty plot.
I can circumvent the problem as follows, but it is kind of ugly and complicated,
there must be another way:

a <- as(extent(rlogo), 'SpatialPolygons')
y <- fortify(a,region=id)
ggplot(data=y,aes(y=lat, x=long)) +
  ggRGB(rlogo, r=1, g=2, b=3,ggLayer=TRUE) +
  geom_polygon(colour="yellow", fill=NA) +
  guides(fill=FALSE) +
  coord_fixed(ratio=1) +
  theme(
    axis.text = element_blank(),
    axis.ticks = element_blank(),
    axis.title = element_blank())

Agus


From benjamin.leutner at uni-wuerzburg.de  Mon Mar 13 14:05:12 2017
From: benjamin.leutner at uni-wuerzburg.de (Benjamin Leutner)
Date: Mon, 13 Mar 2017 14:05:12 +0100
Subject: [R-sig-Geo] Avoid axis labels, ticks and marks in ggRGB() plot
In-Reply-To: <CAG4NReJCEQaLip-YcuJ+TbFHCheo8GWsqny6nBNKg_GBtAmTng@mail.gmail.com>
References: <CAG4NReJCEQaLip-YcuJ+TbFHCheo8GWsqny6nBNKg_GBtAmTng@mail.gmail.com>
Message-ID: <8ea590ac-91a8-0ab9-4f93-5412b9ec4a34@uni-wuerzburg.de>

The problem with your first approach is that there is no "data layer" 
which could span the coordinate axes.
Since ggRGB by default uses an annotation_raster() in order to keep your 
"fill" dimension free for other data,  the coordinate limits are empty, 
hence the plotted raster is lost in the dimensionless void and you get 
see nothing ;-)

I would recommend to start your plot with ggRGB like this:

ggRGB(rlogo, r=1, g=2, b=3) +
   theme(
     axis.text = element_blank(),
     axis.ticks = element_blank(),
     axis.title = element_blank())


If you do want to use it with ggLayer = TRUE, there should be at least 
one "geom" with actual data in it (or you'd have to set ggRGB(..., 
geom_raster=TRUE), but I don't see any benefit in that and it would give 
you a huge legend with one entry per rgb color...)

best,
Benjamin

On 03/13/2017 12:10 PM, Agustin Lobo wrote:
> In order to save space, I prefer to avoid coordinates in the plot
> generated by ggRGB. Is there any way? I've tried:
>
> ggplot() +
> ggRGB(rlogo, r=1, g=2, b=3,ggLayer=TRUE) +
>    theme(
>      axis.text = element_blank(),
>      axis.ticks = element_blank(),
>      axis.title = element_blank())
>
> but get an empty plot.
> I can circumvent the problem as follows, but it is kind of ugly and complicated,
> there must be another way:
>
> a <- as(extent(rlogo), 'SpatialPolygons')
> y <- fortify(a,region=id)
> ggplot(data=y,aes(y=lat, x=long)) +
>    ggRGB(rlogo, r=1, g=2, b=3,ggLayer=TRUE) +
>    geom_polygon(colour="yellow", fill=NA) +
>    guides(fill=FALSE) +
>    coord_fixed(ratio=1) +
>    theme(
>      axis.text = element_blank(),
>      axis.ticks = element_blank(),
>      axis.title = element_blank())
>
> Agus
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Benjamin Leutner M.Sc.
PhD candidate

Department of Remote Sensing
University of Wuerzburg
Campus Hubland Nord 86
97074 Wuerzburg, Germany

Tel: +49-(0)931-31 89594
Fax: +49-(0)931-31 89594-0
Email: benjamin.leutner at uni-wuerzburg.de
Web: http://www.fernerkundung.uni-wuerzburg.de


From alobolistas at gmail.com  Mon Mar 13 14:25:32 2017
From: alobolistas at gmail.com (Agustin Lobo)
Date: Mon, 13 Mar 2017 14:25:32 +0100
Subject: [R-sig-Geo] Avoid axis labels, ticks and marks in ggRGB() plot
In-Reply-To: <8ea590ac-91a8-0ab9-4f93-5412b9ec4a34@uni-wuerzburg.de>
References: <CAG4NReJCEQaLip-YcuJ+TbFHCheo8GWsqny6nBNKg_GBtAmTng@mail.gmail.com>
	<8ea590ac-91a8-0ab9-4f93-5412b9ec4a34@uni-wuerzburg.de>
Message-ID: <CAG4NReJuoVO5u4KwcRYBAAAfzrkwR7o4G2XcAFUy+5sM0wRCKQ@mail.gmail.com>

Yes! Thanks!
I knew there had to be a better way. For my set of plots I can set
t <- theme(
  axis.text = element_blank(),
  axis.ticks = element_blank(),
  axis.title = element_blank())

and then

ggRGB(rlogo, r=1, g=2, b=3) + t +ggtitle("patatin")

Agus



On Mon, Mar 13, 2017 at 2:05 PM, Benjamin Leutner
<benjamin.leutner at uni-wuerzburg.de> wrote:
> The problem with your first approach is that there is no "data layer" which
> could span the coordinate axes.
> Since ggRGB by default uses an annotation_raster() in order to keep your
> "fill" dimension free for other data,  the coordinate limits are empty,
> hence the plotted raster is lost in the dimensionless void and you get see
> nothing ;-)
>
> I would recommend to start your plot with ggRGB like this:
>
> ggRGB(rlogo, r=1, g=2, b=3) +
>   theme(
>     axis.text = element_blank(),
>     axis.ticks = element_blank(),
>     axis.title = element_blank())
>
>
> If you do want to use it with ggLayer = TRUE, there should be at least one
> "geom" with actual data in it (or you'd have to set ggRGB(...,
> geom_raster=TRUE), but I don't see any benefit in that and it would give you
> a huge legend with one entry per rgb color...)
>
> best,
> Benjamin
>
>
> On 03/13/2017 12:10 PM, Agustin Lobo wrote:
>>
>> In order to save space, I prefer to avoid coordinates in the plot
>> generated by ggRGB. Is there any way? I've tried:
>>
>> ggplot() +
>> ggRGB(rlogo, r=1, g=2, b=3,ggLayer=TRUE) +
>>    theme(
>>      axis.text = element_blank(),
>>      axis.ticks = element_blank(),
>>      axis.title = element_blank())
>>
>> but get an empty plot.
>> I can circumvent the problem as follows, but it is kind of ugly and
>> complicated,
>> there must be another way:
>>
>> a <- as(extent(rlogo), 'SpatialPolygons')
>> y <- fortify(a,region=id)
>> ggplot(data=y,aes(y=lat, x=long)) +
>>    ggRGB(rlogo, r=1, g=2, b=3,ggLayer=TRUE) +
>>    geom_polygon(colour="yellow", fill=NA) +
>>    guides(fill=FALSE) +
>>    coord_fixed(ratio=1) +
>>    theme(
>>      axis.text = element_blank(),
>>      axis.ticks = element_blank(),
>>      axis.title = element_blank())
>>
>> Agus
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> --
> Benjamin Leutner M.Sc.
> PhD candidate
>
> Department of Remote Sensing
> University of Wuerzburg
> Campus Hubland Nord 86
> 97074 Wuerzburg, Germany
>
> Tel: +49-(0)931-31 89594
> Fax: +49-(0)931-31 89594-0
> Email: benjamin.leutner at uni-wuerzburg.de
> Web: http://www.fernerkundung.uni-wuerzburg.de
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From philipova at imbm.bas.bg  Tue Mar 14 09:54:29 2017
From: philipova at imbm.bas.bg (philipova at imbm.bas.bg)
Date: Tue, 14 Mar 2017 10:54:29 +0200
Subject: [R-sig-Geo] Error in bbox(newdata) : object not a >= 2-column
 array
In-Reply-To: <CA+Y23tY0pVar95e7iF7O383+cpDUje9oBGpzfu5BXEi90aOg=A@mail.gmail.com>
References: <ec3c4a96ea1d89b386fd4cc29f227f78.squirrel@info.imbm.bas.bg>
	<CA+Y23tY0pVar95e7iF7O383+cpDUje9oBGpzfu5BXEi90aOg=A@mail.gmail.com>
Message-ID: <23e34e2e394381109affbd89c51c25f6.squirrel@info.imbm.bas.bg>

> Dear David,
Dear R users,
Now R calculates var1.pred as a constatnt:
kriged=krige(Nmin~1,locationsDD,grid,model=fit)

> kriged["var1.pred"]


925  (339003.4, 2988160)  11.22117
926  (339013.4, 2988160)  11.22117
927  (339023.4, 2988160)  11.22117
928  (339033.4, 2988160)  11.22117
929  (339043.4, 2988160)  11.22117
930  (339053.4, 2988160)  11.22117
931  (339063.4, 2988160)  11.22117
932  (339073.4, 2988160)  11.22117
933  (339083.4, 2988160)  11.22117
........................................
7482 (339293.4, 2989180)  11.22117
7483 (339303.4, 2989180)  11.22117
7484 (339313.4, 2989180)  11.22117
7485 (339323.4, 2989180)  11.22117
7486 (339333.4, 2989180)  11.22117
7487 (339343.4, 2989180)  11.22117
7488 (339353.4, 2989180)  11.22117
>
spplot(kriged["var1.pred"])
 Error: unexpected string constant in:
"
spplot(kriged[""

And it cann't give ssplot
Please if anyone can help me!


I was getting this error as well.  The cause was either not having the
> coordinates and coordinate reference system (CRS) set or having the wrong
> CRS.  I did both at the same time so I am not sure which it was.
>
> Is your 'grid' a SpatialPixels object?
>
> Did you run a line like 'coordinates(grid) <- ~x + y'  ?
>
> If so, did you then set the CRS?
>
>
>
> On Sat, Mar 11, 2017 at 7:38 AM, <philipova at imbm.bas.bg> wrote:
>
>> Dear R-Users,
>> Please anyone to help me with this error:
>>
>> kriged=krige(Nmin~1,locationsDD,grid,model=vgm(1,"Exp",150,1))
>> Error in bbox(newdata) : object not a >= 2-column array
>>
>> Thank you so much in advance!
>> Kind Regards
>> Nina Philipova
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>
>
> --
> David Warner
> Research Fisheries Biologist
> U.S.G.S. Great Lakes Science Center
> 1451 Green Road
> Ann Arbor, MI 48105
> 734-214-9392
>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: Variogram & Kriging.txt
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20170314/c3a979a4/attachment.txt>

From edzer.pebesma at uni-muenster.de  Tue Mar 14 10:00:21 2017
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Tue, 14 Mar 2017 10:00:21 +0100
Subject: [R-sig-Geo] Error in bbox(newdata) : object not a >= 2-column
 array
In-Reply-To: <23e34e2e394381109affbd89c51c25f6.squirrel@info.imbm.bas.bg>
References: <ec3c4a96ea1d89b386fd4cc29f227f78.squirrel@info.imbm.bas.bg>
	<CA+Y23tY0pVar95e7iF7O383+cpDUje9oBGpzfu5BXEi90aOg=A@mail.gmail.com>
	<23e34e2e394381109affbd89c51c25f6.squirrel@info.imbm.bas.bg>
Message-ID: <7051890f-ef88-00ca-09b4-d36b3ba6a22b@uni-muenster.de>

Looks to me as if you made a typo in your script, possibly with a quote,
but I'd need to see the full script, and preferably have access the
necessary data in order to run it, to be completely sure.

On 14/03/17 09:54, philipova at imbm.bas.bg wrote:
>> Dear David,
> Dear R users,
> Now R calculates var1.pred as a constatnt:
> kriged=krige(Nmin~1,locationsDD,grid,model=fit)
> 
>> kriged["var1.pred"]
> 
> 
> 925  (339003.4, 2988160)  11.22117
> 926  (339013.4, 2988160)  11.22117
> 927  (339023.4, 2988160)  11.22117
> 928  (339033.4, 2988160)  11.22117
> 929  (339043.4, 2988160)  11.22117
> 930  (339053.4, 2988160)  11.22117
> 931  (339063.4, 2988160)  11.22117
> 932  (339073.4, 2988160)  11.22117
> 933  (339083.4, 2988160)  11.22117
> ........................................
> 7482 (339293.4, 2989180)  11.22117
> 7483 (339303.4, 2989180)  11.22117
> 7484 (339313.4, 2989180)  11.22117
> 7485 (339323.4, 2989180)  11.22117
> 7486 (339333.4, 2989180)  11.22117
> 7487 (339343.4, 2989180)  11.22117
> 7488 (339353.4, 2989180)  11.22117
>>
> spplot(kriged["var1.pred"])
>  Error: unexpected string constant in:
> "
> spplot(kriged[""
> 
> And it cann't give ssplot
> Please if anyone can help me!
> 
> 
> I was getting this error as well.  The cause was either not having the
>> coordinates and coordinate reference system (CRS) set or having the wrong
>> CRS.  I did both at the same time so I am not sure which it was.
>>
>> Is your 'grid' a SpatialPixels object?
>>
>> Did you run a line like 'coordinates(grid) <- ~x + y'  ?
>>
>> If so, did you then set the CRS?
>>
>>
>>
>> On Sat, Mar 11, 2017 at 7:38 AM, <philipova at imbm.bas.bg> wrote:
>>
>>> Dear R-Users,
>>> Please anyone to help me with this error:
>>>
>>> kriged=krige(Nmin~1,locationsDD,grid,model=vgm(1,"Exp",150,1))
>>> Error in bbox(newdata) : object not a >= 2-column array
>>>
>>> Thank you so much in advance!
>>> Kind Regards
>>> Nina Philipova
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>>
>>
>> --
>> David Warner
>> Research Fisheries Biologist
>> U.S.G.S. Great Lakes Science Center
>> 1451 Green Road
>> Ann Arbor, MI 48105
>> 734-214-9392
>>
>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Edzer Pebesma
Institute for Geoinformatics  (ifgi),  University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany; +49 251 83 33081
Journal of Statistical Software:   http://www.jstatsoft.org/
Computers & Geosciences:   http://elsevier.com/locate/cageo/

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 473 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20170314/4f49893b/attachment.bin>

From martazores at gmail.com  Tue Mar 14 18:02:23 2017
From: martazores at gmail.com (marta azores)
Date: Tue, 14 Mar 2017 16:02:23 -0100
Subject: [R-sig-Geo] loop memory problem
In-Reply-To: <882f4b60-060b-df3f-9405-a04fdc6bff7b@informatik.uni-freiburg.de>
References: <CAE3WKgQPSYMxSzTSarj9Ee2xrkjcWg4fQYZJESvxnOnGkGBeZg@mail.gmail.com>
	<8ca347cd-2fb9-2443-ff38-b5c59f4d9950@informatik.uni-freiburg.de>
	<882f4b60-060b-df3f-9405-a04fdc6bff7b@informatik.uni-freiburg.de>
Message-ID: <CAE3WKgSHrKSmAzPm5NXqHU6+cu_Xic6sBtGnKFpE57N+h-S+EA@mail.gmail.com>

> #answer Marcel in r-sig-geo forum:
>> #1) maybe you can first make your calculations and afterwards plot the
>> result.
>> #It might be faster this way.
>>
>> #2) maybe you can use the parallel for each loop in order to use the
>> whole performance of your cpu
>>
>> #3) loops in R are really slow in general.. you could also think about
>> some fancy stuff like some R compiler or Rcpp package
>>
>> #4) in order to analyze your memory consumption, you should have a look
>> on your system resources (depending on your OS: task manager (win) or htop
>> (linux))
>>
>> #############
>> #1)MARCEL: maybe you can first make your calculations and afterwards plot
>> the result.
>> #It might be faster this way.
>> ##MARTA: I did that, but the difference between the calculations inside
>> the loop of afterwards is less than a second.
>> #
>>
>       #############

> #2) MARCEL:maybe you can use the parallel or each loop in order to use the
>> whole performance of your cpu
>> #MARTA:I  developed 5 different loops, the old one (2.A) it works
>> properly but is too slow. I followed your suggestion with the parallel
>> loops to increase the speed. I wrote a loop (2.B) with %do%, which is works
>> but the time is the #same as the old loop. The other loops with %doPar%,
>> didn't work at all. Only the simple (2.D) runs, but is not what I want. The
>> other two ( 2.C and 2.E) didn't run, they have errors. The 2.C "task 1
>> failed - "non-numeric argument #to binary operator"  and the 2.E "task 1
>> failed - "no method for coercing this S4 class to a vector".
>> #
>> #Any idea of how repair this loop?
>>
>> #########
>> #library
>> ########
>> library(parallel);library(foreach);library(doParallel);
>> library(gdistance);library(raster)
>> library(rgdal);library(rgeos)
>> library(sp)
>> #######
>> #data
>> ###########
>> path_data<-"E:/Q11/"
>> # cost raster sea and island
>> costa6Azo <- raster("E:/Q11/costa6Azo_projected.tif")
>> transitioncosta6Azo <- transition(costa6Azo, min, directions=16)#porque
>> min????
>> trCostS16 <- gdistance::geoCorrection(transitioncosta6Azo, type="c")
>> #points
>> boat <- read.table(paste0(path_data,"boat2905.csv"), header=TRUE,
>> sep=";", na.strings="NA", dec=".", strip.white=TRUE)
>> pos<-as.data.frame(cbind(boat$Lat1,boat$Long1,boat$Ref))
>> str(pos)
>> sp::coordinates(pos) <- ~V2+V1
>> sp::proj4string(pos) <-CRS("+proj=longlat +datum=WGS84 +no_defs")
>>
>> pos<-sp::spTransform(pos, CRS("+proj=utm +zone=26 +ellps=intl
>> +towgs84=-104,167,-38,0,0,0,0 +units=m +no_defs"))
>> # The aim of the loop: calculating the track of the whole sailing
>> path#############################################################
>> #
>> line<- gdistance::shortestPath(trCostS16, pos at coords[1,],pos at coords[2,],
>> output="SpatialLines")#
>> glength(1-2=4887.737m);(2-3=12590.01);(12-11=11360.39m);(12-13=9453.001m)
>> lines(line,col=5)
>> #2. A) old
>> loop##########################################################################################################################
>> #it works, but it's too slow
>>
>

> ## here we start with the for-loop
>> for (i in (seq(2,length(pos) - 1))) {
>>   # calculation of the rest of the segements
>>   nextSegment<- gdistance::shortestPath(trCostS16, pos at coords
>> [i,],pos at coords[i+1,], output="SpatialLines")
>>   # simple addition combines the single spatialline segements
>>   line <- nextSegment + line
>>   # we plot each new segment
>>   lines(nextSegment)
>> }
>> # note that we have now ten combined line features in this SpatialLines
>> object
>> line
>> gLength(line)#110747.2
>>
>> #2.B### new parallel
>> loop##################################################################################################3
>> #it works, but it's too slow##%do%
>> #
>> line<- gdistance::shortestPath(trCostS16, pos at coords[1,],pos at coords[2,],
>> output="SpatialLines")#
>> glength(1-2=4887.737m);(2-3=12590.01);(12-11=11360.39m);(12-13=9453.001m)
>>
>> x <- foreach(i=2:13) %do%
>>   {nextSegment<-gdistance::shortestPath(trCostS16, pos at coords
>> [i,],pos at coords[i-1,], output="SpatialLines")
>>     line <- nextSegment + line
>>  }
>> x      ##  it works!!!! 1+ 12 spatialLines!!
>> ##
>
>
#     #2.C#parallel loop ##%dopar%

> #without success
>>
> registerDoParallel()
>
> getDoParWorkers()
>> line<- gdistance::shortestPath(trCostS16, pos at coords[1,],pos at coords[2,],
>> output="SpatialLines")#
>> glength(1-2=4887.737m);(2-3=12590.01);(12-11=11360.39m);(12-13=9453.001m)
>> #function
>> #
>> funMTM<-function(){
>> nextSegment<-gdistance::shortestPath(trCostS16, pos at coords[i,],pos at coords[i-1,],
>> output="SpatialLines")
>> line <- nextSegment + line
>> }
>> getDoParWorkers()
>> ptime <- system.time({
>>   result <- foreach(i=2:13) %dopar% funMTM()
>>   })
>> ptime#Error in funMTM() :
>> #task 1 failed - "non-numeric argument to binary operator"
>> #
>>
> #

> #2.D#loop %dopar% simple
>>
>        # it works, but I need the spatiallines output, not a list.

> #If I run the %dopar% only with the functions shortestPath without
>> increase the lines into the SpatialLines. I get a list with 13 features(
>> indidivual spatialLines). However, I need an SpatialLines object, with 13
>> spatiallines inside.
>> registerDoParallel()
>> registerDoSEQ()
>> registerDoParallel(cores=10)
>> getDoParWorkers()
>> system.time(foreach(i=2:13) %dopar% gdistance::shortestPath(trCostS16,
>> pos at coords[i,],pos at coords[i-1,], output="SpatialLines"))
>> #user  system elapsed
>> #0.74    0.69   54.81
>>
>
#    #2.E#loop %dopar% with the function defined in the loop
      #without success:

> system.time(foreach(i=2:13) %dopar% {
>>   nextSegment=gdistance::shortestPath(trCostS16, pos at coords
>> [i,],pos at coords[i-1,], output="SpatialLines")
>>             line =nextSegment + line})
>> #Error in { :
>> #task 1 failed - "no method for coercing this S4 class to a vector"
>> stopCluster(cl)
>>
>> ##############
>> #3)MARCEL: loops in R are really slow in general.. you could also think
>> about some fancy stuff like some R compiler or Rcpp package
>> #MARTA##### Functions #####
>> # byte code compilation
>> library(compiler)
>> myfunc<-gdistance::shortestPath(trCostS16, pos at coords[1,],pos at coords[2,],
>> output="SpatialLines")
>> myFuncCmp <- cmpfun(myfunc)
>> system.time({
>>   output <- SpatialLines(LinesList = , 1, FUN=myFuncCmp)
>> })
>> #############
>>
>>       #############

> #4) MARCEL: in order to analyze your memory consumption, you should have a
>> look on your system resources (depending on your OS: task manager (win) or
>> htop (linux))
>> #MARTA:I run the loop with the task manager's window open, and never over
>> pass the 30% of the CPU's memory .
>> ####files
>> https://drive.google.com/open?id=0BwqSBe1Yq-FBUWVBOUdvaThEU1k
>>
>>
> I haven't my solution yet but I'm closer now, your suggestions were really
helpful.
Marta

	[[alternative HTML version deleted]]


From rameshv at caryinstitute.org  Tue Mar 14 22:31:46 2017
From: rameshv at caryinstitute.org (Vijay Ramesh)
Date: Tue, 14 Mar 2017 17:31:46 -0400
Subject: [R-sig-Geo] Same mask for two rasters,
	but obtaining different extents in R
Message-ID: <CAOGv6M-15T1boTM8NeFaz2Snm1eCfnJaFV=tc3aR-c+9NnB-fQ@mail.gmail.com>

I loaded a shapefile in R, and cropped and masked it with the same mask,
but I get different extents. Any suggestions?

Code below:

    library(raster)
    library(rgdal)
    library(GISTools)
    library(sp)
    library(maptools)

    ##Loading the first mask
    Mask <- readOGR("C:\\Users\\rameshv\\Downloads\\Climate
Stability\\SPV_Mask\\mask.shp")
    proj4string(Mask) <- CRS("+init=epsg:4326")

    #Loading the Rasters For Present and LGM and clipping them to the right
extent
    bio5 <- raster("C:\\Users\\rameshv\\Downloads\\Climate
Stability\\Data_LGM_Present\\Present\\1_RawData\\bio_5")
    proj4string(bio5) <- CRS("+init=epsg:4326")
    lg5 <- raster("C:\\Users\\rameshv\\Downloads\\Climate
Stability\\Data_LGM_Present\\LGM\\1_RawData\\cclgmbi5.tif")
    proj4string(lg5) <- CRS("+init=epsg:4326")

    ##Cropping by using the Crop and Mask functions
    cr<- crop(bio5, extent(Mask))
    bio5 <- mask(cr, Mask)

    cr2<- crop(lg5, extent(Mask))
    lg5<- mask(cr2, Mask)

    > bio5
     class       : RasterLayer
     dimensions  : 339, 246, 83394  (nrow, ncol, ncell)
     resolution  : 0.04166667, 0.04166667  (x, y)
     extent      : 72.45835, 82.70835, 8.083337, 22.20834  (xmin, xmax,
ymin, ymax)
     coord. ref. : +init=epsg:4326 +proj=longlat +datum=WGS84 +no_defs
+ellps=WGS84 +towgs84=0,0,0
     data source : in memory
     names       : bio_5
     values      : 207, 432  (min, max)
     attributes  :
        ID COUNT
     from: -86     1
     to  : 489    38

     > lg5
     class       : RasterLayer
     dimensions  : 339, 246, 83394  (nrow, ncol, ncell)
     resolution  : 0.04166667, 0.04166667  (x, y)
     extent      : 72.45833, 82.70833, 8.083333, 22.20833  (xmin, xmax,
ymin, ymax)
     coord. ref. : +init=epsg:4326 +proj=longlat +datum=WGS84 +no_defs
+ellps=WGS84 +towgs84=0,0,0
     data source : in memory
     names       : cclgmbi5
     values      : 187, 392  (min, max)


-- 
Data Manager,
Barbara Han Lab,
Cary Institute of Ecosystem Studies,
2801 Sharon Turnpike, Millbrook, NY 12545
Lab Site : http://www.hanlab.science/
Personal Site : http://evolecol.weebly.com/
Phone : (845)-677-7600 Ext: 241

	[[alternative HTML version deleted]]


From btupper at bigelow.org  Wed Mar 15 14:58:56 2017
From: btupper at bigelow.org (Ben Tupper)
Date: Wed, 15 Mar 2017 09:58:56 -0400
Subject: [R-sig-Geo] Same mask for two rasters,
	but obtaining different extents in R
In-Reply-To: <CAOGv6M-15T1boTM8NeFaz2Snm1eCfnJaFV=tc3aR-c+9NnB-fQ@mail.gmail.com>
References: <CAOGv6M-15T1boTM8NeFaz2Snm1eCfnJaFV=tc3aR-c+9NnB-fQ@mail.gmail.com>
Message-ID: <2642DF6E-8590-4266-BAA9-E3B77BC9644D@bigelow.org>

Hi,

Might you show us what bio5 and lg5 look like before you do the masking?

Cheers,
Ben


> On Mar 14, 2017, at 5:31 PM, Vijay Ramesh via R-sig-Geo <r-sig-geo at r-project.org> wrote:
> 
> I loaded a shapefile in R, and cropped and masked it with the same mask,
> but I get different extents. Any suggestions?
> 
> Code below:
> 
>    library(raster)
>    library(rgdal)
>    library(GISTools)
>    library(sp)
>    library(maptools)
> 
>    ##Loading the first mask
>    Mask <- readOGR("C:\\Users\\rameshv\\Downloads\\Climate
> Stability\\SPV_Mask\\mask.shp")
>    proj4string(Mask) <- CRS("+init=epsg:4326")
> 
>    #Loading the Rasters For Present and LGM and clipping them to the right
> extent
>    bio5 <- raster("C:\\Users\\rameshv\\Downloads\\Climate
> Stability\\Data_LGM_Present\\Present\\1_RawData\\bio_5")
>    proj4string(bio5) <- CRS("+init=epsg:4326")
>    lg5 <- raster("C:\\Users\\rameshv\\Downloads\\Climate
> Stability\\Data_LGM_Present\\LGM\\1_RawData\\cclgmbi5.tif")
>    proj4string(lg5) <- CRS("+init=epsg:4326")
> 
>    ##Cropping by using the Crop and Mask functions
>    cr<- crop(bio5, extent(Mask))
>    bio5 <- mask(cr, Mask)
> 
>    cr2<- crop(lg5, extent(Mask))
>    lg5<- mask(cr2, Mask)
> 
>> bio5
>     class       : RasterLayer
>     dimensions  : 339, 246, 83394  (nrow, ncol, ncell)
>     resolution  : 0.04166667, 0.04166667  (x, y)
>     extent      : 72.45835, 82.70835, 8.083337, 22.20834  (xmin, xmax,
> ymin, ymax)
>     coord. ref. : +init=epsg:4326 +proj=longlat +datum=WGS84 +no_defs
> +ellps=WGS84 +towgs84=0,0,0
>     data source : in memory
>     names       : bio_5
>     values      : 207, 432  (min, max)
>     attributes  :
>        ID COUNT
>     from: -86     1
>     to  : 489    38
> 
>> lg5
>     class       : RasterLayer
>     dimensions  : 339, 246, 83394  (nrow, ncol, ncell)
>     resolution  : 0.04166667, 0.04166667  (x, y)
>     extent      : 72.45833, 82.70833, 8.083333, 22.20833  (xmin, xmax,
> ymin, ymax)
>     coord. ref. : +init=epsg:4326 +proj=longlat +datum=WGS84 +no_defs
> +ellps=WGS84 +towgs84=0,0,0
>     data source : in memory
>     names       : cclgmbi5
>     values      : 187, 392  (min, max)
> 
> 
> -- 
> Data Manager,
> Barbara Han Lab,
> Cary Institute of Ecosystem Studies,
> 2801 Sharon Turnpike, Millbrook, NY 12545
> Lab Site : http://www.hanlab.science/
> Personal Site : http://evolecol.weebly.com/
> Phone : (845)-677-7600 Ext: 241
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

Ben Tupper
Bigelow Laboratory for Ocean Sciences
60 Bigelow Drive, P.O. Box 380
East Boothbay, Maine 04544
http://www.bigelow.org


From sarah.goslee at gmail.com  Wed Mar 15 18:13:36 2017
From: sarah.goslee at gmail.com (Sarah Goslee)
Date: Wed, 15 Mar 2017 13:13:36 -0400
Subject: [R-sig-Geo] Same mask for two rasters,
 but obtaining different extents in R
In-Reply-To: <CAOGv6M-15T1boTM8NeFaz2Snm1eCfnJaFV=tc3aR-c+9NnB-fQ@mail.gmail.com>
References: <CAOGv6M-15T1boTM8NeFaz2Snm1eCfnJaFV=tc3aR-c+9NnB-fQ@mail.gmail.com>
Message-ID: <CAM_vju=vPZod=DnF9XLVZa46asLEPxjK0YtOpC8vVNh+8=-n_w@mail.gmail.com>

The most likely explanation seems to me that the rasters were not
aligned before cropping, so they are not aligned after cropping.

Have you checked the original extent and resolution?

Sarah

On Tue, Mar 14, 2017 at 5:31 PM, Vijay Ramesh via R-sig-Geo
<r-sig-geo at r-project.org> wrote:
> I loaded a shapefile in R, and cropped and masked it with the same mask,
> but I get different extents. Any suggestions?
>
> Code below:
>
>     library(raster)
>     library(rgdal)
>     library(GISTools)
>     library(sp)
>     library(maptools)
>
>     ##Loading the first mask
>     Mask <- readOGR("C:\\Users\\rameshv\\Downloads\\Climate
> Stability\\SPV_Mask\\mask.shp")
>     proj4string(Mask) <- CRS("+init=epsg:4326")
>
>     #Loading the Rasters For Present and LGM and clipping them to the right
> extent
>     bio5 <- raster("C:\\Users\\rameshv\\Downloads\\Climate
> Stability\\Data_LGM_Present\\Present\\1_RawData\\bio_5")
>     proj4string(bio5) <- CRS("+init=epsg:4326")
>     lg5 <- raster("C:\\Users\\rameshv\\Downloads\\Climate
> Stability\\Data_LGM_Present\\LGM\\1_RawData\\cclgmbi5.tif")
>     proj4string(lg5) <- CRS("+init=epsg:4326")
>
>     ##Cropping by using the Crop and Mask functions
>     cr<- crop(bio5, extent(Mask))
>     bio5 <- mask(cr, Mask)
>
>     cr2<- crop(lg5, extent(Mask))
>     lg5<- mask(cr2, Mask)
>
>     > bio5
>      class       : RasterLayer
>      dimensions  : 339, 246, 83394  (nrow, ncol, ncell)
>      resolution  : 0.04166667, 0.04166667  (x, y)
>      extent      : 72.45835, 82.70835, 8.083337, 22.20834  (xmin, xmax,
> ymin, ymax)
>      coord. ref. : +init=epsg:4326 +proj=longlat +datum=WGS84 +no_defs
> +ellps=WGS84 +towgs84=0,0,0
>      data source : in memory
>      names       : bio_5
>      values      : 207, 432  (min, max)
>      attributes  :
>         ID COUNT
>      from: -86     1
>      to  : 489    38
>
>      > lg5
>      class       : RasterLayer
>      dimensions  : 339, 246, 83394  (nrow, ncol, ncell)
>      resolution  : 0.04166667, 0.04166667  (x, y)
>      extent      : 72.45833, 82.70833, 8.083333, 22.20833  (xmin, xmax,
> ymin, ymax)
>      coord. ref. : +init=epsg:4326 +proj=longlat +datum=WGS84 +no_defs
> +ellps=WGS84 +towgs84=0,0,0
>      data source : in memory
>      names       : cclgmbi5
>      values      : 187, 392  (min, max)
>
>

-- 
Sarah Goslee
http://www.functionaldiversity.org


From martazores at gmail.com  Wed Mar 15 18:37:46 2017
From: martazores at gmail.com (marta azores)
Date: Wed, 15 Mar 2017 16:37:46 -0100
Subject: [R-sig-Geo] loop memory problem
In-Reply-To: <CAE3WKgSHrKSmAzPm5NXqHU6+cu_Xic6sBtGnKFpE57N+h-S+EA@mail.gmail.com>
References: <CAE3WKgQPSYMxSzTSarj9Ee2xrkjcWg4fQYZJESvxnOnGkGBeZg@mail.gmail.com>
	<8ca347cd-2fb9-2443-ff38-b5c59f4d9950@informatik.uni-freiburg.de>
	<882f4b60-060b-df3f-9405-a04fdc6bff7b@informatik.uni-freiburg.de>
	<CAE3WKgSHrKSmAzPm5NXqHU6+cu_Xic6sBtGnKFpE57N+h-S+EA@mail.gmail.com>
Message-ID: <CAE3WKgSc+vDZTvGqHwQ+Hf20Xob7wjQ2+kb0mc5kJiP1aaCH1Q@mail.gmail.com>

Hi again,

I read in the guide of foreach that include the packages was a good idea.
Now the parallel loop is runing but at the end I got only one spatial line
(the first) I don't understand why is not adding the other spatiallines.

Any idea?

###3)dopar%
library(doSNOW)
registerDoSEQ()
registerDoParallel(cores=10)
getDoParWorkers()
line2<- gdistance::shortestPath(trCostS16, pos at coords[13,],pos at coords[12,],
output="SpatialLines")#

x<-foreach(i=2:13,.packages=c("gdistance","doParallel","foreach","base","sp"))
%dopar% {
  nextSegment2=gdistance::shortestPath(trCostS16,
pos at coords[i,],pos at coords[i+1,],
output="SpatialLines")
  line2 =nextSegment2+line2
  print(i)}

stopCluster(cl)
registerDoSEQ()

Thanks in advance,
Marta
####files
https://drive.google.com/open?id=0BwqSBe1Yq-FBUWVBOUdvaThEU1k

	[[alternative HTML version deleted]]


From castrog.miguelg at gmail.com  Wed Mar 15 19:49:30 2017
From: castrog.miguelg at gmail.com (=?utf-8?Q?Miguel_Castro_G=C3=B3mez?=)
Date: Wed, 15 Mar 2017 19:49:30 +0100
Subject: [R-sig-Geo] Sentienl 2 gdal translate
Message-ID: <F3B5A4AE-F1CC-4A9A-BCC0-FD18B6F74ECB@gmail.com>

Hi,

I have Sentinel 2 images (jp2) that I want to convert to GTiff using gdal_translate in R (from gdalutils package). Here is the code I?m using

Image_Path<-?/path/to/wd?

S2_JP2_List <- list.files(Image_Path, full.names = TRUE, pattern = ".jp2$")

for (i in 1:length(S2_JP2_List)) {
gdal_translate(src_dataset = S2_JP2_List[[i]], dst_dataset = paste("Band", i , "tif"), ot = "UInt16", of = ?GTiff")
    }

When running this code, the process starts without any error but its never ending neither producing any output

I've tried to do it in gdal and the same code works, except that it is necessary to skip  the default driver since it cannot manage large jp2 files. 

gdal_translate -of GTiff /path/to/input/S2_b1.jp2  /path/to/output/S2_b1converted.tif --config GDAL_SKIP JP2ECW

Any idea how could I run this in R?

Thanks 
M



	[[alternative HTML version deleted]]


From mtreglia at gmail.com  Wed Mar 15 20:50:11 2017
From: mtreglia at gmail.com (Michael Treglia)
Date: Wed, 15 Mar 2017 15:50:11 -0400
Subject: [R-sig-Geo] Maintain SRID with st_write to postgis db
Message-ID: <CAPKp32stHJ6d1smgTf6Y2pA+w=1khGcc1UmyUDgSo3mfs+DPsA@mail.gmail.com>

Hi All,

Been working to import and manipulate a CSV file with point data
(lat/long), and then export to a PostGIS db.

Overall, successful, but one thing I'd like to fix - when I write out the
layer to postgis, the SRID is not maintained. The final EPSG/SRID should be
2263, but when I check in PostGIS, it comes up as 900914.

Below is my code and sessionInfo, and the data are from here:
https://data.cityofnewyork.us/Public-Safety/NYPD-Complaint-Data-Current-YTD/5uac-w243
(downloaded as plain old CSV)

Anything I might be missing? Thanks in advance for giving a quick look!
Mike


##Start Code

#load packages
library(sf)
library(RPostgreSQL)

#read data
crime_current <- read.csv("NYPD_Complaint_Data_Current_YTD.csv",
stringsAsFactors = FALSE)

#format time columns for easier reading in postgres (I think), as keeping
as date format caused problems in export
crime_current$CMPLNT_FR_TIME <-
as.character(as.POSIXct(paste(crime_current$CMPLNT_FR_DT,
crime_current$CMPLNT_FR_TM), format="%m/%d/%Y\ %H:%M", tz=""))
crime_current$CMPLNT_TO_TIME <-
as.character(as.POSIXct(paste(crime_current$CMPLNT_TO_DT,
crime_current$CMPLNT_TO_TM), format="%m/%d/%Y\ %H:%M", tz=""))
crime_current$RPT_DT <- as.character(as.POSIXct(crime_current$RPT_DT,
format="%m/%d/%Y", tz=""))

#convert to sf object
crime_current.sf <- st_as_sf(crime_current, coords = c("Longitude",
"Latitude"), crs = 4326)
#reproject to EPSG 2263
crime_current.sf <- st_transform(crime_current.sf, crs=2263)

#write to postgres
st_write(crime_current.sf, "PG:dbname=mydb user=user host=xx.xx.xx.xx",
'health_safety.crime_current')
###End Code



> sessionInfo()
R version 3.3.1 (2016-06-21)
Platform: x86_64-pc-linux-gnu (64-bit)
Running under: Ubuntu 14.04.5 LTS

locale:
 [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
 [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
 LC_PAPER=en_US.UTF-8       LC_NAME=C
 [9] LC_ADDRESS=C               LC_TELEPHONE=C
LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] sp_1.2-3          RPostgreSQL_0.4-1 DBI_0.6           sf_0.3-4

loaded via a namespace (and not attached):
[1] tools_3.3.1     units_0.4-2     Rcpp_0.12.9     udunits2_0.13
grid_3.3.1      lattice_0.20-33

	[[alternative HTML version deleted]]


From englishchristophera at gmail.com  Wed Mar 15 22:21:15 2017
From: englishchristophera at gmail.com (chris english)
Date: Wed, 15 Mar 2017 17:21:15 -0400
Subject: [R-sig-Geo] Maintain SRID with st_write to postgis db
In-Reply-To: <CAPKp32stHJ6d1smgTf6Y2pA+w=1khGcc1UmyUDgSo3mfs+DPsA@mail.gmail.com>
References: <CAPKp32stHJ6d1smgTf6Y2pA+w=1khGcc1UmyUDgSo3mfs+DPsA@mail.gmail.com>
Message-ID: <CAASFQpRdPiS1ctEoTNYRupjaZgXcAOwK8KOuZbw7Te+rycBPSQ@mail.gmail.com>

Michael,

this from the sf vignettes on read write to databases:

The dsn and layer arguments to st_read and st_write denote a data source
name and optionally a layer name. Their exact interpretation as well as the
options they support vary per driver, the GDAL driver documentation is best
consulted for this. For instance, a PostGIS table in database postgis might
be read by

meuse <- st_read("PG:dbname=postgis", "meuse")

where the PG: string indicates this concerns the PostGIS driver, followed
by database name, and possibly port and user credentials.

st_read typically reads the coordinate reference system as proj4string, but
not the EPSG (SRID). GDAL cannot retrieve SRID (EPSG code) from proj4string
strings, and, when needed, it has to be set by the user.

I just re-read this this morning for my own understanding, and the
statements regarding st_read would appear to apply as explicitly to
st_write as both or mediated by GDAL, that processes proj4string(s) but not
epsg. So it looks like manually setting or resetting epsg is part of the
workflow. Further down in the crs section is discussion about how within a
layer both proj4string and epsg must be the same, or NA. This may localize
where the 900914 is being applied, i.e. in PostGIS to settle the table
parameters.

HTH,

Chris





On Wed, Mar 15, 2017 at 3:50 PM, Michael Treglia <mtreglia at gmail.com> wrote:

> Hi All,
>
> Been working to import and manipulate a CSV file with point data
> (lat/long), and then export to a PostGIS db.
>
> Overall, successful, but one thing I'd like to fix - when I write out the
> layer to postgis, the SRID is not maintained. The final EPSG/SRID should be
> 2263, but when I check in PostGIS, it comes up as 900914.
>
> Below is my code and sessionInfo, and the data are from here:
> https://data.cityofnewyork.us/Public-Safety/NYPD-Complaint-
> Data-Current-YTD/5uac-w243
> (downloaded as plain old CSV)
>
> Anything I might be missing? Thanks in advance for giving a quick look!
> Mike
>
>
> ##Start Code
>
> #load packages
> library(sf)
> library(RPostgreSQL)
>
> #read data
> crime_current <- read.csv("NYPD_Complaint_Data_Current_YTD.csv",
> stringsAsFactors = FALSE)
>
> #format time columns for easier reading in postgres (I think), as keeping
> as date format caused problems in export
> crime_current$CMPLNT_FR_TIME <-
> as.character(as.POSIXct(paste(crime_current$CMPLNT_FR_DT,
> crime_current$CMPLNT_FR_TM), format="%m/%d/%Y\ %H:%M", tz=""))
> crime_current$CMPLNT_TO_TIME <-
> as.character(as.POSIXct(paste(crime_current$CMPLNT_TO_DT,
> crime_current$CMPLNT_TO_TM), format="%m/%d/%Y\ %H:%M", tz=""))
> crime_current$RPT_DT <- as.character(as.POSIXct(crime_current$RPT_DT,
> format="%m/%d/%Y", tz=""))
>
> #convert to sf object
> crime_current.sf <- st_as_sf(crime_current, coords = c("Longitude",
> "Latitude"), crs = 4326)
> #reproject to EPSG 2263
> crime_current.sf <- st_transform(crime_current.sf, crs=2263)
>
> #write to postgres
> st_write(crime_current.sf, "PG:dbname=mydb user=user host=xx.xx.xx.xx",
> 'health_safety.crime_current')
> ###End Code
>
>
>
> > sessionInfo()
> R version 3.3.1 (2016-06-21)
> Platform: x86_64-pc-linux-gnu (64-bit)
> Running under: Ubuntu 14.04.5 LTS
>
> locale:
>  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
> LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
>  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
>  LC_PAPER=en_US.UTF-8       LC_NAME=C
>  [9] LC_ADDRESS=C               LC_TELEPHONE=C
> LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> other attached packages:
> [1] sp_1.2-3          RPostgreSQL_0.4-1 DBI_0.6           sf_0.3-4
>
> loaded via a namespace (and not attached):
> [1] tools_3.3.1     units_0.4-2     Rcpp_0.12.9     udunits2_0.13
> grid_3.3.1      lattice_0.20-33
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From mtreglia at gmail.com  Wed Mar 15 22:43:50 2017
From: mtreglia at gmail.com (Michael Treglia)
Date: Wed, 15 Mar 2017 17:43:50 -0400
Subject: [R-sig-Geo] Maintain SRID with st_write to postgis db
In-Reply-To: <CAASFQpRdPiS1ctEoTNYRupjaZgXcAOwK8KOuZbw7Te+rycBPSQ@mail.gmail.com>
References: <CAPKp32stHJ6d1smgTf6Y2pA+w=1khGcc1UmyUDgSo3mfs+DPsA@mail.gmail.com>
	<CAASFQpRdPiS1ctEoTNYRupjaZgXcAOwK8KOuZbw7Te+rycBPSQ@mail.gmail.com>
Message-ID: <CAPKp32ufvfNvbWS7LQ8Ac4q0qZgHhpGdQjNiKYx7PMZbapXKqw@mail.gmail.com>

Hi Chris,

Thanks for that insight - I hadn't caught that part of the vignette (it had
admittedly been a bit since I last looked at it), and I appreciate your
interpretation. What you say makes sense to me, reading through that, and I
can naturally add code to set the SRID in PostGIS pretty easily.

Best,
Mike

On Wed, Mar 15, 2017 at 5:21 PM, chris english <
englishchristophera at gmail.com> wrote:

> Michael,
>
> this from the sf vignettes on read write to databases:
>
> The dsn and layer arguments to st_read and st_write denote a data source
> name and optionally a layer name. Their exact interpretation as well as the
> options they support vary per driver, the GDAL driver documentation is best
> consulted for this. For instance, a PostGIS table in database postgis might
> be read by
>
> meuse <- st_read("PG:dbname=postgis", "meuse")
>
> where the PG: string indicates this concerns the PostGIS driver, followed
> by database name, and possibly port and user credentials.
>
> st_read typically reads the coordinate reference system as proj4string,
> but not the EPSG (SRID). GDAL cannot retrieve SRID (EPSG code) from
> proj4string strings, and, when needed, it has to be set by the user.
>
> I just re-read this this morning for my own understanding, and the
> statements regarding st_read would appear to apply as explicitly to
> st_write as both or mediated by GDAL, that processes proj4string(s) but not
> epsg. So it looks like manually setting or resetting epsg is part of the
> workflow. Further down in the crs section is discussion about how within a
> layer both proj4string and epsg must be the same, or NA. This may localize
> where the 900914 is being applied, i.e. in PostGIS to settle the table
> parameters.
>
> HTH,
>
> Chris
>
>
>
>
>
> On Wed, Mar 15, 2017 at 3:50 PM, Michael Treglia <mtreglia at gmail.com>
> wrote:
>
>> Hi All,
>>
>> Been working to import and manipulate a CSV file with point data
>> (lat/long), and then export to a PostGIS db.
>>
>> Overall, successful, but one thing I'd like to fix - when I write out the
>> layer to postgis, the SRID is not maintained. The final EPSG/SRID should
>> be
>> 2263, but when I check in PostGIS, it comes up as 900914.
>>
>> Below is my code and sessionInfo, and the data are from here:
>> https://data.cityofnewyork.us/Public-Safety/NYPD-Complaint-D
>> ata-Current-YTD/5uac-w243
>> (downloaded as plain old CSV)
>>
>> Anything I might be missing? Thanks in advance for giving a quick look!
>> Mike
>>
>>
>> ##Start Code
>>
>> #load packages
>> library(sf)
>> library(RPostgreSQL)
>>
>> #read data
>> crime_current <- read.csv("NYPD_Complaint_Data_Current_YTD.csv",
>> stringsAsFactors = FALSE)
>>
>> #format time columns for easier reading in postgres (I think), as keeping
>> as date format caused problems in export
>> crime_current$CMPLNT_FR_TIME <-
>> as.character(as.POSIXct(paste(crime_current$CMPLNT_FR_DT,
>> crime_current$CMPLNT_FR_TM), format="%m/%d/%Y\ %H:%M", tz=""))
>> crime_current$CMPLNT_TO_TIME <-
>> as.character(as.POSIXct(paste(crime_current$CMPLNT_TO_DT,
>> crime_current$CMPLNT_TO_TM), format="%m/%d/%Y\ %H:%M", tz=""))
>> crime_current$RPT_DT <- as.character(as.POSIXct(crime_current$RPT_DT,
>> format="%m/%d/%Y", tz=""))
>>
>> #convert to sf object
>> crime_current.sf <- st_as_sf(crime_current, coords = c("Longitude",
>> "Latitude"), crs = 4326)
>> #reproject to EPSG 2263
>> crime_current.sf <- st_transform(crime_current.sf, crs=2263)
>>
>> #write to postgres
>> st_write(crime_current.sf, "PG:dbname=mydb user=user host=xx.xx.xx.xx",
>> 'health_safety.crime_current')
>> ###End Code
>>
>>
>>
>> > sessionInfo()
>> R version 3.3.1 (2016-06-21)
>> Platform: x86_64-pc-linux-gnu (64-bit)
>> Running under: Ubuntu 14.04.5 LTS
>>
>> locale:
>>  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
>> LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
>>  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
>>  LC_PAPER=en_US.UTF-8       LC_NAME=C
>>  [9] LC_ADDRESS=C               LC_TELEPHONE=C
>> LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C
>>
>> attached base packages:
>> [1] stats     graphics  grDevices utils     datasets  methods   base
>>
>> other attached packages:
>> [1] sp_1.2-3          RPostgreSQL_0.4-1 DBI_0.6           sf_0.3-4
>>
>> loaded via a namespace (and not attached):
>> [1] tools_3.3.1     units_0.4-2     Rcpp_0.12.9     udunits2_0.13
>> grid_3.3.1      lattice_0.20-33
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>

	[[alternative HTML version deleted]]


From edzer.pebesma at uni-muenster.de  Wed Mar 15 22:58:42 2017
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Wed, 15 Mar 2017 22:58:42 +0100
Subject: [R-sig-Geo] Maintain SRID with st_write to postgis db
In-Reply-To: <CAPKp32stHJ6d1smgTf6Y2pA+w=1khGcc1UmyUDgSo3mfs+DPsA@mail.gmail.com>
References: <CAPKp32stHJ6d1smgTf6Y2pA+w=1khGcc1UmyUDgSo3mfs+DPsA@mail.gmail.com>
Message-ID: <cc3d05b8-3f90-e861-c130-8364bf0e7e62@uni-muenster.de>

Great question! Short answer: now solved in the dev version on github;
data are written directly to postgis having epsg 2263.


Long answer:

I believe this was caused by gdal and proj.4 doing different things when
resolving epsg codes to proj4strings. sf uses proj.4 for this. When
writing a proj4string either gdal or postgis don't recognize the
proj4string that proj.4 returns on the epsg code. Neither gdal nor
postgis understand that syntactically different proj4strings may be
semantically identical.


After running your example, in postgis

# select proj4text from spatial_ref_sys where SRID = 900914;

gives:

 +proj=lcc +lat_1=41.03333333333333 +lat_2=40.66666666666666
+lat_0=40.16666666666666 +lon_0=-74 +x_0=300000 +y_0=0 +ellps=GRS80
+towgs84=0,0,0,0,0,0,0 +units=us-ft +no_defs

# select proj4text from spatial_ref_sys where SRID = 2263;

gives:

 +proj=lcc +lat_1=41.03333333333333 +lat_2=40.66666666666666
+lat_0=40.16666666666666 +lon_0=-74 +x_0=300000.0000000001 +y_0=0
+datum=NAD83 +units=us-ft +no_defs

sf causes this:

> st_crs(2263)
$epsg
[1] 2263

$proj4string
[1] "+proj=lcc +lat_1=41.03333333333333 +lat_2=40.66666666666666
+lat_0=40.16666666666666 +lon_0=-74 +x_0=300000.0000000001 +y_0=0
+ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=us-ft +no_defs"

attr(,"class")
[1] "crs"

because it uses proj.4 directly to resolve SRID strings:

/usr/share/proj/epsg has:

# NAD83 / New York Long Island (ftUS)
<2263> +proj=lcc +lat_1=41.03333333333333 +lat_2=40.66666666666666
+lat_0=40.16666666666666 +lon_0=-74 +x_0=300000.0000000001 +y_0=0
+datum=NAD83 +units=us-ft +no_defs  <>


The change I made to sf (
https://github.com/edzer/sfr/commit/d620f3b748d487bae910e3884c554fa9e3ce7090)
now first asks gdal to resolve the epsg (in case it is not NA), and
otherwise resolve the proj4string (if not NA), instead of ONLY trying to
resolve a non-NA proj4string.

On 15/03/17 20:50, Michael Treglia wrote:
> Hi All,
> 
> Been working to import and manipulate a CSV file with point data
> (lat/long), and then export to a PostGIS db.
> 
> Overall, successful, but one thing I'd like to fix - when I write out the
> layer to postgis, the SRID is not maintained. The final EPSG/SRID should be
> 2263, but when I check in PostGIS, it comes up as 900914.
> 
> Below is my code and sessionInfo, and the data are from here:
> https://data.cityofnewyork.us/Public-Safety/NYPD-Complaint-Data-Current-YTD/5uac-w243
> (downloaded as plain old CSV)
> 
> Anything I might be missing? Thanks in advance for giving a quick look!
> Mike
> 
> 
> ##Start Code
> 
> #load packages
> library(sf)
> library(RPostgreSQL)
> 
> #read data
> crime_current <- read.csv("NYPD_Complaint_Data_Current_YTD.csv",
> stringsAsFactors = FALSE)
> 
> #format time columns for easier reading in postgres (I think), as keeping
> as date format caused problems in export
> crime_current$CMPLNT_FR_TIME <-
> as.character(as.POSIXct(paste(crime_current$CMPLNT_FR_DT,
> crime_current$CMPLNT_FR_TM), format="%m/%d/%Y\ %H:%M", tz=""))
> crime_current$CMPLNT_TO_TIME <-
> as.character(as.POSIXct(paste(crime_current$CMPLNT_TO_DT,
> crime_current$CMPLNT_TO_TM), format="%m/%d/%Y\ %H:%M", tz=""))
> crime_current$RPT_DT <- as.character(as.POSIXct(crime_current$RPT_DT,
> format="%m/%d/%Y", tz=""))
> 
> #convert to sf object
> crime_current.sf <- st_as_sf(crime_current, coords = c("Longitude",
> "Latitude"), crs = 4326)
> #reproject to EPSG 2263
> crime_current.sf <- st_transform(crime_current.sf, crs=2263)
> 
> #write to postgres
> st_write(crime_current.sf, "PG:dbname=mydb user=user host=xx.xx.xx.xx",
> 'health_safety.crime_current')
> ###End Code
> 
> 
> 
>> sessionInfo()
> R version 3.3.1 (2016-06-21)
> Platform: x86_64-pc-linux-gnu (64-bit)
> Running under: Ubuntu 14.04.5 LTS
> 
> locale:
>  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
> LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
>  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
>  LC_PAPER=en_US.UTF-8       LC_NAME=C
>  [9] LC_ADDRESS=C               LC_TELEPHONE=C
> LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C
> 
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
> 
> other attached packages:
> [1] sp_1.2-3          RPostgreSQL_0.4-1 DBI_0.6           sf_0.3-4
> 
> loaded via a namespace (and not attached):
> [1] tools_3.3.1     units_0.4-2     Rcpp_0.12.9     udunits2_0.13
> grid_3.3.1      lattice_0.20-33
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics  (ifgi),  University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany; +49 251 83 33081
Journal of Statistical Software:   http://www.jstatsoft.org/
Computers & Geosciences:   http://elsevier.com/locate/cageo/

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 473 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20170315/d04cdd02/attachment.bin>

From loic.dutrieux at conabio.gob.mx  Wed Mar 15 23:13:47 2017
From: loic.dutrieux at conabio.gob.mx (=?UTF-8?Q?Lo=c3=afc_Dutrieux?=)
Date: Wed, 15 Mar 2017 16:13:47 -0600
Subject: [R-sig-Geo] Sentienl 2 gdal translate
In-Reply-To: <F3B5A4AE-F1CC-4A9A-BCC0-FD18B6F74ECB@gmail.com>
References: <F3B5A4AE-F1CC-4A9A-BCC0-FD18B6F74ECB@gmail.com>
Message-ID: <573be8a5-7ff1-03d1-4ab6-9f841db0941a@conabio.gob.mx>

Hi,

I tried your code with some S2 images I had lying around, and it works
on my system. I modified it a bit to write the output layers to the same
directory and not to my working directory.

library(gdalUtils)
library(raster)

Image_Path<-'/path/to/images/'

S2_JP2_List <- list.files(Image_Path, full.names = TRUE, pattern = ".jp2$")

for (file in S2_JP2_List) {
  out_file <- extension(file, 'tif')
  gdal_translate(src_dataset = file, dst_dataset = out_file, ot =
"UInt16", of = "GTiff")
}

gdal has a sentinel 2 driver, but it's not extremely old, therefore it's
possible that your installation doesn't have it; you can check with:

gdal-config --formats | grep sentinel2

Cheers,
Lo?c



On 15/03/17 12:49, Miguel Castro G?mez wrote:
> Hi,
> 
> I have Sentinel 2 images (jp2) that I want to convert to GTiff using gdal_translate in R (from gdalutils package). Here is the code I?m using
> 
> Image_Path<-?/path/to/wd?
> 
> S2_JP2_List <- list.files(Image_Path, full.names = TRUE, pattern = ".jp2$")
> 
> for (i in 1:length(S2_JP2_List)) {
> gdal_translate(src_dataset = S2_JP2_List[[i]], dst_dataset = paste("Band", i , "tif"), ot = "UInt16", of = ?GTiff")
>     }
> 
> When running this code, the process starts without any error but its never ending neither producing any output
> 
> I've tried to do it in gdal and the same code works, except that it is necessary to skip  the default driver since it cannot manage large jp2 files. 
> 
> gdal_translate -of GTiff /path/to/input/S2_b1.jp2  /path/to/output/S2_b1converted.tif --config GDAL_SKIP JP2ECW
> 
> Any idea how could I run this in R?
> 
> Thanks 
> M
> 
> 
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From mtreglia at gmail.com  Wed Mar 15 23:14:34 2017
From: mtreglia at gmail.com (Michael Treglia)
Date: Wed, 15 Mar 2017 18:14:34 -0400
Subject: [R-sig-Geo] Maintain SRID with st_write to postgis db
In-Reply-To: <cc3d05b8-3f90-e861-c130-8364bf0e7e62@uni-muenster.de>
References: <CAPKp32stHJ6d1smgTf6Y2pA+w=1khGcc1UmyUDgSo3mfs+DPsA@mail.gmail.com>
	<cc3d05b8-3f90-e861-c130-8364bf0e7e62@uni-muenster.de>
Message-ID: <CAPKp32uLVs+WyBj+PZJiNcCCAfiEURMQFKubWs7qwpMUYETG5Q@mail.gmail.com>

Wow - thanks so much for this quick fix, Edzer! I like your solution to
having syntatically different but semantically identical proj4string. Will
try this in a bit, and write back if I have any issues.
Best,
mike

On Wed, Mar 15, 2017 at 5:58 PM, Edzer Pebesma <
edzer.pebesma at uni-muenster.de> wrote:

> Great question! Short answer: now solved in the dev version on github;
> data are written directly to postgis having epsg 2263.
>
>
> Long answer:
>
> I believe this was caused by gdal and proj.4 doing different things when
> resolving epsg codes to proj4strings. sf uses proj.4 for this. When
> writing a proj4string either gdal or postgis don't recognize the
> proj4string that proj.4 returns on the epsg code. Neither gdal nor
> postgis understand that syntactically different proj4strings may be
> semantically identical.
>
>
> After running your example, in postgis
>
> # select proj4text from spatial_ref_sys where SRID = 900914;
>
> gives:
>
>  +proj=lcc +lat_1=41.03333333333333 +lat_2=40.66666666666666
> +lat_0=40.16666666666666 +lon_0=-74 +x_0=300000 +y_0=0 +ellps=GRS80
> +towgs84=0,0,0,0,0,0,0 +units=us-ft +no_defs
>
> # select proj4text from spatial_ref_sys where SRID = 2263;
>
> gives:
>
>  +proj=lcc +lat_1=41.03333333333333 +lat_2=40.66666666666666
> +lat_0=40.16666666666666 +lon_0=-74 +x_0=300000.0000000001 +y_0=0
> +datum=NAD83 +units=us-ft +no_defs
>
> sf causes this:
>
> > st_crs(2263)
> $epsg
> [1] 2263
>
> $proj4string
> [1] "+proj=lcc +lat_1=41.03333333333333 +lat_2=40.66666666666666
> +lat_0=40.16666666666666 +lon_0=-74 +x_0=300000.0000000001 +y_0=0
> +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=us-ft +no_defs"
>
> attr(,"class")
> [1] "crs"
>
> because it uses proj.4 directly to resolve SRID strings:
>
> /usr/share/proj/epsg has:
>
> # NAD83 / New York Long Island (ftUS)
> <2263> +proj=lcc +lat_1=41.03333333333333 +lat_2=40.66666666666666
> +lat_0=40.16666666666666 +lon_0=-74 +x_0=300000.0000000001 +y_0=0
> +datum=NAD83 +units=us-ft +no_defs  <>
>
>
> The change I made to sf (
> https://github.com/edzer/sfr/commit/d620f3b748d487bae910e3884c554f
> a9e3ce7090)
> now first asks gdal to resolve the epsg (in case it is not NA), and
> otherwise resolve the proj4string (if not NA), instead of ONLY trying to
> resolve a non-NA proj4string.
>
> On 15/03/17 20:50, Michael Treglia wrote:
> > Hi All,
> >
> > Been working to import and manipulate a CSV file with point data
> > (lat/long), and then export to a PostGIS db.
> >
> > Overall, successful, but one thing I'd like to fix - when I write out the
> > layer to postgis, the SRID is not maintained. The final EPSG/SRID should
> be
> > 2263, but when I check in PostGIS, it comes up as 900914.
> >
> > Below is my code and sessionInfo, and the data are from here:
> > https://data.cityofnewyork.us/Public-Safety/NYPD-Complaint-
> Data-Current-YTD/5uac-w243
> > (downloaded as plain old CSV)
> >
> > Anything I might be missing? Thanks in advance for giving a quick look!
> > Mike
> >
> >
> > ##Start Code
> >
> > #load packages
> > library(sf)
> > library(RPostgreSQL)
> >
> > #read data
> > crime_current <- read.csv("NYPD_Complaint_Data_Current_YTD.csv",
> > stringsAsFactors = FALSE)
> >
> > #format time columns for easier reading in postgres (I think), as keeping
> > as date format caused problems in export
> > crime_current$CMPLNT_FR_TIME <-
> > as.character(as.POSIXct(paste(crime_current$CMPLNT_FR_DT,
> > crime_current$CMPLNT_FR_TM), format="%m/%d/%Y\ %H:%M", tz=""))
> > crime_current$CMPLNT_TO_TIME <-
> > as.character(as.POSIXct(paste(crime_current$CMPLNT_TO_DT,
> > crime_current$CMPLNT_TO_TM), format="%m/%d/%Y\ %H:%M", tz=""))
> > crime_current$RPT_DT <- as.character(as.POSIXct(crime_current$RPT_DT,
> > format="%m/%d/%Y", tz=""))
> >
> > #convert to sf object
> > crime_current.sf <- st_as_sf(crime_current, coords = c("Longitude",
> > "Latitude"), crs = 4326)
> > #reproject to EPSG 2263
> > crime_current.sf <- st_transform(crime_current.sf, crs=2263)
> >
> > #write to postgres
> > st_write(crime_current.sf, "PG:dbname=mydb user=user host=xx.xx.xx.xx",
> > 'health_safety.crime_current')
> > ###End Code
> >
> >
> >
> >> sessionInfo()
> > R version 3.3.1 (2016-06-21)
> > Platform: x86_64-pc-linux-gnu (64-bit)
> > Running under: Ubuntu 14.04.5 LTS
> >
> > locale:
> >  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
> > LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
> >  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
> >  LC_PAPER=en_US.UTF-8       LC_NAME=C
> >  [9] LC_ADDRESS=C               LC_TELEPHONE=C
> > LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C
> >
> > attached base packages:
> > [1] stats     graphics  grDevices utils     datasets  methods   base
> >
> > other attached packages:
> > [1] sp_1.2-3          RPostgreSQL_0.4-1 DBI_0.6           sf_0.3-4
> >
> > loaded via a namespace (and not attached):
> > [1] tools_3.3.1     units_0.4-2     Rcpp_0.12.9     udunits2_0.13
> > grid_3.3.1      lattice_0.20-33
> >
> >       [[alternative HTML version deleted]]
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
>
> --
> Edzer Pebesma
> Institute for Geoinformatics  (ifgi),  University of M?nster
> Heisenbergstra?e 2, 48149 M?nster, Germany; +49 251 83 33081
> Journal of Statistical Software:   http://www.jstatsoft.org/
> Computers & Geosciences:   http://elsevier.com/locate/cageo/
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From mtreglia at gmail.com  Thu Mar 16 00:53:58 2017
From: mtreglia at gmail.com (Michael Treglia)
Date: Wed, 15 Mar 2017 19:53:58 -0400
Subject: [R-sig-Geo] Maintain SRID with st_write to postgis db
In-Reply-To: <CAPKp32uLVs+WyBj+PZJiNcCCAfiEURMQFKubWs7qwpMUYETG5Q@mail.gmail.com>
References: <CAPKp32stHJ6d1smgTf6Y2pA+w=1khGcc1UmyUDgSo3mfs+DPsA@mail.gmail.com>
	<cc3d05b8-3f90-e861-c130-8364bf0e7e62@uni-muenster.de>
	<CAPKp32uLVs+WyBj+PZJiNcCCAfiEURMQFKubWs7qwpMUYETG5Q@mail.gmail.com>
Message-ID: <CAPKp32t88vqbg60+tHNQF82CdW4YBFBDpWbdYF_FgV+9Y=nHBw@mail.gmail.com>

Sorry - this follow-up isn't entirely an R question, so if best to take
this off list, let me know:

Installing the dev version from github fails for me (installing on ubuntu
14.04.5) - I've included the output from the install process below - seems
to fail due to failed check for liblwgeom version.

Looks like I don't have liblwgeom installed - and when I try (via sudo
apt-get install liblwgeom-2.3-0), it indicates it requires libgeos-c1.
Installing libgeos-c1, however, requires removal of a newer version of
libgeos (libgeos-c1v5), which other FOSS GIS tools depend on (at least if
my understanding is correct).  Is there a way around this?  Sorry if I'm
just missing something, and thanks again for input.
mike



#Output of install from github
> install_github("edzer/sfr")
Downloading GitHub repo edzer/sfr at master
from URL https://api.github.com/repos/edzer/sfr/zipball/master
Installing sf
'/usr/lib/R/bin/R' --no-site-file --no-environ --no-save --no-restore
--quiet  \
  CMD INSTALL '/tmp/RtmpKLmhyt/devtools9fd11eb9c3/edzer-sfr-d620f3b'  \
  --library='/home/mlt244/R/x86_64-pc-linux-gnu-library/3.3'
--install-tests

* installing *source* package ?sf? ...
configure: CC: gcc -std=gnu99
configure: CXX: g++
configure: :
checking for gdal-config... /usr/bin/gdal-config
checking gdal-config usability... yes
configure: GDAL: 2.1.0
checking GDAL version >= 2.0.0... yes
checking for gcc... gcc -std=gnu99
checking whether the C compiler works... yes
checking for C compiler default output file name... a.out
checking for suffix of executables...
checking whether we are cross compiling... no
checking for suffix of object files... o
checking whether we are using the GNU C compiler... yes
checking whether gcc -std=gnu99 accepts -g... yes
checking for gcc -std=gnu99 option to accept ISO C89... none needed
checking how to run the C preprocessor... gcc -std=gnu99 -E
checking for grep that handles long lines and -e... /bin/grep
checking for egrep... /bin/grep -E
checking for ANSI C header files... yes
checking for sys/types.h... yes
checking for sys/stat.h... yes
checking for stdlib.h... yes
checking for string.h... yes
checking for memory.h... yes
checking for strings.h... yes
checking for inttypes.h... yes
checking for stdint.h... yes
checking for unistd.h... yes
checking gdal.h usability... yes
checking gdal.h presence... yes
checking for gdal.h... yes
checking GDAL: linking with --libs only... yes
checking GDAL: /usr/share/gdal/2.1/pcs.csv readable... yes
checking GDAL: checking whether PROJ.4 is available for linking:... yes
checking GDAL: checking whether PROJ.4 is available fur running:... yes
checking proj_api.h usability... yes
checking proj_api.h presence... yes
checking for proj_api.h... yes
checking for pj_init_plus in -lproj... yes
checking PROJ.4: epsg found and readable... yes
proj_conf_test.c: In function 'main':
proj_conf_test.c:5:5: error: unknown type name 'PAFile'
     PAFile fp;
     ^
proj_conf_test.c:8:5: warning: implicit declaration of function
'pj_open_lib' [-Wimplicit-function-declaration]
     fp = pj_open_lib(ctx, "conus", "rb");
     ^
proj_conf_test.c:9:12: warning: comparison between pointer and integer
[enabled by default]
     if (fp == NULL) exit(1);
            ^
proj_conf_test.c:10:5: warning: implicit declaration of function
'pj_ctx_fclose' [-Wimplicit-function-declaration]
     pj_ctx_fclose(ctx, fp);
     ^
./configure: line 3834: ./proj_conf_test: No such file or directory
checking PROJ.4: conus found and readable... yes
checking geos-config usability... yes
configure: GEOS: 3.5.0
checking GEOS version >= 3.3.0... yes
checking geos_c.h usability... yes
checking geos_c.h presence... yes
checking for geos_c.h... yes
checking geos: linking with -lgeos_c... yes
checking for lwgeom_version in -llwgeom... no
configure: error: in `/tmp/RtmpKLmhyt/devtools9fd11eb9c3/edzer-sfr-d620f3b':
configure: error: lwgeom test failed (--without-readline to disable)
See `config.log' for more details
ERROR: configuration failed for package ?sf?
* removing ?/home/mlt244/R/x86_64-pc-linux-gnu-library/3.3/sf?
* restoring previous ?/home/mlt244/R/x86_64-pc-linux-gnu-library/3.3/sf?
Error: Command failed (1)


On Wed, Mar 15, 2017 at 6:14 PM, Michael Treglia <mtreglia at gmail.com> wrote:

> Wow - thanks so much for this quick fix, Edzer! I like your solution to
> having syntatically different but semantically identical proj4string. Will
> try this in a bit, and write back if I have any issues.
> Best,
> mike
>
> On Wed, Mar 15, 2017 at 5:58 PM, Edzer Pebesma <
> edzer.pebesma at uni-muenster.de> wrote:
>
>> Great question! Short answer: now solved in the dev version on github;
>> data are written directly to postgis having epsg 2263.
>>
>>
>> Long answer:
>>
>> I believe this was caused by gdal and proj.4 doing different things when
>> resolving epsg codes to proj4strings. sf uses proj.4 for this. When
>> writing a proj4string either gdal or postgis don't recognize the
>> proj4string that proj.4 returns on the epsg code. Neither gdal nor
>> postgis understand that syntactically different proj4strings may be
>> semantically identical.
>>
>>
>> After running your example, in postgis
>>
>> # select proj4text from spatial_ref_sys where SRID = 900914;
>>
>> gives:
>>
>>  +proj=lcc +lat_1=41.03333333333333 +lat_2=40.66666666666666
>> +lat_0=40.16666666666666 +lon_0=-74 +x_0=300000 +y_0=0 +ellps=GRS80
>> +towgs84=0,0,0,0,0,0,0 +units=us-ft +no_defs
>>
>> # select proj4text from spatial_ref_sys where SRID = 2263;
>>
>> gives:
>>
>>  +proj=lcc +lat_1=41.03333333333333 +lat_2=40.66666666666666
>> +lat_0=40.16666666666666 +lon_0=-74 +x_0=300000.0000000001 +y_0=0
>> +datum=NAD83 +units=us-ft +no_defs
>>
>> sf causes this:
>>
>> > st_crs(2263)
>> $epsg
>> [1] 2263
>>
>> $proj4string
>> [1] "+proj=lcc +lat_1=41.03333333333333 +lat_2=40.66666666666666
>> +lat_0=40.16666666666666 +lon_0=-74 +x_0=300000.0000000001 +y_0=0
>> +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=us-ft +no_defs"
>>
>> attr(,"class")
>> [1] "crs"
>>
>> because it uses proj.4 directly to resolve SRID strings:
>>
>> /usr/share/proj/epsg has:
>>
>> # NAD83 / New York Long Island (ftUS)
>> <2263> +proj=lcc +lat_1=41.03333333333333 +lat_2=40.66666666666666
>> +lat_0=40.16666666666666 +lon_0=-74 +x_0=300000.0000000001 +y_0=0
>> +datum=NAD83 +units=us-ft +no_defs  <>
>>
>>
>> The change I made to sf (
>> https://github.com/edzer/sfr/commit/d620f3b748d487bae910e388
>> 4c554fa9e3ce7090)
>> now first asks gdal to resolve the epsg (in case it is not NA), and
>> otherwise resolve the proj4string (if not NA), instead of ONLY trying to
>> resolve a non-NA proj4string.
>>
>> On 15/03/17 20:50, Michael Treglia wrote:
>> > Hi All,
>> >
>> > Been working to import and manipulate a CSV file with point data
>> > (lat/long), and then export to a PostGIS db.
>> >
>> > Overall, successful, but one thing I'd like to fix - when I write out
>> the
>> > layer to postgis, the SRID is not maintained. The final EPSG/SRID
>> should be
>> > 2263, but when I check in PostGIS, it comes up as 900914.
>> >
>> > Below is my code and sessionInfo, and the data are from here:
>> > https://data.cityofnewyork.us/Public-Safety/NYPD-Complaint-D
>> ata-Current-YTD/5uac-w243
>> > (downloaded as plain old CSV)
>> >
>> > Anything I might be missing? Thanks in advance for giving a quick look!
>> > Mike
>> >
>> >
>> > ##Start Code
>> >
>> > #load packages
>> > library(sf)
>> > library(RPostgreSQL)
>> >
>> > #read data
>> > crime_current <- read.csv("NYPD_Complaint_Data_Current_YTD.csv",
>> > stringsAsFactors = FALSE)
>> >
>> > #format time columns for easier reading in postgres (I think), as
>> keeping
>> > as date format caused problems in export
>> > crime_current$CMPLNT_FR_TIME <-
>> > as.character(as.POSIXct(paste(crime_current$CMPLNT_FR_DT,
>> > crime_current$CMPLNT_FR_TM), format="%m/%d/%Y\ %H:%M", tz=""))
>> > crime_current$CMPLNT_TO_TIME <-
>> > as.character(as.POSIXct(paste(crime_current$CMPLNT_TO_DT,
>> > crime_current$CMPLNT_TO_TM), format="%m/%d/%Y\ %H:%M", tz=""))
>> > crime_current$RPT_DT <- as.character(as.POSIXct(crime_current$RPT_DT,
>> > format="%m/%d/%Y", tz=""))
>> >
>> > #convert to sf object
>> > crime_current.sf <- st_as_sf(crime_current, coords = c("Longitude",
>> > "Latitude"), crs = 4326)
>> > #reproject to EPSG 2263
>> > crime_current.sf <- st_transform(crime_current.sf, crs=2263)
>> >
>> > #write to postgres
>> > st_write(crime_current.sf, "PG:dbname=mydb user=user host=xx.xx.xx.xx",
>> > 'health_safety.crime_current')
>> > ###End Code
>> >
>> >
>> >
>> >> sessionInfo()
>> > R version 3.3.1 (2016-06-21)
>> > Platform: x86_64-pc-linux-gnu (64-bit)
>> > Running under: Ubuntu 14.04.5 LTS
>> >
>> > locale:
>> >  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
>> > LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
>> >  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
>> >  LC_PAPER=en_US.UTF-8       LC_NAME=C
>> >  [9] LC_ADDRESS=C               LC_TELEPHONE=C
>> > LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C
>> >
>> > attached base packages:
>> > [1] stats     graphics  grDevices utils     datasets  methods   base
>> >
>> > other attached packages:
>> > [1] sp_1.2-3          RPostgreSQL_0.4-1 DBI_0.6           sf_0.3-4
>> >
>> > loaded via a namespace (and not attached):
>> > [1] tools_3.3.1     units_0.4-2     Rcpp_0.12.9     udunits2_0.13
>> > grid_3.3.1      lattice_0.20-33
>> >
>> >       [[alternative HTML version deleted]]
>> >
>> > _______________________________________________
>> > R-sig-Geo mailing list
>> > R-sig-Geo at r-project.org
>> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> >
>>
>> --
>> Edzer Pebesma
>> Institute for Geoinformatics  (ifgi),  University of M?nster
>> Heisenbergstra?e 2, 48149 M?nster, Germany; +49 251 83 33081
>> Journal of Statistical Software:   http://www.jstatsoft.org/
>> Computers & Geosciences:   http://elsevier.com/locate/cageo/
>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>

	[[alternative HTML version deleted]]


From englishchristophera at gmail.com  Thu Mar 16 05:46:30 2017
From: englishchristophera at gmail.com (chris english)
Date: Thu, 16 Mar 2017 00:46:30 -0400
Subject: [R-sig-Geo] Maintain SRID with st_write to postgis db
In-Reply-To: <CAPKp32t88vqbg60+tHNQF82CdW4YBFBDpWbdYF_FgV+9Y=nHBw@mail.gmail.com>
References: <CAPKp32stHJ6d1smgTf6Y2pA+w=1khGcc1UmyUDgSo3mfs+DPsA@mail.gmail.com>
	<cc3d05b8-3f90-e861-c130-8364bf0e7e62@uni-muenster.de>
	<CAPKp32uLVs+WyBj+PZJiNcCCAfiEURMQFKubWs7qwpMUYETG5Q@mail.gmail.com>
	<CAPKp32t88vqbg60+tHNQF82CdW4YBFBDpWbdYF_FgV+9Y=nHBw@mail.gmail.com>
Message-ID: <CAASFQpS6sHCSoCb6nN1nZQk=34wk_v7vqypWgGwpXhk3-tUaNQ@mail.gmail.com>

Michael,

I have the very same failure,
> library(sf)
Linking to GEOS 3.4.2, GDAL 2.1.3, proj.4 4.9.1
(pre upgrade attempt, which still works just fine)

checking for geos_c.h... yes
checking geos: linking with -lgeos_c... yes
checking for lwgeom_version in -llwgeom... no
configure: error: in `/tmp/RtmpsCmf6B/devtoolsd68e68107a/edzer-sfr-d620f3b':
configure: error: lwgeom test failed (--without-readline to disable)

I could nearly copy your install output though on 16.04, and the same
tangle of it depends on x but it won't be installed & etc.
But, if you have PostGIS, you have liblwgeom as it is fairly specific to
PostGIS. Perhaps, rather than a devtools::github_install,
a clone github lo a local directory and config, make, install might work,
but I'm just imagining.

then testing:
config.log --snip --
configure:3993: checking for lwgeom_version in -llwgeom
configure:4018: gcc -std=gnu99 -o conftest -g -O2 -fstack-protector
--param=ssp-
buffer-size=4 -Wformat -Werror=format-security -D_FORTIFY_SOURCE=2 -g
 -I/usr/lo
cal/include   -I/usr/local/include -I/usr/local/include
-Wl,-Bsymbolic-functions
 -Wl,-z,relro conftest.c -llwgeom  -lproj  -L/usr/local/lib -lproj
-L/usr/loca
l/lib -lgdal -L/usr/local/lib -lgeos_c -lproj >&5
/tmp/ccDBUh1h.o: In function `main':
/home/chris/sfr/sfr/conftest.c:34: undefined reference to `lwgeom_version'
collect2: error: ld returned 1 exit status
configure:4018: $? = 1
configure: failed program was:
| /* confdefs.h */
| #define PACKAGE_NAME ""
| #define PACKAGE_TARNAME ""
| #define PACKAGE_VERSION ""
| #define PACKAGE_STRING ""
| #define PACKAGE_BUGREPORT ""
| #define PACKAGE_URL ""
| #define STDC_HEADERS 1
| #define HAVE_SYS_TYPES_H 1
| #define HAVE_SYS_STAT_H 1
| #define HAVE_STDLIB_H 1
| #define HAVE_STRING_H 1
| #define HAVE_MEMORY_H 1
| #define HAVE_STRINGS_H 1
| #define HAVE_INTTYPES_H 1
| #define HAVE_STDINT_H 1
| #define HAVE_UNISTD_H 1
| #define HAVE_GDAL_H 1
| #define HAVE_PROJ_API_H 1
| #define HAVE_LIBPROJ 1
| #define HAVE_GEOS_C_H 1
| /* end confdefs.h.  */
|
| /* Override any GCC internal prototype to avoid an error.
|    Use char because int might match the return type of a GCC
|    builtin and then its argument prototype would still apply.  */
| #ifdef __cplusplus
| extern "C"
| #endif
| char lwgeom_version ();
| int
| main ()
| {
| return lwgeom_version ();
|   ;
|   return 0;
| }
configure:4027: result: no
configure:4036: error: in `/home/chris/sfr/sfr':
configure:4038: error: lwgeom test failed (--without-readline to disable)
See `config.log' for more details

so, it may or may not be the presence or absence of liblwgeom but simply
an undefined reference as suggested above:

/home/chris/sfr/sfr/conftest.c:34: undefined reference to `lwgeom_version' ,

but I'm unclear how the version was being requested (well, I can kind of
guess)
but failing on undefined reference suggests it is not the version per se
that may
or may not be present (though is because you are using PostGIS), but how
the version was requested. I intuit.

Ah, and reading  /* confdefs.h */, that it indeed ends with #define
HAVE_GEOS_C_H 1,
and indeed, conftest.c:34: would have an  undefined reference to
`lwgeom_version'.

And I've said as much as I understand.

Chris

On Wed, Mar 15, 2017 at 7:53 PM, Michael Treglia <mtreglia at gmail.com> wrote:

> Sorry - this follow-up isn't entirely an R question, so if best to take
> this off list, let me know:
>
> Installing the dev version from github fails for me (installing on ubuntu
> 14.04.5) - I've included the output from the install process below - seems
> to fail due to failed check for liblwgeom version.
>
> Looks like I don't have liblwgeom installed - and when I try (via sudo
> apt-get install liblwgeom-2.3-0), it indicates it requires libgeos-c1.
> Installing libgeos-c1, however, requires removal of a newer version of
> libgeos (libgeos-c1v5), which other FOSS GIS tools depend on (at least if
> my understanding is correct).  Is there a way around this?  Sorry if I'm
> just missing something, and thanks again for input.
> mike
>
>
>
> #Output of install from github
> > install_github("edzer/sfr")
> Downloading GitHub repo edzer/sfr at master
> from URL https://api.github.com/repos/edzer/sfr/zipball/master
> Installing sf
> '/usr/lib/R/bin/R' --no-site-file --no-environ --no-save --no-restore
> --quiet  \
>   CMD INSTALL '/tmp/RtmpKLmhyt/devtools9fd11eb9c3/edzer-sfr-d620f3b'  \
>   --library='/home/mlt244/R/x86_64-pc-linux-gnu-library/3.3'
> --install-tests
>
> * installing *source* package ?sf? ...
> configure: CC: gcc -std=gnu99
> configure: CXX: g++
> configure: :
> checking for gdal-config... /usr/bin/gdal-config
> checking gdal-config usability... yes
> configure: GDAL: 2.1.0
> checking GDAL version >= 2.0.0... yes
> checking for gcc... gcc -std=gnu99
> checking whether the C compiler works... yes
> checking for C compiler default output file name... a.out
> checking for suffix of executables...
> checking whether we are cross compiling... no
> checking for suffix of object files... o
> checking whether we are using the GNU C compiler... yes
> checking whether gcc -std=gnu99 accepts -g... yes
> checking for gcc -std=gnu99 option to accept ISO C89... none needed
> checking how to run the C preprocessor... gcc -std=gnu99 -E
> checking for grep that handles long lines and -e... /bin/grep
> checking for egrep... /bin/grep -E
> checking for ANSI C header files... yes
> checking for sys/types.h... yes
> checking for sys/stat.h... yes
> checking for stdlib.h... yes
> checking for string.h... yes
> checking for memory.h... yes
> checking for strings.h... yes
> checking for inttypes.h... yes
> checking for stdint.h... yes
> checking for unistd.h... yes
> checking gdal.h usability... yes
> checking gdal.h presence... yes
> checking for gdal.h... yes
> checking GDAL: linking with --libs only... yes
> checking GDAL: /usr/share/gdal/2.1/pcs.csv readable... yes
> checking GDAL: checking whether PROJ.4 is available for linking:... yes
> checking GDAL: checking whether PROJ.4 is available fur running:... yes
> checking proj_api.h usability... yes
> checking proj_api.h presence... yes
> checking for proj_api.h... yes
> checking for pj_init_plus in -lproj... yes
> checking PROJ.4: epsg found and readable... yes
> proj_conf_test.c: In function 'main':
> proj_conf_test.c:5:5: error: unknown type name 'PAFile'
>      PAFile fp;
>      ^
> proj_conf_test.c:8:5: warning: implicit declaration of function
> 'pj_open_lib' [-Wimplicit-function-declaration]
>      fp = pj_open_lib(ctx, "conus", "rb");
>      ^
> proj_conf_test.c:9:12: warning: comparison between pointer and integer
> [enabled by default]
>      if (fp == NULL) exit(1);
>             ^
> proj_conf_test.c:10:5: warning: implicit declaration of function
> 'pj_ctx_fclose' [-Wimplicit-function-declaration]
>      pj_ctx_fclose(ctx, fp);
>      ^
> ./configure: line 3834: ./proj_conf_test: No such file or directory
> checking PROJ.4: conus found and readable... yes
> checking geos-config usability... yes
> configure: GEOS: 3.5.0
> checking GEOS version >= 3.3.0... yes
> checking geos_c.h usability... yes
> checking geos_c.h presence... yes
> checking for geos_c.h... yes
> checking geos: linking with -lgeos_c... yes
> checking for lwgeom_version in -llwgeom... no
> configure: error: in `/tmp/RtmpKLmhyt/devtools9fd11eb9c3/edzer-sfr-
> d620f3b':
> configure: error: lwgeom test failed (--without-readline to disable)
> See `config.log' for more details
> ERROR: configuration failed for package ?sf?
> * removing ?/home/mlt244/R/x86_64-pc-linux-gnu-library/3.3/sf?
> * restoring previous ?/home/mlt244/R/x86_64-pc-linux-gnu-library/3.3/sf?
> Error: Command failed (1)
>
>
> On Wed, Mar 15, 2017 at 6:14 PM, Michael Treglia <mtreglia at gmail.com>
> wrote:
>
> > Wow - thanks so much for this quick fix, Edzer! I like your solution to
> > having syntatically different but semantically identical proj4string.
> Will
> > try this in a bit, and write back if I have any issues.
> > Best,
> > mike
> >
> > On Wed, Mar 15, 2017 at 5:58 PM, Edzer Pebesma <
> > edzer.pebesma at uni-muenster.de> wrote:
> >
> >> Great question! Short answer: now solved in the dev version on github;
> >> data are written directly to postgis having epsg 2263.
> >>
> >>
> >> Long answer:
> >>
> >> I believe this was caused by gdal and proj.4 doing different things when
> >> resolving epsg codes to proj4strings. sf uses proj.4 for this. When
> >> writing a proj4string either gdal or postgis don't recognize the
> >> proj4string that proj.4 returns on the epsg code. Neither gdal nor
> >> postgis understand that syntactically different proj4strings may be
> >> semantically identical.
> >>
> >>
> >> After running your example, in postgis
> >>
> >> # select proj4text from spatial_ref_sys where SRID = 900914;
> >>
> >> gives:
> >>
> >>  +proj=lcc +lat_1=41.03333333333333 +lat_2=40.66666666666666
> >> +lat_0=40.16666666666666 +lon_0=-74 +x_0=300000 +y_0=0 +ellps=GRS80
> >> +towgs84=0,0,0,0,0,0,0 +units=us-ft +no_defs
> >>
> >> # select proj4text from spatial_ref_sys where SRID = 2263;
> >>
> >> gives:
> >>
> >>  +proj=lcc +lat_1=41.03333333333333 +lat_2=40.66666666666666
> >> +lat_0=40.16666666666666 +lon_0=-74 +x_0=300000.0000000001 +y_0=0
> >> +datum=NAD83 +units=us-ft +no_defs
> >>
> >> sf causes this:
> >>
> >> > st_crs(2263)
> >> $epsg
> >> [1] 2263
> >>
> >> $proj4string
> >> [1] "+proj=lcc +lat_1=41.03333333333333 +lat_2=40.66666666666666
> >> +lat_0=40.16666666666666 +lon_0=-74 +x_0=300000.0000000001 +y_0=0
> >> +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=us-ft +no_defs"
> >>
> >> attr(,"class")
> >> [1] "crs"
> >>
> >> because it uses proj.4 directly to resolve SRID strings:
> >>
> >> /usr/share/proj/epsg has:
> >>
> >> # NAD83 / New York Long Island (ftUS)
> >> <2263> +proj=lcc +lat_1=41.03333333333333 +lat_2=40.66666666666666
> >> +lat_0=40.16666666666666 +lon_0=-74 +x_0=300000.0000000001 +y_0=0
> >> +datum=NAD83 +units=us-ft +no_defs  <>
> >>
> >>
> >> The change I made to sf (
> >> https://github.com/edzer/sfr/commit/d620f3b748d487bae910e388
> >> 4c554fa9e3ce7090)
> >> now first asks gdal to resolve the epsg (in case it is not NA), and
> >> otherwise resolve the proj4string (if not NA), instead of ONLY trying to
> >> resolve a non-NA proj4string.
> >>
> >> On 15/03/17 20:50, Michael Treglia wrote:
> >> > Hi All,
> >> >
> >> > Been working to import and manipulate a CSV file with point data
> >> > (lat/long), and then export to a PostGIS db.
> >> >
> >> > Overall, successful, but one thing I'd like to fix - when I write out
> >> the
> >> > layer to postgis, the SRID is not maintained. The final EPSG/SRID
> >> should be
> >> > 2263, but when I check in PostGIS, it comes up as 900914.
> >> >
> >> > Below is my code and sessionInfo, and the data are from here:
> >> > https://data.cityofnewyork.us/Public-Safety/NYPD-Complaint-D
> >> ata-Current-YTD/5uac-w243
> >> > (downloaded as plain old CSV)
> >> >
> >> > Anything I might be missing? Thanks in advance for giving a quick
> look!
> >> > Mike
> >> >
> >> >
> >> > ##Start Code
> >> >
> >> > #load packages
> >> > library(sf)
> >> > library(RPostgreSQL)
> >> >
> >> > #read data
> >> > crime_current <- read.csv("NYPD_Complaint_Data_Current_YTD.csv",
> >> > stringsAsFactors = FALSE)
> >> >
> >> > #format time columns for easier reading in postgres (I think), as
> >> keeping
> >> > as date format caused problems in export
> >> > crime_current$CMPLNT_FR_TIME <-
> >> > as.character(as.POSIXct(paste(crime_current$CMPLNT_FR_DT,
> >> > crime_current$CMPLNT_FR_TM), format="%m/%d/%Y\ %H:%M", tz=""))
> >> > crime_current$CMPLNT_TO_TIME <-
> >> > as.character(as.POSIXct(paste(crime_current$CMPLNT_TO_DT,
> >> > crime_current$CMPLNT_TO_TM), format="%m/%d/%Y\ %H:%M", tz=""))
> >> > crime_current$RPT_DT <- as.character(as.POSIXct(crime_current$RPT_DT,
> >> > format="%m/%d/%Y", tz=""))
> >> >
> >> > #convert to sf object
> >> > crime_current.sf <- st_as_sf(crime_current, coords = c("Longitude",
> >> > "Latitude"), crs = 4326)
> >> > #reproject to EPSG 2263
> >> > crime_current.sf <- st_transform(crime_current.sf, crs=2263)
> >> >
> >> > #write to postgres
> >> > st_write(crime_current.sf, "PG:dbname=mydb user=user
> host=xx.xx.xx.xx",
> >> > 'health_safety.crime_current')
> >> > ###End Code
> >> >
> >> >
> >> >
> >> >> sessionInfo()
> >> > R version 3.3.1 (2016-06-21)
> >> > Platform: x86_64-pc-linux-gnu (64-bit)
> >> > Running under: Ubuntu 14.04.5 LTS
> >> >
> >> > locale:
> >> >  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
> >> > LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
> >> >  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
> >> >  LC_PAPER=en_US.UTF-8       LC_NAME=C
> >> >  [9] LC_ADDRESS=C               LC_TELEPHONE=C
> >> > LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C
> >> >
> >> > attached base packages:
> >> > [1] stats     graphics  grDevices utils     datasets  methods   base
> >> >
> >> > other attached packages:
> >> > [1] sp_1.2-3          RPostgreSQL_0.4-1 DBI_0.6           sf_0.3-4
> >> >
> >> > loaded via a namespace (and not attached):
> >> > [1] tools_3.3.1     units_0.4-2     Rcpp_0.12.9     udunits2_0.13
> >> > grid_3.3.1      lattice_0.20-33
> >> >
> >> >       [[alternative HTML version deleted]]
> >> >
> >> > _______________________________________________
> >> > R-sig-Geo mailing list
> >> > R-sig-Geo at r-project.org
> >> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >> >
> >>
> >> --
> >> Edzer Pebesma
> >> Institute for Geoinformatics  (ifgi),  University of M?nster
> >> Heisenbergstra?e 2, 48149 M?nster, Germany; +49 251 83 33081
> >> Journal of Statistical Software:   http://www.jstatsoft.org/
> >> Computers & Geosciences:   http://elsevier.com/locate/cageo/
> >>
> >>
> >> _______________________________________________
> >> R-sig-Geo mailing list
> >> R-sig-Geo at r-project.org
> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >>
> >
> >
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From rameshv at caryinstitute.org  Wed Mar 15 18:21:23 2017
From: rameshv at caryinstitute.org (Vijay Ramesh)
Date: Wed, 15 Mar 2017 13:21:23 -0400
Subject: [R-sig-Geo] Same mask for two rasters,
 but obtaining different extents in R
In-Reply-To: <CAM_vju=vPZod=DnF9XLVZa46asLEPxjK0YtOpC8vVNh+8=-n_w@mail.gmail.com>
References: <CAOGv6M-15T1boTM8NeFaz2Snm1eCfnJaFV=tc3aR-c+9NnB-fQ@mail.gmail.com>
	<CAM_vju=vPZod=DnF9XLVZa46asLEPxjK0YtOpC8vVNh+8=-n_w@mail.gmail.com>
Message-ID: <CAOGv6M_C=ps1K04PdGPG9Y4Lijbtk+nLnpq+AFWGJNt6v3bU0A@mail.gmail.com>

I re-checked the original extent and here it is: This is data obtained from
WorldClim.

> bio5
class       : RasterLayer
dimensions  : 3600, 8640, 31104000  (nrow, ncol, ncell)
resolution  : 0.04166667, 0.04166667  (x, y)
extent      : -180, 180, -60, *90.00001 * (xmin, xmax, ymin, ymax) #This
varies at the 6th decimal place.
coord. ref. : +proj=longlat +ellps=WGS84 +towgs84=0,0,0,0,0,0,0 +no_defs
data source : C:\Users\rameshv\Downloads\Climate
Stability\Data_LGM_Present\Present\1_RawData\bio_5
names       : bio_5
values      : -86, 489  (min, max)
attributes  :
        ID COUNT
 from: -86     1
 to  : 489    38


> lg5
class       : RasterLayer
dimensions  : 3600, 8640, 31104000  (nrow, ncol, ncell)
resolution  : 0.04166667, 0.04166667  (x, y)
extent      : -180, 180, -60, 90  (xmin, xmax, ymin, ymax)
coord. ref. : +proj=longlat +ellps=WGS84 +towgs84=0,0,0,0,0,0,0 +no_defs
data source : C:\Users\rameshv\Downloads\Climate
Stability\Data_LGM_Present\LGM\1_RawData\cclgmbi5.tif
names       : cclgmbi5
values      : -204, 519  (min, max)

What do you suggest?

Also, any suggestions on aligning them before I crop them? I wouldn't want
to projectRaster using one of the rasters, as that creates extra number of
rows (when I coerce the raster to a Spatial Pixels Data Frame).



On Wed, Mar 15, 2017 at 1:13 PM, Sarah Goslee <sarah.goslee at gmail.com>
wrote:

> The most likely explanation seems to me that the rasters were not
> aligned before cropping, so they are not aligned after cropping.
>
> Have you checked the original extent and resolution?
>
> Sarah
>
> On Tue, Mar 14, 2017 at 5:31 PM, Vijay Ramesh via R-sig-Geo
> <r-sig-geo at r-project.org> wrote:
> > I loaded a shapefile in R, and cropped and masked it with the same mask,
> > but I get different extents. Any suggestions?
> >
> > Code below:
> >
> >     library(raster)
> >     library(rgdal)
> >     library(GISTools)
> >     library(sp)
> >     library(maptools)
> >
> >     ##Loading the first mask
> >     Mask <- readOGR("C:\\Users\\rameshv\\Downloads\\Climate
> > Stability\\SPV_Mask\\mask.shp")
> >     proj4string(Mask) <- CRS("+init=epsg:4326")
> >
> >     #Loading the Rasters For Present and LGM and clipping them to the
> right
> > extent
> >     bio5 <- raster("C:\\Users\\rameshv\\Downloads\\Climate
> > Stability\\Data_LGM_Present\\Present\\1_RawData\\bio_5")
> >     proj4string(bio5) <- CRS("+init=epsg:4326")
> >     lg5 <- raster("C:\\Users\\rameshv\\Downloads\\Climate
> > Stability\\Data_LGM_Present\\LGM\\1_RawData\\cclgmbi5.tif")
> >     proj4string(lg5) <- CRS("+init=epsg:4326")
> >
> >     ##Cropping by using the Crop and Mask functions
> >     cr<- crop(bio5, extent(Mask))
> >     bio5 <- mask(cr, Mask)
> >
> >     cr2<- crop(lg5, extent(Mask))
> >     lg5<- mask(cr2, Mask)
> >
> >     > bio5
> >      class       : RasterLayer
> >      dimensions  : 339, 246, 83394  (nrow, ncol, ncell)
> >      resolution  : 0.04166667, 0.04166667  (x, y)
> >      extent      : 72.45835, 82.70835, 8.083337, 22.20834  (xmin, xmax,
> > ymin, ymax)
> >      coord. ref. : +init=epsg:4326 +proj=longlat +datum=WGS84 +no_defs
> > +ellps=WGS84 +towgs84=0,0,0
> >      data source : in memory
> >      names       : bio_5
> >      values      : 207, 432  (min, max)
> >      attributes  :
> >         ID COUNT
> >      from: -86     1
> >      to  : 489    38
> >
> >      > lg5
> >      class       : RasterLayer
> >      dimensions  : 339, 246, 83394  (nrow, ncol, ncell)
> >      resolution  : 0.04166667, 0.04166667  (x, y)
> >      extent      : 72.45833, 82.70833, 8.083333, 22.20833  (xmin, xmax,
> > ymin, ymax)
> >      coord. ref. : +init=epsg:4326 +proj=longlat +datum=WGS84 +no_defs
> > +ellps=WGS84 +towgs84=0,0,0
> >      data source : in memory
> >      names       : cclgmbi5
> >      values      : 187, 392  (min, max)
> >
> >
>
> --
> Sarah Goslee
> http://www.functionaldiversity.org
>



-- 
Data Manager,
Barbara Han Lab,
Cary Institute of Ecosystem Studies,
2801 Sharon Turnpike, Millbrook, NY 12545
Lab Site : http://www.hanlab.science/
Personal Site : http://evolecol.weebly.com/
Phone : (845)-677-7600 Ext: 241

	[[alternative HTML version deleted]]


From jmjosedominguez at yahoo.es  Wed Mar 15 18:43:58 2017
From: jmjosedominguez at yahoo.es (=?utf-8?Q?Juanma_Jos=C3=A9?=)
Date: Thu, 16 Mar 2017 00:43:58 +0700
Subject: [R-sig-Geo] Getis Ord G test in 3 dimensions
Message-ID: <FE46E35D-50DB-457B-B21D-E4FF7F9F64FB@yahoo.es>

> Dear all

> I am working on a 3D home range estimator, we want to calculated home ranges and core areas on primates that were followed sleeping site to sleeping site. We collected GPS locations and animals height at equal intervals along the day. 
> We already calculates home ranges and core area in 2D using Delaunay triangulation and then applying a hot spot analysis in ArcGis( Getis Ord G*) using the perimeter of the triangles. Then, to calculate it on 3D we first created a 3D convex hull formed by tetrahedrons using animals locations (coordinates in meters)  and height.

> we are wondering if it is possible to use the function Local G or Global G test (package Spdep) for 3D locatios (X,Y,Z) as we previously  did in 2D (Hotspot with rendering, ArgGis)

Thanks in advance
> 
> 
> Juanma 
                        
 
Juan Manuel Jos? Dom?nguez
Postdoctoral Researcher         
                                                  
Conservation Ecology Program
School of Bioresources & Technology
King Mongkut?s University of Technology Thonburi

49 Soi Tienthalay 25
Bangkhuntien-Chaithalay Road
Thakham, Bangkhuntien
Bangkok 10150
Thailand
http://cons-ecol-kmutt.weebly.com/
	[[alternative HTML version deleted]]


From edzer.pebesma at uni-muenster.de  Thu Mar 16 10:06:42 2017
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Thu, 16 Mar 2017 10:06:42 +0100
Subject: [R-sig-Geo] Maintain SRID with st_write to postgis db
In-Reply-To: <CAASFQpS6sHCSoCb6nN1nZQk=34wk_v7vqypWgGwpXhk3-tUaNQ@mail.gmail.com>
References: <CAPKp32stHJ6d1smgTf6Y2pA+w=1khGcc1UmyUDgSo3mfs+DPsA@mail.gmail.com>
	<cc3d05b8-3f90-e861-c130-8364bf0e7e62@uni-muenster.de>
	<CAPKp32uLVs+WyBj+PZJiNcCCAfiEURMQFKubWs7qwpMUYETG5Q@mail.gmail.com>
	<CAPKp32t88vqbg60+tHNQF82CdW4YBFBDpWbdYF_FgV+9Y=nHBw@mail.gmail.com>
	<CAASFQpS6sHCSoCb6nN1nZQk=34wk_v7vqypWgGwpXhk3-tUaNQ@mail.gmail.com>
Message-ID: <04e27abf-24db-a04f-3738-69f47ac4f4b7@uni-muenster.de>

Mike, Chris, the configure step should now pass regardless whether
liblwgeom is present, or not; the error message was my mistake.

sf will link to liblwgeom when its development version is present (on
ubuntu: liblwgeom-dev). If postgis is binary installed, liblwgeom may be
present, but not its dev version (needed for header files); that case is
now being caught too.

liblwgeom provides st_make_valid, essentially ST_makeValid in postgis;
see https://github.com/edzer/sfr/issues/67 . Since liblwgeom is not
available on the CRAN build farms, it's presence is not required by sf.

Best regards,

On 16/03/17 05:46, chris english wrote:
> Michael,
> 
> I have the very same failure, 
>> library(sf)
> Linking to GEOS 3.4.2, GDAL 2.1.3, proj.4 4.9.1
> (pre upgrade attempt, which still works just fine)
> 
> checking for geos_c.h... yes
> checking geos: linking with -lgeos_c... yes
> checking for lwgeom_version in -llwgeom... no
> configure: error: in `/tmp/RtmpsCmf6B/devtoolsd68e68107a/edzer-sfr-d620f3b':
> configure: error: lwgeom test failed (--without-readline to disable)
> 
> I could nearly copy your install output though on 16.04, and the same
> tangle of it depends on x but it won't be installed & etc. 
> But, if you have PostGIS, you have liblwgeom as it is fairly specific to
> PostGIS. Perhaps, rather than a devtools::github_install,
> a clone github lo a local directory and config, make, install might
> work, but I'm just imagining. 
> 
> then testing:
> config.log --snip --
> configure:3993: checking for lwgeom_version in -llwgeom
> configure:4018: gcc -std=gnu99 -o conftest -g -O2 -fstack-protector
> --param=ssp-
> buffer-size=4 -Wformat -Werror=format-security -D_FORTIFY_SOURCE=2 -g
>  -I/usr/lo
> cal/include   -I/usr/local/include -I/usr/local/include
> -Wl,-Bsymbolic-functions
>  -Wl,-z,relro conftest.c -llwgeom  -lproj  -L/usr/local/lib -lproj  
> -L/usr/loca
> l/lib -lgdal -L/usr/local/lib -lgeos_c -lproj >&5
> /tmp/ccDBUh1h.o: In function `main':
> /home/chris/sfr/sfr/conftest.c:34: undefined reference to `lwgeom_version'
> collect2: error: ld returned 1 exit status
> configure:4018: $? = 1
> configure: failed program was:
> | /* confdefs.h */
> | #define PACKAGE_NAME ""
> | #define PACKAGE_TARNAME ""
> | #define PACKAGE_VERSION ""
> | #define PACKAGE_STRING ""
> | #define PACKAGE_BUGREPORT ""
> | #define PACKAGE_URL ""
> | #define STDC_HEADERS 1
> | #define HAVE_SYS_TYPES_H 1
> | #define HAVE_SYS_STAT_H 1
> | #define HAVE_STDLIB_H 1
> | #define HAVE_STRING_H 1
> | #define HAVE_MEMORY_H 1
> | #define HAVE_STRINGS_H 1
> | #define HAVE_INTTYPES_H 1
> | #define HAVE_STDINT_H 1
> | #define HAVE_UNISTD_H 1
> | #define HAVE_GDAL_H 1
> | #define HAVE_PROJ_API_H 1
> | #define HAVE_LIBPROJ 1
> | #define HAVE_GEOS_C_H 1
> | /* end confdefs.h.  */
> | 
> | /* Override any GCC internal prototype to avoid an error.
> |    Use char because int might match the return type of a GCC
> |    builtin and then its argument prototype would still apply.  */
> | #ifdef __cplusplus
> | extern "C"
> | #endif
> | char lwgeom_version ();
> | int
> | main ()
> | {
> | return lwgeom_version ();
> |   ;
> |   return 0;
> | }
> configure:4027: result: no
> configure:4036: error: in `/home/chris/sfr/sfr':
> configure:4038: error: lwgeom test failed (--without-readline to disable)
> See `config.log' for more details
> 
> so, it may or may not be the presence or absence of liblwgeom but simply
> an undefined reference as suggested above:
> 
> /home/chris/sfr/sfr/conftest.c:34: undefined reference to `lwgeom_version' ,
> 
> but I'm unclear how the version was being requested (well, I can kind of
> guess)
> but failing on undefined reference suggests it is not the version per se
> that may
> or may not be present (though is because you are using PostGIS), but how
> the version was requested. I intuit.
> 
> Ah, and reading  /* confdefs.h */, that it indeed ends with #define
> HAVE_GEOS_C_H 1,
> and indeed, conftest.c:34: would have an  undefined reference to
> `lwgeom_version'. 
> 
> And I've said as much as I understand.
> 
> Chris
> 
> On Wed, Mar 15, 2017 at 7:53 PM, Michael Treglia <mtreglia at gmail.com
> <mailto:mtreglia at gmail.com>> wrote:
> 
>     Sorry - this follow-up isn't entirely an R question, so if best to take
>     this off list, let me know:
> 
>     Installing the dev version from github fails for me (installing on
>     ubuntu
>     14.04.5) - I've included the output from the install process below -
>     seems
>     to fail due to failed check for liblwgeom version.
> 
>     Looks like I don't have liblwgeom installed - and when I try (via sudo
>     apt-get install liblwgeom-2.3-0), it indicates it requires libgeos-c1.
>     Installing libgeos-c1, however, requires removal of a newer version of
>     libgeos (libgeos-c1v5), which other FOSS GIS tools depend on (at
>     least if
>     my understanding is correct).  Is there a way around this?  Sorry if I'm
>     just missing something, and thanks again for input.
>     mike
> 
> 
> 
>     #Output of install from github
>     > install_github("edzer/sfr")
>     Downloading GitHub repo edzer/sfr at master
>     from URL https://api.github.com/repos/edzer/sfr/zipball/master
>     <https://api.github.com/repos/edzer/sfr/zipball/master>
>     Installing sf
>     '/usr/lib/R/bin/R' --no-site-file --no-environ --no-save --no-restore
>     --quiet  \
>       CMD INSTALL '/tmp/RtmpKLmhyt/devtools9fd11eb9c3/edzer-sfr-d620f3b'  \
>       --library='/home/mlt244/R/x86_64-pc-linux-gnu-library/3.3'
>     --install-tests
> 
>     * installing *source* package ?sf? ...
>     configure: CC: gcc -std=gnu99
>     configure: CXX: g++
>     configure: :
>     checking for gdal-config... /usr/bin/gdal-config
>     checking gdal-config usability... yes
>     configure: GDAL: 2.1.0
>     checking GDAL version >= 2.0.0... yes
>     checking for gcc... gcc -std=gnu99
>     checking whether the C compiler works... yes
>     checking for C compiler default output file name... a.out
>     checking for suffix of executables...
>     checking whether we are cross compiling... no
>     checking for suffix of object files... o
>     checking whether we are using the GNU C compiler... yes
>     checking whether gcc -std=gnu99 accepts -g... yes
>     checking for gcc -std=gnu99 option to accept ISO C89... none needed
>     checking how to run the C preprocessor... gcc -std=gnu99 -E
>     checking for grep that handles long lines and -e... /bin/grep
>     checking for egrep... /bin/grep -E
>     checking for ANSI C header files... yes
>     checking for sys/types.h... yes
>     checking for sys/stat.h... yes
>     checking for stdlib.h... yes
>     checking for string.h... yes
>     checking for memory.h... yes
>     checking for strings.h... yes
>     checking for inttypes.h... yes
>     checking for stdint.h... yes
>     checking for unistd.h... yes
>     checking gdal.h usability... yes
>     checking gdal.h presence... yes
>     checking for gdal.h... yes
>     checking GDAL: linking with --libs only... yes
>     checking GDAL: /usr/share/gdal/2.1/pcs.csv readable... yes
>     checking GDAL: checking whether PROJ.4 is available for linking:... yes
>     checking GDAL: checking whether PROJ.4 is available fur running:... yes
>     checking proj_api.h usability... yes
>     checking proj_api.h presence... yes
>     checking for proj_api.h... yes
>     checking for pj_init_plus in -lproj... yes
>     checking PROJ.4: epsg found and readable... yes
>     proj_conf_test.c: In function 'main':
>     proj_conf_test.c:5:5: error: unknown type name 'PAFile'
>          PAFile fp;
>          ^
>     proj_conf_test.c:8:5: warning: implicit declaration of function
>     'pj_open_lib' [-Wimplicit-function-declaration]
>          fp = pj_open_lib(ctx, "conus", "rb");
>          ^
>     proj_conf_test.c:9:12: warning: comparison between pointer and integer
>     [enabled by default]
>          if (fp == NULL) exit(1);
>                 ^
>     proj_conf_test.c:10:5: warning: implicit declaration of function
>     'pj_ctx_fclose' [-Wimplicit-function-declaration]
>          pj_ctx_fclose(ctx, fp);
>          ^
>     ./configure: line 3834: ./proj_conf_test: No such file or directory
>     checking PROJ.4: conus found and readable... yes
>     checking geos-config usability... yes
>     configure: GEOS: 3.5.0
>     checking GEOS version >= 3.3.0... yes
>     checking geos_c.h usability... yes
>     checking geos_c.h presence... yes
>     checking for geos_c.h... yes
>     checking geos: linking with -lgeos_c... yes
>     checking for lwgeom_version in -llwgeom... no
>     configure: error: in
>     `/tmp/RtmpKLmhyt/devtools9fd11eb9c3/edzer-sfr-d620f3b':
>     configure: error: lwgeom test failed (--without-readline to disable)
>     See `config.log' for more details
>     ERROR: configuration failed for package ?sf?
>     * removing ?/home/mlt244/R/x86_64-pc-linux-gnu-library/3.3/sf?
>     * restoring previous ?/home/mlt244/R/x86_64-pc-linux-gnu-library/3.3/sf?
>     Error: Command failed (1)
> 
> 
>     On Wed, Mar 15, 2017 at 6:14 PM, Michael Treglia <mtreglia at gmail.com
>     <mailto:mtreglia at gmail.com>> wrote:
> 
>     > Wow - thanks so much for this quick fix, Edzer! I like your
>     solution to
>     > having syntatically different but semantically identical
>     proj4string. Will
>     > try this in a bit, and write back if I have any issues.
>     > Best,
>     > mike
>     >
>     > On Wed, Mar 15, 2017 at 5:58 PM, Edzer Pebesma <
>     > edzer.pebesma at uni-muenster.de
>     <mailto:edzer.pebesma at uni-muenster.de>> wrote:
>     >
>     >> Great question! Short answer: now solved in the dev version on
>     github;
>     >> data are written directly to postgis having epsg 2263.
>     >>
>     >>
>     >> Long answer:
>     >>
>     >> I believe this was caused by gdal and proj.4 doing different
>     things when
>     >> resolving epsg codes to proj4strings. sf uses proj.4 for this. When
>     >> writing a proj4string either gdal or postgis don't recognize the
>     >> proj4string that proj.4 returns on the epsg code. Neither gdal nor
>     >> postgis understand that syntactically different proj4strings may be
>     >> semantically identical.
>     >>
>     >>
>     >> After running your example, in postgis
>     >>
>     >> # select proj4text from spatial_ref_sys where SRID = 900914;
>     >>
>     >> gives:
>     >>
>     >>  +proj=lcc +lat_1=41.03333333333333 +lat_2=40.66666666666666
>     >> +lat_0=40.16666666666666 +lon_0=-74 +x_0=300000 +y_0=0 +ellps=GRS80
>     >> +towgs84=0,0,0,0,0,0,0 +units=us-ft +no_defs
>     >>
>     >> # select proj4text from spatial_ref_sys where SRID = 2263;
>     >>
>     >> gives:
>     >>
>     >>  +proj=lcc +lat_1=41.03333333333333 +lat_2=40.66666666666666
>     >> +lat_0=40.16666666666666 +lon_0=-74 +x_0=300000.0000000001 +y_0=0
>     >> +datum=NAD83 +units=us-ft +no_defs
>     >>
>     >> sf causes this:
>     >>
>     >> > st_crs(2263)
>     >> $epsg
>     >> [1] 2263
>     >>
>     >> $proj4string
>     >> [1] "+proj=lcc +lat_1=41.03333333333333 +lat_2=40.66666666666666
>     >> +lat_0=40.16666666666666 +lon_0=-74 +x_0=300000.0000000001 +y_0=0
>     >> +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=us-ft +no_defs"
>     >>
>     >> attr(,"class")
>     >> [1] "crs"
>     >>
>     >> because it uses proj.4 directly to resolve SRID strings:
>     >>
>     >> /usr/share/proj/epsg has:
>     >>
>     >> # NAD83 / New York Long Island (ftUS)
>     >> <2263> +proj=lcc +lat_1=41.03333333333333 +lat_2=40.66666666666666
>     >> +lat_0=40.16666666666666 +lon_0=-74 +x_0=300000.0000000001 +y_0=0
>     >> +datum=NAD83 +units=us-ft +no_defs  <>
>     >>
>     >>
>     >> The change I made to sf (
>     >> https://github.com/edzer/sfr/commit/d620f3b748d487bae910e388
>     <https://github.com/edzer/sfr/commit/d620f3b748d487bae910e388>
>     >> 4c554fa9e3ce7090)
>     >> now first asks gdal to resolve the epsg (in case it is not NA), and
>     >> otherwise resolve the proj4string (if not NA), instead of ONLY
>     trying to
>     >> resolve a non-NA proj4string.
>     >>
>     >> On 15/03/17 20:50, Michael Treglia wrote:
>     >> > Hi All,
>     >> >
>     >> > Been working to import and manipulate a CSV file with point data
>     >> > (lat/long), and then export to a PostGIS db.
>     >> >
>     >> > Overall, successful, but one thing I'd like to fix - when I
>     write out
>     >> the
>     >> > layer to postgis, the SRID is not maintained. The final EPSG/SRID
>     >> should be
>     >> > 2263, but when I check in PostGIS, it comes up as 900914.
>     >> >
>     >> > Below is my code and sessionInfo, and the data are from here:
>     >> > https://data.cityofnewyork.us/Public-Safety/NYPD-Complaint-D
>     <https://data.cityofnewyork.us/Public-Safety/NYPD-Complaint-D>
>     >> ata-Current-YTD/5uac-w243
>     >> > (downloaded as plain old CSV)
>     >> >
>     >> > Anything I might be missing? Thanks in advance for giving a
>     quick look!
>     >> > Mike
>     >> >
>     >> >
>     >> > ##Start Code
>     >> >
>     >> > #load packages
>     >> > library(sf)
>     >> > library(RPostgreSQL)
>     >> >
>     >> > #read data
>     >> > crime_current <- read.csv("NYPD_Complaint_Data_Current_YTD.csv",
>     >> > stringsAsFactors = FALSE)
>     >> >
>     >> > #format time columns for easier reading in postgres (I think), as
>     >> keeping
>     >> > as date format caused problems in export
>     >> > crime_current$CMPLNT_FR_TIME <-
>     >> > as.character(as.POSIXct(paste(crime_current$CMPLNT_FR_DT,
>     >> > crime_current$CMPLNT_FR_TM), format="%m/%d/%Y\ %H:%M", tz=""))
>     >> > crime_current$CMPLNT_TO_TIME <-
>     >> > as.character(as.POSIXct(paste(crime_current$CMPLNT_TO_DT,
>     >> > crime_current$CMPLNT_TO_TM), format="%m/%d/%Y\ %H:%M", tz=""))
>     >> > crime_current$RPT_DT <-
>     as.character(as.POSIXct(crime_current$RPT_DT,
>     >> > format="%m/%d/%Y", tz=""))
>     >> >
>     >> > #convert to sf object
>     >> > crime_current.sf <- st_as_sf(crime_current, coords = c("Longitude",
>     >> > "Latitude"), crs = 4326)
>     >> > #reproject to EPSG 2263
>     >> > crime_current.sf <- st_transform(crime_current.sf, crs=2263)
>     >> >
>     >> > #write to postgres
>     >> > st_write(crime_current.sf, "PG:dbname=mydb user=user
>     host=xx.xx.xx.xx",
>     >> > 'health_safety.crime_current')
>     >> > ###End Code
>     >> >
>     >> >
>     >> >
>     >> >> sessionInfo()
>     >> > R version 3.3.1 (2016-06-21)
>     >> > Platform: x86_64-pc-linux-gnu (64-bit)
>     >> > Running under: Ubuntu 14.04.5 LTS
>     >> >
>     >> > locale:
>     >> >  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
>     >> > LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
>     >> >  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
>     >> >  LC_PAPER=en_US.UTF-8       LC_NAME=C
>     >> >  [9] LC_ADDRESS=C               LC_TELEPHONE=C
>     >> > LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C
>     >> >
>     >> > attached base packages:
>     >> > [1] stats     graphics  grDevices utils     datasets  methods 
>      base
>     >> >
>     >> > other attached packages:
>     >> > [1] sp_1.2-3          RPostgreSQL_0.4-1 DBI_0.6           sf_0.3-4
>     >> >
>     >> > loaded via a namespace (and not attached):
>     >> > [1] tools_3.3.1     units_0.4-2     Rcpp_0.12.9     udunits2_0.13
>     >> > grid_3.3.1      lattice_0.20-33
>     >> >
>     >> >       [[alternative HTML version deleted]]
>     >> >
>     >> > _______________________________________________
>     >> > R-sig-Geo mailing list
>     >> > R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
>     >> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>     <https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
>     >> >
>     >>
>     >> --
>     >> Edzer Pebesma
>     >> Institute for Geoinformatics  (ifgi),  University of M?nster
>     >> Heisenbergstra?e 2, 48149 M?nster, Germany; +49 251 83 33081
>     <tel:%2B49%20251%2083%2033081>
>     >> Journal of Statistical Software:   http://www.jstatsoft.org/
>     >> Computers & Geosciences:   http://elsevier.com/locate/cageo/
>     <http://elsevier.com/locate/cageo/>
>     >>
>     >>
>     >> _______________________________________________
>     >> R-sig-Geo mailing list
>     >> R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
>     >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>     <https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
>     >>
>     >
>     >
> 
>             [[alternative HTML version deleted]]
> 
>     _______________________________________________
>     R-sig-Geo mailing list
>     R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
>     https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>     <https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
> 
> 

-- 
Edzer Pebesma
Institute for Geoinformatics  (ifgi),  University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany; +49 251 83 33081
Journal of Statistical Software:   http://www.jstatsoft.org/
Computers & Geosciences:   http://elsevier.com/locate/cageo/

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 473 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20170316/ee95e8c1/attachment.bin>

From castrog.miguelg at gmail.com  Thu Mar 16 13:02:58 2017
From: castrog.miguelg at gmail.com (=?utf-8?Q?Miguel_Castro_G=C3=B3mez?=)
Date: Thu, 16 Mar 2017 13:02:58 +0100
Subject: [R-sig-Geo] Sentienl 2 gdal translate
In-Reply-To: <573be8a5-7ff1-03d1-4ab6-9f841db0941a@conabio.gob.mx>
References: <F3B5A4AE-F1CC-4A9A-BCC0-FD18B6F74ECB@gmail.com>
	<573be8a5-7ff1-03d1-4ab6-9f841db0941a@conabio.gob.mx>
Message-ID: <2F972073-5F50-4BF6-8383-E28C300F47B5@gmail.com>

Hi Lo?c,

I have tried your code but it does not work yet. It just produces one tif file for the first band but this file is not correct (8 kb just). The R process keep working for a long time without any other output

Here are the versions I?m using

R version: 3.3.2
gdalUtils: v 2.0.1.7
raster: 2.5-8
gdal: 2.1.2, released 2016/10/24

When checking for the sentinel 2 driver in gdal (see red)

 gdal-config --formats | grep sentinel2
gxf gtiff hfa aigrid aaigrid ceos ceos2 iso8211 xpm sdts raw dted mem jdem envisat elas fit vrt usgsdem l1b nitf bmp airsar rs2 ilwis rmf leveller sgi srtmhgt idrisi gsg ingr ers jaxapalsar dimap gff cosar pds adrg coasp tsx terragen blx msgn til r northwood saga xyz hf2 kmlsuperoverlay ctg e00grid zmap ngsgeoid iris map cals safe sentinel2 mrf webp wcs wms plmosaic wmts dods grib bsb openjpeg jpeg2000 netcdf hdf5 hdf4 ogdi gif jpeg gta png pcraster fits pcidsk rik ozi rasterlite mbtiles postgisraster arg

I think the problem is the driver that is used to manage the jp2 file. Any idea how can I include in the R code the --config GDAL_SKIP JP2ECW option. 

Cheers,
M

> El 15 mar 2017, a las 23:13, Lo?c Dutrieux <loic.dutrieux at conabio.gob.mx> escribi?:
> 
> Hi,
> 
> I tried your code with some S2 images I had lying around, and it works
> on my system. I modified it a bit to write the output layers to the same
> directory and not to my working directory.
> 
> library(gdalUtils)
> library(raster)
> 
> Image_Path<-'/path/to/images/'
> 
> S2_JP2_List <- list.files(Image_Path, full.names = TRUE, pattern = ".jp2$")
> 
> for (file in S2_JP2_List) {
>  out_file <- extension(file, 'tif')
>  gdal_translate(src_dataset = file, dst_dataset = out_file, ot =
> "UInt16", of = "GTiff")
> }
> 
> gdal has a sentinel 2 driver, but it's not extremely old, therefore it's
> possible that your installation doesn't have it; you can check with:
> 
> gdal-config --formats | grep sentinel2
> 
> Cheers,
> Lo?c
> 
> 
> 
> On 15/03/17 12:49, Miguel Castro G?mez wrote:
>> Hi,
>> 
>> I have Sentinel 2 images (jp2) that I want to convert to GTiff using gdal_translate in R (from gdalutils package). Here is the code I?m using
>> 
>> Image_Path<-?/path/to/wd?
>> 
>> S2_JP2_List <- list.files(Image_Path, full.names = TRUE, pattern = ".jp2$")
>> 
>> for (i in 1:length(S2_JP2_List)) {
>> gdal_translate(src_dataset = S2_JP2_List[[i]], dst_dataset = paste("Band", i , "tif"), ot = "UInt16", of = ?GTiff")
>>    }
>> 
>> When running this code, the process starts without any error but its never ending neither producing any output
>> 
>> I've tried to do it in gdal and the same code works, except that it is necessary to skip  the default driver since it cannot manage large jp2 files. 
>> 
>> gdal_translate -of GTiff /path/to/input/S2_b1.jp2  /path/to/output/S2_b1converted.tif --config GDAL_SKIP JP2ECW
>> 
>> Any idea how could I run this in R?
>> 
>> Thanks 
>> M
>> 
>> 
>> 
>> 	[[alternative HTML version deleted]]
>> 
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> 
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


	[[alternative HTML version deleted]]


From Roger.Bivand at nhh.no  Thu Mar 16 09:58:54 2017
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 16 Mar 2017 09:58:54 +0100
Subject: [R-sig-Geo] Getis Ord G test in 3 dimensions
In-Reply-To: <FE46E35D-50DB-457B-B21D-E4FF7F9F64FB@yahoo.es>
References: <FE46E35D-50DB-457B-B21D-E4FF7F9F64FB@yahoo.es>
Message-ID: <alpine.LFD.2.20.1703160954400.21930@reclus.nhh.no>

On Wed, 15 Mar 2017, Juanma Jos? via R-sig-Geo wrote:

>> Dear all
>
>> I am working on a 3D home range estimator, we want to calculated home 
>> ranges and core areas on primates that were followed sleeping site to 
>> sleeping site. We collected GPS locations and animals height at equal 
>> intervals along the day. We already calculates home ranges and core 
>> area in 2D using Delaunay triangulation and then applying a hot spot 
>> analysis in ArcGis( Getis Ord G*) using the perimeter of the triangles. 
>> Then, to calculate it on 3D we first created a 3D convex hull formed by 
>> tetrahedrons using animals locations (coordinates in meters)  and 
>> height.
>
>> we are wondering if it is possible to use the function Local G or 
>> Global G test (package Spdep) for 3D locatios (X,Y,Z) as we previously 
>> did in 2D (Hotspot with rendering, ArgGis)

I replied to this off-list, but the OP hasn't taken my points into 
account:

Please note that hotspots are often seriously misleading unless missing 
values have been taken into account. For instance in your case, the 
presence of a predator may lead to clustering of prey birds in 3D, or 
insect-eating birds will cluster in voxels with higher insect densities. 
The case appears to be 2.5D, not 3D, which will undoubtedly affect 
the absence of hotspots underground.

Getis G/G* is a 2D measure, so you'd first have to show that the same 
statistical properties apply to 3D. Really you need 4D as time is crucial. 
My guess is that kernel densities generalize better than LISA, and there 
are better non-parametric statistical bases for carrying out inference 
from 3D kernels. There are quite a lot of R contributed packages providing 
KDE techniques: http://vita.had.co.nz/papers/density-estimation.pdf - in 
the listing you can see the #D. Choosing bandwidths is like choosing 
distance rings for G* but better founded. Note that many homerange 
estimators use a form of KDE, I think.

Please also see spatstat and its book. G* is probably not what you should 
be using.

Hope this clarifies,

Roger



>
> Thanks in advance
>> 
>> 
>> Juanma
> 
> 
> Juan Manuel Jos? Dom?nguez
> Postdoctoral Researcher
> 
> Conservation Ecology Program
> School of Bioresources & Technology
> King Mongkut?s University of Technology Thonburi
>
> 49 Soi Tienthalay 25
> Bangkhuntien-Chaithalay Road
> Thakham, Bangkhuntien
> Bangkok 10150
> Thailand
> http://cons-ecol-kmutt.weebly.com/
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
Editor-in-Chief of The R Journal, https://journal.r-project.org/index.html
http://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
http://depsy.org/person/444584

From btupper at bigelow.org  Thu Mar 16 11:52:40 2017
From: btupper at bigelow.org (Ben Tupper)
Date: Thu, 16 Mar 2017 06:52:40 -0400
Subject: [R-sig-Geo] Same mask for two rasters,
	but obtaining different extents in R
In-Reply-To: <CAOGv6M_C=ps1K04PdGPG9Y4Lijbtk+nLnpq+AFWGJNt6v3bU0A@mail.gmail.com>
References: <CAOGv6M-15T1boTM8NeFaz2Snm1eCfnJaFV=tc3aR-c+9NnB-fQ@mail.gmail.com>
	<CAM_vju=vPZod=DnF9XLVZa46asLEPxjK0YtOpC8vVNh+8=-n_w@mail.gmail.com>
	<CAOGv6M_C=ps1K04PdGPG9Y4Lijbtk+nLnpq+AFWGJNt6v3bU0A@mail.gmail.com>
Message-ID: <C7694168-5D57-4884-AA08-80EACC618005@bigelow.org>

Hi,

In the short term you could use raster::alignExtent() to get align bio5 to the the extent of lg5.  

I would also inspect the source of your data and compare it to your locally stored copy of it.  If they are different then it would be worthwhile to review the steps you used to download, manipulate and store it.

Cheers,
Ben 

 
> On Mar 15, 2017, at 1:21 PM, Vijay Ramesh via R-sig-Geo <r-sig-geo at r-project.org> wrote:
> 
> I re-checked the original extent and here it is: This is data obtained from
> WorldClim.
> 
>> bio5
> class       : RasterLayer
> dimensions  : 3600, 8640, 31104000  (nrow, ncol, ncell)
> resolution  : 0.04166667, 0.04166667  (x, y)
> extent      : -180, 180, -60, *90.00001 * (xmin, xmax, ymin, ymax) #This
> varies at the 6th decimal place.
> coord. ref. : +proj=longlat +ellps=WGS84 +towgs84=0,0,0,0,0,0,0 +no_defs
> data source : C:\Users\rameshv\Downloads\Climate
> Stability\Data_LGM_Present\Present\1_RawData\bio_5
> names       : bio_5
> values      : -86, 489  (min, max)
> attributes  :
>        ID COUNT
> from: -86     1
> to  : 489    38
> 
> 
>> lg5
> class       : RasterLayer
> dimensions  : 3600, 8640, 31104000  (nrow, ncol, ncell)
> resolution  : 0.04166667, 0.04166667  (x, y)
> extent      : -180, 180, -60, 90  (xmin, xmax, ymin, ymax)
> coord. ref. : +proj=longlat +ellps=WGS84 +towgs84=0,0,0,0,0,0,0 +no_defs
> data source : C:\Users\rameshv\Downloads\Climate
> Stability\Data_LGM_Present\LGM\1_RawData\cclgmbi5.tif
> names       : cclgmbi5
> values      : -204, 519  (min, max)
> 
> What do you suggest?
> 
> Also, any suggestions on aligning them before I crop them? I wouldn't want
> to projectRaster using one of the rasters, as that creates extra number of
> rows (when I coerce the raster to a Spatial Pixels Data Frame).
> 
> 
> 
> On Wed, Mar 15, 2017 at 1:13 PM, Sarah Goslee <sarah.goslee at gmail.com>
> wrote:
> 
>> The most likely explanation seems to me that the rasters were not
>> aligned before cropping, so they are not aligned after cropping.
>> 
>> Have you checked the original extent and resolution?
>> 
>> Sarah
>> 
>> On Tue, Mar 14, 2017 at 5:31 PM, Vijay Ramesh via R-sig-Geo
>> <r-sig-geo at r-project.org> wrote:
>>> I loaded a shapefile in R, and cropped and masked it with the same mask,
>>> but I get different extents. Any suggestions?
>>> 
>>> Code below:
>>> 
>>>    library(raster)
>>>    library(rgdal)
>>>    library(GISTools)
>>>    library(sp)
>>>    library(maptools)
>>> 
>>>    ##Loading the first mask
>>>    Mask <- readOGR("C:\\Users\\rameshv\\Downloads\\Climate
>>> Stability\\SPV_Mask\\mask.shp")
>>>    proj4string(Mask) <- CRS("+init=epsg:4326")
>>> 
>>>    #Loading the Rasters For Present and LGM and clipping them to the
>> right
>>> extent
>>>    bio5 <- raster("C:\\Users\\rameshv\\Downloads\\Climate
>>> Stability\\Data_LGM_Present\\Present\\1_RawData\\bio_5")
>>>    proj4string(bio5) <- CRS("+init=epsg:4326")
>>>    lg5 <- raster("C:\\Users\\rameshv\\Downloads\\Climate
>>> Stability\\Data_LGM_Present\\LGM\\1_RawData\\cclgmbi5.tif")
>>>    proj4string(lg5) <- CRS("+init=epsg:4326")
>>> 
>>>    ##Cropping by using the Crop and Mask functions
>>>    cr<- crop(bio5, extent(Mask))
>>>    bio5 <- mask(cr, Mask)
>>> 
>>>    cr2<- crop(lg5, extent(Mask))
>>>    lg5<- mask(cr2, Mask)
>>> 
>>>> bio5
>>>     class       : RasterLayer
>>>     dimensions  : 339, 246, 83394  (nrow, ncol, ncell)
>>>     resolution  : 0.04166667, 0.04166667  (x, y)
>>>     extent      : 72.45835, 82.70835, 8.083337, 22.20834  (xmin, xmax,
>>> ymin, ymax)
>>>     coord. ref. : +init=epsg:4326 +proj=longlat +datum=WGS84 +no_defs
>>> +ellps=WGS84 +towgs84=0,0,0
>>>     data source : in memory
>>>     names       : bio_5
>>>     values      : 207, 432  (min, max)
>>>     attributes  :
>>>        ID COUNT
>>>     from: -86     1
>>>     to  : 489    38
>>> 
>>>> lg5
>>>     class       : RasterLayer
>>>     dimensions  : 339, 246, 83394  (nrow, ncol, ncell)
>>>     resolution  : 0.04166667, 0.04166667  (x, y)
>>>     extent      : 72.45833, 82.70833, 8.083333, 22.20833  (xmin, xmax,
>>> ymin, ymax)
>>>     coord. ref. : +init=epsg:4326 +proj=longlat +datum=WGS84 +no_defs
>>> +ellps=WGS84 +towgs84=0,0,0
>>>     data source : in memory
>>>     names       : cclgmbi5
>>>     values      : 187, 392  (min, max)
>>> 
>>> 
>> 
>> --
>> Sarah Goslee
>> http://www.functionaldiversity.org
>> 
> 
> 
> 
> -- 
> Data Manager,
> Barbara Han Lab,
> Cary Institute of Ecosystem Studies,
> 2801 Sharon Turnpike, Millbrook, NY 12545
> Lab Site : http://www.hanlab.science/
> Personal Site : http://evolecol.weebly.com/
> Phone : (845)-677-7600 Ext: 241
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

Ben Tupper
Bigelow Laboratory for Ocean Sciences
60 Bigelow Drive, P.O. Box 380
East Boothbay, Maine 04544
http://www.bigelow.org


From englishchristophera at gmail.com  Thu Mar 16 14:53:14 2017
From: englishchristophera at gmail.com (chris english)
Date: Thu, 16 Mar 2017 09:53:14 -0400
Subject: [R-sig-Geo] Maintain SRID with st_write to postgis db
In-Reply-To: <04e27abf-24db-a04f-3738-69f47ac4f4b7@uni-muenster.de>
References: <CAPKp32stHJ6d1smgTf6Y2pA+w=1khGcc1UmyUDgSo3mfs+DPsA@mail.gmail.com>
	<cc3d05b8-3f90-e861-c130-8364bf0e7e62@uni-muenster.de>
	<CAPKp32uLVs+WyBj+PZJiNcCCAfiEURMQFKubWs7qwpMUYETG5Q@mail.gmail.com>
	<CAPKp32t88vqbg60+tHNQF82CdW4YBFBDpWbdYF_FgV+9Y=nHBw@mail.gmail.com>
	<CAASFQpS6sHCSoCb6nN1nZQk=34wk_v7vqypWgGwpXhk3-tUaNQ@mail.gmail.com>
	<04e27abf-24db-a04f-3738-69f47ac4f4b7@uni-muenster.de>
Message-ID: <CAASFQpQR64iu6KErWFNTH-9szrNW_vCg5FtMib4akwkSHJ5iOw@mail.gmail.com>

Edzer,

Installs fine now, though st_make_valid is useful when cleaning messy
inputs. I
just installed new ubuntu binaries for PostGIS last night but will attend
to rebuild
from source.

 The only thing to come up in an otherwise smooth install:
** preparing package for lazy loading
in method for ?coerce? with signature ?"Spatial","sf"?: no definition for
class ?Spatial?
in method for ?coerce? with signature ?"Spatial","sfc"?: no definition for
class ?Spatial?
in method for ?coerce? with signature ?"sf","Spatial"?: no definition for
class ?Spatial?
in method for ?coerce? with signature ?"sfc","Spatial"?: no definition for
class ?Spatial?
** help
*** installing help indices
** building package indices
** installing vignettes
** testing if installed package can be loaded
* DONE (sf)
Reloading installed sf
Linking to GEOS 3.4.2, GDAL 2.1.3, proj.4 4.9.1

I'm guessing this refers to sp::Spatial-class as Spatial is capitalized. I
don't know
whether this will affect swapping in and out of sf <->sp, but include it
for completeness.

Thanks again,

Chris

On Thu, Mar 16, 2017 at 5:06 AM, Edzer Pebesma <
edzer.pebesma at uni-muenster.de> wrote:

> Mike, Chris, the configure step should now pass regardless whether
> liblwgeom is present, or not; the error message was my mistake.
>
> sf will link to liblwgeom when its development version is present (on
> ubuntu: liblwgeom-dev). If postgis is binary installed, liblwgeom may be
> present, but not its dev version (needed for header files); that case is
> now being caught too.
>
> liblwgeom provides st_make_valid, essentially ST_makeValid in postgis;
> see https://github.com/edzer/sfr/issues/67 . Since liblwgeom is not
> available on the CRAN build farms, it's presence is not required by sf.
>
> Best regards,
>
> On 16/03/17 05:46, chris english wrote:
> > Michael,
> >
> > I have the very same failure,
> >> library(sf)
> > Linking to GEOS 3.4.2, GDAL 2.1.3, proj.4 4.9.1
> > (pre upgrade attempt, which still works just fine)
> >
> > checking for geos_c.h... yes
> > checking geos: linking with -lgeos_c... yes
> > checking for lwgeom_version in -llwgeom... no
> > configure: error: in `/tmp/RtmpsCmf6B/devtoolsd68e68107a/edzer-sfr-
> d620f3b':
> > configure: error: lwgeom test failed (--without-readline to disable)
> >
> > I could nearly copy your install output though on 16.04, and the same
> > tangle of it depends on x but it won't be installed & etc.
> > But, if you have PostGIS, you have liblwgeom as it is fairly specific to
> > PostGIS. Perhaps, rather than a devtools::github_install,
> > a clone github lo a local directory and config, make, install might
> > work, but I'm just imagining.
> >
> > then testing:
> > config.log --snip --
> > configure:3993: checking for lwgeom_version in -llwgeom
> > configure:4018: gcc -std=gnu99 -o conftest -g -O2 -fstack-protector
> > --param=ssp-
> > buffer-size=4 -Wformat -Werror=format-security -D_FORTIFY_SOURCE=2 -g
> >  -I/usr/lo
> > cal/include   -I/usr/local/include -I/usr/local/include
> > -Wl,-Bsymbolic-functions
> >  -Wl,-z,relro conftest.c -llwgeom  -lproj  -L/usr/local/lib -lproj
> > -L/usr/loca
> > l/lib -lgdal -L/usr/local/lib -lgeos_c -lproj >&5
> > /tmp/ccDBUh1h.o: In function `main':
> > /home/chris/sfr/sfr/conftest.c:34: undefined reference to
> `lwgeom_version'
> > collect2: error: ld returned 1 exit status
> > configure:4018: $? = 1
> > configure: failed program was:
> > | /* confdefs.h */
> > | #define PACKAGE_NAME ""
> > | #define PACKAGE_TARNAME ""
> > | #define PACKAGE_VERSION ""
> > | #define PACKAGE_STRING ""
> > | #define PACKAGE_BUGREPORT ""
> > | #define PACKAGE_URL ""
> > | #define STDC_HEADERS 1
> > | #define HAVE_SYS_TYPES_H 1
> > | #define HAVE_SYS_STAT_H 1
> > | #define HAVE_STDLIB_H 1
> > | #define HAVE_STRING_H 1
> > | #define HAVE_MEMORY_H 1
> > | #define HAVE_STRINGS_H 1
> > | #define HAVE_INTTYPES_H 1
> > | #define HAVE_STDINT_H 1
> > | #define HAVE_UNISTD_H 1
> > | #define HAVE_GDAL_H 1
> > | #define HAVE_PROJ_API_H 1
> > | #define HAVE_LIBPROJ 1
> > | #define HAVE_GEOS_C_H 1
> > | /* end confdefs.h.  */
> > |
> > | /* Override any GCC internal prototype to avoid an error.
> > |    Use char because int might match the return type of a GCC
> > |    builtin and then its argument prototype would still apply.  */
> > | #ifdef __cplusplus
> > | extern "C"
> > | #endif
> > | char lwgeom_version ();
> > | int
> > | main ()
> > | {
> > | return lwgeom_version ();
> > |   ;
> > |   return 0;
> > | }
> > configure:4027: result: no
> > configure:4036: error: in `/home/chris/sfr/sfr':
> > configure:4038: error: lwgeom test failed (--without-readline to disable)
> > See `config.log' for more details
> >
> > so, it may or may not be the presence or absence of liblwgeom but simply
> > an undefined reference as suggested above:
> >
> > /home/chris/sfr/sfr/conftest.c:34: undefined reference to
> `lwgeom_version' ,
> >
> > but I'm unclear how the version was being requested (well, I can kind of
> > guess)
> > but failing on undefined reference suggests it is not the version per se
> > that may
> > or may not be present (though is because you are using PostGIS), but how
> > the version was requested. I intuit.
> >
> > Ah, and reading  /* confdefs.h */, that it indeed ends with #define
> > HAVE_GEOS_C_H 1,
> > and indeed, conftest.c:34: would have an  undefined reference to
> > `lwgeom_version'.
> >
> > And I've said as much as I understand.
> >
> > Chris
> >
> > On Wed, Mar 15, 2017 at 7:53 PM, Michael Treglia <mtreglia at gmail.com
> > <mailto:mtreglia at gmail.com>> wrote:
> >
> >     Sorry - this follow-up isn't entirely an R question, so if best to
> take
> >     this off list, let me know:
> >
> >     Installing the dev version from github fails for me (installing on
> >     ubuntu
> >     14.04.5) - I've included the output from the install process below -
> >     seems
> >     to fail due to failed check for liblwgeom version.
> >
> >     Looks like I don't have liblwgeom installed - and when I try (via
> sudo
> >     apt-get install liblwgeom-2.3-0), it indicates it requires
> libgeos-c1.
> >     Installing libgeos-c1, however, requires removal of a newer version
> of
> >     libgeos (libgeos-c1v5), which other FOSS GIS tools depend on (at
> >     least if
> >     my understanding is correct).  Is there a way around this?  Sorry if
> I'm
> >     just missing something, and thanks again for input.
> >     mike
> >
> >
> >
> >     #Output of install from github
> >     > install_github("edzer/sfr")
> >     Downloading GitHub repo edzer/sfr at master
> >     from URL https://api.github.com/repos/edzer/sfr/zipball/master
> >     <https://api.github.com/repos/edzer/sfr/zipball/master>
> >     Installing sf
> >     '/usr/lib/R/bin/R' --no-site-file --no-environ --no-save --no-restore
> >     --quiet  \
> >       CMD INSTALL '/tmp/RtmpKLmhyt/devtools9fd11eb9c3/edzer-sfr-d620f3b'
> \
> >       --library='/home/mlt244/R/x86_64-pc-linux-gnu-library/3.3'
> >     --install-tests
> >
> >     * installing *source* package ?sf? ...
> >     configure: CC: gcc -std=gnu99
> >     configure: CXX: g++
> >     configure: :
> >     checking for gdal-config... /usr/bin/gdal-config
> >     checking gdal-config usability... yes
> >     configure: GDAL: 2.1.0
> >     checking GDAL version >= 2.0.0... yes
> >     checking for gcc... gcc -std=gnu99
> >     checking whether the C compiler works... yes
> >     checking for C compiler default output file name... a.out
> >     checking for suffix of executables...
> >     checking whether we are cross compiling... no
> >     checking for suffix of object files... o
> >     checking whether we are using the GNU C compiler... yes
> >     checking whether gcc -std=gnu99 accepts -g... yes
> >     checking for gcc -std=gnu99 option to accept ISO C89... none needed
> >     checking how to run the C preprocessor... gcc -std=gnu99 -E
> >     checking for grep that handles long lines and -e... /bin/grep
> >     checking for egrep... /bin/grep -E
> >     checking for ANSI C header files... yes
> >     checking for sys/types.h... yes
> >     checking for sys/stat.h... yes
> >     checking for stdlib.h... yes
> >     checking for string.h... yes
> >     checking for memory.h... yes
> >     checking for strings.h... yes
> >     checking for inttypes.h... yes
> >     checking for stdint.h... yes
> >     checking for unistd.h... yes
> >     checking gdal.h usability... yes
> >     checking gdal.h presence... yes
> >     checking for gdal.h... yes
> >     checking GDAL: linking with --libs only... yes
> >     checking GDAL: /usr/share/gdal/2.1/pcs.csv readable... yes
> >     checking GDAL: checking whether PROJ.4 is available for linking:...
> yes
> >     checking GDAL: checking whether PROJ.4 is available fur running:...
> yes
> >     checking proj_api.h usability... yes
> >     checking proj_api.h presence... yes
> >     checking for proj_api.h... yes
> >     checking for pj_init_plus in -lproj... yes
> >     checking PROJ.4: epsg found and readable... yes
> >     proj_conf_test.c: In function 'main':
> >     proj_conf_test.c:5:5: error: unknown type name 'PAFile'
> >          PAFile fp;
> >          ^
> >     proj_conf_test.c:8:5: warning: implicit declaration of function
> >     'pj_open_lib' [-Wimplicit-function-declaration]
> >          fp = pj_open_lib(ctx, "conus", "rb");
> >          ^
> >     proj_conf_test.c:9:12: warning: comparison between pointer and
> integer
> >     [enabled by default]
> >          if (fp == NULL) exit(1);
> >                 ^
> >     proj_conf_test.c:10:5: warning: implicit declaration of function
> >     'pj_ctx_fclose' [-Wimplicit-function-declaration]
> >          pj_ctx_fclose(ctx, fp);
> >          ^
> >     ./configure: line 3834: ./proj_conf_test: No such file or directory
> >     checking PROJ.4: conus found and readable... yes
> >     checking geos-config usability... yes
> >     configure: GEOS: 3.5.0
> >     checking GEOS version >= 3.3.0... yes
> >     checking geos_c.h usability... yes
> >     checking geos_c.h presence... yes
> >     checking for geos_c.h... yes
> >     checking geos: linking with -lgeos_c... yes
> >     checking for lwgeom_version in -llwgeom... no
> >     configure: error: in
> >     `/tmp/RtmpKLmhyt/devtools9fd11eb9c3/edzer-sfr-d620f3b':
> >     configure: error: lwgeom test failed (--without-readline to disable)
> >     See `config.log' for more details
> >     ERROR: configuration failed for package ?sf?
> >     * removing ?/home/mlt244/R/x86_64-pc-linux-gnu-library/3.3/sf?
> >     * restoring previous ?/home/mlt244/R/x86_64-pc-
> linux-gnu-library/3.3/sf?
> >     Error: Command failed (1)
> >
> >
> >     On Wed, Mar 15, 2017 at 6:14 PM, Michael Treglia <mtreglia at gmail.com
> >     <mailto:mtreglia at gmail.com>> wrote:
> >
> >     > Wow - thanks so much for this quick fix, Edzer! I like your
> >     solution to
> >     > having syntatically different but semantically identical
> >     proj4string. Will
> >     > try this in a bit, and write back if I have any issues.
> >     > Best,
> >     > mike
> >     >
> >     > On Wed, Mar 15, 2017 at 5:58 PM, Edzer Pebesma <
> >     > edzer.pebesma at uni-muenster.de
> >     <mailto:edzer.pebesma at uni-muenster.de>> wrote:
> >     >
> >     >> Great question! Short answer: now solved in the dev version on
> >     github;
> >     >> data are written directly to postgis having epsg 2263.
> >     >>
> >     >>
> >     >> Long answer:
> >     >>
> >     >> I believe this was caused by gdal and proj.4 doing different
> >     things when
> >     >> resolving epsg codes to proj4strings. sf uses proj.4 for this.
> When
> >     >> writing a proj4string either gdal or postgis don't recognize the
> >     >> proj4string that proj.4 returns on the epsg code. Neither gdal nor
> >     >> postgis understand that syntactically different proj4strings may
> be
> >     >> semantically identical.
> >     >>
> >     >>
> >     >> After running your example, in postgis
> >     >>
> >     >> # select proj4text from spatial_ref_sys where SRID = 900914;
> >     >>
> >     >> gives:
> >     >>
> >     >>  +proj=lcc +lat_1=41.03333333333333 +lat_2=40.66666666666666
> >     >> +lat_0=40.16666666666666 +lon_0=-74 +x_0=300000 +y_0=0
> +ellps=GRS80
> >     >> +towgs84=0,0,0,0,0,0,0 +units=us-ft +no_defs
> >     >>
> >     >> # select proj4text from spatial_ref_sys where SRID = 2263;
> >     >>
> >     >> gives:
> >     >>
> >     >>  +proj=lcc +lat_1=41.03333333333333 +lat_2=40.66666666666666
> >     >> +lat_0=40.16666666666666 +lon_0=-74 +x_0=300000.0000000001 +y_0=0
> >     >> +datum=NAD83 +units=us-ft +no_defs
> >     >>
> >     >> sf causes this:
> >     >>
> >     >> > st_crs(2263)
> >     >> $epsg
> >     >> [1] 2263
> >     >>
> >     >> $proj4string
> >     >> [1] "+proj=lcc +lat_1=41.03333333333333 +lat_2=40.66666666666666
> >     >> +lat_0=40.16666666666666 +lon_0=-74 +x_0=300000.0000000001 +y_0=0
> >     >> +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=us-ft +no_defs"
> >     >>
> >     >> attr(,"class")
> >     >> [1] "crs"
> >     >>
> >     >> because it uses proj.4 directly to resolve SRID strings:
> >     >>
> >     >> /usr/share/proj/epsg has:
> >     >>
> >     >> # NAD83 / New York Long Island (ftUS)
> >     >> <2263> +proj=lcc +lat_1=41.03333333333333 +lat_2=40.66666666666666
> >     >> +lat_0=40.16666666666666 +lon_0=-74 +x_0=300000.0000000001 +y_0=0
> >     >> +datum=NAD83 +units=us-ft +no_defs  <>
> >     >>
> >     >>
> >     >> The change I made to sf (
> >     >> https://github.com/edzer/sfr/commit/d620f3b748d487bae910e388
> >     <https://github.com/edzer/sfr/commit/d620f3b748d487bae910e388>
> >     >> 4c554fa9e3ce7090)
> >     >> now first asks gdal to resolve the epsg (in case it is not NA),
> and
> >     >> otherwise resolve the proj4string (if not NA), instead of ONLY
> >     trying to
> >     >> resolve a non-NA proj4string.
> >     >>
> >     >> On 15/03/17 20:50, Michael Treglia wrote:
> >     >> > Hi All,
> >     >> >
> >     >> > Been working to import and manipulate a CSV file with point data
> >     >> > (lat/long), and then export to a PostGIS db.
> >     >> >
> >     >> > Overall, successful, but one thing I'd like to fix - when I
> >     write out
> >     >> the
> >     >> > layer to postgis, the SRID is not maintained. The final
> EPSG/SRID
> >     >> should be
> >     >> > 2263, but when I check in PostGIS, it comes up as 900914.
> >     >> >
> >     >> > Below is my code and sessionInfo, and the data are from here:
> >     >> > https://data.cityofnewyork.us/Public-Safety/NYPD-Complaint-D
> >     <https://data.cityofnewyork.us/Public-Safety/NYPD-Complaint-D>
> >     >> ata-Current-YTD/5uac-w243
> >     >> > (downloaded as plain old CSV)
> >     >> >
> >     >> > Anything I might be missing? Thanks in advance for giving a
> >     quick look!
> >     >> > Mike
> >     >> >
> >     >> >
> >     >> > ##Start Code
> >     >> >
> >     >> > #load packages
> >     >> > library(sf)
> >     >> > library(RPostgreSQL)
> >     >> >
> >     >> > #read data
> >     >> > crime_current <- read.csv("NYPD_Complaint_Data_
> Current_YTD.csv",
> >     >> > stringsAsFactors = FALSE)
> >     >> >
> >     >> > #format time columns for easier reading in postgres (I think),
> as
> >     >> keeping
> >     >> > as date format caused problems in export
> >     >> > crime_current$CMPLNT_FR_TIME <-
> >     >> > as.character(as.POSIXct(paste(crime_current$CMPLNT_FR_DT,
> >     >> > crime_current$CMPLNT_FR_TM), format="%m/%d/%Y\ %H:%M", tz=""))
> >     >> > crime_current$CMPLNT_TO_TIME <-
> >     >> > as.character(as.POSIXct(paste(crime_current$CMPLNT_TO_DT,
> >     >> > crime_current$CMPLNT_TO_TM), format="%m/%d/%Y\ %H:%M", tz=""))
> >     >> > crime_current$RPT_DT <-
> >     as.character(as.POSIXct(crime_current$RPT_DT,
> >     >> > format="%m/%d/%Y", tz=""))
> >     >> >
> >     >> > #convert to sf object
> >     >> > crime_current.sf <- st_as_sf(crime_current, coords =
> c("Longitude",
> >     >> > "Latitude"), crs = 4326)
> >     >> > #reproject to EPSG 2263
> >     >> > crime_current.sf <- st_transform(crime_current.sf, crs=2263)
> >     >> >
> >     >> > #write to postgres
> >     >> > st_write(crime_current.sf, "PG:dbname=mydb user=user
> >     host=xx.xx.xx.xx",
> >     >> > 'health_safety.crime_current')
> >     >> > ###End Code
> >     >> >
> >     >> >
> >     >> >
> >     >> >> sessionInfo()
> >     >> > R version 3.3.1 (2016-06-21)
> >     >> > Platform: x86_64-pc-linux-gnu (64-bit)
> >     >> > Running under: Ubuntu 14.04.5 LTS
> >     >> >
> >     >> > locale:
> >     >> >  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
> >     >> > LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
> >     >> >  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
> >     >> >  LC_PAPER=en_US.UTF-8       LC_NAME=C
> >     >> >  [9] LC_ADDRESS=C               LC_TELEPHONE=C
> >     >> > LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C
> >     >> >
> >     >> > attached base packages:
> >     >> > [1] stats     graphics  grDevices utils     datasets  methods
> >      base
> >     >> >
> >     >> > other attached packages:
> >     >> > [1] sp_1.2-3          RPostgreSQL_0.4-1 DBI_0.6
>  sf_0.3-4
> >     >> >
> >     >> > loaded via a namespace (and not attached):
> >     >> > [1] tools_3.3.1     units_0.4-2     Rcpp_0.12.9
>  udunits2_0.13
> >     >> > grid_3.3.1      lattice_0.20-33
> >     >> >
> >     >> >       [[alternative HTML version deleted]]
> >     >> >
> >     >> > _______________________________________________
> >     >> > R-sig-Geo mailing list
> >     >> > R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
> >     >> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >     <https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
> >     >> >
> >     >>
> >     >> --
> >     >> Edzer Pebesma
> >     >> Institute for Geoinformatics  (ifgi),  University of M?nster
> >     >> Heisenbergstra?e 2, 48149 M?nster, Germany; +49 251 83 33081
> >     <tel:%2B49%20251%2083%2033081>
> >     >> Journal of Statistical Software:   http://www.jstatsoft.org/
> >     >> Computers & Geosciences:   http://elsevier.com/locate/cageo/
> >     <http://elsevier.com/locate/cageo/>
> >     >>
> >     >>
> >     >> _______________________________________________
> >     >> R-sig-Geo mailing list
> >     >> R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
> >     >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >     <https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
> >     >>
> >     >
> >     >
> >
> >             [[alternative HTML version deleted]]
> >
> >     _______________________________________________
> >     R-sig-Geo mailing list
> >     R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
> >     https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >     <https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
> >
> >
>
> --
> Edzer Pebesma
> Institute for Geoinformatics  (ifgi),  University of M?nster
> Heisenbergstra?e 2, 48149 M?nster, Germany; +49 251 83 33081
> Journal of Statistical Software:   http://www.jstatsoft.org/
> Computers & Geosciences:   http://elsevier.com/locate/cageo/
>
>

	[[alternative HTML version deleted]]


From edzer.pebesma at uni-muenster.de  Thu Mar 16 16:15:36 2017
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Thu, 16 Mar 2017 16:15:36 +0100
Subject: [R-sig-Geo] Maintain SRID with st_write to postgis db
In-Reply-To: <CAASFQpQR64iu6KErWFNTH-9szrNW_vCg5FtMib4akwkSHJ5iOw@mail.gmail.com>
References: <CAPKp32stHJ6d1smgTf6Y2pA+w=1khGcc1UmyUDgSo3mfs+DPsA@mail.gmail.com>
	<cc3d05b8-3f90-e861-c130-8364bf0e7e62@uni-muenster.de>
	<CAPKp32uLVs+WyBj+PZJiNcCCAfiEURMQFKubWs7qwpMUYETG5Q@mail.gmail.com>
	<CAPKp32t88vqbg60+tHNQF82CdW4YBFBDpWbdYF_FgV+9Y=nHBw@mail.gmail.com>
	<CAASFQpS6sHCSoCb6nN1nZQk=34wk_v7vqypWgGwpXhk3-tUaNQ@mail.gmail.com>
	<04e27abf-24db-a04f-3738-69f47ac4f4b7@uni-muenster.de>
	<CAASFQpQR64iu6KErWFNTH-9szrNW_vCg5FtMib4akwkSHJ5iOw@mail.gmail.com>
Message-ID: <454c0550-6b70-3569-5191-cd2120a7f4ed@uni-muenster.de>



On 16/03/17 14:53, chris english wrote:
> Edzer,
> 
> Installs fine now, though st_make_valid is useful when cleaning messy
> inputs. I
> just installed new ubuntu binaries for PostGIS last night but will
> attend to rebuild
> from source. 
> 
>  The only thing to come up in an otherwise smooth install:
> ** preparing package for lazy loading
> in method for ?coerce? with signature ?"Spatial","sf"?: no definition
> for class ?Spatial?
> in method for ?coerce? with signature ?"Spatial","sfc"?: no definition
> for class ?Spatial?
> in method for ?coerce? with signature ?"sf","Spatial"?: no definition
> for class ?Spatial?
> in method for ?coerce? with signature ?"sfc","Spatial"?: no definition
> for class ?Spatial?
> ** help
> *** installing help indices
> ** building package indices
> ** installing vignettes
> ** testing if installed package can be loaded
> * DONE (sf)
> Reloading installed sf
> Linking to GEOS 3.4.2, GDAL 2.1.3, proj.4 4.9.1
> 
> I'm guessing this refers to sp::Spatial-class as Spatial is capitalized.
> I don't know
> whether this will affect swapping in and out of sf <->sp, but include it
> for completeness.

You can safely ignore it.

If `sf' would import `sp' it would go away, but there is no need to do
so. Not importing packages makes it easier to understand where they are
being used, and so limits the search for where things can go wrong.

> 
> Thanks again,
> 
> Chris
> 
> On Thu, Mar 16, 2017 at 5:06 AM, Edzer Pebesma
> <edzer.pebesma at uni-muenster.de <mailto:edzer.pebesma at uni-muenster.de>>
> wrote:
> 
>     Mike, Chris, the configure step should now pass regardless whether
>     liblwgeom is present, or not; the error message was my mistake.
> 
>     sf will link to liblwgeom when its development version is present (on
>     ubuntu: liblwgeom-dev). If postgis is binary installed, liblwgeom may be
>     present, but not its dev version (needed for header files); that case is
>     now being caught too.
> 
>     liblwgeom provides st_make_valid, essentially ST_makeValid in postgis;
>     see https://github.com/edzer/sfr/issues/67
>     <https://github.com/edzer/sfr/issues/67> . Since liblwgeom is not
>     available on the CRAN build farms, it's presence is not required by sf.
> 
>     Best regards,
> 
>     On 16/03/17 05:46, chris english wrote:
>     > Michael,
>     >
>     > I have the very same failure,
>     >> library(sf)
>     > Linking to GEOS 3.4.2, GDAL 2.1.3, proj.4 4.9.1
>     > (pre upgrade attempt, which still works just fine)
>     >
>     > checking for geos_c.h... yes
>     > checking geos: linking with -lgeos_c... yes
>     > checking for lwgeom_version in -llwgeom... no
>     > configure: error: in
>     `/tmp/RtmpsCmf6B/devtoolsd68e68107a/edzer-sfr-d620f3b':
>     > configure: error: lwgeom test failed (--without-readline to disable)
>     >
>     > I could nearly copy your install output though on 16.04, and the same
>     > tangle of it depends on x but it won't be installed & etc.
>     > But, if you have PostGIS, you have liblwgeom as it is fairly
>     specific to
>     > PostGIS. Perhaps, rather than a devtools::github_install,
>     > a clone github lo a local directory and config, make, install might
>     > work, but I'm just imagining.
>     >
>     > then testing:
>     > config.log --snip --
>     > configure:3993: checking for lwgeom_version in -llwgeom
>     > configure:4018: gcc -std=gnu99 -o conftest -g -O2 -fstack-protector
>     > --param=ssp-
>     > buffer-size=4 -Wformat -Werror=format-security -D_FORTIFY_SOURCE=2 -g
>     >  -I/usr/lo
>     > cal/include   -I/usr/local/include -I/usr/local/include
>     > -Wl,-Bsymbolic-functions
>     >  -Wl,-z,relro conftest.c -llwgeom  -lproj  -L/usr/local/lib -lproj
>     > -L/usr/loca
>     > l/lib -lgdal -L/usr/local/lib -lgeos_c -lproj >&5
>     > /tmp/ccDBUh1h.o: In function `main':
>     > /home/chris/sfr/sfr/conftest.c:34: undefined reference to
>     `lwgeom_version'
>     > collect2: error: ld returned 1 exit status
>     > configure:4018: $? = 1
>     > configure: failed program was:
>     > | /* confdefs.h */
>     > | #define PACKAGE_NAME ""
>     > | #define PACKAGE_TARNAME ""
>     > | #define PACKAGE_VERSION ""
>     > | #define PACKAGE_STRING ""
>     > | #define PACKAGE_BUGREPORT ""
>     > | #define PACKAGE_URL ""
>     > | #define STDC_HEADERS 1
>     > | #define HAVE_SYS_TYPES_H 1
>     > | #define HAVE_SYS_STAT_H 1
>     > | #define HAVE_STDLIB_H 1
>     > | #define HAVE_STRING_H 1
>     > | #define HAVE_MEMORY_H 1
>     > | #define HAVE_STRINGS_H 1
>     > | #define HAVE_INTTYPES_H 1
>     > | #define HAVE_STDINT_H 1
>     > | #define HAVE_UNISTD_H 1
>     > | #define HAVE_GDAL_H 1
>     > | #define HAVE_PROJ_API_H 1
>     > | #define HAVE_LIBPROJ 1
>     > | #define HAVE_GEOS_C_H 1
>     > | /* end confdefs.h.  */
>     > |
>     > | /* Override any GCC internal prototype to avoid an error.
>     > |    Use char because int might match the return type of a GCC
>     > |    builtin and then its argument prototype would still apply.  */
>     > | #ifdef __cplusplus
>     > | extern "C"
>     > | #endif
>     > | char lwgeom_version ();
>     > | int
>     > | main ()
>     > | {
>     > | return lwgeom_version ();
>     > |   ;
>     > |   return 0;
>     > | }
>     > configure:4027: result: no
>     > configure:4036: error: in `/home/chris/sfr/sfr':
>     > configure:4038: error: lwgeom test failed (--without-readline to
>     disable)
>     > See `config.log' for more details
>     >
>     > so, it may or may not be the presence or absence of liblwgeom but
>     simply
>     > an undefined reference as suggested above:
>     >
>     > /home/chris/sfr/sfr/conftest.c:34: undefined reference to
>     `lwgeom_version' ,
>     >
>     > but I'm unclear how the version was being requested (well, I can
>     kind of
>     > guess)
>     > but failing on undefined reference suggests it is not the version
>     per se
>     > that may
>     > or may not be present (though is because you are using PostGIS),
>     but how
>     > the version was requested. I intuit.
>     >
>     > Ah, and reading  /* confdefs.h */, that it indeed ends with #define
>     > HAVE_GEOS_C_H 1,
>     > and indeed, conftest.c:34: would have an  undefined reference to
>     > `lwgeom_version'.
>     >
>     > And I've said as much as I understand.
>     >
>     > Chris
>     >
>     > On Wed, Mar 15, 2017 at 7:53 PM, Michael Treglia
>     <mtreglia at gmail.com <mailto:mtreglia at gmail.com>
>     > <mailto:mtreglia at gmail.com <mailto:mtreglia at gmail.com>>> wrote:
>     >
>     >     Sorry - this follow-up isn't entirely an R question, so if
>     best to take
>     >     this off list, let me know:
>     >
>     >     Installing the dev version from github fails for me (installing on
>     >     ubuntu
>     >     14.04.5) - I've included the output from the install process
>     below -
>     >     seems
>     >     to fail due to failed check for liblwgeom version.
>     >
>     >     Looks like I don't have liblwgeom installed - and when I try
>     (via sudo
>     >     apt-get install liblwgeom-2.3-0), it indicates it requires
>     libgeos-c1.
>     >     Installing libgeos-c1, however, requires removal of a newer
>     version of
>     >     libgeos (libgeos-c1v5), which other FOSS GIS tools depend on (at
>     >     least if
>     >     my understanding is correct).  Is there a way around this? 
>     Sorry if I'm
>     >     just missing something, and thanks again for input.
>     >     mike
>     >
>     >
>     >
>     >     #Output of install from github
>     >     > install_github("edzer/sfr")
>     >     Downloading GitHub repo edzer/sfr at master
>     >     from URL https://api.github.com/repos/edzer/sfr/zipball/master
>     <https://api.github.com/repos/edzer/sfr/zipball/master>
>     >     <https://api.github.com/repos/edzer/sfr/zipball/master
>     <https://api.github.com/repos/edzer/sfr/zipball/master>>
>     >     Installing sf
>     >     '/usr/lib/R/bin/R' --no-site-file --no-environ --no-save
>     --no-restore
>     >     --quiet  \
>     >       CMD INSTALL
>     '/tmp/RtmpKLmhyt/devtools9fd11eb9c3/edzer-sfr-d620f3b'  \
>     >       --library='/home/mlt244/R/x86_64-pc-linux-gnu-library/3.3'
>     >     --install-tests
>     >
>     >     * installing *source* package ?sf? ...
>     >     configure: CC: gcc -std=gnu99
>     >     configure: CXX: g++
>     >     configure: :
>     >     checking for gdal-config... /usr/bin/gdal-config
>     >     checking gdal-config usability... yes
>     >     configure: GDAL: 2.1.0
>     >     checking GDAL version >= 2.0.0... yes
>     >     checking for gcc... gcc -std=gnu99
>     >     checking whether the C compiler works... yes
>     >     checking for C compiler default output file name... a.out
>     >     checking for suffix of executables...
>     >     checking whether we are cross compiling... no
>     >     checking for suffix of object files... o
>     >     checking whether we are using the GNU C compiler... yes
>     >     checking whether gcc -std=gnu99 accepts -g... yes
>     >     checking for gcc -std=gnu99 option to accept ISO C89... none
>     needed
>     >     checking how to run the C preprocessor... gcc -std=gnu99 -E
>     >     checking for grep that handles long lines and -e... /bin/grep
>     >     checking for egrep... /bin/grep -E
>     >     checking for ANSI C header files... yes
>     >     checking for sys/types.h... yes
>     >     checking for sys/stat.h... yes
>     >     checking for stdlib.h... yes
>     >     checking for string.h... yes
>     >     checking for memory.h... yes
>     >     checking for strings.h... yes
>     >     checking for inttypes.h... yes
>     >     checking for stdint.h... yes
>     >     checking for unistd.h... yes
>     >     checking gdal.h usability... yes
>     >     checking gdal.h presence... yes
>     >     checking for gdal.h... yes
>     >     checking GDAL: linking with --libs only... yes
>     >     checking GDAL: /usr/share/gdal/2.1/pcs.csv readable... yes
>     >     checking GDAL: checking whether PROJ.4 is available for
>     linking:... yes
>     >     checking GDAL: checking whether PROJ.4 is available fur
>     running:... yes
>     >     checking proj_api.h usability... yes
>     >     checking proj_api.h presence... yes
>     >     checking for proj_api.h... yes
>     >     checking for pj_init_plus in -lproj... yes
>     >     checking PROJ.4: epsg found and readable... yes
>     >     proj_conf_test.c: In function 'main':
>     >     proj_conf_test.c:5:5: error: unknown type name 'PAFile'
>     >          PAFile fp;
>     >          ^
>     >     proj_conf_test.c:8:5: warning: implicit declaration of function
>     >     'pj_open_lib' [-Wimplicit-function-declaration]
>     >          fp = pj_open_lib(ctx, "conus", "rb");
>     >          ^
>     >     proj_conf_test.c:9:12: warning: comparison between pointer and
>     integer
>     >     [enabled by default]
>     >          if (fp == NULL) exit(1);
>     >                 ^
>     >     proj_conf_test.c:10:5: warning: implicit declaration of function
>     >     'pj_ctx_fclose' [-Wimplicit-function-declaration]
>     >          pj_ctx_fclose(ctx, fp);
>     >          ^
>     >     ./configure: line 3834: ./proj_conf_test: No such file or
>     directory
>     >     checking PROJ.4: conus found and readable... yes
>     >     checking geos-config usability... yes
>     >     configure: GEOS: 3.5.0
>     >     checking GEOS version >= 3.3.0... yes
>     >     checking geos_c.h usability... yes
>     >     checking geos_c.h presence... yes
>     >     checking for geos_c.h... yes
>     >     checking geos: linking with -lgeos_c... yes
>     >     checking for lwgeom_version in -llwgeom... no
>     >     configure: error: in
>     >     `/tmp/RtmpKLmhyt/devtools9fd11eb9c3/edzer-sfr-d620f3b':
>     >     configure: error: lwgeom test failed (--without-readline to
>     disable)
>     >     See `config.log' for more details
>     >     ERROR: configuration failed for package ?sf?
>     >     * removing ?/home/mlt244/R/x86_64-pc-linux-gnu-library/3.3/sf?
>     >     * restoring previous
>     ?/home/mlt244/R/x86_64-pc-linux-gnu-library/3.3/sf?
>     >     Error: Command failed (1)
>     >
>     >
>     >     On Wed, Mar 15, 2017 at 6:14 PM, Michael Treglia
>     <mtreglia at gmail.com <mailto:mtreglia at gmail.com>
>     >     <mailto:mtreglia at gmail.com <mailto:mtreglia at gmail.com>>> wrote:
>     >
>     >     > Wow - thanks so much for this quick fix, Edzer! I like your
>     >     solution to
>     >     > having syntatically different but semantically identical
>     >     proj4string. Will
>     >     > try this in a bit, and write back if I have any issues.
>     >     > Best,
>     >     > mike
>     >     >
>     >     > On Wed, Mar 15, 2017 at 5:58 PM, Edzer Pebesma <
>     >     > edzer.pebesma at uni-muenster.de <mailto:edzer.pebesma at uni-muenster.de>
>     >     <mailto:edzer.pebesma at uni-muenster.de
>     <mailto:edzer.pebesma at uni-muenster.de>>> wrote:
>     >     >
>     >     >> Great question! Short answer: now solved in the dev version on
>     >     github;
>     >     >> data are written directly to postgis having epsg 2263.
>     >     >>
>     >     >>
>     >     >> Long answer:
>     >     >>
>     >     >> I believe this was caused by gdal and proj.4 doing different
>     >     things when
>     >     >> resolving epsg codes to proj4strings. sf uses proj.4 for
>     this. When
>     >     >> writing a proj4string either gdal or postgis don't
>     recognize the
>     >     >> proj4string that proj.4 returns on the epsg code. Neither
>     gdal nor
>     >     >> postgis understand that syntactically different
>     proj4strings may be
>     >     >> semantically identical.
>     >     >>
>     >     >>
>     >     >> After running your example, in postgis
>     >     >>
>     >     >> # select proj4text from spatial_ref_sys where SRID = 900914;
>     >     >>
>     >     >> gives:
>     >     >>
>     >     >>  +proj=lcc +lat_1=41.03333333333333 +lat_2=40.66666666666666
>     >     >> +lat_0=40.16666666666666 +lon_0=-74 +x_0=300000 +y_0=0
>     +ellps=GRS80
>     >     >> +towgs84=0,0,0,0,0,0,0 +units=us-ft +no_defs
>     >     >>
>     >     >> # select proj4text from spatial_ref_sys where SRID = 2263;
>     >     >>
>     >     >> gives:
>     >     >>
>     >     >>  +proj=lcc +lat_1=41.03333333333333 +lat_2=40.66666666666666
>     >     >> +lat_0=40.16666666666666 +lon_0=-74 +x_0=300000.0000000001
>     +y_0=0
>     >     >> +datum=NAD83 +units=us-ft +no_defs
>     >     >>
>     >     >> sf causes this:
>     >     >>
>     >     >> > st_crs(2263)
>     >     >> $epsg
>     >     >> [1] 2263
>     >     >>
>     >     >> $proj4string
>     >     >> [1] "+proj=lcc +lat_1=41.03333333333333
>     +lat_2=40.66666666666666
>     >     >> +lat_0=40.16666666666666 +lon_0=-74 +x_0=300000.0000000001
>     +y_0=0
>     >     >> +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=us-ft +no_defs"
>     >     >>
>     >     >> attr(,"class")
>     >     >> [1] "crs"
>     >     >>
>     >     >> because it uses proj.4 directly to resolve SRID strings:
>     >     >>
>     >     >> /usr/share/proj/epsg has:
>     >     >>
>     >     >> # NAD83 / New York Long Island (ftUS)
>     >     >> <2263> +proj=lcc +lat_1=41.03333333333333
>     +lat_2=40.66666666666666
>     >     >> +lat_0=40.16666666666666 +lon_0=-74 +x_0=300000.0000000001
>     +y_0=0
>     >     >> +datum=NAD83 +units=us-ft +no_defs  <>
>     >     >>
>     >     >>
>     >     >> The change I made to sf (
>     >     >>
>     https://github.com/edzer/sfr/commit/d620f3b748d487bae910e388
>     <https://github.com/edzer/sfr/commit/d620f3b748d487bae910e388>
>     >     <https://github.com/edzer/sfr/commit/d620f3b748d487bae910e388
>     <https://github.com/edzer/sfr/commit/d620f3b748d487bae910e388>>
>     >     >> 4c554fa9e3ce7090)
>     >     >> now first asks gdal to resolve the epsg (in case it is not
>     NA), and
>     >     >> otherwise resolve the proj4string (if not NA), instead of ONLY
>     >     trying to
>     >     >> resolve a non-NA proj4string.
>     >     >>
>     >     >> On 15/03/17 20:50, Michael Treglia wrote:
>     >     >> > Hi All,
>     >     >> >
>     >     >> > Been working to import and manipulate a CSV file with
>     point data
>     >     >> > (lat/long), and then export to a PostGIS db.
>     >     >> >
>     >     >> > Overall, successful, but one thing I'd like to fix - when I
>     >     write out
>     >     >> the
>     >     >> > layer to postgis, the SRID is not maintained. The final
>     EPSG/SRID
>     >     >> should be
>     >     >> > 2263, but when I check in PostGIS, it comes up as 900914.
>     >     >> >
>     >     >> > Below is my code and sessionInfo, and the data are from here:
>     >     >> >
>     https://data.cityofnewyork.us/Public-Safety/NYPD-Complaint-D
>     <https://data.cityofnewyork.us/Public-Safety/NYPD-Complaint-D>
>     >     <https://data.cityofnewyork.us/Public-Safety/NYPD-Complaint-D
>     <https://data.cityofnewyork.us/Public-Safety/NYPD-Complaint-D>>
>     >     >> ata-Current-YTD/5uac-w243
>     >     >> > (downloaded as plain old CSV)
>     >     >> >
>     >     >> > Anything I might be missing? Thanks in advance for giving a
>     >     quick look!
>     >     >> > Mike
>     >     >> >
>     >     >> >
>     >     >> > ##Start Code
>     >     >> >
>     >     >> > #load packages
>     >     >> > library(sf)
>     >     >> > library(RPostgreSQL)
>     >     >> >
>     >     >> > #read data
>     >     >> > crime_current <-
>     read.csv("NYPD_Complaint_Data_Current_YTD.csv",
>     >     >> > stringsAsFactors = FALSE)
>     >     >> >
>     >     >> > #format time columns for easier reading in postgres (I
>     think), as
>     >     >> keeping
>     >     >> > as date format caused problems in export
>     >     >> > crime_current$CMPLNT_FR_TIME <-
>     >     >> > as.character(as.POSIXct(paste(crime_current$CMPLNT_FR_DT,
>     >     >> > crime_current$CMPLNT_FR_TM), format="%m/%d/%Y\ %H:%M",
>     tz=""))
>     >     >> > crime_current$CMPLNT_TO_TIME <-
>     >     >> > as.character(as.POSIXct(paste(crime_current$CMPLNT_TO_DT,
>     >     >> > crime_current$CMPLNT_TO_TM), format="%m/%d/%Y\ %H:%M",
>     tz=""))
>     >     >> > crime_current$RPT_DT <-
>     >     as.character(as.POSIXct(crime_current$RPT_DT,
>     >     >> > format="%m/%d/%Y", tz=""))
>     >     >> >
>     >     >> > #convert to sf object
>     >     >> > crime_current.sf <- st_as_sf(crime_current, coords =
>     c("Longitude",
>     >     >> > "Latitude"), crs = 4326)
>     >     >> > #reproject to EPSG 2263
>     >     >> > crime_current.sf <- st_transform(crime_current.sf, crs=2263)
>     >     >> >
>     >     >> > #write to postgres
>     >     >> > st_write(crime_current.sf, "PG:dbname=mydb user=user
>     >     host=xx.xx.xx.xx",
>     >     >> > 'health_safety.crime_current')
>     >     >> > ###End Code
>     >     >> >
>     >     >> >
>     >     >> >
>     >     >> >> sessionInfo()
>     >     >> > R version 3.3.1 (2016-06-21)
>     >     >> > Platform: x86_64-pc-linux-gnu (64-bit)
>     >     >> > Running under: Ubuntu 14.04.5 LTS
>     >     >> >
>     >     >> > locale:
>     >     >> >  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
>     >     >> > LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
>     >     >> >  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
>     >     >> >  LC_PAPER=en_US.UTF-8       LC_NAME=C
>     >     >> >  [9] LC_ADDRESS=C               LC_TELEPHONE=C
>     >     >> > LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C
>     >     >> >
>     >     >> > attached base packages:
>     >     >> > [1] stats     graphics  grDevices utils     datasets  methods
>     >      base
>     >     >> >
>     >     >> > other attached packages:
>     >     >> > [1] sp_1.2-3          RPostgreSQL_0.4-1 DBI_0.6         
>      sf_0.3-4
>     >     >> >
>     >     >> > loaded via a namespace (and not attached):
>     >     >> > [1] tools_3.3.1     units_0.4-2     Rcpp_0.12.9   
>      udunits2_0.13
>     >     >> > grid_3.3.1      lattice_0.20-33
>     >     >> >
>     >     >> >       [[alternative HTML version deleted]]
>     >     >> >
>     >     >> > _______________________________________________
>     >     >> > R-sig-Geo mailing list
>     >     >> > R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
>     <mailto:R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>>
>     >     >> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>     <https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
>     >     <https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>     <https://stat.ethz.ch/mailman/listinfo/r-sig-geo>>
>     >     >> >
>     >     >>
>     >     >> --
>     >     >> Edzer Pebesma
>     >     >> Institute for Geoinformatics  (ifgi),  University of M?nster
>     >     >> Heisenbergstra?e 2, 48149 M?nster, Germany; +49 251 83 33081 <tel:%2B49%20251%2083%2033081>
>     >     <tel:%2B49%20251%2083%2033081>
>     >     >> Journal of Statistical Software:   http://www.jstatsoft.org/
>     >     >> Computers & Geosciences:   http://elsevier.com/locate/cageo/ <http://elsevier.com/locate/cageo/>
>     >     <http://elsevier.com/locate/cageo/ <http://elsevier.com/locate/cageo/>>
>     >     >>
>     >     >>
>     >     >> _______________________________________________
>     >     >> R-sig-Geo mailing list
>     >     >> R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
>     <mailto:R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>>
>     >     >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>     <https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
>     >     <https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>     <https://stat.ethz.ch/mailman/listinfo/r-sig-geo>>
>     >     >>
>     >     >
>     >     >
>     >
>     >             [[alternative HTML version deleted]]
>     >
>     >     _______________________________________________
>     >     R-sig-Geo mailing list
>     >     R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
>     <mailto:R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>>
>     >     https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>     <https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
>     >     <https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>     <https://stat.ethz.ch/mailman/listinfo/r-sig-geo>>
>     >
>     >
> 
>     --
>     Edzer Pebesma
>     Institute for Geoinformatics  (ifgi),  University of M?nster
>     Heisenbergstra?e 2, 48149 M?nster, Germany; +49 251 83 33081
>     <tel:%2B49%20251%2083%2033081>
>     Journal of Statistical Software:   http://www.jstatsoft.org/
>     Computers & Geosciences:   http://elsevier.com/locate/cageo/
>     <http://elsevier.com/locate/cageo/>
> 
> 

-- 
Edzer Pebesma
Institute for Geoinformatics  (ifgi),  University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany; +49 251 83 33081
Journal of Statistical Software:   http://www.jstatsoft.org/
Computers & Geosciences:   http://elsevier.com/locate/cageo/

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 473 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20170316/fea647cc/attachment.bin>

From loic.dutrieux at conabio.gob.mx  Thu Mar 16 19:21:21 2017
From: loic.dutrieux at conabio.gob.mx (=?UTF-8?Q?Lo=c3=afc_Dutrieux?=)
Date: Thu, 16 Mar 2017 12:21:21 -0600
Subject: [R-sig-Geo] Sentienl 2 gdal translate
In-Reply-To: <2F972073-5F50-4BF6-8383-E28C300F47B5@gmail.com>
References: <F3B5A4AE-F1CC-4A9A-BCC0-FD18B6F74ECB@gmail.com>
	<573be8a5-7ff1-03d1-4ab6-9f841db0941a@conabio.gob.mx>
	<2F972073-5F50-4BF6-8383-E28C300F47B5@gmail.com>
Message-ID: <fd2c3bca-2309-eceb-b90e-ca78d019131c@conabio.gob.mx>

Hi Miguel,

Briefly looking at the help and source code of
gdalUtils::gdal_translate(), I don't see any way to pass additional
options. Your best shot is therefore probably to build the expression
yourself and pass it via a system call.

library(raster)

Image_Path<-'/path/to/images/'

S2_JP2_List <- list.files(Image_Path, full.names = TRUE, pattern = ".jp2$")

for (file in S2_JP2_List) {
  out_file <- extension(file, 'tif')
  system2('gdal_translate', args = c('-of GTiff', file, out_file,
'--config GDAL_SKIP JPECW'))
}

But the real question here is why the simple gdal_translate call without
--config GDAL_SKIP JPECW did not work for you while you clearly have the
sentinel2 driver...

Cheers,
Lo?c

On 16/03/17 06:02, Miguel Castro G?mez wrote:
> Hi Lo?c,
> 
> I have tried your code but it does not work yet. It just produces one
> tif file for the first band but this file is not correct (8 kb just).
> The R process keep working for a long time without any other output
> 
> Here are the versions I?m using
> 
> R version: 3.3.2
> gdalUtils: v 2.0.1.7
> raster: 2.5-8
> gdal: 2.1.2, released 2016/10/24
> 
> When checking for the sentinel 2 driver in gdal (see red)
> 
>  gdal-config --formats | grep sentinel2
> gxf gtiff hfa aigrid aaigrid ceos ceos2 iso8211 xpm sdts raw dted mem
> jdem envisat elas fit vrt usgsdem l1b nitf bmp airsar rs2 ilwis rmf
> leveller sgi srtmhgt idrisi gsg ingr ers jaxapalsar dimap gff cosar pds
> adrg coasp tsx terragen blx msgn til r northwood saga xyz hf2
> kmlsuperoverlay ctg e00grid zmap ngsgeoid iris map cals safe *sentinel2*
> mrf webp wcs wms plmosaic wmts dods grib bsb openjpeg jpeg2000 netcdf
> hdf5 hdf4 ogdi gif jpeg gta png pcraster fits pcidsk rik ozi rasterlite
> mbtiles postgisraster arg
> 
> I think the problem is the driver that is used to manage the jp2 file.
> Any idea how can I include in the R code the --config GDAL_SKIP JP2ECW
> option. 
> 
> Cheers,
> M
> 
>> El 15 mar 2017, a las 23:13, Lo?c Dutrieux
>> <loic.dutrieux at conabio.gob.mx <mailto:loic.dutrieux at conabio.gob.mx>>
>> escribi?:
>>
>> Hi,
>>
>> I tried your code with some S2 images I had lying around, and it works
>> on my system. I modified it a bit to write the output layers to the same
>> directory and not to my working directory.
>>
>> library(gdalUtils)
>> library(raster)
>>
>> Image_Path<-'/path/to/images/'
>>
>> S2_JP2_List <- list.files(Image_Path, full.names = TRUE, pattern =
>> ".jp2$")
>>
>> for (file in S2_JP2_List) {
>>  out_file <- extension(file, 'tif')
>>  gdal_translate(src_dataset = file, dst_dataset = out_file, ot =
>> "UInt16", of = "GTiff")
>> }
>>
>> gdal has a sentinel 2 driver, but it's not extremely old, therefore it's
>> possible that your installation doesn't have it; you can check with:
>>
>> gdal-config --formats | grep sentinel2
>>
>> Cheers,
>> Lo?c
>>
>>
>>
>> On 15/03/17 12:49, Miguel Castro G?mez wrote:
>>> Hi,
>>>
>>> I have Sentinel 2 images (jp2) that I want to convert to GTiff using
>>> gdal_translate in R (from gdalutils package). Here is the code I?m using
>>>
>>> Image_Path<-?/path/to/wd?
>>>
>>> S2_JP2_List <- list.files(Image_Path, full.names = TRUE, pattern =
>>> ".jp2$")
>>>
>>> for (i in 1:length(S2_JP2_List)) {
>>> gdal_translate(src_dataset = S2_JP2_List[[i]], dst_dataset =
>>> paste("Band", i , "tif"), ot = "UInt16", of = ?GTiff")
>>>    }
>>>
>>> When running this code, the process starts without any error but its
>>> never ending neither producing any output
>>>
>>> I've tried to do it in gdal and the same code works, except that it
>>> is necessary to skip  the default driver since it cannot manage large
>>> jp2 files.
>>>
>>> gdal_translate -of GTiff /path/to/input/S2_b1.jp2
>>>  /path/to/output/S2_b1converted.tif --config GDAL_SKIP JP2ECW
>>>
>>> Any idea how could I run this in R?
>>>
>>> Thanks
>>> M
>>>
>>>
>>>
>>> [[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 
> 
> 
> Email secured by Check Point
>


From mtreglia at gmail.com  Thu Mar 16 20:01:18 2017
From: mtreglia at gmail.com (Michael Treglia)
Date: Thu, 16 Mar 2017 15:01:18 -0400
Subject: [R-sig-Geo] Maintain SRID with st_write to postgis db
In-Reply-To: <454c0550-6b70-3569-5191-cd2120a7f4ed@uni-muenster.de>
References: <CAPKp32stHJ6d1smgTf6Y2pA+w=1khGcc1UmyUDgSo3mfs+DPsA@mail.gmail.com>
	<cc3d05b8-3f90-e861-c130-8364bf0e7e62@uni-muenster.de>
	<CAPKp32uLVs+WyBj+PZJiNcCCAfiEURMQFKubWs7qwpMUYETG5Q@mail.gmail.com>
	<CAPKp32t88vqbg60+tHNQF82CdW4YBFBDpWbdYF_FgV+9Y=nHBw@mail.gmail.com>
	<CAASFQpS6sHCSoCb6nN1nZQk=34wk_v7vqypWgGwpXhk3-tUaNQ@mail.gmail.com>
	<04e27abf-24db-a04f-3738-69f47ac4f4b7@uni-muenster.de>
	<CAASFQpQR64iu6KErWFNTH-9szrNW_vCg5FtMib4akwkSHJ5iOw@mail.gmail.com>
	<454c0550-6b70-3569-5191-cd2120a7f4ed@uni-muenster.de>
Message-ID: <CAPKp32sy054eM9NWw4V6eQz5V4HATR_b3fmhFg4o5r7n_7fuaA@mail.gmail.com>

Thanks again Edzer - I've got the dev version installed sucessfully
now, but new issue popped up: my st_write statement now throws an
error:


>st_write(nypd_crime_current.sf, dsn="PG:dbname=dbname user=user host=xx.xx.xx.xx", layer='health_safety.crime_current')

Writing layer `health_safety.crime_current' to data source
`PG:dbname=dbname user=user host=xx.xx.xx.xx' using driver
`PostgreSQL'
Dataset PG:dbname=dbname user=user host=xx.xx.xx.xx already exists;
remove first, or use update=TRUE to append.
Error in CPL_write_ogr(obj, dsn, layer, driver,
as.character(dataset_options),  :
  Dataset already exists.

> sessionInfo()
R version 3.3.1 (2016-06-21)
Platform: x86_64-pc-linux-gnu (64-bit)
Running under: Ubuntu 14.04.5 LTS

locale:
 [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
 [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
LC_PAPER=en_US.UTF-8       LC_NAME=C
 [9] LC_ADDRESS=C               LC_TELEPHONE=C
LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] RPostgreSQL_0.4-1 DBI_0.6           sf_0.4-0

loaded via a namespace (and not attached):
[1] magrittr_1.5  tools_3.3.1   units_0.4-2   Rcpp_0.12.9
udunits2_0.13 grid_3.3.1






The command works with the CRAN version of sf

> sessionInfo()
R version 3.3.1 (2016-06-21)
Platform: x86_64-pc-linux-gnu (64-bit)
Running under: Ubuntu 14.04.5 LTS

locale:
 [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
 [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
LC_PAPER=en_US.UTF-8       LC_NAME=C
 [9] LC_ADDRESS=C               LC_TELEPHONE=C
LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] sf_0.3-4

loaded via a namespace (and not attached):
[1] DBI_0.6       tools_3.3.1   units_0.4-2   Rcpp_0.12.9
udunits2_0.13 grid_3.3.1


(I realize st_write_db is an option, but not finding myself able to
specify a schema (it just gets written to public - if I name the table
'schema.tableName')

Sorry to keep bugging about this, and thanks again for these quick fixes!
mike

On Thu, Mar 16, 2017 at 11:15 AM, Edzer Pebesma
<edzer.pebesma at uni-muenster.de> wrote:
>
>
> On 16/03/17 14:53, chris english wrote:
>> Edzer,
>>
>> Installs fine now, though st_make_valid is useful when cleaning messy
>> inputs. I
>> just installed new ubuntu binaries for PostGIS last night but will
>> attend to rebuild
>> from source.
>>
>>  The only thing to come up in an otherwise smooth install:
>> ** preparing package for lazy loading
>> in method for ?coerce? with signature ?"Spatial","sf"?: no definition
>> for class ?Spatial?
>> in method for ?coerce? with signature ?"Spatial","sfc"?: no definition
>> for class ?Spatial?
>> in method for ?coerce? with signature ?"sf","Spatial"?: no definition
>> for class ?Spatial?
>> in method for ?coerce? with signature ?"sfc","Spatial"?: no definition
>> for class ?Spatial?
>> ** help
>> *** installing help indices
>> ** building package indices
>> ** installing vignettes
>> ** testing if installed package can be loaded
>> * DONE (sf)
>> Reloading installed sf
>> Linking to GEOS 3.4.2, GDAL 2.1.3, proj.4 4.9.1
>>
>> I'm guessing this refers to sp::Spatial-class as Spatial is capitalized.
>> I don't know
>> whether this will affect swapping in and out of sf <->sp, but include it
>> for completeness.
>
> You can safely ignore it.
>
> If `sf' would import `sp' it would go away, but there is no need to do
> so. Not importing packages makes it easier to understand where they are
> being used, and so limits the search for where things can go wrong.
>
>>
>> Thanks again,
>>
>> Chris
>>
>> On Thu, Mar 16, 2017 at 5:06 AM, Edzer Pebesma
>> <edzer.pebesma at uni-muenster.de <mailto:edzer.pebesma at uni-muenster.de>>
>> wrote:
>>
>>     Mike, Chris, the configure step should now pass regardless whether
>>     liblwgeom is present, or not; the error message was my mistake.
>>
>>     sf will link to liblwgeom when its development version is present (on
>>     ubuntu: liblwgeom-dev). If postgis is binary installed, liblwgeom may be
>>     present, but not its dev version (needed for header files); that case is
>>     now being caught too.
>>
>>     liblwgeom provides st_make_valid, essentially ST_makeValid in postgis;
>>     see https://github.com/edzer/sfr/issues/67
>>     <https://github.com/edzer/sfr/issues/67> . Since liblwgeom is not
>>     available on the CRAN build farms, it's presence is not required by sf.
>>
>>     Best regards,
>>
>>     On 16/03/17 05:46, chris english wrote:
>>     > Michael,
>>     >
>>     > I have the very same failure,
>>     >> library(sf)
>>     > Linking to GEOS 3.4.2, GDAL 2.1.3, proj.4 4.9.1
>>     > (pre upgrade attempt, which still works just fine)
>>     >
>>     > checking for geos_c.h... yes
>>     > checking geos: linking with -lgeos_c... yes
>>     > checking for lwgeom_version in -llwgeom... no
>>     > configure: error: in
>>     `/tmp/RtmpsCmf6B/devtoolsd68e68107a/edzer-sfr-d620f3b':
>>     > configure: error: lwgeom test failed (--without-readline to disable)
>>     >
>>     > I could nearly copy your install output though on 16.04, and the same
>>     > tangle of it depends on x but it won't be installed & etc.
>>     > But, if you have PostGIS, you have liblwgeom as it is fairly
>>     specific to
>>     > PostGIS. Perhaps, rather than a devtools::github_install,
>>     > a clone github lo a local directory and config, make, install might
>>     > work, but I'm just imagining.
>>     >
>>     > then testing:
>>     > config.log --snip --
>>     > configure:3993: checking for lwgeom_version in -llwgeom
>>     > configure:4018: gcc -std=gnu99 -o conftest -g -O2 -fstack-protector
>>     > --param=ssp-
>>     > buffer-size=4 -Wformat -Werror=format-security -D_FORTIFY_SOURCE=2 -g
>>     >  -I/usr/lo
>>     > cal/include   -I/usr/local/include -I/usr/local/include
>>     > -Wl,-Bsymbolic-functions
>>     >  -Wl,-z,relro conftest.c -llwgeom  -lproj  -L/usr/local/lib -lproj
>>     > -L/usr/loca
>>     > l/lib -lgdal -L/usr/local/lib -lgeos_c -lproj >&5
>>     > /tmp/ccDBUh1h.o: In function `main':
>>     > /home/chris/sfr/sfr/conftest.c:34: undefined reference to
>>     `lwgeom_version'
>>     > collect2: error: ld returned 1 exit status
>>     > configure:4018: $? = 1
>>     > configure: failed program was:
>>     > | /* confdefs.h */
>>     > | #define PACKAGE_NAME ""
>>     > | #define PACKAGE_TARNAME ""
>>     > | #define PACKAGE_VERSION ""
>>     > | #define PACKAGE_STRING ""
>>     > | #define PACKAGE_BUGREPORT ""
>>     > | #define PACKAGE_URL ""
>>     > | #define STDC_HEADERS 1
>>     > | #define HAVE_SYS_TYPES_H 1
>>     > | #define HAVE_SYS_STAT_H 1
>>     > | #define HAVE_STDLIB_H 1
>>     > | #define HAVE_STRING_H 1
>>     > | #define HAVE_MEMORY_H 1
>>     > | #define HAVE_STRINGS_H 1
>>     > | #define HAVE_INTTYPES_H 1
>>     > | #define HAVE_STDINT_H 1
>>     > | #define HAVE_UNISTD_H 1
>>     > | #define HAVE_GDAL_H 1
>>     > | #define HAVE_PROJ_API_H 1
>>     > | #define HAVE_LIBPROJ 1
>>     > | #define HAVE_GEOS_C_H 1
>>     > | /* end confdefs.h.  */
>>     > |
>>     > | /* Override any GCC internal prototype to avoid an error.
>>     > |    Use char because int might match the return type of a GCC
>>     > |    builtin and then its argument prototype would still apply.  */
>>     > | #ifdef __cplusplus
>>     > | extern "C"
>>     > | #endif
>>     > | char lwgeom_version ();
>>     > | int
>>     > | main ()
>>     > | {
>>     > | return lwgeom_version ();
>>     > |   ;
>>     > |   return 0;
>>     > | }
>>     > configure:4027: result: no
>>     > configure:4036: error: in `/home/chris/sfr/sfr':
>>     > configure:4038: error: lwgeom test failed (--without-readline to
>>     disable)
>>     > See `config.log' for more details
>>     >
>>     > so, it may or may not be the presence or absence of liblwgeom but
>>     simply
>>     > an undefined reference as suggested above:
>>     >
>>     > /home/chris/sfr/sfr/conftest.c:34: undefined reference to
>>     `lwgeom_version' ,
>>     >
>>     > but I'm unclear how the version was being requested (well, I can
>>     kind of
>>     > guess)
>>     > but failing on undefined reference suggests it is not the version
>>     per se
>>     > that may
>>     > or may not be present (though is because you are using PostGIS),
>>     but how
>>     > the version was requested. I intuit.
>>     >
>>     > Ah, and reading  /* confdefs.h */, that it indeed ends with #define
>>     > HAVE_GEOS_C_H 1,
>>     > and indeed, conftest.c:34: would have an  undefined reference to
>>     > `lwgeom_version'.
>>     >
>>     > And I've said as much as I understand.
>>     >
>>     > Chris
>>     >
>>     > On Wed, Mar 15, 2017 at 7:53 PM, Michael Treglia
>>     <mtreglia at gmail.com <mailto:mtreglia at gmail.com>
>>     > <mailto:mtreglia at gmail.com <mailto:mtreglia at gmail.com>>> wrote:
>>     >
>>     >     Sorry - this follow-up isn't entirely an R question, so if
>>     best to take
>>     >     this off list, let me know:
>>     >
>>     >     Installing the dev version from github fails for me (installing on
>>     >     ubuntu
>>     >     14.04.5) - I've included the output from the install process
>>     below -
>>     >     seems
>>     >     to fail due to failed check for liblwgeom version.
>>     >
>>     >     Looks like I don't have liblwgeom installed - and when I try
>>     (via sudo
>>     >     apt-get install liblwgeom-2.3-0), it indicates it requires
>>     libgeos-c1.
>>     >     Installing libgeos-c1, however, requires removal of a newer
>>     version of
>>     >     libgeos (libgeos-c1v5), which other FOSS GIS tools depend on (at
>>     >     least if
>>     >     my understanding is correct).  Is there a way around this?
>>     Sorry if I'm
>>     >     just missing something, and thanks again for input.
>>     >     mike
>>     >
>>     >
>>     >
>>     >     #Output of install from github
>>     >     > install_github("edzer/sfr")
>>     >     Downloading GitHub repo edzer/sfr at master
>>     >     from URL https://api.github.com/repos/edzer/sfr/zipball/master
>>     <https://api.github.com/repos/edzer/sfr/zipball/master>
>>     >     <https://api.github.com/repos/edzer/sfr/zipball/master
>>     <https://api.github.com/repos/edzer/sfr/zipball/master>>
>>     >     Installing sf
>>     >     '/usr/lib/R/bin/R' --no-site-file --no-environ --no-save
>>     --no-restore
>>     >     --quiet  \
>>     >       CMD INSTALL
>>     '/tmp/RtmpKLmhyt/devtools9fd11eb9c3/edzer-sfr-d620f3b'  \
>>     >       --library='/home/mlt244/R/x86_64-pc-linux-gnu-library/3.3'
>>     >     --install-tests
>>     >
>>     >     * installing *source* package ?sf? ...
>>     >     configure: CC: gcc -std=gnu99
>>     >     configure: CXX: g++
>>     >     configure: :
>>     >     checking for gdal-config... /usr/bin/gdal-config
>>     >     checking gdal-config usability... yes
>>     >     configure: GDAL: 2.1.0
>>     >     checking GDAL version >= 2.0.0... yes
>>     >     checking for gcc... gcc -std=gnu99
>>     >     checking whether the C compiler works... yes
>>     >     checking for C compiler default output file name... a.out
>>     >     checking for suffix of executables...
>>     >     checking whether we are cross compiling... no
>>     >     checking for suffix of object files... o
>>     >     checking whether we are using the GNU C compiler... yes
>>     >     checking whether gcc -std=gnu99 accepts -g... yes
>>     >     checking for gcc -std=gnu99 option to accept ISO C89... none
>>     needed
>>     >     checking how to run the C preprocessor... gcc -std=gnu99 -E
>>     >     checking for grep that handles long lines and -e... /bin/grep
>>     >     checking for egrep... /bin/grep -E
>>     >     checking for ANSI C header files... yes
>>     >     checking for sys/types.h... yes
>>     >     checking for sys/stat.h... yes
>>     >     checking for stdlib.h... yes
>>     >     checking for string.h... yes
>>     >     checking for memory.h... yes
>>     >     checking for strings.h... yes
>>     >     checking for inttypes.h... yes
>>     >     checking for stdint.h... yes
>>     >     checking for unistd.h... yes
>>     >     checking gdal.h usability... yes
>>     >     checking gdal.h presence... yes
>>     >     checking for gdal.h... yes
>>     >     checking GDAL: linking with --libs only... yes
>>     >     checking GDAL: /usr/share/gdal/2.1/pcs.csv readable... yes
>>     >     checking GDAL: checking whether PROJ.4 is available for
>>     linking:... yes
>>     >     checking GDAL: checking whether PROJ.4 is available fur
>>     running:... yes
>>     >     checking proj_api.h usability... yes
>>     >     checking proj_api.h presence... yes
>>     >     checking for proj_api.h... yes
>>     >     checking for pj_init_plus in -lproj... yes
>>     >     checking PROJ.4: epsg found and readable... yes
>>     >     proj_conf_test.c: In function 'main':
>>     >     proj_conf_test.c:5:5: error: unknown type name 'PAFile'
>>     >          PAFile fp;
>>     >          ^
>>     >     proj_conf_test.c:8:5: warning: implicit declaration of function
>>     >     'pj_open_lib' [-Wimplicit-function-declaration]
>>     >          fp = pj_open_lib(ctx, "conus", "rb");
>>     >          ^
>>     >     proj_conf_test.c:9:12: warning: comparison between pointer and
>>     integer
>>     >     [enabled by default]
>>     >          if (fp == NULL) exit(1);
>>     >                 ^
>>     >     proj_conf_test.c:10:5: warning: implicit declaration of function
>>     >     'pj_ctx_fclose' [-Wimplicit-function-declaration]
>>     >          pj_ctx_fclose(ctx, fp);
>>     >          ^
>>     >     ./configure: line 3834: ./proj_conf_test: No such file or
>>     directory
>>     >     checking PROJ.4: conus found and readable... yes
>>     >     checking geos-config usability... yes
>>     >     configure: GEOS: 3.5.0
>>     >     checking GEOS version >= 3.3.0... yes
>>     >     checking geos_c.h usability... yes
>>     >     checking geos_c.h presence... yes
>>     >     checking for geos_c.h... yes
>>     >     checking geos: linking with -lgeos_c... yes
>>     >     checking for lwgeom_version in -llwgeom... no
>>     >     configure: error: in
>>     >     `/tmp/RtmpKLmhyt/devtools9fd11eb9c3/edzer-sfr-d620f3b':
>>     >     configure: error: lwgeom test failed (--without-readline to
>>     disable)
>>     >     See `config.log' for more details
>>     >     ERROR: configuration failed for package ?sf?
>>     >     * removing ?/home/mlt244/R/x86_64-pc-linux-gnu-library/3.3/sf?
>>     >     * restoring previous
>>     ?/home/mlt244/R/x86_64-pc-linux-gnu-library/3.3/sf?
>>     >     Error: Command failed (1)
>>     >
>>     >
>>     >     On Wed, Mar 15, 2017 at 6:14 PM, Michael Treglia
>>     <mtreglia at gmail.com <mailto:mtreglia at gmail.com>
>>     >     <mailto:mtreglia at gmail.com <mailto:mtreglia at gmail.com>>> wrote:
>>     >
>>     >     > Wow - thanks so much for this quick fix, Edzer! I like your
>>     >     solution to
>>     >     > having syntatically different but semantically identical
>>     >     proj4string. Will
>>     >     > try this in a bit, and write back if I have any issues.
>>     >     > Best,
>>     >     > mike
>>     >     >
>>     >     > On Wed, Mar 15, 2017 at 5:58 PM, Edzer Pebesma <
>>     >     > edzer.pebesma at uni-muenster.de <mailto:edzer.pebesma at uni-muenster.de>
>>     >     <mailto:edzer.pebesma at uni-muenster.de
>>     <mailto:edzer.pebesma at uni-muenster.de>>> wrote:
>>     >     >
>>     >     >> Great question! Short answer: now solved in the dev version on
>>     >     github;
>>     >     >> data are written directly to postgis having epsg 2263.
>>     >     >>
>>     >     >>
>>     >     >> Long answer:
>>     >     >>
>>     >     >> I believe this was caused by gdal and proj.4 doing different
>>     >     things when
>>     >     >> resolving epsg codes to proj4strings. sf uses proj.4 for
>>     this. When
>>     >     >> writing a proj4string either gdal or postgis don't
>>     recognize the
>>     >     >> proj4string that proj.4 returns on the epsg code. Neither
>>     gdal nor
>>     >     >> postgis understand that syntactically different
>>     proj4strings may be
>>     >     >> semantically identical.
>>     >     >>
>>     >     >>
>>     >     >> After running your example, in postgis
>>     >     >>
>>     >     >> # select proj4text from spatial_ref_sys where SRID = 900914;
>>     >     >>
>>     >     >> gives:
>>     >     >>
>>     >     >>  +proj=lcc +lat_1=41.03333333333333 +lat_2=40.66666666666666
>>     >     >> +lat_0=40.16666666666666 +lon_0=-74 +x_0=300000 +y_0=0
>>     +ellps=GRS80
>>     >     >> +towgs84=0,0,0,0,0,0,0 +units=us-ft +no_defs
>>     >     >>
>>     >     >> # select proj4text from spatial_ref_sys where SRID = 2263;
>>     >     >>
>>     >     >> gives:
>>     >     >>
>>     >     >>  +proj=lcc +lat_1=41.03333333333333 +lat_2=40.66666666666666
>>     >     >> +lat_0=40.16666666666666 +lon_0=-74 +x_0=300000.0000000001
>>     +y_0=0
>>     >     >> +datum=NAD83 +units=us-ft +no_defs
>>     >     >>
>>     >     >> sf causes this:
>>     >     >>
>>     >     >> > st_crs(2263)
>>     >     >> $epsg
>>     >     >> [1] 2263
>>     >     >>
>>     >     >> $proj4string
>>     >     >> [1] "+proj=lcc +lat_1=41.03333333333333
>>     +lat_2=40.66666666666666
>>     >     >> +lat_0=40.16666666666666 +lon_0=-74 +x_0=300000.0000000001
>>     +y_0=0
>>     >     >> +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=us-ft +no_defs"
>>     >     >>
>>     >     >> attr(,"class")
>>     >     >> [1] "crs"
>>     >     >>
>>     >     >> because it uses proj.4 directly to resolve SRID strings:
>>     >     >>
>>     >     >> /usr/share/proj/epsg has:
>>     >     >>
>>     >     >> # NAD83 / New York Long Island (ftUS)
>>     >     >> <2263> +proj=lcc +lat_1=41.03333333333333
>>     +lat_2=40.66666666666666
>>     >     >> +lat_0=40.16666666666666 +lon_0=-74 +x_0=300000.0000000001
>>     +y_0=0
>>     >     >> +datum=NAD83 +units=us-ft +no_defs  <>
>>     >     >>
>>     >     >>
>>     >     >> The change I made to sf (
>>     >     >>
>>     https://github.com/edzer/sfr/commit/d620f3b748d487bae910e388
>>     <https://github.com/edzer/sfr/commit/d620f3b748d487bae910e388>
>>     >     <https://github.com/edzer/sfr/commit/d620f3b748d487bae910e388
>>     <https://github.com/edzer/sfr/commit/d620f3b748d487bae910e388>>
>>     >     >> 4c554fa9e3ce7090)
>>     >     >> now first asks gdal to resolve the epsg (in case it is not
>>     NA), and
>>     >     >> otherwise resolve the proj4string (if not NA), instead of ONLY
>>     >     trying to
>>     >     >> resolve a non-NA proj4string.
>>     >     >>
>>     >     >> On 15/03/17 20:50, Michael Treglia wrote:
>>     >     >> > Hi All,
>>     >     >> >
>>     >     >> > Been working to import and manipulate a CSV file with
>>     point data
>>     >     >> > (lat/long), and then export to a PostGIS db.
>>     >     >> >
>>     >     >> > Overall, successful, but one thing I'd like to fix - when I
>>     >     write out
>>     >     >> the
>>     >     >> > layer to postgis, the SRID is not maintained. The final
>>     EPSG/SRID
>>     >     >> should be
>>     >     >> > 2263, but when I check in PostGIS, it comes up as 900914.
>>     >     >> >
>>     >     >> > Below is my code and sessionInfo, and the data are from here:
>>     >     >> >
>>     https://data.cityofnewyork.us/Public-Safety/NYPD-Complaint-D
>>     <https://data.cityofnewyork.us/Public-Safety/NYPD-Complaint-D>
>>     >     <https://data.cityofnewyork.us/Public-Safety/NYPD-Complaint-D
>>     <https://data.cityofnewyork.us/Public-Safety/NYPD-Complaint-D>>
>>     >     >> ata-Current-YTD/5uac-w243
>>     >     >> > (downloaded as plain old CSV)
>>     >     >> >
>>     >     >> > Anything I might be missing? Thanks in advance for giving a
>>     >     quick look!
>>     >     >> > Mike
>>     >     >> >
>>     >     >> >
>>     >     >> > ##Start Code
>>     >     >> >
>>     >     >> > #load packages
>>     >     >> > library(sf)
>>     >     >> > library(RPostgreSQL)
>>     >     >> >
>>     >     >> > #read data
>>     >     >> > crime_current <-
>>     read.csv("NYPD_Complaint_Data_Current_YTD.csv",
>>     >     >> > stringsAsFactors = FALSE)
>>     >     >> >
>>     >     >> > #format time columns for easier reading in postgres (I
>>     think), as
>>     >     >> keeping
>>     >     >> > as date format caused problems in export
>>     >     >> > crime_current$CMPLNT_FR_TIME <-
>>     >     >> > as.character(as.POSIXct(paste(crime_current$CMPLNT_FR_DT,
>>     >     >> > crime_current$CMPLNT_FR_TM), format="%m/%d/%Y\ %H:%M",
>>     tz=""))
>>     >     >> > crime_current$CMPLNT_TO_TIME <-
>>     >     >> > as.character(as.POSIXct(paste(crime_current$CMPLNT_TO_DT,
>>     >     >> > crime_current$CMPLNT_TO_TM), format="%m/%d/%Y\ %H:%M",
>>     tz=""))
>>     >     >> > crime_current$RPT_DT <-
>>     >     as.character(as.POSIXct(crime_current$RPT_DT,
>>     >     >> > format="%m/%d/%Y", tz=""))
>>     >     >> >
>>     >     >> > #convert to sf object
>>     >     >> > crime_current.sf <- st_as_sf(crime_current, coords =
>>     c("Longitude",
>>     >     >> > "Latitude"), crs = 4326)
>>     >     >> > #reproject to EPSG 2263
>>     >     >> > crime_current.sf <- st_transform(crime_current.sf, crs=2263)
>>     >     >> >
>>     >     >> > #write to postgres
>>     >     >> > st_write(crime_current.sf, "PG:dbname=mydb user=user
>>     >     host=xx.xx.xx.xx",
>>     >     >> > 'health_safety.crime_current')
>>     >     >> > ###End Code
>>     >     >> >
>>     >     >> >
>>     >     >> >
>>     >     >> >> sessionInfo()
>>     >     >> > R version 3.3.1 (2016-06-21)
>>     >     >> > Platform: x86_64-pc-linux-gnu (64-bit)
>>     >     >> > Running under: Ubuntu 14.04.5 LTS
>>     >     >> >
>>     >     >> > locale:
>>     >     >> >  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
>>     >     >> > LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
>>     >     >> >  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
>>     >     >> >  LC_PAPER=en_US.UTF-8       LC_NAME=C
>>     >     >> >  [9] LC_ADDRESS=C               LC_TELEPHONE=C
>>     >     >> > LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C
>>     >     >> >
>>     >     >> > attached base packages:
>>     >     >> > [1] stats     graphics  grDevices utils     datasets  methods
>>     >      base
>>     >     >> >
>>     >     >> > other attached packages:
>>     >     >> > [1] sp_1.2-3          RPostgreSQL_0.4-1 DBI_0.6
>>      sf_0.3-4
>>     >     >> >
>>     >     >> > loaded via a namespace (and not attached):
>>     >     >> > [1] tools_3.3.1     units_0.4-2     Rcpp_0.12.9
>>      udunits2_0.13
>>     >     >> > grid_3.3.1      lattice_0.20-33
>>     >     >> >
>>     >     >> >       [[alternative HTML version deleted]]
>>     >     >> >
>>     >     >> > _______________________________________________
>>     >     >> > R-sig-Geo mailing list
>>     >     >> > R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
>>     <mailto:R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>>
>>     >     >> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>     <https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
>>     >     <https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>     <https://stat.ethz.ch/mailman/listinfo/r-sig-geo>>
>>     >     >> >
>>     >     >>
>>     >     >> --
>>     >     >> Edzer Pebesma
>>     >     >> Institute for Geoinformatics  (ifgi),  University of M?nster
>>     >     >> Heisenbergstra?e 2, 48149 M?nster, Germany; +49 251 83 33081 <tel:%2B49%20251%2083%2033081>
>>     >     <tel:%2B49%20251%2083%2033081>
>>     >     >> Journal of Statistical Software:   http://www.jstatsoft.org/
>>     >     >> Computers & Geosciences:   http://elsevier.com/locate/cageo/ <http://elsevier.com/locate/cageo/>
>>     >     <http://elsevier.com/locate/cageo/ <http://elsevier.com/locate/cageo/>>
>>     >     >>
>>     >     >>
>>     >     >> _______________________________________________
>>     >     >> R-sig-Geo mailing list
>>     >     >> R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
>>     <mailto:R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>>
>>     >     >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>     <https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
>>     >     <https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>     <https://stat.ethz.ch/mailman/listinfo/r-sig-geo>>
>>     >     >>
>>     >     >
>>     >     >
>>     >
>>     >             [[alternative HTML version deleted]]
>>     >
>>     >     _______________________________________________
>>     >     R-sig-Geo mailing list
>>     >     R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
>>     <mailto:R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>>
>>     >     https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>     <https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
>>     >     <https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>     <https://stat.ethz.ch/mailman/listinfo/r-sig-geo>>
>>     >
>>     >
>>
>>     --
>>     Edzer Pebesma
>>     Institute for Geoinformatics  (ifgi),  University of M?nster
>>     Heisenbergstra?e 2, 48149 M?nster, Germany; +49 251 83 33081
>>     <tel:%2B49%20251%2083%2033081>
>>     Journal of Statistical Software:   http://www.jstatsoft.org/
>>     Computers & Geosciences:   http://elsevier.com/locate/cageo/
>>     <http://elsevier.com/locate/cageo/>
>>
>>
>
> --
> Edzer Pebesma
> Institute for Geoinformatics  (ifgi),  University of M?nster
> Heisenbergstra?e 2, 48149 M?nster, Germany; +49 251 83 33081
> Journal of Statistical Software:   http://www.jstatsoft.org/
> Computers & Geosciences:   http://elsevier.com/locate/cageo/
>


From edzer.pebesma at uni-muenster.de  Thu Mar 16 22:17:45 2017
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Thu, 16 Mar 2017 22:17:45 +0100
Subject: [R-sig-Geo] Maintain SRID with st_write to postgis db
In-Reply-To: <CAPKp32sy054eM9NWw4V6eQz5V4HATR_b3fmhFg4o5r7n_7fuaA@mail.gmail.com>
References: <CAPKp32stHJ6d1smgTf6Y2pA+w=1khGcc1UmyUDgSo3mfs+DPsA@mail.gmail.com>
	<cc3d05b8-3f90-e861-c130-8364bf0e7e62@uni-muenster.de>
	<CAPKp32uLVs+WyBj+PZJiNcCCAfiEURMQFKubWs7qwpMUYETG5Q@mail.gmail.com>
	<CAPKp32t88vqbg60+tHNQF82CdW4YBFBDpWbdYF_FgV+9Y=nHBw@mail.gmail.com>
	<CAASFQpS6sHCSoCb6nN1nZQk=34wk_v7vqypWgGwpXhk3-tUaNQ@mail.gmail.com>
	<04e27abf-24db-a04f-3738-69f47ac4f4b7@uni-muenster.de>
	<CAASFQpQR64iu6KErWFNTH-9szrNW_vCg5FtMib4akwkSHJ5iOw@mail.gmail.com>
	<454c0550-6b70-3569-5191-cd2120a7f4ed@uni-muenster.de>
	<CAPKp32sy054eM9NWw4V6eQz5V4HATR_b3fmhFg4o5r7n_7fuaA@mail.gmail.com>
Message-ID: <8bb40c90-a894-8fea-5d45-9137fc22b665@uni-muenster.de>



On 16/03/17 20:01, Michael Treglia wrote:
> Thanks again Edzer - I've got the dev version installed sucessfully
> now, but new issue popped up: my st_write statement now throws an
> error:
> 
> 
>> st_write(nypd_crime_current.sf, dsn="PG:dbname=dbname user=user host=xx.xx.xx.xx", layer='health_safety.crime_current')
> 
> Writing layer `health_safety.crime_current' to data source
> `PG:dbname=dbname user=user host=xx.xx.xx.xx' using driver
> `PostgreSQL'
> Dataset PG:dbname=dbname user=user host=xx.xx.xx.xx already exists;
> remove first, or use update=TRUE to append.

with update=TRUE it will work.

So far, sf would simply overwrite existing files on st_write(), which is
not exactly a good idea, always - rgdal::writeOGR is much more careful.
I changed it this way now, but agree that it is not very satisfactory if
dsn is a database, which is expected to exist, so I expect the
requirement to add `update=TRUE' to disappear in a future release for
database dsn's.

more further down:

> Error in CPL_write_ogr(obj, dsn, layer, driver,
> as.character(dataset_options),  :
>   Dataset already exists.
> 
>> sessionInfo()
> R version 3.3.1 (2016-06-21)
> Platform: x86_64-pc-linux-gnu (64-bit)
> Running under: Ubuntu 14.04.5 LTS
> 
> locale:
>  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
> LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
>  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
> LC_PAPER=en_US.UTF-8       LC_NAME=C
>  [9] LC_ADDRESS=C               LC_TELEPHONE=C
> LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C
> 
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
> 
> other attached packages:
> [1] RPostgreSQL_0.4-1 DBI_0.6           sf_0.4-0
> 
> loaded via a namespace (and not attached):
> [1] magrittr_1.5  tools_3.3.1   units_0.4-2   Rcpp_0.12.9
> udunits2_0.13 grid_3.3.1
> 
> 
> 
> 
> 
> 
> The command works with the CRAN version of sf
> 
>> sessionInfo()
> R version 3.3.1 (2016-06-21)
> Platform: x86_64-pc-linux-gnu (64-bit)
> Running under: Ubuntu 14.04.5 LTS
> 
> locale:
>  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
> LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
>  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
> LC_PAPER=en_US.UTF-8       LC_NAME=C
>  [9] LC_ADDRESS=C               LC_TELEPHONE=C
> LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C
> 
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
> 
> other attached packages:
> [1] sf_0.3-4
> 
> loaded via a namespace (and not attached):
> [1] DBI_0.6       tools_3.3.1   units_0.4-2   Rcpp_0.12.9
> udunits2_0.13 grid_3.3.1
> 
> 
> (I realize st_write_db is an option, but not finding myself able to
> specify a schema (it just gets written to public - if I name the table
> 'schema.tableName')

try table = c("schema", "table")

> 
> Sorry to keep bugging about this, and thanks again for these quick fixes!
> mike
> 
> On Thu, Mar 16, 2017 at 11:15 AM, Edzer Pebesma
> <edzer.pebesma at uni-muenster.de> wrote:
>>
>>
>> On 16/03/17 14:53, chris english wrote:
>>> Edzer,
>>>
>>> Installs fine now, though st_make_valid is useful when cleaning messy
>>> inputs. I
>>> just installed new ubuntu binaries for PostGIS last night but will
>>> attend to rebuild
>>> from source.
>>>
>>>  The only thing to come up in an otherwise smooth install:
>>> ** preparing package for lazy loading
>>> in method for ?coerce? with signature ?"Spatial","sf"?: no definition
>>> for class ?Spatial?
>>> in method for ?coerce? with signature ?"Spatial","sfc"?: no definition
>>> for class ?Spatial?
>>> in method for ?coerce? with signature ?"sf","Spatial"?: no definition
>>> for class ?Spatial?
>>> in method for ?coerce? with signature ?"sfc","Spatial"?: no definition
>>> for class ?Spatial?
>>> ** help
>>> *** installing help indices
>>> ** building package indices
>>> ** installing vignettes
>>> ** testing if installed package can be loaded
>>> * DONE (sf)
>>> Reloading installed sf
>>> Linking to GEOS 3.4.2, GDAL 2.1.3, proj.4 4.9.1
>>>
>>> I'm guessing this refers to sp::Spatial-class as Spatial is capitalized.
>>> I don't know
>>> whether this will affect swapping in and out of sf <->sp, but include it
>>> for completeness.
>>
>> You can safely ignore it.
>>
>> If `sf' would import `sp' it would go away, but there is no need to do
>> so. Not importing packages makes it easier to understand where they are
>> being used, and so limits the search for where things can go wrong.
>>
>>>
>>> Thanks again,
>>>
>>> Chris
>>>
>>> On Thu, Mar 16, 2017 at 5:06 AM, Edzer Pebesma
>>> <edzer.pebesma at uni-muenster.de <mailto:edzer.pebesma at uni-muenster.de>>
>>> wrote:
>>>
>>>     Mike, Chris, the configure step should now pass regardless whether
>>>     liblwgeom is present, or not; the error message was my mistake.
>>>
>>>     sf will link to liblwgeom when its development version is present (on
>>>     ubuntu: liblwgeom-dev). If postgis is binary installed, liblwgeom may be
>>>     present, but not its dev version (needed for header files); that case is
>>>     now being caught too.
>>>
>>>     liblwgeom provides st_make_valid, essentially ST_makeValid in postgis;
>>>     see https://github.com/edzer/sfr/issues/67
>>>     <https://github.com/edzer/sfr/issues/67> . Since liblwgeom is not
>>>     available on the CRAN build farms, it's presence is not required by sf.
>>>
>>>     Best regards,
>>>
>>>     On 16/03/17 05:46, chris english wrote:
>>>     > Michael,
>>>     >
>>>     > I have the very same failure,
>>>     >> library(sf)
>>>     > Linking to GEOS 3.4.2, GDAL 2.1.3, proj.4 4.9.1
>>>     > (pre upgrade attempt, which still works just fine)
>>>     >
>>>     > checking for geos_c.h... yes
>>>     > checking geos: linking with -lgeos_c... yes
>>>     > checking for lwgeom_version in -llwgeom... no
>>>     > configure: error: in
>>>     `/tmp/RtmpsCmf6B/devtoolsd68e68107a/edzer-sfr-d620f3b':
>>>     > configure: error: lwgeom test failed (--without-readline to disable)
>>>     >
>>>     > I could nearly copy your install output though on 16.04, and the same
>>>     > tangle of it depends on x but it won't be installed & etc.
>>>     > But, if you have PostGIS, you have liblwgeom as it is fairly
>>>     specific to
>>>     > PostGIS. Perhaps, rather than a devtools::github_install,
>>>     > a clone github lo a local directory and config, make, install might
>>>     > work, but I'm just imagining.
>>>     >
>>>     > then testing:
>>>     > config.log --snip --
>>>     > configure:3993: checking for lwgeom_version in -llwgeom
>>>     > configure:4018: gcc -std=gnu99 -o conftest -g -O2 -fstack-protector
>>>     > --param=ssp-
>>>     > buffer-size=4 -Wformat -Werror=format-security -D_FORTIFY_SOURCE=2 -g
>>>     >  -I/usr/lo
>>>     > cal/include   -I/usr/local/include -I/usr/local/include
>>>     > -Wl,-Bsymbolic-functions
>>>     >  -Wl,-z,relro conftest.c -llwgeom  -lproj  -L/usr/local/lib -lproj
>>>     > -L/usr/loca
>>>     > l/lib -lgdal -L/usr/local/lib -lgeos_c -lproj >&5
>>>     > /tmp/ccDBUh1h.o: In function `main':
>>>     > /home/chris/sfr/sfr/conftest.c:34: undefined reference to
>>>     `lwgeom_version'
>>>     > collect2: error: ld returned 1 exit status
>>>     > configure:4018: $? = 1
>>>     > configure: failed program was:
>>>     > | /* confdefs.h */
>>>     > | #define PACKAGE_NAME ""
>>>     > | #define PACKAGE_TARNAME ""
>>>     > | #define PACKAGE_VERSION ""
>>>     > | #define PACKAGE_STRING ""
>>>     > | #define PACKAGE_BUGREPORT ""
>>>     > | #define PACKAGE_URL ""
>>>     > | #define STDC_HEADERS 1
>>>     > | #define HAVE_SYS_TYPES_H 1
>>>     > | #define HAVE_SYS_STAT_H 1
>>>     > | #define HAVE_STDLIB_H 1
>>>     > | #define HAVE_STRING_H 1
>>>     > | #define HAVE_MEMORY_H 1
>>>     > | #define HAVE_STRINGS_H 1
>>>     > | #define HAVE_INTTYPES_H 1
>>>     > | #define HAVE_STDINT_H 1
>>>     > | #define HAVE_UNISTD_H 1
>>>     > | #define HAVE_GDAL_H 1
>>>     > | #define HAVE_PROJ_API_H 1
>>>     > | #define HAVE_LIBPROJ 1
>>>     > | #define HAVE_GEOS_C_H 1
>>>     > | /* end confdefs.h.  */
>>>     > |
>>>     > | /* Override any GCC internal prototype to avoid an error.
>>>     > |    Use char because int might match the return type of a GCC
>>>     > |    builtin and then its argument prototype would still apply.  */
>>>     > | #ifdef __cplusplus
>>>     > | extern "C"
>>>     > | #endif
>>>     > | char lwgeom_version ();
>>>     > | int
>>>     > | main ()
>>>     > | {
>>>     > | return lwgeom_version ();
>>>     > |   ;
>>>     > |   return 0;
>>>     > | }
>>>     > configure:4027: result: no
>>>     > configure:4036: error: in `/home/chris/sfr/sfr':
>>>     > configure:4038: error: lwgeom test failed (--without-readline to
>>>     disable)
>>>     > See `config.log' for more details
>>>     >
>>>     > so, it may or may not be the presence or absence of liblwgeom but
>>>     simply
>>>     > an undefined reference as suggested above:
>>>     >
>>>     > /home/chris/sfr/sfr/conftest.c:34: undefined reference to
>>>     `lwgeom_version' ,
>>>     >
>>>     > but I'm unclear how the version was being requested (well, I can
>>>     kind of
>>>     > guess)
>>>     > but failing on undefined reference suggests it is not the version
>>>     per se
>>>     > that may
>>>     > or may not be present (though is because you are using PostGIS),
>>>     but how
>>>     > the version was requested. I intuit.
>>>     >
>>>     > Ah, and reading  /* confdefs.h */, that it indeed ends with #define
>>>     > HAVE_GEOS_C_H 1,
>>>     > and indeed, conftest.c:34: would have an  undefined reference to
>>>     > `lwgeom_version'.
>>>     >
>>>     > And I've said as much as I understand.
>>>     >
>>>     > Chris
>>>     >
>>>     > On Wed, Mar 15, 2017 at 7:53 PM, Michael Treglia
>>>     <mtreglia at gmail.com <mailto:mtreglia at gmail.com>
>>>     > <mailto:mtreglia at gmail.com <mailto:mtreglia at gmail.com>>> wrote:
>>>     >
>>>     >     Sorry - this follow-up isn't entirely an R question, so if
>>>     best to take
>>>     >     this off list, let me know:
>>>     >
>>>     >     Installing the dev version from github fails for me (installing on
>>>     >     ubuntu
>>>     >     14.04.5) - I've included the output from the install process
>>>     below -
>>>     >     seems
>>>     >     to fail due to failed check for liblwgeom version.
>>>     >
>>>     >     Looks like I don't have liblwgeom installed - and when I try
>>>     (via sudo
>>>     >     apt-get install liblwgeom-2.3-0), it indicates it requires
>>>     libgeos-c1.
>>>     >     Installing libgeos-c1, however, requires removal of a newer
>>>     version of
>>>     >     libgeos (libgeos-c1v5), which other FOSS GIS tools depend on (at
>>>     >     least if
>>>     >     my understanding is correct).  Is there a way around this?
>>>     Sorry if I'm
>>>     >     just missing something, and thanks again for input.
>>>     >     mike
>>>     >
>>>     >
>>>     >
>>>     >     #Output of install from github
>>>     >     > install_github("edzer/sfr")
>>>     >     Downloading GitHub repo edzer/sfr at master
>>>     >     from URL https://api.github.com/repos/edzer/sfr/zipball/master
>>>     <https://api.github.com/repos/edzer/sfr/zipball/master>
>>>     >     <https://api.github.com/repos/edzer/sfr/zipball/master
>>>     <https://api.github.com/repos/edzer/sfr/zipball/master>>
>>>     >     Installing sf
>>>     >     '/usr/lib/R/bin/R' --no-site-file --no-environ --no-save
>>>     --no-restore
>>>     >     --quiet  \
>>>     >       CMD INSTALL
>>>     '/tmp/RtmpKLmhyt/devtools9fd11eb9c3/edzer-sfr-d620f3b'  \
>>>     >       --library='/home/mlt244/R/x86_64-pc-linux-gnu-library/3.3'
>>>     >     --install-tests
>>>     >
>>>     >     * installing *source* package ?sf? ...
>>>     >     configure: CC: gcc -std=gnu99
>>>     >     configure: CXX: g++
>>>     >     configure: :
>>>     >     checking for gdal-config... /usr/bin/gdal-config
>>>     >     checking gdal-config usability... yes
>>>     >     configure: GDAL: 2.1.0
>>>     >     checking GDAL version >= 2.0.0... yes
>>>     >     checking for gcc... gcc -std=gnu99
>>>     >     checking whether the C compiler works... yes
>>>     >     checking for C compiler default output file name... a.out
>>>     >     checking for suffix of executables...
>>>     >     checking whether we are cross compiling... no
>>>     >     checking for suffix of object files... o
>>>     >     checking whether we are using the GNU C compiler... yes
>>>     >     checking whether gcc -std=gnu99 accepts -g... yes
>>>     >     checking for gcc -std=gnu99 option to accept ISO C89... none
>>>     needed
>>>     >     checking how to run the C preprocessor... gcc -std=gnu99 -E
>>>     >     checking for grep that handles long lines and -e... /bin/grep
>>>     >     checking for egrep... /bin/grep -E
>>>     >     checking for ANSI C header files... yes
>>>     >     checking for sys/types.h... yes
>>>     >     checking for sys/stat.h... yes
>>>     >     checking for stdlib.h... yes
>>>     >     checking for string.h... yes
>>>     >     checking for memory.h... yes
>>>     >     checking for strings.h... yes
>>>     >     checking for inttypes.h... yes
>>>     >     checking for stdint.h... yes
>>>     >     checking for unistd.h... yes
>>>     >     checking gdal.h usability... yes
>>>     >     checking gdal.h presence... yes
>>>     >     checking for gdal.h... yes
>>>     >     checking GDAL: linking with --libs only... yes
>>>     >     checking GDAL: /usr/share/gdal/2.1/pcs.csv readable... yes
>>>     >     checking GDAL: checking whether PROJ.4 is available for
>>>     linking:... yes
>>>     >     checking GDAL: checking whether PROJ.4 is available fur
>>>     running:... yes
>>>     >     checking proj_api.h usability... yes
>>>     >     checking proj_api.h presence... yes
>>>     >     checking for proj_api.h... yes
>>>     >     checking for pj_init_plus in -lproj... yes
>>>     >     checking PROJ.4: epsg found and readable... yes
>>>     >     proj_conf_test.c: In function 'main':
>>>     >     proj_conf_test.c:5:5: error: unknown type name 'PAFile'
>>>     >          PAFile fp;
>>>     >          ^
>>>     >     proj_conf_test.c:8:5: warning: implicit declaration of function
>>>     >     'pj_open_lib' [-Wimplicit-function-declaration]
>>>     >          fp = pj_open_lib(ctx, "conus", "rb");
>>>     >          ^
>>>     >     proj_conf_test.c:9:12: warning: comparison between pointer and
>>>     integer
>>>     >     [enabled by default]
>>>     >          if (fp == NULL) exit(1);
>>>     >                 ^
>>>     >     proj_conf_test.c:10:5: warning: implicit declaration of function
>>>     >     'pj_ctx_fclose' [-Wimplicit-function-declaration]
>>>     >          pj_ctx_fclose(ctx, fp);
>>>     >          ^
>>>     >     ./configure: line 3834: ./proj_conf_test: No such file or
>>>     directory
>>>     >     checking PROJ.4: conus found and readable... yes
>>>     >     checking geos-config usability... yes
>>>     >     configure: GEOS: 3.5.0
>>>     >     checking GEOS version >= 3.3.0... yes
>>>     >     checking geos_c.h usability... yes
>>>     >     checking geos_c.h presence... yes
>>>     >     checking for geos_c.h... yes
>>>     >     checking geos: linking with -lgeos_c... yes
>>>     >     checking for lwgeom_version in -llwgeom... no
>>>     >     configure: error: in
>>>     >     `/tmp/RtmpKLmhyt/devtools9fd11eb9c3/edzer-sfr-d620f3b':
>>>     >     configure: error: lwgeom test failed (--without-readline to
>>>     disable)
>>>     >     See `config.log' for more details
>>>     >     ERROR: configuration failed for package ?sf?
>>>     >     * removing ?/home/mlt244/R/x86_64-pc-linux-gnu-library/3.3/sf?
>>>     >     * restoring previous
>>>     ?/home/mlt244/R/x86_64-pc-linux-gnu-library/3.3/sf?
>>>     >     Error: Command failed (1)
>>>     >
>>>     >
>>>     >     On Wed, Mar 15, 2017 at 6:14 PM, Michael Treglia
>>>     <mtreglia at gmail.com <mailto:mtreglia at gmail.com>
>>>     >     <mailto:mtreglia at gmail.com <mailto:mtreglia at gmail.com>>> wrote:
>>>     >
>>>     >     > Wow - thanks so much for this quick fix, Edzer! I like your
>>>     >     solution to
>>>     >     > having syntatically different but semantically identical
>>>     >     proj4string. Will
>>>     >     > try this in a bit, and write back if I have any issues.
>>>     >     > Best,
>>>     >     > mike
>>>     >     >
>>>     >     > On Wed, Mar 15, 2017 at 5:58 PM, Edzer Pebesma <
>>>     >     > edzer.pebesma at uni-muenster.de <mailto:edzer.pebesma at uni-muenster.de>
>>>     >     <mailto:edzer.pebesma at uni-muenster.de
>>>     <mailto:edzer.pebesma at uni-muenster.de>>> wrote:
>>>     >     >
>>>     >     >> Great question! Short answer: now solved in the dev version on
>>>     >     github;
>>>     >     >> data are written directly to postgis having epsg 2263.
>>>     >     >>
>>>     >     >>
>>>     >     >> Long answer:
>>>     >     >>
>>>     >     >> I believe this was caused by gdal and proj.4 doing different
>>>     >     things when
>>>     >     >> resolving epsg codes to proj4strings. sf uses proj.4 for
>>>     this. When
>>>     >     >> writing a proj4string either gdal or postgis don't
>>>     recognize the
>>>     >     >> proj4string that proj.4 returns on the epsg code. Neither
>>>     gdal nor
>>>     >     >> postgis understand that syntactically different
>>>     proj4strings may be
>>>     >     >> semantically identical.
>>>     >     >>
>>>     >     >>
>>>     >     >> After running your example, in postgis
>>>     >     >>
>>>     >     >> # select proj4text from spatial_ref_sys where SRID = 900914;
>>>     >     >>
>>>     >     >> gives:
>>>     >     >>
>>>     >     >>  +proj=lcc +lat_1=41.03333333333333 +lat_2=40.66666666666666
>>>     >     >> +lat_0=40.16666666666666 +lon_0=-74 +x_0=300000 +y_0=0
>>>     +ellps=GRS80
>>>     >     >> +towgs84=0,0,0,0,0,0,0 +units=us-ft +no_defs
>>>     >     >>
>>>     >     >> # select proj4text from spatial_ref_sys where SRID = 2263;
>>>     >     >>
>>>     >     >> gives:
>>>     >     >>
>>>     >     >>  +proj=lcc +lat_1=41.03333333333333 +lat_2=40.66666666666666
>>>     >     >> +lat_0=40.16666666666666 +lon_0=-74 +x_0=300000.0000000001
>>>     +y_0=0
>>>     >     >> +datum=NAD83 +units=us-ft +no_defs
>>>     >     >>
>>>     >     >> sf causes this:
>>>     >     >>
>>>     >     >> > st_crs(2263)
>>>     >     >> $epsg
>>>     >     >> [1] 2263
>>>     >     >>
>>>     >     >> $proj4string
>>>     >     >> [1] "+proj=lcc +lat_1=41.03333333333333
>>>     +lat_2=40.66666666666666
>>>     >     >> +lat_0=40.16666666666666 +lon_0=-74 +x_0=300000.0000000001
>>>     +y_0=0
>>>     >     >> +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=us-ft +no_defs"
>>>     >     >>
>>>     >     >> attr(,"class")
>>>     >     >> [1] "crs"
>>>     >     >>
>>>     >     >> because it uses proj.4 directly to resolve SRID strings:
>>>     >     >>
>>>     >     >> /usr/share/proj/epsg has:
>>>     >     >>
>>>     >     >> # NAD83 / New York Long Island (ftUS)
>>>     >     >> <2263> +proj=lcc +lat_1=41.03333333333333
>>>     +lat_2=40.66666666666666
>>>     >     >> +lat_0=40.16666666666666 +lon_0=-74 +x_0=300000.0000000001
>>>     +y_0=0
>>>     >     >> +datum=NAD83 +units=us-ft +no_defs  <>
>>>     >     >>
>>>     >     >>
>>>     >     >> The change I made to sf (
>>>     >     >>
>>>     https://github.com/edzer/sfr/commit/d620f3b748d487bae910e388
>>>     <https://github.com/edzer/sfr/commit/d620f3b748d487bae910e388>
>>>     >     <https://github.com/edzer/sfr/commit/d620f3b748d487bae910e388
>>>     <https://github.com/edzer/sfr/commit/d620f3b748d487bae910e388>>
>>>     >     >> 4c554fa9e3ce7090)
>>>     >     >> now first asks gdal to resolve the epsg (in case it is not
>>>     NA), and
>>>     >     >> otherwise resolve the proj4string (if not NA), instead of ONLY
>>>     >     trying to
>>>     >     >> resolve a non-NA proj4string.
>>>     >     >>
>>>     >     >> On 15/03/17 20:50, Michael Treglia wrote:
>>>     >     >> > Hi All,
>>>     >     >> >
>>>     >     >> > Been working to import and manipulate a CSV file with
>>>     point data
>>>     >     >> > (lat/long), and then export to a PostGIS db.
>>>     >     >> >
>>>     >     >> > Overall, successful, but one thing I'd like to fix - when I
>>>     >     write out
>>>     >     >> the
>>>     >     >> > layer to postgis, the SRID is not maintained. The final
>>>     EPSG/SRID
>>>     >     >> should be
>>>     >     >> > 2263, but when I check in PostGIS, it comes up as 900914.
>>>     >     >> >
>>>     >     >> > Below is my code and sessionInfo, and the data are from here:
>>>     >     >> >
>>>     https://data.cityofnewyork.us/Public-Safety/NYPD-Complaint-D
>>>     <https://data.cityofnewyork.us/Public-Safety/NYPD-Complaint-D>
>>>     >     <https://data.cityofnewyork.us/Public-Safety/NYPD-Complaint-D
>>>     <https://data.cityofnewyork.us/Public-Safety/NYPD-Complaint-D>>
>>>     >     >> ata-Current-YTD/5uac-w243
>>>     >     >> > (downloaded as plain old CSV)
>>>     >     >> >
>>>     >     >> > Anything I might be missing? Thanks in advance for giving a
>>>     >     quick look!
>>>     >     >> > Mike
>>>     >     >> >
>>>     >     >> >
>>>     >     >> > ##Start Code
>>>     >     >> >
>>>     >     >> > #load packages
>>>     >     >> > library(sf)
>>>     >     >> > library(RPostgreSQL)
>>>     >     >> >
>>>     >     >> > #read data
>>>     >     >> > crime_current <-
>>>     read.csv("NYPD_Complaint_Data_Current_YTD.csv",
>>>     >     >> > stringsAsFactors = FALSE)
>>>     >     >> >
>>>     >     >> > #format time columns for easier reading in postgres (I
>>>     think), as
>>>     >     >> keeping
>>>     >     >> > as date format caused problems in export
>>>     >     >> > crime_current$CMPLNT_FR_TIME <-
>>>     >     >> > as.character(as.POSIXct(paste(crime_current$CMPLNT_FR_DT,
>>>     >     >> > crime_current$CMPLNT_FR_TM), format="%m/%d/%Y\ %H:%M",
>>>     tz=""))
>>>     >     >> > crime_current$CMPLNT_TO_TIME <-
>>>     >     >> > as.character(as.POSIXct(paste(crime_current$CMPLNT_TO_DT,
>>>     >     >> > crime_current$CMPLNT_TO_TM), format="%m/%d/%Y\ %H:%M",
>>>     tz=""))
>>>     >     >> > crime_current$RPT_DT <-
>>>     >     as.character(as.POSIXct(crime_current$RPT_DT,
>>>     >     >> > format="%m/%d/%Y", tz=""))
>>>     >     >> >
>>>     >     >> > #convert to sf object
>>>     >     >> > crime_current.sf <- st_as_sf(crime_current, coords =
>>>     c("Longitude",
>>>     >     >> > "Latitude"), crs = 4326)
>>>     >     >> > #reproject to EPSG 2263
>>>     >     >> > crime_current.sf <- st_transform(crime_current.sf, crs=2263)
>>>     >     >> >
>>>     >     >> > #write to postgres
>>>     >     >> > st_write(crime_current.sf, "PG:dbname=mydb user=user
>>>     >     host=xx.xx.xx.xx",
>>>     >     >> > 'health_safety.crime_current')
>>>     >     >> > ###End Code
>>>     >     >> >
>>>     >     >> >
>>>     >     >> >
>>>     >     >> >> sessionInfo()
>>>     >     >> > R version 3.3.1 (2016-06-21)
>>>     >     >> > Platform: x86_64-pc-linux-gnu (64-bit)
>>>     >     >> > Running under: Ubuntu 14.04.5 LTS
>>>     >     >> >
>>>     >     >> > locale:
>>>     >     >> >  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
>>>     >     >> > LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
>>>     >     >> >  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
>>>     >     >> >  LC_PAPER=en_US.UTF-8       LC_NAME=C
>>>     >     >> >  [9] LC_ADDRESS=C               LC_TELEPHONE=C
>>>     >     >> > LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C
>>>     >     >> >
>>>     >     >> > attached base packages:
>>>     >     >> > [1] stats     graphics  grDevices utils     datasets  methods
>>>     >      base
>>>     >     >> >
>>>     >     >> > other attached packages:
>>>     >     >> > [1] sp_1.2-3          RPostgreSQL_0.4-1 DBI_0.6
>>>      sf_0.3-4
>>>     >     >> >
>>>     >     >> > loaded via a namespace (and not attached):
>>>     >     >> > [1] tools_3.3.1     units_0.4-2     Rcpp_0.12.9
>>>      udunits2_0.13
>>>     >     >> > grid_3.3.1      lattice_0.20-33
>>>     >     >> >
>>>     >     >> >       [[alternative HTML version deleted]]
>>>     >     >> >
>>>     >     >> > _______________________________________________
>>>     >     >> > R-sig-Geo mailing list
>>>     >     >> > R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
>>>     <mailto:R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>>
>>>     >     >> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>     <https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
>>>     >     <https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>     <https://stat.ethz.ch/mailman/listinfo/r-sig-geo>>
>>>     >     >> >
>>>     >     >>
>>>     >     >> --
>>>     >     >> Edzer Pebesma
>>>     >     >> Institute for Geoinformatics  (ifgi),  University of M?nster
>>>     >     >> Heisenbergstra?e 2, 48149 M?nster, Germany; +49 251 83 33081 <tel:%2B49%20251%2083%2033081>
>>>     >     <tel:%2B49%20251%2083%2033081>
>>>     >     >> Journal of Statistical Software:   http://www.jstatsoft.org/
>>>     >     >> Computers & Geosciences:   http://elsevier.com/locate/cageo/ <http://elsevier.com/locate/cageo/>
>>>     >     <http://elsevier.com/locate/cageo/ <http://elsevier.com/locate/cageo/>>
>>>     >     >>
>>>     >     >>
>>>     >     >> _______________________________________________
>>>     >     >> R-sig-Geo mailing list
>>>     >     >> R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
>>>     <mailto:R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>>
>>>     >     >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>     <https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
>>>     >     <https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>     <https://stat.ethz.ch/mailman/listinfo/r-sig-geo>>
>>>     >     >>
>>>     >     >
>>>     >     >
>>>     >
>>>     >             [[alternative HTML version deleted]]
>>>     >
>>>     >     _______________________________________________
>>>     >     R-sig-Geo mailing list
>>>     >     R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
>>>     <mailto:R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>>
>>>     >     https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>     <https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
>>>     >     <https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>     <https://stat.ethz.ch/mailman/listinfo/r-sig-geo>>
>>>     >
>>>     >
>>>
>>>     --
>>>     Edzer Pebesma
>>>     Institute for Geoinformatics  (ifgi),  University of M?nster
>>>     Heisenbergstra?e 2, 48149 M?nster, Germany; +49 251 83 33081
>>>     <tel:%2B49%20251%2083%2033081>
>>>     Journal of Statistical Software:   http://www.jstatsoft.org/
>>>     Computers & Geosciences:   http://elsevier.com/locate/cageo/
>>>     <http://elsevier.com/locate/cageo/>
>>>
>>>
>>
>> --
>> Edzer Pebesma
>> Institute for Geoinformatics  (ifgi),  University of M?nster
>> Heisenbergstra?e 2, 48149 M?nster, Germany; +49 251 83 33081
>> Journal of Statistical Software:   http://www.jstatsoft.org/
>> Computers & Geosciences:   http://elsevier.com/locate/cageo/
>>

-- 
Edzer Pebesma
Institute for Geoinformatics  (ifgi),  University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany; +49 251 83 33081
Journal of Statistical Software:   http://www.jstatsoft.org/
Computers & Geosciences:   http://elsevier.com/locate/cageo/

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 473 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20170316/a661b39e/attachment.bin>

From didier.leibovici at nottingham.ac.uk  Fri Mar 17 10:46:05 2017
From: didier.leibovici at nottingham.ac.uk (Dr Didier G. Leibovici)
Date: Fri, 17 Mar 2017 09:46:05 +0000
Subject: [R-sig-Geo] xlsx or rJava issue
Message-ID: <b0e9f3fd-74b4-6713-f199-6209c41ddce4@nottingham.ac.uk>

Hi,

I had some issues with java settings when using xlsx.

I had re-installed rJava as well.

 > library(xlsx)
Error : .onLoad failed in loadNamespace() for 'xlsx', details:
   call: .jinit()
   error: JNI_GetCreatedJavaVMs returned -1

Error: package or namespace load failed for ?xlsx?
JavaVM: requested Java version ((null)) not available. Using Java at "" 
instead.
JavaVM: Failed to load JVM: /bundle/Libraries/libserver.dylib
JavaVM FATAL: Failed to load the jvm library.

that file on my machine is in:
/Library/Java/JavaVirtualMachines/jdk1.8.0_25.jdk/Contents/Home/jre/lib/server/

is it a particular JAVA_HOME setting or a PATH issue?

I added this in the PATH, re-installed rJava, re-installed xlsx ... nope!
thanks,

Didier

on R version 3.3.2 (2016-10-31)

-- 
Dr Didier G. Leibovici
    d-d'ye    ley-bow-v-c
Senior Research Fellow
Geocomputational Modelling & Geospatial Statistics
Nottingham Geospatial Institute
University of Nottingham, UK
+44 (0)115 84 13924
http://www.nottingham.ac.uk/ngi/people/didier.leibovici
Google+ didier.leibovici at gmail.com
Skype didierleibovici





This message and any attachment are intended solely for the addressee
and may contain confidential information. If you have received this
message in error, please send it back to me, and immediately delete it. 

Please do not use, copy or disclose the information contained in this
message or in any attachment.  Any views or opinions expressed by the
author of this email do not necessarily reflect the views of the
University of Nottingham.

This message has been checked for viruses but the contents of an
attachment may still contain software viruses which could damage your
computer system, you are advised to perform your own checks. Email
communications with the University of Nottingham may be monitored as
permitted by UK legislation.


	[[alternative HTML version deleted]]


From edzer.pebesma at uni-muenster.de  Fri Mar 17 10:56:59 2017
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Fri, 17 Mar 2017 10:56:59 +0100
Subject: [R-sig-Geo] xlsx or rJava issue
In-Reply-To: <b0e9f3fd-74b4-6713-f199-6209c41ddce4@nottingham.ac.uk>
References: <b0e9f3fd-74b4-6713-f199-6209c41ddce4@nottingham.ac.uk>
Message-ID: <c7f19f2c-3277-5ca6-6a51-3b0fe44845b4@uni-muenster.de>

Didier, this is somewhat off-topic for this list, but in the past I've
solved all my R/java troubles with running, as root

R CMD javareconf

On 17/03/17 10:46, Dr Didier G. Leibovici wrote:
> Hi,
> 
> I had some issues with java settings when using xlsx.
> 
> I had re-installed rJava as well.
> 
>  > library(xlsx)
> Error : .onLoad failed in loadNamespace() for 'xlsx', details:
>    call: .jinit()
>    error: JNI_GetCreatedJavaVMs returned -1
> 
> Error: package or namespace load failed for ?xlsx?
> JavaVM: requested Java version ((null)) not available. Using Java at "" 
> instead.
> JavaVM: Failed to load JVM: /bundle/Libraries/libserver.dylib
> JavaVM FATAL: Failed to load the jvm library.
> 
> that file on my machine is in:
> /Library/Java/JavaVirtualMachines/jdk1.8.0_25.jdk/Contents/Home/jre/lib/server/
> 
> is it a particular JAVA_HOME setting or a PATH issue?
> 
> I added this in the PATH, re-installed rJava, re-installed xlsx ... nope!
> thanks,
> 
> Didier
> 
> on R version 3.3.2 (2016-10-31)
> 

-- 
Edzer Pebesma
Institute for Geoinformatics  (ifgi),  University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany; +49 251 83 33081
Journal of Statistical Software:   http://www.jstatsoft.org/
Computers & Geosciences:   http://elsevier.com/locate/cageo/

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 473 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20170317/38b48eb7/attachment.bin>

From didier.leibovici at nottingham.ac.uk  Fri Mar 17 11:10:20 2017
From: didier.leibovici at nottingham.ac.uk (Dr Didier G. Leibovici)
Date: Fri, 17 Mar 2017 10:10:20 +0000
Subject: [R-sig-Geo] xlsx or rJava issue
In-Reply-To: <b0e9f3fd-74b4-6713-f199-6209c41ddce4@nottingham.ac.uk>
References: <b0e9f3fd-74b4-6713-f199-6209c41ddce4@nottingham.ac.uk>
Message-ID: <427e9d9a-8b79-0eac-b50a-d68032f7a799@nottingham.ac.uk>

A bit of dig up on google and I found 
(http://stackoverflow.com/questions/35179151/cannot-load-r-xlsx-package-on-mac-os-10-11) 
which resolves the thing in a terminal but when using Rgui same thing (?)

I tried re-installing in Rgui and now it is library(rJava) which cannot 
load (?)

library(xlsx)
Loading required package: rJava
Error : .onLoad failed in loadNamespace() for 'rJava', details:
   call: dyn.load(file, DLLpath = DLLpath, ...)
   error: unable to load shared object 
'/Users/lgzdl/Library/R/3.3/library/rJava/libs/rJava.so':
   dlopen(/Users/lgzdl/Library/R/3.3/library/rJava/libs/rJava.so, 6): 
Library not loaded: @rpath/libjvm.dylib
   Referenced from: /Users/lgzdl/Library/R/3.3/library/rJava/libs/rJava.so
   Reason: image not found
Error: package ?rJava? could not be loaded

but at least I can work with R in a terminal!

cheers to SanjayIV,

Didier



On 17/03/2017 09:46, Dr Didier G. Leibovici wrote:
> Hi,
>
> I had some issues with java settings when using xlsx.
>
> I had re-installed rJava as well.
>
>   > library(xlsx)
> Error : .onLoad failed in loadNamespace() for 'xlsx', details:
>     call: .jinit()
>     error: JNI_GetCreatedJavaVMs returned -1
>
> Error: package or namespace load failed for ?xlsx?
> JavaVM: requested Java version ((null)) not available. Using Java at ""
> instead.
> JavaVM: Failed to load JVM: /bundle/Libraries/libserver.dylib
> JavaVM FATAL: Failed to load the jvm library.
>
> that file on my machine is in:
> /Library/Java/JavaVirtualMachines/jdk1.8.0_25.jdk/Contents/Home/jre/lib/server/
>
> is it a particular JAVA_HOME setting or a PATH issue?
>
> I added this in the PATH, re-installed rJava, re-installed xlsx ... nope!
> thanks,
>
> Didier
>
> on R version 3.3.2 (2016-10-31)
>

-- 
Dr Didier G. Leibovici
    d-d'ye    ley-bow-v-c
Senior Research Fellow
Geocomputational Modelling & Geospatial Statistics
Nottingham Geospatial Institute
University of Nottingham, UK
+44 (0)115 84 13924
http://www.nottingham.ac.uk/ngi/people/didier.leibovici
Google+ didier.leibovici at gmail.com
Skype didierleibovici





This message and any attachment are intended solely for the addressee
and may contain confidential information. If you have received this
message in error, please send it back to me, and immediately delete it. 

Please do not use, copy or disclose the information contained in this
message or in any attachment.  Any views or opinions expressed by the
author of this email do not necessarily reflect the views of the
University of Nottingham.

This message has been checked for viruses but the contents of an
attachment may still contain software viruses which could damage your
computer system, you are advised to perform your own checks. Email
communications with the University of Nottingham may be monitored as
permitted by UK legislation.


	[[alternative HTML version deleted]]


From didier.leibovici at nottingham.ac.uk  Fri Mar 17 11:12:36 2017
From: didier.leibovici at nottingham.ac.uk (Dr Didier G. Leibovici)
Date: Fri, 17 Mar 2017 10:12:36 +0000
Subject: [R-sig-Geo] xlsx or rJava issue
In-Reply-To: <c7f19f2c-3277-5ca6-6a51-3b0fe44845b4@uni-muenster.de>
References: <b0e9f3fd-74b4-6713-f199-6209c41ddce4@nottingham.ac.uk>
	<c7f19f2c-3277-5ca6-6a51-3b0fe44845b4@uni-muenster.de>
Message-ID: <3c0e0ee8-20c2-3740-0310-d0f3f81b2fb3@nottingham.ac.uk>

Yes, thanks Edzer I found this solution though Rgui didn't seem to get 
it (could that be after a reboot?) thanks, Didier


On 17/03/2017 09:56, Edzer Pebesma wrote:
> Didier, this is somewhat off-topic for this list, but in the past I've
> solved all my R/java troubles with running, as root
>
> R CMD javareconf
>
> On 17/03/17 10:46, Dr Didier G. Leibovici wrote:
>> Hi,
>>
>> I had some issues with java settings when using xlsx.
>>
>> I had re-installed rJava as well.
>>
>>   > library(xlsx)
>> Error : .onLoad failed in loadNamespace() for 'xlsx', details:
>>     call: .jinit()
>>     error: JNI_GetCreatedJavaVMs returned -1
>>
>> Error: package or namespace load failed for ?xlsx?
>> JavaVM: requested Java version ((null)) not available. Using Java at ""
>> instead.
>> JavaVM: Failed to load JVM: /bundle/Libraries/libserver.dylib
>> JavaVM FATAL: Failed to load the jvm library.
>>
>> that file on my machine is in:
>> /Library/Java/JavaVirtualMachines/jdk1.8.0_25.jdk/Contents/Home/jre/lib/server/
>>
>> is it a particular JAVA_HOME setting or a PATH issue?
>>
>> I added this in the PATH, re-installed rJava, re-installed xlsx ... nope!
>> thanks,
>>
>> Didier
>>
>> on R version 3.3.2 (2016-10-31)
>>
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Dr Didier G. Leibovici
    d-d'ye    ley-bow-v-c
Senior Research Fellow
Geocomputational Modelling & Geospatial Statistics
Nottingham Geospatial Institute
University of Nottingham, UK
+44 (0)115 84 13924
http://www.nottingham.ac.uk/ngi/people/didier.leibovici
Google+ didier.leibovici at gmail.com
Skype didierleibovici





This message and any attachment are intended solely for the addressee
and may contain confidential information. If you have received this
message in error, please send it back to me, and immediately delete it. 

Please do not use, copy or disclose the information contained in this
message or in any attachment.  Any views or opinions expressed by the
author of this email do not necessarily reflect the views of the
University of Nottingham.

This message has been checked for viruses but the contents of an
attachment may still contain software viruses which could damage your
computer system, you are advised to perform your own checks. Email
communications with the University of Nottingham may be monitored as
permitted by UK legislation.


	[[alternative HTML version deleted]]


From thi_veloso at yahoo.com.br  Fri Mar 17 11:17:28 2017
From: thi_veloso at yahoo.com.br (Thiago V. dos Santos)
Date: Fri, 17 Mar 2017 10:17:28 +0000 (UTC)
Subject: [R-sig-Geo] xlsx or rJava issue
In-Reply-To: <b0e9f3fd-74b4-6713-f199-6209c41ddce4@nottingham.ac.uk>
References: <b0e9f3fd-74b4-6713-f199-6209c41ddce4@nottingham.ac.uk>
Message-ID: <1480480772.2104717.1489745848520@mail.yahoo.com>

Didier, I noticed you are using macOS. Are you by any chance using RStudio as well? If yes, besides Edzer's suggestion, the following command has also helped me in the past:

sudo ln -f -s $(/usr/libexec/java_home)/jre/lib/server/libjvm.dylib /usr/local/lib

Then, try re-installing rJava - *from source* - now. It should work.
 Hope this helps,
 -- Thiago V. dos Santos

PhD student
Land and Atmospheric Science
University of Minnesota



On Friday, March 17, 2017 4:52 AM, Dr Didier G. Leibovici <didier.leibovici at nottingham.ac.uk> wrote:
Hi,

I had some issues with java settings when using xlsx.

I had re-installed rJava as well.

> library(xlsx)
Error : .onLoad failed in loadNamespace() for 'xlsx', details:
   call: .jinit()
   error: JNI_GetCreatedJavaVMs returned -1

Error: package or namespace load failed for ?xlsx?
JavaVM: requested Java version ((null)) not available. Using Java at "" 
instead.
JavaVM: Failed to load JVM: /bundle/Libraries/libserver.dylib
JavaVM FATAL: Failed to load the jvm library.

that file on my machine is in:
/Library/Java/JavaVirtualMachines/jdk1.8.0_25.jdk/Contents/Home/jre/lib/server/

is it a particular JAVA_HOME setting or a PATH issue?

I added this in the PATH, re-installed rJava, re-installed xlsx ... nope!
thanks,

Didier

on R version 3.3.2 (2016-10-31)

-- 
Dr Didier G. Leibovici
    d-d'ye    ley-bow-v-c
Senior Research Fellow
Geocomputational Modelling & Geospatial Statistics
Nottingham Geospatial Institute
University of Nottingham, UK
+44 (0)115 84 13924
http://www.nottingham.ac.uk/ngi/people/didier.leibovici
Google+ didier.leibovici at gmail.com
Skype didierleibovici





This message and any attachment are intended solely for the addressee
and may contain confidential information. If you have received this
message in error, please send it back to me, and immediately delete it. 

Please do not use, copy or disclose the information contained in this
message or in any attachment.  Any views or opinions expressed by the
author of this email do not necessarily reflect the views of the
University of Nottingham.

This message has been checked for viruses but the contents of an
attachment may still contain software viruses which could damage your
computer system, you are advised to perform your own checks. Email
communications with the University of Nottingham may be monitored as
permitted by UK legislation.


    [[alternative HTML version deleted]]

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo 


From castrog.miguelg at gmail.com  Fri Mar 17 12:45:15 2017
From: castrog.miguelg at gmail.com (=?utf-8?Q?Miguel_Castro_G=C3=B3mez?=)
Date: Fri, 17 Mar 2017 12:45:15 +0100
Subject: [R-sig-Geo] Sentienl 2 gdal translate
In-Reply-To: <fd2c3bca-2309-eceb-b90e-ca78d019131c@conabio.gob.mx>
References: <F3B5A4AE-F1CC-4A9A-BCC0-FD18B6F74ECB@gmail.com>
	<573be8a5-7ff1-03d1-4ab6-9f841db0941a@conabio.gob.mx>
	<2F972073-5F50-4BF6-8383-E28C300F47B5@gmail.com>
	<fd2c3bca-2309-eceb-b90e-ca78d019131c@conabio.gob.mx>
Message-ID: <CE9B955C-4B86-48FC-A508-7FB1CC4496B9@gmail.com>

Hi Lo?c,

Thanks for your help,

When trying the system2 option this is what happens:

Image_Path<- ?path/to/images/"

S2_JP2_List <- list.files(Image_Path, full.names = TRUE, pattern = ".jp2$")

for (file in S2_JP2_List) {
    out_file <- extension(file, 'tif')
    system2('gdal_translate', args = c('-of GTiff', file, out_file,
                                       '--config GDAL_SKIP JPECW'))
}

sh: gdal_translate: command not found


I have been checking and the problem may be that R cannot find the gdal_translate command. Here are the paths:

Sys.getenv('R_HOME?)
"/Library/Frameworks/R.framework/Resources"
Sys.getenv('PATH')
"/usr/bin:/bin:/usr/sbin:/sbin:/usr/local/bin?

In terminal:
user$ echo $PATH 
/Library/Frameworks/GDAL.framework/Programs:/Library/Frameworks/GDAL.framework/Programs:/Library/Frameworks/GDAL.framework/Programs:/Users/Miguel/anaconda/bin:/Library/Frameworks/Python.framework/Versions/3.5/bin:/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin


I think it has to match but not sure how can I change the path that R is using to find the command gdal_translate

Regarding sentinel2 driver, any idea why is not working? Any help on that

Cheers
M


> El 16 mar 2017, a las 19:21, Lo?c Dutrieux <loic.dutrieux at conabio.gob.mx> escribi?:
> 
> Hi Miguel,
> 
> Briefly looking at the help and source code of
> gdalUtils::gdal_translate(), I don't see any way to pass additional
> options. Your best shot is therefore probably to build the expression
> yourself and pass it via a system call.
> 
> library(raster)
> 
> Image_Path<-'/path/to/images/'
> 
> S2_JP2_List <- list.files(Image_Path, full.names = TRUE, pattern = ".jp2$")
> 
> for (file in S2_JP2_List) {
>  out_file <- extension(file, 'tif')
>  system2('gdal_translate', args = c('-of GTiff', file, out_file,
> '--config GDAL_SKIP JPECW'))
> }
> 
> But the real question here is why the simple gdal_translate call without
> --config GDAL_SKIP JPECW did not work for you while you clearly have the
> sentinel2 driver...
> 
> Cheers,
> Lo?c
> 
> On 16/03/17 06:02, Miguel Castro G?mez wrote:
>> Hi Lo?c,
>> 
>> I have tried your code but it does not work yet. It just produces one
>> tif file for the first band but this file is not correct (8 kb just).
>> The R process keep working for a long time without any other output
>> 
>> Here are the versions I?m using
>> 
>> R version: 3.3.2
>> gdalUtils: v 2.0.1.7
>> raster: 2.5-8
>> gdal: 2.1.2, released 2016/10/24
>> 
>> When checking for the sentinel 2 driver in gdal (see red)
>> 
>> gdal-config --formats | grep sentinel2
>> gxf gtiff hfa aigrid aaigrid ceos ceos2 iso8211 xpm sdts raw dted mem
>> jdem envisat elas fit vrt usgsdem l1b nitf bmp airsar rs2 ilwis rmf
>> leveller sgi srtmhgt idrisi gsg ingr ers jaxapalsar dimap gff cosar pds
>> adrg coasp tsx terragen blx msgn til r northwood saga xyz hf2
>> kmlsuperoverlay ctg e00grid zmap ngsgeoid iris map cals safe *sentinel2*
>> mrf webp wcs wms plmosaic wmts dods grib bsb openjpeg jpeg2000 netcdf
>> hdf5 hdf4 ogdi gif jpeg gta png pcraster fits pcidsk rik ozi rasterlite
>> mbtiles postgisraster arg
>> 
>> I think the problem is the driver that is used to manage the jp2 file.
>> Any idea how can I include in the R code the --config GDAL_SKIP JP2ECW
>> option. 
>> 
>> Cheers,
>> M
>> 
>>> El 15 mar 2017, a las 23:13, Lo?c Dutrieux
>>> <loic.dutrieux at conabio.gob.mx <mailto:loic.dutrieux at conabio.gob.mx> <mailto:loic.dutrieux at conabio.gob.mx <mailto:loic.dutrieux at conabio.gob.mx>>>
>>> escribi?:
>>> 
>>> Hi,
>>> 
>>> I tried your code with some S2 images I had lying around, and it works
>>> on my system. I modified it a bit to write the output layers to the same
>>> directory and not to my working directory.
>>> 
>>> library(gdalUtils)
>>> library(raster)
>>> 
>>> Image_Path<-'/path/to/images/'
>>> 
>>> S2_JP2_List <- list.files(Image_Path, full.names = TRUE, pattern =
>>> ".jp2$")
>>> 
>>> for (file in S2_JP2_List) {
>>> out_file <- extension(file, 'tif')
>>> gdal_translate(src_dataset = file, dst_dataset = out_file, ot =
>>> "UInt16", of = "GTiff")
>>> }
>>> 
>>> gdal has a sentinel 2 driver, but it's not extremely old, therefore it's
>>> possible that your installation doesn't have it; you can check with:
>>> 
>>> gdal-config --formats | grep sentinel2
>>> 
>>> Cheers,
>>> Lo?c
>>> 
>>> 
>>> 
>>> On 15/03/17 12:49, Miguel Castro G?mez wrote:
>>>> Hi,
>>>> 
>>>> I have Sentinel 2 images (jp2) that I want to convert to GTiff using
>>>> gdal_translate in R (from gdalutils package). Here is the code I?m using
>>>> 
>>>> Image_Path<-?/path/to/wd?
>>>> 
>>>> S2_JP2_List <- list.files(Image_Path, full.names = TRUE, pattern =
>>>> ".jp2$")
>>>> 
>>>> for (i in 1:length(S2_JP2_List)) {
>>>> gdal_translate(src_dataset = S2_JP2_List[[i]], dst_dataset =
>>>> paste("Band", i , "tif"), ot = "UInt16", of = ?GTiff")
>>>>   }
>>>> 
>>>> When running this code, the process starts without any error but its
>>>> never ending neither producing any output
>>>> 
>>>> I've tried to do it in gdal and the same code works, except that it
>>>> is necessary to skip  the default driver since it cannot manage large
>>>> jp2 files.
>>>> 
>>>> gdal_translate -of GTiff /path/to/input/S2_b1.jp2
>>>> /path/to/output/S2_b1converted.tif --config GDAL_SKIP JP2ECW
>>>> 
>>>> Any idea how could I run this in R?
>>>> 
>>>> Thanks
>>>> M
>>>> 
>>>> 
>>>> 
>>>> [[alternative HTML version deleted]]
>>>> 
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org> <mailto:R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>>
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo <https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
>>>> 
>>> 
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org> <mailto:R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>>
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo <https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
>> 
>> 
>> 
>> Email secured by Check Point


	[[alternative HTML version deleted]]


From didier.leibovici at nottingham.ac.uk  Fri Mar 17 12:59:45 2017
From: didier.leibovici at nottingham.ac.uk (Dr Didier G. Leibovici)
Date: Fri, 17 Mar 2017 11:59:45 +0000
Subject: [R-sig-Geo] xlsx or rJava issue
In-Reply-To: <1480480772.2104717.1489745848520@mail.yahoo.com>
References: <b0e9f3fd-74b4-6713-f199-6209c41ddce4@nottingham.ac.uk>
	<1480480772.2104717.1489745848520@mail.yahoo.com>
Message-ID: <cb4d707b-34b0-ab28-0b26-2cbaa1fa10ed@nottingham.ac.uk>

Thank you Thiago that worked!

Rgui:

 > library(rJava)
 > library(xlsx)
Loading required package: xlsxjars
 >


On 17/03/2017 10:17, Thiago V. dos Santos wrote:
> Didier, I noticed you are using macOS. Are you by any chance using RStudio as well? If yes, besides Edzer's suggestion, the following command has also helped me in the past:
>
> sudo ln -f -s $(/usr/libexec/java_home)/jre/lib/server/libjvm.dylib /usr/local/lib
>
> Then, try re-installing rJava - *from source* - now. It should work.
>   Hope this helps,
>   -- Thiago V. dos Santos
>
> PhD student
> Land and Atmospheric Science
> University of Minnesota
>
>
>
> On Friday, March 17, 2017 4:52 AM, Dr Didier G. Leibovici <didier.leibovici at nottingham.ac.uk> wrote:
> Hi,
>
> I had some issues with java settings when using xlsx.
>
> I had re-installed rJava as well.
>
>> library(xlsx)
> Error : .onLoad failed in loadNamespace() for 'xlsx', details:
>     call: .jinit()
>     error: JNI_GetCreatedJavaVMs returned -1
>
> Error: package or namespace load failed for ?xlsx?
> JavaVM: requested Java version ((null)) not available. Using Java at ""
> instead.
> JavaVM: Failed to load JVM: /bundle/Libraries/libserver.dylib
> JavaVM FATAL: Failed to load the jvm library.
>
> that file on my machine is in:
> /Library/Java/JavaVirtualMachines/jdk1.8.0_25.jdk/Contents/Home/jre/lib/server/
>
> is it a particular JAVA_HOME setting or a PATH issue?
>
> I added this in the PATH, re-installed rJava, re-installed xlsx ... nope!
> thanks,
>
> Didier
>
> on R version 3.3.2 (2016-10-31)
>

-- 
Dr Didier G. Leibovici
    d-d'ye    ley-bow-v-c
Senior Research Fellow
Geocomputational Modelling & Geospatial Statistics
Nottingham Geospatial Institute
University of Nottingham, UK
+44 (0)115 84 13924
http://www.nottingham.ac.uk/ngi/people/didier.leibovici
Google+ didier.leibovici at gmail.com
Skype didierleibovici





This message and any attachment are intended solely for the addressee
and may contain confidential information. If you have received this
message in error, please send it back to me, and immediately delete it. 

Please do not use, copy or disclose the information contained in this
message or in any attachment.  Any views or opinions expressed by the
author of this email do not necessarily reflect the views of the
University of Nottingham.

This message has been checked for viruses but the contents of an
attachment may still contain software viruses which could damage your
computer system, you are advised to perform your own checks. Email
communications with the University of Nottingham may be monitored as
permitted by UK legislation.


	[[alternative HTML version deleted]]


From loic.dutrieux at conabio.gob.mx  Fri Mar 17 18:12:45 2017
From: loic.dutrieux at conabio.gob.mx (=?UTF-8?Q?Lo=c3=afc_Dutrieux?=)
Date: Fri, 17 Mar 2017 11:12:45 -0600
Subject: [R-sig-Geo] Sentienl 2 gdal translate
In-Reply-To: <CE9B955C-4B86-48FC-A508-7FB1CC4496B9@gmail.com>
References: <F3B5A4AE-F1CC-4A9A-BCC0-FD18B6F74ECB@gmail.com>
	<573be8a5-7ff1-03d1-4ab6-9f841db0941a@conabio.gob.mx>
	<2F972073-5F50-4BF6-8383-E28C300F47B5@gmail.com>
	<fd2c3bca-2309-eceb-b90e-ca78d019131c@conabio.gob.mx>
	<CE9B955C-4B86-48FC-A508-7FB1CC4496B9@gmail.com>
Message-ID: <5b303cc5-af6c-1e36-e5f2-71c3c1e4be4f@conabio.gob.mx>

Hi Miguel,

Do you have more than one installation of gdal? That could potentially
explain why your first try with gdal_translate() did not work.

library(gdalUtils)
length(getOption("gdalUtils_gdalPath"))

should give you the number of installations you have on your system.

If more than 1, gdal_chooseInstallation(hasDrivers=c("SENTINEL2"))
should set the correct path for gdal_translate().

Cheers,
Lo?c

On 17/03/17 05:45, Miguel Castro G?mez wrote:
> Hi Lo?c,
> 
> Thanks for your help,
> 
> When trying the system2 option this is what happens:
> 
> Image_Path<- ?path/to/images/"
> 
> S2_JP2_List <- list.files(Image_Path, full.names = TRUE, pattern = ".jp2$")
> 
> for (file in S2_JP2_List) {
>     out_file <- extension(file, 'tif')
>     system2('gdal_translate', args = c('-of GTiff', file, out_file,
>                                        '--config GDAL_SKIP JPECW'))
> }
> 
> sh: gdal_translate: command not found
> 
> 
> I have been checking and the problem may be that R cannot find the
> gdal_translate command. Here are the paths:
> 
> Sys.getenv('R_HOME?)
> "/Library/Frameworks/R.framework/Resources"
> Sys.getenv('PATH')
> "/usr/bin:/bin:/usr/sbin:/sbin:/usr/local/bin?
> 
> In terminal:
> user$ echo $PATH 
> /Library/Frameworks/GDAL.framework/Programs:/Library/Frameworks/GDAL.framework/Programs:/Library/Frameworks/GDAL.framework/Programs:/Users/Miguel/anaconda/bin:/Library/Frameworks/Python.framework/Versions/3.5/bin:/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin
> 
> 
> I think it has to match but not sure how can I change the path that R is
> using to find the command gdal_translate
> 
> Regarding sentinel2 driver, any idea why is not working? Any help on that
> 
> Cheers
> M
> 
> 
>> El 16 mar 2017, a las 19:21, Lo?c Dutrieux
>> <loic.dutrieux at conabio.gob.mx <mailto:loic.dutrieux at conabio.gob.mx>>
>> escribi?:
>>
>> Hi Miguel,
>>
>> Briefly looking at the help and source code of
>> gdalUtils::gdal_translate(), I don't see any way to pass additional
>> options. Your best shot is therefore probably to build the expression
>> yourself and pass it via a system call.
>>
>> library(raster)
>>
>> Image_Path<-'/path/to/images/'
>>
>> S2_JP2_List <- list.files(Image_Path, full.names = TRUE, pattern =
>> ".jp2$")
>>
>> for (file in S2_JP2_List) {
>>  out_file <- extension(file, 'tif')
>>  system2('gdal_translate', args = c('-of GTiff', file, out_file,
>> '--config GDAL_SKIP JPECW'))
>> }
>>
>> But the real question here is why the simple gdal_translate call without
>> --config GDAL_SKIP JPECW did not work for you while you clearly have the
>> sentinel2 driver...
>>
>> Cheers,
>> Lo?c
>>
>> On 16/03/17 06:02, Miguel Castro G?mez wrote:
>>> Hi Lo?c,
>>>
>>> I have tried your code but it does not work yet. It just produces one
>>> tif file for the first band but this file is not correct (8 kb just).
>>> The R process keep working for a long time without any other output
>>>
>>> Here are the versions I?m using
>>>
>>> R version: 3.3.2
>>> gdalUtils: v 2.0.1.7
>>> raster: 2.5-8
>>> gdal: 2.1.2, released 2016/10/24
>>>
>>> When checking for the sentinel 2 driver in gdal (see red)
>>>
>>> gdal-config --formats | grep sentinel2
>>> gxf gtiff hfa aigrid aaigrid ceos ceos2 iso8211 xpm sdts raw dted mem
>>> jdem envisat elas fit vrt usgsdem l1b nitf bmp airsar rs2 ilwis rmf
>>> leveller sgi srtmhgt idrisi gsg ingr ers jaxapalsar dimap gff cosar pds
>>> adrg coasp tsx terragen blx msgn til r northwood saga xyz hf2
>>> kmlsuperoverlay ctg e00grid zmap ngsgeoid iris map cals safe *sentinel2*
>>> mrf webp wcs wms plmosaic wmts dods grib bsb openjpeg jpeg2000 netcdf
>>> hdf5 hdf4 ogdi gif jpeg gta png pcraster fits pcidsk rik ozi rasterlite
>>> mbtiles postgisraster arg
>>>
>>> I think the problem is the driver that is used to manage the jp2 file.
>>> Any idea how can I include in the R code the --config GDAL_SKIP JP2ECW
>>> option. 
>>>
>>> Cheers,
>>> M
>>>
>>>> El 15 mar 2017, a las 23:13, Lo?c Dutrieux
>>>> <loic.dutrieux at conabio.gob.mx
>>>> <mailto:loic.dutrieux at conabio.gob.mx> <mailto:loic.dutrieux at conabio.gob.mx>>
>>>> escribi?:
>>>>
>>>> Hi,
>>>>
>>>> I tried your code with some S2 images I had lying around, and it works
>>>> on my system. I modified it a bit to write the output layers to the same
>>>> directory and not to my working directory.
>>>>
>>>> library(gdalUtils)
>>>> library(raster)
>>>>
>>>> Image_Path<-'/path/to/images/'
>>>>
>>>> S2_JP2_List <- list.files(Image_Path, full.names = TRUE, pattern =
>>>> ".jp2$")
>>>>
>>>> for (file in S2_JP2_List) {
>>>> out_file <- extension(file, 'tif')
>>>> gdal_translate(src_dataset = file, dst_dataset = out_file, ot =
>>>> "UInt16", of = "GTiff")
>>>> }
>>>>
>>>> gdal has a sentinel 2 driver, but it's not extremely old, therefore it's
>>>> possible that your installation doesn't have it; you can check with:
>>>>
>>>> gdal-config --formats | grep sentinel2
>>>>
>>>> Cheers,
>>>> Lo?c
>>>>
>>>>
>>>>
>>>> On 15/03/17 12:49, Miguel Castro G?mez wrote:
>>>>> Hi,
>>>>>
>>>>> I have Sentinel 2 images (jp2) that I want to convert to GTiff using
>>>>> gdal_translate in R (from gdalutils package). Here is the code I?m
>>>>> using
>>>>>
>>>>> Image_Path<-?/path/to/wd?
>>>>>
>>>>> S2_JP2_List <- list.files(Image_Path, full.names = TRUE, pattern =
>>>>> ".jp2$")
>>>>>
>>>>> for (i in 1:length(S2_JP2_List)) {
>>>>> gdal_translate(src_dataset = S2_JP2_List[[i]], dst_dataset =
>>>>> paste("Band", i , "tif"), ot = "UInt16", of = ?GTiff")
>>>>>   }
>>>>>
>>>>> When running this code, the process starts without any error but its
>>>>> never ending neither producing any output
>>>>>
>>>>> I've tried to do it in gdal and the same code works, except that it
>>>>> is necessary to skip  the default driver since it cannot manage large
>>>>> jp2 files.
>>>>>
>>>>> gdal_translate -of GTiff /path/to/input/S2_b1.jp2
>>>>> /path/to/output/S2_b1converted.tif --config GDAL_SKIP JP2ECW
>>>>>
>>>>> Any idea how could I run this in R?
>>>>>
>>>>> Thanks
>>>>> M
>>>>>
>>>>>
>>>>>
>>>>> [[alternative HTML version deleted]]
>>>>>
>>>>> _______________________________________________
>>>>> R-sig-Geo mailing list
>>>>> R-sig-Geo at r-project.org
>>>>> <mailto:R-sig-Geo at r-project.org> <mailto:R-sig-Geo at r-project.org>
>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at r-project.org
>>>> <mailto:R-sig-Geo at r-project.org> <mailto:R-sig-Geo at r-project.org>
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>>
>>>
>>> Email secured by Check Point
> 
> 
> 
> Email secured by Check Point
>


From hnstedu at 163.com  Tue Mar 21 02:25:59 2017
From: hnstedu at 163.com (hnstedu)
Date: Tue, 21 Mar 2017 09:25:59 +0800 (CST)
Subject: [R-sig-Geo] read the .nc file and obtain the vector data of a region
Message-ID: <452f953c.27e3.15aee788235.Coremail.hnstedu@163.com>

Hi, dear friend,
I have download the surface PM2.5 data provided in  NetCDF [.nc] file (http://fizz.phys.dal.ca/~atmos/martin/?page_id=140). 
My goal is to obtain the PM2.5 data of various provinces in China using this nc file. I know wo can employ the "ncdf4" package
to load the nc file in R. However, I have no idea to obtain the corresponding data of one region (e.g. China Provinces).
Any idea?


Thanks very much !


Bests,
wanhaiyou
	[[alternative HTML version deleted]]


From madiazl at gmail.com  Tue Mar 21 02:31:29 2017
From: madiazl at gmail.com (Andres Diaz)
Date: Tue, 21 Mar 2017 02:31:29 +0100
Subject: [R-sig-Geo] read the .nc file and obtain the vector data of a
	region
In-Reply-To: <CAMXOh=1pR70o8fRCyfZYuwLocj=S6ijcrm+zciRYEdM8f-ywkQ@mail.gmail.com>
References: <452f953c.27e3.15aee788235.Coremail.hnstedu@163.com>
	<CAMXOh=1ypjSYWfYt5JO2zJQFKtGtz0ePVML3SLvkRW1xMQEKGA@mail.gmail.com>
	<CAMXOh=2GqP_jjf3bo5kQPxyby-f=bBkA1A6acgkvcY-Tf9o_vw@mail.gmail.com>
	<CAMXOh=2gV-wrQO9dE=q88Arphw6XArMT9nUF5X4jOTnjZXXcMw@mail.gmail.com>
	<CAMXOh=1pR70o8fRCyfZYuwLocj=S6ijcrm+zciRYEdM8f-ywkQ@mail.gmail.com>
Message-ID: <CAMXOh=2YCMTr9mCbSHJTxpMBFByoooPRHpVoMx8WD1rcdUL4dg@mail.gmail.com>

There are some packages like gdal or the overlay/extract function of sp
that can help you. The most important is to open the information and once
you have the matrix (of the data) if you have the positions in the matrix
which correspond to your geographical units (china) you can extract only
those pixels/positions.

All the best,

Andres

On 21 Mar 2017 02:26, "hnstedu" <hnstedu at 163.com> wrote:

Hi, dear friend,
I have download the surface PM2.5 data provided in  NetCDF [.nc] file (
http://fizz.phys.dal.ca/~atmos/martin/?page_id=140).
My goal is to obtain the PM2.5 data of various provinces in China using
this nc file. I know wo can employ the "ncdf4" package
to load the nc file in R. However, I have no idea to obtain the
corresponding data of one region (e.g. China Provinces).
Any idea?


Thanks very much !


Bests,
wanhaiyou
        [[alternative HTML version deleted]]

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo

	[[alternative HTML version deleted]]


From martin.zuba at gmx.at  Wed Mar 22 18:19:01 2017
From: martin.zuba at gmx.at (Martin Zuba)
Date: Wed, 22 Mar 2017 18:19:01 +0100
Subject: [R-sig-Geo] Eurostat shapefiles & google maps offset
Message-ID: <CAG3rrX6XbtNo8B9oTa=5=Yu7pN3WAA9m+BNC=dXKssA2D_un6Q@mail.gmail.com>

Dear list,

I would like to plot shaded shapefiles with static google maps background
images.

I obtain the shapefiles from Eurostat, via the eurostat R package.

I obtain the static google background images from using the get_map wrapper
from the R package ggmap.

My problem is that there seems to be an offset between those two coordinate
systems. I know that the Eurostat files uss the coordinate reference system
ETRS89 and google maps uses WSG84, which should be (almost) identical.

However, google images and the shapefiles are somwhat off; and that offset
is not constant, which indicates that there might be a problem related to
projections.


illustration:
https://www.dropbox.com/s/34k2ace42ubjjek/eurostatVSgoogle.png?dl=0

replication:
https://www.dropbox.com/s/hhoc84lrmo42imf/niceEurostat.R?dl=0


I welcome any suggestions.

Best Regards,

Martin Zuba

	[[alternative HTML version deleted]]


From patrick.brown at utoronto.ca  Fri Mar 24 15:42:35 2017
From: patrick.brown at utoronto.ca (Patrick Brown)
Date: Fri, 24 Mar 2017 10:42:35 -0400
Subject: [R-sig-Geo] Eurostat shapefiles & google maps offset
Message-ID: <CA+j2mtU2YfV0gBLYVCYoF8ATA4WrN7NcThPAA7ju8DVgwas4mA@mail.gmail.com>

Hello, you'll need to reproject either your shapefiles or the background
images.  The mapmisc package can get you background images in a specified
projection
https://journal.r-project.org/archive/2016-1/brown.pdf

p


> Message: 1
> Date: Wed, 22 Mar 2017 18:19:01 +0100
> From: Martin Zuba <martin.zuba at gmx.at>
> To: r-sig-geo at r-project.org
> Subject: [R-sig-Geo] Eurostat shapefiles & google maps offset
> Message-ID:
>         <CAG3rrX6XbtNo8B9oTa=5=Yu7pN3WAA9m+BNC=dXKssA2D_un6Q@
> mail.gmail.com>
> Content-Type: text/plain; charset="UTF-8"
>
> Dear list,
>
> I would like to plot shaded shapefiles with static google maps background
> images.
>
> I obtain the shapefiles from Eurostat, via the eurostat R package.
>
> I obtain the static google background images from using the get_map wrapper
> from the R package ggmap.
>
> My problem is that there seems to be an offset between those two coordinate
> systems. I know that the Eurostat files uss the coordinate reference system
> ETRS89 and google maps uses WSG84, which should be (almost) identical.
>
> However, google images and the shapefiles are somwhat off; and that offset
> is not constant, which indicates that there might be a problem related to
> projections.
>
>
> illustration:
> https://www.dropbox.com/s/34k2ace42ubjjek/eurostatVSgoogle.png?dl=0
>
> replication:
> https://www.dropbox.com/s/hhoc84lrmo42imf/niceEurostat.R?dl=0
>
>
> I welcome any suggestions.
>
> Best Regards,
>
> Martin Zuba
>
>         [[alternative HTML version deleted]]
>
>
>
> ------------------------------
>
> Subject: Digest Footer
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> ------------------------------
>
> End of R-sig-Geo Digest, Vol 163, Issue 20
> ******************************************
>

	[[alternative HTML version deleted]]


From cicoz at anadolu.edu.tr  Mon Mar 27 10:28:58 2017
From: cicoz at anadolu.edu.tr (=?iso-8859-9?B?Q2VuayDdx9Za?=)
Date: Mon, 27 Mar 2017 08:28:58 +0000
Subject: [R-sig-Geo] Negative mse values
Message-ID: <C2AF35551EE58A4487CC3151707449ADBCD29075@mb05.porsuk.anadolu.edu.tr>

Hi  dear friends.

I was trying to smooth a spatial point pattern with kernel function but I am a bit confused .
I need some  explanation about negative MSE values obtained ( used for selecting optimum bandwidth)  by using mse2d function of "splancs " package.
As the definition of mse function  for one dimension I know it might not take negative values.
However I have no idea for the two dimensional definition of mse for a spatial point pattern. Could the mse values be negative in this case? I found an example taking minimum negative value of mse fort he optimum bandwidth which is the lowest negative value
Thanks in advance.


Res. Asst. Cenk Icoz
Statistics Department ,Anadolu University, Turkey



	[[alternative HTML version deleted]]


From r.turner at auckland.ac.nz  Mon Mar 27 12:24:08 2017
From: r.turner at auckland.ac.nz (Rolf Turner)
Date: Mon, 27 Mar 2017 23:24:08 +1300
Subject: [R-sig-Geo] Negative mse values
In-Reply-To: <C2AF35551EE58A4487CC3151707449ADBCD29075@mb05.porsuk.anadolu.edu.tr>
References: <C2AF35551EE58A4487CC3151707449ADBCD29075@mb05.porsuk.anadolu.edu.tr>
Message-ID: <b1e401a8-893a-0248-1c41-db1c3f576100@auckland.ac.nz>


On 27/03/17 21:28, Cenk ???Z via R-sig-Geo wrote:

> Hi  dear friends.
>
> I was trying to smooth a spatial point pattern with kernel function
> but I am a bit confused .
> I need some explanation about negative MSE values obtained ( used
> forselecting optimum bandwidth) by using mse2d function of "splancs " package.
> As the definition of mse function for one dimension I know it might
> not take negative values.
> However I have no idea for the two dimensional definition of mse for
> aspatial point pattern. Could the mse values be negative in this case? I
> found an example taking minimum negative value of mse fort he optimum
> bandwidth which is the lowest negative value

The short answer is that the value returned by mse2d() is not actually 
the MSE but rather MSE minus a data dependent constant.  So this can 
"legitimately" be negative.

The off-setting constant "does no harm" since interest lies in 
determining the optimum bandwidth, so it is the relative sizes of the 
values produced that are of interest.

It has been suggested to me in the past (by Barry Rowlingson, one of the 
original authors of splancs) that the function bw.diggle() from the 
spatstat package may be more reliable than mse2d().  The former function 
uses a somewhat different calculation procedure, whence the results of 
the two functions are not exactly comparable.

Note that bw.diggle() is expressed in terms of "sigma" whereas mse2d()
is expressed in terms of "h" where sigma = h/2. So if mse2d() gives an
"optimal" value of 3, one would *roughly* expect bw.diggle() to give an 
optimal value of 1.5.

Note also that estimating an "optimal" bandwidth is a pretty inexact 
endeavour under the best of circumstances.  The smooth surface to be 
fitted is an ill-determined creature and the bandwidth that gives the 
best fit is even more ill-determined.

cheers,

Rolf Turner

-- 
Technical Editor ANZJS
Department of Statistics
University of Auckland
Phone: +64-9-373-7599 ext. 88276


From cicoz at anadolu.edu.tr  Mon Mar 27 14:03:32 2017
From: cicoz at anadolu.edu.tr (=?utf-8?B?Q2VuayDEsMOHw5Za?=)
Date: Mon, 27 Mar 2017 12:03:32 +0000
Subject: [R-sig-Geo] Negative mse values
In-Reply-To: <b1e401a8-893a-0248-1c41-db1c3f576100@auckland.ac.nz>
References: <C2AF35551EE58A4487CC3151707449ADBCD29075@mb05.porsuk.anadolu.edu.tr>
	<b1e401a8-893a-0248-1c41-db1c3f576100@auckland.ac.nz>
Message-ID: <C2AF35551EE58A4487CC3151707449ADBCD290CB@mb05.porsuk.anadolu.edu.tr>

Thanks Rolf. Now it is settled. I get it. 
I agree they are all ill determined endeavours.
Nonetheless, some has to determine a bandwidth to see the big picture.
What else we can do? . Parametric methods (point processes) or others do not depict the characteristic of the pattern exactly. 
Thanks again.


Res. Asst. Cenk Icoz
Statistics Department , Anadolu University, Turkey


-----Original Message-----
From: Rolf Turner [mailto:r.turner at auckland.ac.nz] 
Sent: Monday, March 27, 2017 1:24 PM
To: Cenk ???Z <cicoz at anadolu.edu.tr>
Cc: r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] Negative mse values


On 27/03/17 21:28, Cenk ???Z via R-sig-Geo wrote:

> Hi  dear friends.
>
> I was trying to smooth a spatial point pattern with kernel function
> but I am a bit confused .
> I need some explanation about negative MSE values obtained ( used
> forselecting optimum bandwidth) by using mse2d function of "splancs " package.
> As the definition of mse function for one dimension I know it might
> not take negative values.
> However I have no idea for the two dimensional definition of mse for
> aspatial point pattern. Could the mse values be negative in this case? I
> found an example taking minimum negative value of mse fort he optimum
> bandwidth which is the lowest negative value

The short answer is that the value returned by mse2d() is not actually 
the MSE but rather MSE minus a data dependent constant.  So this can 
"legitimately" be negative.

The off-setting constant "does no harm" since interest lies in 
determining the optimum bandwidth, so it is the relative sizes of the 
values produced that are of interest.

It has been suggested to me in the past (by Barry Rowlingson, one of the 
original authors of splancs) that the function bw.diggle() from the 
spatstat package may be more reliable than mse2d().  The former function 
uses a somewhat different calculation procedure, whence the results of 
the two functions are not exactly comparable.

Note that bw.diggle() is expressed in terms of "sigma" whereas mse2d()
is expressed in terms of "h" where sigma = h/2. So if mse2d() gives an
"optimal" value of 3, one would *roughly* expect bw.diggle() to give an 
optimal value of 1.5.

Note also that estimating an "optimal" bandwidth is a pretty inexact 
endeavour under the best of circumstances.  The smooth surface to be 
fitted is an ill-determined creature and the bandwidth that gives the 
best fit is even more ill-determined.

cheers,

Rolf Turner

-- 
Technical Editor ANZJS
Department of Statistics
University of Auckland
Phone: +64-9-373-7599 ext. 88276

From Andy.Bunn at wwu.edu  Mon Mar 27 22:55:10 2017
From: Andy.Bunn at wwu.edu (Andy Bunn)
Date: Mon, 27 Mar 2017 20:55:10 +0000
Subject: [R-sig-Geo] AVHRR NDVI3g time series tool?
Message-ID: <D4FEC595.66C9E%andy.bunn@wwu.edu>

Hi all, shot in the dark here. But is there a prefabricated tool for
extracting the biweekly time series from  AVHRR NDVI3g for a particular
set of points? I can download all the data and process it myself but
wondering if there is a package that would make this easy. E.g., what I'd
like would be to have the biweekly NDVI time series from 1981 to 2015 for
these points without processing all the netcdf files:


require(sp)
pts <- data.frame(ID="NOCA","MORA","OLYM",
                  lat=c(48.776, 48.879,47.802),
                  long=c(-121.299,-121.726,-123.604))
coordinates(pts) <- ~lat+long


Can such a thing be easily done?

Thanks in advance for advice, Andy


From mdsumner at gmail.com  Mon Mar 27 23:03:56 2017
From: mdsumner at gmail.com (Michael Sumner)
Date: Mon, 27 Mar 2017 21:03:56 +0000
Subject: [R-sig-Geo] AVHRR NDVI3g time series tool?
In-Reply-To: <D4FEC595.66C9E%andy.bunn@wwu.edu>
References: <D4FEC595.66C9E%andy.bunn@wwu.edu>
Message-ID: <CAAcGz98Mgyqv8Q47zOpLMwF23vKxMiEPhG9mJYtYmGPg0esJOg@mail.gmail.com>

Maybe xtractomatic?

On Tue, Mar 28, 2017, 07:55 Andy Bunn <Andy.Bunn at wwu.edu> wrote:

> Hi all, shot in the dark here. But is there a prefabricated tool for
> extracting the biweekly time series from  AVHRR NDVI3g for a particular
> set of points? I can download all the data and process it myself but
> wondering if there is a package that would make this easy. E.g., what I'd
> like would be to have the biweekly NDVI time series from 1981 to 2015 for
> these points without processing all the netcdf files:
>
>
> require(sp)
> pts <- data.frame(ID="NOCA","MORA","OLYM",
>                   lat=c(48.776, 48.879,47.802),
>                   long=c(-121.299,-121.726,-123.604))
> coordinates(pts) <- ~lat+long
>
>
> Can such a thing be easily done?
>
> Thanks in advance for advice, Andy
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
-- 
Dr. Michael Sumner
Software and Database Engineer
Australian Antarctic Division
203 Channel Highway
Kingston Tasmania 7050 Australia

	[[alternative HTML version deleted]]


From Andy.Bunn at wwu.edu  Tue Mar 28 00:00:47 2017
From: Andy.Bunn at wwu.edu (Andy Bunn)
Date: Mon, 27 Mar 2017 22:00:47 +0000
Subject: [R-sig-Geo] AVHRR NDVI3g time series tool?
In-Reply-To: <CAAcGz98Mgyqv8Q47zOpLMwF23vKxMiEPhG9mJYtYmGPg0esJOg@mail.gmail.com>
References: <D4FEC595.66C9E%andy.bunn@wwu.edu>
	<CAAcGz98Mgyqv8Q47zOpLMwF23vKxMiEPhG9mJYtYmGPg0esJOg@mail.gmail.com>
Message-ID: <D4FED919.66CD4%andy.bunn@wwu.edu>

Huh. That is very cool. It doesn't look like the NDVI data are in ERDDAP. They are all here in a really easy form: https://ecocast.arc.nasa.gov/data/pub/gimms/3g.v1/

I'll dig some more.

Thanks.

From: Michael Sumner <mdsumner at gmail.com<mailto:mdsumner at gmail.com>>
Date: Monday, March 27, 2017 at 2:03 PM
To: Andy Bunn <andy.bunn at wwu.edu<mailto:andy.bunn at wwu.edu>>, R-sig-Geo <r-sig-geo at r-project.org<mailto:r-sig-geo at r-project.org>>
Subject: Re: [R-sig-Geo] AVHRR NDVI3g time series tool?


Maybe xtractomatic?

On Tue, Mar 28, 2017, 07:55 Andy Bunn <Andy.Bunn at wwu.edu<mailto:Andy.Bunn at wwu.edu>> wrote:
Hi all, shot in the dark here. But is there a prefabricated tool for
extracting the biweekly time series from  AVHRR NDVI3g for a particular
set of points? I can download all the data and process it myself but
wondering if there is a package that would make this easy. E.g., what I'd
like would be to have the biweekly NDVI time series from 1981 to 2015 for
these points without processing all the netcdf files:


require(sp)
pts <- data.frame(ID="NOCA","MORA","OLYM",
                  lat=c(48.776, 48.879,47.802),
                  long=c(-121.299,-121.726,-123.604))
coordinates(pts) <- ~lat+long


Can such a thing be easily done?

Thanks in advance for advice, Andy

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org<mailto:R-sig-Geo at r-project.org>
https://stat.ethz.ch/mailman/listinfo/r-sig-geo
--
Dr. Michael Sumner
Software and Database Engineer
Australian Antarctic Division
203 Channel Highway
Kingston Tasmania 7050 Australia


	[[alternative HTML version deleted]]


From dicko.ahmadou at gmail.com  Tue Mar 28 00:29:01 2017
From: dicko.ahmadou at gmail.com (Ahmadou Dicko)
Date: Mon, 27 Mar 2017 22:29:01 +0000
Subject: [R-sig-Geo] AVHRR NDVI3g time series tool?
In-Reply-To: <D4FED919.66CD4%andy.bunn@wwu.edu>
References: <D4FEC595.66C9E%andy.bunn@wwu.edu>
	<CAAcGz98Mgyqv8Q47zOpLMwF23vKxMiEPhG9mJYtYmGPg0esJOg@mail.gmail.com>
	<D4FED919.66CD4%andy.bunn@wwu.edu>
Message-ID: <CAP8THHV+3qbMvzKP+eHGwMfhPw5V+TwatN3vzOFmNUrYQu4tvg@mail.gmail.com>

You can also use the gimms R package and the downloadGimms function.

https://cran.r-project.org/package=gimms

Best

On Mon, Mar 27, 2017 at 10:00 PM, Andy Bunn <Andy.Bunn at wwu.edu> wrote:

> Huh. That is very cool. It doesn't look like the NDVI data are in ERDDAP.
> They are all here in a really easy form: https://ecocast.arc.nasa.gov/
> data/pub/gimms/3g.v1/
>
> I'll dig some more.
>
> Thanks.
>
> From: Michael Sumner <mdsumner at gmail.com<mailto:mdsumner at gmail.com>>
> Date: Monday, March 27, 2017 at 2:03 PM
> To: Andy Bunn <andy.bunn at wwu.edu<mailto:andy.bunn at wwu.edu>>, R-sig-Geo <
> r-sig-geo at r-project.org<mailto:r-sig-geo at r-project.org>>
> Subject: Re: [R-sig-Geo] AVHRR NDVI3g time series tool?
>
>
> Maybe xtractomatic?
>
> On Tue, Mar 28, 2017, 07:55 Andy Bunn <Andy.Bunn at wwu.edu<mailto:Andy
> .Bunn at wwu.edu>> wrote:
> Hi all, shot in the dark here. But is there a prefabricated tool for
> extracting the biweekly time series from  AVHRR NDVI3g for a particular
> set of points? I can download all the data and process it myself but
> wondering if there is a package that would make this easy. E.g., what I'd
> like would be to have the biweekly NDVI time series from 1981 to 2015 for
> these points without processing all the netcdf files:
>
>
> require(sp)
> pts <- data.frame(ID="NOCA","MORA","OLYM",
>                   lat=c(48.776, 48.879,47.802),
>                   long=c(-121.299,-121.726,-123.604))
> coordinates(pts) <- ~lat+long
>
>
> Can such a thing be easily done?
>
> Thanks in advance for advice, Andy
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org<mailto:R-sig-Geo at r-project.org>
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> --
> Dr. Michael Sumner
> Software and Database Engineer
> Australian Antarctic Division
> 203 Channel Highway
> Kingston Tasmania 7050 Australia
>
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



-- 
Ahmadou H. DICKO, PhD

Data Lab Manager
Humanitarian Data Exchange (HDX) - humdata.org
OCHA ROWCA regional office
VDN Sacre Coeur III, Villa 9364 BP 16 922 Fann
Dakar, Senegal
Phone: (+221) 33 869 85 36
Mobile: (+221) 77 123 81 69

Email: dicko5 at un.org
Skype: dicko.ahmadou.h
Twitter : @dickoah
Gitlab: gitlab/dickoa
Github: github/dickoa

	[[alternative HTML version deleted]]


From florian.detsch at staff.uni-marburg.de  Tue Mar 28 08:47:24 2017
From: florian.detsch at staff.uni-marburg.de (Florian Detsch)
Date: Tue, 28 Mar 2017 08:47:24 +0200
Subject: [R-sig-Geo] AVHRR NDVI3g time series tool?
In-Reply-To: <CAP8THHV+3qbMvzKP+eHGwMfhPw5V+TwatN3vzOFmNUrYQu4tvg@mail.gmail.com>
References: <D4FEC595.66C9E%andy.bunn@wwu.edu>
	<CAAcGz98Mgyqv8Q47zOpLMwF23vKxMiEPhG9mJYtYmGPg0esJOg@mail.gmail.com>
	<D4FED919.66CD4%andy.bunn@wwu.edu>
	<CAP8THHV+3qbMvzKP+eHGwMfhPw5V+TwatN3vzOFmNUrYQu4tvg@mail.gmail.com>
Message-ID: <e2e6ffbc-cbfe-5659-29f2-34641b5a40db@staff.uni-marburg.de>

Yeah, well... you can use the gimms package, but you won't get around 
downloading all the NetCDF files (eg using downloadGimms()). Then, 
rasterizeGimms() allows you to specify a spatial extent (ie your spatial 
points' bounding box) in order to automatically create image subsets, 
which significantly reduces computation time and amount of memory needed.

Note that rasterizeGimms() lets you clip images and perform quality 
control in one go. Just have a look at the corresponding GitBook for 
further details: 
https://envin-marburg.gitbooks.io/introducing-the-r-gimms-package/content/.

Best,
Florian



On 28.03.2017 00:29, Ahmadou Dicko wrote:
> You can also use the gimms R package and the downloadGimms function.
>
> https://cran.r-project.org/package=gimms
>
> Best
>
> On Mon, Mar 27, 2017 at 10:00 PM, Andy Bunn <Andy.Bunn at wwu.edu> wrote:
>
>> Huh. That is very cool. It doesn't look like the NDVI data are in ERDDAP.
>> They are all here in a really easy form: https://ecocast.arc.nasa.gov/
>> data/pub/gimms/3g.v1/
>>
>> I'll dig some more.
>>
>> Thanks.
>>
>> From: Michael Sumner <mdsumner at gmail.com<mailto:mdsumner at gmail.com>>
>> Date: Monday, March 27, 2017 at 2:03 PM
>> To: Andy Bunn <andy.bunn at wwu.edu<mailto:andy.bunn at wwu.edu>>, R-sig-Geo <
>> r-sig-geo at r-project.org<mailto:r-sig-geo at r-project.org>>
>> Subject: Re: [R-sig-Geo] AVHRR NDVI3g time series tool?
>>
>>
>> Maybe xtractomatic?
>>
>> On Tue, Mar 28, 2017, 07:55 Andy Bunn <Andy.Bunn at wwu.edu<mailto:Andy
>> .Bunn at wwu.edu>> wrote:
>> Hi all, shot in the dark here. But is there a prefabricated tool for
>> extracting the biweekly time series from  AVHRR NDVI3g for a particular
>> set of points? I can download all the data and process it myself but
>> wondering if there is a package that would make this easy. E.g., what I'd
>> like would be to have the biweekly NDVI time series from 1981 to 2015 for
>> these points without processing all the netcdf files:
>>
>>
>> require(sp)
>> pts <- data.frame(ID="NOCA","MORA","OLYM",
>>                    lat=c(48.776, 48.879,47.802),
>>                    long=c(-121.299,-121.726,-123.604))
>> coordinates(pts) <- ~lat+long
>>
>>
>> Can such a thing be easily done?
>>
>> Thanks in advance for advice, Andy
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org<mailto:R-sig-Geo at r-project.org>
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> --
>> Dr. Michael Sumner
>> Software and Database Engineer
>> Australian Antarctic Division
>> 203 Channel Highway
>> Kingston Tasmania 7050 Australia
>>
>>
>>          [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>

-- 
Dr. Florian Detsch
Environmental Informatics
Department of Geography
Philipps-Universit?t Marburg
Deutschhausstra?e 12
35032 (parcel post: 35037) Marburg, Germany

Phone: +49 (0) 6421 28-25323
Web: http://www.uni-marburg.de/fb19/fachgebiete/umweltinformatik/detschf/index.html


From Andy.Bunn at wwu.edu  Tue Mar 28 22:37:54 2017
From: Andy.Bunn at wwu.edu (Andy Bunn)
Date: Tue, 28 Mar 2017 20:37:54 +0000
Subject: [R-sig-Geo] AVHRR NDVI3g time series tool?
In-Reply-To: <e2e6ffbc-cbfe-5659-29f2-34641b5a40db@staff.uni-marburg.de>
References: <D4FEC595.66C9E%andy.bunn@wwu.edu>
	<CAAcGz98Mgyqv8Q47zOpLMwF23vKxMiEPhG9mJYtYmGPg0esJOg@mail.gmail.com>
	<D4FED919.66CD4%andy.bunn@wwu.edu>
	<CAP8THHV+3qbMvzKP+eHGwMfhPw5V+TwatN3vzOFmNUrYQu4tvg@mail.gmail.com>
	<e2e6ffbc-cbfe-5659-29f2-34641b5a40db@staff.uni-marburg.de>
Message-ID: <D5001739.66DB6%andy.bunn@wwu.edu>

Great. Thanks so much for this package. I'll look into it.So many great
tools for working with these data. The last time I wrestled with the GIMMs
data for research was 12 years ago and boy was it a pain processing them
all. This is great!

On 3/27/17, 11:47 PM, "R-sig-Geo on behalf of Florian Detsch"
<r-sig-geo-bounces at r-project.org on behalf of
florian.detsch at staff.uni-marburg.de> wrote:

>Yeah, well... you can use the gimms package, but you won't get around
>downloading all the NetCDF files (eg using downloadGimms()). Then,
>rasterizeGimms() allows you to specify a spatial extent (ie your spatial
>points' bounding box) in order to automatically create image subsets,
>which significantly reduces computation time and amount of memory needed.
>
>Note that rasterizeGimms() lets you clip images and perform quality
>control in one go. Just have a look at the corresponding GitBook for
>further details: 
>https://envin-marburg.gitbooks.io/introducing-the-r-gimms-package/content/
>.
>
>Best,
>Florian
>
>
>
>On 28.03.2017 00:29, Ahmadou Dicko wrote:
>> You can also use the gimms R package and the downloadGimms function.
>>
>> https://cran.r-project.org/package=gimms
>>
>> Best
>>
>> On Mon, Mar 27, 2017 at 10:00 PM, Andy Bunn <Andy.Bunn at wwu.edu> wrote:
>>
>>> Huh. That is very cool. It doesn't look like the NDVI data are in
>>>ERDDAP.
>>> They are all here in a really easy form: https://ecocast.arc.nasa.gov/
>>> data/pub/gimms/3g.v1/
>>>
>>> I'll dig some more.
>>>
>>> Thanks.
>>>
>>> From: Michael Sumner <mdsumner at gmail.com<mailto:mdsumner at gmail.com>>
>>> Date: Monday, March 27, 2017 at 2:03 PM
>>> To: Andy Bunn <andy.bunn at wwu.edu<mailto:andy.bunn at wwu.edu>>, R-sig-Geo
>>><
>>> r-sig-geo at r-project.org<mailto:r-sig-geo at r-project.org>>
>>> Subject: Re: [R-sig-Geo] AVHRR NDVI3g time series tool?
>>>
>>>
>>> Maybe xtractomatic?
>>>
>>> On Tue, Mar 28, 2017, 07:55 Andy Bunn <Andy.Bunn at wwu.edu<mailto:Andy
>>> .Bunn at wwu.edu>> wrote:
>>> Hi all, shot in the dark here. But is there a prefabricated tool for
>>> extracting the biweekly time series from  AVHRR NDVI3g for a particular
>>> set of points? I can download all the data and process it myself but
>>> wondering if there is a package that would make this easy. E.g., what
>>>I'd
>>> like would be to have the biweekly NDVI time series from 1981 to 2015
>>>for
>>> these points without processing all the netcdf files:
>>>
>>>
>>> require(sp)
>>> pts <- data.frame(ID="NOCA","MORA","OLYM",
>>>                    lat=c(48.776, 48.879,47.802),
>>>                    long=c(-121.299,-121.726,-123.604))
>>> coordinates(pts) <- ~lat+long
>>>
>>>
>>> Can such a thing be easily done?
>>>
>>> Thanks in advance for advice, Andy
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org<mailto:R-sig-Geo at r-project.org>
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>> --
>>> Dr. Michael Sumner
>>> Software and Database Engineer
>>> Australian Antarctic Division
>>> 203 Channel Highway
>>> Kingston Tasmania 7050 Australia
>>>
>>>
>>>          [[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>>
>
>-- 
>Dr. Florian Detsch
>Environmental Informatics
>Department of Geography
>Philipps-Universit?t Marburg
>Deutschhausstra?e 12
>35032 (parcel post: 35037) Marburg, Germany
>
>Phone: +49 (0) 6421 28-25323
>Web: 
>http://www.uni-marburg.de/fb19/fachgebiete/umweltinformatik/detschf/index.
>html
>
>_______________________________________________
>R-sig-Geo mailing list
>R-sig-Geo at r-project.org
>https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From binbinlu at whu.edu.cn  Wed Mar 29 11:19:23 2017
From: binbinlu at whu.edu.cn (binbinlu at whu.edu.cn)
Date: Wed, 29 Mar 2017 17:19:23 +0800 (GMT+08:00)
Subject: [R-sig-Geo] New verison of GWmodel on CRAN
Message-ID: <7d6b1049.45ac.15b195ccb77.Coremail.binbinlu@whu.edu.cn>

Dear all,

As you noticed, there are 2.0-x versions of GWmodel available on CRAN recently.  In cotrast to the 1.x-x versions, there are a number of new features, as follows:
1)  Some of the more computationally intensive functions have been re-coded with C++ by linking to Rcpp and RcppArmadillo. Their computational efficiency has been greatly improved.
2)  In order to make the function names more understandable, some of the funcitons have been re-named:
    montecarlo.gwss	---> gwss.montecarlo
    montecarlo.gwpca.1	--->  gwpca.montecarlo.1
    montecarlo.gwpca.2 	---> gwpca.montecarlo.2
    model.selection.gwr	---> gwr.model.selection
    model.view.gwr	--->  gwr.model.view
    model.sort.gwr	--->  gwr.model.sort
    montecarlo.gwr ---> gwr.montecarlo
    writeGWR 	---> gwr.write
    writeGWR.shp ---> gwr.write.shp
    glyph.plot	 ---> gwpca.glyph.plot
    check.components 	---> gwpca.check.components
    mink.approach ---> gwr.mink.approach
    matrixview 	---> gwr.mink.matrixview
    gwr.generalised ---> ggwr.basic (A reported bug has been fixed with it, and now it is fine with GWmodel_2.0-2 or GWmodel_2.0-3)

Note that we will keep the accesses to to the old names, to ensure the example code work well in the two published vignettes Lu et a. (2014) and Gollini et al. (2015):

    Gollini I, Lu B, Charlton M, Brunsdon C, Harris P (2015) GWmodel: an R Package for exploring Spatial Heterogeneity using Geographically Weighted Models. Journal of Statistical Software, 63(17):1-50, http://www.jstatsoft.org/v63/i17/ 
    Lu B, Harris P, Charlton M, Brunsdon C (2014) The GWmodel R Package: further topics for exploring 17(2): 85-101,http://www.tandfonline.com/doi/abs/10.1080/10095020.2014.917453 

3) New features and functions are included:
   
   bw.gw.average: Select bandwidth for GW averages;
   gwr.mink.pval: Select the values of p for the Minkovski approach for GWR (see details in Lu et al. 2016: Lu, B, Charlton, M, Brunsdon, C & Harris, P(2016). The Minkowski approach for choosing the distance metric in Geographically Weighted Regression. International Journal of Geographical Information Science, 30(2): 351-368. )
   For an adaptive kernel, the bandwidth (the number of nearest neighbours) can be specified as a larger number than the number of observations, and in this case the real value for calculating the weights is {the maximum distance between regression location and all the observations} * (bandwidth/number of observations)

4) Bugs repaired for gwr.basic, gw.dist and ggwr.basic (Please update or install the latest version: GWmodel_2.0-3)

Do feel free to make any suggestions/comments on the new versions. Many thanks.

Best regards,

GWmodel Developement Team


From julian.burgos at hafogvatn.is  Wed Mar 29 19:39:53 2017
From: julian.burgos at hafogvatn.is (Julian M. Burgos)
Date: Wed, 29 Mar 2017 17:39:53 +0000
Subject: [R-sig-Geo] Eurostat shapefiles & google maps offset
In-Reply-To: <CAG3rrX6XbtNo8B9oTa=5=Yu7pN3WAA9m+BNC=dXKssA2D_un6Q@mail.gmail.com>
References: <CAG3rrX6XbtNo8B9oTa=5=Yu7pN3WAA9m+BNC=dXKssA2D_un6Q@mail.gmail.com>
Message-ID: <xgzlgrokmmu.fsf@hafogvatn.is>

Martin, as far as I know Google images are in EPSG:3857, which is an
spherical Mercator projection, and not in WSG84.  The solution is to use
the spTransform function to project your polygons to EPSG:3857.

Julian

Martin Zuba writes:

> Dear list,
>
> I would like to plot shaded shapefiles with static google maps background
> images.
>
> I obtain the shapefiles from Eurostat, via the eurostat R package.
>
> I obtain the static google background images from using the get_map wrapper
> from the R package ggmap.
>
> My problem is that there seems to be an offset between those two coordinate
> systems. I know that the Eurostat files uss the coordinate reference system
> ETRS89 and google maps uses WSG84, which should be (almost) identical.
>
> However, google images and the shapefiles are somwhat off; and that offset
> is not constant, which indicates that there might be a problem related to
> projections.
>
>
> illustration:
> https://www.dropbox.com/s/34k2ace42ubjjek/eurostatVSgoogle.png?dl=0
>
> replication:
> https://www.dropbox.com/s/hhoc84lrmo42imf/niceEurostat.R?dl=0
>
>
> I welcome any suggestions.
>
> Best Regards,
>
> Martin Zuba
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


--
Julian Mariano Burgos, PhD
Hafranns?knastofnun, ranns?kna- og r??gjafarstofnun hafs og vatna/
Marine and Freshwater Research Institute
Sk?lagata 4, 121 Reykjav?k, Iceland
S?mi/Telephone : +354-5752037
Br?fs?mi/Telefax:  +354-5752001
Netfang/Email: julian.burgos at hafogvatn.is


From phawkins at connact.com  Thu Mar 30 16:10:12 2017
From: phawkins at connact.com (Patricia J. Hawkins)
Date: Thu, 30 Mar 2017 10:10:12 -0400
Subject: [R-sig-Geo] Eurostat shapefiles & google maps offset
In-Reply-To: <CAG3rrX6XbtNo8B9oTa=5=Yu7pN3WAA9m+BNC=dXKssA2D_un6Q@mail.gmail.com>
	(Martin Zuba's message of "Wed, 22 Mar 2017 18:19:01 +0100")
References: <CAG3rrX6XbtNo8B9oTa=5=Yu7pN3WAA9m+BNC=dXKssA2D_un6Q@mail.gmail.com>
Message-ID: <877f364zzv.fsf@connact.com>

Hi, when I run your example code, I get the following warnings from your 
get_map calls: 

"Warning: bounding box given to google - spatial extent only approximate.
converting bounding box to center/zoom specification. (experimental)
Map from URL : http://maps.googleapis.com/maps/api/staticmap?center=47.474661,16.578517&zoom=7&size=640x640&scale=2&maptype=terrain&language=en-EN&sensor=false"

"Warning: bounding box given to google - spatial extent only approximate.
converting bounding box to center/zoom specification. (experimental)
Map from URL :
http://maps.googleapis.com/maps/api/staticmap?center=47.925583,15.807816&zoom=6&size=640x640&scale=2&maptype=terrain&language=en-EN&sensor=false"

Seems Google maps is giving you images with an exact center, but
approximate bounds, which are not quite the same as the limits you gave it.  

And you are calculating your clipping boxes from your limits, not from
the center, so the difference between your limits and google's
approximation shows up in your overlays.  And you're getting a different
approximation in the second call, hence the different offset. 

Don't ignore warnings; understand them.

May I say, the reason you've gotten slow help on this is that this
*isn't* a minimal demonstration of the problem?   Also, your coding
style makes your code difficult to read, and is a big potential source
of bugs.

* For a minimal example, you need to cut out all other transforms and
  massaging, so far as possible.  Your massaging of the eurostat data
  could be a source of the problem, and your readers have to spend time
  looking at it and understanding it.

  Cutting down to a truly minimal example is also a good way to find
  the problem for yourself.  And it will make you a better programmer. 

* You calculate the same value repeatedly: Doing this is potentially
  inefficient, a big source of errors, and a tax on anyone who reads your code. 

  For instance,  you could do:
  center.lat <- mean(range(map.dat$lat,na.rm=TRUE))
  center.lon <- mean(range(map.dat$lon,na.rm=TRUE))

  and just reuse that, with much greater clarity.

* Don't include raw constants in your code -- for instance, 1.1, 5.
  This is always a bad practice, and here it's another tax on your
  reader: what does "5" mean?  

  Better to use a variable, which a) documents your code and b) only
  needs to be changed in one place, not throughout your code.  Just try
  "query replace 5" sometime, in a big piece of code.
  
  For example: 

  large_scaling_factor <- 5
  small_scaling_factor <- 1.1

I hope you find this useful -- these are some simple practices that can
save you many, many hours of confusion and debugging.

And just as an aside, I was amused to see that the center of your first
bounding box is between Kleinmutschen and Gro?mutschen.  Have courage --
at least a little!

-- 
Patricia J. Hawkins


