From WSteenbeek at nscr.nl  Mon Jun  2 17:31:55 2014
From: WSteenbeek at nscr.nl (Wouter Steenbeek)
Date: Mon, 2 Jun 2014 15:31:55 +0000
Subject: [R-sig-Geo] Cut SpatialLines into two Lines when intersecting with
	SpatialPolyon
Message-ID: <E9C18A23CC90B64F91C6A03B094B1B7E1980E0@MAIL01.arthur.nscr.nl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140602/88a6742a/attachment.pl>

From markpayneatwork at gmail.com  Tue Jun  3 08:27:07 2014
From: markpayneatwork at gmail.com (Mark Payne)
Date: Tue, 3 Jun 2014 08:27:07 +0200
Subject: [R-sig-Geo] (Linear) interpolation in three (or more) dimensions
Message-ID: <CAGBzUO8cvxV3iWBzNSoB=422GH_i8Sqa1za2fOiD16r23t6w3Q@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140603/63b23b51/attachment.pl>

From kridox at ymail.com  Tue Jun  3 08:35:48 2014
From: kridox at ymail.com (Pascal Oettli)
Date: Tue, 3 Jun 2014 15:35:48 +0900
Subject: [R-sig-Geo] (Linear) interpolation in three (or more) dimensions
In-Reply-To: <CAGBzUO8cvxV3iWBzNSoB=422GH_i8Sqa1za2fOiD16r23t6w3Q@mail.gmail.com>
References: <CAGBzUO8cvxV3iWBzNSoB=422GH_i8Sqa1za2fOiD16r23t6w3Q@mail.gmail.com>
Message-ID: <CAAcyNCwo_T1Fm+iqU+BdhUmLnQLHRH9-Kwd=FTR8v-HJPgE_ZQ@mail.gmail.com>

Hello Mark,

The DINEOF method is designed for problems as yours.

There is an implementation in R here
(http://menugget.blogspot.de/2012/10/dineof-data-interpolating-empirical.html)
but it doesn't directly work on Raster* object.

Hope this helps,
Pascal

On Tue, Jun 3, 2014 at 3:27 PM, Mark Payne <markpayneatwork at gmail.com> wrote:
> Hi,
>
> I have a dataset that consists of satellite observations on a regular
> lon-lat grid at taken at regularly time pointts. Unfortunately due to cloud
> cover, there are gaps dispersed semi-randomly throughout the 3D data array.
> I would like to fill these gaps.
>
> The "best" solution I guess is space-time kriging, if memory limitations
> permit. But before I go that far, I would like to do a simple 3D linear
> interpolation to fill the gaps i.e interpolating the temperature at the
> missing (lon, lat, time) points.
>
> The akima package does an excellent job of this in 2D, but doesn't support
> higher dimensionality. Does anyone know of a function that supports three
> or more dimensions?
>
> Mark
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



-- 
Pascal Oettli
Project Scientist
JAMSTEC
Yokohama, Japan


From edzer.pebesma at uni-muenster.de  Tue Jun  3 09:37:42 2014
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Tue, 03 Jun 2014 09:37:42 +0200
Subject: [R-sig-Geo] (Linear) interpolation in three (or more) dimensions
In-Reply-To: <CAGBzUO8cvxV3iWBzNSoB=422GH_i8Sqa1za2fOiD16r23t6w3Q@mail.gmail.com>
References: <CAGBzUO8cvxV3iWBzNSoB=422GH_i8Sqa1za2fOiD16r23t6w3Q@mail.gmail.com>
Message-ID: <538D7B46.4000203@uni-muenster.de>

package gstat offers simple 3D interpolation (idw, kriging), e.g.

library(gstat)
example(gstat3D)

and also spatio-temporal kriging; some memory limitations there may be
dealt with by using local kriging (see ?krigeST).

On 06/03/2014 08:27 AM, Mark Payne wrote:
> Hi,
> 
> I have a dataset that consists of satellite observations on a regular
> lon-lat grid at taken at regularly time pointts. Unfortunately due to cloud
> cover, there are gaps dispersed semi-randomly throughout the 3D data array.
> I would like to fill these gaps.
> 
> The "best" solution I guess is space-time kriging, if memory limitations
> permit. But before I go that far, I would like to do a simple 3D linear
> interpolation to fill the gaps i.e interpolating the temperature at the
> missing (lon, lat, time) points.
> 
> The akima package does an excellent job of this in 2D, but doesn't support
> higher dimensionality. Does anyone know of a function that supports three
> or more dimensions?
> 
> Mark
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
83 33081 http://ifgi.uni-muenster.de GPG key ID 0xAC227795

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 490 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140603/a1bcba40/attachment.bin>

From WSteenbeek at nscr.nl  Tue Jun  3 11:04:52 2014
From: WSteenbeek at nscr.nl (Wouter Steenbeek)
Date: Tue, 3 Jun 2014 09:04:52 +0000
Subject: [R-sig-Geo] Cut SpatialLines into two Lines when intersecting with
	SpatialPolyon
In-Reply-To: <E9C18A23CC90B64F91C6A03B094B1B7E1980E0@MAIL01.arthur.nscr.nl>
References: <E9C18A23CC90B64F91C6A03B094B1B7E1980E0@MAIL01.arthur.nscr.nl>
Message-ID: <E9C18A23CC90B64F91C6A03B094B1B7E19820D@MAIL01.arthur.nscr.nl>

[My apologies if this is a double post. I wrote the first post in HTML, and I think it may not have gotten through.]

I have a SpatialLines(DataFrame) (e.g. streets) and SpatialPolygons(DataFrame) (e.g. neighborhoods). When a Line intersects with a polygon boundary, I want to split this Line into two new Lines. So: if a street begins in one neighborhood and ends in another neighborhood, I want to remove the original SpatialLine and replace that by two SpatialLines (streets): one street from the starting point until the intersection with the polygon boundary, and another street from the intersection with the polygon boundary to the original end point.

Can someone give me advice on how to do this?

Cheers,
Wouter


From Roger.Bivand at nhh.no  Tue Jun  3 11:22:45 2014
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 3 Jun 2014 11:22:45 +0200
Subject: [R-sig-Geo] Cut SpatialLines into two Lines when intersecting
 with	SpatialPolyon
In-Reply-To: <E9C18A23CC90B64F91C6A03B094B1B7E19820D@MAIL01.arthur.nscr.nl>
References: <E9C18A23CC90B64F91C6A03B094B1B7E1980E0@MAIL01.arthur.nscr.nl>
	<E9C18A23CC90B64F91C6A03B094B1B7E19820D@MAIL01.arthur.nscr.nl>
Message-ID: <alpine.LRH.2.03.1406031119330.2723@reclus.nhh.no>

On Tue, 3 Jun 2014, Wouter Steenbeek wrote:

> [My apologies if this is a double post. I wrote the first post in HTML, 
> and I think it may not have gotten through.]

Thanks for respecting our guidelines - it is much harder to infect plain 
text, which is why HTML is not welcome.

>
> I have a SpatialLines(DataFrame) (e.g. streets) and 
> SpatialPolygons(DataFrame) (e.g. neighborhoods). When a Line intersects 
> with a polygon boundary, I want to split this Line into two new Lines. 
> So: if a street begins in one neighborhood and ends in another 
> neighborhood, I want to remove the original SpatialLine and replace that 
> by two SpatialLines (streets): one street from the starting point until 
> the intersection with the polygon boundary, and another street from the 
> intersection with the polygon boundary to the original end point.
>
> Can someone give me advice on how to do this?

As in most cases, you will increase your chances of a reply if you provide 
a toy example, for instance using readWKT() in rgeos to generate the 
objects. Probably all you need is in rgeos, but without a toy example, it 
is hard to give advice that isn't more like hand-waving.

Roger

>
> Cheers,
> Wouter
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no


From jwm302 at gmail.com  Tue Jun  3 15:05:16 2014
From: jwm302 at gmail.com (Justin Michell)
Date: Tue, 3 Jun 2014 15:05:16 +0200
Subject: [R-sig-Geo] Error in extract function in Raster package on Mac OS X
Message-ID: <37B013C9-6476-45D6-827E-B38A8EAB488F@gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140603/a035d19b/attachment.pl>

From jwm302 at gmail.com  Tue Jun  3 16:00:14 2014
From: jwm302 at gmail.com (Justin Michell)
Date: Tue, 3 Jun 2014 16:00:14 +0200
Subject: [R-sig-Geo] Error in extract function in Raster package on Mac
	OS X
In-Reply-To: <B879AF6D5CB2A040A61A6DB25A700B0510846777@EXMBX2010-5.campus.MCGILL.CA>
References: <37B013C9-6476-45D6-827E-B38A8EAB488F@gmail.com>
	<B879AF6D5CB2A040A61A6DB25A700B0510846777@EXMBX2010-5.campus.MCGILL.CA>
Message-ID: <4A20B22C-3B79-4FFC-919B-79C94BC3CCE3@gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140603/f154729b/attachment.pl>

From WSteenbeek at nscr.nl  Tue Jun  3 16:56:53 2014
From: WSteenbeek at nscr.nl (Wouter Steenbeek)
Date: Tue, 3 Jun 2014 14:56:53 +0000
Subject: [R-sig-Geo] Cut SpatialLines into two Lines when intersecting
 with	SpatialPolyon
In-Reply-To: <alpine.LRH.2.03.1406031119330.2723@reclus.nhh.no>
References: <E9C18A23CC90B64F91C6A03B094B1B7E1980E0@MAIL01.arthur.nscr.nl>
	<E9C18A23CC90B64F91C6A03B094B1B7E19820D@MAIL01.arthur.nscr.nl>
	<alpine.LRH.2.03.1406031119330.2723@reclus.nhh.no>
Message-ID: <E9C18A23CC90B64F91C6A03B094B1B7E198375@MAIL01.arthur.nscr.nl>

I'm sorry I didn't provide a toy example. I figured it was a simple question and I just couldn't find some well-known function.

I am not very familiar with readWKT(), but I used the sp_intro text to generate the following example:

library(sp)

Sr1 = Polygon(cbind(c(2,4,4,1,2),c(2,3,5,4,2)))
Sr2 = Polygon(cbind(c(5,4,2,5),c(2,3,2,2)))
Sr3 = Polygon(cbind(c(4,4,5,6,6,4),c(5,3,2,2,5,5)))
Sr4 = Polygon(cbind(c(6,6,8,8,6),c(5,2,2,5,5)))
Srs1 = Polygons(list(Sr1), "s1")
Srs2 = Polygons(list(Sr2), "s2")
Srs3 = Polygons(list(Sr3), "s3")
Srs4 = Polygons(list(Sr4), "s4")
SpP = SpatialPolygons(list(Srs1,Srs2,Srs3, Srs4), 1:4)
plot(SpP, col = 5:8) # these are three example neighborhoods

l1 = cbind(c(2,5),c(4,4))
l2 = cbind(c(5,7),c(3,3))
Sl1 = Line(l1)
Sl2 = Line(l2)
S1 = Lines(list(Sl1), ID="a")
S2 = Lines(list(Sl2), ID="b")
Sl = SpatialLines(list(S1,S2))
plot(Sl, add=TRUE) # two streets, which cross neighborhood boundaries

I am looking for a way to recode the lines into separate lines, when they cross a polygon boundary. So the resulting SpatialLines object should, for SpatialLine #1, have two new lines: one from (2,4) to (4,4), and another line from (4,4) to (5,4). For SpatialLine #2 there should also be two new lines created: one from (5,3) to (6,3) and another one from (6,3) to (7,3). Ideally these new lines should rename the IDs of the original SpatialLines in a convenient way.

Outcome would be a new SpatialLines object:

l1_1 = cbind(c(2,4),c(4,4))
l1_2 = cbind(c(4,5),c(4,4))
l2_1 = cbind(c(5,6),c(3,3))
l2_2 = cbind(c(6,7),c(3,3))
Sl1_1 = Line(l1_1)
Sl1_2 = Line(l1_2)
Sl2_1 = Line(l2_1)
Sl2_2 = Line(l2_2)
S1_1 = Lines(list(Sl1_1), ID="a_1")
S1_2 = Lines(list(Sl1_2), ID="a_2")
S2_1 = Lines(list(Sl2_1), ID="b_1")
S2_2 = Lines(list(Sl2_2), ID="b_2")
Sl2 = SpatialLines(list(S1_1,S1_2,S2_1,S2_2))
plot(Sl2, add=TRUE, col=1:4)

So I would like to convert Sl into Sl2 in some automatic manner. I'm thinking I should use "over" (from sp) to get the intersections of lines and polygons and go from there. But I don't quite see how to proceed from there (ie how to automatically "cut" a line into two lines).

By the way, if this is important to know: I'm actually working with SpatialPolygonsDataFrame and SpatialLinesDataFrame. So it would be nice if the two new lines (for example, S1_1 and S1_2) simply inherit the entire dataframe of the parent (in this example, the df attached to S1). My apologies that I don't provide that in the toy example, but I thought I'd keep the example as simple as possible.

Cheers,
Wouter



-----Original Message-----
From: Roger Bivand [mailto:Roger.Bivand at nhh.no] 
Sent: Tuesday, June 03, 2014 11:23 AM
To: Wouter Steenbeek
Cc: 'r-sig-geo at r-project.org'
Subject: Re: [R-sig-Geo] Cut SpatialLines into two Lines when intersecting with SpatialPolyon

On Tue, 3 Jun 2014, Wouter Steenbeek wrote:

> [My apologies if this is a double post. I wrote the first post in 
> HTML, and I think it may not have gotten through.]

Thanks for respecting our guidelines - it is much harder to infect plain text, which is why HTML is not welcome.

>
> I have a SpatialLines(DataFrame) (e.g. streets) and
> SpatialPolygons(DataFrame) (e.g. neighborhoods). When a Line 
> intersects with a polygon boundary, I want to split this Line into two new Lines.
> So: if a street begins in one neighborhood and ends in another 
> neighborhood, I want to remove the original SpatialLine and replace 
> that by two SpatialLines (streets): one street from the starting point 
> until the intersection with the polygon boundary, and another street 
> from the intersection with the polygon boundary to the original end point.
>
> Can someone give me advice on how to do this?

As in most cases, you will increase your chances of a reply if you provide a toy example, for instance using readWKT() in rgeos to generate the objects. Probably all you need is in rgeos, but without a toy example, it is hard to give advice that isn't more like hand-waving.

Roger

>
> Cheers,
> Wouter
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

--
Roger Bivand
Department of Economics, Norwegian School of Economics, Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no


From Roger.Bivand at nhh.no  Tue Jun  3 17:21:31 2014
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 3 Jun 2014 17:21:31 +0200
Subject: [R-sig-Geo] Cut SpatialLines into two Lines when intersecting
 with SpatialPolyon
In-Reply-To: <E9C18A23CC90B64F91C6A03B094B1B7E198375@MAIL01.arthur.nscr.nl>
References: <E9C18A23CC90B64F91C6A03B094B1B7E1980E0@MAIL01.arthur.nscr.nl>
	<E9C18A23CC90B64F91C6A03B094B1B7E19820D@MAIL01.arthur.nscr.nl>
	<alpine.LRH.2.03.1406031119330.2723@reclus.nhh.no>
	<E9C18A23CC90B64F91C6A03B094B1B7E198375@MAIL01.arthur.nscr.nl>
Message-ID: <alpine.LRH.2.03.1406031716130.5312@reclus.nhh.no>

On Tue, 3 Jun 2014, Wouter Steenbeek wrote:

> I'm sorry I didn't provide a toy example. I figured it was a simple 
> question and I just couldn't find some well-known function.
>
> I am not very familiar with readWKT(), but I used the sp_intro text to 
> generate the following example:
>
> library(sp)
>
> Sr1 = Polygon(cbind(c(2,4,4,1,2),c(2,3,5,4,2)))
> Sr2 = Polygon(cbind(c(5,4,2,5),c(2,3,2,2)))
> Sr3 = Polygon(cbind(c(4,4,5,6,6,4),c(5,3,2,2,5,5)))
> Sr4 = Polygon(cbind(c(6,6,8,8,6),c(5,2,2,5,5)))
> Srs1 = Polygons(list(Sr1), "s1")
> Srs2 = Polygons(list(Sr2), "s2")
> Srs3 = Polygons(list(Sr3), "s3")
> Srs4 = Polygons(list(Sr4), "s4")
> SpP = SpatialPolygons(list(Srs1,Srs2,Srs3, Srs4), 1:4)
> plot(SpP, col = 5:8) # these are three example neighborhoods
>
> l1 = cbind(c(2,5),c(4,4))
> l2 = cbind(c(5,7),c(3,3))
> Sl1 = Line(l1)
> Sl2 = Line(l2)
> S1 = Lines(list(Sl1), ID="a")
> S2 = Lines(list(Sl2), ID="b")
> Sl = SpatialLines(list(S1,S2))
> plot(Sl, add=TRUE) # two streets, which cross neighborhood boundaries
>
> I am looking for a way to recode the lines into separate lines, when they cross a polygon boundary. So the resulting SpatialLines object should, for SpatialLine #1, have two new lines: one from (2,4) to (4,4), and another line from (4,4) to (5,4). For SpatialLine #2 there should also be two new lines created: one from (5,3) to (6,3) and another one from (6,3) to (7,3). Ideally these new lines should rename the IDs of the original SpatialLines in a convenient way.
>
> Outcome would be a new SpatialLines object:
>
> l1_1 = cbind(c(2,4),c(4,4))
> l1_2 = cbind(c(4,5),c(4,4))
> l2_1 = cbind(c(5,6),c(3,3))
> l2_2 = cbind(c(6,7),c(3,3))
> Sl1_1 = Line(l1_1)
> Sl1_2 = Line(l1_2)
> Sl2_1 = Line(l2_1)
> Sl2_2 = Line(l2_2)
> S1_1 = Lines(list(Sl1_1), ID="a_1")
> S1_2 = Lines(list(Sl1_2), ID="a_2")
> S2_1 = Lines(list(Sl2_1), ID="b_1")
> S2_2 = Lines(list(Sl2_2), ID="b_2")
> Sl2 = SpatialLines(list(S1_1,S1_2,S2_1,S2_2))
> plot(Sl2, add=TRUE, col=1:4)
>
gI <- gIntersection(SpP, Sl, byid=c(TRUE, TRUE))
plot(gI, col=1:4, lwd=2, add=TRUE)
row.names(gI)

The row.names() of the output are predictable, and can be modified by 
modifying the row.names of the input objects.

> So I would like to convert Sl into Sl2 in some automatic manner. I'm 
> thinking I should use "over" (from sp) to get the intersections of lines 
> and polygons and go from there. But I don't quite see how to proceed 
> from there (ie how to automatically "cut" a line into two lines).
>
> By the way, if this is important to know: I'm actually working with 
> SpatialPolygonsDataFrame and SpatialLinesDataFrame. So it would be nice 
> if the two new lines (for example, S1_1 and S1_2) simply inherit the 
> entire dataframe of the parent (in this example, the df attached to S1). 
> My apologies that I don't provide that in the toy example, but I thought 
> I'd keep the example as simple as possible.

No, you have to figure this out youself, using the components of the 
row.names of the output object, and ensure that the names of the variables 
in the new data.frame object are unique.

Hope this helps,

Roger

>
> Cheers,
> Wouter
>
>
>
> -----Original Message-----
> From: Roger Bivand [mailto:Roger.Bivand at nhh.no]
> Sent: Tuesday, June 03, 2014 11:23 AM
> To: Wouter Steenbeek
> Cc: 'r-sig-geo at r-project.org'
> Subject: Re: [R-sig-Geo] Cut SpatialLines into two Lines when intersecting with SpatialPolyon
>
> On Tue, 3 Jun 2014, Wouter Steenbeek wrote:
>
>> [My apologies if this is a double post. I wrote the first post in
>> HTML, and I think it may not have gotten through.]
>
> Thanks for respecting our guidelines - it is much harder to infect plain text, which is why HTML is not welcome.
>
>>
>> I have a SpatialLines(DataFrame) (e.g. streets) and
>> SpatialPolygons(DataFrame) (e.g. neighborhoods). When a Line
>> intersects with a polygon boundary, I want to split this Line into two new Lines.
>> So: if a street begins in one neighborhood and ends in another
>> neighborhood, I want to remove the original SpatialLine and replace
>> that by two SpatialLines (streets): one street from the starting point
>> until the intersection with the polygon boundary, and another street
>> from the intersection with the polygon boundary to the original end point.
>>
>> Can someone give me advice on how to do this?
>
> As in most cases, you will increase your chances of a reply if you provide a toy example, for instance using readWKT() in rgeos to generate the objects. Probably all you need is in rgeos, but without a toy example, it is hard to give advice that isn't more like hand-waving.
>
> Roger
>
>>
>> Cheers,
>> Wouter
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> --
> Roger Bivand
> Department of Economics, Norwegian School of Economics, Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; fax +47 55 95 91 00
> e-mail: Roger.Bivand at nhh.no
>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no


From ortiz-bobea at rff.org  Tue Jun  3 20:16:51 2014
From: ortiz-bobea at rff.org (Ariel Ortiz-Bobea)
Date: Tue, 3 Jun 2014 11:16:51 -0700 (PDT)
Subject: [R-sig-Geo] Failure during raster IO
In-Reply-To: <1372118637340-7583906.post@n2.nabble.com>
References: <CAPD=AxpFNas=+yxg_cUK9-+GXT6s4ED6GBaswKtah-WiRmRmhQ@mail.gmail.com>
	<CANtt_hxEcK7FPxrjDUQXTO4vFQHsKsDW6JfDmkD+jjOVs_VfrA@mail.gmail.com>
	<1359672082466-7582447.post@n2.nabble.com>
	<CANtt_hzt3Lt_p9nsF6ro=u8L-Uf5BMkOT2Cj9ufAsMSuZV51mA@mail.gmail.com>
	<1372118637340-7583906.post@n2.nabble.com>
Message-ID: <1401819411549-7586548.post@n2.nabble.com>

Ran into a similar problem and was getting "Failure during raster IO" when
using extract on a very large raster with a small polygon. My solution was
to crop the large raster before doing the extract. Maybe this can help other
folks in the future. Cheers.
Ariel



-----
Ariel Ortiz-Bobea
Fellow at Resources for the Future
--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Failure-during-raster-IO-tp7582421p7586548.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From azvoleff at conservation.org  Tue Jun  3 20:40:19 2014
From: azvoleff at conservation.org (Alex Zvoleff)
Date: Tue, 3 Jun 2014 14:40:19 -0400
Subject: [R-sig-Geo] Adding smoothing factor to terrain function in
	raster
In-Reply-To: <CACwzsXFniWQJ5P=UMFF58YW30uKOmETy6KH1x56k1b48En89cg@mail.gmail.com>
References: <CACwzsXFniWQJ5P=UMFF58YW30uKOmETy6KH1x56k1b48En89cg@mail.gmail.com>
Message-ID: <CACwzsXG7z5bExVe+dCoSV4ZMLDcsNuv3vn88PrZH7xv0N3gJ0g@mail.gmail.com>

Whoops - somehow a double comma worked its way into the ."Call" lines
in the first patch I sent. The attached patch is updated to address
that issue.

Alex

On Fri, May 30, 2014 at 10:48 AM, Alex Zvoleff
<azvoleff at conservation.org> wrote:
> Dear list (and Robert Hijmans in particular),
>
> I am using  the terrain function in the raster package to calculate
> slope and aspect prior to performing topographic correction. The
> landsat package supports applying a smoothing factor during the slope
> calculation, to avoid over-correction of reflectance in high slope
> areas with low illumination (as suggested by Ria?o, Salas, and Aguado
> 2003). However I have been using the terrain function in the raster
> package to calculate slope and aspect since it can handle large
> rasters and is coded in C.
>
> Attached is a patch to allow applying a smoothing factor when
> calculating slope using the terrain function in raster. Is there a
> chance of including the attached changes (based on r2994) in the next
> release of raster?
>
> Thanks,
> Alex
>
> Ref: Ria?o D., Chuvieco E., Salas J., and Aguado I., 2003. Assessment
> of different topographic corrections in Landsat-TM data for mapping
> vegetation types. IEEE Transactions on Geoscience and Remote Sensing
> 41: 1056-1061.
>
> --
> Alex Zvoleff
> Postdoctoral Associate
> Tropical Ecology Assessment and Monitoring (TEAM) Network
> Conservation International
> 2011 Crystal Dr. Suite 500, Arlington, Virginia 22202, USA
> Tel: +1-703-341-2749, Fax: +1-703-979-0953, Skype: azvoleff
> http://www.teamnetwork.org | http://www.conservation.org



-- 
Alex Zvoleff
Postdoctoral Associate
Tropical Ecology Assessment and Monitoring (TEAM) Network
Conservation International
2011 Crystal Dr. Suite 500, Arlington, Virginia 22202, USA
Tel: +1-703-341-2749, Fax: +1-703-979-0953, Skype: azvoleff
http://www.teamnetwork.org | http://www.conservation.org
-------------- next part --------------
A non-text attachment was scrubbed...
Name: smoothing_factor_v2.patch
Type: application/octet-stream
Size: 8350 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140603/1a04d80a/attachment.obj>

From jhazlehu at tulane.edu  Tue Jun  3 22:24:07 2014
From: jhazlehu at tulane.edu (Hazlehurst, Jenny A)
Date: Tue, 3 Jun 2014 20:24:07 +0000
Subject: [R-sig-Geo] Export object class SpatialPixelsDataFrame to GIS
Message-ID: <1401827045829.6468@tulane.edu>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140603/f6b1feab/attachment.pl>

From sarah.goslee at gmail.com  Tue Jun  3 22:28:34 2014
From: sarah.goslee at gmail.com (Sarah Goslee)
Date: Tue, 3 Jun 2014 16:28:34 -0400
Subject: [R-sig-Geo] Export object class SpatialPixelsDataFrame to GIS
In-Reply-To: <1401827045829.6468@tulane.edu>
References: <1401827045829.6468@tulane.edu>
Message-ID: <CAM_vjunnfL8oWoj-b8Zcj4y2VtErttwmGbpuC2Y1h3tE63NqjA@mail.gmail.com>

Hi,

You can use writeGDAL() from the rgdal package.

Sarah

On Tue, Jun 3, 2014 at 4:24 PM, Hazlehurst, Jenny A <jhazlehu at tulane.edu> wrote:
> ?Thanks in advance. Using the package adehabitatHR for kernel analysis of bird home ranges.
>
>
> Looking for how to get a specific kernel, which is of class SpatialPixelsDataFrame, into a format use-able by GIS platform, mostly QGIS, so that I can work within specific kernels in the field.
>
>
> Thanks!
>
>

-- 
Sarah Goslee
http://www.functionaldiversity.org


From trevorwjoyce at gmail.com  Wed Jun  4 03:00:43 2014
From: trevorwjoyce at gmail.com (Trevor Joyce)
Date: Tue, 3 Jun 2014 18:00:43 -0700
Subject: [R-sig-Geo] Three-dimensional interpolation of temperature profiles
	using gstat?
Message-ID: <CAJnnNUo2MCL_jsSx+QV0cz8ANdtqZLU1EQXnerGeCA9KLOr7TQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140603/f8173346/attachment.pl>

From edzer.pebesma at uni-muenster.de  Wed Jun  4 09:20:38 2014
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Wed, 04 Jun 2014 09:20:38 +0200
Subject: [R-sig-Geo] Three-dimensional interpolation of temperature
 profiles using gstat?
In-Reply-To: <CAJnnNUo2MCL_jsSx+QV0cz8ANdtqZLU1EQXnerGeCA9KLOr7TQ@mail.gmail.com>
References: <CAJnnNUo2MCL_jsSx+QV0cz8ANdtqZLU1EQXnerGeCA9KLOr7TQ@mail.gmail.com>
Message-ID: <538EC8C6.10004@uni-muenster.de>



On 06/04/2014 03:00 AM, Trevor Joyce wrote:
> Hi,
> 
> I'm working on a problem in which I'd like to interpolate a set of
> oceanographic temperature profiles over a three-dimensional matrix of
> unsampled x, y, & z locations based on a SpatialPointsDataFrame (WOD) in
> which I've stored temperature data (WOD$TEMP) in association with
> coordinate information in the form of latitude (WOD$LAT,in
> degrees),longitude (WOD$LONG, in degrees), and depth (WOD$DEPTH, in
> meters).  The data consists of multiple temperature measurements collected
> on different depth levels at each station (i.e. multiple TEMP and DEPTH
> values for each LAT and LONG pair). Here's an example of the data which is
> drawn from the World Ocean Database (I can send along a more complete
> dataset as a .csv if you're interested)
> 
> head(WOD[WOD$YEAR%in%2013 &
> WOD$TYPE%in%"PFL",c("LAT","LONG","DEPTH","TEMP")],100)[seq(1,100,2),]
>            LAT    LONG   DEPTH   TEMP
> 4004511 27.644 -78.732    3.68 23.151
> 4004711 27.644 -78.732   14.20 23.133
> 4004911 27.644 -78.732   22.75 23.128
> 4005111 27.644 -78.732   33.77 23.116
> 4005311 27.644 -78.732   42.41 23.119
> 4005511 27.644 -78.732   53.04 23.115
> 4005711 27.644 -78.732   63.96 23.086
> 4005911 27.644 -78.732   72.50 23.045
> 4006111 27.644 -78.732   83.82 23.043
> 4006311 27.644 -78.732   92.36 23.022
> 4006511 27.644 -78.732  103.29 22.977
> 4006711 27.644 -78.732  116.59 22.967
> 4006911 27.644 -78.732  137.54 22.618
> 4007111 27.644 -78.732  176.15 20.855
> 4007311 27.644 -78.732  222.69 19.743
> 4007511 27.644 -78.732  272.30 18.979
> 4007711 27.644 -78.732  320.31 18.334
> 4007911 27.644 -78.732  371.48 17.855
> 4008111 27.644 -78.732  445.34 16.469
> 4008311 27.644 -78.732  543.75 13.591
> 4008511 27.644 -78.732  663.89  9.110
> 4011811 26.952 -77.340   10.33 23.660
> 4012011 26.952 -77.340   20.07 23.699
> 4012211 26.952 -77.340   30.00 23.693
> 4012411 26.952 -77.340   39.83 23.683
> 4012611 26.952 -77.340   50.16 23.664
> 4012811 26.952 -77.340   59.50 23.641
> 4013011 26.952 -77.340   69.53 23.601
> 4013211 26.952 -77.340   80.05 23.580
> 4013411 26.952 -77.340   89.79 23.552
> 401369  26.952 -77.340   99.52 23.625
> 401382  26.952 -77.340  109.45 23.349
> 4014011 26.952 -77.340  129.60 22.105
> 4014211 26.952 -77.340  158.99 20.615
> 4014411 26.952 -77.340  198.49 19.640
> 4014611 26.952 -77.340  249.10 18.740
> 4014811 26.952 -77.340  298.21 18.209
> 4015011 26.952 -77.340  347.80 17.910
> 4015211 26.952 -77.340  397.58 17.292
> 4015411 26.952 -77.340  496.51 15.465
> 4015611 26.952 -77.340  594.80 13.275
> 4015811 26.952 -77.340  744.02  9.963
> 4016011 26.952 -77.340  892.25  6.338
> 4016211 26.952 -77.340 1090.28  5.297
> ...
> 
> WOD=WOD[WOD$YEAR%in%2013 & WOD$TYPE%in%"PFL" &
> WOD$REGION%in%c("TOTO","SEPC","NWPN","NWPS"),]
> 
> coordinates(WOD) = ~LONG+LAT+DEPTH
> 
> 
> #Based on the demo(gstat3D) example I have fitted the following variogram
> models:
> 
> library(sp);library(gstat);library(raster);library(rgdal)
> 
> WOD_vg=variogram(TEMP~1,WOD)
> WOD_vgm=fit.variogram(WOD_vg,mod=vgm(psill=2,"Exp",range=1))
> WOD_vgm1=fit.variogram(WOD_vg,mod=vgm(psill=1.8,"Sph",range=1.0,nugget=0.6))
> WOD_vgm2=fit.variogram(WOD_vg,mod=vgm(psill=2,"Sph",range=1.5,nugget=0.6))
> WOD_vgm3=fit.variogram(WOD_vg,mod=vgm(psill=2,"Mat",range=1.5,nugget=0.6))
> 
> plot(WOD_vg$dist,WOD_vg$gamma)
> lines(variogramLine(WOD_vgm,1.5)$dist,variogramLine(WOD_vgm,1.5)$gamma)
> lines(variogramLine(WOD_vgm1,1.5)$dist,variogramLine(WOD_vgm1,1.5)$gamma)
> lines(variogramLine(WOD_vgm2,1.5)$dist,variogramLine(WOD_vgm2,1.5)$gamma)
> lines(variogramLine(WOD_vgm3,1.5)$dist,variogramLine(WOD_vgm3,1.5)$gamma)
> 
> # and attempted to krige the data and variogram model over three
> dimensional SpatialPixels defined in terms of ~LONG+LAT+DEPTH
> 
> grid3D <- expand.grid(LONG=seq(from = -79.00, to = -76.50, by=0.05),
>                       LAT=seq(from = 23.25, to = 26.75, by=0.05),
>                       DEPTH=seq(from = 0, to = 1200, by=50))
> gridded(grid3D) = ~LONG+LAT+DEPTH
> 
> res3D <- krige(formula = TEMP ~ 1, WOD, grid3D, model = WOD_vgm2)
> 
> This produces the following error:
> 
>> res3D <- krige(formula = TEMP ~ 1, WOD, grid3D, model = WOD_vgm2)
> [using ordinary kriging]
> 
> "chfactor.c", line 131: singular matrix in function LDLfactor()
> Error in predict.gstat(g, newdata = newdata, block = block, nsim = nsim,  :
>   LDLfactor
> 
> This error I gather from reading lots of earlier posts on various forums
> probably relates to having multiple observations (at different depth
> levels) with same LAT and LONG coordinates (i.e. horizontal distance
> between these observations = 0).
> 
> I'm relatively new to the world of geostatistics so I have a number of
> questions:
> 1) Is 3D kriging using gstat an appropriate method of interpolation in this
> context? If not is there an alternative approach that I should pursue?

You seem to use an anisotropic variogram model, meaning equal decay of
autocorrelation in all directions. Even if your dimensions had
comparable units (e.g., meters), it is very unlikely that this would be
satisfactory, as nearly everything on earth changes faster in the
vertical as in horizontal. Also, most phenomena will show a trend in the
vertical (deeper = colder?) that kriging does not take into account when
it is not being told to do so.

> 
> 2) How should I deal with having observations on multiple depth levels at
> the same LAT and LONG coordinates?

that should not be a problem.

> 
> 3) Do latitude, longitude and depth need to be in the same units (e.g.
> meters) for accurate estimation of distances in variogram calculation and
> kriging interpolation?

If you replace the word "accurate" with "meaningful": yes. After that,
you can start thinking about anisotropy in a meaningful way (i.e.
unit-less), I would say.

> 
> 4)How should I set initial parameters for the anisotropy term given that
> temperature varies by almost an order of magnitude (4-30 C) over 1000m in
> the vertical direction but <=1 degree C over >100 km in the horizontal
> dimensions (more with latitude than with longitude)?

I would start thinking about a trend first, then about anisotropy of the
residual process.

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
83 33081 http://ifgi.uni-muenster.de GPG key ID 0xAC227795

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 490 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140604/a25282fb/attachment.bin>

From til.dlh at gmx.de  Wed Jun  4 17:29:44 2014
From: til.dlh at gmx.de (Azimoth)
Date: Wed, 4 Jun 2014 08:29:44 -0700 (PDT)
Subject: [R-sig-Geo] plotKML package - Invalid multibyte string 1?
Message-ID: <1401895784059-7586554.post@n2.nabble.com>

Hi,
apologies if this is already explained somewhere, but I could not find it so
far.

I tried to figure out how to use the plotKML package and ran into the
following error:
Error in nchar(levels(as.factor(x))) : invalid multibyte string 1

Is this a bug in the package or my mistake? How can I make it work?

This is my first post in any mailing list at all, so I don't have experience
in what you need to help me to help myself.

Since I don't know a better way I will just provide, what I think might be
helpful underneath.

I put it in this order:
1. My first try to understand this problem
2. Output of version
3. Output of traceback()
4. The code I used (but no local data is required so it should run on any
machine)

Any tips how to post a question in a more effective way or way that's more
convenient for you are welcome.
And tips on how to narrow down a problem as well.

--------------------

I tried to find a solution by myself without success. Here's what I did:

I tried to find out, what "x" is and this is what seemed possible to me (all
names and variables taken either from the sample code below or from files
included in the plotKML package):

1. I looked for "nchar(levels(as.factor(x)))" from the error traceback and
found it only in line 23 of a file called "legend.bar.R"
And there was a comment right above this line:
 ### NOTE : This is a not a perfect implementation for a factor with a lot
of categories!

2. When I looked for "legend.bar" I found this in line 136 of a file called
"layer.SpatialPixels"
kml_legend.bar(x = obj at data[,1], legend.file = legend_name, legend.pal =
colour_scale, z.lim = eval(call.lst[["z.lim"]]))

I assume that "x = obj at data[,1]" was what I was looking for so my question
changed to "what is x = obj at data[,1]?"

3. "layer.SpatialPixels" can be found in plotKML.sp.R, where in line 365 it
says
kml_layer.SpatialPixels(obj[[i]], colour = colour, raster_name =
raster_name_i, metadata = metadata, plot.legend=FALSE, ...)

4. That's what my code calls in the last line
plotKML(ORCDRC_sd1_country["val"],
colour_scale=soil.legends[["ORCDRC"]]$COLOR)

So I think obj = ORCDRC_sd1_country["val"].

Since I found kml_legend.bar(x = obj at data[,1],[?]) in step 2 above I tried

> max(nchar(levels(as.factor(ORCDRC_sd1_country["val"]@data[,1]))))*5+70
Error in nchar(levels(as.factor(ORCDRC_sd1_country["val"]@data[, 1]))) :
invalid multibyte string 1 

So I could reproduce the error I got before. (Or just found another way to
the same dead end...)
That's why I think this might be what happens when my code is executed.

The only way that SOMETHING worked (I don't know what it does exactly) was:

> max(nchar(levels(as.factor(ORCDRC_sd1_country at data[,1]))))*5+70
[1] 85

Does this make sense? Or is this line just successfully computing rubbish?

--------------------
> version
               _                           
platform       x86_64-apple-darwin10.8.0   
arch           x86_64                      
os             darwin10.8.0                
system         x86_64, darwin10.8.0        
status                                     
major          3                           
minor          0.3                         
year           2014                        
month          03                          
day            06                          
svn rev        65126                       
language       R                           
version.string R version 3.0.3 (2014-03-06)
nickname       Warm Puppy                  

--------------------

> traceback()
8: nchar(levels(as.factor(x)))
7: kml_legend.bar(x = obj at data[, 1], legend.file = legend_name, 
       legend.pal = colour_scale)
6: .local(obj, ...)
5: kml_layer(obj, colour = colour, raster_name = raster_name, metadata =
metadata, 
       ...)
4: kml_layer(obj, colour = colour, raster_name = raster_name, metadata =
metadata, 
       ...)
3: .local(obj, ...)
2: plotKML(ORCDRC_sd1_country["val"], colour_scale =
soil.legends[["ORCDRC"]]$COLOR)
1: plotKML(ORCDRC_sd1_country["val"], colour_scale =
soil.legends[["ORCDRC"]]$COLOR)

--------------------
### The code I had that led to the error ###

library(RCurl)
library(R.utils)
library(maptools)
library(XML)
library(gdalUtils)
library(rgdal)
library(GSIF)
library(plotKML)

## Getting necessary data
## location of soilgrids:
sg.ftp <- "ftp://soilgrids:soilgrids at ftp.soilgrids.org/data/recent/"
filenames = getURL(sg.ftp, ftp.use.epsv = FALSE, dirlistonly = TRUE)
filenames = strsplit(filenames, "\r*\n")[[1]]
filenames[1:5]

ORC.name <- filenames[grep(filenames, pattern="ORCDRC_sd1_M")]
ORC.name

## CAUTION!!! 165.4 Mb to download in total, unzipped 1,87 GB
download.file(paste(sg.ftp, ORC.name[1], sep=""), ORC.name)
library(R.utils)
gunzip(ORC.name[1])

## check that everything is OK:
ORC.tif <- strsplit(ORC.name[1], ".gz")[[1]][1]
GDALinfo(ORC.tif)

## Getting the shape-file (5.1 Mb in total) that contains the desired
country
download.file("http://www.nacis.org/naturalearth/10m/cultural/ne_10m_admin_0_countries.zip",
"ne_10m_admin_0_countries.zip")
unzip("ne_10m_admin_0_countries.zip")

## loading and reducing the shape-file to the desired country
countries <- readShapeSpatial("ne_10m_admin_0_countries.shp")
desired_country <- "Germany"
country_name <- toString(countries$FORMAL_EN[grep(desired_country,
countries$ADMIN)])
country <- countries[grep(desired_country, countries$ADMIN),]
country_lines <- as(country, "SpatialLines")

#plot(country[1]) #Check if everything so far worked as expected

getOption("gdalUtils_gdalPath")
gdal_setInstallation() ## CAN TAKE 1-2 MINUTES!
getOption("gdalUtils_gdalPath")

te = as.vector(country at bbox) #Numeric. (c(xmin,ymin,xmax,ymax)). set
georeferenced extents of output file to be created (in target SRS).

tile_file <- paste("ORC_sd1_", ".tif", sep = desired_country)
gdalwarp(ORC.tif, dstfile= tile_file, te=te)
ORCDRC_sd1_country <- readGDAL(tile_file)


## Web Coverage Service
## location of service:
wcs = "http://wms3.isric.org/geoserver/soilgrids1km/wcs?"
## create an XML file:
l1 <- newXMLNode("WCS_GDAL")
l1.s <- newXMLNode("ServiceURL", wcs, parent=l1)
l1.l <- newXMLNode("CoverageName", "ORCDRC_sd1_M", parent=l1)
l1
xml.out = "ORCDRC_sd1_M.xml"
saveXML(l1, file=xml.out)

## check if the layer exists:
gdalinfo(xml.out)

## plot the map:
data(soil.legends)
class.labels = paste(soil.legends[["ORCDRC"]]$MIN, "\226",
soil.legends[["ORCDRC"]]$MAX)
ORCDRC_sd1_country$val <- cut(ORCDRC_sd1_country$band1,
breaks=c(soil.legends[["ORCDRC"]]$MIN[1], soil.legends[["ORCDRC"]]$MAX),
labels = class.labels)
bnd <- list(
#list("sp.points", sites, pch="+", col="black"), 
list("sp.lines", country_lines))
spplot(ORCDRC_sd1_country["val"], main="Organic carbon in permilles (0\2265
cm)", col.regions=soil.legends[["ORCDRC"]]$COLOR, sp.layout=bnd,
scales=list(draw=TRUE))

## Visualization of maps in Google Earth:
plotKML(ORCDRC_sd1_country["val"],
colour_scale=soil.legends[["ORCDRC"]]$COLOR)





--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/plotKML-package-Invalid-multibyte-string-1-tp7586554.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From micha at arava.co.il  Wed Jun  4 19:15:40 2014
From: micha at arava.co.il (Micha Silver)
Date: Wed, 04 Jun 2014 20:15:40 +0300
Subject: [R-sig-Geo] Co-kriging
Message-ID: <538F543C.2010809@arava.co.il>

An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140604/92c9f8a5/attachment.html>

From edzer.pebesma at uni-muenster.de  Wed Jun  4 20:01:23 2014
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Wed, 04 Jun 2014 20:01:23 +0200
Subject: [R-sig-Geo] Co-kriging
In-Reply-To: <538F543C.2010809@arava.co.il>
References: <538F543C.2010809@arava.co.il>
Message-ID: <538F5EF3.9070903@uni-muenster.de>



On 06/04/2014 07:15 PM, Micha Silver wrote:
> I could use some guidance finishing a co-kriging script. I have rain
> data, and elevation for each rain gauge. I have successfully make an
> ordinary kriging of the rainfall. Now I'd like to try to use the
> elevation as an auxiliary variable to improve the prediction. I have
> made the model variogram with two variables, and the fitted variogram
> using fit.lmc:
> 
> vg.fit <- fit.lmc(vg, g, vgm(700, "Exp", 50000))
> #gstat object 'g' prepared already with the 2 variables
> plot(vg, vg.fit)   # (looks OK)
> 
> then I run:
> # grd prepared in advance to match the range of the data
> precip.cokrige <- predict.gstat(vg.fit, newdata=grd) 
>  
> I expected to see:
> "Linear Model of Coregionalization.Good"
> [using ordinary cokriging]
> 
> but instead the command returned:
> "Intrinsic Correlation found. Good.
> [using ordinary cokriging]"
> 
> The co-kriging finishes successfully, and the results "look good." But
> what am I getting?  What is the difference between Intrinsic Correlation
> and Linear Model of Coregionalization?

Please look up the literature -- IC is a special case of LMC, where each
variogram is a multiple of a basic model. For LMC this is not the case
for the full variogram, but for each variogram component (sub-model:
Nugget, Spherical). If you'd add a nugget component to the model passed
to fit.lmc, you'd get an LMC.

> 
> Thanks,
> Micha
> 
> 
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
83 33081 http://ifgi.uni-muenster.de GPG key ID 0xAC227795

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 490 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140604/608bac9d/attachment.bin>

From jwm302 at gmail.com  Thu Jun  5 13:58:08 2014
From: jwm302 at gmail.com (jwm302)
Date: Thu, 5 Jun 2014 04:58:08 -0700 (PDT)
Subject: [R-sig-Geo] MacOS spatial packages installation
In-Reply-To: <CANVKczMY3d96Y044Q8PKV3cW+DJGPM-tLSpBpuODRtEWfp-T_Q@mail.gmail.com>
References: <CANVKczMY3d96Y044Q8PKV3cW+DJGPM-tLSpBpuODRtEWfp-T_Q@mail.gmail.com>
Message-ID: <1401969488577-7586556.post@n2.nabble.com>

Hi Roger

I am really battling to get maptools package to work on on my system (OS X
10.9.3 Mavericks - see session at bottom of message). Everything was working
fine but since I upgraded from R version 3.0 (2013-09-25) -- "Frisbee
Sailing? to R 3.0.2 ?Spring Dance?  (because suddenly the extract function
wasn?t working anymore things started to break. 

rgdal seems to be working because I am able to do commands like this with no
error:  surfWater <- readOGR("Surface_water/gns_swb", "gns_swb?) 

I have spent hours sifting through forum posts and the like, but all to no
avail. Either I am missing something obvious, or I am not command line savy
enough to find a solution . This forum (right at the bottom) seems to
suggest that you don?t need to install map tools from source, that the
binaries are available on CRAN. But I see over here
(http://cran.r-project.org/web/packages/maptools/index.html) that OS X
Mavericks binaries are not available. I am confused because I get conflicted
results from my searching on forums. 

I would just like to resolve the issue as soon as possible so that I can get
on with my work.

But as you can see, when I invoke maptools package I get a horrible looking
error and R crashes (the same happens when I perform the same code from the
command line 
<http://r-sig-geo.2731867.n2.nabble.com/file/n7586556/Screen_Shot_2014-06-05_at_1.png>
)):

> sessionInfo()
R version 3.1.0 (2014-04-10)
Platform: x86_64-apple-darwin13.1.0 (64-bit)

locale:
[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8

attached base packages:
[1] splines   grid      stats     graphics  grDevices utils     datasets 
methods   base     

other attached packages:
 [1] diagram_1.6.2     shape_1.4.1       data.table_1.9.2  tables_0.7.64    
Hmisc_3.14-0      Formula_1.1-1     survival_2.37-7   lattice_0.20-29  
xtable_1.7-1      texreg_1.32      
[11] bootStepAIC_1.2-0 MASS_7.3-31       glm2_1.1.2        plyr_1.8         
RMySQL_0.9-3      DBI_0.2-7         maps_2.3-6        maptools_0.8-29  
gdalUtils_0.2.0   rgdal_0.8-16     
[21] raster_2.2-12     sp_1.0-14        

loaded via a namespace (and not attached):
[1] cluster_1.15.2      codetools_0.2-8     foreach_1.4.1      
foreign_0.8-61      iterators_1.0.6     latticeExtra_0.6-26
RColorBrewer_1.0-5  reshape2_1.2.2      stringr_0.6.2      
> 

> packageInstallLoad <- function(x){
+   for( i in x ){
+     #  require returns TRUE invisibly if it was able to load package
+     if( ! require( i , character.only = TRUE ) ){
+       #  If package was not able to be loaded then re-install
+       #setRepositories(ind = c(1,6))
+       install.packages( i , dependencies = T )
+       #  Load package after installing
+       require( i , character.only = TRUE )
+     }
+   }
+ }
> 
> packageInstallLoad(c("raster", "rgdal", "gdalUtils", "maptools", "sp",
> "maps", "RMySQL", "plyr", "stats", "glm2", "bootStepAIC", "texreg",
> "xtable", "tables", "data.table", "diagram"))
Loading required package: gdalUtils
Loading required package: maps
Loading required package: RMySQL
Loading required package: DBI
Loading required package: plyr
Loading required package: glm2
Loading required package: bootStepAIC
Loading required package: MASS

Attaching package: ?MASS?

The following objects are masked from ?package:raster?:

    area, select

Loading required package: texreg
Version:  1.32
Date:     2014-05-01
Author:   Philip Leifeld (University of Konstanz)

Attaching package: ?texreg?

The following object is masked from ?package:raster?:

    extract

Loading required package: xtable

Attaching package: ?xtable?

The following object is masked from ?package:maptools?:

    label

Loading required package: tables
Loading required package: Hmisc
Loading required package: grid
Loading required package: lattice
Loading required package: survival
Loading required package: splines
Loading required package: Formula

Attaching package: ?Hmisc?

The following objects are masked from ?package:xtable?:

    label, label<-

The following objects are masked from ?package:plyr?:

    is.discrete, summarize

The following objects are masked from ?package:raster?:

    mask, zoom

The following object is masked from ?package:maptools?:

    label

The following object is masked from ?package:rgeos?:

    translate

The following objects are masked from ?package:base?:

    format.pval, round.POSIXt, trunc.POSIXt, units

Loading required package: data.table
data.table 1.9.2  For help type: help("data.table")
Loading required package: diagram
Loading required package: shape

Attaching package: ?diagram?

The following object is masked from ?package:sp?:

    coordinates

> data(wrld_simpl)
> kenya <- wrld_simpl[wrld_simpl$NAME == "Kenya",]

 *** caught segfault ***
address 0x1150, cause 'memory not mapped'

Traceback:
 1: .Call(bboxCalcR_c, y at polygons)
 2: wrld_simpl[wrld_simpl$NAME == "Kenya", ]
 3: wrld_simpl[wrld_simpl$NAME == "Kenya", ]

Possible actions:
1: abort (with core dump, if enabled)
2: normal R exit
3: exit R without saving workspace
4: exit R saving workspace
Selection:

Thanks and Regards
Justin Michell








--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/MacOS-spatial-packages-installation-tp7583815p7586556.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From Roger.Bivand at nhh.no  Thu Jun  5 15:25:13 2014
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 5 Jun 2014 15:25:13 +0200
Subject: [R-sig-Geo] MacOS spatial packages installation
In-Reply-To: <1401969488577-7586556.post@n2.nabble.com>
References: <CANVKczMY3d96Y044Q8PKV3cW+DJGPM-tLSpBpuODRtEWfp-T_Q@mail.gmail.com>
	<1401969488577-7586556.post@n2.nabble.com>
Message-ID: <alpine.LRH.2.03.1406051511370.19374@reclus.nhh.no>

This is a list, others may know the answer better than the person you 
named (me). Please ask on R-sig-mac. Note that Brian Ripley answered 
questions regarding spatial packages on Mavericks there:

https://stat.ethz.ch/pipermail/r-sig-mac/2014-April/010860.html

and later

https://stat.ethz.ch/pipermail/r-sig-mac/2014-May/010871.html

with a resolution - re-install rgdal and rgeos from CRAN-extras. Then 
you'll need to install maptools from source, I suppose. I don't know 
enough to know whether R 3.0.2 runs on 10.9.* at all. You'll need to 
specify a lot more about your underlying system (OS 10.9.3, which R 
version build for which system, etc.). My guess is that you have mixtures 
of versions of software.

maptools doesn't depend on rgdal or rgeos, but it hasn't been built for R 
3.1.0/Mavericks because of an unprotected call to rgeos::gDistance which I 
will protect, so maptools for OSX Mavericks should appear soon. This, 
however, is not your problem, I think.

Roger

On Thu, 5 Jun 2014, jwm302 wrote:

> Hi Roger
>
> I am really battling to get maptools package to work on on my system (OS X
> 10.9.3 Mavericks - see session at bottom of message). Everything was working
> fine but since I upgraded from R version 3.0 (2013-09-25) -- "Frisbee
> Sailing? to R 3.0.2 ?Spring Dance?  (because suddenly the extract function
> wasn?t working anymore things started to break. 
>
> rgdal seems to be working because I am able to do commands like this with no
> error:  surfWater <- readOGR("Surface_water/gns_swb", "gns_swb?) 
>
> I have spent hours sifting through forum posts and the like, but all to no
> avail. Either I am missing something obvious, or I am not command line savy
> enough to find a solution . This forum (right at the bottom) seems to
> suggest that you don?t need to install map tools from source, that the
> binaries are available on CRAN. But I see over here
> (http://cran.r-project.org/web/packages/maptools/index.html) that OS X
> Mavericks binaries are not available. I am confused because I get conflicted
> results from my searching on forums. 
>
> I would just like to resolve the issue as soon as possible so that I can get
> on with my work.
>
> But as you can see, when I invoke maptools package I get a horrible looking
> error and R crashes (the same happens when I perform the same code from the
> command line 
> <http://r-sig-geo.2731867.n2.nabble.com/file/n7586556/Screen_Shot_2014-06-05_at_1.png>
> )):
>
>> sessionInfo()
> R version 3.1.0 (2014-04-10)
> Platform: x86_64-apple-darwin13.1.0 (64-bit)
>
> locale:
> [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
>
> attached base packages:
> [1] splines   grid      stats     graphics  grDevices utils     datasets 
> methods   base 
>
> other attached packages:
> [1] diagram_1.6.2     shape_1.4.1       data.table_1.9.2  tables_0.7.64 
> Hmisc_3.14-0      Formula_1.1-1     survival_2.37-7   lattice_0.20-29 
> xtable_1.7-1      texreg_1.32 
> [11] bootStepAIC_1.2-0 MASS_7.3-31       glm2_1.1.2        plyr_1.8 
> RMySQL_0.9-3      DBI_0.2-7         maps_2.3-6        maptools_0.8-29 
> gdalUtils_0.2.0   rgdal_0.8-16 
> [21] raster_2.2-12     sp_1.0-14 
>
> loaded via a namespace (and not attached):
> [1] cluster_1.15.2      codetools_0.2-8     foreach_1.4.1 
> foreign_0.8-61      iterators_1.0.6     latticeExtra_0.6-26
> RColorBrewer_1.0-5  reshape2_1.2.2      stringr_0.6.2 
>> 
>
>> packageInstallLoad <- function(x){
> +   for( i in x ){
> +     #  require returns TRUE invisibly if it was able to load package
> +     if( ! require( i , character.only = TRUE ) ){
> +       #  If package was not able to be loaded then re-install
> +       #setRepositories(ind = c(1,6))
> +       install.packages( i , dependencies = T )
> +       #  Load package after installing
> +       require( i , character.only = TRUE )
> +     }
> +   }
> + }
>> 
>> packageInstallLoad(c("raster", "rgdal", "gdalUtils", "maptools", "sp",
>> "maps", "RMySQL", "plyr", "stats", "glm2", "bootStepAIC", "texreg",
>> "xtable", "tables", "data.table", "diagram"))
> Loading required package: gdalUtils
> Loading required package: maps
> Loading required package: RMySQL
> Loading required package: DBI
> Loading required package: plyr
> Loading required package: glm2
> Loading required package: bootStepAIC
> Loading required package: MASS
>
> Attaching package: ?MASS?
>
> The following objects are masked from ?package:raster?:
>
>    area, select
>
> Loading required package: texreg
> Version:  1.32
> Date:     2014-05-01
> Author:   Philip Leifeld (University of Konstanz)
>
> Attaching package: ?texreg?
>
> The following object is masked from ?package:raster?:
>
>    extract
>
> Loading required package: xtable
>
> Attaching package: ?xtable?
>
> The following object is masked from ?package:maptools?:
>
>    label
>
> Loading required package: tables
> Loading required package: Hmisc
> Loading required package: grid
> Loading required package: lattice
> Loading required package: survival
> Loading required package: splines
> Loading required package: Formula
>
> Attaching package: ?Hmisc?
>
> The following objects are masked from ?package:xtable?:
>
>    label, label<-
>
> The following objects are masked from ?package:plyr?:
>
>    is.discrete, summarize
>
> The following objects are masked from ?package:raster?:
>
>    mask, zoom
>
> The following object is masked from ?package:maptools?:
>
>    label
>
> The following object is masked from ?package:rgeos?:
>
>    translate
>
> The following objects are masked from ?package:base?:
>
>    format.pval, round.POSIXt, trunc.POSIXt, units
>
> Loading required package: data.table
> data.table 1.9.2  For help type: help("data.table")
> Loading required package: diagram
> Loading required package: shape
>
> Attaching package: ?diagram?
>
> The following object is masked from ?package:sp?:
>
>    coordinates
>
>> data(wrld_simpl)
>> kenya <- wrld_simpl[wrld_simpl$NAME == "Kenya",]
>
> *** caught segfault ***
> address 0x1150, cause 'memory not mapped'
>
> Traceback:
> 1: .Call(bboxCalcR_c, y at polygons)
> 2: wrld_simpl[wrld_simpl$NAME == "Kenya", ]
> 3: wrld_simpl[wrld_simpl$NAME == "Kenya", ]
>
> Possible actions:
> 1: abort (with core dump, if enabled)
> 2: normal R exit
> 3: exit R without saving workspace
> 4: exit R saving workspace
> Selection:
>
> Thanks and Regards
> Justin Michell
>
>
>
>
>
>
>
>
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/MacOS-spatial-packages-installation-tp7583815p7586556.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no

From mdsumner at gmail.com  Thu Jun  5 15:59:24 2014
From: mdsumner at gmail.com (Michael Sumner)
Date: Thu, 5 Jun 2014 23:59:24 +1000
Subject: [R-sig-Geo] OT - resource for compiling geo-software on Linux
Message-ID: <CAAcGz9--BO6q9ge_91jBs3DiT6RtJ6nxH0+FVcM0+YmzqbtYLQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140605/fc2b4e78/attachment.pl>

From r.hijmans at gmail.com  Fri Jun  6 05:23:55 2014
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Thu, 5 Jun 2014 20:23:55 -0700
Subject: [R-sig-Geo] fill layers of a RasterStack with values in rows of
	a matrix
In-Reply-To: <CAAMki4EujE2m1dmmnL_f8gkPmbszzNTByP8rEOsMUs9NyVWPTg@mail.gmail.com>
References: <CAAMki4Gamf4QusNsK_kC=uW=7gteH4Hs0piaN=CDQ-VM18RfTA@mail.gmail.com>
	<CAFTcopfyYBUg3amJC7wY9wOL+vusP06Qn=mbM8DrYrei=asYOA@mail.gmail.com>
	<CAAMki4EujE2m1dmmnL_f8gkPmbszzNTByP8rEOsMUs9NyVWPTg@mail.gmail.com>
Message-ID: <CANtt_hx86wKMH-g1QYWquY1zJZO_dSVpV8Pyh_LwcWg8NBtSdw@mail.gmail.com>

Vero,

Here is a simpler solution:

library(raster)
m <- matrix(data = runif(n = 9216*506, min = 0, max = 1000), nrow =
9216, ncol = 506)
b <- brick(nrows=96, ncols=96, xmn=-62, xmx=-58, ymn=-49, ymx=-45,
crs="+proj=longlat +datum=WGS84")

b <- setValues(b, m)

Robert

On Tue, May 27, 2014 at 12:54 PM, Veronica Andreo <veroandreo at gmail.com> wrote:
> Hi Andrew, list
>
> I've tried what you suggested and got this:
>
> Error en setValues(r2, m[, i]) :
>   length(values) is not equal to ncell(x), or to 1
>
>
> Thing is my images (rasters i want to reconstruct) are in the rows of
> the matrix (96x96=9216).
>
> So, i tried looping over rows...
>
> l <- lapply(1:nrow(m), function(i) {
>   setValues(r2, m[i,])
> } )
>
> and it works!!!!!
>
> THANK YOU SO MUCH!!!
>
> Best,
> Vero
>
>
>
> 2014-05-27 15:25 GMT-03:00 Andrew Vitale <vitale232 at gmail.com>:
>
>> If I understand right, this should give you what you want:
>>
>> library(raster)
>>
>> # create matrix with specified dimensions and random data
>> m <- matrix(data = runif(n = 9216*506, min = 0, max = 1000),
>>             nrow = 9216, ncol = 506)
>>
>> # create a raster with no values but desired extent/projection/ncells
>> r <- raster(nrows=96, ncols=96, xmn=-62, xmx=-58, ymn=-49, ymx=-45,
>>             crs="+proj=longlat +datum=WGS84")
>>
>> # loop through the columns of the matrix and assign the values to
>> # the raster called r, providing a new raster layer for each time step.
>> # this assumes the cells are stored in the proper order within the matrix.
>>
>> # lapply outputs a list of rasters
>> l <- lapply(1:ncol(m), function(i) {
>>             setValues(r, m[ , i])
>>             } )
>>
>> # stack the list
>> s <- stack(l)
>>
>>
>>
>>
>> On Tue, May 27, 2014 at 10:32 AM, Veronica Andreo <veroandreo at gmail.com>wrote:
>>
>>> Hi list,
>>>
>>> I have a big matrix (9216x506) that is the result of applying dineof (
>>>
>>> http://menugget.blogspot.com.ar/2012/10/dineof-data-interpolating-empirical.html
>>> ),
>>> a method to fill gappy data. In each row I have a vectorized version of my
>>> original images and each column represent a time series for each pixel; so
>>> space in rows and time in columns.
>>>
>>> What I want to do now is to reconstruct my spatio-temporal series of 506
>>> images of 96x96; so I need to use values of each row in the big matrix to
>>> build up a 96x96x506 rasterstack, but I'd like to put it into a loop to
>>> avoid doing it 506 times... It works for just one raster, but I've been
>>> trying for a while but I don't get it to work for the stack.
>>>
>>> This is the approach I'm following:
>>>
>>> #### for one raster layer
>>>
>>> # create the raster object
>>> esqueleto<-raster(nrows=96, ncols=96, xmn=-62, xmx=-58, ymn=-49, ymx=-45,
>>> crs="+proj=longlat +datum=WGS84")
>>> esqueleto<-setValues(esqueleto,Xa[1,])
>>> hasValues(esqueleto)
>>>
>>> [1] TRUE
>>>
>>>
>>> #### for the raster stack
>>>
>>> # create the raster object
>>> esqueleto<-raster(nrows=96, ncols=96, xmn=-62, xmx=-58, ymn=-49, ymx=-45,
>>> crs="+proj=longlat +datum=WGS84")
>>> # create the rasterstack (96x96x506)
>>> list_rasters<-replicate(506, esqueleto)
>>> out<-stack(list_rasters)
>>> # attempt to fill the rasterstack
>>> for (i in 1:506) out[,,i] <- setValues(out,Xa[i,],layer=i)
>>> Error en .local(x, i, j, ..., value) : unused argument (value)
>>> # where Xa is the big matrix with numeric data and row.names the original
>>> images filenames
>>>
>>> > class(Xa)[1] "matrix"> str(Xa) num [1:506, 1:9216] 1.068 1.063 1.536
>>> 1.473 0.806 ...
>>>  - attr(*, "dimnames")=List of 2
>>>   ..$ : chr [1:506] "A20030012003008.L3m_8D_CHL_chlor_a_4km_arg"
>>> "A20030092003016.L3m_8D_CHL_chlor_a_4km_arg"
>>> "A20030172003024.L3m_8D_CHL_chlor_a_4km_arg"
>>> "A20030252003032.L3m_8D_CHL_chlor_a_4km_arg" ...
>>>   ..$ : NULL
>>>
>>>
>>> Can you please help me? Which would be the right approach to get what i
>>> want??
>>>
>>> Thanks so much in advance!
>>>
>>> Best,
>>> Vero
>>>
>>>         [[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>>
>>
>> --
>> *Andrew P. Vitale*
>> Masters Student
>> Department of Geography
>> University of Nevada, Reno
>> vitale232 at gmail.com
>>
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From marcus at leuphana.de  Fri Jun  6 10:33:17 2014
From: marcus at leuphana.de (Tamar Marcus)
Date: Fri, 6 Jun 2014 10:33:17 +0200
Subject: [R-sig-Geo] gdistance errors - passage and commuteDistance functions
Message-ID: <CAK=bVwjVVtu3C3jBMhiOB-V=3ztopNdpLRXrnkYmLkkk8r_GGQ@mail.gmail.com>

Hi All -

I am trying to create distance matrices between my 50 sampling points
using the various options available in gdistance, and am getting
strange error messages with the passage and commuteDistance functions.
I created a transition layer based on a conductance layer (also tried
with a resistance layer) created in arcGIS, with values of 0.0001
instead of 0 (so no isolated pixels) and then values ranging from
1-10. The conductance layer is pretty large - 2972 x 3925 pixels. The
costDistance function manages to run smoothly, but for the other 2
functions I get the errors listed below. I have tested the code with a
smaller layer and point set and it runs fine, but the issue is not RAM
(checked by running the code on a server and seeing RAM usage when it
threw the errors).

I would greatly appreciate any insight someone might have as to what
these errors mean and how I can possibly solve them. Google didn't
find much, but unfortunately that may be due to the Denglish, I
unfortunately need to run the code on a computer which has R installed
in German...

Many thanks!
Tamar

passage error - this one seems to be thrown not by R, but by something deeper:

cost.pass <- passage(tr_cond, orgin, destination, theta=0)


*** caught segfault ***

address 0x7fff5a83bf38, cause 'memory not mapped'



Traceback:

 1: .solve.dgC(a, as(b, "denseMatrix"), tol = tol, sparse = sparse)

 2: .local(a, b, ...)

 3: solve(a, Matrix(b))

 4: solve(a, Matrix(b))

 5: eval(expr, envir, enclos)

 6: eval(call, sys.frame(sys.parent()))

 7: callGeneric(a, Matrix(b))

 8: solve(t(IdMinusWj), ei)

 9: solve(t(IdMinusWj), ei)

10: .probPass(x, Id, W, nr, ci, cj, tc, totalNet, output)

11: .randomShPaths(x, ci, cj, theta, tc, totalNet, output)

12: .local(x, origin, goal, theta, ...)

13: passage(tr_cond, orgin, destination, theta = 0)

14: passage(tr_cond, orgin, destination, theta = 0)



Possible actions:

1: abort (with core dump, if enabled)

2: normal R exit

3: exit R without saving workspace

4: exit R saving workspace




commuteDistance error:

cost.commute<- commuteDistance(tr_cond, sites)

Fehler in LU.dgC(a) :

  cs_lu(A) fehlgeschlagen: near-Singul?res A (oder au?erhalb des Speichers)



The code I am using:

final.cond <- raster("all_cond.txt")
tr_cond <- transition(final.cond, transitionFunction=mean, directions=4)

xyfilename <- "plot coords_sch.csv"
XY <- read.csv(xyfilename, header=TRUE)
xvals <- XY[,1]
yvals <- XY[,2]
xy <- cbind(xvals,yvals)
sites <- SpatialPointsDataFrame(coords=
as.data.frame(xy),as.data.
frame(xy))

orgin <- sites
destination <- sites

cost.pass <- passage(tr_cond, orgin, destination, theta=0)
cost.dist <- costDistance(tr_cond, sites)
cost.commute<- commuteDistance(tr_cond, sites)


From jacobvanetten at yahoo.com  Fri Jun  6 16:06:59 2014
From: jacobvanetten at yahoo.com (Jacob van Etten)
Date: Fri, 6 Jun 2014 15:06:59 +0100 (BST)
Subject: [R-sig-Geo] gdistance errors - passage and commuteDistance
	functions
In-Reply-To: <CAK=bVwjVVtu3C3jBMhiOB-V=3ztopNdpLRXrnkYmLkkk8r_GGQ@mail.gmail.com>
References: <CAK=bVwjVVtu3C3jBMhiOB-V=3ztopNdpLRXrnkYmLkkk8r_GGQ@mail.gmail.com>
Message-ID: <1402063619.80397.YahooMailNeo@web133206.mail.ir2.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140606/d1d1bbc6/attachment.pl>

From markpayneatwork at gmail.com  Fri Jun  6 18:56:55 2014
From: markpayneatwork at gmail.com (Mark Payne)
Date: Fri, 6 Jun 2014 18:56:55 +0200
Subject: [R-sig-Geo] Spacetime variogram - non square cells
Message-ID: <CAGBzUO9i_MC5jdVPXMgYRSArPHJWaZ0Mgv6TcvhczrRiShPkZA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140606/cb2d13f1/attachment.pl>

From bakare at ualberta.ca  Fri Jun  6 19:24:20 2014
From: bakare at ualberta.ca (Moshood Agba Bakare)
Date: Fri, 6 Jun 2014 11:24:20 -0600
Subject: [R-sig-Geo] Clarification on cross validation fitted variogram model
Message-ID: <CAJRR3XP-rG8GFYKzvbeNUOi22tPL_tDT0kmX6zY8XUktqechhQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140606/4e4f16a2/attachment.pl>

From edzer.pebesma at uni-muenster.de  Sat Jun  7 19:25:37 2014
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Sat, 07 Jun 2014 19:25:37 +0200
Subject: [R-sig-Geo] Spacetime variogram - non square cells
In-Reply-To: <CAGBzUO9i_MC5jdVPXMgYRSArPHJWaZ0Mgv6TcvhczrRiShPkZA@mail.gmail.com>
References: <CAGBzUO9i_MC5jdVPXMgYRSArPHJWaZ0Mgv6TcvhczrRiShPkZA@mail.gmail.com>
Message-ID: <53934B11.9000406@uni-muenster.de>

Mark, what does

diff(dat at sp@grid at cellsize)

give, as output?

On 06/06/2014 06:56 PM, Mark Payne wrote:
> Hi,
> 
> I have a space-time array derived from (patchy) satellite data that I am
> trying to do space-time kriging on. However, I'm not having much success
> with trying to calculate the variogram. In particular, I get the following
> error:
> 
>> vg <- variogramST(logchl~1,location=dat)
> 
> |
> |   0%
> Error: gstat: value not allowed for: cannot deal with non-square cells
>>
> 
> As far as I can see, my cells are "square" - I have a regular lat-lon grid,
> and regularly spaced time intervals. Or have I mis-understood the meaning
> of this error message?
> 
> A summary of my STFDF is included below, and package versions as well.
> 
> Best wishes,
> 
> Mark
> 
>> summary(dat)
> Object of class STFDF
>  with Dimensions (s, t, attr): (11520, 301, 1)
> [[Spatial:]]
> Object of class SpatialPixels
> Coordinates:
>          min       max
> s1 -4.979167 -1.020833
> s2 43.020835 47.979168
> Is projected: FALSE
> proj4string : [+proj=longlat +datum=WGS84]
> Number of points: 11520
> Grid attributes:
>    cellcentre.offset   cellsize cells.dim
> s1         -4.979167 0.04166666        96
> s2         43.020835 0.04166666       120
> [[Temporal:]]
>      Index              timeIndex
>  Min.   :2002-05-28   Min.   :  1
>  1st Qu.:2002-08-11   1st Qu.: 76
>  Median :2002-10-25   Median :151
>  Mean   :2002-10-25   Mean   :151
>  3rd Qu.:2003-01-08   3rd Qu.:226
>  Max.   :2003-03-24   Max.   :301
> [[Data attributes:]]
>      logchl
>  Min.   :-6.8
>  1st Qu.:-1.4
>  Median :-0.9
>  Mean   :-0.8
>  3rd Qu.:-0.3
>  Max.   : 4.0
>  NA's   :2461741
>> packageVersion("gstat")
> [1] ???1.0.19???
>> packageVersion("spacetime")
> [1] ???1.1.0???
>>
> 
> 	[[alternative HTML version deleted]]
> 
> 
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
83 33081 http://ifgi.uni-muenster.de GPG key ID 0xAC227795

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 490 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140607/eb472105/attachment.bin>

From edzer.pebesma at uni-muenster.de  Sat Jun  7 19:28:58 2014
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Sat, 07 Jun 2014 19:28:58 +0200
Subject: [R-sig-Geo] Clarification on cross validation fitted variogram
	model
In-Reply-To: <CAJRR3XP-rG8GFYKzvbeNUOi22tPL_tDT0kmX6zY8XUktqechhQ@mail.gmail.com>
References: <CAJRR3XP-rG8GFYKzvbeNUOi22tPL_tDT0kmX6zY8XUktqechhQ@mail.gmail.com>
Message-ID: <53934BDA.6040608@uni-muenster.de>

You don't give us enough invormation to give you a generally useful answer.

If fit.variogram() gives you a reasonably fitted variogram model, I see
no point in NOT using exp.mod in krige.cv(). On the other hand, we don't
know how and why the values passed to vgm() were chosen, and someone may
have a reason to argue they are better than the ones fitted by
fit.variogram().

On 06/06/2014 07:24 PM, Moshood Agba Bakare wrote:
> Hi all,
> Please I need clarification about the cross validation of fitted
> variogram model. I have come across a situation where some use *exp.var
> *in cross validation others use *exp.mod*. As for me, I think *exp.mod
> *is the right to use because the theoretical function is already fitted
> to empirical variogram. Moreso, *exp.mod *has the parameters in terms of
> nugget, sill, and range for the fitted function. Whereas *exp.var *has
> initial starting value of the parameter.
> 
> from the last script, should model equals to *exp.var *or *exp.mod*?
> 
> ## Fit empirical semivariogram using gstat
> empvar<-variogram(yield~1,canocrop.sp,cutoff = 300,width = 5, cressie =
> TRUE)
> 
> 
> ## Exponential variogram model
> exp.var<-vgm(psill = psill, model = "Exp", range = range, nugget = nugget)
> exp.mod<-fit.variogram(empvar,model = exp.var)
> 
> 
> #### Cross validation of the variogram models by ordinary kriging
> 
> exp.kcv <- krige.cv <http://krige.cv>(yield ~ 1, canocrop.sp, *model =
> ???*,nmax = 20, nfold=  5)
> 
> Thank you.
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
83 33081 http://ifgi.uni-muenster.de GPG key ID 0xAC227795

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 490 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140607/a9fbdbb5/attachment.bin>

From bwtian at gmail.com  Sun Jun  8 11:41:19 2014
From: bwtian at gmail.com (Bingwei Tian)
Date: Sun, 8 Jun 2014 02:41:19 -0700 (PDT)
Subject: [R-sig-Geo] Three-dimensional interpolation of temperature
 profiles using gstat?
In-Reply-To: <538EC8C6.10004@uni-muenster.de>
References: <CAJnnNUo2MCL_jsSx+QV0cz8ANdtqZLU1EQXnerGeCA9KLOr7TQ@mail.gmail.com>
	<538EC8C6.10004@uni-muenster.de>
Message-ID: <1402220479512-7586566.post@n2.nabble.com>

Dear Edzer,

I have a similar question related to sub-land-surface temperature profile
data. 
You are absolutely right, the temperature changes faster in the vertical
than in horizontal.
In this case, Depper is hotter.
And the trend usually linear due to conduction of temperature in vertical
direction.
My question is How to calculate and show the 3d variogram  in follow case,
and What kind of Kringing method
is the suitable one? Thank you in Advance!
1. There is temperature Trend in Vertical z(Measure Depth).
2. I would like to consider the location of Volcanoes in Interpolation using
Kriging.
3. The study area is quite large about 80000km2
4. I have 430 boreholes with different depth and interval of depth. 
5. The target grid is to 100*100*100 or 1000*1000*100 (x*y*z)



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Three-dimensional-interpolation-of-temperature-profiles-using-gstat-tp7586552p7586566.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From mspinola10 at gmail.com  Tue Jun 10 04:31:08 2014
From: mspinola10 at gmail.com (=?UTF-8?Q?Manuel_Sp=C3=ADnola?=)
Date: Mon, 9 Jun 2014 20:31:08 -0600
Subject: [R-sig-Geo] Plot a raster with categorical variable using spplot
Message-ID: <CABkCotTf0AbixMJeFzcQgrMwmu6YN8C7zj5K1GD02bKoxN+o1g@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140609/9653eaec/attachment.pl>

From jthomps at fas.harvard.edu  Tue Jun 10 13:49:21 2014
From: jthomps at fas.harvard.edu (Thompson, Jonathan)
Date: Tue, 10 Jun 2014 11:49:21 +0000
Subject: [R-sig-Geo] new patch versus patch expansion
Message-ID: <53AEF96CFCBD6044874EC220EEF02369B0222C65@HARVANDMBX02.fasmail.priv>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140610/abd7f208/attachment.pl>

From ferra.xu at yahoo.com  Tue Jun 10 18:22:09 2014
From: ferra.xu at yahoo.com (Ferra Xu)
Date: Tue, 10 Jun 2014 09:22:09 -0700 (PDT)
Subject: [R-sig-Geo] Spatio-Temporal marked Hawkes (self-exciting) point
	process
Message-ID: <1402417329.35710.YahooMailNeo@web125104.mail.ne1.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140610/e7fc90fc/attachment.pl>

From palfaro at motionsoft.com.uy  Wed Jun 11 02:10:01 2014
From: palfaro at motionsoft.com.uy (Pablo Alfaro)
Date: Tue, 10 Jun 2014 21:10:01 -0300
Subject: [R-sig-Geo] Large NetCDF file problems
Message-ID: <CALDV4smYfnno0Mwr0icKZZvyam_Znb4u9Tdk_QYRX755CnMPog@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140610/0a098546/attachment.pl>

From kridox at ymail.com  Wed Jun 11 03:49:24 2014
From: kridox at ymail.com (Pascal Oettli)
Date: Wed, 11 Jun 2014 10:49:24 +0900
Subject: [R-sig-Geo] Large NetCDF file problems
In-Reply-To: <CALDV4smYfnno0Mwr0icKZZvyam_Znb4u9Tdk_QYRX755CnMPog@mail.gmail.com>
References: <CALDV4smYfnno0Mwr0icKZZvyam_Znb4u9Tdk_QYRX755CnMPog@mail.gmail.com>
Message-ID: <CAAcyNCwtbPyNf9xPoYgKFZLNMtKUJ=2QXJs55Oq9sfx3TXGOnw@mail.gmail.com>

Hello,

Do you get the same error if you run your code out of Rstudio?

However, another approach would be to open your NetCDF file with
'brick' function from the raster package.

Regards,
Pascal

On Wed, Jun 11, 2014 at 9:10 AM, Pablo Alfaro <palfaro at motionsoft.com.uy> wrote:
> Hi, I'm having trouble opening a large netcdf file (2.45 GB) with the
> following code on R 3.0.3 64 bit
>
> require('ncdf')
> nc <- open.ncdf('C:/testsMCH/test/wrfout_d02_2014-06-09_00%3A00%3A00')
> get.var.ncdf(nc, 'T2', start=c(1, 1, 1), count=c(-1, -1, -1))
>
> I get this error:
> Assertion failed!
>
> Program: C:\Program Files\RStudio\bin\x64\rsession.exe
> File: posixio.c, Line 417
>
> Expression: offset >= 0
>
> This application has requested the Runtime to terminate it in an unusual
> way.
> Please contact the application's support team for more information.
>
>
> In R 32 bit there are no problems.
>
> It is the same problem as reported here:
> http://r.789695.n4.nabble.com/Problems-with-Raster-and-clim-pact-packages-with-large-netcdf-files-2-7G-in-x64-bit-R-td4119638.html#a4691956
>
> Does anyone have any clue as to why this may be?
> I can upload the file on an FTP server but it'll take me a while.
>
> Thanks in advance!
> Pablo
>
> --
> Ing. Pablo Alfaro Pi?eyro
> MotionSoft Consulting S.R.L.
> Tel: 095 938 487
>
>         [[alternative HTML version deleted]]
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



-- 
Pascal Oettli
Project Scientist
JAMSTEC
Yokohama, Japan


From mdsumner at gmail.com  Wed Jun 11 04:13:19 2014
From: mdsumner at gmail.com (Michael Sumner)
Date: Wed, 11 Jun 2014 12:13:19 +1000
Subject: [R-sig-Geo] Large NetCDF file problems
In-Reply-To: <CAAcyNCwtbPyNf9xPoYgKFZLNMtKUJ=2QXJs55Oq9sfx3TXGOnw@mail.gmail.com>
References: <CALDV4smYfnno0Mwr0icKZZvyam_Znb4u9Tdk_QYRX755CnMPog@mail.gmail.com>
	<CAAcyNCwtbPyNf9xPoYgKFZLNMtKUJ=2QXJs55Oq9sfx3TXGOnw@mail.gmail.com>
Message-ID: <CAAcGz9_adUdF+bv_wXA4G6jrAL2jF_gAXG0BgKgwBTNa_RXrrg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140611/e7d86abf/attachment.pl>

From adammichaelwilson2 at gmail.com  Wed Jun 11 15:56:55 2014
From: adammichaelwilson2 at gmail.com (AdamWilson)
Date: Wed, 11 Jun 2014 06:56:55 -0700 (PDT)
Subject: [R-sig-Geo] rasterVis levelplot: Use colortable in raster with
 attribute table
In-Reply-To: <759254E7AC2B1A4D834095DE4D652AA253AE7B42@P2KITMBX02WC01.unicph.domain>
References: <759254E7AC2B1A4D834095DE4D652AA253AE430E@P2KITMBX02WC01.unicph.domain>
	<CAMLL7bmw9Yb7n4xaje1cCx-Avo-OGNc-PCF7wvjG+wqT1feQhw@mail.gmail.com>
	<759254E7AC2B1A4D834095DE4D652AA253AE6B2D@P2KITMBX02WC01.unicph.domain>
	<CAMLL7bmoo+4QA3Cm4jP7yzZE8oMpts8+CXWCuK+M03EYPPJD5g@mail.gmail.com>
	<759254E7AC2B1A4D834095DE4D652AA253AE7B42@P2KITMBX02WC01.unicph.domain>
Message-ID: <1402495015718-7586573.post@n2.nabble.com>

It's possible to use the colortable metadata in levelplot like this:

library(rasterVis)
f <- system.file("external/test.grd", package="raster")
r <- round(raster(f))

## assign a color table
## if the original raster (on disk) had a color table it should already be
in this slot
r at legend@colortable=rainbow(cellStats(r,max))
str(r)

## 'normal' levelplot
levelplot(r)

## use the color table instead. Could write a simple wrapper function for
this...
## this might not work for all color tables....
cols=r at legend@colortable
levelplot(r,col.regions=cols,at=0:length(cols))




--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/rasterVis-levelplot-Use-colortable-in-raster-with-attribute-table-tp7585716p7586573.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From palfaro at motionsoft.com.uy  Wed Jun 11 20:07:10 2014
From: palfaro at motionsoft.com.uy (Pablo Alfaro)
Date: Wed, 11 Jun 2014 15:07:10 -0300
Subject: [R-sig-Geo] Large NetCDF file problems
In-Reply-To: <CAAcGz9_adUdF+bv_wXA4G6jrAL2jF_gAXG0BgKgwBTNa_RXrrg@mail.gmail.com>
References: <CALDV4smYfnno0Mwr0icKZZvyam_Znb4u9Tdk_QYRX755CnMPog@mail.gmail.com>
	<CAAcyNCwtbPyNf9xPoYgKFZLNMtKUJ=2QXJs55Oq9sfx3TXGOnw@mail.gmail.com>
	<CAAcGz9_adUdF+bv_wXA4G6jrAL2jF_gAXG0BgKgwBTNa_RXrrg@mail.gmail.com>
Message-ID: <CALDV4skHbwJq38BcPuiV2W_mqN97xRjrF1=TZFMsB19jOBQSFQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140611/4538a848/attachment.pl>

From palfaro at motionsoft.com.uy  Wed Jun 11 22:37:31 2014
From: palfaro at motionsoft.com.uy (Pablo Alfaro)
Date: Wed, 11 Jun 2014 17:37:31 -0300
Subject: [R-sig-Geo] Large NetCDF file problems
In-Reply-To: <CALDV4skHbwJq38BcPuiV2W_mqN97xRjrF1=TZFMsB19jOBQSFQ@mail.gmail.com>
References: <CALDV4smYfnno0Mwr0icKZZvyam_Znb4u9Tdk_QYRX755CnMPog@mail.gmail.com>
	<CAAcyNCwtbPyNf9xPoYgKFZLNMtKUJ=2QXJs55Oq9sfx3TXGOnw@mail.gmail.com>
	<CAAcGz9_adUdF+bv_wXA4G6jrAL2jF_gAXG0BgKgwBTNa_RXrrg@mail.gmail.com>
	<CALDV4skHbwJq38BcPuiV2W_mqN97xRjrF1=TZFMsB19jOBQSFQ@mail.gmail.com>
Message-ID: <CALDV4skvFCnmrwRy+KBKcUXBt_vyeEt7FTqdY=AO8PDngt_p-w@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140611/c3d5e1ef/attachment.pl>

From Roger.Bivand at nhh.no  Wed Jun 11 23:14:41 2014
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 11 Jun 2014 23:14:41 +0200
Subject: [R-sig-Geo] Large NetCDF file problems
In-Reply-To: <CALDV4skvFCnmrwRy+KBKcUXBt_vyeEt7FTqdY=AO8PDngt_p-w@mail.gmail.com>
References: <CALDV4smYfnno0Mwr0icKZZvyam_Znb4u9Tdk_QYRX755CnMPog@mail.gmail.com>
	<CAAcyNCwtbPyNf9xPoYgKFZLNMtKUJ=2QXJs55Oq9sfx3TXGOnw@mail.gmail.com>
	<CAAcGz9_adUdF+bv_wXA4G6jrAL2jF_gAXG0BgKgwBTNa_RXrrg@mail.gmail.com>
	<CALDV4skHbwJq38BcPuiV2W_mqN97xRjrF1=TZFMsB19jOBQSFQ@mail.gmail.com>
	<CALDV4skvFCnmrwRy+KBKcUXBt_vyeEt7FTqdY=AO8PDngt_p-w@mail.gmail.com>
Message-ID: <alpine.LRH.2.03.1406112310020.26131@reclus.nhh.no>

I suggest that you put together a complete reproducible example with 
access to the file on a server, and send this to the maintainers of ncdf 
and RNetCDF. This looks either like an issue in compiler flags, or an 
issue in the code of the external library used.

Roger

On Wed, 11 Jun 2014, Pablo Alfaro wrote:

> Hmm, just tried using RNetCDF (v 1.6.2-2) and it has the same problem.
>
> When using
>
> require('RNetCDF')
> nc <- open.nc('C:/testsMCH/test/wrfout_d02_2014-06-09_00%3A00%3A00')
> var.get.nc(nc, "T2", start=c(1, 1, 1), count=c(NA, NA, NA))
>
> I get the same problem on 64bit R, no problem on 32bits.
>
> Seems like a problem with the version of posixio.c used in 64 bit R. Just
> found a version of posixio.c on the web (
> http://www.nco.ncep.noaa.gov/pmb/codes/nwprod/util/sorc/ncdump.fd/libsrc/posixio.c)
> which has the assertion on line 417.
>
> assert(offset >= 0);
>
> offset is a variable of type off_t which is defined in <sys/types.h> and
> apparently requires that you enable Large File Support on the compiler
> command line to be a 64 bit integer.
> Can it be that the 32 bit version of R is using Large File Support but the
> 64 bit version is not?
>
> Best
> Pablo
>
>
>
>
> 2014-06-11 15:07 GMT-03:00 Pablo Alfaro <palfaro at motionsoft.com.uy>:
>
>> Hi Michael, Pascal, thank you both for your replies.
>>
>> Yeah, Sorry, I'm using R 3.0.3 64 (or 32 for the working version) bit, on
>> Windows 7 x64 and the NetCDF library is ncdf (not ncdf4) version 1.6.6, the
>> last available version.
>>
>> I need it to run on Windows since the servers I run the code on are
>> Windows.
>>
>> I tried downloading and installing the package you mention Michael but
>> when loading it, it says the x64 architecture is not supported (the author
>> mentions it in the site as well). The thing is that ncdf works on x86 so it
>> leaves me with the same options.
>>
>> RNetCDF seems to use NetCDF v3, but maybe it doesn't have this problem. I
>> wil try that and see if it helps.
>>
>> The assertion on the error complains an offset which isn't >= 0. If I were
>> to take a guess, that offset is a 32 bit signed integer and that's why it
>> breaks only with large files (bigger than 2^31 - 1 bytes). But I can't tell
>> for sure. Also it's weird that it works on 32 bits.
>>
>> Best
>> Pablo
>>
>>
>> 2014-06-10 23:13 GMT-03:00 Michael Sumner <mdsumner at gmail.com>:
>>
>>
>>>
>>>
>>> On Wed, Jun 11, 2014 at 11:49 AM, Pascal Oettli <kridox at ymail.com> wrote:
>>>
>>>> Hello,
>>>>
>>>> Do you get the same error if you run your code out of Rstudio?
>>>>
>>>> However, another approach would be to open your NetCDF file with
>>>> 'brick' function from the raster package.
>>>>
>>>
>>>
>>> I don't think either of these will help, raster simply runs ncdf (or
>>> preferably ncdf4) to do the file read. You might find it easier to move to
>>> ncdf4 if you can, but potentially the stuff I write below is just an
>>> unwelcome aside. I have seen a similar error in a file I've tried to use,
>>> so I'll have another look at that and see if I can isolate where the
>>> problem lies. At minimum we really need to know the version of the NetCDF
>>> library in use and perhaps details of how it was compiled so at minimum you
>>> should provide the ncdf package version as well as R's.
>>>
>>> It's possible to install ncdf4 on Windows, but it's not supported (no
>>> binary .zip on CRAN) but you can do it yourself (again not supported, and
>>> the archive here is not updated):
>>> http://cirrus.ucsd.edu/~pierce/ncdf/
>>>
>>> It's much more generally available to do this on Linux, though there's
>>> always bumps in the road.
>>>
>>> RNetCDF is actively updated on CRAN and is another option to see if the
>>> read is supported (I don't know how to find out what version of the library
>>> was used for the CRAN Windows binary, but presambly it is < 4.0).
>>>
>>> Cheers, Mike.
>>>
>>>
>>>
>>>> Regards,
>>>> Pascal
>>>>
>>>> On Wed, Jun 11, 2014 at 9:10 AM, Pablo Alfaro <palfaro at motionsoft.com.uy>
>>>> wrote:
>>>>> Hi, I'm having trouble opening a large netcdf file (2.45 GB) with the
>>>>> following code on R 3.0.3 64 bit
>>>>>
>>>>> require('ncdf')
>>>>> nc <- open.ncdf('C:/testsMCH/test/wrfout_d02_2014-06-09_00%3A00%3A00')
>>>>> get.var.ncdf(nc, 'T2', start=c(1, 1, 1), count=c(-1, -1, -1))
>>>>>
>>>>> I get this error:
>>>>> Assertion failed!
>>>>>
>>>>> Program: C:\Program Files\RStudio\bin\x64\rsession.exe
>>>>> File: posixio.c, Line 417
>>>>>
>>>>> Expression: offset >= 0
>>>>>
>>>>> This application has requested the Runtime to terminate it in an
>>>> unusual
>>>>> way.
>>>>> Please contact the application's support team for more information.
>>>>>
>>>>>
>>>>> In R 32 bit there are no problems.
>>>>>
>>>>> It is the same problem as reported here:
>>>>>
>>>> http://r.789695.n4.nabble.com/Problems-with-Raster-and-clim-pact-packages-with-large-netcdf-files-2-7G-in-x64-bit-R-td4119638.html#a4691956
>>>>>
>>>>> Does anyone have any clue as to why this may be?
>>>>> I can upload the file on an FTP server but it'll take me a while.
>>>>>
>>>>> Thanks in advance!
>>>>> Pablo
>>>>>
>>>>> --
>>>>> Ing. Pablo Alfaro Pi??eyro
>>>>> MotionSoft Consulting S.R.L.
>>>>> Tel: 095 938 487
>>>>>
>>>>>         [[alternative HTML version deleted]]
>>>>>
>>>>>
>>>>> _______________________________________________
>>>>> R-sig-Geo mailing list
>>>>> R-sig-Geo at r-project.org
>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>
>>>>
>>>>
>>>>
>>>> --
>>>> Pascal Oettli
>>>> Project Scientist
>>>> JAMSTEC
>>>> Yokohama, Japan
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at r-project.org
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>
>>>
>>>
>>> --
>>> Michael Sumner
>>> Software and Database Engineer
>>> Australian Antarctic Division
>>> Hobart, Australia
>>> e-mail: mdsumner at gmail.com
>>>
>>
>>
>>
>> --
>> Ing. Pablo Alfaro Pi??eyro
>> MotionSoft Consulting S.R.L.
>> Tel: 095 938 487
>>
>
>
>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no


From palfaro at motionsoft.com.uy  Thu Jun 12 02:45:55 2014
From: palfaro at motionsoft.com.uy (Pablo Alfaro)
Date: Wed, 11 Jun 2014 21:45:55 -0300
Subject: [R-sig-Geo] Large NetCDF file problems
In-Reply-To: <alpine.LRH.2.03.1406112310020.26131@reclus.nhh.no>
References: <CALDV4smYfnno0Mwr0icKZZvyam_Znb4u9Tdk_QYRX755CnMPog@mail.gmail.com>
	<CAAcyNCwtbPyNf9xPoYgKFZLNMtKUJ=2QXJs55Oq9sfx3TXGOnw@mail.gmail.com>
	<CAAcGz9_adUdF+bv_wXA4G6jrAL2jF_gAXG0BgKgwBTNa_RXrrg@mail.gmail.com>
	<CALDV4skHbwJq38BcPuiV2W_mqN97xRjrF1=TZFMsB19jOBQSFQ@mail.gmail.com>
	<CALDV4skvFCnmrwRy+KBKcUXBt_vyeEt7FTqdY=AO8PDngt_p-w@mail.gmail.com>
	<alpine.LRH.2.03.1406112310020.26131@reclus.nhh.no>
Message-ID: <CALDV4s=RLPPkibwHDmjOs_8uEzQ60ogHhbzG3BXF-PWCBQea8g@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140611/0f999baf/attachment.pl>

From Roger.Bivand at nhh.no  Thu Jun 12 05:58:27 2014
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 12 Jun 2014 05:58:27 +0200
Subject: [R-sig-Geo] Large NetCDF file problems
In-Reply-To: <CALDV4s=RLPPkibwHDmjOs_8uEzQ60ogHhbzG3BXF-PWCBQea8g@mail.gmail.com>
References: <CALDV4smYfnno0Mwr0icKZZvyam_Znb4u9Tdk_QYRX755CnMPog@mail.gmail.com>
	<CAAcyNCwtbPyNf9xPoYgKFZLNMtKUJ=2QXJs55Oq9sfx3TXGOnw@mail.gmail.com>
	<CAAcGz9_adUdF+bv_wXA4G6jrAL2jF_gAXG0BgKgwBTNa_RXrrg@mail.gmail.com>
	<CALDV4skHbwJq38BcPuiV2W_mqN97xRjrF1=TZFMsB19jOBQSFQ@mail.gmail.com>
	<CALDV4skvFCnmrwRy+KBKcUXBt_vyeEt7FTqdY=AO8PDngt_p-w@mail.gmail.com>
	<alpine.LRH.2.03.1406112310020.26131@reclus.nhh.no>
	<CALDV4s=RLPPkibwHDmjOs_8uEzQ60ogHhbzG3BXF-PWCBQea8g@mail.gmail.com>
Message-ID: <alpine.LRH.2.03.1406120539310.27690@reclus.nhh.no>

On Thu, 12 Jun 2014, Pablo Alfaro wrote:

> So you think this is not an R problem then?
> The executable failing the assertion is rsession.exe

You were told to run this outside RStudio (rsession.exe is part of RStudio 
that calls R.dll). You must do this to create a helpful reproducible 
example. The file you refer to (posixio.c) is part of NetCDF, not ncdf, 
not RNetCDF, and certainly not R.

However, there have been other examples of RStudio failing on large files 
(large spatial weights files IIRC) when the same script run directly in R 
did not fail. You need to approach this layer by layer, so removing 
RStudio is the first step.

The next is making a failing NetCDF file and its creation metadata 
available online and providing a link to it. The metadata is needed to 
know where the file is originated, as you haven't ruled out the 
possibility that the problem is in the file rather than NetCDF.

Roger

>
>
> 2014-06-11 18:14 GMT-03:00 Roger Bivand <Roger.Bivand at nhh.no>:
>
>> I suggest that you put together a complete reproducible example with
>> access to the file on a server, and send this to the maintainers of ncdf
>> and RNetCDF. This looks either like an issue in compiler flags, or an issue
>> in the code of the external library used.
>>
>> Roger
>>
>>
>> On Wed, 11 Jun 2014, Pablo Alfaro wrote:
>>
>>  Hmm, just tried using RNetCDF (v 1.6.2-2) and it has the same problem.
>>>
>>> When using
>>>
>>> require('RNetCDF')
>>> nc <- open.nc('C:/testsMCH/test/wrfout_d02_2014-06-09_00%3A00%3A00')
>>> var.get.nc(nc, "T2", start=c(1, 1, 1), count=c(NA, NA, NA))
>>>
>>> I get the same problem on 64bit R, no problem on 32bits.
>>>
>>> Seems like a problem with the version of posixio.c used in 64 bit R. Just
>>> found a version of posixio.c on the web (
>>> http://www.nco.ncep.noaa.gov/pmb/codes/nwprod/util/sorc/
>>> ncdump.fd/libsrc/posixio.c)
>>> which has the assertion on line 417.
>>>
>>> assert(offset >= 0);
>>>
>>> offset is a variable of type off_t which is defined in <sys/types.h> and
>>> apparently requires that you enable Large File Support on the compiler
>>> command line to be a 64 bit integer.
>>> Can it be that the 32 bit version of R is using Large File Support but the
>>> 64 bit version is not?
>>>
>>> Best
>>> Pablo
>>>
>>>
>>>
>>>
>>> 2014-06-11 15:07 GMT-03:00 Pablo Alfaro <palfaro at motionsoft.com.uy>:
>>>
>>>  Hi Michael, Pascal, thank you both for your replies.
>>>>
>>>> Yeah, Sorry, I'm using R 3.0.3 64 (or 32 for the working version) bit, on
>>>> Windows 7 x64 and the NetCDF library is ncdf (not ncdf4) version 1.6.6,
>>>> the
>>>> last available version.
>>>>
>>>> I need it to run on Windows since the servers I run the code on are
>>>> Windows.
>>>>
>>>> I tried downloading and installing the package you mention Michael but
>>>> when loading it, it says the x64 architecture is not supported (the
>>>> author
>>>> mentions it in the site as well). The thing is that ncdf works on x86 so
>>>> it
>>>> leaves me with the same options.
>>>>
>>>> RNetCDF seems to use NetCDF v3, but maybe it doesn't have this problem. I
>>>> wil try that and see if it helps.
>>>>
>>>> The assertion on the error complains an offset which isn't >= 0. If I
>>>> were
>>>> to take a guess, that offset is a 32 bit signed integer and that's why it
>>>> breaks only with large files (bigger than 2^31 - 1 bytes). But I can't
>>>> tell
>>>> for sure. Also it's weird that it works on 32 bits.
>>>>
>>>> Best
>>>> Pablo
>>>>
>>>>
>>>> 2014-06-10 23:13 GMT-03:00 Michael Sumner <mdsumner at gmail.com>:
>>>>
>>>>
>>>>
>>>>>
>>>>> On Wed, Jun 11, 2014 at 11:49 AM, Pascal Oettli <kridox at ymail.com>
>>>>> wrote:
>>>>>
>>>>>  Hello,
>>>>>>
>>>>>> Do you get the same error if you run your code out of Rstudio?
>>>>>>
>>>>>> However, another approach would be to open your NetCDF file with
>>>>>> 'brick' function from the raster package.
>>>>>>
>>>>>>
>>>>>
>>>>> I don't think either of these will help, raster simply runs ncdf (or
>>>>> preferably ncdf4) to do the file read. You might find it easier to move
>>>>> to
>>>>> ncdf4 if you can, but potentially the stuff I write below is just an
>>>>> unwelcome aside. I have seen a similar error in a file I've tried to
>>>>> use,
>>>>> so I'll have another look at that and see if I can isolate where the
>>>>> problem lies. At minimum we really need to know the version of the
>>>>> NetCDF
>>>>> library in use and perhaps details of how it was compiled so at minimum
>>>>> you
>>>>> should provide the ncdf package version as well as R's.
>>>>>
>>>>> It's possible to install ncdf4 on Windows, but it's not supported (no
>>>>> binary .zip on CRAN) but you can do it yourself (again not supported,
>>>>> and
>>>>> the archive here is not updated):
>>>>> http://cirrus.ucsd.edu/~pierce/ncdf/
>>>>>
>>>>> It's much more generally available to do this on Linux, though there's
>>>>> always bumps in the road.
>>>>>
>>>>> RNetCDF is actively updated on CRAN and is another option to see if the
>>>>> read is supported (I don't know how to find out what version of the
>>>>> library
>>>>> was used for the CRAN Windows binary, but presambly it is < 4.0).
>>>>>
>>>>> Cheers, Mike.
>>>>>
>>>>>
>>>>>
>>>>>  Regards,
>>>>>> Pascal
>>>>>>
>>>>>> On Wed, Jun 11, 2014 at 9:10 AM, Pablo Alfaro <
>>>>>> palfaro at motionsoft.com.uy>
>>>>>> wrote:
>>>>>>
>>>>>>> Hi, I'm having trouble opening a large netcdf file (2.45 GB) with the
>>>>>>> following code on R 3.0.3 64 bit
>>>>>>>
>>>>>>> require('ncdf')
>>>>>>> nc <- open.ncdf('C:/testsMCH/test/wrfout_d02_2014-06-09_00%3A00%
>>>>>>> 3A00')
>>>>>>> get.var.ncdf(nc, 'T2', start=c(1, 1, 1), count=c(-1, -1, -1))
>>>>>>>
>>>>>>> I get this error:
>>>>>>> Assertion failed!
>>>>>>>
>>>>>>> Program: C:\Program Files\RStudio\bin\x64\rsession.exe
>>>>>>> File: posixio.c, Line 417
>>>>>>>
>>>>>>> Expression: offset >= 0
>>>>>>>
>>>>>>> This application has requested the Runtime to terminate it in an
>>>>>>>
>>>>>> unusual
>>>>>>
>>>>>>> way.
>>>>>>> Please contact the application's support team for more information.
>>>>>>>
>>>>>>>
>>>>>>> In R 32 bit there are no problems.
>>>>>>>
>>>>>>> It is the same problem as reported here:
>>>>>>>
>>>>>>>  http://r.789695.n4.nabble.com/Problems-with-Raster-and-clim-
>>>>>> pact-packages-with-large-netcdf-files-2-7G-in-x64-bit-
>>>>>> R-td4119638.html#a4691956
>>>>>>
>>>>>>>
>>>>>>> Does anyone have any clue as to why this may be?
>>>>>>> I can upload the file on an FTP server but it'll take me a while.
>>>>>>>
>>>>>>> Thanks in advance!
>>>>>>> Pablo
>>>>>>>
>>>>>>> --
>>>>>>> Ing. Pablo Alfaro Pi??eyro
>>>>>>>
>>>>>>> MotionSoft Consulting S.R.L.
>>>>>>> Tel: 095 938 487
>>>>>>>
>>>>>>>         [[alternative HTML version deleted]]
>>>>>>>
>>>>>>>
>>>>>>> _______________________________________________
>>>>>>> R-sig-Geo mailing list
>>>>>>> R-sig-Geo at r-project.org
>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>>>
>>>>>>>
>>>>>>
>>>>>>
>>>>>> --
>>>>>> Pascal Oettli
>>>>>> Project Scientist
>>>>>> JAMSTEC
>>>>>> Yokohama, Japan
>>>>>>
>>>>>> _______________________________________________
>>>>>> R-sig-Geo mailing list
>>>>>> R-sig-Geo at r-project.org
>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>>
>>>>>>
>>>>>
>>>>>
>>>>> --
>>>>> Michael Sumner
>>>>> Software and Database Engineer
>>>>> Australian Antarctic Division
>>>>> Hobart, Australia
>>>>> e-mail: mdsumner at gmail.com
>>>>>
>>>>>
>>>>
>>>>
>>>> --
>>>> Ing. Pablo Alfaro Pi??eyro
>>>>
>>>> MotionSoft Consulting S.R.L.
>>>> Tel: 095 938 487
>>>>
>>>>
>>>
>>>
>>>
>>>
>> --
>> Roger Bivand
>> Department of Economics, Norwegian School of Economics,
>> Helleveien 30, N-5045 Bergen, Norway.
>> voice: +47 55 95 93 55; fax +47 55 95 91 00
>> e-mail: Roger.Bivand at nhh.no
>>
>>
>
>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no


From r.hijmans at gmail.com  Thu Jun 12 07:58:21 2014
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Wed, 11 Jun 2014 22:58:21 -0700
Subject: [R-sig-Geo] new patch versus patch expansion
In-Reply-To: <53AEF96CFCBD6044874EC220EEF02369B0222C65@HARVANDMBX02.fasmail.priv>
References: <53AEF96CFCBD6044874EC220EEF02369B0222C65@HARVANDMBX02.fasmail.priv>
Message-ID: <CANtt_hz_X1kgCD=ORDU9NkwtG3T_qjhgkJg4LsBEqjNd+13tHw@mail.gmail.com>

Jonathan,

I am not sure if this improves things, but it is an alternative route:

a <- boundaries(t1, type='outer', classes=TRUE, directions=4)
f1 <- freq(c.change, useNA='no')
f2 <- freq(mask(c.change, a, maskvalue=0), useNA='no')
f <- merge(f1, f2, by='value')
newpatches <- f[f[,2] == f[,3]]

Robert

On Tue, Jun 10, 2014 at 4:49 AM, Thompson, Jonathan
<jthomps at fas.harvard.edu> wrote:
> I am hoping for some help thinking through a problem.  I need to quantify the percent of new urban patches (not cells) in a land cover change map that occur as expansion of existing urban patches versus those that occur as new patches. And I need to do this over a very large area (>40mil cells).     I developed a toy solution below but it is terribly inefficient and when applied to the full dataset the vector produced from the adjacent command is prohibitively large.   My fear is that I?m overlooking an obvious solution.   I would sure appreciate any ideas.  Thanks in advance.
>
> library(raster); library(SDMTools)
> set.seed(10)
> ### Time One Raster  ############
> t1 <- raster(ncol=5, nrow=5)
> vals <- sample(c(0,1,0,0,0), ncell(t1), replace =T)
> t1[] <- vals
>
> ### Change Raster #########
> change<- raster(ncol=5,nrow=5)
> change[] <- rep(0, times = ncell(change))
> vals.c <- sample(which(vals==0), 5)
> change[vals.c]=1
>
> ### Time Two Raster #########
> t2 <- t1 + change
>
> ### Define and count Patches #####
> c.change <- clump(change)
> change.patches <- PatchStat(c.change, cellsize = 1)
>
> ## define those cells that are adjacent to Time One Urban Cells
> adj.cells <- adjacent(t1, which(values(t1)==1), pairs = F)
>
> ## Which of those are occupied by a new patch
> adj.patches <- extract(c.change,adj.cells)
>
> ## What percent of patches are adjacent to existing patches
> (length(unique(adj.patches))-1) / length(unique(change.patches$patchID))
>
>
>
> Jonathan R Thompson, Ph.D.
> Harvard Forest   |  Harvard Univeristy
> 324 North Main Street, Petersham Massachusetts 01366
> Phone 978-756-6145  | Email jthomps at fas.harvard.edu <mailto:jthomps at fas.harvard.edu%20>
>
>
>         [[alternative HTML version deleted]]
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From mdsumner at gmail.com  Thu Jun 12 09:39:49 2014
From: mdsumner at gmail.com (Michael Sumner)
Date: Thu, 12 Jun 2014 17:39:49 +1000
Subject: [R-sig-Geo] Large NetCDF file problems
In-Reply-To: <CALDV4s=RLPPkibwHDmjOs_8uEzQ60ogHhbzG3BXF-PWCBQea8g@mail.gmail.com>
References: <CALDV4smYfnno0Mwr0icKZZvyam_Znb4u9Tdk_QYRX755CnMPog@mail.gmail.com>
	<CAAcyNCwtbPyNf9xPoYgKFZLNMtKUJ=2QXJs55Oq9sfx3TXGOnw@mail.gmail.com>
	<CAAcGz9_adUdF+bv_wXA4G6jrAL2jF_gAXG0BgKgwBTNa_RXrrg@mail.gmail.com>
	<CALDV4skHbwJq38BcPuiV2W_mqN97xRjrF1=TZFMsB19jOBQSFQ@mail.gmail.com>
	<CALDV4skvFCnmrwRy+KBKcUXBt_vyeEt7FTqdY=AO8PDngt_p-w@mail.gmail.com>
	<alpine.LRH.2.03.1406112310020.26131@reclus.nhh.no>
	<CALDV4s=RLPPkibwHDmjOs_8uEzQ60ogHhbzG3BXF-PWCBQea8g@mail.gmail.com>
Message-ID: <CAAcGz98Ut0Nz8R_mkS5GFAEisp3O6ie9cygWDdp6exCxR+iRTw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140612/ad3d1e62/attachment.pl>

From matt.slocum at ruths.ai  Thu Jun 12 15:10:38 2014
From: matt.slocum at ruths.ai (Matthew Slocum)
Date: Thu, 12 Jun 2014 08:10:38 -0500
Subject: [R-sig-Geo] Area of polygons wrong after intersection using
	gDifference
Message-ID: <CAKo2tqFXU8jx22WCEfPbyi5FabPFEGBRE3iZEXOnnjL4dNw8Aw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140612/86614b13/attachment.pl>

From ferra.xu at yahoo.com  Thu Jun 12 21:55:35 2014
From: ferra.xu at yahoo.com (Ferra Xu)
Date: Thu, 12 Jun 2014 12:55:35 -0700 (PDT)
Subject: [R-sig-Geo] Simulating spatio-temporal marked ETAS point process
Message-ID: <1402602935.54308.YahooMailNeo@web125101.mail.ne1.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140612/9d05a2db/attachment.pl>

From Roger.Bivand at nhh.no  Thu Jun 12 23:01:55 2014
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 12 Jun 2014 23:01:55 +0200
Subject: [R-sig-Geo] Area of polygons wrong after intersection using
 gDifference
In-Reply-To: <CAKo2tqFXU8jx22WCEfPbyi5FabPFEGBRE3iZEXOnnjL4dNw8Aw@mail.gmail.com>
References: <CAKo2tqFXU8jx22WCEfPbyi5FabPFEGBRE3iZEXOnnjL4dNw8Aw@mail.gmail.com>
Message-ID: <alpine.LRH.2.03.1406122231200.30040@reclus.nhh.no>

On Thu, 12 Jun 2014, Matthew Slocum wrote:

> I originally posted this question to Stack Overflow, and I was told that
> this was the right place to go.

Yes (of course), effectively none of the developers here have time to read 
SO. Users are expected to respect the constraints on developers' time - we 
have day jobs (really).

>
> I performed an analysis on a set of X, Y coordinates producing a Voronoi
> diagram, and I then created a border. Here I intersect the diagram and the
> border, and attempt to get the area of the resulting polygons. The areas
> for the interior "hole" polys are correct, but the edge polygons appear to
> maintain their original exaggerated size. A link to my data is here:
>
> https://drive.google.com/a/ruths.ai/file/d/0B8QG4cbDqH0UaGM2VkkxZHZkZTA/edit?usp=sharing
>
> Code illustrating the problem is here:
>

You posted HTML, don't.

You have provided data files (note that real shapefiles should have a 
*.prj). However, from there on you are just guessing.

Never user maptools to read data, use rgdal (you do not load maptools in 
your code). If you use rgdal, you'll find that the essential comments for 
SpatialPolygons and Polygons objects are generated. If you don't, the 
exterior and interior rings may get mislaid (rgeos imposes comments on 
the fly internally, but there are less forgiving heuristics in maptools).

Never use @ to access slots unless you are a developer. Use subsetting and 
access methods.

Do not guess that plot order is anything other than its name. The hole 
slot is intended to be correct, as is ring direction. The comment in 
Polygons objects is authoritative.

No Polygons object can by definition consist of a single hole - it has to 
have at least one exterior ring.

All of this is documented in Bivand et al. (2013, 2nd ed.) - your email is 
from a commercial organisation in oil/gas consulting so you can buy the 
book - academics have libraries (you do not give an affiliation, but 
should).

> sapply(slot(slot(SPDF[339,], "polygons")[[1]], "Polygons"), slot, 
"hole")
[1] FALSE

339 is not a hole - why should it be?? SPDF are Voronoi polygons, so no 
holes by definition?

> gArea(SPDF[337,])
[1] 3932082

is the area of the polygon - not wrong!

Why gDifference?? Of the possibilities, gIntersection is the obvious one 
to use, if you want to clip SPDF to spP. You even use the word intersect, 
so how does your code represent your actual workflow? Your final sentence 
is equally unreflected, as edges have by definition no area. Do you intend 
to do:

D <- gIntersection(SPDF, SpP, byid=c(TRUE, FALSE))
plot(D, add=TRUE, col=sample(rainbow(339)))

summary(gArea(SPDF, byid=TRUE) - gArea(D, byid=TRUE))

Hope this clarifies,

Roger

>
> # Read in shapefiles.
> # Files are located at:
>
> require(sp)
> require(rgeos)
> SPDF <- readShapeSpatial("SPDF.shp")
> SpP <- readShapeSpatial("SpP.shp")
>
> # Examine plots
> plot(SPDF)
> SPDF at polygons[[337]]@area # Too large; want it cut off
> SPDF at polygons[[339]]@area # Hole poly; area correct
> gArea(SPDF[339,]) # Ditto
> gArea(SPDF[337,]) # Still wrong
>
>
> # Merge polys using gDifference
> D <- gDifference(SpP, SPDF, byid = TRUE)
> plot(D)
>
> # Seems to work, but areas now have a couple of problems.
> # I pick apart D using the plotOrder slot to separate
> # polys that are holes versus those that are not, allowing
> # me to get the correct area for "hole" polys, but the
> # edge polygons are still not correct, maintaining their
> # area estimates from the original SPDF data frame.
>
> areas <- vector()
> for (i in 337:339){ # 337 = exterior poly, 338 and 339 are holes
>  po <- D at polygons[[i]]@plotOrder
>
>  if (max(po) == 2) {
>    areas[i] <- D at polygons[[i]]@Polygons[[2]]@area
>  } else {
>    areas[i] <- D at polygons[[i]]@area
>
>  }
> }
>
> areas
>
> How does one get the right areas for the edges that should be cut
> off by the intersection?
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no


From espada at agro.uba.ar  Fri Jun 13 05:53:39 2014
From: espada at agro.uba.ar (Ramiro Augusto Espada)
Date: Fri, 13 Jun 2014 00:53:39 -0300
Subject: [R-sig-Geo] problems for using spgrass6 package
Message-ID: <CAG=AKhVtum7eXPEuf54dGpo3PYjB1CLTKFoOXUcsqmG+GZ+CmA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140613/7e98ccf8/attachment.pl>

From villers.alexandre at gmail.com  Fri Jun 13 06:41:15 2014
From: villers.alexandre at gmail.com (Alexandre Villers)
Date: Fri, 13 Jun 2014 06:41:15 +0200
Subject: [R-sig-Geo] problems for using spgrass6 package
In-Reply-To: <CAG=AKhVtum7eXPEuf54dGpo3PYjB1CLTKFoOXUcsqmG+GZ+CmA@mail.gmail.com>
References: <CAG=AKhVtum7eXPEuf54dGpo3PYjB1CLTKFoOXUcsqmG+GZ+CmA@mail.gmail.com>
Message-ID: <CAFrtd2OORqmaCbLXw19BKuHYuSLLCLDYM1QpOgLGci9biWKNRA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140613/3cad3a33/attachment.pl>

From Roger.Bivand at nhh.no  Fri Jun 13 07:34:02 2014
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 13 Jun 2014 07:34:02 +0200
Subject: [R-sig-Geo] problems for using spgrass6 package
In-Reply-To: <CAFrtd2OORqmaCbLXw19BKuHYuSLLCLDYM1QpOgLGci9biWKNRA@mail.gmail.com>
References: <CAG=AKhVtum7eXPEuf54dGpo3PYjB1CLTKFoOXUcsqmG+GZ+CmA@mail.gmail.com>
	<CAFrtd2OORqmaCbLXw19BKuHYuSLLCLDYM1QpOgLGci9biWKNRA@mail.gmail.com>
Message-ID: <alpine.LRH.2.03.1406130721230.3963@reclus.nhh.no>

In:

list.files(system.file("doc", package="spgrass6"))

there are two PDF files, one from OSGeo Journal in 2007. They describe use 
of R inside a GRASS location - start GRASS first, then start R from within 
GRASS (as you have not provided the output of sessionInfo(), we don't know 
your OS).

If you need to start a temporary location, look at the help page for 
initGRASS, then execGRASS. For running R inside GRASS, see Neteler and 
Mitasova (2008). For both modes, see Bivand et al. (2013, 2nd edition) 
section 4.5, pp. 112-118 (GRASS in R) and 136 (temporary location). The 
code for these is on www.asdar-book.org.

The grass-stats mailing list is another place to ask, but reviewing the 
archives of that list may be helpful too.

Hope this helps,

Roger


On Fri, 13 Jun 2014, Alexandre Villers wrote:

> Hi,
> This message doesn't prevent you from using grass. You can still use the
> different grass modules within the R environment. Unless you have other
> warnings or error messages...
>
> HTH
>
> Alex
> Le 13 juin 2014 05:54, "Ramiro Augusto Espada" <espada at agro.uba.ar> a ??crit
> :
>
>> Hi!
>>
>> Im trying to use GRASS GIS inside R.  But when I use the commands of
>> spgrass6 package isnt work well.
>>
>> I think that maybe has any relation with this message that appears when i
>> load the package:
>>
>>> require(spgrass6)
>> Loading required package: spgrass6
>> Loading required package: sp
>> Loading required package: XML
>> *GRASS GIS interface loaded with GRASS version: (GRASS not running)*
>>
>>
>>
>> I got the 3.0.3 version of R. And the version 6.4.3 of GRASS-GIS.
>>
>> Somebody has any idea why can i do? or about any tutorial to learn how it
>> works.
>>
>> thanks to read!
>>
>> regards!
>> Ramiro
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> 	[[alternative HTML version deleted]]
>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no


From Dominik.Schneider at colorado.edu  Sat Jun 14 00:49:38 2014
From: Dominik.Schneider at colorado.edu (Dominik Schneider)
Date: Fri, 13 Jun 2014 16:49:38 -0600
Subject: [R-sig-Geo] cressman analysis
Message-ID: <CAHYDKLaFXuig9-ZLvxVjs790VNpicAkJXVZRmPF9AnoF_+YiTQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140613/e814b90d/attachment.pl>

From j.garcia-pintado at reading.ac.uk  Sat Jun 14 06:45:02 2014
From: j.garcia-pintado at reading.ac.uk (Javier Garcia-Pintado)
Date: Sat, 14 Jun 2014 04:45:02 +0000
Subject: [R-sig-Geo] cressman analysis
In-Reply-To: <CAHYDKLaFXuig9-ZLvxVjs790VNpicAkJXVZRmPF9AnoF_+YiTQ@mail.gmail.com>
References: <CAHYDKLaFXuig9-ZLvxVjs790VNpicAkJXVZRmPF9AnoF_+YiTQ@mail.gmail.com>
Message-ID: <E82BBC061BBD7448BC7905721F497B077020C002@vime-mbx5.rdg.ac.uk>

Hi Dominik,

a) It won't take you more than a few of lines to code the Cressman analysis in R. You just need to decide what metric to use for the weighting function [e.g. a distance-based exponential decay?]

b) Are you sure you want to use a Cressman analysis? It certainly is not the state-of-the-art in Data Assimilation


Regards,
Javier


________________________________________
From: r-sig-geo-bounces at r-project.org [r-sig-geo-bounces at r-project.org] on behalf of Dominik Schneider [Dominik.Schneider at colorado.edu]
Sent: 13 June 2014 23:49
To: r-sig-Geo at r-project.org
Subject: [R-sig-Geo] cressman analysis

Are there any implementations in R of the Cressman interpolation?
https://nsidc.org/data/docs/daac/nsidc0033_arctic_water_vapor/cressman_equations.html
I haven't found anything via rseek or google.
Thanks Dominik

        [[alternative HTML version deleted]]

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From sandramf at live.co.za  Sun Jun 15 13:33:50 2014
From: sandramf at live.co.za (Sandra MacFadyen)
Date: Sun, 15 Jun 2014 13:33:50 +0200
Subject: [R-sig-Geo] focal {raster} fun = freq(): Error in (function
	(classes, fdef,
	mtable) : unable to find an inherited method for function 'freq' for
	signature '"numeric"' [large rasters]
Message-ID: <DUB131-DS3A3822A8B25CCF2D0750EFB170@phx.gbl>

Dear R-sig-Geo'ers,

I am trying the calculate different focal measures of diversity on a raster
without using execGRASS.
My code (see below) works fine on small (ras1) and large (ras2) rasters.
However, when I try to parse these as functions to focal {raster} to
calculate over "moving window" values within a neighbourhood, I get an error
when using freq(): Error in (function (classes, fdef, mtable)  :   unable to
find an inherited method for function 'freq' for signature '"numeric"'.

I would appreciate any advice you could give.

Thank you

Regards
Sandra

# Create matrix
seq1 <- seq(1:9)
mat1 <- matrix(seq1, 3)

# change values
mat1[2,2]=2
mat1[3,3]=2

# convert to raster
ras1 = raster(mat1)

# Calculate diversity measures
(richness <- length(unique(ras1)) ) # Richness
(eveness <- richness / ncell(ras1) ) # Eveness
(Ni <- freq(ras1)[,2] ) # Frequency of individuals
(Pi <- freq(ras1)[,2]/ncell(ras1) ) # Proportion of individuals
(f.simpD <- (freq(ras1)[,2]/ncell(ras1))^2 ) # Value to calc Simpson index
(simpD <- sum((freq(ras1)[,2]/ncell(ras1))^2) ) # Simpson index

# Do the same thing but with a large raster
# Create large matrix
seq2 <- runif(1000000, -120, 4980)
mat2 <- matrix(seq2, 1000)
# convert to raster
ras2 = raster(mat2)

# Calculate diversity measures
(richness <- length(unique(ras2)) ) # Richness
(eveness <- richness / ncell(ras2) ) # Eveness
(Ni <- freq(ras2)[,2] ) # Frequency of individuals
(Pi <- freq(ras2)[,2]/ncell(ras2) ) # Proportion of individuals

(f.simpD <- (freq(ras2)[,2]/ncell(ras2))^2 ) # Value to calc Simpson index
(simpD <- sum((freq(ras2)[,2]/ncell(ras2))^2) ) # Simpson index

# Now with Focal functions (moving windows)
# Define custom functions
# Set functions to calculate diversity indices
f.rich = function(x) { length(unique(x)) }
f.even = function(x) {  length(unique(x))/ ncell(x) }
f.Ni = function(x) { freq(x)[,2] }

f.1simpD = function(x) { (freq(x)[,2]/ncell(x))^2 }
f.2simpD = function(x) { sum((freq(x)[,2]/ncell(x))^2) }

#Pass function to focal function 5x5
lsat.rich <- focal(lsat, w=matrix(1/25,nrow=5,ncol=5), fun=f.rich)
lsat.even <- focal(lsat, w=matrix(1/25,nrow=5,ncol=5), fun=f.even)
lsat.Ni <- focal(lsat, w=matrix(1/25,nrow=5,ncol=5), fun=f.Ni)


From Dominik.Schneider at colorado.edu  Mon Jun 16 16:43:10 2014
From: Dominik.Schneider at colorado.edu (Dominik Schneider)
Date: Mon, 16 Jun 2014 08:43:10 -0600
Subject: [R-sig-Geo] cressman analysis
In-Reply-To: <E82BBC061BBD7448BC7905721F497B077020C002@vime-mbx5.rdg.ac.uk>
References: <CAHYDKLaFXuig9-ZLvxVjs790VNpicAkJXVZRmPF9AnoF_+YiTQ@mail.gmail.com>
	<E82BBC061BBD7448BC7905721F497B077020C002@vime-mbx5.rdg.ac.uk>
Message-ID: <CAHYDKLavhXkw+m+M0qGvf252e3xJXQMQMqqHXBZb2VC8f-jQkQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140616/429910af/attachment.pl>

From j.garcia-pintado at reading.ac.uk  Mon Jun 16 17:42:23 2014
From: j.garcia-pintado at reading.ac.uk (Javier Garcia-Pintado)
Date: Mon, 16 Jun 2014 15:42:23 +0000
Subject: [R-sig-Geo] cressman analysis
In-Reply-To: <CAHYDKLavhXkw+m+M0qGvf252e3xJXQMQMqqHXBZb2VC8f-jQkQ@mail.gmail.com>
References: <CAHYDKLaFXuig9-ZLvxVjs790VNpicAkJXVZRmPF9AnoF_+YiTQ@mail.gmail.com>
	<E82BBC061BBD7448BC7905721F497B077020C002@vime-mbx5.rdg.ac.uk>,
	<CAHYDKLavhXkw+m+M0qGvf252e3xJXQMQMqqHXBZb2VC8f-jQkQ@mail.gmail.com>
Message-ID: <E82BBC061BBD7448BC7905721F497B077020C15F@vime-mbx5.rdg.ac.uk>

An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140616/b9685a98/attachment.html>

From benjamin0mack at gmail.com  Tue Jun 17 10:47:27 2014
From: benjamin0mack at gmail.com (ben mack)
Date: Tue, 17 Jun 2014 01:47:27 -0700 (PDT)
Subject: [R-sig-Geo] custom focal function on rasterstack
In-Reply-To: <CAO6WGrU-qDTgbNV6L+4eirgn-unDOeg3cQjHPfA=_wibZOGn5w@mail.gmail.com>
References: <CAO6WGrWsXiyXVZC1sEH=KJFF8Kr0R+W9Jww=pNeBjgNH9ULhsg@mail.gmail.com>
	<CABG0rfvRGK9jLUtLkGmoicwwQb8Ff+SkOTW_GEwc_7E6+0NeKg@mail.gmail.com>
	<CAO6WGrU-qDTgbNV6L+4eirgn-unDOeg3cQjHPfA=_wibZOGn5w@mail.gmail.com>
Message-ID: <1402994847252-7586593.post@n2.nabble.com>

Hi,

the spatial.tools is really a great thing to accellerate the raster
processing. However, I have the same issue and often need to process only a
part of the image and thus a mask option for the rasterEngine would also be
great for me.
I just wanted to also ask if this is considered an option in future versions
(Jonathan?). Or did you, Ruben, or anybody else found a work around?

Thanks a lot,
Ben 



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/custom-focal-function-on-rasterstack-tp7585959p7586593.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From gonzagarg at yahoo.com.br  Wed Jun 18 01:56:30 2014
From: gonzagarg at yahoo.com.br (Ruth Gonzaga)
Date: Wed, 18 Jun 2014 00:56:30 +0100
Subject: [R-sig-Geo] Error creating GlobalSoilMap object (GSIF package)
Message-ID: <CAOumgdDYNW_2_tLw9CzwusBS3b8EHRFVv1sLP8fpA8b14JBVUQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140618/b63dbb81/attachment.pl>

From gosz at gmx.de  Wed Jun 18 02:19:26 2014
From: gosz at gmx.de (Guido Schulz)
Date: Tue, 17 Jun 2014 21:19:26 -0300
Subject: [R-sig-Geo] What's the difference between (universal) kriging and
 spatial autoregressive models?
Message-ID: <53A0DB0E.3070700@gmx.de>

Dear list,

as part of a course on missing observations in social/survey statistics
I am trying to explore existing methods of predicting either point
pattern or polygon data.

As far as I have seen, there is no particular package that includes
missing spatial data and imputation for spatial data methods, so I am
relying on prediction and interpolation.

I got quite confused by all the different terms and formalisations used
in geostatistics (more on the kriging side?) on the one hand and spatial
statistics/econometrics (more on the regression side?) on the other.

So far, I understood that both spatial autoregression and kriging

- seek spatial prediction,

- rely on a variance-covariance (or variogram) Matrix - in other words,
they rely on spatial autocorrelation,

- and, as far as universal kriging is concerned, assume an underlying
trend plus random residuals.

However, kriging seems to be used primarily for point patterns with
continuous regions while spatial autoregression involves aggregations of
phenomena into polygons.

So here are my questions:

- Is the underlying spatial structure the only difference between the two?

- Are there equivalent mathematical model formulations for universal
kriging and spatial autoregression?

- Would area-to-area universal kriging be exactly the same thing as
prediction models using spatial error autoregression?

- Is the "constrainedKriging" package the only one that supports
spatialpolygondataframe-to-spatialpolygondataframe kriging?


Best,

Guido


From kridox at ymail.com  Wed Jun 18 03:12:05 2014
From: kridox at ymail.com (Pascal Oettli)
Date: Wed, 18 Jun 2014 10:12:05 +0900
Subject: [R-sig-Geo] Error creating GlobalSoilMap object (GSIF package)
In-Reply-To: <CAOumgdDYNW_2_tLw9CzwusBS3b8EHRFVv1sLP8fpA8b14JBVUQ@mail.gmail.com>
References: <CAOumgdDYNW_2_tLw9CzwusBS3b8EHRFVv1sLP8fpA8b14JBVUQ@mail.gmail.com>
Message-ID: <CAAcyNCzN9+DQ__baJUpoLbKeVB_H=zSCR01WViF4bSuTw89VUg@mail.gmail.com>

Hello,

According to the help file, TimeSpan is an "object of class "list";
contains begin and end of the sampling period of class "POSIXct"". You
need to provide a list of POSIXct dates, not a vector.

HTH
Pascal

On Wed, Jun 18, 2014 at 8:56 AM, Ruth Gonzaga <gonzagarg at yahoo.com.br> wrote:
> Dear All,
> I have been trying to follow this tutorial on 3D modelling of soil with the
> GSIF package:
> http://gsif.isric.org/doku.php?id=wiki:tutorial_eberg
>
> (code on:
> https://code.google.com/p/gsif/source/browse/trunk/eberg/tutorial_eberg.R)
>
> When I get to creating a GlobalSoilMap object (line 181):
>
> SNDMHT.gsm <- GlobalSoilMap(sd.ll, varname="SNDMHT", period=c("1999-02-01",
> "2001-07-01"))
>
> I get an error saying:
> Error in GlobalSoilMap(sd.ll, varname = "SNDMHT", period = c("1999-02-01",
> : unused argument (period = c("1999-02-01", "2001-07-01"))
>
> I think the tutorial is quite old. I checked the help and then replaced
> "period" for "TimeSpan". I now get the following error:
>  Error in initialize(value, ...) :
>   invalid name for slot of class "GlobalSoilMap": TimeSpan.begin
>
>
> Here is some information on this function:
>> GlobalSoilMap function (obj, varname, TimeSpan = list(begin = Sys.Date()
> - 1, end = Sys.Date())) { if (!class(obj) == "list") { stop("Object of
> class 'list' required") } out = new("GlobalSoilMap", varname = varname,
> TimeSpan.begin = TimeSpan, sd1 = as(obj[[1]], "SpatialPixelsDataFrame"),
> sd2 = as(obj[[2]], "SpatialPixelsDataFrame"), sd3 = as(obj[[3]],
> "SpatialPixelsDataFrame"), sd4 = as(obj[[4]], "SpatialPixelsDataFrame"),
> sd5 = as(obj[[5]], "SpatialPixelsDataFrame"), sd6 = as(obj[[6]],
> "SpatialPixelsDataFrame")) return(out)
> }
>
> Any ideas?
> Thanks.
>
> Ruth
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



-- 
Pascal Oettli
Project Scientist
JAMSTEC
Yokohama, Japan


From bi.keithhelfrich at gmail.com  Wed Jun 18 04:47:58 2014
From: bi.keithhelfrich at gmail.com (Keith Helfrich)
Date: Tue, 17 Jun 2014 19:47:58 -0700
Subject: [R-sig-Geo] Spatio-Temporal Clustering
Message-ID: <CALU+=bGzdD8EQZou8ChNWPkThrfU_=LeMEfTvc-gZDBFb4B24Q@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140617/4504e253/attachment.pl>

From yasebaytok at gmail.com  Wed Jun 18 07:24:47 2014
From: yasebaytok at gmail.com (Yerguner)
Date: Tue, 17 Jun 2014 22:24:47 -0700 (PDT)
Subject: [R-sig-Geo] parallelize projectRaster()
Message-ID: <1403069087977-7586598.post@n2.nabble.com>

Hi All,

Below sample script do the job with a small multi-layered netcdf file (200M)
but it takes ~8 hrs to complete. I need to do the same process with a large
netcdf file(5.5 GB -that I cut this sample file from). I am wondering if
there is way to parallelize this process using beginCluster()-counting on
the build-in capacity of projectRaster()- OR using doParallel().

Thanks,
Yasemin

library(raster)
library(ncdf4)
library(rgdal)
rasterOptions(tmpdir=?/my_tmp_path/?)
ifile <- "cold2002_s1.nc"
colds1 <- brick(ifile)

> NAvalue(colds1)
[1] -9999
colds1[colds1 == -9999] <- NA 
> NAvalue(colds1)
[1] -1.7e+308

newproj <- "+proj=laea +lat_0=45 +lon_0=-100 +x_0=0 +y_0=0 +a=6370997
+b=6370997 +units=m +no_defs"
prjs1<- projectExtent(colds1, newproj) 
res(prjs1) <- c(231.6564, 231.6563)
prjs1 <- projectRaster(colds1, prjs1, method='ngb')
ifile2 <- "/mod2002.tif"
mod02 <- raster(ifile2)
submod02 <- crop(mod02,prj1)
bb <- extent(581811.7, 791924.1, 347931.5, 454493.4)
extent(submod02) <- bb
submod02f <- setExtent(submod02, bb, keepres=FALSE)
stackSelect(prj1,submod02f,filename="modcold02.tif",options="INTERLEAVE=BAND")



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/parallelize-projectRaster-tp7586598.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From hengl at spatial-analyst.net  Wed Jun 18 15:41:44 2014
From: hengl at spatial-analyst.net (Tomislav Hengl)
Date: Wed, 18 Jun 2014 15:41:44 +0200
Subject: [R-sig-Geo] Error creating GlobalSoilMap object (GSIF package)
In-Reply-To: <CAAcyNCzN9+DQ__baJUpoLbKeVB_H=zSCR01WViF4bSuTw89VUg@mail.gmail.com>
References: <CAOumgdDYNW_2_tLw9CzwusBS3b8EHRFVv1sLP8fpA8b14JBVUQ@mail.gmail.com>
	<CAAcyNCzN9+DQ__baJUpoLbKeVB_H=zSCR01WViF4bSuTw89VUg@mail.gmail.com>
Message-ID: <53A19718.9020209@spatial-analyst.net>


I would recommend switching to using "SoilGrids" class:

http://gsif.r-forge.r-project.org/SoilGrids.html

Hence, to produce objects of SoilGrids class you need to use:

## save to a "SoilGrids" object:
SNDMHT.gsm <- SoilGrids(obj=sd.ll, varname="SNDPPT",
              TimeSpan=list(begin="1999-02-01", end="2001-07-01"))

In which case TimeSpan needs to be a list with names "begin", "end".

To install the most recent version of the GSIF package (v0.4-2), please use:

install.packages("GSIF", repos="http://R-Forge.R-project.org")

For technical issues and problems with SoilGrids classes please also 
consider writing to the GSIF mailing list at:

https://groups.google.com/forum/#!forum/global-soil-information

HTH

T. Hengl

On 18-6-2014 3:12, Pascal Oettli wrote:
> Hello,
>
> According to the help file, TimeSpan is an "object of class "list";
> contains begin and end of the sampling period of class "POSIXct"". You
> need to provide a list of POSIXct dates, not a vector.
>
> HTH
> Pascal
>
> On Wed, Jun 18, 2014 at 8:56 AM, Ruth Gonzaga <gonzagarg at yahoo.com.br> wrote:
>> Dear All,
>> I have been trying to follow this tutorial on 3D modelling of soil with the
>> GSIF package:
>> http://gsif.isric.org/doku.php?id=wiki:tutorial_eberg
>>
>> (code on:
>> https://code.google.com/p/gsif/source/browse/trunk/eberg/tutorial_eberg.R)
>>
>> When I get to creating a GlobalSoilMap object (line 181):
>>
>> SNDMHT.gsm <- GlobalSoilMap(sd.ll, varname="SNDMHT", period=c("1999-02-01",
>> "2001-07-01"))
>>
>> I get an error saying:
>> Error in GlobalSoilMap(sd.ll, varname = "SNDMHT", period = c("1999-02-01",
>> : unused argument (period = c("1999-02-01", "2001-07-01"))
>>
>> I think the tutorial is quite old. I checked the help and then replaced
>> "period" for "TimeSpan". I now get the following error:
>>   Error in initialize(value, ...) :
>>    invalid name for slot of class "GlobalSoilMap": TimeSpan.begin
>>
>>
>> Here is some information on this function:
>>> GlobalSoilMap function (obj, varname, TimeSpan = list(begin = Sys.Date()
>> - 1, end = Sys.Date())) { if (!class(obj) == "list") { stop("Object of
>> class 'list' required") } out = new("GlobalSoilMap", varname = varname,
>> TimeSpan.begin = TimeSpan, sd1 = as(obj[[1]], "SpatialPixelsDataFrame"),
>> sd2 = as(obj[[2]], "SpatialPixelsDataFrame"), sd3 = as(obj[[3]],
>> "SpatialPixelsDataFrame"), sd4 = as(obj[[4]], "SpatialPixelsDataFrame"),
>> sd5 = as(obj[[5]], "SpatialPixelsDataFrame"), sd6 = as(obj[[6]],
>> "SpatialPixelsDataFrame")) return(out)
>> }
>>
>> Any ideas?
>> Thanks.
>>
>> Ruth
>>
>>          [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
>


From gonzagarg at yahoo.com.br  Wed Jun 18 16:55:09 2014
From: gonzagarg at yahoo.com.br (Ruth Gonzaga)
Date: Wed, 18 Jun 2014 15:55:09 +0100
Subject: [R-sig-Geo] Error creating GlobalSoilMap object (GSIF package)
In-Reply-To: <53A19718.9020209@spatial-analyst.net>
References: <CAOumgdDYNW_2_tLw9CzwusBS3b8EHRFVv1sLP8fpA8b14JBVUQ@mail.gmail.com>
	<CAAcyNCzN9+DQ__baJUpoLbKeVB_H=zSCR01WViF4bSuTw89VUg@mail.gmail.com>
	<53A19718.9020209@spatial-analyst.net>
Message-ID: <CAOumgdA4MgA83841WE9YnLOmse0viOyUH9z_t2SOs1exx31Eiw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140618/cf4a6dc4/attachment.pl>

From jgrn at illinois.edu  Wed Jun 18 17:03:25 2014
From: jgrn at illinois.edu (Jonathan Greenberg)
Date: Wed, 18 Jun 2014 10:03:25 -0500
Subject: [R-sig-Geo] parallelize projectRaster()
In-Reply-To: <1403069087977-7586598.post@n2.nabble.com>
References: <1403069087977-7586598.post@n2.nabble.com>
Message-ID: <CABG0rfv-6qMSt13TxiUT-ErGvFDBapzCKTQpYwnKJrk-neYH0w@mail.gmail.com>

Yerguner:

You might want to consider using gdalUtils
(http://cran.r-project.org/web/packages/gdalUtils/index.html) --
reprojecting via gdal warp is really fast and you can even get it
cranking on multiple processors.

--j

On Wed, Jun 18, 2014 at 12:24 AM, Yerguner <yasebaytok at gmail.com> wrote:
> Hi All,
>
> Below sample script do the job with a small multi-layered netcdf file (200M)
> but it takes ~8 hrs to complete. I need to do the same process with a large
> netcdf file(5.5 GB -that I cut this sample file from). I am wondering if
> there is way to parallelize this process using beginCluster()-counting on
> the build-in capacity of projectRaster()- OR using doParallel().
>
> Thanks,
> Yasemin
>
> library(raster)
> library(ncdf4)
> library(rgdal)
> rasterOptions(tmpdir=?/my_tmp_path/?)
> ifile <- "cold2002_s1.nc"
> colds1 <- brick(ifile)
>
>> NAvalue(colds1)
> [1] -9999
> colds1[colds1 == -9999] <- NA
>> NAvalue(colds1)
> [1] -1.7e+308
>
> newproj <- "+proj=laea +lat_0=45 +lon_0=-100 +x_0=0 +y_0=0 +a=6370997
> +b=6370997 +units=m +no_defs"
> prjs1<- projectExtent(colds1, newproj)
> res(prjs1) <- c(231.6564, 231.6563)
> prjs1 <- projectRaster(colds1, prjs1, method='ngb')
> ifile2 <- "/mod2002.tif"
> mod02 <- raster(ifile2)
> submod02 <- crop(mod02,prj1)
> bb <- extent(581811.7, 791924.1, 347931.5, 454493.4)
> extent(submod02) <- bb
> submod02f <- setExtent(submod02, bb, keepres=FALSE)
> stackSelect(prj1,submod02f,filename="modcold02.tif",options="INTERLEAVE=BAND")
>
>
>
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/parallelize-projectRaster-tp7586598.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



-- 
Jonathan A. Greenberg, PhD
Assistant Professor
Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
Department of Geography and Geographic Information Science
University of Illinois at Urbana-Champaign
259 Computing Applications Building, MC-150
605 East Springfield Avenue
Champaign, IL  61820-6371
Phone: 217-300-1924
http://www.geog.illinois.edu/~jgrn/
AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007


From eric.j.christeson at gmail.com  Wed Jun 18 17:05:32 2014
From: eric.j.christeson at gmail.com (ejc)
Date: Wed, 18 Jun 2014 10:05:32 -0500
Subject: [R-sig-Geo] Error creating GlobalSoilMap object (GSIF package)
In-Reply-To: <CAOumgdA4MgA83841WE9YnLOmse0viOyUH9z_t2SOs1exx31Eiw@mail.gmail.com>
References: <CAOumgdDYNW_2_tLw9CzwusBS3b8EHRFVv1sLP8fpA8b14JBVUQ@mail.gmail.com>
	<CAAcyNCzN9+DQ__baJUpoLbKeVB_H=zSCR01WViF4bSuTw89VUg@mail.gmail.com>
	<53A19718.9020209@spatial-analyst.net>
	<CAOumgdA4MgA83841WE9YnLOmse0viOyUH9z_t2SOs1exx31Eiw@mail.gmail.com>
Message-ID: <CAFUr27AzBpHKBF0k5oGyvwQhqRfjF=9NaB+9gHW4Ky=cj37Jjw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140618/8c8df7dd/attachment.pl>

From jgrn at illinois.edu  Wed Jun 18 17:19:09 2014
From: jgrn at illinois.edu (Jonathan Greenberg)
Date: Wed, 18 Jun 2014 10:19:09 -0500
Subject: [R-sig-Geo] Large NetCDF file problems
In-Reply-To: <CAAcGz98Ut0Nz8R_mkS5GFAEisp3O6ie9cygWDdp6exCxR+iRTw@mail.gmail.com>
References: <CALDV4smYfnno0Mwr0icKZZvyam_Znb4u9Tdk_QYRX755CnMPog@mail.gmail.com>
	<CAAcyNCwtbPyNf9xPoYgKFZLNMtKUJ=2QXJs55Oq9sfx3TXGOnw@mail.gmail.com>
	<CAAcGz9_adUdF+bv_wXA4G6jrAL2jF_gAXG0BgKgwBTNa_RXrrg@mail.gmail.com>
	<CALDV4skHbwJq38BcPuiV2W_mqN97xRjrF1=TZFMsB19jOBQSFQ@mail.gmail.com>
	<CALDV4skvFCnmrwRy+KBKcUXBt_vyeEt7FTqdY=AO8PDngt_p-w@mail.gmail.com>
	<alpine.LRH.2.03.1406112310020.26131@reclus.nhh.no>
	<CALDV4s=RLPPkibwHDmjOs_8uEzQ60ogHhbzG3BXF-PWCBQea8g@mail.gmail.com>
	<CAAcGz98Ut0Nz8R_mkS5GFAEisp3O6ie9cygWDdp6exCxR+iRTw@mail.gmail.com>
Message-ID: <CABG0rft8nC6UbkFZxT_b5=OD2Vb2mS_hNJ1cGsLZUS3BpyiUpg@mail.gmail.com>

Pablo:

Although probably not ideal, my general approach when dealing with
NetCDFs is first extract/convert them to a more friendly format --
gdalUtils should work on a Windows box to accomplish this (let me know
if it doesn't).

--j

On Thu, Jun 12, 2014 at 2:39 AM, Michael Sumner <mdsumner at gmail.com> wrote:
> My take is that it's an outdated NetCDF library being shipped with RNetCDF
> and ncdf. Here's a minimal reproducible example that behaves fine in 32-bit
> R, but not 64-bit. Reduce n to 2^14 and it works in either:
>
> n <- 2^15
>
> library(ncdf)
> d1 <- dim.def.ncdf("x", "count", 1:n)
> d2 <- dim.def.ncdf("y", "count", 1:n)
> v <- var.def.ncdf("v", "count", list(d1, d2), -1)
> nc <- create.ncdf("afile.nc", v)
>
>
> You won't see this in Linux installs because they will usually be using
> later versions of NetCDF. (It's a special CRAN service to build these
> packages on a Windows machine with NetCDF installed.)
>
> I am interested in learning more about compiling for myself in Windows, but
> it's just quite painful.
>
> HTH
>
>
> On Thu, Jun 12, 2014 at 10:45 AM, Pablo Alfaro <palfaro at motionsoft.com.uy>
> wrote:
>
>> So you think this is not an R problem then?
>> The executable failing the assertion is rsession.exe
>>
>>
>> 2014-06-11 18:14 GMT-03:00 Roger Bivand <Roger.Bivand at nhh.no>:
>>
>> I suggest that you put together a complete reproducible example with
>>> access to the file on a server, and send this to the maintainers of ncdf
>>> and RNetCDF. This looks either like an issue in compiler flags, or an issue
>>> in the code of the external library used.
>>>
>>> Roger
>>>
>>>
>>> On Wed, 11 Jun 2014, Pablo Alfaro wrote:
>>>
>>>  Hmm, just tried using RNetCDF (v 1.6.2-2) and it has the same problem.
>>>>
>>>> When using
>>>>
>>>> require('RNetCDF')
>>>> nc <- open.nc('C:/testsMCH/test/wrfout_d02_2014-06-09_00%3A00%3A00')
>>>> var.get.nc(nc, "T2", start=c(1, 1, 1), count=c(NA, NA, NA))
>>>>
>>>> I get the same problem on 64bit R, no problem on 32bits.
>>>>
>>>> Seems like a problem with the version of posixio.c used in 64 bit R. Just
>>>> found a version of posixio.c on the web (
>>>> http://www.nco.ncep.noaa.gov/pmb/codes/nwprod/util/sorc/
>>>> ncdump.fd/libsrc/posixio.c)
>>>> which has the assertion on line 417.
>>>>
>>>> assert(offset >= 0);
>>>>
>>>> offset is a variable of type off_t which is defined in <sys/types.h> and
>>>> apparently requires that you enable Large File Support on the compiler
>>>> command line to be a 64 bit integer.
>>>> Can it be that the 32 bit version of R is using Large File Support but
>>>> the
>>>> 64 bit version is not?
>>>>
>>>> Best
>>>> Pablo
>>>>
>>>>
>>>>
>>>>
>>>> 2014-06-11 15:07 GMT-03:00 Pablo Alfaro <palfaro at motionsoft.com.uy>:
>>>>
>>>>  Hi Michael, Pascal, thank you both for your replies.
>>>>>
>>>>> Yeah, Sorry, I'm using R 3.0.3 64 (or 32 for the working version) bit,
>>>>> on
>>>>> Windows 7 x64 and the NetCDF library is ncdf (not ncdf4) version 1.6.6,
>>>>> the
>>>>> last available version.
>>>>>
>>>>> I need it to run on Windows since the servers I run the code on are
>>>>> Windows.
>>>>>
>>>>> I tried downloading and installing the package you mention Michael but
>>>>> when loading it, it says the x64 architecture is not supported (the
>>>>> author
>>>>> mentions it in the site as well). The thing is that ncdf works on x86
>>>>> so it
>>>>> leaves me with the same options.
>>>>>
>>>>> RNetCDF seems to use NetCDF v3, but maybe it doesn't have this problem.
>>>>> I
>>>>> wil try that and see if it helps.
>>>>>
>>>>> The assertion on the error complains an offset which isn't >= 0. If I
>>>>> were
>>>>> to take a guess, that offset is a 32 bit signed integer and that's why
>>>>> it
>>>>> breaks only with large files (bigger than 2^31 - 1 bytes). But I can't
>>>>> tell
>>>>> for sure. Also it's weird that it works on 32 bits.
>>>>>
>>>>> Best
>>>>> Pablo
>>>>>
>>>>>
>>>>> 2014-06-10 23:13 GMT-03:00 Michael Sumner <mdsumner at gmail.com>:
>>>>>
>>>>>
>>>>>
>>>>>>
>>>>>> On Wed, Jun 11, 2014 at 11:49 AM, Pascal Oettli <kridox at ymail.com>
>>>>>> wrote:
>>>>>>
>>>>>>  Hello,
>>>>>>>
>>>>>>> Do you get the same error if you run your code out of Rstudio?
>>>>>>>
>>>>>>> However, another approach would be to open your NetCDF file with
>>>>>>> 'brick' function from the raster package.
>>>>>>>
>>>>>>>
>>>>>>
>>>>>> I don't think either of these will help, raster simply runs ncdf (or
>>>>>> preferably ncdf4) to do the file read. You might find it easier to
>>>>>> move to
>>>>>> ncdf4 if you can, but potentially the stuff I write below is just an
>>>>>> unwelcome aside. I have seen a similar error in a file I've tried to
>>>>>> use,
>>>>>> so I'll have another look at that and see if I can isolate where the
>>>>>> problem lies. At minimum we really need to know the version of the
>>>>>> NetCDF
>>>>>> library in use and perhaps details of how it was compiled so at
>>>>>> minimum you
>>>>>> should provide the ncdf package version as well as R's.
>>>>>>
>>>>>> It's possible to install ncdf4 on Windows, but it's not supported (no
>>>>>> binary .zip on CRAN) but you can do it yourself (again not supported,
>>>>>> and
>>>>>> the archive here is not updated):
>>>>>> http://cirrus.ucsd.edu/~pierce/ncdf/
>>>>>>
>>>>>> It's much more generally available to do this on Linux, though there's
>>>>>> always bumps in the road.
>>>>>>
>>>>>> RNetCDF is actively updated on CRAN and is another option to see if the
>>>>>> read is supported (I don't know how to find out what version of the
>>>>>> library
>>>>>> was used for the CRAN Windows binary, but presambly it is < 4.0).
>>>>>>
>>>>>> Cheers, Mike.
>>>>>>
>>>>>>
>>>>>>
>>>>>>  Regards,
>>>>>>> Pascal
>>>>>>>
>>>>>>> On Wed, Jun 11, 2014 at 9:10 AM, Pablo Alfaro <
>>>>>>> palfaro at motionsoft.com.uy>
>>>>>>> wrote:
>>>>>>>
>>>>>>>> Hi, I'm having trouble opening a large netcdf file (2.45 GB) with the
>>>>>>>> following code on R 3.0.3 64 bit
>>>>>>>>
>>>>>>>> require('ncdf')
>>>>>>>> nc <- open.ncdf('C:/testsMCH/test/wrfout_d02_2014-06-09_00%3A00%
>>>>>>>> 3A00')
>>>>>>>> get.var.ncdf(nc, 'T2', start=c(1, 1, 1), count=c(-1, -1, -1))
>>>>>>>>
>>>>>>>> I get this error:
>>>>>>>> Assertion failed!
>>>>>>>>
>>>>>>>> Program: C:\Program Files\RStudio\bin\x64\rsession.exe
>>>>>>>> File: posixio.c, Line 417
>>>>>>>>
>>>>>>>> Expression: offset >= 0
>>>>>>>>
>>>>>>>> This application has requested the Runtime to terminate it in an
>>>>>>>>
>>>>>>> unusual
>>>>>>>
>>>>>>>> way.
>>>>>>>> Please contact the application's support team for more information.
>>>>>>>>
>>>>>>>>
>>>>>>>> In R 32 bit there are no problems.
>>>>>>>>
>>>>>>>> It is the same problem as reported here:
>>>>>>>>
>>>>>>>>  http://r.789695.n4.nabble.com/Problems-with-Raster-and-clim-
>>>>>>> pact-packages-with-large-netcdf-files-2-7G-in-x64-bit-
>>>>>>> R-td4119638.html#a4691956
>>>>>>>
>>>>>>>>
>>>>>>>> Does anyone have any clue as to why this may be?
>>>>>>>> I can upload the file on an FTP server but it'll take me a while.
>>>>>>>>
>>>>>>>> Thanks in advance!
>>>>>>>> Pablo
>>>>>>>>
>>>>>>>> --
>>>>>>>> Ing. Pablo Alfaro Pi??eyro
>>>>>>>>
>>>>>>>> MotionSoft Consulting S.R.L.
>>>>>>>> Tel: 095 938 487
>>>>>>>>
>>>>>>>>         [[alternative HTML version deleted]]
>>>>>>>>
>>>>>>>>
>>>>>>>> _______________________________________________
>>>>>>>> R-sig-Geo mailing list
>>>>>>>> R-sig-Geo at r-project.org
>>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>>>>
>>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>> --
>>>>>>> Pascal Oettli
>>>>>>> Project Scientist
>>>>>>> JAMSTEC
>>>>>>> Yokohama, Japan
>>>>>>>
>>>>>>> _______________________________________________
>>>>>>> R-sig-Geo mailing list
>>>>>>> R-sig-Geo at r-project.org
>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>>>
>>>>>>>
>>>>>>
>>>>>>
>>>>>> --
>>>>>> Michael Sumner
>>>>>> Software and Database Engineer
>>>>>> Australian Antarctic Division
>>>>>> Hobart, Australia
>>>>>> e-mail: mdsumner at gmail.com
>>>>>>
>>>>>>
>>>>>
>>>>>
>>>>> --
>>>>> Ing. Pablo Alfaro Pi??eyro
>>>>>
>>>>> MotionSoft Consulting S.R.L.
>>>>> Tel: 095 938 487
>>>>>
>>>>>
>>>>
>>>>
>>>>
>>>>
>>> --
>>> Roger Bivand
>>> Department of Economics, Norwegian School of Economics,
>>> Helleveien 30, N-5045 Bergen, Norway.
>>> voice: +47 55 95 93 55; fax +47 55 95 91 00
>>> e-mail: Roger.Bivand at nhh.no
>>>
>>>
>>
>>
>> --
>> Ing. Pablo Alfaro Pi?eyro
>>
>> MotionSoft Consulting S.R.L.
>> Tel: 095 938 487
>>
>>
>> 2014-06-11 18:14 GMT-03:00 Roger Bivand <Roger.Bivand at nhh.no>:
>>
>> I suggest that you put together a complete reproducible example with
>>> access to the file on a server, and send this to the maintainers of ncdf
>>> and RNetCDF. This looks either like an issue in compiler flags, or an issue
>>> in the code of the external library used.
>>>
>>> Roger
>>>
>>>
>>> On Wed, 11 Jun 2014, Pablo Alfaro wrote:
>>>
>>>  Hmm, just tried using RNetCDF (v 1.6.2-2) and it has the same problem.
>>>>
>>>> When using
>>>>
>>>> require('RNetCDF')
>>>> nc <- open.nc('C:/testsMCH/test/wrfout_d02_2014-06-09_00%3A00%3A00')
>>>> var.get.nc(nc, "T2", start=c(1, 1, 1), count=c(NA, NA, NA))
>>>>
>>>> I get the same problem on 64bit R, no problem on 32bits.
>>>>
>>>> Seems like a problem with the version of posixio.c used in 64 bit R. Just
>>>> found a version of posixio.c on the web (
>>>> http://www.nco.ncep.noaa.gov/pmb/codes/nwprod/util/sorc/
>>>> ncdump.fd/libsrc/posixio.c)
>>>> which has the assertion on line 417.
>>>>
>>>> assert(offset >= 0);
>>>>
>>>> offset is a variable of type off_t which is defined in <sys/types.h> and
>>>> apparently requires that you enable Large File Support on the compiler
>>>> command line to be a 64 bit integer.
>>>> Can it be that the 32 bit version of R is using Large File Support but
>>>> the
>>>> 64 bit version is not?
>>>>
>>>> Best
>>>> Pablo
>>>>
>>>>
>>>>
>>>>
>>>> 2014-06-11 15:07 GMT-03:00 Pablo Alfaro <palfaro at motionsoft.com.uy>:
>>>>
>>>>  Hi Michael, Pascal, thank you both for your replies.
>>>>>
>>>>> Yeah, Sorry, I'm using R 3.0.3 64 (or 32 for the working version) bit,
>>>>> on
>>>>> Windows 7 x64 and the NetCDF library is ncdf (not ncdf4) version 1.6.6,
>>>>> the
>>>>> last available version.
>>>>>
>>>>> I need it to run on Windows since the servers I run the code on are
>>>>> Windows.
>>>>>
>>>>> I tried downloading and installing the package you mention Michael but
>>>>> when loading it, it says the x64 architecture is not supported (the
>>>>> author
>>>>> mentions it in the site as well). The thing is that ncdf works on x86
>>>>> so it
>>>>> leaves me with the same options.
>>>>>
>>>>> RNetCDF seems to use NetCDF v3, but maybe it doesn't have this problem.
>>>>> I
>>>>> wil try that and see if it helps.
>>>>>
>>>>> The assertion on the error complains an offset which isn't >= 0. If I
>>>>> were
>>>>> to take a guess, that offset is a 32 bit signed integer and that's why
>>>>> it
>>>>> breaks only with large files (bigger than 2^31 - 1 bytes). But I can't
>>>>> tell
>>>>> for sure. Also it's weird that it works on 32 bits.
>>>>>
>>>>> Best
>>>>> Pablo
>>>>>
>>>>>
>>>>> 2014-06-10 23:13 GMT-03:00 Michael Sumner <mdsumner at gmail.com>:
>>>>>
>>>>>
>>>>>
>>>>>>
>>>>>> On Wed, Jun 11, 2014 at 11:49 AM, Pascal Oettli <kridox at ymail.com>
>>>>>> wrote:
>>>>>>
>>>>>>  Hello,
>>>>>>>
>>>>>>> Do you get the same error if you run your code out of Rstudio?
>>>>>>>
>>>>>>> However, another approach would be to open your NetCDF file with
>>>>>>> 'brick' function from the raster package.
>>>>>>>
>>>>>>>
>>>>>>
>>>>>> I don't think either of these will help, raster simply runs ncdf (or
>>>>>> preferably ncdf4) to do the file read. You might find it easier to
>>>>>> move to
>>>>>> ncdf4 if you can, but potentially the stuff I write below is just an
>>>>>> unwelcome aside. I have seen a similar error in a file I've tried to
>>>>>> use,
>>>>>> so I'll have another look at that and see if I can isolate where the
>>>>>> problem lies. At minimum we really need to know the version of the
>>>>>> NetCDF
>>>>>> library in use and perhaps details of how it was compiled so at
>>>>>> minimum you
>>>>>> should provide the ncdf package version as well as R's.
>>>>>>
>>>>>> It's possible to install ncdf4 on Windows, but it's not supported (no
>>>>>> binary .zip on CRAN) but you can do it yourself (again not supported,
>>>>>> and
>>>>>> the archive here is not updated):
>>>>>> http://cirrus.ucsd.edu/~pierce/ncdf/
>>>>>>
>>>>>> It's much more generally available to do this on Linux, though there's
>>>>>> always bumps in the road.
>>>>>>
>>>>>> RNetCDF is actively updated on CRAN and is another option to see if the
>>>>>> read is supported (I don't know how to find out what version of the
>>>>>> library
>>>>>> was used for the CRAN Windows binary, but presambly it is < 4.0).
>>>>>>
>>>>>> Cheers, Mike.
>>>>>>
>>>>>>
>>>>>>
>>>>>>  Regards,
>>>>>>> Pascal
>>>>>>>
>>>>>>> On Wed, Jun 11, 2014 at 9:10 AM, Pablo Alfaro <
>>>>>>> palfaro at motionsoft.com.uy>
>>>>>>> wrote:
>>>>>>>
>>>>>>>> Hi, I'm having trouble opening a large netcdf file (2.45 GB) with the
>>>>>>>> following code on R 3.0.3 64 bit
>>>>>>>>
>>>>>>>> require('ncdf')
>>>>>>>> nc <- open.ncdf('C:/testsMCH/test/wrfout_d02_2014-06-09_00%3A00%
>>>>>>>> 3A00')
>>>>>>>> get.var.ncdf(nc, 'T2', start=c(1, 1, 1), count=c(-1, -1, -1))
>>>>>>>>
>>>>>>>> I get this error:
>>>>>>>> Assertion failed!
>>>>>>>>
>>>>>>>> Program: C:\Program Files\RStudio\bin\x64\rsession.exe
>>>>>>>> File: posixio.c, Line 417
>>>>>>>>
>>>>>>>> Expression: offset >= 0
>>>>>>>>
>>>>>>>> This application has requested the Runtime to terminate it in an
>>>>>>>>
>>>>>>> unusual
>>>>>>>
>>>>>>>> way.
>>>>>>>> Please contact the application's support team for more information.
>>>>>>>>
>>>>>>>>
>>>>>>>> In R 32 bit there are no problems.
>>>>>>>>
>>>>>>>> It is the same problem as reported here:
>>>>>>>>
>>>>>>>>  http://r.789695.n4.nabble.com/Problems-with-Raster-and-clim-
>>>>>>> pact-packages-with-large-netcdf-files-2-7G-in-x64-bit-
>>>>>>> R-td4119638.html#a4691956
>>>>>>>
>>>>>>>>
>>>>>>>> Does anyone have any clue as to why this may be?
>>>>>>>> I can upload the file on an FTP server but it'll take me a while.
>>>>>>>>
>>>>>>>> Thanks in advance!
>>>>>>>> Pablo
>>>>>>>>
>>>>>>>> --
>>>>>>>> Ing. Pablo Alfaro Pi??eyro
>>>>>>>>
>>>>>>>> MotionSoft Consulting S.R.L.
>>>>>>>> Tel: 095 938 487
>>>>>>>>
>>>>>>>>         [[alternative HTML version deleted]]
>>>>>>>>
>>>>>>>>
>>>>>>>> _______________________________________________
>>>>>>>> R-sig-Geo mailing list
>>>>>>>> R-sig-Geo at r-project.org
>>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>>>>
>>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>> --
>>>>>>> Pascal Oettli
>>>>>>> Project Scientist
>>>>>>> JAMSTEC
>>>>>>> Yokohama, Japan
>>>>>>>
>>>>>>> _______________________________________________
>>>>>>> R-sig-Geo mailing list
>>>>>>> R-sig-Geo at r-project.org
>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>>>
>>>>>>>
>>>>>>
>>>>>>
>>>>>> --
>>>>>> Michael Sumner
>>>>>> Software and Database Engineer
>>>>>> Australian Antarctic Division
>>>>>> Hobart, Australia
>>>>>> e-mail: mdsumner at gmail.com
>>>>>>
>>>>>>
>>>>>
>>>>>
>>>>> --
>>>>> Ing. Pablo Alfaro Pi??eyro
>>>>>
>>>>> MotionSoft Consulting S.R.L.
>>>>> Tel: 095 938 487
>>>>>
>>>>>
>>>>
>>>>
>>>>
>>>>
>>> --
>>> Roger Bivand
>>> Department of Economics, Norwegian School of Economics,
>>> Helleveien 30, N-5045 Bergen, Norway.
>>> voice: +47 55 95 93 55; fax +47 55 95 91 00
>>> e-mail: Roger.Bivand at nhh.no
>>>
>>>
>>
>>
>> --
>> Ing. Pablo Alfaro Pi?eyro
>>
>> MotionSoft Consulting S.R.L.
>> Tel: 095 938 487
>>
>
>
>
> --
> Michael Sumner
> Software and Database Engineer
> Australian Antarctic Division
> Hobart, Australia
> e-mail: mdsumner at gmail.com
>
>         [[alternative HTML version deleted]]
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



-- 
Jonathan A. Greenberg, PhD
Assistant Professor
Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
Department of Geography and Geographic Information Science
University of Illinois at Urbana-Champaign
259 Computing Applications Building, MC-150
605 East Springfield Avenue
Champaign, IL  61820-6371
Phone: 217-300-1924
http://www.geog.illinois.edu/~jgrn/
AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007


From yasebaytok at gmail.com  Wed Jun 18 17:44:09 2014
From: yasebaytok at gmail.com (Yerguner)
Date: Wed, 18 Jun 2014 08:44:09 -0700 (PDT)
Subject: [R-sig-Geo] parallelize projectRaster()
In-Reply-To: <CABG0rfv-6qMSt13TxiUT-ErGvFDBapzCKTQpYwnKJrk-neYH0w@mail.gmail.com>
References: <1403069087977-7586598.post@n2.nabble.com>
	<CABG0rfv-6qMSt13TxiUT-ErGvFDBapzCKTQpYwnKJrk-neYH0w@mail.gmail.com>
Message-ID: <1403106249076-7586604.post@n2.nabble.com>

Hi Jonathan,

Thanks a lot for your reply. I've already tried your gdalUtils() package but
it creates a empty .tif file (all zero values) and continues to run several
(>14) hrs. May be I'm not using the function correctly:

library(raster)
rasterOptions(tmpdir="/pegasus/yb3/modvar2000/")
library(ncdf4)
library(rgdal)
library(gdalUtils)
gdal_setInstallation()
ifile2 <- "cold00_s2.nc"
newproj <- "+proj=laea +lat_0=45 +lon_0=-100 +x_0=0 +y_0=0 +a=6370997
+b=6370997 +units=m +no_defs"
gdalwarp(srcfile= ifile2, dstfile= "ohey_file.tif", t_srs= newproj,
output_Raster=TRUE, multi=TRUE, tr=c(231.6564, 231.6563),r="near")
class       : RasterBrick 
dimensions  : 2049, 4417, 9050433, 365  (nrow, ncol, ncell, nlayers)
resolution  : 231.6564, 231.6563  (x, y)
extent      : -1075057, -51831.17, 241865.9, 716529.7  (xmin, xmax, ymin,
ymax)
coord. ref. : +proj=laea +lat_0=45 +lon_0=-100 +x_0=0 +y_0=0 +a=6370997
+b=6370997 +units=m +no_defs 
data source : /pegasus/yb3/daymet2000/ohey_file.tif 
names       : ohey_file.1, ohey_file.2, ohey_file.3, ohey_file.4,
ohey_file.5, ohey_file.6, ohey_file.7, ohey_file.8, ohey_file.9,
ohey_file.10, ohey_file.11, ohey_file.12, ohey_file.13, ohey_file.14,
ohey_file.15, ... 

Thanks,
Yasemin





--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/parallelize-projectRaster-tp7586598p7586604.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From jgrn at illinois.edu  Wed Jun 18 18:15:29 2014
From: jgrn at illinois.edu (Jonathan Greenberg)
Date: Wed, 18 Jun 2014 11:15:29 -0500
Subject: [R-sig-Geo] parallelize projectRaster()
In-Reply-To: <1403106249076-7586604.post@n2.nabble.com>
References: <1403069087977-7586598.post@n2.nabble.com>
	<CABG0rfv-6qMSt13TxiUT-ErGvFDBapzCKTQpYwnKJrk-neYH0w@mail.gmail.com>
	<1403106249076-7586604.post@n2.nabble.com>
Message-ID: <CABG0rfuK35nb4Jx57QdUYEaJhYenrGe4ureXBoPoHzPHxOWHog@mail.gmail.com>

Yerguner:

Have you tried first converting the NetCDF to another "friendlier"
raster format (netcdf isn't really a raster format, keep in mind)--j
first via gdal_translate?  Then you can follow up with a gdalwarp.
Keep in mind gdalUtils is merely a wrapper for the GDAL Utilities --
from their documentation on NetCDF
(http://www.gdal.org/frmt_netcdf.html):

"If the file contains only one netCDF array which appears to be an
image, it may be accessed directly, but if the file contains multiple
images it may be necessary to import the file via a two step process.

The first step is to get a report of the components images (dataset)
in the file using gdalinfo, and then to import the desired images
using gdal_translate. The gdalinfo utility lists all multidimensional
subdatasets from the input netCDF file.

The name of individual images are assigned to the SUBDATASET_n_NAME
metadata item. The description for each image is found in the
SUBDATASET_n_DESC metadata item. For netCDF images will follow this
format: NETCDF:filename:variable_name"



On Wed, Jun 18, 2014 at 10:44 AM, Yerguner <yasebaytok at gmail.com> wrote:
> Hi Jonathan,
>
> Thanks a lot for your reply. I've already tried your gdalUtils() package but
> it creates a empty .tif file (all zero values) and continues to run several
> (>14) hrs. May be I'm not using the function correctly:
>
> library(raster)
> rasterOptions(tmpdir="/pegasus/yb3/modvar2000/")
> library(ncdf4)
> library(rgdal)
> library(gdalUtils)
> gdal_setInstallation()
> ifile2 <- "cold00_s2.nc"
> newproj <- "+proj=laea +lat_0=45 +lon_0=-100 +x_0=0 +y_0=0 +a=6370997
> +b=6370997 +units=m +no_defs"
> gdalwarp(srcfile= ifile2, dstfile= "ohey_file.tif", t_srs= newproj,
> output_Raster=TRUE, multi=TRUE, tr=c(231.6564, 231.6563),r="near")
> class       : RasterBrick
> dimensions  : 2049, 4417, 9050433, 365  (nrow, ncol, ncell, nlayers)
> resolution  : 231.6564, 231.6563  (x, y)
> extent      : -1075057, -51831.17, 241865.9, 716529.7  (xmin, xmax, ymin,
> ymax)
> coord. ref. : +proj=laea +lat_0=45 +lon_0=-100 +x_0=0 +y_0=0 +a=6370997
> +b=6370997 +units=m +no_defs
> data source : /pegasus/yb3/daymet2000/ohey_file.tif
> names       : ohey_file.1, ohey_file.2, ohey_file.3, ohey_file.4,
> ohey_file.5, ohey_file.6, ohey_file.7, ohey_file.8, ohey_file.9,
> ohey_file.10, ohey_file.11, ohey_file.12, ohey_file.13, ohey_file.14,
> ohey_file.15, ...
>
> Thanks,
> Yasemin
>
>
>
>
>
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/parallelize-projectRaster-tp7586598p7586604.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



-- 
Jonathan A. Greenberg, PhD
Assistant Professor
Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
Department of Geography and Geographic Information Science
University of Illinois at Urbana-Champaign
259 Computing Applications Building, MC-150
605 East Springfield Avenue
Champaign, IL  61820-6371
Phone: 217-300-1924
http://www.geog.illinois.edu/~jgrn/
AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007


From basille.web at ase-research.org  Wed Jun 18 19:49:06 2014
From: basille.web at ase-research.org (Mathieu Basille)
Date: Wed, 18 Jun 2014 13:49:06 -0400
Subject: [R-sig-Geo] Ecological Niche Factor Analysis
In-Reply-To: <b5e67cb38dd58feb8240d7bf30db744c.squirrel@webmail.pitt.edu>
References: <b5e67cb38dd58feb8240d7bf30db744c.squirrel@webmail.pitt.edu>
Message-ID: <146b012e735.-9204350249694774088.-2603564756497648759@ase-research.org>

Dear Alannie, 

Sorry for the very late answer. Sometimes even projections that should be the same are not, I guess due to the way R stores them. 'count.points' actually checks for 

identical(proj4string(corysp), proj4string(bio))

So you can simply check:

proj4string(corysp)

and 

proj4string(bio)

There might be a tiny difference that prevents the function to work. If this is the case, but you are sure that the two data sets are properly projected in the same projection, you can simply use (you'll get a warning):

proj4string(corysp) <- proj4string(bio)

and run 'count.points' again.

As for the histograms, I think you're trying to use 'hist.kasc' from the legacy adehabitat. And, as its name suggests, this only works --

~$ whoami 
Mathieu Basille, PhD 
 
~$ locate --details 
University of Florida \\ 
Fort Lauderdale Research and Education Center 
(+1) 954-577-6314 
http://ase-research.org/basille 
 
~$ fortune 
? Le tout est de tout dire, et je manque de mots 
Et je manque de temps, et je manque d&#39;audace. ? 
  -- Paul ?luardfor kascs, not SpatialPixelsDataFrames (the function is actually not available anymore in the new adehabitatMA). Try to use any column of the SPDF as a regular data frame column, with 'hist' and 'density' if that's what you're looking for.

Hope this helps,
Mathieu.


---- Le ven., 30 mai 2014 16:02:24 -0400 alannie  a ?crit ---- 

>Oh, on that last part with the conversion, I actually used
>
>coordsp<-SpatialPoints(corysp, proj4string=CRS"+proj=longlat
>+datum=WGS84")) , bbox = NULL)
>
>Sorry for that mistake. Either way, it does not work.
>
>
>> Thanks Mathieu!
>>
>> This has gone very well so far, but I cannot seem to get the XY location
>> data and the bioclim maps in the same proj4string.
>> CODE: pr <- slot(count.points(corysp, bio), "data")[,1]
>> Error in count.points(corysp, bio) : different proj4string in w and xy
>>
>> This seems strange since everything in the same coordinate system WGS 1984
>> from previous analysis.
>>
>> class(corysp)
>> [1] "SpatialPointsDataFrame"
>> attr(,"package")
>> [1] "sp"
>>
>> summary(corysp)
>> Object of class SpatialPointsDataFrame
>> Coordinates:
>> min max
>> coords.x1 -124.1643 -119.7514
>> coords.x2 37.0000 40.8030
>> Is projected: NA
>> proj4string : [NA]
>> Number of points: 44
>> Data attributes:
>> taxon_name Y_latitude X_longitud
>> Collinsia corymbosa:44 Min. :37.00 Min. :-124.2
>> 1st Qu.:37.98 1st Qu.:-123.8
>> Median :39.46 Median :-123.8
>> Mean :38.99 Mean :-123.3
>> 3rd Qu.:39.50 3rd Qu.:-122.6
>> Max. :40.80 Max. :-119.8
>>
>>
>> I have tried to change the coordinate system using
>> CODE:
>>
>> coordsp<-SpatialPoints(corysp, proj4string=CRS(as.character(NA)), bbox =
>> NULL)
>>
>> But get the same issue:
>>
>> pr <- slot(count.points(coordsp, bio), "data")[,1]
>> Error in count.points(coordsp, bio) : different proj4string in w and xy
>>
>>
>> Also, I still cannot may histograms using the bioclim map data.
>>
>>
>> Thanks so much for your assistance! You have helped me so much!
>>
>>
>> Alannie
>>
>>
>>
>>
>>>
>>>
>>> Dear Alannie,
>>>
>>> I think your problem comes from the handling of rasters as sp classes,
>>> not
>>> from the actual ENFA methods. You should try to import the rasters
>>> properly first, and check that they are actually valid
>>> 'SpatialPixelsDataFrame's. For instance, using rgdal:
>>>
>>> library(rgdal)
>>> bio1 <- readGDAL("bio1.asc")
>>> bio2 <- readGDAL("bio2.asc")
>>> bio3 <- readGDAL("bio3.asc")
>>> bio <- cbind(bio1, bio2, bio3)
>>> names(bio) <- c("bio1", "bio2", "bio3")
>>> summary(bio)
>>> image(bio)
>>> spplot(bio)
>>> ...
>>>
>>> The rest of the analysis should work as expected.
>>> Mathieu.
>>>
>>>
>>> --
>>>
>>> ~$ whoami
>>> Mathieu Basille, PhD
>>>
>>> ~$ locate --details
>>> University of Florida \
>>> Fort Lauderdale Research and Education Center
>>> (+1) 954-577-6314
>>> http://ase-research.org/basille
>>>
>>> ~$ fortune
>>> ?? Le tout est de tout dire, et je manque de mots
>>> Et je manque de temps, et je manque d&#39;audace. ??
>>> -- Paul ??luard
>>> ---- Le mar., 27 mai 2014 21:56:19 -0400 alannie a ??crit ----
>>>
>>>>Hi,
>>>>
>>>>I have been using ENFA in R to perform some analyses.
>>>>
>>>>I have gotten the procedure to work before, however I can't seem to
>>>>replicate the code. This is very important since I would like to do this
>>>>analysis for a wide range of species.
>>>>
>>>>Please advise of best practice for implementing the procedure.
>>>>
>>>>Going from the very beginnings of the procedure:
>>>>
>>>>1) read in .csv formatted locations data for the interested species
>>>>
>>>> /code/ species1<-read.csv("species1.csv",head=T, sep=",")
>>>> species1coords<-SpatialPoints(species1)
>>>>
>>>>2) read in raster files (I am using the bioclim variables converted into
>>>>ASCII)
>>>>
>>>> /code/ b1<-read.asc("bio1.asc")
>>>> b2<-read.asc("bio2.asc")
>>>> b3<-read.asc("bio3.asc")
>>>>
>>>>3) combine the maps into a single data frame and add slots to the
>>>> individual
>>>>maps
>>>> /code/ map<-cbind(b1 at data,b2 at data,b3 at data) *this form does not allow me
>>>>to visualize the maps using image(map)
>>>> map2<-cbind(b1,b2,b3) *this form, with out the slots,
>>>>does allow me to visualize the maps using image(map2)
>>>>
>>>>4) following this step is making a histogram: hist(map, type = "l") I
>>>>usually cannot make one, but when I am able to make a histogram, the
>>>>variables show up on a single graph with the warning:
>>>>
>>>>Warning messages:
>>>>1: In title(main = main, sub = sub, xlab = xlab, ylab = ylab, ...) :
>>>> graphical parameter "type" is obsolete
>>>>2: In axis(1, ...) : graphical parameter "type" is obsolete
>>>>3: In axis(2, ...) : graphical parameter "type" is obsolete
>>>>
>>>>4) The tab:
>>>> /code/ tab <- slot(map, "data"), I get this warning:
>>>>Error in slot(map, "data") :
>>>> cannot get a slot ("data") from an object of type "double"
>>>>
>>>>Sometimes I get other warnings such as 'x is not numeric' or something
>>>> about
>>>>NA values.
>>>>
>>>>I will spare the rest of the issues I face.
>>>>
>>>>I believe the origins of these issues are the starting data inputs. I
>>>> would
>>>>appreciate any assistance in modifying the data inputs. I have tried to
>>>> look
>>>>through other resources, however I have not found anything to help with
>>>> my
>>>>specific issues.
>>>>
>>>>If I can get this worked out, I also hope to post some code somewhere to
>>>>aide others in their SDM adventures.
>>>>
>>>>Thank you for reading!
>>>>
>>>>A
>>>>
>>>>
>>>>
>>>>
>>>>
>>>>
>>>>
>>>>
>>>>
>>>>
>>>>--
>>>>View this message in context:
>>>> http://r-sig-geo.2731867.n2.nabble.com/Ecological-Niche-Factor-Analysis-tp7586516.html
>>>>Sent from the R-sig-geo mailing list archive at Nabble.com.
>>>>
>>>>_______________________________________________
>>>>R-sig-Geo mailing list
>>>>R-sig-Geo at r-project.org
>>>>https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>
>>> --
>>>
>>> ~$ whoami
>>> Mathieu Basille, PhD
>>>
>>> ~$ locate --details
>>> University of Florida \
>>> Fort Lauderdale Research and Education Center
>>> (+1) 954-577-6314
>>> http://ase-research.org/basille
>>>
>>> ~$ fortune
>>> ?? Le tout est de tout dire, et je manque de mots
>>> Et je manque de temps, et je manque d'audace. ??
>>> -- Paul ??luard
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>>
>>>
>>>
>>> _______________________________________________
>>> If you reply to this email, your message will be added to the discussion
>>> below:
>>> http://r-sig-geo.2731867.n2.nabble.com/Ecological-Niche-Factor-Analysis-tp7586516p7586523.html
>>> To start a new topic under R-sig-geo, email
>>> ml-node+s2731867n2731867h11 at n2.nabble.com
>>> To unsubscribe from Ecological Niche Factor Analysis, visit
>>> http://r-sig-geo.2731867.n2.nabble.com/template/NamlServlet.jtp?macro=unsubscribe_by_code&node=7586516&code=YWdnMThAcGl0dC5lZHV8NzU4NjUxNnwtMjAxOTYzNDk0MQ==
>>
>>
>>
>
>
>
>
>
>
>
>--
>View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Re-ReA-Ecological-Niche-Factor-Analysis-tp7586536.html
>Sent from the R-sig-geo mailing list archive at Nabble.com.
>
>_______________________________________________
>R-sig-Geo mailing list
>R-sig-Geo at r-project.org
>https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

--

~$ whoami 
Mathieu Basille, PhD 
 
~$ locate --details 
University of Florida \\ 
Fort Lauderdale Research and Education Center 
(+1) 954-577-6314 
http://ase-research.org/basille 
 
~$ fortune 
? Le tout est de tout dire, et je manque de mots 
Et je manque de temps, et je manque d'audace. ? 
 -- Paul ?luard


From gonzagarg at yahoo.com.br  Wed Jun 18 20:08:01 2014
From: gonzagarg at yahoo.com.br (Ruth Gonzaga)
Date: Wed, 18 Jun 2014 19:08:01 +0100
Subject: [R-sig-Geo] Error creating GlobalSoilMap object (GSIF package)
In-Reply-To: <CAFUr27AzBpHKBF0k5oGyvwQhqRfjF=9NaB+9gHW4Ky=cj37Jjw@mail.gmail.com>
References: <CAOumgdDYNW_2_tLw9CzwusBS3b8EHRFVv1sLP8fpA8b14JBVUQ@mail.gmail.com>
	<CAAcyNCzN9+DQ__baJUpoLbKeVB_H=zSCR01WViF4bSuTw89VUg@mail.gmail.com>
	<53A19718.9020209@spatial-analyst.net>
	<CAOumgdA4MgA83841WE9YnLOmse0viOyUH9z_t2SOs1exx31Eiw@mail.gmail.com>
	<CAFUr27AzBpHKBF0k5oGyvwQhqRfjF=9NaB+9gHW4Ky=cj37Jjw@mail.gmail.com>
Message-ID: <CAOumgdAoUUJ7fgbA0txrsWO=ysr7PPkqLHNT2ErxYDuFoSKVEg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140618/da47e464/attachment.pl>

From yasebaytok at gmail.com  Wed Jun 18 21:32:18 2014
From: yasebaytok at gmail.com (Yerguner)
Date: Wed, 18 Jun 2014 12:32:18 -0700 (PDT)
Subject: [R-sig-Geo] parallelize projectRaster()
In-Reply-To: <CABG0rfuK35nb4Jx57QdUYEaJhYenrGe4ureXBoPoHzPHxOWHog@mail.gmail.com>
References: <1403069087977-7586598.post@n2.nabble.com>
	<CABG0rfv-6qMSt13TxiUT-ErGvFDBapzCKTQpYwnKJrk-neYH0w@mail.gmail.com>
	<1403106249076-7586604.post@n2.nabble.com>
	<CABG0rfuK35nb4Jx57QdUYEaJhYenrGe4ureXBoPoHzPHxOWHog@mail.gmail.com>
Message-ID: <1403119938926-7586608.post@n2.nabble.com>

Hi Jonathan,

Believe me I tried that and all other different combinations but starting
with the gdal_translate step only adds extra hrs to finish the whole
process. Actually, when I run the below gdalwarp commanline outside R, it
completes the same small netcdf file in ~ 2hrs but I just do the
reprojection and then do the resampling step in R in ~25 min. So, this was
the my first approach alternative to projectRaster() approach and 2,5 hrs is
better than 8 hrs. But again, unless there is a solution to speed up the
process (at least the reprojection part), both approaches do not work my
case. That's why I'm looking for way to do this all process in R to be able
to parallelize the functions as for the first approach. And I have also many
large files (each about the same size 5.5 GB) to repeat this process. So,
both the file sizes are large and many, in addition to doParallel(),
foreach() package might also be a solution?

gdalwarp and resample() approach:

gdalwarp -t_srs "+proj=laea +lat_0=45 +lon_0=-100 +x_0=0 +y_0=0 +no_defs
+a=6370997 +b=6370997 +to_meter=1.0" NETCDF:"colds1.nc":tmin colds1.tif     
## ~2 hrs

library(raster)
library(rgdal)
rasterOptions(tmpdir="some_tmp_path")
source_file1 <- "mod2000.tif"
source_file2 <- "colds1.tif"
mod00 <- raster(source_file1)
cold00s1 <- brick(source_file2)
submod00 <- crop(mod00,cold00s1)
rsmp1 <- resample(cold00s1,submod00,method="ngb")     ## 25 min
stackSelect
(rsmp1,submod00,filename="modcold00.tif",options="INTERLEAVE=BAND")

Thank you so much and looking forward to hearing from you,
Yasemin




--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/parallelize-projectRaster-tp7586598p7586608.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From tephilippi at gmail.com  Wed Jun 18 21:44:33 2014
From: tephilippi at gmail.com (Tom Philippi)
Date: Wed, 18 Jun 2014 12:44:33 -0700
Subject: [R-sig-Geo] Large NetCDF file problems
In-Reply-To: <CABG0rft8nC6UbkFZxT_b5=OD2Vb2mS_hNJ1cGsLZUS3BpyiUpg@mail.gmail.com>
References: <CALDV4smYfnno0Mwr0icKZZvyam_Znb4u9Tdk_QYRX755CnMPog@mail.gmail.com>
	<CAAcyNCwtbPyNf9xPoYgKFZLNMtKUJ=2QXJs55Oq9sfx3TXGOnw@mail.gmail.com>
	<CAAcGz9_adUdF+bv_wXA4G6jrAL2jF_gAXG0BgKgwBTNa_RXrrg@mail.gmail.com>
	<CALDV4skHbwJq38BcPuiV2W_mqN97xRjrF1=TZFMsB19jOBQSFQ@mail.gmail.com>
	<CALDV4skvFCnmrwRy+KBKcUXBt_vyeEt7FTqdY=AO8PDngt_p-w@mail.gmail.com>
	<alpine.LRH.2.03.1406112310020.26131@reclus.nhh.no>
	<CALDV4s=RLPPkibwHDmjOs_8uEzQ60ogHhbzG3BXF-PWCBQea8g@mail.gmail.com>
	<CAAcGz98Ut0Nz8R_mkS5GFAEisp3O6ie9cygWDdp6exCxR+iRTw@mail.gmail.com>
	<CABG0rft8nC6UbkFZxT_b5=OD2Vb2mS_hNJ1cGsLZUS3BpyiUpg@mail.gmail.com>
Message-ID: <CALyPt8wE-zuB-=DGGAczhuPadh2aQSSh+1B=SQ3NdGWRkuJDJw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140618/11ea51de/attachment.pl>

From jgrn at illinois.edu  Thu Jun 19 02:31:02 2014
From: jgrn at illinois.edu (Jonathan Greenberg)
Date: Wed, 18 Jun 2014 19:31:02 -0500
Subject: [R-sig-Geo] parallelize projectRaster()
In-Reply-To: <1403119938926-7586608.post@n2.nabble.com>
References: <1403069087977-7586598.post@n2.nabble.com>
	<CABG0rfv-6qMSt13TxiUT-ErGvFDBapzCKTQpYwnKJrk-neYH0w@mail.gmail.com>
	<1403106249076-7586604.post@n2.nabble.com>
	<CABG0rfuK35nb4Jx57QdUYEaJhYenrGe4ureXBoPoHzPHxOWHog@mail.gmail.com>
	<1403119938926-7586608.post@n2.nabble.com>
Message-ID: <CABG0rfv-v8Kw+yJ8yKU+PYCT_yDkH+wqTwnAvzRHMg04r=BfAQ@mail.gmail.com>

Can you make your test file available via google drive or dropbox or
something?  I'm really surprised GDAL is taking more time than the R
version.  It is hard to replicate your example without the test file.

As an FYI, to enable parallel processing of a single gdalwarp, use
(from: http://lists.osgeo.org/pipermail/gdal-dev/2012-June/033084.html):

gdalwarp -multi src.tif dst.tif -wo NUM_THREADS=ALL_CPUS

You can use these options from gdalUtils if you'd like.

--j

On Wed, Jun 18, 2014 at 2:32 PM, Yerguner <yasebaytok at gmail.com> wrote:
> Hi Jonathan,
>
> Believe me I tried that and all other different combinations but starting
> with the gdal_translate step only adds extra hrs to finish the whole
> process. Actually, when I run the below gdalwarp commanline outside R, it
> completes the same small netcdf file in ~ 2hrs but I just do the
> reprojection and then do the resampling step in R in ~25 min. So, this was
> the my first approach alternative to projectRaster() approach and 2,5 hrs is
> better than 8 hrs. But again, unless there is a solution to speed up the
> process (at least the reprojection part), both approaches do not work my
> case. That's why I'm looking for way to do this all process in R to be able
> to parallelize the functions as for the first approach. And I have also many
> large files (each about the same size 5.5 GB) to repeat this process. So,
> both the file sizes are large and many, in addition to doParallel(),
> foreach() package might also be a solution?
>
> gdalwarp and resample() approach:
>
> gdalwarp -t_srs "+proj=laea +lat_0=45 +lon_0=-100 +x_0=0 +y_0=0 +no_defs
> +a=6370997 +b=6370997 +to_meter=1.0" NETCDF:"colds1.nc":tmin colds1.tif
> ## ~2 hrs
>
> library(raster)
> library(rgdal)
> rasterOptions(tmpdir="some_tmp_path")
> source_file1 <- "mod2000.tif"
> source_file2 <- "colds1.tif"
> mod00 <- raster(source_file1)
> cold00s1 <- brick(source_file2)
> submod00 <- crop(mod00,cold00s1)
> rsmp1 <- resample(cold00s1,submod00,method="ngb")     ## 25 min
> stackSelect
> (rsmp1,submod00,filename="modcold00.tif",options="INTERLEAVE=BAND")
>
> Thank you so much and looking forward to hearing from you,
> Yasemin
>
>
>
>
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/parallelize-projectRaster-tp7586598p7586608.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



-- 
Jonathan A. Greenberg, PhD
Assistant Professor
Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
Department of Geography and Geographic Information Science
University of Illinois at Urbana-Champaign
259 Computing Applications Building, MC-150
605 East Springfield Avenue
Champaign, IL  61820-6371
Phone: 217-300-1924
http://www.geog.illinois.edu/~jgrn/
AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007


From mdsumner at gmail.com  Thu Jun 19 04:02:36 2014
From: mdsumner at gmail.com (Michael Sumner)
Date: Thu, 19 Jun 2014 12:02:36 +1000
Subject: [R-sig-Geo] parallelize projectRaster()
In-Reply-To: <1403119938926-7586608.post@n2.nabble.com>
References: <1403069087977-7586598.post@n2.nabble.com>
	<CABG0rfv-6qMSt13TxiUT-ErGvFDBapzCKTQpYwnKJrk-neYH0w@mail.gmail.com>
	<1403106249076-7586604.post@n2.nabble.com>
	<CABG0rfuK35nb4Jx57QdUYEaJhYenrGe4ureXBoPoHzPHxOWHog@mail.gmail.com>
	<1403119938926-7586608.post@n2.nabble.com>
Message-ID: <CAAcGz99fdLV2-yr=QOPB9-nXWqpEywreomQNVLC0vFO1aBa7_w@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140619/e0acf3dd/attachment.pl>

From rob.andronaco at lifesavingvictoria.com.au  Thu Jun 19 05:43:35 2014
From: rob.andronaco at lifesavingvictoria.com.au (Robert)
Date: Wed, 18 Jun 2014 20:43:35 -0700 (PDT)
Subject: [R-sig-Geo] tango.stat
Message-ID: <1403149415575-7586612.post@n2.nabble.com>

Hi there,

I?m new to R and was hoping someone could help me out. Hopefully it?s
something simple I have missed!

I? m using tango.stat from the DCluster package - 
http://www.inside-r.org/packages/cran/DCluster/docs/tango.stat
<http://www.inside-r.org/packages/cran/DCluster/docs/tango.stat>  

I ran the listed example (Sids) and it runs without error (to be expected).

When I run my substituted values from the imported csv file I get the
following error;

> # #use exp(-D) as closeness matrix
> tango.stat(drown, col.W.tango, zero.policy=TRUE)

*Error in array(x, c(length(x), 1L), if (!is.null(names(x))) list(names(x), 
: 
  'data' must be of a vector type, was 'NULL'*

> tango.test(Obs_count~offset(log(Exp_count)), drown , model="poisson",
> R=999, list=col.W.tango, zero.policy=TRUE)

Although the error appears I still get the values:

	Tango's test of global clustering 
	Type of boots.: parametric 
	Model used when sampling: Poisson 
	Number of simulations: 999 
	Statistic:  0.01126845 
	p-value :  0.001

Essentially I want to know:

1.	If the error has any impact on the end calculation?
2.	And if so, what do I need to modify to ensure that the values are
correct?

Please let me know if more information is required. 

Regards

Rob  



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/tango-stat-tp7586612.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From benjaminbenwu at gmail.com  Fri Jun 20 15:38:18 2014
From: benjaminbenwu at gmail.com (Ben Wu)
Date: Fri, 20 Jun 2014 21:38:18 +0800
Subject: [R-sig-Geo] 1.geocode using Chinese ? 2. let mapdist deal with
	several lon/lat?
Message-ID: <CAP-NH8tpyO0NGk=u5wqjTCjm0kc-2OPgCmbs03BLN6XHFvCxSQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140620/2ef7b2bf/attachment.pl>

From brasilbrasil at gmail.com  Fri Jun 20 19:35:03 2014
From: brasilbrasil at gmail.com (Lucas Fortini)
Date: Fri, 20 Jun 2014 10:35:03 -0700 (PDT)
Subject: [R-sig-Geo] Mahalanobis scores for training data
In-Reply-To: <CANtt_hzC-6SskGL=H=voT4=zkH2MOOuhURDKQzYUUwYyty55jw@mail.gmail.com>
References: <52A91810.9090705@gmail.com>
	<CANtt_hzC-6SskGL=H=voT4=zkH2MOOuhURDKQzYUUwYyty55jw@mail.gmail.com>
Message-ID: <1403285703601-7586614.post@n2.nabble.com>

Dear Robert, 
I was replying to the thread because I have also encountered the same issue
that Gerardo mentions but believe that your recommendation does not address
the issue.
I have been using the mahal classifier function (Dismo package in r) in
several of my analyses and recently I have discovered that it seems to give
apparently wrong distance results for points that are identical to points
used in training of the classifier. I have recently posted a question on
stack overflow without realizing that this thread existed. In it I document
the odd behavior in multiple ways. 

http://stackoverflow.com/questions/24313694/mahalanobis-distance-based-classifier-leads-to-seemingly-wrong-scores-for-points

BTW, thanks very much for the work on the Dismo package. It is truly an
amazing tool set.

Best regards,
Lucas



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Mahalanobis-scores-for-training-data-tp7585347p7586614.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From ferra.xu at yahoo.com  Fri Jun 20 20:45:19 2014
From: ferra.xu at yahoo.com (Ferra Xu)
Date: Fri, 20 Jun 2014 11:45:19 -0700
Subject: [R-sig-Geo] Is there anyone who is familiar with PtProcess package?
Message-ID: <1403289919.670.YahooMailNeo@web125106.mail.ne1.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140620/c8e21003/attachment.pl>

From klamathconservation at gmail.com  Fri Jun 20 23:50:29 2014
From: klamathconservation at gmail.com (Carlos Carroll)
Date: Fri, 20 Jun 2014 14:50:29 -0700
Subject: [R-sig-Geo] apply "raster::aggregate" to multi-layer raster stack,
 using function that processes values from multiple layers to create
 a single layer?
Message-ID: <CAMX4SANgy4xTTvFL5tS2yEi6_FKzNrRQUDgmv5ZwztAej=pEow@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140620/10572ad1/attachment.pl>

From palfaro at motionsoft.com.uy  Sat Jun 21 00:56:46 2014
From: palfaro at motionsoft.com.uy (Pablo Alfaro)
Date: Fri, 20 Jun 2014 19:56:46 -0300
Subject: [R-sig-Geo] Large NetCDF file problems
In-Reply-To: <CALyPt8wE-zuB-=DGGAczhuPadh2aQSSh+1B=SQ3NdGWRkuJDJw@mail.gmail.com>
References: <CALDV4smYfnno0Mwr0icKZZvyam_Znb4u9Tdk_QYRX755CnMPog@mail.gmail.com>
	<CAAcyNCwtbPyNf9xPoYgKFZLNMtKUJ=2QXJs55Oq9sfx3TXGOnw@mail.gmail.com>
	<CAAcGz9_adUdF+bv_wXA4G6jrAL2jF_gAXG0BgKgwBTNa_RXrrg@mail.gmail.com>
	<CALDV4skHbwJq38BcPuiV2W_mqN97xRjrF1=TZFMsB19jOBQSFQ@mail.gmail.com>
	<CALDV4skvFCnmrwRy+KBKcUXBt_vyeEt7FTqdY=AO8PDngt_p-w@mail.gmail.com>
	<alpine.LRH.2.03.1406112310020.26131@reclus.nhh.no>
	<CALDV4s=RLPPkibwHDmjOs_8uEzQ60ogHhbzG3BXF-PWCBQea8g@mail.gmail.com>
	<CAAcGz98Ut0Nz8R_mkS5GFAEisp3O6ie9cygWDdp6exCxR+iRTw@mail.gmail.com>
	<CABG0rft8nC6UbkFZxT_b5=OD2Vb2mS_hNJ1cGsLZUS3BpyiUpg@mail.gmail.com>
	<CALyPt8wE-zuB-=DGGAczhuPadh2aQSSh+1B=SQ3NdGWRkuJDJw@mail.gmail.com>
Message-ID: <CALDV4smHDBJyqq8tAdYjTHu4poPoku2VzAxvmh=cjp+sNfT19g@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140620/ef1b0851/attachment.pl>

From hengl at spatial-analyst.net  Sat Jun 21 08:02:18 2014
From: hengl at spatial-analyst.net (Tomislav Hengl)
Date: Sat, 21 Jun 2014 08:02:18 +0200
Subject: [R-sig-Geo] Error creating GlobalSoilMap object (GSIF package)
In-Reply-To: <CAOumgdA4MgA83841WE9YnLOmse0viOyUH9z_t2SOs1exx31Eiw@mail.gmail.com>
References: <CAOumgdDYNW_2_tLw9CzwusBS3b8EHRFVv1sLP8fpA8b14JBVUQ@mail.gmail.com>	<CAAcyNCzN9+DQ__baJUpoLbKeVB_H=zSCR01WViF4bSuTw89VUg@mail.gmail.com>	<53A19718.9020209@spatial-analyst.net>
	<CAOumgdA4MgA83841WE9YnLOmse0viOyUH9z_t2SOs1exx31Eiw@mail.gmail.com>
Message-ID: <53A51FEA.3060204@spatial-analyst.net>


Sorry for that bug. You need to get GSIF v0.4-2 or higher and then the 
SoilGrids objects will compile 
(http://gsif.r-forge.r-project.org/SoilGrids.html).

Looks like R-forge is still building the package 
(http://r-forge.r-project.org/R/?group_id=1125). I will try to put the 
new version on CRAN next week. In the meanwhile you should be able to 
install it by running:

install.packages("GSIF", repos=c("http://R-Forge.R-project.org"), type = 
"source")


On 18-6-2014 16:55, Ruth Gonzaga wrote:
> Thanks for the suggestion, but I am still getting an error:
>
>  > SNDMHT.gsm <- SoilGrids(obj=sd.ll, varname="SNDPPT",
> TimeSpan=list(begin="1999-02-01", end="2001-07-01"))
> Error in validityMethod(object) :
>    no slot of name "TimeSpan.begin" for this object of class "GlobalSoilMap"
>
> I am on Windows 8 using GSIF version 4-01. I will try to load this on a
> Ubuntu Virtual Machine to see if it turns out differently.
> Ruth
>
>
> On 18 June 2014 14:41, Tomislav Hengl <hengl at spatial-analyst.net
> <mailto:hengl at spatial-analyst.net>> wrote:
>
>
>     I would recommend switching to using "SoilGrids" class:
>
>     http://gsif.r-forge.r-project.__org/SoilGrids.html
>     <http://gsif.r-forge.r-project.org/SoilGrids.html>
>
>     Hence, to produce objects of SoilGrids class you need to use:
>
>     ## save to a "SoilGrids" object:
>     SNDMHT.gsm <- SoilGrids(obj=sd.ll, varname="SNDPPT",
>                   TimeSpan=list(begin="1999-02-__01", end="2001-07-01"))
>
>     In which case TimeSpan needs to be a list with names "begin", "end".
>
>     To install the most recent version of the GSIF package (v0.4-2),
>     please use:
>
>     install.packages("GSIF", repos="http://R-Forge.R-__project.org
>     <http://R-Forge.R-project.org>")
>
>     For technical issues and problems with SoilGrids classes please also
>     consider writing to the GSIF mailing list at:
>
>     https://groups.google.com/__forum/#!forum/global-soil-__information
>     <https://groups.google.com/forum/#!forum/global-soil-information>
>
>     HTH
>
>     T. Hengl
>
>     On 18-6-2014 3:12, Pascal Oettli wrote:
>
>         Hello,
>
>         According to the help file, TimeSpan is an "object of class "list";
>         contains begin and end of the sampling period of class
>         "POSIXct"". You
>         need to provide a list of POSIXct dates, not a vector.
>
>         HTH
>         Pascal
>
>         On Wed, Jun 18, 2014 at 8:56 AM, Ruth Gonzaga
>         <gonzagarg at yahoo.com.br <mailto:gonzagarg at yahoo.com.br>> wrote:
>
>             Dear All,
>             I have been trying to follow this tutorial on 3D modelling
>             of soil with the
>             GSIF package:
>             http://gsif.isric.org/doku.__php?id=wiki:tutorial_eberg
>             <http://gsif.isric.org/doku.php?id=wiki:tutorial_eberg>
>
>             (code on:
>             https://code.google.com/p/__gsif/source/browse/trunk/__eberg/tutorial_eberg.R
>             <https://code.google.com/p/gsif/source/browse/trunk/eberg/tutorial_eberg.R>)
>
>             When I get to creating a GlobalSoilMap object (line 181):
>
>             SNDMHT.gsm <- GlobalSoilMap(sd.ll, varname="SNDMHT",
>             period=c("1999-02-01",
>             "2001-07-01"))
>
>             I get an error saying:
>             Error in GlobalSoilMap(sd.ll, varname = "SNDMHT", period =
>             c("1999-02-01",
>             : unused argument (period = c("1999-02-01", "2001-07-01"))
>
>             I think the tutorial is quite old. I checked the help and
>             then replaced
>             "period" for "TimeSpan". I now get the following error:
>                Error in initialize(value, ...) :
>                 invalid name for slot of class "GlobalSoilMap":
>             TimeSpan.begin
>
>
>             Here is some information on this function:
>
>                 GlobalSoilMap function (obj, varname, TimeSpan =
>                 list(begin = Sys.Date()
>
>             - 1, end = Sys.Date())) { if (!class(obj) == "list") {
>             stop("Object of
>             class 'list' required") } out = new("GlobalSoilMap", varname
>             = varname,
>             TimeSpan.begin = TimeSpan, sd1 = as(obj[[1]],
>             "SpatialPixelsDataFrame"),
>             sd2 = as(obj[[2]], "SpatialPixelsDataFrame"), sd3 = as(obj[[3]],
>             "SpatialPixelsDataFrame"), sd4 = as(obj[[4]],
>             "SpatialPixelsDataFrame"),
>             sd5 = as(obj[[5]], "SpatialPixelsDataFrame"), sd6 = as(obj[[6]],
>             "SpatialPixelsDataFrame")) return(out)
>             }
>
>             Any ideas?
>             Thanks.
>
>             Ruth
>
>                       [[alternative HTML version deleted]]
>
>             _________________________________________________
>             R-sig-Geo mailing list
>             R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
>             https://stat.ethz.ch/mailman/__listinfo/r-sig-geo
>             <https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
>
>
>
>
>
>     _________________________________________________
>     R-sig-Geo mailing list
>     R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
>     https://stat.ethz.ch/mailman/__listinfo/r-sig-geo
>     <https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
>
>


From r.hijmans at gmail.com  Sat Jun 21 13:35:13 2014
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Sat, 21 Jun 2014 04:35:13 -0700
Subject: [R-sig-Geo] apply "raster::aggregate" to multi-layer raster
 stack,
 using function that processes values from multiple layers to create a single
 layer?
In-Reply-To: <CAMX4SANgy4xTTvFL5tS2yEi6_FKzNrRQUDgmv5ZwztAej=pEow@mail.gmail.com>
References: <CAMX4SANgy4xTTvFL5tS2yEi6_FKzNrRQUDgmv5ZwztAej=pEow@mail.gmail.com>
Message-ID: <CANtt_hwJ_vJwfaOR_ezeT9CaTRPhM77+sdq8boMFYp73sbb_XA@mail.gmail.com>

Carlos,

How about:

x <- mean(y)

or

x <- calc(y, mean)

Robert



On Fri, Jun 20, 2014 at 2:50 PM, Carlos Carroll
<klamathconservation at gmail.com> wrote:
> When I use "aggregate" (package raster) on a multi-layer stack, with a
> function such as "mean", it returns a second multi-layer stack at the
> aggregated resolution. The function is applied separately to values from
> each layer in turn.
> What I want to do is send the vector/matrix of values extracted across all
> layers to the user-defined function, which returns a single value that
> would then go to form the output, a single layer raster or stack.
> I can do this for a focal function using package spatial.tools, e.g.:
>
> v<-rasterEngine(w,fun=mean,window_dims = c(15,15,3))  ## for a 3 band stack
> with a window size of 15 by 15.
>
> But I just need the value at the aggregate resolution, so running a focal
> function takes ~200 times longer than necessary in this case.
> Is it possible to use raster::aggregate or another function to do a similar
> multi-layer operation?
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From klamathconservation at gmail.com  Sat Jun 21 18:26:02 2014
From: klamathconservation at gmail.com (Carlos Carroll)
Date: Sat, 21 Jun 2014 09:26:02 -0700
Subject: [R-sig-Geo] apply "raster::aggregate" to multi-layer raster
 stack,
 using function that processes values from multiple layers to create a single
 layer?
In-Reply-To: <CANtt_hwJ_vJwfaOR_ezeT9CaTRPhM77+sdq8boMFYp73sbb_XA@mail.gmail.com>
References: <CAMX4SANgy4xTTvFL5tS2yEi6_FKzNrRQUDgmv5ZwztAej=pEow@mail.gmail.com>
	<CANtt_hwJ_vJwfaOR_ezeT9CaTRPhM77+sdq8boMFYp73sbb_XA@mail.gmail.com>
Message-ID: <CAMX4SAPjCSVRY5QpxzDdOTG8Tign3Zav1xOOY7z6na+6RHx1_g@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140621/55baeae3/attachment.pl>

From rob.andronaco at lifesavingvictoria.com.au  Mon Jun 23 14:13:47 2014
From: rob.andronaco at lifesavingvictoria.com.au (Robert)
Date: Mon, 23 Jun 2014 05:13:47 -0700 (PDT)
Subject: [R-sig-Geo] Population density adjusted exponential weight
Message-ID: <1403525627375-7586621.post@n2.nabble.com>

Hi there,

I'm looking at creating a 'Population density adjusted exponential weight'.

Does anyone know where i can find an example script or basis to start with?

Regards

Rob 



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Population-density-adjusted-exponential-weight-tp7586621.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From ferra.xu at yahoo.com  Mon Jun 23 18:14:23 2014
From: ferra.xu at yahoo.com (Ferra Xu)
Date: Mon, 23 Jun 2014 09:14:23 -0700
Subject: [R-sig-Geo] Problem with "nlm" function to minimize the negative
	log likelihood
Message-ID: <1403540063.64234.YahooMailNeo@web125103.mail.ne1.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140623/73673579/attachment.pl>

From nevil.amos at gmail.com  Tue Jun 24 05:32:39 2014
From: nevil.amos at gmail.com (nevil amos)
Date: Tue, 24 Jun 2014 13:32:39 +1000
Subject: [R-sig-Geo] rasterVis:: levelplot error
Message-ID: <CAN9eD7m1JdRh7crnmESmto5+crK+9fnZ5Ty2A=dGewsbWBPEZw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140624/e3a51515/attachment.pl>

From oscar.perpinan at upm.es  Tue Jun 24 10:47:08 2014
From: oscar.perpinan at upm.es (=?UTF-8?Q?Oscar_Perpi=C3=B1an?=)
Date: Tue, 24 Jun 2014 10:47:08 +0200
Subject: [R-sig-Geo] rasterVis:: levelplot error
In-Reply-To: <CAN9eD7m1JdRh7crnmESmto5+crK+9fnZ5Ty2A=dGewsbWBPEZw@mail.gmail.com>
References: <CAN9eD7m1JdRh7crnmESmto5+crK+9fnZ5Ty2A=dGewsbWBPEZw@mail.gmail.com>
Message-ID: <CAMLL7bkbyminEeG7RUgMzVu9BPBRwTh==+61ifcoBX0-WzVzuw@mail.gmail.com>

Hi Nevil,

I am almost sure that this error is signaled by cellStats, which is
internally used in levelplot. If so, I can fix it easily.
Could you please post the result of traceback() and sessionInfo()?

Best,

Oscar.


-----------------------------------------------------------------
Oscar Perpi??n Lamigueiro
Dpto. Ingenier?a El?ctrica (ETSIDI-UPM)
Grupo de Sistemas Fotovoltaicos (IES-UPM)
URL: http://oscarperpinan.github.io
Twitter: @oscarperpinan


2014-06-24 5:32 GMT+02:00 nevil amos <nevil.amos at gmail.com>:
> Is there a maximum raster size to plot using levelplot?
>
> I am getting the following error
>
>> levelplot(LessThanTfiCount,legend=T,maxpixels=100000,col=c("gray",colors))
> Error in .local(x, stat, ...) : cannot use this function for large files
>
>
>
>> LessThanTfiCount
> class       : RasterLayer
> dimensions  : 22268, 32521, 724177628  (nrow, ncol, ncell)
> resolution  : 25, 25  (x, y)
> extent      : 2126750, 2939775, 2262225, 2818925  (xmin, xmax, ymin, ymax)
> coord. ref. : +proj=lcc +lat_1=-36 +lat_2=-38 +lat_0=-37 +lon_0=145
> +x_0=2500000 +y_0=2500000 +ellps=GRS80 +units=m +no_defs
> data source :
> C:\Users\JNA\AppData\Local\Temp\R_raster_JNA\raster_tmp_2014-06-24_094850_1800_86115.grd
> names       : layer
> values      : 0, 9  (min, max)
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From jgrn at illinois.edu  Tue Jun 24 18:04:13 2014
From: jgrn at illinois.edu (Jonathan Greenberg)
Date: Tue, 24 Jun 2014 11:04:13 -0500
Subject: [R-sig-Geo] apply "raster::aggregate" to multi-layer raster
 stack,
 using function that processes values from multiple layers to create a single
 layer?
In-Reply-To: <CAMX4SAPjCSVRY5QpxzDdOTG8Tign3Zav1xOOY7z6na+6RHx1_g@mail.gmail.com>
References: <CAMX4SANgy4xTTvFL5tS2yEi6_FKzNrRQUDgmv5ZwztAej=pEow@mail.gmail.com>
	<CANtt_hwJ_vJwfaOR_ezeT9CaTRPhM77+sdq8boMFYp73sbb_XA@mail.gmail.com>
	<CAMX4SAPjCSVRY5QpxzDdOTG8Tign3Zav1xOOY7z6na+6RHx1_g@mail.gmail.com>
Message-ID: <CABG0rfu-fzSscaC5=UwYze7qzOuBJE0EG8ot+WNPp7ZcWb1b_g@mail.gmail.com>

Just to be clear, what you are really asking for is a function applied
to a focal window not at every pixel location, but centered on e.g.
every 15th pixels (so the focal windows don't overlap), correct?  If
so, as you noted this isn't what rasterEngine is designed for in the
way you are running it -- it takes 200 times longer, of course,
because each pixel using a 15x15 window is 225 pixels needed to
calculate an output.

I don't think aggregate takes more than 1 layer as an input (Robert?
Is this something that you could mod easily?) which is your problem.

You could solve this with rasterEngine is a bit of a backwards way --
if your "input" to rasterEngine (which sets the
extent/projection/resolution of the output) is actually the output,
aggregated file (blank), and one of the input variables is your input
file, you could write a function that uses the pixel position to pull
data from the input file.  projectRaster_rigorous (look at the source
code -- it is simply a rasterEngine function) shows an example of this
"start from the end" solution.  You won't want to use the polygon
cropping approach, however, you'll want to use a quicker function
(e.g. getValuesBlock would be a good one).

Basically:

input to rasterEngine: a blank aggregated file, chunk_format="raster"
function inputs: blank aggregated file, high resolution file, window size
function:
- determine the pixel coordinates of each pixel in the "chunk" of the
blank file (note that since chunk_format is set to "raster" instead of
"array", you will have access to all of the geographic information of
that chunk)
- loop through each pixel in the chunk and use its pixel coordinates
to set the parameters for getValuesBlock -- the starting row will need
to be the current pixel minus 7 pixels (if a 15x15 window)
---> special note: you will need to be careful with edge pixels, since
you may ask for a chunk that runs off the edge of your high rez image
- getValuesBlock from your high resolution file (one per pixel in the
chunk), run your analysis, return 1 values per pixel in the output
aggregated file

Does this make sense?  It is a bit counter-intuitive starting from the
end, but you should be able to get fairly rapid processing (at the
cost of increased coding) this way.  If you do follow this technique,
please follow-up with your actual completed code for the community!

--j

On Sat, Jun 21, 2014 at 11:26 AM, Carlos Carroll
<klamathconservation at gmail.com> wrote:
> While mean of calc(y, mean) would allow me to operate on the original
> stack, and then subsequently aggregate the results, what I need to do is
> operate on the entire set of values within the aggregation window (x * y *
> nlayers) in one go, because I am deriving a multivariate distance metric
> (below).
>
> multidist <- function(x,...)
> {
> footprintsize<-225
> numvars<-3
> meandist <- mean(dist(matrix(x,footprintsize,numvars), method =
> "euclidean"),na.rm=TRUE)
> return(meandist)
> }
>
>
>
> On Sat, Jun 21, 2014 at 4:35 AM, Robert J. Hijmans <r.hijmans at gmail.com>
> wrote:
>
>> Carlos,
>>
>> How about:
>>
>> x <- mean(y)
>>
>> or
>>
>> x <- calc(y, mean)
>>
>> Robert
>>
>>
>>
>> On Fri, Jun 20, 2014 at 2:50 PM, Carlos Carroll
>> <klamathconservation at gmail.com> wrote:
>> > When I use "aggregate" (package raster) on a multi-layer stack, with a
>> > function such as "mean", it returns a second multi-layer stack at the
>> > aggregated resolution. The function is applied separately to values from
>> > each layer in turn.
>> > What I want to do is send the vector/matrix of values extracted across
>> all
>> > layers to the user-defined function, which returns a single value that
>> > would then go to form the output, a single layer raster or stack.
>> > I can do this for a focal function using package spatial.tools, e.g.:
>> >
>> > v<-rasterEngine(w,fun=mean,window_dims = c(15,15,3))  ## for a 3 band
>> stack
>> > with a window size of 15 by 15.
>> >
>> > But I just need the value at the aggregate resolution, so running a focal
>> > function takes ~200 times longer than necessary in this case.
>> > Is it possible to use raster::aggregate or another function to do a
>> similar
>> > multi-layer operation?
>> >
>> >         [[alternative HTML version deleted]]
>> >
>> > _______________________________________________
>> > R-sig-Geo mailing list
>> > R-sig-Geo at r-project.org
>> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



-- 
Jonathan A. Greenberg, PhD
Assistant Professor
Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
Department of Geography and Geographic Information Science
University of Illinois at Urbana-Champaign
259 Computing Applications Building, MC-150
605 East Springfield Avenue
Champaign, IL  61820-6371
Phone: 217-300-1924
http://www.geog.illinois.edu/~jgrn/
AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007


From jgrn at illinois.edu  Tue Jun 24 19:25:04 2014
From: jgrn at illinois.edu (Jonathan Greenberg)
Date: Tue, 24 Jun 2014 12:25:04 -0500
Subject: [R-sig-Geo] custom focal function on rasterstack
In-Reply-To: <1402994847252-7586593.post@n2.nabble.com>
References: <CAO6WGrWsXiyXVZC1sEH=KJFF8Kr0R+W9Jww=pNeBjgNH9ULhsg@mail.gmail.com>
	<CABG0rfvRGK9jLUtLkGmoicwwQb8Ff+SkOTW_GEwc_7E6+0NeKg@mail.gmail.com>
	<CAO6WGrU-qDTgbNV6L+4eirgn-unDOeg3cQjHPfA=_wibZOGn5w@mail.gmail.com>
	<1402994847252-7586593.post@n2.nabble.com>
Message-ID: <CABG0rfuzxXOTcNvpB9Wntb5bFngdjy7tcnM-nOx_O4vjPRr5sw@mail.gmail.com>

Hi Ben:

In the short term, I don't have a plan to implement a mask in focal
the way I think you are asking -- it has to do with how data is read
from disk to realize the parallel processing -- all of the data HAS to
be read, and you HAVE to have a single output per pixel.  With this
said, the code allows you to implement a mask if need be (set it as a
second input raster). If you use processing_unit="chunk" with a focal
window, you can efficiently use a mask to "skip" those masked pixels
(when I mean skip, I mean your function performs a quick "return NA"
instead of "process all values in the window").

The processing_unit="chunk" for focal takes a bit of getting used to,
so you might want to investigate it with debugmode=TRUE.  Another
trick for learning this mode is to grab the latest spatial.tools from
R-forge (version 1.4.4 or later) is to create a "GLT" file (a 2-band
file where band 1 is the pixel x position (column) and band 2 is the
pixel y position (row)) using raster_to_GLT.  When you take a look at
the test chunk in the debugmode you will see how this an "unspooled"
set of focal windows looks.

--j

On Tue, Jun 17, 2014 at 3:47 AM, ben mack <benjamin0mack at gmail.com> wrote:
> Hi,
>
> the spatial.tools is really a great thing to accellerate the raster
> processing. However, I have the same issue and often need to process only a
> part of the image and thus a mask option for the rasterEngine would also be
> great for me.
> I just wanted to also ask if this is considered an option in future versions
> (Jonathan?). Or did you, Ruben, or anybody else found a work around?
>
> Thanks a lot,
> Ben
>
>
>
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/custom-focal-function-on-rasterstack-tp7585959p7586593.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



-- 
Jonathan A. Greenberg, PhD
Assistant Professor
Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
Department of Geography and Geographic Information Science
University of Illinois at Urbana-Champaign
259 Computing Applications Building, MC-150
605 East Springfield Avenue
Champaign, IL  61820-6371
Phone: 217-300-1924
http://www.geog.illinois.edu/~jgrn/
AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007


From janka.vanschoenwinkel at uhasselt.be  Tue Jun 24 19:35:48 2014
From: janka.vanschoenwinkel at uhasselt.be (Janka VANSCHOENWINKEL)
Date: Tue, 24 Jun 2014 19:35:48 +0200
Subject: [R-sig-Geo] Choropleth map
Message-ID: <CAHymutKaqonuZdTuyyynZ8KqHHpr6x2JBhWnJkJ0VEYTkBSM2Q@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140624/fda20dd6/attachment.pl>

From bi.keithhelfrich at gmail.com  Wed Jun 25 02:38:14 2014
From: bi.keithhelfrich at gmail.com (Keith Helfrich)
Date: Tue, 24 Jun 2014 17:38:14 -0700
Subject: [R-sig-Geo] Spatio Temporal Clustering
Message-ID: <CALU+=bFxvHSC6=HSmOP7nxm8Cz+n=QRqoaZNyi0vQ4-TTY5mfQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140624/9db1c5f9/attachment.pl>

From nevil.amos at gmail.com  Wed Jun 25 03:27:35 2014
From: nevil.amos at gmail.com (nevil amos)
Date: Wed, 25 Jun 2014 11:27:35 +1000
Subject: [R-sig-Geo] rasterVis:: levelplot error
In-Reply-To: <CAMLL7bkbyminEeG7RUgMzVu9BPBRwTh==+61ifcoBX0-WzVzuw@mail.gmail.com>
References: <CAN9eD7m1JdRh7crnmESmto5+crK+9fnZ5Ty2A=dGewsbWBPEZw@mail.gmail.com>
	<CAMLL7bkbyminEeG7RUgMzVu9BPBRwTh==+61ifcoBX0-WzVzuw@mail.gmail.com>
Message-ID: <CAN9eD7kCRaoqpfLdJHBrHkQObiD+OqrzDteW5Uzsi5KOckcjSA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140625/708a70c0/attachment.pl>

From oscar.perpinan at upm.es  Wed Jun 25 12:00:54 2014
From: oscar.perpinan at upm.es (=?UTF-8?Q?Oscar_Perpi=C3=B1an?=)
Date: Wed, 25 Jun 2014 12:00:54 +0200
Subject: [R-sig-Geo] rasterVis:: levelplot error
In-Reply-To: <CAN9eD7kCRaoqpfLdJHBrHkQObiD+OqrzDteW5Uzsi5KOckcjSA@mail.gmail.com>
References: <CAN9eD7m1JdRh7crnmESmto5+crK+9fnZ5Ty2A=dGewsbWBPEZw@mail.gmail.com>
	<CAMLL7bkbyminEeG7RUgMzVu9BPBRwTh==+61ifcoBX0-WzVzuw@mail.gmail.com>
	<CAN9eD7kCRaoqpfLdJHBrHkQObiD+OqrzDteW5Uzsi5KOckcjSA@mail.gmail.com>
Message-ID: <CAMLL7b=OXo2UiRc+igpK_n6S8zLWOsEAOUZnO6F+PM8E-yruNQ@mail.gmail.com>

Thanks. I have pushed a commit to solve it:
https://github.com/oscarperpinan/rastervis/commit/bfe0ad06b753a66a89e6953daa70f3dcfb5325b3.
You can try it with devtools::install_github('rasterVis',
'oscarperpinan'). I will upload a new version to CRAN soon.

Best,

Oscar.

2014-06-25 3:27 GMT+02:00 nevil amos <nevil.amos at gmail.com>:
> Thanks
>
> here is the traceback() etc
>


From Roger.Bivand at nhh.no  Wed Jun 25 14:00:17 2014
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 25 Jun 2014 14:00:17 +0200
Subject: [R-sig-Geo] Choropleth map
In-Reply-To: <CAHymutKaqonuZdTuyyynZ8KqHHpr6x2JBhWnJkJ0VEYTkBSM2Q@mail.gmail.com>
References: <CAHymutKaqonuZdTuyyynZ8KqHHpr6x2JBhWnJkJ0VEYTkBSM2Q@mail.gmail.com>
Message-ID: <alpine.LRH.2.03.1406251352240.14482@reclus.nhh.no>

Please do *not* post in HTML - all R lists require plain text.

You have not provided a reproducible example or access to downloadable 
data with a script showing your problem. Nobody will try to copy & paste 
from garbled HTML.

You are using ggplot, which mangles spatial objects. If the choropleth map 
can be created with plot or spplot methods from sp, you can go on to use 
ggplot, but you will most likely find it harder to debug all the way to 
ggplot without debugging the objects - so try spplot first.

Once that works, you are free to go on to ggplot. Have you looked at Oscar 
Perpig??n's book on displaying spatial data - your library should have it? 
Hadley Wickham's approach is to make all the fish into fish soup 
(fortify), from which it is hard to extract the fish for debugging. Debug 
the fish first before making your soup, especially checking dimensions.

Roger

On Tue, 24 Jun 2014, Janka VANSCHOENWINKEL wrote:

> Dear list members,
>
>
> I am trying to make a basic choropleth map for all nuts3 regions in Europe
> ( = a map where
>
> regions are colored by the value of a certain variable ??? think for instance
> about a populations
>
> density map).
>
>
> I am struggling with this for over a week by now and I always get the same
> error message:
>
> Error: Aesthetics must either be length one, or the same length as
>
> the dataProblems:ValueMapDf$NUTS_ID
>
>
>
> I checked the book ???ggplot2??? from Hadley Weckham and several internet
> sources.  They
>
> document the different steps very properly, but still I don???t know what I
> am doing wrong.
>
>
> Could somebody help me out, please? Thanks in advance!
>
> *Below you can find my code. I hope I gave sufficient information,
> otherwise, just let me know!*
>
>
> library(maptools)
>
> library(ggplot2)
>
> library(ggmap)
>
>
> # read administrative boundaries (I call the SpatialPolygonsDataFrame:
> "nuts" since it contains all nuts3 regions of Europe) )
>
> nuts <- readShapePoly(fn="NUTS_RG_60M_2006")
>
> names(nuts)
>
> [1] "OBJECTID"   "NUTS_ID"    "STAT_LEVL_" "AREA"       "LEN"
> "Shape_Leng" "Shape_Area"
>
>
> # Then I have a dataset with over 60000 observations (several observations
> per nuts3 region). I take the average of the different
>
> observations per nuts3 region and save it as "Value"
>
> # The dataset is called Alldata and MEt is the variable I would like to map
> over the different nuts3 regions
>
>
> Value <- aggregate(Alldata$MEt,list(Alldata$nuts3),mean)
>
> colnames(Value) <- c("NUTS_ID","ValueMEt")
>
>
> head(Value)
>
>  NUTS_ID   ValueMEt
>
> 1   AT111 0.04856170
>
> 2   AT112 0.05448523
>
> 3   AT113 0.04563415
>
> 4   AT121 0.02164469
>
> 5   AT122 0.02664611
>
> 6   AT123 0.03163034
>
>
>
> # merge map and data: I call the result "ValueMapDf"
>
> ValueMapDf <- merge(nuts, Value, by.x="NUTS_ID", by.y="NUTS_ID")
>
> ValueMapDf <- ValueMapDf[order(ValueMapDf$NUTS_ID),]
>
>
>
> # then I dropped some regions of the SpatialPolygonsDataFrame, for which I
> don't have observations (I did this manually since I didn't
>
> know if there was a way to do it automatically)
>
> ValueMapDf<-ValueMapDf[ValueMapDf$OBJECTID > 441,]
>
> ValueMapDf<-ValueMapDf[ValueMapDf$OBJECTID != 444,]
>
> ValueMapDf<-ValueMapDf[ValueMapDf$OBJECTID != 447,]
>
> ???.
>
> ValueMapDf<-ValueMapDf[ValueMapDf$OBJECTID != 1927,]
>
>
>
> # So far so good: now I continue with plotting my map with the values!
> However, as you can see below, here something goes wrong.
>
> # ggplot mapping
>
> # data layer
>
> m0 <- ggplot(data=ValueMapDf)
>
> # fill with Value data
>
> m1 <- m0 + geom_polygon(aes(x=long, y=lat, group=ValueMapDf$NUTS_ID,
> fill="ValueMapDf$ValueMEt")) + coord_equal()
>
> # add map with only borders (to have visible borders)
>
> m2 <- m1 + geom_path(aes(x=long, y=lat, group=ValueMapDf$NUTS_ID),
> color='black')
>
> m2
>
> Error: Aesthetics must either be length one, or the same length as the
> dataProblems:ValueMapDf$NUTS_ID
>
>
>
> I also tried:
>
> qplot(long,lat,data=ValueMapDf, group=ValueMapDf$NUTS_ID,
> fill=ValueMapDf$ValueMEt, geom="polygon")
>
> Regions defined for each Polygons
>
> Error: Aesthetics must either be length one, or the same length as the
> dataProblems:ValueMapDf$ValueMEt, ValueMapDf$NUTS_ID
>
>
>
>
>
>> length(ValueMapDf$OBJECTID)
>
> [1] 1122
>
>> length(ValueMapDf)
>
> [1] 1122
>
>> length(ValueMapDf$NUTS_ID)
>
> [1] 1122
>
>> length(ValueMapDf$ValueMEt)
>
> [1] 1122
>
>
>
> *When I write:*
>
> m0 <- ggplot(data=ValueMapDf)
>
> # fill with Value data
>
> m1 <- m0 + geom_polygon(aes(x=long, y=lat, group=NUTS_ID,
> fill="ValueMapDf$ValueMEt")) + coord_equal()
>
> # add map with only borders (to have visible borders)
>
> m2 <- m1 + geom_path(aes(x=long, y=lat, group=NUTS_ID), color='black')
>
> m2
>
> It get: Error in eval(expr, envir, enclos) : object 'NUTS_ID' not found
>
>
>
> Thanks in advance!
>
>
> Janka
>
> 	[[alternative HTML version deleted]]
>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no

From ROONEYJ4 at tcd.ie  Wed Jun 25 14:40:17 2014
From: ROONEYJ4 at tcd.ie (James Rooney)
Date: Wed, 25 Jun 2014 13:40:17 +0100
Subject: [R-sig-Geo] Choropleth map
In-Reply-To: <CAHymutKaqonuZdTuyyynZ8KqHHpr6x2JBhWnJkJ0VEYTkBSM2Q@mail.gmail.com>
References: <CAHymutKaqonuZdTuyyynZ8KqHHpr6x2JBhWnJkJ0VEYTkBSM2Q@mail.gmail.com>
Message-ID: <75C8D19A1470D344A8AF5312F01160A602BC2BCC8959@GOMAIL.college.tcd.ie>

Dear Janka,

I can't answer your ggplot questions as I don't really use it much however I did spot something in your code that will cause problems.

You used a "merge" to combine data between a dataframe and an SPDF:

> ValueMapDf <- merge(nuts, Value, by.x="NUTS_ID", by.y="NUTS_ID")

I've forgotten the reasoning, but this will not give you the merge results you expect. You might want to do some manual checking on your merge results.
James

________________________________________
From: r-sig-geo-bounces at r-project.org [r-sig-geo-bounces at r-project.org] On Behalf Of Janka VANSCHOENWINKEL [janka.vanschoenwinkel at uhasselt.be]
Sent: 24 June 2014 18:35
To: r-sig-geo at r-project.org
Subject: [R-sig-Geo] Choropleth map

Dear list members,


I am trying to make a basic choropleth map for all nuts3 regions in Europe
( = a map where

regions are colored by the value of a certain variable ? think for instance
about a populations

 density map).


I am struggling with this for over a week by now and I always get the same
error message:

Error: Aesthetics must either be length one, or the same length as

 the dataProblems:ValueMapDf$NUTS_ID



I checked the book ?ggplot2? from Hadley Weckham and several internet
sources.  They

document the different steps very properly, but still I don?t know what I
am doing wrong.


Could somebody help me out, please? Thanks in advance!

*Below you can find my code. I hope I gave sufficient information,
otherwise, just let me know!*


library(maptools)

library(ggplot2)

library(ggmap)


# read administrative boundaries (I call the SpatialPolygonsDataFrame:
"nuts" since it contains all nuts3 regions of Europe) )

nuts <- readShapePoly(fn="NUTS_RG_60M_2006")

names(nuts)

[1] "OBJECTID"   "NUTS_ID"    "STAT_LEVL_" "AREA"       "LEN"
"Shape_Leng" "Shape_Area"


# Then I have a dataset with over 60000 observations (several observations
per nuts3 region). I take the average of the different

observations per nuts3 region and save it as "Value"

# The dataset is called Alldata and MEt is the variable I would like to map
over the different nuts3 regions


Value <- aggregate(Alldata$MEt,list(Alldata$nuts3),mean)

colnames(Value) <- c("NUTS_ID","ValueMEt")


head(Value)

  NUTS_ID   ValueMEt

1   AT111 0.04856170

2   AT112 0.05448523

3   AT113 0.04563415

4   AT121 0.02164469

5   AT122 0.02664611

6   AT123 0.03163034



# merge map and data: I call the result "ValueMapDf"

ValueMapDf <- merge(nuts, Value, by.x="NUTS_ID", by.y="NUTS_ID")

ValueMapDf <- ValueMapDf[order(ValueMapDf$NUTS_ID),]



# then I dropped some regions of the SpatialPolygonsDataFrame, for which I
don't have observations (I did this manually since I didn't

know if there was a way to do it automatically)

ValueMapDf<-ValueMapDf[ValueMapDf$OBJECTID > 441,]

ValueMapDf<-ValueMapDf[ValueMapDf$OBJECTID != 444,]

ValueMapDf<-ValueMapDf[ValueMapDf$OBJECTID != 447,]

?.

ValueMapDf<-ValueMapDf[ValueMapDf$OBJECTID != 1927,]



# So far so good: now I continue with plotting my map with the values!
However, as you can see below, here something goes wrong.

# ggplot mapping

# data layer

m0 <- ggplot(data=ValueMapDf)

# fill with Value data

m1 <- m0 + geom_polygon(aes(x=long, y=lat, group=ValueMapDf$NUTS_ID,
fill="ValueMapDf$ValueMEt")) + coord_equal()

# add map with only borders (to have visible borders)

m2 <- m1 + geom_path(aes(x=long, y=lat, group=ValueMapDf$NUTS_ID),
color='black')

m2

Error: Aesthetics must either be length one, or the same length as the
dataProblems:ValueMapDf$NUTS_ID



I also tried:

qplot(long,lat,data=ValueMapDf, group=ValueMapDf$NUTS_ID,
fill=ValueMapDf$ValueMEt, geom="polygon")

Regions defined for each Polygons

Error: Aesthetics must either be length one, or the same length as the
dataProblems:ValueMapDf$ValueMEt, ValueMapDf$NUTS_ID





> length(ValueMapDf$OBJECTID)

[1] 1122

> length(ValueMapDf)

[1] 1122

> length(ValueMapDf$NUTS_ID)

[1] 1122

> length(ValueMapDf$ValueMEt)

[1] 1122



*When I write:*

m0 <- ggplot(data=ValueMapDf)

# fill with Value data

m1 <- m0 + geom_polygon(aes(x=long, y=lat, group=NUTS_ID,
fill="ValueMapDf$ValueMEt")) + coord_equal()

# add map with only borders (to have visible borders)

m2 <- m1 + geom_path(aes(x=long, y=lat, group=NUTS_ID), color='black')

m2

It get: Error in eval(expr, envir, enclos) : object 'NUTS_ID' not found



 Thanks in advance!


Janka

        [[alternative HTML version deleted]]


From klamathconservation at gmail.com  Wed Jun 25 19:05:47 2014
From: klamathconservation at gmail.com (Carlos Carroll)
Date: Wed, 25 Jun 2014 10:05:47 -0700
Subject: [R-sig-Geo] apply "raster::aggregate" to multi-layer raster
 stack,
 using function that processes values from multiple layers to create a single
 layer?
In-Reply-To: <CABG0rfu-fzSscaC5=UwYze7qzOuBJE0EG8ot+WNPp7ZcWb1b_g@mail.gmail.com>
References: <CAMX4SANgy4xTTvFL5tS2yEi6_FKzNrRQUDgmv5ZwztAej=pEow@mail.gmail.com>
	<CANtt_hwJ_vJwfaOR_ezeT9CaTRPhM77+sdq8boMFYp73sbb_XA@mail.gmail.com>
	<CAMX4SAPjCSVRY5QpxzDdOTG8Tign3Zav1xOOY7z6na+6RHx1_g@mail.gmail.com>
	<CABG0rfu-fzSscaC5=UwYze7qzOuBJE0EG8ot+WNPp7ZcWb1b_g@mail.gmail.com>
Message-ID: <CAMX4SAP-3bJZ+9PSNWCL3Pzw1iTdY=V56hOxYxDm9_8wuJKPKw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140625/d9063b6f/attachment.pl>

From jwm302 at gmail.com  Wed Jun 25 20:54:47 2014
From: jwm302 at gmail.com (Justin Michell)
Date: Wed, 25 Jun 2014 20:54:47 +0200
Subject: [R-sig-Geo] Raster Layers same resolution but not the same
	coordinates over the same area
Message-ID: <FEFE7375-7C62-47E7-B906-BB257581C587@gmail.com>

Dear Group

I am attempting to plot the length of malaria risk (in months) over Kenya (using the model described in the paper by Gemperli et al. (2003) entitled, 'Mapping malaria transmission in West and Central Africa?). The criteria for the model as it pertains to which months are suitable for stable malaria transmission at the locations I have in my sample, can be viewed here: https://db.tt/AoThPoSC

Following these criteria l have obtained which months are suitable at each of the locations in my dataset, as follows:

# evaluate month 1 (January)
> df$month1 <- 1
df[!(df$MATemp1 > (19.5 + df$SDMeanTemp)  & (df$meanRain1>80 || df$meanRain12 > 80 || df$meanRain11>80) &
(df$MARain1 >  60 || df$NDVI12  > 0.35) & df$minAnnualTemp > 5), "month1"] <- 0

My problem is that now I want to use the same logic to obtain a malaria seasonal map covering the whole country, not just evaluating whether a month is suitable at my locations but everywhere that I have raster data.

I want to output something like this but for Kenya: https://db.tt/x0izxff7

I downloaded my NDVI data from the  Land Processes Distributed Active Archive Center (LP DAAC) (https://lpdaac.usgs.gov/, product MOD13A3), and the rest from the WorldClim website. All layers are at 1 km resolution and the NDVI data was resampled to the same geographic projection as temp and rain layers (I used the raster and gdalutils packages to get the data in and for processing). 

My raster layers are in stacks, one stack per enviro/climate layer made up of 12 months each. So meanTempStack has 12 layers representing an aggregated raster layer for each month of the year. I have converted these stacks to data frames keeping track of the coordinates.  These stack data frames (which are in a .rda workspace file) can be downloaded from: 

https://www.dropbox.com/s/uudzadx811gvnv2/rasterStacks.rda

And then once the .rda file is in your workspace, they can be retrieved in the usual way using:

> load("rasterStacks.rda?)

My plan was to merge all these data frames and then apply the same logic as demonstrated above but now for everywhere in Kenya not just at my locations. The problem can be demonstrated by the following (x denotes longitude y latitude):

> merge2 <- merge(meanTempStackDf, rainStackDf,  by = c("x", "y?))
> head(merge2)
        x            y meanTemp1 meanTemp2 meanTemp3 meanTemp4 meanTemp5 meanTemp6 meanTemp7 meanTemp8 meanTemp9 meanTemp10 meanTemp11 meanTemp12 rain1 rain2 rain3 rain4 rain5 rain6 rain7 rain8 rain9 1 33.9125 -0.004166667      23.1      23.3      23.4      22.9      22.4      21.9      21.6      21.6      22.1       22.7       22.6       22.5    52    68   129   172   130    44    34    46    51 2 33.9125  -0.012500000      23.1      23.3      23.4      22.9      22.4      21.9      21.6      21.6      22.1       22.7       22.6       22.5    52    68   128   172   130    44    34    45    50 3 33.9125 -0.020833333      23.1      23.3      23.4      22.9      22.4      21.9      21.6      21.6      22.1       22.7       22.6       22.5    52    68   128   171   130    44    34    45    50 4 33.9125 -0.029166667      23.1      23.3      23.4      22.9      22.4      21.9      21.6      21.6      22.1       22.7       22.7       22.5    51    68   128   171   130    44    34    44    49 5 33.9125 -0.037500000      23.1      23.3      23.4      22.9      22.4      21.9      21.6      21.6      22.1       22.7       22.7       22.5    51    68   128   170   130    44    34    44    49
6 33.9125 -0.045833333      23.1      23.3      23.4      22.9      22.4      21.9      21.6      21.6      22.1       22.7       22.7       22.5    51    68   128   170   130    44    33    44    48  rain10 rain11 rain12 1     73    119     85 2     73    119     85 3     72    119     85 4     72    118     86 5     71    118     86 6     71    118     86

But when I try to merge NDVI with a WorlClim layer there is no ?overlapping? of coordinates:

> merge2 <- merge(meanTempStackDf, rainStackDf,  by = c("x", "y?))
> head(merge2)
 [1] x      y      NDVI1  NDVI2  NDVI3  NDVI4  NDVI5  NDVI6  NDVI7  NDVI8  NDVI9  NDVI10 NDVI11 NDVI12 rain1  rain2  rain3  rain4  rain5  rain6  rain7  rain8  rain9  rain10 rain11 rain12
<0 rows> (or 0-length row.names)

So I am not exactly sure what to do from here. Any thoughts/help would be appreciated. 

Thanks
Justin Michell

From janka.vanschoenwinkel at uhasselt.be  Wed Jun 25 22:32:23 2014
From: janka.vanschoenwinkel at uhasselt.be (Janka VANSCHOENWINKEL)
Date: Wed, 25 Jun 2014 22:32:23 +0200
Subject: [R-sig-Geo] Choropleth map
In-Reply-To: <alpine.LRH.2.03.1406251352240.14482@reclus.nhh.no>
References: <CAHymutKaqonuZdTuyyynZ8KqHHpr6x2JBhWnJkJ0VEYTkBSM2Q@mail.gmail.com>
	<alpine.LRH.2.03.1406251352240.14482@reclus.nhh.no>
Message-ID: <CAHymutLS_0Ug1YTL2oqEmsagKPR9GXvd1PAhTz1AtctGa2MdXw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140625/ab710276/attachment.pl>

From ferra.xu at yahoo.com  Wed Jun 25 22:37:49 2014
From: ferra.xu at yahoo.com (Ferra Xu)
Date: Wed, 25 Jun 2014 13:37:49 -0700
Subject: [R-sig-Geo] plot a 3-D marked point process
Message-ID: <1403728669.73037.YahooMailNeo@web125106.mail.ne1.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140625/c34baa93/attachment.pl>

From Roger.Bivand at nhh.no  Wed Jun 25 22:41:02 2014
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 25 Jun 2014 22:41:02 +0200
Subject: [R-sig-Geo] Choropleth map
In-Reply-To: <CAHymutLS_0Ug1YTL2oqEmsagKPR9GXvd1PAhTz1AtctGa2MdXw@mail.gmail.com>
References: <CAHymutKaqonuZdTuyyynZ8KqHHpr6x2JBhWnJkJ0VEYTkBSM2Q@mail.gmail.com>
	<alpine.LRH.2.03.1406251352240.14482@reclus.nhh.no>
	<CAHymutLS_0Ug1YTL2oqEmsagKPR9GXvd1PAhTz1AtctGa2MdXw@mail.gmail.com>
Message-ID: <alpine.LRH.2.03.1406252232390.15705@reclus.nhh.no>

On Wed, 25 Jun 2014, Janka VANSCHOENWINKEL wrote:

> Thanks for your advice Roger!
>
> I will check you suggestion to use the sp package.

The usual solution to practical problems like yours is to go through step 
by step, and check after each step that the output is as expected (James 
Rooney suggested that the problem might be in the merge step, which is 
quite likely). Sometimes the classes of objects lead to dispatch to 
another method than one envisaged, so that the object returned does not 
have the expected structure.

For obvious reasons, fortify depends on having a well-formed input 
object, so checking at each step is prudent. I'd suggest that doing merge 
manually (in steps involving match(), and checking that the IDs do match 
at the correct lengths) is likely to help, as vector extension can be 
confusing - that in some situations R cycles too short vectors to match 
the required length.

Roger

>
> Next time, I'll also make sure to provide downloadable data, without html.
>
>
>
>
> 2014-06-25 14:00 GMT+02:00 Roger Bivand <Roger.Bivand at nhh.no>:
>
>> Please do *not* post in HTML - all R lists require plain text.
>>
>> You have not provided a reproducible example or access to downloadable
>> data with a script showing your problem. Nobody will try to copy & paste
>> from garbled HTML.
>>
>> You are using ggplot, which mangles spatial objects. If the choropleth map
>> can be created with plot or spplot methods from sp, you can go on to use
>> ggplot, but you will most likely find it harder to debug all the way to
>> ggplot without debugging the objects - so try spplot first.
>>
>> Once that works, you are free to go on to ggplot. Have you looked at Oscar
>> Perpig??n's book on displaying spatial data - your library should have it?
>> Hadley Wickham's approach is to make all the fish into fish soup (fortify),
>> from which it is hard to extract the fish for debugging. Debug the fish
>> first before making your soup, especially checking dimensions.
>>
>> Roger
>>
>>
>> On Tue, 24 Jun 2014, Janka VANSCHOENWINKEL wrote:
>>
>>  Dear list members,
>>>
>>>
>>> I am trying to make a basic choropleth map for all nuts3 regions in Europe
>>> ( = a map where
>>>
>>> regions are colored by the value of a certain variable ??? think for
>>> instance
>>>
>>> about a populations
>>>
>>> density map).
>>>
>>>
>>> I am struggling with this for over a week by now and I always get the same
>>> error message:
>>>
>>> Error: Aesthetics must either be length one, or the same length as
>>>
>>> the dataProblems:ValueMapDf$NUTS_ID
>>>
>>>
>>>
>>> I checked the book ???ggplot2??? from Hadley Weckham and several internet
>>> sources.  They
>>>
>>> document the different steps very properly, but still I don???t know what
>>> I
>>>
>>> am doing wrong.
>>>
>>>
>>> Could somebody help me out, please? Thanks in advance!
>>>
>>> *Below you can find my code. I hope I gave sufficient information,
>>> otherwise, just let me know!*
>>>
>>>
>>>
>>> library(maptools)
>>>
>>> library(ggplot2)
>>>
>>> library(ggmap)
>>>
>>>
>>> # read administrative boundaries (I call the SpatialPolygonsDataFrame:
>>> "nuts" since it contains all nuts3 regions of Europe) )
>>>
>>> nuts <- readShapePoly(fn="NUTS_RG_60M_2006")
>>>
>>> names(nuts)
>>>
>>> [1] "OBJECTID"   "NUTS_ID"    "STAT_LEVL_" "AREA"       "LEN"
>>> "Shape_Leng" "Shape_Area"
>>>
>>>
>>> # Then I have a dataset with over 60000 observations (several observations
>>> per nuts3 region). I take the average of the different
>>>
>>> observations per nuts3 region and save it as "Value"
>>>
>>> # The dataset is called Alldata and MEt is the variable I would like to
>>> map
>>> over the different nuts3 regions
>>>
>>>
>>> Value <- aggregate(Alldata$MEt,list(Alldata$nuts3),mean)
>>>
>>> colnames(Value) <- c("NUTS_ID","ValueMEt")
>>>
>>>
>>> head(Value)
>>>
>>>  NUTS_ID   ValueMEt
>>>
>>> 1   AT111 0.04856170
>>>
>>> 2   AT112 0.05448523
>>>
>>> 3   AT113 0.04563415
>>>
>>> 4   AT121 0.02164469
>>>
>>> 5   AT122 0.02664611
>>>
>>> 6   AT123 0.03163034
>>>
>>>
>>>
>>> # merge map and data: I call the result "ValueMapDf"
>>>
>>> ValueMapDf <- merge(nuts, Value, by.x="NUTS_ID", by.y="NUTS_ID")
>>>
>>> ValueMapDf <- ValueMapDf[order(ValueMapDf$NUTS_ID),]
>>>
>>>
>>>
>>> # then I dropped some regions of the SpatialPolygonsDataFrame, for which I
>>> don't have observations (I did this manually since I didn't
>>>
>>> know if there was a way to do it automatically)
>>>
>>> ValueMapDf<-ValueMapDf[ValueMapDf$OBJECTID > 441,]
>>>
>>> ValueMapDf<-ValueMapDf[ValueMapDf$OBJECTID != 444,]
>>>
>>> ValueMapDf<-ValueMapDf[ValueMapDf$OBJECTID != 447,]
>>>
>>> ???.
>>>
>>>
>>> ValueMapDf<-ValueMapDf[ValueMapDf$OBJECTID != 1927,]
>>>
>>>
>>>
>>> # So far so good: now I continue with plotting my map with the values!
>>> However, as you can see below, here something goes wrong.
>>>
>>> # ggplot mapping
>>>
>>> # data layer
>>>
>>> m0 <- ggplot(data=ValueMapDf)
>>>
>>> # fill with Value data
>>>
>>> m1 <- m0 + geom_polygon(aes(x=long, y=lat, group=ValueMapDf$NUTS_ID,
>>> fill="ValueMapDf$ValueMEt")) + coord_equal()
>>>
>>> # add map with only borders (to have visible borders)
>>>
>>> m2 <- m1 + geom_path(aes(x=long, y=lat, group=ValueMapDf$NUTS_ID),
>>> color='black')
>>>
>>> m2
>>>
>>> Error: Aesthetics must either be length one, or the same length as the
>>> dataProblems:ValueMapDf$NUTS_ID
>>>
>>>
>>>
>>> I also tried:
>>>
>>> qplot(long,lat,data=ValueMapDf, group=ValueMapDf$NUTS_ID,
>>> fill=ValueMapDf$ValueMEt, geom="polygon")
>>>
>>> Regions defined for each Polygons
>>>
>>> Error: Aesthetics must either be length one, or the same length as the
>>> dataProblems:ValueMapDf$ValueMEt, ValueMapDf$NUTS_ID
>>>
>>>
>>>
>>>
>>>
>>>  length(ValueMapDf$OBJECTID)
>>>>
>>>
>>> [1] 1122
>>>
>>>  length(ValueMapDf)
>>>>
>>>
>>> [1] 1122
>>>
>>>  length(ValueMapDf$NUTS_ID)
>>>>
>>>
>>> [1] 1122
>>>
>>>  length(ValueMapDf$ValueMEt)
>>>>
>>>
>>> [1] 1122
>>>
>>>
>>>
>>> *When I write:*
>>>
>>>
>>> m0 <- ggplot(data=ValueMapDf)
>>>
>>> # fill with Value data
>>>
>>> m1 <- m0 + geom_polygon(aes(x=long, y=lat, group=NUTS_ID,
>>> fill="ValueMapDf$ValueMEt")) + coord_equal()
>>>
>>> # add map with only borders (to have visible borders)
>>>
>>> m2 <- m1 + geom_path(aes(x=long, y=lat, group=NUTS_ID), color='black')
>>>
>>> m2
>>>
>>> It get: Error in eval(expr, envir, enclos) : object 'NUTS_ID' not found
>>>
>>>
>>>
>>> Thanks in advance!
>>>
>>>
>>> Janka
>>>
>>>         [[alternative HTML version deleted]]
>>>
>>>
>>>
>> --
>> Roger Bivand
>> Department of Economics, Norwegian School of Economics,
>> Helleveien 30, N-5045 Bergen, Norway.
>> voice: +47 55 95 93 55; fax +47 55 95 91 00
>> e-mail: Roger.Bivand at nhh.no
>>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no

From ferra.xu at yahoo.com  Thu Jun 26 05:05:29 2014
From: ferra.xu at yahoo.com (Ferra Xu)
Date: Wed, 25 Jun 2014 20:05:29 -0700
Subject: [R-sig-Geo] Space-time non-homogeneous Poisson process
Message-ID: <1403751929.43347.YahooMailNeo@web125101.mail.ne1.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140625/cfc1a117/attachment.pl>

From Roger.Bivand at nhh.no  Thu Jun 26 09:42:50 2014
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 26 Jun 2014 09:42:50 +0200
Subject: [R-sig-Geo] plot a 3-D marked point process
In-Reply-To: <1403728669.73037.YahooMailNeo@web125106.mail.ne1.yahoo.com>
References: <1403728669.73037.YahooMailNeo@web125106.mail.ne1.yahoo.com>
Message-ID: <alpine.LRH.2.03.1406260938210.17743@reclus.nhh.no>

Do not post HTML. Do not cross-post (here to r-help). Do be patient - your 
repeat of your posting came just 6 hours after this. People actually sleep 
at night in their time zones. Do provide a reproducible example; 
following the posting guide is always advisable.

Roger Bivand
List admin.

On Wed, 25 Jun 2014, Ferra Xu wrote:

> Hello All
>
> I intend to plot a 3-D marked point process. Could you please help me to 
> find a code or a related package?
>
> Thanks
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no


From j.boutet at conservatoirepicardie.org  Thu Jun 26 12:01:56 2014
From: j.boutet at conservatoirepicardie.org (j.boutet at conservatoirepicardie.org)
Date: Thu, 26 Jun 2014 12:01:56 +0200 (CEST)
Subject: [R-sig-Geo] =?utf-8?q?_R=C3=A9ponse_automatique?=
Message-ID: <201406261001.s5QA1u0u068833@albane6.nfrance.com>




Bonjour,

Je suis absent jusqu'au 4 ao?t prochain.

En cas d'urgence, merci de contacter Francis Meunier, directeur-adjoint :

f.meunier - at - conservatoirepicardie.org



J. Boutet



> From: r-sig-geo-request at r-project.org
> Subject: R-sig-Geo Digest, Vol 130, Issue 20
> Date: Thu, 26 Jun 2014 12:00:03 +0200


From j.boutet at conservatoirepicardie.org  Fri Jun 27 12:02:42 2014
From: j.boutet at conservatoirepicardie.org (j.boutet at conservatoirepicardie.org)
Date: Fri, 27 Jun 2014 12:02:42 +0200 (CEST)
Subject: [R-sig-Geo] =?utf-8?q?_R=C3=A9ponse_automatique?=
Message-ID: <201406271002.s5RA2gGt075983@albane10.nfrance.com>




Bonjour,

Je suis absent jusqu'au 4 ao?t prochain.

En cas d'urgence, merci de contacter Francis Meunier, directeur-adjoint :

f.meunier - at - conservatoirepicardie.org



J. Boutet



> From: r-sig-geo-request at r-project.org
> Subject: R-sig-Geo Digest, Vol 130, Issue 21
> Date: Fri, 27 Jun 2014 12:00:04 +0200


From nevil.amos at gmail.com  Fri Jun 27 12:08:58 2014
From: nevil.amos at gmail.com (nevil amos)
Date: Fri, 27 Jun 2014 20:08:58 +1000
Subject: [R-sig-Geo] Unexpected result from rasterVis::levelplot
Message-ID: <CAN9eD7m+NLC6AkaQHSjPrLMyBik2doTAsxfTUX43w8Ggy_HYeg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140627/aca23495/attachment.pl>

From gbl1 at hi.is  Fri Jun 27 12:30:41 2014
From: gbl1 at hi.is (Gilles Benjamin Leduc)
Date: Fri, 27 Jun 2014 10:30:41 +0000
Subject: [R-sig-Geo] =?utf-8?q?Import_a_=2Esvg_map=3F?=
Message-ID: <4571-53ad4800-1ff-4314b100@36747153>

Hi, 

For making a part of my work, I needed to use another software named Darcy, I fed it with .shp files ans R calculated values, but it gave me back some map with .svg format. 
As their perspective is horible, I need to get them back in R and make a correct graph? Any idea of the way for doing that? I cannot find a way of loading svg, or convert it to shp? 
Best Regards


From oscar.perpinan at gmail.com  Fri Jun 27 13:39:28 2014
From: oscar.perpinan at gmail.com (=?UTF-8?Q?Oscar_Perpi=C3=B1an?=)
Date: Fri, 27 Jun 2014 13:39:28 +0200
Subject: [R-sig-Geo] Unexpected result from rasterVis::levelplot
In-Reply-To: <CAN9eD7m+NLC6AkaQHSjPrLMyBik2doTAsxfTUX43w8Ggy_HYeg@mail.gmail.com>
References: <CAN9eD7m+NLC6AkaQHSjPrLMyBik2doTAsxfTUX43w8Ggy_HYeg@mail.gmail.com>
Message-ID: <CAMLL7bnBPt1aUR-8fu4qVaO1S0msbCQmo-_zXqu32V6M_n7CtA@mail.gmail.com>

Hi,

> I was expecting that levelplot would produce a legend in which the each
> level of the attribute used in the plot was listed once ( and associated
> with a single color in the legend).
> However levelplot is resulting in one level in the legend for each of the
> RAT IDs.

Right, this is what levelplot is supposed to produce. The levels of
your Raster are the unique cell values, and they are defined by the
first column of the RAT. The help page of 'ratify' explains that: "a
RasterLayer is linked to other values via a "Raster Attribute Table"
(RAT). Thus the cell values are an index, whereas the actual values of
interest are in the RAT. The RAT is a data.frame. The first column in
the RAT ("ID") has the unique cell values of the layer; this column
should normally not be changed. The other columns can be of any basic
type (factor, character, integer, numeric or logical)"
Therefore, I can't see any other solution than substituting the values
of your cells using 'subs', 'reclassify', etc.

On the other hand, it is not good practice to access and modify the
slots directly using @. Instead you should use the methods defined in
the package (for example,
http://stackoverflow.com/questions/9900134/is-it-bad-practice-to-access-s4-objects-slots-directly-using)

In this case you should use "levels" and "levels<-":

## Here I assume that R has three levels (three unique cell values)
R <- ratify(R)
rat <- levels(R)[[1]]
rat$alpha <- c("a","b","c")
rat$alphakey <- c(1,2,3)
levels(R) <- rat

> Additionally where the attribute had NA values I expected that these would
> result in a the corresponding cells appearing blank (as NA values in the
> original raster did) however a color is assigned to the "NA" from the
> attribute table and it appears in the legend, but the NA cells in the
> raster istself remain blank.

You have to substitute the NA cells with a value if you need them to
be included in the RAT as a different level.

> grid.arrange(p1,p2,p3,p4,nrow=2, ncol=2)

Last, you can arrange the graphic using lattice::print.trellis instead
of gridExtra::grid.arrange:

print(p1, split = c(1, 1, 2, 2), more = TRUE)
print(p2, split = c(1, 2, 2, 2), more = TRUE)
print(p3, split = c(2, 1, 2, 2), more = TRUE)
print(p4, split = c(2, 2, 2, 2))

Best,

Oscar


From b.rowlingson at lancaster.ac.uk  Fri Jun 27 15:42:46 2014
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Fri, 27 Jun 2014 14:42:46 +0100
Subject: [R-sig-Geo] Import a .svg map?
In-Reply-To: <d4038076a7814ca2bd4ac90ea75e0a0d@EX-1-HT0.lancs.local>
References: <d4038076a7814ca2bd4ac90ea75e0a0d@EX-1-HT0.lancs.local>
Message-ID: <CANVKczNTcyyTMaugx-stcPOiPECnBFUH9hh+xu+Ex5eoY5QmJA@mail.gmail.com>

SVG is a general vector graphics format, which uses XML for its
structure. The coordinate numbers in the SVG could be anything now,
perhaps scaled from 0 to 1 on each axis or something. It might take
some custom processing to recover the SVG into a proper mappable
format.

And if by "their perspective is horible" you mean their projection,
then you'll need the projection specification they are using in order
to back-project that.

What's the nature of the output? Is it values in polygon areas
(shapefile features)? Can you not get Darcy to just output the values
to a text/csv/spreadsheet file, and then link them back to the
shapefile in R (it might be in the same order)?

Any chance you can supply an exemplar SVG on a sharing site somewhere
(dont post it to the group)?

Barry



On Fri, Jun 27, 2014 at 11:30 AM, Gilles Benjamin Leduc <gbl1 at hi.is> wrote:
> Hi,
>
> For making a part of my work, I needed to use another software named Darcy, I fed it with .shp files ans R calculated values, but it gave me back some map with .svg format.
> As their perspective is horible, I need to get them back in R and make a correct graph? Any idea of the way for doing that? I cannot find a way of loading svg, or convert it to shp?
> Best Regards
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From gbl1 at hi.is  Fri Jun 27 15:53:58 2014
From: gbl1 at hi.is (Gilles Benjamin Leduc)
Date: Fri, 27 Jun 2014 13:53:58 +0000
Subject: [R-sig-Geo] =?utf-8?q?Import_a_=2Esvg_map=3F?=
In-Reply-To: <CANVKczNTcyyTMaugx-stcPOiPECnBFUH9hh+xu+Ex5eoY5QmJA@mail.gmail.com>
Message-ID: <d04-53ad7780-267-733dce00@5510020>

 
 
 Hi Barry, 

Thanks for answering ;) 

So the svg is here https://www.dropbox.com/s/ggok7wijxk8hoat/ana-UPGMA.svg 
I can also provide the originel shp (the one coresponding to the blue stuff) 

It seems that Darcy is a dead-end software? French research? No global view? Public funding and no control? Very sad cus it could have been great, and I was about to add in my package a export function to it? anyway? 

Thanks a lot

Benjamin 


Le Vendredi 27 Juin 2014 13:42 GMT, Barry Rowlingson <b.rowlingson at lancaster.ac.uk> a ?crit: 
 
> SVG is a general vector graphics format, which uses XML for its
> structure. The coordinate numbers in the SVG could be anything now,
> perhaps scaled from 0 to 1 on each axis or something. It might take
> some custom processing to recover the SVG into a proper mappable
> format.
> 
> And if by "their perspective is horible" you mean their projection,
> then you'll need the projection specification they are using in order
> to back-project that.
> 
> What's the nature of the output? Is it values in polygon areas
> (shapefile features)? Can you not get Darcy to just output the values
> to a text/csv/spreadsheet file, and then link them back to the
> shapefile in R (it might be in the same order)?
> 
> Any chance you can supply an exemplar SVG on a sharing site somewhere
> (dont post it to the group)?
> 
> Barry
> 
> 
> 
> On Fri, Jun 27, 2014 at 11:30 AM, Gilles Benjamin Leduc <gbl1 at hi.is> wrote:
> > Hi,
> >
> > For making a part of my work, I needed to use another software named Darcy, I fed it with .shp files ans R calculated values, but it gave me back some map with .svg format.
> > As their perspective is horible, I need to get them back in R and make a correct graph? Any idea of the way for doing that? I cannot find a way of loading svg, or convert it to shp?
> > Best Regards
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From b.rowlingson at lancaster.ac.uk  Fri Jun 27 16:24:53 2014
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Fri, 27 Jun 2014 15:24:53 +0100
Subject: [R-sig-Geo] Import a .svg map?
In-Reply-To: <102ad043b3504cb09daf7a57c9f49cc6@EX-0-HT0.lancs.local>
References: <CANVKczNTcyyTMaugx-stcPOiPECnBFUH9hh+xu+Ex5eoY5QmJA@mail.gmail.com>
	<102ad043b3504cb09daf7a57c9f49cc6@EX-0-HT0.lancs.local>
Message-ID: <CANVKczP9jjGPSHuoD_4+RXUustMAqi7op3CTi6jjTCJ8G4YcLQ@mail.gmail.com>

So I see a couple of distorted outlines of Iceland, both quite
flattened N-S (Mercator projection?), and a warped grid over the top,
with what I suppose are 5 control points with green and blue point
pairs...

Is this the output from some kind of warping/registration procedure?
What are you trying to get out? Is your original shapefile in lat-long
and you want a map of Iceland in warped lat-long (ie in the wrong
place)?

The coordinates of the lines in the SVG scale it nicely for putting on
an A4 page so it looks like this is designed for printing and not
further analysis....

 Have you got a link to the software?


On Fri, Jun 27, 2014 at 2:53 PM, Gilles Benjamin Leduc <gbl1 at hi.is> wrote:
>
>
>  Hi Barry,
>
> Thanks for answering ;)
>
> So the svg is here https://www.dropbox.com/s/ggok7wijxk8hoat/ana-UPGMA.svg
> I can also provide the originel shp (the one coresponding to the blue stuff)
>
> It seems that Darcy is a dead-end software? French research? No global view? Public funding and no control? Very sad cus it could have been great, and I was about to add in my package a export function to it? anyway?
>
> Thanks a lot
>
> Benjamin
>
>
> Le Vendredi 27 Juin 2014 13:42 GMT, Barry Rowlingson <b.rowlingson at lancaster.ac.uk> a ?crit:
>
>> SVG is a general vector graphics format, which uses XML for its
>> structure. The coordinate numbers in the SVG could be anything now,
>> perhaps scaled from 0 to 1 on each axis or something. It might take
>> some custom processing to recover the SVG into a proper mappable
>> format.
>>
>> And if by "their perspective is horible" you mean their projection,
>> then you'll need the projection specification they are using in order
>> to back-project that.
>>
>> What's the nature of the output? Is it values in polygon areas
>> (shapefile features)? Can you not get Darcy to just output the values
>> to a text/csv/spreadsheet file, and then link them back to the
>> shapefile in R (it might be in the same order)?
>>
>> Any chance you can supply an exemplar SVG on a sharing site somewhere
>> (dont post it to the group)?
>>
>> Barry
>>
>>
>>
>> On Fri, Jun 27, 2014 at 11:30 AM, Gilles Benjamin Leduc <gbl1 at hi.is> wrote:
>> > Hi,
>> >
>> > For making a part of my work, I needed to use another software named Darcy, I fed it with .shp files ans R calculated values, but it gave me back some map with .svg format.
>> > As their perspective is horible, I need to get them back in R and make a correct graph? Any idea of the way for doing that? I cannot find a way of loading svg, or convert it to shp?
>> > Best Regards
>> >
>> > _______________________________________________
>> > R-sig-Geo mailing list
>> > R-sig-Geo at r-project.org
>> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
>


From gbl1 at hi.is  Fri Jun 27 17:24:02 2014
From: gbl1 at hi.is (Gilles Benjamin Leduc)
Date: Fri, 27 Jun 2014 15:24:02 +0000
Subject: [R-sig-Geo] =?utf-8?q?Import_a_=2Esvg_map=3F?=
In-Reply-To: <CANVKczP9jjGPSHuoD_4+RXUustMAqi7op3CTi6jjTCJ8G4YcLQ@mail.gmail.com>
Message-ID: <7276-53ad8c80-21-54c45180@190306237>

Hi again, 

The software is there http://spatial-modelling.info/Darcy-2-module-de-comparaison 

So indeed it is Iceland (Hi.is tells where I am) 
The blue is the "regular" shape with a strange projection? The green is an anamorphosis. 
Blue points are my actual gps data of sampling, green are "image points" when modifying the geographical position according to the genetical distance (Reynolds index) 

I made up some function to make up the image points (not sure If I pushed it yet) 

As the SVG output is ugly and not suitable for publication, I need to make it cute on R :p

Benjamin 
 
 
Le Vendredi 27 Juin 2014 14:24 GMT, Barry Rowlingson <b.rowlingson at lancaster.ac.uk> a ?crit: 
 
> So I see a couple of distorted outlines of Iceland, both quite
> flattened N-S (Mercator projection?), and a warped grid over the top,
> with what I suppose are 5 control points with green and blue point
> pairs...
> 
> Is this the output from some kind of warping/registration procedure?

> What are you trying to get out? Is your original shapefile in lat-long
> and you want a map of Iceland in warped lat-long (ie in the wrong
> place)?
> 
> The coordinates of the lines in the SVG scale it nicely for putting on
> an A4 page so it looks like this is designed for printing and not
> further analysis....
> 
>  Have you got a link to the software?
> 
> 
> On Fri, Jun 27, 2014 at 2:53 PM, Gilles Benjamin Leduc <gbl1 at hi.is> wrote:
> >
> >
> >  Hi Barry,
> >
> > Thanks for answering ;)
> >
> > So the svg is here https://www.dropbox.com/s/ggok7wijxk8hoat/ana-UPGMA.svg
> > I can also provide the originel shp (the one coresponding to the blue stuff)
> >
> > It seems that Darcy is a dead-end software? French research? No global view? Public funding and no control? Very sad cus it could have been great, and I was about to add in my package a export function to it? anyway?
> >
> > Thanks a lot
> >
> > Benjamin
> >
> >
> > Le Vendredi 27 Juin 2014 13:42 GMT, Barry Rowlingson <b.rowlingson at lancaster.ac.uk> a ?crit:
> >
> >> SVG is a general vector graphics format, which uses XML for its
> >> structure. The coordinate numbers in the SVG could be anything now,
> >> perhaps scaled from 0 to 1 on each axis or something. It might take
> >> some custom processing to recover the SVG into a proper mappable
> >> format.
> >>
> >> And if by "their perspective is horible" you mean their projection,
> >> then you'll need the projection specification they are using in order
> >> to back-project that.
> >>
> >> What's the nature of the output? Is it values in polygon areas
> >> (shapefile features)? Can you not get Darcy to just output the values
> >> to a text/csv/spreadsheet file, and then link them back to the
> >> shapefile in R (it might be in the same order)?
> >>
> >> Any chance you can supply an exemplar SVG on a sharing site somewhere
> >> (dont post it to the group)?
> >>
> >> Barry
> >>
> >>
> >>
> >> On Fri, Jun 27, 2014 at 11:30 AM, Gilles Benjamin Leduc <gbl1 at hi.is> wrote:
> >> > Hi,
> >> >
> >> > For making a part of my work, I needed to use another software named Darcy, I fed it with .shp files ans R calculated values, but it gave me back some map with .svg format.
> >> > As their perspective is horible, I need to get them back in R and make a correct graph? Any idea of the way for doing that? I cannot find a way of loading svg, or convert it to shp?
> >> > Best Regards
> >> >
> >> > _______________________________________________
> >> > R-sig-Geo mailing list
> >> > R-sig-Geo at r-project.org
> >> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
> >
> >


From b.rowlingson at lancaster.ac.uk  Fri Jun 27 18:06:53 2014
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Fri, 27 Jun 2014 17:06:53 +0100
Subject: [R-sig-Geo] Import a .svg map?
In-Reply-To: <632da45493dd46e391de2dae2fc656c8@EX-1-HT0.lancs.local>
References: <CANVKczP9jjGPSHuoD_4+RXUustMAqi7op3CTi6jjTCJ8G4YcLQ@mail.gmail.com>
	<632da45493dd46e391de2dae2fc656c8@EX-1-HT0.lancs.local>
Message-ID: <CANVKczPriijnsi3X+WYQDw8=p=3CE6GvbgpuYg2qBWTfowXA0g@mail.gmail.com>

Playing around with it a bit, you can right-click on a layer in the
legend and get an "Export" option which produces a file containing
some WKT:

ID    geom
background    GEOMETRYCOLLECTION (MULTIPOLYGON (((51146.64788209766
109166.87983294153, 51914.19041081249 114132.5781415662,
 53723.24910049731 114363.53122978129, 54578.8941572942
113080.1977245861, 54642.83015735373 115386.04719873359, 56598.1513751
7477 117295.63286451202, 56050.17479866443 117427.96707263529,
55095.97946977576 119916.59990695301, 58033.90139251192 121691.
4... etc.

By reading this into R and chopping out everything that isn't WKT
(which starts with GEOMETRYCOLLECTION) I can recover a polygon....

The Luxembourg example supplied with the s/w seems to be a bit
different to yours, but if you can see both of your iceland polygons
as layers in the legend you might be able to right-click and export as
WKT and get it into R that way.

For the Lux example, I save background.out.txt and read in:

txt = scan("~/background.out.txt",what="",sep="\t")

then the fourth item is the WKT, so I do:

require(rgeos)
p = readWKT(txt[4])


then I can plot p as a spatial object:

plot(p)

The SVG output does seem to be a representation of what's in the
current view window so not really meant for analysis...

Barry



On Fri, Jun 27, 2014 at 4:24 PM, Gilles Benjamin Leduc <gbl1 at hi.is> wrote:
> Hi again,
>
> The software is there http://spatial-modelling.info/Darcy-2-module-de-comparaison
>
> So indeed it is Iceland (Hi.is tells where I am)
> The blue is the "regular" shape with a strange projection? The green is an anamorphosis.
> Blue points are my actual gps data of sampling, green are "image points" when modifying the geographical position according to the genetical distance (Reynolds index)
>
> I made up some function to make up the image points (not sure If I pushed it yet)
>
> As the SVG output is ugly and not suitable for publication, I need to make it cute on R :p
>
> Benjamin
>
>
> Le Vendredi 27 Juin 2014 14:24 GMT, Barry Rowlingson <b.rowlingson at lancaster.ac.uk> a ?crit:
>
>> So I see a couple of distorted outlines of Iceland, both quite
>> flattened N-S (Mercator projection?), and a warped grid over the top,
>> with what I suppose are 5 control points with green and blue point
>> pairs...
>>
>> Is this the output from some kind of warping/registration procedure?
>
>> What are you trying to get out? Is your original shapefile in lat-long
>> and you want a map of Iceland in warped lat-long (ie in the wrong
>> place)?
>>
>> The coordinates of the lines in the SVG scale it nicely for putting on
>> an A4 page so it looks like this is designed for printing and not
>> further analysis....
>>
>>  Have you got a link to the software?
>>
>>
>> On Fri, Jun 27, 2014 at 2:53 PM, Gilles Benjamin Leduc <gbl1 at hi.is> wrote:
>> >
>> >
>> >  Hi Barry,
>> >
>> > Thanks for answering ;)
>> >
>> > So the svg is here https://www.dropbox.com/s/ggok7wijxk8hoat/ana-UPGMA.svg
>> > I can also provide the originel shp (the one coresponding to the blue stuff)
>> >
>> > It seems that Darcy is a dead-end software? French research? No global view? Public funding and no control? Very sad cus it could have been great, and I was about to add in my package a export function to it? anyway?
>> >
>> > Thanks a lot
>> >
>> > Benjamin
>> >
>> >
>> > Le Vendredi 27 Juin 2014 13:42 GMT, Barry Rowlingson <b.rowlingson at lancaster.ac.uk> a ?crit:
>> >
>> >> SVG is a general vector graphics format, which uses XML for its
>> >> structure. The coordinate numbers in the SVG could be anything now,
>> >> perhaps scaled from 0 to 1 on each axis or something. It might take
>> >> some custom processing to recover the SVG into a proper mappable
>> >> format.
>> >>
>> >> And if by "their perspective is horible" you mean their projection,
>> >> then you'll need the projection specification they are using in order
>> >> to back-project that.
>> >>
>> >> What's the nature of the output? Is it values in polygon areas
>> >> (shapefile features)? Can you not get Darcy to just output the values
>> >> to a text/csv/spreadsheet file, and then link them back to the
>> >> shapefile in R (it might be in the same order)?
>> >>
>> >> Any chance you can supply an exemplar SVG on a sharing site somewhere
>> >> (dont post it to the group)?
>> >>
>> >> Barry
>> >>
>> >>
>> >>
>> >> On Fri, Jun 27, 2014 at 11:30 AM, Gilles Benjamin Leduc <gbl1 at hi.is> wrote:
>> >> > Hi,
>> >> >
>> >> > For making a part of my work, I needed to use another software named Darcy, I fed it with .shp files ans R calculated values, but it gave me back some map with .svg format.
>> >> > As their perspective is horible, I need to get them back in R and make a correct graph? Any idea of the way for doing that? I cannot find a way of loading svg, or convert it to shp?
>> >> > Best Regards
>> >> >
>> >> > _______________________________________________
>> >> > R-sig-Geo mailing list
>> >> > R-sig-Geo at r-project.org
>> >> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> >
>> >
>> >
>
>
>


From ferra.xu at yahoo.com  Fri Jun 27 19:59:09 2014
From: ferra.xu at yahoo.com (Ferra Xu)
Date: Fri, 27 Jun 2014 10:59:09 -0700
Subject: [R-sig-Geo] Generate data follows space-time clustered
	inhomogeneous Poisson point process in 3D space
Message-ID: <1403891949.82546.YahooMailNeo@web125106.mail.ne1.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140627/e4f3c58c/attachment.pl>

From waldircj at gmail.com  Fri Jun 27 21:02:22 2014
From: waldircj at gmail.com (Waldir de Carvalho Junior)
Date: Fri, 27 Jun 2014 16:02:22 -0300
Subject: [R-sig-Geo] join classification of rpart into one
Message-ID: <CAFs5Q4Kb=GooWf5Putd1CmbGodce4bv67Fm_-DDO8-gfTP9u1g@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140627/18965546/attachment.pl>

From j.boutet at conservatoirepicardie.org  Sat Jun 28 12:00:49 2014
From: j.boutet at conservatoirepicardie.org (j.boutet at conservatoirepicardie.org)
Date: Sat, 28 Jun 2014 12:00:49 +0200 (CEST)
Subject: [R-sig-Geo] =?utf-8?q?_R=C3=A9ponse_automatique?=
Message-ID: <201406281000.s5SA0no1038860@albane6.nfrance.com>




Bonjour,

Je suis absent jusqu'au 4 ao?t prochain.

En cas d'urgence, merci de contacter Francis Meunier, directeur-adjoint :

f.meunier - at - conservatoirepicardie.org



J. Boutet



> From: r-sig-geo-request at r-project.org
> Subject: R-sig-Geo Digest, Vol 130, Issue 22
> Date: Sat, 28 Jun 2014 12:00:03 +0200


From j.boutet at conservatoirepicardie.org  Sun Jun 29 12:01:03 2014
From: j.boutet at conservatoirepicardie.org (j.boutet at conservatoirepicardie.org)
Date: Sun, 29 Jun 2014 12:01:03 +0200 (CEST)
Subject: [R-sig-Geo] =?utf-8?q?_R=C3=A9ponse_automatique?=
Message-ID: <201406291001.s5TA132m051329@albane10.nfrance.com>




Bonjour,

Je suis absent jusqu'au 4 ao?t prochain.

En cas d'urgence, merci de contacter Francis Meunier, directeur-adjoint :

f.meunier - at - conservatoirepicardie.org



J. Boutet



> From: r-sig-geo-request at r-project.org
> Subject: R-sig-Geo Digest, Vol 130, Issue 23
> Date: Sun, 29 Jun 2014 12:00:02 +0200


From jwm302 at gmail.com  Mon Jun 30 13:22:49 2014
From: jwm302 at gmail.com (Justin Michell)
Date: Mon, 30 Jun 2014 13:22:49 +0200
Subject: [R-sig-Geo] Raster Layers same resolution but not the
	same	coordinates over the same area
In-Reply-To: <csym1f9skc7sbexltddb6dc3.1403877499889@email.android.com>
References: <FEFE7375-7C62-47E7-B906-BB257581C587@gmail.com>
	<csym1f9skc7sbexltddb6dc3.1403877499889@email.android.com>
Message-ID: <4A71BF68-2BC3-48FC-B988-80CB966F46FF@gmail.com>

Dear Niandou

No I have not received any feedback. 

I do have some thoughts though. Is it possible/or at least would it make sense to get values in NDVI layer (average of nearby cells?) at the coordinates of raster values in other layers which one wants to merge with? 

I am not very well versed in these things so it?s just a thought- not sure how it would be implemented in R. 

Regards
Justin


On Jun 27, 2014, at 3:58 PM, ISSAKA NIANDOU, Yacouba <niandouy at who.int> wrote:

> Niandou


From gbl1 at hi.is  Mon Jun 30 16:10:29 2014
From: gbl1 at hi.is (Gilles Benjamin Leduc)
Date: Mon, 30 Jun 2014 14:10:29 +0000
Subject: [R-sig-Geo] Conversion geographical coodinate in UTM
Message-ID: <4a4f-53b17000-4f-49f92300@154507220>

Hi, 

I need to convert some geographical coordinate it UTM. 
First I have a shapefile: 
Front<-readShapeSpatial("ISL_adm0.shp") 
class(Front)
[1] "SpatialPolygonsDataFrame"

then? I tried this after googling: 
DataUTM <- spTransform(Front, CRS("+proj=utm +zone=27 +north +datum=WGS84"))
Erreur dans spTransform(xSP, CRSobj, ...) : 
  No transformation possible from NA reference system

My UTM area is 27 W (If I understood the system) 

What is wrong? 

Thanks in advance

Benjamin


From sarah.goslee at gmail.com  Mon Jun 30 16:18:15 2014
From: sarah.goslee at gmail.com (Sarah Goslee)
Date: Mon, 30 Jun 2014 10:18:15 -0400
Subject: [R-sig-Geo] Conversion geographical coodinate in UTM
In-Reply-To: <4a4f-53b17000-4f-49f92300@154507220>
References: <4a4f-53b17000-4f-49f92300@154507220>
Message-ID: <CAM_vjukfVKGLgfVpA9XPcPUEyfbgYeS9r+pO=m914mQTK0ws6w@mail.gmail.com>

Hi,

At a guess, your Front dataset doesn't have a CRS set, so
spTransform() doesn't know what to transform *from*.

See the examples in ?spTransform for the whole process, including
setting the CRS for your data.

Sarah

On Mon, Jun 30, 2014 at 10:10 AM, Gilles Benjamin Leduc <gbl1 at hi.is> wrote:
> Hi,
>
> I need to convert some geographical coordinate it UTM.
> First I have a shapefile:
> Front<-readShapeSpatial("ISL_adm0.shp")
> class(Front)
> [1] "SpatialPolygonsDataFrame"
>
> then? I tried this after googling:
> DataUTM <- spTransform(Front, CRS("+proj=utm +zone=27 +north +datum=WGS84"))
> Erreur dans spTransform(xSP, CRSobj, ...) :
>   No transformation possible from NA reference system
>
> My UTM area is 27 W (If I understood the system)
>
> What is wrong?
>
> Thanks in advance
>
> Benjamin
>
-- 
Sarah Goslee
http://www.functionaldiversity.org


From b.rowlingson at lancaster.ac.uk  Mon Jun 30 17:12:05 2014
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Mon, 30 Jun 2014 16:12:05 +0100
Subject: [R-sig-Geo] Conversion geographical coodinate in UTM
In-Reply-To: <e094d64eb1c04c74acfb162f464be5c5@EX-1-HT0.lancs.local>
References: <4a4f-53b17000-4f-49f92300@154507220>
	<e094d64eb1c04c74acfb162f464be5c5@EX-1-HT0.lancs.local>
Message-ID: <CANVKczNb30-SU6RrajTaz4jCvoQwM1KCUk=xts5cEyGf6iNKtg@mail.gmail.com>

On Mon, Jun 30, 2014 at 3:18 PM, Sarah Goslee <sarah.goslee at gmail.com> wrote:
> Hi,
>
> At a guess, your Front dataset doesn't have a CRS set, so

Probably because you've used readShapeSpatial which ignores projection
info from shapefiles...

>> Front<-readShapeSpatial("ISL_adm0.shp")
>> class(Front)
>> [1] "SpatialPolygonsDataFrame"

Use rgdal:

require(rgdal)
Front = readOGR(".","ISL_adm0")

then check Front has a proj4string. summary(Front) should mention it.

This is getting to be the R-sig-geo equivalent of R FAQ 7.31..

Barry


From gbl1 at hi.is  Mon Jun 30 17:33:58 2014
From: gbl1 at hi.is (Gilles Benjamin Leduc)
Date: Mon, 30 Jun 2014 15:33:58 +0000
Subject: [R-sig-Geo] Conversion geographical coodinate in UTM
In-Reply-To: <CANVKczNb30-SU6RrajTaz4jCvoQwM1KCUk=xts5cEyGf6iNKtg@mail.gmail.com>
Message-ID: <4ab9-53b18380-8f-24a21dc0@204299208>

Thanks Barry, 

That's it? Sorry if my question was too simple? I'm not a geograph, I'm a molecular biologist? so I'm not used to these packages ? I started from the simple script I had for normal maps? (and it is monday, brain isn't fully operational!) 

Benjamin

 
 
 
Le Lundi 30 Juin 2014 15:12 GMT, Barry Rowlingson <b.rowlingson at lancaster.ac.uk> a ?crit: 
 
> On Mon, Jun 30, 2014 at 3:18 PM, Sarah Goslee <sarah.goslee at gmail.com> wrote:
> > Hi,
> >
> > At a guess, your Front dataset doesn't have a CRS set, so
> 
> Probably because you've used readShapeSpatial which ignores projection
> info from shapefiles...
> 
> >> Front<-readShapeSpatial("ISL_adm0.shp")
> >> class(Front)
> >> [1] "SpatialPolygonsDataFrame"
> 
> Use rgdal:
> 
> require(rgdal)
> Front = readOGR(".","ISL_adm0")
> 
> then check Front has a proj4string. summary(Front) should mention it.
> 
> This is getting to be the R-sig-geo equivalent of R FAQ 7.31..
> 
> Barry


From jgrn at illinois.edu  Mon Jun 30 17:55:53 2014
From: jgrn at illinois.edu (Jonathan Greenberg)
Date: Mon, 30 Jun 2014 10:55:53 -0500
Subject: [R-sig-Geo] Raster Layers same resolution but not the same
 coordinates over the same area
In-Reply-To: <4A71BF68-2BC3-48FC-B988-80CB966F46FF@gmail.com>
References: <FEFE7375-7C62-47E7-B906-BB257581C587@gmail.com>
	<csym1f9skc7sbexltddb6dc3.1403877499889@email.android.com>
	<4A71BF68-2BC3-48FC-B988-80CB966F46FF@gmail.com>
Message-ID: <CABG0rfvymz-7HXdcPS3DvXzQ9eDuojP-sDWZqxP6+5iuiJ46zQ@mail.gmail.com>

Justin:

It would make more sense, if you insist on working with data.frames,
for you to create a single stack with all of your predictor and
response variables, and then do your extraction -- that way you don't
need to worry about a merge after the fact.  The chances of the
coordinates being EXACT I suspect are very low, which is why the
merge() is failing.

Basically:

mystack <- stack(meanTempStackDf, rainStackDf)

... Then you can extract the data.

--j

On Mon, Jun 30, 2014 at 6:22 AM, Justin Michell <jwm302 at gmail.com> wrote:
> Dear Niandou
>
> No I have not received any feedback.
>
> I do have some thoughts though. Is it possible/or at least would it make sense to get values in NDVI layer (average of nearby cells?) at the coordinates of raster values in other layers which one wants to merge with?
>
> I am not very well versed in these things so it?s just a thought- not sure how it would be implemented in R.
>
> Regards
> Justin
>
>
> On Jun 27, 2014, at 3:58 PM, ISSAKA NIANDOU, Yacouba <niandouy at who.int> wrote:
>
>> Niandou
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



-- 
Jonathan A. Greenberg, PhD
Assistant Professor
Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
Department of Geography and Geographic Information Science
University of Illinois at Urbana-Champaign
259 Computing Applications Building, MC-150
605 East Springfield Avenue
Champaign, IL  61820-6371
Phone: 217-300-1924
http://www.geog.illinois.edu/~jgrn/
AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007


From b.rowlingson at lancaster.ac.uk  Mon Jun 30 18:19:04 2014
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Mon, 30 Jun 2014 17:19:04 +0100
Subject: [R-sig-Geo] Conversion geographical coodinate in UTM
In-Reply-To: <5a3e20375d5b4b30bb2c16ae8547256a@EX-1-HT0.lancs.local>
References: <CANVKczNb30-SU6RrajTaz4jCvoQwM1KCUk=xts5cEyGf6iNKtg@mail.gmail.com>
	<5a3e20375d5b4b30bb2c16ae8547256a@EX-1-HT0.lancs.local>
Message-ID: <CANVKczOBUWZJE897Ax63cOYKhq9S3CE0+cV_WTQ+OLRVi=wSwQ@mail.gmail.com>

Not your fault that readShapeSpatial ignores the projection!

I think Roger recently spoke about fixing these things...

Barry



On Mon, Jun 30, 2014 at 4:33 PM, Gilles Benjamin Leduc <gbl1 at hi.is> wrote:
> Thanks Barry,
>
> That's it? Sorry if my question was too simple? I'm not a geograph, I'm a molecular biologist? so I'm not used to these packages ? I started from the simple script I had for normal maps? (and it is monday, brain isn't fully operational!)
>
> Benjamin
>
>
>
>
> Le Lundi 30 Juin 2014 15:12 GMT, Barry Rowlingson <b.rowlingson at lancaster.ac.uk> a ?crit:
>
>> On Mon, Jun 30, 2014 at 3:18 PM, Sarah Goslee <sarah.goslee at gmail.com> wrote:
>> > Hi,
>> >
>> > At a guess, your Front dataset doesn't have a CRS set, so
>>
>> Probably because you've used readShapeSpatial which ignores projection
>> info from shapefiles...
>>
>> >> Front<-readShapeSpatial("ISL_adm0.shp")
>> >> class(Front)
>> >> [1] "SpatialPolygonsDataFrame"
>>
>> Use rgdal:
>>
>> require(rgdal)
>> Front = readOGR(".","ISL_adm0")
>>
>> then check Front has a proj4string. summary(Front) should mention it.
>>
>> This is getting to be the R-sig-geo equivalent of R FAQ 7.31..
>>
>> Barry
>
>
>


From rvaldezr at gmail.com  Mon Jun 30 19:03:36 2014
From: rvaldezr at gmail.com (Rolando Valdez)
Date: Mon, 30 Jun 2014 12:03:36 -0500
Subject: [R-sig-Geo] Assign coordinates to zip address
Message-ID: <0B9CE8E9-7659-483D-AB0A-933EEA4CF7CB@gmail.com>

Hi everyone,

Is possible assign coordinates to zip address? I?m not sure if it is possible and how could I do it. I have a lot of surveys from a specific urban area and the zip address by survey.

Thank you in advance

Rolando Valdez


From frtog at vestas.com  Mon Jun 30 19:20:43 2014
From: frtog at vestas.com (=?Windows-1252?Q?Frede_Aakmann_T=F8gersen?=)
Date: Mon, 30 Jun 2014 19:20:43 +0200
Subject: [R-sig-Geo] Assign coordinates to zip address
Message-ID: <fajmlirkstkwfj56c7lle1o5.1404148839492@email.android.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140630/6cb6e468/attachment.pl>

From rvaldezr at gmail.com  Mon Jun 30 19:31:55 2014
From: rvaldezr at gmail.com (Rolando Valdez)
Date: Mon, 30 Jun 2014 12:31:55 -0500
Subject: [R-sig-Geo] Assign coordinates to zip address
In-Reply-To: <fajmlirkstkwfj56c7lle1o5.1404148839492@email.android.com>
References: <fajmlirkstkwfj56c7lle1o5.1404148839492@email.android.com>
Message-ID: <106471BD-9EE8-4837-A0AB-8C85DEED3234@gmail.com>

Hi,

The zipcode package provides coordinates by zip code in the U.S. The problem is, the information is not from the U.S., and I don?t need the coordinates by zip code, I have some surveys with the same zip code but different street name and number, as I said, I need the coordinate by survey.

Thank you anyway,

El 30/06/2014, a las 12:20, Frede Aakmann T?gersen <frtog at vestas.com> escribi?:

> Perhaps Google is your friend. Google for:
> 
> r zip code to location
> 
> Br. Frede
> 
> 
> Sendt fra Samsung mobil
> 
> 
> -------- Oprindelig meddelelse --------
> Fra: Rolando Valdez 
> Dato:30/06/2014 19.04 (GMT+01:00) 
> Til: r-sig-geo at r-project.org 
> Emne: [R-sig-Geo] Assign coordinates to zip address 
> 
> Hi everyone,
> 
> Is possible assign coordinates to zip address? I?m not sure if it is possible and how could I do it. I have a lot of surveys from a specific urban area and the zip address by survey.
> 
> Thank you in advance
> 
> Rolando Valdez
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

Rolando Valdez


From roland.harhoff at uni-muenster.de  Mon Jun 30 20:19:37 2014
From: roland.harhoff at uni-muenster.de (Roland Harhoff)
Date: Mon, 30 Jun 2014 20:19:37 +0200 (CEST)
Subject: [R-sig-Geo] Assign coordinates to zip address
In-Reply-To: <106471BD-9EE8-4837-A0AB-8C85DEED3234@gmail.com>
Message-ID: <permail-20140630181937fe5316b600002328-rolandh@message-id.uni-muenster.de>

Rolando, if you do not have any concerns in using google
you may try geocode() from the package ggmap.
Wbr! Roland  : )


Rolando Valdez schrieb am 2014-06-30:
> Hi,

> The zipcode package provides coordinates by zip code in the U.S. The
> problem is, the information is not from the U.S., and I don?t need
> the coordinates by zip code, I have some surveys with the same zip
> code but different street name and number, as I said, I need the
> coordinate by survey.

> Thank you anyway,

> El 30/06/2014, a las 12:20, Frede Aakmann T?gersen <frtog at vestas.com>
> escribi?:

> > Perhaps Google is your friend. Google for:

> > r zip code to location

> > Br. Frede


> > Sendt fra Samsung mobil


> > -------- Oprindelig meddelelse --------
> > Fra: Rolando Valdez
> > Dato:30/06/2014 19.04 (GMT+01:00)
> > Til: r-sig-geo at r-project.org
> > Emne: [R-sig-Geo] Assign coordinates to zip address

> > Hi everyone,

> > Is possible assign coordinates to zip address? I?m not sure if it
> > is possible and how could I do it. I have a lot of surveys from a
> > specific urban area and the zip address by survey.

> > Thank you in advance

> > Rolando Valdez

> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo

> Rolando Valdez

> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From rvaldezr at gmail.com  Mon Jun 30 20:46:52 2014
From: rvaldezr at gmail.com (Rolando Valdez)
Date: Mon, 30 Jun 2014 13:46:52 -0500
Subject: [R-sig-Geo] Assign coordinates to zip address
In-Reply-To: <permail-20140630181937fe5316b600002328-rolandh@message-id.uni-muenster.de>
References: <permail-20140630181937fe5316b600002328-rolandh@message-id.uni-muenster.de>
Message-ID: <A42D22BF-34B1-43D0-ADC5-D71BCE9CAA56@gmail.com>

geocode() works well.

Thank you

El 30/06/2014, a las 13:19, Roland Harhoff <roland.harhoff at uni-muenster.de> escribi?:

> Rolando, if you do not have any concerns in using google
> you may try geocode() from the package ggmap.
> Wbr! Roland  : )
> 
> 
> Rolando Valdez schrieb am 2014-06-30:
>> Hi,
> 
>> The zipcode package provides coordinates by zip code in the U.S. The
>> problem is, the information is not from the U.S., and I don?t need
>> the coordinates by zip code, I have some surveys with the same zip
>> code but different street name and number, as I said, I need the
>> coordinate by survey.
> 
>> Thank you anyway,
> 
>> El 30/06/2014, a las 12:20, Frede Aakmann T?gersen <frtog at vestas.com>
>> escribi?:
> 
>>> Perhaps Google is your friend. Google for:
> 
>>> r zip code to location
> 
>>> Br. Frede
> 
> 
>>> Sendt fra Samsung mobil
> 
> 
>>> -------- Oprindelig meddelelse --------
>>> Fra: Rolando Valdez
>>> Dato:30/06/2014 19.04 (GMT+01:00)
>>> Til: r-sig-geo at r-project.org
>>> Emne: [R-sig-Geo] Assign coordinates to zip address
> 
>>> Hi everyone,
> 
>>> Is possible assign coordinates to zip address? I?m not sure if it
>>> is possible and how could I do it. I have a lot of surveys from a
>>> specific urban area and the zip address by survey.
> 
>>> Thank you in advance
> 
>>> Rolando Valdez
> 
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 
>> Rolando Valdez
> 
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

Rolando Valdez


From Jose.M.Pavia at uv.es  Mon Jun 30 21:25:16 2014
From: Jose.M.Pavia at uv.es (Jose M. Pavia)
Date: Mon, 30 Jun 2014 21:25:16 +0200 (CEST)
Subject: [R-sig-Geo] Assign coordinates to zip address
In-Reply-To: <106471BD-9EE8-4837-A0AB-8C85DEED3234@gmail.com>
References: <106471BD-9EE8-4837-A0AB-8C85DEED3234@gmail.com>
Message-ID: <5573751744pavia@uv.es>

Ronaldo, maybe you can ask to the local authorities of the urban area 
for a file that contains the coordinates for each postal address in 
the area. I made it in the past for research purposes in my city and 
they provide me the file for free. 
Other way, maybe you can create (or ask someome to do it) some kind 
of robot to consult postal addresses in google maps that can collect 
and save the coordinates for you . 

best regards
jm


> Hi,
> 
> The zipcode package provides coordinates by zip code in the U.S. 
The problem is, the information is not from the U.S., and I don?t 
need the coordinates by zip code, I have some surveys with the same 
zip code but different street name and number, as I said, I need the 
coordinate by survey.
> 
> Thank you anyway,
> 
> El 30/06/2014, a las 12:20, Frede Aakmann T?gersen 
<frtog at vestas.com> escribi?:
> 
> > Perhaps Google is your friend. Google for:
> > 
> > r zip code to location
> > 
> > Br. Frede
> > 
> > 
> > Sendt fra Samsung mobil
> > 
> > 
> > -------- Oprindelig meddelelse --------
> > Fra: Rolando Valdez 
> > Dato:30/06/2014 19.04 (GMT+01:00) 
> > Til: r-sig-geo at r-project.org 
> > Emne: [R-sig-Geo] Assign coordinates to zip address 
> > 
> > Hi everyone,
> > 
> > Is possible assign coordinates to zip address? I?m not sure if it 
is possible and how could I do it. I have a lot of surveys from a 
specific urban area and the zip address by survey.
> > 
> > Thank you in advance
> > 
> > Rolando Valdez
> > 
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 
> Rolando Valdez
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 
> 


--
Jose M. Pavia
Quantitative Methods' Professor
Universitat de Valencia
Av Tarongers, s/n
46022 Valencia, Spain
Phone: +34 963 828 404
Fax: +34 963 828 415
e-mail: pavia at uv.es


