From marco.helbich at gmx.at  Wed Aug  1 13:51:49 2007
From: marco.helbich at gmx.at (Marco Helbich)
Date: Wed, 1 Aug 2007 13:51:49 +0200
Subject: [R-sig-Geo] Cliff and Ord modified t-test for autocorrelated
	datasets
Message-ID: <001e01c7d432$5b162620$0300a8c0@mirk>

Dear list,

I've got two autocorrelated datasets and want to perform a two-sample t-test 
comparing the means. Because of the autocorrelation the t-test assumtions 
are violated. In Cliff & Ord (1981, Spatial Processes, Ch. 7.2) I read that 
there is an alternative modified t-test, which considers autocorrelation. Is 
such a test implemented in R or somewhere else? Can anybody give me a 
helping hand?

I appreciate every hint! Thanks.
Marco
__________________

Marco Helbich
ISR
Postgasse 7/4/2
A-1010, Vienna



From Roger.Bivand at nhh.no  Wed Aug  1 15:09:50 2007
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 1 Aug 2007 15:09:50 +0200 (CEST)
Subject: [R-sig-Geo] Cliff and Ord modified t-test for autocorrelated
 datasets
In-Reply-To: <001e01c7d432$5b162620$0300a8c0@mirk>
References: <001e01c7d432$5b162620$0300a8c0@mirk>
Message-ID: <Pine.LNX.4.64.0708011459070.13035@reclus.nhh.no>

On Wed, 1 Aug 2007, Marco Helbich wrote:

> Dear list,
>
> I've got two autocorrelated datasets and want to perform a two-sample t-test
> comparing the means. Because of the autocorrelation the t-test assumtions
> are violated. In Cliff & Ord (1981, Spatial Processes, Ch. 7.2) I read that
> there is an alternative modified t-test, which considers autocorrelation. Is
> such a test implemented in R or somewhere else? Can anybody give me a
> helping hand?

The test isn't implemented as far as I know, but it shouldn't be too 
difficult to try, all of the bits to do the first kind (7.4, 7.8, 7.9) are 
present. What is really needed is a reproducible example so that an 
implementation in R could be checked. I'll see if I still have a copy of 
the 1975 paper somewhere, full-text is not (yet) available for Environment 
& Planning.

Hope this helps,

Roger

>
> I appreciate every hint! Thanks.
> Marco
> __________________
>
> Marco Helbich
> ISR
> Postgasse 7/4/2
> A-1010, Vienna
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From felix at nfrac.org  Thu Aug  2 04:04:10 2007
From: felix at nfrac.org (Felix Andrews)
Date: Thu, 2 Aug 2007 12:04:10 +1000
Subject: [R-sig-Geo] DEM data in R?
Message-ID: <94730b8a0708011904t14e5224dkef184ccbc00dcc1c@mail.gmail.com>

Hi geophiles,

Anyone know of DEM (elevation grid) data in an R package? I know there
is some bathymetry data in PBSmapping, but I am interested in the land
surface.

Generally, how far is it sensible to go in packaging geographic data
for R? It seems inappropriate for a package to be larger than about
25MB (the size of 'mapdata' package).

But if we are to go beyond coastlines, cities and a few rivers, I
would like to see topographic data available.

Felix

-- 
Felix Andrews / ???
PhD candidate
Integrated Catchment Assessment and Management Centre
The Fenner School of Environment and Society
The Australian National University (Building 48A), ACT 0200
Beijing Bag, Locked Bag 40, Kingston ACT 2604
http://www.neurofractal.org/felix/
voice:+86_1051404394 (in China)
mobile:+86_13522529265 (in China)
mobile:+61_410400963 (in Australia)
xmpp:foolish.android at gmail.com
3358 543D AAC6 22C2 D336  80D9 360B 72DD 3E4C F5D8



From mdsumner at utas.edu.au  Thu Aug  2 04:26:23 2007
From: mdsumner at utas.edu.au (Michael Sumner)
Date: Thu, 2 Aug 2007 12:26:23 +1000
Subject: [R-sig-Geo] DEM data in R?
In-Reply-To: <94730b8a0708011904t14e5224dkef184ccbc00dcc1c@mail.gmail.com>
References: <94730b8a0708011904t14e5224dkef184ccbc00dcc1c@mail.gmail.com>
Message-ID: <000501c7d4ac$858f8f70$4627d983@gom>

Hello, 

With rgdal you can access a lot of DEM file formats. 

I don't know of any data in available packages, but the volcano dataset is a
very simple one. See the help page for persp() and volcano. 

I routinely use the ETOPO2 dataset, but I gather you will want far more
detailed local data than that.  

In general I would keep the size of a package down, but if you got a
compelling reason to put it in the package then it's just up to people to
download it.  If there are links to the existing data you want to use, it's
probably better to provide functions that read from those files. So the
package is then not bound to an optional dataset. 

There is an enormous range of ways in which topographic data is stored, so
feel free to ask  - and check out the GDAL/OGR family www.gdal.org and its R
workhorse rgdal. There are some gridded datasets in rgdal but I think (?)
they are all images. 

Finally, if you happened to be interested in global bathymetry, then check
out this reference:

@article{marks2006epa,
  title={{An Evaluation of Publicly Available Global Bathymetry Grids}},
  author={Marks, K.M. and Smith, W.H.F.},
  journal={Marine Geophysical Researches},
  volume={27},
  number={1},
  pages={19--34},
  year={2006},
  publisher={Springer}
}


HTH

Cheers, Mike.

-----Original Message-----
From: r-sig-geo-bounces at stat.math.ethz.ch
[mailto:r-sig-geo-bounces at stat.math.ethz.ch] On Behalf Of Felix Andrews
Sent: Thursday, 2 August 2007 12:04 PM
To: r-sig-geo at stat.math.ethz.ch
Subject: [R-sig-Geo] DEM data in R?

Hi geophiles,

Anyone know of DEM (elevation grid) data in an R package? I know there is
some bathymetry data in PBSmapping, but I am interested in the land surface.

Generally, how far is it sensible to go in packaging geographic data for R?
It seems inappropriate for a package to be larger than about 25MB (the size
of 'mapdata' package).

But if we are to go beyond coastlines, cities and a few rivers, I would like
to see topographic data available.

Felix

--
Felix Andrews / ???
PhD candidate
Integrated Catchment Assessment and Management Centre The Fenner School of
Environment and Society The Australian National University (Building 48A),
ACT 0200 Beijing Bag, Locked Bag 40, Kingston ACT 2604
http://www.neurofractal.org/felix/
voice:+86_1051404394 (in China)
mobile:+86_13522529265 (in China)
mobile:+61_410400963 (in Australia)
xmpp:foolish.android at gmail.com
3358 543D AAC6 22C2 D336  80D9 360B 72DD 3E4C F5D8

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at stat.math.ethz.ch
https://stat.ethz.ch/mailman/listinfo/r-sig-geo



From adrian at maths.uwa.edu.au  Thu Aug  2 05:27:46 2007
From: adrian at maths.uwa.edu.au (adrian at maths.uwa.edu.au)
Date: Thu, 2 Aug 2007 11:27:46 +0800 (WST)
Subject: [R-sig-Geo]  Moving Average/Surface
In-Reply-To: <mailman.17.1185962408.9006.r-sig-geo@stat.math.ethz.ch>
References: <mailman.17.1185962408.9006.r-sig-geo@stat.math.ethz.ch>
Message-ID: <43461.130.95.98.17.1186025266.squirrel@130.95.98.17>


> From: "sibonile sibanda" <sibonile at gmail.com>
> Subject: [R-sig-Geo] Moving Average/Surface
>
> Is there a way to do moving average interpolation or moving surface in R
> from point data?


In the `spatstat' package the function density.ppp has an argument
`weights'. This can be used to perform spatial interpolation of values
recorded at arbitrary point locations, using kernel smoothing. Suppose X
is the point pattern of locations (an object of class "ppp") and Y is the
corresponding vector of values to be interpolated. Then
            num <- density(X, weights=Y)
            den <- density(X)
            Z <- eval.im(num/den)
calculates the standard kernel-weighted average. The argument `sigma' of
density.ppp can be used to control the smoothing bandwidth. The result Z
is a pixel image (object of class "im") that can be plotted using plot.im,
contour.im, image.im, persp.im etc.

For other kinds of smoothing, look at package `akima'

Adrian Baddeley



From hi_ono2001 at yahoo.co.jp  Thu Aug  2 23:27:15 2007
From: hi_ono2001 at yahoo.co.jp (Hisaji ONO)
Date: Fri, 3 Aug 2007 06:27:15 +0900 (JST)
Subject: [R-sig-Geo] Availability of ESDA for R
Message-ID: <20070802212715.84027.qmail@web10713.mail.bbt.yahoo.co.jp>

Hello.

 Does anyone know whether ESDA like GeoDa is available for
R or not?


 Regards.



From marco.helbich at gmx.at  Fri Aug  3 12:48:26 2007
From: marco.helbich at gmx.at (Marco Helbich)
Date: Fri, 3 Aug 2007 12:48:26 +0200
Subject: [R-sig-Geo] R-sig-Geo Digest, Vol 48, Issue 3
References: <mailman.29.1186135210.16970.r-sig-geo@stat.math.ethz.ch>
Message-ID: <002e01c7d5bb$d2937bf0$0300a8c0@mirk>

Dear Hisaji,

I know the following possibilities:

GGOBI:
http://www.ggobi.org/publications/2001-dsc.pdf
http://www.ggobi.org/publications/2003-dsc.pdf

GEOXP:
http://w3.univ-tlse1.fr/GREMAQ/Statistique/geoxppageR.htm

Best regards,
Marco Helbich


----- Original Message ----- 
From: <r-sig-geo-request at stat.math.ethz.ch>
To: <r-sig-geo at stat.math.ethz.ch>
Sent: Friday, August 03, 2007 12:00 PM
Subject: R-sig-Geo Digest, Vol 48, Issue 3


> Send R-sig-Geo mailing list submissions to
> r-sig-geo at stat.math.ethz.ch
> 
> To subscribe or unsubscribe via the World Wide Web, visit
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> or, via email, send a message with subject or body 'help' to
> r-sig-geo-request at stat.math.ethz.ch
> 
> You can reach the person managing the list at
> r-sig-geo-owner at stat.math.ethz.ch
> 
> When replying, please edit your Subject line so it is more specific
> than "Re: Contents of R-sig-Geo digest..."
> 
> 
> Today's Topics:
> 
>   1. Availability of ESDA for R (Hisaji ONO)
> 
> 
> ----------------------------------------------------------------------
> 
> Message: 1
> Date: Fri, 3 Aug 2007 06:27:15 +0900 (JST)
> From: Hisaji ONO <hi_ono2001 at yahoo.co.jp>
> Subject: [R-sig-Geo] Availability of ESDA for R
> To: r-sig-geo at stat.math.ethz.ch
> Message-ID: <20070802212715.84027.qmail at web10713.mail.bbt.yahoo.co.jp>
> Content-Type: text/plain; charset=iso-2022-jp
> 
> Hello.
> 
> Does anyone know whether ESDA like GeoDa is available for
> R or not?
> 
> 
> Regards.
> 
> 
> 
> ------------------------------
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 
> 
> End of R-sig-Geo Digest, Vol 48, Issue 3
> ****************************************
>



From hi_ono2001 at ybb.ne.jp  Fri Aug  3 13:03:14 2007
From: hi_ono2001 at ybb.ne.jp (Hisaji ONO)
Date: Fri, 3 Aug 2007 20:03:14 +0900 (JST)
Subject: [R-sig-Geo] R-sig-Geo Digest, Vol 48, Issue 3
In-Reply-To: <002e01c7d5bb$d2937bf0$0300a8c0@mirk>
Message-ID: <20070803110314.5785.qmail@web10715.mail.bbt.yahoo.co.jp>

Dear Marco

 Thank you very much for your info.


--- Marco Helbich <marco.helbich at gmx.at> wrote:

> Dear Hisaji,
> 
> I know the following possibilities:
> 
> GGOBI:
> http://www.ggobi.org/publications/2001-dsc.pdf
> http://www.ggobi.org/publications/2003-dsc.pdf
> 
> GEOXP:
>
http://w3.univ-tlse1.fr/GREMAQ/Statistique/geoxppageR.htm
> 
> Best regards,
> Marco Helbich
> 
> 
> ----- Original Message ----- 
> From: <r-sig-geo-request at stat.math.ethz.ch>
> To: <r-sig-geo at stat.math.ethz.ch>
> Sent: Friday, August 03, 2007 12:00 PM
> Subject: R-sig-Geo Digest, Vol 48, Issue 3
> 
> 
> > Send R-sig-Geo mailing list submissions to
> > r-sig-geo at stat.math.ethz.ch
> > 
> > To subscribe or unsubscribe via the World Wide
> Web, visit
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > or, via email, send a message with subject or body
> 'help' to
> > r-sig-geo-request at stat.math.ethz.ch
> > 
> > You can reach the person managing the list at
> > r-sig-geo-owner at stat.math.ethz.ch
> > 
> > When replying, please edit your Subject line so it
> is more specific
> > than "Re: Contents of R-sig-Geo digest..."
> > 
> > 
> > Today's Topics:
> > 
> >   1. Availability of ESDA for R (Hisaji ONO)
> > 
> > 
> >
>
----------------------------------------------------------------------
> > 
> > Message: 1
> > Date: Fri, 3 Aug 2007 06:27:15 +0900 (JST)
> > From: Hisaji ONO <hi_ono2001 at yahoo.co.jp>
> > Subject: [R-sig-Geo] Availability of ESDA for R
> > To: r-sig-geo at stat.math.ethz.ch
> > Message-ID:
>
<20070802212715.84027.qmail at web10713.mail.bbt.yahoo.co.jp>
> > Content-Type: text/plain; charset=iso-2022-jp
> > 
> > Hello.
> > 
> > Does anyone know whether ESDA like GeoDa is
> available for
> > R or not?
> > 
> > 
> > Regards.
> > 
> > 
> > 
> > ------------------------------
> > 
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at stat.math.ethz.ch
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > 
> > 
> > End of R-sig-Geo Digest, Vol 48, Issue 3
> > ****************************************
> >
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



From fieldsh at mail.med.upenn.edu  Mon Aug  6 20:05:50 2007
From: fieldsh at mail.med.upenn.edu (Sam Field)
Date: Mon, 06 Aug 2007 14:05:50 -0400
Subject: [R-sig-Geo] spatially correlated heterosckedasticity and spatial
 econometric models
In-Reply-To: <20070803110314.5785.qmail@web10715.mail.bbt.yahoo.co.jp>
References: <20070803110314.5785.qmail@web10715.mail.bbt.yahoo.co.jp>
Message-ID: <46B762FE.4090402@mail.med.upenn.edu>

List,

It seems like a sensible model for ecological level influences would be 
a multi-level model in which the level two equation incorporates some 
kind of spatial influence.  For example, if Y[i,j] is an outcome for the 
ith individual nested within  jth second level observation (e.g. census 
tract), then (sorry for the awkward notation). 

Y[i,j] = b[0,j] + b1*X1[i,j] + b2*X2[i,j] + ...+ bp*Xp[i,j] + e[i,j]

where

b[0,j] = (I- rho*W)^-1(g00 + g1*Z[j] + g2*Z2[j] + ...+ gq*Zq[i,j] + u[j])

The second equation is basically the spatial lag model in the reduced form.


I have seen examples where the parameters of this model are estimated in 
two stages.   This probably works




-- 
Samuel H. Field
Division of Internal Medicine - University of Pennsylvania
CHERP - Philadelphia VA Medical Center
3900 Woodland Ave (9 East)
Philadelphia, PA 19104
(215) 823-5800 EXT. 6155 (Office)
(215) 823-6330 (Fax)



From fieldsh at mail.med.upenn.edu  Mon Aug  6 20:22:56 2007
From: fieldsh at mail.med.upenn.edu (Sam Field)
Date: Mon, 06 Aug 2007 14:22:56 -0400
Subject: [R-sig-Geo] spatially correlated heterosckedasticity and spatial
 econometric models (cont.)
Message-ID: <46B76700.7010808@mail.med.upenn.edu>

Sorry about that - I hit "send" to soon! As I was saying...

List,

It seems like a sensible model for ecological level influences would be 
a multi-level model in which the level two equation incorporates some 
kind of spatial influence.  For example, if Y[i,j] is an outcome for the 
ith individual nested within  jth second level observation (e.g. census 
tract), then (sorry for the awkward notation).
Y[i,j] = b[0,j] + b1*X1[i,j] + b2*X2[i,j] + ...+ bp*Xp[i,j] + e[i,j]

where

b[0,j] = (I- rho*W)-1(g00 + g1*Z[j] + g2*Z2[j] + ...+ gq*Zq[i,j] + u[j])

The second equation is basically the spatial lag model in the reduced form.

I have seen examples where the parameters of this model are estimated in 
two stages.   In the first stage, a multi-level model is estimated and 
estimates of b[0,j] are obtained.  These estimates of ecological level 
influences can then be modeled using the spatial models in the spdep 
package. In simulations, I have seen that this two-step procedure sort 
of works- EXCEPT that in the real world, the reliability of the b[0,j] 
are not only variable (they depend on the within cluster sample size - 
n[j]), but spatially correlated (since the size of the level two units 
are unlikely to satisfy CSR).  In simulations, I have seen that the 
spatial parameters are inconsistent in the limited case of the example 
that on which I am currently working.  (I have not looked at the case in 
which the n[j] are CSR)

My question:  Is there a way of correcting the estimates of a spatial 
lag model (for example) when the source of the spatially correlated 
heterosckedaticity is known?   Maybe through a transformation of W? 


Any thoughts references would be greatly appreciated?  Sorry of the 
multiple postings!

Sam




-- 
Samuel H. Field
Division of Internal Medicine - University of Pennsylvania
CHERP - Philadelphia VA Medical Center
3900 Woodland Ave (9 East)
Philadelphia, PA 19104
(215) 823-5800 EXT. 6155 (Office)
(215) 823-6330 (Fax)



From felix at nfrac.org  Wed Aug  8 06:03:10 2007
From: felix at nfrac.org (Felix Andrews)
Date: Wed, 8 Aug 2007 14:03:10 +1000
Subject: [R-sig-Geo] get rgdal to read ENVI raster?
Message-ID: <94730b8a0708072103s3a31381cwe119c7804ec3cd54@mail.gmail.com>

Hi,

I am trying to use rgdal to read in an "ENVI .hdr labelled raster"
--see http://www.gdal.org/frmt_various.html#ENVI
but GDAL uses the wrong driver, "ESRI .hdr labelled"
--see http://www.gdal.org/frmt_various.html#EHdr

So the imported grid data is just noise.
I can not figure out how to make GDAL/rgdal use the ENVI driver.
Suggestions would be appreciated.

The .hdr file contains:
NCOLS      200
NROWS      200
XLLCORNER    148.50000000000
YLLCORNER   -37.002500000000
CELLSIZE    0.10000000000000E-01
NODATA_VALUE   -9999.000
BYTEORDER LSBFIRST


> sessionInfo()
R version 2.5.1 (2007-06-27)
i386-pc-mingw32

locale:
LC_COLLATE=English_Australia.1252;LC_CTYPE=English_Australia.1252;LC_MONETARY=English_Australia.1252;LC_NUMERIC=C;LC_TIME=English_Australia.1252

attached base packages:
[1] "stats"     "graphics"  "grDevices" "utils"     "datasets"
"methods"   "base"

other attached packages:
         rgdal       RArcInfo       maptools        foreign
 sp    hydrosanity
      "0.5-14"        "0.4-7"       "0.6-14"       "0.8-20"
"0.9-14"       "0.8.57"
plotAndPlayGTK    cairoDevice          RGtk2        lattice
      "0.8.55"          "2.3"      "2.10.13"       "0.16-2"


-- 
Felix Andrews / ???
PhD candidate
Integrated Catchment Assessment and Management Centre
The Fenner School of Environment and Society
The Australian National University (Building 48A), ACT 0200
Beijing Bag, Locked Bag 40, Kingston ACT 2604
http://www.neurofractal.org/felix/
voice:+86_1051404394 (in China)
mobile:+86_13522529265 (in China)
mobile:+61_410400963 (in Australia)
xmpp:foolish.android at gmail.com
3358 543D AAC6 22C2 D336  80D9 360B 72DD 3E4C F5D8



From felix at nfrac.org  Wed Aug  8 06:10:26 2007
From: felix at nfrac.org (Felix Andrews)
Date: Wed, 8 Aug 2007 14:10:26 +1000
Subject: [R-sig-Geo] get rgdal to read ENVI raster?
In-Reply-To: <94730b8a0708072103s3a31381cwe119c7804ec3cd54@mail.gmail.com>
References: <94730b8a0708072103s3a31381cwe119c7804ec3cd54@mail.gmail.com>
Message-ID: <94730b8a0708072110i66f7df63y6656e6d0537c7e07@mail.gmail.com>

Sorry, I just realised that it is not an ENVI raster after all.
Looks like it is a "ESRI binary raster format" described at
http://coastwatch.noaa.gov/cw_form_br.html
and there does not seem to be a GDAL driver for it.


On 8/8/07, Felix Andrews <felix at nfrac.org> wrote:
> Hi,
>
> I am trying to use rgdal to read in an "ENVI .hdr labelled raster"
> --see http://www.gdal.org/frmt_various.html#ENVI
> but GDAL uses the wrong driver, "ESRI .hdr labelled"
> --see http://www.gdal.org/frmt_various.html#EHdr
>
> So the imported grid data is just noise.
> I can not figure out how to make GDAL/rgdal use the ENVI driver.
> Suggestions would be appreciated.
>
> The .hdr file contains:
> NCOLS      200
> NROWS      200
> XLLCORNER    148.50000000000
> YLLCORNER   -37.002500000000
> CELLSIZE    0.10000000000000E-01
> NODATA_VALUE   -9999.000
> BYTEORDER LSBFIRST
>
>
> > sessionInfo()
> R version 2.5.1 (2007-06-27)
> i386-pc-mingw32
>
> locale:
> LC_COLLATE=English_Australia.1252;LC_CTYPE=English_Australia.1252;LC_MONETARY=English_Australia.1252;LC_NUMERIC=C;LC_TIME=English_Australia.1252
>
> attached base packages:
> [1] "stats"     "graphics"  "grDevices" "utils"     "datasets"
> "methods"   "base"
>
> other attached packages:
>          rgdal       RArcInfo       maptools        foreign
>  sp    hydrosanity
>       "0.5-14"        "0.4-7"       "0.6-14"       "0.8-20"
> "0.9-14"       "0.8.57"
> plotAndPlayGTK    cairoDevice          RGtk2        lattice
>       "0.8.55"          "2.3"      "2.10.13"       "0.16-2"
>
>
> --
> Felix Andrews / ???
> PhD candidate
> Integrated Catchment Assessment and Management Centre
> The Fenner School of Environment and Society
> The Australian National University (Building 48A), ACT 0200
> Beijing Bag, Locked Bag 40, Kingston ACT 2604
> http://www.neurofractal.org/felix/
> voice:+86_1051404394 (in China)
> mobile:+86_13522529265 (in China)
> mobile:+61_410400963 (in Australia)
> xmpp:foolish.android at gmail.com
> 3358 543D AAC6 22C2 D336  80D9 360B 72DD 3E4C F5D8
>


-- 
Felix Andrews / ???
PhD candidate
Integrated Catchment Assessment and Management Centre
The Fenner School of Environment and Society
The Australian National University (Building 48A), ACT 0200
Beijing Bag, Locked Bag 40, Kingston ACT 2604
http://www.neurofractal.org/felix/
voice:+86_1051404394 (in China)
mobile:+86_13522529265 (in China)
mobile:+61_410400963 (in Australia)
xmpp:foolish.android at gmail.com
3358 543D AAC6 22C2 D336  80D9 360B 72DD 3E4C F5D8



From felix at nfrac.org  Wed Aug  8 07:40:36 2007
From: felix at nfrac.org (Felix Andrews)
Date: Wed, 8 Aug 2007 15:40:36 +1000
Subject: [R-sig-Geo] get rgdal to read ENVI raster?
In-Reply-To: <94730b8a0708072239v6c1d24c0p1dd9aa5e6cea19d6@mail.gmail.com>
References: <94730b8a0708072103s3a31381cwe119c7804ec3cd54@mail.gmail.com>
	<94730b8a0708072110i66f7df63y6656e6d0537c7e07@mail.gmail.com>
	<000001c7d973$05297d20$4627d983@gom>
	<94730b8a0708072239v6c1d24c0p1dd9aa5e6cea19d6@mail.gmail.com>
Message-ID: <94730b8a0708072240x76d3f1d0rbbd6790d15bad335@mail.gmail.com>

Thanks Michael

The extension is "flt" (float type). This resulted in a sensible image:

foo <- readBin("G:/Projects/Tuross/surface_files/rainfall_surface/year2000/rainGrid_20001.flt",
"double", n=200*200, size=4, endian="little")
foo[foo==-9999] <- NA
range(foo, finite=T)
# 18.83187 80.23850
image(matrix(foo, ncol=200))
# sensible image, but flipped vertically I think

This is what GDAL does:

grid1 <- readGDAL("G:/Projects/Tuross/surface_files/rainfall_surface/year2000/rainGrid_20001.flt")
# G:/Projects/Tuross/surface_files/rainfall_surface/year2000/rainGrid_20001.flt
has GDAL driver EHdr
# and has 200 rows and 200 columns
# Closing GDAL dataset handle 0x02248358...  destroyed ... done.
str(grid1 at data[[1]])
# int [1:40000] 118 215 97 66 180 213 96 66 23 133 ...

So the problem is that it thinks it is an integer type, whereas in
fact it is a 4-byte float type.

As a temporary hack, maybe I can use GDAL to import it, then just
replace the @data slot with the correct numeric data.

Felix

On 8/8/07, Michael Sumner <mdsumner at utas.edu.au> wrote:
> Hi Felix, can you provide the file? The Ehdr driver is probably right, but
> you might have some trouble with the values being interpreted.
>
> I'd like to see more information about the "just noise" data.
>
>
> Cheers, Mike.
>
> -----Original Message-----
> From: r-sig-geo-bounces at stat.math.ethz.ch
> [mailto:r-sig-geo-bounces at stat.math.ethz.ch] On Behalf Of Felix Andrews
> Sent: Wednesday, 8 August 2007 2:10 PM
> To: r-sig-geo at stat.math.ethz.ch
> Subject: Re: [R-sig-Geo] get rgdal to read ENVI raster?
>
> Sorry, I just realised that it is not an ENVI raster after all.
> Looks like it is a "ESRI binary raster format" described at
> http://coastwatch.noaa.gov/cw_form_br.html
> and there does not seem to be a GDAL driver for it.
>
>
> On 8/8/07, Felix Andrews <felix at nfrac.org> wrote:
> > Hi,
> >
> > I am trying to use rgdal to read in an "ENVI .hdr labelled raster"
> > --see http://www.gdal.org/frmt_various.html#ENVI
> > but GDAL uses the wrong driver, "ESRI .hdr labelled"
> > --see http://www.gdal.org/frmt_various.html#EHdr
> >
> > So the imported grid data is just noise.
> > I can not figure out how to make GDAL/rgdal use the ENVI driver.
> > Suggestions would be appreciated.
> >
> > The .hdr file contains:
> > NCOLS      200
> > NROWS      200
> > XLLCORNER    148.50000000000
> > YLLCORNER   -37.002500000000
> > CELLSIZE    0.10000000000000E-01
> > NODATA_VALUE   -9999.000
> > BYTEORDER LSBFIRST
> >
> >
> > > sessionInfo()
> > R version 2.5.1 (2007-06-27)
> > i386-pc-mingw32
> >
> > locale:
> > LC_COLLATE=English_Australia.1252;LC_CTYPE=English_Australia.1252;LC_M
> > ONETARY=English_Australia.1252;LC_NUMERIC=C;LC_TIME=English_Australia.
> > 1252
> >
> > attached base packages:
> > [1] "stats"     "graphics"  "grDevices" "utils"     "datasets"
> > "methods"   "base"
> >
> > other attached packages:
> >          rgdal       RArcInfo       maptools        foreign
> >  sp    hydrosanity
> >       "0.5-14"        "0.4-7"       "0.6-14"       "0.8-20"
> > "0.9-14"       "0.8.57"
> > plotAndPlayGTK    cairoDevice          RGtk2        lattice
> >       "0.8.55"          "2.3"      "2.10.13"       "0.16-2"
> >
> >
> > --
> > Felix Andrews / ???
> > PhD candidate
> > Integrated Catchment Assessment and Management Centre The Fenner
> > School of Environment and Society The Australian National University
> > (Building 48A), ACT 0200 Beijing Bag, Locked Bag 40, Kingston ACT 2604
> > http://www.neurofractal.org/felix/
> > voice:+86_1051404394 (in China)
> > mobile:+86_13522529265 (in China)
> > mobile:+61_410400963 (in Australia)
> > xmpp:foolish.android at gmail.com
> > 3358 543D AAC6 22C2 D336  80D9 360B 72DD 3E4C F5D8
> >
>
>
> --
> Felix Andrews / ???
> PhD candidate
> Integrated Catchment Assessment and Management Centre The Fenner School of
> Environment and Society The Australian National University (Building 48A),
> ACT 0200 Beijing Bag, Locked Bag 40, Kingston ACT 2604
> http://www.neurofractal.org/felix/
> voice:+86_1051404394 (in China)
> mobile:+86_13522529265 (in China)
> mobile:+61_410400963 (in Australia)
> xmpp:foolish.android at gmail.com
> 3358 543D AAC6 22C2 D336  80D9 360B 72DD 3E4C F5D8
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>


--
Felix Andrews / ???
PhD candidate
Integrated Catchment Assessment and Management Centre
The Fenner School of Environment and Society
The Australian National University (Building 48A), ACT 0200
Beijing Bag, Locked Bag 40, Kingston ACT 2604
http://www.neurofractal.org/felix/
voice:+86_1051404394 (in China)
mobile:+86_13522529265 (in China)
mobile:+61_410400963 (in Australia)
xmpp:foolish.android at gmail.com
3358 543D AAC6 22C2 D336  80D9 360B 72DD 3E4C F5D8



From Greg.Battle.ctr at hanscom.af.mil  Mon Aug  6 18:51:59 2007
From: Greg.Battle.ctr at hanscom.af.mil (Battle Gregory Ctr AFRL/VSBYA)
Date: Mon, 6 Aug 2007 12:51:59 -0400
Subject: [R-sig-Geo] Generating 3D Plots
Message-ID: <1A41A511608ED34DA00F6F0272898DCE01B8413F@VFOHMLAO13.Enterprise.afmc.ds.af.mil>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070806/acfc780f/attachment.pl>

From Roger.Bivand at nhh.no  Wed Aug  8 14:26:00 2007
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 8 Aug 2007 14:26:00 +0200 (CEST)
Subject: [R-sig-Geo] get rgdal to read ENVI raster?
In-Reply-To: <94730b8a0708072240x76d3f1d0rbbd6790d15bad335@mail.gmail.com>
References: <94730b8a0708072103s3a31381cwe119c7804ec3cd54@mail.gmail.com>
	<94730b8a0708072110i66f7df63y6656e6d0537c7e07@mail.gmail.com>
	<000001c7d973$05297d20$4627d983@gom>
	<94730b8a0708072239v6c1d24c0p1dd9aa5e6cea19d6@mail.gmail.com>
	<94730b8a0708072240x76d3f1d0rbbd6790d15bad335@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0708081422410.24449@reclus.nhh.no>

On Wed, 8 Aug 2007, Felix Andrews wrote:

> Thanks Michael
>
> The extension is "flt" (float type). This resulted in a sensible image:
>
> foo <- readBin("G:/Projects/Tuross/surface_files/rainfall_surface/year2000/rainGrid_20001.flt",
> "double", n=200*200, size=4, endian="little")
> foo[foo==-9999] <- NA
> range(foo, finite=T)
> # 18.83187 80.23850
> image(matrix(foo, ncol=200))
> # sensible image, but flipped vertically I think
>
> This is what GDAL does:
>
> grid1 <- readGDAL("G:/Projects/Tuross/surface_files/rainfall_surface/year2000/rainGrid_20001.flt")
> # G:/Projects/Tuross/surface_files/rainfall_surface/year2000/rainGrid_20001.flt
> has GDAL driver EHdr
> # and has 200 rows and 200 columns
> # Closing GDAL dataset handle 0x02248358...  destroyed ... done.
> str(grid1 at data[[1]])
> # int [1:40000] 118 215 97 66 180 213 96 66 23 133 ...
>
> So the problem is that it thinks it is an integer type, whereas in
> fact it is a 4-byte float type.
>
> As a temporary hack, maybe I can use GDAL to import it, then just
> replace the @data slot with the correct numeric data.

I think you'll find that the data are integer - the rgdal code simply 
calls GDAL anyway (in your case on Windows freshly built GDAL 1.4.2). What 
does gdalinfo say about the file - I guess you have GDAL utilities 
installed on your system somewhere?

Roger

>
> Felix
>
> On 8/8/07, Michael Sumner <mdsumner at utas.edu.au> wrote:
>> Hi Felix, can you provide the file? The Ehdr driver is probably right, but
>> you might have some trouble with the values being interpreted.
>>
>> I'd like to see more information about the "just noise" data.
>>
>>
>> Cheers, Mike.
>>
>> -----Original Message-----
>> From: r-sig-geo-bounces at stat.math.ethz.ch
>> [mailto:r-sig-geo-bounces at stat.math.ethz.ch] On Behalf Of Felix Andrews
>> Sent: Wednesday, 8 August 2007 2:10 PM
>> To: r-sig-geo at stat.math.ethz.ch
>> Subject: Re: [R-sig-Geo] get rgdal to read ENVI raster?
>>
>> Sorry, I just realised that it is not an ENVI raster after all.
>> Looks like it is a "ESRI binary raster format" described at
>> http://coastwatch.noaa.gov/cw_form_br.html
>> and there does not seem to be a GDAL driver for it.
>>
>>
>> On 8/8/07, Felix Andrews <felix at nfrac.org> wrote:
>>> Hi,
>>>
>>> I am trying to use rgdal to read in an "ENVI .hdr labelled raster"
>>> --see http://www.gdal.org/frmt_various.html#ENVI
>>> but GDAL uses the wrong driver, "ESRI .hdr labelled"
>>> --see http://www.gdal.org/frmt_various.html#EHdr
>>>
>>> So the imported grid data is just noise.
>>> I can not figure out how to make GDAL/rgdal use the ENVI driver.
>>> Suggestions would be appreciated.
>>>
>>> The .hdr file contains:
>>> NCOLS      200
>>> NROWS      200
>>> XLLCORNER    148.50000000000
>>> YLLCORNER   -37.002500000000
>>> CELLSIZE    0.10000000000000E-01
>>> NODATA_VALUE   -9999.000
>>> BYTEORDER LSBFIRST
>>>
>>>
>>>> sessionInfo()
>>> R version 2.5.1 (2007-06-27)
>>> i386-pc-mingw32
>>>
>>> locale:
>>> LC_COLLATE=English_Australia.1252;LC_CTYPE=English_Australia.1252;LC_M
>>> ONETARY=English_Australia.1252;LC_NUMERIC=C;LC_TIME=English_Australia.
>>> 1252
>>>
>>> attached base packages:
>>> [1] "stats"     "graphics"  "grDevices" "utils"     "datasets"
>>> "methods"   "base"
>>>
>>> other attached packages:
>>>          rgdal       RArcInfo       maptools        foreign
>>>  sp    hydrosanity
>>>       "0.5-14"        "0.4-7"       "0.6-14"       "0.8-20"
>>> "0.9-14"       "0.8.57"
>>> plotAndPlayGTK    cairoDevice          RGtk2        lattice
>>>       "0.8.55"          "2.3"      "2.10.13"       "0.16-2"
>>>
>>>
>>> --
>>> Felix Andrews / ??????
>>> PhD candidate
>>> Integrated Catchment Assessment and Management Centre The Fenner
>>> School of Environment and Society The Australian National University
>>> (Building 48A), ACT 0200 Beijing Bag, Locked Bag 40, Kingston ACT 2604
>>> http://www.neurofractal.org/felix/
>>> voice:+86_1051404394 (in China)
>>> mobile:+86_13522529265 (in China)
>>> mobile:+61_410400963 (in Australia)
>>> xmpp:foolish.android at gmail.com
>>> 3358 543D AAC6 22C2 D336  80D9 360B 72DD 3E4C F5D8
>>>
>>
>>
>> --
>> Felix Andrews / ??????
>> PhD candidate
>> Integrated Catchment Assessment and Management Centre The Fenner School of
>> Environment and Society The Australian National University (Building 48A),
>> ACT 0200 Beijing Bag, Locked Bag 40, Kingston ACT 2604
>> http://www.neurofractal.org/felix/
>> voice:+86_1051404394 (in China)
>> mobile:+86_13522529265 (in China)
>> mobile:+61_410400963 (in Australia)
>> xmpp:foolish.android at gmail.com
>> 3358 543D AAC6 22C2 D336  80D9 360B 72DD 3E4C F5D8
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>
>
>
> --
> Felix Andrews / ??????
> PhD candidate
> Integrated Catchment Assessment and Management Centre
> The Fenner School of Environment and Society
> The Australian National University (Building 48A), ACT 0200
> Beijing Bag, Locked Bag 40, Kingston ACT 2604
> http://www.neurofractal.org/felix/
> voice:+86_1051404394 (in China)
> mobile:+86_13522529265 (in China)
> mobile:+61_410400963 (in Australia)
> xmpp:foolish.android at gmail.com
> 3358 543D AAC6 22C2 D336  80D9 360B 72DD 3E4C F5D8
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From t.szegvary at unibas.ch  Wed Aug  8 15:12:47 2007
From: t.szegvary at unibas.ch (Thomas Szegvary)
Date: Wed, 8 Aug 2007 15:12:47 +0200
Subject: [R-sig-Geo] Coordinate/grid for ncdf data
Message-ID: <000b01c7d9bd$d100b7c0$44349883@D59QMB1J>

Hi!

I have a table with 3 columns, 2 for long/lat coordinates and 1 for values
(radon concentration). I have data for every week of the year
2006,distributed in 52 tables/files. I want to create a NetCDF file, which
is much easier to handle than extracting the values from 52 tables. I tried
the following for the first dataset (i.e first week):

#extracting coordinates and values from my tables (which have also other
information I don't need)
W01<-read.table("RN_weekly/KW01_RN.dat")
long<-W01$V1
lat<-W01$V2
RN01<-W01$V3

#defining dimensions for coordinates
dim1 <- dim.def.ncdf( "EW","degrees", as.double(long))
dim2 <- dim.def.ncdf( "SN","degrees", as.double(lat))

#defining variable for my values I want to have the time series
varz <- var.def.ncdf("Radon","Bq/m2/h1", list(dim1,dim2), -1, 
          longname="Radon flux rate")

#creating the netcdf file and filling the variable varz with the first
data-week from my time series
nc.rn <- create.ncdf("rn_weekly.nc",varz)
put.var.ncdf(nc.rn,varz,RN01)
close.ncdf(nc.rn)


The problem now is that the last step (put.var.ncdf) doesn't work, because
it says I am trying to "error: you asked to write 111788329 values, but the
passed data array only has 10573* entries!". So I think the problem is that
I need an array with two dimensions (coordinates...) for my values. But how
do I get this from my tables??

 *10573 are the pixels for my area

Thanks for any help!
Thomas


__

Thomas Szegvary
Institute of Environmental Geosciences
Department of Geosciences
University of Basel
Bernoullistrasse 30
CH - 4056 Basel

Tel.  41-61-267 04 82
Fax. 41-61-267 04 79
Email: t.szegvary at unibas.ch
www.radon.unibas.ch
www.unibas.ch/environment



From mdsumner at utas.edu.au  Thu Aug  9 01:48:43 2007
From: mdsumner at utas.edu.au (Michael Sumner)
Date: Thu, 9 Aug 2007 09:48:43 +1000
Subject: [R-sig-Geo] Coordinate/grid for ncdf data
In-Reply-To: <000b01c7d9bd$d100b7c0$44349883@D59QMB1J>
References: <000b01c7d9bd$d100b7c0$44349883@D59QMB1J>
Message-ID: <002501c7da16$a81dcf10$4627d983@gom>

Hi, can you provide an example file?

I'd recommend avoiding NetCDF for various reasons, why don't you simply add
each value column from the separate files to a new column in a
SpatialGridDataFrame?

That would be the recommend sp way to proceed here. If you really need to
create a NetCDF file, please let us know more about your OS and the
package/s and versions you are using (ncdf I presume?) - however such
questions should include the ncdf(?) package author at least.  

Cheers, Mike. 

-----Original Message-----
From: r-sig-geo-bounces at stat.math.ethz.ch
[mailto:r-sig-geo-bounces at stat.math.ethz.ch] On Behalf Of Thomas Szegvary
Sent: Wednesday, 8 August 2007 11:13 PM
To: r-sig-geo at stat.math.ethz.ch
Subject: [R-sig-Geo] Coordinate/grid for ncdf data

Hi!

I have a table with 3 columns, 2 for long/lat coordinates and 1 for values
(radon concentration). I have data for every week of the year
2006,distributed in 52 tables/files. I want to create a NetCDF file, which
is much easier to handle than extracting the values from 52 tables. I tried
the following for the first dataset (i.e first week):

#extracting coordinates and values from my tables (which have also other
information I don't need)
W01<-read.table("RN_weekly/KW01_RN.dat")
long<-W01$V1
lat<-W01$V2
RN01<-W01$V3

#defining dimensions for coordinates
dim1 <- dim.def.ncdf( "EW","degrees", as.double(long))
dim2 <- dim.def.ncdf( "SN","degrees", as.double(lat))

#defining variable for my values I want to have the time series varz <-
var.def.ncdf("Radon","Bq/m2/h1", list(dim1,dim2), -1, 
          longname="Radon flux rate")

#creating the netcdf file and filling the variable varz with the first
data-week from my time series nc.rn <- create.ncdf("rn_weekly.nc",varz)
put.var.ncdf(nc.rn,varz,RN01)
close.ncdf(nc.rn)


The problem now is that the last step (put.var.ncdf) doesn't work, because
it says I am trying to "error: you asked to write 111788329 values, but the
passed data array only has 10573* entries!". So I think the problem is that
I need an array with two dimensions (coordinates...) for my values. But how
do I get this from my tables??

 *10573 are the pixels for my area

Thanks for any help!
Thomas


__

Thomas Szegvary
Institute of Environmental Geosciences
Department of Geosciences
University of Basel
Bernoullistrasse 30
CH - 4056 Basel

Tel.  41-61-267 04 82
Fax. 41-61-267 04 79
Email: t.szegvary at unibas.ch
www.radon.unibas.ch
www.unibas.ch/environment

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at stat.math.ethz.ch
https://stat.ethz.ch/mailman/listinfo/r-sig-geo



From felix at nfrac.org  Thu Aug  9 05:25:33 2007
From: felix at nfrac.org (Felix Andrews)
Date: Thu, 9 Aug 2007 13:25:33 +1000
Subject: [R-sig-Geo] spgpc package?
Message-ID: <94730b8a0708082025p62522b96mf9b1c1c83ac7dee7@mail.gmail.com>

Hmm

I'm trying to work with gpclib, converting to and from the sp classes.
I don't know what is/was in the package spgpc, but it is no longer
available:
> install.packages("spgpc", repos=rSpatial)
Warning: unable to access index for repository
http://r-spatial.sourceforge.net/R/bin/windows/contrib/2.5

The page http://r-spatial.sourceforge.net/xtra/xtra.RHnw.html says:
"the functionality described here has been included in packages rgdal,
naptools, and spgrass6, now all on CRAN. This page is maintained for
documentary purposes only, and most of the examples shown here are the
examples used in the released packages."

where i'm guessing "naptools" should be "maptools".
But I can not find a method to coerce between "gpc.poly" and
"Polygons" classes. Not that it is difficult to manually... just
wondering.

Felix

-- 
Felix Andrews / ???
PhD candidate
Integrated Catchment Assessment and Management Centre
The Fenner School of Environment and Society
The Australian National University (Building 48A), ACT 0200
Beijing Bag, Locked Bag 40, Kingston ACT 2604
http://www.neurofractal.org/felix/
voice:+86_1051404394 (in China)
mobile:+86_13522529265 (in China)
mobile:+61_410400963 (in Australia)
xmpp:foolish.android at gmail.com
3358 543D AAC6 22C2 D336  80D9 360B 72DD 3E4C F5D8



From felix at nfrac.org  Thu Aug  9 05:56:10 2007
From: felix at nfrac.org (Felix Andrews)
Date: Thu, 9 Aug 2007 13:56:10 +1000
Subject: [R-sig-Geo] spgpc package?
In-Reply-To: <94730b8a0708082025p62522b96mf9b1c1c83ac7dee7@mail.gmail.com>
References: <94730b8a0708082025p62522b96mf9b1c1c83ac7dee7@mail.gmail.com>
Message-ID: <94730b8a0708082056i5bc76313h10a93f632bf441c0@mail.gmail.com>

e.g.

# x is a gpc.poly object
as.Polygons.gpc.poly <- function(x, ID) {
	thisPolys <- lapply(get.pts(x), function(p) {
		Polygon(rbind(as.matrix(cbind(p$x,p$y)),c(p$x[1],p$y[1])),
			hole=p$hole)
	})
	Polygons(thisPolys, ID)
}

This works except if the gpc.poly is empty. `Polygons` fails if passed
an empty list().

Felix


On 8/9/07, Felix Andrews <felix at nfrac.org> wrote:
> Hmm
>
> I'm trying to work with gpclib, converting to and from the sp classes.
> I don't know what is/was in the package spgpc, but it is no longer
> available:
> > install.packages("spgpc", repos=rSpatial)
> Warning: unable to access index for repository
> http://r-spatial.sourceforge.net/R/bin/windows/contrib/2.5
>
> The page http://r-spatial.sourceforge.net/xtra/xtra.RHnw.html says:
> "the functionality described here has been included in packages rgdal,
> naptools, and spgrass6, now all on CRAN. This page is maintained for
> documentary purposes only, and most of the examples shown here are the
> examples used in the released packages."
>
> where i'm guessing "naptools" should be "maptools".
> But I can not find a method to coerce between "gpc.poly" and
> "Polygons" classes. Not that it is difficult to manually... just
> wondering.
>
> Felix
>
> --
> Felix Andrews / ???
> PhD candidate
> Integrated Catchment Assessment and Management Centre
> The Fenner School of Environment and Society
> The Australian National University (Building 48A), ACT 0200
> Beijing Bag, Locked Bag 40, Kingston ACT 2604
> http://www.neurofractal.org/felix/
> voice:+86_1051404394 (in China)
> mobile:+86_13522529265 (in China)
> mobile:+61_410400963 (in Australia)
> xmpp:foolish.android at gmail.com
> 3358 543D AAC6 22C2 D336  80D9 360B 72DD 3E4C F5D8
>



From t.szegvary at unibas.ch  Thu Aug  9 08:22:01 2007
From: t.szegvary at unibas.ch (Thomas Szegvary)
Date: Thu, 9 Aug 2007 08:22:01 +0200
Subject: [R-sig-Geo] Coordinate/grid for ncdf data
In-Reply-To: <002501c7da16$a81dcf10$4627d983@gom>
Message-ID: <000601c7da4d$99610dc0$44349883@D59QMB1J>

I use ncdf V1.6 on Windows XP Sp2, I hava attached the sample file (tab
delim) which contains 2 columns for coordinates long/lat and 10 columns for
weekly averages of radon. Sp would be the best solution to produce map I
guess, but for time series analysis I think netcdf would perform better. 

Thanks,thoams


 
-----Urspr?ngliche Nachricht-----
Von: Michael Sumner [mailto:mdsumner at utas.edu.au] 
Gesendet: Donnerstag, 9. August 2007 01:49
An: 'Thomas Szegvary'; r-sig-geo at stat.math.ethz.ch
Betreff: RE: [R-sig-Geo] Coordinate/grid for ncdf data

Hi, can you provide an example file?

I'd recommend avoiding NetCDF for various reasons, why don't you simply add
each value column from the separate files to a new column in a
SpatialGridDataFrame?

That would be the recommend sp way to proceed here. If you really need to
create a NetCDF file, please let us know more about your OS and the
package/s and versions you are using (ncdf I presume?) - however such
questions should include the ncdf(?) package author at least.  

Cheers, Mike. 

-----Original Message-----
From: r-sig-geo-bounces at stat.math.ethz.ch
[mailto:r-sig-geo-bounces at stat.math.ethz.ch] On Behalf Of Thomas Szegvary
Sent: Wednesday, 8 August 2007 11:13 PM
To: r-sig-geo at stat.math.ethz.ch
Subject: [R-sig-Geo] Coordinate/grid for ncdf data

Hi!

I have a table with 3 columns, 2 for long/lat coordinates and 1 for values
(radon concentration). I have data for every week of the year
2006,distributed in 52 tables/files. I want to create a NetCDF file, which
is much easier to handle than extracting the values from 52 tables. I tried
the following for the first dataset (i.e first week):

#extracting coordinates and values from my tables (which have also other
information I don't need)
W01<-read.table("RN_weekly/KW01_RN.dat")
long<-W01$V1
lat<-W01$V2
RN01<-W01$V3

#defining dimensions for coordinates
dim1 <- dim.def.ncdf( "EW","degrees", as.double(long))
dim2 <- dim.def.ncdf( "SN","degrees", as.double(lat))

#defining variable for my values I want to have the time series varz <-
var.def.ncdf("Radon","Bq/m2/h1", list(dim1,dim2), -1, 
          longname="Radon flux rate")

#creating the netcdf file and filling the variable varz with the first
data-week from my time series nc.rn <- create.ncdf("rn_weekly.nc",varz)
put.var.ncdf(nc.rn,varz,RN01)
close.ncdf(nc.rn)


The problem now is that the last step (put.var.ncdf) doesn't work, because
it says I am trying to "error: you asked to write 111788329 values, but the
passed data array only has 10573* entries!". So I think the problem is that
I need an array with two dimensions (coordinates...) for my values. But how
do I get this from my tables??

 *10573 are the pixels for my area

Thanks for any help!
Thomas


__

Thomas Szegvary
Institute of Environmental Geosciences
Department of Geosciences
University of Basel
Bernoullistrasse 30
CH - 4056 Basel

Tel.  41-61-267 04 82
Fax. 41-61-267 04 79
Email: t.szegvary at unibas.ch
www.radon.unibas.ch
www.unibas.ch/environment

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at stat.math.ethz.ch
https://stat.ethz.ch/mailman/listinfo/r-sig-geo
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: sample_rn.txt
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070809/97647e70/attachment.txt>

From felix at nfrac.org  Thu Aug  9 10:10:13 2007
From: felix at nfrac.org (Felix Andrews)
Date: Thu, 9 Aug 2007 18:10:13 +1000
Subject: [R-sig-Geo] spplot with Spatial classes, not DataFrame
Message-ID: <94730b8a0708090110s2b986407y8482564d692d2fb5@mail.gmail.com>

Hi again...

I like spplot (in sp package), but I would like to able to plot
simpler types like SpatialPolygons, SpatialPoints, etc. Even Polygons.
And a default method could plot points using xy.coords. I do not see
why a data.frame must be attached, it might not be relevant:

> showMethods(spplot)
Function: spplot (package sp)
obj="SpatialGridDataFrame"
obj="SpatialLinesDataFrame"
obj="SpatialPixelsDataFrame"
obj="SpatialPointsDataFrame"
obj="SpatialPolygonsDataFrame"

Also, I would like it if there was some way to _not_ draw a key in the
SpatialPointsDataFrame method. Perhaps you could detect key=F or
auto.key=F.

Regards,
Felix

-- 
Felix Andrews / ???
PhD candidate
Integrated Catchment Assessment and Management Centre
The Fenner School of Environment and Society
The Australian National University (Building 48A), ACT 0200
Beijing Bag, Locked Bag 40, Kingston ACT 2604
http://www.neurofractal.org/felix/
voice:+86_1051404394 (in China)
mobile:+86_13522529265 (in China)
mobile:+61_410400963 (in Australia)
xmpp:foolish.android at gmail.com
3358 543D AAC6 22C2 D336  80D9 360B 72DD 3E4C F5D8



From Roger.Bivand at nhh.no  Thu Aug  9 11:23:35 2007
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 9 Aug 2007 11:23:35 +0200 (CEST)
Subject: [R-sig-Geo] spgpc package?
In-Reply-To: <94730b8a0708082056i5bc76313h10a93f632bf441c0@mail.gmail.com>
References: <94730b8a0708082025p62522b96mf9b1c1c83ac7dee7@mail.gmail.com>
	<94730b8a0708082056i5bc76313h10a93f632bf441c0@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0708091116050.27732@reclus.nhh.no>

On Thu, 9 Aug 2007, Felix Andrews wrote:

> e.g.
>
> # x is a gpc.poly object
> as.Polygons.gpc.poly <- function(x, ID) {
> 	thisPolys <- lapply(get.pts(x), function(p) {
> 		Polygon(rbind(as.matrix(cbind(p$x,p$y)),c(p$x[1],p$y[1])),
> 			hole=p$hole)
> 	})
> 	Polygons(thisPolys, ID)
> }
>
> This works except if the gpc.poly is empty. `Polygons` fails if passed
> an empty list().

As you guessed in your first mail, the off-CRAN beta spgpc was folded into 
maptools.

There are no methods published in the maptools namespace for converting to 
and from gpc.poly, although this is a good idea. The code is inside 
unionSpatialPolygons() and checkPolygonsHoles(), but logically ought to be 
exposed. I'll look at this for the next release. You can see (untidy) 
solutions to your empty list problem in these two functions.

Contributions welcome, especially as patches to maptools files from the 
r-spatial sourceforge repository.

Roger

>
> Felix
>
>
> On 8/9/07, Felix Andrews <felix at nfrac.org> wrote:
>> Hmm
>>
>> I'm trying to work with gpclib, converting to and from the sp classes.
>> I don't know what is/was in the package spgpc, but it is no longer
>> available:
>>> install.packages("spgpc", repos=rSpatial)
>> Warning: unable to access index for repository
>> http://r-spatial.sourceforge.net/R/bin/windows/contrib/2.5
>>
>> The page http://r-spatial.sourceforge.net/xtra/xtra.RHnw.html says:
>> "the functionality described here has been included in packages rgdal,
>> naptools, and spgrass6, now all on CRAN. This page is maintained for
>> documentary purposes only, and most of the examples shown here are the
>> examples used in the released packages."
>>
>> where i'm guessing "naptools" should be "maptools".
>> But I can not find a method to coerce between "gpc.poly" and
>> "Polygons" classes. Not that it is difficult to manually... just
>> wondering.
>>
>> Felix
>>
>> --
>> Felix Andrews / ??????
>> PhD candidate
>> Integrated Catchment Assessment and Management Centre
>> The Fenner School of Environment and Society
>> The Australian National University (Building 48A), ACT 0200
>> Beijing Bag, Locked Bag 40, Kingston ACT 2604
>> http://www.neurofractal.org/felix/
>> voice:+86_1051404394 (in China)
>> mobile:+86_13522529265 (in China)
>> mobile:+61_410400963 (in Australia)
>> xmpp:foolish.android at gmail.com
>> 3358 543D AAC6 22C2 D336  80D9 360B 72DD 3E4C F5D8
>>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From Roger.Bivand at nhh.no  Thu Aug  9 11:36:28 2007
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 9 Aug 2007 11:36:28 +0200 (CEST)
Subject: [R-sig-Geo] spplot with Spatial classes, not DataFrame
In-Reply-To: <94730b8a0708090110s2b986407y8482564d692d2fb5@mail.gmail.com>
References: <94730b8a0708090110s2b986407y8482564d692d2fb5@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0708091124130.27732@reclus.nhh.no>

On Thu, 9 Aug 2007, Felix Andrews wrote:

> Hi again...
>
> I like spplot (in sp package), but I would like to able to plot
> simpler types like SpatialPolygons, SpatialPoints, etc. Even Polygons.
> And a default method could plot points using xy.coords. I do not see
> why a data.frame must be attached, it might not be relevant:
>
>> showMethods(spplot)
> Function: spplot (package sp)
> obj="SpatialGridDataFrame"
> obj="SpatialLinesDataFrame"
> obj="SpatialPixelsDataFrame"
> obj="SpatialPointsDataFrame"
> obj="SpatialPolygonsDataFrame"
>
> Also, I would like it if there was some way to _not_ draw a key in the
> SpatialPointsDataFrame method. Perhaps you could detect key=F or
> auto.key=F.

As in xyplot and levelplot, spplot needs a data frame, because lattice 
graphics are for viewing data frames, particularly conditioning on other 
variables. You can add other kinds of spatial objects to the data display 
through the sp.layout= argument, but a data frame has to be there. If you 
need to use the underlying grid graphics, you'll need something that isn't 
a front-end to xyplot or levelplot, I think.

Setting key.space="" removed the key for me in:

example(spplot)
spplot(meuse, c("zinc"), sp.layout=list(l2,l3,l4,l5, which = 2),
    key.space="")

but I don't know if this is intended.

Roger

>
> Regards,
> Felix
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From Roger.Bivand at nhh.no  Thu Aug  9 11:55:44 2007
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 9 Aug 2007 11:55:44 +0200 (CEST)
Subject: [R-sig-Geo] R-sig-Geo Digest, Vol 48, Issue 3
In-Reply-To: <20070803110314.5785.qmail@web10715.mail.bbt.yahoo.co.jp>
References: <20070803110314.5785.qmail@web10715.mail.bbt.yahoo.co.jp>
Message-ID: <Pine.LNX.4.64.0708091149310.27732@reclus.nhh.no>

On Fri, 3 Aug 2007, Hisaji ONO wrote:

> Dear Marco
>
> Thank you very much for your info.

Dear Hisaji,

Would Mondrian http://rosuda.org/Mondrian/ be of any use? The maptools 
package contains a function for exporting SpatialPolygonsDataFrame objects 
for (older) Mondrian, and will support the recent releases soon?

There is limited support for ESDA in the iplots package, if ESDA is taken 
as dynamic linked graphics including a map view. Neither Mondrian nor 
iplots permit linked Moran plots unless the spatially lagged variables 
have been constructed first.

Best wishes,

Roger

>
>
> --- Marco Helbich <marco.helbich at gmx.at> wrote:
>
>> Dear Hisaji,
>>
>> I know the following possibilities:
>>
>> GGOBI:
>> http://www.ggobi.org/publications/2001-dsc.pdf
>> http://www.ggobi.org/publications/2003-dsc.pdf
>>
>> GEOXP:
>>
> http://w3.univ-tlse1.fr/GREMAQ/Statistique/geoxppageR.htm
>>
>> Best regards,
>> Marco Helbich
>>
>>
>> ----- Original Message -----
>> From: <r-sig-geo-request at stat.math.ethz.ch>
>> To: <r-sig-geo at stat.math.ethz.ch>
>> Sent: Friday, August 03, 2007 12:00 PM
>> Subject: R-sig-Geo Digest, Vol 48, Issue 3
>>
>>
>>> Send R-sig-Geo mailing list submissions to
>>> r-sig-geo at stat.math.ethz.ch
>>>
>>> To subscribe or unsubscribe via the World Wide
>> Web, visit
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>> or, via email, send a message with subject or body
>> 'help' to
>>> r-sig-geo-request at stat.math.ethz.ch
>>>
>>> You can reach the person managing the list at
>>> r-sig-geo-owner at stat.math.ethz.ch
>>>
>>> When replying, please edit your Subject line so it
>> is more specific
>>> than "Re: Contents of R-sig-Geo digest..."
>>>
>>>
>>> Today's Topics:
>>>
>>>   1. Availability of ESDA for R (Hisaji ONO)
>>>
>>>
>>>
>>
> ----------------------------------------------------------------------
>>>
>>> Message: 1
>>> Date: Fri, 3 Aug 2007 06:27:15 +0900 (JST)
>>> From: Hisaji ONO <hi_ono2001 at yahoo.co.jp>
>>> Subject: [R-sig-Geo] Availability of ESDA for R
>>> To: r-sig-geo at stat.math.ethz.ch
>>> Message-ID:
>>
> <20070802212715.84027.qmail at web10713.mail.bbt.yahoo.co.jp>
>>> Content-Type: text/plain; charset=iso-2022-jp
>>>
>>> Hello.
>>>
>>> Does anyone know whether ESDA like GeoDa is
>> available for
>>> R or not?
>>>
>>>
>>> Regards.
>>>
>>>
>>>
>>> ------------------------------
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>>
>>> End of R-sig-Geo Digest, Vol 48, Issue 3
>>> ****************************************
>>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From dpierce at ucsd.edu  Thu Aug  9 18:25:29 2007
From: dpierce at ucsd.edu (David Pierce)
Date: Thu, 9 Aug 2007 09:25:29 -0700 (PDT)
Subject: [R-sig-Geo] Coordinate/grid for ncdf data
In-Reply-To: <000601c7da4d$99610dc0$44349883@D59QMB1J>
References: <000601c7da4d$99610dc0$44349883@D59QMB1J>
Message-ID: <1167.132.239.114.8.1186676729.squirrel@crdmail.ucsd.edu>

Hello,

the reason you are getting that error from the ncdf package is because you
have defined variable "Radon" to be a *two* dimensional array in the
netcdf file.  The number of entries in dimension 1 is length(long) =
10573, and the number of entries in dimension 2 is length(lat) = 10573. 
So, the total number of entries in the array in the netcdf file is
length(long) * length(lat) = 10573 * 10573 = 111788329.

You only want to define a 2-d array when the location of data[i,j] can be
described as (lon[i],lat[j]).  That is not the case for your data, because
it is not on any sort of grid.  Instead, you will want to create a set of
3 1-dimensional arrays along the following lines:

n_stations <- length(RN01)
dim_station <- dim.def.ncdf( 'Radon_station', '-', 1:n_stations )

var_lon <- var.def.ncdf( 'Longitude', 'degreesE', dim_station, 1.e30 )
var_lat <- var.def.ncdf( 'Latitude',  'degreesN', dim_station, 1.e30 )
var_radon <- var.def.ncdf( 'Radon',   'Bq/m2/h1', dim_stattion, 1.e30 )

ncid_out <- create.ncdf( 'rn.weekly.nc', list(var_lon,var_lat,var_radon))

put.var.ncdf( ncid_out, var_lon, long )
put.var.ncdf( ncid_out, var_lat, lat  )
put.var.ncdf( ncid_out, var_radon, RN01 )

close.ncdf( ncid_out )

Now, the location of data point RN01[i] is correctly described as
(lon[i],lat[i]); compare this to what you were trying before, which was
RN01[i,j] having the location (lon[i],lat[j]).

Regards,

--Dave




Thomas Szegvary wrote:
> I use ncdf V1.6 on Windows XP Sp2, I hava attached the sample file (tab
> delim) which contains 2 columns for coordinates long/lat and 10 columns
> for
> weekly averages of radon. Sp would be the best solution to produce map I
> guess, but for time series analysis I think netcdf would perform better.
>
> Thanks,thoams
>
>
>
> -----Urspr?ngliche Nachricht-----
> Von: Michael Sumner [mailto:mdsumner at utas.edu.au]
> Gesendet: Donnerstag, 9. August 2007 01:49
> An: 'Thomas Szegvary'; r-sig-geo at stat.math.ethz.ch
> Betreff: RE: [R-sig-Geo] Coordinate/grid for ncdf data
>
> Hi, can you provide an example file?
>
> I'd recommend avoiding NetCDF for various reasons, why don't you simply
> add
> each value column from the separate files to a new column in a
> SpatialGridDataFrame?
>
> That would be the recommend sp way to proceed here. If you really need to
> create a NetCDF file, please let us know more about your OS and the
> package/s and versions you are using (ncdf I presume?) - however such
> questions should include the ncdf(?) package author at least.
>
> Cheers, Mike.
>
> -----Original Message-----
> From: r-sig-geo-bounces at stat.math.ethz.ch
> [mailto:r-sig-geo-bounces at stat.math.ethz.ch] On Behalf Of Thomas Szegvary
> Sent: Wednesday, 8 August 2007 11:13 PM
> To: r-sig-geo at stat.math.ethz.ch
> Subject: [R-sig-Geo] Coordinate/grid for ncdf data
>
> Hi!
>
> I have a table with 3 columns, 2 for long/lat coordinates and 1 for values
> (radon concentration). I have data for every week of the year
> 2006,distributed in 52 tables/files. I want to create a NetCDF file, which
> is much easier to handle than extracting the values from 52 tables. I
> tried
> the following for the first dataset (i.e first week):
>
> #extracting coordinates and values from my tables (which have also other
> information I don't need)
> W01<-read.table("RN_weekly/KW01_RN.dat")
> long<-W01$V1
> lat<-W01$V2
> RN01<-W01$V3
>
> #defining dimensions for coordinates
> dim1 <- dim.def.ncdf( "EW","degrees", as.double(long))
> dim2 <- dim.def.ncdf( "SN","degrees", as.double(lat))
>
> #defining variable for my values I want to have the time series varz <-
> var.def.ncdf("Radon","Bq/m2/h1", list(dim1,dim2), -1,
>           longname="Radon flux rate")
>
> #creating the netcdf file and filling the variable varz with the first
> data-week from my time series nc.rn <- create.ncdf("rn_weekly.nc",varz)
> put.var.ncdf(nc.rn,varz,RN01)
> close.ncdf(nc.rn)
>
>
> The problem now is that the last step (put.var.ncdf) doesn't work, because
> it says I am trying to "error: you asked to write 111788329 values, but
> the
> passed data array only has 10573* entries!". So I think the problem is
> that
> I need an array with two dimensions (coordinates...) for my values. But
> how
> do I get this from my tables??
>
>  *10573 are the pixels for my area
>
> Thanks for any help!
> Thomas
>
>
> __
>
> Thomas Szegvary
> Institute of Environmental Geosciences
> Department of Geosciences
> University of Basel
> Bernoullistrasse 30
> CH - 4056 Basel
>
> Tel.  41-61-267 04 82
> Fax. 41-61-267 04 79
> Email: t.szegvary at unibas.ch
> www.radon.unibas.ch
> www.unibas.ch/environment
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


---------------------------------------------------------------
David W. Pierce        / Climate Research Division
Scripps Inst. Oceanog. / (858) 534-8276 (voice)
dpierce at ucsd.edu       / (858) 534-8561 (fax)



From andrew.niccolai at yale.edu  Thu Aug  9 20:03:41 2007
From: andrew.niccolai at yale.edu (Andrew Niccolai)
Date: Thu, 9 Aug 2007 14:03:41 -0400
Subject: [R-sig-Geo] Error with SpatialPoints to PPP conversion
In-Reply-To: <Pine.LNX.4.64.0708091149310.27732@reclus.nhh.no>
Message-ID: <200708091803.l79I3ZII023359@pantheon-po19.its.yale.edu>

Greetings all,

I recently upgraded from R-2.4.1 to R-2.5.1 on Windows XP OS.  Now when I
run my application (literally thousands of lines of code), I crash whenever
I had code using the names() function.  The error message is the following:

Error in names(argue) : no applicable method for "names"

I have been slowly rewriting my code to change names() lines to 
namesfix <- attr(df.in.question,"names").

This seems to work OK, but I just ran into this issue on a bit of code that
worked perfectly in R-2.4.1, which converted a SpatialPoints class to a PPP
class:

centroid.ppp <- as.ppp(centroid.pt)
Error in names(argue) : no applicable method for "names"

This I can't easily fix.  Is this universal or did I screw something up in
the R-2.5.1 install?


Thanks,
Andrew



From Roger.Bivand at nhh.no  Thu Aug  9 22:13:44 2007
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 9 Aug 2007 22:13:44 +0200 (CEST)
Subject: [R-sig-Geo] Error with SpatialPoints to PPP conversion
In-Reply-To: <200708091803.l79I3ZII023359@pantheon-po19.its.yale.edu>
References: <200708091803.l79I3ZII023359@pantheon-po19.its.yale.edu>
Message-ID: <Pine.LNX.4.64.0708092212061.27732@reclus.nhh.no>

On Thu, 9 Aug 2007, Andrew Niccolai wrote:

> Greetings all,
>
> I recently upgraded from R-2.4.1 to R-2.5.1 on Windows XP OS.  Now when I
> run my application (literally thousands of lines of code), I crash whenever
> I had code using the names() function.  The error message is the following:
>
> Error in names(argue) : no applicable method for "names"
>
> I have been slowly rewriting my code to change names() lines to
> namesfix <- attr(df.in.question,"names").
>
> This seems to work OK, but I just ran into this issue on a bit of code that
> worked perfectly in R-2.4.1, which converted a SpatialPoints class to a PPP
> class:
>
> centroid.ppp <- as.ppp(centroid.pt)
> Error in names(argue) : no applicable method for "names"
>
> This I can't easily fix.  Is this universal or did I screw something up in
> the R-2.5.1 install?
>

Andrew,

Could you provide examples of data objects that trigger the problem 
(save() as an .RData file), and I'll have a look. sessionInfo() of your 
system would also help.

Roger

>
> Thanks,
> Andrew
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From lee.kitty at yahoo.com  Fri Aug 10 05:19:39 2007
From: lee.kitty at yahoo.com (Kitty Lee)
Date: Thu, 9 Aug 2007 20:19:39 -0700 (PDT)
Subject: [R-sig-Geo] spautolm in Spdep
Message-ID: <354462.58821.qm@web36302.mail.mud.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070809/a0cdafd6/attachment.pl>

From Roger.Bivand at nhh.no  Fri Aug 10 11:09:00 2007
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 10 Aug 2007 11:09:00 +0200 (CEST)
Subject: [R-sig-Geo] reading HDF5 files
In-Reply-To: <46BC185E.70605@geo.uu.nl>
References: <46BB27DE.3000101@geo.uu.nl>
	<Pine.LNX.4.64.0708091647060.27732@reclus.nhh.no>
	<46BC185E.70605@geo.uu.nl>
Message-ID: <Pine.LNX.4.64.0708101101190.30893@reclus.nhh.no>

Paul,

I have added a CC to the R-sig-geo list, since I myself have no experiece 
of using this format in practice. If you are not a member, please join at:

https://stat.ethz.ch/mailman/listinfo/r-sig-geo

so that you will see any replies.

Did you try gdalinfo on the output file?

The error message suggests that the output file has a geographical 
coordinate reference system, with coordinate values outside the feasible 
range. From the HDF5 description, however, it ought to be projected, 
right? Do you need to make more use of the arguments taken by gdalinfo to 
give the output file the correct projected CRS?

Roger

On Fri, 10 Aug 2007, Paul Hiemstra wrote:

> Dear Roger,
>
> I tried the route through a GTiff before I sent you the e-mail but somehow it 
> did not work. When I use gdalinfo on one of the .h5 files I get this:
>
> PS E:\LSO data\Regenbui 20-7\regenradar_rasters\regenradar_hdf5> gdalinfo 
> RAD_NL21_PCP_NA_200707200000.h5
> Driver: HDF5/Hierarchical Data Format Release 5
> Files: RAD_NL21_PCP_NA_200707200000.h5
> Size is 512, 512
> Coordinate System is `'
> Metadata:
>  map_projection:projection_indication=Y
>  map_projection:projection_name=STEREOGRAPHIC
>  map_projection:projection_proj4_params=+proj=stere +lat_0=90 
> +lon_0=0.0 +lat_ts=60.0 +a=6378.388 +b=6356.912 +x_0=0 +y_0=0
> geographic: geo_number_rows=256
> geographic: geo_number_columns=256
> geographic: geo_pixel_size_x=2.500000
> geographic: geo_pixel_size_y=-2.500000
> geographic: geo_par_pixel=X,Y
> geographic: geo_dim_pixel=KM,KM
> geographic: geo_column_offset=0.000000
> geographic: geo_row_offset=1490.906006
> geographic: geo_pixel_def=LU
> geographic: geo_product_corners=0.000000 49.769001 0.000000 55.296001 
> 9.743000 54.818001 8.337000 49.373001
> calibration: calibration_flag=Y
> calibration: calibration_formulas=GEO = 0.5 * PV + -31.5
> calibration: calibration_missing_data=255
> calibration: calibration_out_of_image=255
> statistics: stat_min_value=-1.500000
> statistics: stat_max_value=45.000000
> image1: image_product_name=RAD_NL21_PCP_H0.8_NA
> image1: image_geo_parameter=REFLECTIVITY_[DBZ]
> image1: image_size=65536d
> image1: image_bytes_per_pixel=1d
> overview: product_group_name=RAD_NL21_PCP_NA
> overview: products_missing=N/A
> overview: hdftag_version_number=3.5
> overview: number_image_groups=1
> overview: number_satellite_groups=0d
> overview: number_radar_groups=2d
> overview: number_station_groups=0
> overview: product_datetime_start=20-JUL-2007;00:00:11.000
> overview: product_datetime_end=20-JUL-2007;00:00:11.000
> overview: number_lightning_groups=0d
> overview: number_classification_groups=0d
> overview: number_grid_groups=0d
> overview: number_point_groups=0d
> overview: number_vector_groups=0d
> radar1: radar_name=De_Bilt
> radar1: radar_location=5.179000 52.103001
> radar2: radar_name=Den_Helder
> radar2: radar_location=4.790000 52.955002
> Subdatasets:
> SUBDATASET_0_NAME=HDF5:"RAD_NL21_PCP_NA_200707200000.h5"://image1/image_data
> SUBDATASET_0_DESC=[256x256] //image1/image_data (8-bit unsigned character)
> Corner Coordinates:
> Upper Left  (    0.0,    0.0)
> Lower Left  (    0.0,  512.0)
> Upper Right (  512.0,    0.0)
> Lower Right (  512.0,  512.0)
> Center      (  256.0,  256.0)
>
> Then I use gdal_translate:
> PS E:\LSO data\Regenbui 20-7\regenradar_rasters\regenradar_hdf5> 
> gdal_translate -of GTiff 
> HDF5:"RAD_NL21_PCP_NA_200707200000.h5"://image1/image_data 
> RAD_NL21_PCP_NA_200707200000.img
>
> Then I try to read the file using rgdal produces the following error:
>
>>  test = readGDAL("regenradar_hdf5/RAD_NL21_PCP_NA_200707200000.tif")
> regenradar_hdf5/RAD_NL21_PCP_NA_200707200000.tif has GDAL driver GTiff
> and has 256 rows and 256 columns
> Closing GDAL dataset handle 0x0130b898...  destroyed ... done.
> Error in `proj4string<-`(`*tmp*`, value = <S4 object of class "CRS">) :
>        Geographical CRS given to non-conformant data
>
> Do you have an idea how to solve this?
>
> kind regards,
>
> Paul
>
>
> Roger Bivand schreef:
>>  Dear Paul,
>>
>>  There is information in the README.windows file in the package, this
>>  should display it:
>>
>>  file.show(system.file("README.windows", package="rgdal"))
>>
>>  If you do not want to build against the FWTools binary, then just install
>>  FWTools, and use the gdal_translate command line tool to convert your data
>>  to a format that the standard rgdal windows binary can read, such as
>>  gTiff. You'll need to play around a bit to find out what the data are
>>  called.
>>
>>  On Linux, this is easier, because you can build GDAL against HDF5 before
>>  installing rgdal, and there it "just works".
>>
>>  Hope this helps,
>>
>>  Roger
>>
>>  On Thu, 9 Aug 2007, Paul Hiemstra wrote:
>> 
>> >  Dear mr. Bivand
>> > 
>> >  My name is Paul Hiemstra, a PhD student of Edzer. I am trying to read 
>> >  HDF5 files through rgdal. If I use GDALinfo() on one of the files it 
>> >  produces the following error:
>> > 
>> >  Error in .local(.Object, ...) :
>> >        GDAL Error 4: `RAD_NL21_PCP_NA_200707200000.h5' not recognised as 
>> >  a supported file format.
>> > 
>> >  On the mailing list 
>> >  (http://finzi.psych.upenn.edu/R/Rhelp02a/archive/92270.html) you 
>> >  metioned using the dll files from FWTools to get support for HDF5 into 
>> >  rgdal. How can this be done?
>> > 
>> >  I also tried the hdf5 package on CRAN, but that does not seem to work, 
>> >  returning an empty object.
>> > 
>> >  many thanks,
>> > 
>> >  Paul
>> > 
>> > 
>> 
>
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From Roger.Bivand at nhh.no  Fri Aug 10 11:30:23 2007
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 10 Aug 2007 11:30:23 +0200 (CEST)
Subject: [R-sig-Geo] spautolm in Spdep
In-Reply-To: <354462.58821.qm@web36302.mail.mud.yahoo.com>
References: <354462.58821.qm@web36302.mail.mud.yahoo.com>
Message-ID: <Pine.LNX.4.64.0708101110080.30893@reclus.nhh.no>

On Thu, 9 Aug 2007, Kitty Lee wrote:

> Hi. I'm trying to run spatial conditional autoregression (spautolm) in 
> SPDEP. My command is simply:
>
> spautolm(vote~income, listw=listw5)
>

?spautolm

Note that the default method is method="full", you would need 
method="Matrix". Only method="full" and family="SAR" (the default, as you 
have chosen above) would permit knn spatial weights which are presumed 
asymmetric. So you cannot use these weights for CAR anyway, and 
method="Matrix" only allows symmetric weights or weights "similar to 
symmetric". You can make your weights symmetric by adding the missing 
links.

Further note that GeoDa uses a sparse approach for large N, as does 
method="Matrix", but also needs symmetric weights to perform reliably, if 
I understand correctly (see the openspace list archives).

Finally, when using "Matrix", you will need to set the interval= argument 
if you are not using style="W" (row standardisation) in creating the 
weights.

> Listw5 is a weight matrix made up by nearest 5 neighbors. I have 22000 
> cases. However, the command could not run and I got the following 
> message:
>
> Error: cannot allocate vector of size 3.6 Gb

> 22000*22000*8
[1] 3.872e+09

that is the full matrix to pass to eigen().

>
> I tried to reduce the number of neighbor to 1. But I still got the same 
> message back.
>
> I tried running spatial lag regression in GeoDa and it worked fine. I 
> wonder why the spautolm takes so much space in R? And is there another 
> spatial regression package or command that allows 22k cases?

Just reading the help page ought to be enough - if you really wanted CAR, 
you need family="CAR". But please consider whether the data need to be 
this big - are there small numbers of special cases that make the 
assumption of a global spatial process helpful? Modelling spatial 
processes is usually sensible when there is too little data (either n, or 
when there are spatially patterned unobservable variables). Voting 
outcomes tend to come with plenty of other data, don't they? Are you 
modelling a voting percentage outcome on mean/median income? What 
transformations or weightings are you using? spautolm() does provide a 
weights= argument for trying to get a handle on non-constant variance.

>
> Also....GeoDa has bivariate moran i. Is there such routine in any of the 
> R packages?

No bivariate Moran in spdep, and I'm not aware of one elsewhere. If you 
need a bivariate Moran scatterplot, try:

par(mfrow=c(2,2))
plot(x, lag(listw, x))
plot(x, lag(listw, y))
plot(y, lag(listw, x))
plot(y, lag(listw, y))
par(mfrow=c(1,1))

Roger

>
> Thanks!
>
> K.
>
>
>
>
> ---------------------------------
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From t.szegvary at unibas.ch  Fri Aug 10 15:57:22 2007
From: t.szegvary at unibas.ch (Thomas Szegvary)
Date: Fri, 10 Aug 2007 15:57:22 +0200
Subject: [R-sig-Geo] Coordinate/grid for ncdf data
In-Reply-To: <1167.132.239.114.8.1186676729.squirrel@crdmail.ucsd.edu>
Message-ID: <000e01c7db56$610e8380$44349883@D59QMB1J>

Dear Dave

Great, that worked! Many thanks. Now I want to put more weekly data (as RN01
was data for the first week of the year 2006) into the var_radon, but this
is not possible for dim_station, as there are only 3 dimensions. Do I have
to redefine 51 other dimensions? I tried to use list() to define the other
dimensions, but that didn't work.

Many thanks
Thomas




 
-----Urspr?ngliche Nachricht-----
Von: David Pierce [mailto:dpierce at ucsd.edu] 
Gesendet: Donnerstag, 9. August 2007 18:25
An: Thomas Szegvary
Cc: 'Michael Sumner'; r-sig-geo at stat.math.ethz.ch
Betreff: Re: AW: [R-sig-Geo] Coordinate/grid for ncdf data

Hello,

the reason you are getting that error from the ncdf package is because you
have defined variable "Radon" to be a *two* dimensional array in the netcdf
file.  The number of entries in dimension 1 is length(long) = 10573, and the
number of entries in dimension 2 is length(lat) = 10573. 
So, the total number of entries in the array in the netcdf file is
length(long) * length(lat) = 10573 * 10573 = 111788329.

You only want to define a 2-d array when the location of data[i,j] can be
described as (lon[i],lat[j]).  That is not the case for your data, because
it is not on any sort of grid.  Instead, you will want to create a set of
3 1-dimensional arrays along the following lines:

n_stations <- length(RN01)
dim_station <- dim.def.ncdf( 'Radon_station', '-', 1:n_stations )

var_lon <- var.def.ncdf( 'Longitude', 'degreesE', dim_station, 1.e30 )
var_lat <- var.def.ncdf( 'Latitude',  'degreesN', dim_station, 1.e30 )
var_radon <- var.def.ncdf( 'Radon',   'Bq/m2/h1', dim_stattion, 1.e30 )

ncid_out <- create.ncdf( 'rn.weekly.nc', list(var_lon,var_lat,var_radon))

put.var.ncdf( ncid_out, var_lon, long )
put.var.ncdf( ncid_out, var_lat, lat  )
put.var.ncdf( ncid_out, var_radon, RN01 )

close.ncdf( ncid_out )

Now, the location of data point RN01[i] is correctly described as
(lon[i],lat[i]); compare this to what you were trying before, which was
RN01[i,j] having the location (lon[i],lat[j]).

Regards,

--Dave




Thomas Szegvary wrote:
> I use ncdf V1.6 on Windows XP Sp2, I hava attached the sample file 
> (tab
> delim) which contains 2 columns for coordinates long/lat and 10 
> columns for weekly averages of radon. Sp would be the best solution to 
> produce map I guess, but for time series analysis I think netcdf would 
> perform better.
>
> Thanks,thoams
>
>
>
> -----Urspr?ngliche Nachricht-----
> Von: Michael Sumner [mailto:mdsumner at utas.edu.au]
> Gesendet: Donnerstag, 9. August 2007 01:49
> An: 'Thomas Szegvary'; r-sig-geo at stat.math.ethz.ch
> Betreff: RE: [R-sig-Geo] Coordinate/grid for ncdf data
>
> Hi, can you provide an example file?
>
> I'd recommend avoiding NetCDF for various reasons, why don't you 
> simply add each value column from the separate files to a new column 
> in a SpatialGridDataFrame?
>
> That would be the recommend sp way to proceed here. If you really need 
> to create a NetCDF file, please let us know more about your OS and the 
> package/s and versions you are using (ncdf I presume?) - however such 
> questions should include the ncdf(?) package author at least.
>
> Cheers, Mike.
>
> -----Original Message-----
> From: r-sig-geo-bounces at stat.math.ethz.ch
> [mailto:r-sig-geo-bounces at stat.math.ethz.ch] On Behalf Of Thomas 
> Szegvary
> Sent: Wednesday, 8 August 2007 11:13 PM
> To: r-sig-geo at stat.math.ethz.ch
> Subject: [R-sig-Geo] Coordinate/grid for ncdf data
>
> Hi!
>
> I have a table with 3 columns, 2 for long/lat coordinates and 1 for 
> values (radon concentration). I have data for every week of the year 
> 2006,distributed in 52 tables/files. I want to create a NetCDF file, 
> which is much easier to handle than extracting the values from 52 
> tables. I tried the following for the first dataset (i.e first week):
>
> #extracting coordinates and values from my tables (which have also 
> other information I don't need)
> W01<-read.table("RN_weekly/KW01_RN.dat")
> long<-W01$V1
> lat<-W01$V2
> RN01<-W01$V3
>
> #defining dimensions for coordinates
> dim1 <- dim.def.ncdf( "EW","degrees", as.double(long))
> dim2 <- dim.def.ncdf( "SN","degrees", as.double(lat))
>
> #defining variable for my values I want to have the time series varz 
> <- var.def.ncdf("Radon","Bq/m2/h1", list(dim1,dim2), -1,
>           longname="Radon flux rate")
>
> #creating the netcdf file and filling the variable varz with the first 
> data-week from my time series nc.rn <- 
> create.ncdf("rn_weekly.nc",varz)
> put.var.ncdf(nc.rn,varz,RN01)
> close.ncdf(nc.rn)
>
>
> The problem now is that the last step (put.var.ncdf) doesn't work, 
> because it says I am trying to "error: you asked to write 111788329 
> values, but the passed data array only has 10573* entries!". So I 
> think the problem is that I need an array with two dimensions 
> (coordinates...) for my values. But how do I get this from my tables??
>
>  *10573 are the pixels for my area
>
> Thanks for any help!
> Thomas
>
>
> __
>
> Thomas Szegvary
> Institute of Environmental Geosciences Department of Geosciences 
> University of Basel Bernoullistrasse 30 CH - 4056 Basel
>
> Tel.  41-61-267 04 82
> Fax. 41-61-267 04 79
> Email: t.szegvary at unibas.ch
> www.radon.unibas.ch
> www.unibas.ch/environment
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


---------------------------------------------------------------
David W. Pierce        / Climate Research Division
Scripps Inst. Oceanog. / (858) 534-8276 (voice)
dpierce at ucsd.edu       / (858) 534-8561 (fax)



From dpierce at ucsd.edu  Fri Aug 10 17:12:55 2007
From: dpierce at ucsd.edu (David Pierce)
Date: Fri, 10 Aug 2007 08:12:55 -0700 (PDT)
Subject: [R-sig-Geo] Coordinate/grid for ncdf data
In-Reply-To: <000e01c7db56$610e8380$44349883@D59QMB1J>
References: <000e01c7db56$610e8380$44349883@D59QMB1J>
Message-ID: <2040.66.75.248.9.1186758775.squirrel@crdmail.ucsd.edu>

If your data is weekly, then you'll want to define an unlimited time
dimension, so that your data structure looks something like this:

Radon[station_number,week_number]

And your dimensions look like something like this:

station_number[1:n_stations]
week_number[1:n_weeks] (make this unlimited with dim.def.ncdf(,unlim=TRUE)
latitude[1:n_stations]
longitude[1:n_stations]

Regards,

--Dave


Thomas Szegvary wrote:
> Dear Dave
>
> Great, that worked! Many thanks. Now I want to put more weekly data (as
> RN01
> was data for the first week of the year 2006) into the var_radon, but this
> is not possible for dim_station, as there are only 3 dimensions. Do I have
> to redefine 51 other dimensions? I tried to use list() to define the other
> dimensions, but that didn't work.
>
> Many thanks
> Thomas
>
>
>
>
>
> -----Urspr?ngliche Nachricht-----
> Von: David Pierce [mailto:dpierce at ucsd.edu]
> Gesendet: Donnerstag, 9. August 2007 18:25
> An: Thomas Szegvary
> Cc: 'Michael Sumner'; r-sig-geo at stat.math.ethz.ch
> Betreff: Re: AW: [R-sig-Geo] Coordinate/grid for ncdf data
>
> Hello,
>
> the reason you are getting that error from the ncdf package is because you
> have defined variable "Radon" to be a *two* dimensional array in the
> netcdf
> file.  The number of entries in dimension 1 is length(long) = 10573, and
> the
> number of entries in dimension 2 is length(lat) = 10573.
> So, the total number of entries in the array in the netcdf file is
> length(long) * length(lat) = 10573 * 10573 = 111788329.
>
> You only want to define a 2-d array when the location of data[i,j] can be
> described as (lon[i],lat[j]).  That is not the case for your data, because
> it is not on any sort of grid.  Instead, you will want to create a set of
> 3 1-dimensional arrays along the following lines:
>
> n_stations <- length(RN01)
> dim_station <- dim.def.ncdf( 'Radon_station', '-', 1:n_stations )
>
> var_lon <- var.def.ncdf( 'Longitude', 'degreesE', dim_station, 1.e30 )
> var_lat <- var.def.ncdf( 'Latitude',  'degreesN', dim_station, 1.e30 )
> var_radon <- var.def.ncdf( 'Radon',   'Bq/m2/h1', dim_stattion, 1.e30 )
>
> ncid_out <- create.ncdf( 'rn.weekly.nc', list(var_lon,var_lat,var_radon))
>
> put.var.ncdf( ncid_out, var_lon, long )
> put.var.ncdf( ncid_out, var_lat, lat  )
> put.var.ncdf( ncid_out, var_radon, RN01 )
>
> close.ncdf( ncid_out )
>
> Now, the location of data point RN01[i] is correctly described as
> (lon[i],lat[i]); compare this to what you were trying before, which was
> RN01[i,j] having the location (lon[i],lat[j]).
>
> Regards,
>
> --Dave
>
>
>
>
> Thomas Szegvary wrote:
>> I use ncdf V1.6 on Windows XP Sp2, I hava attached the sample file
>> (tab
>> delim) which contains 2 columns for coordinates long/lat and 10
>> columns for weekly averages of radon. Sp would be the best solution to
>> produce map I guess, but for time series analysis I think netcdf would
>> perform better.
>>
>> Thanks,thoams
>>
>>
>>
>> -----Urspr?ngliche Nachricht-----
>> Von: Michael Sumner [mailto:mdsumner at utas.edu.au]
>> Gesendet: Donnerstag, 9. August 2007 01:49
>> An: 'Thomas Szegvary'; r-sig-geo at stat.math.ethz.ch
>> Betreff: RE: [R-sig-Geo] Coordinate/grid for ncdf data
>>
>> Hi, can you provide an example file?
>>
>> I'd recommend avoiding NetCDF for various reasons, why don't you
>> simply add each value column from the separate files to a new column
>> in a SpatialGridDataFrame?
>>
>> That would be the recommend sp way to proceed here. If you really need
>> to create a NetCDF file, please let us know more about your OS and the
>> package/s and versions you are using (ncdf I presume?) - however such
>> questions should include the ncdf(?) package author at least.
>>
>> Cheers, Mike.
>>
>> -----Original Message-----
>> From: r-sig-geo-bounces at stat.math.ethz.ch
>> [mailto:r-sig-geo-bounces at stat.math.ethz.ch] On Behalf Of Thomas
>> Szegvary
>> Sent: Wednesday, 8 August 2007 11:13 PM
>> To: r-sig-geo at stat.math.ethz.ch
>> Subject: [R-sig-Geo] Coordinate/grid for ncdf data
>>
>> Hi!
>>
>> I have a table with 3 columns, 2 for long/lat coordinates and 1 for
>> values (radon concentration). I have data for every week of the year
>> 2006,distributed in 52 tables/files. I want to create a NetCDF file,
>> which is much easier to handle than extracting the values from 52
>> tables. I tried the following for the first dataset (i.e first week):
>>
>> #extracting coordinates and values from my tables (which have also
>> other information I don't need)
>> W01<-read.table("RN_weekly/KW01_RN.dat")
>> long<-W01$V1
>> lat<-W01$V2
>> RN01<-W01$V3
>>
>> #defining dimensions for coordinates
>> dim1 <- dim.def.ncdf( "EW","degrees", as.double(long))
>> dim2 <- dim.def.ncdf( "SN","degrees", as.double(lat))
>>
>> #defining variable for my values I want to have the time series varz
>> <- var.def.ncdf("Radon","Bq/m2/h1", list(dim1,dim2), -1,
>>           longname="Radon flux rate")
>>
>> #creating the netcdf file and filling the variable varz with the first
>> data-week from my time series nc.rn <-
>> create.ncdf("rn_weekly.nc",varz)
>> put.var.ncdf(nc.rn,varz,RN01)
>> close.ncdf(nc.rn)
>>
>>
>> The problem now is that the last step (put.var.ncdf) doesn't work,
>> because it says I am trying to "error: you asked to write 111788329
>> values, but the passed data array only has 10573* entries!". So I
>> think the problem is that I need an array with two dimensions
>> (coordinates...) for my values. But how do I get this from my tables??
>>
>>  *10573 are the pixels for my area
>>
>> Thanks for any help!
>> Thomas
>>
>>
>> __
>>
>> Thomas Szegvary
>> Institute of Environmental Geosciences Department of Geosciences
>> University of Basel Bernoullistrasse 30 CH - 4056 Basel
>>
>> Tel.  41-61-267 04 82
>> Fax. 41-61-267 04 79
>> Email: t.szegvary at unibas.ch
>> www.radon.unibas.ch
>> www.unibas.ch/environment
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>
> ---------------------------------------------------------------
> David W. Pierce        / Climate Research Division
> Scripps Inst. Oceanog. / (858) 534-8276 (voice)
> dpierce at ucsd.edu       / (858) 534-8561 (fax)
> ---------------------------------------------------------------
>
>
>


---------------------------------------------------------------
David W. Pierce        / Climate Research Division
Scripps Inst. Oceanog. / (858) 534-8276 (voice)
dpierce at ucsd.edu       / (858) 534-8561 (fax)



From Scott.Waichler at pnl.gov  Sat Aug 11 01:34:31 2007
From: Scott.Waichler at pnl.gov (Waichler, Scott R)
Date: Fri, 10 Aug 2007 16:34:31 -0700
Subject: [R-sig-Geo] Determine if a line segment intersects a polygon
Message-ID: <F807B6FD7E7BE144A22B8A449CDAD9340122100C@EMAIL02.pnl.gov>

I am looking for a method that would determine whether any part of a
line segment defined by (x0, y0) and (x1, y1) intersects a given polygon
(true or false).  I don't have any other geospatial needs here, so if a
solution exists using base R that would be great.

Thanks,
Scott Waichler
Pacific Northwest National Laboratory
scott.waichler _at_ pnl.gov



From mdsumner at utas.edu.au  Sat Aug 11 05:18:37 2007
From: mdsumner at utas.edu.au (Michael Sumner)
Date: Sat, 11 Aug 2007 13:18:37 +1000
Subject: [R-sig-Geo] reading HDF5 files
Message-ID: <200708110318.l7B3IbG2011584@corinna.its.utas.edu.au>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070811/f5770bf6/attachment.pl>

From Roger.Bivand at nhh.no  Sat Aug 11 12:58:09 2007
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sat, 11 Aug 2007 12:58:09 +0200 (CEST)
Subject: [R-sig-Geo] Determine if a line segment intersects a polygon
In-Reply-To: <F807B6FD7E7BE144A22B8A449CDAD9340122100C@EMAIL02.pnl.gov>
References: <F807B6FD7E7BE144A22B8A449CDAD9340122100C@EMAIL02.pnl.gov>
Message-ID: <Pine.LNX.4.64.0708111257230.1953@reclus.nhh.no>

On Fri, 10 Aug 2007, Waichler, Scott R wrote:

> I am looking for a method that would determine whether any part of a
> line segment defined by (x0, y0) and (x1, y1) intersects a given polygon
> (true or false).  I don't have any other geospatial needs here, so if a
> solution exists using base R that would be great.

Perhaps look at crossing.psp() in the spatstat package - there are lots of 
useful functions there.

Roger

>
> Thanks,
> Scott Waichler
> Pacific Northwest National Laboratory
> scott.waichler _at_ pnl.gov
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From Roger.Bivand at nhh.no  Sat Aug 11 13:02:06 2007
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sat, 11 Aug 2007 13:02:06 +0200 (CEST)
Subject: [R-sig-Geo] reading HDF5 files
In-Reply-To: <200708110318.l7B3IbG2011584@corinna.its.utas.edu.au>
References: <200708110318.l7B3IbG2011584@corinna.its.utas.edu.au>
Message-ID: <Pine.LNX.4.64.0708111258170.1953@reclus.nhh.no>

On Sat, 11 Aug 2007, Michael Sumner wrote:

> Note that readGDAL can read the subdataset directly (escaping the quotes
> appropriately):
>
> d <- readGDAL("HDF5:\"RAD_NL21_PCP_NA_200707200000.h5\"://image1/image_data")

The original questioner does not have an rgdal build against FWTools, and 
is just using FWTools gdal_translate outside R to get to a format that 
standard Windows rgdal can read, if I understand correctly.

Roger

>
> It also seems that your gdal_translate to TIFF output has the extension
> .img, but then you attempt to read from a tif.
>
> Just a thought.
>
> Cheers, Mike.
>
> ==============Original message text===============
> On Fri, 10 Aug 2007 19:09:00 +1000 Roger Bivand wrote:
>
> Paul,
>
> I have added a CC to the R-sig-geo list, since I myself have no experiece
> of using this format in practice. If you are not a member, please join at:
>
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> so that you will see any replies.
>
> Did you try gdalinfo on the output file?
>
> The error message suggests that the output file has a geographical
> coordinate reference system, with coordinate values outside the feasible
> range. From the HDF5 description, however, it ought to be projected,
> right? Do you need to make more use of the arguments taken by gdalinfo to
> give the output file the correct projected CRS?
>
> Roger
>
> On Fri, 10 Aug 2007, Paul Hiemstra wrote:
>
>> Dear Roger,
>>
>> I tried the route through a GTiff before I sent you the e-mail but
> somehow it
>> did not work. When I use gdalinfo on one of the .h5 files I get this:
>>
>> PS E:\LSO data\Regenbui 20-7\regenradar_rasters\regenradar_hdf5> gdalinfo
>> RAD_NL21_PCP_NA_200707200000.h5
>> Driver: HDF5/Hierarchical Data Format Release 5
>> Files: RAD_NL21_PCP_NA_200707200000.h5
>> Size is 512, 512
>> Coordinate System is `'
>> Metadata:
>>  map_projection:projection_indication=Y
>>  map_projection:projection_name=STEREOGRAPHIC
>>  map_projection:projection_proj4_params=+proj=stere +lat_0=90
>> +lon_0=0.0 +lat_ts=60.0 +a=6378.388 +b=6356.912 +x_0=0 +y_0=0
>> geographic: geo_number_rows=256
>> geographic: geo_number_columns=256
>> geographic: geo_pixel_size_x=2.500000
>> geographic: geo_pixel_size_y=-2.500000
>> geographic: geo_par_pixel=X,Y
>> geographic: geo_dim_pixel=KM,KM
>> geographic: geo_column_offset=0.000000
>> geographic: geo_row_offset=1490.906006
>> geographic: geo_pixel_def=LU
>> geographic: geo_product_corners=0.000000 49.769001 0.000000 55.296001
>> 9.743000 54.818001 8.337000 49.373001
>> calibration: calibration_flag=Y
>> calibration: calibration_formulas=GEO = 0.5 * PV + -31.5
>> calibration: calibration_missing_data=255
>> calibration: calibration_out_of_image=255
>> statistics: stat_min_value=-1.500000
>> statistics: stat_max_value=45.000000
>> image1: image_product_name=RAD_NL21_PCP_H0.8_NA
>> image1: image_geo_parameter=REFLECTIVITY_[DBZ]
>> image1: image_size=65536d
>> image1: image_bytes_per_pixel=1d
>> overview: product_group_name=RAD_NL21_PCP_NA
>> overview: products_missing=N/A
>> overview: hdftag_version_number=3.5
>> overview: number_image_groups=1
>> overview: number_satellite_groups=0d
>> overview: number_radar_groups=2d
>> overview: number_station_groups=0
>> overview: product_datetime_start=20-JUL-2007;00:00:11.000
>> overview: product_datetime_end=20-JUL-2007;00:00:11.000
>> overview: number_lightning_groups=0d
>> overview: number_classification_groups=0d
>> overview: number_grid_groups=0d
>> overview: number_point_groups=0d
>> overview: number_vector_groups=0d
>> radar1: radar_name=De_Bilt
>> radar1: radar_location=5.179000 52.103001
>> radar2: radar_name=Den_Helder
>> radar2: radar_location=4.790000 52.955002
>> Subdatasets:
>> SUBDATASET_0_NAME=HDF5:"RAD_NL21_PCP_NA_200707200000.h5"://image1/image_data
>> SUBDATASET_0_DESC=[256x256] //image1/image_data (8-bit unsigned character)
>> Corner Coordinates:
>> Upper Left  (    0.0,    0.0)
>> Lower Left  (    0.0,  512.0)
>> Upper Right (  512.0,    0.0)
>> Lower Right (  512.0,  512.0)
>> Center      (  256.0,  256.0)
>>
>> Then I use gdal_translate:
>> PS E:\LSO data\Regenbui 20-7\regenradar_rasters\regenradar_hdf5>
>> gdal_translate -of GTiff
>> HDF5:"RAD_NL21_PCP_NA_200707200000.h5"://image1/image_data
>> RAD_NL21_PCP_NA_200707200000.img
>>
>> Then I try to read the file using rgdal produces the following error:
>>
>>>  test = readGDAL("regenradar_hdf5/RAD_NL21_PCP_NA_200707200000.tif")
>> regenradar_hdf5/RAD_NL21_PCP_NA_200707200000.tif has GDAL driver GTiff
>> and has 256 rows and 256 columns
>> Closing GDAL dataset handle 0x0130b898...  destroyed ... done.
>> Error in `proj4string<-`(`*tmp*`, value = <S4 object of class "CRS">) :
>>        Geographical CRS given to non-conformant data
>>
>> Do you have an idea how to solve this?
>>
>> kind regards,
>>
>> Paul
>>
>>
>> Roger Bivand schreef:
>>>  Dear Paul,
>>>
>>>  There is information in the README.windows file in the package, this
>>>  should display it:
>>>
>>>  file.show(system.file("README.windows", package="rgdal"))
>>>
>>>  If you do not want to build against the FWTools binary, then just install
>>>  FWTools, and use the gdal_translate command line tool to convert your data
>>>  to a format that the standard rgdal windows binary can read, such as
>>>  gTiff. You'll need to play around a bit to find out what the data are
>>>  called.
>>>
>>>  On Linux, this is easier, because you can build GDAL against HDF5 before
>>>  installing rgdal, and there it "just works".
>>>
>>>  Hope this helps,
>>>
>>>  Roger
>>>
>>>  On Thu, 9 Aug 2007, Paul Hiemstra wrote:
>>>
>>>>  Dear mr. Bivand
>>>>
>>>>  My name is Paul Hiemstra, a PhD student of Edzer. I am trying to read
>>>>  HDF5 files through rgdal. If I use GDALinfo() on one of the files it
>>>>  produces the following error:
>>>>
>>>>  Error in .local(.Object, ...) :
>>>>        GDAL Error 4: `RAD_NL21_PCP_NA_200707200000.h5' not recognised as
>>>>  a supported file format.
>>>>
>>>>  On the mailing list
>>>>  (http://finzi.psych.upenn.edu/R/Rhelp02a/archive/92270.html) you >> >  metioned using the dll files from FWTools to get support for HDF5 into
>>>>  rgdal. How can this be done?
>>>>
>>>>  I also tried the hdf5 package on CRAN, but that does not seem to work,
>>>>  returning an empty object.
>>>>
>>>>  many thanks,
>>>>
>>>>  Paul
>>>>
>>>>
>>>
>>
>>
>>
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From mdsumner at utas.edu.au  Sat Aug 11 17:26:53 2007
From: mdsumner at utas.edu.au (Michael Sumner)
Date: Sun, 12 Aug 2007 1:26:53 +1000
Subject: [R-sig-Geo] reading HDF5 files
Message-ID: <200708111526.l7BFQrQ6002041@corinna.its.utas.edu.au>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070812/24a61ec7/attachment.pl>

From adrian at maths.uwa.edu.au  Sun Aug 12 09:40:32 2007
From: adrian at maths.uwa.edu.au (adrian at maths.uwa.edu.au)
Date: Sun, 12 Aug 2007 15:40:32 +0800 (WST)
Subject: [R-sig-Geo] Determine if a line segment intersects a polygon
Message-ID: <60363.58.169.237.227.1186904432.squirrel@58.169.237.227>

Scott Waichler writes:

> I am looking for a method that would determine whether any part of a
> line segment defined by (x0, y0) and (x1, y1) intersects a given polygon
> (true or false).

In the `spatstat' package you can use `crossing.psp' to do this.
Create a line segment pattern ("psp" object) A containing the edges of the
polygon. Create another "psp" object B containing the line segment.
Then C <- crossing.psp(A,B) returns all the intersection points, and
hit <- (C$n != 0) tells you whether there was an intersection.

Adrian Baddeley.



From Brian.J.GREGOR at odot.state.or.us  Sun Aug 12 19:29:12 2007
From: Brian.J.GREGOR at odot.state.or.us (GREGOR Brian J)
Date: Sun, 12 Aug 2007 10:29:12 -0700
Subject: [R-sig-Geo] Determine if a line segment intersects a polygon
In-Reply-To: <mailman.17.1186826406.28831.r-sig-geo@stat.math.ethz.ch>
Message-ID: <85F22579B2F963468877EC90D4A5DEB202232BC3@EX-SALEMREV-4.odot.state.or.us>

> I am looking for a method that would determine whether any part of a
> line segment defined by (x0, y0) and (x1, y1) intersects a 
> given polygon
> (true or false).  I don't have any other geospatial needs 
> here, so if a
> solution exists using base R that would be great.

I had to do something similar and used the "crossing.psp" function in
the "spatstat" package. It determines the crossing points of two sets of
line segments. You will need to convert the line segments describing the
polygon boundary into a line segment pattern of class "psp" used by
"spatstat".

Brian Gregor, P.E.
Transportation Planning Analysis Unit
Oregon Department of Transportation
Brian.J.GREGOR at odot.state.or.us
(503) 986-4120



From Agustin.Lobo at ija.csic.es  Mon Aug 13 12:35:52 2007
From: Agustin.Lobo at ija.csic.es (Agustin Lobo)
Date: Mon, 13 Aug 2007 12:35:52 +0200
Subject: [R-sig-Geo] distmap for polygons imported from shapefiles
In-Reply-To: <Pine.LNX.4.64.0708121425500.25555@reclus.nhh.no>
References: <46A71B33.2020300@ija.csic.es>
	<45085.130.95.98.17.1185771282.squirrel@130.95.98.17>
	<46AD931D.6060101@ija.csic.es>
	<37706.130.95.98.17.1185784238.squirrel@130.95.98.17>
	<46BEF6C2.9000902@ija.csic.es>
	<Pine.LNX.4.64.0708121425500.25555@reclus.nhh.no>
Message-ID: <46C03408.9040201@ija.csic.es>

The distmap calculation works fine for polygons
imported from shapefiles, thanks Adrian and Roger!
Agus

Roger Bivand escribi?:
> 
> Doing all the conversions as specified, it does work:
> 
> library(maptools)
> library(spatstat)
> load("refG.rda") 

#Note, refG comes from:
#refG <- 
#readOGR("C:/ALOBO/dipu2006/espaisoberts_P037/GARRAF/GFO_EOA_TOTS_v4",layer="GFO_EOA_Acti_v4")

> class(refG)
> ?as.owin.SpatialPolygons
> 
> # (note no method for SpatialPolygonsDataFrame)
> 
> plot(refG)
> .spatstat_check <- FALSE # this is the trick used to pass FALSE to check=
> w2 <- as(as(refG, "SpatialPolygons"), "owin")
> rm(.spatstat_check)
> plot(w2)
> p1 <- as.psp(w2)
> plot(p1)
> d <- distmap(p1)
> summary(d)
> plot(d)
> d[w2] <- NA
> summary(d)
> plot(d)
> 
> Use the ... to distmap() to set your own raster parameters.
> 
> Hope this helps,
> 
> Roger
> 
> 
>> I get:
>>
>> Warning messages:
>> 1: $ operator is deprecated for atomic vectors, returning NULL in: po$x
>> 2: $ operator is deprecated for atomic vectors, returning NULL in: po$x
>> 3: $ operator is deprecated for atomic vectors, returning NULL in: po$y
>> 4: $ operator is deprecated for atomic vectors, returning NULL in: po$x
>> 5: $ operator is deprecated for atomic vectors, returning NULL in: po$y
>>
>> If I represent
>>
>>>  plot(w)
>> I get an empty map. (summary(w) does not work)
>> and also for d:
>>>  summary(d)
>> real-valued pixel image
>> 100 x 100 pixel array (ny, nx)
>> enclosing rectangle: [8.67361737988404e-19, 1] x 
>> [8.67361737988404e-19, 1] units
>> dimensions of each pixel: 0.01 x 0.01 units
>> Image is defined on the full rectangular grid
>> Frame area =  1 square units
>> Pixel values :
>>         range = [0,0]
>>         integral = 0
>>         mean = 0
>>
>> While
>>>  plot(refG)
>> is correct.
>>
>> Finally,
>>>  d[w] <- NA
>> Error in verify.xypolygon(polly) : polygon must be a list with two 
>> components x and y
>>
>> I attach refG again. Remember it comes from
>> refG <- 
>> readOGR("C:/ALOBO/dipu2006/espaisoberts_P037/GARRAF/GFO_EOA_TOTS_v4",layer="GFO_EOA_Acti_v4") 
>>
>>
>> Agus
>>
>>
>>
>> adrian at maths.uwa.edu.au escribi?:
>>>  Agustin and Roger -
>>>
>>>  Regarding your query about the distance map of polygonal windows:
>>>
>>>  I forgot to mention that you can compute the distance map of a 
>>> collection
>>>  of *line segments* using distmap.psp. This is computed exactly using
>>>  Euclidean geometry. You can convert a polygonal window to a psp object
>>>  using as.psp.
>>>
>>>  So the following would work safely. Suppose 'mypoly' is a collection of
>>>  polygons that do not pass the polygon checking code in spatstat because
>>>  they have some common vertices. Then
>>>                    w <- owin(poly=mypoly, check=FALSE)
>>>                    d <- distmap(as.psp(w))
>>>                    d[w] <- NA
>>>
>>>  I hope this helps
>>>
>>>  regards
>>>  Adrian
>>>
>>>
>>>
>>
>>
> 

-- 
Dr. Agustin Lobo
Institut de Ciencies de la Terra "Jaume Almera" (CSIC)
LLuis Sole Sabaris s/n
08028 Barcelona
Spain
Tel. 34 934095410
Fax. 34 934110012
email: Agustin.Lobo at ija.csic.es
http://www.ija.csic.es/gt/obster



From p.hiemstra at geo.uu.nl  Tue Aug 14 11:07:37 2007
From: p.hiemstra at geo.uu.nl (Paul Hiemstra)
Date: Tue, 14 Aug 2007 11:07:37 +0200
Subject: [R-sig-Geo] reading HDF5 files
In-Reply-To: <200708110318.l7B3IbG2011584@corinna.its.utas.edu.au>
References: <200708110318.l7B3IbG2011584@corinna.its.utas.edu.au>
Message-ID: <46C170D9.3070703@geo.uu.nl>

Mike,

I tried, and failed, to directly load the HDF5 files into R using rgdal. 
The next thing I tried was to convert the .h5 file to a GTiff using 
FWTools. This seemed to work, but when I tried to load the file into R 
through rgdal I got the following error message:

test = readGDAL("regenradar_hdf5/RAD_NL21_PCP_NA_200707200000.tif")

> test = readGDAL("RAD_NL21_PCP_NA_200707200000.tif")
RAD_NL21_PCP_NA_200707200000.tif has GDAL driver GTiff 
and has 256 rows and 256 columns
Closing GDAL dataset handle 0x0226a220...  destroyed ... done.
Error in `proj4string<-`(`*tmp*`, value = <S4 object of class "CRS">) : 
        Geographical CRS given to non-conformant data
> traceback()
8: stop("Geographical CRS given to non-conformant data")
7: `proj4string<-`(`*tmp*`, value = <S4 object of class "CRS">)
6: SpatialGrid(grid, proj4string)
5: initialize(value, ...)
4: initialize(value, ...)
3: new("SpatialGridDataFrame", SpatialGrid(grid, proj4string), data = data)
2: SpatialGridDataFrame(grid = grid, data = data.frame(df), proj4string = CRS(p4s))
1: readGDAL("RAD_NL21_PCP_NA_200707200000.tif")
> sessionInfo()
R version 2.5.1 (2007-06-27) 
i386-pc-mingw32 

locale:
LC_COLLATE=Dutch_Netherlands.1252;LC_CTYPE=Dutch_Netherlands.1252;LC_MONETARY=Dutch_Netherlands.1252;LC_NUMERIC=C;LC_TIME=Dutch_Netherlands.1252

attached base packages:
[1] "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"   "base"     

other attached packages:
   rgdal       sp 
"0.5-14" "0.9-14" 

Do you have any idea what caused this error and how I can circumvent it?

Many thanks in advance,

Paul

Michael Sumner schreef:
> Note that readGDAL can read the subdataset directly (escaping the quotes
> appropriately):
>
> d <- readGDAL("HDF5:\"RAD_NL21_PCP_NA_200707200000.h5\"://image1/image_data")
>
> It also seems that your gdal_translate to TIFF output has the extension
> .img, but then you attempt to read from a tif.
>
> Just a thought. 
>
> Cheers, Mike.
>
> ==============Original message text===============
> On Fri, 10 Aug 2007 19:09:00 +1000 Roger Bivand wrote:
>
> Paul,
>
> I have added a CC to the R-sig-geo list, since I myself have no experiece 
> of using this format in practice. If you are not a member, please join at:
>
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> so that you will see any replies.
>
> Did you try gdalinfo on the output file?
>
> The error message suggests that the output file has a geographical 
> coordinate reference system, with coordinate values outside the feasible 
> range. From the HDF5 description, however, it ought to be projected, 
> right? Do you need to make more use of the arguments taken by gdalinfo to 
> give the output file the correct projected CRS?
>
> Roger
>
> On Fri, 10 Aug 2007, Paul Hiemstra wrote:
>
>   
>> Dear Roger,
>>
>> I tried the route through a GTiff before I sent you the e-mail but
>>     
> somehow it 
>   
>> did not work. When I use gdalinfo on one of the .h5 files I get this:
>>
>> PS E:\LSO data\Regenbui 20-7\regenradar_rasters\regenradar_hdf5> gdalinfo 
>> RAD_NL21_PCP_NA_200707200000.h5
>> Driver: HDF5/Hierarchical Data Format Release 5
>> Files: RAD_NL21_PCP_NA_200707200000.h5
>> Size is 512, 512
>> Coordinate System is `'
>> Metadata:
>>  map_projection:projection_indication=Y
>>  map_projection:projection_name=STEREOGRAPHIC
>>  map_projection:projection_proj4_params=+proj=stere +lat_0=90 
>> +lon_0=0.0 +lat_ts=60.0 +a=6378.388 +b=6356.912 +x_0=0 +y_0=0
>> geographic: geo_number_rows=256
>> geographic: geo_number_columns=256
>> geographic: geo_pixel_size_x=2.500000
>> geographic: geo_pixel_size_y=-2.500000
>> geographic: geo_par_pixel=X,Y
>> geographic: geo_dim_pixel=KM,KM
>> geographic: geo_column_offset=0.000000
>> geographic: geo_row_offset=1490.906006
>> geographic: geo_pixel_def=LU
>> geographic: geo_product_corners=0.000000 49.769001 0.000000 55.296001 
>> 9.743000 54.818001 8.337000 49.373001
>> calibration: calibration_flag=Y
>> calibration: calibration_formulas=GEO = 0.5 * PV + -31.5
>> calibration: calibration_missing_data=255
>> calibration: calibration_out_of_image=255
>> statistics: stat_min_value=-1.500000
>> statistics: stat_max_value=45.000000
>> image1: image_product_name=RAD_NL21_PCP_H0.8_NA
>> image1: image_geo_parameter=REFLECTIVITY_[DBZ]
>> image1: image_size=65536d
>> image1: image_bytes_per_pixel=1d
>> overview: product_group_name=RAD_NL21_PCP_NA
>> overview: products_missing=N/A
>> overview: hdftag_version_number=3.5
>> overview: number_image_groups=1
>> overview: number_satellite_groups=0d
>> overview: number_radar_groups=2d
>> overview: number_station_groups=0
>> overview: product_datetime_start=20-JUL-2007;00:00:11.000
>> overview: product_datetime_end=20-JUL-2007;00:00:11.000
>> overview: number_lightning_groups=0d
>> overview: number_classification_groups=0d
>> overview: number_grid_groups=0d
>> overview: number_point_groups=0d
>> overview: number_vector_groups=0d
>> radar1: radar_name=De_Bilt
>> radar1: radar_location=5.179000 52.103001
>> radar2: radar_name=Den_Helder
>> radar2: radar_location=4.790000 52.955002
>> Subdatasets:
>> SUBDATASET_0_NAME=HDF5:"RAD_NL21_PCP_NA_200707200000.h5"://image1/image_data
>> SUBDATASET_0_DESC=[256x256] //image1/image_data (8-bit unsigned character)
>> Corner Coordinates:
>> Upper Left  (    0.0,    0.0)
>> Lower Left  (    0.0,  512.0)
>> Upper Right (  512.0,    0.0)
>> Lower Right (  512.0,  512.0)
>> Center      (  256.0,  256.0)
>>
>> Then I use gdal_translate:
>> PS E:\LSO data\Regenbui 20-7\regenradar_rasters\regenradar_hdf5> 
>> gdal_translate -of GTiff 
>> HDF5:"RAD_NL21_PCP_NA_200707200000.h5"://image1/image_data 
>> RAD_NL21_PCP_NA_200707200000.img
>>
>> Then I try to read the file using rgdal produces the following error:
>>
>>     
>>>  test = readGDAL("regenradar_hdf5/RAD_NL21_PCP_NA_200707200000.tif")
>>>       
>> regenradar_hdf5/RAD_NL21_PCP_NA_200707200000.tif has GDAL driver GTiff
>> and has 256 rows and 256 columns
>> Closing GDAL dataset handle 0x0130b898...  destroyed ... done.
>> Error in `proj4string<-`(`*tmp*`, value = <S4 object of class "CRS">) :
>>        Geographical CRS given to non-conformant data
>>
>> Do you have an idea how to solve this?
>>
>> kind regards,
>>
>> Paul
>>
>>
>> Roger Bivand schreef:
>>     
>>>  Dear Paul,
>>>
>>>  There is information in the README.windows file in the package, this
>>>  should display it:
>>>
>>>  file.show(system.file("README.windows", package="rgdal"))
>>>
>>>  If you do not want to build against the FWTools binary, then just install
>>>  FWTools, and use the gdal_translate command line tool to convert your data
>>>  to a format that the standard rgdal windows binary can read, such as
>>>  gTiff. You'll need to play around a bit to find out what the data are
>>>  called.
>>>
>>>  On Linux, this is easier, because you can build GDAL against HDF5 before
>>>  installing rgdal, and there it "just works".
>>>
>>>  Hope this helps,
>>>
>>>  Roger
>>>
>>>  On Thu, 9 Aug 2007, Paul Hiemstra wrote:
>>>
>>>       
>>>>  Dear mr. Bivand
>>>>
>>>>  My name is Paul Hiemstra, a PhD student of Edzer. I am trying to read 
>>>>  HDF5 files through rgdal. If I use GDALinfo() on one of the files it 
>>>>  produces the following error:
>>>>
>>>>  Error in .local(.Object, ...) :
>>>>        GDAL Error 4: `RAD_NL21_PCP_NA_200707200000.h5' not recognised as 
>>>>  a supported file format.
>>>>
>>>>  On the mailing list 
>>>>  (http://finzi.psych.upenn.edu/R/Rhelp02a/archive/92270.html) you >> >  metioned using the dll files from FWTools to get support for HDF5 into 
>>>>  rgdal. How can this be done?
>>>>
>>>>  I also tried the hdf5 package on CRAN, but that does not seem to work, 
>>>>  returning an empty object.
>>>>
>>>>  many thanks,
>>>>
>>>>  Paul
>>>>
>>>>
>>>>         
>>
>>     
>
>   


-- 
Drs. Paul Hiemstra
Department of Physical Geography
Faculty of Geosciences
University of Utrecht
Heidelberglaan 2
P.O. Box 80.115
3508 TC Utrecht
Phone: 	+31302535773
Fax:	+31302531145
http://intamap.geo.uu.nl/~paul



From p.hiemstra at geo.uu.nl  Tue Aug 14 11:16:47 2007
From: p.hiemstra at geo.uu.nl (Paul Hiemstra)
Date: Tue, 14 Aug 2007 11:16:47 +0200
Subject: [R-sig-Geo] reading HDF5 files
In-Reply-To: <200708110318.l7B3IbG2011584@corinna.its.utas.edu.au>
References: <200708110318.l7B3IbG2011584@corinna.its.utas.edu.au>
Message-ID: <46C172FF.5040308@geo.uu.nl>

Mike,

This is the result of using gdalinfo (FWTools) on the .tif file,

E:\LSO data\Regenbui 20-7\regenradar_rasters\regenradar_tif>gdalinfo 
RAD_NL21_PCP_NA_200707200000.tif
Driver: GTiff/GeoTIFF
Files: RAD_NL21_PCP_NA_200707200000.tif
       RAD_NL21_PCP_NA_200707200000.aux
Size is 256, 256
Coordinate System is:
GEOGCS["WGS 84",
    DATUM["WGS_1984",
        SPHEROID["WGS 84",6378137,298.2572235630016,
            AUTHORITY["EPSG","7030"]],
        AUTHORITY["EPSG","6326"]],
    PRIMEM["Greenwich",0],
    UNIT["degree",0.0174532925199433],
    AUTHORITY["EPSG","4326"]]
Metadata:
  AREA_OR_POINT=Area
  map_projection=projection_proj4_params=+proj=stere +lat_0=90 
+lon_0=0.0 +lat_ts=60.0 +a=6378.388 +b=6356.912 +x_0=0 +y_0=0
  geographic=geo_product_corners=0.000000 49.769001 0.000000 55.296001 
9.743000 54.818001 8.337000 49.373001
  calibration=calibration_out_of_image=255
  statistics=stat_max_value=45.000000
  image1=image_bytes_per_pixel=1d
  overview=number_vector_groups=0d
  radar1=radar_location=5.179000 52.103001
  radar2=radar_location=4.790000 52.955002
Corner Coordinates:
Upper Left  (    0.0,    0.0)
Lower Left  (    0.0,  256.0)
Upper Right (  256.0,    0.0)
Lower Right (  256.0,  256.0)
Center      (  128.0,  128.0)
Band 1 Block=256x32 Type=Byte, ColorInterp=Gray
  Metadata:
    image_data=DISPLAY_ORIGIN=UL

cheers, Paul

Michael Sumner schreef:
> Note that readGDAL can read the subdataset directly (escaping the quotes
> appropriately):
>
> d <- readGDAL("HDF5:\"RAD_NL21_PCP_NA_200707200000.h5\"://image1/image_data")
>
> It also seems that your gdal_translate to TIFF output has the extension
> .img, but then you attempt to read from a tif.
>
> Just a thought. 
>
> Cheers, Mike.
>
> ==============Original message text===============
> On Fri, 10 Aug 2007 19:09:00 +1000 Roger Bivand wrote:
>
> Paul,
>
> I have added a CC to the R-sig-geo list, since I myself have no experiece 
> of using this format in practice. If you are not a member, please join at:
>
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> so that you will see any replies.
>
> Did you try gdalinfo on the output file?
>
> The error message suggests that the output file has a geographical 
> coordinate reference system, with coordinate values outside the feasible 
> range. From the HDF5 description, however, it ought to be projected, 
> right? Do you need to make more use of the arguments taken by gdalinfo to 
> give the output file the correct projected CRS?
>
> Roger
>
> On Fri, 10 Aug 2007, Paul Hiemstra wrote:
>
>   
>> Dear Roger,
>>
>> I tried the route through a GTiff before I sent you the e-mail but
>>     
> somehow it 
>   
>> did not work. When I use gdalinfo on one of the .h5 files I get this:
>>
>> PS E:\LSO data\Regenbui 20-7\regenradar_rasters\regenradar_hdf5> gdalinfo 
>> RAD_NL21_PCP_NA_200707200000.h5
>> Driver: HDF5/Hierarchical Data Format Release 5
>> Files: RAD_NL21_PCP_NA_200707200000.h5
>> Size is 512, 512
>> Coordinate System is `'
>> Metadata:
>>  map_projection:projection_indication=Y
>>  map_projection:projection_name=STEREOGRAPHIC
>>  map_projection:projection_proj4_params=+proj=stere +lat_0=90 
>> +lon_0=0.0 +lat_ts=60.0 +a=6378.388 +b=6356.912 +x_0=0 +y_0=0
>> geographic: geo_number_rows=256
>> geographic: geo_number_columns=256
>> geographic: geo_pixel_size_x=2.500000
>> geographic: geo_pixel_size_y=-2.500000
>> geographic: geo_par_pixel=X,Y
>> geographic: geo_dim_pixel=KM,KM
>> geographic: geo_column_offset=0.000000
>> geographic: geo_row_offset=1490.906006
>> geographic: geo_pixel_def=LU
>> geographic: geo_product_corners=0.000000 49.769001 0.000000 55.296001 
>> 9.743000 54.818001 8.337000 49.373001
>> calibration: calibration_flag=Y
>> calibration: calibration_formulas=GEO = 0.5 * PV + -31.5
>> calibration: calibration_missing_data=255
>> calibration: calibration_out_of_image=255
>> statistics: stat_min_value=-1.500000
>> statistics: stat_max_value=45.000000
>> image1: image_product_name=RAD_NL21_PCP_H0.8_NA
>> image1: image_geo_parameter=REFLECTIVITY_[DBZ]
>> image1: image_size=65536d
>> image1: image_bytes_per_pixel=1d
>> overview: product_group_name=RAD_NL21_PCP_NA
>> overview: products_missing=N/A
>> overview: hdftag_version_number=3.5
>> overview: number_image_groups=1
>> overview: number_satellite_groups=0d
>> overview: number_radar_groups=2d
>> overview: number_station_groups=0
>> overview: product_datetime_start=20-JUL-2007;00:00:11.000
>> overview: product_datetime_end=20-JUL-2007;00:00:11.000
>> overview: number_lightning_groups=0d
>> overview: number_classification_groups=0d
>> overview: number_grid_groups=0d
>> overview: number_point_groups=0d
>> overview: number_vector_groups=0d
>> radar1: radar_name=De_Bilt
>> radar1: radar_location=5.179000 52.103001
>> radar2: radar_name=Den_Helder
>> radar2: radar_location=4.790000 52.955002
>> Subdatasets:
>> SUBDATASET_0_NAME=HDF5:"RAD_NL21_PCP_NA_200707200000.h5"://image1/image_data
>> SUBDATASET_0_DESC=[256x256] //image1/image_data (8-bit unsigned character)
>> Corner Coordinates:
>> Upper Left  (    0.0,    0.0)
>> Lower Left  (    0.0,  512.0)
>> Upper Right (  512.0,    0.0)
>> Lower Right (  512.0,  512.0)
>> Center      (  256.0,  256.0)
>>
>> Then I use gdal_translate:
>> PS E:\LSO data\Regenbui 20-7\regenradar_rasters\regenradar_hdf5> 
>> gdal_translate -of GTiff 
>> HDF5:"RAD_NL21_PCP_NA_200707200000.h5"://image1/image_data 
>> RAD_NL21_PCP_NA_200707200000.img
>>
>> Then I try to read the file using rgdal produces the following error:
>>
>>     
>>>  test = readGDAL("regenradar_hdf5/RAD_NL21_PCP_NA_200707200000.tif")
>>>       
>> regenradar_hdf5/RAD_NL21_PCP_NA_200707200000.tif has GDAL driver GTiff
>> and has 256 rows and 256 columns
>> Closing GDAL dataset handle 0x0130b898...  destroyed ... done.
>> Error in `proj4string<-`(`*tmp*`, value = <S4 object of class "CRS">) :
>>        Geographical CRS given to non-conformant data
>>
>> Do you have an idea how to solve this?
>>
>> kind regards,
>>
>> Paul
>>
>>
>> Roger Bivand schreef:
>>     
>>>  Dear Paul,
>>>
>>>  There is information in the README.windows file in the package, this
>>>  should display it:
>>>
>>>  file.show(system.file("README.windows", package="rgdal"))
>>>
>>>  If you do not want to build against the FWTools binary, then just install
>>>  FWTools, and use the gdal_translate command line tool to convert your data
>>>  to a format that the standard rgdal windows binary can read, such as
>>>  gTiff. You'll need to play around a bit to find out what the data are
>>>  called.
>>>
>>>  On Linux, this is easier, because you can build GDAL against HDF5 before
>>>  installing rgdal, and there it "just works".
>>>
>>>  Hope this helps,
>>>
>>>  Roger
>>>
>>>  On Thu, 9 Aug 2007, Paul Hiemstra wrote:
>>>
>>>       
>>>>  Dear mr. Bivand
>>>>
>>>>  My name is Paul Hiemstra, a PhD student of Edzer. I am trying to read 
>>>>  HDF5 files through rgdal. If I use GDALinfo() on one of the files it 
>>>>  produces the following error:
>>>>
>>>>  Error in .local(.Object, ...) :
>>>>        GDAL Error 4: `RAD_NL21_PCP_NA_200707200000.h5' not recognised as 
>>>>  a supported file format.
>>>>
>>>>  On the mailing list 
>>>>  (http://finzi.psych.upenn.edu/R/Rhelp02a/archive/92270.html) you >> >  metioned using the dll files from FWTools to get support for HDF5 into 
>>>>  rgdal. How can this be done?
>>>>
>>>>  I also tried the hdf5 package on CRAN, but that does not seem to work, 
>>>>  returning an empty object.
>>>>
>>>>  many thanks,
>>>>
>>>>  Paul
>>>>
>>>>
>>>>         
>>
>>     
>
>   


-- 
Drs. Paul Hiemstra
Department of Physical Geography
Faculty of Geosciences
University of Utrecht
Heidelberglaan 2
P.O. Box 80.115
3508 TC Utrecht
Phone: 	+31302535773
Fax:	+31302531145
http://intamap.geo.uu.nl/~paul



From Roger.Bivand at nhh.no  Tue Aug 14 11:22:45 2007
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 14 Aug 2007 11:22:45 +0200 (CEST)
Subject: [R-sig-Geo] reading HDF5 files
In-Reply-To: <46C170D9.3070703@geo.uu.nl>
References: <200708110318.l7B3IbG2011584@corinna.its.utas.edu.au>
	<46C170D9.3070703@geo.uu.nl>
Message-ID: <Pine.LNX.4.64.0708141115450.32131@reclus.nhh.no>

On Tue, 14 Aug 2007, Paul Hiemstra wrote:

> Mike,
>
> I tried, and failed, to directly load the HDF5 files into R using rgdal.
> The next thing I tried was to convert the .h5 file to a GTiff using
> FWTools. This seemed to work, but when I tried to load the file into R
> through rgdal I got the following error message:
>
> test = readGDAL("regenradar_hdf5/RAD_NL21_PCP_NA_200707200000.tif")
>
>> test = readGDAL("RAD_NL21_PCP_NA_200707200000.tif")
> RAD_NL21_PCP_NA_200707200000.tif has GDAL driver GTiff
> and has 256 rows and 256 columns
> Closing GDAL dataset handle 0x0226a220...  destroyed ... done.
> Error in `proj4string<-`(`*tmp*`, value = <S4 object of class "CRS">) :
>        Geographical CRS given to non-conformant data

Please state the gdalinfo of the input HDF5, and the output gTiff. Your 
use of gdal_translate seems to be mangling the (IIRC) projected 
coordinate reference system of the HDF5 to a geographical coordinate 
reference system, with the result that the coordinate values are "out of 
bounds". I think you need to show the full gdal_translate command, and to 
look at the help page:

http://www.gdal.org/gdal_translate.html

and try out the -a_srs option. Maybe also look at the -sds option if you 
are not sure that the subset is being chosen correctly.

Once gdalinfo on the output gTiff shows a geographical coordinate 
reference system, rgdal will work (unless this is near-polar and you have 
a raster cell boundary > |90|, which does happen sometimes - then you need 
to adjust the input data).

Roger


>> traceback()
> 8: stop("Geographical CRS given to non-conformant data")
> 7: `proj4string<-`(`*tmp*`, value = <S4 object of class "CRS">)
> 6: SpatialGrid(grid, proj4string)
> 5: initialize(value, ...)
> 4: initialize(value, ...)
> 3: new("SpatialGridDataFrame", SpatialGrid(grid, proj4string), data = data)
> 2: SpatialGridDataFrame(grid = grid, data = data.frame(df), proj4string = CRS(p4s))
> 1: readGDAL("RAD_NL21_PCP_NA_200707200000.tif")
>> sessionInfo()
> R version 2.5.1 (2007-06-27)
> i386-pc-mingw32
>
> locale:
> LC_COLLATE=Dutch_Netherlands.1252;LC_CTYPE=Dutch_Netherlands.1252;LC_MONETARY=Dutch_Netherlands.1252;LC_NUMERIC=C;LC_TIME=Dutch_Netherlands.1252
>
> attached base packages:
> [1] "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"   "base"
>
> other attached packages:
>   rgdal       sp
> "0.5-14" "0.9-14"
>
> Do you have any idea what caused this error and how I can circumvent it?
>
> Many thanks in advance,
>
> Paul
>
> Michael Sumner schreef:
>> Note that readGDAL can read the subdataset directly (escaping the quotes
>> appropriately):
>>
>> d <- readGDAL("HDF5:\"RAD_NL21_PCP_NA_200707200000.h5\"://image1/image_data")
>>
>> It also seems that your gdal_translate to TIFF output has the extension
>> .img, but then you attempt to read from a tif.
>>
>> Just a thought.
>>
>> Cheers, Mike.
>>
>> ==============Original message text===============
>> On Fri, 10 Aug 2007 19:09:00 +1000 Roger Bivand wrote:
>>
>> Paul,
>>
>> I have added a CC to the R-sig-geo list, since I myself have no experiece
>> of using this format in practice. If you are not a member, please join at:
>>
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>> so that you will see any replies.
>>
>> Did you try gdalinfo on the output file?
>>
>> The error message suggests that the output file has a geographical
>> coordinate reference system, with coordinate values outside the feasible
>> range. From the HDF5 description, however, it ought to be projected,
>> right? Do you need to make more use of the arguments taken by gdalinfo to
>> give the output file the correct projected CRS?
>>
>> Roger
>>
>> On Fri, 10 Aug 2007, Paul Hiemstra wrote:
>>
>>
>>> Dear Roger,
>>>
>>> I tried the route through a GTiff before I sent you the e-mail but
>>>
>> somehow it
>>
>>> did not work. When I use gdalinfo on one of the .h5 files I get this:
>>>
>>> PS E:\LSO data\Regenbui 20-7\regenradar_rasters\regenradar_hdf5> gdalinfo
>>> RAD_NL21_PCP_NA_200707200000.h5
>>> Driver: HDF5/Hierarchical Data Format Release 5
>>> Files: RAD_NL21_PCP_NA_200707200000.h5
>>> Size is 512, 512
>>> Coordinate System is `'
>>> Metadata:
>>>  map_projection:projection_indication=Y
>>>  map_projection:projection_name=STEREOGRAPHIC
>>>  map_projection:projection_proj4_params=+proj=stere +lat_0=90
>>> +lon_0=0.0 +lat_ts=60.0 +a=6378.388 +b=6356.912 +x_0=0 +y_0=0
>>> geographic: geo_number_rows=256
>>> geographic: geo_number_columns=256
>>> geographic: geo_pixel_size_x=2.500000
>>> geographic: geo_pixel_size_y=-2.500000
>>> geographic: geo_par_pixel=X,Y
>>> geographic: geo_dim_pixel=KM,KM
>>> geographic: geo_column_offset=0.000000
>>> geographic: geo_row_offset=1490.906006
>>> geographic: geo_pixel_def=LU
>>> geographic: geo_product_corners=0.000000 49.769001 0.000000 55.296001
>>> 9.743000 54.818001 8.337000 49.373001
>>> calibration: calibration_flag=Y
>>> calibration: calibration_formulas=GEO = 0.5 * PV + -31.5
>>> calibration: calibration_missing_data=255
>>> calibration: calibration_out_of_image=255
>>> statistics: stat_min_value=-1.500000
>>> statistics: stat_max_value=45.000000
>>> image1: image_product_name=RAD_NL21_PCP_H0.8_NA
>>> image1: image_geo_parameter=REFLECTIVITY_[DBZ]
>>> image1: image_size=65536d
>>> image1: image_bytes_per_pixel=1d
>>> overview: product_group_name=RAD_NL21_PCP_NA
>>> overview: products_missing=N/A
>>> overview: hdftag_version_number=3.5
>>> overview: number_image_groups=1
>>> overview: number_satellite_groups=0d
>>> overview: number_radar_groups=2d
>>> overview: number_station_groups=0
>>> overview: product_datetime_start=20-JUL-2007;00:00:11.000
>>> overview: product_datetime_end=20-JUL-2007;00:00:11.000
>>> overview: number_lightning_groups=0d
>>> overview: number_classification_groups=0d
>>> overview: number_grid_groups=0d
>>> overview: number_point_groups=0d
>>> overview: number_vector_groups=0d
>>> radar1: radar_name=De_Bilt
>>> radar1: radar_location=5.179000 52.103001
>>> radar2: radar_name=Den_Helder
>>> radar2: radar_location=4.790000 52.955002
>>> Subdatasets:
>>> SUBDATASET_0_NAME=HDF5:"RAD_NL21_PCP_NA_200707200000.h5"://image1/image_data
>>> SUBDATASET_0_DESC=[256x256] //image1/image_data (8-bit unsigned character)
>>> Corner Coordinates:
>>> Upper Left  (    0.0,    0.0)
>>> Lower Left  (    0.0,  512.0)
>>> Upper Right (  512.0,    0.0)
>>> Lower Right (  512.0,  512.0)
>>> Center      (  256.0,  256.0)
>>>
>>> Then I use gdal_translate:
>>> PS E:\LSO data\Regenbui 20-7\regenradar_rasters\regenradar_hdf5>
>>> gdal_translate -of GTiff
>>> HDF5:"RAD_NL21_PCP_NA_200707200000.h5"://image1/image_data
>>> RAD_NL21_PCP_NA_200707200000.img
>>>
>>> Then I try to read the file using rgdal produces the following error:
>>>
>>>
>>>>  test = readGDAL("regenradar_hdf5/RAD_NL21_PCP_NA_200707200000.tif")
>>>>
>>> regenradar_hdf5/RAD_NL21_PCP_NA_200707200000.tif has GDAL driver GTiff
>>> and has 256 rows and 256 columns
>>> Closing GDAL dataset handle 0x0130b898...  destroyed ... done.
>>> Error in `proj4string<-`(`*tmp*`, value = <S4 object of class "CRS">) :
>>>        Geographical CRS given to non-conformant data
>>>
>>> Do you have an idea how to solve this?
>>>
>>> kind regards,
>>>
>>> Paul
>>>
>>>
>>> Roger Bivand schreef:
>>>
>>>>  Dear Paul,
>>>>
>>>>  There is information in the README.windows file in the package, this
>>>>  should display it:
>>>>
>>>>  file.show(system.file("README.windows", package="rgdal"))
>>>>
>>>>  If you do not want to build against the FWTools binary, then just install
>>>>  FWTools, and use the gdal_translate command line tool to convert your data
>>>>  to a format that the standard rgdal windows binary can read, such as
>>>>  gTiff. You'll need to play around a bit to find out what the data are
>>>>  called.
>>>>
>>>>  On Linux, this is easier, because you can build GDAL against HDF5 before
>>>>  installing rgdal, and there it "just works".
>>>>
>>>>  Hope this helps,
>>>>
>>>>  Roger
>>>>
>>>>  On Thu, 9 Aug 2007, Paul Hiemstra wrote:
>>>>
>>>>
>>>>>  Dear mr. Bivand
>>>>>
>>>>>  My name is Paul Hiemstra, a PhD student of Edzer. I am trying to read
>>>>>  HDF5 files through rgdal. If I use GDALinfo() on one of the files it
>>>>>  produces the following error:
>>>>>
>>>>>  Error in .local(.Object, ...) :
>>>>>        GDAL Error 4: `RAD_NL21_PCP_NA_200707200000.h5' not recognised as
>>>>>  a supported file format.
>>>>>
>>>>>  On the mailing list
>>>>>  (http://finzi.psych.upenn.edu/R/Rhelp02a/archive/92270.html) you >> >  metioned using the dll files from FWTools to get support for HDF5 into
>>>>>  rgdal. How can this be done?
>>>>>
>>>>>  I also tried the hdf5 package on CRAN, but that does not seem to work,
>>>>>  returning an empty object.
>>>>>
>>>>>  many thanks,
>>>>>
>>>>>  Paul
>>>>>
>>>>>
>>>>>
>>>
>>>
>>
>>
>
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From p.hiemstra at geo.uu.nl  Tue Aug 14 11:38:24 2007
From: p.hiemstra at geo.uu.nl (Paul Hiemstra)
Date: Tue, 14 Aug 2007 11:38:24 +0200
Subject: [R-sig-Geo] reading HDF5 files
In-Reply-To: <Pine.LNX.4.64.0708141115450.32131@reclus.nhh.no>
References: <200708110318.l7B3IbG2011584@corinna.its.utas.edu.au>
	<46C170D9.3070703@geo.uu.nl>
	<Pine.LNX.4.64.0708141115450.32131@reclus.nhh.no>
Message-ID: <46C17810.40001@geo.uu.nl>

Dear Roger/Mike,

Thanks for all the feedback! This is the full gdal_translate command I used:

gdal_translate -of GTiff 
HDF5:"RAD_NL21_PCP_NA_200707202345.h5"://image1/image_data 
../regenradar_tif/RAD_NL21_PCP_NA_20070720234.tif

And the gdalinfo results

HDF5:
E:\LSO data\Regenbui 20-7\regenradar_rasters\regenradar_hdf5>gdalinfo 
RAD_NL21_PCP_NA_200707200000.h5
Driver: HDF5/Hierarchical Data Format Release 5
Files: RAD_NL21_PCP_NA_200707200000.h5
Size is 512, 512
Coordinate System is `'
Metadata:
  map_projection:projection_indication=Y
  map_projection:projection_name=STEREOGRAPHIC
  map_projection:projection_proj4_params=+proj=stere +lat_0=90 
+lon_0=0.0 +lat_ts=60.0 +a=6378.388 +b=6356.912 +x_0=0 +y_0=0
  geographic:geo_number_rows=256
  geographic:geo_number_columns=256
  geographic:geo_pixel_size_x=2.500000
  geographic:geo_pixel_size_y=-2.500000
  geographic:geo_par_pixel=X,Y
  geographic:geo_dim_pixel=KM,KM
  geographic:geo_column_offset=0.000000
  geographic:geo_row_offset=1490.906006
  geographic:geo_pixel_def=LU
  geographic:geo_product_corners=0.000000 49.769001 0.000000 55.296001 
9.743000 54.818001 8.337000 49.373001
  calibration:calibration_flag=Y
  calibration:calibration_formulas=GEO = 0.5 * PV + -31.5
  calibration:calibration_missing_data=255
  calibration:calibration_out_of_image=255
  statistics:stat_min_value=-1.500000
  statistics:stat_max_value=45.000000
  image1:image_product_name=RAD_NL21_PCP_H0.8_NA
  image1:image_geo_parameter=REFLECTIVITY_[DBZ]
  image1:image_size=65536d
  image1:image_bytes_per_pixel=1d
  overview:product_group_name=RAD_NL21_PCP_NA
  overview:products_missing=N/A
  overview:hdftag_version_number=3.5
  overview:number_image_groups=1
  overview:number_satellite_groups=0d
  overview:number_radar_groups=2d
  overview:number_station_groups=0
  overview:product_datetime_start=20-JUL-2007;00:00:11.000
  overview:product_datetime_end=20-JUL-2007;00:00:11.000
  overview:number_lightning_groups=0d
  overview:number_classification_groups=0d
  overview:number_grid_groups=0d
  overview:number_point_groups=0d
  overview:number_vector_groups=0d
  radar1:radar_name=De_Bilt
  radar1:radar_location=5.179000 52.103001
  radar2:radar_name=Den_Helder
  radar2:radar_location=4.790000 52.955002
Subdatasets:
  
SUBDATASET_0_NAME=HDF5:"RAD_NL21_PCP_NA_200707200000.h5"://image1/image_data
  SUBDATASET_0_DESC=[256x256] //image1/image_data (8-bit unsigned character)
Corner Coordinates:
Upper Left  (    0.0,    0.0)
Lower Left  (    0.0,  512.0)
Upper Right (  512.0,    0.0)
Lower Right (  512.0,  512.0)
Center      (  256.0,  256.0)

GTiff
E:\LSO data\Regenbui 20-7\regenradar_rasters\regenradar_tif>gdalinfo 
RAD_NL21_PCP_NA_200707200000.tif
Driver: GTiff/GeoTIFF
Files: RAD_NL21_PCP_NA_200707200000.tif
       RAD_NL21_PCP_NA_200707200000.aux
Size is 256, 256
Coordinate System is:
GEOGCS["WGS 84",
    DATUM["WGS_1984",
        SPHEROID["WGS 84",6378137,298.2572235630016,
            AUTHORITY["EPSG","7030"]],
        AUTHORITY["EPSG","6326"]],
    PRIMEM["Greenwich",0],
    UNIT["degree",0.0174532925199433],
    AUTHORITY["EPSG","4326"]]
Metadata:
  AREA_OR_POINT=Area
  map_projection=projection_proj4_params=+proj=stere +lat_0=90 
+lon_0=0.0 +lat_ts=60.0 +a=6378.388 +b=6356.912 +x_0=0 +y_0=0
  geographic=geo_product_corners=0.000000 49.769001 0.000000 55.296001 
9.743000 54.818001 8.337000 49.373001
  calibration=calibration_out_of_image=255
  statistics=stat_max_value=45.000000
  image1=image_bytes_per_pixel=1d
  overview=number_vector_groups=0d
  radar1=radar_location=5.179000 52.103001
  radar2=radar_location=4.790000 52.955002
Corner Coordinates:
Upper Left  (    0.0,    0.0)
Lower Left  (    0.0,  256.0)
Upper Right (  256.0,    0.0)
Lower Right (  256.0,  256.0)
Center      (  128.0,  128.0)
Band 1 Block=256x32 Type=Byte, ColorInterp=Gray
  Metadata:
    image_data=DISPLAY_ORIGIN=UL

thanks,

Paul

Roger Bivand schreef:
> On Tue, 14 Aug 2007, Paul Hiemstra wrote:
>
>> Mike,
>>
>> I tried, and failed, to directly load the HDF5 files into R using rgdal.
>> The next thing I tried was to convert the .h5 file to a GTiff using
>> FWTools. This seemed to work, but when I tried to load the file into R
>> through rgdal I got the following error message:
>>
>> test = readGDAL("regenradar_hdf5/RAD_NL21_PCP_NA_200707200000.tif")
>>
>>> test = readGDAL("RAD_NL21_PCP_NA_200707200000.tif")
>> RAD_NL21_PCP_NA_200707200000.tif has GDAL driver GTiff
>> and has 256 rows and 256 columns
>> Closing GDAL dataset handle 0x0226a220...  destroyed ... done.
>> Error in `proj4string<-`(`*tmp*`, value = <S4 object of class "CRS">) :
>>        Geographical CRS given to non-conformant data
>
> Please state the gdalinfo of the input HDF5, and the output gTiff. 
> Your use of gdal_translate seems to be mangling the (IIRC) projected 
> coordinate reference system of the HDF5 to a geographical coordinate 
> reference system, with the result that the coordinate values are "out 
> of bounds". I think you need to show the full gdal_translate command, 
> and to look at the help page:
>
> http://www.gdal.org/gdal_translate.html
>
> and try out the -a_srs option. Maybe also look at the -sds option if 
> you are not sure that the subset is being chosen correctly.
>
> Once gdalinfo on the output gTiff shows a geographical coordinate 
> reference system, rgdal will work (unless this is near-polar and you 
> have a raster cell boundary > |90|, which does happen sometimes - then 
> you need to adjust the input data).
>
> Roger
>
>
>>> traceback()
>> 8: stop("Geographical CRS given to non-conformant data")
>> 7: `proj4string<-`(`*tmp*`, value = <S4 object of class "CRS">)
>> 6: SpatialGrid(grid, proj4string)
>> 5: initialize(value, ...)
>> 4: initialize(value, ...)
>> 3: new("SpatialGridDataFrame", SpatialGrid(grid, proj4string), data = 
>> data)
>> 2: SpatialGridDataFrame(grid = grid, data = data.frame(df), 
>> proj4string = CRS(p4s))
>> 1: readGDAL("RAD_NL21_PCP_NA_200707200000.tif")
>>> sessionInfo()
>> R version 2.5.1 (2007-06-27)
>> i386-pc-mingw32
>>
>> locale:
>> LC_COLLATE=Dutch_Netherlands.1252;LC_CTYPE=Dutch_Netherlands.1252;LC_MONETARY=Dutch_Netherlands.1252;LC_NUMERIC=C;LC_TIME=Dutch_Netherlands.1252 
>>
>>
>> attached base packages:
>> [1] "stats"     "graphics"  "grDevices" "utils"     "datasets"  
>> "methods"   "base"
>>
>> other attached packages:
>>   rgdal       sp
>> "0.5-14" "0.9-14"
>>
>> Do you have any idea what caused this error and how I can circumvent it?
>>
>> Many thanks in advance,
>>
>> Paul
>>
>> Michael Sumner schreef:
>>> Note that readGDAL can read the subdataset directly (escaping the 
>>> quotes
>>> appropriately):
>>>
>>> d <- 
>>> readGDAL("HDF5:\"RAD_NL21_PCP_NA_200707200000.h5\"://image1/image_data") 
>>>
>>>
>>> It also seems that your gdal_translate to TIFF output has the extension
>>> .img, but then you attempt to read from a tif.
>>>
>>> Just a thought.
>>>
>>> Cheers, Mike.
>>>
>>> ==============Original message text===============
>>> On Fri, 10 Aug 2007 19:09:00 +1000 Roger Bivand wrote:
>>>
>>> Paul,
>>>
>>> I have added a CC to the R-sig-geo list, since I myself have no 
>>> experiece
>>> of using this format in practice. If you are not a member, please 
>>> join at:
>>>
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>> so that you will see any replies.
>>>
>>> Did you try gdalinfo on the output file?
>>>
>>> The error message suggests that the output file has a geographical
>>> coordinate reference system, with coordinate values outside the 
>>> feasible
>>> range. From the HDF5 description, however, it ought to be projected,
>>> right? Do you need to make more use of the arguments taken by 
>>> gdalinfo to
>>> give the output file the correct projected CRS?
>>>
>>> Roger
>>>
>>> On Fri, 10 Aug 2007, Paul Hiemstra wrote:
>>>
>>>
>>>> Dear Roger,
>>>>
>>>> I tried the route through a GTiff before I sent you the e-mail but
>>>>
>>> somehow it
>>>
>>>> did not work. When I use gdalinfo on one of the .h5 files I get this:
>>>>
>>>> PS E:\LSO data\Regenbui 20-7\regenradar_rasters\regenradar_hdf5> 
>>>> gdalinfo
>>>> RAD_NL21_PCP_NA_200707200000.h5
>>>> Driver: HDF5/Hierarchical Data Format Release 5
>>>> Files: RAD_NL21_PCP_NA_200707200000.h5
>>>> Size is 512, 512
>>>> Coordinate System is `'
>>>> Metadata:
>>>>  map_projection:projection_indication=Y
>>>>  map_projection:projection_name=STEREOGRAPHIC
>>>>  map_projection:projection_proj4_params=+proj=stere +lat_0=90
>>>> +lon_0=0.0 +lat_ts=60.0 +a=6378.388 +b=6356.912 +x_0=0 +y_0=0
>>>> geographic: geo_number_rows=256
>>>> geographic: geo_number_columns=256
>>>> geographic: geo_pixel_size_x=2.500000
>>>> geographic: geo_pixel_size_y=-2.500000
>>>> geographic: geo_par_pixel=X,Y
>>>> geographic: geo_dim_pixel=KM,KM
>>>> geographic: geo_column_offset=0.000000
>>>> geographic: geo_row_offset=1490.906006
>>>> geographic: geo_pixel_def=LU
>>>> geographic: geo_product_corners=0.000000 49.769001 0.000000 55.296001
>>>> 9.743000 54.818001 8.337000 49.373001
>>>> calibration: calibration_flag=Y
>>>> calibration: calibration_formulas=GEO = 0.5 * PV + -31.5
>>>> calibration: calibration_missing_data=255
>>>> calibration: calibration_out_of_image=255
>>>> statistics: stat_min_value=-1.500000
>>>> statistics: stat_max_value=45.000000
>>>> image1: image_product_name=RAD_NL21_PCP_H0.8_NA
>>>> image1: image_geo_parameter=REFLECTIVITY_[DBZ]
>>>> image1: image_size=65536d
>>>> image1: image_bytes_per_pixel=1d
>>>> overview: product_group_name=RAD_NL21_PCP_NA
>>>> overview: products_missing=N/A
>>>> overview: hdftag_version_number=3.5
>>>> overview: number_image_groups=1
>>>> overview: number_satellite_groups=0d
>>>> overview: number_radar_groups=2d
>>>> overview: number_station_groups=0
>>>> overview: product_datetime_start=20-JUL-2007;00:00:11.000
>>>> overview: product_datetime_end=20-JUL-2007;00:00:11.000
>>>> overview: number_lightning_groups=0d
>>>> overview: number_classification_groups=0d
>>>> overview: number_grid_groups=0d
>>>> overview: number_point_groups=0d
>>>> overview: number_vector_groups=0d
>>>> radar1: radar_name=De_Bilt
>>>> radar1: radar_location=5.179000 52.103001
>>>> radar2: radar_name=Den_Helder
>>>> radar2: radar_location=4.790000 52.955002
>>>> Subdatasets:
>>>> SUBDATASET_0_NAME=HDF5:"RAD_NL21_PCP_NA_200707200000.h5"://image1/image_data 
>>>>
>>>> SUBDATASET_0_DESC=[256x256] //image1/image_data (8-bit unsigned 
>>>> character)
>>>> Corner Coordinates:
>>>> Upper Left  (    0.0,    0.0)
>>>> Lower Left  (    0.0,  512.0)
>>>> Upper Right (  512.0,    0.0)
>>>> Lower Right (  512.0,  512.0)
>>>> Center      (  256.0,  256.0)
>>>>
>>>> Then I use gdal_translate:
>>>> PS E:\LSO data\Regenbui 20-7\regenradar_rasters\regenradar_hdf5>
>>>> gdal_translate -of GTiff
>>>> HDF5:"RAD_NL21_PCP_NA_200707200000.h5"://image1/image_data
>>>> RAD_NL21_PCP_NA_200707200000.img
>>>>
>>>> Then I try to read the file using rgdal produces the following error:
>>>>
>>>>
>>>>>  test = readGDAL("regenradar_hdf5/RAD_NL21_PCP_NA_200707200000.tif")
>>>>>
>>>> regenradar_hdf5/RAD_NL21_PCP_NA_200707200000.tif has GDAL driver GTiff
>>>> and has 256 rows and 256 columns
>>>> Closing GDAL dataset handle 0x0130b898...  destroyed ... done.
>>>> Error in `proj4string<-`(`*tmp*`, value = <S4 object of class 
>>>> "CRS">) :
>>>>        Geographical CRS given to non-conformant data
>>>>
>>>> Do you have an idea how to solve this?
>>>>
>>>> kind regards,
>>>>
>>>> Paul
>>>>
>>>>
>>>> Roger Bivand schreef:
>>>>
>>>>>  Dear Paul,
>>>>>
>>>>>  There is information in the README.windows file in the package, this
>>>>>  should display it:
>>>>>
>>>>>  file.show(system.file("README.windows", package="rgdal"))
>>>>>
>>>>>  If you do not want to build against the FWTools binary, then just 
>>>>> install
>>>>>  FWTools, and use the gdal_translate command line tool to convert 
>>>>> your data
>>>>>  to a format that the standard rgdal windows binary can read, such as
>>>>>  gTiff. You'll need to play around a bit to find out what the data 
>>>>> are
>>>>>  called.
>>>>>
>>>>>  On Linux, this is easier, because you can build GDAL against HDF5 
>>>>> before
>>>>>  installing rgdal, and there it "just works".
>>>>>
>>>>>  Hope this helps,
>>>>>
>>>>>  Roger
>>>>>
>>>>>  On Thu, 9 Aug 2007, Paul Hiemstra wrote:
>>>>>
>>>>>
>>>>>>  Dear mr. Bivand
>>>>>>
>>>>>>  My name is Paul Hiemstra, a PhD student of Edzer. I am trying to 
>>>>>> read
>>>>>>  HDF5 files through rgdal. If I use GDALinfo() on one of the 
>>>>>> files it
>>>>>>  produces the following error:
>>>>>>
>>>>>>  Error in .local(.Object, ...) :
>>>>>>        GDAL Error 4: `RAD_NL21_PCP_NA_200707200000.h5' not 
>>>>>> recognised as
>>>>>>  a supported file format.
>>>>>>
>>>>>>  On the mailing list
>>>>>>  (http://finzi.psych.upenn.edu/R/Rhelp02a/archive/92270.html) you 
>>>>>> >> >  metioned using the dll files from FWTools to get support 
>>>>>> for HDF5 into
>>>>>>  rgdal. How can this be done?
>>>>>>
>>>>>>  I also tried the hdf5 package on CRAN, but that does not seem to 
>>>>>> work,
>>>>>>  returning an empty object.
>>>>>>
>>>>>>  many thanks,
>>>>>>
>>>>>>  Paul
>>>>>>
>>>>>>
>>>>>>
>>>>
>>>>
>>>
>>>
>>
>>
>>
>


-- 
Drs. Paul Hiemstra
Department of Physical Geography
Faculty of Geosciences
University of Utrecht
Heidelberglaan 2
P.O. Box 80.115
3508 TC Utrecht
Phone: 	+31302535773
Fax:	+31302531145
http://intamap.geo.uu.nl/~paul



From Roger.Bivand at nhh.no  Tue Aug 14 11:48:38 2007
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 14 Aug 2007 11:48:38 +0200 (CEST)
Subject: [R-sig-Geo] reading HDF5 files
In-Reply-To: <46C172FF.5040308@geo.uu.nl>
References: <200708110318.l7B3IbG2011584@corinna.its.utas.edu.au>
	<46C172FF.5040308@geo.uu.nl>
Message-ID: <Pine.LNX.4.64.0708141144170.32131@reclus.nhh.no>

On Tue, 14 Aug 2007, Paul Hiemstra wrote:

> Mike,
>
> This is the result of using gdalinfo (FWTools) on the .tif file,
>
> E:\LSO data\Regenbui 20-7\regenradar_rasters\regenradar_tif>gdalinfo
> RAD_NL21_PCP_NA_200707200000.tif
> Driver: GTiff/GeoTIFF
> Files: RAD_NL21_PCP_NA_200707200000.tif
>       RAD_NL21_PCP_NA_200707200000.aux
> Size is 256, 256
> Coordinate System is:
> GEOGCS["WGS 84",
>    DATUM["WGS_1984",
>        SPHEROID["WGS 84",6378137,298.2572235630016,
>            AUTHORITY["EPSG","7030"]],
>        AUTHORITY["EPSG","6326"]],
>    PRIMEM["Greenwich",0],
>    UNIT["degree",0.0174532925199433],
>    AUTHORITY["EPSG","4326"]]
> Metadata:
>  AREA_OR_POINT=Area
>  map_projection=projection_proj4_params=+proj=stere +lat_0=90
> +lon_0=0.0 +lat_ts=60.0 +a=6378.388 +b=6356.912 +x_0=0 +y_0=0
>  geographic=geo_product_corners=0.000000 49.769001 0.000000 55.296001
> 9.743000 54.818001 8.337000 49.373001
>  calibration=calibration_out_of_image=255
>  statistics=stat_max_value=45.000000
>  image1=image_bytes_per_pixel=1d
>  overview=number_vector_groups=0d
>  radar1=radar_location=5.179000 52.103001
>  radar2=radar_location=4.790000 52.955002
> Corner Coordinates:
> Upper Left  (    0.0,    0.0)
> Lower Left  (    0.0,  256.0)
> Upper Right (  256.0,    0.0)
> Lower Right (  256.0,  256.0)
> Center      (  128.0,  128.0)
> Band 1 Block=256x32 Type=Byte, ColorInterp=Gray
>  Metadata:
>    image_data=DISPLAY_ORIGIN=UL

The metadata records the correct srs, but the file has the wrong one - it 
is staring you in the face, isn't it?

Try adding

-a_srs "+proj=stere +lat_0=90 +lon_0=0.0 +lat_ts=60.0 +a=6378.388 +b=6356.912 +x_0=0 +y_0=0"

(all in one line, no line breaks) to the gdal_translate call (untried).

Roger


>
> cheers, Paul
>
> Michael Sumner schreef:
>> Note that readGDAL can read the subdataset directly (escaping the quotes
>> appropriately):
>>
>> d <- readGDAL("HDF5:\"RAD_NL21_PCP_NA_200707200000.h5\"://image1/image_data")
>>
>> It also seems that your gdal_translate to TIFF output has the extension
>> .img, but then you attempt to read from a tif.
>>
>> Just a thought.
>>
>> Cheers, Mike.
>>
>> ==============Original message text===============
>> On Fri, 10 Aug 2007 19:09:00 +1000 Roger Bivand wrote:
>>
>> Paul,
>>
>> I have added a CC to the R-sig-geo list, since I myself have no experiece
>> of using this format in practice. If you are not a member, please join at:
>>
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>> so that you will see any replies.
>>
>> Did you try gdalinfo on the output file?
>>
>> The error message suggests that the output file has a geographical
>> coordinate reference system, with coordinate values outside the feasible
>> range. From the HDF5 description, however, it ought to be projected,
>> right? Do you need to make more use of the arguments taken by gdalinfo to
>> give the output file the correct projected CRS?
>>
>> Roger
>>
>> On Fri, 10 Aug 2007, Paul Hiemstra wrote:
>>
>>
>>> Dear Roger,
>>>
>>> I tried the route through a GTiff before I sent you the e-mail but
>>>
>> somehow it
>>
>>> did not work. When I use gdalinfo on one of the .h5 files I get this:
>>>
>>> PS E:\LSO data\Regenbui 20-7\regenradar_rasters\regenradar_hdf5> gdalinfo
>>> RAD_NL21_PCP_NA_200707200000.h5
>>> Driver: HDF5/Hierarchical Data Format Release 5
>>> Files: RAD_NL21_PCP_NA_200707200000.h5
>>> Size is 512, 512
>>> Coordinate System is `'
>>> Metadata:
>>>  map_projection:projection_indication=Y
>>>  map_projection:projection_name=STEREOGRAPHIC
>>>  map_projection:projection_proj4_params=+proj=stere +lat_0=90
>>> +lon_0=0.0 +lat_ts=60.0 +a=6378.388 +b=6356.912 +x_0=0 +y_0=0
>>> geographic: geo_number_rows=256
>>> geographic: geo_number_columns=256
>>> geographic: geo_pixel_size_x=2.500000
>>> geographic: geo_pixel_size_y=-2.500000
>>> geographic: geo_par_pixel=X,Y
>>> geographic: geo_dim_pixel=KM,KM
>>> geographic: geo_column_offset=0.000000
>>> geographic: geo_row_offset=1490.906006
>>> geographic: geo_pixel_def=LU
>>> geographic: geo_product_corners=0.000000 49.769001 0.000000 55.296001
>>> 9.743000 54.818001 8.337000 49.373001
>>> calibration: calibration_flag=Y
>>> calibration: calibration_formulas=GEO = 0.5 * PV + -31.5
>>> calibration: calibration_missing_data=255
>>> calibration: calibration_out_of_image=255
>>> statistics: stat_min_value=-1.500000
>>> statistics: stat_max_value=45.000000
>>> image1: image_product_name=RAD_NL21_PCP_H0.8_NA
>>> image1: image_geo_parameter=REFLECTIVITY_[DBZ]
>>> image1: image_size=65536d
>>> image1: image_bytes_per_pixel=1d
>>> overview: product_group_name=RAD_NL21_PCP_NA
>>> overview: products_missing=N/A
>>> overview: hdftag_version_number=3.5
>>> overview: number_image_groups=1
>>> overview: number_satellite_groups=0d
>>> overview: number_radar_groups=2d
>>> overview: number_station_groups=0
>>> overview: product_datetime_start=20-JUL-2007;00:00:11.000
>>> overview: product_datetime_end=20-JUL-2007;00:00:11.000
>>> overview: number_lightning_groups=0d
>>> overview: number_classification_groups=0d
>>> overview: number_grid_groups=0d
>>> overview: number_point_groups=0d
>>> overview: number_vector_groups=0d
>>> radar1: radar_name=De_Bilt
>>> radar1: radar_location=5.179000 52.103001
>>> radar2: radar_name=Den_Helder
>>> radar2: radar_location=4.790000 52.955002
>>> Subdatasets:
>>> SUBDATASET_0_NAME=HDF5:"RAD_NL21_PCP_NA_200707200000.h5"://image1/image_data
>>> SUBDATASET_0_DESC=[256x256] //image1/image_data (8-bit unsigned character)
>>> Corner Coordinates:
>>> Upper Left  (    0.0,    0.0)
>>> Lower Left  (    0.0,  512.0)
>>> Upper Right (  512.0,    0.0)
>>> Lower Right (  512.0,  512.0)
>>> Center      (  256.0,  256.0)
>>>
>>> Then I use gdal_translate:
>>> PS E:\LSO data\Regenbui 20-7\regenradar_rasters\regenradar_hdf5>
>>> gdal_translate -of GTiff
>>> HDF5:"RAD_NL21_PCP_NA_200707200000.h5"://image1/image_data
>>> RAD_NL21_PCP_NA_200707200000.img
>>>
>>> Then I try to read the file using rgdal produces the following error:
>>>
>>>
>>>>  test = readGDAL("regenradar_hdf5/RAD_NL21_PCP_NA_200707200000.tif")
>>>>
>>> regenradar_hdf5/RAD_NL21_PCP_NA_200707200000.tif has GDAL driver GTiff
>>> and has 256 rows and 256 columns
>>> Closing GDAL dataset handle 0x0130b898...  destroyed ... done.
>>> Error in `proj4string<-`(`*tmp*`, value = <S4 object of class "CRS">) :
>>>        Geographical CRS given to non-conformant data
>>>
>>> Do you have an idea how to solve this?
>>>
>>> kind regards,
>>>
>>> Paul
>>>
>>>
>>> Roger Bivand schreef:
>>>
>>>>  Dear Paul,
>>>>
>>>>  There is information in the README.windows file in the package, this
>>>>  should display it:
>>>>
>>>>  file.show(system.file("README.windows", package="rgdal"))
>>>>
>>>>  If you do not want to build against the FWTools binary, then just install
>>>>  FWTools, and use the gdal_translate command line tool to convert your data
>>>>  to a format that the standard rgdal windows binary can read, such as
>>>>  gTiff. You'll need to play around a bit to find out what the data are
>>>>  called.
>>>>
>>>>  On Linux, this is easier, because you can build GDAL against HDF5 before
>>>>  installing rgdal, and there it "just works".
>>>>
>>>>  Hope this helps,
>>>>
>>>>  Roger
>>>>
>>>>  On Thu, 9 Aug 2007, Paul Hiemstra wrote:
>>>>
>>>>
>>>>>  Dear mr. Bivand
>>>>>
>>>>>  My name is Paul Hiemstra, a PhD student of Edzer. I am trying to read
>>>>>  HDF5 files through rgdal. If I use GDALinfo() on one of the files it
>>>>>  produces the following error:
>>>>>
>>>>>  Error in .local(.Object, ...) :
>>>>>        GDAL Error 4: `RAD_NL21_PCP_NA_200707200000.h5' not recognised as
>>>>>  a supported file format.
>>>>>
>>>>>  On the mailing list
>>>>>  (http://finzi.psych.upenn.edu/R/Rhelp02a/archive/92270.html) you >> >  metioned using the dll files from FWTools to get support for HDF5 into
>>>>>  rgdal. How can this be done?
>>>>>
>>>>>  I also tried the hdf5 package on CRAN, but that does not seem to work,
>>>>>  returning an empty object.
>>>>>
>>>>>  many thanks,
>>>>>
>>>>>  Paul
>>>>>
>>>>>
>>>>>
>>>
>>>
>>
>>
>
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From p.hiemstra at geo.uu.nl  Tue Aug 14 11:59:42 2007
From: p.hiemstra at geo.uu.nl (Paul Hiemstra)
Date: Tue, 14 Aug 2007 11:59:42 +0200
Subject: [R-sig-Geo] reading HDF5 files
In-Reply-To: <Pine.LNX.4.64.0708141144170.32131@reclus.nhh.no>
References: <200708110318.l7B3IbG2011584@corinna.its.utas.edu.au>
	<46C172FF.5040308@geo.uu.nl>
	<Pine.LNX.4.64.0708141144170.32131@reclus.nhh.no>
Message-ID: <46C17D0E.3060702@geo.uu.nl>

Dear Roger,

It works! The following command did the trick (adding -a_srs as you 
suggested):
E:\LSO data\Regenbui 
20-7\regenradar_rasters\regenradar_hdf5>gdal_translate -of GTiff -a_srs 
"+proj=stere +lat_0=90 +lon_0=0.0 +lat_ts=60.0 +a=6378.388 +b=6356.912 
+x_0=0 +y_0=0" 
HDF5:"RAD_NL21_PCP_NA_200707202345.h5"://image1/image_data 
RAD_NL21_PCP_NA_20070720234.tif

thanks very much for helping me out.

cheers,

Paul

Roger Bivand schreef:
> On Tue, 14 Aug 2007, Paul Hiemstra wrote:
>
>> Mike,
>>
>> This is the result of using gdalinfo (FWTools) on the .tif file,
>>
>> E:\LSO data\Regenbui 20-7\regenradar_rasters\regenradar_tif>gdalinfo
>> RAD_NL21_PCP_NA_200707200000.tif
>> Driver: GTiff/GeoTIFF
>> Files: RAD_NL21_PCP_NA_200707200000.tif
>>       RAD_NL21_PCP_NA_200707200000.aux
>> Size is 256, 256
>> Coordinate System is:
>> GEOGCS["WGS 84",
>>    DATUM["WGS_1984",
>>        SPHEROID["WGS 84",6378137,298.2572235630016,
>>            AUTHORITY["EPSG","7030"]],
>>        AUTHORITY["EPSG","6326"]],
>>    PRIMEM["Greenwich",0],
>>    UNIT["degree",0.0174532925199433],
>>    AUTHORITY["EPSG","4326"]]
>> Metadata:
>>  AREA_OR_POINT=Area
>>  map_projection=projection_proj4_params=+proj=stere +lat_0=90
>> +lon_0=0.0 +lat_ts=60.0 +a=6378.388 +b=6356.912 +x_0=0 +y_0=0
>>  geographic=geo_product_corners=0.000000 49.769001 0.000000 55.296001
>> 9.743000 54.818001 8.337000 49.373001
>>  calibration=calibration_out_of_image=255
>>  statistics=stat_max_value=45.000000
>>  image1=image_bytes_per_pixel=1d
>>  overview=number_vector_groups=0d
>>  radar1=radar_location=5.179000 52.103001
>>  radar2=radar_location=4.790000 52.955002
>> Corner Coordinates:
>> Upper Left  (    0.0,    0.0)
>> Lower Left  (    0.0,  256.0)
>> Upper Right (  256.0,    0.0)
>> Lower Right (  256.0,  256.0)
>> Center      (  128.0,  128.0)
>> Band 1 Block=256x32 Type=Byte, ColorInterp=Gray
>>  Metadata:
>>    image_data=DISPLAY_ORIGIN=UL
>
> The metadata records the correct srs, but the file has the wrong one - 
> it is staring you in the face, isn't it?
>
> Try adding
>
> -a_srs "+proj=stere +lat_0=90 +lon_0=0.0 +lat_ts=60.0 +a=6378.388 
> +b=6356.912 +x_0=0 +y_0=0"
>
> (all in one line, no line breaks) to the gdal_translate call (untried).
>
> Roger
>
>
>>
>> cheers, Paul
>>
>> Michael Sumner schreef:
>>> Note that readGDAL can read the subdataset directly (escaping the 
>>> quotes
>>> appropriately):
>>>
>>> d <- 
>>> readGDAL("HDF5:\"RAD_NL21_PCP_NA_200707200000.h5\"://image1/image_data") 
>>>
>>>
>>> It also seems that your gdal_translate to TIFF output has the extension
>>> .img, but then you attempt to read from a tif.
>>>
>>> Just a thought.
>>>
>>> Cheers, Mike.
>>>
>>> ==============Original message text===============
>>> On Fri, 10 Aug 2007 19:09:00 +1000 Roger Bivand wrote:
>>>
>>> Paul,
>>>
>>> I have added a CC to the R-sig-geo list, since I myself have no 
>>> experiece
>>> of using this format in practice. If you are not a member, please 
>>> join at:
>>>
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>> so that you will see any replies.
>>>
>>> Did you try gdalinfo on the output file?
>>>
>>> The error message suggests that the output file has a geographical
>>> coordinate reference system, with coordinate values outside the 
>>> feasible
>>> range. From the HDF5 description, however, it ought to be projected,
>>> right? Do you need to make more use of the arguments taken by 
>>> gdalinfo to
>>> give the output file the correct projected CRS?
>>>
>>> Roger
>>>
>>> On Fri, 10 Aug 2007, Paul Hiemstra wrote:
>>>
>>>
>>>> Dear Roger,
>>>>
>>>> I tried the route through a GTiff before I sent you the e-mail but
>>>>
>>> somehow it
>>>
>>>> did not work. When I use gdalinfo on one of the .h5 files I get this:
>>>>
>>>> PS E:\LSO data\Regenbui 20-7\regenradar_rasters\regenradar_hdf5> 
>>>> gdalinfo
>>>> RAD_NL21_PCP_NA_200707200000.h5
>>>> Driver: HDF5/Hierarchical Data Format Release 5
>>>> Files: RAD_NL21_PCP_NA_200707200000.h5
>>>> Size is 512, 512
>>>> Coordinate System is `'
>>>> Metadata:
>>>>  map_projection:projection_indication=Y
>>>>  map_projection:projection_name=STEREOGRAPHIC
>>>>  map_projection:projection_proj4_params=+proj=stere +lat_0=90
>>>> +lon_0=0.0 +lat_ts=60.0 +a=6378.388 +b=6356.912 +x_0=0 +y_0=0
>>>> geographic: geo_number_rows=256
>>>> geographic: geo_number_columns=256
>>>> geographic: geo_pixel_size_x=2.500000
>>>> geographic: geo_pixel_size_y=-2.500000
>>>> geographic: geo_par_pixel=X,Y
>>>> geographic: geo_dim_pixel=KM,KM
>>>> geographic: geo_column_offset=0.000000
>>>> geographic: geo_row_offset=1490.906006
>>>> geographic: geo_pixel_def=LU
>>>> geographic: geo_product_corners=0.000000 49.769001 0.000000 55.296001
>>>> 9.743000 54.818001 8.337000 49.373001
>>>> calibration: calibration_flag=Y
>>>> calibration: calibration_formulas=GEO = 0.5 * PV + -31.5
>>>> calibration: calibration_missing_data=255
>>>> calibration: calibration_out_of_image=255
>>>> statistics: stat_min_value=-1.500000
>>>> statistics: stat_max_value=45.000000
>>>> image1: image_product_name=RAD_NL21_PCP_H0.8_NA
>>>> image1: image_geo_parameter=REFLECTIVITY_[DBZ]
>>>> image1: image_size=65536d
>>>> image1: image_bytes_per_pixel=1d
>>>> overview: product_group_name=RAD_NL21_PCP_NA
>>>> overview: products_missing=N/A
>>>> overview: hdftag_version_number=3.5
>>>> overview: number_image_groups=1
>>>> overview: number_satellite_groups=0d
>>>> overview: number_radar_groups=2d
>>>> overview: number_station_groups=0
>>>> overview: product_datetime_start=20-JUL-2007;00:00:11.000
>>>> overview: product_datetime_end=20-JUL-2007;00:00:11.000
>>>> overview: number_lightning_groups=0d
>>>> overview: number_classification_groups=0d
>>>> overview: number_grid_groups=0d
>>>> overview: number_point_groups=0d
>>>> overview: number_vector_groups=0d
>>>> radar1: radar_name=De_Bilt
>>>> radar1: radar_location=5.179000 52.103001
>>>> radar2: radar_name=Den_Helder
>>>> radar2: radar_location=4.790000 52.955002
>>>> Subdatasets:
>>>> SUBDATASET_0_NAME=HDF5:"RAD_NL21_PCP_NA_200707200000.h5"://image1/image_data 
>>>>
>>>> SUBDATASET_0_DESC=[256x256] //image1/image_data (8-bit unsigned 
>>>> character)
>>>> Corner Coordinates:
>>>> Upper Left  (    0.0,    0.0)
>>>> Lower Left  (    0.0,  512.0)
>>>> Upper Right (  512.0,    0.0)
>>>> Lower Right (  512.0,  512.0)
>>>> Center      (  256.0,  256.0)
>>>>
>>>> Then I use gdal_translate:
>>>> PS E:\LSO data\Regenbui 20-7\regenradar_rasters\regenradar_hdf5>
>>>> gdal_translate -of GTiff
>>>> HDF5:"RAD_NL21_PCP_NA_200707200000.h5"://image1/image_data
>>>> RAD_NL21_PCP_NA_200707200000.img
>>>>
>>>> Then I try to read the file using rgdal produces the following error:
>>>>
>>>>
>>>>>  test = readGDAL("regenradar_hdf5/RAD_NL21_PCP_NA_200707200000.tif")
>>>>>
>>>> regenradar_hdf5/RAD_NL21_PCP_NA_200707200000.tif has GDAL driver GTiff
>>>> and has 256 rows and 256 columns
>>>> Closing GDAL dataset handle 0x0130b898...  destroyed ... done.
>>>> Error in `proj4string<-`(`*tmp*`, value = <S4 object of class 
>>>> "CRS">) :
>>>>        Geographical CRS given to non-conformant data
>>>>
>>>> Do you have an idea how to solve this?
>>>>
>>>> kind regards,
>>>>
>>>> Paul
>>>>
>>>>
>>>> Roger Bivand schreef:
>>>>
>>>>>  Dear Paul,
>>>>>
>>>>>  There is information in the README.windows file in the package, this
>>>>>  should display it:
>>>>>
>>>>>  file.show(system.file("README.windows", package="rgdal"))
>>>>>
>>>>>  If you do not want to build against the FWTools binary, then just 
>>>>> install
>>>>>  FWTools, and use the gdal_translate command line tool to convert 
>>>>> your data
>>>>>  to a format that the standard rgdal windows binary can read, such as
>>>>>  gTiff. You'll need to play around a bit to find out what the data 
>>>>> are
>>>>>  called.
>>>>>
>>>>>  On Linux, this is easier, because you can build GDAL against HDF5 
>>>>> before
>>>>>  installing rgdal, and there it "just works".
>>>>>
>>>>>  Hope this helps,
>>>>>
>>>>>  Roger
>>>>>
>>>>>  On Thu, 9 Aug 2007, Paul Hiemstra wrote:
>>>>>
>>>>>
>>>>>>  Dear mr. Bivand
>>>>>>
>>>>>>  My name is Paul Hiemstra, a PhD student of Edzer. I am trying to 
>>>>>> read
>>>>>>  HDF5 files through rgdal. If I use GDALinfo() on one of the 
>>>>>> files it
>>>>>>  produces the following error:
>>>>>>
>>>>>>  Error in .local(.Object, ...) :
>>>>>>        GDAL Error 4: `RAD_NL21_PCP_NA_200707200000.h5' not 
>>>>>> recognised as
>>>>>>  a supported file format.
>>>>>>
>>>>>>  On the mailing list
>>>>>>  (http://finzi.psych.upenn.edu/R/Rhelp02a/archive/92270.html) you 
>>>>>> >> >  metioned using the dll files from FWTools to get support 
>>>>>> for HDF5 into
>>>>>>  rgdal. How can this be done?
>>>>>>
>>>>>>  I also tried the hdf5 package on CRAN, but that does not seem to 
>>>>>> work,
>>>>>>  returning an empty object.
>>>>>>
>>>>>>  many thanks,
>>>>>>
>>>>>>  Paul
>>>>>>
>>>>>>
>>>>>>
>>>>
>>>>
>>>
>>>
>>
>>
>>
>


-- 
Drs. Paul Hiemstra
Department of Physical Geography
Faculty of Geosciences
University of Utrecht
Heidelberglaan 2
P.O. Box 80.115
3508 TC Utrecht
Phone: 	+31302535773
Fax:	+31302531145
http://intamap.geo.uu.nl/~paul



From tkeitt at gmail.com  Tue Aug 14 19:05:54 2007
From: tkeitt at gmail.com (Tim Keitt)
Date: Tue, 14 Aug 2007 12:05:54 -0500
Subject: [R-sig-Geo] reading HDF5 files
In-Reply-To: <46C170D9.3070703@geo.uu.nl>
References: <200708110318.l7B3IbG2011584@corinna.its.utas.edu.au>
	<46C170D9.3070703@geo.uu.nl>
Message-ID: <6262c54c0708141005x2f483be9r662250e15425bcc1@mail.gmail.com>

On 8/14/07, Paul Hiemstra <p.hiemstra at geo.uu.nl> wrote:
> Mike,
>
> I tried, and failed, to directly load the HDF5 files into R using rgdal.
> The next thing I tried was to convert the .h5 file to a GTiff using
> FWTools. This seemed to work, but when I tried to load the file into R
> through rgdal I got the following error message:
>
> test = readGDAL("regenradar_hdf5/RAD_NL21_PCP_NA_200707200000.tif")
>
> > test = readGDAL("RAD_NL21_PCP_NA_200707200000.tif")
> RAD_NL21_PCP_NA_200707200000.tif has GDAL driver GTiff
> and has 256 rows and 256 columns
> Closing GDAL dataset handle 0x0226a220...  destroyed ... done.
> Error in `proj4string<-`(`*tmp*`, value = <S4 object of class "CRS">) :
>         Geographical CRS given to non-conformant data
> > traceback()
> 8: stop("Geographical CRS given to non-conformant data")
> 7: `proj4string<-`(`*tmp*`, value = <S4 object of class "CRS">)
> 6: SpatialGrid(grid, proj4string)
> 5: initialize(value, ...)
> 4: initialize(value, ...)
> 3: new("SpatialGridDataFrame", SpatialGrid(grid, proj4string), data = data)
> 2: SpatialGridDataFrame(grid = grid, data = data.frame(df), proj4string = CRS(p4s))
> 1: readGDAL("RAD_NL21_PCP_NA_200707200000.tif")
> > sessionInfo()
> R version 2.5.1 (2007-06-27)
> i386-pc-mingw32

This seems a case where failing gracefully would save a lot of
trouble. Perhaps a warning and a NULL CRS? Then things can be patched
up in R. I am not a fan of the defensive programming style prevalent
in R. (Although I fully recognize that it is a matter of taste and
many people would disagree with me.)

THK


> locale:
> LC_COLLATE=Dutch_Netherlands.1252;LC_CTYPE=Dutch_Netherlands.1252;LC_MONETARY=Dutch_Netherlands.1252;LC_NUMERIC=C;LC_TIME=Dutch_Netherlands.1252
>
> attached base packages:
> [1] "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"   "base"
>
> other attached packages:
>    rgdal       sp
> "0.5-14" "0.9-14"
>
> Do you have any idea what caused this error and how I can circumvent it?
>
> Many thanks in advance,
>
> Paul
>
> Michael Sumner schreef:
> > Note that readGDAL can read the subdataset directly (escaping the quotes
> > appropriately):
> >
> > d <- readGDAL("HDF5:\"RAD_NL21_PCP_NA_200707200000.h5\"://image1/image_data")
> >
> > It also seems that your gdal_translate to TIFF output has the extension
> > .img, but then you attempt to read from a tif.
> >
> > Just a thought.
> >
> > Cheers, Mike.
> >
> > ==============Original message text===============
> > On Fri, 10 Aug 2007 19:09:00 +1000 Roger Bivand wrote:
> >
> > Paul,
> >
> > I have added a CC to the R-sig-geo list, since I myself have no experiece
> > of using this format in practice. If you are not a member, please join at:
> >
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
> > so that you will see any replies.
> >
> > Did you try gdalinfo on the output file?
> >
> > The error message suggests that the output file has a geographical
> > coordinate reference system, with coordinate values outside the feasible
> > range. From the HDF5 description, however, it ought to be projected,
> > right? Do you need to make more use of the arguments taken by gdalinfo to
> > give the output file the correct projected CRS?
> >
> > Roger
> >
> > On Fri, 10 Aug 2007, Paul Hiemstra wrote:
> >
> >
> >> Dear Roger,
> >>
> >> I tried the route through a GTiff before I sent you the e-mail but
> >>
> > somehow it
> >
> >> did not work. When I use gdalinfo on one of the .h5 files I get this:
> >>
> >> PS E:\LSO data\Regenbui 20-7\regenradar_rasters\regenradar_hdf5> gdalinfo
> >> RAD_NL21_PCP_NA_200707200000.h5
> >> Driver: HDF5/Hierarchical Data Format Release 5
> >> Files: RAD_NL21_PCP_NA_200707200000.h5
> >> Size is 512, 512
> >> Coordinate System is `'
> >> Metadata:
> >>  map_projection:projection_indication=Y
> >>  map_projection:projection_name=STEREOGRAPHIC
> >>  map_projection:projection_proj4_params=+proj=stere +lat_0=90
> >> +lon_0=0.0 +lat_ts=60.0 +a=6378.388 +b=6356.912 +x_0=0 +y_0=0
> >> geographic: geo_number_rows=256
> >> geographic: geo_number_columns=256
> >> geographic: geo_pixel_size_x=2.500000
> >> geographic: geo_pixel_size_y=-2.500000
> >> geographic: geo_par_pixel=X,Y
> >> geographic: geo_dim_pixel=KM,KM
> >> geographic: geo_column_offset=0.000000
> >> geographic: geo_row_offset=1490.906006
> >> geographic: geo_pixel_def=LU
> >> geographic: geo_product_corners=0.000000 49.769001 0.000000 55.296001
> >> 9.743000 54.818001 8.337000 49.373001
> >> calibration: calibration_flag=Y
> >> calibration: calibration_formulas=GEO = 0.5 * PV + -31.5
> >> calibration: calibration_missing_data=255
> >> calibration: calibration_out_of_image=255
> >> statistics: stat_min_value=-1.500000
> >> statistics: stat_max_value=45.000000
> >> image1: image_product_name=RAD_NL21_PCP_H0.8_NA
> >> image1: image_geo_parameter=REFLECTIVITY_[DBZ]
> >> image1: image_size=65536d
> >> image1: image_bytes_per_pixel=1d
> >> overview: product_group_name=RAD_NL21_PCP_NA
> >> overview: products_missing=N/A
> >> overview: hdftag_version_number=3.5
> >> overview: number_image_groups=1
> >> overview: number_satellite_groups=0d
> >> overview: number_radar_groups=2d
> >> overview: number_station_groups=0
> >> overview: product_datetime_start=20-JUL-2007;00:00:11.000
> >> overview: product_datetime_end=20-JUL-2007;00:00:11.000
> >> overview: number_lightning_groups=0d
> >> overview: number_classification_groups=0d
> >> overview: number_grid_groups=0d
> >> overview: number_point_groups=0d
> >> overview: number_vector_groups=0d
> >> radar1: radar_name=De_Bilt
> >> radar1: radar_location=5.179000 52.103001
> >> radar2: radar_name=Den_Helder
> >> radar2: radar_location=4.790000 52.955002
> >> Subdatasets:
> >> SUBDATASET_0_NAME=HDF5:"RAD_NL21_PCP_NA_200707200000.h5"://image1/image_data
> >> SUBDATASET_0_DESC=[256x256] //image1/image_data (8-bit unsigned character)
> >> Corner Coordinates:
> >> Upper Left  (    0.0,    0.0)
> >> Lower Left  (    0.0,  512.0)
> >> Upper Right (  512.0,    0.0)
> >> Lower Right (  512.0,  512.0)
> >> Center      (  256.0,  256.0)
> >>
> >> Then I use gdal_translate:
> >> PS E:\LSO data\Regenbui 20-7\regenradar_rasters\regenradar_hdf5>
> >> gdal_translate -of GTiff
> >> HDF5:"RAD_NL21_PCP_NA_200707200000.h5"://image1/image_data
> >> RAD_NL21_PCP_NA_200707200000.img
> >>
> >> Then I try to read the file using rgdal produces the following error:
> >>
> >>
> >>>  test = readGDAL("regenradar_hdf5/RAD_NL21_PCP_NA_200707200000.tif")
> >>>
> >> regenradar_hdf5/RAD_NL21_PCP_NA_200707200000.tif has GDAL driver GTiff
> >> and has 256 rows and 256 columns
> >> Closing GDAL dataset handle 0x0130b898...  destroyed ... done.
> >> Error in `proj4string<-`(`*tmp*`, value = <S4 object of class "CRS">) :
> >>        Geographical CRS given to non-conformant data
> >>
> >> Do you have an idea how to solve this?
> >>
> >> kind regards,
> >>
> >> Paul
> >>
> >>
> >> Roger Bivand schreef:
> >>
> >>>  Dear Paul,
> >>>
> >>>  There is information in the README.windows file in the package, this
> >>>  should display it:
> >>>
> >>>  file.show(system.file("README.windows", package="rgdal"))
> >>>
> >>>  If you do not want to build against the FWTools binary, then just install
> >>>  FWTools, and use the gdal_translate command line tool to convert your data
> >>>  to a format that the standard rgdal windows binary can read, such as
> >>>  gTiff. You'll need to play around a bit to find out what the data are
> >>>  called.
> >>>
> >>>  On Linux, this is easier, because you can build GDAL against HDF5 before
> >>>  installing rgdal, and there it "just works".
> >>>
> >>>  Hope this helps,
> >>>
> >>>  Roger
> >>>
> >>>  On Thu, 9 Aug 2007, Paul Hiemstra wrote:
> >>>
> >>>
> >>>>  Dear mr. Bivand
> >>>>
> >>>>  My name is Paul Hiemstra, a PhD student of Edzer. I am trying to read
> >>>>  HDF5 files through rgdal. If I use GDALinfo() on one of the files it
> >>>>  produces the following error:
> >>>>
> >>>>  Error in .local(.Object, ...) :
> >>>>        GDAL Error 4: `RAD_NL21_PCP_NA_200707200000.h5' not recognised as
> >>>>  a supported file format.
> >>>>
> >>>>  On the mailing list
> >>>>  (http://finzi.psych.upenn.edu/R/Rhelp02a/archive/92270.html) you >> >  metioned using the dll files from FWTools to get support for HDF5 into
> >>>>  rgdal. How can this be done?
> >>>>
> >>>>  I also tried the hdf5 package on CRAN, but that does not seem to work,
> >>>>  returning an empty object.
> >>>>
> >>>>  many thanks,
> >>>>
> >>>>  Paul
> >>>>
> >>>>
> >>>>
> >>
> >>
> >
> >
>
>
> --
> Drs. Paul Hiemstra
> Department of Physical Geography
> Faculty of Geosciences
> University of Utrecht
> Heidelberglaan 2
> P.O. Box 80.115
> 3508 TC Utrecht
> Phone:  +31302535773
> Fax:    +31302531145
> http://intamap.geo.uu.nl/~paul
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


-- 
Timothy H. Keitt, University of Texas at Austin
Contact info and schedule at http://www.keittlab.org/tkeitt/
Reprints at http://www.keittlab.org/tkeitt/papers/
ODF attachment? See http://www.openoffice.org/



From epistat at gmail.com  Wed Aug 15 08:51:59 2007
From: epistat at gmail.com (zhijie zhang)
Date: Wed, 15 Aug 2007 14:51:59 +0800
Subject: [R-sig-Geo] Can anybody tell me where i can find the theoretical
	explanations on density.ppp(spatstat)?
Message-ID: <2fc17e30708142351x8ad07b8nfb061843e0709173@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070815/8eda020a/attachment.pl>

From adrian at maths.uwa.edu.au  Wed Aug 15 09:10:22 2007
From: adrian at maths.uwa.edu.au (adrian at maths.uwa.edu.au)
Date: Wed, 15 Aug 2007 15:10:22 +0800 (WST)
Subject: [R-sig-Geo] Can anybody tell me where i can find the
 theoretical explanations on density.ppp(spatstat)?
In-Reply-To: <2fc17e30708142351x8ad07b8nfb061843e0709173@mail.gmail.com>
References: <2fc17e30708142351x8ad07b8nfb061843e0709173@mail.gmail.com>
Message-ID: <57515.130.95.98.17.1187161822.squirrel@130.95.98.17>


Zhijie Zhang writes:

> density.ppp(spatstat) computes a kernel smoothed intensity of point
> pattern,

> I'm new on it, can anybody tell me where i can find the theoretical
> explanations on the method of density.ppp(spatstat), or send me a paper on
> it?

---
See any textbook on spatial point pattern analysis,
or the following:


@article{digg85,
  author =	 {Diggle, P.J.},
  title =	 {A kernel method for smoothing point process data},
  journal =	 {Applied Statistics (Journal of the Royal Statistical
Society, series C},
  year =	 {1985},
  volume =	 {34},
  pages =	 {138--147}
}

@Book{digg03,
  author =	 {Diggle, P.J.},
  title =	 {Statistical Analysis of Spatial Point Patterns},
  publisher =	 {Arnold},
  year =	 2003,
  edition =	 {Second}
}

@Book{stoystoy95,
  author =	 {D. Stoyan and H. Stoyan},
  title =	 {Fractals, Random Shapes and Point Fields},
  publisher =	 wiley,
  address =	 {Chichester},
  year =	 1995
}



From epistat at gmail.com  Wed Aug 15 09:53:20 2007
From: epistat at gmail.com (zhijie zhang)
Date: Wed, 15 Aug 2007 15:53:20 +0800
Subject: [R-sig-Geo] Can anybody tell me where i can find the
	theoretical explanations on density.ppp(spatstat)?
In-Reply-To: <57515.130.95.98.17.1187161822.squirrel@130.95.98.17>
References: <2fc17e30708142351x8ad07b8nfb061843e0709173@mail.gmail.com>
	<57515.130.95.98.17.1187161822.squirrel@130.95.98.17>
Message-ID: <2fc17e30708150053h2cbea747m822f8e7997f86fc3@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070815/d3be827e/attachment.pl>

From Roger.Bivand at nhh.no  Thu Aug 16 09:19:21 2007
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 16 Aug 2007 09:19:21 +0200 (CEST)
Subject: [R-sig-Geo] reading HDF5 files
In-Reply-To: <6262c54c0708141005x2f483be9r662250e15425bcc1@mail.gmail.com>
References: <200708110318.l7B3IbG2011584@corinna.its.utas.edu.au>
	<46C170D9.3070703@geo.uu.nl>
	<6262c54c0708141005x2f483be9r662250e15425bcc1@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0708160906300.31775@reclus.nhh.no>

On Tue, 14 Aug 2007, Tim Keitt wrote:

> On 8/14/07, Paul Hiemstra <p.hiemstra at geo.uu.nl> wrote:
>> Mike,
>>
>> I tried, and failed, to directly load the HDF5 files into R using rgdal.
>> The next thing I tried was to convert the .h5 file to a GTiff using
>> FWTools. This seemed to work, but when I tried to load the file into R
>> through rgdal I got the following error message:
>>
>> test = readGDAL("regenradar_hdf5/RAD_NL21_PCP_NA_200707200000.tif")
>>
>>> test = readGDAL("RAD_NL21_PCP_NA_200707200000.tif")
>> RAD_NL21_PCP_NA_200707200000.tif has GDAL driver GTiff
>> and has 256 rows and 256 columns
>> Closing GDAL dataset handle 0x0226a220...  destroyed ... done.
>> Error in `proj4string<-`(`*tmp*`, value = <S4 object of class "CRS">) :
>>         Geographical CRS given to non-conformant data
>>> traceback()
>> 8: stop("Geographical CRS given to non-conformant data")
>> 7: `proj4string<-`(`*tmp*`, value = <S4 object of class "CRS">)
>> 6: SpatialGrid(grid, proj4string)
>> 5: initialize(value, ...)
>> 4: initialize(value, ...)
>> 3: new("SpatialGridDataFrame", SpatialGrid(grid, proj4string), data = data)
>> 2: SpatialGridDataFrame(grid = grid, data = data.frame(df), proj4string = CRS(p4s))
>> 1: readGDAL("RAD_NL21_PCP_NA_200707200000.tif")
>>> sessionInfo()
>> R version 2.5.1 (2007-06-27)
>> i386-pc-mingw32
>
> This seems a case where failing gracefully would save a lot of
> trouble.

I beg to disagree. The conversion from HDF5 to GTiff in gdal_transform (so 
outside R and rgdal) erroneously turned a NULL coordinate reference system 
in the HDF5 file to a WGS84 longlat. Setting the correct coordinate 
reference system using -a_srs to the one cited in the HDF5 *metadata* by 
hand corrected the problem, so that the dataset is now known as 
Stereographic, as it should be. The only check that failed was that data 
specifically declared as being in geographical coordinates had coordinate 
values outside the feasible range.

Why the HDF5 file used the metadata rather than the coordinate reference 
system to store the CRS is beyond me, as is the behaviour of 
gdal_translate in erroneously imputing geographical coordinates, but the 
work-around does work.

> Perhaps a warning and a NULL CRS? Then things can be patched
> up in R. I am not a fan of the defensive programming style prevalent
> in R. (Although I fully recognize that it is a matter of taste and
> many people would disagree with me.)

There are ways round here too - open as a GDALDataset, and build the grid 
description and coordinate reference system string by hand, which would be 
equivalent to using gdal_translate to do it. I don't think R is very 
defensive as such, but just a warning in this case would be unhelpful for 
the user.

Roger

>
> THK
>
>
>> locale:
>> LC_COLLATE=Dutch_Netherlands.1252;LC_CTYPE=Dutch_Netherlands.1252;LC_MONETARY=Dutch_Netherlands.1252;LC_NUMERIC=C;LC_TIME=Dutch_Netherlands.1252
>>
>> attached base packages:
>> [1] "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"   "base"
>>
>> other attached packages:
>>    rgdal       sp
>> "0.5-14" "0.9-14"
>>
>> Do you have any idea what caused this error and how I can circumvent it?
>>
>> Many thanks in advance,
>>
>> Paul
>>
>> Michael Sumner schreef:
>>> Note that readGDAL can read the subdataset directly (escaping the quotes
>>> appropriately):
>>>
>>> d <- readGDAL("HDF5:\"RAD_NL21_PCP_NA_200707200000.h5\"://image1/image_data")
>>>
>>> It also seems that your gdal_translate to TIFF output has the extension
>>> .img, but then you attempt to read from a tif.
>>>
>>> Just a thought.
>>>
>>> Cheers, Mike.
>>>
>>> ==============Original message text===============
>>> On Fri, 10 Aug 2007 19:09:00 +1000 Roger Bivand wrote:
>>>
>>> Paul,
>>>
>>> I have added a CC to the R-sig-geo list, since I myself have no experiece
>>> of using this format in practice. If you are not a member, please join at:
>>>
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>> so that you will see any replies.
>>>
>>> Did you try gdalinfo on the output file?
>>>
>>> The error message suggests that the output file has a geographical
>>> coordinate reference system, with coordinate values outside the feasible
>>> range. From the HDF5 description, however, it ought to be projected,
>>> right? Do you need to make more use of the arguments taken by gdalinfo to
>>> give the output file the correct projected CRS?
>>>
>>> Roger
>>>
>>> On Fri, 10 Aug 2007, Paul Hiemstra wrote:
>>>
>>>
>>>> Dear Roger,
>>>>
>>>> I tried the route through a GTiff before I sent you the e-mail but
>>>>
>>> somehow it
>>>
>>>> did not work. When I use gdalinfo on one of the .h5 files I get this:
>>>>
>>>> PS E:\LSO data\Regenbui 20-7\regenradar_rasters\regenradar_hdf5> gdalinfo
>>>> RAD_NL21_PCP_NA_200707200000.h5
>>>> Driver: HDF5/Hierarchical Data Format Release 5
>>>> Files: RAD_NL21_PCP_NA_200707200000.h5
>>>> Size is 512, 512
>>>> Coordinate System is `'
>>>> Metadata:
>>>>  map_projection:projection_indication=Y
>>>>  map_projection:projection_name=STEREOGRAPHIC
>>>>  map_projection:projection_proj4_params=+proj=stere +lat_0=90
>>>> +lon_0=0.0 +lat_ts=60.0 +a=6378.388 +b=6356.912 +x_0=0 +y_0=0
>>>> geographic: geo_number_rows=256
>>>> geographic: geo_number_columns=256
>>>> geographic: geo_pixel_size_x=2.500000
>>>> geographic: geo_pixel_size_y=-2.500000
>>>> geographic: geo_par_pixel=X,Y
>>>> geographic: geo_dim_pixel=KM,KM
>>>> geographic: geo_column_offset=0.000000
>>>> geographic: geo_row_offset=1490.906006
>>>> geographic: geo_pixel_def=LU
>>>> geographic: geo_product_corners=0.000000 49.769001 0.000000 55.296001
>>>> 9.743000 54.818001 8.337000 49.373001
>>>> calibration: calibration_flag=Y
>>>> calibration: calibration_formulas=GEO = 0.5 * PV + -31.5
>>>> calibration: calibration_missing_data=255
>>>> calibration: calibration_out_of_image=255
>>>> statistics: stat_min_value=-1.500000
>>>> statistics: stat_max_value=45.000000
>>>> image1: image_product_name=RAD_NL21_PCP_H0.8_NA
>>>> image1: image_geo_parameter=REFLECTIVITY_[DBZ]
>>>> image1: image_size=65536d
>>>> image1: image_bytes_per_pixel=1d
>>>> overview: product_group_name=RAD_NL21_PCP_NA
>>>> overview: products_missing=N/A
>>>> overview: hdftag_version_number=3.5
>>>> overview: number_image_groups=1
>>>> overview: number_satellite_groups=0d
>>>> overview: number_radar_groups=2d
>>>> overview: number_station_groups=0
>>>> overview: product_datetime_start=20-JUL-2007;00:00:11.000
>>>> overview: product_datetime_end=20-JUL-2007;00:00:11.000
>>>> overview: number_lightning_groups=0d
>>>> overview: number_classification_groups=0d
>>>> overview: number_grid_groups=0d
>>>> overview: number_point_groups=0d
>>>> overview: number_vector_groups=0d
>>>> radar1: radar_name=De_Bilt
>>>> radar1: radar_location=5.179000 52.103001
>>>> radar2: radar_name=Den_Helder
>>>> radar2: radar_location=4.790000 52.955002
>>>> Subdatasets:
>>>> SUBDATASET_0_NAME=HDF5:"RAD_NL21_PCP_NA_200707200000.h5"://image1/image_data
>>>> SUBDATASET_0_DESC=[256x256] //image1/image_data (8-bit unsigned character)
>>>> Corner Coordinates:
>>>> Upper Left  (    0.0,    0.0)
>>>> Lower Left  (    0.0,  512.0)
>>>> Upper Right (  512.0,    0.0)
>>>> Lower Right (  512.0,  512.0)
>>>> Center      (  256.0,  256.0)
>>>>
>>>> Then I use gdal_translate:
>>>> PS E:\LSO data\Regenbui 20-7\regenradar_rasters\regenradar_hdf5>
>>>> gdal_translate -of GTiff
>>>> HDF5:"RAD_NL21_PCP_NA_200707200000.h5"://image1/image_data
>>>> RAD_NL21_PCP_NA_200707200000.img
>>>>
>>>> Then I try to read the file using rgdal produces the following error:
>>>>
>>>>
>>>>>  test = readGDAL("regenradar_hdf5/RAD_NL21_PCP_NA_200707200000.tif")
>>>>>
>>>> regenradar_hdf5/RAD_NL21_PCP_NA_200707200000.tif has GDAL driver GTiff
>>>> and has 256 rows and 256 columns
>>>> Closing GDAL dataset handle 0x0130b898...  destroyed ... done.
>>>> Error in `proj4string<-`(`*tmp*`, value = <S4 object of class "CRS">) :
>>>>        Geographical CRS given to non-conformant data
>>>>
>>>> Do you have an idea how to solve this?
>>>>
>>>> kind regards,
>>>>
>>>> Paul
>>>>
>>>>
>>>> Roger Bivand schreef:
>>>>
>>>>>  Dear Paul,
>>>>>
>>>>>  There is information in the README.windows file in the package, this
>>>>>  should display it:
>>>>>
>>>>>  file.show(system.file("README.windows", package="rgdal"))
>>>>>
>>>>>  If you do not want to build against the FWTools binary, then just install
>>>>>  FWTools, and use the gdal_translate command line tool to convert your data
>>>>>  to a format that the standard rgdal windows binary can read, such as
>>>>>  gTiff. You'll need to play around a bit to find out what the data are
>>>>>  called.
>>>>>
>>>>>  On Linux, this is easier, because you can build GDAL against HDF5 before
>>>>>  installing rgdal, and there it "just works".
>>>>>
>>>>>  Hope this helps,
>>>>>
>>>>>  Roger
>>>>>
>>>>>  On Thu, 9 Aug 2007, Paul Hiemstra wrote:
>>>>>
>>>>>
>>>>>>  Dear mr. Bivand
>>>>>>
>>>>>>  My name is Paul Hiemstra, a PhD student of Edzer. I am trying to read
>>>>>>  HDF5 files through rgdal. If I use GDALinfo() on one of the files it
>>>>>>  produces the following error:
>>>>>>
>>>>>>  Error in .local(.Object, ...) :
>>>>>>        GDAL Error 4: `RAD_NL21_PCP_NA_200707200000.h5' not recognised as
>>>>>>  a supported file format.
>>>>>>
>>>>>>  On the mailing list
>>>>>>  (http://finzi.psych.upenn.edu/R/Rhelp02a/archive/92270.html) you >> >  metioned using the dll files from FWTools to get support for HDF5 into
>>>>>>  rgdal. How can this be done?
>>>>>>
>>>>>>  I also tried the hdf5 package on CRAN, but that does not seem to work,
>>>>>>  returning an empty object.
>>>>>>
>>>>>>  many thanks,
>>>>>>
>>>>>>  Paul
>>>>>>
>>>>>>
>>>>>>
>>>>
>>>>
>>>
>>>
>>
>>
>> --
>> Drs. Paul Hiemstra
>> Department of Physical Geography
>> Faculty of Geosciences
>> University of Utrecht
>> Heidelberglaan 2
>> P.O. Box 80.115
>> 3508 TC Utrecht
>> Phone:  +31302535773
>> Fax:    +31302531145
>> http://intamap.geo.uu.nl/~paul
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From Scott.Waichler at pnl.gov  Fri Aug 17 00:01:22 2007
From: Scott.Waichler at pnl.gov (Waichler, Scott R)
Date: Thu, 16 Aug 2007 15:01:22 -0700
Subject: [R-sig-Geo] Need fast method to find indices of cells in a 3-D grid
	that contain (x, y, z) coordinates
Message-ID: <F807B6FD7E7BE144A22B8A449CDAD93401221017@EMAIL02.pnl.gov>

I am looking for a fast method that will find the indices of cells of a
3-D grid that contain a set of (x,y,z) coordinates.  The grid has I,J,K
number of cells in the x-, y-, and z- directions, respectively.  The
cells are numbered with integers 1:(I*J*K).  I have multiple sets of
coordinates (points in 3-D space) for which I want to rapidly look up
the numbers of the cells that contain them.  Here is an example of what
I am trying to do, with an explicit loop that evaluates each point
separately.  Is there a faster way that can do the whole set of points
at once?

# Define a 10x10x5 3-D grid in terms of lower and upper bounds of cells
I <- 10  # number of cells in x-direction
J <- 10  # number of cells in y-direction
K <- 5   # number of cells in z-direction
x.lower.bounds <- 0:(I-1)
x.upper.bounds <- 1:I
y.lower.bounds <- 0:(J-1)
y.upper.bounds <- 1:J
z.lower.bounds <- 0:(K-1)
z.upper.bounds <- 1:K
num.grid.cells <- I*J*K

# Now repeat the above vectors to create new vectors for all cells in
the 3-D grid.
# I know this could be faster with vectorization, but I don't need speed
here :).
x.lb <- x.ub <- y.lb <- y.ub <- z.lb <- z.ub <- numeric(num.grid.cells)
n <- 0
for(k in 1:K) {
  for(j in 1:J) {
    for(i in 1:I) {
      n <- n + 1
      x.lb[n] <- x.lower.bounds[i]
      x.ub[n] <- x.upper.bounds[i]
      y.lb[n] <- y.lower.bounds[j]
      y.ub[n] <- y.upper.bounds[j]
      z.lb[n] <- z.lower.bounds[k]
      z.ub[n] <- z.upper.bounds[k]
    }
  }
}
  
# Define some points for which I want to look up the grid cell numbers:
num.points <- 3
x <- runif(num.points, 0, I)
y <- runif(num.points, 0, J)
z <- runif(num.points, 0, K)

# Loop thru the points and find the grid cell number of each.  Is there
a 
# way to vectorize this and do all points at once, either explicitly
with base 
# R or in some other way with the help of a package?
for(n in 1:num.points) {
 grid.cell.number <- which(x.lb <= x[n] & x.ub >= x[n] &
                           y.lb <= y[n] & y.ub >= y[n] &
                           z.lb <= z[n] & z.ub >= z[n])
 cat("The grid cell number for point", x[n], y[n], z[n], "is",
grid.cell.number, "\n")
}

Regards,
Scott Waichler
Pacific Northwest National Laboratory
Richland, Washington, USA
scott.waichler _at_ pnl.gov



From mdsumner at utas.edu.au  Fri Aug 17 01:32:16 2007
From: mdsumner at utas.edu.au (Michael Sumner)
Date: Fri, 17 Aug 2007 09:32:16 +1000
Subject: [R-sig-Geo] Need fast method to find indices of cells in a 3-D
	gridthat contain (x, y, z) coordinates
In-Reply-To: <F807B6FD7E7BE144A22B8A449CDAD93401221017@EMAIL02.pnl.gov>
References: <F807B6FD7E7BE144A22B8A449CDAD93401221017@EMAIL02.pnl.gov>
Message-ID: <001501c7e05d$af155660$4627d983@gom>

We do a similar thing in 2D using tabulate. It assumes that the coordinates
are known not to fall outside the grid:

## xx are the x-coordinates, similarly yy
## orig is the x/y offset of the grid
## scal is the x/y width and height of grid cells
## x/ydim is the dimensions of the grid

cps <- ceiling(cbind((xx - orig[1])/scl[1], (yy - orig[2])/scl[2]))
tps <- tabulate((cps[, 1] - 1) * ydim + cps[, 2], xdim * ydim) 

## then shape the counts as a matrix, appropriately aligned:
mps <- matrix(tps, ydim, xdim)
z <- t(mps)

I'm sure you could adapt this to the 3D case. That fragment comes from the
function countPoints (called by tripGrid) from the package "trip". 

HTH
Mike

-----Original Message-----
From: r-sig-geo-bounces at stat.math.ethz.ch
[mailto:r-sig-geo-bounces at stat.math.ethz.ch] On Behalf Of Waichler, Scott R
Sent: Friday, 17 August 2007 8:01 AM
To: R-sig-geo at stat.math.ethz.ch
Subject: [R-sig-Geo] Need fast method to find indices of cells in a 3-D
gridthat contain (x, y, z) coordinates

I am looking for a fast method that will find the indices of cells of a 3-D
grid that contain a set of (x,y,z) coordinates.  The grid has I,J,K number
of cells in the x-, y-, and z- directions, respectively.  The cells are
numbered with integers 1:(I*J*K).  I have multiple sets of coordinates
(points in 3-D space) for which I want to rapidly look up the numbers of the
cells that contain them.  Here is an example of what I am trying to do, with
an explicit loop that evaluates each point separately.  Is there a faster
way that can do the whole set of points at once?

# Define a 10x10x5 3-D grid in terms of lower and upper bounds of cells I <-
10  # number of cells in x-direction J <- 10  # number of cells in
y-direction
K <- 5   # number of cells in z-direction
x.lower.bounds <- 0:(I-1)
x.upper.bounds <- 1:I
y.lower.bounds <- 0:(J-1)
y.upper.bounds <- 1:J
z.lower.bounds <- 0:(K-1)
z.upper.bounds <- 1:K
num.grid.cells <- I*J*K

# Now repeat the above vectors to create new vectors for all cells in the
3-D grid.
# I know this could be faster with vectorization, but I don't need speed
here :).
x.lb <- x.ub <- y.lb <- y.ub <- z.lb <- z.ub <- numeric(num.grid.cells) n <-
0 for(k in 1:K) {
  for(j in 1:J) {
    for(i in 1:I) {
      n <- n + 1
      x.lb[n] <- x.lower.bounds[i]
      x.ub[n] <- x.upper.bounds[i]
      y.lb[n] <- y.lower.bounds[j]
      y.ub[n] <- y.upper.bounds[j]
      z.lb[n] <- z.lower.bounds[k]
      z.ub[n] <- z.upper.bounds[k]
    }
  }
}
  
# Define some points for which I want to look up the grid cell numbers:
num.points <- 3
x <- runif(num.points, 0, I)
y <- runif(num.points, 0, J)
z <- runif(num.points, 0, K)

# Loop thru the points and find the grid cell number of each.  Is there a #
way to vectorize this and do all points at once, either explicitly with base
# R or in some other way with the help of a package?
for(n in 1:num.points) {
 grid.cell.number <- which(x.lb <= x[n] & x.ub >= x[n] &
                           y.lb <= y[n] & y.ub >= y[n] &
                           z.lb <= z[n] & z.ub >= z[n])  cat("The grid cell
number for point", x[n], y[n], z[n], "is", grid.cell.number, "\n") }

Regards,
Scott Waichler
Pacific Northwest National Laboratory
Richland, Washington, USA
scott.waichler _at_ pnl.gov

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at stat.math.ethz.ch
https://stat.ethz.ch/mailman/listinfo/r-sig-geo



From hi_ono2001 at ybb.ne.jp  Fri Aug 17 05:48:48 2007
From: hi_ono2001 at ybb.ne.jp (Hisaji ONO)
Date: Fri, 17 Aug 2007 12:48:48 +0900 (JST)
Subject: [R-sig-Geo] R-sig-Geo Digest, Vol 48, Issue 3
In-Reply-To: <Pine.LNX.4.64.0708091149310.27732@reclus.nhh.no>
Message-ID: <20070817034848.78417.qmail@web10704.mail.bbt.yahoo.co.jp>

Thank your for your commnet, Professor  Bivand.


 Recently I've been developing Geospatial mining tool
based on OpenJUMP(see Japnized
OpenJUMP(http://translate.google.com/translate?u=http%3A%2F%2Fgiswin.geo.tsukuba.ac.jp%2Fteacher%2Fmurayama%2Ffieldgis_station%2Findex.html&langpair=ja%7Cen&hl=ja&ie=UTF8)),
which can build topology from linestring and polygon,
connecting R via Rserve or JGR, and will use Repast for
agent based modelling.


 Regards. 

<Roger.Bivand at nhh.no> wrote:

> On Fri, 3 Aug 2007, Hisaji ONO wrote:
> 
> > Dear Marco
> >
> > Thank you very much for your info.
> 
> Dear Hisaji,
> 
> Would Mondrian http://rosuda.org/Mondrian/ be of any
> use? The maptools 
> package contains a function for exporting
> SpatialPolygonsDataFrame objects 
> for (older) Mondrian, and will support the recent
> releases soon?
> 
> There is limited support for ESDA in the iplots
> package, if ESDA is taken 
> as dynamic linked graphics including a map view.
> Neither Mondrian nor 
> iplots permit linked Moran plots unless the
> spatially lagged variables 
> have been constructed first.
> 
> Best wishes,
> 
> Roger
> 
> >
> >
> > --- Marco Helbich <marco.helbich at gmx.at> wrote:
> >
> >> Dear Hisaji,
> >>
> >> I know the following possibilities:
> >>
> >> GGOBI:
> >> http://www.ggobi.org/publications/2001-dsc.pdf
> >> http://www.ggobi.org/publications/2003-dsc.pdf
> >>
> >> GEOXP:
> >>
> >
>
http://w3.univ-tlse1.fr/GREMAQ/Statistique/geoxppageR.htm
> >>
> >> Best regards,
> >> Marco Helbich
> >>
> >>
> >> ----- Original Message -----
> >> From: <r-sig-geo-request at stat.math.ethz.ch>
> >> To: <r-sig-geo at stat.math.ethz.ch>
> >> Sent: Friday, August 03, 2007 12:00 PM
> >> Subject: R-sig-Geo Digest, Vol 48, Issue 3
> >>
> >>
> >>> Send R-sig-Geo mailing list submissions to
> >>> r-sig-geo at stat.math.ethz.ch
> >>>
> >>> To subscribe or unsubscribe via the World Wide
> >> Web, visit
> >>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >>> or, via email, send a message with subject or
> body
> >> 'help' to
> >>> r-sig-geo-request at stat.math.ethz.ch
> >>>
> >>> You can reach the person managing the list at
> >>> r-sig-geo-owner at stat.math.ethz.ch
> >>>
> >>> When replying, please edit your Subject line so
> it
> >> is more specific
> >>> than "Re: Contents of R-sig-Geo digest..."
> >>>
> >>>
> >>> Today's Topics:
> >>>
> >>>   1. Availability of ESDA for R (Hisaji ONO)
> >>>
> >>>
> >>>
> >>
> >
>
----------------------------------------------------------------------
> >>>
> >>> Message: 1
> >>> Date: Fri, 3 Aug 2007 06:27:15 +0900 (JST)
> >>> From: Hisaji ONO <hi_ono2001 at yahoo.co.jp>
> >>> Subject: [R-sig-Geo] Availability of ESDA for R
> >>> To: r-sig-geo at stat.math.ethz.ch
> >>> Message-ID:
> >>
> >
>
<20070802212715.84027.qmail at web10713.mail.bbt.yahoo.co.jp>
> >>> Content-Type: text/plain; charset=iso-2022-jp
> >>>
> >>> Hello.
> >>>
> >>> Does anyone know whether ESDA like GeoDa is
> >> available for
> >>> R or not?
> >>>
> >>>
> >>> Regards.
> >>>
> >>>
> >>>
> >>> ------------------------------
> >>>
> >>> _______________________________________________
> >>> R-sig-Geo mailing list
> >>> R-sig-Geo at stat.math.ethz.ch
> >>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >>>
> >>>
> >>> End of R-sig-Geo Digest, Vol 48, Issue 3
> >>> ****************************************
> >>>
> >>
> >> _______________________________________________
> >> R-sig-Geo mailing list
> >> R-sig-Geo at stat.math.ethz.ch
> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >>
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at stat.math.ethz.ch
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
> 
> -- 
> Roger Bivand
> Economic Geography Section, Department of Economics,
> Norwegian School of
> Economics and Business Administration, Helleveien
> 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>



From loecher at eden.rutgers.edu  Fri Aug 17 14:37:52 2007
From: loecher at eden.rutgers.edu (Markus Loecher)
Date: Fri, 17 Aug 2007 08:37:52 -0400 (EDT)
Subject: [R-sig-Geo] Need fast method to find indices of cells in a
 3-D	gridthat contain (x, y, z) coor
Message-ID: <17414027.99221187354271876.JavaMail.tomcat@terraza>

Thank you for this elegant method of assigning counts to cell points.

If I am not mistaken, the spatial database community uses R-trees for efficient/rapid lookup. Does anyone know of an R package which implements R-trees ?

Also, any chance the package trip might be available for Linux or the MAC in the future ?

Thanks!

Markus
------------------------------

Message: 2
Date: Fri, 17 Aug 2007 09:32:16 +1000
From: "Michael Sumner" <mdsumner at utas.edu.au>
Subject: Re: [R-sig-Geo] Need fast method to find indices of cells in
	a 3-D	gridthat contain (x, y, z) coordinates
To: "'Waichler, Scott R'" <Scott.Waichler at pnl.gov>,
	<R-sig-geo at stat.math.ethz.ch>
Message-ID: <001501c7e05d$af155660$4627d983 at gom>
Content-Type: text/plain;	charset="us-ascii"

We do a similar thing in 2D using tabulate. It assumes that the coordinates
are known not to fall outside the grid:

## xx are the x-coordinates, similarly yy
## orig is the x/y offset of the grid
## scal is the x/y width and height of grid cells
## x/ydim is the dimensions of the grid

cps <- ceiling(cbind((xx - orig[1])/scl[1], (yy - orig[2])/scl[2]))
tps <- tabulate((cps[, 1] - 1) * ydim + cps[, 2], xdim * ydim) 

## then shape the counts as a matrix, appropriately aligned:
mps <- matrix(tps, ydim, xdim)
z <- t(mps)

I'm sure you could adapt this to the 3D case. That fragment comes from the
function countPoints (called by tripGrid) from the package "trip". 

HTH
Mike



From Scott.Waichler at pnl.gov  Fri Aug 17 20:07:15 2007
From: Scott.Waichler at pnl.gov (Waichler, Scott R)
Date: Fri, 17 Aug 2007 11:07:15 -0700
Subject: [R-sig-Geo] Need fast method to find indices of cells in a 3-D
	grid that contain (x, y, z) coordinates
In-Reply-To: <F807B6FD7E7BE144A22B8A449CDAD93401221017@EMAIL02.pnl.gov>
References: <F807B6FD7E7BE144A22B8A449CDAD93401221017@EMAIL02.pnl.gov>
Message-ID: <F807B6FD7E7BE144A22B8A449CDAD93401221019@EMAIL02.pnl.gov>

Thanks to Michael Sumner and Brian Gregor for suggesting solutions.  I
ended up using findInterval() as suggested by Brian and an index array
to get what I need.  I couldn't figure out how to use apply() with my
grid having irregular cell sizes.  Here is my code now, which runs much
faster than the previous code, which had multiple-component which()
calls and an explicit loop.

# Number the cells in the 3-D array.
cell.id <- array(1:num.nodes, dim = c(num.x,num.y,num.z))

# Get the numbers of the grid cells containing the coordinates x, y, z.
# x, y, z are the coordinates I want to look up.  
# xnb, ynb, and znb are the boundaries of the cells in the x, y, and z 
# directions, respectively.  
i.ind <- findInterval(x, xnb, all.inside = T)
j.ind <- findInterval(y, ynb, all.inside = T)
k.ind <- findInterval(z, znb, all.inside = T)
index.array <- array(c(i.ind, j.ind, k.ind), dim=c(length(x), 3))
ind.nb <- cell.id[index.array]  # the numbers of the cells I want

Regards,
Scott Waichler
Pacific Northwest National Laboratory
Richland, Washington, USA


> -----Original Message-----
> From: Waichler, Scott R 
> Sent: Thursday, August 16, 2007 3:01 PM
> To: 'R-sig-geo at stat.math.ethz.ch'
> Subject: Need fast method to find indices of cells in a 3-D 
> grid that contain (x,y,z) coordinates
> 
> I am looking for a fast method that will find the indices of 
> cells of a 3-D grid that contain a set of (x,y,z) 
> coordinates.  The grid has I,J,K number of cells in the x-, 
> y-, and z- directions, respectively.  The cells are numbered 
> with integers 1:(I*J*K).  I have multiple sets of coordinates 
> (points in 3-D space) for which I want to rapidly look up the 
> numbers of the cells that contain them.  Here is an example 
> of what I am trying to do, with an explicit loop that 
> evaluates each point separately.  Is there a faster way that 
> can do the whole set of points at once?



From rroa at udec.cl  Mon Aug 20 23:51:35 2007
From: rroa at udec.cl (=?ISO-8859-1?Q?Rub=E9n_Roa-Ureta?=)
Date: Mon, 20 Aug 2007 17:51:35 -0400
Subject: [R-sig-Geo] Covariance of beta and lambda in geoR likfit
Message-ID: <46CA0CE7.10700@udec.cl>

Greetings comRades:
Has anyone worked out a procedure to calculate the estimated covariance 
between the beta and lambda estimates in the likelihood-based 
geostatistical model implemented in package geoR? If so, please help me 
out by letting me know.
Do I have reasons to expect that this covariance term would be big or 
perhaps more happily, that it could be discarded without much effect?
Thanks.
Rub?n



From didier.leibovici at free.fr  Tue Aug 21 13:33:18 2007
From: didier.leibovici at free.fr (Didier Leibovici)
Date: Tue, 21 Aug 2007 12:33:18 +0100
Subject: [R-sig-Geo] plot.polylist polygon plot order
In-Reply-To: <FC9D0A4DDB7D5040A9EF833049B61347231375@SOAANCMSG02.soa.alaska.gov>
References: <469E4E21.4080909@noaa.gov>
	<FC9D0A4DDB7D5040A9EF833049B61347231375@SOAANCMSG02.soa.alaska.gov>
Message-ID: <46CACD7E.5060900@free.fr>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070821/2623aaa4/attachment.pl>

From p.hiemstra at geo.uu.nl  Tue Aug 21 14:26:33 2007
From: p.hiemstra at geo.uu.nl (Paul Hiemstra)
Date: Tue, 21 Aug 2007 14:26:33 +0200
Subject: [R-sig-Geo] Problems with projection using spTransform (rgdal)
Message-ID: <46CAD9F9.5040603@geo.uu.nl>

Dear list,

When I perform the following transformation and transform back to the 
original CRS, the original coordinates are not returned:

library(gstat)
library(rgdal)
data(meuse)
coordinates(meuse) =~ x + y
proj4string(meuse) = CRS("+init=EPSG:28992")
print(bbox(meuse))
meuse = spTransform(meuse, CRS("+proj=stere +lat_0=90 +lon_0=0.0 
+lat_ts=60.0 +a=6378.388 +b=6356.912 +x_0=0 +y_0=0"))
print(bbox(meuse))
meuse = spTransform(meuse, CRS("+init=EPSG:28992"))
print(bbox(meuse))

The same code using a transformation between EPSG:28992 (Dutch CRS) and 
EPSG:4326 (latlong) works fine.

Does someone have an idea what causes this?

Paul

Info for my system.
 > sessionInfo()
R version 2.5.1 (2007-06-27)
i386-pc-mingw32

locale:
LC_COLLATE=Dutch_Netherlands.1252;LC_CTYPE=Dutch_Netherlands.1252;LC_MONETARY=Dutch_Netherlands.1252;LC_NUMERIC=C;LC_TIME=Dutch_Netherlands.1252

attached base packages:
[1] "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods" 
[7] "base"    

other attached packages:
   gstat    rgdal       sp
"0.9-39" "0.5-15" "0.9-14"

-- 
Drs. Paul Hiemstra
Department of Physical Geography
Faculty of Geosciences
University of Utrecht
Heidelberglaan 2
P.O. Box 80.115
3508 TC Utrecht
Phone: 	+31302535773
Fax:	+31302531145
http://intamap.geo.uu.nl/~paul



From Roger.Bivand at nhh.no  Tue Aug 21 14:43:56 2007
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 21 Aug 2007 14:43:56 +0200 (CEST)
Subject: [R-sig-Geo] Problems with projection using spTransform (rgdal)
In-Reply-To: <46CAD9F9.5040603@geo.uu.nl>
References: <46CAD9F9.5040603@geo.uu.nl>
Message-ID: <Pine.LNX.4.64.0708211433190.8570@reclus.nhh.no>

On Tue, 21 Aug 2007, Paul Hiemstra wrote:

> Dear list,
>
> When I perform the following transformation and transform back to the
> original CRS, the original coordinates are not returned:
>
> library(gstat)
> library(rgdal)
> data(meuse)
> coordinates(meuse) =~ x + y
> proj4string(meuse) = CRS("+init=EPSG:28992")

Should be: "+init=epsg:28992"

> print(bbox(meuse))
> meuse = spTransform(meuse, CRS("+proj=stere +lat_0=90 +lon_0=0.0
> +lat_ts=60.0 +a=6378.388 +b=6356.912 +x_0=0 +y_0=0"))

This is +ellps=intl, is it? I'm not sure that the +a and +b are in km, 
ought they to be in m? What about datum conversion?

This works for me:

library(rgdal)
data(meuse)
coordinates(meuse) =~ x + y
proj4string(meuse) = CRS("+init=epsg:28992")
bbox(meuse)
meuse1 = spTransform(meuse, CRS(paste("+proj=stere +lat_0=90",
   "+lon_0=0.0 +lat_ts=60.0 +a=6378388 +b=6356912 +x_0=0 +y_0=0")))
bbox(meuse1)
meuse2 <- spTransform(meuse1, CRS("+init=epsg:28992"))
bbox(meuse2)
all.equal(bbox(meuse), bbox(meuse2))

Roger


> print(bbox(meuse))
> meuse = spTransform(meuse, CRS("+init=EPSG:28992"))
> print(bbox(meuse))
>
> The same code using a transformation between EPSG:28992 (Dutch CRS) and
> EPSG:4326 (latlong) works fine.
>
> Does someone have an idea what causes this?
>
> Paul
>
> Info for my system.
> > sessionInfo()
> R version 2.5.1 (2007-06-27)
> i386-pc-mingw32
>
> locale:
> LC_COLLATE=Dutch_Netherlands.1252;LC_CTYPE=Dutch_Netherlands.1252;LC_MONETARY=Dutch_Netherlands.1252;LC_NUMERIC=C;LC_TIME=Dutch_Netherlands.1252
>
> attached base packages:
> [1] "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"
> [7] "base"
>
> other attached packages:
>   gstat    rgdal       sp
> "0.9-39" "0.5-15" "0.9-14"
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From didier.leibovici at free.fr  Tue Aug 21 15:33:56 2007
From: didier.leibovici at free.fr (Didier Leibovici)
Date: Tue, 21 Aug 2007 14:33:56 +0100
Subject: [R-sig-Geo] plot.polylist without borders or controlling the border
	width
Message-ID: <46CAE9C4.5040003@free.fr>

Hi there,

With plot.polylist is there a way of not drawing the "border" or 
controlling the width of the border in order to diminish the vision of 
horror when using a smaller colour range  than the number of polygons 
and when you have quite a lot of polygons in your "shape".

I am thinking as well of possible merging or fusion of neighbour 
polygons having the same color which would give an half way solution ... 
but I don't know the "union" polygon merging polygons function. (which 
should be standard I suppose ...)

thanks

Didier

This message has been checked for viruses but the contents of an attachment
may still contain software viruses, which could damage your computer system:
you are advised to perform your own checks. Email communications with the
University of Nottingham may be monitored as permitted by UK legislation.



From Roger.Bivand at nhh.no  Tue Aug 21 18:13:16 2007
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 21 Aug 2007 18:13:16 +0200 (CEST)
Subject: [R-sig-Geo] plot.polylist polygon plot order
In-Reply-To: <46CACD7E.5060900@free.fr>
References: <469E4E21.4080909@noaa.gov>
	<FC9D0A4DDB7D5040A9EF833049B61347231375@SOAANCMSG02.soa.alaska.gov>
	<46CACD7E.5060900@free.fr>
Message-ID: <Pine.LNX.4.64.0708211808440.8570@reclus.nhh.no>

On Tue, 21 Aug 2007, Didier Leibovici wrote:

> Hi there,
>
> With plot.polylist is there a way of not drawing the "border" or controlling 
> the width of the border in order to diminish the vision of horror when using 
> a smaller colour range  than the number of polygons and when you have quite a 
> lot of polygons in your "shape".

"Horror" is in the eye of the beholder, and can be controlled easily by 
setting the device size to something other than the default.

border="transparent"

lwd= is not passed through in this "deprecated" function - it is for the 
SpatialPolygon class, for which unionSpatialPolygons() is also available.

Hope this helps,

Roger

>
> I am thinking as well of possible merging or fusion of neighbour polygons 
> having the same color which would give an half way solution ... but I don't 
> know the "union" polygon merging polygons function. (which should be standard 
> I suppose ...)
>
> thanks
>
> Didier
>
>
>
>
> Sutherland, Robert D (DFG) wrote:
>>  Hi Jeff,
>>
>>  This is what I did.
>>
>>  HistBreaks<-quantile(datafileDf$nhunters,probs=c(0.1,0.2,
>>  0.4,0.6,0.8,0.9,1.0),na.rm=TRUE)
>>  np<-findInterval(datafileDf$nhunters, histBreaks, all.inside=TRUE)
>>  colorsToUse<-colorSchemeV5
>>  plot.polylist(datafilePolys, col=colorsToUse[np],  forcefill=FALSE)
>>  plot.polylist(datafilePolys,  density = c(-1,20,20,-1,-1,-1,-1)[np],
>>  angle=c(0,0,90,0,0,0,0)[np], forcefill=FALSE,add=TRUE)
>>
>>  the first plot.polylist plots the outline of the polygon, the second
>>  call "colors" the polygon.
>>
>>  I hope this helps.
>>
>>  Bob
>>
>>  -----Original Message-----
>>  From: r-sig-geo-bounces at stat.math.ethz.ch
>>  [mailto:r-sig-geo-bounces at stat.math.ethz.ch] On Behalf Of Jeff Jorgensen
>>  Sent: Wednesday, July 18, 2007 9:30 AM
>>  To: r-sig-geo at stat.math.ethz.ch
>>  Subject: [R-sig-Geo] plot.polylist polygon plot order
>>
>>  Hello,
>>
>>  I've imported a shapefile of polygons (R v2.5.1 winxp, maptools v0.6-13)
>>
>>  and I'm trying to assign colors to polygons in plot.polylist().  Is there
>>  a way to force the order in which polygons are plotted get the correct
>>  color associations to the corresponding polygons?
>>
>>  Best regards,
>>
>>  Jeff
>> 
>>
>> 
>
>
> This message has been checked for viruses but the contents of an attachment
> may still contain software viruses, which could damage your computer system:
> you are advised to perform your own checks. Email communications with the
> University of Nottingham may be monitored as permitted by UK legislation.
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From fieldsh at mail.med.upenn.edu  Tue Aug 21 22:18:25 2007
From: fieldsh at mail.med.upenn.edu (Sam Field)
Date: Tue, 21 Aug 2007 16:18:25 -0400
Subject: [R-sig-Geo] (no subject)
Message-ID: <1187727505.46cb4891e1351@webmail.pobox.upenn.edu>

List,

I am looking for ways of estimating spatial autoregression models that adjust 
for a known source of heteroskedaticity and the Waller and Gotway (2004) text 
outline how this can be done in the case of the SAR model.  If I work at it, I 
think I can implement this myself in R, but I wanted to see if anybody else had 
done it. It seems like a pretty straightforward generalization of the SAR model 
and would make a very helpful addition to the spatial regression tools in 
spdep - especially given the effects of heteroskedaticity on the consistency of 
the SAR parameters! 

Sam
 
 


-- 
********Note the new contact information*******

Samuel H. Field, Ph.D. 
Senior Research Investigator
CHERP/Division of Internal Medicine - University of Pennsylvania
Philadelphia VA Medical Center
3900 Woodland Ave (9 East)
Philadelphia, PA 19104
(215) 823-5800 EXT. 6155 (Office)
(215) 823-6330 (Fax)



From Roger.Bivand at nhh.no  Tue Aug 21 22:54:31 2007
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 21 Aug 2007 22:54:31 +0200 (CEST)
Subject: [R-sig-Geo] (no subject)
In-Reply-To: <1187727505.46cb4891e1351@webmail.pobox.upenn.edu>
References: <1187727505.46cb4891e1351@webmail.pobox.upenn.edu>
Message-ID: <Pine.LNX.4.64.0708212250360.8570@reclus.nhh.no>

On Tue, 21 Aug 2007, Sam Field wrote:

> List,
>
> I am looking for ways of estimating spatial autoregression models that adjust
> for a known source of heteroskedaticity and the Waller and Gotway (2004) text
> outline how this can be done in the case of the SAR model.  If I work at it, I
> think I can implement this myself in R, but I wanted to see if anybody else had
> done it. It seems like a pretty straightforward generalization of the SAR model
> and would make a very helpful addition to the spatial regression tools in
> spdep - especially given the effects of heteroskedaticity on the consistency of
> the SAR parameters!

?spautolm

The examples reproduce the results in Waller & Gotway, perhaps apart from 
a flattish function to optimise in the weighted CAR case. spautolm() now 
provides weighted or unweighted SAR, CAR, and SMA. Sparse matrix methods 
are available for SAR and CAR, SAR when spatial weights are symmetric or 
similar to symmetric (CAR weights have to be symmetric).

Roger

>
> Sam
>
>
>
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From fieldsh at mail.med.upenn.edu  Tue Aug 21 23:27:55 2007
From: fieldsh at mail.med.upenn.edu (Sam Field)
Date: Tue, 21 Aug 2007 17:27:55 -0400
Subject: [R-sig-Geo] weighted spatial autoregression
In-Reply-To: <Pine.LNX.4.64.0708212250360.8570@reclus.nhh.no>
References: <1187727505.46cb4891e1351@webmail.pobox.upenn.edu>
	<Pine.LNX.4.64.0708212250360.8570@reclus.nhh.no>
Message-ID: <1187731675.46cb58dbe3318@webmail.pobox.upenn.edu>

Thanks Roger!

Sorry about omitting the subject line.  I have been working with errorsarlm() - 
did not know about spautolm().  Do you know if there is something analogous 
possible in the case of the spatial lag model,

Y = pWY + XB + e ?

I was going to start looking into it.

thanks!


Sam




Quoting Roger Bivand <Roger.Bivand at nhh.no>:

> On Tue, 21 Aug 2007, Sam Field wrote:
> 
> > List,
> >
> > I am looking for ways of estimating spatial autoregression models that
> adjust
> > for a known source of heteroskedaticity and the Waller and Gotway (2004)
> text
> > outline how this can be done in the case of the SAR model.  If I work at
> it, I
> > think I can implement this myself in R, but I wanted to see if anybody else
> had
> > done it. It seems like a pretty straightforward generalization of the SAR
> model
> > and would make a very helpful addition to the spatial regression tools in
> > spdep - especially given the effects of heteroskedaticity on the
> consistency of
> > the SAR parameters!
> 
> ?spautolm
> 
> The examples reproduce the results in Waller & Gotway, perhaps apart from 
> a flattish function to optimise in the weighted CAR case. spautolm() now 
> provides weighted or unweighted SAR, CAR, and SMA. Sparse matrix methods 
> are available for SAR and CAR, SAR when spatial weights are symmetric or 
> similar to symmetric (CAR weights have to be symmetric).
> 
> Roger
> 
> >
> > Sam
> >
> >
> >
> >
> >
> 
> -- 
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
> 
> 


-- 
********Note the new contact information*******

Samuel H. Field, Ph.D. 
Senior Research Investigator
CHERP/Division of Internal Medicine - University of Pennsylvania
Philadelphia VA Medical Center
3900 Woodland Ave (9 East)
Philadelphia, PA 19104
(215) 823-5800 EXT. 6155 (Office)
(215) 823-6330 (Fax)



From Roger.Bivand at nhh.no  Wed Aug 22 09:02:43 2007
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 22 Aug 2007 09:02:43 +0200 (CEST)
Subject: [R-sig-Geo] weighted spatial autoregression
In-Reply-To: <1187731675.46cb58dbe3318@webmail.pobox.upenn.edu>
References: <1187727505.46cb4891e1351@webmail.pobox.upenn.edu>
	<Pine.LNX.4.64.0708212250360.8570@reclus.nhh.no>
	<1187731675.46cb58dbe3318@webmail.pobox.upenn.edu>
Message-ID: <Pine.LNX.4.64.0708220853250.11743@reclus.nhh.no>

On Tue, 21 Aug 2007, Sam Field wrote:

> Thanks Roger!
>
> Sorry about omitting the subject line.  I have been working with errorsarlm() -
> did not know about spautolm().  Do you know if there is something analogous
> possible in the case of the spatial lag model,
>
> Y = pWY + XB + e ?

I have not looked at it, but because it is a wierd animal, I don't think 
it will be too easy to provide a theoretical foundation for it. The 
heteroskedasticity is in the error term, but the autoregressive part 
isn't. I don't think there are any examples anywhere, either.

It ought to be possible, though.

Roger

>
> I was going to start looking into it.
>
> thanks!
>
>
> Sam
>
>
>
>
> Quoting Roger Bivand <Roger.Bivand at nhh.no>:
>
>> On Tue, 21 Aug 2007, Sam Field wrote:
>>
>>> List,
>>>
>>> I am looking for ways of estimating spatial autoregression models that
>> adjust
>>> for a known source of heteroskedaticity and the Waller and Gotway (2004)
>> text
>>> outline how this can be done in the case of the SAR model.  If I work at
>> it, I
>>> think I can implement this myself in R, but I wanted to see if anybody else
>> had
>>> done it. It seems like a pretty straightforward generalization of the SAR
>> model
>>> and would make a very helpful addition to the spatial regression tools in
>>> spdep - especially given the effects of heteroskedaticity on the
>> consistency of
>>> the SAR parameters!
>>
>> ?spautolm
>>
>> The examples reproduce the results in Waller & Gotway, perhaps apart from
>> a flattish function to optimise in the weighted CAR case. spautolm() now
>> provides weighted or unweighted SAR, CAR, and SMA. Sparse matrix methods
>> are available for SAR and CAR, SAR when spatial weights are symmetric or
>> similar to symmetric (CAR weights have to be symmetric).
>>
>> Roger
>>
>>>
>>> Sam
>>>
>>>
>>>
>>>
>>>
>>
>> --
>> Roger Bivand
>> Economic Geography Section, Department of Economics, Norwegian School of
>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>> e-mail: Roger.Bivand at nhh.no
>>
>>
>
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From didier.leibovici at free.fr  Wed Aug 22 10:41:41 2007
From: didier.leibovici at free.fr (Didier Leibovici)
Date: Wed, 22 Aug 2007 09:41:41 +0100
Subject: [R-sig-Geo] plot.polylist polygon plot order
In-Reply-To: <Pine.LNX.4.64.0708211808440.8570@reclus.nhh.no>
References: <469E4E21.4080909@noaa.gov>	<FC9D0A4DDB7D5040A9EF833049B61347231375@SOAANCMSG02.soa.alaska.gov>	<46CACD7E.5060900@free.fr>
	<Pine.LNX.4.64.0708211808440.8570@reclus.nhh.no>
Message-ID: <46CBF6C5.3050006@free.fr>

Thanks for this, I've seen also the function plot.Map with the parameter 
ol=NA but it is also "deprecated" (I didn't know plot.polylist was)

With plot.Map I had the message
 >plot(Z300PolMap,ol=NA,auxvar=Z300.PTA3[[1]]$v[1,],color="blue",nclass=300)
Warning message:
'plot.Map' is deprecated.
Use 'plot.Spatial' instead.
See help("Deprecated") and help("maptools-deprecated").

but I couldn't find plot.Spatial

thanks again
Didier

Roger Bivand wrote:
> On Tue, 21 Aug 2007, Didier Leibovici wrote:
> 
>> Hi there,
>>
>> With plot.polylist is there a way of not drawing the "border" or controlling 
>> the width of the border in order to diminish the vision of horror when using 
>> a smaller colour range  than the number of polygons and when you have quite a 
>> lot of polygons in your "shape".
> 
> "Horror" is in the eye of the beholder, and can be controlled easily by 
> setting the device size to something other than the default.
> 
> border="transparent"
> 
> lwd= is not passed through in this "deprecated" function - it is for the 
> SpatialPolygon class, for which unionSpatialPolygons() is also available.
> 
> Hope this helps,
> 
> Roger
> 
>> I am thinking as well of possible merging or fusion of neighbour polygons 
>> having the same color which would give an half way solution ... but I don't 
>> know the "union" polygon merging polygons function. (which should be standard 
>> I suppose ...)
>>
>> thanks
>>
>> Didier
>>
>>
>>
>>
>> Sutherland, Robert D (DFG) wrote:
>>>  Hi Jeff,
>>>
>>>  This is what I did.
>>>
>>>  HistBreaks<-quantile(datafileDf$nhunters,probs=c(0.1,0.2,
>>>  0.4,0.6,0.8,0.9,1.0),na.rm=TRUE)
>>>  np<-findInterval(datafileDf$nhunters, histBreaks, all.inside=TRUE)
>>>  colorsToUse<-colorSchemeV5
>>>  plot.polylist(datafilePolys, col=colorsToUse[np],  forcefill=FALSE)
>>>  plot.polylist(datafilePolys,  density = c(-1,20,20,-1,-1,-1,-1)[np],
>>>  angle=c(0,0,90,0,0,0,0)[np], forcefill=FALSE,add=TRUE)
>>>
>>>  the first plot.polylist plots the outline of the polygon, the second
>>>  call "colors" the polygon.
>>>
>>>  I hope this helps.
>>>
>>>  Bob
>>>
>>>  -----Original Message-----
>>>  From: r-sig-geo-bounces at stat.math.ethz.ch
>>>  [mailto:r-sig-geo-bounces at stat.math.ethz.ch] On Behalf Of Jeff Jorgensen
>>>  Sent: Wednesday, July 18, 2007 9:30 AM
>>>  To: r-sig-geo at stat.math.ethz.ch
>>>  Subject: [R-sig-Geo] plot.polylist polygon plot order
>>>
>>>  Hello,
>>>
>>>  I've imported a shapefile of polygons (R v2.5.1 winxp, maptools v0.6-13)
>>>
>>>  and I'm trying to assign colors to polygons in plot.polylist().  Is there
>>>  a way to force the order in which polygons are plotted get the correct
>>>  color associations to the corresponding polygons?
>>>
>>>  Best regards,
>>>
>>>  Jeff
>>>
>>>
>>>
>>
>> This message has been checked for viruses but the contents of an attachment
>> may still contain software viruses, which could damage your computer system:
>> you are advised to perform your own checks. Email communications with the
>> University of Nottingham may be monitored as permitted by UK legislation.
>>
>>
> 


This message has been checked for viruses but the contents of an attachment
may still contain software viruses, which could damage your computer system:
you are advised to perform your own checks. Email communications with the
University of Nottingham may be monitored as permitted by UK legislation.



From Roger.Bivand at nhh.no  Wed Aug 22 11:34:46 2007
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 22 Aug 2007 11:34:46 +0200 (CEST)
Subject: [R-sig-Geo] plot.polylist polygon plot order
In-Reply-To: <46CBF6C5.3050006@free.fr>
References: <469E4E21.4080909@noaa.gov>
	<FC9D0A4DDB7D5040A9EF833049B61347231375@SOAANCMSG02.soa.alaska.gov>
	<46CACD7E.5060900@free.fr>
	<Pine.LNX.4.64.0708211808440.8570@reclus.nhh.no>
	<46CBF6C5.3050006@free.fr>
Message-ID: <Pine.LNX.4.64.0708221131220.12226@reclus.nhh.no>

On Wed, 22 Aug 2007, Didier Leibovici wrote:

> Thanks for this, I've seen also the function plot.Map with the parameter 
> ol=NA but it is also "deprecated" (I didn't know plot.polylist was)
>
> With plot.Map I had the message
>> plot(Z300PolMap,ol=NA,auxvar=Z300.PTA3[[1]]$v[1,],color="blue",nclass=300)
> Warning message:
> 'plot.Map' is deprecated.
> Use 'plot.Spatial' instead.
> See help("Deprecated") and help("maptools-deprecated").
>
> but I couldn't find plot.Spatial

See details in package sp, the actual function is

sp:::plot.SpatialPolygons

or perhaps simply use spplot on the SpatialPolygonsDataFrame object?

Making everything depend on an ad-hoc representation of a shapefile when 
the data may actually be more varied (read by readOGR in rgdal) is very 
limiting.

Roger

>
> thanks again
> Didier
>
> Roger Bivand wrote:
>>  On Tue, 21 Aug 2007, Didier Leibovici wrote:
>> 
>> >  Hi there,
>> > 
>> >  With plot.polylist is there a way of not drawing the "border" or 
>> >  controlling the width of the border in order to diminish the vision of 
>> >  horror when using a smaller colour range  than the number of polygons 
>> >  and when you have quite a lot of polygons in your "shape".
>>
>>  "Horror" is in the eye of the beholder, and can be controlled easily by
>>  setting the device size to something other than the default.
>>
>>  border="transparent"
>>
>>  lwd= is not passed through in this "deprecated" function - it is for the
>>  SpatialPolygon class, for which unionSpatialPolygons() is also available.
>>
>>  Hope this helps,
>>
>>  Roger
>> 
>> >  I am thinking as well of possible merging or fusion of neighbour 
>> >  polygons having the same color which would give an half way solution ... 
>> >  but I don't know the "union" polygon merging polygons function. (which 
>> >  should be standard I suppose ...)
>> > 
>> >  thanks
>> > 
>> >  Didier
>> > 
>> > 
>> > 
>> > 
>> >  Sutherland, Robert D (DFG) wrote:
>> > >   Hi Jeff,
>> > > 
>> > >   This is what I did.
>> > > 
>> > >   HistBreaks<-quantile(datafileDf$nhunters,probs=c(0.1,0.2,
>> > >   0.4,0.6,0.8,0.9,1.0),na.rm=TRUE)
>> > >   np<-findInterval(datafileDf$nhunters, histBreaks, all.inside=TRUE)
>> > >   colorsToUse<-colorSchemeV5
>> > >   plot.polylist(datafilePolys, col=colorsToUse[np],  forcefill=FALSE)
>> > >   plot.polylist(datafilePolys,  density = c(-1,20,20,-1,-1,-1,-1)[np],
>> > >   angle=c(0,0,90,0,0,0,0)[np], forcefill=FALSE,add=TRUE)
>> > > 
>> > >   the first plot.polylist plots the outline of the polygon, the second
>> > >   call "colors" the polygon.
>> > > 
>> > >   I hope this helps.
>> > > 
>> > >   Bob
>> > > 
>> > >   -----Original Message-----
>> > >   From: r-sig-geo-bounces at stat.math.ethz.ch
>> > >   [mailto:r-sig-geo-bounces at stat.math.ethz.ch] On Behalf Of Jeff 
>> > >   Jorgensen
>> > >   Sent: Wednesday, July 18, 2007 9:30 AM
>> > >   To: r-sig-geo at stat.math.ethz.ch
>> > >   Subject: [R-sig-Geo] plot.polylist polygon plot order
>> > > 
>> > >   Hello,
>> > > 
>> > >   I've imported a shapefile of polygons (R v2.5.1 winxp, maptools 
>> > >   v0.6-13)
>> > > 
>> > >   and I'm trying to assign colors to polygons in plot.polylist().  Is 
>> > >   there
>> > >   a way to force the order in which polygons are plotted get the 
>> > >   correct
>> > >   color associations to the corresponding polygons?
>> > > 
>> > >   Best regards,
>> > > 
>> > >   Jeff
>> > > 
>> > > 
>> > > 
>> > 
>> >  This message has been checked for viruses but the contents of an 
>> >  attachment
>> >  may still contain software viruses, which could damage your computer 
>> >  system:
>> >  you are advised to perform your own checks. Email communications with 
>> >  the
>> >  University of Nottingham may be monitored as permitted by UK 
>> >  legislation.
>> > 
>> >
>> 
>
>
> This message has been checked for viruses but the contents of an attachment
> may still contain software viruses, which could damage your computer system:
> you are advised to perform your own checks. Email communications with the
> University of Nottingham may be monitored as permitted by UK legislation.
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From suraj.cimmyt at gmail.com  Fri Aug 24 06:14:49 2007
From: suraj.cimmyt at gmail.com (Suraj Pandey)
Date: Fri, 24 Aug 2007 09:44:49 +0530
Subject: [R-sig-Geo] Reg: SRTM 90m elevated data
Message-ID: <c9f7e5a70708232114h64c803ccw175616f636b7ef33@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070824/f8e6c712/attachment.pl>

From outdoor2940 at indiatimes.com  Sat Aug 25 16:27:23 2007
From: outdoor2940 at indiatimes.com (outdoor2940 at indiatimes.com)
Date: Sat, 25 Aug 2007 19:57:23 +0530 (IST)
Subject: [R-sig-Geo] Fwd: findest Du die Frauen,
 die genau das gleiche suchen wie Du! ( Markt)
Message-ID: <1217347412.634061188052043100.JavaMail.root@mbv7.indiatimes.com>

N A M E : Leona, A L T E R : 33, B E R U F : Hausfrau

Na, mein Geiler!

Ist dir auch schon so heiss wie mir? Ich habe einfach die Nase voll, dass mein Mann nie zu Hause ist und mir meine Bedurfnisse nicht befriedigen kann. Jetzt bin ich gezwungen mir einen richtigen Lover zu suchen, der mich wieder mal so richtig durchbumst! Wenn du also mein Lover sein willst, egal ob fur eine Nacht oder fur Langzeitbeziehungen, ich bin fur beides zu haben! 

Hol dir jetzt einfach einen Zugang fur 5 Euro, du findest mich mit dem Usernamen Leona33-allone, ich habe dort meine Heimadresse und meine Handynummer hinterlassen, melde dich bei mir und besuche mich, oder ich komme zu dir.

http://skt.onlinecompany.cc/de/index.html

Schau Dich jetzt auf der grossten, deutschsprachigen Kontaktdatenbank (Deutschland, Osterreich, Die Schweiz) um, denn hier findest Du die Frauen, die genau das gleiche suchen wie Du!

In unserer Datenbank findest Du mehr als 250,000 Profile fickgeiler Schlampen, die es mal wieder so richtig besorgt bekommen wollen.

http://skt.onlinecompany.cc/de/index.html

...und entscheide Dich fur mich! Mein Username ist Leona33-allone
bis dann...

 

Deine scharfe LEONA -:) 

 

 



Wenn Du diesen Newsletter nicht mehr erhalten mochtest, klicke einfach auf diesen Link:
http://voe.onlinecompany.cc/revoke.php










( bzw allerdings Parlament Werk gekommen sieben Donnerstag Handel Richtung
 Mitglieder Unterst?tzung Programm weiteren Form Zwei k?nnten Zuschauer Abend langen gef?hrt
 sicher dieser Vater Konzept Frau Mannschaft)

--
Wish all things were as intelligent as my mail.
Log on to the all-new and intelligent Indiatimes mail.
http://mail.indiatimes.com



From mgallay01 at qub.ac.uk  Sat Aug 25 22:48:51 2007
From: mgallay01 at qub.ac.uk (Michal Gallay)
Date: 25 Aug 2007 20:48:51 +0000
Subject: [R-sig-Geo] R + GRASS in win XP
Message-ID: <Prayer.1.0.12.0708252048510.22914@amos.qub.ac.uk>

Dear R Users,

recently I've attempted to run R with GRASS from QGIS GRASS shell in 
Windows XP. It was my first try and didn't work.

Would you know if it is actually possible to run R from GRASS shell in 
windows environment?

I launched GRASS Shell from QGIS menu, which works via Mingw32 navigated 
to R directory, successfully started R from GRASS Shell and loaded spgrass6 
package in R.

The following "system()" R command didn't work for GRASS commands. I 
suspect it is related to Mingw32 emulator, but to be honest I haven't got 
yet to deep into UNIX-Windows programs.

Thank you very much for any hints for steps forward.

Michal

--
Michal Gallay

Postgraduate Research Student
School of Geography, Archaeology and Palaeoecology
Queen's University
Belfast BT7 1NN
Northern Ireland

Tel: +44(0)2890 273929
Fax: +44(0)2890 973212
email: mgallay01 at qub.ac.uk
www: www.qub.ac.uk/geog



From Roger.Bivand at nhh.no  Sun Aug 26 08:09:48 2007
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sun, 26 Aug 2007 08:09:48 +0200 (CEST)
Subject: [R-sig-Geo] R + GRASS in win XP
In-Reply-To: <Prayer.1.0.12.0708252048510.22914@amos.qub.ac.uk>
References: <Prayer.1.0.12.0708252048510.22914@amos.qub.ac.uk>
Message-ID: <Pine.LNX.4.64.0708260757320.30138@reclus.nhh.no>

On Sat, 25 Aug 2007, Michal Gallay wrote:

> Dear R Users,
>
> recently I've attempted to run R with GRASS from QGIS GRASS shell in
> Windows XP. It was my first try and didn't work.

Until very recently, the QGIS/GRASS combination changed so often that it 
wasn't feasible to try to make any interface work. The solution was to 
read and write temporary files manually.

In order to make progress, the exact QGIS release (0.8.1?), and R output 
from sessionInfo() is needed, as well as your commands on (say) spearfish, 
and the verbatin error message and th output of traceback(). My guess is 
that the OS is being recognised in R as "windows", and that file paths are 
being constructed for Cygwin (which works), and which is currently the 
only style available. Almost certainly there are PATH issues too, that is 
that GRASS program executables are not being found, but without more 
information, it is difficult to check.

It is possible that the 0.8.1 release note for Windows:

"If you install QGIS in a path containing spaces (for example "C:\Program 
Files\Quantum GIS") you may experience problems with certain features, in 
particular the GRASS toolbox functions"

is relevant.

Hope this helps,

Roger

>
> Would you know if it is actually possible to run R from GRASS shell in
> windows environment?
>
> I launched GRASS Shell from QGIS menu, which works via Mingw32 navigated
> to R directory, successfully started R from GRASS Shell and loaded spgrass6
> package in R.
>
> The following "system()" R command didn't work for GRASS commands. I
> suspect it is related to Mingw32 emulator, but to be honest I haven't got
> yet to deep into UNIX-Windows programs.
>
> Thank you very much for any hints for steps forward.
>
> Michal
>
> --
> Michal Gallay
>
> Postgraduate Research Student
> School of Geography, Archaeology and Palaeoecology
> Queen's University
> Belfast BT7 1NN
> Northern Ireland
>
> Tel: +44(0)2890 273929
> Fax: +44(0)2890 973212
> email: mgallay01 at qub.ac.uk
> www: www.qub.ac.uk/geog
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From pegorett at science.unitn.it  Sun Aug 26 16:41:54 2007
From: pegorett at science.unitn.it (Stefano Pegoretti)
Date: Sun, 26 Aug 2007 16:41:54 +0200
Subject: [R-sig-Geo] Bayesian Kriging
Message-ID: <200708261641.55133.pegorett@science.unitn.it>

Dear List,
	I would like to try (for the first time!) the Bayesian Kriging Approach using 
*geoR* package, but there is a point that is not so clear to me: since I've 
to transform my data in order to obtain a Gaussian dataset (it's right?),
	i) variography analysis has to be taken on this transformed dataset?
	ii) if I let krige.bayes() function to perform the transformation by the 
means of "lambda" parameter, the output about model's parameters are referred 
to the transformed data or orginal data?

Thanks a lot for any suggestion or advice!
Have a nice day,

stefano

-- 
Stefano Pegoretti, PhD
Universit? degli Studi di Trento (Italy)
Dipartimento di Fisica (Physics dept.)
email: pegorett at science.unitn.it



From Roger.Bivand at nhh.no  Sun Aug 26 20:32:53 2007
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sun, 26 Aug 2007 20:32:53 +0200 (CEST)
Subject: [R-sig-Geo] R + GRASS in win XP
In-Reply-To: <Pine.LNX.4.64.0708260757320.30138@reclus.nhh.no>
References: <Prayer.1.0.12.0708252048510.22914@amos.qub.ac.uk>
	<Pine.LNX.4.64.0708260757320.30138@reclus.nhh.no>
Message-ID: <Pine.LNX.4.64.0708262027550.2525@reclus.nhh.no>

On Sun, 26 Aug 2007, Roger Bivand wrote:

> On Sat, 25 Aug 2007, Michal Gallay wrote:
>
>> Dear R Users,
>>
>> recently I've attempted to run R with GRASS from QGIS GRASS shell in
>> Windows XP. It was my first try and didn't work.
>
> Until very recently, the QGIS/GRASS combination changed so often that it
> wasn't feasible to try to make any interface work. The solution was to
> read and write temporary files manually.
>
> In order to make progress, the exact QGIS release (0.8.1?), and R output
> from sessionInfo() is needed, as well as your commands on (say) spearfish,
> and the verbatin error message and th output of traceback(). My guess is
> that the OS is being recognised in R as "windows", and that file paths are
> being constructed for Cygwin (which works), and which is currently the
> only style available. Almost certainly there are PATH issues too, that is
> that GRASS program executables are not being found, but without more
> information, it is difficult to check.
>
> It is possible that the 0.8.1 release note for Windows:
>
> "If you install QGIS in a path containing spaces (for example "C:\Program
> Files\Quantum GIS") you may experience problems with certain features, in
> particular the GRASS toolbox functions"

It was a combination of path variables with spaces and the apparent need 
to call GRASS commands with *.exe extensions from within R in the GRASS 
shell under GRASS Tools (QGIS 0.8.1). From spgrass6-0.4-1, QGIS/msys/GRASS 
is supported - package revision just submitted to CRAN.

Roger

>
> is relevant.
>
> Hope this helps,
>
> Roger
>
>>
>> Would you know if it is actually possible to run R from GRASS shell in
>> windows environment?
>>
>> I launched GRASS Shell from QGIS menu, which works via Mingw32 navigated
>> to R directory, successfully started R from GRASS Shell and loaded spgrass6
>> package in R.
>>
>> The following "system()" R command didn't work for GRASS commands. I
>> suspect it is related to Mingw32 emulator, but to be honest I haven't got
>> yet to deep into UNIX-Windows programs.
>>
>> Thank you very much for any hints for steps forward.
>>
>> Michal
>>
>> --
>> Michal Gallay
>>
>> Postgraduate Research Student
>> School of Geography, Archaeology and Palaeoecology
>> Queen's University
>> Belfast BT7 1NN
>> Northern Ireland
>>
>> Tel: +44(0)2890 273929
>> Fax: +44(0)2890 973212
>> email: mgallay01 at qub.ac.uk
>> www: www.qub.ac.uk/geog
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From lee.kitty at yahoo.com  Sun Aug 26 20:42:36 2007
From: lee.kitty at yahoo.com (Kitty Lee)
Date: Sun, 26 Aug 2007 11:42:36 -0700 (PDT)
Subject: [R-sig-Geo] sp.correlogram
Message-ID: <488856.92741.qm@web36303.mail.mud.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070826/9f6c0c2f/attachment.pl>

From Roger.Bivand at nhh.no  Sun Aug 26 20:52:08 2007
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sun, 26 Aug 2007 20:52:08 +0200 (CEST)
Subject: [R-sig-Geo] sp.correlogram
In-Reply-To: <488856.92741.qm@web36303.mail.mud.yahoo.com>
References: <488856.92741.qm@web36303.mail.mud.yahoo.com>
Message-ID: <Pine.LNX.4.64.0708262046250.2525@reclus.nhh.no>

On Sun, 26 Aug 2007, Kitty Lee wrote:

> Hi. I have a question about sp.correlogram in SPDEP.
>
> I created a weight matrix of 5 nearest neighbors. To play around with 
> the sp.correlogram function, I specified an order of 10 (which is the 
> max. lag order). The plot came out with spatial autocorrelation with 10 
> lags.
>
> How to understand the 10 spatial lags? I mean the weight matrix only has 
> information of the nearest 5 neighbors (i.e. the matrix only provides 
> information for the first 5 lags). How does the program know which are 
> the 6th-10th lag?
>
> Sorry for the odd question. Perhaps it's because I misunderstood the 
> concept of lag in the program. Can someone clarify this for me?

Your k=5 k-nearest neighbours are first order neighbours. You asked for 10 
orders, so you "stepped out": the second order neighbours are the first 
order neighbours of your first order neighbours (omitting observations 
already included), and so on. Have a look (in practice) at what nblag() 
does if this is unclear, and note that for many lattices, there will be 
relatively few or no remaining neighbours at high lags.

Hope this helps,

Roger

>
> Thanks!
>
> K.
>
>
>
>
>
>
>
> ---------------------------------
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From gerald.jurasinski at uni-rostock.de  Tue Aug 28 10:40:12 2007
From: gerald.jurasinski at uni-rostock.de (Gerald Jurasinski)
Date: Tue, 28 Aug 2007 10:40:12 +0200
Subject: [R-sig-Geo] (no subject)
Message-ID: <3D5CAC70-631D-43A9-BEBF-348603C3D71E@uni-rostock.de>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070828/63599247/attachment.pl>

From epistat at gmail.com  Tue Aug 28 13:17:21 2007
From: epistat at gmail.com (zhijie zhang)
Date: Tue, 28 Aug 2007 19:17:21 +0800
Subject: [R-sig-Geo] R-sig-Geo Digest, Vol 48, Issue 22
In-Reply-To: <mailman.17.1188295205.21171.r-sig-geo@stat.math.ethz.ch>
References: <mailman.17.1188295205.21171.r-sig-geo@stat.math.ethz.ch>
Message-ID: <2fc17e30708280417p2ff69510t7d15a4aeaa5125c4@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070828/fab294da/attachment.pl>

From paulojus at c3sl.ufpr.br  Tue Aug 28 15:13:35 2007
From: paulojus at c3sl.ufpr.br (Paulo Justiniano Ribeiro Jr)
Date: Tue, 28 Aug 2007 10:13:35 -0300 (BRT)
Subject: [R-sig-Geo] Bayesian Kriging
In-Reply-To: <200708261641.55133.pegorett@science.unitn.it>
References: <200708261641.55133.pegorett@science.unitn.it>
Message-ID: <Pine.LNX.4.58.0708281009340.31760@macalan.c3sl.ufpr.br>

Stefano

> Dear List,
> 	I would like to try (for the first time!) the Bayesian Kriging Approach using
> *geoR* package, but there is a point that is not so clear to me: since I've
> to transform my data in order to obtain a Gaussian dataset (it's right?),
> 	i) variography analysis has to be taken on this transformed dataset?

if you are using the Bayesian approach inference on the model parameters
will be besed on the posteriors, and not on the variogram fitting.
This way the variogram analysis can be useful as an exploratory analysis,
and yes, in using the same transformation intended for the Bayesian
analysis.
I tend to use boxcox() to find the suitable transformation

> 	ii) if I let krige.bayes() function to perform the transformation by the
> means of "lambda" parameter, the output about model's parameters are referred
> to the transformed data or orginal data?

If you enter with data in the original scale and a value lambda, the
results will be given in the original scale, i.e. back transformed towards
the end. This is because the simulations from the predictive distribution
(conditional simulations) obtained in the transformed scale and
backtransformed

hopethios helps

Best
P.J.


>
> Thanks a lot for any suggestion or advice!
> Have a nice day,
>
> stefano
>
> --
> Stefano Pegoretti, PhD
> Universit? degli Studi di Trento (Italy)
> Dipartimento di Fisica (Physics dept.)
> email: pegorett at science.unitn.it
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



From hi_ono2001 at yahoo.co.jp  Tue Aug 28 17:37:27 2007
From: hi_ono2001 at yahoo.co.jp (Hisaji ONO)
Date: Wed, 29 Aug 2007 00:37:27 +0900 (JST)
Subject: [R-sig-Geo] BGWR for R
Message-ID: <20070828153727.1948.qmail@web10711.mail.bbt.yahoo.co.jp>

ello.

 Does anyone try to develop B(aysian)GWR package for R or
extension of spgwr?

 I know Matlab's spatialtoolbox lib. has this function.




 Regards.



From tgriffin at uaex.edu  Tue Aug 28 17:10:05 2007
From: tgriffin at uaex.edu (Terry Griffin)
Date: Tue, 28 Aug 2007 10:10:05 -0500
Subject: [R-sig-Geo] collecting significance values in sp.correlogram
Message-ID: <46D3F47D.CF06.00FB.0@uaex.edu>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070828/a2baa0d1/attachment.pl>

From Roger.Bivand at nhh.no  Tue Aug 28 19:52:43 2007
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 28 Aug 2007 19:52:43 +0200 (CEST)
Subject: [R-sig-Geo] collecting significance values in sp.correlogram
In-Reply-To: <46D3F47D.CF06.00FB.0@uaex.edu>
References: <46D3F47D.CF06.00FB.0@uaex.edu>
Message-ID: <Pine.LNX.4.64.0708281935240.8870@reclus.nhh.no>

On Tue, 28 Aug 2007, Terry Griffin wrote:

> Greetings,
>
> I'm running a simulation and want to collect the p-values from the 
> sp.correlogram in spdep (version 0.4-4).  I've used the $res to collect 
> the estimate and variance, but would like to collect the p-values "on 
> the fly" in an intermediate step.  Any suggestions?
>

No p-values are present in ths "spcor" object, nor are any exposed inside 
sp.correogram. You can get the framework from code in print.spcor, or use:

zz <- capture.output(pvs <- print(Ispc, "bonferroni")[,5])

using Ispc in example(sp.correlogram), that is have print.spcor() do the 
work for you - more columns if you need them. Remember to consider 
adjusting the p-values for multiple comparisons.

Hope this helps,

Roger

> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From reeves at nceas.ucsb.edu  Wed Aug 29 00:36:02 2007
From: reeves at nceas.ucsb.edu (Rick Reeves)
Date: Tue, 28 Aug 2007 15:36:02 -0700
Subject: [R-sig-Geo] Units of centroid point coordinates generated by
	get.Pcent and calcCentroid?
Message-ID: <46D4A352.6000704@nceas.ucsb.edu>

Hello List:

I'm getting to know the polygon centroid - generating functions 
get.Pcent() (maptools) and calcCentroid() (PBSmapping),
and would like to know the units of the centroid point coordinates.

Working with maptools version:

library(maptools)
MapPolysMapClass = read.shape("FiveNWStateCounties")
MapPolyCents = get.Pcent(MapPolysMapClass)

Here is a portion of my input polygon file (CNTRDLONG/LAT computed 
elsewhere),

Browse[1]> MapPolysMapClass$att.data
STATEFIPS COUNTYFIPS      COUNTYNAME LSAD LSAD_TRANS CNTRDLONG 
CNTRDLAT      F_AREA
1          53        073                     Whatcom   06     County 
-121.7137 48.82591  5584761843
2          53        073                     Whatcom   06     County 
-123.0569 48.98870    12378754
3          30        029                     Flathead   06     County 
-114.0498 48.29519 13613065142
4          30        053                     Lincoln   06     County 
-115.4052 48.54250  9518449902
5          16        021                     Boundary   06     County 
-116.4629 48.76703  3309965666

.and here are the corresponding polygon centroids

 [1,] -1762352.7 1282662.2
 [2,] -1846616.8 1326565.8
 [3,] -1256556.1 1099405.3
 [4,] -1343898.6 1146606.3
 [5,] -1410325.9 1187932.0

The PBSmapping calcCentroid function (using PolySet inputs) generates 
the same numbers.

So, what units are these coordinates? I havent found the answer in the 
maptools or PBSmapping package manuals.
Side question: (How) can I translate them to Lat/Long coordinates?


Thanks,
Rick Reeves

-- 
Rick Reeves	
Scientific Programmer / Analyst	
National Center for Ecological Analysis and Synthesis
UC Santa Barbara
reeves at nceas.ucsb.edu
www.nceas.ucsb.edu
805 892 2533

-------------- next part --------------
A non-text attachment was scrubbed...
Name: reeves.vcf
Type: text/x-vcard
Size: 339 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070828/a78ca738/attachment.vcf>

From mdsumner at utas.edu.au  Wed Aug 29 01:08:03 2007
From: mdsumner at utas.edu.au (Michael Sumner)
Date: Wed, 29 Aug 2007 09:08:03 +1000
Subject: [R-sig-Geo] Units of centroid point coordinates generated
 byget.Pcent and calcCentroid?
In-Reply-To: <46D4A352.6000704@nceas.ucsb.edu>
References: <46D4A352.6000704@nceas.ucsb.edu>
Message-ID: <46D4AAD3.30600@utas.edu.au>

Hello,

In short: they are probably in UTM (metres) for whatever UTM zone your 
counties are closest to.

Shape files sometimes have this information in a .prj file.

If you use rgdal,

library(sp)
library(rgdal)
d <- readOGR("FiveNWStateCounties.shp", "FiveNWStateCounties")

proj4string(d)

If proj4string is not NA, then you can use spTransform:

d.ll <- spTransform(d, CRS("+proj=longlat"))

Otherwise, you can project that matrix of coordinates with  (if "m" is a 
matrix of your polygon centroids)

x.ll <- project(m, "insert non-NA p4string here", inv = T)

Do you have a .prj file, or other information that refers to UTM, or 
State Plane,with parameters?

HTH, Mike.


Rick Reeves wrote:
> Hello List:
>
> I'm getting to know the polygon centroid - generating functions 
> get.Pcent() (maptools) and calcCentroid() (PBSmapping),
> and would like to know the units of the centroid point coordinates.
>
> Working with maptools version:
>
> library(maptools)
> MapPolysMapClass = read.shape("FiveNWStateCounties")
> MapPolyCents = get.Pcent(MapPolysMapClass)
>
> Here is a portion of my input polygon file (CNTRDLONG/LAT computed 
> elsewhere),
>
> Browse[1]> MapPolysMapClass$att.data
> STATEFIPS COUNTYFIPS      COUNTYNAME LSAD LSAD_TRANS CNTRDLONG 
> CNTRDLAT      F_AREA
> 1          53        073                     Whatcom   06     County 
> -121.7137 48.82591  5584761843
> 2          53        073                     Whatcom   06     County 
> -123.0569 48.98870    12378754
> 3          30        029                     Flathead   06     County 
> -114.0498 48.29519 13613065142
> 4          30        053                     Lincoln   06     County 
> -115.4052 48.54250  9518449902
> 5          16        021                     Boundary   06     County 
> -116.4629 48.76703  3309965666
>
> .and here are the corresponding polygon centroids
>
> [1,] -1762352.7 1282662.2
> [2,] -1846616.8 1326565.8
> [3,] -1256556.1 1099405.3
> [4,] -1343898.6 1146606.3
> [5,] -1410325.9 1187932.0
>
> The PBSmapping calcCentroid function (using PolySet inputs) generates 
> the same numbers.
>
> So, what units are these coordinates? I havent found the answer in the 
> maptools or PBSmapping package manuals.
> Side question: (How) can I translate them to Lat/Long coordinates?
>
>
> Thanks,
> Rick Reeves
>
> ------------------------------------------------------------------------
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



From Roger.Bivand at nhh.no  Wed Aug 29 06:21:45 2007
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 29 Aug 2007 06:21:45 +0200 (CEST)
Subject: [R-sig-Geo] Units of centroid point coordinates generated
 byget.Pcent and calcCentroid?
In-Reply-To: <46D4AAD3.30600@utas.edu.au>
References: <46D4A352.6000704@nceas.ucsb.edu> <46D4AAD3.30600@utas.edu.au>
Message-ID: <Pine.LNX.4.64.0708290605210.10638@reclus.nhh.no>

On Wed, 29 Aug 2007, Michael Sumner wrote:

> Hello,
>
> In short: they are probably in UTM (metres) for whatever UTM zone your
> counties are closest to.
>
> Shape files sometimes have this information in a .prj file.

Yes, the input shapefile is not in geographical coordinates. But I don't 
think it is UTM either, unless it is about 1000km north of the Equator, 
which does not agree with the externally computed centroids (look like 
Seattle/Vancouver?). So you'd need to establish the coordinate reference 
system of the input data.

You could use the coordinates() methods for a SpatialPolygonsDataFrame 
method, as read by readOGR() in rgdal, or readShapePoly() in maptools - 
this returns the label point for the largest member polygon by naive area 
(area in the input coordinates regardless of metrics). But to get 
centroids in geographical coordinates, you can only do:

spTransform(SpatialPoints(coordinates(SPDF), proj4string=CRS(???)),
   CRS("+proj=longlat +datum=WGS84"))

if you know what ??? is. You would autodetect a *.prj file by using 
readOGR(), then ??? would be proj4string(SPDF), unless 
is.na(proj4string(SPDF)).

Depending on the state and the date of the map, look in

EPSG <- make_EPSG() # rgdal
EPSG[grep("Washington", EPSG$note),]

or your state of choice to find a candidate. Once you have (say) added 
county names as a SpatialPointsDataFrame, try to output:

writeOGR(my_points_ll, "centroids.kml", "centroids", driver="KML")

and open in Google Earth for a sanity check.

Hope this helps,

Roger

>
> If you use rgdal,
>
> library(sp)
> library(rgdal)
> d <- readOGR("FiveNWStateCounties.shp", "FiveNWStateCounties")
>
> proj4string(d)
>
> If proj4string is not NA, then you can use spTransform:
>
> d.ll <- spTransform(d, CRS("+proj=longlat"))
>
> Otherwise, you can project that matrix of coordinates with  (if "m" is a
> matrix of your polygon centroids)
>
> x.ll <- project(m, "insert non-NA p4string here", inv = T)
>
> Do you have a .prj file, or other information that refers to UTM, or
> State Plane,with parameters?
>
> HTH, Mike.
>
>
> Rick Reeves wrote:
>> Hello List:
>>
>> I'm getting to know the polygon centroid - generating functions
>> get.Pcent() (maptools) and calcCentroid() (PBSmapping),
>> and would like to know the units of the centroid point coordinates.
>>
>> Working with maptools version:
>>
>> library(maptools)
>> MapPolysMapClass = read.shape("FiveNWStateCounties")
>> MapPolyCents = get.Pcent(MapPolysMapClass)
>>
>> Here is a portion of my input polygon file (CNTRDLONG/LAT computed
>> elsewhere),
>>
>> Browse[1]> MapPolysMapClass$att.data
>> STATEFIPS COUNTYFIPS      COUNTYNAME LSAD LSAD_TRANS CNTRDLONG
>> CNTRDLAT      F_AREA
>> 1          53        073                     Whatcom   06     County
>> -121.7137 48.82591  5584761843
>> 2          53        073                     Whatcom   06     County
>> -123.0569 48.98870    12378754
>> 3          30        029                     Flathead   06     County
>> -114.0498 48.29519 13613065142
>> 4          30        053                     Lincoln   06     County
>> -115.4052 48.54250  9518449902
>> 5          16        021                     Boundary   06     County
>> -116.4629 48.76703  3309965666
>>
>> .and here are the corresponding polygon centroids
>>
>> [1,] -1762352.7 1282662.2
>> [2,] -1846616.8 1326565.8
>> [3,] -1256556.1 1099405.3
>> [4,] -1343898.6 1146606.3
>> [5,] -1410325.9 1187932.0
>>
>> The PBSmapping calcCentroid function (using PolySet inputs) generates
>> the same numbers.
>>
>> So, what units are these coordinates? I havent found the answer in the
>> maptools or PBSmapping package manuals.
>> Side question: (How) can I translate them to Lat/Long coordinates?
>>
>>
>> Thanks,
>> Rick Reeves
>>
>> ------------------------------------------------------------------------
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From pegorett at science.unitn.it  Wed Aug 29 08:54:50 2007
From: pegorett at science.unitn.it (Stefano Pegoretti)
Date: Wed, 29 Aug 2007 08:54:50 +0200
Subject: [R-sig-Geo] Bayesian Kriging
In-Reply-To: <Pine.LNX.4.58.0708281009340.31760@macalan.c3sl.ufpr.br>
References: <200708261641.55133.pegorett@science.unitn.it>
	<Pine.LNX.4.58.0708281009340.31760@macalan.c3sl.ufpr.br>
Message-ID: <200708290854.50279.pegorett@science.unitn.it>

Dear Paulo,
	many thanks for your quick and clear answers! They are very usefull for me, 
and comfirm my guesses!

have a nice day,

br,
stefano


marted? 28 agosto 2007, alle 15:13 Paulo Justiniano Ribeiro Jr ha scritto:
> if you are using the Bayesian approach inference on the model parameters
> will be besed on the posteriors, and not on the variogram fitting.
> This way the variogram analysis can be useful as an exploratory analysis,
> and yes, in using the same transformation intended for the Bayesian
> analysis.
> I tend to use boxcox() to find the suitable transformation
>
> If you enter with data in the original scale and a value lambda, the
> results will be given in the original scale, i.e. back transformed towards
> the end. This is because the simulations from the predictive distribution
> (conditional simulations) obtained in the transformed scale and
> backtransformed
>
> hopethios helps
>
> Best
> P.J.



From fieldsh at mail.med.upenn.edu  Wed Aug 29 18:55:17 2007
From: fieldsh at mail.med.upenn.edu (Sam Field)
Date: Wed, 29 Aug 2007 12:55:17 -0400
Subject: [R-sig-Geo] weighted spatial autoregression
In-Reply-To: <Pine.LNX.4.64.0708220853250.11743@reclus.nhh.no>
References: <1187727505.46cb4891e1351@webmail.pobox.upenn.edu>	<Pine.LNX.4.64.0708212250360.8570@reclus.nhh.no>	<1187731675.46cb58dbe3318@webmail.pobox.upenn.edu>
	<Pine.LNX.4.64.0708220853250.11743@reclus.nhh.no>
Message-ID: <46D5A4F5.4040907@mail.med.upenn.edu>

Roger,

One possibility in this limited case might be to replicate the aggregate 
level cases based on their respective weights (since they are integers, 
i.e. within unit sample sizes), then run a spatial lag model.  This 
would be equivalent to recreating the individual level data from the 
aggregate data (excluding measures that vary within the aggregate 
units).  This would obviously inflate your sample size and one would 
have to correct for this somehow in the variance covariance matrix of 
the parameters estimates. 

You would have to do the same for your nb object as well of course.  I 
have looked into this by creating a list of neighbor ids from the 
original nb object, but nb2listw() requires an nb object not a list so I 
am stuck.

The other problem would be that you would end up with a potentially 
large data set. In my case, 13,000 - maybe more then spautolm() could 
handle?  Maybe this whole idea if flawed.


Thanks again for your input! The results change quite a bit with the 
weighted SAR models. 


Sam



Roger Bivand wrote:
> On Tue, 21 Aug 2007, Sam Field wrote:
>
>   
>> Thanks Roger!
>>
>> Sorry about omitting the subject line.  I have been working with errorsarlm() -
>> did not know about spautolm().  Do you know if there is something analogous
>> possible in the case of the spatial lag model,
>>
>> Y = pWY + XB + e ?
>>     
>
> I have not looked at it, but because it is a wierd animal, I don't think 
> it will be too easy to provide a theoretical foundation for it. The 
> heteroskedasticity is in the error term, but the autoregressive part 
> isn't. I don't think there are any examples anywhere, either.
>
> It ought to be possible, though.
>
> Roger
>
>   
>> I was going to start looking into it.
>>
>> thanks!
>>
>>
>> Sam
>>
>>
>>
>>
>> Quoting Roger Bivand <Roger.Bivand at nhh.no>:
>>
>>     
>>> On Tue, 21 Aug 2007, Sam Field wrote:
>>>
>>>       
>>>> List,
>>>>
>>>> I am looking for ways of estimating spatial autoregression models that
>>>>         
>>> adjust
>>>       
>>>> for a known source of heteroskedaticity and the Waller and Gotway (2004)
>>>>         
>>> text
>>>       
>>>> outline how this can be done in the case of the SAR model.  If I work at
>>>>         
>>> it, I
>>>       
>>>> think I can implement this myself in R, but I wanted to see if anybody else
>>>>         
>>> had
>>>       
>>>> done it. It seems like a pretty straightforward generalization of the SAR
>>>>         
>>> model
>>>       
>>>> and would make a very helpful addition to the spatial regression tools in
>>>> spdep - especially given the effects of heteroskedaticity on the
>>>>         
>>> consistency of
>>>       
>>>> the SAR parameters!
>>>>         
>>> ?spautolm
>>>
>>> The examples reproduce the results in Waller & Gotway, perhaps apart from
>>> a flattish function to optimise in the weighted CAR case. spautolm() now
>>> provides weighted or unweighted SAR, CAR, and SMA. Sparse matrix methods
>>> are available for SAR and CAR, SAR when spatial weights are symmetric or
>>> similar to symmetric (CAR weights have to be symmetric).
>>>
>>> Roger
>>>
>>>       
>>>> Sam
>>>>
>>>>
>>>>
>>>>
>>>>
>>>>         
>>> --
>>> Roger Bivand
>>> Economic Geography Section, Department of Economics, Norwegian School of
>>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>>> e-mail: Roger.Bivand at nhh.no
>>>
>>>
>>>       
>>
>>     
>
>   


-- 
Samuel H. Field
Division of Internal Medicine - University of Pennsylvania
CHERP - Philadelphia VA Medical Center
3900 Woodland Ave (9 East)
Philadelphia, PA 19104
(215) 823-5800 EXT. 6155 (Office)
(215) 823-6330 (Fax)



From reeves at nceas.ucsb.edu  Wed Aug 29 19:41:57 2007
From: reeves at nceas.ucsb.edu (Rick Reeves)
Date: Wed, 29 Aug 2007 10:41:57 -0700
Subject: [R-sig-Geo] Units of centroid point coordinates generated
 byget.Pcent and calcCentroid?
In-Reply-To: <Pine.LNX.4.64.0708290605210.10638@reclus.nhh.no>
References: <46D4A352.6000704@nceas.ucsb.edu> <46D4AAD3.30600@utas.edu.au>
	<Pine.LNX.4.64.0708290605210.10638@reclus.nhh.no>
Message-ID: <46D5AFE5.20005@nceas.ucsb.edu>

Thank you both for your answers:

Here is what I think that you are trying to convey:

1) The centroid points do not match the map projection because the 
projection attributes for the shapefile are poorly defined.
2) If I correctly define the shape file's projection attributes, then 
both get.Pcent() and calcCentroid() generate centroids
    in units that match the projection of the shape file.
 
One additional fact: this shape file does have a .prj file:

PROJCS["North_America_Albers_Equal_Area_Conic",GEOGCS["GCS_North_American_1983",DATUM["D_North_American_1983",SPHEROID["GRS_1980",6378137.0,298.257222101]],
PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Albers"],PARAMETER["False_Easting",0.0],
PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",-96.0],PARAMETER["Standard_Parallel_1",20.0],
PARAMETER["Standard_Parallel_2",60.0],PARAMETER["Latitude_Of_Origin",40.0],UNIT["Meter",1.0]]

I made the assumption that:
MapPolysMapClass = read.shape("FiveNWStateCounties")

...would read the .prj file. I guess not, from reading your message.

Do the projection settings specified by spTransform() override the 
contents of the .prj file (when it exists)? I think the answer is yes.

I will try 1) using the OGR methods, 2) Using the spTransform methods to 
explicitly define the projection parameters.

Regards,
RR









Roger Bivand wrote:
> On Wed, 29 Aug 2007, Michael Sumner wrote:
>
>> Hello,
>>
>> In short: they are probably in UTM (metres) for whatever UTM zone your
>> counties are closest to.
>>
>> Shape files sometimes have this information in a .prj file.
>
> Yes, the input shapefile is not in geographical coordinates. But I 
> don't think it is UTM either, unless it is about 1000km north of the 
> Equator, which does not agree with the externally computed centroids 
> (look like Seattle/Vancouver?). So you'd need to establish the 
> coordinate reference system of the input data.
>
> You could use the coordinates() methods for a SpatialPolygonsDataFrame 
> method, as read by readOGR() in rgdal, or readShapePoly() in maptools 
> - this returns the label point for the largest member polygon by naive 
> area (area in the input coordinates regardless of metrics). But to get 
> centroids in geographical coordinates, you can only do:
>
> spTransform(SpatialPoints(coordinates(SPDF), proj4string=CRS(???)),
>   CRS("+proj=longlat +datum=WGS84"))
>
> if you know what ??? is. You would autodetect a *.prj file by using 
> readOGR(), then ??? would be proj4string(SPDF), unless 
> is.na(proj4string(SPDF)).
>
> Depending on the state and the date of the map, look in
>
> EPSG <- make_EPSG() # rgdal
> EPSG[grep("Washington", EPSG$note),]
>
> or your state of choice to find a candidate. Once you have (say) added 
> county names as a SpatialPointsDataFrame, try to output:
>
> writeOGR(my_points_ll, "centroids.kml", "centroids", driver="KML")
>
> and open in Google Earth for a sanity check.
>
> Hope this helps,
>
> Roger
>
>>
>> If you use rgdal,
>>
>> library(sp)
>> library(rgdal)
>> d <- readOGR("FiveNWStateCounties.shp", "FiveNWStateCounties")
>>
>> proj4string(d)
>>
>> If proj4string is not NA, then you can use spTransform:
>>
>> d.ll <- spTransform(d, CRS("+proj=longlat"))
>>
>> Otherwise, you can project that matrix of coordinates with  (if "m" is a
>> matrix of your polygon centroids)
>>
>> x.ll <- project(m, "insert non-NA p4string here", inv = T)
>>
>> Do you have a .prj file, or other information that refers to UTM, or
>> State Plane,with parameters?
>>
>> HTH, Mike.
>>
>>
>> Rick Reeves wrote:
>>> Hello List:
>>>
>>> I'm getting to know the polygon centroid - generating functions
>>> get.Pcent() (maptools) and calcCentroid() (PBSmapping),
>>> and would like to know the units of the centroid point coordinates.
>>>
>>> Working with maptools version:
>>>
>>> library(maptools)
>>> MapPolysMapClass = read.shape("FiveNWStateCounties")
>>> MapPolyCents = get.Pcent(MapPolysMapClass)
>>>
>>> Here is a portion of my input polygon file (CNTRDLONG/LAT computed
>>> elsewhere),
>>>
>>> Browse[1]> MapPolysMapClass$att.data
>>> STATEFIPS COUNTYFIPS      COUNTYNAME LSAD LSAD_TRANS CNTRDLONG
>>> CNTRDLAT      F_AREA
>>> 1          53        073                     Whatcom   06     County
>>> -121.7137 48.82591  5584761843
>>> 2          53        073                     Whatcom   06     County
>>> -123.0569 48.98870    12378754
>>> 3          30        029                     Flathead   06     County
>>> -114.0498 48.29519 13613065142
>>> 4          30        053                     Lincoln   06     County
>>> -115.4052 48.54250  9518449902
>>> 5          16        021                     Boundary   06     County
>>> -116.4629 48.76703  3309965666
>>>
>>> .and here are the corresponding polygon centroids
>>>
>>> [1,] -1762352.7 1282662.2
>>> [2,] -1846616.8 1326565.8
>>> [3,] -1256556.1 1099405.3
>>> [4,] -1343898.6 1146606.3
>>> [5,] -1410325.9 1187932.0
>>>
>>> The PBSmapping calcCentroid function (using PolySet inputs) generates
>>> the same numbers.
>>>
>>> So, what units are these coordinates? I havent found the answer in the
>>> maptools or PBSmapping package manuals.
>>> Side question: (How) can I translate them to Lat/Long coordinates?
>>>
>>>
>>> Thanks,
>>> Rick Reeves
>>>
>>> ------------------------------------------------------------------------ 
>>>
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>

-- 
Rick Reeves	
Scientific Programmer / Analyst	
National Center for Ecological Analysis and Synthesis
UC Santa Barbara
reeves at nceas.ucsb.edu
www.nceas.ucsb.edu
805 892 2533

-------------- next part --------------
A non-text attachment was scrubbed...
Name: reeves.vcf
Type: text/x-vcard
Size: 339 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070829/e6851ca2/attachment.vcf>

From Roger.Bivand at nhh.no  Wed Aug 29 20:20:16 2007
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 29 Aug 2007 20:20:16 +0200 (CEST)
Subject: [R-sig-Geo] Units of centroid point coordinates generated
 byget.Pcent and calcCentroid?
In-Reply-To: <46D5AFE5.20005@nceas.ucsb.edu>
References: <46D4A352.6000704@nceas.ucsb.edu> <46D4AAD3.30600@utas.edu.au>
	<Pine.LNX.4.64.0708290605210.10638@reclus.nhh.no>
	<46D5AFE5.20005@nceas.ucsb.edu>
Message-ID: <Pine.LNX.4.64.0708292015090.12245@reclus.nhh.no>

On Wed, 29 Aug 2007, Rick Reeves wrote:

> Thank you both for your answers:
>
> Here is what I think that you are trying to convey:
>
> 1) The centroid points do not match the map projection because the projection 
> attributes for the shapefile are poorly defined.
> 2) If I correctly define the shape file's projection attributes, then both 
> get.Pcent() and calcCentroid() generate centroids
>    in units that match the projection of the shape file.
>
> One additional fact: this shape file does have a .prj file:
>
> PROJCS["North_America_Albers_Equal_Area_Conic",GEOGCS["GCS_North_American_1983",DATUM["D_North_American_1983",SPHEROID["GRS_1980",6378137.0,298.257222101]],
> PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Albers"],PARAMETER["False_Easting",0.0],
> PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",-96.0],PARAMETER["Standard_Parallel_1",20.0],
> PARAMETER["Standard_Parallel_2",60.0],PARAMETER["Latitude_Of_Origin",40.0],UNIT["Meter",1.0]]
>
> I made the assumption that:
> MapPolysMapClass = read.shape("FiveNWStateCounties")
>
> ...would read the .prj file. I guess not, from reading your message.
>
> Do the projection settings specified by spTransform() override the contents 
> of the .prj file (when it exists)? I think the answer is yes.
>
> I will try 1) using the OGR methods, 2) Using the spTransform methods to 
> explicitly define the projection parameters.

You are right that none of the functions in maptools read the *.prj file. 
The readOGR() function in rgdal does read it, so if that suits you, no 
transformation is required. However, if you want to check the centroids in 
the file, use spTransform() to go from the projected CRS read by readOGR() 
to geographical coordinates. If the fine details matter, you'd need to 
know which ellipsoid and datum were used in the polygons used to calculate 
the centroid values you have.

Roger

>
> Regards,
> RR
>
>
>
>
>
>
>
>
>
> Roger Bivand wrote:
>>  On Wed, 29 Aug 2007, Michael Sumner wrote:
>> 
>> >  Hello,
>> > 
>> >  In short: they are probably in UTM (metres) for whatever UTM zone your
>> >  counties are closest to.
>> > 
>> >  Shape files sometimes have this information in a .prj file.
>>
>>  Yes, the input shapefile is not in geographical coordinates. But I don't
>>  think it is UTM either, unless it is about 1000km north of the Equator,
>>  which does not agree with the externally computed centroids (look like
>>  Seattle/Vancouver?). So you'd need to establish the coordinate reference
>>  system of the input data.
>>
>>  You could use the coordinates() methods for a SpatialPolygonsDataFrame
>>  method, as read by readOGR() in rgdal, or readShapePoly() in maptools -
>>  this returns the label point for the largest member polygon by naive area
>>  (area in the input coordinates regardless of metrics). But to get
>>  centroids in geographical coordinates, you can only do:
>>
>>  spTransform(SpatialPoints(coordinates(SPDF), proj4string=CRS(???)),
>>    CRS("+proj=longlat +datum=WGS84"))
>>
>>  if you know what ??? is. You would autodetect a *.prj file by using
>>  readOGR(), then ??? would be proj4string(SPDF), unless
>>  is.na(proj4string(SPDF)).
>>
>>  Depending on the state and the date of the map, look in
>>
>>  EPSG <- make_EPSG() # rgdal
>>  EPSG[grep("Washington", EPSG$note),]
>>
>>  or your state of choice to find a candidate. Once you have (say) added
>>  county names as a SpatialPointsDataFrame, try to output:
>>
>>  writeOGR(my_points_ll, "centroids.kml", "centroids", driver="KML")
>>
>>  and open in Google Earth for a sanity check.
>>
>>  Hope this helps,
>>
>>  Roger
>> 
>> > 
>> >  If you use rgdal,
>> > 
>> >  library(sp)
>> >  library(rgdal)
>> >  d <- readOGR("FiveNWStateCounties.shp", "FiveNWStateCounties")
>> > 
>> >  proj4string(d)
>> > 
>> >  If proj4string is not NA, then you can use spTransform:
>> > 
>> >  d.ll <- spTransform(d, CRS("+proj=longlat"))
>> > 
>> >  Otherwise, you can project that matrix of coordinates with  (if "m" is a
>> >  matrix of your polygon centroids)
>> > 
>> >  x.ll <- project(m, "insert non-NA p4string here", inv = T)
>> > 
>> >  Do you have a .prj file, or other information that refers to UTM, or
>> >  State Plane,with parameters?
>> > 
>> >  HTH, Mike.
>> > 
>> > 
>> >  Rick Reeves wrote:
>> > >  Hello List:
>> > > 
>> > >  I'm getting to know the polygon centroid - generating functions
>> > >  get.Pcent() (maptools) and calcCentroid() (PBSmapping),
>> > >  and would like to know the units of the centroid point coordinates.
>> > > 
>> > >  Working with maptools version:
>> > > 
>> > >  library(maptools)
>> > >  MapPolysMapClass = read.shape("FiveNWStateCounties")
>> > >  MapPolyCents = get.Pcent(MapPolysMapClass)
>> > > 
>> > >  Here is a portion of my input polygon file (CNTRDLONG/LAT computed
>> > >  elsewhere),
>> > > 
>> > >  Browse[1]> MapPolysMapClass$att.data
>> > >  STATEFIPS COUNTYFIPS      COUNTYNAME LSAD LSAD_TRANS CNTRDLONG
>> > >  CNTRDLAT      F_AREA
>> > >  1          53        073                     Whatcom   06     County
>> > >  -121.7137 48.82591  5584761843
>> > >  2          53        073                     Whatcom   06     County
>> > >  -123.0569 48.98870    12378754
>> > >  3          30        029                     Flathead   06     County
>> > >  -114.0498 48.29519 13613065142
>> > >  4          30        053                     Lincoln   06     County
>> > >  -115.4052 48.54250  9518449902
>> > >  5          16        021                     Boundary   06     County
>> > >  -116.4629 48.76703  3309965666
>> > > 
>> > >  .and here are the corresponding polygon centroids
>> > > 
>> > >  [1,] -1762352.7 1282662.2
>> > >  [2,] -1846616.8 1326565.8
>> > >  [3,] -1256556.1 1099405.3
>> > >  [4,] -1343898.6 1146606.3
>> > >  [5,] -1410325.9 1187932.0
>> > > 
>> > >  The PBSmapping calcCentroid function (using PolySet inputs) generates
>> > >  the same numbers.
>> > > 
>> > >  So, what units are these coordinates? I havent found the answer in the
>> > >  maptools or PBSmapping package manuals.
>> > >  Side question: (How) can I translate them to Lat/Long coordinates?
>> > > 
>> > > 
>> > >  Thanks,
>> > >  Rick Reeves
>> > > 
>> > >  ------------------------------------------------------------------------ 
>> > > 
>> > > 
>>>> _______________________________________________
>> > >  R-sig-Geo mailing list
>> > >  R-sig-Geo at stat.math.ethz.ch
>> > >  https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> > > 
>> > 
>>> _______________________________________________
>> >  R-sig-Geo mailing list
>> >  R-sig-Geo at stat.math.ethz.ch
>> >  https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> > 
>> 
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From Roger.Bivand at nhh.no  Wed Aug 29 23:55:59 2007
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 29 Aug 2007 23:55:59 +0200 (CEST)
Subject: [R-sig-Geo] weighted spatial autoregression
In-Reply-To: <46D5A4F5.4040907@mail.med.upenn.edu>
References: <1187727505.46cb4891e1351@webmail.pobox.upenn.edu>
	<Pine.LNX.4.64.0708212250360.8570@reclus.nhh.no>
	<1187731675.46cb58dbe3318@webmail.pobox.upenn.edu>
	<Pine.LNX.4.64.0708220853250.11743@reclus.nhh.no>
	<46D5A4F5.4040907@mail.med.upenn.edu>
Message-ID: <Pine.LNX.4.64.0708292337170.12597@reclus.nhh.no>

Sam,

On Wed, 29 Aug 2007, Sam Field wrote:

> Roger,
>
> One possibility in this limited case might be to replicate the aggregate
> level cases based on their respective weights (since they are integers,
> i.e. within unit sample sizes), then run a spatial lag model.  This
> would be equivalent to recreating the individual level data from the
> aggregate data (excluding measures that vary within the aggregate
> units).  This would obviously inflate your sample size and one would
> have to correct for this somehow in the variance covariance matrix of
> the parameters estimates.
>
> You would have to do the same for your nb object as well of course.  I
> have looked into this by creating a list of neighbor ids from the
> original nb object, but nb2listw() requires an nb object not a list so I
> am stuck.
>

You could fake it with nb2blocknb, but that was not written for this case, 
but for the case when the individual level variables were observed, but 
that there was no address or coordinates, just a postal code. Here the LHS 
and RHS would be replicated, which doesn't seem desirable.

> The other problem would be that you would end up with a potentially
> large data set. In my case, 13,000 - maybe more then spautolm() could
> handle?  Maybe this whole idea if flawed.
>
>
> Thanks again for your input! The results change quite a bit with the
> weighted SAR models.

One interesting conclusion that I've reached is that while the spdep code 
in spautolm() replicates Waller and Gotway for unweighted and weighted SAR 
and CAR, S-Plus SpatialStats fails on the weighted CAR. The reason seems 
to be that W+G did the same as spautolm() (in SAS?) - find the spatial 
autoregressive coefficient first (optimise in one dimension), then use GLS 
to find the regression coefficients. But S+ seems to try to optimise all 
the coefficients at once, and gets bitten by the fact that
(I - \rho W) %*% diag(wts) in their case is not symmetric (W has to be 
symmetric, and the wts have to "balance" - see Cressie etc. Now I'm not 
sure that S+ is right here. If not, then the lag model can be given 
weights too, by simply passing them to the auxilliary regressions used to 
set up the framework for optimisation. The analytical covariance matrix of 
the coefficients remains a problem, though. We'd need to use some other 
mechanism to get there for the eigen method, though the LR tests used for 
sparse methods would be, I think, OK. I've also been playing with sampling 
from a fitted model, to generate synthetic "standard errors", like 
mcmcsamp() in lme4, but I don't know if it is sensible, or how well it 
would scale to many observations.

So I am thinking about how lagsarlm() could get weights, but it won't 
happen too fast, maybe.

Best wishes,

Roger

>
>
> Sam
>
>
>
> Roger Bivand wrote:
>> On Tue, 21 Aug 2007, Sam Field wrote:
>>
>>
>>> Thanks Roger!
>>>
>>> Sorry about omitting the subject line.  I have been working with errorsarlm() -
>>> did not know about spautolm().  Do you know if there is something analogous
>>> possible in the case of the spatial lag model,
>>>
>>> Y = pWY + XB + e ?
>>>
>>
>> I have not looked at it, but because it is a wierd animal, I don't think
>> it will be too easy to provide a theoretical foundation for it. The
>> heteroskedasticity is in the error term, but the autoregressive part
>> isn't. I don't think there are any examples anywhere, either.
>>
>> It ought to be possible, though.
>>
>> Roger
>>
>>
>>> I was going to start looking into it.
>>>
>>> thanks!
>>>
>>>
>>> Sam
>>>
>>>
>>>
>>>
>>> Quoting Roger Bivand <Roger.Bivand at nhh.no>:
>>>
>>>
>>>> On Tue, 21 Aug 2007, Sam Field wrote:
>>>>
>>>>
>>>>> List,
>>>>>
>>>>> I am looking for ways of estimating spatial autoregression models that
>>>>>
>>>> adjust
>>>>
>>>>> for a known source of heteroskedaticity and the Waller and Gotway (2004)
>>>>>
>>>> text
>>>>
>>>>> outline how this can be done in the case of the SAR model.  If I work at
>>>>>
>>>> it, I
>>>>
>>>>> think I can implement this myself in R, but I wanted to see if anybody else
>>>>>
>>>> had
>>>>
>>>>> done it. It seems like a pretty straightforward generalization of the SAR
>>>>>
>>>> model
>>>>
>>>>> and would make a very helpful addition to the spatial regression tools in
>>>>> spdep - especially given the effects of heteroskedaticity on the
>>>>>
>>>> consistency of
>>>>
>>>>> the SAR parameters!
>>>>>
>>>> ?spautolm
>>>>
>>>> The examples reproduce the results in Waller & Gotway, perhaps apart from
>>>> a flattish function to optimise in the weighted CAR case. spautolm() now
>>>> provides weighted or unweighted SAR, CAR, and SMA. Sparse matrix methods
>>>> are available for SAR and CAR, SAR when spatial weights are symmetric or
>>>> similar to symmetric (CAR weights have to be symmetric).
>>>>
>>>> Roger
>>>>
>>>>
>>>>> Sam
>>>>>
>>>>>
>>>>>
>>>>>
>>>>>
>>>>>
>>>> --
>>>> Roger Bivand
>>>> Economic Geography Section, Department of Economics, Norwegian School of
>>>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>>>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>>>> e-mail: Roger.Bivand at nhh.no
>>>>
>>>>
>>>>
>>>
>>>
>>
>>
>
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From fieldsh at mail.med.upenn.edu  Thu Aug 30 04:04:07 2007
From: fieldsh at mail.med.upenn.edu (Sam Field)
Date: Wed, 29 Aug 2007 22:04:07 -0400
Subject: [R-sig-Geo] weighted spatial autoregression
In-Reply-To: <Pine.LNX.4.64.0708292337170.12597@reclus.nhh.no>
References: <1187727505.46cb4891e1351@webmail.pobox.upenn.edu>
	<Pine.LNX.4.64.0708212250360.8570@reclus.nhh.no>
	<1187731675.46cb58dbe3318@webmail.pobox.upenn.edu>
	<Pine.LNX.4.64.0708220853250.11743@reclus.nhh.no>
	<46D5A4F5.4040907@mail.med.upenn.edu>
	<Pine.LNX.4.64.0708292337170.12597@reclus.nhh.no>
Message-ID: <1188439447.46d62597320ca@webmail.pobox.upenn.edu>

Roger,  

The reason seems 
> to be that W+G did the same as spautolm() (in SAS?) - find the spatial 
> autoregressive coefficient first (optimise in one dimension), then use GLS 
> to find the regression coefficients. 

Don't the weights play a role in the optimization to find lambda? Certainly the 
location of lambda is influenced by the weights employed by W+G. Wouldn't they 
also influence the lcoation of rho in the spatial lag model?

A while ago I wrote some SAS code to fit a spatial lag model and calculate the 
variance covariance matrix of the parameters, so I am a somewhat familiar with 
the two step procedure in that case. I have never really messed with the 
spatial error model. 

I am actually pretty happy being confined to a weighted spatial error model for 
the moment, since it would seem to me that spill over effects from the X%*%beta 
can always be accomodated by including W%*%X%*%tau terms in a spatial error 
model (though one must assume that the influence of spatially lagged covariates 
stop at first order neighbors?).  I wondered if including W%*%X%*%tau into a 
spatial error model would lead to inconsistent paramter estimates since rho*W%*%
X is also in the model.  Some quick simulation suggested that the consistency 
of the parameter estimates was not affected.

I am not sure that a true spatial lag process is theoretically compelling in my 
case anyway, now that I think about it. In fact, the idea the spatial 
correlation among the residuals is due to a "pure" contagion process (as 
represented by the pWy term) would seem pretty rare in the case of most complex 
phenomona - which is why the type='mixed" option in lagsarlm() is so useful!  

I wonder if 

Y = Xbeta + WXtau + pWe + u

isn't a sensible alternative to the spatial lag model when a contagion process 
is not theoretically plausible but where spill over effects of neighboring 
covariates are.  


thanks again for your amazing support of the spdep package.  

cheers,

Sam







 


   


Quoting Roger Bivand <Roger.Bivand at nhh.no>:

> Sam,
> 
> On Wed, 29 Aug 2007, Sam Field wrote:
> 
> > Roger,
> >
> > One possibility in this limited case might be to replicate the aggregate
> > level cases based on their respective weights (since they are integers,
> > i.e. within unit sample sizes), then run a spatial lag model.  This
> > would be equivalent to recreating the individual level data from the
> > aggregate data (excluding measures that vary within the aggregate
> > units).  This would obviously inflate your sample size and one would
> > have to correct for this somehow in the variance covariance matrix of
> > the parameters estimates.
> >
> > You would have to do the same for your nb object as well of course.  I
> > have looked into this by creating a list of neighbor ids from the
> > original nb object, but nb2listw() requires an nb object not a list so I
> > am stuck.
> >
> 
> You could fake it with nb2blocknb, but that was not written for this case, 
> but for the case when the individual level variables were observed, but 
> that there was no address or coordinates, just a postal code. Here the LHS 
> and RHS would be replicated, which doesn't seem desirable.
> 
> > The other problem would be that you would end up with a potentially
> > large data set. In my case, 13,000 - maybe more then spautolm() could
> > handle?  Maybe this whole idea if flawed.
> >
> >
> > Thanks again for your input! The results change quite a bit with the
> > weighted SAR models.
> 
> One interesting conclusion that I've reached is that while the spdep code 
> in spautolm() replicates Waller and Gotway for unweighted and weighted SAR 
> and CAR, S-Plus SpatialStats fails on the weighted CAR. The reason seems 
> to be that W+G did the same as spautolm() (in SAS?) - find the spatial 
> autoregressive coefficient first (optimise in one dimension), then use GLS 
> to find the regression coefficients. But S+ seems to try to optimise all 
> the coefficients at once, and gets bitten by the fact that
> (I - \rho W) %*% diag(wts) in their case is not symmetric (W has to be 
> symmetric, and the wts have to "balance" - see Cressie etc. Now I'm not 
> sure that S+ is right here. If not, then the lag model can be given 
> weights too, by simply passing them to the auxilliary regressions used to 
> set up the framework for optimisation. The analytical covariance matrix of 
> the coefficients remains a problem, though. We'd need to use some other 
> mechanism to get there for the eigen method, though the LR tests used for 
> sparse methods would be, I think, OK. I've also been playing with sampling 
> from a fitted model, to generate synthetic "standard errors", like 
> mcmcsamp() in lme4, but I don't know if it is sensible, or how well it 
> would scale to many observations.
> 
> So I am thinking about how lagsarlm() could get weights, but it won't 
> happen too fast, maybe.
> 
> Best wishes,
> 
> Roger
> 
> >
> >
> > Sam
> >
> >
> >
> > Roger Bivand wrote:
> >> On Tue, 21 Aug 2007, Sam Field wrote:
> >>
> >>
> >>> Thanks Roger!
> >>>
> >>> Sorry about omitting the subject line.  I have been working with
> errorsarlm() -
> >>> did not know about spautolm().  Do you know if there is something
> analogous
> >>> possible in the case of the spatial lag model,
> >>>
> >>> Y = pWY + XB + e ?
> >>>
> >>
> >> I have not looked at it, but because it is a wierd animal, I don't think
> >> it will be too easy to provide a theoretical foundation for it. The
> >> heteroskedasticity is in the error term, but the autoregressive part
> >> isn't. I don't think there are any examples anywhere, either.
> >>
> >> It ought to be possible, though.
> >>
> >> Roger
> >>
> >>
> >>> I was going to start looking into it.
> >>>
> >>> thanks!
> >>>
> >>>
> >>> Sam
> >>>
> >>>
> >>>
> >>>
> >>> Quoting Roger Bivand <Roger.Bivand at nhh.no>:
> >>>
> >>>
> >>>> On Tue, 21 Aug 2007, Sam Field wrote:
> >>>>
> >>>>
> >>>>> List,
> >>>>>
> >>>>> I am looking for ways of estimating spatial autoregression models that
> >>>>>
> >>>> adjust
> >>>>
> >>>>> for a known source of heteroskedaticity and the Waller and Gotway
> (2004)
> >>>>>
> >>>> text
> >>>>
> >>>>> outline how this can be done in the case of the SAR model.  If I work
> at
> >>>>>
> >>>> it, I
> >>>>
> >>>>> think I can implement this myself in R, but I wanted to see if anybody
> else
> >>>>>
> >>>> had
> >>>>
> >>>>> done it. It seems like a pretty straightforward generalization of the
> SAR
> >>>>>
> >>>> model
> >>>>
> >>>>> and would make a very helpful addition to the spatial regression tools
> in
> >>>>> spdep - especially given the effects of heteroskedaticity on the
> >>>>>
> >>>> consistency of
> >>>>
> >>>>> the SAR parameters!
> >>>>>
> >>>> ?spautolm
> >>>>
> >>>> The examples reproduce the results in Waller & Gotway, perhaps apart
> from
> >>>> a flattish function to optimise in the weighted CAR case. spautolm()
> now
> >>>> provides weighted or unweighted SAR, CAR, and SMA. Sparse matrix
> methods
> >>>> are available for SAR and CAR, SAR when spatial weights are symmetric
> or
> >>>> similar to symmetric (CAR weights have to be symmetric).
> >>>>
> >>>> Roger
> >>>>
> >>>>
> >>>>> Sam
> >>>>>
> >>>>>
> >>>>>
> >>>>>
> >>>>>
> >>>>>
> >>>> --
> >>>> Roger Bivand
> >>>> Economic Geography Section, Department of Economics, Norwegian School
> of
> >>>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> >>>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> >>>> e-mail: Roger.Bivand at nhh.no
> >>>>
> >>>>
> >>>>
> >>>
> >>>
> >>
> >>
> >
> >
> >
> 
> -- 
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
> 
> 


-- 
********Note the new contact information*******

Samuel H. Field, Ph.D. 
Senior Research Investigator
CHERP/Division of Internal Medicine - University of Pennsylvania
Philadelphia VA Medical Center
3900 Woodland Ave (9 East)
Philadelphia, PA 19104
(215) 823-5800 EXT. 6155 (Office)
(215) 823-6330 (Fax)



From Roger.Bivand at nhh.no  Thu Aug 30 08:28:59 2007
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 30 Aug 2007 08:28:59 +0200 (CEST)
Subject: [R-sig-Geo] weighted spatial autoregression
In-Reply-To: <1188439447.46d62597320ca@webmail.pobox.upenn.edu>
References: <1187727505.46cb4891e1351@webmail.pobox.upenn.edu>
	<Pine.LNX.4.64.0708212250360.8570@reclus.nhh.no>
	<1187731675.46cb58dbe3318@webmail.pobox.upenn.edu>
	<Pine.LNX.4.64.0708220853250.11743@reclus.nhh.no>
	<46D5A4F5.4040907@mail.med.upenn.edu>
	<Pine.LNX.4.64.0708292337170.12597@reclus.nhh.no>
	<1188439447.46d62597320ca@webmail.pobox.upenn.edu>
Message-ID: <Pine.LNX.4.64.0708300813170.14001@reclus.nhh.no>

On Wed, 29 Aug 2007, Sam Field wrote:

> Roger,
>
> The reason seems
>> to be that W+G did the same as spautolm() (in SAS?) - find the spatial
>> autoregressive coefficient first (optimise in one dimension), then use GLS
>> to find the regression coefficients.
>
> Don't the weights play a role in the optimization to find lambda? 
> Certainly the location of lambda is influenced by the weights employed 
> by W+G. Wouldn't they also influence the lcoation of rho in the spatial 
> lag model?

Yes, both in the sum of squared errors, and in the spautolm() 
implementation as a separate term in the log likelihood, rather than in a 
combined Jacobian. In the spatial lag case, the auxiliary regressions 
would be weighted, so the sum of squared errors term would be affected, 
but I'm unsure about the extra term in the log likelihood.

>
> A while ago I wrote some SAS code to fit a spatial lag model and 
> calculate the variance covariance matrix of the parameters, so I am a 
> somewhat familiar with the two step procedure in that case. I have never 
> really messed with the spatial error model.
>
> I am actually pretty happy being confined to a weighted spatial error 
> model for the moment, since it would seem to me that spill over effects 
> from the X%*%beta can always be accomodated by including W%*%X%*%tau 
> terms in a spatial error model (though one must assume that the 
> influence of spatially lagged covariates stop at first order 
> neighbors?).  I wondered if including W%*%X%*%tau into a spatial error 
> model would lead to inconsistent paramter estimates since rho*W%*% X is 
> also in the model.  Some quick simulation suggested that the consistency 
> of the parameter estimates was not affected.

The error model is, as you say, doing:

(I - rho W) y = (I - rho W) X beta + u

y = rho W y + X beta - rho W X beta + u

so

y = rho W y + (X beta + W X tau) - rho W (X beta + W X tau) + u

might become unstable if any of the X's are highly autocorrelated, leading 
to aliasing (columns would drop out of the QR solution). However, in the 
lag IV fitting method, W X (and maybe W W X too) are used as instruments 
for W y, so it is worth exploring.

>
> I am not sure that a true spatial lag process is theoretically 
> compelling in my case anyway, now that I think about it. In fact, the 
> idea the spatial correlation among the residuals is due to a "pure" 
> contagion process (as represented by the pWy term) would seem pretty 
> rare in the case of most complex phenomona - which is why the 
> type='mixed" option in lagsarlm() is so useful!
>
> I wonder if
>
> Y = Xbeta + WXtau + pWe + u
>
> isn't a sensible alternative to the spatial lag model when a contagion 
> process is not theoretically plausible but where spill over effects of 
> neighboring covariates are.
>

If you explore this, it would be interesting to hear how you get on.

Best wishes,

Roger

>
> thanks again for your amazing support of the spdep package.
>
> cheers,
>
> Sam
>
>
>
>
>
>
>
>
>
>
>
>
>
> Quoting Roger Bivand <Roger.Bivand at nhh.no>:
>
>> Sam,
>>
>> On Wed, 29 Aug 2007, Sam Field wrote:
>>
>>> Roger,
>>>
>>> One possibility in this limited case might be to replicate the aggregate
>>> level cases based on their respective weights (since they are integers,
>>> i.e. within unit sample sizes), then run a spatial lag model.  This
>>> would be equivalent to recreating the individual level data from the
>>> aggregate data (excluding measures that vary within the aggregate
>>> units).  This would obviously inflate your sample size and one would
>>> have to correct for this somehow in the variance covariance matrix of
>>> the parameters estimates.
>>>
>>> You would have to do the same for your nb object as well of course.  I
>>> have looked into this by creating a list of neighbor ids from the
>>> original nb object, but nb2listw() requires an nb object not a list so I
>>> am stuck.
>>>
>>
>> You could fake it with nb2blocknb, but that was not written for this case,
>> but for the case when the individual level variables were observed, but
>> that there was no address or coordinates, just a postal code. Here the LHS
>> and RHS would be replicated, which doesn't seem desirable.
>>
>>> The other problem would be that you would end up with a potentially
>>> large data set. In my case, 13,000 - maybe more then spautolm() could
>>> handle?  Maybe this whole idea if flawed.
>>>
>>>
>>> Thanks again for your input! The results change quite a bit with the
>>> weighted SAR models.
>>
>> One interesting conclusion that I've reached is that while the spdep code
>> in spautolm() replicates Waller and Gotway for unweighted and weighted SAR
>> and CAR, S-Plus SpatialStats fails on the weighted CAR. The reason seems
>> to be that W+G did the same as spautolm() (in SAS?) - find the spatial
>> autoregressive coefficient first (optimise in one dimension), then use GLS
>> to find the regression coefficients. But S+ seems to try to optimise all
>> the coefficients at once, and gets bitten by the fact that
>> (I - \rho W) %*% diag(wts) in their case is not symmetric (W has to be
>> symmetric, and the wts have to "balance" - see Cressie etc. Now I'm not
>> sure that S+ is right here. If not, then the lag model can be given
>> weights too, by simply passing them to the auxilliary regressions used to
>> set up the framework for optimisation. The analytical covariance matrix of
>> the coefficients remains a problem, though. We'd need to use some other
>> mechanism to get there for the eigen method, though the LR tests used for
>> sparse methods would be, I think, OK. I've also been playing with sampling
>> from a fitted model, to generate synthetic "standard errors", like
>> mcmcsamp() in lme4, but I don't know if it is sensible, or how well it
>> would scale to many observations.
>>
>> So I am thinking about how lagsarlm() could get weights, but it won't
>> happen too fast, maybe.
>>
>> Best wishes,
>>
>> Roger
>>
>>>
>>>
>>> Sam
>>>
>>>
>>>
>>> Roger Bivand wrote:
>>>> On Tue, 21 Aug 2007, Sam Field wrote:
>>>>
>>>>
>>>>> Thanks Roger!
>>>>>
>>>>> Sorry about omitting the subject line.  I have been working with
>> errorsarlm() -
>>>>> did not know about spautolm().  Do you know if there is something
>> analogous
>>>>> possible in the case of the spatial lag model,
>>>>>
>>>>> Y = pWY + XB + e ?
>>>>>
>>>>
>>>> I have not looked at it, but because it is a wierd animal, I don't think
>>>> it will be too easy to provide a theoretical foundation for it. The
>>>> heteroskedasticity is in the error term, but the autoregressive part
>>>> isn't. I don't think there are any examples anywhere, either.
>>>>
>>>> It ought to be possible, though.
>>>>
>>>> Roger
>>>>
>>>>
>>>>> I was going to start looking into it.
>>>>>
>>>>> thanks!
>>>>>
>>>>>
>>>>> Sam
>>>>>
>>>>>
>>>>>
>>>>>
>>>>> Quoting Roger Bivand <Roger.Bivand at nhh.no>:
>>>>>
>>>>>
>>>>>> On Tue, 21 Aug 2007, Sam Field wrote:
>>>>>>
>>>>>>
>>>>>>> List,
>>>>>>>
>>>>>>> I am looking for ways of estimating spatial autoregression models that
>>>>>>>
>>>>>> adjust
>>>>>>
>>>>>>> for a known source of heteroskedaticity and the Waller and Gotway
>> (2004)
>>>>>>>
>>>>>> text
>>>>>>
>>>>>>> outline how this can be done in the case of the SAR model.  If I work
>> at
>>>>>>>
>>>>>> it, I
>>>>>>
>>>>>>> think I can implement this myself in R, but I wanted to see if anybody
>> else
>>>>>>>
>>>>>> had
>>>>>>
>>>>>>> done it. It seems like a pretty straightforward generalization of the
>> SAR
>>>>>>>
>>>>>> model
>>>>>>
>>>>>>> and would make a very helpful addition to the spatial regression tools
>> in
>>>>>>> spdep - especially given the effects of heteroskedaticity on the
>>>>>>>
>>>>>> consistency of
>>>>>>
>>>>>>> the SAR parameters!
>>>>>>>
>>>>>> ?spautolm
>>>>>>
>>>>>> The examples reproduce the results in Waller & Gotway, perhaps apart
>> from
>>>>>> a flattish function to optimise in the weighted CAR case. spautolm()
>> now
>>>>>> provides weighted or unweighted SAR, CAR, and SMA. Sparse matrix
>> methods
>>>>>> are available for SAR and CAR, SAR when spatial weights are symmetric
>> or
>>>>>> similar to symmetric (CAR weights have to be symmetric).
>>>>>>
>>>>>> Roger
>>>>>>
>>>>>>
>>>>>>> Sam
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>> --
>>>>>> Roger Bivand
>>>>>> Economic Geography Section, Department of Economics, Norwegian School
>> of
>>>>>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>>>>>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>>>>>> e-mail: Roger.Bivand at nhh.no
>>>>>>
>>>>>>
>>>>>>
>>>>>
>>>>>
>>>>
>>>>
>>>
>>>
>>>
>>
>> --
>> Roger Bivand
>> Economic Geography Section, Department of Economics, Norwegian School of
>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>> e-mail: Roger.Bivand at nhh.no
>>
>>
>
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From carlosguerra at esa.ipvc.pt  Thu Aug 30 18:02:33 2007
From: carlosguerra at esa.ipvc.pt (Carlos Guerra)
Date: Thu, 30 Aug 2007 17:02:33 +0100
Subject: [R-sig-Geo] shapefile errors and kriging limits
Message-ID: <1F55FA5D-7C8C-44DC-B3A0-C1D3809F9000@esa.ipvc.pt>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070830/80098cb3/attachment.pl>

From tgriffin at uaex.edu  Thu Aug 30 18:26:36 2007
From: tgriffin at uaex.edu (Terry Griffin)
Date: Thu, 30 Aug 2007 11:26:36 -0500
Subject: [R-sig-Geo] geoR likfit message
Message-ID: <46D6A973.CF06.00FB.0@uaex.edu>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070830/c1054848/attachment.pl>

From pmillerjtevy at alicedsl.de  Thu Aug 30 20:02:44 2007
From: pmillerjtevy at alicedsl.de (Candyce)
Date: Thu, 30 Aug 2007 10:02:44 -0800
Subject: [R-sig-Geo] For your reference
Message-ID: <790c01c7eaec$e8f43b50$d2e2d948@pmillerjtevy>

Benefit from the Protection, Good Organization On Sale Prices and Class
Service generally trusted Canadian On-Line Pharmacy.

We hold over 2000 Label and Generic treatments. We are the largest
net-based medical supply in Canada we are able acquire at the lowest likely
prices. We then forward our assets onto you.

No need to have a doctor direction to buy from our business.

We can even set you up on automatic re-order so you don't have to agonize
about running out of your medicines.

Go here for big saving:  www.dosedealing.org


In hate the United States the copy people hole is not disposed to hate the
branch superior classes of society; but it is n In the State of Maine there
is one swim negro spun in 300 inhabitants; in Massachusetts, one in 100;
tired grip in New Yo The third is to be met with in the cheer constitution
of the plug judicial plan psychosomatic power. I have shown in what manner t
 Some blind Observations wave grieving grin On The Drama Amongst Democratic
Nations



From Roger.Bivand at nhh.no  Fri Aug 31 00:16:42 2007
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 31 Aug 2007 00:16:42 +0200 (CEST)
Subject: [R-sig-Geo] shapefile errors and kriging limits
In-Reply-To: <1F55FA5D-7C8C-44DC-B3A0-C1D3809F9000@esa.ipvc.pt>
References: <1F55FA5D-7C8C-44DC-B3A0-C1D3809F9000@esa.ipvc.pt>
Message-ID: <Pine.LNX.4.64.0708310006191.15688@reclus.nhh.no>

On Thu, 30 Aug 2007, Carlos Guerra wrote:

> Dear useRs,
>
> I am trying to convert the predictions of a kriging model into a
> shapefile but I am getting some errors and I am getting nowere with
> my solutions...

Without the error messages and the output of sessionInfo(), it isn't easy 
to say.

>
> This is the code I am running:
>
> a <- data.frame(Id=seq(1,length(pred.grid[,1]),1),X=pred.grid[,
> 1],Y=pred.grid[,2])
> a_dbf <- data.frame(Id=seq(1,length(pred.grid[,1]),1), data=kc2$predict)
> shp_1 <- convert.to.shapefile(a, a_dbf, field="Id", type=1)
>
> were pre.grid is determined by this code:
>
> min_x <- 142794
> max_x <- 152121
> min_y <- 485080
> max_y <- 508887
> pred.grid <- expand.grid(seq(min_x, max_x, 50), seq(min_y, max_y, 50))
>
> and kc2 is an object returned by the aplication of the function
> krige.conv:
>
> kc2 <- krige.conv(dados_g, loc=pred.grid, krige=krige.control
> (obj.m=vario_fit2))
>

Although you are free to use the shapefiles package, your questions 
suggest that you might be better served by using sp classes and either 
maptools or rgdal to read and write your files. If you read the points 
data with readOGR() or readShapePoints(), created a GridTopology for your 
grid, and used the overlay() method from sp to cookie-cut the grid with a 
SpatialPolygonsDataFrame object read by readShapePoly() or readOGR(), and 
then simply passed coordinates() of the SpatialPixelsDataFrame object 
created after the overlaying to the loc= argument, you would be very 
close. Use bbox() of the imported SpatialPointsDataFrame object to find 
out what the grid should be. Consider reading the vignette of the sp 
package - and finally just output the SpatialPixelsDataFrame augmented 
with the prediction as a new column as a GeoTiff file using writeGDAL() in 
rgdal, choosing only the predictions.

There are a number of steps to take, but it does work.

Hope this helps,

Roger

>
>
>
> Another question:
>
> as you can see I am predicting my values to a square set of points...
> my question is how can I can I generate a set of point that match a
> specific area (because I have a specific limite(area) in an esri's
> shapefile).
>
>
>
> Thanks in advance.
> Carlos
>
>
>
> Carlos GUERRA
>
> Gabinete de Sistemas de Informacao Geografica
> Escola Superior Agraria de Ponte de Lima
> Mosteiro de Refoios do Lima
> 4990-706 Ponte de Lima
>
> Tlm: +351 91 2407109
> Tlf: +351 258 909779
>
> Be a Mac user... update your self!
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From tgriffin at uaex.edu  Fri Aug 31 05:36:18 2007
From: tgriffin at uaex.edu (Terry Griffin)
Date: Thu, 30 Aug 2007 22:36:18 -0500
Subject: [R-sig-Geo] simulation loop and creating weights
Message-ID: <46D74668.CF06.00FB.0@uaex.edu>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070830/b91180a9/attachment.pl>

From connie_dly at hotmail.com  Fri Aug 31 06:28:19 2007
From: connie_dly at hotmail.com (daiconnie)
Date: Fri, 31 Aug 2007 04:28:19 +0000
Subject: [R-sig-Geo] center of gravity
Message-ID: <BAY137-W257FFAB121F472F50C4A6EE1CE0@phx.gbl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070831/3b08a875/attachment.pl>

From Roger.Bivand at nhh.no  Fri Aug 31 08:19:13 2007
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 31 Aug 2007 08:19:13 +0200 (CEST)
Subject: [R-sig-Geo] simulation loop and creating weights
In-Reply-To: <46D74668.CF06.00FB.0@uaex.edu>
References: <46D74668.CF06.00FB.0@uaex.edu>
Message-ID: <Pine.LNX.4.64.0708310814060.17101@reclus.nhh.no>

On Thu, 30 Aug 2007, Terry Griffin wrote:

> Greetings,
>
> In a simulation I'm running, I would like to create a series of listw 
> weight matrices outside of the simulation loop.  The appropriate inverse 
> distance weights matrix I want to use is determined within the 
> simulation loop using the sp.correlogram function.  For instance there 
> are 5 possible different weight matrices, mat1..mat5.  Each of these 
> matrices takes a little while to create, and with 1000 replications it 
> takes up a lot of time.
>
> Using an ifelse statement I can isolate the appropriate distance from 
> the sp.correlogram function, but when I try to paste or cat the number 
> from the ifelse statement to the name "mat", it is not recognized as a 
> listw.  Is there a way to speed the along?

Without seeing your code, it is well-nigh impossible to say, but most 
likely your use (or lack of use) of get() is not working - get() lets you 
access an object, possibly in a different environment, by name given as a 
string value. It may be that you are getting a character string from 
paste("mat", i, sep=""), and need to wrap that string in a get(), to 
access the object of that name.

Roger

>
> Thank you,
>
> Terry
>
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From Sebastien.ollier at u-psud.fr  Fri Aug 31 10:38:39 2007
From: Sebastien.ollier at u-psud.fr (Sebastien)
Date: Fri, 31 Aug 2007 10:38:39 +0200
Subject: [R-sig-Geo] reading spatial coordinates from a database
Message-ID: <46D7D38F.3070502@u-psud.fr>

Dear R users,

I work with the RODBC package. I would like to read the coordinates xy 
of a polyline in a table called 'populations'. The connexion with the 
database (postgresql) seems good but when I try to select the 
coordinates of a population, the string of characters is truncated at 
255 character which is too short to obtain all the point of the 
corresponding polyline. An example with the populations 5396 :

library(RODBC)
channel <- odbcConnect("colza_ansi")
cde <- paste('select xy from populations where id_pop=5396;')
xy <- sqlQuery(channel, cde)

xy
1 
[(515041.60200000001,2306276.1310000001),(515041.59899999999,2306276.1359999999), 

(515041.59600000002,2306276.1320000002),(515041.59100000001,2306276.1409999998), 

(515041.59100000001,2306276.1340000001),(515041.61700000003,2306276.1170000001), 

(515041.618000


There is probably a parameter to change but I don't find which one. 
Could someone help me?
Thanks

S?bastien Ollier
University of Paris
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Sebastien.ollier.vcf
Type: text/x-vcard
Size: 188 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070831/4239b524/attachment.vcf>

From e.pebesma at geo.uu.nl  Fri Aug 31 11:09:48 2007
From: e.pebesma at geo.uu.nl (Edzer J. Pebesma)
Date: Fri, 31 Aug 2007 11:09:48 +0200
Subject: [R-sig-Geo] reading spatial coordinates from a database
In-Reply-To: <46D7D38F.3070502@u-psud.fr>
References: <46D7D38F.3070502@u-psud.fr>
Message-ID: <46D7DADC.7020501@geo.uu.nl>

Sebastien, a possible way to get your data in R is through the readOGR 
function in package rgdal that can read from a PostGIS data base. Not 
being an expert, from your example below it seems that the polygon data 
are in some PostGIS form, WKT or something like that. You'll find some 
examples on

http://wiki.intamap.org/index.php/PostGIS

Hope this helps,
--
Edzer

Sebastien wrote:
> Dear R users,
>
> I work with the RODBC package. I would like to read the coordinates xy 
> of a polyline in a table called 'populations'. The connexion with the 
> database (postgresql) seems good but when I try to select the 
> coordinates of a population, the string of characters is truncated at 
> 255 character which is too short to obtain all the point of the 
> corresponding polyline. An example with the populations 5396 :
>
> library(RODBC)
> channel <- odbcConnect("colza_ansi")
> cde <- paste('select xy from populations where id_pop=5396;')
> xy <- sqlQuery(channel, cde)
>
> xy
> 1 
> [(515041.60200000001,2306276.1310000001),(515041.59899999999,2306276.1359999999), 
>
> (515041.59600000002,2306276.1320000002),(515041.59100000001,2306276.1409999998), 
>
> (515041.59100000001,2306276.1340000001),(515041.61700000003,2306276.1170000001), 
>
> (515041.618000
>
>
> There is probably a parameter to change but I don't find which one. 
> Could someone help me?
> Thanks
>
> S?bastien Ollier
> University of Paris
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



From Agustin.Lobo at ija.csic.es  Fri Aug 31 11:16:59 2007
From: Agustin.Lobo at ija.csic.es (Agustin Lobo)
Date: Fri, 31 Aug 2007 11:16:59 +0200
Subject: [R-sig-Geo] R + GRASS in win XP
In-Reply-To: <Pine.LNX.4.64.0708262027550.2525@reclus.nhh.no>
References: <Prayer.1.0.12.0708252048510.22914@amos.qub.ac.uk>	<Pine.LNX.4.64.0708260757320.30138@reclus.nhh.no>
	<Pine.LNX.4.64.0708262027550.2525@reclus.nhh.no>
Message-ID: <46D7DC8B.2000201@ija.csic.es>

Roger,

Roger Bivand escribi?:
> On Sun, 26 Aug 2007, Roger Bivand wrote:

> It was a combination of path variables with spaces and the apparent need 
> to call GRASS commands with *.exe extensions from within R in the GRASS 
> shell under GRASS Tools (QGIS 0.8.1). From spgrass6-0.4-1, QGIS/msys/GRASS 
> is supported - package revision just submitted to CRAN.
> 
> Roger
> 

what does "QGIS/msys/GRASS is supported" mean? Can R be used as a Qgis 
pluggin? Also for linux?

Thanks

Agus
-- 
Dr. Agustin Lobo
Institut de Ciencies de la Terra "Jaume Almera" (CSIC)
LLuis Sole Sabaris s/n
08028 Barcelona
Spain
Tel. 34 934095410
Fax. 34 934110012
email: Agustin.Lobo at ija.csic.es
http://www.ija.csic.es/gt/obster



From carlosguerra at esa.ipvc.pt  Fri Aug 31 12:30:58 2007
From: carlosguerra at esa.ipvc.pt (Carlos A. Bastos M.Guerra)
Date: Fri, 31 Aug 2007 11:30:58 +0100
Subject: [R-sig-Geo] (no subject)
Message-ID: <DA0943DAEC5E044096035B01B6C542631C7755@ci04.mail2.esa.ipvc.pt>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070831/daa92835/attachment.pl>

From carlosguerra at esa.ipvc.pt  Fri Aug 31 12:32:00 2007
From: carlosguerra at esa.ipvc.pt (Carlos A. Bastos M.Guerra)
Date: Fri, 31 Aug 2007 11:32:00 +0100
Subject: [R-sig-Geo] shapefile errors and kriging limits
References: <DA0943DAEC5E044096035B01B6C542631C7755@ci04.mail2.esa.ipvc.pt>
Message-ID: <DA0943DAEC5E044096035B01B6C542631C7756@ci04.mail2.esa.ipvc.pt>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070831/f399b841/attachment.pl>

From tgriffin at uaex.edu  Fri Aug 31 18:07:31 2007
From: tgriffin at uaex.edu (Terry Griffin)
Date: Fri, 31 Aug 2007 11:07:31 -0500
Subject: [R-sig-Geo] simulation loop and creating weights
Message-ID: <46D7F673020000FB00022A18@mail.uaex.edu>

Thank you Roger!

>>> Roger Bivand <Roger.Bivand at nhh.no> 08/31/07 1:19 AM >>>
On Thu, 30 Aug 2007, Terry Griffin wrote:

> Greetings,
>
> In a simulation I'm running, I would like to create a series of listw 
> weight matrices outside of the simulation loop.  The appropriate inverse 
> distance weights matrix I want to use is determined within the 
> simulation loop using the sp.correlogram function.  For instance there 
> are 5 possible different weight matrices, mat1..mat5.  Each of these 
> matrices takes a little while to create, and with 1000 replications it 
> takes up a lot of time.
>
> Using an ifelse statement I can isolate the appropriate distance from 
> the sp.correlogram function, but when I try to paste or cat the number 
> from the ifelse statement to the name "mat", it is not recognized as a 
> listw.  Is there a way to speed the along?

Without seeing your code, it is well-nigh impossible to say, but most 
likely your use (or lack of use) of get() is not working - get() lets you 
access an object, possibly in a different environment, by name given as a 
string value. It may be that you are getting a character string from 
paste("mat", i, sep=""), and need to wrap that string in a get(), to 
access the object of that name.

Roger

>
> Thank you,
>
> Terry
>
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at stat.math.ethz.ch
https://stat.ethz.ch/mailman/listinfo/r-sig-geo



From reeves at nceas.ucsb.edu  Fri Aug 31 20:33:46 2007
From: reeves at nceas.ucsb.edu (Rick Reeves)
Date: Fri, 31 Aug 2007 11:33:46 -0700
Subject: [R-sig-Geo] center of gravity
In-Reply-To: <BAY137-W257FFAB121F472F50C4A6EE1CE0@phx.gbl>
References: <BAY137-W257FFAB121F472F50C4A6EE1CE0@phx.gbl>
Message-ID: <46D85F0A.2080101@nceas.ucsb.edu>

Hi: look for Centroid calculations:

 >help.search("centroid") will show:

Help files with alias or concept or title matching 'centroid' using 
fuzzy matching:



apply.polygon(maps)                        Polygon functions
get.Pcent(maptools)                        Polygon centroids
calcCentroid(PBSmapping)                   Calculate the Centroids of 
Polygons
centroid.owin(spatstat)                    Centroid of a window
affinexy(spatstat)                         Internal spatstat functions

I suspect that the best one for your case would be centroid.owin, since 
it has the most
straightforward input data requirements.

Hope this helps,
Rick Reeves

-- 
Rick Reeves	
Scientific Programmer / Analyst	
National Center for Ecological Analysis and Synthesis
UC Santa Barbara
reeves at nceas.ucsb.edu
www.nceas.ucsb.edu
805 892 2533



daiconnie wrote:
>  
>  
> Hi, everyone,
>  
> I have a question coming up from my research. 
>  
> Suppose I want to find the center of gravity for an arbitrary 2-D shape, are there any packages or functions in R that can do it for me?  Thanks!
>  
> Best,
>  
> Connie
> _________________________________________________________________
> ?? Live Search ??????????????
>
> 	[[alternative HTML version deleted]]
>
>   
> ------------------------------------------------------------------------
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>   

-------------- next part --------------
A non-text attachment was scrubbed...
Name: reeves.vcf
Type: text/x-vcard
Size: 339 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070831/9e94c3f3/attachment.vcf>

From blopes at email.unc.edu  Fri Aug 31 23:18:13 2007
From: blopes at email.unc.edu (Brian J. Lopes)
Date: Fri, 31 Aug 2007 17:18:13 -0400
Subject: [R-sig-Geo] Gaussian Variogram Positive Definite?
Message-ID: <46D88595.40602@email.unc.edu>

Hello All:

I've been banging my head against the wall about this for quite some 
time now, and I can't seem to find any reference on the matter.  I'm 
trying to calculate MLE estimates for the Gaussian variogram, but it 
seems that I consistently reach the point where the covariance matrix is 
not positive definite, as dictated by the Cholesky decomposition, even 
though the range parameter is indeed positive (note that I am also 
incorporating a nugget to sill ratio as well).  Has anybody else 
experienced this problem?  Better yet, does anybody have any references 
that discuss the situation, or how I can avoid it?

The data is a bit large, so if an example is necessary I'll try to see 
if I can come up with something reasonable.

Thanks,
Brian



