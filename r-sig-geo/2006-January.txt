From rb.glists at gmail.com  Thu Jan  5 14:15:43 2006
From: rb.glists at gmail.com (Ronnie Babigumira)
Date: Thu, 05 Jan 2006 14:15:43 +0100
Subject: [R-sig-Geo] Neighbours list
Message-ID: <43BD1BFF.2020705@gmail.com>

Hi, I have a raster map in raster format and would like to make a neighbours list. Reading spdeps documentation I sense 
that cell2nb is what I should use, however, my grid is not regular (my understanding of this that the grid would be a 
square or rectangle yet my grid is an abstract form of a region in a country). How does one go about creating a 
neighbours list in such a case?

Ronnie



From rb.glists at gmail.com  Thu Jan  5 15:05:31 2006
From: rb.glists at gmail.com (Ronnie Babigumira)
Date: Thu, 05 Jan 2006 15:05:31 +0100
Subject: [R-sig-Geo] Clarification on Neighbours list
Message-ID: <43BD27AB.3080003@gmail.com>

Someone has pointed out that my question was not clear. With a clear danger of sounding really stupid, I will try to clarify

Say I have a polygon, which I convert to raster format so each cell is n by n. For some reason I select a set of cells 
and have a neat rectangle such as below. To get a neighbor list for such a grid I could use cell2nb(3, 8) would be fine

1 1 1 0 0 1 0 1
0 1 1 0 1 1 1 0
1 1 0 0 1 1 1 1

However say my grid came from the full map and looked something like this
   0 1 0 0 1
0 1 1 0 1 1 1
     0 0 1 1 1
       0 0 1 0 1
   1 1 0 1 1 1
   1 0 0 1
1 1 1 0 0
0 1 1

The number of rows is clear, however, what is the number of columns (and anyway, what R function do you use to get the 
dimensions of a SpatialGridDataFrame object.


Ronnie



From Roger.Bivand at nhh.no  Thu Jan  5 16:33:32 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 5 Jan 2006 16:33:32 +0100 (CET)
Subject: [R-sig-Geo] Clarification on Neighbours list
In-Reply-To: <43BD27AB.3080003@gmail.com>
Message-ID: <Pine.LNX.4.44.0601051516300.13218-100000@reclus.nhh.no>

On Thu, 5 Jan 2006, Ronnie Babigumira wrote:

> Someone has pointed out that my question was not clear. With a clear danger of sounding really stupid, I will try to clarify
> 
> Say I have a polygon, which I convert to raster format so each cell is n by n. For some reason I select a set of cells 
> and have a neat rectangle such as below. To get a neighbor list for such a grid I could use cell2nb(3, 8) would be fine
> 
> 1 1 1 0 0 1 0 1
> 0 1 1 0 1 1 1 0
> 1 1 0 0 1 1 1 1
> 
> However say my grid came from the full map and looked something like this
>    0 1 0 0 1
> 0 1 1 0 1 1 1
>      0 0 1 1 1
>        0 0 1 0 1
>    1 1 0 1 1 1
>    1 0 0 1
> 1 1 1 0 0
> 0 1 1
> 
> The number of rows is clear, however, what is the number of columns (and anyway, what R function do you use to get the 
> dimensions of a SpatialGridDataFrame object.
> 

At an enjoyable workshop south of Leipzig in November, this came up. If 
you have a SpatialGridDataFrame from a raster, with NA where there are no 
values:

x <- read.asciigrid(system.file("external/test.ag", package="sp")[1])
summary(x)
xx <- as(x, "SpatialPixelsDataFrame")
summary(xx)
slot(xx, "grid")
# find grid spacing, 40 distance units for rook neighbours
# for queen, max distance about 57 should work
d40_nb <- dnearneigh(coordinates(xx), 0, 40)
d40_nb
# convert to polygons
xxsp <- as.SpatialPolygons.SpatialPixels(xx)
# generate rook neighbours again - takes longer
rook_nb <- poly2nb(xxsp, queen=FALSE)
rook_nb
# compare, alike apart from different IDs
diffnb(rook_nb, d40_nb)

Hope this helps,

Roger

> 
> Ronnie
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From reeves at nceas.ucsb.edu  Fri Jan  6 01:43:43 2006
From: reeves at nceas.ucsb.edu (Rick Reeves)
Date: Thu, 05 Jan 2006 16:43:43 -0800
Subject: [R-sig-Geo] A question re: tripack / voronoi cell area units
Message-ID: <43BDBD3F.8050607@nceas.ucsb.edu>

   
Greetings:

I've checked the tripack documentation for an answer to this question:
How to determine the units for areas calculated for voronoi mosaic cells 
(by the cells method)
in the tripack package?

I assume that they are related to the units of the $x and $y coordinates 
input to the voronoi.mosaic()
method. For example, if the coordinates are expressed in decimal 
degrees, then the cell side lengths
are also expressed in decimal degrees and the cell areas would be in 
units of decimal degrees ** 2.

Can someone affirm or correct this assumption?

Thanks,
Rick R

-- 
Rick Reeves	
Scientific ProgrammerAnalyst
National Center for Ecological Analysis and Synthesis (NCEAS)
University of California, Santa Barbara
reeves at nceas.ucsb.edu
805 892 2533



From tkobayas at iu.edu  Fri Jan  6 10:09:38 2006
From: tkobayas at iu.edu (tkobayas at iu.edu)
Date: Fri,  6 Jan 2006 04:09:38 -0500
Subject: [R-sig-Geo] finding significant local peaks by locfit package
Message-ID: <20060106040938.8d0l4h5msgw00c0s@webmail-beta.iu.edu>

HI,

I am still learning how a nonparametric regression works to find out
statistically significant local peaks on the fitted curve. My data comes from
Baltimore census tracts. The tracts have the latitude and longitude values.

lfknots showed that the fitted values, the local points, and the log likelihood
statistics. I assume the log likelihood statistics is very meaningful in this
sense. but I am not sure if there is any criteria to pick statistically
significant ones out of all sets of points evalueated by locfit.

I apprecaite if someone could help me out.

Thank you very much.

Taka


Indiana University, Dept. Geography



From rb.glists at gmail.com  Fri Jan  6 12:39:26 2006
From: rb.glists at gmail.com (Ronnie Babigumira)
Date: Fri, 06 Jan 2006 12:39:26 +0100
Subject: [R-sig-Geo] Clarification on Neighbours list
In-Reply-To: <Pine.LNX.4.44.0601051516300.13218-100000@reclus.nhh.no>
References: <Pine.LNX.4.44.0601051516300.13218-100000@reclus.nhh.no>
Message-ID: <43BE56EE.1050609@gmail.com>

Roger (as well as others who contacted me off the list), many thanks for this it helped clarify things.

Ronnie
Roger Bivand wrote:
> On Thu, 5 Jan 2006, Ronnie Babigumira wrote:
> 
>> Someone has pointed out that my question was not clear. With a clear danger of sounding really stupid, I will try to clarify
>>
>> Say I have a polygon, which I convert to raster format so each cell is n by n. For some reason I select a set of cells 
>> and have a neat rectangle such as below. To get a neighbor list for such a grid I could use cell2nb(3, 8) would be fine
>>
>> 1 1 1 0 0 1 0 1
>> 0 1 1 0 1 1 1 0
>> 1 1 0 0 1 1 1 1
>>
>> However say my grid came from the full map and looked something like this
>>    0 1 0 0 1
>> 0 1 1 0 1 1 1
>>      0 0 1 1 1
>>        0 0 1 0 1
>>    1 1 0 1 1 1
>>    1 0 0 1
>> 1 1 1 0 0
>> 0 1 1
>>
>> The number of rows is clear, however, what is the number of columns (and anyway, what R function do you use to get the 
>> dimensions of a SpatialGridDataFrame object.
>>
> 
> At an enjoyable workshop south of Leipzig in November, this came up. If 
> you have a SpatialGridDataFrame from a raster, with NA where there are no 
> values:
> 
> x <- read.asciigrid(system.file("external/test.ag", package="sp")[1])
> summary(x)
> xx <- as(x, "SpatialPixelsDataFrame")
> summary(xx)
> slot(xx, "grid")
> # find grid spacing, 40 distance units for rook neighbours
> # for queen, max distance about 57 should work
> d40_nb <- dnearneigh(coordinates(xx), 0, 40)
> d40_nb
> # convert to polygons
> xxsp <- as.SpatialPolygons.SpatialPixels(xx)
> # generate rook neighbours again - takes longer
> rook_nb <- poly2nb(xxsp, queen=FALSE)
> rook_nb
> # compare, alike apart from different IDs
> diffnb(rook_nb, d40_nb)
> 
> Hope this helps,
> 
> Roger
> 
>> Ronnie
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>



From rb.glists at gmail.com  Sun Jan  8 22:15:58 2006
From: rb.glists at gmail.com (Ronnie Babigumira)
Date: Sun, 08 Jan 2006 22:15:58 +0100
Subject: [R-sig-Geo] Converting Grid to factor list
Message-ID: <43C1810E.2070205@gmail.com>

Hi listers
I would like to change a grid to a factor list so as to apply Join Count statistics however when I use
mygrid.f <- factor(mygrid)

I get an error message " 'x' must be atomic".

Looking through the RHelp archives, I have chanced on emails with a similar problem but no direct answer to this. Is 
anyone farmiliar with this and how can I go about it


Many thanks

Ronnie



From e.pebesma at geo.uu.nl  Sun Jan  8 23:21:14 2006
From: e.pebesma at geo.uu.nl (Edzer J. Pebesma)
Date: Sun, 08 Jan 2006 22:21:14 +0000
Subject: [R-sig-Geo] Converting Grid to factor list
In-Reply-To: <43C1810E.2070205@gmail.com>
References: <43C1810E.2070205@gmail.com>
Message-ID: <43C1905A.20904@geo.uu.nl>

Ronnie, you didn't tell us how you created the grid. Is it on of the
grid classes in package sp? In that case you can address the
variable in it by it's name, say foo:

mygrid.f <- factor(mygrid$foo)

hth,
--
Edzer

Ronnie Babigumira wrote:

>Hi listers
>I would like to change a grid to a factor list so as to apply Join Count statistics however when I use
>mygrid.f <- factor(mygrid)
>
>I get an error message " 'x' must be atomic".
>
>Looking through the RHelp archives, I have chanced on emails with a similar problem but no direct answer to this. Is 
>anyone farmiliar with this and how can I go about it
>
>
>Many thanks
>
>Ronnie
>
>_______________________________________________
>R-sig-Geo mailing list
>R-sig-Geo at stat.math.ethz.ch
>https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>  
>



From rb.glists at gmail.com  Sun Jan  8 22:43:56 2006
From: rb.glists at gmail.com (Ronnie Babigumira)
Date: Sun, 08 Jan 2006 22:43:56 +0100
Subject: [R-sig-Geo] Converting Grid to factor list
In-Reply-To: <43C1905A.20904@geo.uu.nl>
References: <43C1810E.2070205@gmail.com> <43C1905A.20904@geo.uu.nl>
Message-ID: <43C1879C.6070903@gmail.com>

Edzer
Many thanks. The grid was created in ArcView and exported as an ascii file. I then read it in R using the read.asciigrid 
function in map tools

Any ideas?

Ronnie

Edzer J. Pebesma wrote:
> Ronnie, you didn't tell us how you created the grid. Is it on of the
> grid classes in package sp? In that case you can address the
> variable in it by it's name, say foo:
> 
> mygrid.f <- factor(mygrid$foo)
> 
> hth,
> -- 
> Edzer
> 
> Ronnie Babigumira wrote:
> 
>> Hi listers
>> I would like to change a grid to a factor list so as to apply Join 
>> Count statistics however when I use
>> mygrid.f <- factor(mygrid)
>>
>> I get an error message " 'x' must be atomic".
>>
>> Looking through the RHelp archives, I have chanced on emails with a 
>> similar problem but no direct answer to this. Is anyone farmiliar with 
>> this and how can I go about it
>>
>>
>> Many thanks
>>
>> Ronnie
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>  
>>
> 
>



From e.pebesma at geo.uu.nl  Mon Jan  9 08:28:17 2006
From: e.pebesma at geo.uu.nl (Edzer J. Pebesma)
Date: Mon, 09 Jan 2006 08:28:17 +0100
Subject: [R-sig-Geo] Converting Grid to factor list
In-Reply-To: <43C1879C.6070903@gmail.com>
References: <43C1810E.2070205@gmail.com> <43C1905A.20904@geo.uu.nl>
	<43C1879C.6070903@gmail.com>
Message-ID: <43C21091.8020502@geo.uu.nl>

Ronnie Babigumira wrote:

>Edzer
>Many thanks. The grid was created in ArcView and exported as an ascii file. I then read it in R using the read.asciigrid 
>function in map tools
>
>Any ideas?
>  
>
Yes; the function returns an object of class SpatialGridDataFrame:

 > example(read.asciigrid)

rd.scg> x <- read.asciigrid(system.file("external/test.ag",
    package = "sp")[1])

rd.scg> class(x)
[1] "SpatialGridDataFrame"
attr(,"package")
[1] "sp"

rd.scg> image(x)
 > names(x)
[1] "/home/edzer/S/library/sp/external/test.ag"
 > names(x) = "foo"
 > f = factor(round(x$foo))
 > summary(f)
    357     394     270     310     398     294     295     303     
307     391
     18      18      17      17      17      16      16      16      
16      16
 [etc., etc.,...]
    250     256     265     274     290     291     297     299 
(Other)    NA's
      9       9       9       9       9       9       9       9    
1938    6097
 >

The renaming to foo was not necessary, but quotes would have
been necessary around the name as it contained slashes. I rounded
the values because they were numeric.
--
Edzer

>Ronnie
>
>Edzer J. Pebesma wrote:
>  
>
>>Ronnie, you didn't tell us how you created the grid. Is it on of the
>>grid classes in package sp? In that case you can address the
>>variable in it by it's name, say foo:
>>
>>mygrid.f <- factor(mygrid$foo)
>>
>>hth,
>>-- 
>>Edzer
>>
>>Ronnie Babigumira wrote:
>>
>>    
>>
>>>Hi listers
>>>I would like to change a grid to a factor list so as to apply Join 
>>>Count statistics however when I use
>>>mygrid.f <- factor(mygrid)
>>>
>>>I get an error message " 'x' must be atomic".
>>>
>>>Looking through the RHelp archives, I have chanced on emails with a 
>>>similar problem but no direct answer to this. Is anyone farmiliar with 
>>>this and how can I go about it
>>>
>>>
>>>Many thanks
>>>
>>>Ronnie
>>>
>>>_______________________________________________
>>>R-sig-Geo mailing list
>>>R-sig-Geo at stat.math.ethz.ch
>>>https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>> 
>>>
>>>      
>>>
>>    
>>
>
>_______________________________________________
>R-sig-Geo mailing list
>R-sig-Geo at stat.math.ethz.ch
>https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>  
>



From rb.glists at gmail.com  Mon Jan  9 09:13:25 2006
From: rb.glists at gmail.com (Ronnie Babigumira)
Date: Mon, 09 Jan 2006 09:13:25 +0100
Subject: [R-sig-Geo] Converting Grid to factor list
In-Reply-To: <43C21091.8020502@geo.uu.nl>
References: <43C1810E.2070205@gmail.com> <43C1905A.20904@geo.uu.nl>
	<43C1879C.6070903@gmail.com> <43C21091.8020502@geo.uu.nl>
Message-ID: <43C21B25.5010906@gmail.com>

Edzer, Many thanks for this "aha...I see" moment. Most illuminating

Ronnie

Edzer J. Pebesma wrote:
> Ronnie Babigumira wrote:
> 
>> Edzer
>> Many thanks. The grid was created in ArcView and exported as an ascii 
>> file. I then read it in R using the read.asciigrid function in map tools
>>
>> Any ideas?
>>  
>>
> Yes; the function returns an object of class SpatialGridDataFrame:
> 
>  > example(read.asciigrid)
> 
> rd.scg> x <- read.asciigrid(system.file("external/test.ag",
>    package = "sp")[1])
> 
> rd.scg> class(x)
> [1] "SpatialGridDataFrame"
> attr(,"package")
> [1] "sp"
> 
> rd.scg> image(x)
>  > names(x)
> [1] "/home/edzer/S/library/sp/external/test.ag"
>  > names(x) = "foo"
>  > f = factor(round(x$foo))
>  > summary(f)
>    357     394     270     310     398     294     295     303     
> 307     391
>     18      18      17      17      17      16      16      16      
> 16      16
> [etc., etc.,...]
>    250     256     265     274     290     291     297     299 
> (Other)    NA's
>      9       9       9       9       9       9       9       9    
> 1938    6097
>  >
> 
> The renaming to foo was not necessary, but quotes would have
> been necessary around the name as it contained slashes. I rounded
> the values because they were numeric.
> -- 
> Edzer
> 
>> Ronnie
>>
>> Edzer J. Pebesma wrote:
>>  
>>
>>> Ronnie, you didn't tell us how you created the grid. Is it on of the
>>> grid classes in package sp? In that case you can address the
>>> variable in it by it's name, say foo:
>>>
>>> mygrid.f <- factor(mygrid$foo)
>>>
>>> hth,
>>> -- 
>>> Edzer
>>>
>>> Ronnie Babigumira wrote:
>>>
>>>   
>>>> Hi listers
>>>> I would like to change a grid to a factor list so as to apply Join 
>>>> Count statistics however when I use
>>>> mygrid.f <- factor(mygrid)
>>>>
>>>> I get an error message " 'x' must be atomic".
>>>>
>>>> Looking through the RHelp archives, I have chanced on emails with a 
>>>> similar problem but no direct answer to this. Is anyone farmiliar 
>>>> with this and how can I go about it
>>>>
>>>>
>>>> Many thanks
>>>>
>>>> Ronnie
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at stat.math.ethz.ch
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>>
>>>>     
>>>   
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>  
>>
> 
>



From rb.glists at gmail.com  Mon Jan  9 13:55:05 2006
From: rb.glists at gmail.com (Ronnie Babigumira)
Date: Mon, 09 Jan 2006 13:55:05 +0100
Subject: [R-sig-Geo] join count with a grid that has NA's
Message-ID: <43C25D29.20604@gmail.com>

Hi listers
I am trying to apply join counts stats however my grid has some NA's and so I get an error

 > joincount.multi(mygrid.f, nb2listw(mynb, style="B"))
Error in joincount.multi(mygrid.f, nb2listw(mynb, style="B")) :
         NA in factor

My feeling was that the NA's can be ignored but looking at ?joincount.multi I dont see any options for ignoring NA's. 
Any ideas on a work around this

Ronnie



From Roger.Bivand at nhh.no  Mon Jan  9 14:10:52 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 9 Jan 2006 14:10:52 +0100 (CET)
Subject: [R-sig-Geo] join count with a grid that has NA's
In-Reply-To: <43C25D29.20604@gmail.com>
Message-ID: <Pine.LNX.4.44.0601091404450.26898-100000@reclus.nhh.no>

On Mon, 9 Jan 2006, Ronnie Babigumira wrote:

> Hi listers
> I am trying to apply join counts stats however my grid has some NA's and so I get an error
> 
>  > joincount.multi(mygrid.f, nb2listw(mynb, style="B"))
> Error in joincount.multi(mygrid.f, nb2listw(mynb, style="B")) :
>          NA in factor
> 
> My feeling was that the NA's can be ignored but looking at
> ?joincount.multi I dont see any options for ignoring NA's.  Any ideas on
> a work around this

Two possibilities: subset the data and the neighbour list to remove the NA 
cells - use subset methods, or turn NA into a factor level - a different 
category - and include it in the analysis (so counting NA/NA and NA with 
real level joins too). Neither very good, nor very bad, depends on your 
needs.

You have to make the decision, there isn't an obviously right one,
especially not just omitting NA/other and NA/NA counts internally by
ignoring them, because then the join count sums will not agree with the
neighbour graph geometry sums.

Roger

> 
> Ronnie
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From rb.glists at gmail.com  Mon Jan  9 15:45:00 2006
From: rb.glists at gmail.com (Ronnie Babigumira)
Date: Mon, 09 Jan 2006 15:45:00 +0100
Subject: [R-sig-Geo] join count with a grid that has NA's
In-Reply-To: <Pine.LNX.4.44.0601091404450.26898-100000@reclus.nhh.no>
References: <Pine.LNX.4.44.0601091404450.26898-100000@reclus.nhh.no>
Message-ID: <43C276EC.9050805@gmail.com>

Thanks Roger
Started with the easier of the two which was to turn NA into a factor level.

However, I feel drawn to the "subsetting" option. However, here is my dilemma (or more like my ignorance at this point)

1. spdep has subset.listw and subset.nb to subset the spatial weights or the neighbors lists respectively (by the way 
does c(31, 34) in the example in the help file mean that columns 31 and 34 will be dropped?)

2 However, I have (using RSiteSearch) tried to look for a function subsetting a spatialgriddataframe but have had no 
luck. Any pointers

More fundamentally, my intuition is that I need to start the subsetting process with mygrid and somehow retain a vector 
of the rows or columns dropped and pass this information on the the subset.listw or subset.nb so that the same cells are 
dropped in the neighbor list. Now that is as far as I can go (thinking...), any ideas on how to proceed?

Ronnie

Roger Bivand wrote:
> On Mon, 9 Jan 2006, Ronnie Babigumira wrote:
> 
>> Hi listers
>> I am trying to apply join counts stats however my grid has some NA's and so I get an error
>>
>>  > joincount.multi(mygrid.f, nb2listw(mynb, style="B"))
>> Error in joincount.multi(mygrid.f, nb2listw(mynb, style="B")) :
>>          NA in factor
>>
>> My feeling was that the NA's can be ignored but looking at
>> ?joincount.multi I dont see any options for ignoring NA's.  Any ideas on
>> a work around this
> 
> Two possibilities: subset the data and the neighbour list to remove the NA 
> cells - use subset methods, or turn NA into a factor level - a different 
> category - and include it in the analysis (so counting NA/NA and NA with 
> real level joins too). Neither very good, nor very bad, depends on your 
> needs.
> 
> You have to make the decision, there isn't an obviously right one,
> especially not just omitting NA/other and NA/NA counts internally by
> ignoring them, because then the join count sums will not agree with the
> neighbour graph geometry sums.
> 
> Roger
> 
>> Ronnie
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>



From rb.glists at gmail.com  Mon Jan  9 22:59:20 2006
From: rb.glists at gmail.com (Ronnie Babigumira)
Date: Mon, 09 Jan 2006 22:59:20 +0100
Subject: [R-sig-Geo] subset grid and neighbour list
Message-ID: <43C2DCB8.1050401@gmail.com>

Dear listers
This may be obvious however I have thrown in the towel after numerous futile attempts. Here is my problem. I have a grid 
with 5 levels including NA. I would like to perform join count stats on it. Prof. Bivand advised me to either add NA as 
a factor, or subset the grid and eliminate the NA's (I feel the later makes more sense)

I think the steps I need to take are

1. Drop the NA's in mygrid (and save the ids of the cells dropped)

2. subset the neighbors list using information from step1

Is there anyone familiar with this especially step 1

Ronnie



From Roger.Bivand at nhh.no  Tue Jan 10 08:42:58 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 10 Jan 2006 08:42:58 +0100 (CET)
Subject: [R-sig-Geo] subset grid and neighbour list
In-Reply-To: <43C2DCB8.1050401@gmail.com>
Message-ID: <Pine.LNX.4.44.0601100834260.28730-100000@reclus.nhh.no>

On Mon, 9 Jan 2006, Ronnie Babigumira wrote:

> Dear listers
> This may be obvious however I have thrown in the towel after numerous futile attempts. Here is my problem. I have a grid 
> with 5 levels including NA. I would like to perform join count stats on it. Prof. Bivand advised me to either add NA as 
> a factor, or subset the grid and eliminate the NA's (I feel the later makes more sense)
> 
> I think the steps I need to take are
> 
> 1. Drop the NA's in mygrid (and save the ids of the cells dropped)
> 
> 2. subset the neighbors list using information from step1
> 
> Is there anyone familiar with this especially step 1

library(spdep)
set.seed(20060110)
input <- data.frame(expand.grid(x=1:10, y=1:10), z=rpois(100, 3))
coordinates(input) <- c("x", "y")
table(input$z)
is.na(input$z) <- input$z < 1 | input$z > 5
table(input$z)
input$z <- as.factor(input$z)
rook <- dnearneigh(coordinates(input), 0, 1)
rook
plot(rook, coordinates(input))
joincount.multi(input$z, nb2listw(rook, 
style="B"))
# Error in joincount.multi(input$z, nb2listw(rook, style = "B")) : 
#        NA in factor
keep <- !is.na(input$z)
rook_sub <- subset(rook, subset=keep)
input_sub <- subset(input, subset=keep)
rook_sub
# look out for no-neighbour cells - if present, use zero.policy=TRUE below
plot(rook_sub, coordinates(input_sub))
joincount.multi(input_sub$z, nb2listw(rook_sub, style="B"))

This is for a full grid, but if you have SpatialPixels or SpatialPolygons 
the order of operations will be the same, I think. You need to watch out 
for no-neighbour cells after subsetting, and use zero.policy=TRUE in both 
joincount.multi() and nb2listw() if they have been introduced.

Roger


> 
> Ronnie
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From TMiewald at sanborn.com  Wed Jan 11 06:33:32 2006
From: TMiewald at sanborn.com (Miewald, Tom)
Date: Tue, 10 Jan 2006 22:33:32 -0700
Subject: [R-sig-Geo] randomForests for mapping vegetation
Message-ID: <145AFBAC9803654DBA4C713E3DAC19F9131640@COS-SVR-28.intra.sanborn.com>


Hello all,

I am new to this list and wondering whether anyone has any experience (or ideas) for how to implement vegetation mapping using the randomForests package from R.  The model produced from randomForests would be used to map vegetation from Landsat (30 x 30 meter pixels) for relatively large areas (> 10 million hectares, so a lot of pixels).  There are ~15 explanatory data sets (imagery, dems,precip, etc).  My main question concerns how to use the output from randomForests to predict vegetation over such an area.  I have seen some literature out there using GRASS.  I would rather not go down that road because I already have enough software packages.  Is there any possibilities for using ArcGIS connectivity to enable the prediction of vegetation?  Any input would be appreciated.  Thanks!
Tom

CONFIDENTIALITY AND DISCLAIMER: This message and any attachments hereto are intended only for the use of the addressee(s) and may be legally privileged and/or confidential. Any dissemination, distribution, printing, forwarding, or any method of copying of this message or any attachment hereto, and/or the taking of any action in reliance on the information herein or in any attachment hereto is strictly prohibited except by the original intended recipient. If you have received this communication in error, please immediately notify the sender, and permanently delete this message and any attachment hereto from your computer or storage system, and destroy any printout thereof. Although reasonable precautions have been taken to ensure no viruses are present in this message or any attachment hereto, The Sanborn Map Company, Inc. takes no responsibility and has no liability for any virus which may be transferred via this message or any attachment hereto.

(svr28)



From e.pebesma at geog.uu.nl  Wed Jan 11 11:24:51 2006
From: e.pebesma at geog.uu.nl (Edzer J. Pebesma)
Date: Wed, 11 Jan 2006 11:24:51 +0100
Subject: [R-sig-Geo] randomForests for mapping vegetation
In-Reply-To: <145AFBAC9803654DBA4C713E3DAC19F9131640@COS-SVR-28.intra.sanborn.com>
References: <145AFBAC9803654DBA4C713E3DAC19F9131640@COS-SVR-28.intra.sanborn.com>
Message-ID: <43C4DCF3.1070705@geog.uu.nl>

Tom, a possibility is to stay in R and use rgdal.
rgdal can open raster maps (and I'm sure landsat images) directly,
and read in parts of them, i.e. it doesn't read the full
map at once. You'd have to loop over the full map, read
a part, predict with randomForest's predict method,
write the predicted values out, and go to the next part.

Support for sp classes is under development, in a
packages called spGDAL which is available in source
code on cvs from sourceforge:

export CVSROOT=:pserver:anonymous at cvs.sf.net:/cvsroot/r-spatial
cvs co spGDAL

spGDAL has support for writing a gdal map, but I'm in
doubt whether it does support writing segments of
a gdal map. It should; please keep us updated on your mileage.
--
Edzer

Miewald, Tom wrote:

>Hello all,
>
>I am new to this list and wondering whether anyone has any experience (or ideas) for how to implement vegetation mapping using the randomForests package from R.  The model produced from randomForests would be used to map vegetation from Landsat (30 x 30 meter pixels) for relatively large areas (> 10 million hectares, so a lot of pixels).  There are ~15 explanatory data sets (imagery, dems,precip, etc).  My main question concerns how to use the output from randomForests to predict vegetation over such an area.  I have seen some literature out there using GRASS.  I would rather not go down that road because I already have enough software packages.  Is there any possibilities for using ArcGIS connectivity to enable the prediction of vegetation?  Any input would be appreciated.  Thanks!
>Tom
>
>CONFIDENTIALITY AND DISCLAIMER: This message and any attachments hereto are intended only for the use of the addressee(s) and may be legally privileged and/or confidential. Any dissemination, distribution, printing, forwarding, or any method of copying of this message or any attachment hereto, and/or the taking of any action in reliance on the information herein or in any attachment hereto is strictly prohibited except by the original intended recipient. If you have received this communication in error, please immediately notify the sender, and permanently delete this message and any attachment hereto from your computer or storage system, and destroy any printout thereof. Although reasonable precautions have been taken to ensure no viruses are present in this message or any attachment hereto, The Sanborn Map Company, Inc. takes no responsibility and has no liability for any virus which may be transferred via this message or any attachment hereto.
>
>(svr28)
>
>_______________________________________________
>R-sig-Geo mailing list
>R-sig-Geo at stat.math.ethz.ch
>https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>  
>



From Roger.Bivand at nhh.no  Wed Jan 11 11:28:19 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 11 Jan 2006 11:28:19 +0100 (CET)
Subject: [R-sig-Geo] randomForests for mapping vegetation
In-Reply-To: <145AFBAC9803654DBA4C713E3DAC19F9131640@COS-SVR-28.intra.sanborn.com>
Message-ID: <Pine.LNX.4.44.0601111110230.30033-100000@reclus.nhh.no>

On Tue, 10 Jan 2006, Miewald, Tom wrote:

> 
> Hello all,
> 
> I am new to this list and wondering whether anyone has any experience
> (or ideas) for how to implement vegetation mapping using the
> randomForests package from R.  The model produced from randomForests
> would be used to map vegetation from Landsat (30 x 30 meter pixels) for
> relatively large areas (> 10 million hectares, so a lot of pixels).  
> There are ~15 explanatory data sets (imagery, dems,precip, etc).  My
> main question concerns how to use the output from randomForests to
> predict vegetation over such an area.  I have seen some literature out
> there using GRASS.  I would rather not go down that road because I
> already have enough software packages.  Is there any possibilities for
> using ArcGIS connectivity to enable the prediction of vegetation?  Any
> input would be appreciated.  Thanks!

Have a look at:

http://www.ci.tuwien.ac.at/Conferences/DSC-2003/Drafts/FurlanelloEtAl.pdf

which is fairly close to your description, although not such a large 
number of pixels, and does use R/GRASS integration.

My guess would be that you should tile the region for prediction into 
subregions, and patch them together back in AcrGIS. You could do it by 
writing out Arc ASCII grids using the write.asciigrid() function in 
the maptools package. If this is going to be more heavyweight production, 
then using the Rcom interface from VBA in ArcGIS might also be possible, 
if the whole process is going to have to be repeated many times. We are 
also looking at writing geotiffs from rdgal, so you should be able to find 
a suitable route from the subregional predictions within R back to rasters 
in ArcGIS. 

Examples using VBA are shown here:

http://perso.univ-lr.fr/csaintje/Recherche/RArcgis/index.html

and a nice interface using Python from ArcGIS then Rcom:

http://www.nicholas.duke.edu/geospatial/software/

Most of the hard work will be in getting things to work once, from there 
it'll get easier. Consider save()ing the RF model output, so that to make 
predictions, you only need to load() then predict() for newdata (grids of 
RHS variables) for the current subregion. This also parallelises nicely, 
so you could also pass off subregions and the fitted model to slaves to do 
the predictions, but getting it working will take substantial time. By the 
way, OSX and Linux memory management will be better than Windows, so on 
Windows, go for smaller subregions.

Roger


> Tom
> 
> CONFIDENTIALITY AND DISCLAIMER: This message and any attachments hereto
> are intended only for the use of the addressee(s) and may be legally
> privileged and/or confidential. Any dissemination, distribution,
> printing, forwarding, or any method of copying of this message or any
> attachment hereto, and/or the taking of any action in reliance on the
> information herein or in any attachment hereto is strictly prohibited
> except by the original intended recipient. If you have received this
> communication in error, please immediately notify the sender, and
> permanently delete this message and any attachment hereto from your
> computer or storage system, and destroy any printout thereof. Although
> reasonable precautions have been taken to ensure no viruses are present
> in this message or any attachment hereto, The Sanborn Map Company, Inc.
> takes no responsibility and has no liability for any virus which may be
> transferred via this message or any attachment hereto.
> 
> (svr28)
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From tghoward at gw.dec.state.ny.us  Wed Jan 11 14:07:50 2006
From: tghoward at gw.dec.state.ny.us (Tim Howard)
Date: Wed, 11 Jan 2006 08:07:50 -0500
Subject: [R-sig-Geo] randomForests for mapping vegetation
Message-ID: <s3c4bcf9.071@gwsmtp.DEC.STATE.NY.US>

Tom,
  We are using randomForests to generate predictive models (at 30 meters pixels, with a 22578 x 17160 grid) with about 36 environmental variables. I must admit we have not yet had the energy to do it completely within R or call R from ArcGIS.  
   We do our data prep and attributing in ArcGIS, then dump it all out to ASCII. We bring the attributed presence and absence points into R and build our random forest. With the known RF model, we then open connections to the ASCII grids for all 36 environmental layers, read them in piece by piece (each one is about 2GB), run a RF prediction on those pieces, and then write the prediction out to an ASCII file. 
  We then import the prediction layer into ArcGIS.  Not pretty by any means, but it does work.

Sincerely,
Tim





------------------------------

Message: 2
Date: Wed, 11 Jan 2006 11:24:51 +0100
From: "Edzer J. Pebesma" <e.pebesma at geog.uu.nl>
Subject: Re: [R-sig-Geo] randomForests for mapping vegetation
To: "Miewald, Tom" <TMiewald at sanborn.com>
Cc: r-sig-geo at stat.math.ethz.ch 
Message-ID: <43C4DCF3.1070705 at geog.uu.nl>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed

Tom, a possibility is to stay in R and use rgdal.
rgdal can open raster maps (and I'm sure landsat images) directly,
and read in parts of them, i.e. it doesn't read the full
map at once. You'd have to loop over the full map, read
a part, predict with randomForest's predict method,
write the predicted values out, and go to the next part.

Support for sp classes is under development, in a
packages called spGDAL which is available in source
code on cvs from sourceforge:

export CVSROOT=:pserver:anonymous at cvs.sf.net:/cvsroot/r-spatial 
cvs co spGDAL

spGDAL has support for writing a gdal map, but I'm in
doubt whether it does support writing segments of
a gdal map. It should; please keep us updated on your mileage.
--
Edzer

Miewald, Tom wrote:

>Hello all,
>
>I am new to this list and wondering whether anyone has any experience (or ideas) for how to implement vegetation mapping using the randomForests package from R.  The model produced from randomForests would be used to map vegetation from Landsat (30 x 30 meter pixels) for relatively large areas (> 10 million hectares, so a lot of pixels).  There are ~15 explanatory data sets (imagery, dems,precip, etc).  My main question concerns how to use the output from randomForests to predict vegetation over such an area.  I have seen some literature out there using GRASS.  I would rather not go down that road because I already have enough software packages.  Is there any possibilities for using ArcGIS connectivity to enable the prediction of vegetation?  Any input would be appreciated.  Thanks!
>Tom
>
>CONFIDENTIALITY AND DISCLAIMER: This message and any attachments hereto are intended only for the use of the addressee(s) and may be legally privileged and/or confidential. Any dissemination, distribution, printing, forwarding, or any method of copying of this message or any attachment hereto, and/or the taking of any action in reliance on the information herein or in any attachment hereto is strictly prohibited except by the original intended recipient. If you have received this communication in error, please immediately notify the sender, and permanently delete this message and any attachment hereto from your computer or storage system, and destroy any printout thereof. Although reasonable precautions have been taken to ensure no viruses are present in this message or any attachment hereto, The Sanborn Map Company, Inc. takes no responsibility and has no liability for any virus which may be transferred via this message or any attachment hereto.
>
>(svr28)
>
>_______________________________________________
>R-sig-Geo mailing list
>R-sig-Geo at stat.math.ethz.ch 
>https://stat.ethz.ch/mailman/listinfo/r-sig-geo 
>  
>



------------------------------

Message: 3
Date: Wed, 11 Jan 2006 11:28:19 +0100 (CET)
From: Roger Bivand <Roger.Bivand at nhh.no>
Subject: Re: [R-sig-Geo] randomForests for mapping vegetation
To: "Miewald, Tom" <TMiewald at sanborn.com>
Cc: r-sig-geo at stat.math.ethz.ch 
Message-ID: <Pine.LNX.4.44.0601111110230.30033-100000 at reclus.nhh.no>
Content-Type: TEXT/PLAIN; charset=US-ASCII

On Tue, 10 Jan 2006, Miewald, Tom wrote:

> 
> Hello all,
> 
> I am new to this list and wondering whether anyone has any experience
> (or ideas) for how to implement vegetation mapping using the
> randomForests package from R.  The model produced from randomForests
> would be used to map vegetation from Landsat (30 x 30 meter pixels) for
> relatively large areas (> 10 million hectares, so a lot of pixels).  
> There are ~15 explanatory data sets (imagery, dems,precip, etc).  My
> main question concerns how to use the output from randomForests to
> predict vegetation over such an area.  I have seen some literature out
> there using GRASS.  I would rather not go down that road because I
> already have enough software packages.  Is there any possibilities for
> using ArcGIS connectivity to enable the prediction of vegetation?  Any
> input would be appreciated.  Thanks!

Have a look at:

http://www.ci.tuwien.ac.at/Conferences/DSC-2003/Drafts/FurlanelloEtAl.pdf 

which is fairly close to your description, although not such a large 
number of pixels, and does use R/GRASS integration.

My guess would be that you should tile the region for prediction into 
subregions, and patch them together back in AcrGIS. You could do it by 
writing out Arc ASCII grids using the write.asciigrid() function in 
the maptools package. If this is going to be more heavyweight production, 
then using the Rcom interface from VBA in ArcGIS might also be possible, 
if the whole process is going to have to be repeated many times. We are 
also looking at writing geotiffs from rdgal, so you should be able to find 
a suitable route from the subregional predictions within R back to rasters 
in ArcGIS. 

Examples using VBA are shown here:

http://perso.univ-lr.fr/csaintje/Recherche/RArcgis/index.html 

and a nice interface using Python from ArcGIS then Rcom:

http://www.nicholas.duke.edu/geospatial/software/ 

Most of the hard work will be in getting things to work once, from there 
it'll get easier. Consider save()ing the RF model output, so that to make 
predictions, you only need to load() then predict() for newdata (grids of 
RHS variables) for the current subregion. This also parallelises nicely, 
so you could also pass off subregions and the fitted model to slaves to do 
the predictions, but getting it working will take substantial time. By the 
way, OSX and Linux memory management will be better than Windows, so on 
Windows, go for smaller subregions.

Roger


> Tom
> 
> CONFIDENTIALITY AND DISCLAIMER: This message and any attachments hereto
> are intended only for the use of the addressee(s) and may be legally
> privileged and/or confidential. Any dissemination, distribution,
> printing, forwarding, or any method of copying of this message or any
> attachment hereto, and/or the taking of any action in reliance on the
> information herein or in any attachment hereto is strictly prohibited
> except by the original intended recipient. If you have received this
> communication in error, please immediately notify the sender, and
> permanently delete this message and any attachment hereto from your
> computer or storage system, and destroy any printout thereof. Although
> reasonable precautions have been taken to ensure no viruses are present
> in this message or any attachment hereto, The Sanborn Map Company, Inc.
> takes no responsibility and has no liability for any virus which may be
> transferred via this message or any attachment hereto.
> 
> (svr28)
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch 
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo 
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no 



------------------------------

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at stat.math.ethz.ch 
https://stat.ethz.ch/mailman/listinfo/r-sig-geo 


End of R-sig-Geo Digest, Vol 29, Issue 5
****************************************

Timothy G. Howard, Ecologist and Program Scientist
New York Natural Heritage Program
625 Broadway, 5th floor
Albany, NY 12233-4757

(518) 402-8945
facsimile  (518) 402-8925



From mreisman at isis.wu-wien.ac.at  Mon Jan 16 16:11:27 2006
From: mreisman at isis.wu-wien.ac.at (Martin Reismann)
Date: Mon, 16 Jan 2006 16:11:27 +0100 (MEZ)
Subject: [R-sig-Geo] Missing statistics with errorsarlm(method="SparseM")
Message-ID: <Pine.A32.3.96.1060116160542.224760A-100000@isis.wu-wien.ac.at>

When using errorsarlm with method="SparseM" I encountered that 
"Asymptotic standard error" and "Wald statistic" are missing in the
summary. Both are available with errorsarlm method="eigen".

Any suggestions?

Best wishes,
Martin Reismann

---
Martin Reismann
Institut fuer Wirtschaftsgeographie und Geoinformatik
Wirtschaftsuniversitaet Wien
Nordbergstrasse 15, 4. Stock, Kern A
A-1090 Wien

EMail: Martin.Reismann at wu-wien.ac.at
Tel +43-(0)-1-31336-5720
Fax +43-(0)-1-31336-703



From Roger.Bivand at nhh.no  Mon Jan 16 19:08:30 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 16 Jan 2006 19:08:30 +0100 (CET)
Subject: [R-sig-Geo] Missing statistics with errorsarlm(method="SparseM")
In-Reply-To: <Pine.A32.3.96.1060116160542.224760A-100000@isis.wu-wien.ac.at>
Message-ID: <Pine.LNX.4.44.0601161903530.27353-100000@reclus.nhh.no>

On Mon, 16 Jan 2006, Martin Reismann wrote:

> When using errorsarlm with method="SparseM" I encountered that 
> "Asymptotic standard error" and "Wald statistic" are missing in the
> summary. Both are available with errorsarlm method="eigen".

The "SparseM" method is used for large n, when operations on a full matrix
would tax your computer. Computing the information matrix means inverting
an n by n matrix, so statistics relying on the information matrix are not
available with this method. If you must have them for large n, you need
more RAM and possibly a 64 bit box, but in practice if you have many n,
the likelihood ratio will tell you what you need to know anyway.

> 
> Any suggestions?
> 
> Best wishes,
> Martin Reismann
> 
> ---
> Martin Reismann
> Institut fuer Wirtschaftsgeographie und Geoinformatik
> Wirtschaftsuniversitaet Wien
> Nordbergstrasse 15, 4. Stock, Kern A
> A-1090 Wien
> 
> EMail: Martin.Reismann at wu-wien.ac.at
> Tel +43-(0)-1-31336-5720
> Fax +43-(0)-1-31336-703
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From ahertel at atmos.uiuc.edu  Thu Jan 19 18:25:10 2006
From: ahertel at atmos.uiuc.edu (Anne Hertel)
Date: Thu, 19 Jan 2006 11:25:10 -0600
Subject: [R-sig-Geo] Maps across the dateline
Message-ID: <web-7417819@atmos.uiuc.edu>

Hello,

I'm trying to plot some data for the Pacific Ocean and want to get a map onto my plot as well. I'm using the function 'map()' from library(maps). However, I cannot get it to plot anything across the dateline since it requires that longitudes between 180 and 360 degrees east to be written as negative degrees east of Greenwich (e.g. -180 to 0 degrees east). The longitudes I want to plot are 135 to 255 degrees east but the function map() wants that to be written 135 to 180 degrees east and -180 to -105 degrees east, so I would have to divide the grid up in two. But even if I do that I can't plot it together because -180 doesn't come after 180.

Does anyone have a way to plot something across the dateline? I only want a map of the Pacific, not the rest of the world.

Thanks,
Anne Hertel


------------------------------------------------------------
Anne M. K. Hertel
Grad. Student & Research Assistant
Department of Atmospheric Sciences
University of Illinois at Urbana-Champaign
Annex II, room 204
Phone: (217) 333 6296



From Greg.Snow at intermountainmail.org  Thu Jan 19 18:49:51 2006
From: Greg.Snow at intermountainmail.org (Gregory Snow)
Date: Thu, 19 Jan 2006 10:49:51 -0700
Subject: [R-sig-Geo] Maps across the dateline
Message-ID: <07E228A5BE53C24CAD490193A7381BBB20171A@LP-EXCHVS07.CO.IHC.COM>

There is a function recenter.Map in the TeachingDemos package that works
with the maptools package (rather than the maps package).  This function
is pretty basic and easy to break, but it may do what you want (or give
you a place to start on creating a better solution).

Hope this helps,

-- 
Gregory (Greg) L. Snow Ph.D.
Statistical Data Center
Intermountain Healthcare
greg.snow at intermountainmail.org
(801) 408-8111
 
 

> -----Original Message-----
> From: r-sig-geo-bounces at stat.math.ethz.ch 
> [mailto:r-sig-geo-bounces at stat.math.ethz.ch] On Behalf Of Anne Hertel
> Sent: Thursday, January 19, 2006 10:25 AM
> To: r-sig-geo at stat.math.ethz.ch
> Subject: [R-sig-Geo] Maps across the dateline
> 
> Hello,
> 
> I'm trying to plot some data for the Pacific Ocean and want 
> to get a map onto my plot as well. I'm using the function 
> 'map()' from library(maps). However, I cannot get it to plot 
> anything across the dateline since it requires that 
> longitudes between 180 and 360 degrees east to be written as 
> negative degrees east of Greenwich (e.g. -180 to 0 degrees 
> east). The longitudes I want to plot are 135 to 255 degrees 
> east but the function map() wants that to be written 135 to 
> 180 degrees east and -180 to -105 degrees east, so I would 
> have to divide the grid up in two. But even if I do that I 
> can't plot it together because -180 doesn't come after 180.
> 
> Does anyone have a way to plot something across the dateline? 
> I only want a map of the Pacific, not the rest of the world.
> 
> Thanks,
> Anne Hertel
> 
> 
> ------------------------------------------------------------
> Anne M. K. Hertel
> Grad. Student & Research Assistant
> Department of Atmospheric Sciences
> University of Illinois at Urbana-Champaign Annex II, room 204
> Phone: (217) 333 6296
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



From White.Denis at epamail.epa.gov  Thu Jan 19 21:01:40 2006
From: White.Denis at epamail.epa.gov (White.Denis at epamail.epa.gov)
Date: Thu, 19 Jan 2006 12:01:40 -0800
Subject: [R-sig-Geo] Maps across the dateline
Message-ID: <OFA19003B5.3FAF2F78-ON882570FB.006E0414-882570FB.006E0418@epamail.epa.gov>



>I'm trying to plot some
>data for the Pacific Ocean and want to get a map onto my plot as
>well.
>I'm using the function 'map()' from library(maps). However, I cannot
>get it to plot anything across the dateline since it requires that
>longitudes between 180 and 360 degrees east to be written as negative
>degrees east of Greenwich (e.g. -180 to 0 degrees east). The
>longitudes
>I want to plot are 135 to 255 degrees east but the function map()
>wants
>that to be written 135 to 180 degrees east and -180 to -105 degrees
>east, so I would have to divide the grid up in two. But even if I do
>that I can't plot it together because -180 doesn't come after 180.
>
>Does anyone have a way to plot something across the dateline? I only
>want a map of the Pacific, not the rest of the world.
>
>Thanks,
>Anne Hertel

If you use an appropriate map projection centered at 180/-180, for
example, then you should be able to plot your data and islands or
latitude/longitude lines as desired.  See the following example for
plotting some random points and the latitude and longitude graticule
lines using one particular map projection.  This projection, the Lambert
azimuthal, is an equal area projection but may not be the most
appropriate for your needs.  There are web sites that can help to choose
a projection if you need it.

# plot data across 180/-180

# Lambert azimuthal equal area map projection
lambaz <- function (lon, lat, clon=NULL, clat=NULL)
  # Arguments are vectors of longitude and latitude,
  # that is, geographic coordinates in decimal degrees.
  # Projection center is (clon, clat), which, if null, is
  # set to the midpoint of the input in lat-lon space.
  # Line identifiers in lon[is.na (lat)] retained in x.
  # Returns a two column matrix with column names "x" and "y",
  # in units of kilometers.  This is Lambert's azimuthal
  # equal area map projection using a spherical earth model.
  # (ref JP Snyder, USGS Prof Paper 1395, p 182 ff).
{
    R <- 6371 # authalic radius of Clarke 1866 rounded to km
    if (is.null (clon) || is.null (clat))
    {
        rlat <- range (lat, na.rm=TRUE)
        rlon <- range (lon, na.rm=TRUE)
        clat <- diff (rlat) / 2 + rlat[1]
        clon <- diff (rlon) / 2 + rlon[1]
    }
    dlon <- (lon - clon) * pi / 180
    cosdlon <- cos (dlon)
    sinlat <- sin (lat * pi / 180)
    coslat <- cos (lat * pi / 180)
    sinclat <- sin (clat * pi / 180)
    cosclat <- cos (clat * pi / 180)
    kp <- 1 + sinclat*sinlat + cosclat*coslat*cosdlon
    kp <- sqrt (2 / kp)
    x <- R * kp * coslat * sin (dlon)
    y <- R * kp * (cosclat*sinlat - sinclat*coslat*cosdlon)
    x[is.na (lat)] <- lon[is.na (lat)]
    xy <- cbind (x=x, y=y)
    xy
}

# generate latitude and longitude graticules
graticule <- function (minlon=-180, maxlon=180,
    minlat=-90, maxlat=90, ginc=10, dinc=2)
{
    dlon <- maxlon - minlon
    dlat <- maxlat - minlat
    nr <- (dlon / dinc + 1) * (dlat / ginc + 1) +
        (dlat / dinc + 1) * (dlon / ginc + 1) +
        dlon / ginc + dlat / ginc + 2
    geo <- matrix (0, nrow=nr, ncol=2)
    i <- n <- 0
    for (lon in seq (minlon, maxlon, by=ginc))
    {
        i <- i + 1
        n <- n + 1
        geo[i, 1] <- n
        geo[i, 2] <- NA
        for (lat in seq (minlat, maxlat, by=dinc))
        {
            i <- i + 1
            geo[i, 1] <- lon
            geo[i, 2] <- lat
        }
    }
    for (lat in seq (minlat, maxlat, by=ginc))
    {
        i <- i + 1
        n <- n + 1
        geo[i, 1] <- n
        geo[i, 2] <- NA
        for (lon in seq (minlon, maxlon, by=dinc))
        {
            i <- i + 1
            geo[i, 1] <- lon
            geo[i, 2] <- lat
        }
    }
    geo
}

# a graticule for central pacific
east.part <- graticule (minlon=-180, maxlon=-150,
                        minlat=-30, maxlat=30)
west.part <- graticule (minlon= 150, maxlon= 180,
                        minlat=-30, maxlat=30)
grat.geo <- rbind (east.part, west.part)
grat.lam <- lambaz (grat.geo[,1], grat.geo[,2], clon=180, clat=0)

# generate random points in central pacific
east.pts <- cbind (runif (100, min=-180, max=-150),
                   runif (100, min=-30, max=30))
west.pts <- cbind (runif (100, min= 150, max= 180),
                   runif (100, min=-30, max=30))
pts.geo <- rbind (east.pts, west.pts)
pts.lam <- lambaz (pts.geo[,1], pts.geo[,2], clon=180, clat=0)

# plot in geographic coordinate space (lat, lon)
plot.new ()
plot.window (range (grat.geo[,1], na.rm=TRUE),
             range (grat.geo[,2], na.rm=TRUE), asp=1)
lines (grat.geo)
points (pts.geo, pch=20)

# plot in Lambert space
plot.new ()
plot.window (range (grat.lam[,1], na.rm=TRUE),
             range (grat.lam[,2], na.rm=TRUE), asp=1)
lines (grat.lam)
points (pts.lam, pch=20)



From kwythers at umn.edu  Thu Jan 19 21:43:53 2006
From: kwythers at umn.edu (Kirk R. Wythers)
Date: Thu, 19 Jan 2006 14:43:53 -0600
Subject: [R-sig-Geo] file format error with R and GRASS61
Message-ID: <4D8D52F7-00A7-4652-826F-E28535A14675@umn.edu>

I am trying to figure out an GDAL error message about grass file not  
being a supported format. The message is:

 > gmeta6 <- gmeta6()
 > fname <- paste(gmeta6$GISDBASE, gmeta6$LOCATION_NAME,
+ "PERMANENT", "cellhd", "soils.ph",
+ sep="/")
 > soilsph_GDAL <- read.GDAL(fname)
Error in .local(.Object, ...) :
         GDAL Error 4: `~/grassdata/spearfish60/PERMANENT/cellhd/ 
soils.ph' not recognised as a supported file format.

This is on grass61 and R 2.2.1 using the spearfish60 location

Thanks in advance for any ideas



From Roger.Bivand at nhh.no  Thu Jan 19 22:01:32 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 19 Jan 2006 22:01:32 +0100 (CET)
Subject: [R-sig-Geo] Maps across the dateline
In-Reply-To: <OFA19003B5.3FAF2F78-ON882570FB.006E0414-882570FB.006E0418@epamail.epa.gov>
Message-ID: <Pine.LNX.4.44.0601192159260.32454-100000@reclus.nhh.no>

On Thu, 19 Jan 2006 White.Denis at epamail.epa.gov wrote:

While there are plenty of good answers to this question, the most direct 
one - given that the maps package is maintained from New Zealand, is to 
use the world2 database it provides:

?world2

which runs 0-360 (roughly), and should be good enough resolution for a 
whole-Pacific map.

Roger

> 
> 
> >I'm trying to plot some
> >data for the Pacific Ocean and want to get a map onto my plot as
> >well.
> >I'm using the function 'map()' from library(maps). However, I cannot
> >get it to plot anything across the dateline since it requires that
> >longitudes between 180 and 360 degrees east to be written as negative
> >degrees east of Greenwich (e.g. -180 to 0 degrees east). The
> >longitudes
> >I want to plot are 135 to 255 degrees east but the function map()
> >wants
> >that to be written 135 to 180 degrees east and -180 to -105 degrees
> >east, so I would have to divide the grid up in two. But even if I do
> >that I can't plot it together because -180 doesn't come after 180.
> >
> >Does anyone have a way to plot something across the dateline? I only
> >want a map of the Pacific, not the rest of the world.
> >
> >Thanks,
> >Anne Hertel
> 
> If you use an appropriate map projection centered at 180/-180, for
> example, then you should be able to plot your data and islands or
> latitude/longitude lines as desired.  See the following example for
> plotting some random points and the latitude and longitude graticule
> lines using one particular map projection.  This projection, the Lambert
> azimuthal, is an equal area projection but may not be the most
> appropriate for your needs.  There are web sites that can help to choose
> a projection if you need it.
> 
> # plot data across 180/-180
> 
> # Lambert azimuthal equal area map projection
> lambaz <- function (lon, lat, clon=NULL, clat=NULL)
>   # Arguments are vectors of longitude and latitude,
>   # that is, geographic coordinates in decimal degrees.
>   # Projection center is (clon, clat), which, if null, is
>   # set to the midpoint of the input in lat-lon space.
>   # Line identifiers in lon[is.na (lat)] retained in x.
>   # Returns a two column matrix with column names "x" and "y",
>   # in units of kilometers.  This is Lambert's azimuthal
>   # equal area map projection using a spherical earth model.
>   # (ref JP Snyder, USGS Prof Paper 1395, p 182 ff).
> {
>     R <- 6371 # authalic radius of Clarke 1866 rounded to km
>     if (is.null (clon) || is.null (clat))
>     {
>         rlat <- range (lat, na.rm=TRUE)
>         rlon <- range (lon, na.rm=TRUE)
>         clat <- diff (rlat) / 2 + rlat[1]
>         clon <- diff (rlon) / 2 + rlon[1]
>     }
>     dlon <- (lon - clon) * pi / 180
>     cosdlon <- cos (dlon)
>     sinlat <- sin (lat * pi / 180)
>     coslat <- cos (lat * pi / 180)
>     sinclat <- sin (clat * pi / 180)
>     cosclat <- cos (clat * pi / 180)
>     kp <- 1 + sinclat*sinlat + cosclat*coslat*cosdlon
>     kp <- sqrt (2 / kp)
>     x <- R * kp * coslat * sin (dlon)
>     y <- R * kp * (cosclat*sinlat - sinclat*coslat*cosdlon)
>     x[is.na (lat)] <- lon[is.na (lat)]
>     xy <- cbind (x=x, y=y)
>     xy
> }
> 
> # generate latitude and longitude graticules
> graticule <- function (minlon=-180, maxlon=180,
>     minlat=-90, maxlat=90, ginc=10, dinc=2)
> {
>     dlon <- maxlon - minlon
>     dlat <- maxlat - minlat
>     nr <- (dlon / dinc + 1) * (dlat / ginc + 1) +
>         (dlat / dinc + 1) * (dlon / ginc + 1) +
>         dlon / ginc + dlat / ginc + 2
>     geo <- matrix (0, nrow=nr, ncol=2)
>     i <- n <- 0
>     for (lon in seq (minlon, maxlon, by=ginc))
>     {
>         i <- i + 1
>         n <- n + 1
>         geo[i, 1] <- n
>         geo[i, 2] <- NA
>         for (lat in seq (minlat, maxlat, by=dinc))
>         {
>             i <- i + 1
>             geo[i, 1] <- lon
>             geo[i, 2] <- lat
>         }
>     }
>     for (lat in seq (minlat, maxlat, by=ginc))
>     {
>         i <- i + 1
>         n <- n + 1
>         geo[i, 1] <- n
>         geo[i, 2] <- NA
>         for (lon in seq (minlon, maxlon, by=dinc))
>         {
>             i <- i + 1
>             geo[i, 1] <- lon
>             geo[i, 2] <- lat
>         }
>     }
>     geo
> }
> 
> # a graticule for central pacific
> east.part <- graticule (minlon=-180, maxlon=-150,
>                         minlat=-30, maxlat=30)
> west.part <- graticule (minlon= 150, maxlon= 180,
>                         minlat=-30, maxlat=30)
> grat.geo <- rbind (east.part, west.part)
> grat.lam <- lambaz (grat.geo[,1], grat.geo[,2], clon=180, clat=0)
> 
> # generate random points in central pacific
> east.pts <- cbind (runif (100, min=-180, max=-150),
>                    runif (100, min=-30, max=30))
> west.pts <- cbind (runif (100, min= 150, max= 180),
>                    runif (100, min=-30, max=30))
> pts.geo <- rbind (east.pts, west.pts)
> pts.lam <- lambaz (pts.geo[,1], pts.geo[,2], clon=180, clat=0)
> 
> # plot in geographic coordinate space (lat, lon)
> plot.new ()
> plot.window (range (grat.geo[,1], na.rm=TRUE),
>              range (grat.geo[,2], na.rm=TRUE), asp=1)
> lines (grat.geo)
> points (pts.geo, pch=20)
> 
> # plot in Lambert space
> plot.new ()
> plot.window (range (grat.lam[,1], na.rm=TRUE),
>              range (grat.lam[,2], na.rm=TRUE), asp=1)
> lines (grat.lam)
> points (pts.lam, pch=20)
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From Roger.Bivand at nhh.no  Thu Jan 19 22:06:49 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 19 Jan 2006 22:06:49 +0100 (CET)
Subject: [R-sig-Geo] file format error with R and GRASS61
In-Reply-To: <4D8D52F7-00A7-4652-826F-E28535A14675@umn.edu>
Message-ID: <Pine.LNX.4.44.0601192202030.32454-100000@reclus.nhh.no>

On Thu, 19 Jan 2006, Kirk R. Wythers wrote:

> I am trying to figure out an GDAL error message about grass file not  
> being a supported format. The message is:
> 
>  > gmeta6 <- gmeta6()
>  > fname <- paste(gmeta6$GISDBASE, gmeta6$LOCATION_NAME,
> + "PERMANENT", "cellhd", "soils.ph",
> + sep="/")
>  > soilsph_GDAL <- read.GDAL(fname)
> Error in .local(.Object, ...) :
>          GDAL Error 4: `~/grassdata/spearfish60/PERMANENT/cellhd/ 
> soils.ph' not recognised as a supported file format.

If r.out.gdal works for you on that file, then we have a problem. However, 
I think that your GRASS GDAL plugin is not present, so GDAL doesn't know 
how to read GRASS rasters natively. What does 

> getGDALDriverNames()

say within R after loading the rgdal package, or equivalently

$ gdalinfo --formats

from the shell prompt? If you see "GRASS" there, we have a problem, if 
not, please make sure the GDAL GRASS plugin is installed and working (one 
does this *after* installing GRASS.

Roger

> 
> This is on grass61 and R 2.2.1 using the spearfish60 location
> 
> Thanks in advance for any ideas
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From kwythers at umn.edu  Thu Jan 19 22:22:03 2006
From: kwythers at umn.edu (Kirk R. Wythers)
Date: Thu, 19 Jan 2006 15:22:03 -0600
Subject: [R-sig-Geo] file format error with R and GRASS61
In-Reply-To: <Pine.LNX.4.44.0601192202030.32454-100000@reclus.nhh.no>
References: <Pine.LNX.4.44.0601192202030.32454-100000@reclus.nhh.no>
Message-ID: <FF9D5077-27F7-4D04-BD05-B42DC3B4DC98@umn.edu>


On Jan 19, 2006, at 3:06 PM, Roger Bivand wrote:

> On Thu, 19 Jan 2006, Kirk R. Wythers wrote:
>
>> I am trying to figure out an GDAL error message about grass file not
>> being a supported format. The message is:
>>
>>> gmeta6 <- gmeta6()
>>> fname <- paste(gmeta6$GISDBASE, gmeta6$LOCATION_NAME,
>> + "PERMANENT", "cellhd", "soils.ph",
>> + sep="/")
>>> soilsph_GDAL <- read.GDAL(fname)
>> Error in .local(.Object, ...) :
>>          GDAL Error 4: `~/grassdata/spearfish60/PERMANENT/cellhd/
>> soils.ph' not recognised as a supported file format.
>
> If r.out.gdal works for you on that file, then we have a problem.  
> However,
> I think that your GRASS GDAL plugin is not present, so GDAL doesn't  
> know
> how to read GRASS rasters natively. What does
>
>> getGDALDriverNames()

 > getGDALDriverNames()
[1] "VRT"       "GTiff"     "NITF"      "HFA"       "SAR_CEOS"  "CEOS"
[7] "ELAS"      "AIG"       "AAIGrid"   "SDTS"      "OGDI"      "DTED"
[13] "PNG"       "JPEG"      "MEM"       "JDEM"      "GIF"       "ESAT"
[19] "BSB"       "XPM"       "BMP"       "AirSAR"    "RS2"        
"PCIDSK"
[25] "PCRaster"  "ILWIS"     "RIK"       "GMT"       "netCDF"    "HDF4"
[31] "HDF4Image" "PNM"       "DOQ1"      "DOQ2"      "ENVI"      "EHdr"
[37] "PAux"      "MFF"       "MFF2"      "FujiBAS"   "GSC"       "FAST"
[43] "BT"        "LAN"       "CPG"       "IDA"       "NDF"        
"JPEG2000"
[49] "L1B"       "FIT"       "RMF"       "USGSDEM"   "GXF"
 >


>
> say within R after loading the rgdal package, or equivalently
>
> $ gdalinfo --formats

the same

>
> from the shell prompt? If you see "GRASS" there, we have a problem, if
> not, please make sure the GDAL GRASS plugin

I thought I had this installed. You are talking about Frank's 1.3.1  
version gdal, right?

I used the config options:

./configure --mandir=/usr/local/share/man --without-python --with- 
threads --with
-static-proj4=/usr/local --with-libtiff=/usr/local --with-geotiff=/ 
usr/local --w
ith-jpeg=/usr/local --with-gif=/usr/local --with-png=/usr/local -- 
with-jasper=/u
sr/local --with-pg=/usr/local/pgsql/bin/pg_config --with-mysql=/usr/ 
local/mysql/
bin/mysql_config --with-netcdf=/Volumes/disk1/home1/kwythers/src/ 
netcdf-3.6.0-p1
--with-hdf4=/Volumes/disk1/home1/kwythers/src/HDF4.2r1/hdf4-darwin - 
with-ogdi=/
usr/local --with-geos=/usr/local/bin/geos-config --with-grass=/usr/ 
local/grass-6
.1.cvs



> is installed and working (one
> does this *after* installing GRASS.
>
> Roger
>
>>
>> This is on grass61 and R 2.2.1 using the spearfish60 location
>>
>> Thanks in advance for any ideas
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> -- 
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian  
> School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>



From kwythers at umn.edu  Thu Jan 19 22:30:40 2006
From: kwythers at umn.edu (Kirk R. Wythers)
Date: Thu, 19 Jan 2006 15:30:40 -0600
Subject: [R-sig-Geo] file format error with R and GRASS61
In-Reply-To: <Pine.LNX.4.44.0601192202030.32454-100000@reclus.nhh.no>
References: <Pine.LNX.4.44.0601192202030.32454-100000@reclus.nhh.no>
Message-ID: <6C0CEA71-B01C-48EA-BEDA-5CC1194EA946@umn.edu>


On Jan 19, 2006, at 3:06 PM, Roger Bivand wrote:

> On Thu, 19 Jan 2006, Kirk R. Wythers wrote:
>
>> I am trying to figure out an GDAL error message about grass file not
>> being a supported format. The message is:
>>
>>> gmeta6 <- gmeta6()
>>> fname <- paste(gmeta6$GISDBASE, gmeta6$LOCATION_NAME,
>> + "PERMANENT", "cellhd", "soils.ph",
>> + sep="/")
>>> soilsph_GDAL <- read.GDAL(fname)
>> Error in .local(.Object, ...) :
>>          GDAL Error 4: `~/grassdata/spearfish60/PERMANENT/cellhd/
>> soils.ph' not recognised as a supported file format.
>
> If r.out.gdal works for you on that file, then we have a problem.  
> However,
> I think that your GRASS GDAL plugin is not present, so GDAL doesn't  
> know
> how to read GRASS rasters natively. What does
>
>> getGDALDriverNames()
>
> say within R after loading the rgdal package, or equivalently
>
> $ gdalinfo --formats
>
> from the shell prompt? If you see "GRASS" there, we have a problem, if
> not, please make sure the GDAL GRASS plugin is installed and  
> working (one
> does this *after* installing GRASS.

That was it Roger. Thanks. I was sure that I had the plugin  
installed, but after rebuilding gdal-withgrass and reinstalling,  
read.GDAL ran just fine.


>
> Roger
>
>>
>> This is on grass61 and R 2.2.1 using the spearfish60 location
>>
>> Thanks in advance for any ideas
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> -- 
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian  
> School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>



From Scott_Mitchell at carleton.ca  Fri Jan 20 19:13:30 2006
From: Scott_Mitchell at carleton.ca (Scott Mitchell)
Date: Fri, 20 Jan 2006 13:13:30 -0500
Subject: [R-sig-Geo] file format error with R and GRASS61
In-Reply-To: <6C0CEA71-B01C-48EA-BEDA-5CC1194EA946@umn.edu>
References: <Pine.LNX.4.44.0601192202030.32454-100000@reclus.nhh.no>
	<6C0CEA71-B01C-48EA-BEDA-5CC1194EA946@umn.edu>
Message-ID: <99D33528-8E78-41F5-8861-5FA336A2E0BA@carleton.ca>

On 19-Jan-06, at 16:30, Kirk R. Wythers wrote:

> On Jan 19, 2006, at 3:06 PM, Roger Bivand wrote:
>
>> On Thu, 19 Jan 2006, Kirk R. Wythers wrote:
>>
>>> I am trying to figure out an GDAL error message about grass file not
>>> being a supported format. The message is:

...

>> If r.out.gdal works for you on that file, then we have a problem.
>> However, I think that your GRASS GDAL plugin is not present, so  
>> GDAL doesn't
>> know how to read GRASS rasters natively. What does
>>
>>> getGDALDriverNames()
>>
>> say within R after loading the rgdal package, or equivalently
>>
>> $ gdalinfo --formats
>>
>> from the shell prompt? If you see "GRASS" there, we have a  
>> problem, if
>> not, please make sure the GDAL GRASS plugin is installed and
>> working (one
>> does this *after* installing GRASS.
>
> That was it Roger. Thanks. I was sure that I had the plugin
> installed, but after rebuilding gdal-withgrass and reinstalling,
> read.GDAL ran just fine.
>

Great to hear that you got it working!

The procedure Roger was referring to for making everyone play  
correctly is slightly different, however, assuming I'm interpreting  
your message correctly.  So to make sure it's archived in the mailing  
list, here's what I've gathered is now the way to go (same idea for  
getting GRASS support fully functional in QGIS, by the way):

- build and install GDAL WITHOUT GRASS support
- build and install GRASS
- download the separate gdal-grass plugin that is available at the  
gdal site
(as of this writing, that's http://www.gdal.org/dl/gdal- 
grass-1.3.1.1.tar.gz )
and compile that, and the make install process in that directory will  
insert just
the GRASS driver into your existing GDAL tree

Then GDAL called from 3rd applications, e.g. R or QGIS, should be  
able to read GRASS rasters.

I don't know/can't remember whether this essentially does the same  
thing as what you did
(i.e. I'm assuming you've recompiled the full GDAL after GRASS with  
GRASS functionality turned on), or if there's a functional  
difference.  In any case, it's simpler, and is designed
to avoid circular dependency problems.

Cheers,
Scott Mitchell

----
Scott Mitchell, Assistant Professor, Carleton University
Department of Geography & Environmental Studies, Loeb A209
Mailing:  Loeb B349, 1125 Colonel By Dr., Ottawa, ON K1S 5B6 Canada
1-613-520-2600 x2695 Fax: 613-520-4301 Scott_Mitchell at carleton.ca



From kwythers at umn.edu  Fri Jan 20 19:41:25 2006
From: kwythers at umn.edu (Kirk R. Wythers)
Date: Fri, 20 Jan 2006 12:41:25 -0600
Subject: [R-sig-Geo] file format error with R and GRASS61
In-Reply-To: <99D33528-8E78-41F5-8861-5FA336A2E0BA@carleton.ca>
References: <Pine.LNX.4.44.0601192202030.32454-100000@reclus.nhh.no>
	<6C0CEA71-B01C-48EA-BEDA-5CC1194EA946@umn.edu>
	<99D33528-8E78-41F5-8861-5FA336A2E0BA@carleton.ca>
Message-ID: <0B00B644-9694-4251-BA4D-B70FDC1E006D@umn.edu>


On Jan 20, 2006, at 12:13 PM, Scott Mitchell wrote:

>
> Great to hear that you got it working!

Thanks Scott. I appreciate your desire to get the solution  
documented. Here are the details...

>
> The procedure Roger was referring to for making everyone play  
> correctly is slightly different, however, assuming I'm interpreting  
> your message correctly.  So to make sure it's archived in the  
> mailing list, here's what I've gathered is now the way to go (same  
> idea for getting GRASS support fully functional in QGIS, by the way):
>
> - build and install GDAL WITHOUT GRASS support

gdal-1.3.1

./configure
	--mandir=/usr/local/share/man
	--without-python
	--with-threads
	--with-static-proj4=/usr/local
	--with-libtiff=/usr/local
	--with-geotiff=/usr/local
	--with-jpeg=/usr/local
	--with-gif=/usr/local
	--with-png=/usr/local
	--with-jasper=/usr/local
	--with-pg=/usr/local/pgsql/bin/pg_config
	--with-mysql=/usr/local/mysql/bin/mysql_config
	--with-netcdf=/Volumes/disk1/home1/kwythers/src/netcdf-3.6.0-p1
	--with-hdf4=/Volumes/disk1/home1/kwythers/src/HDF4.2r1/hdf4-darwin
	--with-ogdi=/usr/local
	--with-geos=/usr/local/bin/geos-config


> - build and install GRASS

grass-6.1.cvs

./configure\
     --enable-64bit\
     --enable-sysv\
     --with-includes=/usr/X11R6/include\
     --with-libs=/usr/X11R6/lib\
     --with-freetype\
     --with-tcltk-includes=/usr/X11R6/include\
     --with-tcltk-libs=/usr/X11R6/lib\
     --with-gdal=/usr/local/bin/gdal-config\
     --with-proj\
     --with-x\
     --with-cxx\
     --with-glw\
     --with-motif\
     --without-odbc\
     --enable-shared\
     --with-postgres-includes=/usr/local/pgsql/include\
     --with-postgres-libs=/usr/local/pgsql/lib\
     --with-mysql\
     --with-mysql-includes=/usr/local/mysql/include\
     --with-mysql-libs=/usr/local/mysql/lib\
     --with-freetype-includes=/usr/local/include/freetype2


> - download the separate gdal-grass plugin that is available at the  
> gdal site
> (as of this writing, that's http://www.gdal.org/dl/gdal- 
> grass-1.3.1.1.tar.gz )

In my case I just reconfigured and re-installed gdal-1.3.1 with:

./configure
	--mandir=/usr/local/share/man
	--without-python
	--with-threads
	--with-static-proj4=/usr/local
	--with-libtiff=/usr/local
	--with-geotiff=/usr/local
	--with-jpeg=/usr/local
	--with-gif=/usr/local
	--with-png=/usr/local
	--with-jasper=/usr/local
	--with-pg=/usr/local/pgsql/bin/pg_config
	--with-mysql=/usr/local/mysql/bin/mysql_config
	--with-netcdf=/Volumes/disk1/home1/kwythers/src/netcdf-3.6.0-p1
	--with-hdf4=/Volumes/disk1/home1/kwythers/src/HDF4.2r1/hdf4-darwin
	--with-ogdi=/usr/local
	--with-geos=/usr/local/bin/geos-config
	--with-grass=/usr/local/grass-6.1.cvs


> and compile that, and the make install process in that directory  
> will insert just
> the GRASS driver into your existing GDAL tree

Perhaps this approach would be more efficient. I assume that http:// 
www.gdal.org/dl/gdal-grass-1.3.1.1.tar.gz  does not rebuild and  
reinstall whole gdal application?

>
> Then GDAL called from 3rd applications, e.g. R or QGIS, should be  
> able to read GRASS rasters.
>
> I don't know/can't remember whether this essentially does the same  
> thing as what you did
> (i.e. I'm assuming you've recompiled the full GDAL after GRASS with  
> GRASS functionality turned on), or if there's a functional  
> difference.  In any case, it's simpler, and is designed
> to avoid circular dependency problems.

I agree your approach would be simpler. Although since have not had  
any trouble getting qgis builds to read grass vectors or rasters, it  
would seem that both approaches work.


>
> Cheers,
> Scott Mitchell
>
> ----
> Scott Mitchell, Assistant Professor, Carleton University
> Department of Geography & Environmental Studies, Loeb A209
> Mailing:  Loeb B349, 1125 Colonel By Dr., Ottawa, ON K1S 5B6 Canada
> 1-613-520-2600 x2695 Fax: 613-520-4301 Scott_Mitchell at carleton.ca
>
>



From Roger.Bivand at nhh.no  Fri Jan 20 20:38:25 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 20 Jan 2006 20:38:25 +0100 (CET)
Subject: [R-sig-Geo] ANN: Europe and its Regions Conference
Message-ID: <Pine.LNX.4.44.0601202031170.1154-100000@reclus.nhh.no>

I've been asked to circulate a call for papers for a meeting in Berlin 30
June and 1 July on "Europe and its Regions: The Usage of European
Regionalized Social Science Data" by Wenzel Matiaske:

"I'm writing you as maintainer of the R spatial projects. We - Gerd
Groezinger, Katharina Spiess and myself are organising a conference
entitled: "Europe and its Regions: The Usage of European Regionalized
Social Science Data" (6/30/06 and 7/1/06 DIW Berlin). The conference
should inform about data sets, applications and specialized methods for
regionalized data.

Actually we are missing the last point: We have no contributions on
methods or software packages in the area to spatial data analysis.  I am
writing to ask if you would circulate our call for papers and this mail to
R-sig-Geo to encourage proposals in methods or software packages;
particularly we are interested in an overview paper on R spatial projects
and other software projects.

In ignorance of the deadline mentioned in our call for papers, proposals
(max. 1 page) should be send in until the 31st of January."

I thought it worth passing this on because there are probably a number of 
social science researchers using European regional data on the list, who 
might feel like taking up the challenge of presenting how R and these 
kinds of data might work together. I've put the CFP on:

http://spatial.nhh.no/misc/europe-regional.pdf

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From neteler at itc.it  Mon Jan 23 13:42:54 2006
From: neteler at itc.it (Markus Neteler)
Date: Mon, 23 Jan 2006 13:42:54 +0100
Subject: [R-sig-Geo] file format error with R and GRASS61
In-Reply-To: <99D33528-8E78-41F5-8861-5FA336A2E0BA@carleton.ca>
References: <Pine.LNX.4.44.0601192202030.32454-100000@reclus.nhh.no>
	<6C0CEA71-B01C-48EA-BEDA-5CC1194EA946@umn.edu>
	<99D33528-8E78-41F5-8861-5FA336A2E0BA@carleton.ca>
Message-ID: <20060123124254.GC9264@bartok.itc.it>

On Fri, Jan 20, 2006 at 01:13:30PM -0500, Scott Mitchell wrote:
...
> So to make sure it's archived in the mailing  
> list, here's what I've gathered is now the way to go (same idea for  
> getting GRASS support fully functional in QGIS, by the way):
> 
> - build and install GDAL WITHOUT GRASS support
> - build and install GRASS
> - download the separate gdal-grass plugin that is available at the  
>  gdal site
> (as of this writing, that's http://www.gdal.org/dl/gdal-grass-1.3.1.1.tar.gz )
> and compile that, and the make install process in that directory will  
> insert just the GRASS driver into your existing GDAL tree

This is documented in the GRASS Wiki:

http://grass.gdf-hannover.de/twiki/bin/view/GRASS/WebHome
->  How to compile/install GRASS and QGIS with GDAL/OGR Plugin
    http://grass.gdf-hannover.de/twiki/bin/view/GRASS/GrassQgisGdalOgrPlugin


Best
 Markus



From s0198247 at sms.ed.ac.uk  Tue Jan 24 16:56:26 2006
From: s0198247 at sms.ed.ac.uk (Luke Spadavecchia)
Date: Tue, 24 Jan 2006 15:56:26 +0000
Subject: [R-sig-Geo] External Drift Kriging
Message-ID: <43D64E2A.9040002@sms.ed.ac.uk>

Hello!

I am currently studying my PhD at Edinburgh University, and I have 
recently been moving to R as my main data analysis package. One of the 
main reasons for this is the availability of GeoR, which will allow me 
to do everything I need to do in one environment. However, I am 
currently having a few problems getting up and running with the 
krige.conv command. I am trying to krige annual average temperatures 
from 112 met stations located in the Eastern Cascade mountains of 
Oregon. The data are highly non-stationary, due to the presence of a 
linear lapse response between the temperature and the altitude (the 
altitudinal range here is considerable). I have quantified this response 
at a loss of 3.5 degrees centegrade per 1km rise. I have removed this 
trend from the data, and produced a zero mean, gaussian distributed 
stationary process, and from this derived the spatial covarince structure.

The problem is that I only want to predict values from a small subset of 
the area which the stations occupy; although some stations are outwith 
the required borders, they are more or less within the range of the 
covariance function. I have an elevation model for the prediction 
locations, but due to computational limitations, cannot extend this to 
cover the full area: thus trend.l is only specified within the borders. 
All of the stations have elevations attached, and so I am able to 
specify trend.d. To summarise I have the following:

grid                     [a 1km grid which covers the entire domain of 
interest, containing all the met stations]
lc                        [a two dimensional matrix specifying the 
borders for prediction]
Normals             [a geodata object with data on the annual station 
temperature average]
pts                      [a geodata object with data on the station 
elevations]
cressie_cu           [a variogram model (cressie weights, cubic model), 
derived from the residuals of the linear model average_temp~elevation]
DEM                  [a geodata object with elevation data at 1km 
spacing for all prediction locations within lc]

I am attempting the following:

pars <- krige.control(obj.m=cressie_cu,
                               trend.d = trend.spatial(~data, pts),
                               trend.l = trend.spatial(~data,DEM))

kc <- krige.conv(Normals, loc = grid, borders = lc, krige = pars)

On trying to execute the commands, I get an output which has lots of 
lines and other artifacts running through it, which seems to bear no 
resemblance to the expected output at all. Could you please suggest what 
I am getting wrong?

Many thanks

Luke Spadavecchia



From paulojus at est.ufpr.br  Thu Jan 26 15:00:21 2006
From: paulojus at est.ufpr.br (Paulo Justiniano Ribeiro Jr)
Date: Thu, 26 Jan 2006 12:00:21 -0200 (BRST)
Subject: [R-sig-Geo] External Drift Kriging
In-Reply-To: <43D64E2A.9040002@sms.ed.ac.uk>
References: <43D64E2A.9040002@sms.ed.ac.uk>
Message-ID: <Pine.LNX.4.63.0601261148590.1735@est.ufpr.br>

Hi Luke

> krige.conv command. I am trying to krige annual average temperatures
> from 112 met stations located in the Eastern Cascade mountains of
> Oregon. The data are highly non-stationary, due to the presence of a
> linear lapse response between the temperature and the altitude (the
> altitudinal range here is considerable). I have quantified this response
> at a loss of 3.5 degrees centegrade per 1km rise. I have removed this
> trend from the data, and produced a zero mean, gaussian distributed
> stationary process, and from this derived the spatial covarince structure.
>

OK. This is one option indeed, to modelling covariance after getting 
"residuals" from some kind of model to take auto the effect of known 
sources of variation.
And indeed the usual variogram will only make sense for stationary data.

In the max. lik. estimation you can do both together, getting estimates 
for a (linear) model for the mean and for the covariance parameters.

An example call would be something along the lines

> ml <- likfit(foo, trend=~altitude)
provided foo is a geodata object with covariate information on altitude

Later for kriging you would need a call of the type:
> krige.conv(foo, loc=gr, krige=krige.control(obj=ml, trend.d=~altitude, 
trend.l = ~altitude.gr), borders=NULL)

where gr is a matrix with coordinates of prediction points and
altitude.gr is the value of the covariate at those prediction points,

> The problem is that I only want to predict values from a small subset of
> the area which the stations occupy; although some stations are outwith
> the required borders, they are more or less within the range of the
> covariance function. I have an elevation model for the prediction
> locations, but due to computational limitations, cannot extend this to
> cover the full area: thus trend.l is only specified within the borders.

So you can only krige within the borders, unless you extrapolate your 
covariate information somehow.
Kriging with external trend (w/ covariates) requires values of the 
coavriates at all prediction locations.


Hope this helps, and if the problempersists feel free to contact me 
directly

best
P.J.



> All of the stations have elevations attached, and so I am able to
> specify trend.d. To summarise I have the following:
>
> grid                     [a 1km grid which covers the entire domain of
> interest, containing all the met stations]
> lc                        [a two dimensional matrix specifying the
> borders for prediction]
> Normals             [a geodata object with data on the annual station
> temperature average]
> pts                      [a geodata object with data on the station
> elevations]
> cressie_cu           [a variogram model (cressie weights, cubic model),
> derived from the residuals of the linear model average_temp~elevation]
> DEM                  [a geodata object with elevation data at 1km
> spacing for all prediction locations within lc]
>
> I am attempting the following:
>
> pars <- krige.control(obj.m=cressie_cu,
>                               trend.d = trend.spatial(~data, pts),
>                               trend.l = trend.spatial(~data,DEM))
>
> kc <- krige.conv(Normals, loc = grid, borders = lc, krige = pars)
>
> On trying to execute the commands, I get an output which has lots of
> lines and other artifacts running through it, which seems to bear no
> resemblance to the expected output at all. Could you please suggest what
> I am getting wrong?
>
> Many thanks
>
> Luke Spadavecchia
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>

Paulo Justiniano Ribeiro Jr
LEG (Laborat?rio de Estat?stica e Geoinforma??o)
Departamento de Estat?stica
Universidade Federal do Paran?
Caixa Postal 19.081
CEP 81.531-990
Curitiba, PR  -  Brasil
Tel: (+55) 41 3361 3573
Fax: (+55) 41 3361 3141
e-mail: paulojus at est.ufpr.br
http://www.est.ufpr.br/~paulojus

From Roger.Bivand at nhh.no  Thu Jan 26 16:50:02 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 26 Jan 2006 16:50:02 +0100 (CET)
Subject: [R-sig-Geo] useR! 2006 - Submission Deadline 2006-02-28
Message-ID: <Pine.LNX.4.44.0601261644510.3836-100000@reclus.nhh.no>

Once again, spatial statistics is a chosen topic for the useR! conference. 
It will be great to meet in Vienna, and very interesting to hear and see 
what contributors have been doing. Please consider taking part actively!

Here are the current details:

"The submission deadline for `useR! 2006', the second R user conference to
be held in Vienna June 15-17 2006, is only four weeks ahead. Now is the
perfect time to submit abstracts for user-contributed sessions!

The sessions will be a platform to bring together R users, contributers,
package maintainers and developers in the S spirit that `users are developers'.
People from different fields will show us how they solve problems
with R in fascinating applications, including
  - Applied Statistics & Biostatistics
  - Bayesian Statistics
  - Bioinformatics
  - Econometrics & Finance
  - Machine Learning
  - Marketing
  - Robust Statistics
  - Spatial Statistics
  - Statistics in the Social and Political Sciences
  - Teaching
  - Visualization & Graphics
  - and many more.

We invite all R users to submit abstracts on topics presenting innovations or
exciting applications of R. A web page offering more information on the `useR!'
conference, abstract submission, registration and Vienna is available at

  http://www.R-project.org/useR-2006/

We will accept submissions until February 28, 2006.

Let the contributions roll in!


The organizing committee:

Torsten Hothorn, Achim Zeileis, David Meyer, Bettina Gruen,
Kurt Hornik and Friedrich Leisch"

--
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From hi_ono2001 at yahoo.co.jp  Thu Jan 26 18:50:36 2006
From: hi_ono2001 at yahoo.co.jp (Hisaji ONO)
Date: Fri, 27 Jan 2006 02:50:36 +0900 (JST)
Subject: [R-sig-Geo] New Spatial Analysis Book using R
Message-ID: <20060126175036.96822.qmail@web10702.mail.bbt.yahoo.co.jp>

Hello.

 Within a few months, spatial analysis book written in
Japanese, which I co-wrote one chapter which explained
some spatial analysis methods using spatial analysis tool,
developed by me, based on R with some nice spatial
packages.

 In North America or Europe, any Spatial Analysis Text
Books using R will be published? I've been very interested
in them.

 Regards.



From horacio.samaniego at gmail.com  Fri Jan 27 02:15:31 2006
From: horacio.samaniego at gmail.com (Horacio Samaniego)
Date: Fri, 27 Jan 2006 02:15:31 +0100
Subject: [R-sig-Geo] compiling spproj on osx
Message-ID: <9BD95BF3-7FB7-4E7D-AC7F-90690DCE96D1@unm.edu>

I got to the point where I would need the spproj package to reproject  
som sp dataframes. However, when I try to install the package from  
http://r-spatial.sourceforge.net/R/src/contrib/spproj_0.3-4.tar.gz,   
I get the following error.
Is this an incompatibility with os x 10.4 or am I missing something  
in my path?


########## error output ##############

su-2.05b# R CMD INSTALL spproj_0.3-4.tar.gz
* Installing *source* package 'spproj' ...
creating cache ./config.cache
checking for pj_init_plus in -lproj... yes
checking how to run the C preprocessor... cc -E
checking for proj_api.h... yes
updating cache ./config.cache
creating ./config.status
creating src/Makevars
** libs
gcc-3.3 -no-cpp-precomp -I/Library/Frameworks/R.framework/Resources/ 
include  -I/usr/local/include   -fno-common  -g -O2 -c projectit.c -o  
projectit.o
gcc-3.3 -bundle -flat_namespace -undefined suppress -L/usr/local/lib - 
o spproj.so projectit.o -lproj -lcc_dynamic -F/Library/Frameworks/ 
R.framework/.. -framework R
ld: can't locate file for: -lcc_dynamic
make: *** [spproj.so] Error 1
ERROR: compilation failed for package 'spproj'
** Removing '/Library/Frameworks/R.framework/Versions/2.2/Resources/ 
library/spproj'

#################################


Any hint is appreciated!
thanks

H



From Roger.Bivand at nhh.no  Fri Jan 27 09:15:00 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 27 Jan 2006 09:15:00 +0100 (CET)
Subject: [R-sig-Geo] compiling spproj on osx
In-Reply-To: <9BD95BF3-7FB7-4E7D-AC7F-90690DCE96D1@unm.edu>
Message-ID: <Pine.LNX.4.44.0601270902080.4799-100000@reclus.nhh.no>

On Fri, 27 Jan 2006, Horacio Samaniego wrote:

> I got to the point where I would need the spproj package to reproject  
> som sp dataframes. However, when I try to install the package from  
> http://r-spatial.sourceforge.net/R/src/contrib/spproj_0.3-4.tar.gz,   
> I get the following error.
> Is this an incompatibility with os x 10.4 or am I missing something  
> in my path?

The authors and maintainers have no access to OSX, so we can't help. Can 
you build and install other source packages including compiled C code? Was 
your R installed from binary or source? Which OSX is this? Have you looked 
on the R-sig-Mac list archives https://stat.ethz.ch/pipermail/r-sig-mac/. 
I guess you have looked at the FAQ - "2.1.3 libreadline 4.3 or higher" 
mentions the -lcc_dynamic issue, but I don't know if this applies to you. 
There is also a wiki at http://wiki.urbanek.info/index.cgi?HomePage

Without (intimate) knowledge of OSX (with many versions) and the build 
trains (with even more versions), it isn't easy to help.

Roger
 
> 
> 
> ########## error output ##############
> 
> su-2.05b# R CMD INSTALL spproj_0.3-4.tar.gz
> * Installing *source* package 'spproj' ...
> creating cache ./config.cache
> checking for pj_init_plus in -lproj... yes
> checking how to run the C preprocessor... cc -E
> checking for proj_api.h... yes
> updating cache ./config.cache
> creating ./config.status
> creating src/Makevars
> ** libs
> gcc-3.3 -no-cpp-precomp -I/Library/Frameworks/R.framework/Resources/ 
> include  -I/usr/local/include   -fno-common  -g -O2 -c projectit.c -o  
> projectit.o
> gcc-3.3 -bundle -flat_namespace -undefined suppress -L/usr/local/lib - 
> o spproj.so projectit.o -lproj -lcc_dynamic -F/Library/Frameworks/ 
> R.framework/.. -framework R
> ld: can't locate file for: -lcc_dynamic
> make: *** [spproj.so] Error 1
> ERROR: compilation failed for package 'spproj'
> ** Removing '/Library/Frameworks/R.framework/Versions/2.2/Resources/ 
> library/spproj'
> 
> #################################
> 
> 
> Any hint is appreciated!
> thanks
> 
> H
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From horacio.samaniego at gmail.com  Fri Jan 27 16:08:22 2006
From: horacio.samaniego at gmail.com (Horacio Samaniego)
Date: Fri, 27 Jan 2006 16:08:22 +0100
Subject: [R-sig-Geo] compiling spproj on osx
In-Reply-To: <Pine.LNX.4.44.0601270902080.4799-100000@reclus.nhh.no>
References: <Pine.LNX.4.44.0601270902080.4799-100000@reclus.nhh.no>
Message-ID: <7CFA6577-3440-4D3C-ADEB-CB0D9107C621@gmail.com>

With the kind insight of Roger, I have been able to identify and  
solve the problem. Here is a summary:

If you have upgraded your OSX system from Panther to Tiger you should  
know that the compilers have changed from gcc3.3 to gcc4.0 this  
creates some instabilities when it comes to compile R packages which  
are well explained here: https://stat.ethz.ch/pipermail/r-sig-mac/ 
2005-July/002031.html

in short you need to make sure that the system uses gcc-3.3 by  
running `gcc_select 3.3' before you compile the package which in my  
case was spproj and spGDAL

This solved my installation issue, I hope it'll help.

thanks,

Horacio


On Jan 27, 2006, at 9:15 AM, Roger Bivand wrote:

On Fri, 27 Jan 2006, Horacio Samaniego wrote:

> I got to the point where I would need the spproj package to reproject
> som sp dataframes. However, when I try to install the package from
> http://r-spatial.sourceforge.net/R/src/contrib/spproj_0.3-4.tar.gz,
> I get the following error.
> Is this an incompatibility with os x 10.4 or am I missing something
> in my path?

The authors and maintainers have no access to OSX, so we can't help. Can
you build and install other source packages including compiled C  
code? Was
your R installed from binary or source? Which OSX is this? Have you  
looked
on the R-sig-Mac list archives https://stat.ethz.ch/pipermail/r-sig- 
mac/.
I guess you have looked at the FAQ - "2.1.3 libreadline 4.3 or higher"
mentions the -lcc_dynamic issue, but I don't know if this applies to  
you.
There is also a wiki at http://wiki.urbanek.info/index.cgi?HomePage

Without (intimate) knowledge of OSX (with many versions) and the build
trains (with even more versions), it isn't easy to help.

Roger

>
>
> ########## error output ##############
>
> su-2.05b# R CMD INSTALL spproj_0.3-4.tar.gz
> * Installing *source* package 'spproj' ...
> creating cache ./config.cache
> checking for pj_init_plus in -lproj... yes
> checking how to run the C preprocessor... cc -E
> checking for proj_api.h... yes
> updating cache ./config.cache
> creating ./config.status
> creating src/Makevars
> ** libs
> gcc-3.3 -no-cpp-precomp -I/Library/Frameworks/R.framework/Resources/
> include  -I/usr/local/include   -fno-common  -g -O2 -c projectit.c -o
> projectit.o
> gcc-3.3 -bundle -flat_namespace -undefined suppress -L/usr/local/lib -
> o spproj.so projectit.o -lproj -lcc_dynamic -F/Library/Frameworks/
> R.framework/.. -framework R
> ld: can't locate file for: -lcc_dynamic
> make: *** [spproj.so] Error 1
> ERROR: compilation failed for package 'spproj'
> ** Removing '/Library/Frameworks/R.framework/Versions/2.2/Resources/
> library/spproj'
>
> #################################
>
>
> Any hint is appreciated!
> thanks
>
> H
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From Roger.Bivand at nhh.no  Fri Jan 27 16:21:54 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 27 Jan 2006 16:21:54 +0100 (CET)
Subject: [R-sig-Geo] compiling spproj on osx
In-Reply-To: <7CFA6577-3440-4D3C-ADEB-CB0D9107C621@gmail.com>
Message-ID: <Pine.LNX.4.44.0601271620200.3657-100000@reclus.nhh.no>

On Fri, 27 Jan 2006, Horacio Samaniego wrote:

> With the kind insight of Roger, I have been able to identify and  
> solve the problem. Here is a summary:
> 
> If you have upgraded your OSX system from Panther to Tiger you should  
> know that the compilers have changed from gcc3.3 to gcc4.0 this  
> creates some instabilities when it comes to compile R packages which  
> are well explained here: https://stat.ethz.ch/pipermail/r-sig-mac/ 
> 2005-July/002031.html
> 
> in short you need to make sure that the system uses gcc-3.3 by  
> running `gcc_select 3.3' before you compile the package which in my  
> case was spproj and spGDAL
> 
> This solved my installation issue, I hope it'll help.

Thank you for this clear report - because this list can also be searched 
by RSiteSearch() from within R, others will benefit from your solution!

Roger

> 
> thanks,
> 
> Horacio
> 
> 
> On Jan 27, 2006, at 9:15 AM, Roger Bivand wrote:
> 
> On Fri, 27 Jan 2006, Horacio Samaniego wrote:
> 
> > I got to the point where I would need the spproj package to reproject
> > som sp dataframes. However, when I try to install the package from
> > http://r-spatial.sourceforge.net/R/src/contrib/spproj_0.3-4.tar.gz,
> > I get the following error.
> > Is this an incompatibility with os x 10.4 or am I missing something
> > in my path?
> 
> The authors and maintainers have no access to OSX, so we can't help. Can
> you build and install other source packages including compiled C  
> code? Was
> your R installed from binary or source? Which OSX is this? Have you  
> looked
> on the R-sig-Mac list archives https://stat.ethz.ch/pipermail/r-sig- 
> mac/.
> I guess you have looked at the FAQ - "2.1.3 libreadline 4.3 or higher"
> mentions the -lcc_dynamic issue, but I don't know if this applies to  
> you.
> There is also a wiki at http://wiki.urbanek.info/index.cgi?HomePage
> 
> Without (intimate) knowledge of OSX (with many versions) and the build
> trains (with even more versions), it isn't easy to help.
> 
> Roger
> 
> >
> >
> > ########## error output ##############
> >
> > su-2.05b# R CMD INSTALL spproj_0.3-4.tar.gz
> > * Installing *source* package 'spproj' ...
> > creating cache ./config.cache
> > checking for pj_init_plus in -lproj... yes
> > checking how to run the C preprocessor... cc -E
> > checking for proj_api.h... yes
> > updating cache ./config.cache
> > creating ./config.status
> > creating src/Makevars
> > ** libs
> > gcc-3.3 -no-cpp-precomp -I/Library/Frameworks/R.framework/Resources/
> > include  -I/usr/local/include   -fno-common  -g -O2 -c projectit.c -o
> > projectit.o
> > gcc-3.3 -bundle -flat_namespace -undefined suppress -L/usr/local/lib -
> > o spproj.so projectit.o -lproj -lcc_dynamic -F/Library/Frameworks/
> > R.framework/.. -framework R
> > ld: can't locate file for: -lcc_dynamic
> > make: *** [spproj.so] Error 1
> > ERROR: compilation failed for package 'spproj'
> > ** Removing '/Library/Frameworks/R.framework/Versions/2.2/Resources/
> > library/spproj'
> >
> > #################################
> >
> >
> > Any hint is appreciated!
> > thanks
> >
> > H
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at stat.math.ethz.ch
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
> 
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From e.pebesma at geo.uu.nl  Sun Jan 29 20:49:17 2006
From: e.pebesma at geo.uu.nl (Edzer J. Pebesma)
Date: Sun, 29 Jan 2006 20:49:17 +0100
Subject: [R-sig-Geo] krige does not accept SpatialPixels objects
In-Reply-To: <43DCA1C5.8060208@univ-fcomte.fr>
References: <43DCA1C5.8060208@univ-fcomte.fr>
Message-ID: <43DD1C3D.2000702@geo.uu.nl>

Patrick Giraudoux wrote:

> Dear Edzer,
>
> I am revisiting/training with gstat using the tutorial (vignette) and 
> applying it to an example of Cs distribution in Franche-Comt?. Looks 
> like if a small bug was in krige().
>
> If you make a grid just with coordinates, eg:
>
> Csnewsp.grid<-expand.grid(x=seq(bbox(Csnewsp)[1,1],bbox(Csnewsp)[1,2],by=4500),y=seq(bbox(Csnewsp)[2,1],bbox(Csnewsp)[2,2],by=4500))
> coordinates(Csnewsp.grid)<-~x+y
> gridded(Csnewsp.grid)<-TRUE
>
> a call to
>
> cs2002.idw<-krige(CD2002~1,Csnewsp,Csnewsp.grid)
>
> gives:
>
> > cs2002.idw<-krige(CD2002~1,Csnewsp,Csnewsp.grid)
> Error in as.data.frame.default(newdata) : cannot coerce class 
> "SpatialPixels" into a data.frame
>
> However, if you add a variable like that:
>
> Csnewsp.grid<-expand.grid(x=seq(bbox(Csnewsp)[1,1],bbox(Csnewsp)[1,2],by=4500),y=seq(bbox(Csnewsp)[2,1],bbox(Csnewsp)[2,2],by=4500))
> Csnewsp.grid<-cbind(Csnewsp.grid,fact=1) # add a non sense variable
> coordinates(Csnewsp.grid)<-~x+y
> gridded(Csnewsp.grid)<-TRUE
>
> Everything looks OK:
>
> > cs2002.idw<-krige(CD2002~1,Csnewsp,Csnewsp.grid)
> [inverse distance weighted interpolation]
>
> Suppose the trouble comes when a SpatialPixel object is given as a 
> grid when a SpatialPixelDataFrame is expected... This may happen when 
> the grid is just the coordinates and does not include other variables, 
> which may be often the case.
>
> Is it normal or is there a mistake on my side?
>
> All the best,
>
> Patrick
>
Patrick, this is not a mistake on your side; objects of class
SpatialPixels (or SpatialGrid) were lacking an as.data.frame()
method. They have one now; I added this to package sp (on which
gstat now depends), it is in sp version 0.8-9 which should
be available from CRAN within a few days.

Thanks,
--
Edzer



From c.beale at macaulay.ac.uk  Tue Jan 31 17:20:36 2006
From: c.beale at macaulay.ac.uk (Colin Beale)
Date: Tue, 31 Jan 2006 16:20:36 +0000
Subject: [R-sig-Geo] Grid projections and spatial matrices
Message-ID: <s3df8e67.022@macaulay.ac.uk>

Hi,

Two questions really (elaborated below): (1) Has anyone created what is
essentially a spherical (or at least hemispherical) matrix structure
that I can use normal R functions like apply() on? and (2) has anyone
coded the procedure described in the ref below to calculate effective
sample sizes of correlations between two spatial matrices? As the first
author is clearly an R user I had expected to find something, but quite
a lot of searching has so far drawn a blank.

Clifford, P., Richardson, S. & Hemon, D. (1989). Assessing the
significance of the correlation between two spatial processes.
Biometrics, 45, 123-134.

As the first question is the most involved, this is the background: I'm
looking at presence / absence data for a range of species. Up to now, I
have mainly worked with distributions easily mapable on a regular grid.
I've developed a number of functions that use arrays as a way of
representing these data: y & x references in the first two dimensions,
species ID in a third. Several of these functions compute turnover in
species distirbution - they check neighbouring boxes within the grid for
presence / absence of the same species and compute statistics based on
this. This is all very well when the basic projection is a simple 2d
matrix. Recently, however, I have started using larger scale datasets
where appropriate projections need to be used - most of this data is
projected onto a 10x10km UTM based grid reference system (in practice,
the Military Grid Reference System). I need to adapt my functions to
recognise a dataset that has this projection - ie, that cells in
different sectors can be neighbours. I appreciate that this might
require a complete rewriting of my functions and a new way of thinking
about these data, but the most obvious solution to me is simply to
create a matrix or array type object that is sort-of "zipped" together
along the edges of the sector, to retain appropriate neighbour
identification. As an example of the sort of basic calculation involved,
I include below a small function below that calcualtes one parameter of
interest - related to the number of species that a species if present in
the focal quadrat, an in its neighbouring ones that I currently use on
my flat 2d array type data - I've also included some toy distributions
so you can see how it works. Any suggestions/pointers would be very
welcome (and I'm sure the original code could be more elegant too!).

Thanks very much,

Colin

# toy dataset
set.seed (1)
distMap <- array (sample (c (0, 0, 1), 120, rep = T), dim = c (6, 5,
4))

##example function - require package(magic) to run.

localTurnover <- function (spmap = distMap) {  
  mapx    <- dim (spmap)[2]                             # extracts map
dimensions and start 
  mapy    <- dim (spmap)[1]                             # up
parameters
  nsp     <- dim (spmap)[3]
  library (magic)                
  temp <- apad(apad(spmap, c(1,1,0)), c(1,1,0), post = FALSE)  # pads
array
  temp[,c (1, dim(temp)[2]),] <- NA                            # makes
additional rows/cols = NA
  temp[c (1, dim(temp)[1]),,] <- NA                            
  spmap[!is.na(spmap)] <- 1                                    # makes
all values in spmap = 1
  turnoverMap <- spmap

  locala <- rep (1, length = 8)
  localb <- rep (1, length = 8)
  localc <- rep (1, length = 8)
 
  for (NSP in 1:nsp) {
    for (iy in 1:mapy) {
      for (ix in 1:mapx) {
        if (!is.na (temp[iy+1,ix+1,NSP])) {
          if (temp[iy+1,ix+1,NSP] == 0) turnoverMap[iy, ix, NSP] <- 0
else {
            if (is.na (temp[iy    , ix    , NSP])) locala[1] <- NA else
{
              if (temp[iy+1,ix+1,NSP] == 1 & temp[iy    ,ix     , NSP]
== 0) locala[1] <- 0
            }
            if (is.na (temp[iy + 1, ix    , NSP])) locala[2] <- NA else
{
              if (temp[iy+1,ix+1,NSP] == 1 & temp[iy + 1,ix     , NSP]
== 0) locala[2] <- 0
            }
            if (is.na (temp[iy + 2, ix    , NSP])) locala[3] <- NA else
{
              if (temp[iy+1,ix+1,NSP] == 1 & temp[iy + 2,ix     , NSP]
== 0) locala[3] <- 0
            }
            if (is.na (temp[iy    , ix + 1, NSP])) locala[4] <- NA else
{
              if (temp[iy+1,ix+1,NSP] == 1 & temp[iy    , ix + 1, NSP]
== 0) locala[4] <- 0
            }   
            if (is.na (temp[iy    , ix + 2, NSP])) locala[5] <- NA else
{
              if (temp[iy+1,ix+1,NSP] == 1 & temp[iy    , ix + 2, NSP]
== 0) locala[5] <- 0
            }
            if (is.na (temp[iy + 1, ix + 2, NSP])) locala[6] <- NA else
{
              if (temp[iy+1,ix+1,NSP] == 1 & temp[iy + 1, ix + 2, NSP]
== 0) locala[6] <- 0
            }
            if (is.na (temp[iy + 2, ix + 1, NSP])) locala[7] <- NA else
{
              if (temp[iy+1,ix+1,NSP] == 1 & temp[iy + 2, ix + 1, NSP]
== 0) locala[7] <- 0
            }
            if (is.na (temp[iy + 2, ix + 2, NSP])) locala[8] <- NA else
{
              if (temp[iy+1,ix+1,NSP] == 1 & temp[iy + 2, ix + 2, NSP]
== 0) locala[8] <- 0
            }
            turnoverMap[iy,ix,NSP] <- mean (locala, na.rm = TRUE)
            locala <- rep (1, length = 8)
          }
        }  
      }
    }
  }
  return (apply(turnoverMap, c(1,2), sum))
}

localTurnover()

Dr. Colin Beale
Spatial Ecologist
The Macaulay Institute
Craigiebuckler
Aberdeen
AB15 8QH
UK

Tel: 01224 498200 ext. 2363
Fax: 01224 311556
Email: c.beale at macaulay.ac.uk



From White.Denis at epamail.epa.gov  Tue Jan 31 21:08:55 2006
From: White.Denis at epamail.epa.gov (White.Denis at epamail.epa.gov)
Date: Tue, 31 Jan 2006 12:08:55 -0800
Subject: [R-sig-Geo] Grid projections and spatial matrices
Message-ID: <OF39D6BD24.441EDC62-ON88257107.006EAE16-88257107.006EAE1E@epamail.epa.gov>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20060131/1f7eb6c6/attachment.pl>

