From hi_ono2001 at yahoo.co.jp  Thu Jun  1 04:15:34 2006
From: hi_ono2001 at yahoo.co.jp (Hisaji ONO)
Date: Thu, 1 Jun 2006 11:15:34 +0900 (JST)
Subject: [R-sig-Geo] Availability of R Script for WSAF(weighted spatial
	adaptive filter)
Message-ID: <20060601021534.3791.qmail@web10710.mail.bbt.yahoo.co.jp>

Hi.

 Does any one know whether R Script written for
WSAF(weighted spatial adaptive filter)(Gorr, W.L. and
Olligschlaeger, A.M. (1994). "Weighted Spatial Adaptive
Filtering: Monte Carlo Studies and Application to Illicit
Drug Market Modeling." Geographical Analysis, 26: 67-87.

), which enhances adaptive filtering's ability to
automatically identify and estimate parameters with
discontinuous or sharp gradient changes occurring over
space, is available or not?



 Regards.



From karl.sommer at dpi.vic.gov.au  Thu Jun  1 06:28:32 2006
From: karl.sommer at dpi.vic.gov.au (karl.sommer at dpi.vic.gov.au)
Date: Thu, 1 Jun 2006 14:28:32 +1000
Subject: [R-sig-Geo] using readGDAL() for ESRI raster file
Message-ID: <OF642484C6.6881D976-ONCA257180.0010F0C2-CA257180.001895E2@nre.vic.gov.au>

Hello list

thanks to the helpful advice given by list members I have been able to read
and re-project vector based shape files and attributes data using readOGR()
under rgdal for further analysis (kriging, k-means clustering) and
plotting.

Using the sp.layout under spplot allowed me to precisely overlay different
data layers.

Yesterday  I was attempting to use the function readGDAL() to read an ESRI
*.bil raster file of remote sensing spectral data.

Using GDALinfo under DOS within the data directory where the file is
located gave me the following information

gdalinfo -nomd inputfile.bil

Driver: EHdr/ESRI .hdr Labelled
Size is 813, 516
Coordinate System is `'
Origin = (617405.000000,6190325.500000)
Pixel Size = (0.50000000,-0.50000000)
Corner Coordinates:
Upper Left  (  617405.000, 6190325.500)
Lower Left  (  617405.000, 6190067.500)
Upper Right (  617811.500, 6190325.500)
Lower Right (  617811.500, 6190067.500)
Center      (  617608.250, 6190196.500)
Band 1 Block=813x1 Type=Int16, ColorInterp=Undefined
Band 2 Block=813x1 Type=Int16, ColorInterp=Undefined
Band 3 Block=813x1 Type=Int16, ColorInterp=Undefined
Band 4 Block=813x1 Type=Int16, ColorInterp=Undefined
Band 5 Block=813x1 Type=Int16, ColorInterp=Undefined
Band 6 Block=813x1 Type=Int16, ColorInterp=Undefined

when I am trying to read the same file using readGDAL() in R I get the
following error and so far have not been able to make sense of it.

test <- readGDAL("inputfile.bil", package="gdal")
inputfile.bil has GDAL driver EHdr
and has 516 rows and 813 columns
Error in getRasterData(x, offset = offset, region.dim = region.dim, ...) :
      unused argument(s) (package ...)

Any pointers would be gratefully accepted

Regards

Karl J Sommer
Scientist



From Roger.Bivand at nhh.no  Thu Jun  1 08:44:43 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 1 Jun 2006 08:44:43 +0200 (CEST)
Subject: [R-sig-Geo] using readGDAL() for ESRI raster file
In-Reply-To: <OF642484C6.6881D976-ONCA257180.0010F0C2-CA257180.001895E2@nre.vic.gov.au>
Message-ID: <Pine.LNX.4.44.0606010842300.7084-100000@reclus.nhh.no>

On Thu, 1 Jun 2006 karl.sommer at dpi.vic.gov.au wrote:

> Hello list
> 
> thanks to the helpful advice given by list members I have been able to read
> and re-project vector based shape files and attributes data using readOGR()
> under rgdal for further analysis (kriging, k-means clustering) and
> plotting.
> 
> Using the sp.layout under spplot allowed me to precisely overlay different
> data layers.
> 
> Yesterday  I was attempting to use the function readGDAL() to read an ESRI
> *.bil raster file of remote sensing spectral data.
> 
> Using GDALinfo under DOS within the data directory where the file is
> located gave me the following information
> 
> gdalinfo -nomd inputfile.bil
> 
> Driver: EHdr/ESRI .hdr Labelled
> Size is 813, 516
> Coordinate System is `'
> Origin = (617405.000000,6190325.500000)
> Pixel Size = (0.50000000,-0.50000000)
> Corner Coordinates:
> Upper Left  (  617405.000, 6190325.500)
> Lower Left  (  617405.000, 6190067.500)
> Upper Right (  617811.500, 6190325.500)
> Lower Right (  617811.500, 6190067.500)
> Center      (  617608.250, 6190196.500)
> Band 1 Block=813x1 Type=Int16, ColorInterp=Undefined
> Band 2 Block=813x1 Type=Int16, ColorInterp=Undefined
> Band 3 Block=813x1 Type=Int16, ColorInterp=Undefined
> Band 4 Block=813x1 Type=Int16, ColorInterp=Undefined
> Band 5 Block=813x1 Type=Int16, ColorInterp=Undefined
> Band 6 Block=813x1 Type=Int16, ColorInterp=Undefined
> 
> when I am trying to read the same file using readGDAL() in R I get the
> following error and so far have not been able to make sense of it.
> 
> test <- readGDAL("inputfile.bil", package="gdal")

                                     ^^^^^^^

The smoking gun is the error message, the "..." argument is used for 
passinf valid arguments throught to getRasterData(), etc. getRasterData() 
does not have a package= argument, so I expect that if you remove it, this 
problem should go away.

Roger

> inputfile.bil has GDAL driver EHdr
> and has 516 rows and 813 columns
> Error in getRasterData(x, offset = offset, region.dim = region.dim, ...) :
>       unused argument(s) (package ...)
> 
> Any pointers would be gratefully accepted
> 
> Regards
> 
> Karl J Sommer
> Scientist
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From adrian at maths.uwa.edu.au  Fri Jun  2 04:01:11 2006
From: adrian at maths.uwa.edu.au (Adrian Baddeley)
Date: Fri, 2 Jun 2006 10:01:11 +0800
Subject: [R-sig-Geo] Computing polygon area with decimal degree coordinates
Message-ID: <17535.39911.437695.123014@maths.uwa.edu.au>


I may be misunderstanding the discussion about polygon area,
but:

At the risk of restating a well-known fact, it's not mathematically complicated
to compute the area of a polygonal region (consisting of one or more separate
regions bounded by polygons, possibly including holes) on any oriented two-dimensional 
surface (a plane, a sphere, a blob) using any measure of area, provided we
have the following information:
     - a list of all edges, in any order, oriented so that the interior is to the left of each edge
      (the edges are traversed anticlockwise on the exterior,
      clockwise for a hole, etc);
     - the area (in the sense you want) of the trapezium bounded by an edge,
       meridians through the two endpoints, and a fixed baseline which is outside the polygon. 

No information is required about how the edges fit together.
No decomposition or geometric manipulation of the polygon is required,
because area is additive with respect to sets. 

For example in the flat plane, we can define meridians to be vertical lines
and the baseline to be the x-axis. Just shift the polygon so that it is above
the x-axis. Then associate with each edge the trapezium bounded by the edge,
two vertical lines that go through the endpoints, and the x-axis. Compute the area
of each trapezium. Add these areas with the appropriate sign, and you get the 
polygon area. This is just the `discrete Green's formula'. [This algorithm is
implemented in package 'spatstat'.]

On a sphere, or a sphere-like surface, in any coordinate system, 
define meridians to be the lines of constant longitude coordinate, and the baseline can be
the south pole (a point, but that's OK). Then all we need to know is the 
area (in the sense we want) of the triangular region delineated by an edge
and the two meridians that stretch from the edge's endpoints to the 
south pole. Sum these areas (with the appropriate sign) and we get the 
polygon area. [Other choices of baseline can be used if you only have
a local coordinate system.]

regards
Adrian Baddeley



From Morten.Sickel at nrpa.no  Fri Jun  2 10:42:28 2006
From: Morten.Sickel at nrpa.no (Morten Sickel)
Date: Fri, 2 Jun 2006 10:42:28 +0200
Subject: [R-sig-Geo] Geographical selection
Message-ID: <2326C830ADA651438DC694248E5FEF6069905A@mailix.NRPA.LOCAL>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20060602/fc3cb133/attachment.pl>

From tkeitt at gmail.com  Fri Jun  2 17:56:35 2006
From: tkeitt at gmail.com (Tim Keitt)
Date: Fri, 2 Jun 2006 10:56:35 -0500
Subject: [R-sig-Geo] Computing polygon area with decimal degree
	coordinates
In-Reply-To: <17535.39911.437695.123014@maths.uwa.edu.au>
References: <17535.39911.437695.123014@maths.uwa.edu.au>
Message-ID: <6262c54c0606020856k34ee4357h158fed6f07768f7d@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20060602/fcff97d7/attachment.pl>

From White.Denis at epamail.epa.gov  Fri Jun  2 18:33:16 2006
From: White.Denis at epamail.epa.gov (White.Denis at epamail.epa.gov)
Date: Fri, 02 Jun 2006 09:33:16 -0700
Subject: [R-sig-Geo] Computing polygon area with decimal
	degree	coordinates
Message-ID: <OF8C2985C3.7211386F-ON88257181.005AEFF7-88257181.005AEFFC@epamail.epa.gov>

Computing area on the spheroid:
Kimerling AJ. 1984. Area computation from geodetic coordinates on the
spheroid. Surveying and Mapping 44(4):343-351.

Measuring distortion:
Many cartography texts cover this.  Analytical formulas for computing
distortion were developed by Tissot in the 19th century.  A recent paper
using Tissot measures in a sampling framework is available at:
  http://www.epa.gov/wed/pages/staff/white/cagis.95.pdf

Kimerling AJ, Overton WS, White D. 1995. Statistical comparison of map
projection distortions within irregular areas. Cartography and
Geographic Information Systems 22(3):205-221.

Denis


-----r-sig-geo-bounces at stat.math.ethz.ch wrote: -----

To: adrian at maths.uwa.edu.au
From: Tim Keitt <tkeitt at gmail.com>
Sent by: r-sig-geo-bounces at stat.math.ethz.ch
Date: 02.06.2006 08:56
cc: r-sig-geo at stat.math.ethz.ch
Subject: Re: [R-sig-Geo] Computing polygon area with decimal degree
coordinates

Ah, that is very useful. I'd always assumed the hard part is computing
the
area of the triangles on the surface of a sphere/elipse, but perhaps
that is
not so hard after all. Anyone have a reference to some simple formulas?
The
other question is how much error is introduced if one computes areas
after
projecting to UTM or other map projections? (Probably depends a lot on
how
large an area one is talking about.)

THK

On 6/1/06, Adrian Baddeley <adrian at maths.uwa.edu.au> wrote:
>
>
> I may be misunderstanding the discussion about polygon area,
> but:
>
> At the risk of restating a well-known fact, it's not mathematically
> complicated
> to compute the area of a polygonal region (consisting of one or more
> separate
> regions bounded by polygons, possibly including holes) on any oriented
> two-dimensional
> surface (a plane, a sphere, a blob) using any measure of area,
provided we
> have the following information:
>      - a list of all edges, in any order, oriented so that the
interior is
> to the left of each edge
>       (the edges are traversed anticlockwise on the exterior,
>       clockwise for a hole, etc);
>      - the area (in the sense you want) of the trapezium bounded by an
> edge,
>        meridians through the two endpoints, and a fixed baseline which
is
> outside the polygon.
>
> No information is required about how the edges fit together.
> No decomposition or geometric manipulation of the polygon is required,
> because area is additive with respect to sets.
>
> For example in the flat plane, we can define meridians to be vertical
> lines
> and the baseline to be the x-axis. Just shift the polygon so that it
is
> above
> the x-axis. Then associate with each edge the trapezium bounded by the
> edge,
> two vertical lines that go through the endpoints, and the x-axis.
Compute
> the area
> of each trapezium. Add these areas with the appropriate sign, and you
get
> the
> polygon area. This is just the `discrete Green's formula'. [This
algorithm
> is
> implemented in package 'spatstat'.]
>
> On a sphere, or a sphere-like surface, in any coordinate system,
> define meridians to be the lines of constant longitude coordinate, and
the
> baseline can be
> the south pole (a point, but that's OK). Then all we need to know is
the
> area (in the sense we want) of the triangular region delineated by an
edge
> and the two meridians that stretch from the edge's endpoints to the
> south pole. Sum these areas (with the appropriate sign) and we get the
> polygon area. [Other choices of baseline can be used if you only have
> a local coordinate system.]
>
> regards
> Adrian Baddeley
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



--
Timothy H. Keitt
http://www.keittlab.org/

     [[alternative HTML version deleted]]

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at stat.math.ethz.ch
https://stat.ethz.ch/mailman/listinfo/r-sig-geo



From pierces1 at msu.edu  Sat Jun  3 00:42:18 2006
From: pierces1 at msu.edu (Steven J. Pierce)
Date: Fri, 2 Jun 2006 18:42:18 -0400
Subject: [R-sig-Geo] (no subject)
In-Reply-To: <mailman.16.1149242405.15517.r-sig-geo@stat.math.ethz.ch>
Message-ID: <000001c68695$ce0f34f0$0a00a8c0@TheVoid>

Hi folks,

After using spdep to construct a neighbor list from a SpatialPolygons
object, I plotted the neighbor list and noted that I needed one more link
that wasn't caught by the poly2nb command. I found the edit.nb() function
and can successfully use the interactive graphical interface to add the
link, but would like to know if there is an alternative method for adding a
link between two regions. What would I need to do to directly edit the
neighbor list object to include an additional link between regions 23 and
31?


> # Create a SpatialPolygons object from a SpatialPolygonsDataFrame object,
this
> # helps set up for creating a neighbor list via commands from spdep
package
> 
> CITY.polys <- as.SpatialPolygons.PolygonsList(CITY.ZCTA.data at polygons, 
+
proj4string=CRS(projection.details))
> 
> # Create a neighbor list based on shared boundary. We need this to
facilitate
> # creating a weights matrix when we go to do spatial regression models.
> 
> CITY.nb <- poly2nb(CITY.polys, row.names = NULL,
snap=sqrt(.Machine$double.eps), queen=TRUE)
> 
> # Capture coordinates of ZCTA centroids into a matrix we can use in
plotting
> # the neighbor list.
> 
> coords.mat <- cbind(CITY.ZCTA.data$centroid.x, CITY.ZCTA.data$centroid.y)
> 
> # Plot the neighbor list (reveals we need to add 1 more link)
> 
> plot(CITY.ZCTA.data, col="grey", border="black", axes=FALSE, asp=1,
yaxs="i")
> title(main="Neighbor List Links", adj= 0, cex.sub=.75)
> plot(CITY.nb, coords.mat, add=TRUE, col="black", lwd=2)
> 
> # Add 1 link to neighbor list. This requires interaction with the graphics
> # on screen.
> 
> CITY.nb <- edit.nb(CITY.nb, coords.mat, polys=CITY.polys)
Identifying contiguity for deletion ...
No contiguity between chosen points
Add contiguity? (y/n) y
added contiguity between point 23 and 31 
Options: quit[q] refresh[r] continue[c] q
> 
> # Plot the revised neighbor list (now everything looks right)
> 
> plot(CITY.ZCTA.data, col="grey", border="black", axes=FALSE, asp=1,
yaxs="i")
> title(main="Neighbor List Links", adj= 0, cex.sub=.75)
> plot(CITY.nb, coords.mat, add=TRUE, col="black", lwd=2)


Steven J. Pierce
E-mail: pierces1 at msu.edu



From Roger.Bivand at nhh.no  Sat Jun  3 13:10:36 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sat, 3 Jun 2006 13:10:36 +0200 (CEST)
Subject: [R-sig-Geo] adding links to neighbour lists
In-Reply-To: <000001c68695$ce0f34f0$0a00a8c0@TheVoid>
Message-ID: <Pine.LNX.4.44.0606031130260.8487-100000@reclus.nhh.no>

On Fri, 2 Jun 2006, Steven J. Pierce wrote:

> Hi folks,
> 
> After using spdep to construct a neighbor list from a SpatialPolygons
> object, I plotted the neighbor list and noted that I needed one more link
> that wasn't caught by the poly2nb command. I found the edit.nb() function
> and can successfully use the interactive graphical interface to add the
> link, but would like to know if there is an alternative method for adding a
> link between two regions. What would I need to do to directly edit the
> neighbor list object to include an additional link between regions 23 and
> 31?

There is a drop.links() function but no add.links(). So yes, you could 
manipulate the list directly. If ij is a two element vector for the 
missing link:

nb[[ij[1]]] <- sort(unique(c(nb[[ij[1]]], ij[2])))
nb[[ij[2]]] <- sort(unique(c(nb[[ij[2]]], ij[1])))

should do it (untried). If there are more links, have a look at drop.links 
and see if you can adapt it.

> 
> 
> > # Create a SpatialPolygons object from a SpatialPolygonsDataFrame object,
> this
> > # helps set up for creating a neighbor list via commands from spdep
> package
> > 
> > CITY.polys <- as.SpatialPolygons.PolygonsList(CITY.ZCTA.data at polygons, 
> +
> proj4string=CRS(projection.details))
> > 

I think:

CITY.polys <- as(CITY.ZCTA.data, "SpatialPolygons")

should be enough, in time poly2nb() will do that internally.

> > # Create a neighbor list based on shared boundary. We need this to
> facilitate
> > # creating a weights matrix when we go to do spatial regression models.
> > 
> > CITY.nb <- poly2nb(CITY.polys, row.names = NULL,
> snap=sqrt(.Machine$double.eps), queen=TRUE)
> > 
> > # Capture coordinates of ZCTA centroids into a matrix we can use in
> plotting
> > # the neighbor list.
> > 
> > coords.mat <- cbind(CITY.ZCTA.data$centroid.x, CITY.ZCTA.data$centroid.y)
> > 

Could be:

coords.mat <- coordinates(CITY.ZCTA.data)

if the centroid.x|y values correspond to the polygon centroids.

Roger

> > # Plot the neighbor list (reveals we need to add 1 more link)
> > 
> > plot(CITY.ZCTA.data, col="grey", border="black", axes=FALSE, asp=1,
> yaxs="i")
> > title(main="Neighbor List Links", adj= 0, cex.sub=.75)
> > plot(CITY.nb, coords.mat, add=TRUE, col="black", lwd=2)
> > 
> > # Add 1 link to neighbor list. This requires interaction with the graphics
> > # on screen.
> > 
> > CITY.nb <- edit.nb(CITY.nb, coords.mat, polys=CITY.polys)
> Identifying contiguity for deletion ...
> No contiguity between chosen points
> Add contiguity? (y/n) y
> added contiguity between point 23 and 31 
> Options: quit[q] refresh[r] continue[c] q
> > 
> > # Plot the revised neighbor list (now everything looks right)
> > 
> > plot(CITY.ZCTA.data, col="grey", border="black", axes=FALSE, asp=1,
> yaxs="i")
> > title(main="Neighbor List Links", adj= 0, cex.sub=.75)
> > plot(CITY.nb, coords.mat, add=TRUE, col="black", lwd=2)
> 
> 
> Steven J. Pierce
> E-mail: pierces1 at msu.edu
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From e.pebesma at geo.uu.nl  Mon Jun  5 21:29:58 2006
From: e.pebesma at geo.uu.nl (Edzer J Pebesma)
Date: Mon, 05 Jun 2006 21:29:58 +0200
Subject: [R-sig-Geo] default value for cutoff in gstat variogram()
In-Reply-To: <448179EC.8040601@univ-fcomte.fr>
References: <448179EC.8040601@univ-fcomte.fr>
Message-ID: <44848636.6020004@geo.uu.nl>

Patrick Giraudoux wrote:

> I wonder what is the default value for the argument 'cutoff' when not 
> specified in the variogram.formula function of gstat. Computing 
> variogram envelops within gstat, I am comparing the results obtained 
> with variog in geoR and variogram in gstat, and it took me a while 
> before understanding that the cutoff default value is not the maximum 
> distance.
>
> Can Edzer tell us about it?

Yes, of course (while I'm moving this from r-help to r-sig-geo):

the default value is computed in the c code. Without checking
(meaning: from >10 years memory) I do recall that gstat uses
one third of the diagional of the rectangular (or block for 3D)
that spans the data locations.

Why? In time series you compute ACF's up to one half
of the length of the series; after this things start to oscillate
because you lack independent replication at large distance;
look at what is meant by ergodicity for further reading.
Variograms are basically flipped & unscaled acf's for higher
dimensions.

Some books (Journel & Huijbregts?) gave suggestions
that half the max. distance in the data set is a good guideline,
back in 1978. I used  one third of the diagonal because
I thought finding the maximum distance between any
too point pairs may be expensive to find for large data
sets. The parameter "one third" can be overridden by
those who don't like it.

Please keep us updated about your milage comparing
gstat and geoR; I once spent an afternoon on this, trying
to reproduce sample variogram across the packages and
found this hard (but not impossible). I had the feeling
it had to do with using < or <= to decide whether a
point pairs falls in a distance interval or not, but didn't 100%
assure myself.
--
Edzer



From john.lewis at sympatico.ca  Tue Jun  6 17:33:29 2006
From: john.lewis at sympatico.ca (john lewis)
Date: Tue, 6 Jun 2006 11:33:29 -0400
Subject: [R-sig-Geo] 1. Re: default value for cutoff in gstat variogram()
Message-ID: <001701c6897e$8fbd4bb0$8c00a8c0@max>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20060606/de7aac5c/attachment.pl>

From karl.sommer at dpi.vic.gov.au  Wed Jun  7 07:50:28 2006
From: karl.sommer at dpi.vic.gov.au (karl.sommer at dpi.vic.gov.au)
Date: Wed, 7 Jun 2006 15:50:28 +1000
Subject: [R-sig-Geo]  selection of data subsets in spatial classes
Message-ID: <OF28344A5D.BEFA1E77-ONCA257186.001CC9A7-CA257186.00201632@nre.vic.gov.au>

Hello list

I have been trying to figure out if it is possible to select a subset of
data in a SpatialGridDataFrame without prior conversion to a data.frame
using the method as.data.frame().

I have imported an ESRI " *. bil " file containing different spectral bands
using rgdal.  The file imported as a SpatialGridDataFrame.  The data
originates from an aerial photograph of a row crop and I would like to
select pixels from within a row as opposed to those from the inter-row
space for further interpolation.   Inter-row pixels have a different
signature and therefore may be potentially screened out.  However, I have
been unable to access the SpatialGridDataFrame directly with, for example,
a  subset(x, band5 < lowerLimit, select c(a, b) ) call for selecting values
according to given criteria.

Am I using the wrong strategy, should I just demote the spatial class using
method as.data.frame(), do the manipulation and then promote the screened
values back to a spatial class?

Regards

Karl
_________________________________
Karl J Sommer,
Department of Primary Industries,
PO Box 905
Mildura, VIC, Australia 3502

Tel: +61 (0)3 5051 4390
Fax +61 (0)3 5051 4534

Email:     karl.sommer at dpi.vic.gov.au



From e.pebesma at geo.uu.nl  Wed Jun  7 08:59:00 2006
From: e.pebesma at geo.uu.nl (Edzer J. Pebesma)
Date: Wed, 07 Jun 2006 08:59:00 +0200
Subject: [R-sig-Geo] 1. Re: default value for cutoff in gstat variogram()
In-Reply-To: <001701c6897e$8fbd4bb0$8c00a8c0@max>
References: <001701c6897e$8fbd4bb0$8c00a8c0@max>
Message-ID: <44867934.4090705@geo.uu.nl>

john lewis wrote:
> Hello all,
> I did a comparison of gstat, geoR and SPlus 6.1 about 2 years ago with the coal ash data and found little difference among them after a bit of time making sure all input parameters were the same. I don't know if I can find those results but maybe it is time for me to do it again?
>   
Maybe they're not worrying from a statistical point of view, but from 
the point of view of code verification I am interested to see them (with 
the data & scripts to generated them). The coalash data are only 
available in S-Plus, am I right? (We do have an S+SpatialStats licence, 
but never got around to set it up for 7.0)
--
Edzer



From Roger.Bivand at nhh.no  Wed Jun  7 11:17:48 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 7 Jun 2006 11:17:48 +0200 (CEST)
Subject: [R-sig-Geo] selection of data subsets in spatial classes
In-Reply-To: <OF28344A5D.BEFA1E77-ONCA257186.001CC9A7-CA257186.00201632@nre.vic.gov.au>
Message-ID: <Pine.LNX.4.44.0606071109180.31057-100000@reclus.nhh.no>

On Wed, 7 Jun 2006 karl.sommer at dpi.vic.gov.au wrote:

> Hello list
> 
> I have been trying to figure out if it is possible to select a subset of
> data in a SpatialGridDataFrame without prior conversion to a data.frame
> using the method as.data.frame().
> 
> I have imported an ESRI " *. bil " file containing different spectral bands
> using rgdal.  The file imported as a SpatialGridDataFrame.  The data
> originates from an aerial photograph of a row crop and I would like to
> select pixels from within a row as opposed to those from the inter-row
> space for further interpolation.   Inter-row pixels have a different
> signature and therefore may be potentially screened out.  However, I have
> been unable to access the SpatialGridDataFrame directly with, for example,
> a  subset(x, band5 < lowerLimit, select c(a, b) ) call for selecting values
> according to given criteria.

This is what the SpatialPixelsDataFrame class is for (unless you want to 
change resolution too):

library(rgdal)
SP27GTIF <- readGDAL(system.file("pictures/SP27GTIF.TIF", package = 
  "rgdal")[1])
summary(SP27GTIF)
image(SP27GTIF, col=grey(1:9/10))
SP27GTIF_a <- as(SP27GTIF, "SpatialPixelsDataFrame")
summary(SP27GTIF_a)
SP27GTIF_b <- SP27GTIF_a[SP27GTIF_a$band1 < 100,]
summary(SP27GTIF_b)
image(SP27GTIF_b)

because SpatialPixelsDataFrame objects have their coordinates recorded 
explicitly, and "know where they are" on a full grid. 

fullgrid(SP27GTIF_b) <- TRUE
summary(SP27GTIF_b)

will drop them again, inserting NAs where band1 >= 100.

This class is borrowed from the Terralib "CELL" data structure, part 
raster, part DB record, only recording cells with data.

Roger

> 
> Am I using the wrong strategy, should I just demote the spatial class using
> method as.data.frame(), do the manipulation and then promote the screened
> values back to a spatial class?
> 
> Regards
> 
> Karl
> _________________________________
> Karl J Sommer,
> Department of Primary Industries,
> PO Box 905
> Mildura, VIC, Australia 3502
> 
> Tel: +61 (0)3 5051 4390
> Fax +61 (0)3 5051 4534
> 
> Email:     karl.sommer at dpi.vic.gov.au
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From e.pebesma at geo.uu.nl  Wed Jun  7 11:41:55 2006
From: e.pebesma at geo.uu.nl (Edzer J. Pebesma)
Date: Wed, 07 Jun 2006 11:41:55 +0200
Subject: [R-sig-Geo] selection of data subsets in spatial classes
In-Reply-To: <Pine.LNX.4.44.0606071109180.31057-100000@reclus.nhh.no>
References: <Pine.LNX.4.44.0606071109180.31057-100000@reclus.nhh.no>
Message-ID: <44869F63.8040103@geo.uu.nl>

Thanks for this. For the record:

sp has a subset function for SpatialPixelsDataFrame,
but it is not exported (nor documented, I believe).
In addition, it seems not to work:

SP27GTIF_c <- sp:::subset.SpatialPixelsDataFrame(SP27GTIF_a, band1 < 100)
Error in sp:::subset.SpatialPixelsDataFrame(SP27GTIF_a, band1 < 100) :
        object "band1" not found
--
Edzer


Roger Bivand wrote:
> On Wed, 7 Jun 2006 karl.sommer at dpi.vic.gov.au wrote:
>
>   
>> Hello list
>>
>> I have been trying to figure out if it is possible to select a subset of
>> data in a SpatialGridDataFrame without prior conversion to a data.frame
>> using the method as.data.frame().
>>
>> I have imported an ESRI " *. bil " file containing different spectral bands
>> using rgdal.  The file imported as a SpatialGridDataFrame.  The data
>> originates from an aerial photograph of a row crop and I would like to
>> select pixels from within a row as opposed to those from the inter-row
>> space for further interpolation.   Inter-row pixels have a different
>> signature and therefore may be potentially screened out.  However, I have
>> been unable to access the SpatialGridDataFrame directly with, for example,
>> a  subset(x, band5 < lowerLimit, select c(a, b) ) call for selecting values
>> according to given criteria.
>>     
>
> This is what the SpatialPixelsDataFrame class is for (unless you want to 
> change resolution too):
>
> library(rgdal)
> SP27GTIF <- readGDAL(system.file("pictures/SP27GTIF.TIF", package = 
>   "rgdal")[1])
> summary(SP27GTIF)
> image(SP27GTIF, col=grey(1:9/10))
> SP27GTIF_a <- as(SP27GTIF, "SpatialPixelsDataFrame")
> summary(SP27GTIF_a)
> SP27GTIF_b <- SP27GTIF_a[SP27GTIF_a$band1 < 100,]
> summary(SP27GTIF_b)
> image(SP27GTIF_b)
>
> because SpatialPixelsDataFrame objects have their coordinates recorded 
> explicitly, and "know where they are" on a full grid. 
>
> fullgrid(SP27GTIF_b) <- TRUE
> summary(SP27GTIF_b)
>
> will drop them again, inserting NAs where band1 >= 100.
>
> This class is borrowed from the Terralib "CELL" data structure, part 
> raster, part DB record, only recording cells with data.
>
> Roger
>
>   
>> Am I using the wrong strategy, should I just demote the spatial class using
>> method as.data.frame(), do the manipulation and then promote the screened
>> values back to a spatial class?
>>
>> Regards
>>
>> Karl
>> _________________________________
>> Karl J Sommer,
>> Department of Primary Industries,
>> PO Box 905
>> Mildura, VIC, Australia 3502
>>
>> Tel: +61 (0)3 5051 4390
>> Fax +61 (0)3 5051 4534
>>
>> Email:     karl.sommer at dpi.vic.gov.au
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>     
>
>



From paulojus at est.ufpr.br  Wed Jun  7 15:48:59 2006
From: paulojus at est.ufpr.br (Paulo Justiniano Ribeiro Jr)
Date: Wed, 7 Jun 2006 10:48:59 -0300 (BRT)
Subject: [R-sig-Geo] 1. Re: default value for cutoff in gstat variogram()
In-Reply-To: <44867934.4090705@geo.uu.nl>
References: <001701c6897e$8fbd4bb0$8c00a8c0@max> <44867934.4090705@geo.uu.nl>
Message-ID: <Pine.LNX.4.63.0606071042140.10568@est.ufpr.br>

Hi
My 2 cents here.

I agree with Edzer that from statistical point of view there is not much 
point in compare this.
However the software implementation and checking can benefit from it.

Let me try to remember a few possible relevant points for the diferences:

1. the values in the x-axis : some will average distance values while 
others will take the mid point of the classes intervals (as done, for 
instence in histograms)

2. How to deal with interval borders (<= ou <, >= or >= )

3. How to deal with coincident locations

4. How the maximim distance for the variogram is defined

5. How to deal with NA's in some distance classes and minimum number of 
pairs

The packages will have different default options (maybe not aways clearly 
documented).
A commom exemple run using all packages would be welcome, and this should 
include not only geoR and gstat but also the opthers.
We only have to bear in mind that the choice of empirical variograms will 
aways be subjective, according to the options defined by the user.

Best
P.J.





On Wed, 7 Jun 2006, Edzer J. Pebesma wrote:

> Date: Wed, 07 Jun 2006 08:59:00 +0200
> From: Edzer J. Pebesma <e.pebesma at geo.uu.nl>
> To: john lewis <john.lewis at sympatico.ca>
> Cc: r-sig-geo at stat.math.ethz.ch
> Subject: Re: [R-sig-Geo] 1. Re: default value for cutoff in gstat variogram()
> 
> john lewis wrote:
>> Hello all,
>> I did a comparison of gstat, geoR and SPlus 6.1 about 2 years ago with the coal ash data and found little difference among them after a bit of time making sure all input parameters were the same. I don't know if I can find those results but maybe it is time for me to do it again?
>>
> Maybe they're not worrying from a statistical point of view, but from
> the point of view of code verification I am interested to see them (with
> the data & scripts to generated them). The coalash data are only
> available in S-Plus, am I right? (We do have an S+SpatialStats licence,
> but never got around to set it up for 7.0)
> --
> Edzer
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>

Paulo Justiniano Ribeiro Jr
LEG (Laborat?rio de Estat?stica e Geoinforma??o)
Departamento de Estat?stica
Universidade Federal do Paran?
Caixa Postal 19.081
CEP 81.531-990
Curitiba, PR  -  Brasil
Tel: (+55) 41 3361 3573
Fax: (+55) 41 3361 3141
e-mail: paulojus at est.ufpr.br
http://www.est.ufpr.br/~paulojus

From karl.sommer at dpi.vic.gov.au  Thu Jun  8 07:56:20 2006
From: karl.sommer at dpi.vic.gov.au (karl.sommer at dpi.vic.gov.au)
Date: Thu, 8 Jun 2006 15:56:20 +1000
Subject: [R-sig-Geo] selection of data subsets in spatial classes
Message-ID: <OF13E3BF7C.FFC5C739-ONCA257187.001D1890-CA257187.00209F94@nre.vic.gov.au>


thanks  Roger Bivand, this is really powerful and much less cumbersome than
I feared.

I ran an inverse distance interpolation on some of the screened data.  In
order to do so I created a destination file from scratch with a 2 x 2 m
grid. The destination file is of rectangular shape and is larger than the
field for which a I have the aerial image data which is a polygon.  As a
result the kriging procedure extends beyond the field.

Is there a way to either create a sampling grid that is the same shape as
the field, ie from a shape file,  or is there a way to subtract the two
layers such that only the field shape is retained (something similar to
mapcalc in GRASS)?

here is my R code

library(rgdal)
# load rgdal library and import ESRI raster file (aerial image)
t1 <- readGDAL( "shi94a9_bnd.bil" ,  half.cell=c(0.5, 0.5), silent = FALSE)

image(t1, col=grey(1:9/10))
summary(t1)

t1a <- as(t1, "SpatialPixelsDataFrame")
summary(t1a)

t1b <- t1a[t1a$band5 > 0,]  # this eliminates values outside the field
boundaries which are 0; inter-row pixels had been eliminated previously

library(gstat)
t1b.idw <- krige(band5~1, t1b,  grid.pts)
spplot(t1b.idw["var1.pred"],main="idw PCD map", col.regions=bpy.colors(64))

# the grid.pts file was created as follows
#
utm.n.min<- 6190068
utm.n.max<- 6190326
utm.e.min<- 617405
utm.e.max<- 617812

spacing<-2  # average linear spacing between points
#
xseq<-seq(utm.e.min, utm.e.max, by=spacing)
yseq<-seq(utm.n.min, utm.n.max, by=spacing)

sample.pts<-expand.grid(xseq, yseq)
names(sample.pts)<-c("x", "y")

## include the variable in a new object yld.pts
grid.pts <- cbind(sample.pts)
coordinates(grid.pts)=~x+y
gridded(grid.pts)=TRUE

Cheers

Karl



|---------+---------------------------->
|         |           Roger.Bivand at nhh.|
|         |           no               |
|         |                            |
|         |           07/06/2006 19:17 |
|         |           Please respond to|
|         |           Roger.Bivand     |
|         |                            |
|---------+---------------------------->
  >------------------------------------------------------------------------------------------------------------------------------|
  |                                                                                                                              |
  |       To:       karl.sommer at dpi.vic.gov.au                                                                                   |
  |       cc:       r-sig-geo at stat.math.ethz.ch                                                                                  |
  |       Subject:  Re: [R-sig-Geo]  selection of data subsets in spatial classes                                                |
  >------------------------------------------------------------------------------------------------------------------------------|




On Wed, 7 Jun 2006 karl.sommer at dpi.vic.gov.au wrote:

> Hello list
>
> I have been trying to figure out if it is possible to select a subset of
> data in a SpatialGridDataFrame without prior conversion to a data.frame
> using the method as.data.frame().
>
> I have imported an ESRI " *. bil " file containing different spectral
bands
> using rgdal.  The file imported as a SpatialGridDataFrame.  The data
> originates from an aerial photograph of a row crop and I would like to
> select pixels from within a row as opposed to those from the inter-row
> space for further interpolation.   Inter-row pixels have a different
> signature and therefore may be potentially screened out.  However, I have
> been unable to access the SpatialGridDataFrame directly with, for
example,
> a  subset(x, band5 < lowerLimit, select c(a, b) ) call for selecting
values
> according to given criteria.

This is what the SpatialPixelsDataFrame class is for (unless you want to
change resolution too):

library(rgdal)
SP27GTIF <- readGDAL(system.file("pictures/SP27GTIF.TIF", package =
  "rgdal")[1])
summary(SP27GTIF)
image(SP27GTIF, col=grey(1:9/10))
SP27GTIF_a <- as(SP27GTIF, "SpatialPixelsDataFrame")
summary(SP27GTIF_a)
SP27GTIF_b <- SP27GTIF_a[SP27GTIF_a$band1 < 100,]
summary(SP27GTIF_b)
image(SP27GTIF_b)

because SpatialPixelsDataFrame objects have their coordinates recorded
explicitly, and "know where they are" on a full grid.

fullgrid(SP27GTIF_b) <- TRUE
summary(SP27GTIF_b)

will drop them again, inserting NAs where band1 >= 100.

This class is borrowed from the Terralib "CELL" data structure, part
raster, part DB record, only recording cells with data.

Roger

>
> Am I using the wrong strategy, should I just demote the spatial class
using
> method as.data.frame(), do the manipulation and then promote the screened
> values back to a spatial class?
>
> Regards
>
> Karl
> _________________________________
> Karl J Sommer,
> Department of Primary Industries,
> PO Box 905
> Mildura, VIC, Australia 3502
>
> Tel: +61 (0)3 5051 4390
> Fax +61 (0)3 5051 4534
>
> Email:     karl.sommer at dpi.vic.gov.au
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

--
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From e.pebesma at geo.uu.nl  Thu Jun  8 09:30:47 2006
From: e.pebesma at geo.uu.nl (Edzer J. Pebesma)
Date: Thu, 08 Jun 2006 09:30:47 +0200
Subject: [R-sig-Geo] selection of data subsets in spatial classes
In-Reply-To: <OF13E3BF7C.FFC5C739-ONCA257187.001D1890-CA257187.00209F94@nre.vic.gov.au>
References: <OF13E3BF7C.FFC5C739-ONCA257187.001D1890-CA257187.00209F94@nre.vic.gov.au>
Message-ID: <4487D227.7020204@geo.uu.nl>

karl.sommer at dpi.vic.gov.au wrote:
> thanks  Roger Bivand, this is really powerful and much less cumbersome than
> I feared.
>
> I ran an inverse distance interpolation on some of the screened data.  In
> order to do so I created a destination file from scratch with a 2 x 2 m
> grid. The destination file is of rectangular shape and is larger than the
> field for which a I have the aerial image data which is a polygon.  As a
> result the kriging procedure extends beyond the field.
>
> Is there a way to either create a sampling grid that is the same shape as
> the field, ie from a shape file,  or is there a way to subtract the two
> layers such that only the field shape is retained (something similar to
> mapcalc in GRASS)?
>   
>

you may want to have a look at function makegrid in sp. It's
first argument should have a bounding box (as all Spatial objects
have), or be such a bounding box.
--
Edzer



From Roger.Bivand at nhh.no  Thu Jun  8 10:53:56 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 8 Jun 2006 10:53:56 +0200 (CEST)
Subject: [R-sig-Geo] selection of data subsets in spatial classes
In-Reply-To: <OF13E3BF7C.FFC5C739-ONCA257187.001D1890-CA257187.00209F94@nre.vic.gov.au>
Message-ID: <Pine.LNX.4.44.0606081036370.31705-100000@reclus.nhh.no>

On Thu, 8 Jun 2006 karl.sommer at dpi.vic.gov.au wrote:

> 
> thanks  Roger Bivand, this is really powerful and much less cumbersome than
> I feared.
> 
> I ran an inverse distance interpolation on some of the screened data.  In
> order to do so I created a destination file from scratch with a 2 x 2 m
> grid. The destination file is of rectangular shape and is larger than the
> field for which a I have the aerial image data which is a polygon.  As a
> result the kriging procedure extends beyond the field.
> 
> Is there a way to either create a sampling grid that is the same shape as
> the field, ie from a shape file,  or is there a way to subtract the two
> layers such that only the field shape is retained (something similar to
> mapcalc in GRASS)?

My immediate guess would be that the overlay method will get you there:

library(sp)
plot(1:100, 1:100, type="n")
poly <- locator()
poly <- do.call("cbind", poly)
poly <- rbind(poly, poly[1,])
lines(poly)
field <- SpatialPolygons(list(Polygons(list(Polygon(poly)), ID="field")))
grd <- GridTopology(c(0.5,0.5), c(1,1), c(100, 100))
SG <- SpatialGrid(grd)
plot(SG, add=TRUE)
t1 <- overlay(SG, field)
SGDF <- SpatialGridDataFrame(grd, data=AttributeList(list(field=t1)))
SPDF <- as(SGDF, "SpatialPixelsDataFrame")
plot(SPDF, col="red", add=TRUE)

and then use the SPDF points for prediction. If you've read in the field 
polygon, you're already mostly set up. It will also work with multiple 
fields, when t1 will know which field the grid point belongs to.

Using GridTopology to set up prediction grids is quite neat too, it 
provides an object to encapsulate what you are doing, but ensures that you 
register the grid to the grid centres.

Hope this helps,

Roger

> 
> here is my R code
> 
> library(rgdal)
> # load rgdal library and import ESRI raster file (aerial image)
> t1 <- readGDAL( "shi94a9_bnd.bil" ,  half.cell=c(0.5, 0.5), silent = FALSE)
> 
> image(t1, col=grey(1:9/10))
> summary(t1)
> 
> t1a <- as(t1, "SpatialPixelsDataFrame")
> summary(t1a)
> 
> t1b <- t1a[t1a$band5 > 0,]  # this eliminates values outside the field
> boundaries which are 0; inter-row pixels had been eliminated previously
> 
> library(gstat)
> t1b.idw <- krige(band5~1, t1b,  grid.pts)
> spplot(t1b.idw["var1.pred"],main="idw PCD map", col.regions=bpy.colors(64))
> 
> # the grid.pts file was created as follows
> #
> utm.n.min<- 6190068
> utm.n.max<- 6190326
> utm.e.min<- 617405
> utm.e.max<- 617812
> 
> spacing<-2  # average linear spacing between points
> #
> xseq<-seq(utm.e.min, utm.e.max, by=spacing)
> yseq<-seq(utm.n.min, utm.n.max, by=spacing)
> 
> sample.pts<-expand.grid(xseq, yseq)
> names(sample.pts)<-c("x", "y")
> 
> ## include the variable in a new object yld.pts
> grid.pts <- cbind(sample.pts)
> coordinates(grid.pts)=~x+y
> gridded(grid.pts)=TRUE
> 
> Cheers
> 
> Karl
> 
> 
> 
> |---------+---------------------------->
> |         |           Roger.Bivand at nhh.|
> |         |           no               |
> |         |                            |
> |         |           07/06/2006 19:17 |
> |         |           Please respond to|
> |         |           Roger.Bivand     |
> |         |                            |
> |---------+---------------------------->
>   >------------------------------------------------------------------------------------------------------------------------------|
>   |                                                                                                                              |
>   |       To:       karl.sommer at dpi.vic.gov.au                                                                                   |
>   |       cc:       r-sig-geo at stat.math.ethz.ch                                                                                  |
>   |       Subject:  Re: [R-sig-Geo]  selection of data subsets in spatial classes                                                |
>   >------------------------------------------------------------------------------------------------------------------------------|
> 
> 
> 
> 
> On Wed, 7 Jun 2006 karl.sommer at dpi.vic.gov.au wrote:
> 
> > Hello list
> >
> > I have been trying to figure out if it is possible to select a subset of
> > data in a SpatialGridDataFrame without prior conversion to a data.frame
> > using the method as.data.frame().
> >
> > I have imported an ESRI " *. bil " file containing different spectral
> bands
> > using rgdal.  The file imported as a SpatialGridDataFrame.  The data
> > originates from an aerial photograph of a row crop and I would like to
> > select pixels from within a row as opposed to those from the inter-row
> > space for further interpolation.   Inter-row pixels have a different
> > signature and therefore may be potentially screened out.  However, I have
> > been unable to access the SpatialGridDataFrame directly with, for
> example,
> > a  subset(x, band5 < lowerLimit, select c(a, b) ) call for selecting
> values
> > according to given criteria.
> 
> This is what the SpatialPixelsDataFrame class is for (unless you want to
> change resolution too):
> 
> library(rgdal)
> SP27GTIF <- readGDAL(system.file("pictures/SP27GTIF.TIF", package =
>   "rgdal")[1])
> summary(SP27GTIF)
> image(SP27GTIF, col=grey(1:9/10))
> SP27GTIF_a <- as(SP27GTIF, "SpatialPixelsDataFrame")
> summary(SP27GTIF_a)
> SP27GTIF_b <- SP27GTIF_a[SP27GTIF_a$band1 < 100,]
> summary(SP27GTIF_b)
> image(SP27GTIF_b)
> 
> because SpatialPixelsDataFrame objects have their coordinates recorded
> explicitly, and "know where they are" on a full grid.
> 
> fullgrid(SP27GTIF_b) <- TRUE
> summary(SP27GTIF_b)
> 
> will drop them again, inserting NAs where band1 >= 100.
> 
> This class is borrowed from the Terralib "CELL" data structure, part
> raster, part DB record, only recording cells with data.
> 
> Roger
> 
> >
> > Am I using the wrong strategy, should I just demote the spatial class
> using
> > method as.data.frame(), do the manipulation and then promote the screened
> > values back to a spatial class?
> >
> > Regards
> >
> > Karl
> > _________________________________
> > Karl J Sommer,
> > Department of Primary Industries,
> > PO Box 905
> > Mildura, VIC, Australia 3502
> >
> > Tel: +61 (0)3 5051 4390
> > Fax +61 (0)3 5051 4534
> >
> > Email:     karl.sommer at dpi.vic.gov.au
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at stat.math.ethz.ch
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
> 
> --
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
> 
> 
> 
> 
> 
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From brubineau at sloan.mit.edu  Thu Jun  8 21:28:59 2006
From: brubineau at sloan.mit.edu (Brian Rubineau)
Date: Thu, 08 Jun 2006 15:28:59 -0400
Subject: [R-sig-Geo] ? model evaluation error
Message-ID: <20060608152859.m7p9n9du2pc8ow04@webmail.mit.edu>

Dear spdep sages,
I am a new R user, and very new spdep user, and am receiving
an error message (below) that to me is inscrutable.

Error in if (attr(vlist, "mode") != "binary") stop("Not yet able to subset
general weights lists") :
        argument is of length zero

I'm trying to estimate a model where the network
effects are in disturbances to the errors.

my command line looks so:
disturbeffect.01=errorsarlm(resp_var~predictor_vars,,my.listw,na.action=na.omit,zero.policy=TRUE)

(my network has some nodes without neighbors, and my predictor_vars have some
NAs - but the model formula runs fine within lm() .)

I tried the same arguments for lagsarlm() and received the exact same error.
I've looked through the spdep manual, and all I can find is that
"mode" can be an argument in a "vector()" command, but do not know
how this relates to my specification of my model.

I'm attaching my listw type list, in case this is of help.
Thank you for your assistance,

Brian

-- 
Brian Rubineau                             PhD Candidate, Organization Studies
brubineau at sloan.mit.edu                         MIT Sloan School of Management
tel: 617.253.6680                                   50 Memorial Drive, E52-511
fax: 810.963.2738                                         Cambridge, MA  02142



-------------- next part --------------
A non-text attachment was scrubbed...
Name: mylistw.Rdata
Type: application/x-gzip
Size: 5049 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20060608/18d6d0a7/attachment.tgz>

From Roger.Bivand at nhh.no  Thu Jun  8 23:24:23 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 8 Jun 2006 23:24:23 +0200 (CEST)
Subject: [R-sig-Geo] ? model evaluation error
In-Reply-To: <20060608152859.m7p9n9du2pc8ow04@webmail.mit.edu>
Message-ID: <Pine.LNX.4.44.0606082245130.31743-100000@reclus.nhh.no>

On Thu, 8 Jun 2006, Brian Rubineau wrote:

> Dear spdep sages,
> I am a new R user, and very new spdep user, and am receiving
> an error message (below) that to me is inscrutable.
> 
> Error in if (attr(vlist, "mode") != "binary") stop("Not yet able to subset
> general weights lists") :
>         argument is of length zero
> 

Say traceback(), then. But just trying things:

vlist <- NULL
if (attr(vlist, "mode") != "binary") cat("")

suggests that vlist does not have a "mode" attribute. The object in
question is one of three elements in a listw object. Maybe it would be
helpful if you began with sessionInfo(), so that we have some knowledge of
package versions, etc?

> I'm trying to estimate a model where the network
> effects are in disturbances to the errors.
> 
> my command line looks so:

> 
> disturbeffect.01 = errorsarlm(resp_var~predictor_vars, , my.listw, 
> na.action=na.omit, zero.policy=TRUE)
> 

my.listw is a listw object that you have constructed with a weights
element with no "mode" attribute, so when you go through na.omit, you
induce subsetting (which checks that attribute), because spatial models
cannot be fit id NA are present. What happens in lm() is that the
observations including NAs are dropped, but here we need to drop the
observations from resp_var and predictor_vars - and drop rows and columns
from the spatial weights. Your listw object has been constructed in a way
that makes this impossible.

>From examination of the object you attached (good!), it seems to have been
created by mat2listw(), which does not (and should) set the "mode"
attribute in listw$weights, so I'll correct that (to say "unknown").  
That function actually cannot know if the weights are "binary" or
"general" - but yours seem to be simple "B" style weights, 0/1, so my
suggestion would be:

my.listw1 <- nb2listw(my.listw$neighbours, style="B", zero.policy=TRUE)
summary(my.listw1, zero.policy=TRUE)
attr(my.listw1$weights, "mode")

It should run on my.listw1. By the way, if you have coordinates for your 
objects, you can look at a plot of the neighbours (?plot.nb) - to see if 
the matrix you started from represents the structure you want. Thanks for 
a full report!

Best wishes,

Roger

> (my network has some nodes without neighbors, and my predictor_vars have some
> NAs - but the model formula runs fine within lm() .)
> 
> I tried the same arguments for lagsarlm() and received the exact same error.
> I've looked through the spdep manual, and all I can find is that
> "mode" can be an argument in a "vector()" command, but do not know
> how this relates to my specification of my model.
> 
> I'm attaching my listw type list, in case this is of help.

(without the attachment, it would have been impossible to help - the 
commands used to make the objects can also tell a lot)

> Thank you for your assistance,
> 
> Brian
> 
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From brubineau at sloan.mit.edu  Fri Jun  9 03:01:15 2006
From: brubineau at sloan.mit.edu (Brian Rubineau)
Date: Thu, 08 Jun 2006 21:01:15 -0400
Subject: [R-sig-Geo] ? model evaluation error
In-Reply-To: <Pine.LNX.4.44.0606082245130.31743-100000@reclus.nhh.no>
References: <Pine.LNX.4.44.0606082245130.31743-100000@reclus.nhh.no>
Message-ID: <20060608210115.l6ui2qb1yw0kssgg@webmail.mit.edu>

Wonderful - thank you! It worked perfectly as suggested.
I will send version information as well next time.
Appreciatively,
Brian

-- 
Brian Rubineau                             PhD Candidate, Organization Studies
brubineau at sloan.mit.edu                         MIT Sloan School of Management
tel: 617.253.6680                                   50 Memorial Drive, E52-511
fax: 810.963.2738                                         Cambridge, MA  02142


Quoting Roger Bivand <Roger.Bivand at nhh.no>:

> On Thu, 8 Jun 2006, Brian Rubineau wrote:
>
>> Dear spdep sages,
>> I am a new R user, and very new spdep user, and am receiving
>> an error message (below) that to me is inscrutable.
>>
>> Error in if (attr(vlist, "mode") != "binary") stop("Not yet able to subset
>> general weights lists") :
>>         argument is of length zero
>>
>
> Say traceback(), then. But just trying things:
>
> vlist <- NULL
> if (attr(vlist, "mode") != "binary") cat("")
>
> suggests that vlist does not have a "mode" attribute. The object in
> question is one of three elements in a listw object. Maybe it would be
> helpful if you began with sessionInfo(), so that we have some knowledge of
> package versions, etc?
>
>> I'm trying to estimate a model where the network
>> effects are in disturbances to the errors.
>>
>> my command line looks so:
>
>>
>> disturbeffect.01 = errorsarlm(resp_var~predictor_vars, , my.listw,
>> na.action=na.omit, zero.policy=TRUE)
>>
>
> my.listw is a listw object that you have constructed with a weights
> element with no "mode" attribute, so when you go through na.omit, you
> induce subsetting (which checks that attribute), because spatial models
> cannot be fit id NA are present. What happens in lm() is that the
> observations including NAs are dropped, but here we need to drop the
> observations from resp_var and predictor_vars - and drop rows and columns
> from the spatial weights. Your listw object has been constructed in a way
> that makes this impossible.
>
> From examination of the object you attached (good!), it seems to have been
> created by mat2listw(), which does not (and should) set the "mode"
> attribute in listw$weights, so I'll correct that (to say "unknown").
> That function actually cannot know if the weights are "binary" or
> "general" - but yours seem to be simple "B" style weights, 0/1, so my
> suggestion would be:
>
> my.listw1 <- nb2listw(my.listw$neighbours, style="B", zero.policy=TRUE)
> summary(my.listw1, zero.policy=TRUE)
> attr(my.listw1$weights, "mode")
>
> It should run on my.listw1. By the way, if you have coordinates for your
> objects, you can look at a plot of the neighbours (?plot.nb) - to see if
> the matrix you started from represents the structure you want. Thanks for
> a full report!
>
> Best wishes,
>
> Roger
>
>> (my network has some nodes without neighbors, and my predictor_vars 
>> have some
>> NAs - but the model formula runs fine within lm() .)
>>
>> I tried the same arguments for lagsarlm() and received the exact same error.
>> I've looked through the spdep manual, and all I can find is that
>> "mode" can be an argument in a "vector()" command, but do not know
>> how this relates to my specification of my model.
>>
>> I'm attaching my listw type list, in case this is of help.
>
> (without the attachment, it would have been impossible to help - the
> commands used to make the objects can also tell a lot)
>
>> Thank you for your assistance,
>>
>> Brian
>>
>>
>
> --
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>
>
>
>



From karl.sommer at dpi.vic.gov.au  Fri Jun  9 10:00:22 2006
From: karl.sommer at dpi.vic.gov.au (karl.sommer at dpi.vic.gov.au)
Date: Fri, 9 Jun 2006 18:00:22 +1000
Subject: [R-sig-Geo] selection of data subsets in spatial classes
Message-ID: <OF55EE4CB9.B5AC32AD-ONCA257188.002B3AF6-CA257188.002BFA64@nre.vic.gov.au>


after some fiddling with the GridTopology() method I eventually succeeded
in making it work and now can interpolate onto the grid.

Tremendous, thanks.

One problem I encountered when specifying a number smaller than 1 for the
cellsize argument eg. c(0.5, 0.5) instead of c(1,1),  I get erroneous
results.

grd <- GridTopology(c(617400, 6190060), c(1,1), c(400, 300))

Cheers
Karl



|---------+---------------------------->
|         |           Roger.Bivand at nhh.|
|         |           no               |
|         |                            |
|         |           08/06/2006 18:53 |
|         |           Please respond to|
|         |           Roger.Bivand     |
|         |                            |
|---------+---------------------------->
  >------------------------------------------------------------------------------------------------------------------------------|
  |                                                                                                                              |
  |       To:       karl.sommer at dpi.vic.gov.au                                                                                   |
  |       cc:       r-sig-geo at stat.math.ethz.ch                                                                                  |
  |       Subject:  Re: [R-sig-Geo]  selection of data subsets in spatial classes                                                |
  >------------------------------------------------------------------------------------------------------------------------------|




On Thu, 8 Jun 2006 karl.sommer at dpi.vic.gov.au wrote:

>
> thanks  Roger Bivand, this is really powerful and much less cumbersome
than
> I feared.
>
> I ran an inverse distance interpolation on some of the screened data.  In
> order to do so I created a destination file from scratch with a 2 x 2 m
> grid. The destination file is of rectangular shape and is larger than the
> field for which a I have the aerial image data which is a polygon.  As a
> result the kriging procedure extends beyond the field.
>
> Is there a way to either create a sampling grid that is the same shape as
> the field, ie from a shape file,  or is there a way to subtract the two
> layers such that only the field shape is retained (something similar to
> mapcalc in GRASS)?

My immediate guess would be that the overlay method will get you there:

library(sp)
plot(1:100, 1:100, type="n")
poly <- locator()
poly <- do.call("cbind", poly)
poly <- rbind(poly, poly[1,])
lines(poly)
field <- SpatialPolygons(list(Polygons(list(Polygon(poly)), ID="field")))
grd <- GridTopology(c(0.5,0.5), c(1,1), c(100, 100))
SG <- SpatialGrid(grd)
plot(SG, add=TRUE)
t1 <- overlay(SG, field)
SGDF <- SpatialGridDataFrame(grd, data=AttributeList(list(field=t1)))
SPDF <- as(SGDF, "SpatialPixelsDataFrame")
plot(SPDF, col="red", add=TRUE)

and then use the SPDF points for prediction. If you've read in the field
polygon, you're already mostly set up. It will also work with multiple
fields, when t1 will know which field the grid point belongs to.

Using GridTopology to set up prediction grids is quite neat too, it
provides an object to encapsulate what you are doing, but ensures that you
register the grid to the grid centres.

Hope this helps,

Roger

>
> here is my R code
>
> library(rgdal)
> # load rgdal library and import ESRI raster file (aerial image)
> t1 <- readGDAL( "shi94a9_bnd.bil" ,  half.cell=c(0.5, 0.5), silent =
FALSE)
>
> image(t1, col=grey(1:9/10))
> summary(t1)
>
> t1a <- as(t1, "SpatialPixelsDataFrame")
> summary(t1a)
>
> t1b <- t1a[t1a$band5 > 0,]  # this eliminates values outside the field
> boundaries which are 0; inter-row pixels had been eliminated previously
>
> library(gstat)
> t1b.idw <- krige(band5~1, t1b,  grid.pts)
> spplot(t1b.idw["var1.pred"],main="idw PCD map",
col.regions=bpy.colors(64))
>
> # the grid.pts file was created as follows
> #
> utm.n.min<- 6190068
> utm.n.max<- 6190326
> utm.e.min<- 617405
> utm.e.max<- 617812
>
> spacing<-2  # average linear spacing between points
> #
> xseq<-seq(utm.e.min, utm.e.max, by=spacing)
> yseq<-seq(utm.n.min, utm.n.max, by=spacing)
>
> sample.pts<-expand.grid(xseq, yseq)
> names(sample.pts)<-c("x", "y")
>
> ## include the variable in a new object yld.pts
> grid.pts <- cbind(sample.pts)
> coordinates(grid.pts)=~x+y
> gridded(grid.pts)=TRUE
>
> Cheers
>
> Karl
>
>
>
> |---------+---------------------------->
> |         |           Roger.Bivand at nhh.|
> |         |           no               |
> |         |                            |
> |         |           07/06/2006 19:17 |
> |         |           Please respond to|
> |         |           Roger.Bivand     |
> |         |                            |
> |---------+---------------------------->
>   >
------------------------------------------------------------------------------------------------------------------------------|

>   |
|
>   |       To:       karl.sommer at dpi.vic.gov.au
|
>   |       cc:       r-sig-geo at stat.math.ethz.ch
|
>   |       Subject:  Re: [R-sig-Geo]  selection of data subsets in spatial
classes                                                |
>   >
------------------------------------------------------------------------------------------------------------------------------|

>
>
>
>
> On Wed, 7 Jun 2006 karl.sommer at dpi.vic.gov.au wrote:
>
> > Hello list
> >
> > I have been trying to figure out if it is possible to select a subset
of
> > data in a SpatialGridDataFrame without prior conversion to a data.frame
> > using the method as.data.frame().
> >
> > I have imported an ESRI " *. bil " file containing different spectral
> bands
> > using rgdal.  The file imported as a SpatialGridDataFrame.  The data
> > originates from an aerial photograph of a row crop and I would like to
> > select pixels from within a row as opposed to those from the inter-row
> > space for further interpolation.   Inter-row pixels have a different
> > signature and therefore may be potentially screened out.  However, I
have
> > been unable to access the SpatialGridDataFrame directly with, for
> example,
> > a  subset(x, band5 < lowerLimit, select c(a, b) ) call for selecting
> values
> > according to given criteria.
>
> This is what the SpatialPixelsDataFrame class is for (unless you want to
> change resolution too):
>
> library(rgdal)
> SP27GTIF <- readGDAL(system.file("pictures/SP27GTIF.TIF", package =
>   "rgdal")[1])
> summary(SP27GTIF)
> image(SP27GTIF, col=grey(1:9/10))
> SP27GTIF_a <- as(SP27GTIF, "SpatialPixelsDataFrame")
> summary(SP27GTIF_a)
> SP27GTIF_b <- SP27GTIF_a[SP27GTIF_a$band1 < 100,]
> summary(SP27GTIF_b)
> image(SP27GTIF_b)
>
> because SpatialPixelsDataFrame objects have their coordinates recorded
> explicitly, and "know where they are" on a full grid.
>
> fullgrid(SP27GTIF_b) <- TRUE
> summary(SP27GTIF_b)
>
> will drop them again, inserting NAs where band1 >= 100.
>
> This class is borrowed from the Terralib "CELL" data structure, part
> raster, part DB record, only recording cells with data.
>
> Roger
>
> >
> > Am I using the wrong strategy, should I just demote the spatial class
> using
> > method as.data.frame(), do the manipulation and then promote the
screened
> > values back to a spatial class?
> >
> > Regards
> >
> > Karl
> > _________________________________
> > Karl J Sommer,
> > Department of Primary Industries,
> > PO Box 905
> > Mildura, VIC, Australia 3502
> >
> > Tel: +61 (0)3 5051 4390
> > Fax +61 (0)3 5051 4534
> >
> > Email:     karl.sommer at dpi.vic.gov.au
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at stat.math.ethz.ch
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
>
> --
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>
>
>
>
>
>

--
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From Roger.Bivand at nhh.no  Fri Jun  9 10:11:27 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 9 Jun 2006 10:11:27 +0200 (CEST)
Subject: [R-sig-Geo] selection of data subsets in spatial classes
In-Reply-To: <OF55EE4CB9.B5AC32AD-ONCA257188.002B3AF6-CA257188.002BFA64@nre.vic.gov.au>
Message-ID: <Pine.LNX.4.44.0606091009190.32400-100000@reclus.nhh.no>

On Fri, 9 Jun 2006 karl.sommer at dpi.vic.gov.au wrote:

> 
> after some fiddling with the GridTopology() method I eventually succeeded
> in making it work and now can interpolate onto the grid.
> 
> Tremendous, thanks.

Good

> 
> One problem I encountered when specifying a number smaller than 1 for the
> cellsize argument eg. c(0.5, 0.5) instead of c(1,1),  I get erroneous
> results.
> 
> grd <- GridTopology(c(617400, 6190060), c(1,1), c(400, 300))
> 

I think this is a matter of screen representation:

coordinates(GridTopology(c(617400, 6190060), c(0.5,0.5), c(4, 3)))

looks wrong, but

print(coordinates(GridTopology(c(617400, 6190060), c(0.5,0.5), c(4, 3))), 
  digits=10)

shows that the coordinate values were been rounded for display (is that 
what you are seeing?)

Roger

> Cheers
> Karl
> 
> 
> 
> |---------+---------------------------->
> |         |           Roger.Bivand at nhh.|
> |         |           no               |
> |         |                            |
> |         |           08/06/2006 18:53 |
> |         |           Please respond to|
> |         |           Roger.Bivand     |
> |         |                            |
> |---------+---------------------------->
>   >------------------------------------------------------------------------------------------------------------------------------|
>   |                                                                                                                              |
>   |       To:       karl.sommer at dpi.vic.gov.au                                                                                   |
>   |       cc:       r-sig-geo at stat.math.ethz.ch                                                                                  |
>   |       Subject:  Re: [R-sig-Geo]  selection of data subsets in spatial classes                                                |
>   >------------------------------------------------------------------------------------------------------------------------------|
> 
> 
> 
> 
> On Thu, 8 Jun 2006 karl.sommer at dpi.vic.gov.au wrote:
> 
> >
> > thanks  Roger Bivand, this is really powerful and much less cumbersome
> than
> > I feared.
> >
> > I ran an inverse distance interpolation on some of the screened data.  In
> > order to do so I created a destination file from scratch with a 2 x 2 m
> > grid. The destination file is of rectangular shape and is larger than the
> > field for which a I have the aerial image data which is a polygon.  As a
> > result the kriging procedure extends beyond the field.
> >
> > Is there a way to either create a sampling grid that is the same shape as
> > the field, ie from a shape file,  or is there a way to subtract the two
> > layers such that only the field shape is retained (something similar to
> > mapcalc in GRASS)?
> 
> My immediate guess would be that the overlay method will get you there:
> 
> library(sp)
> plot(1:100, 1:100, type="n")
> poly <- locator()
> poly <- do.call("cbind", poly)
> poly <- rbind(poly, poly[1,])
> lines(poly)
> field <- SpatialPolygons(list(Polygons(list(Polygon(poly)), ID="field")))
> grd <- GridTopology(c(0.5,0.5), c(1,1), c(100, 100))
> SG <- SpatialGrid(grd)
> plot(SG, add=TRUE)
> t1 <- overlay(SG, field)
> SGDF <- SpatialGridDataFrame(grd, data=AttributeList(list(field=t1)))
> SPDF <- as(SGDF, "SpatialPixelsDataFrame")
> plot(SPDF, col="red", add=TRUE)
> 
> and then use the SPDF points for prediction. If you've read in the field
> polygon, you're already mostly set up. It will also work with multiple
> fields, when t1 will know which field the grid point belongs to.
> 
> Using GridTopology to set up prediction grids is quite neat too, it
> provides an object to encapsulate what you are doing, but ensures that you
> register the grid to the grid centres.
> 
> Hope this helps,
> 
> Roger
> 
> >
> > here is my R code
> >
> > library(rgdal)
> > # load rgdal library and import ESRI raster file (aerial image)
> > t1 <- readGDAL( "shi94a9_bnd.bil" ,  half.cell=c(0.5, 0.5), silent =
> FALSE)
> >
> > image(t1, col=grey(1:9/10))
> > summary(t1)
> >
> > t1a <- as(t1, "SpatialPixelsDataFrame")
> > summary(t1a)
> >
> > t1b <- t1a[t1a$band5 > 0,]  # this eliminates values outside the field
> > boundaries which are 0; inter-row pixels had been eliminated previously
> >
> > library(gstat)
> > t1b.idw <- krige(band5~1, t1b,  grid.pts)
> > spplot(t1b.idw["var1.pred"],main="idw PCD map",
> col.regions=bpy.colors(64))
> >
> > # the grid.pts file was created as follows
> > #
> > utm.n.min<- 6190068
> > utm.n.max<- 6190326
> > utm.e.min<- 617405
> > utm.e.max<- 617812
> >
> > spacing<-2  # average linear spacing between points
> > #
> > xseq<-seq(utm.e.min, utm.e.max, by=spacing)
> > yseq<-seq(utm.n.min, utm.n.max, by=spacing)
> >
> > sample.pts<-expand.grid(xseq, yseq)
> > names(sample.pts)<-c("x", "y")
> >
> > ## include the variable in a new object yld.pts
> > grid.pts <- cbind(sample.pts)
> > coordinates(grid.pts)=~x+y
> > gridded(grid.pts)=TRUE
> >
> > Cheers
> >
> > Karl
> >
> >
> >
> > |---------+---------------------------->
> > |         |           Roger.Bivand at nhh.|
> > |         |           no               |
> > |         |                            |
> > |         |           07/06/2006 19:17 |
> > |         |           Please respond to|
> > |         |           Roger.Bivand     |
> > |         |                            |
> > |---------+---------------------------->
> >   >
> ------------------------------------------------------------------------------------------------------------------------------|
> 
> >   |
> |
> >   |       To:       karl.sommer at dpi.vic.gov.au
> |
> >   |       cc:       r-sig-geo at stat.math.ethz.ch
> |
> >   |       Subject:  Re: [R-sig-Geo]  selection of data subsets in spatial
> classes                                                |
> >   >
> ------------------------------------------------------------------------------------------------------------------------------|
> 
> >
> >
> >
> >
> > On Wed, 7 Jun 2006 karl.sommer at dpi.vic.gov.au wrote:
> >
> > > Hello list
> > >
> > > I have been trying to figure out if it is possible to select a subset
> of
> > > data in a SpatialGridDataFrame without prior conversion to a data.frame
> > > using the method as.data.frame().
> > >
> > > I have imported an ESRI " *. bil " file containing different spectral
> > bands
> > > using rgdal.  The file imported as a SpatialGridDataFrame.  The data
> > > originates from an aerial photograph of a row crop and I would like to
> > > select pixels from within a row as opposed to those from the inter-row
> > > space for further interpolation.   Inter-row pixels have a different
> > > signature and therefore may be potentially screened out.  However, I
> have
> > > been unable to access the SpatialGridDataFrame directly with, for
> > example,
> > > a  subset(x, band5 < lowerLimit, select c(a, b) ) call for selecting
> > values
> > > according to given criteria.
> >
> > This is what the SpatialPixelsDataFrame class is for (unless you want to
> > change resolution too):
> >
> > library(rgdal)
> > SP27GTIF <- readGDAL(system.file("pictures/SP27GTIF.TIF", package =
> >   "rgdal")[1])
> > summary(SP27GTIF)
> > image(SP27GTIF, col=grey(1:9/10))
> > SP27GTIF_a <- as(SP27GTIF, "SpatialPixelsDataFrame")
> > summary(SP27GTIF_a)
> > SP27GTIF_b <- SP27GTIF_a[SP27GTIF_a$band1 < 100,]
> > summary(SP27GTIF_b)
> > image(SP27GTIF_b)
> >
> > because SpatialPixelsDataFrame objects have their coordinates recorded
> > explicitly, and "know where they are" on a full grid.
> >
> > fullgrid(SP27GTIF_b) <- TRUE
> > summary(SP27GTIF_b)
> >
> > will drop them again, inserting NAs where band1 >= 100.
> >
> > This class is borrowed from the Terralib "CELL" data structure, part
> > raster, part DB record, only recording cells with data.
> >
> > Roger
> >
> > >
> > > Am I using the wrong strategy, should I just demote the spatial class
> > using
> > > method as.data.frame(), do the manipulation and then promote the
> screened
> > > values back to a spatial class?
> > >
> > > Regards
> > >
> > > Karl
> > > _________________________________
> > > Karl J Sommer,
> > > Department of Primary Industries,
> > > PO Box 905
> > > Mildura, VIC, Australia 3502
> > >
> > > Tel: +61 (0)3 5051 4390
> > > Fax +61 (0)3 5051 4534
> > >
> > > Email:     karl.sommer at dpi.vic.gov.au
> > >
> > > _______________________________________________
> > > R-sig-Geo mailing list
> > > R-sig-Geo at stat.math.ethz.ch
> > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > >
> >
> > --
> > Roger Bivand
> > Economic Geography Section, Department of Economics, Norwegian School of
> > Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> > Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> > e-mail: Roger.Bivand at nhh.no
> >
> >
> >
> >
> >
> >
> 
> --
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
> 
> 
> 
> 
> 
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From karl.sommer at dpi.vic.gov.au  Fri Jun  9 10:30:27 2006
From: karl.sommer at dpi.vic.gov.au (karl.sommer at dpi.vic.gov.au)
Date: Fri, 9 Jun 2006 18:30:27 +1000
Subject: [R-sig-Geo] selection of data subsets in spatial classes
Message-ID: <OFEEC67494.9DB37CEB-ONCA257188.002DC2DA-CA257188.002EBB89@nre.vic.gov.au>


Yes, the grid coordinates reflect the c(0,5, 0,5)

 [1,] 617400.0 6190061.0
 [2,] 617400.5 6190061.0
 [3,] 617401.0 6190061.0
 [4,] 617401.5 6190061.0
 [5,] 617400.0 6190060.5
 [6,] 617400.5 6190060.5

But for some reason, when using the smaller cellsize my spplot of the
interpolated field all of a sudden only shows a subsection of the original
plot.

There are no error messages.

Karl



|---------+---------------------------->
|         |           Roger.Bivand at nhh.|
|         |           no               |
|         |                            |
|         |           09/06/2006 18:11 |
|         |           Please respond to|
|         |           Roger.Bivand     |
|         |                            |
|---------+---------------------------->
  >------------------------------------------------------------------------------------------------------------------------------|
  |                                                                                                                              |
  |       To:       karl.sommer at dpi.vic.gov.au                                                                                   |
  |       cc:       r-sig-geo at stat.math.ethz.ch                                                                                  |
  |       Subject:  Re: [R-sig-Geo]  selection of data subsets in spatial classes                                                |
  >------------------------------------------------------------------------------------------------------------------------------|




On Fri, 9 Jun 2006 karl.sommer at dpi.vic.gov.au wrote:

>
> after some fiddling with the GridTopology() method I eventually succeeded
> in making it work and now can interpolate onto the grid.
>
> Tremendous, thanks.

Good

>
> One problem I encountered when specifying a number smaller than 1 for the
> cellsize argument eg. c(0.5, 0.5) instead of c(1,1),  I get erroneous
> results.
>
> grd <- GridTopology(c(617400, 6190060), c(1,1), c(400, 300))
>

I think this is a matter of screen representation:

coordinates(GridTopology(c(617400, 6190060), c(0.5,0.5), c(4, 3)))

looks wrong, but

print(coordinates(GridTopology(c(617400, 6190060), c(0.5,0.5), c(4, 3))),
  digits=10)

shows that the coordinate values were been rounded for display (is that
what you are seeing?)

Roger

> Cheers
> Karl
>
>
>
> |---------+---------------------------->
> |         |           Roger.Bivand at nhh.|
> |         |           no               |
> |         |                            |
> |         |           08/06/2006 18:53 |
> |         |           Please respond to|
> |         |           Roger.Bivand     |
> |         |                            |
> |---------+---------------------------->
>   >
------------------------------------------------------------------------------------------------------------------------------|

>   |
|
>   |       To:       karl.sommer at dpi.vic.gov.au
|
>   |       cc:       r-sig-geo at stat.math.ethz.ch
|
>   |       Subject:  Re: [R-sig-Geo]  selection of data subsets in spatial
classes                                                |
>   >
------------------------------------------------------------------------------------------------------------------------------|

>
>
>
>
> On Thu, 8 Jun 2006 karl.sommer at dpi.vic.gov.au wrote:
>
> >
> > thanks  Roger Bivand, this is really powerful and much less cumbersome
> than
> > I feared.
> >
> > I ran an inverse distance interpolation on some of the screened data.
In
> > order to do so I created a destination file from scratch with a 2 x 2 m
> > grid. The destination file is of rectangular shape and is larger than
the
> > field for which a I have the aerial image data which is a polygon.  As
a
> > result the kriging procedure extends beyond the field.
> >
> > Is there a way to either create a sampling grid that is the same shape
as
> > the field, ie from a shape file,  or is there a way to subtract the two
> > layers such that only the field shape is retained (something similar to
> > mapcalc in GRASS)?
>
> My immediate guess would be that the overlay method will get you there:
>
> library(sp)
> plot(1:100, 1:100, type="n")
> poly <- locator()
> poly <- do.call("cbind", poly)
> poly <- rbind(poly, poly[1,])
> lines(poly)
> field <- SpatialPolygons(list(Polygons(list(Polygon(poly)), ID="field")))
> grd <- GridTopology(c(0.5,0.5), c(1,1), c(100, 100))
> SG <- SpatialGrid(grd)
> plot(SG, add=TRUE)
> t1 <- overlay(SG, field)
> SGDF <- SpatialGridDataFrame(grd, data=AttributeList(list(field=t1)))
> SPDF <- as(SGDF, "SpatialPixelsDataFrame")
> plot(SPDF, col="red", add=TRUE)
>
> and then use the SPDF points for prediction. If you've read in the field
> polygon, you're already mostly set up. It will also work with multiple
> fields, when t1 will know which field the grid point belongs to.
>
> Using GridTopology to set up prediction grids is quite neat too, it
> provides an object to encapsulate what you are doing, but ensures that
you
> register the grid to the grid centres.
>
> Hope this helps,
>
> Roger
>
> >
> > here is my R code
> >
> > library(rgdal)
> > # load rgdal library and import ESRI raster file (aerial image)
> > t1 <- readGDAL( "shi94a9_bnd.bil" ,  half.cell=c(0.5, 0.5), silent =
> FALSE)
> >
> > image(t1, col=grey(1:9/10))
> > summary(t1)
> >
> > t1a <- as(t1, "SpatialPixelsDataFrame")
> > summary(t1a)
> >
> > t1b <- t1a[t1a$band5 > 0,]  # this eliminates values outside the field
> > boundaries which are 0; inter-row pixels had been eliminated previously
> >
> > library(gstat)
> > t1b.idw <- krige(band5~1, t1b,  grid.pts)
> > spplot(t1b.idw["var1.pred"],main="idw PCD map",
> col.regions=bpy.colors(64))
> >
> > # the grid.pts file was created as follows
> > #
> > utm.n.min<- 6190068
> > utm.n.max<- 6190326
> > utm.e.min<- 617405
> > utm.e.max<- 617812
> >
> > spacing<-2  # average linear spacing between points
> > #
> > xseq<-seq(utm.e.min, utm.e.max, by=spacing)
> > yseq<-seq(utm.n.min, utm.n.max, by=spacing)
> >
> > sample.pts<-expand.grid(xseq, yseq)
> > names(sample.pts)<-c("x", "y")
> >
> > ## include the variable in a new object yld.pts
> > grid.pts <- cbind(sample.pts)
> > coordinates(grid.pts)=~x+y
> > gridded(grid.pts)=TRUE
> >
> > Cheers
> >
> > Karl
> >
> >
> >
> > |---------+---------------------------->
> > |         |           Roger.Bivand at nhh.|
> > |         |           no               |
> > |         |                            |
> > |         |           07/06/2006 19:17 |
> > |         |           Please respond to|
> > |         |           Roger.Bivand     |
> > |         |                            |
> > |---------+---------------------------->
> >   >
>
------------------------------------------------------------------------------------------------------------------------------|

>
> >   |
> |
> >   |       To:       karl.sommer at dpi.vic.gov.au
> |
> >   |       cc:       r-sig-geo at stat.math.ethz.ch
> |
> >   |       Subject:  Re: [R-sig-Geo]  selection of data subsets in
spatial
> classes                                                |
> >   >
>
------------------------------------------------------------------------------------------------------------------------------|

>
> >
> >
> >
> >
> > On Wed, 7 Jun 2006 karl.sommer at dpi.vic.gov.au wrote:
> >
> > > Hello list
> > >
> > > I have been trying to figure out if it is possible to select a subset
> of
> > > data in a SpatialGridDataFrame without prior conversion to a
data.frame
> > > using the method as.data.frame().
> > >
> > > I have imported an ESRI " *. bil " file containing different spectral
> > bands
> > > using rgdal.  The file imported as a SpatialGridDataFrame.  The data
> > > originates from an aerial photograph of a row crop and I would like
to
> > > select pixels from within a row as opposed to those from the
inter-row
> > > space for further interpolation.   Inter-row pixels have a different
> > > signature and therefore may be potentially screened out.  However, I
> have
> > > been unable to access the SpatialGridDataFrame directly with, for
> > example,
> > > a  subset(x, band5 < lowerLimit, select c(a, b) ) call for selecting
> > values
> > > according to given criteria.
> >
> > This is what the SpatialPixelsDataFrame class is for (unless you want
to
> > change resolution too):
> >
> > library(rgdal)
> > SP27GTIF <- readGDAL(system.file("pictures/SP27GTIF.TIF", package =
> >   "rgdal")[1])
> > summary(SP27GTIF)
> > image(SP27GTIF, col=grey(1:9/10))
> > SP27GTIF_a <- as(SP27GTIF, "SpatialPixelsDataFrame")
> > summary(SP27GTIF_a)
> > SP27GTIF_b <- SP27GTIF_a[SP27GTIF_a$band1 < 100,]
> > summary(SP27GTIF_b)
> > image(SP27GTIF_b)
> >
> > because SpatialPixelsDataFrame objects have their coordinates recorded
> > explicitly, and "know where they are" on a full grid.
> >
> > fullgrid(SP27GTIF_b) <- TRUE
> > summary(SP27GTIF_b)
> >
> > will drop them again, inserting NAs where band1 >= 100.
> >
> > This class is borrowed from the Terralib "CELL" data structure, part
> > raster, part DB record, only recording cells with data.
> >
> > Roger
> >
> > >
> > > Am I using the wrong strategy, should I just demote the spatial class
> > using
> > > method as.data.frame(), do the manipulation and then promote the
> screened
> > > values back to a spatial class?
> > >
> > > Regards
> > >
> > > Karl
> > > _________________________________
> > > Karl J Sommer,
> > > Department of Primary Industries,
> > > PO Box 905
> > > Mildura, VIC, Australia 3502
> > >
> > > Tel: +61 (0)3 5051 4390
> > > Fax +61 (0)3 5051 4534
> > >
> > > Email:     karl.sommer at dpi.vic.gov.au
> > >
> > > _______________________________________________
> > > R-sig-Geo mailing list
> > > R-sig-Geo at stat.math.ethz.ch
> > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > >
> >
> > --
> > Roger Bivand
> > Economic Geography Section, Department of Economics, Norwegian School
of
> > Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> > Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> > e-mail: Roger.Bivand at nhh.no
> >
> >
> >
> >
> >
> >
>
> --
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>
>
>
>
>
>

--
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From e.pebesma at geo.uu.nl  Fri Jun  9 11:02:50 2006
From: e.pebesma at geo.uu.nl (Edzer J. Pebesma)
Date: Fri, 09 Jun 2006 11:02:50 +0200
Subject: [R-sig-Geo] selection of data subsets in spatial classes
In-Reply-To: <OFEEC67494.9DB37CEB-ONCA257188.002DC2DA-CA257188.002EBB89@nre.vic.gov.au>
References: <OFEEC67494.9DB37CEB-ONCA257188.002DC2DA-CA257188.002EBB89@nre.vic.gov.au>
Message-ID: <4489393A.8030408@geo.uu.nl>

Karl, I cannot reproduce your problem:

library(sp)
grd <- GridTopology(c(617400, 6190060), c(.5,.5), c(400, 300))
grdx = SpatialGridDataFrame(grd, data = data.frame(z= 1:120000))
spplot(grdx, col.regions=bpy.colors())

shows exactly what I expected.
--
Edzer

karl.sommer at dpi.vic.gov.au wrote:
> Yes, the grid coordinates reflect the c(0,5, 0,5)
>
>  [1,] 617400.0 6190061.0
>  [2,] 617400.5 6190061.0
>  [3,] 617401.0 6190061.0
>  [4,] 617401.5 6190061.0
>  [5,] 617400.0 6190060.5
>  [6,] 617400.5 6190060.5
>
> But for some reason, when using the smaller cellsize my spplot of the
> interpolated field all of a sudden only shows a subsection of the original
> plot.
>
> There are no error messages.
>
> Karl
>
>
>
> |---------+---------------------------->
> |         |           Roger.Bivand at nhh.|
> |         |           no               |
> |         |                            |
> |         |           09/06/2006 18:11 |
> |         |           Please respond to|
> |         |           Roger.Bivand     |
> |         |                            |
> |---------+---------------------------->
>   >------------------------------------------------------------------------------------------------------------------------------|
>   |                                                                                                                              |
>   |       To:       karl.sommer at dpi.vic.gov.au                                                                                   |
>   |       cc:       r-sig-geo at stat.math.ethz.ch                                                                                  |
>   |       Subject:  Re: [R-sig-Geo]  selection of data subsets in spatial classes                                                |
>   >------------------------------------------------------------------------------------------------------------------------------|
>
>
>
>
> On Fri, 9 Jun 2006 karl.sommer at dpi.vic.gov.au wrote:
>
>   
>> after some fiddling with the GridTopology() method I eventually succeeded
>> in making it work and now can interpolate onto the grid.
>>
>> Tremendous, thanks.
>>     
>
> Good
>
>   
>> One problem I encountered when specifying a number smaller than 1 for the
>> cellsize argument eg. c(0.5, 0.5) instead of c(1,1),  I get erroneous
>> results.
>>
>> grd <- GridTopology(c(617400, 6190060), c(1,1), c(400, 300))
>>
>>     
>
> I think this is a matter of screen representation:
>
> coordinates(GridTopology(c(617400, 6190060), c(0.5,0.5), c(4, 3)))
>
> looks wrong, but
>
> print(coordinates(GridTopology(c(617400, 6190060), c(0.5,0.5), c(4, 3))),
>   digits=10)
>
> shows that the coordinate values were been rounded for display (is that
> what you are seeing?)
>
> Roger
>
>   
>> Cheers
>> Karl
>>
>>
>>
>> |---------+---------------------------->
>> |         |           Roger.Bivand at nhh.|
>> |         |           no               |
>> |         |                            |
>> |         |           08/06/2006 18:53 |
>> |         |           Please respond to|
>> |         |           Roger.Bivand     |
>> |         |                            |
>> |---------+---------------------------->
>>   >
>>     
> ------------------------------------------------------------------------------------------------------------------------------|
>
>   
>>   |
>>     
> |
>   
>>   |       To:       karl.sommer at dpi.vic.gov.au
>>     
> |
>   
>>   |       cc:       r-sig-geo at stat.math.ethz.ch
>>     
> |
>   
>>   |       Subject:  Re: [R-sig-Geo]  selection of data subsets in spatial
>>     
> classes                                                |
>   
>>   >
>>     
> ------------------------------------------------------------------------------------------------------------------------------|
>
>   
>>
>>
>> On Thu, 8 Jun 2006 karl.sommer at dpi.vic.gov.au wrote:
>>
>>     
>>> thanks  Roger Bivand, this is really powerful and much less cumbersome
>>>       
>> than
>>     
>>> I feared.
>>>
>>> I ran an inverse distance interpolation on some of the screened data.
>>>       
> In
>   
>>> order to do so I created a destination file from scratch with a 2 x 2 m
>>> grid. The destination file is of rectangular shape and is larger than
>>>       
> the
>   
>>> field for which a I have the aerial image data which is a polygon.  As
>>>       
> a
>   
>>> result the kriging procedure extends beyond the field.
>>>
>>> Is there a way to either create a sampling grid that is the same shape
>>>       
> as
>   
>>> the field, ie from a shape file,  or is there a way to subtract the two
>>> layers such that only the field shape is retained (something similar to
>>> mapcalc in GRASS)?
>>>       
>> My immediate guess would be that the overlay method will get you there:
>>
>> library(sp)
>> plot(1:100, 1:100, type="n")
>> poly <- locator()
>> poly <- do.call("cbind", poly)
>> poly <- rbind(poly, poly[1,])
>> lines(poly)
>> field <- SpatialPolygons(list(Polygons(list(Polygon(poly)), ID="field")))
>> grd <- GridTopology(c(0.5,0.5), c(1,1), c(100, 100))
>> SG <- SpatialGrid(grd)
>> plot(SG, add=TRUE)
>> t1 <- overlay(SG, field)
>> SGDF <- SpatialGridDataFrame(grd, data=AttributeList(list(field=t1)))
>> SPDF <- as(SGDF, "SpatialPixelsDataFrame")
>> plot(SPDF, col="red", add=TRUE)
>>
>> and then use the SPDF points for prediction. If you've read in the field
>> polygon, you're already mostly set up. It will also work with multiple
>> fields, when t1 will know which field the grid point belongs to.
>>
>> Using GridTopology to set up prediction grids is quite neat too, it
>> provides an object to encapsulate what you are doing, but ensures that
>>     
> you
>   
>> register the grid to the grid centres.
>>
>> Hope this helps,
>>
>> Roger
>>
>>     
>>> here is my R code
>>>
>>> library(rgdal)
>>> # load rgdal library and import ESRI raster file (aerial image)
>>> t1 <- readGDAL( "shi94a9_bnd.bil" ,  half.cell=c(0.5, 0.5), silent =
>>>       
>> FALSE)
>>     
>>> image(t1, col=grey(1:9/10))
>>> summary(t1)
>>>
>>> t1a <- as(t1, "SpatialPixelsDataFrame")
>>> summary(t1a)
>>>
>>> t1b <- t1a[t1a$band5 > 0,]  # this eliminates values outside the field
>>> boundaries which are 0; inter-row pixels had been eliminated previously
>>>
>>> library(gstat)
>>> t1b.idw <- krige(band5~1, t1b,  grid.pts)
>>> spplot(t1b.idw["var1.pred"],main="idw PCD map",
>>>       
>> col.regions=bpy.colors(64))
>>     
>>> # the grid.pts file was created as follows
>>> #
>>> utm.n.min<- 6190068
>>> utm.n.max<- 6190326
>>> utm.e.min<- 617405
>>> utm.e.max<- 617812
>>>
>>> spacing<-2  # average linear spacing between points
>>> #
>>> xseq<-seq(utm.e.min, utm.e.max, by=spacing)
>>> yseq<-seq(utm.n.min, utm.n.max, by=spacing)
>>>
>>> sample.pts<-expand.grid(xseq, yseq)
>>> names(sample.pts)<-c("x", "y")
>>>
>>> ## include the variable in a new object yld.pts
>>> grid.pts <- cbind(sample.pts)
>>> coordinates(grid.pts)=~x+y
>>> gridded(grid.pts)=TRUE
>>>
>>> Cheers
>>>
>>> Karl
>>>
>>>
>>>
>>> |---------+---------------------------->
>>> |         |           Roger.Bivand at nhh.|
>>> |         |           no               |
>>> |         |                            |
>>> |         |           07/06/2006 19:17 |
>>> |         |           Please respond to|
>>> |         |           Roger.Bivand     |
>>> |         |                            |
>>> |---------+---------------------------->
>>>   >
>>>       
> ------------------------------------------------------------------------------------------------------------------------------|
>
>   
>>>   |
>>>       
>> |
>>     
>>>   |       To:       karl.sommer at dpi.vic.gov.au
>>>       
>> |
>>     
>>>   |       cc:       r-sig-geo at stat.math.ethz.ch
>>>       
>> |
>>     
>>>   |       Subject:  Re: [R-sig-Geo]  selection of data subsets in
>>>       
> spatial
>   
>> classes                                                |
>>     
>>>   >
>>>       
> ------------------------------------------------------------------------------------------------------------------------------|
>
>   
>>>
>>>
>>> On Wed, 7 Jun 2006 karl.sommer at dpi.vic.gov.au wrote:
>>>
>>>       
>>>> Hello list
>>>>
>>>> I have been trying to figure out if it is possible to select a subset
>>>>         
>> of
>>     
>>>> data in a SpatialGridDataFrame without prior conversion to a
>>>>         
> data.frame
>   
>>>> using the method as.data.frame().
>>>>
>>>> I have imported an ESRI " *. bil " file containing different spectral
>>>>         
>>> bands
>>>       
>>>> using rgdal.  The file imported as a SpatialGridDataFrame.  The data
>>>> originates from an aerial photograph of a row crop and I would like
>>>>         
> to
>   
>>>> select pixels from within a row as opposed to those from the
>>>>         
> inter-row
>   
>>>> space for further interpolation.   Inter-row pixels have a different
>>>> signature and therefore may be potentially screened out.  However, I
>>>>         
>> have
>>     
>>>> been unable to access the SpatialGridDataFrame directly with, for
>>>>         
>>> example,
>>>       
>>>> a  subset(x, band5 < lowerLimit, select c(a, b) ) call for selecting
>>>>         
>>> values
>>>       
>>>> according to given criteria.
>>>>         
>>> This is what the SpatialPixelsDataFrame class is for (unless you want
>>>       
> to
>   
>>> change resolution too):
>>>
>>> library(rgdal)
>>> SP27GTIF <- readGDAL(system.file("pictures/SP27GTIF.TIF", package =
>>>   "rgdal")[1])
>>> summary(SP27GTIF)
>>> image(SP27GTIF, col=grey(1:9/10))
>>> SP27GTIF_a <- as(SP27GTIF, "SpatialPixelsDataFrame")
>>> summary(SP27GTIF_a)
>>> SP27GTIF_b <- SP27GTIF_a[SP27GTIF_a$band1 < 100,]
>>> summary(SP27GTIF_b)
>>> image(SP27GTIF_b)
>>>
>>> because SpatialPixelsDataFrame objects have their coordinates recorded
>>> explicitly, and "know where they are" on a full grid.
>>>
>>> fullgrid(SP27GTIF_b) <- TRUE
>>> summary(SP27GTIF_b)
>>>
>>> will drop them again, inserting NAs where band1 >= 100.
>>>
>>> This class is borrowed from the Terralib "CELL" data structure, part
>>> raster, part DB record, only recording cells with data.
>>>
>>> Roger
>>>
>>>       
>>>> Am I using the wrong strategy, should I just demote the spatial class
>>>>         
>>> using
>>>       
>>>> method as.data.frame(), do the manipulation and then promote the
>>>>         
>> screened
>>     
>>>> values back to a spatial class?
>>>>
>>>> Regards
>>>>
>>>> Karl
>>>> _________________________________
>>>> Karl J Sommer,
>>>> Department of Primary Industries,
>>>> PO Box 905
>>>> Mildura, VIC, Australia 3502
>>>>
>>>> Tel: +61 (0)3 5051 4390
>>>> Fax +61 (0)3 5051 4534
>>>>
>>>> Email:     karl.sommer at dpi.vic.gov.au
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at stat.math.ethz.ch
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>>         
>>> --
>>> Roger Bivand
>>> Economic Geography Section, Department of Economics, Norwegian School
>>>       
> of
>   
>>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>>> e-mail: Roger.Bivand at nhh.no
>>>
>>>
>>>
>>>
>>>
>>>
>>>       
>> --
>> Roger Bivand
>> Economic Geography Section, Department of Economics, Norwegian School of
>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>> e-mail: Roger.Bivand at nhh.no
>>
>>
>>
>>
>>
>>
>>     
>
> --
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



From Roger.Bivand at nhh.no  Fri Jun  9 13:08:28 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 9 Jun 2006 13:08:28 +0200 (CEST)
Subject: [R-sig-Geo] selection of data subsets in spatial classes
In-Reply-To: <4489393A.8030408@geo.uu.nl>
Message-ID: <Pine.LNX.4.44.0606091306380.32509-100000@reclus.nhh.no>

Karl,

When you reduce the cell sizes, are you increasing the cell dims 
proportionally, otherwise you will get what you are saying?

Roger


On Fri, 9 Jun 2006, Edzer J. Pebesma wrote:

> Karl, I cannot reproduce your problem:
> 
> library(sp)
> grd <- GridTopology(c(617400, 6190060), c(.5,.5), c(400, 300))
> grdx = SpatialGridDataFrame(grd, data = data.frame(z= 1:120000))
> spplot(grdx, col.regions=bpy.colors())
> 
> shows exactly what I expected.
> --
> Edzer
> 
> karl.sommer at dpi.vic.gov.au wrote:
> > Yes, the grid coordinates reflect the c(0,5, 0,5)
> >
> >  [1,] 617400.0 6190061.0
> >  [2,] 617400.5 6190061.0
> >  [3,] 617401.0 6190061.0
> >  [4,] 617401.5 6190061.0
> >  [5,] 617400.0 6190060.5
> >  [6,] 617400.5 6190060.5
> >
> > But for some reason, when using the smaller cellsize my spplot of the
> > interpolated field all of a sudden only shows a subsection of the original
> > plot.
> >
> > There are no error messages.
> >
> > Karl
> >
> >
> >
> > |---------+---------------------------->
> > |         |           Roger.Bivand at nhh.|
> > |         |           no               |
> > |         |                            |
> > |         |           09/06/2006 18:11 |
> > |         |           Please respond to|
> > |         |           Roger.Bivand     |
> > |         |                            |
> > |---------+---------------------------->
> >   >------------------------------------------------------------------------------------------------------------------------------|
> >   |                                                                                                                              |
> >   |       To:       karl.sommer at dpi.vic.gov.au                                                                                   |
> >   |       cc:       r-sig-geo at stat.math.ethz.ch                                                                                  |
> >   |       Subject:  Re: [R-sig-Geo]  selection of data subsets in spatial classes                                                |
> >   >------------------------------------------------------------------------------------------------------------------------------|
> >
> >
> >
> >
> > On Fri, 9 Jun 2006 karl.sommer at dpi.vic.gov.au wrote:
> >
> >   
> >> after some fiddling with the GridTopology() method I eventually succeeded
> >> in making it work and now can interpolate onto the grid.
> >>
> >> Tremendous, thanks.
> >>     
> >
> > Good
> >
> >   
> >> One problem I encountered when specifying a number smaller than 1 for the
> >> cellsize argument eg. c(0.5, 0.5) instead of c(1,1),  I get erroneous
> >> results.
> >>
> >> grd <- GridTopology(c(617400, 6190060), c(1,1), c(400, 300))
> >>
> >>     
> >
> > I think this is a matter of screen representation:
> >
> > coordinates(GridTopology(c(617400, 6190060), c(0.5,0.5), c(4, 3)))
> >
> > looks wrong, but
> >
> > print(coordinates(GridTopology(c(617400, 6190060), c(0.5,0.5), c(4, 3))),
> >   digits=10)
> >
> > shows that the coordinate values were been rounded for display (is that
> > what you are seeing?)
> >
> > Roger
> >
> >   
> >> Cheers
> >> Karl
> >>
> >>
> >>
> >> |---------+---------------------------->
> >> |         |           Roger.Bivand at nhh.|
> >> |         |           no               |
> >> |         |                            |
> >> |         |           08/06/2006 18:53 |
> >> |         |           Please respond to|
> >> |         |           Roger.Bivand     |
> >> |         |                            |
> >> |---------+---------------------------->
> >>   >
> >>     
> > ------------------------------------------------------------------------------------------------------------------------------|
> >
> >   
> >>   |
> >>     
> > |
> >   
> >>   |       To:       karl.sommer at dpi.vic.gov.au
> >>     
> > |
> >   
> >>   |       cc:       r-sig-geo at stat.math.ethz.ch
> >>     
> > |
> >   
> >>   |       Subject:  Re: [R-sig-Geo]  selection of data subsets in spatial
> >>     
> > classes                                                |
> >   
> >>   >
> >>     
> > ------------------------------------------------------------------------------------------------------------------------------|
> >
> >   
> >>
> >>
> >> On Thu, 8 Jun 2006 karl.sommer at dpi.vic.gov.au wrote:
> >>
> >>     
> >>> thanks  Roger Bivand, this is really powerful and much less cumbersome
> >>>       
> >> than
> >>     
> >>> I feared.
> >>>
> >>> I ran an inverse distance interpolation on some of the screened data.
> >>>       
> > In
> >   
> >>> order to do so I created a destination file from scratch with a 2 x 2 m
> >>> grid. The destination file is of rectangular shape and is larger than
> >>>       
> > the
> >   
> >>> field for which a I have the aerial image data which is a polygon.  As
> >>>       
> > a
> >   
> >>> result the kriging procedure extends beyond the field.
> >>>
> >>> Is there a way to either create a sampling grid that is the same shape
> >>>       
> > as
> >   
> >>> the field, ie from a shape file,  or is there a way to subtract the two
> >>> layers such that only the field shape is retained (something similar to
> >>> mapcalc in GRASS)?
> >>>       
> >> My immediate guess would be that the overlay method will get you there:
> >>
> >> library(sp)
> >> plot(1:100, 1:100, type="n")
> >> poly <- locator()
> >> poly <- do.call("cbind", poly)
> >> poly <- rbind(poly, poly[1,])
> >> lines(poly)
> >> field <- SpatialPolygons(list(Polygons(list(Polygon(poly)), ID="field")))
> >> grd <- GridTopology(c(0.5,0.5), c(1,1), c(100, 100))
> >> SG <- SpatialGrid(grd)
> >> plot(SG, add=TRUE)
> >> t1 <- overlay(SG, field)
> >> SGDF <- SpatialGridDataFrame(grd, data=AttributeList(list(field=t1)))
> >> SPDF <- as(SGDF, "SpatialPixelsDataFrame")
> >> plot(SPDF, col="red", add=TRUE)
> >>
> >> and then use the SPDF points for prediction. If you've read in the field
> >> polygon, you're already mostly set up. It will also work with multiple
> >> fields, when t1 will know which field the grid point belongs to.
> >>
> >> Using GridTopology to set up prediction grids is quite neat too, it
> >> provides an object to encapsulate what you are doing, but ensures that
> >>     
> > you
> >   
> >> register the grid to the grid centres.
> >>
> >> Hope this helps,
> >>
> >> Roger
> >>
> >>     
> >>> here is my R code
> >>>
> >>> library(rgdal)
> >>> # load rgdal library and import ESRI raster file (aerial image)
> >>> t1 <- readGDAL( "shi94a9_bnd.bil" ,  half.cell=c(0.5, 0.5), silent =
> >>>       
> >> FALSE)
> >>     
> >>> image(t1, col=grey(1:9/10))
> >>> summary(t1)
> >>>
> >>> t1a <- as(t1, "SpatialPixelsDataFrame")
> >>> summary(t1a)
> >>>
> >>> t1b <- t1a[t1a$band5 > 0,]  # this eliminates values outside the field
> >>> boundaries which are 0; inter-row pixels had been eliminated previously
> >>>
> >>> library(gstat)
> >>> t1b.idw <- krige(band5~1, t1b,  grid.pts)
> >>> spplot(t1b.idw["var1.pred"],main="idw PCD map",
> >>>       
> >> col.regions=bpy.colors(64))
> >>     
> >>> # the grid.pts file was created as follows
> >>> #
> >>> utm.n.min<- 6190068
> >>> utm.n.max<- 6190326
> >>> utm.e.min<- 617405
> >>> utm.e.max<- 617812
> >>>
> >>> spacing<-2  # average linear spacing between points
> >>> #
> >>> xseq<-seq(utm.e.min, utm.e.max, by=spacing)
> >>> yseq<-seq(utm.n.min, utm.n.max, by=spacing)
> >>>
> >>> sample.pts<-expand.grid(xseq, yseq)
> >>> names(sample.pts)<-c("x", "y")
> >>>
> >>> ## include the variable in a new object yld.pts
> >>> grid.pts <- cbind(sample.pts)
> >>> coordinates(grid.pts)=~x+y
> >>> gridded(grid.pts)=TRUE
> >>>
> >>> Cheers
> >>>
> >>> Karl
> >>>
> >>>
> >>>
> >>> |---------+---------------------------->
> >>> |         |           Roger.Bivand at nhh.|
> >>> |         |           no               |
> >>> |         |                            |
> >>> |         |           07/06/2006 19:17 |
> >>> |         |           Please respond to|
> >>> |         |           Roger.Bivand     |
> >>> |         |                            |
> >>> |---------+---------------------------->
> >>>   >
> >>>       
> > ------------------------------------------------------------------------------------------------------------------------------|
> >
> >   
> >>>   |
> >>>       
> >> |
> >>     
> >>>   |       To:       karl.sommer at dpi.vic.gov.au
> >>>       
> >> |
> >>     
> >>>   |       cc:       r-sig-geo at stat.math.ethz.ch
> >>>       
> >> |
> >>     
> >>>   |       Subject:  Re: [R-sig-Geo]  selection of data subsets in
> >>>       
> > spatial
> >   
> >> classes                                                |
> >>     
> >>>   >
> >>>       
> > ------------------------------------------------------------------------------------------------------------------------------|
> >
> >   
> >>>
> >>>
> >>> On Wed, 7 Jun 2006 karl.sommer at dpi.vic.gov.au wrote:
> >>>
> >>>       
> >>>> Hello list
> >>>>
> >>>> I have been trying to figure out if it is possible to select a subset
> >>>>         
> >> of
> >>     
> >>>> data in a SpatialGridDataFrame without prior conversion to a
> >>>>         
> > data.frame
> >   
> >>>> using the method as.data.frame().
> >>>>
> >>>> I have imported an ESRI " *. bil " file containing different spectral
> >>>>         
> >>> bands
> >>>       
> >>>> using rgdal.  The file imported as a SpatialGridDataFrame.  The data
> >>>> originates from an aerial photograph of a row crop and I would like
> >>>>         
> > to
> >   
> >>>> select pixels from within a row as opposed to those from the
> >>>>         
> > inter-row
> >   
> >>>> space for further interpolation.   Inter-row pixels have a different
> >>>> signature and therefore may be potentially screened out.  However, I
> >>>>         
> >> have
> >>     
> >>>> been unable to access the SpatialGridDataFrame directly with, for
> >>>>         
> >>> example,
> >>>       
> >>>> a  subset(x, band5 < lowerLimit, select c(a, b) ) call for selecting
> >>>>         
> >>> values
> >>>       
> >>>> according to given criteria.
> >>>>         
> >>> This is what the SpatialPixelsDataFrame class is for (unless you want
> >>>       
> > to
> >   
> >>> change resolution too):
> >>>
> >>> library(rgdal)
> >>> SP27GTIF <- readGDAL(system.file("pictures/SP27GTIF.TIF", package =
> >>>   "rgdal")[1])
> >>> summary(SP27GTIF)
> >>> image(SP27GTIF, col=grey(1:9/10))
> >>> SP27GTIF_a <- as(SP27GTIF, "SpatialPixelsDataFrame")
> >>> summary(SP27GTIF_a)
> >>> SP27GTIF_b <- SP27GTIF_a[SP27GTIF_a$band1 < 100,]
> >>> summary(SP27GTIF_b)
> >>> image(SP27GTIF_b)
> >>>
> >>> because SpatialPixelsDataFrame objects have their coordinates recorded
> >>> explicitly, and "know where they are" on a full grid.
> >>>
> >>> fullgrid(SP27GTIF_b) <- TRUE
> >>> summary(SP27GTIF_b)
> >>>
> >>> will drop them again, inserting NAs where band1 >= 100.
> >>>
> >>> This class is borrowed from the Terralib "CELL" data structure, part
> >>> raster, part DB record, only recording cells with data.
> >>>
> >>> Roger
> >>>
> >>>       
> >>>> Am I using the wrong strategy, should I just demote the spatial class
> >>>>         
> >>> using
> >>>       
> >>>> method as.data.frame(), do the manipulation and then promote the
> >>>>         
> >> screened
> >>     
> >>>> values back to a spatial class?
> >>>>
> >>>> Regards
> >>>>
> >>>> Karl
> >>>> _________________________________
> >>>> Karl J Sommer,
> >>>> Department of Primary Industries,
> >>>> PO Box 905
> >>>> Mildura, VIC, Australia 3502
> >>>>
> >>>> Tel: +61 (0)3 5051 4390
> >>>> Fax +61 (0)3 5051 4534
> >>>>
> >>>> Email:     karl.sommer at dpi.vic.gov.au
> >>>>
> >>>> _______________________________________________
> >>>> R-sig-Geo mailing list
> >>>> R-sig-Geo at stat.math.ethz.ch
> >>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >>>>
> >>>>         
> >>> --
> >>> Roger Bivand
> >>> Economic Geography Section, Department of Economics, Norwegian School
> >>>       
> > of
> >   
> >>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> >>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> >>> e-mail: Roger.Bivand at nhh.no
> >>>
> >>>
> >>>
> >>>
> >>>
> >>>
> >>>       
> >> --
> >> Roger Bivand
> >> Economic Geography Section, Department of Economics, Norwegian School of
> >> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> >> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> >> e-mail: Roger.Bivand at nhh.no
> >>
> >>
> >>
> >>
> >>
> >>
> >>     
> >
> > --
> > Roger Bivand
> > Economic Geography Section, Department of Economics, Norwegian School of
> > Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> > Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> > e-mail: Roger.Bivand at nhh.no
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at stat.math.ethz.ch
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >   
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From Roger.Bivand at nhh.no  Mon Jun 12 09:09:47 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 12 Jun 2006 09:09:47 +0200 (CEST)
Subject: [R-sig-Geo] rgdal installation problem on Linux SuSe10.0
In-Reply-To: <CBEOLOCONKCPFHLFGEAMKECLCBAA.sommer@ncable.com.au>
Message-ID: <Pine.LNX.4.44.0606120902010.19385-100000@reclus.nhh.no>

Hello Karl,

I've just posted instructions on how to pass configure options into the 
INSTALL process:

http://www.sal.uiuc.edu/tools/tools-sum/rgeo/rgeo-detail/map-packages-on-cran

under rgdal - look for paragraph about OSX, the same will apply to all
INSTALL from the source package. I'm CC-ing this reply to R-sig-geo for
the record. The next release of rgdal will include the new configure
script, but can't be released just yet.

Roger


On Mon, 12 Jun 2006, Karl Sommer & Meryl Hale wrote:

> Hello Roger Bivand
> 
> I am addressing this email directly to you rather than going through the
> r-geo list.
> 
> Over the weekend I wanted to test your latest suggestion regarding the
> GridTopology command on my home computer.  I am running R on a Linux SuSe
> 10.0 system at home and so far had not installed the rgdal libraries. (At
> work I am running R under Windows 2000).
> 
> I downloaded the latest rgdal_0.4-4.tar.gz file and proceeded to install it
> as follows:
> 
> install.packages("rgdal_0.4-4.tar.gz","usr/lib/R/library",repos=NULL)
> * Installing *source* package 'rgdal' ...
> checking for gcc... gcc
> checking for C compiler default output file name... a.out
> checking whether the C compiler works... yes
> checking whether we are cross compiling... no
> checking for suffix of executables...
> checking for suffix of object files... o
> checking whether we are using the GNU C compiler... yes
> checking whether gcc accepts -g... yes
> checking for gcc option to accept ANSI C... none needed
> checking for pj_init_plus in -lproj... no
> checking how to run the C preprocessor... gcc -E
> checking for egrep... grep -E
> checking for ANSI C header files... yes
> checking for sys/types.h... yes
> checking for sys/stat.h... yes
> checking for stdlib.h... yes
> checking for string.h... yes
> checking for memory.h... yes
> checking for strings.h... yes
> checking for inttypes.h... yes
> checking for stdint.h... yes
> checking for unistd.h... yes
> checking proj_api.h usability... no
> checking proj_api.h presence... no
> checking for proj_api.h... no
> libproj.a and proj_api.h not found in standard search locations,
> edit src/Makevars manually, adding -I<directory with proj_api.h>
> to PKG_CPPFLAGS = , and -L<directory with libproj.a> to PKG_LIBS =
> ERROR: configuration failed for package 'rgdal'
> ** Removing '/usr/lib/R/library/usr/lib/R/library/rgdal'
> Warning message:
> installation of package 'rgdal_0.4-4.tar.gz' had non-zero exit status in:
> install.packages("rgdal_0.4-4.tar.gz", "usr/lib/R/library", repos = NULL)
> >
> 
> After searching the r-geo mailing lists I found that someone has recently
> (Thomas Adams, 23 May) encountered a similar problem and you had advised
> that you would contact him directly rather than through the list because the
> problem was rather specific.
> 
> I believe the above errors are almost identical to the problem referred to
> in the list.
> 
> I have installed FWTool-1.0.0b2 and have located the proj_api.h in its
> /include subdirectory but haven't been able to locate "libproj.a".  At the
> moment I don't know how to progress and therefore would be most grateful for
> your advice.

PS. Consider installing PROJ.4 from source in addition in order to build 
libproj.a, it may not be built in FWTools.

> 
> Regards
> 
> Karl  Sommer
> 
> PS what about the additional packages that usually load with library(rgdal)
> , are they part of the rgdal installation or will they have to be installed
> separately?
> 
> karl.sommer at dpi.vic.gov.au
> sommer at ncable.com.au
> 
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From rusers.sh at gmail.com  Mon Jun 12 15:04:38 2006
From: rusers.sh at gmail.com (zhijie zhang)
Date: Mon, 12 Jun 2006 21:04:38 +0800
Subject: [R-sig-Geo] unclear contents on spatial package
Message-ID: <a835c81e0606120604m55050280mc1f8163dc4c83fe6@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20060612/fa5e5dc2/attachment.pl>

From sorincheval at yahoo.com  Mon Jun 12 15:44:43 2006
From: sorincheval at yahoo.com (Sorin Cheval)
Date: Mon, 12 Jun 2006 06:44:43 -0700 (PDT)
Subject: [R-sig-Geo] joining 'n' tables in R
In-Reply-To: <mailman.15.1150106404.10250.r-sig-geo@stat.math.ethz.ch>
Message-ID: <20060612134443.46800.qmail@web31713.mail.mud.yahoo.com>

Hello,

I need to join 110 tables (.txt files) in R based on a
common field. If anyone has a suggestion, I'd
appreciate a lot.

Thanks,
Sorin Cheval



From Roger.Bivand at nhh.no  Mon Jun 12 19:33:04 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 12 Jun 2006 19:33:04 +0200 (CEST)
Subject: [R-sig-Geo] joining 'n' tables in R
In-Reply-To: <20060612134443.46800.qmail@web31713.mail.mud.yahoo.com>
Message-ID: <Pine.LNX.4.44.0606121930570.19385-100000@reclus.nhh.no>

On Mon, 12 Jun 2006, Sorin Cheval wrote:

> Hello,
> 
> I need to join 110 tables (.txt files) in R based on a
> common field. If anyone has a suggestion, I'd
> appreciate a lot.

Perhaps have a look at ?merge, and try it out on a simple example first. 
It merges data.frame objects, and the by=, by.x= and by.y= arguments can 
be used to define the common field. Watch sort=, because by default the 
rows will be sorted.

> 
> Thanks,
> Sorin Cheval
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From karl.sommer at dpi.vic.gov.au  Tue Jun 13 02:14:52 2006
From: karl.sommer at dpi.vic.gov.au (karl.sommer at dpi.vic.gov.au)
Date: Tue, 13 Jun 2006 10:14:52 +1000
Subject: [R-sig-Geo] selection of data subsets in spatial classes
Message-ID: <OF2E0524E5.8A008A90-ONCA25718C.0000E4EB-CA25718C.00015CAB@nre.vic.gov.au>


Roger

of course, the problem was, as you suggested, that I did not adjust the
cell dimensions.

Thanks again

Karl



|---------+---------------------------->
|         |           Roger.Bivand at nhh.|
|         |           no               |
|         |                            |
|         |           09/06/2006 21:08 |
|         |           Please respond to|
|         |           Roger.Bivand     |
|         |                            |
|---------+---------------------------->
  >------------------------------------------------------------------------------------------------------------------------------|
  |                                                                                                                              |
  |       To:       e.pebesma at geo.uu.nl                                                                                          |
  |       cc:       karl.sommer at dpi.vic.gov.au, r-sig-geo at stat.math.ethz.ch                                                      |
  |       Subject:  Re: [R-sig-Geo] selection of data subsets in spatial classes                                                 |
  >------------------------------------------------------------------------------------------------------------------------------|




Karl,

When you reduce the cell sizes, are you increasing the cell dims
proportionally, otherwise you will get what you are saying?

Roger


On Fri, 9 Jun 2006, Edzer J. Pebesma wrote:

> Karl, I cannot reproduce your problem:
>
> library(sp)
> grd <- GridTopology(c(617400, 6190060), c(.5,.5), c(400, 300))
> grdx = SpatialGridDataFrame(grd, data = data.frame(z= 1:120000))
> spplot(grdx, col.regions=bpy.colors())
>
> shows exactly what I expected.
> --
> Edzer
>
> karl.sommer at dpi.vic.gov.au wrote:
> > Yes, the grid coordinates reflect the c(0,5, 0,5)
> >
> >  [1,] 617400.0 6190061.0
> >  [2,] 617400.5 6190061.0
> >  [3,] 617401.0 6190061.0
> >  [4,] 617401.5 6190061.0
> >  [5,] 617400.0 6190060.5
> >  [6,] 617400.5 6190060.5
> >
> > But for some reason, when using the smaller cellsize my spplot of the
> > interpolated field all of a sudden only shows a subsection of the
original
> > plot.
> >
> > There are no error messages.
> >
> > Karl
> >
> >
> >
> > |---------+---------------------------->
> > |         |           Roger.Bivand at nhh.|
> > |         |           no               |
> > |         |                            |
> > |         |           09/06/2006 18:11 |
> > |         |           Please respond to|
> > |         |           Roger.Bivand     |
> > |         |                            |
> > |---------+---------------------------->
> >   >
------------------------------------------------------------------------------------------------------------------------------|

> >   |
|
> >   |       To:       karl.sommer at dpi.vic.gov.au
|
> >   |       cc:       r-sig-geo at stat.math.ethz.ch
|
> >   |       Subject:  Re: [R-sig-Geo]  selection of data subsets in
spatial classes                                                |
> >   >
------------------------------------------------------------------------------------------------------------------------------|

> >
> >
> >
> >
> > On Fri, 9 Jun 2006 karl.sommer at dpi.vic.gov.au wrote:
> >
> >
> >> after some fiddling with the GridTopology() method I eventually
succeeded
> >> in making it work and now can interpolate onto the grid.
> >>
> >> Tremendous, thanks.
> >>
> >
> > Good
> >
> >
> >> One problem I encountered when specifying a number smaller than 1 for
the
> >> cellsize argument eg. c(0.5, 0.5) instead of c(1,1),  I get erroneous
> >> results.
> >>
> >> grd <- GridTopology(c(617400, 6190060), c(1,1), c(400, 300))
> >>
> >>
> >
> > I think this is a matter of screen representation:
> >
> > coordinates(GridTopology(c(617400, 6190060), c(0.5,0.5), c(4, 3)))
> >
> > looks wrong, but
> >
> > print(coordinates(GridTopology(c(617400, 6190060), c(0.5,0.5), c(4,
3))),
> >   digits=10)
> >
> > shows that the coordinate values were been rounded for display (is that
> > what you are seeing?)
> >
> > Roger
> >
> >
> >> Cheers
> >> Karl
> >>
> >>
> >>
> >> |---------+---------------------------->
> >> |         |           Roger.Bivand at nhh.|
> >> |         |           no               |
> >> |         |                            |
> >> |         |           08/06/2006 18:53 |
> >> |         |           Please respond to|
> >> |         |           Roger.Bivand     |
> >> |         |                            |
> >> |---------+---------------------------->
> >>   >
> >>
> >
------------------------------------------------------------------------------------------------------------------------------|

> >
> >
> >>   |
> >>
> > |
> >
> >>   |       To:       karl.sommer at dpi.vic.gov.au
> >>
> > |
> >
> >>   |       cc:       r-sig-geo at stat.math.ethz.ch
> >>
> > |
> >
> >>   |       Subject:  Re: [R-sig-Geo]  selection of data subsets in
spatial
> >>
> > classes                                                |
> >
> >>   >
> >>
> >
------------------------------------------------------------------------------------------------------------------------------|

> >
> >
> >>
> >>
> >> On Thu, 8 Jun 2006 karl.sommer at dpi.vic.gov.au wrote:
> >>
> >>
> >>> thanks  Roger Bivand, this is really powerful and much less
cumbersome
> >>>
> >> than
> >>
> >>> I feared.
> >>>
> >>> I ran an inverse distance interpolation on some of the screened data.
> >>>
> > In
> >
> >>> order to do so I created a destination file from scratch with a 2 x 2
m
> >>> grid. The destination file is of rectangular shape and is larger than
> >>>
> > the
> >
> >>> field for which a I have the aerial image data which is a polygon.
As
> >>>
> > a
> >
> >>> result the kriging procedure extends beyond the field.
> >>>
> >>> Is there a way to either create a sampling grid that is the same
shape
> >>>
> > as
> >
> >>> the field, ie from a shape file,  or is there a way to subtract the
two
> >>> layers such that only the field shape is retained (something similar
to
> >>> mapcalc in GRASS)?
> >>>
> >> My immediate guess would be that the overlay method will get you
there:
> >>
> >> library(sp)
> >> plot(1:100, 1:100, type="n")
> >> poly <- locator()
> >> poly <- do.call("cbind", poly)
> >> poly <- rbind(poly, poly[1,])
> >> lines(poly)
> >> field <- SpatialPolygons(list(Polygons(list(Polygon(poly)), ID
="field")))
> >> grd <- GridTopology(c(0.5,0.5), c(1,1), c(100, 100))
> >> SG <- SpatialGrid(grd)
> >> plot(SG, add=TRUE)
> >> t1 <- overlay(SG, field)
> >> SGDF <- SpatialGridDataFrame(grd, data=AttributeList(list(field=t1)))
> >> SPDF <- as(SGDF, "SpatialPixelsDataFrame")
> >> plot(SPDF, col="red", add=TRUE)
> >>
> >> and then use the SPDF points for prediction. If you've read in the
field
> >> polygon, you're already mostly set up. It will also work with multiple
> >> fields, when t1 will know which field the grid point belongs to.
> >>
> >> Using GridTopology to set up prediction grids is quite neat too, it
> >> provides an object to encapsulate what you are doing, but ensures that
> >>
> > you
> >
> >> register the grid to the grid centres.
> >>
> >> Hope this helps,
> >>
> >> Roger
> >>
> >>
> >>> here is my R code
> >>>
> >>> library(rgdal)
> >>> # load rgdal library and import ESRI raster file (aerial image)
> >>> t1 <- readGDAL( "shi94a9_bnd.bil" ,  half.cell=c(0.5, 0.5), silent =
> >>>
> >> FALSE)
> >>
> >>> image(t1, col=grey(1:9/10))
> >>> summary(t1)
> >>>
> >>> t1a <- as(t1, "SpatialPixelsDataFrame")
> >>> summary(t1a)
> >>>
> >>> t1b <- t1a[t1a$band5 > 0,]  # this eliminates values outside the
field
> >>> boundaries which are 0; inter-row pixels had been eliminated
previously
> >>>
> >>> library(gstat)
> >>> t1b.idw <- krige(band5~1, t1b,  grid.pts)
> >>> spplot(t1b.idw["var1.pred"],main="idw PCD map",
> >>>
> >> col.regions=bpy.colors(64))
> >>
> >>> # the grid.pts file was created as follows
> >>> #
> >>> utm.n.min<- 6190068
> >>> utm.n.max<- 6190326
> >>> utm.e.min<- 617405
> >>> utm.e.max<- 617812
> >>>
> >>> spacing<-2  # average linear spacing between points
> >>> #
> >>> xseq<-seq(utm.e.min, utm.e.max, by=spacing)
> >>> yseq<-seq(utm.n.min, utm.n.max, by=spacing)
> >>>
> >>> sample.pts<-expand.grid(xseq, yseq)
> >>> names(sample.pts)<-c("x", "y")
> >>>
> >>> ## include the variable in a new object yld.pts
> >>> grid.pts <- cbind(sample.pts)
> >>> coordinates(grid.pts)=~x+y
> >>> gridded(grid.pts)=TRUE
> >>>
> >>> Cheers
> >>>
> >>> Karl
> >>>
> >>>
> >>>
> >>> |---------+---------------------------->
> >>> |         |           Roger.Bivand at nhh.|
> >>> |         |           no               |
> >>> |         |                            |
> >>> |         |           07/06/2006 19:17 |
> >>> |         |           Please respond to|
> >>> |         |           Roger.Bivand     |
> >>> |         |                            |
> >>> |---------+---------------------------->
> >>>   >
> >>>
> >
------------------------------------------------------------------------------------------------------------------------------|

> >
> >
> >>>   |
> >>>
> >> |
> >>
> >>>   |       To:       karl.sommer at dpi.vic.gov.au
> >>>
> >> |
> >>
> >>>   |       cc:       r-sig-geo at stat.math.ethz.ch
> >>>
> >> |
> >>
> >>>   |       Subject:  Re: [R-sig-Geo]  selection of data subsets in
> >>>
> > spatial
> >
> >> classes                                                |
> >>
> >>>   >
> >>>
> >
------------------------------------------------------------------------------------------------------------------------------|

> >
> >
> >>>
> >>>
> >>> On Wed, 7 Jun 2006 karl.sommer at dpi.vic.gov.au wrote:
> >>>
> >>>
> >>>> Hello list
> >>>>
> >>>> I have been trying to figure out if it is possible to select a
subset
> >>>>
> >> of
> >>
> >>>> data in a SpatialGridDataFrame without prior conversion to a
> >>>>
> > data.frame
> >
> >>>> using the method as.data.frame().
> >>>>
> >>>> I have imported an ESRI " *. bil " file containing different
spectral
> >>>>
> >>> bands
> >>>
> >>>> using rgdal.  The file imported as a SpatialGridDataFrame.  The data
> >>>> originates from an aerial photograph of a row crop and I would like
> >>>>
> > to
> >
> >>>> select pixels from within a row as opposed to those from the
> >>>>
> > inter-row
> >
> >>>> space for further interpolation.   Inter-row pixels have a different
> >>>> signature and therefore may be potentially screened out.  However, I
> >>>>
> >> have
> >>
> >>>> been unable to access the SpatialGridDataFrame directly with, for
> >>>>
> >>> example,
> >>>
> >>>> a  subset(x, band5 < lowerLimit, select c(a, b) ) call for selecting
> >>>>
> >>> values
> >>>
> >>>> according to given criteria.
> >>>>
> >>> This is what the SpatialPixelsDataFrame class is for (unless you want
> >>>
> > to
> >
> >>> change resolution too):
> >>>
> >>> library(rgdal)
> >>> SP27GTIF <- readGDAL(system.file("pictures/SP27GTIF.TIF", package =
> >>>   "rgdal")[1])
> >>> summary(SP27GTIF)
> >>> image(SP27GTIF, col=grey(1:9/10))
> >>> SP27GTIF_a <- as(SP27GTIF, "SpatialPixelsDataFrame")
> >>> summary(SP27GTIF_a)
> >>> SP27GTIF_b <- SP27GTIF_a[SP27GTIF_a$band1 < 100,]
> >>> summary(SP27GTIF_b)
> >>> image(SP27GTIF_b)
> >>>
> >>> because SpatialPixelsDataFrame objects have their coordinates
recorded
> >>> explicitly, and "know where they are" on a full grid.
> >>>
> >>> fullgrid(SP27GTIF_b) <- TRUE
> >>> summary(SP27GTIF_b)
> >>>
> >>> will drop them again, inserting NAs where band1 >= 100.
> >>>
> >>> This class is borrowed from the Terralib "CELL" data structure, part
> >>> raster, part DB record, only recording cells with data.
> >>>
> >>> Roger
> >>>
> >>>
> >>>> Am I using the wrong strategy, should I just demote the spatial
class
> >>>>
> >>> using
> >>>
> >>>> method as.data.frame(), do the manipulation and then promote the
> >>>>
> >> screened
> >>
> >>>> values back to a spatial class?
> >>>>
> >>>> Regards
> >>>>
> >>>> Karl
> >>>> _________________________________
> >>>> Karl J Sommer,
> >>>> Department of Primary Industries,
> >>>> PO Box 905
> >>>> Mildura, VIC, Australia 3502
> >>>>
> >>>> Tel: +61 (0)3 5051 4390
> >>>> Fax +61 (0)3 5051 4534
> >>>>
> >>>> Email:     karl.sommer at dpi.vic.gov.au
> >>>>
> >>>> _______________________________________________
> >>>> R-sig-Geo mailing list
> >>>> R-sig-Geo at stat.math.ethz.ch
> >>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >>>>
> >>>>
> >>> --
> >>> Roger Bivand
> >>> Economic Geography Section, Department of Economics, Norwegian School
> >>>
> > of
> >
> >>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> >>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> >>> e-mail: Roger.Bivand at nhh.no
> >>>
> >>>
> >>>
> >>>
> >>>
> >>>
> >>>
> >> --
> >> Roger Bivand
> >> Economic Geography Section, Department of Economics, Norwegian School
of
> >> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> >> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> >> e-mail: Roger.Bivand at nhh.no
> >>
> >>
> >>
> >>
> >>
> >>
> >>
> >
> > --
> > Roger Bivand
> > Economic Geography Section, Department of Economics, Norwegian School
of
> > Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> > Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> > e-mail: Roger.Bivand at nhh.no
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at stat.math.ethz.ch
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
>

--
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From pierces1 at msu.edu  Tue Jun 13 04:12:36 2006
From: pierces1 at msu.edu (Steven J. Pierce)
Date: Mon, 12 Jun 2006 22:12:36 -0400
Subject: [R-sig-Geo] adding links to neighbour lists
In-Reply-To: <Pine.LNX.4.44.0606031130260.8487-100000@reclus.nhh.no>
Message-ID: <001101c68e8e$d6d76b60$0a00a8c0@TheVoid>

Hi folks,

I tried Roger's suggested method for adding extra links directly into a
neighbor list. To get it to work, I had to coerce the vector representing
the new link to be an integer vector instead of a numeric vector. Here's
what worked.

# Create an integer vector of the 2 regions (23 & 31) that need to be
connected.

ij <- as.integer(c(23,31))

# Update the neighbor list to add the symmetric link.

nb[[ij[1]]] <- sort(unique(c(nb[[ij[1]]], ij[2])))
nb[[ij[2]]] <- sort(unique(c(nb[[ij[2]]], ij[1])))

I just wanted to share that detail back to the list in case anyone else
wants to do this sort of data manipulation.

Steven J. Pierce
E-mail: pierces1 at msu.edu

-----Original Message-----
From: Roger Bivand [mailto:Roger.Bivand at nhh.no] 
Sent: Saturday, June 03, 2006 7:11 AM
To: Steven J. Pierce
Cc: r-sig-geo at stat.math.ethz.ch
Subject: Re: [R-sig-Geo] adding links to neighbour lists

On Fri, 2 Jun 2006, Steven J. Pierce wrote:

> Hi folks,
> 
> After using spdep to construct a neighbor list from a SpatialPolygons
> object, I plotted the neighbor list and noted that I needed one more link
> that wasn't caught by the poly2nb command. I found the edit.nb() function
> and can successfully use the interactive graphical interface to add the
> link, but would like to know if there is an alternative method for adding
a
> link between two regions. What would I need to do to directly edit the
> neighbor list object to include an additional link between regions 23 and
> 31?

There is a drop.links() function but no add.links(). So yes, you could 
manipulate the list directly. If ij is a two element vector for the 
missing link:

nb[[ij[1]]] <- sort(unique(c(nb[[ij[1]]], ij[2])))
nb[[ij[2]]] <- sort(unique(c(nb[[ij[2]]], ij[1])))

should do it (untried). If there are more links, have a look at drop.links 
and see if you can adapt it.

> 
> 
> > # Create a SpatialPolygons object from a SpatialPolygonsDataFrame
object,
> this
> > # helps set up for creating a neighbor list via commands from spdep
> package
> > 
> > CITY.polys <- as.SpatialPolygons.PolygonsList(CITY.ZCTA.data at polygons, 
> +
> proj4string=CRS(projection.details))
> > 

I think:

CITY.polys <- as(CITY.ZCTA.data, "SpatialPolygons")

should be enough, in time poly2nb() will do that internally.

> > # Create a neighbor list based on shared boundary. We need this to
> facilitate
> > # creating a weights matrix when we go to do spatial regression models.
> > 
> > CITY.nb <- poly2nb(CITY.polys, row.names = NULL,
> snap=sqrt(.Machine$double.eps), queen=TRUE)
> > 
> > # Capture coordinates of ZCTA centroids into a matrix we can use in
> plotting
> > # the neighbor list.
> > 
> > coords.mat <- cbind(CITY.ZCTA.data$centroid.x,
CITY.ZCTA.data$centroid.y)
> > 

Could be:

coords.mat <- coordinates(CITY.ZCTA.data)

if the centroid.x|y values correspond to the polygon centroids.

Roger

> > # Plot the neighbor list (reveals we need to add 1 more link)
> > 
> > plot(CITY.ZCTA.data, col="grey", border="black", axes=FALSE, asp=1,
> yaxs="i")
> > title(main="Neighbor List Links", adj= 0, cex.sub=.75)
> > plot(CITY.nb, coords.mat, add=TRUE, col="black", lwd=2)
> > 
> > # Add 1 link to neighbor list. This requires interaction with the
graphics
> > # on screen.
> > 
> > CITY.nb <- edit.nb(CITY.nb, coords.mat, polys=CITY.polys)
> Identifying contiguity for deletion ...
> No contiguity between chosen points
> Add contiguity? (y/n) y
> added contiguity between point 23 and 31 
> Options: quit[q] refresh[r] continue[c] q
> > 
> > # Plot the revised neighbor list (now everything looks right)
> > 
> > plot(CITY.ZCTA.data, col="grey", border="black", axes=FALSE, asp=1,
> yaxs="i")
> > title(main="Neighbor List Links", adj= 0, cex.sub=.75)
> > plot(CITY.nb, coords.mat, add=TRUE, col="black", lwd=2)
> 
> 
> Steven J. Pierce
> E-mail: pierces1 at msu.edu
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From mjf at ansto.gov.au  Tue Jun 13 05:00:26 2006
From: mjf at ansto.gov.au (FISCHER, Matthew)
Date: Tue, 13 Jun 2006 13:00:26 +1000
Subject: [R-sig-Geo] help with rgdal
Message-ID: <283982AD9F3CD211B3AC00A0C983032F14738E08@paradise.ansto.gov.au>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20060613/85da5f12/attachment.pl>

From Roger.Bivand at nhh.no  Tue Jun 13 08:21:48 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 13 Jun 2006 08:21:48 +0200 (CEST)
Subject: [R-sig-Geo] adding links to neighbour lists
In-Reply-To: <001101c68e8e$d6d76b60$0a00a8c0@TheVoid>
Message-ID: <Pine.LNX.4.44.0606130820420.20204-100000@reclus.nhh.no>

On Mon, 12 Jun 2006, Steven J. Pierce wrote:

> Hi folks,
> 
> I tried Roger's suggested method for adding extra links directly into a
> neighbor list. To get it to work, I had to coerce the vector representing
> the new link to be an integer vector instead of a numeric vector. Here's
> what worked.

Yes, of course, thanks for your careful attention! 

Roger

> 
> # Create an integer vector of the 2 regions (23 & 31) that need to be
> connected.
> 
> ij <- as.integer(c(23,31))
> 
> # Update the neighbor list to add the symmetric link.
> 
> nb[[ij[1]]] <- sort(unique(c(nb[[ij[1]]], ij[2])))
> nb[[ij[2]]] <- sort(unique(c(nb[[ij[2]]], ij[1])))
> 
> I just wanted to share that detail back to the list in case anyone else
> wants to do this sort of data manipulation.
> 
> Steven J. Pierce
> E-mail: pierces1 at msu.edu
> 
> -----Original Message-----
> From: Roger Bivand [mailto:Roger.Bivand at nhh.no] 
> Sent: Saturday, June 03, 2006 7:11 AM
> To: Steven J. Pierce
> Cc: r-sig-geo at stat.math.ethz.ch
> Subject: Re: [R-sig-Geo] adding links to neighbour lists
> 
> On Fri, 2 Jun 2006, Steven J. Pierce wrote:
> 
> > Hi folks,
> > 
> > After using spdep to construct a neighbor list from a SpatialPolygons
> > object, I plotted the neighbor list and noted that I needed one more link
> > that wasn't caught by the poly2nb command. I found the edit.nb() function
> > and can successfully use the interactive graphical interface to add the
> > link, but would like to know if there is an alternative method for adding
> a
> > link between two regions. What would I need to do to directly edit the
> > neighbor list object to include an additional link between regions 23 and
> > 31?
> 
> There is a drop.links() function but no add.links(). So yes, you could 
> manipulate the list directly. If ij is a two element vector for the 
> missing link:
> 
> nb[[ij[1]]] <- sort(unique(c(nb[[ij[1]]], ij[2])))
> nb[[ij[2]]] <- sort(unique(c(nb[[ij[2]]], ij[1])))
> 
> should do it (untried). If there are more links, have a look at drop.links 
> and see if you can adapt it.
> 
> > 
> > 
> > > # Create a SpatialPolygons object from a SpatialPolygonsDataFrame
> object,
> > this
> > > # helps set up for creating a neighbor list via commands from spdep
> > package
> > > 
> > > CITY.polys <- as.SpatialPolygons.PolygonsList(CITY.ZCTA.data at polygons, 
> > +
> > proj4string=CRS(projection.details))
> > > 
> 
> I think:
> 
> CITY.polys <- as(CITY.ZCTA.data, "SpatialPolygons")
> 
> should be enough, in time poly2nb() will do that internally.
> 
> > > # Create a neighbor list based on shared boundary. We need this to
> > facilitate
> > > # creating a weights matrix when we go to do spatial regression models.
> > > 
> > > CITY.nb <- poly2nb(CITY.polys, row.names = NULL,
> > snap=sqrt(.Machine$double.eps), queen=TRUE)
> > > 
> > > # Capture coordinates of ZCTA centroids into a matrix we can use in
> > plotting
> > > # the neighbor list.
> > > 
> > > coords.mat <- cbind(CITY.ZCTA.data$centroid.x,
> CITY.ZCTA.data$centroid.y)
> > > 
> 
> Could be:
> 
> coords.mat <- coordinates(CITY.ZCTA.data)
> 
> if the centroid.x|y values correspond to the polygon centroids.
> 
> Roger
> 
> > > # Plot the neighbor list (reveals we need to add 1 more link)
> > > 
> > > plot(CITY.ZCTA.data, col="grey", border="black", axes=FALSE, asp=1,
> > yaxs="i")
> > > title(main="Neighbor List Links", adj= 0, cex.sub=.75)
> > > plot(CITY.nb, coords.mat, add=TRUE, col="black", lwd=2)
> > > 
> > > # Add 1 link to neighbor list. This requires interaction with the
> graphics
> > > # on screen.
> > > 
> > > CITY.nb <- edit.nb(CITY.nb, coords.mat, polys=CITY.polys)
> > Identifying contiguity for deletion ...
> > No contiguity between chosen points
> > Add contiguity? (y/n) y
> > added contiguity between point 23 and 31 
> > Options: quit[q] refresh[r] continue[c] q
> > > 
> > > # Plot the revised neighbor list (now everything looks right)
> > > 
> > > plot(CITY.ZCTA.data, col="grey", border="black", axes=FALSE, asp=1,
> > yaxs="i")
> > > title(main="Neighbor List Links", adj= 0, cex.sub=.75)
> > > plot(CITY.nb, coords.mat, add=TRUE, col="black", lwd=2)
> > 
> > 
> > Steven J. Pierce
> > E-mail: pierces1 at msu.edu
> > 
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at stat.math.ethz.ch
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > 
> 
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From Roger.Bivand at nhh.no  Tue Jun 13 08:36:59 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 13 Jun 2006 08:36:59 +0200 (CEST)
Subject: [R-sig-Geo] help with rgdal
In-Reply-To: <283982AD9F3CD211B3AC00A0C983032F14738E08@paradise.ansto.gov.au>
Message-ID: <Pine.LNX.4.44.0606130827370.20204-100000@reclus.nhh.no>

On Tue, 13 Jun 2006, FISCHER, Matthew wrote:

>  
> 
> Hi R-sig-geo,
> 
>  
> 
> I'm running R under windows, and trying to get the example below to
> work, and wondering why it is not.

This isn't about rgdal, by the way, the main function called -
map2SpatialPolygons() - is in the off-CRAN spmaps package.  The example
you use is currently in the help file to that function, it isn't on
http://rgdal.sourceforge.net/, nor on
http://r-spatial.sourceforge.net/xtra/xtra.RHnw.html, which is where the
spmaps examples outside the package itself are.

Beyond that, I can't replicate it either. Which version of sp and spmaps 
are you using (sessionInfo())? What does bbox(nor_coast_poly_sp) say (if 
the bounding box is wrong, you may get Inf in plot.Spatial? What does 
class(nor_coast_poly_sp) - is plot() dispatching on the correct class?

I get:

> bbox(nor_coast_poly_sp)
         min      max
r1  4.804193 31.02664
r2 58.030025 71.12916
> class(nor_coast_poly_sp)
[1] "SpatialPolygons"
attr(,"package")
[1] "sp"


Roger



> 
> I've read the info at:
> 
> http://rgdal.sourceforge.net/ <http://rgdal.sourceforge.net/> 
> 
>  
> 
> Example:
> 
> nor_coast_poly <- map("world", "norway", fill=TRUE, col="transparent", plot=FALSE)
> 
> > range(nor_coast_poly$x, na.rm=TRUE)
> 
> [1]  3.354152 31.026640
> 
> > range(nor_coast_poly$y, na.rm=TRUE)
> 
> [1] -54.46084  71.12916
> 
> > nor_coast_poly <- map("world", "norway", fill=TRUE, col="transparent", plot=FALSE, ylim=c(58,72))
> 
> > nor_coast_poly$names
> 
>  [1] "Norway"               "Norway:Tana"          "Norway:Stjernoya"    
> 
>  [4] "Norway:Karlsoy"       "Norway:Seiland"       "Norway:Soroya"       
> 
>  [7] "Norway:Vega"          "Norway:Hareidlandet"  "Norway:Froya"        
> 
> [10] "Norway:Andoya"        "Norway:Hitra"         "Norway:Gurskoya"     
> 
> [13] "Norway:Langoya"       "Norway:Arnoy"         "Norway:Vannoy"       
> 
> [16] "Norway:Mageroya"      "Norway:Hinnoya"       "Norway:Senja"        
> 
> [19] "Norway:Sunnhordland"  "Norway:Ringvassoy"    "Norway:Vestvagoy"    
> 
> [22] "Norway:Austvagoy"     "Norway:Nordhordland"  "Norway:Bremangerland"
> 
> [25] "Norway:Moskenesoya"   "Norway:Kvaloy"        "Norway:Kvaloya"      
> 
> [28] "Norway:Smola"         "Norway:Karmoy"        "Norway:Vikna"        
> 
> > IDs <- sapply(strsplit(nor_coast_poly$names, ":"), function(x) x[1])
> 
> > nor_coast_poly_sp <- map2SpatialPolygons(nor_coast_poly, IDs=IDs, proj4string=CRS("+proj=longlat +datum=wgs84"))
> 
> > getSpPnParts(nor_coast_poly_sp)
> 
> [1] 30
> 
> > plot(nor_coast_poly_sp, col="grey", axes=TRUE)
> 
> Error in plot.window(xlim, ylim, log, asp, ...) : 
> 
>         need finite 'xlim' values
> 
> In addition: Warning messages:
> 
> 1: no non-missing arguments to min; returning Inf 
> 
> 2: no non-missing arguments to max; returning -Inf 
> 
> 3: no non-missing arguments to min; returning Inf 
> 
> 4: no non-missing arguments to max; returning -Inf
> 
>  
> 
>  
> 
> R starts off like this:
> 
> Loading required package: methods
> 
> Loading required package: sp
> 
> Loading required package: abind
> 
> Loading required package: pixmap
> 
> Geospatial Data Abstraction Library extensions to R successfully loaded
> 
> Search()
> 
>  [1] ".GlobalEnv"      "package:spmaps"  "package:rgdal"   "package:pixmap" 
> 
>  [5] "package:abind"   "package:sp"      "package:methods" "package:akima"  
> 
>  [9] "package:ncdf"    "package:misc3d"  "package:rgl"     "package:tkrplot"
> 
> [13] "package:tcltk"   "package:mapproj" "package:mapdata" "package:maps"   
> 
> [17] "Autoloads"       "package:base"   
> 
>  
> 
> So there is no indication that something hasn't been loaded properly?
> 
>  
> 
> Any help appreciated,
> 
>  
> 
> Matt.
> 
>  
> 
>  
> 
> Dr Matt Fischer
> 
> ANSTO - Environmental Research
> 
> PMB1 Menai NSW 2234
> 
> Ph: + 61 2 9717 9686
> 
> Fax: +61 2 9717 3038
> 
>  
> 
>  
> 
>  
> 
>  
> 
>  
> 
>  
> 
>  
> 
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From nicolas.degallier at ird.fr  Tue Jun 13 09:47:04 2006
From: nicolas.degallier at ird.fr (Nicolas Degallier)
Date: Tue, 13 Jun 2006 09:47:04 +0200
Subject: [R-sig-Geo] how to read CRU climatic data  files with R?
Message-ID: <8B84E377-AD2C-47B7-AD6B-8FBCF3336B7F@ird.fr>

Hi R helpers,

I have downloaded time series of climatic data from CRU (Climatic  
Research Unit) which are ASCII files with a specific format for the  
data.
The format is described here:

http://www.cru.uea.ac.uk/~timm/grid/CRU_TS_2_1.html

under the link "file format".

I would like to know if somebody has already written some script in R  
to open and manage these data, for example for selecting only  
portions of the time series and/or pieces of the spatial grid?

Cheers,

Nicolas Degallier

UMR 7159 / IRD UR182
Laboratoire d'Oc?anographie et du Climat, Exp?rimentation et  
Approches Num?riques (LOCEAN)
Tour 45-55, 4e ?t., case 100, 4 place Jussieu
75252  Paris Cedex 5  France

t?l: (33) 01 44 27 51 57
fax: (33) 01 44 27 38 05
E-mail: <Nicolas.Degallier at ird.fr>

Publications (anonymous ftp):

ftp://ftp.lodyc.jussieu.fr/LOCEAN/ndelod



From antonio.raju at gmail.com  Tue Jun 13 10:34:22 2006
From: antonio.raju at gmail.com (antonio rodriguez)
Date: Tue, 13 Jun 2006 10:34:22 +0200
Subject: [R-sig-Geo] how to read CRU climatic data  files with R?
In-Reply-To: <8B84E377-AD2C-47B7-AD6B-8FBCF3336B7F@ird.fr>
References: <8B84E377-AD2C-47B7-AD6B-8FBCF3336B7F@ird.fr>
Message-ID: <448E788E.8080707@gmail.com>

Nicolas Degallier wrote:
> Hi R helpers,
> 
> I have downloaded time series of climatic data from CRU (Climatic  
> Research Unit) which are ASCII files with a specific format for the  
> data.
> The format is described here:
> 
> http://www.cru.uea.ac.uk/~timm/grid/CRU_TS_2_1.html
> 
> under the link "file format".
> 
> I would like to know if somebody has already written some script in R  
> to open and manage these data, for example for selecting only  
> portions of the time series and/or pieces of the spatial grid?


Hi Nicolas,

You will find in that page, below Data structure section, a link to 
'software'. There you will find a package 'CRU2nc.tgz' which converts 
your ASCII data to 'netCDF' format. Then you can use any of the netCDF 
libraries available in R: ncdf,ncvar, RNetCDF, and the old netCDF.

I've found, at least for me, before to enter the data in R, to 
manipulate them with Ferret (http://ferret.pmel.noaa.gov/Ferret/) 
(subsetting regions and time intervals, etc.)

Hope this helps,

Antonio






> 
> Cheers,
> 
> Nicolas Degallier
> 
> UMR 7159 / IRD UR182
> Laboratoire d'Oc?anographie et du Climat, Exp?rimentation et  
> Approches Num?riques (LOCEAN)
> Tour 45-55, 4e ?t., case 100, 4 place Jussieu
> 75252  Paris Cedex 5  France
> 
> t?l: (33) 01 44 27 51 57
> fax: (33) 01 44 27 38 05
> E-mail: <Nicolas.Degallier at ird.fr>
> 
> Publications (anonymous ftp):
> 
> ftp://ftp.lodyc.jussieu.fr/LOCEAN/ndelod
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 


-- 
=====
Por favor, si me mandas correos con copia a varias personas,
pon mi direcci?n de correo en copia oculta (CCO), para evitar
que acabe en montones de sitios, eliminando mi privacidad,
favoreciendo la propagaci?n de virus y la proliferaci?n del SPAM. Gracias.
-----
If you send me e-mail which has also been sent to several other people,
kindly mark my address as blind-carbon-copy (or BCC), to avoid its
distribution, which affects my privacy, increases the likelihood of
spreading viruses, and leads to more SPAM. Thanks.
=====



From ripley at stats.ox.ac.uk  Tue Jun 13 10:40:30 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 13 Jun 2006 09:40:30 +0100 (BST)
Subject: [R-sig-Geo] [R-sig-DB] how to read CRU climatic data files with
	R?
In-Reply-To: <8B84E377-AD2C-47B7-AD6B-8FBCF3336B7F@ird.fr>
References: <8B84E377-AD2C-47B7-AD6B-8FBCF3336B7F@ird.fr>
Message-ID: <Pine.LNX.4.64.0606130940001.20518@gannet.stats.ox.ac.uk>

This is the databases list, not for reading ASCII files.

Please try R-help.

On Tue, 13 Jun 2006, Nicolas Degallier wrote:

> Hi R helpers,
>
> I have downloaded time series of climatic data from CRU (Climatic
> Research Unit) which are ASCII files with a specific format for the
> data.
> The format is described here:
>
> http://www.cru.uea.ac.uk/~timm/grid/CRU_TS_2_1.html
>
> under the link "file format".
>
> I would like to know if somebody has already written some script in R
> to open and manage these data, for example for selecting only
> portions of the time series and/or pieces of the spatial grid?
>
> Cheers,
>
> Nicolas Degallier
>
> UMR 7159 / IRD UR182
> Laboratoire d'Oc?anographie et du Climat, Exp?rimentation et
> Approches Num?riques (LOCEAN)
> Tour 45-55, 4e ?t., case 100, 4 place Jussieu
> 75252  Paris Cedex 5  France
>
> t?l: (33) 01 44 27 51 57
> fax: (33) 01 44 27 38 05
> E-mail: <Nicolas.Degallier at ird.fr>
>
> Publications (anonymous ftp):
>
> ftp://ftp.lodyc.jussieu.fr/LOCEAN/ndelod
>
> _______________________________________________
> R-sig-DB mailing list -- R Special Interest Group
> R-sig-DB at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-db
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From mmoehr at ssc.wisc.edu  Tue Jun 13 19:00:08 2006
From: mmoehr at ssc.wisc.edu (Matt Moehr)
Date: Tue, 13 Jun 2006 12:00:08 -0500
Subject: [R-sig-Geo] Install problem with 'sp'
Message-ID: <448EEF18.1040202@ssc.wisc.edu>

I have always used the R spatial packages on my home computer.  I wanted 
to use them on my department's server, but of course you can't install 
packages to the local directories.  I thought I could download the 
necessary packages into my directory and use the lib.loc option in 
library().  Everything was going smoothly until I got to the 'sp' package:

 > library(sp, lib.loc="w:/R_Packages")
Error in load(dataFile, ns) : ReadItem: unknown type 241
In addition: Warning message:
package 'sp' was built under R version 2.3.0
Error: unable to load R code in package 'sp'
Error: package/namespace load failed for 'sp'

The R version on the server is 2.2.1 and the 'sp' version is 0.8-14.  
Anyone know any conflicts or problems with the package?  By the way, my 
ultimate goal is just to use the globalG.test() in 'spdep' so I would be 
open to workarounds that didn't require 'sp'.  Thanks for your time.

Matt Moehr

-----------------------------------
Matthew J Moehr
mmoehr at ssc.wisc.edu
Graduate Research Assistant
Applied Population Laboratory
Department of Rural Sociology
University of Wisconsin - Madison
350 Agriculture Hall
1450 Linden Drive
Madison WI 53706
Tel:  608.265.8029
Fax:  608.262.6022



From Thomas.Adams at noaa.gov  Tue Jun 13 20:58:55 2006
From: Thomas.Adams at noaa.gov (Thomas Adams)
Date: Tue, 13 Jun 2006 14:58:55 -0400
Subject: [R-sig-Geo] Install problem with 'sp'
In-Reply-To: <448EEF18.1040202@ssc.wisc.edu>
References: <448EEF18.1040202@ssc.wisc.edu>
Message-ID: <448F0AEF.1060101@noaa.gov>

Matt,

Sorry, I do not have a very good solution ? I encountered this exact 
problem and with the frustrations I had at the time, I reverted back to 
R 2.2.1. Life is good again? BTW, I'm using Redhat Enterprise 3 Linux.

Tom


Matt Moehr wrote:
> I have always used the R spatial packages on my home computer.  I wanted 
> to use them on my department's server, but of course you can't install 
> packages to the local directories.  I thought I could download the 
> necessary packages into my directory and use the lib.loc option in 
> library().  Everything was going smoothly until I got to the 'sp' package:
>
>  > library(sp, lib.loc="w:/R_Packages")
> Error in load(dataFile, ns) : ReadItem: unknown type 241
> In addition: Warning message:
> package 'sp' was built under R version 2.3.0
> Error: unable to load R code in package 'sp'
> Error: package/namespace load failed for 'sp'
>
> The R version on the server is 2.2.1 and the 'sp' version is 0.8-14.  
> Anyone know any conflicts or problems with the package?  By the way, my 
> ultimate goal is just to use the globalG.test() in 'spdep' so I would be 
> open to workarounds that didn't require 'sp'.  Thanks for your time.
>
> Matt Moehr
>
> -----------------------------------
> Matthew J Moehr
> mmoehr at ssc.wisc.edu
> Graduate Research Assistant
> Applied Population Laboratory
> Department of Rural Sociology
> University of Wisconsin - Madison
> 350 Agriculture Hall
> 1450 Linden Drive
> Madison WI 53706
> Tel:  608.265.8029
> Fax:  608.262.6022
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>   


-- 
Thomas E Adams
National Weather Service
Ohio River Forecast Center
1901 South State Route 134
Wilmington, OH 45177

EMAIL:	thomas.adams at noaa.gov

VOICE:	937-383-0528
FAX:	937-383-0033



From Roger.Bivand at nhh.no  Wed Jun 14 08:55:03 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 14 Jun 2006 08:55:03 +0200 (CEST)
Subject: [R-sig-Geo] Install problem with 'sp'
In-Reply-To: <448EEF18.1040202@ssc.wisc.edu>
Message-ID: <Pine.LNX.4.44.0606140848050.20979-100000@reclus.nhh.no>

WARNING! useR 2006 now up and running, so list response time attenuated!

Please make sure you download the bin/windows/contrib/2.2, not the 2.3 
version. Please report with a few more details - are you using or setting 
.libPath()?

Roger


On Tue, 13 Jun 2006, Matt Moehr wrote:

> I have always used the R spatial packages on my home computer.  I wanted 
> to use them on my department's server, but of course you can't install 
> packages to the local directories.  I thought I could download the 
> necessary packages into my directory and use the lib.loc option in 
> library().  Everything was going smoothly until I got to the 'sp' package:
> 
>  > library(sp, lib.loc="w:/R_Packages")
> Error in load(dataFile, ns) : ReadItem: unknown type 241
> In addition: Warning message:
> package 'sp' was built under R version 2.3.0
> Error: unable to load R code in package 'sp'
> Error: package/namespace load failed for 'sp'
> 
> The R version on the server is 2.2.1 and the 'sp' version is 0.8-14.  
> Anyone know any conflicts or problems with the package?  By the way, my 
> ultimate goal is just to use the globalG.test() in 'spdep' so I would be 
> open to workarounds that didn't require 'sp'.  Thanks for your time.
> 
> Matt Moehr
> 
> -----------------------------------
> Matthew J Moehr
> mmoehr at ssc.wisc.edu
> Graduate Research Assistant
> Applied Population Laboratory
> Department of Rural Sociology
> University of Wisconsin - Madison
> 350 Agriculture Hall
> 1450 Linden Drive
> Madison WI 53706
> Tel:  608.265.8029
> Fax:  608.262.6022
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From Luisr at frs.fo  Wed Jun 14 11:48:37 2006
From: Luisr at frs.fo (Luis Ridao Cruz)
Date: Wed, 14 Jun 2006 10:48:37 +0100
Subject: [R-sig-Geo] conversion to polygons
Message-ID: <s48fe98b.064@ffdata.setur.fo>

R-Sig-Geo help,

I have an objct of class "SpatialPointsDataFrame"
which I woul like to convert to polygon.

I have used the following:

test1<-Polygon(test)
test2<-SpatialPolygons(list(test),1)
plot(test2,col=2,pbg="white")

but I get en error message like this:

Error in as.list(X) : cannot get a slot ("Polygons") from an object of
type "double"

I also try ploting:

plot(test1)

which gives :

Error in plot.window(xlim, ylim, log, asp, ...) : 
        need finite 'xlim' values
In addition: Warning messages:
1: no non-missing arguments to min; returning Inf 
2: no non-missing arguments to max; returning -Inf 
3: no non-missing arguments to min; returning Inf 
4: no non-missing arguments to max; returning -Inf 




Thank you in advance



From epistat at gmail.com  Thu Jun 15 09:32:37 2006
From: epistat at gmail.com (zhijie zhang)
Date: Thu, 15 Jun 2006 15:32:37 +0800
Subject: [R-sig-Geo] http://lib.stat.cmu.edu/s can't be visit
Message-ID: <2fc17e30606150032r21bda071y71ab196049ffb908@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20060615/4d652289/attachment.pl>

From Roger.Bivand at nhh.no  Fri Jun 16 10:41:54 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 16 Jun 2006 10:41:54 +0200 (CEST)
Subject: [R-sig-Geo] conversion to polygons
In-Reply-To: <s48fe98b.064@ffdata.setur.fo>
Message-ID: <Pine.LNX.4.44.0606161039270.22366-100000@reclus.nhh.no>

On Wed, 14 Jun 2006, Luis Ridao Cruz wrote:

> R-Sig-Geo help,
> 
> I have an objct of class "SpatialPointsDataFrame"
> which I woul like to convert to polygon.
> 
> I have used the following:
> 
> test1<-Polygon(test)
> test2<-SpatialPolygons(list(test),1)

test2<-SpatialPolygons(list(Polygons(list(test)),ID=1)))

should do it - there are two layers, because some "Polygons" objects with 
a single ID can have multiple "Polygon" object members.

Roger

> plot(test2,col=2,pbg="white")
> 
> but I get en error message like this:
> 
> Error in as.list(X) : cannot get a slot ("Polygons") from an object of
> type "double"
> 
> I also try ploting:
> 
> plot(test1)
> 
> which gives :
> 
> Error in plot.window(xlim, ylim, log, asp, ...) : 
>         need finite 'xlim' values
> In addition: Warning messages:
> 1: no non-missing arguments to min; returning Inf 
> 2: no non-missing arguments to max; returning -Inf 
> 3: no non-missing arguments to min; returning Inf 
> 4: no non-missing arguments to max; returning -Inf 
> 
> 
> 
> 
> Thank you in advance
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From Roger.Bivand at nhh.no  Fri Jun 16 11:47:20 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 16 Jun 2006 11:47:20 +0200 (CEST)
Subject: [R-sig-Geo] http://lib.stat.cmu.edu/s can't be visit
In-Reply-To: <2fc17e30606150032r21bda071y71ab196049ffb908@mail.gmail.com>
Message-ID: <Pine.LNX.4.44.0606161145440.22523-100000@reclus.nhh.no>

On Thu, 15 Jun 2006, zhijie zhang wrote:

> Dear friends,
>   Anyody knows why the webpage "http://lib.stat.cmu.edu/s" can't be visit?
>  a collection of scripts written in S language, and achived at  Statlib.

The interface seems to have been changed, the index is certainly at:

http://lib.stat.cmu.edu/modules.php?op=modload&name=PostWrap&file=index&page=S/

but 

http://lib.stat.cmu.edu/S (big S)

still seems to work.

>  thanks a lot!
> 
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From rusers.sh at gmail.com  Fri Jun 16 12:31:30 2006
From: rusers.sh at gmail.com (zhijie zhang)
Date: Fri, 16 Jun 2006 18:31:30 +0800
Subject: [R-sig-Geo] help on programing
Message-ID: <a835c81e0606160331v790d2a67p74126dcf3b3f6d7a@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20060616/544bfe1e/attachment.pl>

From Roger.Bivand at nhh.no  Fri Jun 16 18:10:22 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 16 Jun 2006 18:10:22 +0200 (CEST)
Subject: [R-sig-Geo] help on programing
In-Reply-To: <a835c81e0606160331v790d2a67p74126dcf3b3f6d7a@mail.gmail.com>
Message-ID: <Pine.LNX.4.44.0606161804050.22629-100000@reclus.nhh.no>

On Fri, 16 Jun 2006, zhijie zhang wrote:

> Dear friends,
>   I want to finish the following task, hope someone to give the R
> programs,thanks.

Could I ask for a little clarification?

> 
> *step1*: Generate a planar x(0,100)*y(0,100) ;

This is a 0,100 by 0,100 square, right?

> *step2*: Divide the planar into 100 grids,either use the number of grids or
> use the coordinates of x/y;(like gridpts(poly,npts,xs,ys)
> #gridpts(splancs),)

How many grid cells do you need, 100 or 100 by 100?, that is npts=100 or 
xs=100,ys=100?

> *step3*: generate the spatial points with autocorrelation, and link points
> with the grid center;

Are the points from a point process model, in which case do you want 
clustered or regular? And if so, do you want to assign them to the grid 
cells (I think so)?

Roger

>  how to do that ? Because of poor R programing techniques, I hope someone
> will spend a few minutes to help me.
> Any suggestions are greately welcome!
> Hope to get the programs as soon as possible.
> 
> With kind regards,
> Wei,Chang
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From pedro at dpi.inpe.br  Fri Jun 16 18:34:08 2006
From: pedro at dpi.inpe.br (pedro at dpi.inpe.br)
Date: Fri, 16 Jun 2006 13:34:08 -0300
Subject: [R-sig-Geo] conversion to polygons
In-Reply-To: <Pine.LNX.4.44.0606161039270.22366-100000@reclus.nhh.no>
References: <Pine.LNX.4.44.0606161039270.22366-100000@reclus.nhh.no>
Message-ID: <20060616133408.mvyqxv764dgkgsw8@agenda.dpi.inpe.br>

Hi,

I also have same "problem". Sometimes I want to build a SpatialPolygons 
from a set of points (a matrix) representing the border of a region, 
and it has only one polygon.

SP <- SpatialPolygons(list(Polygons(list(Polygon(matrixdata))),ID=1)))

But ID in this case is not "necessary", and also the two levels of 
list. At least for me, it is very common, and I can cite geoR and 
splancs packages, where we have this kind of data. I think in this case 
we could have a simpler code, and we could create it directly from the 
matrix:

SP = SpatialPolygons(matrixdata)

or from the Polygon:

SP = SpatialPolygons(polygon)

The creation of the lists and ID could be hidden in SpatialPolygons-methods.R:

SpatialPolygons <- function(Srl, pO, proj4string=CRS(as.character(NA))) {
     if( is.matrix(Srl) ) Srl <- list(Polygons(list(Polygon(Srl))),ID=1))
     ...
}

What do you think of it?

Pedro

Quoting Roger Bivand <Roger.Bivand at nhh.no>:

> On Wed, 14 Jun 2006, Luis Ridao Cruz wrote:
>
>> R-Sig-Geo help,
>>
>> I have an objct of class "SpatialPointsDataFrame"
>> which I woul like to convert to polygon.
>>
>> I have used the following:
>>
>> test1<-Polygon(test)
>> test2<-SpatialPolygons(list(test),1)
>
> test2<-SpatialPolygons(list(Polygons(list(test)),ID=1)))
>
> should do it - there are two layers, because some "Polygons" objects with
> a single ID can have multiple "Polygon" object members.
>
> Roger
>
>> plot(test2,col=2,pbg="white")
>>
>> but I get en error message like this:
>>
>> Error in as.list(X) : cannot get a slot ("Polygons") from an object of
>> type "double"
>>
>> I also try ploting:
>>
>> plot(test1)
>>
>> which gives :
>>
>> Error in plot.window(xlim, ylim, log, asp, ...) :
>>         need finite 'xlim' values
>> In addition: Warning messages:
>> 1: no non-missing arguments to min; returning Inf
>> 2: no non-missing arguments to max; returning -Inf
>> 3: no non-missing arguments to min; returning Inf
>> 4: no non-missing arguments to max; returning -Inf
>>
>>
>>
>>
>> Thank you in advance
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> --
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



From Roger.Bivand at nhh.no  Sat Jun 17 08:59:29 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sat, 17 Jun 2006 08:59:29 +0200 (CEST)
Subject: [R-sig-Geo] conversion to polygons
In-Reply-To: <20060616133408.mvyqxv764dgkgsw8@agenda.dpi.inpe.br>
Message-ID: <Pine.LNX.4.44.0606170858050.23520-100000@reclus.nhh.no>

On Fri, 16 Jun 2006 pedro at dpi.inpe.br wrote:

> Hi,
> 
> I also have same "problem". Sometimes I want to build a SpatialPolygons 
> from a set of points (a matrix) representing the border of a region, 
> and it has only one polygon.
> 
> SP <- SpatialPolygons(list(Polygons(list(Polygon(matrixdata))),ID=1)))
> 
> But ID in this case is not "necessary", and also the two levels of 
> list. At least for me, it is very common, and I can cite geoR and 
> splancs packages, where we have this kind of data. I think in this case 
> we could have a simpler code, and we could create it directly from the 
> matrix:
> 
> SP = SpatialPolygons(matrixdata)
> 
> or from the Polygon:
> 
> SP = SpatialPolygons(polygon)
> 
> The creation of the lists and ID could be hidden in SpatialPolygons-methods.R:
> 
> SpatialPolygons <- function(Srl, pO, proj4string=CRS(as.character(NA))) {
>      if( is.matrix(Srl) ) Srl <- list(Polygons(list(Polygon(Srl))),ID=1))
>      ...
> }
> 
> What do you think of it?

Yes, good idea, I'll implement it once useR 2006 is over for 
SpatialPolygons and Spatial Lines.

Thanks, Roger

> 
> Pedro
> 
> Quoting Roger Bivand <Roger.Bivand at nhh.no>:
> 
> > On Wed, 14 Jun 2006, Luis Ridao Cruz wrote:
> >
> >> R-Sig-Geo help,
> >>
> >> I have an objct of class "SpatialPointsDataFrame"
> >> which I woul like to convert to polygon.
> >>
> >> I have used the following:
> >>
> >> test1<-Polygon(test)
> >> test2<-SpatialPolygons(list(test),1)
> >
> > test2<-SpatialPolygons(list(Polygons(list(test)),ID=1)))
> >
> > should do it - there are two layers, because some "Polygons" objects with
> > a single ID can have multiple "Polygon" object members.
> >
> > Roger
> >
> >> plot(test2,col=2,pbg="white")
> >>
> >> but I get en error message like this:
> >>
> >> Error in as.list(X) : cannot get a slot ("Polygons") from an object of
> >> type "double"
> >>
> >> I also try ploting:
> >>
> >> plot(test1)
> >>
> >> which gives :
> >>
> >> Error in plot.window(xlim, ylim, log, asp, ...) :
> >>         need finite 'xlim' values
> >> In addition: Warning messages:
> >> 1: no non-missing arguments to min; returning Inf
> >> 2: no non-missing arguments to max; returning -Inf
> >> 3: no non-missing arguments to min; returning Inf
> >> 4: no non-missing arguments to max; returning -Inf
> >>
> >>
> >>
> >>
> >> Thank you in advance
> >>
> >> _______________________________________________
> >> R-sig-Geo mailing list
> >> R-sig-Geo at stat.math.ethz.ch
> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >>
> >
> > --
> > Roger Bivand
> > Economic Geography Section, Department of Economics, Norwegian School of
> > Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> > Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> > e-mail: Roger.Bivand at nhh.no
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at stat.math.ethz.ch
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
> 
> 
> 
> ----------------------------------------------------------------
> This message was sent using IMP, the Internet Messaging Program.
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From rusers.sh at gmail.com  Sun Jun 18 15:54:52 2006
From: rusers.sh at gmail.com (zhijie zhang)
Date: Sun, 18 Jun 2006 21:54:52 +0800
Subject: [R-sig-Geo] what's wrong with my programs?
Message-ID: <a835c81e0606180654t71f586d4od7567fab2579b6df@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20060618/aabcda78/attachment.pl>

From Roger.Bivand at nhh.no  Sun Jun 18 20:07:33 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sun, 18 Jun 2006 20:07:33 +0200 (CEST)
Subject: [R-sig-Geo] what's wrong with my programs?
In-Reply-To: <a835c81e0606180654t71f586d4od7567fab2579b6df@mail.gmail.com>
Message-ID: <Pine.LNX.4.44.0606182005410.8772-100000@reclus.nhh.no>

On Sun, 18 Jun 2006, zhijie zhang wrote:

> Dear Rusers,
>   I'm useing spatial package to get a rectangular, but the map seems to be
> wrong,and it maybe need to adjust some parameters that i don't know.

I'll get back to you tomorrow with specific suggestions. ppregion() is not 
a productive route to take for your problem. If it's OK with you, I'll 
reply to the list but including your off-list message to me explaining the 
interesting research context for your question.

Roger

> 
> My pograms:
> library(spatial)
> ppregion(xl=-8.75,xu=133.45,yl=-15.15,yu=187.05)
> poly<-ppgetregion()
> polymap(poly)
> #the programs goes correctly, but the map seems not very good. Please paste
> the programs in your R, then you'll see the problems.
> BTW, i have a points dataset with no corresponding polygon, so i  want to
> generate a polygon. About this operation, is there any good method to do?
> Thanks very much! any suggestions are great welcome!
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From Roger.Bivand at nhh.no  Mon Jun 19 11:20:02 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 19 Jun 2006 11:20:02 +0200 (CEST)
Subject: [R-sig-Geo] point process spatial sampling
In-Reply-To: <a835c81e0606170013s59952623k59df3330221e1ec@mail.gmail.com>
Message-ID: <Pine.LNX.4.44.0606191009190.9361-100000@reclus.nhh.no>

On Sat, 17 Jun 2006, zhijie zhang wrote:

(This is the offline description of the underlying research problem, 
posted with permission from the questioner):

I'm not sure that the steps suggested below are adequate, and input from 
field ecologists with experience in choosing sampling frameworks will be 
very welcome. My understanding is that the officially stipulated 0.11 m2 
observations are felt by the questioner to be "missing" the snails at 
certain levels of clustering or regularity, but the suggestion below just 
gives a framework for simulating distributions from regular to clustered, 
so that the appropriateness of the officially stipulated sampling scheme 
can be examined (corrections please, I'm not sure that this is a good 
representation of the problem).

> Dear prof. Roger Bivand,

> Thanks very much ! I'd like to give you some hint that why i want to do
> that. I'm studying somthing on Oncomelania Hupensis(a kind of snail),
> and our survey method in our country is systematic sampling and the
> sample is 0.11m2square, which is a national criteria and has no
> theoretical support. 

> Recently, i find that Oncomelania Hupensis is clustered in certain
> density, and regular in other density. R is a good software for spatial
> statistics in my opinion, so i want to do some simulations. That is,
> selecting a square or rectangular, then divide it into a number of
> 0.11m2 square/grids(0.33m*0.33m),assign some values from
> cluster/regular/random process to the 0.11m grids, finally sample from
> it and compare the samples with the population through some indices(e.g.
> density of snail) to see which sampling method is the best.
> 

> > *step1*: Generate a planar x(0,100)*y(0,100) ;
> 
> This is a 0,100 by 0,100 square, right*?---square or maybe a rectangular
> *
> > *step2*: Divide the planar into 100 grids,either use the number of grids
> or
> > use the coordinates of x/y;(like gridpts(poly,npts,xs,ys)
> > #gridpts(splancs),)

library(spspatstat)
# rSpatial <- "http://r-spatial.sourceforge.net/R"
# install.packages("spspatstat", repos=rSpatial)

edge <- 10/3
nc <- 10
edge_nc <- edge/nc
edge_nc^2

crds <- matrix(c(0,0,0,edge,edge,edge,edge,0,0,0), ncol=2, byrow=TRUE)
SPoly <- SpatialPolygons(list(Polygons(list(Polygon(crds)), ID=1)))
SPowin <- as(SPoly, "owin")

grd <- GridTopology(c(edge_nc/2, edge_nc/2), c(edge_nc, edge_nc), c(nc, nc))
SG <- SpatialGrid(grd)
ng <- prod(slot(grd, "cells.dim"))

pp <- rMatClust(1, 0.3, 5, win=SPowin)
#                   ^^^^
# the cluster radius argument can be manipulated to go from tight
# clusters to CSR, but the number of points is seldom kappa per unit area 
# * mu  
# pp <- rSSI(0.3, 50, win=SPowin)
# provides from CSR to regular by manipulating the first argument,
# the inhibition distance, but here you know how many points are required

while (length(pp$x) != 50) pp <- rMatClust(1, 0.3, 5, win=SPowin)
# for want of another way of getting exactly 50 points - maybe thinning 
# would be OK? Especially as hitting a larger number will be tricky?

SP_MC03 <- as(pp, "SpatialPoints")
where <- overlay(SG, SP_MC03)
counts <- table(where)
res <- rep(0, ng)
res[as.integer(names(counts))] <- counts
SGDF <- SpatialGridDataFrame(grd, data=AttributeList(list(MC03=res)))

# from here on, add the new point patterns as counts to SGDF by adding
# columns, for example:

pp <- rSSI(0.3, 50, win=SPowin)
SP_SSI03 <- as(pp, "SpatialPoints")
where <- overlay(SG, SP_SSI03)
counts <- table(where)
res <- rep(0, ng)
res[as.integer(names(counts))] <- counts
SGDF$SSI03 <- res

image(SGDF, "MC03")
plot(SP_MC03, add=TRUE)
image(SGDF, "SSI03")
plot(SP_SSI03, add=TRUE)

The spatstat package provides a wide range of ways of simulating random 
point patterns, and it is very possible that the overlay() method in the 
sp package used here for binning and then counting the points in your 
framework could be replaced by a function from spatstat.

Hope this helps,

Roger

(with thanks to Paulo Ribeiro, who helped talk me though this in Vienna 
after the successful useR 2006 meeting - all mistakes are my own fault!)

> 
> How many grid cells do you need, 100 or 100 by 100?, that is npts=100 or
> xs=100,ys=100?--*if possible, i'd like the the area of grid is 0.11m2 ;if
> it's difficult, then use xs=100,ys=100.*
> 
> > *step3*: generate the spatial points with autocorrelation, and link points
> > with the grid center;
> 
> Are the points from a point process model, in which case do you want
> clustered or regular? And if so, do you want to assign them to the grid
> cells (I think so)?--i*'d like the generate three different kind of
> data,that is clustered, regular and random point process and then assign
> them to the grid cells. That is to say, to do three kind of simulations. *
> 
> *Finally*, to sample from the grids  through systematic, random and
> stratified sampling.
>  I hope that i have explained my ideas clearly, thank very much for your
> help!
> 
> 
> 
> 
> 
> 2006/6/17, Roger Bivand <Roger.Bivand at nhh.no>:
> >
> > On Fri, 16 Jun 2006, zhijie zhang wrote:
> >
> > > Dear friends,
> > >   I want to finish the following task, hope someone to give the R
> > > programs,thanks.
> >
> > Could I ask for a little clarification?
> >
> > >
> > > *step1*: Generate a planar x(0,100)*y(0,100) ;
> >
> > This is a 0,100 by 0,100 square, right?
> >
> > > *step2*: Divide the planar into 100 grids,either use the number of grids
> > or
> > > use the coordinates of x/y;(like gridpts(poly,npts,xs,ys)
> > > #gridpts(splancs),)
> >
> > How many grid cells do you need, 100 or 100 by 100?, that is npts=100 or
> > xs=100,ys=100?
> >
> > > *step3*: generate the spatial points with autocorrelation, and link
> > points
> > > with the grid center;
> >
> > Are the points from a point process model, in which case do you want
> > clustered or regular? And if so, do you want to assign them to the grid
> > cells (I think so)?
> >
> > Roger
> >
> > >  how to do that ? Because of poor R programing techniques, I hope
> > someone
> > > will spend a few minutes to help me.
> > > Any suggestions are greately welcome!
> > > Hope to get the programs as soon as possible.
> > >
> > > With kind regards,
> > > Wei,Chang
> > >
> > >       [[alternative HTML version deleted]]
> > >
> > > _______________________________________________
> > > R-sig-Geo mailing list
> > > R-sig-Geo at stat.math.ethz.ch
> > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > >
> >
> > --
> > Roger Bivand
> > Economic Geography Section, Department of Economics, Norwegian School of
> > Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> > Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> > e-mail: Roger.Bivand at nhh.no
> >
> >
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From Luisr at frs.fo  Mon Jun 19 11:27:11 2006
From: Luisr at frs.fo (Luis Ridao Cruz)
Date: Mon, 19 Jun 2006 10:27:11 +0100
Subject: [R-sig-Geo] conversion to polygons
Message-ID: <s4967c07.063@ffdata.setur.fo>


This gives still an error message:

test2 <- SpatialPolygons(list(Polygons(list(test)),ID=1)))

Error: syntax error in
"SpatialPolygons(list(Polygons(list(Polygons(coraltest))),ID=1)))"


Luis



>>> Roger Bivand <Roger.Bivand at nhh.no> 16/06/2006 09:41:54 >>>
On Wed, 14 Jun 2006, Luis Ridao Cruz wrote:

> R-Sig-Geo help,
> 
> I have an objct of class "SpatialPointsDataFrame"
> which I woul like to convert to polygon.
> 
> I have used the following:
> 
> test1<-Polygon(test)
> test2<-SpatialPolygons(list(test),1)

test2<-SpatialPolygons(list(Polygons(list(test)),ID=1)))

should do it - there are two layers, because some "Polygons" objects
with 
a single ID can have multiple "Polygon" object members.

Roger

> plot(test2,col=2,pbg="white")
> 
> but I get en error message like this:
> 
> Error in as.list(X) : cannot get a slot ("Polygons") from an object
of
> type "double"
> 
> I also try ploting:
> 
> plot(test1)
> 
> which gives :
> 
> Error in plot.window(xlim, ylim, log, asp, ...) : 
>         need finite 'xlim' values
> In addition: Warning messages:
> 1: no non-missing arguments to min; returning Inf 
> 2: no non-missing arguments to max; returning -Inf 
> 3: no non-missing arguments to min; returning Inf 
> 4: no non-missing arguments to max; returning -Inf 
> 
> 
> 
> 
> Thank you in advance
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch 
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo 
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School
of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From Roger.Bivand at nhh.no  Mon Jun 19 12:19:48 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 19 Jun 2006 12:19:48 +0200 (CEST)
Subject: [R-sig-Geo] conversion to polygons
In-Reply-To: <s4967c07.062@ffdata.setur.fo>
Message-ID: <Pine.LNX.4.44.0606191214120.9657-100000@reclus.nhh.no>

On Mon, 19 Jun 2006, Luis Ridao Cruz wrote:

> 
> This gives still an error message:
> 
> test2 <- SpatialPolygons(list(Polygons(list(test)),ID=1)))
> 
> Error: syntax error in
> "SpatialPolygons(list(Polygons(list(Polygons(coraltest))),ID=1)))"
> 

But what did you actually enter as the command before the error message, 
and what is str(coraltest)?

library(sp)
coraltest <- matrix(c(0,0,0,1,1,1,1,0,0,0), ncol=2, byrow=TRUE)
plot(coraltest, type="l")
SP_coraltest <- SpatialPolygons(list(Polygons(list(Polygon(coraltest)),ID=1)))
plot(SP_coraltest, axes=TRUE)

does work (one right bracket too many, and the inner constructor is 
Polygon()

Roger

> 
> Luis
> 
> 
> 
> >>> Roger Bivand <Roger.Bivand at nhh.no> 16/06/2006 09:41:54 >>>
> On Wed, 14 Jun 2006, Luis Ridao Cruz wrote:
> 
> > R-Sig-Geo help,
> > 
> > I have an objct of class "SpatialPointsDataFrame"
> > which I woul like to convert to polygon.
> > 
> > I have used the following:
> > 
> > test1<-Polygon(test)
> > test2<-SpatialPolygons(list(test),1)
> 
> test2<-SpatialPolygons(list(Polygons(list(test)),ID=1)))
> 
> should do it - there are two layers, because some "Polygons" objects
> with 
> a single ID can have multiple "Polygon" object members.
> 
> Roger
> 
> > plot(test2,col=2,pbg="white")
> > 
> > but I get en error message like this:
> > 
> > Error in as.list(X) : cannot get a slot ("Polygons") from an object
> of
> > type "double"
> > 
> > I also try ploting:
> > 
> > plot(test1)
> > 
> > which gives :
> > 
> > Error in plot.window(xlim, ylim, log, asp, ...) : 
> >         need finite 'xlim' values
> > In addition: Warning messages:
> > 1: no non-missing arguments to min; returning Inf 
> > 2: no non-missing arguments to max; returning -Inf 
> > 3: no non-missing arguments to min; returning Inf 
> > 4: no non-missing arguments to max; returning -Inf 
> > 
> > 
> > 
> > 
> > Thank you in advance
> > 
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at stat.math.ethz.ch 
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo 
> > 
> 
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From stanimura-ngs at umin.ac.jp  Mon Jun 19 12:45:17 2006
From: stanimura-ngs at umin.ac.jp (Susumu Tanimura)
Date: Mon, 19 Jun 2006 19:45:17 +0900
Subject: [R-sig-Geo] Tutorial of Analysing Spatial Data in R
Message-ID: <20060619194517.0157abdb.stanimura-ngs@umin.ac.jp>

Dear all members in R-sig-Geo,

Dr. Roger Bivand, a giant in this mailing list, will have a tutorial
of analysing spatial data in R on June 29 at the Inst. of Statistical
Mathematics, Tokyo, Japan, keeping the same quality of useR!  2006
meeting in Vienna, June 2006
http://www.r-project.org/useR-2006/Tutorials/Bivand.html.

It is in English and free of charge.  Because of the capacity of the
lecture hall, only 60 people are accepted their registration on a
first-come first-served basis. We especially welcome people outside of
Japan.

After the tutorial, we have a workshop of spatial data analysis on June
29-30. 

-----------------------------------------------------------------------
                 Tutorial of Analysing Spatial Data in R

Goals:
    The tutorial will introduce the foundation classes for spatial
    data provided in the sp package, and show how they make work with
    spatial data easier. The classes have shared interfaces to common
    file formats for spatial data, and a range of subsetting, plot,
    overlay, and sampling methods.

    The tutorial will let participants needing to import spatial data
    into R, analyse it in one or more packages, display it in
    graphical form, and perhaps export it from R, learn how these
    steps can be made conveniently and robustly. The final section
    will show how the new class structure makes writing custom
    interfaces less challenging, making R analysis functions available
    for a wide range of spatial data formats.
Instructor:
     Dr. Roger Bivand, Department of Economic, Norwegian School
     of Economics and Business Administration
Date:
     June 29, 9:30 - 13:05
Venue:
     The Lecture Hall in the Institute of Statistical Mathematics
     Access: http://www.ism.ac.jp/access/index_e.html
Language:
     English
Capacity:
     60 people
Fee:
     Free
Programme:
     1. Representing spatial data in R (30 minutes)
     2. Vizualising spatial data in R (30 minutes)
     3. Accessing spatial data in R (30 minutes)
     4. break
     5. Worked examples: geostatistics (30 minutes)
     6. Worked examples: disease mapping (30 minutes)
     7. Worked examples: customising spatial data classes (30 minutes)
Registration:
     Those who like to take the tutorial are required to registration
     because of the capacity of the venue.  We accept participants on
     a first-come first-served basis. For the registration, please
     send e-mail to Susumu Tanimura <stanimura-ngs at umin.ac.jp> with
     the subject as "Tutorial of Analysing Spatial Data in R."  This
     contents of the e-mail should include your name, affiliation,
     contact e-mail address.
Organizers:
     Susumu Tanimura <stanimura-ngs at umin.ac.jp>
     Inst. of Tropical Medicine, Nagasaki Univ.
     Junji Nakano <nakanoj at ism.ac.jp>
     Inst. of Statistical Mathematics
-----------------------------------------------------------------------

                  Workshop of Spatial Data Analysis
Date:
     June 29-30
Venue:
     The Lecture Hall in the Institute of Statistical Mathematics
     Access: http://www.ism.ac.jp/access/index_e.html
Language:
     English
Fee:
     Free
Program:

June 29 Thu.

   14:25 - 14:30  Opening remarks
   14:30 - 15:30  "Physical Accessibility to Pediatricians in time and
                  space in Nagasaki City" by Susumu Tanimura, Inst. of
                  Tropical Medicine, Nagasaki Univ.
   15:30 - 16:30  "Spatial Data Analysis for Crime Prevention" by
                  Takahito Shimada, National Research Inst. of Police
                  Science
   16:30 - 17:00  Discussion

June 30 Fri.

   10:00 - 11:00  "Error propagation in spatial prediction and other
                  challenges to spatial data analysis" by Roger Bivand,
                  Dept. of Economics, Norwegian School of Economics and
                  Business Administration.
   11:00 - 12:00  "Geostatistical predictions based on data with
                  hierarchical structures" by Masato Sugimoto, Shigeru
                  Mase, and Takayuki Sakaguchi(*), (*) Univ. of Tokyo

                  (lunchtime)

   13:30 - 14:30  "Visualizing Geostatistical Data by Using SVG" by
                  Takafumi Kubota(*), and Tomoyuki Tarumi, (*) Graduate
                  School of Humanities and Social Sciences, Okayama Univ.
   14:30 - 15:30  "Geographical data analysis using CCmaps and a
                  parallel coordinate plot" by Junji Nakano(*),
                  Ikunori Kobayashi and Yoshikazu Yamamoto, (*)
                  Inst. of Statistical Mathematics.
   15:30 - 16:00  Discussion

Organizers:
     Susumu Tanimura <stanimura-ngs at umin.ac.jp>
     Inst. of Tropical Medicine, Nagasaki Univ.
     Junji Nakano <nakanoj at ism.ac.jp>
     Inst. of Statistical Mathematics



From elatine at gmail.com  Mon Jun 19 18:50:29 2006
From: elatine at gmail.com (=?ISO-8859-1?Q?B=E1lint_Cz=FAcz?=)
Date: Mon, 19 Jun 2006 18:50:29 +0200
Subject: [R-sig-Geo] proj4 transform problem (Hungarian EOV CRS)
Message-ID: <fab4bcf70606190950o6dd78bb3j@mail.gmail.com>

Dear R-Sig-Geo readers!

I am trying to integrate spatial data given in the Hungarian EOV CRS
with lonlat data, but I am having problems with the coordinate
transformations.

I found this proj4string on the net:
+proj=somerc +lat_0=47.14439372222222 +lon_0=19.04857177777778
+alpha=90 +k=0.99993 +x_0=650000 +y_0=200000 +ellps=GRS67 +units=m
+no_defs +towgs84=+57.01,-69.97,-9.29

Using this string I get an error message:
> test <- matrix(c(5,1,5,2,6,2,6,1,5,1)*100000, ncol=2, byrow=TRUE)
> test <- SpatialPolygons(list(Polygons(list(Polygon(test)),ID=1)))
> proj4string(test) <- CRS("+proj=somerc +lat_0=47.14439372222222 +lon_0=19.04857177777778 +alpha=90 +k=0.99993 +x_0=650000 +y_0=200000 +ellps=GRS67 +units=m +no_defs +towgs84=+57.01,-69.97,-9.29")
> test2 <- transform(test, CRS=CRS("+proj=longlat +datum=wgs84"))
Error in transform_Polygon(input[[i]], to_args = to_args, from_args =
from_args) :
	no arguments in initialization list

The other direction does not work either:
> ceu <- map("worldHires", plot = FALSE, xlim = xl, ylim = yl)
> ceu <- pruneMap(ceu, xlim = xl, ylim = yl)
> ceu.sp <- map2SpatialLines(ceu, proj4string = CRS("+proj=longlat +datum=wgs84"))
> ceu2 <- transform(ceu.sp, CRS=CRS("+proj=somerc +lat_0=47.14439372222222 +lon_0=19.04857177777778 +alpha=90 +k=0.99993 +x_0=650000 +y_0=200000 +ellps=GRS67 +units=m +no_defs +towgs84=+57.01,-69.97,-9.29"))
Error in transform_Line(input[[i]], to_args = to_args, from_args = from_args) :
	unknown elliptical parameter name

In spite of this the proj4string seems to work OK with the same
projection string and the command line cs2cs utility:
ba:~$ cs2cs +proj=somerc +lat_0=47.14439372222222
+lon_0=19.04857177777778 +alpha=90 +k=0.99993 +x_0=650000 +y_0=200000
+ellps=GRS67 +units=m +no_defs +towgs84=+57.01,-69.97,-9.29   +to
+proj=latlong +datum=WGS84
0 0
10d47'15.654"E  45d2'9.093"N 46.348
650000 200000
19d2'50.836"E   47d8'38.85"N 36.882
...

What can be the problem?
(NB: EOV is a swiss-type oblique mercator projection: can this cause problems?)
Have I forgotten about something?

Thank you for your help!
B?lint


> sessionInfo()
R version 2.2.1, 2005-12-20, i586-uhu-linux-gnu

attached base packages:
[1] "datasets"  "graphics"  "grDevices" "methods"   "stats"     "utils"
[7] "base"

other attached packages:
  spproj   spmaps  mapdata     maps maptools       sp    gstat  foreign
 "0.3-4"  "0.1-3" "2.0-17" "2.0-31" "0.5-12" "0.8-14" "0.9-23" "0.8-12"
    ROCR   gplots    gdata   gtools    rpart      JGR   JavaGD    rJava
 "1.0-1"  "2.2.0"  "2.1.2"  "2.2.3" "3.1-27" "0.1-10"  "0.3-2"  "0.3-4"


-- 
Cz?cz B?lint
PhD hallgat?
BCE KTK Talajtan ?s V?zgazd?lkod?s Tansz?k
1118 Budapest, Vill?nyi ?t 29-43.



From Roger.Bivand at nhh.no  Mon Jun 19 19:34:37 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 19 Jun 2006 19:34:37 +0200 (CEST)
Subject: [R-sig-Geo] proj4 transform problem (Hungarian EOV CRS)
In-Reply-To: <fab4bcf70606190950o6dd78bb3j@mail.gmail.com>
Message-ID: <Pine.LNX.4.44.0606191921340.11110-100000@reclus.nhh.no>

On Mon, 19 Jun 2006, B?lint Cz?cz wrote:

> Dear R-Sig-Geo readers!
> 
> I am trying to integrate spatial data given in the Hungarian EOV CRS
> with lonlat data, but I am having problems with the coordinate
> transformations.

Actually, the problem is that you have wgs84 instead of WGS84:

library(rgdal)
EOV <- "+proj=somerc +lat_0=47.14439372222222 +lon_0=19.04857177777778 
  +alpha=90 +k=0.99993 +x_0=650000 +y_0=200000 +ellps=GRS67 +units=m 
  +no_defs +towgs84=+57.01,-69.97,-9.29"
test <- matrix(c(5,1,5,2,6,2,6,1,5,1)*100000, ncol=2, byrow=TRUE)
test1 <- SpatialPolygons(list(Polygons(list(Polygon(test)),ID=1)), 
  proj4string=CRS(EOV))
test2 <- spTransform(test1, CRS("+proj=longlat +datum=WGS84"))
plot(test2, axes=TRUE)

Some of the proj4 names are sometimes case-sensitive, WGS84 is one of them
(contrast your use of WGS84 in cs2cs! I've used the rgdal package here -
it includes spproj - and the transform() methods have become
spTransform(), but otherwise this should now work.

Thanks for an excellent report!

Hope this helps,

Roger


> 
> I found this proj4string on the net:
> +proj=somerc +lat_0=47.14439372222222 +lon_0=19.04857177777778
> +alpha=90 +k=0.99993 +x_0=650000 +y_0=200000 +ellps=GRS67 +units=m
> +no_defs +towgs84=+57.01,-69.97,-9.29
> 
> Using this string I get an error message:
> > test <- matrix(c(5,1,5,2,6,2,6,1,5,1)*100000, ncol=2, byrow=TRUE)
> > test <- SpatialPolygons(list(Polygons(list(Polygon(test)),ID=1)))
> > proj4string(test) <- CRS("+proj=somerc +lat_0=47.14439372222222 +lon_0=19.04857177777778 +alpha=90 +k=0.99993 +x_0=650000 +y_0=200000 +ellps=GRS67 +units=m +no_defs +towgs84=+57.01,-69.97,-9.29")
> > test2 <- transform(test, CRS=CRS("+proj=longlat +datum=wgs84"))
> Error in transform_Polygon(input[[i]], to_args = to_args, from_args =
> from_args) :
> 	no arguments in initialization list
> 
> The other direction does not work either:
> > ceu <- map("worldHires", plot = FALSE, xlim = xl, ylim = yl)
> > ceu <- pruneMap(ceu, xlim = xl, ylim = yl)
> > ceu.sp <- map2SpatialLines(ceu, proj4string = CRS("+proj=longlat +datum=wgs84"))
> > ceu2 <- transform(ceu.sp, CRS=CRS("+proj=somerc +lat_0=47.14439372222222 +lon_0=19.04857177777778 +alpha=90 +k=0.99993 +x_0=650000 +y_0=200000 +ellps=GRS67 +units=m +no_defs +towgs84=+57.01,-69.97,-9.29"))
> Error in transform_Line(input[[i]], to_args = to_args, from_args = from_args) :
> 	unknown elliptical parameter name
> 
> In spite of this the proj4string seems to work OK with the same
> projection string and the command line cs2cs utility:
> ba:~$ cs2cs +proj=somerc +lat_0=47.14439372222222
> +lon_0=19.04857177777778 +alpha=90 +k=0.99993 +x_0=650000 +y_0=200000
> +ellps=GRS67 +units=m +no_defs +towgs84=+57.01,-69.97,-9.29   +to
> +proj=latlong +datum=WGS84
> 0 0
> 10d47'15.654"E  45d2'9.093"N 46.348
> 650000 200000
> 19d2'50.836"E   47d8'38.85"N 36.882
> ...
> 
> What can be the problem?
> (NB: EOV is a swiss-type oblique mercator projection: can this cause problems?)
> Have I forgotten about something?
> 
> Thank you for your help!
> B?lint
> 
> 
> > sessionInfo()
> R version 2.2.1, 2005-12-20, i586-uhu-linux-gnu
> 
> attached base packages:
> [1] "datasets"  "graphics"  "grDevices" "methods"   "stats"     "utils"
> [7] "base"
> 
> other attached packages:
>   spproj   spmaps  mapdata     maps maptools       sp    gstat  foreign
>  "0.3-4"  "0.1-3" "2.0-17" "2.0-31" "0.5-12" "0.8-14" "0.9-23" "0.8-12"
>     ROCR   gplots    gdata   gtools    rpart      JGR   JavaGD    rJava
>  "1.0-1"  "2.2.0"  "2.1.2"  "2.2.3" "3.1-27" "0.1-10"  "0.3-2"  "0.3-4"
> 
> 
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From epistat at gmail.com  Tue Jun 20 04:52:50 2006
From: epistat at gmail.com (zhijie zhang)
Date: Tue, 20 Jun 2006 10:52:50 +0800
Subject: [R-sig-Geo] whatis wrong with my testing for CSR using F/G function?
Message-ID: <2fc17e30606191952v2a921e0fsc1bd8deaebad5bc2@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20060620/7915081a/attachment.pl>

From b.rowlingson at lancaster.ac.uk  Tue Jun 20 09:05:02 2006
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Tue, 20 Jun 2006 08:05:02 +0100
Subject: [R-sig-Geo] whatis wrong with my testing for CSR using F/G
	function?
In-Reply-To: <2fc17e30606191952v2a921e0fsc1bd8deaebad5bc2@mail.gmail.com>
References: <2fc17e30606191952v2a921e0fsc1bd8deaebad5bc2@mail.gmail.com>
Message-ID: <44979E1E.7050109@lancaster.ac.uk>

zhijie zhang wrote:

> grid.pts<-gridpts(polymap(bbox(pts)),10*np)   *#error in bbox(poly) : object
> not a >= 2-column array*
>  I don't know why it is wrong. 


  I explained this to you yesterday, but your email address was 
different. So far I've seen you use three different email addresses! If 
you keep to one email then life will be much simpler!

  The polymap() function call here is wrong - it is used to draw a 
polygon. Just remove it and do:

  grid.pts <- gridpts(bbox(pts),10*np)

  this produces a grid of 10*np points in the bounding box of the points 
in pts. You can then use polymap() to see them:

  polymap(bbox(pts))
  pointmap(grid.pts,add=T)

Barry



From b.rowlingson at lancaster.ac.uk  Tue Jun 20 10:16:47 2006
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Tue, 20 Jun 2006 09:16:47 +0100
Subject: [R-sig-Geo] whatis wrong with my testing for CSR using
	F/G	function?
In-Reply-To: <44979E1E.7050109@lancaster.ac.uk>
References: <2fc17e30606191952v2a921e0fsc1bd8deaebad5bc2@mail.gmail.com>
	<44979E1E.7050109@lancaster.ac.uk>
Message-ID: <4497AEEF.4040906@lancaster.ac.uk>

Barry Rowlingson wrote:

>   polymap(bbox(pts))
>   pointmap(grid.pts,add=T)

  Okay, there's another reason this doesn't work: splancs now requires 
the 'sp' package which defines a 'bbox' function that doesn't do the 
same thing as the one in splancs. I dimly recall Roger noting this 
sometime ago!

  There's now a 'bboxx' function (two 'x's at the end) in splancs that 
does what the old splancs 'bbox' function did.

  So if you do:

   grid.pts<-gridpts(bboxx(pts),10*np)
   pointmap(grid.pts,add=T)

it should work. I did test my earlier solution, just not with a current 
version of splancs.

Barry



From Roger.Bivand at nhh.no  Tue Jun 20 10:42:32 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 20 Jun 2006 10:42:32 +0200 (CEST)
Subject: [R-sig-Geo] whatis wrong with my testing for CSR using F/G
 function?
In-Reply-To: <4497AEEF.4040906@lancaster.ac.uk>
Message-ID: <Pine.LNX.4.44.0606201034090.14818-100000@reclus.nhh.no>

On Tue, 20 Jun 2006, Barry Rowlingson wrote:

> Barry Rowlingson wrote:
> 
> >   polymap(bbox(pts))
> >   pointmap(grid.pts,add=T)
> 
>   Okay, there's another reason this doesn't work: splancs now requires 
> the 'sp' package which defines a 'bbox' function that doesn't do the 
> same thing as the one in splancs. I dimly recall Roger noting this 
> sometime ago!

Thanks, Barry, I think that is right - without knowing which version of 
splancs the questioner is using. So again, when asking a question about 
problems with code, please include the output of sessionInfo(). I have a 
feeling that this is in part the same question that I replied to yesterday 
using sp and spatstat. 

Roger

> 
>   There's now a 'bboxx' function (two 'x's at the end) in splancs that 
> does what the old splancs 'bbox' function did.
> 
>   So if you do:
> 
>    grid.pts<-gridpts(bboxx(pts),10*np)
>    pointmap(grid.pts,add=T)
> 
> it should work. I did test my earlier solution, just not with a current 
> version of splancs.
> 
> Barry
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From epistat at gmail.com  Tue Jun 20 14:13:41 2006
From: epistat at gmail.com (zhijie zhang)
Date: Tue, 20 Jun 2006 20:13:41 +0800
Subject: [R-sig-Geo] whatis wrong with my testing for CSR using F/G
	function?-still have a little problem
Message-ID: <2fc17e30606200513j6854bd61je333388042a3b1e7@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20060620/295a28f0/attachment.pl>

From B.Rowlingson at lancaster.ac.uk  Tue Jun 20 15:18:52 2006
From: B.Rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Tue, 20 Jun 2006 14:18:52 +0100
Subject: [R-sig-Geo] whatis wrong with my testing for CSR using
 F/G	function?-still have a little problem
In-Reply-To: <2fc17e30606200513j6854bd61je333388042a3b1e7@mail.gmail.com>
References: <2fc17e30606200513j6854bd61je333388042a3b1e7@mail.gmail.com>
Message-ID: <4497F5BC.1020400@lancaster.ac.uk>

zhijie zhang wrote:

> plot(pts)
> grid.pts<-gridpts(bboxx(pts),10*np)
> pointmap(grid.pts,add=T)

  You should only use 'pointmap' and 'polymap' when you first start a 
plot with splancs. So:

pointmap(pts)
pointmap(grid.pts,add=T,pch=2)

  should work. I've put 'pch=2' to plot the grid points with a different 
shape.

  Try that!

Barry



From adrian at maths.uwa.edu.au  Wed Jun 21 07:32:46 2006
From: adrian at maths.uwa.edu.au (Adrian Baddeley)
Date: Wed, 21 Jun 2006 13:32:46 +0800
Subject: [R-sig-Geo] testing for CSR based on F and G functions
In-Reply-To: <mailman.15.1150797605.3451.r-sig-geo@stat.math.ethz.ch>
References: <mailman.15.1150797605.3451.r-sig-geo@stat.math.ethz.ch>
Message-ID: <17560.55806.565508.549852@maths.uwa.edu.au>


Zhijie Zhang asked how to test for CSR using the 
max absolute difference between the functions F and G.

A solution has been provided in package 'splancs'.

For comparison, here's how to do this in package 'spatstat',
illustrated for the 'cells' dataset.
      
      library(spatstat)
      FminG <- function(X, ...) {
	 FX <- Fest(X, ...)
	 GX <- Gest(X, r=FX$r)
	 return(eval.fv(FX - GX))
      }
      data(cells)
      E <- envelope(cells, FminG, global=TRUE)
      plot(E)
      E

Plotting the envelope E shows that the null hypothesis of CSR is rejected.
(This plot even shows the correct y-axis label, "F(r) - G(r)", automatically).
Printing the envelope E prints the significance level of the test, etc.

By adding extra arguments to 'envelope' you can change the number of simulations (nsim),
the significance level (nrank/(nsim+1)), the interval of r values over which the 
maximum absolute deviation is taken (ginterval) and the method of simulating from
the null hypothesis (simulate). 

regards
Adrian Baddeley



From adrian at maths.uwa.edu.au  Wed Jun 21 07:42:40 2006
From: adrian at maths.uwa.edu.au (Adrian Baddeley)
Date: Wed, 21 Jun 2006 13:42:40 +0800
Subject: [R-sig-Geo] quadrat counting
In-Reply-To: <mailman.15.1150797605.3451.r-sig-geo@stat.math.ethz.ch>
References: <mailman.15.1150797605.3451.r-sig-geo@stat.math.ethz.ch>
Message-ID: <17560.56400.925474.640922@maths.uwa.edu.au>


Zhijie Zhang asked how to divide a region into tiles 
and count the number of points from a point pattern that 
fall in each tile.

In  package 'spatstat', this is done using the function quadratcount().

      library(spatstat)
      data(cells)
      quadratcount(cells, 3, 4)

This would divide the window contain the 'cells' point pattern
into a 3 x 4 array of tiles, count the number of points falling in each
tile, and return the counts as a table. 

Alternatively if you want to specify the exact dimensions of the tiles,
use the arguments 'xbreaks' and 'ybreaks'
	quadratcount(cells, xbreaks=c(0, 0.4, 0.7, 1), ybreaks=c(0, 0.5, 1))

In spatstat version 1.9-3 (to be released shortly), the return value
can also be plotted:
      q <- quadratcount(cells, 3, 4)
      plot(q)
The plot draws the tile boundaries and displays the counts as text 
(numerals in each tile).

To perform a classical chi-squared test of CSR based on quadrat counts,
use the related function quadrat.test(). This has similar arguments to quadratcount()
but performs the chi-squared test as well. It can also be plotted
(in spatstat version 1.9-3), showing the tile boundaries, 
the observed and expected counts, and the Pearson residuals. 

quadrat.test() will also perform a chi-squared test of a non-uniform Poisson model.

regards
Adrian Baddeley



From epistat at gmail.com  Wed Jun 21 08:53:11 2006
From: epistat at gmail.com (zhijie zhang)
Date: Wed, 21 Jun 2006 14:53:11 +0800
Subject: [R-sig-Geo] testing for CSR based on F and G functions
In-Reply-To: <17560.55806.565508.549852@maths.uwa.edu.au>
References: <mailman.15.1150797605.3451.r-sig-geo@stat.math.ethz.ch>
	<17560.55806.565508.549852@maths.uwa.edu.au>
Message-ID: <2fc17e30606202353h19fc66f4tf870c6ea4f5e6685@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20060621/69b73a6e/attachment.pl>

From adrian at maths.uwa.edu.au  Wed Jun 21 09:35:14 2006
From: adrian at maths.uwa.edu.au (Adrian Baddeley)
Date: Wed, 21 Jun 2006 15:35:14 +0800
Subject: [R-sig-Geo] testing for CSR based on F and G functions
In-Reply-To: <2fc17e30606202353h19fc66f4tf870c6ea4f5e6685@mail.gmail.com>
References: <mailman.15.1150797605.3451.r-sig-geo@stat.math.ethz.ch>
	<17560.55806.565508.549852@maths.uwa.edu.au>
	<2fc17e30606202353h19fc66f4tf870c6ea4f5e6685@mail.gmail.com>
Message-ID: <17560.63154.358013.829787@maths.uwa.edu.au>


Zhijie Zhang writes:

 >      FminG <- function(X, ...) {
 >         FX <- Fest(X, ...)
 >         GX <- Gest(X, r=FX$r)
 >         return(eval.fv(FX - GX))
 >      }
 > You use the default value of r. HELP says  First-time  users are strongly
 > advised not to specify this argument. If i want to specify it , how to
 > complete it in the above *FminG *functions?

Just pass the argument 'r=rvalues' to the function. 

The "..." argument can be anything, including an argument 'r=rvalues', 
so we can type
	   rvalues <- seq(0, 0.3, length=100)
	   FminG(cells, r=rvalues)

You can do the same thing with envelope(), e.g.

    envelope(cells, FminG, r=rvalues, global=TRUE)

----
regards
Adrian Baddeley



From abunn at whrc.org  Thu Jun 22 15:16:46 2006
From: abunn at whrc.org (Andy Bunn)
Date: Thu, 22 Jun 2006 09:16:46 -0400
Subject: [R-sig-Geo] Add lines from SpatialLinesDataFrame to an image of
	SpatialGridDataFrame
Message-ID: <NEBBIPHDAMMOKDKPOFFIIEBPEFAA.abunn@whrc.org>

Howdy all: I have a simple question. Given two sp objects, a
SpatialGridDataFrame tdmean and SpatialLinesDataFrame states I want to plot
tdmean as an image and draw the lines on top. Can this be done with sp?


> class(tdmean)
[1] "SpatialGridDataFrame"
attr(,"package")
[1] "sp"
> is.projected(tdmean)
[1] TRUE
> class(states)
[1] "SpatialLinesDataFrame"
attr(,"package")
[1] "sp"
> is.projected(states)
[1] TRUE
> # plot states and put the image on top: works but is unsatisfying
> plot(states,axes=T)
> image(tdmean["z"],add=T)
>
> # plot image and put the state lines on top: doesn't work
> image(tdmean["z"],axes=T)
> lines(states)
>



From Roger.Bivand at nhh.no  Thu Jun 22 15:48:57 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 22 Jun 2006 15:48:57 +0200 (CEST)
Subject: [R-sig-Geo] Add lines from SpatialLinesDataFrame to an image of
 SpatialGridDataFrame
In-Reply-To: <NEBBIPHDAMMOKDKPOFFIIEBPEFAA.abunn@whrc.org>
Message-ID: <Pine.LNX.4.44.0606221543040.17495-100000@reclus.nhh.no>

On Thu, 22 Jun 2006, Andy Bunn wrote:

> Howdy all: I have a simple question. Given two sp objects, a
> SpatialGridDataFrame tdmean and SpatialLinesDataFrame states I want to plot
> tdmean as an image and draw the lines on top. Can this be done with sp?
> 
> 
> > class(tdmean)
> [1] "SpatialGridDataFrame"
> attr(,"package")
> [1] "sp"
> > is.projected(tdmean)
> [1] TRUE
> > class(states)
> [1] "SpatialLinesDataFrame"
> attr(,"package")
> [1] "sp"
> > is.projected(states)
> [1] TRUE
> > # plot states and put the image on top: works but is unsatisfying
> > plot(states,axes=T)
> > image(tdmean["z"],add=T)
> >
> > # plot image and put the state lines on top: doesn't work
> > image(tdmean["z"],axes=T)
> > lines(states)
> >

Cany you please try:

image(tdmean, "z", axes=T)
plot(states, add=TRUE)

I don't think there is a lines() method for SpatialLines* objects.

Roger


> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From abunn at whrc.org  Thu Jun 22 17:38:10 2006
From: abunn at whrc.org (Andy Bunn)
Date: Thu, 22 Jun 2006 11:38:10 -0400
Subject: [R-sig-Geo] Add lines from SpatialLinesDataFrame to an image of
	SpatialGridDataFrame
In-Reply-To: <Pine.LNX.4.44.0606221543040.17495-100000@reclus.nhh.no>
Message-ID: <NEBBIPHDAMMOKDKPOFFIIECCEFAA.abunn@whrc.org>

> On Thu, 22 Jun 2006, Andy Bunn wrote:
> 
> > Howdy all: I have a simple question. Given two sp objects, a
> > SpatialGridDataFrame tdmean and SpatialLinesDataFrame states I 
> want to plot
> > tdmean as an image and draw the lines on top. Can this be done with sp?
> > 
> > 
> > > class(tdmean)
> > [1] "SpatialGridDataFrame"
> > attr(,"package")
> > [1] "sp"
> > > is.projected(tdmean)
> > [1] TRUE
> > > class(states)
> > [1] "SpatialLinesDataFrame"
> > attr(,"package")
> > [1] "sp"
> > > is.projected(states)
> > [1] TRUE
> > > # plot states and put the image on top: works but is unsatisfying
> > > plot(states,axes=T)
> > > image(tdmean["z"],add=T)
> > >
> > > # plot image and put the state lines on top: doesn't work
> > > image(tdmean["z"],axes=T)
> > > lines(states)
> > >
> 
> Cany you please try:
> 
> image(tdmean, "z", axes=T)
> plot(states, add=TRUE)
> 
> I don't think there is a lines() method for SpatialLines* objects.


This works. Thanks. Andy



> 
> Roger
> 
> 
> > 
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at stat.math.ethz.ch
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > 
> 
> -- 
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
> 
>



From abunn at whrc.org  Thu Jun 22 17:56:19 2006
From: abunn at whrc.org (Andy Bunn)
Date: Thu, 22 Jun 2006 11:56:19 -0400
Subject: [R-sig-Geo] reading PRISM data from ftp [OT]
In-Reply-To: <NEBBIPHDAMMOKDKPOFFIIECCEFAA.abunn@whrc.org>
Message-ID: <NEBBIPHDAMMOKDKPOFFIEECDEFAA.abunn@whrc.org>

Howdy again,

This is a little off-topic for sig-geo, but I thought somebody might be able
to help here easier than r-help.

Can somebody please tel me why this works:

tmp <- tempfile()
download.file('ftp://ftp.stats.ox.ac.uk/pub/datasets/csb/ch11b.dat',tmp)
unlink(tmp)

While this doesn't:

tmp <- tempfile()
download.file('ftp://ocs.oce.orst.edu/pub/prism/us/grids/tdmean/2000-2009/us
_tdmean_2004.01.gz',tmp)
unlink(tmp)

I have no proxy issues and can connect to the ftp site from the command
line, ftp client, firefox, etc. I'm about to process a lot of climate data
and would like to avoid downloading many small files.

Thanks! -Andy



From B.Rowlingson at lancaster.ac.uk  Thu Jun 22 18:10:41 2006
From: B.Rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Thu, 22 Jun 2006 17:10:41 +0100
Subject: [R-sig-Geo] reading PRISM data from ftp [OT]
In-Reply-To: <NEBBIPHDAMMOKDKPOFFIEECDEFAA.abunn@whrc.org>
References: <NEBBIPHDAMMOKDKPOFFIEECDEFAA.abunn@whrc.org>
Message-ID: <449AC101.5080707@lancaster.ac.uk>


Andy Bunn wrote:

  Well, you dont say in what way it doesn't work. I get:

 > 
download.file('ftp://ocs.oce.orst.edu/pub/prism/us/grids/tdmean/2000-2009/us_tdmean_2004.01.gz',tmp)
trying URL 
'ftp://ocs.oce.orst.edu/pub/prism/us/grids/tdmean/2000-2009/us_tdmean_2004.01.gz'
Error in 
download.file("ftp://ocs.oce.orst.edu/pub/prism/us/grids/tdmean/2000-2009/us_tdmean_2004.01.gz", 
  :
         cannot open URL 
'ftp://ocs.oce.orst.edu/pub/prism/us/grids/tdmean/2000-2009/us_tdmean_2004.01.gz'

  However, if you add 'method="wget"' (and are running on a Unix box 
with wget installed) it works for me:

 > 
download.file('ftp://ocs.oce.orst.edu/pub/prism/us/grids/tdmean/2000-2009/us_tdmean_2004.01.gz',tmp,method="wget")
--17:05:41-- 
ftp://ocs.oce.orst.edu/pub/prism/us/grids/tdmean/2000-2009/us_tdmean_2004.01.gz
            => `/tmp/RtmpHcpXlj/file643c9869'
[wget stuff]
100%[======================================================================>] 
832,851      319.71K/s    ETA 00:00

17:05:46 (319.71 KB/s) - `/tmp/RtmpHcpXlj/file643c9869' saved [832851]

  So I'm guessing its a problem with R's internal FTP client. Maybe it 
doesnt like underscores or minus signs... Speculation...

Barry



From abunn at whrc.org  Thu Jun 22 18:54:49 2006
From: abunn at whrc.org (Andy Bunn)
Date: Thu, 22 Jun 2006 12:54:49 -0400
Subject: [R-sig-Geo] reading PRISM data from ftp [OT]
In-Reply-To: <449AC101.5080707@lancaster.ac.uk>
Message-ID: <NEBBIPHDAMMOKDKPOFFIIECEEFAA.abunn@whrc.org>

>   Well, you dont say in what way it doesn't work. I get:
> 
>  > 
> download.file('ftp://ocs.oce.orst.edu/pub/prism/us/grids/tdmean/20
> 00-2009/us_tdmean_2004.01.gz',tmp)
> trying URL 
> 'ftp://ocs.oce.orst.edu/pub/prism/us/grids/tdmean/2000-2009/us_tdm
> ean_2004.01.gz'
> Error in 
> download.file("ftp://ocs.oce.orst.edu/pub/prism/us/grids/tdmean/20
> 00-2009/us_tdmean_2004.01.gz", 
>   :
>          cannot open URL 
> 'ftp://ocs.oce.orst.edu/pub/prism/us/grids/tdmean/2000-2009/us_tdm
> ean_2004.01.gz'
> 
>   However, if you add 'method="wget"' (and are running on a Unix box 
> with wget installed) it works for me:
> 
>  > 
> download.file('ftp://ocs.oce.orst.edu/pub/prism/us/grids/tdmean/20
> 00-2009/us_tdmean_2004.01.gz',tmp,method="wget")
> --17:05:41-- 
> ftp://ocs.oce.orst.edu/pub/prism/us/grids/tdmean/2000-2009/us_tdme
> an_2004.01.gz
>             => `/tmp/RtmpHcpXlj/file643c9869'
> [wget stuff]
> 100%[=============================================================
> =========>] 
> 832,851      319.71K/s    ETA 00:00
> 
> 17:05:46 (319.71 KB/s) - `/tmp/RtmpHcpXlj/file643c9869' saved [832851]
> 
>   So I'm guessing its a problem with R's internal FTP client. Maybe it 
> doesnt like underscores or minus signs... Speculation...

This works with method 'wget' under windows - thanks. -AB


> 
> Barry
> 
> 
>



From saldanha.plangeo at gmail.com  Sun Jun 25 18:41:23 2006
From: saldanha.plangeo at gmail.com (Raphael Saldanha)
Date: Sun, 25 Jun 2006 13:41:23 -0300
Subject: [R-sig-Geo] Newbie!
Message-ID: <c85849370606250941ie3d0d61g506e29357251615f@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20060625/dc934cea/attachment.pl>

From karl.sommer at dpi.vic.gov.au  Tue Jun 27 00:23:27 2006
From: karl.sommer at dpi.vic.gov.au (karl.sommer at dpi.vic.gov.au)
Date: Tue, 27 Jun 2006 08:23:27 +1000
Subject: [R-sig-Geo]  generate & plot elevation contour lines
Message-ID: <OF076C89F0.28641407-ONCA257199.007A9FE2-CA257199.007AFEF1@nre.vic.gov.au>

Hello list

I am making reference to the graph gallery at
http://r-spatial.sourceforge.net/gallery
I was wondering how one would go about adding elevation contour lines to
the
example fig08?  Presuming that one would have access to a number of
geo-referenced
elevation measurements with a similar density as the sampling locations
indicated with a grey x in fig08. Is there a method to generate contour
lines from such information and overlay it onto the existing interpolated
graph?

Cheers

Karl Sommer
_________________________________
Karl J Sommer,
Department of Primary Industries,
Catchment & Agriculture Services,
PO Box 905
Mildura, VIC, Australia 3502

Tel: +61 (0)3 5051 4390
Fax +61 (0)3 5051 4534

Email:     karl.sommer at dpi.vic.gov.au



From Scott.Waichler at pnl.gov  Tue Jun 27 00:55:19 2006
From: Scott.Waichler at pnl.gov (Waichler, Scott R)
Date: Mon, 26 Jun 2006 15:55:19 -0700
Subject: [R-sig-Geo] Seeking example of making polygons from non-uniform grid
Message-ID: <7E4C06F49D6FEB49BE4B60E5FC92ED7A04A5AA79@pnlmse35.pnl.gov>


Hi,

I have a rectangular grid with varying cell sizes in the x and y
directions.  I am looking for an example on how to efficiently create sp
polygon objects given a complete description of the grid.  For each
cell, I have coordinates for the vertices and a value (z), which is my
case is a categorical variable.  Previously Roger Bivand suggested how I
could merge contiguous, like-valued cells into a single polygon, but the
example assumed a regular grid with uniform dx and dy.

Thanks for your help,
Scott

Scott Waichler, Senior Research Scientist
Pacific Northwest National Laboratory
MSIN K9-36
P.O. Box 999
Richland, WA   99352    USA
509-372-4423 (voice)
509-372-6089 (fax)
scott.waichler at pnl.gov
http://hydrology.pnl.gov



From mdsumner at utas.edu.au  Tue Jun 27 01:56:38 2006
From: mdsumner at utas.edu.au (Michael Sumner)
Date: Tue, 27 Jun 2006 09:56:38 +1000
Subject: [R-sig-Geo] Seeking example of making polygons from non-uniform
 grid
In-Reply-To: <7E4C06F49D6FEB49BE4B60E5FC92ED7A04A5AA79@pnlmse35.pnl.gov>
References: <7E4C06F49D6FEB49BE4B60E5FC92ED7A04A5AA79@pnlmse35.pnl.gov>
Message-ID: <44A07436.3060806@utas.edu.au>

Waichler, Scott R wrote:
> Hi,
>
> I have a rectangular grid with varying cell sizes in the x and y
> directions.  I am looking for an example on how to efficiently create sp
> polygon objects given a complete description of the grid.  For each
> cell, I have coordinates for the vertices and a value (z), which is my
> case is a categorical variable.  Previously Roger Bivand suggested how I
> could merge contiguous, like-valued cells into a single polygon, but the
> example assumed a regular grid with uniform dx and dy.
>
>   
Does this help? 

## bottom left corner of bottom left cell
llX <- 0
llY <- 0.5

## cell width and height
cellX <- 1
cellY <- 0.3

## number of cells
nX <- 10
nY <- 10

## z data - we have a z for every cell
zz <- rnorm(nX * nY)

## grid topology
cellsize <- c(cellX, cellY)
cellcentre.offset <- c(llX, llY) + cellsize/2

library(sp)
## define the grid topology, and convert to polygons
gt <- GridTopology(cellcentre.offset, cellsize, c(nX, nY))
polys <- as.SpatialPolygons.GridTopology(gt)

## add the data as a spatial polygons dataframe

poly.grd <- SpatialPolygonsDataFrame(polys, data.frame(z = zz, 
row.names=getSpPPolygonsIDSlots(polys)))

## compare to a SpGridDF version

grd <- SpatialGridDataFrame(gt, list(z = zz))
image(grd, axes = T)
plot(poly.grd, add = T)


sessionInfo()  ## I'm a little bit out of date
> Version 2.3.0 (2006-04-24)
> i386-pc-mingw32
>
> attached base packages:
> [1] "methods"   "stats"     "graphics"  "grDevices" "utils"     
> "datasets"
> [7] "base"    
>
> other attached packages:
>       sp
> "0.8-14"
>



From Scott.Waichler at pnl.gov  Tue Jun 27 02:45:13 2006
From: Scott.Waichler at pnl.gov (Waichler, Scott R)
Date: Mon, 26 Jun 2006 17:45:13 -0700
Subject: [R-sig-Geo] Seeking example of making polygons from
	non-uniform	grid
In-Reply-To: <44A07436.3060806@utas.edu.au>
Message-ID: <7E4C06F49D6FEB49BE4B60E5FC92ED7A04A5AADF@pnlmse35.pnl.gov>


> Does this help? 
> 
> ## bottom left corner of bottom left cell llX <- 0 llY <- 0.5
> 
> ## cell width and height
> cellX <- 1
> cellY <- 0.3

Michael, thanks for the example, but does this not assume that cellX is
constant across the grid, and likewise for cellY?

After my post I found a Roger Bivand example of how to process a few
irregular polygons given knowledge of the vertices.  I adapted this for
a rectangular grid situation, where the cells are varying sizes.  My
code to do this is below.  If anyone desires to make this more
efficient, please have at it.

  library(sp)
  library(spgpc)

  dx <- c(1, 2, 2, 1, 3, 3, 1, 1)
  dz <- c(2, 1, 1, 3, 3, 1, 2, 2)
  x.origin <- 0
  xnb <- c(x.origin, x.origin + cumsum(dx))  # x cell boundaries
  z.origin <- 0
  znb <- c(z.origin, z.origin + cumsum(dz))  # z nodal boundaries
  num.x <- length(dx)
  num.z <- length(dz)
  num.cells <- num.x * num.z

  k <- 0
  for(j in 1:num.z) {
    for(i in 1:num.x) {
      k <- k + 1
      ll.x <- xnb[i]  # lower left corner
      ll.y <- znb[j]
      ul.x <- ll.x     # upper left corner
      ul.y <- znb[(j+1)]
      ur.x <- xnb[(i+1)]  # upper right corner
      ur.y <- ul.y  
      lr.x <- ur.x  # lower right corner
      lr.y <- znb[j]
      this.polygon <-
        Polygon(matrix(c(ll.x, ll.y, ul.x, ul.y, ur.x, ur.y, lr.x, lr.y,
ll.x, ll.y), byrow=T, ncol=2),
                hole=F)

      cmd <- paste(sep="", 'Srs', k, ' <- Polygons(list(this.polygon),
"s', k, '")')
      eval(parse(text=cmd))
    }
  }
  
  # Assign values to the cells
  cell.values <- c(1, 1, 2, 1, 3, 3, 3, 3, 2, 2, 2, 1, 1, 2, 2, 2, 2, 2,
2, 3, 3,
                   2, 2, 3, 3, 3, 1, 1, 1, 3, 3, 3, 3, 3, 1, 1, 1, 3, 2,
3, 2, 2,
                   3, 3, 3, 3, 1, 2, 3, 3, 2, 2, 2, 2, 1, 3, 1, 1, 2, 2,
2, 2, 1, 3)

  cmd.SR <- 'SR <- SpatialPolygons(list(Srs1'
  for(k in 2:num.cells) cmd.SR <- paste(sep="", cmd.SR, ', Srs', k)
  cmd.SR <- paste(sep="", cmd.SR, ')', ', cell.values', ')')
  eval(parse(text=cmd.SR))
  SR.new <- lapply(getSpPpolygonsSlot(SR), checkPolygonsHoles)

  # Plot the individual cells/polygons
  plot(as.SpatialPolygons.PolygonsList(SR.new), col = cell.values, pbg =
"white")

  # Now union contiguous like-valued cells into minimum number of
polygons.
  SR.union <-
unionSpatialPolygons(as.SpatialPolygons.PolygonsList(SR.new),
cell.values)
  plot(SR.union, col=1:3)

Thanks,
Scott Waichler
Pacific Northwest National Laboratory
scott.waichler _at_ pnl.gov



From mdsumner at utas.edu.au  Tue Jun 27 03:08:57 2006
From: mdsumner at utas.edu.au (Michael Sumner)
Date: Tue, 27 Jun 2006 11:08:57 +1000
Subject: [R-sig-Geo] Seeking example of making polygons from
	non-uniformgrid
In-Reply-To: <7E4C06F49D6FEB49BE4B60E5FC92ED7A04A5AADF@pnlmse35.pnl.gov>
References: <7E4C06F49D6FEB49BE4B60E5FC92ED7A04A5AADF@pnlmse35.pnl.gov>
Message-ID: <44A08529.3060700@utas.edu.au>

Waichler, Scott R wrote:
>> Does this help? 
>>
>> ## bottom left corner of bottom left cell llX <- 0 llY <- 0.5
>>
>> ## cell width and height
>> cellX <- 1
>> cellY <- 0.3
>>     
>
> Michael, thanks for the example, but does this not assume that cellX is
> constant across the grid, and likewise for cellY?
>   

Whoops, I'm sorry.



From e.pebesma at geo.uu.nl  Tue Jun 27 08:55:03 2006
From: e.pebesma at geo.uu.nl (Edzer J. Pebesma)
Date: Tue, 27 Jun 2006 08:55:03 +0200
Subject: [R-sig-Geo] generate & plot elevation contour lines
In-Reply-To: <OF076C89F0.28641407-ONCA257199.007A9FE2-CA257199.007AFEF1@nre.vic.gov.au>
References: <OF076C89F0.28641407-ONCA257199.007A9FE2-CA257199.007AFEF1@nre.vic.gov.au>
Message-ID: <44A0D647.1070207@geo.uu.nl>

karl.sommer at dpi.vic.gov.au wrote:
> Hello list
>
> I am making reference to the graph gallery at
> http://r-spatial.sourceforge.net/gallery
> I was wondering how one would go about adding elevation contour lines to
> the
> example fig08?  Presuming that one would have access to a number of
> geo-referenced
> elevation measurements with a similar density as the sampling locations
> indicated with a grey x in fig08. Is there a method to generate contour
> lines from such information and overlay it onto the existing interpolated
> graph?
>
> Cheers
>
> Karl Sommer
> ________________________________
Simpler than I thought it would be: add contour = TRUE to the argument list
of spplot.

If you want the actual contours, there is a contourLines function that 
returns them; sp has a function to convert these to 
SpatialLinesDataFrame objects: contourLines2SLDF().
--
Edzer



From karl.sommer at dpi.vic.gov.au  Tue Jun 27 09:29:39 2006
From: karl.sommer at dpi.vic.gov.au (karl.sommer at dpi.vic.gov.au)
Date: Tue, 27 Jun 2006 17:29:39 +1000
Subject: [R-sig-Geo] generate & plot elevation contour lines
Message-ID: <OF2837419A.7F95DEA0-ONCA25719A.0028281A-CA25719A.00292AAA@nre.vic.gov.au>



my understanding is that adding the "contour = TRUE" will add the contour
lines for kriged zinc concentration in the present example.

However, what I am after is to superimpose contour lines of elevation in
meters above sea level on top of an interpolated variable that is not
elevation, eg zinc concentration or some other variable.

I have an interpolated maps of an electromagnetic survey  (EM38) of a field
and I would like to overlay a plot of contour lines to visualize surface
drainage patterns.

Thanks

Karl



|---------+---------------------------->
|         |           e.pebesma at geo.uu.|
|         |           nl               |
|         |                            |
|         |           27/06/2006 16:55 |
|         |                            |
|---------+---------------------------->
  >------------------------------------------------------------------------------------------------------------------------------|
  |                                                                                                                              |
  |       To:       karl.sommer at dpi.vic.gov.au                                                                                   |
  |       cc:       r-sig-geo at stat.math.ethz.ch                                                                                  |
  |       Subject:  Re: [R-sig-Geo]  generate & plot elevation contour lines                                                     |
  >------------------------------------------------------------------------------------------------------------------------------|




karl.sommer at dpi.vic.gov.au wrote:
> Hello list
>
> I am making reference to the graph gallery at
> http://r-spatial.sourceforge.net/gallery
> I was wondering how one would go about adding elevation contour lines to
> the
> example fig08?  Presuming that one would have access to a number of
> geo-referenced
> elevation measurements with a similar density as the sampling locations
> indicated with a grey x in fig08. Is there a method to generate contour
> lines from such information and overlay it onto the existing interpolated
> graph?
>
> Cheers
>
> Karl Sommer
> ________________________________
Simpler than I thought it would be: add contour = TRUE to the argument list
of spplot.

If you want the actual contours, there is a contourLines function that
returns them; sp has a function to convert these to
SpatialLinesDataFrame objects: contourLines2SLDF().
--
Edzer



From e.pebesma at geo.uu.nl  Tue Jun 27 11:12:53 2006
From: e.pebesma at geo.uu.nl (Edzer J. Pebesma)
Date: Tue, 27 Jun 2006 11:12:53 +0200
Subject: [R-sig-Geo] generate & plot elevation contour lines
In-Reply-To: <OF2837419A.7F95DEA0-ONCA25719A.0028281A-CA25719A.00292AAA@nre.vic.gov.au>
References: <OF2837419A.7F95DEA0-ONCA25719A.0028281A-CA25719A.00292AAA@nre.vic.gov.au>
Message-ID: <44A0F695.5070204@geo.uu.nl>

karl.sommer at dpi.vic.gov.au wrote:
> my understanding is that adding the "contour = TRUE" will add the contour
> lines for kriged zinc concentration in the present example.
>
> However, what I am after is to superimpose contour lines of elevation in
> meters above sea level on top of an interpolated variable that is not
> elevation, eg zinc concentration or some other variable.
>
> I have an interpolated maps of an electromagnetic survey  (EM38) of a field
> and I would like to overlay a plot of contour lines to visualize surface
> drainage patterns.
>   
In that case you could pass them as a SpatialLinesDataFrame
object in the sp.layout list. It will not automatically print the
contour values, but you may be able to use colour; the corresponding
legend will be the next issue, then.
--
Edzer



From karl.sommer at dpi.vic.gov.au  Thu Jun 29 01:37:03 2006
From: karl.sommer at dpi.vic.gov.au (karl.sommer at dpi.vic.gov.au)
Date: Thu, 29 Jun 2006 09:37:03 +1000
Subject: [R-sig-Geo] generate & plot elevation contour lines
Message-ID: <OF4236902B.42FF60C5-ONCA25719B.007FED15-CA25719B.0081BC1F@nre.vic.gov.au>

|---------+---------------------------->
|         |           e.pebesma at geo.uu.|
|         |           nl               |
|         |                            |
|         |           27/06/2006 19:12 |
|         |                            |
|---------+---------------------------->
  >------------------------------------------------------------------------------------------------------------------------------|
  |                                                                                                                              |
  |       To:       karl.sommer at dpi.vic.gov.au                                                                                   |
  |       cc:       r-sig-geo at stat.math.ethz.ch                                                                                  |
  |       Subject:  Re: [R-sig-Geo]  generate & plot elevation contour lines                                                     |
  >------------------------------------------------------------------------------------------------------------------------------|







karl.sommer at dpi.vic.gov.au wrote:
> my understanding is that adding the "contour = TRUE" will add the contour
> lines for kriged zinc concentration in the present example.
>
> However, what I am after is to superimpose contour lines of elevation in
> meters above sea level on top of an interpolated variable that is not
> elevation, eg zinc concentration or some other variable.
>
> I have interpolated maps of an electromagnetic survey  (EM38) of a field
> and I would like to overlay a plot of contour lines to visualize surface
> drainage patterns.
>
In that case you could pass them as a SpatialLinesDataFrame
object in the sp.layout list. It will not automatically print the
contour values, but you may be able to use colour; the corresponding
legend will be the next issue, then.
--
Edzer

I have tried unsuccessfully to generate a SpatialLinesDataFrame object for
passing in sp.layout

I was trying to use the contourLines() function without success, probably I
didn't get the syntax right

I tried to use the function on an object of class SpatialPixelsDataFrame
(topo.idw) which I generated from a set of  elevation measurements
class(topo.idw)
[1] "SpatialPixelsDataFrame"
attr(,"package")
[1] "sp"

running the function contourLines() directly I get the following error
> contourLines(topo.idw["var1.pred"])
Error in contourLines(topo.idw["var1.pred"]) :
      no proper 'z' matrix specified

running the function contour(topo.idw["var1.pred"]) I get a correct plot of
the contour lines

when I am trying to combine contourLines2SLDF() and contour() I get the
following error message
> CL <- contourLines2SLDF(contour(topo.idw["var1.pred"]))
Error in contourLines2SLDF(contour(topo.idw["var1.pred"])) :
      cL too short

I am not sure how to progress from here

Regards

Karl



From e.pebesma at geo.uu.nl  Thu Jun 29 09:28:40 2006
From: e.pebesma at geo.uu.nl (Edzer J. Pebesma)
Date: Thu, 29 Jun 2006 09:28:40 +0200
Subject: [R-sig-Geo] generate & plot elevation contour lines
In-Reply-To: <OF4236902B.42FF60C5-ONCA25719B.007FED15-CA25719B.0081BC1F@nre.vic.gov.au>
References: <OF4236902B.42FF60C5-ONCA25719B.007FED15-CA25719B.0081BC1F@nre.vic.gov.au>
Message-ID: <44A38128.5010004@geo.uu.nl>

karl.sommer at dpi.vic.gov.au wrote:
> karl.sommer at dpi.vic.gov.au wrote:
>   
>> my understanding is that adding the "contour = TRUE" will add the contour
>> lines for kriged zinc concentration in the present example.
>>
>> However, what I am after is to superimpose contour lines of elevation in
>> meters above sea level on top of an interpolated variable that is not
>> elevation, eg zinc concentration or some other variable.
>>
>> I have interpolated maps of an electromagnetic survey  (EM38) of a field
>> and I would like to overlay a plot of contour lines to visualize surface
>> drainage patterns.
>>
>>     
> In that case you could pass them as a SpatialLinesDataFrame
> object in the sp.layout list. It will not automatically print the
> contour values, but you may be able to use colour; the corresponding
> legend will be the next issue, then.
> --
> Edzer
>
> I have tried unsuccessfully to generate a SpatialLinesDataFrame object for
> passing in sp.layout
>
> I was trying to use the contourLines() function without success, probably I
> didn't get the syntax right
>
> I tried to use the function on an object of class SpatialPixelsDataFrame
> (topo.idw) which I generated from a set of  elevation measurements
> class(topo.idw)
> [1] "SpatialPixelsDataFrame"
> attr(,"package")
> [1] "sp"
>
> running the function contourLines() directly I get the following error
>   
>> contourLines(topo.idw["var1.pred"])
>>     
> Error in contourLines(topo.idw["var1.pred"]) :
>       no proper 'z' matrix specified
>
> running the function contour(topo.idw["var1.pred"]) I get a correct plot of
> the contour lines
>
> when I am trying to combine contourLines2SLDF() and contour() I get the
> following error message
>   
>> CL <- contourLines2SLDF(contour(topo.idw["var1.pred"]))
>>     
> Error in contourLines2SLDF(contour(topo.idw["var1.pred"])) :
>       cL too short
>
> I am not sure how to progress from here
>   
contourLines is base graphics in R, so it needs arguments the
same way contour and image (in base) need them; read their
help pages, and it is especially important that you get x, y and
z right for the contourlines to have the right topology. But hey,
I believe I wrote a function as.image.SpatialGridDataFrame
in sp which does this for you.

Try:

contourLines(as.image(as(topo.idw, "SpatialGridDataFrame")))
--
Edzer



From karl.sommer at dpi.vic.gov.au  Fri Jun 30 01:19:52 2006
From: karl.sommer at dpi.vic.gov.au (karl.sommer at dpi.vic.gov.au)
Date: Fri, 30 Jun 2006 09:19:52 +1000
Subject: [R-sig-Geo] generate & plot elevation contour lines
Message-ID: <OFF6FEFFAA.0C904390-ONCA25719C.007F6180-CA25719C.0080291B@nre.vic.gov.au>

|---------+---------------------------->
|         |           e.pebesma at geo.uu.|
|         |           nl               |
|         |                            |
|         |           29/06/2006 17:28 |
|         |                            |
|---------+---------------------------->
  >------------------------------------------------------------------------------------------------------------------------------|
  |                                                                                                                              |
  |       To:       karl.sommer at dpi.vic.gov.au                                                                                   |
  |       cc:       r-sig-geo at stat.math.ethz.ch                                                                                  |
  |       Subject:  Re: [R-sig-Geo]  generate & plot elevation contour lines                                                     |
  >------------------------------------------------------------------------------------------------------------------------------|











contourLines is base graphics in R, so it needs arguments the
same way contour and image (in base) need them; read their
help pages, and it is especially important that you get x, y and
z right for the contourlines to have the right topology. But hey,
I believe I wrote a function as.image.SpatialGridDataFrame
in sp which does this for you.

Try:

contourLines(as.image(as(topo.idw, "SpatialGridDataFrame")))
--
Edzer

Eventually I had success with the following construct.

CL <- contourLines2SLDF(contourLines(as.image.SpatialGridDataFrame
      (as(topo.idw["var1.pred"],"SpatialGridDataFrame"))))
I then passed CL using sp.layout and it worked

The next challenge is how to pass the corresponding labels ?

Thanks

Karl



From e.pebesma at geo.uu.nl  Fri Jun 30 09:17:44 2006
From: e.pebesma at geo.uu.nl (Edzer J. Pebesma)
Date: Fri, 30 Jun 2006 09:17:44 +0200
Subject: [R-sig-Geo] generate & plot elevation contour lines
In-Reply-To: <OFF6FEFFAA.0C904390-ONCA25719C.007F6180-CA25719C.0080291B@nre.vic.gov.au>
References: <OFF6FEFFAA.0C904390-ONCA25719C.007F6180-CA25719C.0080291B@nre.vic.gov.au>
Message-ID: <44A4D018.1090305@geo.uu.nl>

karl.sommer at dpi.vic.gov.au wrote:
>
> Eventually I had success with the following construct.
>
> CL <- contourLines2SLDF(contourLines(as.image.SpatialGridDataFrame
>       (as(topo.idw["var1.pred"],"SpatialGridDataFrame"))))
> I then passed CL using sp.layout and it worked
>
> The next challenge is how to pass the corresponding labels ?
>   
Not so much to pass them, as they are attributes in the
SpatialLinesDataFrame object; the challenge is to plot
them at suitable locations.

contour() does this quite differently from contourplot()
in lattice it seems, but the former uses some non-accesible
function through .Internal().
--
Edzer



