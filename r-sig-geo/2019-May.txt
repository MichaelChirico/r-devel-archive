From rv@|@v| @end|ng |rom @tudent@un|me|b@edu@@u  Wed May  1 04:18:17 2019
From: rv@|@v| @end|ng |rom @tudent@un|me|b@edu@@u (Roozbeh Valavi)
Date: Wed, 1 May 2019 12:18:17 +1000
Subject: [R-sig-Geo] Spatial join/intersection in R
Message-ID: <CAH-s5PNu74AuTXDY3NA00dY_jH9dWgFGbciRub=C3Xoaotk7BA@mail.gmail.com>

Dear members,

I want to do a spatial join/intersection in R. The problem is that some of
my points are lying exactly at the border of the adjacent polygons (see the
figure attached). So these points are either falling in both or none of the
polygons! Is there any way to avoid this?

Thanks in advance.
Roozbeh


[image: image.png]



-- 
*Roozbeh Valavi*
PhD Candidate
The Quantitative & Applied Ecology Group <http://qaeco.com/>
School of BioSciences | Faculty of Science
The University of Melbourne, VIC 3010, Australia
Mobile: +61 423 283 238

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20190501/b4fc0504/attachment.html>

-------------- next part --------------
A non-text attachment was scrubbed...
Name: image.png
Type: image/png
Size: 27322 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20190501/b4fc0504/attachment.png>

From teph|||pp| @end|ng |rom gm@||@com  Wed May  1 07:15:46 2019
From: teph|||pp| @end|ng |rom gm@||@com (Tom Philippi)
Date: Tue, 30 Apr 2019 22:15:46 -0700
Subject: [R-sig-Geo] Spatial join/intersection in R
In-Reply-To: <CAH-s5PNu74AuTXDY3NA00dY_jH9dWgFGbciRub=C3Xoaotk7BA@mail.gmail.com>
References: <CAH-s5PNu74AuTXDY3NA00dY_jH9dWgFGbciRub=C3Xoaotk7BA@mail.gmail.com>
Message-ID: <CALyPt8x08ZN+TUetdJfE+-1QE5HFNs+ySBjzDwkV9ji_75vGaw@mail.gmail.com>

Roozbeh--

What do you want to have happen with those points? Given the units in your
figure, you could unambiguously assign them to the upper-right by adding a
small value (0.000001) to both the X and Y coordinates of your points.
Whether that is a sensible thing to do depends on what your data are.

How or why do the points fall exactly on your polygon boundaries?  What
process puts them exactly on the polygon (grid cell) boundaries?  It
appears your polygon boundaries are a grid at multiples of 0.05, although
not all potential cells in a rectangle are shown.  Are there many other
points not on polygon boundaries not shown in your figure, or are points
only along grid lines?  If the latter, does it make sense to assign them to
_polygons_ rather than line segments?

If you're doing a sample draw or measuring locations with only a few
decimal points of accuracy, and generating your polygon boundaries at exact
multiples of 0.05, then it might make sense to shift all of your points +
1/10th of your point location resolution so that their coordinates never
fall on polygon boundaries.  There _might_ be situations where instead of
always adding (shifting up and right), you should randomly add or subtract
in each direction for each point, but I'm stuck viewing this as points in
sTomample units so I can't think of such a case.

Tom
.

On Tue, Apr 30, 2019 at 7:18 PM Roozbeh Valavi <
rvalavi at student.unimelb.edu.au> wrote:

> Dear members,
>
> I want to do a spatial join/intersection in R. The problem is that some of
> my points are lying exactly at the border of the adjacent polygons (see the
> figure attached). So these points are either falling in both or none of the
> polygons! Is there any way to avoid this?
>
> Thanks in advance.
> Roozbeh
>
>
> [image: image.png]
>
>
>
> --
> *Roozbeh Valavi*
> PhD Candidate
> The Quantitative & Applied Ecology Group <http://qaeco.com/>
> School of BioSciences | Faculty of Science
> The University of Melbourne, VIC 3010, Australia
> Mobile: +61 423 283 238
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20190430/6e7783d8/attachment.html>

-------------- next part --------------
A non-text attachment was scrubbed...
Name: image.png
Type: image/png
Size: 27322 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20190430/6e7783d8/attachment.png>

From m@ur|z|om@rch|85 @end|ng |rom gm@||@com  Thu May  2 18:49:10 2019
From: m@ur|z|om@rch|85 @end|ng |rom gm@||@com (Maurizio Marchi)
Date: Thu, 2 May 2019 18:49:10 +0200
Subject: [R-sig-Geo] Strange spatial reference system netCDF
Message-ID: <CANJhsN0uoawC2_masuqXOWVweO-Z2FUbdEnxs7ES1hYq=e=jRA@mail.gmail.com>

Dear list,
I'm working with large netCDF files from the UK Climate Projections portal (
https://www.metoffice.gov.uk/research/collaboration/ukcp). More in detail
I'm reading with the ncdf4 library this
<http://data.ceda.ac.uk/badc/ukcp18/data/land-rcm/eur/12km/rcp85/01/tas/mon/latest/>
file. Once loaded O can easily handle it but it is a strange reference
system as follow:
rotated_latitude_longitude[]
            grid_mapping_name: rotated_latitude_longitude
            longitude_of_prime_meridian: 0
            earth_radius: *6371229*
            grid_north_pole_latitude: 39.25
            grid_north_pole_longitude: 198
            north_pole_grid_longitude: 0
If I load the .nc file in QGIS I see that the SR is "+proj=longlat
+a=6371229 +b=6371229 +no_defs" where the values associated to *a* and
*b* variables
are the earth radius. Even if QGIS can read it, the raw file isn't
projected properly (it seems tha QGIS is not able to handle such
projection).
Finally, using the ncdf4+raster libraries, I can easily generate e raster
image but then I'm not able to understand I could I re project this raster
in WGS84 reference system.
Any helps?
Cheers

--
Maurizio Marchi,
PhD Forest Science - Ecological Mathematics
Skype ID: maurizioxyz
linux user 552742
#EUFGIS national Focal point for Italy
#Annals of Silvicultural Research Associated Editor
https://scholar.google.it/citations?hl=en&user=_2X6fu8AAAAJ
<https://scholar.google.it/citations?hl=en&user=_2X6fu8AAAAJ*>

	[[alternative HTML version deleted]]


From edzer@pebe@m@ @end|ng |rom un|-muen@ter@de  Fri May  3 16:58:01 2019
From: edzer@pebe@m@ @end|ng |rom un|-muen@ter@de (Edzer Pebesma)
Date: Fri, 3 May 2019 16:58:01 +0200
Subject: [R-sig-Geo] Strange spatial reference system netCDF
In-Reply-To: <CANJhsN0uoawC2_masuqXOWVweO-Z2FUbdEnxs7ES1hYq=e=jRA@mail.gmail.com>
References: <CANJhsN0uoawC2_masuqXOWVweO-Z2FUbdEnxs7ES1hYq=e=jRA@mail.gmail.com>
Message-ID: <82193e8b-8fcc-3308-7874-a22ae6985c01@uni-muenster.de>

Dear Maurizio,

an attempt to do something along this line is:

f = "tas_rcp85_land-rcm_eur_12km_01_mon_198012-208011.nc"
library(stars)
r = read_ncdf(f, ncsub = cbind(start = c(1, 1, 1, 1), count = c(418,
406, 3, 1)), eps=1e-3)
rx = read_stars(f, proxy = TRUE) # only for the crs!
st_crs(r) = st_crs(rx)
r0 = stars:::st_transform_proj.stars(r, 4326)
png("x.png")
plot(r0[,,,1], border = NA, axes = TRUE, reset = FALSE)
library(rnaturalearth)
plot(ne_coastline(returnclass = "sf"), add = TRUE, col = 'orange')

Note that the output object time stamps respect the 360-day calendar
(using pkg PCICt).

You'll find some discussion, and the output image, here:
https://github.com/r-spatial/stars/issues/175

Feel free to post follow-up questions here, or to github.

On 5/2/19 6:49 PM, Maurizio Marchi wrote:
> Dear list,
> I'm working with large netCDF files from the UK Climate Projections portal (
> https://www.metoffice.gov.uk/research/collaboration/ukcp). More in detail
> I'm reading with the ncdf4 library this
> <http://data.ceda.ac.uk/badc/ukcp18/data/land-rcm/eur/12km/rcp85/01/tas/mon/latest/>
> file. Once loaded O can easily handle it but it is a strange reference
> system as follow:
> rotated_latitude_longitude[]
>             grid_mapping_name: rotated_latitude_longitude
>             longitude_of_prime_meridian: 0
>             earth_radius: *6371229*
>             grid_north_pole_latitude: 39.25
>             grid_north_pole_longitude: 198
>             north_pole_grid_longitude: 0
> If I load the .nc file in QGIS I see that the SR is "+proj=longlat
> +a=6371229 +b=6371229 +no_defs" where the values associated to *a* and
> *b* variables
> are the earth radius. Even if QGIS can read it, the raw file isn't
> projected properly (it seems tha QGIS is not able to handle such
> projection).
> Finally, using the ncdf4+raster libraries, I can easily generate e raster
> image but then I'm not able to understand I could I re project this raster
> in WGS84 reference system.
> Any helps?
> Cheers
> 
> --
> Maurizio Marchi,
> PhD Forest Science - Ecological Mathematics
> Skype ID: maurizioxyz
> linux user 552742
> #EUFGIS national Focal point for Italy
> #Annals of Silvicultural Research Associated Editor
> https://scholar.google.it/citations?hl=en&user=_2X6fu8AAAAJ
> <https://scholar.google.it/citations?hl=en&user=_2X6fu8AAAAJ*>
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics
Heisenbergstrasse 2, 48151 Muenster, Germany
Phone: +49 251 8333081

-------------- next part --------------
A non-text attachment was scrubbed...
Name: pEpkey.asc
Type: application/pgp-keys
Size: 2472 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20190503/34eee3d8/attachment.bin>

From edzer@pebe@m@ @end|ng |rom un|-muen@ter@de  Sat May  4 18:40:44 2019
From: edzer@pebe@m@ @end|ng |rom un|-muen@ter@de (Edzer Pebesma)
Date: Sat, 4 May 2019 18:40:44 +0200
Subject: [R-sig-Geo] R-sig-Geo Digest, Vol 189, Issue 3
In-Reply-To: <CANJhsN3BQTdVrMqHHwgsUSs4jz-Zpip0SLwJbX_2AMv8w_55wA@mail.gmail.com>
References: <mailman.27275.7.1556964537.5757.r-sig-geo@r-project.org>
 <CANJhsN3BQTdVrMqHHwgsUSs4jz-Zpip0SLwJbX_2AMv8w_55wA@mail.gmail.com>
Message-ID: <693dbaec-021e-bb9e-3f02-bf567f32d6c3@uni-muenster.de>

The problem might be in the PROJ version; PROJ has seen a lot of
development the last few years. I'm on

Linking to GEOS 3.7.0, GDAL 2.4.0, PROJ 5.2.0

Since you are on ubuntu, it should be pretty easy to get that too; see
sf github pages for installing from ppa:ubuntugis-unstable:
https://github.com/r-spatial/sf

On 5/4/19 5:19 PM, Maurizio Marchi wrote:
> Dear Prof.
> Many thanks for your quick reply. Anyway I still have some differences
> with your output, as well as some errors in the R console. Actually,
> practically speaking, in my .png plot (attached) the origin of the axes
> is still in Germany and the left and right borders of the image are
> still rectilinear.
> 
> *Here my R output using your code with the sessionInfo() at the end. I
> hope it helps*
> 
> R version 3.6.0 (2019-04-26) -- "Planting of a Tree" Copyright (C) 2019
> The R Foundation for Statistical Computing Platform: x86_64-pc-linux-gnu
> (64-bit) R is free software and comes with ABSOLUTELY NO WARRANTY. You
> are welcome to redistribute it under certain conditions. Type
> 'license()' or 'licence()' for distribution details. Natural language
> support but running in an English locale R is a collaborative project
> with many contributors. Type 'contributors()' for more information and
> 'citation()' on how to cite R or R packages in publications. Type
> 'demo()' for some demos, 'help()' for on-line help, or 'help.start()'
> for an HTML browser interface to help. Type 'q()' to quit R. > f =
> 'tas_rcp85_land-rcm_eur_12km_01_mon_198012-208011.nc
> <http://tas_rcp85_land-rcm_eur_12km_01_mon_198012-208011.nc>' >
> library(stars) Loading required package: abind Loading required package:
> sf Linking to GEOS 3.6.2, GDAL 2.2.3, PROJ 4.9.3 > r = read_ncdf(f,
> ncsub = cbind(start = c(1, 1, 1, 1), count = c(418, 406, 3, 1)),
> eps=1e-3) > rx = read_stars(f, proxy = TRUE) # only for the crs! Warning
> messages: 1: In CPL_read_gdal(as.character(x), as.character(options),
> as.character(driver), : GDAL Message 1: The dataset has several
> variables that could be identified as vector fields, but not all share
> the same primary dimension. Consequently they will be ignored. 2: In
> CPL_read_gdal(as.character(x), as.character(options),
> as.character(driver), : GDAL Message 1: dimension #1 (time) is not a
> Time dimension. 3: In CPL_read_gdal(as.character(x),
> as.character(options), as.character(driver), : GDAL Message 1: dimension
> #0 (ensemble_member) is not a Time dimension. > st_crs(r) = st_crs(rx) >
> r0 = stars:::st_transform_proj.stars(r, 4326) > plot(r0[,,,1], border =
> NA, axes = TRUE, reset = FALSE) Warning messages: 1: In
> classInt::classIntervals(na.omit(values), min(nbreaks - 1, n.unq), : N
> is large, and some styles will run very slowly; sampling imposed 2: In
> st_is_longlat(x) : bounding box has potentially an invalid value range
> for longlat data 3: In st_is_longlat(x) : bounding box has potentially
> an invalid value range for longlat data 4: In st_is_longlat(x) :
> bounding box has potentially an invalid value range for longlat data 5:
> In st_is_longlat(x) : bounding box has potentially an invalid value
> range for longlat data 6: In st_is_longlat(x) : bounding box has
> potentially an invalid value range for longlat data >
> library(rnaturalearth) > plot(ne_coastline(returnclass = "sf"), add =
> TRUE, col = 'orange') Warning message: In
> plot.sf(ne_coastline(returnclass = "sf"), add = TRUE, col = "orange") :
> ignoring all but the first attribute > sessionInfo() R version 3.6.0
> (2019-04-26) Platform: x86_64-pc-linux-gnu (64-bit) Running under:
> Ubuntu 18.04.2 LTS Matrix products: default BLAS:
> /usr/lib/x86_64-linux-gnu/blas/libblas.so.3.7.1 LAPACK:
> /usr/lib/x86_64-linux-gnu/lapack/liblapack.so.3.7.1 locale: [1]
> LC_CTYPE=en_GB.UTF-8 LC_NUMERIC=C LC_TIME=it_IT.UTF-8
> LC_COLLATE=en_GB.UTF-8 LC_MONETARY=it_IT.UTF-8 LC_MESSAGES=en_GB.UTF-8
> [7] LC_PAPER=it_IT.UTF-8 LC_NAME=C LC_ADDRESS=C LC_TELEPHONE=C
> LC_MEASUREMENT=it_IT.UTF-8 LC_IDENTIFICATION=C attached base packages:
> [1] stats graphics grDevices utils datasets methods base other attached
> packages: [1] rnaturalearth_0.1.0 stars_0.3-1 sf_0.7-4 abind_1.4-5
> loaded via a namespace (and not attached): [1] Rcpp_1.0.1 magrittr_1.5
> units_0.6-3 tidyselect_0.2.5 lattice_0.20-38 R6_2.4.0 rlang_0.3.4 [8]
> rnaturalearthdata_0.2.0 dplyr_0.8.0.1 tools_3.6.0 parallel_3.6.0
> grid_3.6.0 KernSmooth_2.23-15 ncmeta_0.0.4 [15] e1071_1.7-1 DBI_1.0.0
> class_7.3-15 assertthat_0.2.1 tibble_2.1.1 RNetCDF_1.9-1 crayon_1.3.4
> [22] tidyr_0.8.3 purrr_0.3.2 PCICt_0.5-4.1 glue_1.3.1 sp_1.3-1
> compiler_3.6.0 pillar_1.3.1 [29] classInt_0.3-3 pkgconfig_2.0.2
> 
> 
> --
> Maurizio Marchi,
> PhD Forest Science - Ecological Mathematics
> Skype ID: maurizioxyz
> linux user 552742
> #EUFGIS national Focal point for Italy
> #Annals of Silvicultural Research?Associated Editor
> https://scholar.google.it/citations?hl=en&user=_2X6fu8AAAAJ
> <https://scholar.google.it/citations?hl=en&user=_2X6fu8AAAAJ*>
> 
> 
> 
> 
> Il giorno sab 4 mag 2019 alle ore 12:10 <r-sig-geo-request at r-project.org
> <mailto:r-sig-geo-request at r-project.org>> ha scritto:
> 
>     Send R-sig-Geo mailing list submissions to
>     ? ? ? ? r-sig-geo at r-project.org <mailto:r-sig-geo at r-project.org>
> 
>     To subscribe or unsubscribe via the World Wide Web, visit
>     ? ? ? ? https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>     or, via email, send a message with subject or body 'help' to
>     ? ? ? ? r-sig-geo-request at r-project.org
>     <mailto:r-sig-geo-request at r-project.org>
> 
>     You can reach the person managing the list at
>     ? ? ? ? r-sig-geo-owner at r-project.org
>     <mailto:r-sig-geo-owner at r-project.org>
> 
>     When replying, please edit your Subject line so it is more specific
>     than "Re: Contents of R-sig-Geo digest..."
> 
> 
>     Today's Topics:
> 
>     ? ?1. Re: Strange spatial reference system netCDF (Edzer Pebesma)
> 
>     ----------------------------------------------------------------------
> 
>     Message: 1
>     Date: Fri, 3 May 2019 16:58:01 +0200
>     From: Edzer Pebesma <edzer.pebesma at uni-muenster.de
>     <mailto:edzer.pebesma at uni-muenster.de>>
>     To: r-sig-geo at r-project.org <mailto:r-sig-geo at r-project.org>
>     Subject: Re: [R-sig-Geo] Strange spatial reference system netCDF
>     Message-ID: <82193e8b-8fcc-3308-7874-a22ae6985c01 at uni-muenster.de
>     <mailto:82193e8b-8fcc-3308-7874-a22ae6985c01 at uni-muenster.de>>
>     Content-Type: text/plain; charset="utf-8"
> 
>     Dear Maurizio,
> 
>     an attempt to do something along this line is:
> 
>     f = "tas_rcp85_land-rcm_eur_12km_01_mon_198012-208011.nc
>     <http://tas_rcp85_land-rcm_eur_12km_01_mon_198012-208011.nc>"
>     library(stars)
>     r = read_ncdf(f, ncsub = cbind(start = c(1, 1, 1, 1), count = c(418,
>     406, 3, 1)), eps=1e-3)
>     rx = read_stars(f, proxy = TRUE) # only for the crs!
>     st_crs(r) = st_crs(rx)
>     r0 = stars:::st_transform_proj.stars(r, 4326)
>     png("x.png")
>     plot(r0[,,,1], border = NA, axes = TRUE, reset = FALSE)
>     library(rnaturalearth)
>     plot(ne_coastline(returnclass = "sf"), add = TRUE, col = 'orange')
> 
>     Note that the output object time stamps respect the 360-day calendar
>     (using pkg PCICt).
> 
>     You'll find some discussion, and the output image, here:
>     https://github.com/r-spatial/stars/issues/175
> 
>     Feel free to post follow-up questions here, or to github.
> 
>     On 5/2/19 6:49 PM, Maurizio Marchi wrote:
>     > Dear list,
>     > I'm working with large netCDF files from the UK Climate
>     Projections portal (
>     > https://www.metoffice.gov.uk/research/collaboration/ukcp). More in
>     detail
>     > I'm reading with the ncdf4 library this
>     >
>     <http://data.ceda.ac.uk/badc/ukcp18/data/land-rcm/eur/12km/rcp85/01/tas/mon/latest/>
>     > file. Once loaded O can easily handle it but it is a strange reference
>     > system as follow:
>     > rotated_latitude_longitude[]
>     >? ? ? ? ? ? ?grid_mapping_name: rotated_latitude_longitude
>     >? ? ? ? ? ? ?longitude_of_prime_meridian: 0
>     >? ? ? ? ? ? ?earth_radius: *6371229*
>     >? ? ? ? ? ? ?grid_north_pole_latitude: 39.25
>     >? ? ? ? ? ? ?grid_north_pole_longitude: 198
>     >? ? ? ? ? ? ?north_pole_grid_longitude: 0
>     > If I load the .nc file in QGIS I see that the SR is "+proj=longlat
>     > +a=6371229 +b=6371229 +no_defs" where the values associated to *a* and
>     > *b* variables
>     > are the earth radius. Even if QGIS can read it, the raw file isn't
>     > projected properly (it seems tha QGIS is not able to handle such
>     > projection).
>     > Finally, using the ncdf4+raster libraries, I can easily generate e
>     raster
>     > image but then I'm not able to understand I could I re project
>     this raster
>     > in WGS84 reference system.
>     > Any helps?
>     > Cheers
>     >
>     > --
>     > Maurizio Marchi,
>     > PhD Forest Science - Ecological Mathematics
>     > Skype ID: maurizioxyz
>     > linux user 552742
>     > #EUFGIS national Focal point for Italy
>     > #Annals of Silvicultural Research Associated Editor
>     > https://scholar.google.it/citations?hl=en&user=_2X6fu8AAAAJ
>     > <https://scholar.google.it/citations?hl=en&user=_2X6fu8AAAAJ*>
>     >
>     >? ? ? ?[[alternative HTML version deleted]]
>     >
>     > _______________________________________________
>     > R-sig-Geo mailing list
>     > R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
>     > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>     >
> 
>     -- 
>     Edzer Pebesma
>     Institute for Geoinformatics
>     Heisenbergstrasse 2, 48151 Muenster, Germany
>     Phone: +49 251 8333081
> 
>     -------------- next part --------------
>     A non-text attachment was scrubbed...
>     Name: pEpkey.asc
>     Type: application/pgp-keys
>     Size: 2472 bytes
>     Desc: not available
>     URL:
>     <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20190503/34eee3d8/attachment-0001.bin>
> 
> 
>     ------------------------------
> 
>     Subject: Digest Footer
> 
>     _______________________________________________
>     R-sig-Geo mailing list
>     R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
>     https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 
> 
>     ------------------------------
> 
>     End of R-sig-Geo Digest, Vol 189, Issue 3
>     *****************************************
> 

-- 
Edzer Pebesma
Institute for Geoinformatics
Heisenbergstrasse 2, 48151 Muenster, Germany
Phone: +49 251 8333081

-------------- next part --------------
A non-text attachment was scrubbed...
Name: pEpkey.asc
Type: application/pgp-keys
Size: 2472 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20190504/84a5b659/attachment.bin>

From m@ur|z|om@rch|85 @end|ng |rom gm@||@com  Sat May  4 19:24:26 2019
From: m@ur|z|om@rch|85 @end|ng |rom gm@||@com (Maurizio Marchi)
Date: Sat, 4 May 2019 19:24:26 +0200
Subject: [R-sig-Geo] R-sig-Geo Digest, Vol 189, Issue 3
In-Reply-To: <693dbaec-021e-bb9e-3f02-bf567f32d6c3@uni-muenster.de>
References: <mailman.27275.7.1556964537.5757.r-sig-geo@r-project.org>
 <CANJhsN3BQTdVrMqHHwgsUSs4jz-Zpip0SLwJbX_2AMv8w_55wA@mail.gmail.com>
 <693dbaec-021e-bb9e-3f02-bf567f32d6c3@uni-muenster.de>
Message-ID: <CANJhsN1-+h-7kYc2rFJKn4WVVPX-M0GF2GNFx6gq_X2gTV0HWQ@mail.gmail.com>

Thanks, I'll check it out.

Il giorno sab 4 mag 2019 alle 18:40 Edzer Pebesma <
edzer.pebesma at uni-muenster.de> ha scritto:

> The problem might be in the PROJ version; PROJ has seen a lot of
> development the last few years. I'm on
>
> Linking to GEOS 3.7.0, GDAL 2.4.0, PROJ 5.2.0
>
> Since you are on ubuntu, it should be pretty easy to get that too; see
> sf github pages for installing from ppa:ubuntugis-unstable:
> https://github.com/r-spatial/sf
>
> On 5/4/19 5:19 PM, Maurizio Marchi wrote:
> > Dear Prof.
> > Many thanks for your quick reply. Anyway I still have some differences
> > with your output, as well as some errors in the R console. Actually,
> > practically speaking, in my .png plot (attached) the origin of the axes
> > is still in Germany and the left and right borders of the image are
> > still rectilinear.
> >
> > *Here my R output using your code with the sessionInfo() at the end. I
> > hope it helps*
> >
> > R version 3.6.0 (2019-04-26) -- "Planting of a Tree" Copyright (C) 2019
> > The R Foundation for Statistical Computing Platform: x86_64-pc-linux-gnu
> > (64-bit) R is free software and comes with ABSOLUTELY NO WARRANTY. You
> > are welcome to redistribute it under certain conditions. Type
> > 'license()' or 'licence()' for distribution details. Natural language
> > support but running in an English locale R is a collaborative project
> > with many contributors. Type 'contributors()' for more information and
> > 'citation()' on how to cite R or R packages in publications. Type
> > 'demo()' for some demos, 'help()' for on-line help, or 'help.start()'
> > for an HTML browser interface to help. Type 'q()' to quit R. > f =
> > 'tas_rcp85_land-rcm_eur_12km_01_mon_198012-208011.nc
> > <http://tas_rcp85_land-rcm_eur_12km_01_mon_198012-208011.nc>' >
> > library(stars) Loading required package: abind Loading required package:
> > sf Linking to GEOS 3.6.2, GDAL 2.2.3, PROJ 4.9.3 > r = read_ncdf(f,
> > ncsub = cbind(start = c(1, 1, 1, 1), count = c(418, 406, 3, 1)),
> > eps=1e-3) > rx = read_stars(f, proxy = TRUE) # only for the crs! Warning
> > messages: 1: In CPL_read_gdal(as.character(x), as.character(options),
> > as.character(driver), : GDAL Message 1: The dataset has several
> > variables that could be identified as vector fields, but not all share
> > the same primary dimension. Consequently they will be ignored. 2: In
> > CPL_read_gdal(as.character(x), as.character(options),
> > as.character(driver), : GDAL Message 1: dimension #1 (time) is not a
> > Time dimension. 3: In CPL_read_gdal(as.character(x),
> > as.character(options), as.character(driver), : GDAL Message 1: dimension
> > #0 (ensemble_member) is not a Time dimension. > st_crs(r) = st_crs(rx) >
> > r0 = stars:::st_transform_proj.stars(r, 4326) > plot(r0[,,,1], border =
> > NA, axes = TRUE, reset = FALSE) Warning messages: 1: In
> > classInt::classIntervals(na.omit(values), min(nbreaks - 1, n.unq), : N
> > is large, and some styles will run very slowly; sampling imposed 2: In
> > st_is_longlat(x) : bounding box has potentially an invalid value range
> > for longlat data 3: In st_is_longlat(x) : bounding box has potentially
> > an invalid value range for longlat data 4: In st_is_longlat(x) :
> > bounding box has potentially an invalid value range for longlat data 5:
> > In st_is_longlat(x) : bounding box has potentially an invalid value
> > range for longlat data 6: In st_is_longlat(x) : bounding box has
> > potentially an invalid value range for longlat data >
> > library(rnaturalearth) > plot(ne_coastline(returnclass = "sf"), add =
> > TRUE, col = 'orange') Warning message: In
> > plot.sf(ne_coastline(returnclass = "sf"), add = TRUE, col = "orange") :
> > ignoring all but the first attribute > sessionInfo() R version 3.6.0
> > (2019-04-26) Platform: x86_64-pc-linux-gnu (64-bit) Running under:
> > Ubuntu 18.04.2 LTS Matrix products: default BLAS:
> > /usr/lib/x86_64-linux-gnu/blas/libblas.so.3.7.1 LAPACK:
> > /usr/lib/x86_64-linux-gnu/lapack/liblapack.so.3.7.1 locale: [1]
> > LC_CTYPE=en_GB.UTF-8 LC_NUMERIC=C LC_TIME=it_IT.UTF-8
> > LC_COLLATE=en_GB.UTF-8 LC_MONETARY=it_IT.UTF-8 LC_MESSAGES=en_GB.UTF-8
> > [7] LC_PAPER=it_IT.UTF-8 LC_NAME=C LC_ADDRESS=C LC_TELEPHONE=C
> > LC_MEASUREMENT=it_IT.UTF-8 LC_IDENTIFICATION=C attached base packages:
> > [1] stats graphics grDevices utils datasets methods base other attached
> > packages: [1] rnaturalearth_0.1.0 stars_0.3-1 sf_0.7-4 abind_1.4-5
> > loaded via a namespace (and not attached): [1] Rcpp_1.0.1 magrittr_1.5
> > units_0.6-3 tidyselect_0.2.5 lattice_0.20-38 R6_2.4.0 rlang_0.3.4 [8]
> > rnaturalearthdata_0.2.0 dplyr_0.8.0.1 tools_3.6.0 parallel_3.6.0
> > grid_3.6.0 KernSmooth_2.23-15 ncmeta_0.0.4 [15] e1071_1.7-1 DBI_1.0.0
> > class_7.3-15 assertthat_0.2.1 tibble_2.1.1 RNetCDF_1.9-1 crayon_1.3.4
> > [22] tidyr_0.8.3 purrr_0.3.2 PCICt_0.5-4.1 glue_1.3.1 sp_1.3-1
> > compiler_3.6.0 pillar_1.3.1 [29] classInt_0.3-3 pkgconfig_2.0.2
> >
> >
> > --
> > Maurizio Marchi,
> > PhD Forest Science - Ecological Mathematics
> > Skype ID: maurizioxyz
> > linux user 552742
> > #EUFGIS national Focal point for Italy
> > #Annals of Silvicultural Research Associated Editor
> > https://scholar.google.it/citations?hl=en&user=_2X6fu8AAAAJ
> > <https://scholar.google.it/citations?hl=en&user=_2X6fu8AAAAJ*>
> >
> >
> >
> >
> > Il giorno sab 4 mag 2019 alle ore 12:10 <r-sig-geo-request at r-project.org
> > <mailto:r-sig-geo-request at r-project.org>> ha scritto:
> >
> >     Send R-sig-Geo mailing list submissions to
> >             r-sig-geo at r-project.org <mailto:r-sig-geo at r-project.org>
> >
> >     To subscribe or unsubscribe via the World Wide Web, visit
> >             https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >     or, via email, send a message with subject or body 'help' to
> >             r-sig-geo-request at r-project.org
> >     <mailto:r-sig-geo-request at r-project.org>
> >
> >     You can reach the person managing the list at
> >             r-sig-geo-owner at r-project.org
> >     <mailto:r-sig-geo-owner at r-project.org>
> >
> >     When replying, please edit your Subject line so it is more specific
> >     than "Re: Contents of R-sig-Geo digest..."
> >
> >
> >     Today's Topics:
> >
> >        1. Re: Strange spatial reference system netCDF (Edzer Pebesma)
> >
> >
>  ----------------------------------------------------------------------
> >
> >     Message: 1
> >     Date: Fri, 3 May 2019 16:58:01 +0200
> >     From: Edzer Pebesma <edzer.pebesma at uni-muenster.de
> >     <mailto:edzer.pebesma at uni-muenster.de>>
> >     To: r-sig-geo at r-project.org <mailto:r-sig-geo at r-project.org>
> >     Subject: Re: [R-sig-Geo] Strange spatial reference system netCDF
> >     Message-ID: <82193e8b-8fcc-3308-7874-a22ae6985c01 at uni-muenster.de
> >     <mailto:82193e8b-8fcc-3308-7874-a22ae6985c01 at uni-muenster.de>>
> >     Content-Type: text/plain; charset="utf-8"
> >
> >     Dear Maurizio,
> >
> >     an attempt to do something along this line is:
> >
> >     f = "tas_rcp85_land-rcm_eur_12km_01_mon_198012-208011.nc
> >     <http://tas_rcp85_land-rcm_eur_12km_01_mon_198012-208011.nc>"
> >     library(stars)
> >     r = read_ncdf(f, ncsub = cbind(start = c(1, 1, 1, 1), count = c(418,
> >     406, 3, 1)), eps=1e-3)
> >     rx = read_stars(f, proxy = TRUE) # only for the crs!
> >     st_crs(r) = st_crs(rx)
> >     r0 = stars:::st_transform_proj.stars(r, 4326)
> >     png("x.png")
> >     plot(r0[,,,1], border = NA, axes = TRUE, reset = FALSE)
> >     library(rnaturalearth)
> >     plot(ne_coastline(returnclass = "sf"), add = TRUE, col = 'orange')
> >
> >     Note that the output object time stamps respect the 360-day calendar
> >     (using pkg PCICt).
> >
> >     You'll find some discussion, and the output image, here:
> >     https://github.com/r-spatial/stars/issues/175
> >
> >     Feel free to post follow-up questions here, or to github.
> >
> >     On 5/2/19 6:49 PM, Maurizio Marchi wrote:
> >     > Dear list,
> >     > I'm working with large netCDF files from the UK Climate
> >     Projections portal (
> >     > https://www.metoffice.gov.uk/research/collaboration/ukcp). More in
> >     detail
> >     > I'm reading with the ncdf4 library this
> >     >
> >     <
> http://data.ceda.ac.uk/badc/ukcp18/data/land-rcm/eur/12km/rcp85/01/tas/mon/latest/
> >
> >     > file. Once loaded O can easily handle it but it is a strange
> reference
> >     > system as follow:
> >     > rotated_latitude_longitude[]
> >     >             grid_mapping_name: rotated_latitude_longitude
> >     >             longitude_of_prime_meridian: 0
> >     >             earth_radius: *6371229*
> >     >             grid_north_pole_latitude: 39.25
> >     >             grid_north_pole_longitude: 198
> >     >             north_pole_grid_longitude: 0
> >     > If I load the .nc file in QGIS I see that the SR is "+proj=longlat
> >     > +a=6371229 +b=6371229 +no_defs" where the values associated to *a*
> and
> >     > *b* variables
> >     > are the earth radius. Even if QGIS can read it, the raw file isn't
> >     > projected properly (it seems tha QGIS is not able to handle such
> >     > projection).
> >     > Finally, using the ncdf4+raster libraries, I can easily generate e
> >     raster
> >     > image but then I'm not able to understand I could I re project
> >     this raster
> >     > in WGS84 reference system.
> >     > Any helps?
> >     > Cheers
> >     >
> >     > --
> >     > Maurizio Marchi,
> >     > PhD Forest Science - Ecological Mathematics
> >     > Skype ID: maurizioxyz
> >     > linux user 552742
> >     > #EUFGIS national Focal point for Italy
> >     > #Annals of Silvicultural Research Associated Editor
> >     > https://scholar.google.it/citations?hl=en&user=_2X6fu8AAAAJ
> >     > <https://scholar.google.it/citations?hl=en&user=_2X6fu8AAAAJ*>
> >     >
> >     >       [[alternative HTML version deleted]]
> >     >
> >     > _______________________________________________
> >     > R-sig-Geo mailing list
> >     > R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
> >     > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >     >
> >
> >     --
> >     Edzer Pebesma
> >     Institute for Geoinformatics
> >     Heisenbergstrasse 2, 48151 Muenster, Germany
> >     Phone: +49 251 8333081
> >
> >     -------------- next part --------------
> >     A non-text attachment was scrubbed...
> >     Name: pEpkey.asc
> >     Type: application/pgp-keys
> >     Size: 2472 bytes
> >     Desc: not available
> >     URL:
> >     <
> https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20190503/34eee3d8/attachment-0001.bin
> >
> >
> >
> >     ------------------------------
> >
> >     Subject: Digest Footer
> >
> >     _______________________________________________
> >     R-sig-Geo mailing list
> >     R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
> >     https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
> >
> >     ------------------------------
> >
> >     End of R-sig-Geo Digest, Vol 189, Issue 3
> >     *****************************************
> >
>
> --
> Edzer Pebesma
> Institute for Geoinformatics
> Heisenbergstrasse 2, 48151 Muenster, Germany
> Phone: +49 251 8333081
>
-- 
--
Maurizio Marchi,
PhD Forest Science - Ecological Mathematics
Skype ID: maurizioxyz
linux user 552742
#EUFGIS national Focal point for Italy
#Annals of Silvicultural Research Associated Editor
https://scholar.google.it/citations?hl=en&user=_2X6fu8AAAAJ
<https://scholar.google.it/citations?hl=en&user=_2X6fu8AAAAJ*>

	[[alternative HTML version deleted]]


From r@ph@e|@me@| @end|ng |rom y@hoo@de  Sat May  4 22:22:57 2019
From: r@ph@e|@me@| @end|ng |rom y@hoo@de (Raphael Mesaric)
Date: Sat, 4 May 2019 22:22:57 +0200
Subject: [R-sig-Geo] Question spdep package - lagsarlm not terminating
Message-ID: <A3FBB1AA-29E4-473F-BAA2-803D8558BF37@yahoo.de>

Dear all,

I have a question with regards to the function ?lagsarlm" from the package spdep. My problem is that the function is not terminating. Of course, I have quite a big grid (depending on the selection either 34000 or 60600 entries) and I also have a lot of explanatory variables (about 40). But I am still wondering whether there is something wrong. 

I tried to run a model based on the dataset ?columbus?, and there I did not have any problems (but there are way fever entries and variables). I also compared the format of the required inputs, but everything seemed to be equivalent to the inputs used for the ?columbus? model.

Do you have any idea what might be the reason for the extremely long (respectively infinite, it has not terminated yet) computation time? Any suggestions are greatly appreciated.

If you would like to, I can also upload the corresponding code. However, the code includes some MAT-Files as I got the data in MATLAB. I do not yet attach them here because I read that attachments in another format than PDF are not desired as they may contain malicious software.

Thank you for your help in advance!

Best regards,

Raphael Mesaric

From rv@|@v| @end|ng |rom @tudent@un|me|b@edu@@u  Sun May  5 04:49:26 2019
From: rv@|@v| @end|ng |rom @tudent@un|me|b@edu@@u (Roozbeh Valavi)
Date: Sun, 5 May 2019 12:49:26 +1000
Subject: [R-sig-Geo] Spatial join/intersection in R
In-Reply-To: <CALyPt8x08ZN+TUetdJfE+-1QE5HFNs+ySBjzDwkV9ji_75vGaw@mail.gmail.com>
References: <CAH-s5PNu74AuTXDY3NA00dY_jH9dWgFGbciRub=C3Xoaotk7BA@mail.gmail.com>
 <CALyPt8x08ZN+TUetdJfE+-1QE5HFNs+ySBjzDwkV9ji_75vGaw@mail.gmail.com>
Message-ID: <CAH-s5POTgcHU1Q4pj5pW_OHji7d5T_x3HEVViUGG0UU2__TQvA@mail.gmail.com>

Thank you for your explanation, Tom.

Let me explain the case clearly.
The point layer is a very dense grid field collection across Great Britain.
I wanted to do spatial cross-validation by specifying each point in one of
the polygons (and assign a group of the polygons to a fold). Since the
points have been sampled on a regular grid they sometimes fall exactly on
the border of the polygons. If I use any sort of intersection or spatial
join, the points on the borders cause a problem.

Currently, I use st_jitter() in sf package give a bit of randomness to the
points. I wanted to see if there is another systematic way to avoid this.

Thanks,
Roozbeh

PhD Candidate
The Quantitative & Applied Ecology Group <http://qaeco.com/>
School of BioSciences | Faculty of Science
The University of Melbourne, VIC 3010, Australia
M: +61 423 283 238  E: rvalavi at student.unimelb.edu.au


On Wed, May 1, 2019 at 3:16 PM Tom Philippi <tephilippi at gmail.com> wrote:

> Roozbeh--
>
> What do you want to have happen with those points? Given the units in your
> figure, you could unambiguously assign them to the upper-right by adding a
> small value (0.000001) to both the X and Y coordinates of your points.
> Whether that is a sensible thing to do depends on what your data are.
>
> How or why do the points fall exactly on your polygon boundaries?  What
> process puts them exactly on the polygon (grid cell) boundaries?  It
> appears your polygon boundaries are a grid at multiples of 0.05, although
> not all potential cells in a rectangle are shown.  Are there many other
> points not on polygon boundaries not shown in your figure, or are points
> only along grid lines?  If the latter, does it make sense to assign them to
> _polygons_ rather than line segments?
>
> If you're doing a sample draw or measuring locations with only a few
> decimal points of accuracy, and generating your polygon boundaries at exact
> multiples of 0.05, then it might make sense to shift all of your points +
> 1/10th of your point location resolution so that their coordinates never
> fall on polygon boundaries.  There _might_ be situations where instead of
> always adding (shifting up and right), you should randomly add or subtract
> in each direction for each point, but I'm stuck viewing this as points in
> sTomample units so I can't think of such a case.
>
> Tom
> .
>
> On Tue, Apr 30, 2019 at 7:18 PM Roozbeh Valavi <
> rvalavi at student.unimelb.edu.au> wrote:
>
>> Dear members,
>>
>> I want to do a spatial join/intersection in R. The problem is that some
>> of my points are lying exactly at the border of the adjacent polygons (see
>> the figure attached). So these points are either falling in both or none of
>> the polygons! Is there any way to avoid this?
>>
>> Thanks in advance.
>> Roozbeh
>>
>>
>> [image: image.png]
>>
>>
>>
>> --
>> *Roozbeh Valavi*
>> PhD Candidate
>> The Quantitative & Applied Ecology Group <http://qaeco.com/>
>> School of BioSciences | Faculty of Science
>> The University of Melbourne, VIC 3010, Australia
>> Mobile: +61 423 283 238
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20190505/b678d62e/attachment.html>

-------------- next part --------------
A non-text attachment was scrubbed...
Name: image.png
Type: image/png
Size: 27322 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20190505/b678d62e/attachment.png>

From m@ur|z|om@rch|85 @end|ng |rom gm@||@com  Sun May  5 15:12:26 2019
From: m@ur|z|om@rch|85 @end|ng |rom gm@||@com (Maurizio Marchi)
Date: Sun, 5 May 2019 15:12:26 +0200
Subject: [R-sig-Geo] Strange spatial reference system netCDF
In-Reply-To: <mailman.27279.3.1557050402.43472.r-sig-geo@r-project.org>
References: <mailman.27279.3.1557050402.43472.r-sig-geo@r-project.org>
Message-ID: <CANJhsN3p+8Xfahzjq-DYeoB=ptvvrhfXOmCg36Mbv_vwfj8mRg@mail.gmail.com>

Great, you were right. After adding the ubuntugis-unstable repository to my
system I got the same setup: Linking to GEOS 3.7.0, GDAL 2.4.0, PROJ 5.2.0
And now everithing is fine!
Thanks a lot
Now I'm working to save this new R object in a new netCDF file but I will
see it on my own, no problem

--
Maurizio Marchi,
PhD Forest Science - Ecological Mathematics
Skype ID: maurizioxyz
linux user 552742
#EUFGIS national Focal point for Italy
#Annals of Silvicultural Research Associated Editor
https://scholar.google.it/citations?hl=en&user=_2X6fu8AAAAJ
<https://scholar.google.it/citations?hl=en&user=_2X6fu8AAAAJ*>

	[[alternative HTML version deleted]]


From Roger@B|v@nd @end|ng |rom nhh@no  Sun May  5 15:21:12 2019
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Sun, 5 May 2019 15:21:12 +0200
Subject: [R-sig-Geo] Question spdep package - lagsarlm not terminating
In-Reply-To: <A3FBB1AA-29E4-473F-BAA2-803D8558BF37@yahoo.de>
References: <A3FBB1AA-29E4-473F-BAA2-803D8558BF37@yahoo.de>
Message-ID: <alpine.LFD.2.21.1905051502310.20318@reclus.nhh.no>

On Sat, 4 May 2019, Raphael Mesaric via R-sig-Geo wrote:

> Dear all,
>
> I have a question with regards to the function ?lagsarlm" from the 
> package spdep. My problem is that the function is not terminating. Of 
> course, I have quite a big grid (depending on the selection either 34000 
> or 60600 entries) and I also have a lot of explanatory variables (about 
> 40). But I am still wondering whether there is something wrong.

If you read the help page (the function is in the spatialreg package and 
will be dropped from spdep shortly), and look at the references (Bivand et 
al. 2013), you will see that the default value if the method= argument is 
"eigen". For small numbers of observations, solving the eigenproblem of a 
dense weights object is not a problem, but becomes demanding on memory as 
n increases. You are using virual memory (and may run out of that too) 
which makes your machine unresponsive. If you choose an alternative 
method, typically "Matrix" for symmetric or similar to symmetric sparse 
weights, or "LU" for asymmetric sparse weights.

> data(house, package="spData")
> dim(house)
[1] 25357    24
> LO_nb
Neighbour list object:
Number of regions: 25357
Number of nonzero links: 74874
Percentage nonzero weights: 0.01164489
Average number of links: 2.952794
> lw <- spdep::nb2listw(LO_nb)
> system.time(res <- spatialreg::lagsarlm(log(price) ~ TLA + frontage + 
+ rooms + yrbuilt, data=house, listw=lw, method="Matrix"))
    user  system elapsed
   0.606   0.011   0.631

so less than 1 second on a standard laptop for similar to symmetric very 
sparse weights and ~ 25000 observations. Less sparse weights take somewhat 
longer. The function does not (maybe yet) prevent users trying to do 
things that are not advisable, because maybe they have 128GB RAM or more, 
and want to use eigenvalues rather than sparse matrix methods.

Hope this clarifies,

Roger

>
> I tried to run a model based on the dataset ?columbus?, and there I did 
> not have any problems (but there are way fever entries and variables). I 
> also compared the format of the required inputs, but everything seemed 
> to be equivalent to the inputs used for the ?columbus? model.
>
> Do you have any idea what might be the reason for the extremely long 
> (respectively infinite, it has not terminated yet) computation time? Any 
> suggestions are greatly appreciated.
>
> If you would like to, I can also upload the corresponding code. However, 
> the code includes some MAT-Files as I got the data in MATLAB. I do not 
> yet attach them here because I read that attachments in another format 
> than PDF are not desired as they may contain malicious software.
>
> Thank you for your help in advance!
>
> Best regards,
>
> Raphael Mesaric
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

From mochud|t|m @end|ng |rom hotm@||@com  Mon May  6 12:22:23 2019
From: mochud|t|m @end|ng |rom hotm@||@com (Tim Pollington)
Date: Mon, 6 May 2019 10:22:23 +0000
Subject: [R-sig-Geo] Mark variograms: 3D(xyt) points + 1D marks
Message-ID: <DB7PR01MB47756CA6E6D7CD3556BA8F73CE300@DB7PR01MB4775.eurprd01.prod.exchangelabs.com>

Dear all,

Are there packages that produce empirical *mark* variograms of 3D data (xyt) with 1D marks? I'm aware of the useful mvstpp package for creating spatial and temporal mark variograms but it doesn't completely fit my data structure.

Thanks, Tim.

	[[alternative HTML version deleted]]


From edzer@pebe@m@ @end|ng |rom un|-muen@ter@de  Mon May  6 12:23:48 2019
From: edzer@pebe@m@ @end|ng |rom un|-muen@ter@de (Edzer Pebesma)
Date: Mon, 6 May 2019 12:23:48 +0200
Subject: [R-sig-Geo] Spatial join/intersection in R
In-Reply-To: <CAH-s5POTgcHU1Q4pj5pW_OHji7d5T_x3HEVViUGG0UU2__TQvA@mail.gmail.com>
References: <CAH-s5PNu74AuTXDY3NA00dY_jH9dWgFGbciRub=C3Xoaotk7BA@mail.gmail.com>
 <CALyPt8x08ZN+TUetdJfE+-1QE5HFNs+ySBjzDwkV9ji_75vGaw@mail.gmail.com>
 <CAH-s5POTgcHU1Q4pj5pW_OHji7d5T_x3HEVViUGG0UU2__TQvA@mail.gmail.com>
Message-ID: <24da036b-84e4-1a65-5afc-4cf37beeab5b@uni-muenster.de>

I guess the problem is that if you represent a regular raster with
polygons, and the polygons won't tell you for points falling on polygon
edges or nodes that they should intersect with only one, rather than
with two (edge) or four (nodes) polygons.

The reprex below shows the difference of doing an intersection of three
points with a raster represented as polygons (at the end), or as a stars
object (begin). The stars object considers only the left and upper edge
and upper-left corner as part of the grid cell; the resulting plot is
attached.

library(stars)
# Loading required package: abind
# Loading required package: sf
# Linking to GEOS 3.7.0, GDAL 2.4.0, PROJ 5.2.0

# create 10 x 10 raster
st_as_stars(matrix(1:100, 10, 10)) %>%
	st_set_dimensions(names = c("x", "y")) %>%
	st_set_dimensions("x", values = 0:9) %>%
	st_set_dimensions("y", values = 9:0) -> r

# three points: at node, edge, and inside cell:
p3 = st_sfc(st_point(c(1,1)), st_point(c(1, 1.5)), st_point(c(1.1, 1.8)))

image(r, axes = TRUE, text_values = TRUE)
plot(p3, col = 'green', add = TRUE)

# query three points:
st_intersects(r, p3, transpose = TRUE)
# Sparse geometry binary predicate list of length 3, where the predicate
was `intersects'
#  1: 82
#  2: 72
#  3: 72

# query three points with same raster as polygons:
st_intersects(p3, st_as_sf(r))
# Sparse geometry binary predicate list of length 3, where the predicate
was `intersects'
#  1: 71, 72, 81, 82
#  2: 71, 72
#  3: 72

# raster does the same as stars:
library(raster)
# Loading required package: sp
extract(as(r, "Raster"), as(p3, "Spatial"))
# [1] 82 72 72


On 5/5/19 4:49 AM, Roozbeh Valavi wrote:
> Thank you for your explanation, Tom.
> 
> Let me explain the case clearly.?
> The point layer is a very dense grid field collection across Great
> Britain. I wanted to do spatial cross-validation by specifying each
> point in one of the polygons (and assign a group of the polygons to a
> fold). Since the points have been sampled on a regular grid they
> sometimes fall exactly on the border of the polygons. If I use any sort
> of intersection or spatial join, the points on the borders cause a problem.?
> 
> Currently, I use st_jitter() in sf package give a bit of randomness to
> the points. I wanted to see if there is another systematic way to avoid
> this.
> 
> Thanks,
> Roozbeh
> 
> PhD Candidate
> The Quantitative & Applied Ecology Group <http://qaeco.com/>
> School of BioSciences | Faculty of Science
> The University of Melbourne,?VIC 3010, Australia
> M: +61 423 283 238? E: rvalavi at student.unimelb.edu.au
> <mailto:rvalavi at student.unimelb.edu.au>
> 
> 
> On Wed, May 1, 2019 at 3:16 PM Tom Philippi <tephilippi at gmail.com
> <mailto:tephilippi at gmail.com>> wrote:
> 
>     Roozbeh--
> 
>     What do you want to have happen with those points? Given the units
>     in your figure, you could unambiguously assign them to the
>     upper-right by adding a small value (0.000001) to both the X and Y
>     coordinates of your points.? Whether that is a sensible thing to do
>     depends on what your data are.
> 
>     How or why do the points fall exactly on your polygon boundaries??
>     What process puts them exactly on the polygon (grid cell)
>     boundaries?? It appears your polygon boundaries are a grid at
>     multiples of 0.05, although not all potential cells in a rectangle
>     are shown.? Are there many other points not on polygon boundaries
>     not shown in your figure, or are points only along grid lines?? If
>     the latter, does it make sense to assign them to _polygons_ rather
>     than line segments?
> 
>     If you're doing a sample draw or measuring locations with only a few
>     decimal points of accuracy, and generating your polygon boundaries
>     at exact multiples of 0.05, then it might make sense to shift all of
>     your points + 1/10th of your point location resolution so that their
>     coordinates never fall on polygon boundaries.? There _might_ be
>     situations where instead of always adding (shifting up and right),
>     you should randomly add or subtract in each direction for each
>     point, but I'm stuck viewing this as points in sTomample units so I
>     can't think of such a case.
> 
>     Tom
>     .??
> 
>     On Tue, Apr 30, 2019 at 7:18 PM Roozbeh Valavi
>     <rvalavi at student.unimelb.edu.au
>     <mailto:rvalavi at student.unimelb.edu.au>> wrote:
> 
>         Dear members,
> 
>         I want to do a spatial join/intersection in R. The problem is
>         that some of my points are lying exactly at the border of the
>         adjacent polygons (see the figure attached). So these points are
>         either falling in both or none of the polygons! Is there any way
>         to avoid this?
> 
>         Thanks in?advance.
>         Roozbeh
> 
> 
>         image.png
> 
> 
> 
>         -- 
>         *Roozbeh Valavi*
>         PhD Candidate
>         The Quantitative & Applied Ecology Group <http://qaeco.com/>
>         School of BioSciences | Faculty of Science
>         The University of Melbourne,?VIC 3010, Australia
>         Mobile: +61 423 283 238
>         _______________________________________________
>         R-sig-Geo mailing list
>         R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
>         https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics
Heisenbergstrasse 2, 48151 Muenster, Germany
Phone: +49 251 8333081

-------------- next part --------------
A non-text attachment was scrubbed...
Name: Rplots.pdf
Type: application/pdf
Size: 5374 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20190506/29fbcd05/attachment.pdf>

-------------- next part --------------
A non-text attachment was scrubbed...
Name: pEpkey.asc
Type: application/pgp-keys
Size: 2472 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20190506/29fbcd05/attachment.bin>

From edzer@pebe@m@ @end|ng |rom un|-muen@ter@de  Mon May  6 13:25:41 2019
From: edzer@pebe@m@ @end|ng |rom un|-muen@ter@de (Edzer Pebesma)
Date: Mon, 6 May 2019 13:25:41 +0200
Subject: [R-sig-Geo] Spatial join/intersection in R
In-Reply-To: <24da036b-84e4-1a65-5afc-4cf37beeab5b@uni-muenster.de>
References: <CAH-s5PNu74AuTXDY3NA00dY_jH9dWgFGbciRub=C3Xoaotk7BA@mail.gmail.com>
 <CALyPt8x08ZN+TUetdJfE+-1QE5HFNs+ySBjzDwkV9ji_75vGaw@mail.gmail.com>
 <CAH-s5POTgcHU1Q4pj5pW_OHji7d5T_x3HEVViUGG0UU2__TQvA@mail.gmail.com>
 <24da036b-84e4-1a65-5afc-4cf37beeab5b@uni-muenster.de>
Message-ID: <9b008624-637b-c92f-ca3b-845166ef5113@uni-muenster.de>



On 5/6/19 12:23 PM, Edzer Pebesma wrote:
> # raster does the same as stars:

That was too quick: raster::extract returns cell values,
stars::st_intersects returns cell indexes. If we fill the raster with
values 100:1 rather than 1:100, we see

library(stars)
# Loading required package: abind
# Loading required package: sf
# Linking to GEOS 3.7.0, GDAL 2.4.0, PROJ 5.2.0

# create 10 x 10 raster
st_as_stars(matrix(100:1, 10, 10)) %>%
	st_set_dimensions(names = c("x", "y")) %>%
	st_set_dimensions("x", values = 0:9) %>%
	st_set_dimensions("y", values = 9:0) -> r

# three points: at node, edge, and inside cell:
p3 = st_sfc(st_point(c(1,1)), st_point(c(1, 1.5)), st_point(c(1.1, 1.8)))

st_intersects(r, p3, transpose = TRUE)
# Sparse geometry binary predicate list of length 3, where the predicate
was `intersects'
#  1: 82
#  2: 72
#  3: 72
library(raster)
# Loading required package: sp
extract(as(r, "Raster"), as(p3, "Spatial"))
# [1] 19 29 29


-- 
Edzer Pebesma
Institute for Geoinformatics
Heisenbergstrasse 2, 48151 Muenster, Germany
Phone: +49 251 8333081

-------------- next part --------------
A non-text attachment was scrubbed...
Name: pEpkey.asc
Type: application/pgp-keys
Size: 2472 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20190506/e10ceac9/attachment.bin>

From r@ph@e|@me@| @end|ng |rom y@hoo@de  Mon May  6 16:35:44 2019
From: r@ph@e|@me@| @end|ng |rom y@hoo@de (Raphael Mesaric)
Date: Mon, 6 May 2019 16:35:44 +0200
Subject: [R-sig-Geo] Fwd: Question spdep package - lagsarlm not terminating
References: <41688C39-FA34-4EB7-82A4-4580F4D953EA@yahoo.de>
Message-ID: <9D41A7FC-A2BE-46AA-B448-73E17948E7B5@yahoo.de>


> Dear Roger,
> 
> Thank you very much for your fast response.
> 
> My weight matrix stems from a rectangular (but not square) grid. So, I think I will have to use the ?LU? method.
> 
> However, by doing that several other error messages popped up. The first one was the following:
> 
> Error in spatialreg::errorsarlm(formula = formula, data = data, listw = listw,  : 
>   NAs in lagged dependent variable
> In addition: Warning messages:
> 1: Function errorsarlm moved to the spatialreg package 
> 2: In lag.listw(listw, y, zero.policy = zero.policy) :
>   NAs in lagged values
> 
> And this happened even though I do actually not have NaN values in my dataset (I removed them in advance). When I completely reload all variables, it works sometimes for a few tries but after a while the error messages pops up again. Do you know why this might happen? And could I theoretically use a dataset with NaN values and the function omits them?
> 
> 
> The second error message was the following:
> 
> Error in solve.default(-(mat), tol.solve = tol.solve) : 
>   system is computationally singular: reciprocal condition number = 2.71727e-26
> 
> I found a reference online (related to glm) that this might be linked to explanatory variables which have a high correlation. Would eliminating some of the variables do the job here as well?
> 
> 
> Then I have two other questions, where I couldn?t find any answers online:
> 
> Is there an option to eliminate specific rows of a nb object? I tried the following command:
> 
> rook234x259_2 <- rook234x259[index], 
> 
> where index is a vector with the row numbers I would like to keep. But this converts the nb to a list object, and there is no list2nb function (as much as I am aware of). And the option ?subset? does not only remove the rows, but also the corresponding cells which leads to a different neighborhood matrix.
> 
> 
> The last question refers to the package spgwr. I would like to run this model as well. The gwr function runs successfully, but when calling the variable where I stored the result, I get the following error message instead of my coefficients:
> 
> Error in abs(coef.se <- xm[, cs.ind, drop = FALSE]) : 
>   non-numeric argument to mathematical function
> In addition: Warning messages:
> 1: In print.gwr(x) : NAs in coefficients dropped
> 2: In cbind(CM, coefficients(x$lm)) :
>   number of rows of result is not a multiple of vector length (arg 2)
> 
> Again, there aren?t any NaN values in my dataset, so I can?t really imagine where the NAs in the coefficients come from.
> 
> 
> Thank you very much for your help!
> 
> Best regards,
> 
> Raphael
> 
> 
>> Am 05.05.2019 um 15:21 schrieb Roger Bivand <Roger.Bivand at nhh.no>:
>> 
>> On Sat, 4 May 2019, Raphael Mesaric via R-sig-Geo wrote:
>> 
>>> Dear all,
>>> 
>>> I have a question with regards to the function ?lagsarlm" from the package spdep. My problem is that the function is not terminating. Of course, I have quite a big grid (depending on the selection either 34000 or 60600 entries) and I also have a lot of explanatory variables (about 40). But I am still wondering whether there is something wrong.
>> 
>> If you read the help page (the function is in the spatialreg package and will be dropped from spdep shortly), and look at the references (Bivand et al. 2013), you will see that the default value if the method= argument is "eigen". For small numbers of observations, solving the eigenproblem of a dense weights object is not a problem, but becomes demanding on memory as n increases. You are using virual memory (and may run out of that too) which makes your machine unresponsive. If you choose an alternative method, typically "Matrix" for symmetric or similar to symmetric sparse weights, or "LU" for asymmetric sparse weights.
>> 
>>> data(house, package="spData")
>>> dim(house)
>> [1] 25357    24
>>> LO_nb
>> Neighbour list object:
>> Number of regions: 25357
>> Number of nonzero links: 74874
>> Percentage nonzero weights: 0.01164489
>> Average number of links: 2.952794
>>> lw <- spdep::nb2listw(LO_nb)
>>> system.time(res <- spatialreg::lagsarlm(log(price) ~ TLA + frontage + 
>> + rooms + yrbuilt, data=house, listw=lw, method="Matrix"))
>>   user  system elapsed
>>  0.606   0.011   0.631
>> 
>> so less than 1 second on a standard laptop for similar to symmetric very sparse weights and ~ 25000 observations. Less sparse weights take somewhat longer. The function does not (maybe yet) prevent users trying to do things that are not advisable, because maybe they have 128GB RAM or more, and want to use eigenvalues rather than sparse matrix methods.
>> 
>> Hope this clarifies,
>> 
>> Roger
>> 
>>> 
>>> I tried to run a model based on the dataset ?columbus?, and there I did not have any problems (but there are way fever entries and variables). I also compared the format of the required inputs, but everything seemed to be equivalent to the inputs used for the ?columbus? model.
>>> 
>>> Do you have any idea what might be the reason for the extremely long (respectively infinite, it has not terminated yet) computation time? Any suggestions are greatly appreciated.
>>> 
>>> If you would like to, I can also upload the corresponding code. However, the code includes some MAT-Files as I got the data in MATLAB. I do not yet attach them here because I read that attachments in another format than PDF are not desired as they may contain malicious software.
>>> 
>>> Thank you for your help in advance!
>>> 
>>> Best regards,
>>> 
>>> Raphael Mesaric
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>> 
>> 
>> -- 
>> Roger Bivand
>> Department of Economics, Norwegian School of Economics,
>> Helleveien 30, N-5045 Bergen, Norway.
>> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
>> https://orcid.org/0000-0003-2392-6140
>> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
> 

	[[alternative HTML version deleted]]


From Roger@B|v@nd @end|ng |rom nhh@no  Mon May  6 17:20:58 2019
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Mon, 6 May 2019 17:20:58 +0200
Subject: [R-sig-Geo] 
 Fwd: Question spdep package - lagsarlm not terminating
In-Reply-To: <9D41A7FC-A2BE-46AA-B448-73E17948E7B5@yahoo.de>
References: <41688C39-FA34-4EB7-82A4-4580F4D953EA@yahoo.de>
 <9D41A7FC-A2BE-46AA-B448-73E17948E7B5@yahoo.de>
Message-ID: <alpine.LFD.2.21.1905061659070.17453@reclus.nhh.no>

On Mon, 6 May 2019, Raphael Mesaric via R-sig-Geo wrote:

>
>> Dear Roger,
>>
>> Thank you very much for your fast response.
>>
>> My weight matrix stems from a rectangular (but not square) grid. So, I 
>> think I will have to use the ?LU? method.

No, this is a misunderstanding. All weights matrices used for fitting 
models are square nxn matrices by definition. If your grid had r rows and 
c columns, n = r * c, and the weights matrix has n rows and n columns.

>>
>> However, by doing that several other error messages popped up. The 
>> first one was the following:
>>
>> Error in spatialreg::errorsarlm(formula = formula, data = data, listw = 
>> listw, :
>>   NAs in lagged dependent variable
>> In addition: Warning messages:
>> 1: Function errorsarlm moved to the spatialreg package
>> 2: In lag.listw(listw, y, zero.policy = zero.policy) :
>>   NAs in lagged values
>>
>> And this happened even though I do actually not have NaN values in my 
>> dataset (I removed them in advance). When I completely reload all 
>> variables, it works sometimes for a few tries but after a while the 
>> error messages pops up again. Do you know why this might happen? And 
>> could I theoretically use a dataset with NaN values and the function 
>> omits them?
>>

By default, observations with missing values are dropped and the weights 
object is subsetted to match. This may produce no-neighbour observations. 
You can choose to set their spatially lagged values to zero by using 
zero.policy=TRUE, which is the probable cause of your error. It could very 
well be that your weights object itself contains no-neighbour observations 
if not created using spdep::nb2listw() - which will alert you to the 
problem.

>>
>> The second error message was the following:
>>
>> Error in solve.default(-(mat), tol.solve = tol.solve) :
>>   system is computationally singular: reciprocal condition number =
>>   2.71727e-26
>>
>> I found a reference online (related to glm) that this might be linked 
>> to explanatory variables which have a high correlation. Would 
>> eliminating some of the variables do the job here as well?
>>

Please do not use references online (especially if you do not link to 
them). The information you need is in the help page, referring to the 
tol.solve= argument. Indeed, your covariates are scaled such that their 
are either colinear (unlikely), or that the numerical values of the 
coefficient variances are very different from the spatial coefficient. You 
may need to re-scale the response or covariates in order to invert the 
matrix needed to yield the variances of the coefficients.

>>
>> Then I have two other questions, where I couldn?t find any answers 
>> online:
>>
>> Is there an option to eliminate specific rows of a nb object? I tried 
>> the following command:
>>
>> rook234x259_2 <- rook234x259[index],

spdep::subset.nb() only. Your suggestion only creates a big mess, as 
subsetting reduces the number of rows, and neighbours are indexed between 
1 and n. Consequently, at least some of the remaining vectors will point 
to neighbours with ids > n, and many of the others will point to the wrong 
neighbours. You can convert to a sparse matrix, subset using "[", and then 
convert back, but the subset method should work.

>>
>> where index is a vector with the row numbers I would like to keep. But 
>> this converts the nb to a list object, and there is no list2nb function 
>> (as much as I am aware of). And the option ?subset? does not only 
>> remove the rows, but also the corresponding cells which leads to a 
>> different neighborhood matrix.

I do not know what you mean, of course it has to remove links in both 
directions.

>>
>>
>> The last question refers to the package spgwr. I would like to run this 
>> model as well. The gwr function runs successfully, but when calling the 
>> variable where I stored the result, I get the following error message 
>> instead of my coefficients:
>>
>> Error in abs(coef.se <- xm[, cs.ind, drop = FALSE]) :
>>   non-numeric argument to mathematical function
>> In addition: Warning messages:
>> 1: In print.gwr(x) : NAs in coefficients dropped
>> 2: In cbind(CM, coefficients(x$lm)) :
>>   number of rows of result is not a multiple of vector length (arg 2)
>>

I always advise against using GWR for anything other than studies 
exploring its weaknesses - do not use in research or production. Just 
showing the error message without a small reproducible example using a 
built-in data set gives nothing to go on. Does the error occur when using 
print() on a fitted object? Maybe NAs in coefficients 
suggests colinearity in your covariates, possibly after weighting.

>> Again, there aren?t any NaN values in my dataset, so I can?t really 
>> imagine where the NAs in the coefficients come from.

But it is terribly easy to introduce them numerically, so they are coming 
from what you are doing.

Roger

>>
>>
>> Thank you very much for your help!
>>
>> Best regards,
>>
>> Raphael
>>
>>
>>> Am 05.05.2019 um 15:21 schrieb Roger Bivand <Roger.Bivand at nhh.no>:
>>>
>>> On Sat, 4 May 2019, Raphael Mesaric via R-sig-Geo wrote:
>>>
>>>> Dear all,
>>>>
>>>> I have a question with regards to the function ?lagsarlm" from the package spdep. My problem is that the function is not terminating. Of course, I have quite a big grid (depending on the selection either 34000 or 60600 entries) and I also have a lot of explanatory variables (about 40). But I am still wondering whether there is something wrong.
>>>
>>> If you read the help page (the function is in the spatialreg package and will be dropped from spdep shortly), and look at the references (Bivand et al. 2013), you will see that the default value if the method= argument is "eigen". For small numbers of observations, solving the eigenproblem of a dense weights object is not a problem, but becomes demanding on memory as n increases. You are using virual memory (and may run out of that too) which makes your machine unresponsive. If you choose an alternative method, typically "Matrix" for symmetric or similar to symmetric sparse weights, or "LU" for asymmetric sparse weights.
>>>
>>>> data(house, package="spData")
>>>> dim(house)
>>> [1] 25357    24
>>>> LO_nb
>>> Neighbour list object:
>>> Number of regions: 25357
>>> Number of nonzero links: 74874
>>> Percentage nonzero weights: 0.01164489
>>> Average number of links: 2.952794
>>>> lw <- spdep::nb2listw(LO_nb)
>>>> system.time(res <- spatialreg::lagsarlm(log(price) ~ TLA + frontage +
>>> + rooms + yrbuilt, data=house, listw=lw, method="Matrix"))
>>>   user  system elapsed
>>>  0.606   0.011   0.631
>>>
>>> so less than 1 second on a standard laptop for similar to symmetric very sparse weights and ~ 25000 observations. Less sparse weights take somewhat longer. The function does not (maybe yet) prevent users trying to do things that are not advisable, because maybe they have 128GB RAM or more, and want to use eigenvalues rather than sparse matrix methods.
>>>
>>> Hope this clarifies,
>>>
>>> Roger
>>>
>>>>
>>>> I tried to run a model based on the dataset ?columbus?, and there I did not have any problems (but there are way fever entries and variables). I also compared the format of the required inputs, but everything seemed to be equivalent to the inputs used for the ?columbus? model.
>>>>
>>>> Do you have any idea what might be the reason for the extremely long (respectively infinite, it has not terminated yet) computation time? Any suggestions are greatly appreciated.
>>>>
>>>> If you would like to, I can also upload the corresponding code. However, the code includes some MAT-Files as I got the data in MATLAB. I do not yet attach them here because I read that attachments in another format than PDF are not desired as they may contain malicious software.
>>>>
>>>> Thank you for your help in advance!
>>>>
>>>> Best regards,
>>>>
>>>> Raphael Mesaric
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at r-project.org
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>
>>> --
>>> Roger Bivand
>>> Department of Economics, Norwegian School of Economics,
>>> Helleveien 30, N-5045 Bergen, Norway.
>>> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
>>> https://orcid.org/0000-0003-2392-6140
>>> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

From m@r|@e||z@turek @end|ng |rom gm@||@com  Mon May  6 18:15:54 2019
From: m@r|@e||z@turek @end|ng |rom gm@||@com (=?UTF-8?Q?M=C2=AA_Eliza_Turek?=)
Date: Mon, 6 May 2019 13:15:54 -0300
Subject: [R-sig-Geo] error to extract soil grids data
Message-ID: <CAKonnoG3oEW0ubEK04v1Rj=irOamQL9Xz_Lr9+s+YOM_2NUQeA@mail.gmail.com>

Dear all,

 I need to extract texture and bulk density data for Brazil, in order to
convert it to soil hydraulic parameters using PTF functions. I read in soil
grids website that for this kind of evaluation is better to use "tile"
data. How can I perform that? I Couldn't find a manual for that. (I can't
access http://gsif.isric.org/doku.php?id=wiki:tutorial_soilgrid).
Also, I am starting to use soil grids and found an error that seems to be
very easy but it stopped my work. It seems to be something referent to the
tiff image. I am trying to use the following code, but after the last
command I get the error: Error in .local(.Object, ...) :
 MissingRequired:TIFF directory is missing required "StripByteCounts" field

Can anyone help me? Thank you!

> # SoilGrids tutorial
> # Reference: [http://gsif.isric.org/doku.php?id=wiki:tutorial_soilgrids]
> # Tom.Hengl at isric.org
> rm(list=ls())
> library(RCurl)
Loading required package: bitops
> library(rgdal)
Loading required package: sp
rgdal: version: 1.4-3, (SVN revision 828)
 Geospatial Data Abstraction Library extensions to R successfully loaded
 Loaded GDAL runtime: GDAL 2.2.3, released 2017/11/20
 Path to GDAL shared files:
C:/Users/User/Documents/R/win-library/3.5/rgdal/gdal
 GDAL binary built with GEOS: TRUE
 Loaded PROJ.4 runtime: Rel. 4.9.3, 15 August 2016, [PJ_VERSION: 493]
 Path to PROJ.4 shared files:
C:/Users/User/Documents/R/win-library/3.5/rgdal/proj
 Linking to sp version: 1.3-1
> library(GSIF)
GSIF version 0.5-5 (2019-01-04)
URL: http://gsif.r-forge.r-project.org/
> library(raster)
> library(plotKML)
plotKML version 0.5-9 (2019-01-04)
URL: http://plotkml.r-forge.r-project.org/
> library(XML)
> library(lattice)
> library(aqp)
This is aqp 1.17

Attaching package: ?aqp?

The following objects are masked from ?package:raster?:

    metadata, metadata<-, union

The following object is masked from ?package:base?:

    union

> library(soiltexture)
soiltexture 1.5.1 (git revision: 4b25ba2). For help type:
help(pack='soiltexture')
> ## GDAL paths:
> if(.Platform$OS.type == "windows"){
+   gdal.dir <- shortPathName("C:/Program files/GDAL")
+   gdal_translate <- paste0(gdal.dir, "/gdal_translate.exe")
+   gdalwarp <- paste0(gdal.dir, "/gdalwarp.exe")
+   gdalinfo <- paste0(gdal.dir, "/gdalinfo.exe")
+ } else {
+   gdal_translate = "gdal_translate"
+   gdalwarp = "gdalwarp"
+   gdalinfo = "gdalinfo"
+ }
> ## (a) FTP download:
> ## location of soilgrids:
> sg.ftp <- "ftp://ftp.soilgrids.org/data/recent/"
> filenames = getURL(sg.ftp, ftp.use.epsv = FALSE, dirlistonly = TRUE)
> filenames = strsplit(filenames, "\r*\n")[[1]]
> filenames[1:5]
[1] "ACDWRB_M_ss_250m.tif" "ACDWRB_M_ss_250m.xml" "AWCh1_M_sl1_250m.tif"
"AWCh1_M_sl1_250m.xml" "AWCh1_M_sl2_250m.tif"
> ## download to a local directory:
> ORC.name <- filenames[grep(filenames,
pattern=glob2rx("AWCh2_M_sl2_250m.tif$"))]
> ORC.name
[1] "AWCh2_M_sl2_250m.tif"
> try(download.file(paste(sg.ftp, ORC.name, sep=""), ORC.name))
trying URL 'ftp://ftp.soilgrids.org/data/recent/AWCh2_M_sl2_250m.tif'
downloaded 919.3 MB

> ## check that everything is OK:
> GDALinfo(ORC.name)
Error in .local(.Object, ...) :
  MissingRequired:TIFF directory is missing required "StripByteCounts" field
---------------------------------------------------------------------



-- 
Maria Eliza Turek
PhD Student - Graduate Program of Environmental Engineering  - PPGEA
Federal University of Paran? - UFPR

	[[alternative HTML version deleted]]


From tom@heng| @end|ng |rom gm@||@com  Mon May  6 21:49:39 2019
From: tom@heng| @end|ng |rom gm@||@com (Tomislav Hengl)
Date: Mon, 6 May 2019 21:49:39 +0200
Subject: [R-sig-Geo] error to extract soil grids data
In-Reply-To: <CAKonnoG3oEW0ubEK04v1Rj=irOamQL9Xz_Lr9+s+YOM_2NUQeA@mail.gmail.com>
References: <CAKonnoG3oEW0ubEK04v1Rj=irOamQL9Xz_Lr9+s+YOM_2NUQeA@mail.gmail.com>
Message-ID: <e2b71797-8fba-bd36-5c56-3a2dd082ace7@gmail.com>


Hi Eliza,

The gsif.isric.org tutorials have been migrated to: 
https://envirometrix.github.io/PredictiveSoilMapping/

Soil texture fractions and bulk density you can now download directly 
from e.g.:

https://landgis.opengeohub.org/#/?base=Stamen%20(OpenStreetMap)&center=-12.8118,-54.3164&zoom=5&opacity=80&layer=sol_bulkdens.fineearth_usda.4a1h_m&depth=30

If you need only Brasil, I recommend using the LandGIS Web Coverage 
Service (https://github.com/Envirometrix/LandGISmaps#accessing-data) e.g.:

download.file("https://geoserver.opengeohub.org/landgisgeoserver/ows?service=WCS&version=2.0.1&request=GetCoverage&coverageId=predicted250m:sol_bulkdens.fineearth_usda.4a1h_m_250m_b30..30cm_1950..2017_v0.2&subset=Lat(-34,6)&subset=Long(-74,-28)&scalefactor=0.25", 
"brazil_sol_bulkdens.fineearth_usda.4a1h_m_250m_b30..30cm_1950..2017_v0.2.tif")
#  % Total    % Received % Xferd  Average Speed   Time    Time     Time 
#Current
#                                 Dload  Upload   Total   Spent    Left 
#Speed
#100 25.8M    0 25.8M    0     0  1098k      0 --:--:--  0:00:24 
#--:--:-- 2095k
library(raster)
#Loading required package: sp
plot(raster("brazil_sol_bulkdens.fineearth_usda.4a1h_m_1km_b30..30cm_1950..2017_v0.2.tif"))

Clay content 
(https://maps.opengeohub.org/layers/predicted250m:sol_clay.wfraction_usda.3a1a1a_m_250m_b30..30cm_1950..2017_v0.2) 
and bulk density 
(https://maps.opengeohub.org/layers/predicted250m:sol_bulkdens.fineearth_usda.4a1h_m_250m_b30..30cm_1950..2017_v0.2) 
are also available via our Geonode.

Having said all this, we have recently derived soil hydraulic parameters 
(water content at various suction pressures) for whole world directly 
from lab data hence without using any PTF (read more in: 
https://twitter.com/opengeohub/status/1115317556343181312), including 
the available water capacity (https://doi.org/10.5281/zenodo.2629148). 
Which soil hydraulic parameters are you aiming at? Will be curious to 
learn from you if any of these layers / instructions help you (please 
send a private message).

HTH,

Tom Hengl
https://opengeohub.org/about


On 5/6/19 6:15 PM, M? Eliza Turek wrote:
> Dear all,
> 
>   I need to extract texture and bulk density data for Brazil, in order to
> convert it to soil hydraulic parameters using PTF functions. I read in soil
> grids website that for this kind of evaluation is better to use "tile"
> data. How can I perform that? I Couldn't find a manual for that. (I can't
> access http://gsif.isric.org/doku.php?id=wiki:tutorial_soilgrid).
> Also, I am starting to use soil grids and found an error that seems to be
> very easy but it stopped my work. It seems to be something referent to the
> tiff image. I am trying to use the following code, but after the last
> command I get the error: Error in .local(.Object, ...) :
>   MissingRequired:TIFF directory is missing required "StripByteCounts" field
> 
> Can anyone help me? Thank you!
> 
>> # SoilGrids tutorial
>> # Reference: [http://gsif.isric.org/doku.php?id=wiki:tutorial_soilgrids]
>> # Tom.Hengl at isric.org
>> rm(list=ls())
>> library(RCurl)
> Loading required package: bitops
>> library(rgdal)
> Loading required package: sp
> rgdal: version: 1.4-3, (SVN revision 828)
>   Geospatial Data Abstraction Library extensions to R successfully loaded
>   Loaded GDAL runtime: GDAL 2.2.3, released 2017/11/20
>   Path to GDAL shared files:
> C:/Users/User/Documents/R/win-library/3.5/rgdal/gdal
>   GDAL binary built with GEOS: TRUE
>   Loaded PROJ.4 runtime: Rel. 4.9.3, 15 August 2016, [PJ_VERSION: 493]
>   Path to PROJ.4 shared files:
> C:/Users/User/Documents/R/win-library/3.5/rgdal/proj
>   Linking to sp version: 1.3-1
>> library(GSIF)
> GSIF version 0.5-5 (2019-01-04)
> URL: http://gsif.r-forge.r-project.org/
>> library(raster)
>> library(plotKML)
> plotKML version 0.5-9 (2019-01-04)
> URL: http://plotkml.r-forge.r-project.org/
>> library(XML)
>> library(lattice)
>> library(aqp)
> This is aqp 1.17
> 
> Attaching package: ?aqp?
> 
> The following objects are masked from ?package:raster?:
> 
>      metadata, metadata<-, union
> 
> The following object is masked from ?package:base?:
> 
>      union
> 
>> library(soiltexture)
> soiltexture 1.5.1 (git revision: 4b25ba2). For help type:
> help(pack='soiltexture')
>> ## GDAL paths:
>> if(.Platform$OS.type == "windows"){
> +   gdal.dir <- shortPathName("C:/Program files/GDAL")
> +   gdal_translate <- paste0(gdal.dir, "/gdal_translate.exe")
> +   gdalwarp <- paste0(gdal.dir, "/gdalwarp.exe")
> +   gdalinfo <- paste0(gdal.dir, "/gdalinfo.exe")
> + } else {
> +   gdal_translate = "gdal_translate"
> +   gdalwarp = "gdalwarp"
> +   gdalinfo = "gdalinfo"
> + }
>> ## (a) FTP download:
>> ## location of soilgrids:
>> sg.ftp <- "ftp://ftp.soilgrids.org/data/recent/"
>> filenames = getURL(sg.ftp, ftp.use.epsv = FALSE, dirlistonly = TRUE)
>> filenames = strsplit(filenames, "\r*\n")[[1]]
>> filenames[1:5]
> [1] "ACDWRB_M_ss_250m.tif" "ACDWRB_M_ss_250m.xml" "AWCh1_M_sl1_250m.tif"
> "AWCh1_M_sl1_250m.xml" "AWCh1_M_sl2_250m.tif"
>> ## download to a local directory:
>> ORC.name <- filenames[grep(filenames,
> pattern=glob2rx("AWCh2_M_sl2_250m.tif$"))]
>> ORC.name
> [1] "AWCh2_M_sl2_250m.tif"
>> try(download.file(paste(sg.ftp, ORC.name, sep=""), ORC.name))
> trying URL 'ftp://ftp.soilgrids.org/data/recent/AWCh2_M_sl2_250m.tif'
> downloaded 919.3 MB
> 
>> ## check that everything is OK:
>> GDALinfo(ORC.name)
> Error in .local(.Object, ...) :
>    MissingRequired:TIFF directory is missing required "StripByteCounts" field
> ---------------------------------------------------------------------
> 
> 
>


From r@ph@e|@me@| @end|ng |rom y@hoo@de  Tue May  7 07:35:00 2019
From: r@ph@e|@me@| @end|ng |rom y@hoo@de (Raphael Mesaric)
Date: Tue, 7 May 2019 07:35:00 +0200
Subject: [R-sig-Geo] Question spdep package - lagsarlm not terminating
In-Reply-To: <alpine.LFD.2.21.1905061659070.17453@reclus.nhh.no>
References: <41688C39-FA34-4EB7-82A4-4580F4D953EA@yahoo.de>
 <9D41A7FC-A2BE-46AA-B448-73E17948E7B5@yahoo.de>
 <alpine.LFD.2.21.1905061659070.17453@reclus.nhh.no>
Message-ID: <CE0FEF5F-D563-459E-965C-6E113CAE8635@yahoo.de>

Dear Roger,

Thank you again for your fast response and the helpful answers and clarifications. I will try to resolve all the issues with your recommendations in the coming days.

Just a few comments here:

I created the listw object by nb2listw() (without any error messages) and set ?zero.policy=TRUE? while calling the function. However, I used the function subset() instead of subset.nb(). I will play around with it a bit and see which works best for me. But it is good to know that observations with missing values are dropped by default and the matrix adjusted.

With regards to your question related to GWR: Yes, the error occurs while printing a fitted object. And I also thought that it might be linked to the collinearity in the covariates, just as it is the case for the error with lagsarlm(). However, if you do not recommend it for any other purposes I will have to discuss its use with my thesis supervisor again.


Have a nice day!

Best regards,

Raphael


> Am 06.05.2019 um 17:20 schrieb Roger Bivand <Roger.Bivand at nhh.no>:
> 
> On Mon, 6 May 2019, Raphael Mesaric via R-sig-Geo wrote:
> 
>> 
>>> Dear Roger,
>>> 
>>> Thank you very much for your fast response.
>>> 
>>> My weight matrix stems from a rectangular (but not square) grid. So, I think I will have to use the ?LU? method.
> 
> No, this is a misunderstanding. All weights matrices used for fitting models are square nxn matrices by definition. If your grid had r rows and c columns, n = r * c, and the weights matrix has n rows and n columns.
> 
>>> 
>>> However, by doing that several other error messages popped up. The first one was the following:
>>> 
>>> Error in spatialreg::errorsarlm(formula = formula, data = data, listw = listw, :
>>>  NAs in lagged dependent variable
>>> In addition: Warning messages:
>>> 1: Function errorsarlm moved to the spatialreg package
>>> 2: In lag.listw(listw, y, zero.policy = zero.policy) :
>>>  NAs in lagged values
>>> 
>>> And this happened even though I do actually not have NaN values in my dataset (I removed them in advance). When I completely reload all variables, it works sometimes for a few tries but after a while the error messages pops up again. Do you know why this might happen? And could I theoretically use a dataset with NaN values and the function omits them?
>>> 
> 
> By default, observations with missing values are dropped and the weights object is subsetted to match. This may produce no-neighbour observations. You can choose to set their spatially lagged values to zero by using zero.policy=TRUE, which is the probable cause of your error. It could very well be that your weights object itself contains no-neighbour observations if not created using spdep::nb2listw() - which will alert you to the problem.
> 
>>> 
>>> The second error message was the following:
>>> 
>>> Error in solve.default(-(mat), tol.solve = tol.solve) :
>>>  system is computationally singular: reciprocal condition number =
>>>  2.71727e-26
>>> 
>>> I found a reference online (related to glm) that this might be linked to explanatory variables which have a high correlation. Would eliminating some of the variables do the job here as well?
>>> 
> 
> Please do not use references online (especially if you do not link to them). The information you need is in the help page, referring to the tol.solve= argument. Indeed, your covariates are scaled such that their are either colinear (unlikely), or that the numerical values of the coefficient variances are very different from the spatial coefficient. You may need to re-scale the response or covariates in order to invert the matrix needed to yield the variances of the coefficients.
> 
>>> 
>>> Then I have two other questions, where I couldn?t find any answers online:
>>> 
>>> Is there an option to eliminate specific rows of a nb object? I tried the following command:
>>> 
>>> rook234x259_2 <- rook234x259[index],
> 
> spdep::subset.nb() only. Your suggestion only creates a big mess, as subsetting reduces the number of rows, and neighbours are indexed between 1 and n. Consequently, at least some of the remaining vectors will point to neighbours with ids > n, and many of the others will point to the wrong neighbours. You can convert to a sparse matrix, subset using "[", and then convert back, but the subset method should work.
> 
>>> 
>>> where index is a vector with the row numbers I would like to keep. But this converts the nb to a list object, and there is no list2nb function (as much as I am aware of). And the option ?subset? does not only remove the rows, but also the corresponding cells which leads to a different neighborhood matrix.
> 
> I do not know what you mean, of course it has to remove links in both directions.
> 
>>> 
>>> 
>>> The last question refers to the package spgwr. I would like to run this model as well. The gwr function runs successfully, but when calling the variable where I stored the result, I get the following error message instead of my coefficients:
>>> 
>>> Error in abs(coef.se <http://coef.se/> <- xm[, cs.ind, drop = FALSE]) :
>>>  non-numeric argument to mathematical function
>>> In addition: Warning messages:
>>> 1: In print.gwr(x) : NAs in coefficients dropped
>>> 2: In cbind(CM, coefficients(x$lm)) :
>>>  number of rows of result is not a multiple of vector length (arg 2)
>>> 
> 
> I always advise against using GWR for anything other than studies exploring its weaknesses - do not use in research or production. Just showing the error message without a small reproducible example using a built-in data set gives nothing to go on. Does the error occur when using print() on a fitted object? Maybe NAs in coefficients suggests colinearity in your covariates, possibly after weighting.
> 
>>> Again, there aren?t any NaN values in my dataset, so I can?t really imagine where the NAs in the coefficients come from.
> 
> But it is terribly easy to introduce them numerically, so they are coming from what you are doing.
> 
> Roger
> 
>>> 
>>> 
>>> Thank you very much for your help!
>>> 
>>> Best regards,
>>> 
>>> Raphael
>>> 
>>> 
>>>> Am 05.05.2019 um 15:21 schrieb Roger Bivand <Roger.Bivand at nhh.no>:
>>>> 
>>>> On Sat, 4 May 2019, Raphael Mesaric via R-sig-Geo wrote:
>>>> 
>>>>> Dear all,
>>>>> 
>>>>> I have a question with regards to the function ?lagsarlm" from the package spdep. My problem is that the function is not terminating. Of course, I have quite a big grid (depending on the selection either 34000 or 60600 entries) and I also have a lot of explanatory variables (about 40). But I am still wondering whether there is something wrong.
>>>> 
>>>> If you read the help page (the function is in the spatialreg package and will be dropped from spdep shortly), and look at the references (Bivand et al. 2013), you will see that the default value if the method= argument is "eigen". For small numbers of observations, solving the eigenproblem of a dense weights object is not a problem, but becomes demanding on memory as n increases. You are using virual memory (and may run out of that too) which makes your machine unresponsive. If you choose an alternative method, typically "Matrix" for symmetric or similar to symmetric sparse weights, or "LU" for asymmetric sparse weights.
>>>> 
>>>>> data(house, package="spData")
>>>>> dim(house)
>>>> [1] 25357    24
>>>>> LO_nb
>>>> Neighbour list object:
>>>> Number of regions: 25357
>>>> Number of nonzero links: 74874
>>>> Percentage nonzero weights: 0.01164489
>>>> Average number of links: 2.952794
>>>>> lw <- spdep::nb2listw(LO_nb)
>>>>> system.time(res <- spatialreg::lagsarlm(log(price) ~ TLA + frontage +
>>>> + rooms + yrbuilt, data=house, listw=lw, method="Matrix"))
>>>>  user  system elapsed
>>>> 0.606   0.011   0.631
>>>> 
>>>> so less than 1 second on a standard laptop for similar to symmetric very sparse weights and ~ 25000 observations. Less sparse weights take somewhat longer. The function does not (maybe yet) prevent users trying to do things that are not advisable, because maybe they have 128GB RAM or more, and want to use eigenvalues rather than sparse matrix methods.
>>>> 
>>>> Hope this clarifies,
>>>> 
>>>> Roger
>>>> 
>>>>> 
>>>>> I tried to run a model based on the dataset ?columbus?, and there I did not have any problems (but there are way fever entries and variables). I also compared the format of the required inputs, but everything seemed to be equivalent to the inputs used for the ?columbus? model.
>>>>> 
>>>>> Do you have any idea what might be the reason for the extremely long (respectively infinite, it has not terminated yet) computation time? Any suggestions are greatly appreciated.
>>>>> 
>>>>> If you would like to, I can also upload the corresponding code. However, the code includes some MAT-Files as I got the data in MATLAB. I do not yet attach them here because I read that attachments in another format than PDF are not desired as they may contain malicious software.
>>>>> 
>>>>> Thank you for your help in advance!
>>>>> 
>>>>> Best regards,
>>>>> 
>>>>> Raphael Mesaric
>>>>> _______________________________________________
>>>>> R-sig-Geo mailing list
>>>>> R-sig-Geo at r-project.org
>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>> 
>>>> 
>>>> --
>>>> Roger Bivand
>>>> Department of Economics, Norwegian School of Economics,
>>>> Helleveien 30, N-5045 Bergen, Norway.
>>>> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
>>>> https://orcid.org/0000-0003-2392-6140
>>>> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>>> 
>> 
>> 	[[alternative HTML version deleted]]
>> 
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo <https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
>> 
> 
> -- 
> Roger Bivand
> Department of Economics, Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55 <tel:+47%2055%2095%2093%2055>; e-mail: Roger.Bivand at nhh.no <mailto:Roger.Bivand at nhh.no>
> https://orcid.org/0000-0003-2392-6140 <https://orcid.org/0000-0003-2392-6140>
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en <https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en>

	[[alternative HTML version deleted]]


From m@rt@@m@ru||no @end|ng |rom gm@||@com  Tue May  7 13:54:18 2019
From: m@rt@@m@ru||no @end|ng |rom gm@||@com (Marta Rufino)
Date: Tue, 7 May 2019 12:54:18 +0100
Subject: [R-sig-Geo] add a field to sf object and point shape in kml
Message-ID: <CAKSASLBkgYfXwVWhPT2FUsTeGnSnqW_Vx8Ffe0kxqBfBvMO_8g@mail.gmail.com>

Hi,

Two very simple question:

1)
What is the best way to add a variable (field) to an sf object?

# For example, if I do:
(a = st_sf(a=1, geom = st_sfc(st_point(0:1))))
# I would expect this would work, and it does, but then it makes some kind
of a nested structure which I cannot work with properly.
# Is this the proper way to add fields or there s another one?
a$b = 2
a
# you can see that the second field is after the geometry, which shows it
is nested.

2)
Can we change the polygon col/fill and point shape/col when exporting sf
obejcts to kml, using the function:
st_write(sf.object, " sf.object  .kml", driver='kml')


Thank you very much in advance,
Best wishes,
M.

------
My first steps in sf: https://rpubs.com/MRufino/488297

	[[alternative HTML version deleted]]


From b|@|ev||@t @end|ng |rom gm@||@com  Tue May  7 14:16:00 2019
From: b|@|ev||@t @end|ng |rom gm@||@com (=?UTF-8?Q?Bede-Fazekas_=c3=81kos?=)
Date: Tue, 7 May 2019 14:16:00 +0200
Subject: [R-sig-Geo] add a field to sf object and point shape in kml
In-Reply-To: <CAKSASLBkgYfXwVWhPT2FUsTeGnSnqW_Vx8Ffe0kxqBfBvMO_8g@mail.gmail.com>
References: <CAKSASLBkgYfXwVWhPT2FUsTeGnSnqW_Vx8Ffe0kxqBfBvMO_8g@mail.gmail.com>
Message-ID: <3d50a379-dc30-fe45-0914-5882102a6bd0@gmail.com>

Dear Marta,

I have answer only to your first question.
The way you created the new column (a$b = 2) is correct.
The order of the columns and the place of the geometry column are 
usually not so important, but if you want to rearrange the columns, just 
use one of the following lines:
a <- a[, c(colnames(a)[!(colnames(a) %in% attr(a, "sf_column"))], 
attr(a, "sf_column"))]
a <- st_sf(cbind(st_set_geometry(a, NULL), st_geometry(a)))

HTH,
?kos Bede-Fazekas
Hungarian Academy of Sciences


2019.05.07. 13:54 keltez?ssel, Marta Rufino ?rta:
> Hi,
>
> Two very simple question:
>
> 1)
> What is the best way to add a variable (field) to an sf object?
>
> # For example, if I do:
> (a = st_sf(a=1, geom = st_sfc(st_point(0:1))))
> # I would expect this would work, and it does, but then it makes some kind
> of a nested structure which I cannot work with properly.
> # Is this the proper way to add fields or there s another one?
> a$b = 2
> a
> # you can see that the second field is after the geometry, which shows it
> is nested.
>
> 2)
> Can we change the polygon col/fill and point shape/col when exporting sf
> obejcts to kml, using the function:
> st_write(sf.object, " sf.object  .kml", driver='kml')
>
>
> Thank you very much in advance,
> Best wishes,
> M.
>
> ------
> My first steps in sf: https://rpubs.com/MRufino/488297
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From b@row||ng@on @end|ng |rom gm@||@com  Tue May  7 16:53:16 2019
From: b@row||ng@on @end|ng |rom gm@||@com (Barry Rowlingson)
Date: Tue, 7 May 2019 15:53:16 +0100
Subject: [R-sig-Geo] add a field to sf object and point shape in kml
In-Reply-To: <CAKSASLBkgYfXwVWhPT2FUsTeGnSnqW_Vx8Ffe0kxqBfBvMO_8g@mail.gmail.com>
References: <CAKSASLBkgYfXwVWhPT2FUsTeGnSnqW_Vx8Ffe0kxqBfBvMO_8g@mail.gmail.com>
Message-ID: <CANVKczMZfqpxm=xcJT7e5DU=Vgd5JDpyy7Zq-K+OLr7QHBwY0g@mail.gmail.com>

On Tue, May 7, 2019 at 12:54 PM Marta Rufino <marta.m.rufino at gmail.com>
wrote:

> Hi,
>
> Two very simple question:
>
> 1)
> What is the best way to add a variable (field) to an sf object?
>
> # For example, if I do:
> (a = st_sf(a=1, geom = st_sfc(st_point(0:1))))
> # I would expect this would work, and it does, but then it makes some kind
> of a nested structure which I cannot work with properly.
>

What you've got there is an "sf data frame":

 > a = st_sf(a=1, geom = st_sfc(st_point(0:1)))
 > class(a)
 [1] "sf"         "data.frame"

 I'm not sure why you think its a "nested structure" - it mostly works like
a data frame but with a special column (called `geom`) that stores geometry
objects.


# Is this the proper way to add fields or there s another one?
> a$b = 2
>

that's how you add columns to a plain data frame, so that's how you add
columns to an sf data frame!


> a
> # you can see that the second field is after the geometry, which shows it
> is nested.
>
>  column order is irrelevant in plain data frames, so its irrelevant in sf
data frames!  The geometry can come first if you want:

 > a[,c("geom","a")]

is an equally valid sf data frame.

Strictly you should use the `st_geometry` function to get the geometry
column of an sf data frame, since it could be called `geom`, `geometry`,
`the_geom`, or anything really. For example:

copy the geom column to a new column (standard data frame ops)

a$foo = a$geom

tell `a` its geometry is in the `foo` column:

st_geometry(a) = "foo"

delete the `geom` column (standard data frame op)

a$geom=NULL

and now:

> a
Simple feature collection with 1 feature and 1 field
geometry type:  POINT
dimension:      XY
bbox:           xmin: 0 ymin: 1 xmax: 0 ymax: 1
epsg (SRID):    NA
proj4string:    NA
  a         foo
1 1 POINT (0 1)

now `a` is an sf data frame with a geometry column called `foo`.



> 2)
> Can we change the polygon col/fill and point shape/col when exporting sf
> obejcts to kml, using the function:
> st_write(sf.object, " sf.object  .kml", driver='kml')
>
>
Hmmm not sure. What do you get if you try and read a KML with those
attributes set?



>
> Thank you very much in advance,
> Best wishes,
> M.
>
> ------
> My first steps in sf: https://rpubs.com/MRufino/488297
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From b@row||ng@on @end|ng |rom gm@||@com  Tue May  7 17:06:58 2019
From: b@row||ng@on @end|ng |rom gm@||@com (Barry Rowlingson)
Date: Tue, 7 May 2019 16:06:58 +0100
Subject: [R-sig-Geo] add a field to sf object and point shape in kml
In-Reply-To: <CAKSASLBkgYfXwVWhPT2FUsTeGnSnqW_Vx8Ffe0kxqBfBvMO_8g@mail.gmail.com>
References: <CAKSASLBkgYfXwVWhPT2FUsTeGnSnqW_Vx8Ffe0kxqBfBvMO_8g@mail.gmail.com>
Message-ID: <CANVKczMCT1-5fY4ujNm5H3SEXBD9rfw=jerz2iZmOtWqZNMOgg@mail.gmail.com>

On Tue, May 7, 2019 at 12:54 PM Marta Rufino <marta.m.rufino at gmail.com>
wrote:

> Hi,
>
> Two very simple question:
>
> 2)
> Can we change the polygon col/fill and point shape/col when exporting sf
> obejcts to kml, using the function:
> st_write(sf.object, " sf.object  .kml", driver='kml')
>
>
Setting styles for writing KML using GDAL/OGR is described here:

https://gis.stackexchange.com/questions/297494/how-to-style-kml-through-libkml-layer-creation-options

For example I have an sf data frame of Osprey tracking data (as points),
and if I create a new field:


osp$OGR_STYLE="PEN(c:#128020,w:5px)"

and then:

st_write(osp, "/tmp/osp.kml",driver="libkml")

then the features in the KML get written with:

         <LineStyle>
            <color>ff208012</color>
            <width>5</width>
          </LineStyle>

I realise now that "PEN" is probably wrong for point features, but it
should all be explained in the google OGR style docs:

https://www.gdal.org/ogr_feature_style.html

and in the links in that GIS stack exchange question...

Barry

	[[alternative HTML version deleted]]


From v|j@y|u||@ @end|ng |rom gm@||@com  Tue May  7 19:11:18 2019
From: v|j@y|u||@ @end|ng |rom gm@||@com (Vijay Lulla)
Date: Tue, 7 May 2019 13:11:18 -0400
Subject: [R-sig-Geo] add a field to sf object and point shape in kml
In-Reply-To: <CANVKczMCT1-5fY4ujNm5H3SEXBD9rfw=jerz2iZmOtWqZNMOgg@mail.gmail.com>
References: <CAKSASLBkgYfXwVWhPT2FUsTeGnSnqW_Vx8Ffe0kxqBfBvMO_8g@mail.gmail.com>
 <CANVKczMCT1-5fY4ujNm5H3SEXBD9rfw=jerz2iZmOtWqZNMOgg@mail.gmail.com>
Message-ID: <CAKkiGbvuWMVqNSMiN-h0DzxOY5rp4Ruu1yput+-zoARg03USrA@mail.gmail.com>

Good one Barry!  As far as I'm aware sf uses rgdal to write various file
formats and writeOGR has options called dataset_options and layer_options
which are considered experimental.  Do you know if either of these options
can be used instead of creating a new field/attribute for the sf
dataframe?  More importantly, I would like to know your opinion of using
these options vs creating an attribute.
Thanks in advance,
Vijay.

On Tue, May 7, 2019 at 11:07 AM Barry Rowlingson <b.rowlingson at gmail.com>
wrote:

> On Tue, May 7, 2019 at 12:54 PM Marta Rufino <marta.m.rufino at gmail.com>
> wrote:
>
> > Hi,
> >
> > Two very simple question:
> >
> > 2)
> > Can we change the polygon col/fill and point shape/col when exporting sf
> > obejcts to kml, using the function:
> > st_write(sf.object, " sf.object  .kml", driver='kml')
> >
> >
> Setting styles for writing KML using GDAL/OGR is described here:
>
>
> https://gis.stackexchange.com/questions/297494/how-to-style-kml-through-libkml-layer-creation-options
>
> For example I have an sf data frame of Osprey tracking data (as points),
> and if I create a new field:
>
>
> osp$OGR_STYLE="PEN(c:#128020,w:5px)"
>
> and then:
>
> st_write(osp, "/tmp/osp.kml",driver="libkml")
>
> then the features in the KML get written with:
>
>          <LineStyle>
>             <color>ff208012</color>
>             <width>5</width>
>           </LineStyle>
>
> I realise now that "PEN" is probably wrong for point features, but it
> should all be explained in the google OGR style docs:
>
> https://www.gdal.org/ogr_feature_style.html
>
> and in the links in that GIS stack exchange question...
>
> Barry
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From m@rt@@m@ru||no @end|ng |rom gm@||@com  Tue May  7 19:37:52 2019
From: m@rt@@m@ru||no @end|ng |rom gm@||@com (Marta Rufino)
Date: Tue, 7 May 2019 18:37:52 +0100
Subject: [R-sig-Geo] add a field to sf object and point shape in kml
In-Reply-To: <CAKkiGbvuWMVqNSMiN-h0DzxOY5rp4Ruu1yput+-zoARg03USrA@mail.gmail.com>
References: <CAKSASLBkgYfXwVWhPT2FUsTeGnSnqW_Vx8Ffe0kxqBfBvMO_8g@mail.gmail.com>
 <CANVKczMCT1-5fY4ujNm5H3SEXBD9rfw=jerz2iZmOtWqZNMOgg@mail.gmail.com>
 <CAKkiGbvuWMVqNSMiN-h0DzxOY5rp4Ruu1yput+-zoARg03USrA@mail.gmail.com>
Message-ID: <CAKSASLDuLtt+YrXsfSFerDqQKFYxE2CRb4A8M4cb+rc+nZCv0Q@mail.gmail.com>

Hi,

Cool! Thank you for the very quick and efficient reply.

Just remembered an alternative for the kml challenge... using plotKML after
converting it to spatial.

library(plotKML)
plotKML(as(my.sf.file, "Spatial"), colour_scale=SAGA_pal[[1]]) # this
function has a very detailed help with many easy options. This is just an
example...

It is a pity that it still does not work directly with sf objects (hehehe -
Edzer? Tom?) - but this way it is fine.

I am trying to retrieve the issues I found previously with adding fields
this way... if I find it I will report those.

Cheers,
M.


Vijay Lulla <vijaylulla at gmail.com> escreveu no dia ter?a, 7/05/2019 ?(s)
18:11:

> Good one Barry!  As far as I'm aware sf uses rgdal to write various file
> formats and writeOGR has options called dataset_options and layer_options
> which are considered experimental.  Do you know if either of these options
> can be used instead of creating a new field/attribute for the sf
> dataframe?  More importantly, I would like to know your opinion of using
> these options vs creating an attribute.
> Thanks in advance,
> Vijay.
>
> On Tue, May 7, 2019 at 11:07 AM Barry Rowlingson <b.rowlingson at gmail.com>
> wrote:
>
>> On Tue, May 7, 2019 at 12:54 PM Marta Rufino <marta.m.rufino at gmail.com>
>> wrote:
>>
>> > Hi,
>> >
>> > Two very simple question:
>> >
>> > 2)
>> > Can we change the polygon col/fill and point shape/col when exporting sf
>> > obejcts to kml, using the function:
>> > st_write(sf.object, " sf.object  .kml", driver='kml')
>> >
>> >
>> Setting styles for writing KML using GDAL/OGR is described here:
>>
>>
>> https://gis.stackexchange.com/questions/297494/how-to-style-kml-through-libkml-layer-creation-options
>>
>> For example I have an sf data frame of Osprey tracking data (as points),
>> and if I create a new field:
>>
>>
>> osp$OGR_STYLE="PEN(c:#128020,w:5px)"
>>
>> and then:
>>
>> st_write(osp, "/tmp/osp.kml",driver="libkml")
>>
>> then the features in the KML get written with:
>>
>>          <LineStyle>
>>             <color>ff208012</color>
>>             <width>5</width>
>>           </LineStyle>
>>
>> I realise now that "PEN" is probably wrong for point features, but it
>> should all be explained in the google OGR style docs:
>>
>> https://www.gdal.org/ogr_feature_style.html
>>
>> and in the links in that GIS stack exchange question...
>>
>> Barry
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>
>

-- 
Marta M. Rufino (auxiliary researcher)

*____________________________________________________*MARE - Marine and
Environmental Sciences Centre
Faculty of Sciences, University of Lisbon
Campo Grande, 1749-016 Lisboa,
Portugal
Tel: + 351 21 750 00 00, extension: 22576

	[[alternative HTML version deleted]]


From tke|tt @end|ng |rom utex@@@edu  Tue May  7 20:29:48 2019
From: tke|tt @end|ng |rom utex@@@edu (Tim Keitt)
Date: Tue, 7 May 2019 13:29:48 -0500
Subject: [R-sig-Geo] Semi-join?
Message-ID: <CANnL8gqt_caM76GBUyhF233D1VQNab6dxCsXX-jHE+9A9aOHbQ@mail.gmail.com>

I keep finding things that are trivial in sql are not so in R, so perhaps
you can help me out.

What would be the way in the 'sf' package to retain only polygons from one
coverage that intersect points in another coverage? I think that's a
semi-join.

Roughly: 'select a.* from polys a, points b where st_intersects(a.geom,
b.geom)'

Thanks.

THK

-- 
Timothy H. Keitt
Professor of Integrative Biology and
Associate Chair for Undergraduate Education
http://www.keittlab.org/

	[[alternative HTML version deleted]]


From edzer@pebe@m@ @end|ng |rom un|-muen@ter@de  Tue May  7 20:39:32 2019
From: edzer@pebe@m@ @end|ng |rom un|-muen@ter@de (Edzer Pebesma)
Date: Tue, 7 May 2019 20:39:32 +0200
Subject: [R-sig-Geo] Semi-join?
In-Reply-To: <CANnL8gqt_caM76GBUyhF233D1VQNab6dxCsXX-jHE+9A9aOHbQ@mail.gmail.com>
References: <CANnL8gqt_caM76GBUyhF233D1VQNab6dxCsXX-jHE+9A9aOHbQ@mail.gmail.com>
Message-ID: <84318df7-6a5d-ae56-66ca-81bc29638c61@uni-muenster.de>



On 5/7/19 8:29 PM, Tim Keitt wrote:
> I keep finding things that are trivial in sql are not so in R, so perhaps
> you can help me out.
> 
> What would be the way in the 'sf' package to retain only polygons from one
> coverage that intersect points in another coverage? I think that's a
> semi-join.
> 
> Roughly: 'select a.* from polys a, points b where st_intersects(a.geom,
> b.geom)'

a[b,]

# or

st_join(a, b, left = FALSE) # no left join gives you inner join

> 
> Thanks.
> 
> THK
> 

-- 
Edzer Pebesma
Institute for Geoinformatics
Heisenbergstrasse 2, 48151 Muenster, Germany
Phone: +49 251 8333081

-------------- next part --------------
A non-text attachment was scrubbed...
Name: pEpkey.asc
Type: application/pgp-keys
Size: 2472 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20190507/06a9be22/attachment.bin>

From b@row||ng@on @end|ng |rom gm@||@com  Tue May  7 21:23:05 2019
From: b@row||ng@on @end|ng |rom gm@||@com (Barry Rowlingson)
Date: Tue, 7 May 2019 20:23:05 +0100
Subject: [R-sig-Geo] add a field to sf object and point shape in kml
In-Reply-To: <CAKkiGbvuWMVqNSMiN-h0DzxOY5rp4Ruu1yput+-zoARg03USrA@mail.gmail.com>
References: <CAKSASLBkgYfXwVWhPT2FUsTeGnSnqW_Vx8Ffe0kxqBfBvMO_8g@mail.gmail.com>
 <CANVKczMCT1-5fY4ujNm5H3SEXBD9rfw=jerz2iZmOtWqZNMOgg@mail.gmail.com>
 <CAKkiGbvuWMVqNSMiN-h0DzxOY5rp4Ruu1yput+-zoARg03USrA@mail.gmail.com>
Message-ID: <CANVKczN2bYhVHJbuLyU63YBe9cYPYQDc+vE04ZO6+A7gfsBBtw@mail.gmail.com>

On Tue, May 7, 2019 at 6:11 PM Vijay Lulla <vijaylulla at gmail.com> wrote:

> Good one Barry!  As far as I'm aware sf uses rgdal to write various file
> formats and writeOGR has options called dataset_options and layer_options
> which are considered experimental.
>

Not quite - `sf` uses the underlying C/C++ GDAL/OGR library directly. The
`rgdal` package does the same. One doesn't use the other.

To write KML the GDAL/OGR library uses either its "kml" or its "libkml"
driver which is documented here:

https://www.gdal.org/drv_libkml.html

dataset_options and layer_options tend to be single value options per
dataset and per layer - to set something per *feature* is going to need a
lot more information, and having an extra attribute in the feature table
(spatial data frame) seems reasonable.

I've not quite understood all the libkml creation options relating to
styles so there may be an easy way to do it but I don't think the overhead
of an extra column is too much trouble.

Barry



> Do you know if either of these options can be used instead of creating a
> new field/attribute for the sf dataframe?  More importantly, I would like
> to know your opinion of using these options vs creating an attribute.
> Thanks in advance,
> Vijay.
>
> On Tue, May 7, 2019 at 11:07 AM Barry Rowlingson <b.rowlingson at gmail.com>
> wrote:
>
>> On Tue, May 7, 2019 at 12:54 PM Marta Rufino <marta.m.rufino at gmail.com>
>> wrote:
>>
>> > Hi,
>> >
>> > Two very simple question:
>> >
>> > 2)
>> > Can we change the polygon col/fill and point shape/col when exporting sf
>> > obejcts to kml, using the function:
>> > st_write(sf.object, " sf.object  .kml", driver='kml')
>> >
>> >
>> Setting styles for writing KML using GDAL/OGR is described here:
>>
>>
>> https://gis.stackexchange.com/questions/297494/how-to-style-kml-through-libkml-layer-creation-options
>>
>> For example I have an sf data frame of Osprey tracking data (as points),
>> and if I create a new field:
>>
>>
>> osp$OGR_STYLE="PEN(c:#128020,w:5px)"
>>
>> and then:
>>
>> st_write(osp, "/tmp/osp.kml",driver="libkml")
>>
>> then the features in the KML get written with:
>>
>>          <LineStyle>
>>             <color>ff208012</color>
>>             <width>5</width>
>>           </LineStyle>
>>
>> I realise now that "PEN" is probably wrong for point features, but it
>> should all be explained in the google OGR style docs:
>>
>> https://www.gdal.org/ogr_feature_style.html
>>
>> and in the links in that GIS stack exchange question...
>>
>> Barry
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>
>

	[[alternative HTML version deleted]]


From tke|tt @end|ng |rom utex@@@edu  Tue May  7 22:18:08 2019
From: tke|tt @end|ng |rom utex@@@edu (Tim Keitt)
Date: Tue, 7 May 2019 15:18:08 -0500
Subject: [R-sig-Geo] Semi-join?
In-Reply-To: <84318df7-6a5d-ae56-66ca-81bc29638c61@uni-muenster.de>
References: <CANnL8gqt_caM76GBUyhF233D1VQNab6dxCsXX-jHE+9A9aOHbQ@mail.gmail.com>
 <84318df7-6a5d-ae56-66ca-81bc29638c61@uni-muenster.de>
Message-ID: <CANnL8gpAt9Yb6BeSHa8hpw-TJJ30dtz2Ci4f1f6gKs-iT-_1nA@mail.gmail.com>

On Tue, May 7, 2019 at 1:39 PM Edzer Pebesma <edzer.pebesma at uni-muenster.de>
wrote:

>
>
> On 5/7/19 8:29 PM, Tim Keitt wrote:
> > I keep finding things that are trivial in sql are not so in R, so perhaps
> > you can help me out.
> >
> > What would be the way in the 'sf' package to retain only polygons from
> one
> > coverage that intersect points in another coverage? I think that's a
> > semi-join.
> >
> > Roughly: 'select a.* from polys a, points b where st_intersects(a.geom,
> > b.geom)'
>
> a[b,]
>
> # or
>
> st_join(a, b, left = FALSE) # no left join gives you inner join
>

Hmm... tried this and for some reasons it was not giving me what I wanted.
I will investigate.

THK


>
> >
> > Thanks.
> >
> > THK
> >
>
> --
> Edzer Pebesma
> Institute for Geoinformatics
> Heisenbergstrasse 2, 48151 Muenster, Germany
> Phone: +49 251 8333081
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >> This message is from an external sender. Learn more about why this <<
> >> matters at https://links.utexas.edu/rtyclf.                        <<
>


-- 
Timothy H. Keitt
Professor of Integrative Biology and
Associate Chair for Undergraduate Education
http://www.keittlab.org/

	[[alternative HTML version deleted]]


From tke|tt @end|ng |rom utex@@@edu  Tue May  7 22:43:55 2019
From: tke|tt @end|ng |rom utex@@@edu (Tim Keitt)
Date: Tue, 7 May 2019 15:43:55 -0500
Subject: [R-sig-Geo] Semi-join?
In-Reply-To: <CANnL8gpAt9Yb6BeSHa8hpw-TJJ30dtz2Ci4f1f6gKs-iT-_1nA@mail.gmail.com>
References: <CANnL8gqt_caM76GBUyhF233D1VQNab6dxCsXX-jHE+9A9aOHbQ@mail.gmail.com>
 <84318df7-6a5d-ae56-66ca-81bc29638c61@uni-muenster.de>
 <CANnL8gpAt9Yb6BeSHa8hpw-TJJ30dtz2Ci4f1f6gKs-iT-_1nA@mail.gmail.com>
Message-ID: <CANnL8go7-eX789ASCX4X3zt8iuBvdSP1RjO6TL-0N1AJtz2qWg@mail.gmail.com>

Thanks. Works now. It was an issue with map projections.

THK

On Tue, May 7, 2019 at 3:18 PM Tim Keitt <tkeitt at utexas.edu> wrote:

>
>
> On Tue, May 7, 2019 at 1:39 PM Edzer Pebesma <
> edzer.pebesma at uni-muenster.de> wrote:
>
>>
>>
>> On 5/7/19 8:29 PM, Tim Keitt wrote:
>> > I keep finding things that are trivial in sql are not so in R, so
>> perhaps
>> > you can help me out.
>> >
>> > What would be the way in the 'sf' package to retain only polygons from
>> one
>> > coverage that intersect points in another coverage? I think that's a
>> > semi-join.
>> >
>> > Roughly: 'select a.* from polys a, points b where st_intersects(a.geom,
>> > b.geom)'
>>
>> a[b,]
>>
>> # or
>>
>> st_join(a, b, left = FALSE) # no left join gives you inner join
>>
>
> Hmm... tried this and for some reasons it was not giving me what I wanted.
> I will investigate.
>
> THK
>
>
>>
>> >
>> > Thanks.
>> >
>> > THK
>> >
>>
>> --
>> Edzer Pebesma
>> Institute for Geoinformatics
>> Heisenbergstrasse 2, 48151 Muenster, Germany
>> Phone: +49 251 8333081
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> >> This message is from an external sender. Learn more about why this <<
>> >> matters at https://links.utexas.edu/rtyclf.                        <<
>>
>
>
> --
> Timothy H. Keitt
> Professor of Integrative Biology and
> Associate Chair for Undergraduate Education
> http://www.keittlab.org/
>


-- 
Timothy H. Keitt
Professor of Integrative Biology and
Associate Chair for Undergraduate Education
http://www.keittlab.org/

	[[alternative HTML version deleted]]


From v|j@y|u||@ @end|ng |rom gm@||@com  Wed May  8 16:35:38 2019
From: v|j@y|u||@ @end|ng |rom gm@||@com (Vijay Lulla)
Date: Wed, 8 May 2019 10:35:38 -0400
Subject: [R-sig-Geo] add a field to sf object and point shape in kml
In-Reply-To: <CANVKczN2bYhVHJbuLyU63YBe9cYPYQDc+vE04ZO6+A7gfsBBtw@mail.gmail.com>
References: <CAKSASLBkgYfXwVWhPT2FUsTeGnSnqW_Vx8Ffe0kxqBfBvMO_8g@mail.gmail.com>
 <CANVKczMCT1-5fY4ujNm5H3SEXBD9rfw=jerz2iZmOtWqZNMOgg@mail.gmail.com>
 <CAKkiGbvuWMVqNSMiN-h0DzxOY5rp4Ruu1yput+-zoARg03USrA@mail.gmail.com>
 <CANVKczN2bYhVHJbuLyU63YBe9cYPYQDc+vE04ZO6+A7gfsBBtw@mail.gmail.com>
Message-ID: <CAKkiGbtTV7iZW+sO7iS=LaMyCLY1XL7xrRZ44ippagXq9X_+fg@mail.gmail.com>

Thank you, Barry!  Your explanation of how all these various
packages/libraries work is very helpful.  And so is your justification
(explanation?) of styling using extra column vs writeOGR options.
Appreciatively,
Vijay.

On Tue, May 7, 2019 at 3:23 PM Barry Rowlingson <b.rowlingson at gmail.com>
wrote:

>
>
> On Tue, May 7, 2019 at 6:11 PM Vijay Lulla <vijaylulla at gmail.com> wrote:
>
>> Good one Barry!  As far as I'm aware sf uses rgdal to write various file
>> formats and writeOGR has options called dataset_options and layer_options
>> which are considered experimental.
>>
>
> Not quite - `sf` uses the underlying C/C++ GDAL/OGR library directly. The
> `rgdal` package does the same. One doesn't use the other.
>
> To write KML the GDAL/OGR library uses either its "kml" or its "libkml"
> driver which is documented here:
>
> https://www.gdal.org/drv_libkml.html
>
> dataset_options and layer_options tend to be single value options per
> dataset and per layer - to set something per *feature* is going to need a
> lot more information, and having an extra attribute in the feature table
> (spatial data frame) seems reasonable.
>
> I've not quite understood all the libkml creation options relating to
> styles so there may be an easy way to do it but I don't think the overhead
> of an extra column is too much trouble.
>
> Barry
>
>
>
>> Do you know if either of these options can be used instead of creating a
>> new field/attribute for the sf dataframe?  More importantly, I would like
>> to know your opinion of using these options vs creating an attribute.
>> Thanks in advance,
>> Vijay.
>>
>> On Tue, May 7, 2019 at 11:07 AM Barry Rowlingson <b.rowlingson at gmail.com>
>> wrote:
>>
>>> On Tue, May 7, 2019 at 12:54 PM Marta Rufino <marta.m.rufino at gmail.com>
>>> wrote:
>>>
>>> > Hi,
>>> >
>>> > Two very simple question:
>>> >
>>> > 2)
>>> > Can we change the polygon col/fill and point shape/col when exporting
>>> sf
>>> > obejcts to kml, using the function:
>>> > st_write(sf.object, " sf.object  .kml", driver='kml')
>>> >
>>> >
>>> Setting styles for writing KML using GDAL/OGR is described here:
>>>
>>>
>>> https://gis.stackexchange.com/questions/297494/how-to-style-kml-through-libkml-layer-creation-options
>>>
>>> For example I have an sf data frame of Osprey tracking data (as points),
>>> and if I create a new field:
>>>
>>>
>>> osp$OGR_STYLE="PEN(c:#128020,w:5px)"
>>>
>>> and then:
>>>
>>> st_write(osp, "/tmp/osp.kml",driver="libkml")
>>>
>>> then the features in the KML get written with:
>>>
>>>          <LineStyle>
>>>             <color>ff208012</color>
>>>             <width>5</width>
>>>           </LineStyle>
>>>
>>> I realise now that "PEN" is probably wrong for point features, but it
>>> should all be explained in the google OGR style docs:
>>>
>>> https://www.gdal.org/ogr_feature_style.html
>>>
>>> and in the links in that GIS stack exchange question...
>>>
>>> Barry
>>>
>>>         [[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>>
>>

	[[alternative HTML version deleted]]


From mochud|t|m @end|ng |rom hotm@||@com  Fri May 10 12:53:13 2019
From: mochud|t|m @end|ng |rom hotm@||@com (Tim Pollington)
Date: Fri, 10 May 2019 10:53:13 +0000
Subject: [R-sig-Geo] Mark variograms: 3D(xyt) points + 1D marks
In-Reply-To: <DB7PR01MB47756CA6E6D7CD3556BA8F73CE300@DB7PR01MB4775.eurprd01.prod.exchangelabs.com>
References: <DB7PR01MB47756CA6E6D7CD3556BA8F73CE300@DB7PR01MB4775.eurprd01.prod.exchangelabs.com>
Message-ID: <DB7PR01MB47757AACC1CDFE51BC6D2064CE0C0@DB7PR01MB4775.eurprd01.prod.exchangelabs.com>

On reflection please ignore my question. One can't construct an xyt variogram with additional marks as one can't define a proper distance in an xyt space as different units are involved.

	[[alternative HTML version deleted]]


From edzer@pebe@m@ @end|ng |rom un|-muen@ter@de  Fri May 10 14:18:25 2019
From: edzer@pebe@m@ @end|ng |rom un|-muen@ter@de (Edzer Pebesma)
Date: Fri, 10 May 2019 14:18:25 +0200
Subject: [R-sig-Geo] Mark variograms: 3D(xyt) points + 1D marks
In-Reply-To: <DB7PR01MB47757AACC1CDFE51BC6D2064CE0C0@DB7PR01MB4775.eurprd01.prod.exchangelabs.com>
References: <DB7PR01MB47756CA6E6D7CD3556BA8F73CE300@DB7PR01MB4775.eurprd01.prod.exchangelabs.com>
 <DB7PR01MB47757AACC1CDFE51BC6D2064CE0C0@DB7PR01MB4775.eurprd01.prod.exchangelabs.com>
Message-ID: <9caa2cff-9447-2d0f-026a-f02bc9770e57@uni-muenster.de>

No, but you can model them as a function of space and time, see e.g.
https://journal.r-project.org/archive/2016/RJ-2016-014/index.html

On 5/10/19 12:53 PM, Tim Pollington wrote:
> On reflection please ignore my question. One can't construct an xyt variogram with additional marks as one can't define a proper distance in an xyt space as different units are involved.
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics
Heisenbergstrasse 2, 48151 Muenster, Germany
Phone: +49 251 8333081

-------------- next part --------------
A non-text attachment was scrubbed...
Name: pEpkey.asc
Type: application/pgp-keys
Size: 2472 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20190510/dfddae02/attachment.bin>

From mochud|t|m @end|ng |rom hotm@||@com  Sat May 11 18:11:37 2019
From: mochud|t|m @end|ng |rom hotm@||@com (Tim Pollington)
Date: Sat, 11 May 2019 16:11:37 +0000
Subject: [R-sig-Geo] Mark variograms: 3D(xyt) points + 1D marks
In-Reply-To: <9caa2cff-9447-2d0f-026a-f02bc9770e57@uni-muenster.de>
References: <DB7PR01MB47756CA6E6D7CD3556BA8F73CE300@DB7PR01MB4775.eurprd01.prod.exchangelabs.com>
 <DB7PR01MB47757AACC1CDFE51BC6D2064CE0C0@DB7PR01MB4775.eurprd01.prod.exchangelabs.com>,
 <9caa2cff-9447-2d0f-026a-f02bc9770e57@uni-muenster.de>
Message-ID: <DB7PR01MB4775B42EACD9752154996CC7CE0D0@DB7PR01MB4775.eurprd01.prod.exchangelabs.com>

Thank you Edzer for your suggestion however I'm trying to avoid geostatistical methods because my data is disease cases recorded at household locations. Therefore strictly speaking there is not a random field that pervades the space between the households and so I must treat it as a spatiotemporal marked point process instead. I attemping to extend Stoyan et al's mark variograms for ST processes https://www.sciencedirect.com/science/article/pii/S2211675317300696 to my data.

Hopefully I'll have gotten a bit further by July so perhaps I can show you more if you're attending Spatial Statistics in Sitges.

Kind regards,

Tim.
________________________________
From: Edzer Pebesma <edzer.pebesma at uni-muenster.de>
Sent: 10 May 2019 13:18
To: r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] Mark variograms: 3D(xyt) points + 1D marks

No, but you can model them as a function of space and time, see e.g.
https://journal.r-project.org/archive/2016/RJ-2016-014/index.html

On 5/10/19 12:53 PM, Tim Pollington wrote:
> On reflection please ignore my question. One can't construct an xyt variogram with additional marks as one can't define a proper distance in an xyt space as different units are involved.
>
>        [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

--
Edzer Pebesma
Institute for Geoinformatics
Heisenbergstrasse 2, 48151 Muenster, Germany
Phone: +49 251 8333081

	[[alternative HTML version deleted]]


From edzer@pebe@m@ @end|ng |rom un|-muen@ter@de  Sun May 12 22:04:39 2019
From: edzer@pebe@m@ @end|ng |rom un|-muen@ter@de (Edzer Pebesma)
Date: Sun, 12 May 2019 22:04:39 +0200
Subject: [R-sig-Geo] Mark variograms: 3D(xyt) points + 1D marks
In-Reply-To: <DB7PR01MB4775B42EACD9752154996CC7CE0D0@DB7PR01MB4775.eurprd01.prod.exchangelabs.com>
References: <DB7PR01MB47756CA6E6D7CD3556BA8F73CE300@DB7PR01MB4775.eurprd01.prod.exchangelabs.com>
 <DB7PR01MB47757AACC1CDFE51BC6D2064CE0C0@DB7PR01MB4775.eurprd01.prod.exchangelabs.com>
 <9caa2cff-9447-2d0f-026a-f02bc9770e57@uni-muenster.de>
 <DB7PR01MB4775B42EACD9752154996CC7CE0D0@DB7PR01MB4775.eurprd01.prod.exchangelabs.com>
Message-ID: <a3053014-601c-36b7-dbfd-4d7a0fcfcbd9@uni-muenster.de>



On 5/11/19 6:11 PM, Tim Pollington wrote:
> Thank you Edzer for your suggestion however I'm trying to avoid
> geostatistical methods because my data is disease cases recorded at
> household locations. Therefore strictly speaking there is not a random
> field that pervades the space between the households and so I must treat
> it as a spatiotemporal marked point process instead. I attemping to
> extend Stoyan et al's mark variograms for ST
> processes?https://www.sciencedirect.com/science/article/pii/S2211675317300696?to
> my data.?

Regrettably (an ironically, as an associate editor) I have no longer
access to that journal. Did you contact the authors of the paper whether
they have software they're willing to share?

> 
> Hopefully I'll have gotten a bit further by July so perhaps I can show
> you more if you're attending Spatial Statistics in Sitges.

Looking forward to that!

> 
> Kind regards,
> 
> Tim.
> ------------------------------------------------------------------------
> *From:* Edzer Pebesma <edzer.pebesma at uni-muenster.de>
> *Sent:* 10 May 2019 13:18
> *To:* r-sig-geo at r-project.org
> *Subject:* Re: [R-sig-Geo] Mark variograms: 3D(xyt) points + 1D marks
> ?
> No, but you can model them as a function of space and time, see e.g.
> https://journal.r-project.org/archive/2016/RJ-2016-014/index.html
> 
> On 5/10/19 12:53 PM, Tim Pollington wrote:
>> On reflection please ignore my question. One can't construct an xyt variogram with additional marks as one can't define a proper distance in an xyt space as different units are involved.
>> 
>>??????? [[alternative HTML version deleted]]
>> 
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> 
> 
> -- 
> Edzer Pebesma
> Institute for Geoinformatics
> Heisenbergstrasse 2, 48151 Muenster, Germany
> Phone: +49 251 8333081

-- 
Edzer Pebesma
Institute for Geoinformatics
Heisenbergstrasse 2, 48151 Muenster, Germany
Phone: +49 251 8333081

-------------- next part --------------
A non-text attachment was scrubbed...
Name: pEpkey.asc
Type: application/pgp-keys
Size: 2472 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20190512/b4c2dd72/attachment.bin>

From mochud|t|m @end|ng |rom hotm@||@com  Mon May 13 00:43:45 2019
From: mochud|t|m @end|ng |rom hotm@||@com (Tim Pollington)
Date: Sun, 12 May 2019 22:43:45 +0000
Subject: [R-sig-Geo] Mark variograms: 3D(xyt) points + 1D marks
In-Reply-To: <a3053014-601c-36b7-dbfd-4d7a0fcfcbd9@uni-muenster.de>
References: <DB7PR01MB47756CA6E6D7CD3556BA8F73CE300@DB7PR01MB4775.eurprd01.prod.exchangelabs.com>
 <DB7PR01MB47757AACC1CDFE51BC6D2064CE0C0@DB7PR01MB4775.eurprd01.prod.exchangelabs.com>
 <9caa2cff-9447-2d0f-026a-f02bc9770e57@uni-muenster.de>
 <DB7PR01MB4775B42EACD9752154996CC7CE0D0@DB7PR01MB4775.eurprd01.prod.exchangelabs.com>,
 <a3053014-601c-36b7-dbfd-4d7a0fcfcbd9@uni-muenster.de>
Message-ID: <DB7PR01MB47752BA0B4DB63A03860A255CE0E0@DB7PR01MB4775.eurprd01.prod.exchangelabs.com>

They have made spatial and temporal mark variograms (xy space with time as a mark, or 1D time with xy 2D marks, respectively) available via their mvstpp package.
The current problem is that I've just got many cases(points) who share the same location because they come from the same household. That's not so bad as marked pont processes can have coincident space coordinates, just not coincident spacetime coordinates.

However additionally I want to give a time mark not just to their onset but all the time they are infectious for until treatment (since infectivity probably rises during the infection). This would make the xyt space far too crowded. I want to avoid spatial jittering as I fear this will pollute the microscale semivariance which is of interest to me. The way I am trying is aggregating individuals into household units and introducing a fourth dimension C_i to represent total numbers of active cases at that time in hhld_i. My goal is a space-time variogram style plot but as a space-time marked variogram instead: by producing a spatial marked variograms stratified by time lag.

Sent from my mobile

________________________________
From: Edzer Pebesma <edzer.pebesma at uni-muenster.de>
Sent: Sunday, May 12, 2019 9:04:39 PM
To: Tim Pollington; r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] Mark variograms: 3D(xyt) points + 1D marks



On 5/11/19 6:11 PM, Tim Pollington wrote:
> Thank you Edzer for your suggestion however I'm trying to avoid
> geostatistical methods because my data is disease cases recorded at
> household locations. Therefore strictly speaking there is not a random
> field that pervades the space between the households and so I must treat
> it as a spatiotemporal marked point process instead. I attemping to
> extend Stoyan et al's mark variograms for ST
> processes https://www.sciencedirect.com/science/article/pii/S2211675317300696 to
> my data.

Regrettably (an ironically, as an associate editor) I have no longer
access to that journal. Did you contact the authors of the paper whether
they have software they're willing to share?

>
> Hopefully I'll have gotten a bit further by July so perhaps I can show
> you more if you're attending Spatial Statistics in Sitges.

[[elided Hotmail spam]]

>
> Kind regards,
>
> Tim.
> ------------------------------------------------------------------------
> *From:* Edzer Pebesma <edzer.pebesma at uni-muenster.de>
> *Sent:* 10 May 2019 13:18
> *To:* r-sig-geo at r-project.org
> *Subject:* Re: [R-sig-Geo] Mark variograms: 3D(xyt) points + 1D marks
>
> No, but you can model them as a function of space and time, see e.g.
> https://journal.r-project.org/archive/2016/RJ-2016-014/index.html
>
> On 5/10/19 12:53 PM, Tim Pollington wrote:
>> On reflection please ignore my question. One can't construct an xyt variogram with additional marks as one can't define a proper distance in an xyt space as different units are involved.
>>
>>        [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> --
> Edzer Pebesma
> Institute for Geoinformatics
> Heisenbergstrasse 2, 48151 Muenster, Germany
> Phone: +49 251 8333081

--
Edzer Pebesma
Institute for Geoinformatics
Heisenbergstrasse 2, 48151 Muenster, Germany
Phone: +49 251 8333081

	[[alternative HTML version deleted]]


From |r@nce@co@perug|n| @end|ng |rom y@hoo@|t  Thu May 16 14:55:03 2019
From: |r@nce@co@perug|n| @end|ng |rom y@hoo@|t (Francesco Perugini)
Date: Thu, 16 May 2019 12:55:03 +0000 (UTC)
Subject: [R-sig-Geo] sp
References: <1727951547.2361418.1558011303541.ref@mail.yahoo.com>
Message-ID: <1727951547.2361418.1558011303541@mail.yahoo.com>

Dear all,I'm not very familiar with R. 
I'm tying to use this code I've written months ago. At that time it was working but now it is not.
library(sp)library(spdep)example(columbus)
coord <- coordinates(columbus)and get this messageError in (function (classes, fdef, mtable)  : 
  unable to find an inherited method for function ?coordinates? for signature ?"sf"?I've tried to also calllibrary(sf)but got the same error.I was wondering why?Thanks a lot.Francesco



	[[alternative HTML version deleted]]


From Roger@B|v@nd @end|ng |rom nhh@no  Thu May 16 15:07:30 2019
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Thu, 16 May 2019 15:07:30 +0200
Subject: [R-sig-Geo] sp
In-Reply-To: <1727951547.2361418.1558011303541@mail.yahoo.com>
References: <1727951547.2361418.1558011303541.ref@mail.yahoo.com>
 <1727951547.2361418.1558011303541@mail.yahoo.com>
Message-ID: <alpine.LFD.2.21.1905161500170.767@reclus.nhh.no>

Please post in plain text to avoid code mangling. You have not noticed 
that a lot has been happening. First, data sets from spdep have mostly 
been moved to spData. Next, spData mostly uses sf to read and format data. 
Finally you may also see changes as spdep model fitting functions are in 
spatialreg and will shortly be dropped from spdep. In your case:

> library(sp)
> library(spdep)
Loading required package: spData
Loading required package: sf
Linking to GEOS 3.7.2, GDAL 3.0.0, PROJ 6.1.0
> example(columbus)

colmbs> columbus <- st_read(system.file("shapes/columbus.shp", 
package="spData")[1], quiet=TRUE)

colmbs> col.gal.nb <- read.gal(system.file("weights/columbus.gal", 
package="spData")[1])
> coord <- coordinates(columbus)
Error in (function (classes, fdef, mtable)  :
   unable to find an inherited method for function ?coordinates? for 
signature ?"sf"?
> columbus <- as(columbus, "Spatial")
> coord <- coordinates(columbus)

Giving the full output, you can see that example(columbus) reads in the 
data and neighbours from spData, using sf. Consequently, you'd need to 
coerce columbus to an sp class if you do not want to upgrade your 
workflow to sf compatability.

Hope this clarifies,

Roger

On Thu, 16 May 2019, Francesco Perugini via R-sig-Geo wrote:

> Dear all,I'm not very familiar with R.
> I'm tying to use this code I've written months ago. At that time it was 
> working but now it is not.
>> library(sp)
>> library(spdep)
>> example(columbus)
>> coord <- coordinates(columbus)and get this message
> Error in (function (classes, fdef, mtable)  : unable to find an 
> inherited method for function ?coordinates? for signature ?"sf"?
> I've tried to also calllibrary(sf)but got the same error.I was wondering 
> why?
> Thanks a lot.Francesco
>
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

From |r@nce@co@perug|n| @end|ng |rom y@hoo@|t  Thu May 16 15:43:49 2019
From: |r@nce@co@perug|n| @end|ng |rom y@hoo@|t (Francesco Perugini)
Date: Thu, 16 May 2019 13:43:49 +0000 (UTC)
Subject: [R-sig-Geo] sp
In-Reply-To: <alpine.LFD.2.21.1905161500170.767@reclus.nhh.no>
References: <1727951547.2361418.1558011303541.ref@mail.yahoo.com>
 <1727951547.2361418.1558011303541@mail.yahoo.com>
 <alpine.LFD.2.21.1905161500170.767@reclus.nhh.no>
Message-ID: <485941351.2408701.1558014229896@mail.yahoo.com>

 Thanks a lot for the reply Prof. Bivand. It works fine now.
Yes I did not use R since few months.I was wondering why this piece of coding left is not working:
neighbors.knn1 <- knn2nb(knearneigh(coord, 1, longlat=F), sym=F)## Global G? ?
dlwknn1.B <- nb2listw(neighbors.knn1, style="B", zero.policy=TRUE) 
globalG.test(CRIME, dlwknn1.B, zero.policy=F)

Error: object 'CRIME' not found 
Thanks again for your help.Francesco

    Il gioved? 16 maggio 2019, 15:07:37 CEST, Roger Bivand <Roger.Bivand at nhh.no> ha scritto:  
 
 Please post in plain text to avoid code mangling. You have not noticed 
that a lot has been happening. First, data sets from spdep have mostly 
been moved to spData. Next, spData mostly uses sf to read and format data. 
Finally you may also see changes as spdep model fitting functions are in 
spatialreg and will shortly be dropped from spdep. In your case:

> library(sp)
> library(spdep)
Loading required package: spData
Loading required package: sf
Linking to GEOS 3.7.2, GDAL 3.0.0, PROJ 6.1.0
> example(columbus)

colmbs> columbus <- st_read(system.file("shapes/columbus.shp", 
package="spData")[1], quiet=TRUE)

colmbs> col.gal.nb <- read.gal(system.file("weights/columbus.gal", 
package="spData")[1])
> coord <- coordinates(columbus)
Error in (function (classes, fdef, mtable)? :
? unable to find an inherited method for function ?coordinates? for 
signature ?"sf"?
> columbus <- as(columbus, "Spatial")
> coord <- coordinates(columbus)

Giving the full output, you can see that example(columbus) reads in the 
data and neighbours from spData, using sf. Consequently, you'd need to 
coerce columbus to an sp class if you do not want to upgrade your 
workflow to sf compatability.

Hope this clarifies,

Roger

On Thu, 16 May 2019, Francesco Perugini via R-sig-Geo wrote:

> Dear all,I'm not very familiar with R.
> I'm tying to use this code I've written months ago. At that time it was 
> working but now it is not.
>> library(sp)
>> library(spdep)
>> example(columbus)
>> coord <- coordinates(columbus)and get this message
> Error in (function (classes, fdef, mtable)? : unable to find an 
> inherited method for function ?coordinates? for signature ?"sf"?
> I've tried to also calllibrary(sf)but got the same error.I was wondering 
> why?
> Thanks a lot.Francesco
>
>
>
> ??? [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en  
	[[alternative HTML version deleted]]


From Roger@B|v@nd @end|ng |rom nhh@no  Thu May 16 15:47:26 2019
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Thu, 16 May 2019 15:47:26 +0200
Subject: [R-sig-Geo] sp
In-Reply-To: <485941351.2408701.1558014229896@mail.yahoo.com>
References: <1727951547.2361418.1558011303541.ref@mail.yahoo.com>
 <1727951547.2361418.1558011303541@mail.yahoo.com>
 <alpine.LFD.2.21.1905161500170.767@reclus.nhh.no>
 <485941351.2408701.1558014229896@mail.yahoo.com>
Message-ID: <alpine.LFD.2.21.1905161545050.767@reclus.nhh.no>

On Thu, 16 May 2019, Francesco Perugini wrote:

> Thanks a lot for the reply Prof. Bivand. It works fine now. Yes I did 
> not use R since few months.I was wondering why this piece of coding left 
> is not working: neighbors.knn1 <- knn2nb(knearneigh(coord, 1, 
> longlat=F), sym=F)## Global G dlwknn1.B <- nb2listw(neighbors.knn1, 
> style="B", zero.policy=TRUE) globalG.test(CRIME, dlwknn1.B, 
> zero.policy=F)

Note that HTML always mangles code. You have not shown any errors apart 
from:

>
> Error: object 'CRIME' not found

which is self-evident, as ls() in your workspace will show. You would 
always have needed columbus$CRIME to access CRIME.

Roger

> Thanks again for your help.Francesco
>
>    Il gioved? 16 maggio 2019, 15:07:37 CEST, Roger Bivand <Roger.Bivand at nhh.no> ha scritto:
>
> Please post in plain text to avoid code mangling. You have not noticed
> that a lot has been happening. First, data sets from spdep have mostly
> been moved to spData. Next, spData mostly uses sf to read and format data.
> Finally you may also see changes as spdep model fitting functions are in
> spatialreg and will shortly be dropped from spdep. In your case:
>
>> library(sp)
>> library(spdep)
> Loading required package: spData
> Loading required package: sf
> Linking to GEOS 3.7.2, GDAL 3.0.0, PROJ 6.1.0
>> example(columbus)
>
> colmbs> columbus <- st_read(system.file("shapes/columbus.shp",
> package="spData")[1], quiet=TRUE)
>
> colmbs> col.gal.nb <- read.gal(system.file("weights/columbus.gal",
> package="spData")[1])
>> coord <- coordinates(columbus)
> Error in (function (classes, fdef, mtable)? :
> ? unable to find an inherited method for function ?coordinates? for
> signature ?"sf"?
>> columbus <- as(columbus, "Spatial")
>> coord <- coordinates(columbus)
>
> Giving the full output, you can see that example(columbus) reads in the
> data and neighbours from spData, using sf. Consequently, you'd need to
> coerce columbus to an sp class if you do not want to upgrade your
> workflow to sf compatability.
>
> Hope this clarifies,
>
> Roger
>
> On Thu, 16 May 2019, Francesco Perugini via R-sig-Geo wrote:
>
>> Dear all,I'm not very familiar with R.
>> I'm tying to use this code I've written months ago. At that time it was
>> working but now it is not.
>>> library(sp)
>>> library(spdep)
>>> example(columbus)
>>> coord <- coordinates(columbus)and get this message
>> Error in (function (classes, fdef, mtable)? : unable to find an
>> inherited method for function ?coordinates? for signature ?"sf"?
>> I've tried to also calllibrary(sf)but got the same error.I was wondering
>> why?
>> Thanks a lot.Francesco
>>
>>
>>
>> ??? [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

From |r@nce@co@perug|n| @end|ng |rom y@hoo@|t  Thu May 16 16:16:20 2019
From: |r@nce@co@perug|n| @end|ng |rom y@hoo@|t (Francesco Perugini)
Date: Thu, 16 May 2019 14:16:20 +0000 (UTC)
Subject: [R-sig-Geo] sp
In-Reply-To: <alpine.LFD.2.21.1905161545050.767@reclus.nhh.no>
References: <1727951547.2361418.1558011303541.ref@mail.yahoo.com>
 <1727951547.2361418.1558011303541@mail.yahoo.com>
 <alpine.LFD.2.21.1905161500170.767@reclus.nhh.no>
 <485941351.2408701.1558014229896@mail.yahoo.com>
 <alpine.LFD.2.21.1905161545050.767@reclus.nhh.no>
Message-ID: <994790948.2443486.1558016180412@mail.yahoo.com>

 Thnaks a lot Prof. Bivand. 
It works.Francesco

    Il gioved? 16 maggio 2019, 15:47:36 CEST, Roger Bivand <Roger.Bivand at nhh.no> ha scritto:  
 
 On Thu, 16 May 2019, Francesco Perugini wrote:

> Thanks a lot for the reply Prof. Bivand. It works fine now. Yes I did 
> not use R since few months.I was wondering why this piece of coding left 
> is not working: neighbors.knn1 <- knn2nb(knearneigh(coord, 1, 
> longlat=F), sym=F)## Global G dlwknn1.B <- nb2listw(neighbors.knn1, 
> style="B", zero.policy=TRUE) globalG.test(CRIME, dlwknn1.B, 
> zero.policy=F)

Note that HTML always mangles code. You have not shown any errors apart 
from:

>
> Error: object 'CRIME' not found

which is self-evident, as ls() in your workspace will show. You would 
always have needed columbus$CRIME to access CRIME.

Roger

> Thanks again for your help.Francesco
>
>? ? Il gioved? 16 maggio 2019, 15:07:37 CEST, Roger Bivand <Roger.Bivand at nhh.no> ha scritto:
>
> Please post in plain text to avoid code mangling. You have not noticed
> that a lot has been happening. First, data sets from spdep have mostly
> been moved to spData. Next, spData mostly uses sf to read and format data.
> Finally you may also see changes as spdep model fitting functions are in
> spatialreg and will shortly be dropped from spdep. In your case:
>
>> library(sp)
>> library(spdep)
> Loading required package: spData
> Loading required package: sf
> Linking to GEOS 3.7.2, GDAL 3.0.0, PROJ 6.1.0
>> example(columbus)
>
> colmbs> columbus <- st_read(system.file("shapes/columbus.shp",
> package="spData")[1], quiet=TRUE)
>
> colmbs> col.gal.nb <- read.gal(system.file("weights/columbus.gal",
> package="spData")[1])
>> coord <- coordinates(columbus)
> Error in (function (classes, fdef, mtable)? :
> ? unable to find an inherited method for function ?coordinates? for
> signature ?"sf"?
>> columbus <- as(columbus, "Spatial")
>> coord <- coordinates(columbus)
>
> Giving the full output, you can see that example(columbus) reads in the
> data and neighbours from spData, using sf. Consequently, you'd need to
> coerce columbus to an sp class if you do not want to upgrade your
> workflow to sf compatability.
>
> Hope this clarifies,
>
> Roger
>
> On Thu, 16 May 2019, Francesco Perugini via R-sig-Geo wrote:
>
>> Dear all,I'm not very familiar with R.
>> I'm tying to use this code I've written months ago. At that time it was
>> working but now it is not.
>>> library(sp)
>>> library(spdep)
>>> example(columbus)
>>> coord <- coordinates(columbus)and get this message
>> Error in (function (classes, fdef, mtable)? : unable to find an
>> inherited method for function ?coordinates? for signature ?"sf"?
>> I've tried to also calllibrary(sf)but got the same error.I was wondering
>> why?
>> Thanks a lot.Francesco
>>
>>
>>
>> ??? [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en  
	[[alternative HTML version deleted]]


From |r@nce@co@perug|n| @end|ng |rom y@hoo@|t  Thu May 16 18:07:11 2019
From: |r@nce@co@perug|n| @end|ng |rom y@hoo@|t (Francesco Perugini)
Date: Thu, 16 May 2019 16:07:11 +0000 (UTC)
Subject: [R-sig-Geo] sp
In-Reply-To: <alpine.LFD.2.21.1905161545050.767@reclus.nhh.no>
References: <1727951547.2361418.1558011303541.ref@mail.yahoo.com>
 <1727951547.2361418.1558011303541@mail.yahoo.com>
 <alpine.LFD.2.21.1905161500170.767@reclus.nhh.no>
 <485941351.2408701.1558014229896@mail.yahoo.com>
 <alpine.LFD.2.21.1905161545050.767@reclus.nhh.no>
Message-ID: <40397357.2542649.1558022831782@mail.yahoo.com>

 Prof. Bivand,sorry again. I'm trying to update the coding I used.I'm now changing, as suggested, a <- readShapePoly("C:/Users/Francesco pc/Prov2011_WGS84", IDvar="COD_PRO")into
a <- readOGR("C:/Users/Francesco pc/Prov2011_WGS84", IDvar="COD_PRO")
I guess IDvar is not correct. Should that be layer="COD_PRO" ?Thanks a lotFrancesco



    Il gioved? 16 maggio 2019, 15:47:36 CEST, Roger Bivand <Roger.Bivand at nhh.no> ha scritto:  
 
 On Thu, 16 May 2019, Francesco Perugini wrote:

> Thanks a lot for the reply Prof. Bivand. It works fine now. Yes I did 
> not use R since few months.I was wondering why this piece of coding left 
> is not working: neighbors.knn1 <- knn2nb(knearneigh(coord, 1, 
> longlat=F), sym=F)## Global G dlwknn1.B <- nb2listw(neighbors.knn1, 
> style="B", zero.policy=TRUE) globalG.test(CRIME, dlwknn1.B, 
> zero.policy=F)

Note that HTML always mangles code. You have not shown any errors apart 
from:

>
> Error: object 'CRIME' not found

which is self-evident, as ls() in your workspace will show. You would 
always have needed columbus$CRIME to access CRIME.

Roger

> Thanks again for your help.Francesco
>
>? ? Il gioved? 16 maggio 2019, 15:07:37 CEST, Roger Bivand <Roger.Bivand at nhh.no> ha scritto:
>
> Please post in plain text to avoid code mangling. You have not noticed
> that a lot has been happening. First, data sets from spdep have mostly
> been moved to spData. Next, spData mostly uses sf to read and format data.
> Finally you may also see changes as spdep model fitting functions are in
> spatialreg and will shortly be dropped from spdep. In your case:
>
>> library(sp)
>> library(spdep)
> Loading required package: spData
> Loading required package: sf
> Linking to GEOS 3.7.2, GDAL 3.0.0, PROJ 6.1.0
>> example(columbus)
>
> colmbs> columbus <- st_read(system.file("shapes/columbus.shp",
> package="spData")[1], quiet=TRUE)
>
> colmbs> col.gal.nb <- read.gal(system.file("weights/columbus.gal",
> package="spData")[1])
>> coord <- coordinates(columbus)
> Error in (function (classes, fdef, mtable)? :
> ? unable to find an inherited method for function ?coordinates? for
> signature ?"sf"?
>> columbus <- as(columbus, "Spatial")
>> coord <- coordinates(columbus)
>
> Giving the full output, you can see that example(columbus) reads in the
> data and neighbours from spData, using sf. Consequently, you'd need to
> coerce columbus to an sp class if you do not want to upgrade your
> workflow to sf compatability.
>
> Hope this clarifies,
>
> Roger
>
> On Thu, 16 May 2019, Francesco Perugini via R-sig-Geo wrote:
>
>> Dear all,I'm not very familiar with R.
>> I'm tying to use this code I've written months ago. At that time it was
>> working but now it is not.
>>> library(sp)
>>> library(spdep)
>>> example(columbus)
>>> coord <- coordinates(columbus)and get this message
>> Error in (function (classes, fdef, mtable)? : unable to find an
>> inherited method for function ?coordinates? for signature ?"sf"?
>> I've tried to also calllibrary(sf)but got the same error.I was wondering
>> why?
>> Thanks a lot.Francesco
>>
>>
>>
>> ??? [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en  
	[[alternative HTML version deleted]]


From r@ph@e|@me@| @end|ng |rom y@hoo@de  Thu May 16 21:01:09 2019
From: r@ph@e|@me@| @end|ng |rom y@hoo@de (Raphael Mesaric)
Date: Thu, 16 May 2019 21:01:09 +0200
Subject: [R-sig-Geo] Question spdep package - extending nb object
References: <401C126D-5669-4E97-ADA8-9879B42835E3.ref@yahoo.de>
Message-ID: <401C126D-5669-4E97-ADA8-9879B42835E3@yahoo.de>

Dear all,

I am working on a spatial regression model which is built in such a way that the dependent variable consists of n blocks of multiple entries, and each block is referring to the same spatial grid. In order to run the lagsarlm() function or the errsarlm() function, I now need to extend my initial nb object from one grid to n grids. In other words, I need the nb object to be repeated n times. However, so far I did not find a way to do this properly.

I tried to just replicate the nb object by repeating the entries of the neighbours list and the weights list, respectively.

dnn800_3w$neighbours <- rep(dnn800_3w$neighbours,20)
dnn800_3w$weights <- rep(dnn800_3w$weights,20)

When I do this, I get the following error message:

Error in is.symmetric.nb(listw$neighbours, FALSE) : Not neighbours list

Which makes sense, as the matrix is not symmetric any more due to the steps described above. However, I cannot think of a correct implementation at the moment.

Can you help me with this issue? Any suggestions are highly appreciated.

Thank you in advance.

Best regards,

Raphael Mesaric
	[[alternative HTML version deleted]]


From r@ph@e|@me@| @end|ng |rom y@hoo@de  Fri May 17 08:56:13 2019
From: r@ph@e|@me@| @end|ng |rom y@hoo@de (Raphael Mesaric)
Date: Fri, 17 May 2019 08:56:13 +0200
Subject: [R-sig-Geo] Question spgwr package - running time gwr()
References: <18F149CA-2275-405C-A7E2-AC67B2A6F5C3.ref@yahoo.de>
Message-ID: <18F149CA-2275-405C-A7E2-AC67B2A6F5C3@yahoo.de>

Dear all,

Is there an option to shorten the running time for the gwr() function, similar to the ?LU? method for lagsarlm() in the spdep package? Because I have a model with roughly 500?000 observations, and the running time at the moment is quite long, respectively it has not yet terminated.

Thank you for your help in advance.

Best regards,

Raphael Mesaric

From |r@nce@co@perug|n| @end|ng |rom y@hoo@|t  Fri May 17 09:16:30 2019
From: |r@nce@co@perug|n| @end|ng |rom y@hoo@|t (Francesco Perugini)
Date: Fri, 17 May 2019 07:16:30 +0000 (UTC)
Subject: [R-sig-Geo] sp
In-Reply-To: <65D07781-BD93-4AD3-B69C-131AB1863435@bigelow.org>
References: <1727951547.2361418.1558011303541.ref@mail.yahoo.com>
 <1727951547.2361418.1558011303541@mail.yahoo.com>
 <alpine.LFD.2.21.1905161500170.767@reclus.nhh.no>
 <485941351.2408701.1558014229896@mail.yahoo.com>
 <alpine.LFD.2.21.1905161545050.767@reclus.nhh.no>
 <40397357.2542649.1558022831782@mail.yahoo.com>
 <61485E58-0204-46C6-BC41-78C11C044168@bigelow.org>
 <247369950.2597648.1558026790460@mail.yahoo.com>
 <65D07781-BD93-4AD3-B69C-131AB1863435@bigelow.org>
Message-ID: <2045872748.2902102.1558077390161@mail.yahoo.com>

 Hello,thanks for the suggestions. I've tried to switch to the new function readOGR() instead of the readShapePolyas follows
### Readpolygon shape files into SpatialPolygonsDataFrame objects

#a <-readShapePoly("C:/Users/Francesco pc/ Prov2011_WGS84",IDvar="COD_PRO")

a <-readOGR(dsn="C:/Users/Francesco pc/",layer="Prov2011_WGS84")
The readOGR function seems to work. However I've now some difficulties in Matching spatial dataframe and dataframe. 
My code is:
quars<-? read.dta("dataset_resilience_perR.dta")???????? #reading file from STATA

save(quars,file = "quars.rda")

load("quars.rda")

names(quars)

attach(quars)

data.quars? <- quars

dim(data.quars)

MATCH <-match(a$COD_PRO, data.quars$codpro); MATCH 

### OBJECTID

data.quars1<- data.quars[MATCH,]; dim(data.quars1)

row.names(data.quars1)<- a$COD_PRO; dim(data.quars1)

aa <-spCbind(a, data.quars1)

sample<- aa[!is.na(aa$stand),] 

#

writePolyShape(sample,"sample",factor2char= TRUE) 

sample<- readShapePoly("sample",IDvar="COD_PRO") 

The last two coding lines must also be changed. But I get an error before that, when using the spCbind 
Error in spCbind(a, data.quars1) : row names not identicalwhich I was not having before when using the readShapePoly function.Don't know why. Thanks a lot for the suggestions.Francesco





    Il gioved? 16 maggio 2019, 21:24:22 CEST, Ben Tupper <btupper at bigelow.org> ha scritto:  
 
 Hi,
This seems like a different question than your original question. ?I have a couple of suggestions...
Check out ogrInfo() from the rgdal package. ?It may help you understand the contents of your shape file.
Be sure that you are using the readOGR() function properly - I don't see IDvar in the help page for readOGR.?
Keeping mind that only you have the data, post this new question to the R-sig-geo list in way that helps your readers understand what you have done and what the problem is.
Best wishes,Ben

On May 16, 2019, at 1:13 PM, Francesco Perugini <francesco.perugini at yahoo.it> wrote:
 Dear Ben Tupper,sorry for the inconvinience cuased. 
I've now switched into plain text. Hopefully it reads fine now.
Here again my previuos email to the forum then
___________
Prof. Bivand,sorry again. I'm trying to update the coding I used.I'm now changing, as suggested, a <- readShapePoly("C:/Users/Francesco pc/Prov2011_WGS84", IDvar="COD_PRO")into
a <- readOGR("C:/Users/Francesco pc/Prov2011_WGS84", IDvar="COD_PRO")
I guess IDvar is not correct. Should that be layer="COD_PRO" ?Thanks a lotFrancesco
___________


    Il gioved? 16 maggio 2019, 18:54:55 CEST, Ben Tupper <btupper at bigelow.org> ha scritto:  
 
 Hi Francesco,
It really would help the rest of us if you would configure your email client to send plain text, rather than rich-formatted text or HTML formatted text. ?The latter two simply mess up what others, like me, see when we read your messages. ?Most email clients, including Yahoo, allow you to switch. ?Attached is a snapshot of my Yahoo mail - you can access the option through the "..." menu at the bottom.
Best wishes,Ben

<yahoo-plain-text.png>

On May 16, 2019, at 12:07 PM, Francesco Perugini via R-sig-Geo <r-sig-geo at r-project.org> wrote:
Prof. Bivand,sorry again. I'm trying to update the coding I used.I'm now changing, as suggested, a <- readShapePoly("C:/Users/Francesco pc/Prov2011_WGS84", IDvar="COD_PRO")into
a <- readOGR("C:/Users/Francesco pc/Prov2011_WGS84", IDvar="COD_PRO")
I guess IDvar is not correct. Should that be layer="COD_PRO" ?Thanks a lotFrancesco



???Il gioved? 16 maggio 2019, 15:47:36 CEST, Roger Bivand <Roger.Bivand at nhh.no> ha scritto: ?

On Thu, 16 May 2019, Francesco Perugini wrote:


Thanks a lot for the reply Prof. Bivand. It works fine now. Yes I did?
not use R since few months.I was wondering why this piece of coding left?
is not working: neighbors.knn1 <- knn2nb(knearneigh(coord, 1,?
longlat=F), sym=F)## Global G dlwknn1.B <- nb2listw(neighbors.knn1,?
style="B", zero.policy=TRUE) globalG.test(CRIME, dlwknn1.B,?
zero.policy=F)


Note that HTML always mangles code. You have not shown any errors apart?
from:



Error: object 'CRIME' not found


which is self-evident, as ls() in your workspace will show. You would?
always have needed columbus$CRIME to access CRIME.

Roger


Thanks again for your help.Francesco

? ??Il gioved? 16 maggio 2019, 15:07:37 CEST, Roger Bivand <Roger.Bivand at nhh.no> ha scritto:

Please post in plain text to avoid code mangling. You have not noticed
that a lot has been happening. First, data sets from spdep have mostly
been moved to spData. Next, spData mostly uses sf to read and format data.
Finally you may also see changes as spdep model fitting functions are in
spatialreg and will shortly be dropped from spdep. In your case:


library(sp)
library(spdep)

Loading required package: spData
Loading required package: sf
Linking to GEOS 3.7.2, GDAL 3.0.0, PROJ 6.1.0

example(columbus)


colmbs> columbus <- st_read(system.file("shapes/columbus.shp",
package="spData")[1], quiet=TRUE)

colmbs> col.gal.nb <- read.gal(system.file("weights/columbus.gal",
package="spData")[1])

coord <- coordinates(columbus)

Error in (function (classes, fdef, mtable)? :
??unable to find an inherited method for function ?coordinates? for
signature ?"sf"?

columbus <- as(columbus, "Spatial")
coord <- coordinates(columbus)


Giving the full output, you can see that example(columbus) reads in the
data and neighbours from spData, using sf. Consequently, you'd need to
coerce columbus to an sp class if you do not want to upgrade your
workflow to sf compatability.

Hope this clarifies,

Roger

On Thu, 16 May 2019, Francesco Perugini via R-sig-Geo wrote:


Dear all,I'm not very familiar with R.
I'm tying to use this code I've written months ago. At that time it was
working but now it is not.

library(sp)
library(spdep)
example(columbus)
coord <- coordinates(columbus)and get this message

Error in (function (classes, fdef, mtable)? : unable to find an
inherited method for function ?coordinates? for signature ?"sf"?
I've tried to also calllibrary(sf)but got the same error.I was wondering
why?
Thanks a lot.Francesco



????[[alternative HTML version deleted]]

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo






--?
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en ?
 [[alternative HTML version deleted]]

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo

Ben Tupper
Bigelow Laboratory for Ocean?Sciences
60 Bigelow Drive, P.O. Box 380
East Boothbay, Maine 04544
http://www.bigelow.org
Ecological Forecasting: https://eco.bigelow.org/




  <yahoo-plain-text.png>

Ben Tupper
Bigelow Laboratory for Ocean?Sciences
60 Bigelow Drive, P.O. Box 380
East Boothbay, Maine 04544
http://www.bigelow.org
Ecological Forecasting: https://eco.bigelow.org/




  
	[[alternative HTML version deleted]]


From me| @end|ng |rom mb@cou@com  Fri May 17 11:03:45 2019
From: me| @end|ng |rom mb@cou@com (Bacou, Melanie)
Date: Fri, 17 May 2019 05:03:45 -0400
Subject: [R-sig-Geo] Use raster::getData to access long term bioclimatic RFE
 CHIRPS ERA5?
Message-ID: <c33a9712-0450-7660-4214-824c913c3f11@mbacou.com>

An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20190517/29388872/attachment.html>

From Roger@B|v@nd @end|ng |rom nhh@no  Fri May 17 14:09:04 2019
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Fri, 17 May 2019 14:09:04 +0200
Subject: [R-sig-Geo] sp
In-Reply-To: <40397357.2542649.1558022831782@mail.yahoo.com>
References: <1727951547.2361418.1558011303541.ref@mail.yahoo.com>
 <1727951547.2361418.1558011303541@mail.yahoo.com>
 <alpine.LFD.2.21.1905161500170.767@reclus.nhh.no>
 <485941351.2408701.1558014229896@mail.yahoo.com>
 <alpine.LFD.2.21.1905161545050.767@reclus.nhh.no>
 <40397357.2542649.1558022831782@mail.yahoo.com>
Message-ID: <alpine.LFD.2.21.1905171354320.7805@reclus.nhh.no>

On Thu, 16 May 2019, Francesco Perugini wrote:

> Prof. Bivand,sorry again. I'm trying to update the coding I used.I'm now 
> changing, as suggested, a <- readShapePoly("C:/Users/Francesco 
> pc/Prov2011_WGS84", IDvar="COD_PRO")into

maptools::readShapePoly() has been deprecated for many years, I should 
make it defunct soon (remove shapefile support completely). The IDvar= 
argument was used to set the row.names of the sp object returned.

> a <- readOGR("C:/Users/Francesco pc/Prov2011_WGS84", IDvar="COD_PRO")

rgdal::readOGR cannot itself set the row.names and as you would see from 
the help page, there is no such argument. So:

row.names(a) <- as.character(a$COD_PRO)

should work. In any case, all should now be moving to sf::st_read(), so:

a <- sf::st_read("C:/Users/Francesco pc/Prov2011_WGS84.shp")

should work. From there on, merge() is better supported.

Roger

> I guess IDvar is not correct. Should that be layer="COD_PRO" ?Thanks a 
> lotFrancesco
>
>
>
>    Il gioved? 16 maggio 2019, 15:47:36 CEST, Roger Bivand <Roger.Bivand at nhh.no> ha scritto:
>
> On Thu, 16 May 2019, Francesco Perugini wrote:
>
>> Thanks a lot for the reply Prof. Bivand. It works fine now. Yes I did
>> not use R since few months.I was wondering why this piece of coding left
>> is not working: neighbors.knn1 <- knn2nb(knearneigh(coord, 1,
>> longlat=F), sym=F)## Global G dlwknn1.B <- nb2listw(neighbors.knn1,
>> style="B", zero.policy=TRUE) globalG.test(CRIME, dlwknn1.B,
>> zero.policy=F)
>
> Note that HTML always mangles code. You have not shown any errors apart
> from:
>
>>
>> Error: object 'CRIME' not found
>
> which is self-evident, as ls() in your workspace will show. You would
> always have needed columbus$CRIME to access CRIME.
>
> Roger
>
>> Thanks again for your help.Francesco
>>
>> ? ? Il gioved? 16 maggio 2019, 15:07:37 CEST, Roger Bivand <Roger.Bivand at nhh.no> ha scritto:
>>
>> Please post in plain text to avoid code mangling. You have not noticed
>> that a lot has been happening. First, data sets from spdep have mostly
>> been moved to spData. Next, spData mostly uses sf to read and format data.
>> Finally you may also see changes as spdep model fitting functions are in
>> spatialreg and will shortly be dropped from spdep. In your case:
>>
>>> library(sp)
>>> library(spdep)
>> Loading required package: spData
>> Loading required package: sf
>> Linking to GEOS 3.7.2, GDAL 3.0.0, PROJ 6.1.0
>>> example(columbus)
>>
>> colmbs> columbus <- st_read(system.file("shapes/columbus.shp",
>> package="spData")[1], quiet=TRUE)
>>
>> colmbs> col.gal.nb <- read.gal(system.file("weights/columbus.gal",
>> package="spData")[1])
>>> coord <- coordinates(columbus)
>> Error in (function (classes, fdef, mtable)? :
>> ? unable to find an inherited method for function ?coordinates? for
>> signature ?"sf"?
>>> columbus <- as(columbus, "Spatial")
>>> coord <- coordinates(columbus)
>>
>> Giving the full output, you can see that example(columbus) reads in the
>> data and neighbours from spData, using sf. Consequently, you'd need to
>> coerce columbus to an sp class if you do not want to upgrade your
>> workflow to sf compatability.
>>
>> Hope this clarifies,
>>
>> Roger
>>
>> On Thu, 16 May 2019, Francesco Perugini via R-sig-Geo wrote:
>>
>>> Dear all,I'm not very familiar with R.
>>> I'm tying to use this code I've written months ago. At that time it was
>>> working but now it is not.
>>>> library(sp)
>>>> library(spdep)
>>>> example(columbus)
>>>> coord <- coordinates(columbus)and get this message
>>> Error in (function (classes, fdef, mtable)? : unable to find an
>>> inherited method for function ?coordinates? for signature ?"sf"?
>>> I've tried to also calllibrary(sf)but got the same error.I was wondering
>>> why?
>>> Thanks a lot.Francesco
>>>
>>>
>>>
>>> ??? [[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>>
>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

From Roger@B|v@nd @end|ng |rom nhh@no  Fri May 17 14:13:08 2019
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Fri, 17 May 2019 14:13:08 +0200
Subject: [R-sig-Geo] Question spdep package - extending nb object
In-Reply-To: <401C126D-5669-4E97-ADA8-9879B42835E3@yahoo.de>
References: <401C126D-5669-4E97-ADA8-9879B42835E3.ref@yahoo.de>
 <401C126D-5669-4E97-ADA8-9879B42835E3@yahoo.de>
Message-ID: <alpine.LFD.2.21.1905171409250.7805@reclus.nhh.no>

On Thu, 16 May 2019, Raphael Mesaric via R-sig-Geo wrote:

> Dear all,
>
> I am working on a spatial regression model which is built in such a way 
> that the dependent variable consists of n blocks of multiple entries, 
> and each block is referring to the same spatial grid. In order to run 
> the lagsarlm() function or the errsarlm() function, I now need to extend 
> my initial nb object from one grid to n grids. In other words, I need 
> the nb object to be repeated n times. However, so far I did not find a 
> way to do this properly.
>
> I tried to just replicate the nb object by repeating the entries of the 
> neighbours list and the weights list, respectively.
>
> dnn800_3w$neighbours <- rep(dnn800_3w$neighbours,20)
> dnn800_3w$weights <- rep(dnn800_3w$weights,20)
>
> When I do this, I get the following error message:
>
> Error in is.symmetric.nb(listw$neighbours, FALSE) : Not neighbours list
>
> Which makes sense, as the matrix is not symmetric any more due to the 
> steps described above. However, I cannot think of a correct 
> implementation at the moment.

Not even worth trying, as you found. Do you mean a Kronecker product, as 
found in spatial panel models? Or do you mean that you have blocks of 
observations without position that belong to upper-level objects with 
known position (postcodes or similar)? If the latter, look at 
?spdep::nb2blocknb.

Hope this clarifies,

Roger

>
> Can you help me with this issue? Any suggestions are highly appreciated.
>
> Thank you in advance.
>
> Best regards,
>
> Raphael Mesaric
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en


From Roger@B|v@nd @end|ng |rom nhh@no  Fri May 17 14:20:27 2019
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Fri, 17 May 2019 14:20:27 +0200
Subject: [R-sig-Geo] Question spgwr package - running time gwr()
In-Reply-To: <18F149CA-2275-405C-A7E2-AC67B2A6F5C3@yahoo.de>
References: <18F149CA-2275-405C-A7E2-AC67B2A6F5C3.ref@yahoo.de>
 <18F149CA-2275-405C-A7E2-AC67B2A6F5C3@yahoo.de>
Message-ID: <alpine.LFD.2.21.1905171413230.7805@reclus.nhh.no>

On Fri, 17 May 2019, Raphael Mesaric via R-sig-Geo wrote:

> Dear all,
>
> Is there an option to shorten the running time for the gwr() function, 
> similar to the ?LU? method for lagsarlm() in the spdep package? Because 
> I have a model with roughly 500?000 observations, and the running time 
> at the moment is quite long, respectively it has not yet terminated.

What are you actually doing? Why did you choose GWR? Are you fitting a GWR 
with 500K observations, or have you fitted a GWR with many fewer 
observations, and are now rendering that fitted model with 500K fit 
points? GWR is only for detecting possible non-stationarity or similar 
mis-specification in moderately sized data sets. Trying to fit with 500K 
gives a dense hat matrix of 500K x 500K, which is imposssible (or were it 
possible would be uninformative). Think of 5K as a sensible maximum if GWR 
is condidered sensible at all. I would think that finding a bandwidth is 
impossible too.

Roger

>
> Thank you for your help in advance.
>
> Best regards,
>
> Raphael Mesaric
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

From Roger@B|v@nd @end|ng |rom nhh@no  Fri May 17 14:26:54 2019
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Fri, 17 May 2019 14:26:54 +0200
Subject: [R-sig-Geo] sp
In-Reply-To: <2045872748.2902102.1558077390161@mail.yahoo.com>
References: <1727951547.2361418.1558011303541.ref@mail.yahoo.com>
 <1727951547.2361418.1558011303541@mail.yahoo.com>
 <alpine.LFD.2.21.1905161500170.767@reclus.nhh.no>
 <485941351.2408701.1558014229896@mail.yahoo.com>
 <alpine.LFD.2.21.1905161545050.767@reclus.nhh.no>
 <40397357.2542649.1558022831782@mail.yahoo.com>
 <61485E58-0204-46C6-BC41-78C11C044168@bigelow.org>
 <247369950.2597648.1558026790460@mail.yahoo.com>
 <65D07781-BD93-4AD3-B69C-131AB1863435@bigelow.org>
 <2045872748.2902102.1558077390161@mail.yahoo.com>
Message-ID: <alpine.LFD.2.21.1905171421030.7805@reclus.nhh.no>

On Fri, 17 May 2019, Francesco Perugini via R-sig-Geo wrote:

> Hello,thanks for the suggestions. I've tried to switch to the new function readOGR() instead of the readShapePolyas follows
> ### Readpolygon shape files into SpatialPolygonsDataFrame objects
>
> #a <-readShapePoly("C:/Users/Francesco pc/ Prov2011_WGS84",IDvar="COD_PRO")
>
> a <-readOGR(dsn="C:/Users/Francesco pc/",layer="Prov2011_WGS84")

> The readOGR function seems to work. However I've now some difficulties 
> in Matching spatial dataframe and dataframe.

See my previous reply. The sf package provides better support for merging 
sf objects and data.frames than sp. Do remember to eliminate your use of 
shapefile functions from maptools, moving to sf instead. You'll find sf 
covered well in Lovelace et al. (2019), also at:

https://geocompr.robinlovelace.net/

Also look there for left_join() and othe *_join() methods as well as 
merge().

Roger


> My code is:
> quars<-? read.dta("dataset_resilience_perR.dta")???????? #reading file from STATA
>
> save(quars,file = "quars.rda")
>
> load("quars.rda")
>
> names(quars)
>
> attach(quars)
>
> data.quars? <- quars
>
> dim(data.quars)
>
> MATCH <-match(a$COD_PRO, data.quars$codpro); MATCH
>
> ### OBJECTID
>
> data.quars1<- data.quars[MATCH,]; dim(data.quars1)
>
> row.names(data.quars1)<- a$COD_PRO; dim(data.quars1)
>
> aa <-spCbind(a, data.quars1)
>
> sample<- aa[!is.na(aa$stand),]
>
> #
>
> writePolyShape(sample,"sample",factor2char= TRUE)
>
> sample<- readShapePoly("sample",IDvar="COD_PRO")
>
> The last two coding lines must also be changed. But I get an error 
> before that, when using the spCbind Error in spCbind(a, data.quars1) : 
> row names not identicalwhich I was not having before when using the 
> readShapePoly function.Don't know why. Thanks a lot for the 
> suggestions.Francesco
>
>
>
>
>
>    Il gioved? 16 maggio 2019, 21:24:22 CEST, Ben Tupper <btupper at bigelow.org> ha scritto:
>
> Hi,
> This seems like a different question than your original question. ?I have a couple of suggestions...
> Check out ogrInfo() from the rgdal package. ?It may help you understand the contents of your shape file.
> Be sure that you are using the readOGR() function properly - I don't see IDvar in the help page for readOGR.?
> Keeping mind that only you have the data, post this new question to the R-sig-geo list in way that helps your readers understand what you have done and what the problem is.
> Best wishes,Ben
>
> On May 16, 2019, at 1:13 PM, Francesco Perugini <francesco.perugini at yahoo.it> wrote:
> Dear Ben Tupper,sorry for the inconvinience cuased.
> I've now switched into plain text. Hopefully it reads fine now.
> Here again my previuos email to the forum then
> ___________
> Prof. Bivand,sorry again. I'm trying to update the coding I used.I'm now changing, as suggested, a <- readShapePoly("C:/Users/Francesco pc/Prov2011_WGS84", IDvar="COD_PRO")into
> a <- readOGR("C:/Users/Francesco pc/Prov2011_WGS84", IDvar="COD_PRO")
> I guess IDvar is not correct. Should that be layer="COD_PRO" ?Thanks a lotFrancesco
> ___________
>
>
>    Il gioved? 16 maggio 2019, 18:54:55 CEST, Ben Tupper <btupper at bigelow.org> ha scritto:
>
> Hi Francesco,
> It really would help the rest of us if you would configure your email client to send plain text, rather than rich-formatted text or HTML formatted text. ?The latter two simply mess up what others, like me, see when we read your messages. ?Most email clients, including Yahoo, allow you to switch. ?Attached is a snapshot of my Yahoo mail - you can access the option through the "..." menu at the bottom.
> Best wishes,Ben
>
> <yahoo-plain-text.png>
>
> On May 16, 2019, at 12:07 PM, Francesco Perugini via R-sig-Geo <r-sig-geo at r-project.org> wrote:
> Prof. Bivand,sorry again. I'm trying to update the coding I used.I'm now changing, as suggested, a <- readShapePoly("C:/Users/Francesco pc/Prov2011_WGS84", IDvar="COD_PRO")into
> a <- readOGR("C:/Users/Francesco pc/Prov2011_WGS84", IDvar="COD_PRO")
> I guess IDvar is not correct. Should that be layer="COD_PRO" ?Thanks a lotFrancesco
>
>
>
> ???Il gioved? 16 maggio 2019, 15:47:36 CEST, Roger Bivand <Roger.Bivand at nhh.no> ha scritto: ?
>
> On Thu, 16 May 2019, Francesco Perugini wrote:
>
>
> Thanks a lot for the reply Prof. Bivand. It works fine now. Yes I did?
> not use R since few months.I was wondering why this piece of coding left?
> is not working: neighbors.knn1 <- knn2nb(knearneigh(coord, 1,?
> longlat=F), sym=F)## Global G dlwknn1.B <- nb2listw(neighbors.knn1,?
> style="B", zero.policy=TRUE) globalG.test(CRIME, dlwknn1.B,?
> zero.policy=F)
>
>
> Note that HTML always mangles code. You have not shown any errors apart?
> from:
>
>
>
> Error: object 'CRIME' not found
>
>
> which is self-evident, as ls() in your workspace will show. You would?
> always have needed columbus$CRIME to access CRIME.
>
> Roger
>
>
> Thanks again for your help.Francesco
>
> ? ??Il gioved? 16 maggio 2019, 15:07:37 CEST, Roger Bivand <Roger.Bivand at nhh.no> ha scritto:
>
> Please post in plain text to avoid code mangling. You have not noticed
> that a lot has been happening. First, data sets from spdep have mostly
> been moved to spData. Next, spData mostly uses sf to read and format data.
> Finally you may also see changes as spdep model fitting functions are in
> spatialreg and will shortly be dropped from spdep. In your case:
>
>
> library(sp)
> library(spdep)
>
> Loading required package: spData
> Loading required package: sf
> Linking to GEOS 3.7.2, GDAL 3.0.0, PROJ 6.1.0
>
> example(columbus)
>
>
> colmbs> columbus <- st_read(system.file("shapes/columbus.shp",
> package="spData")[1], quiet=TRUE)
>
> colmbs> col.gal.nb <- read.gal(system.file("weights/columbus.gal",
> package="spData")[1])
>
> coord <- coordinates(columbus)
>
> Error in (function (classes, fdef, mtable)? :
> ??unable to find an inherited method for function ?coordinates? for
> signature ?"sf"?
>
> columbus <- as(columbus, "Spatial")
> coord <- coordinates(columbus)
>
>
> Giving the full output, you can see that example(columbus) reads in the
> data and neighbours from spData, using sf. Consequently, you'd need to
> coerce columbus to an sp class if you do not want to upgrade your
> workflow to sf compatability.
>
> Hope this clarifies,
>
> Roger
>
> On Thu, 16 May 2019, Francesco Perugini via R-sig-Geo wrote:
>
>
> Dear all,I'm not very familiar with R.
> I'm tying to use this code I've written months ago. At that time it was
> working but now it is not.
>
> library(sp)
> library(spdep)
> example(columbus)
> coord <- coordinates(columbus)and get this message
>
> Error in (function (classes, fdef, mtable)? : unable to find an
> inherited method for function ?coordinates? for signature ?"sf"?
> I've tried to also calllibrary(sf)but got the same error.I was wondering
> why?
> Thanks a lot.Francesco
>
>
>
> ????[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
>
>
>
>
> --?
> Roger Bivand
> Department of Economics, Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
> https://orcid.org/0000-0003-2392-6140
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en ?
> [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> Ben Tupper
> Bigelow Laboratory for Ocean?Sciences
> 60 Bigelow Drive, P.O. Box 380
> East Boothbay, Maine 04544
> http://www.bigelow.org
> Ecological Forecasting: https://eco.bigelow.org/
>
>
>
>
>  <yahoo-plain-text.png>
>
> Ben Tupper
> Bigelow Laboratory for Ocean?Sciences
> 60 Bigelow Drive, P.O. Box 380
> East Boothbay, Maine 04544
> http://www.bigelow.org
> Ecological Forecasting: https://eco.bigelow.org/
>
>
>
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

From r@ph@e|@me@| @end|ng |rom y@hoo@de  Fri May 17 14:58:06 2019
From: r@ph@e|@me@| @end|ng |rom y@hoo@de (Raphael Mesaric)
Date: Fri, 17 May 2019 14:58:06 +0200
Subject: [R-sig-Geo] Question spdep package - extending nb object
In-Reply-To: <alpine.LFD.2.21.1905171409250.7805@reclus.nhh.no>
References: <401C126D-5669-4E97-ADA8-9879B42835E3.ref@yahoo.de>
 <401C126D-5669-4E97-ADA8-9879B42835E3@yahoo.de>
 <alpine.LFD.2.21.1905171409250.7805@reclus.nhh.no>
Message-ID: <2481A4E4-F01D-45DF-AFED-E8EA2B4A640D@yahoo.de>

Dear Roger,

Thank you very much for your reply.

It is kind of a spatial panel model, but I have only one time series. To describe it differently:

The dependent variable consists of twenty blocks with averaged data. Each block is related to one season and one out of five time slots (that is why I have 20 blocks - 4 seasons times 5 time slots). And each block of data refers to the very same grid, i.e. the first entry of the first block corresponds to the same call as the first entry of all the other blocks, the second entries correspond to the second cell etc. The grid is of hectare resolution, i.e. 100 x 100m (one could see this as similar to post codes).

Therefore, nb2blocknb() sounds interesting, even though I do not really have ?location-less observations?, but just observations with different attributes (season and time). Would it work if my ?ID? argument is built in such a way that it repeats 19 times the identification tags of the first block? For example:

rep(seq(from = 1, to = m, by = 1),19) , where m is the number of cells in my grid?

Best,

Raphael


> Am 17.05.2019 um 14:13 schrieb Roger Bivand <Roger.Bivand at nhh.no>:
> 
> On Thu, 16 May 2019, Raphael Mesaric via R-sig-Geo wrote:
> 
>> Dear all,
>> 
>> I am working on a spatial regression model which is built in such a way that the dependent variable consists of n blocks of multiple entries, and each block is referring to the same spatial grid. In order to run the lagsarlm() function or the errsarlm() function, I now need to extend my initial nb object from one grid to n grids. In other words, I need the nb object to be repeated n times. However, so far I did not find a way to do this properly.
>> 
>> I tried to just replicate the nb object by repeating the entries of the neighbours list and the weights list, respectively.
>> 
>> dnn800_3w$neighbours <- rep(dnn800_3w$neighbours,20)
>> dnn800_3w$weights <- rep(dnn800_3w$weights,20)
>> 
>> When I do this, I get the following error message:
>> 
>> Error in is.symmetric.nb(listw$neighbours, FALSE) : Not neighbours list
>> 
>> Which makes sense, as the matrix is not symmetric any more due to the steps described above. However, I cannot think of a correct implementation at the moment.
> 
> Not even worth trying, as you found. Do you mean a Kronecker product, as found in spatial panel models? Or do you mean that you have blocks of observations without position that belong to upper-level objects with known position (postcodes or similar)? If the latter, look at ?spdep::nb2blocknb.
> 
> Hope this clarifies,
> 
> Roger
> 
>> 
>> Can you help me with this issue? Any suggestions are highly appreciated.
>> 
>> Thank you in advance.
>> 
>> Best regards,
>> 
>> Raphael Mesaric
>> 	[[alternative HTML version deleted]]
>> 
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo <https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
>> 
> 
> -- 
> Roger Bivand
> Department of Economics, Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55 <tel:+47%2055%2095%2093%2055>; e-mail: Roger.Bivand at nhh.no <mailto:Roger.Bivand at nhh.no>
> https://orcid.org/0000-0003-2392-6140 <https://orcid.org/0000-0003-2392-6140>
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en <https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en>

	[[alternative HTML version deleted]]


From r@ph@e|@me@| @end|ng |rom y@hoo@de  Fri May 17 14:58:21 2019
From: r@ph@e|@me@| @end|ng |rom y@hoo@de (Raphael Mesaric)
Date: Fri, 17 May 2019 14:58:21 +0200
Subject: [R-sig-Geo] Question spgwr package - running time gwr()
In-Reply-To: <alpine.LFD.2.21.1905171413230.7805@reclus.nhh.no>
References: <18F149CA-2275-405C-A7E2-AC67B2A6F5C3.ref@yahoo.de>
 <18F149CA-2275-405C-A7E2-AC67B2A6F5C3@yahoo.de>
 <alpine.LFD.2.21.1905171413230.7805@reclus.nhh.no>
Message-ID: <527E9629-C122-4FD2-AB70-358B197CE434@yahoo.de>

Dear Roger,

Thank you very much for your reply.

My thesis supervisor told me to use GWR to explore small-scale differences and test the consistency of the SAR models.

So, I tried to fit the GWR model with all my observations. However, if I understood you correctly, I would have to choose smaller sections of the grid and try to fit a GWR there. What I am not sure about how to do this in order to get informative results.

As for the SAR model, the dependent variable consists n blocks where the m-th entry of each block corresponds to the m-th cell of my grid. So, if I have to reduce the grid to about 5K entries, I would need to take a subset of roughly 250 cells and then take all the 20 observations for each of these cells? And then try to fit a GWR there?

Best,

Raphael


> Am 17.05.2019 um 14:20 schrieb Roger Bivand <Roger.Bivand at nhh.no>:
> 
> On Fri, 17 May 2019, Raphael Mesaric via R-sig-Geo wrote:
> 
>> Dear all,
>> 
>> Is there an option to shorten the running time for the gwr() function, similar to the ?LU? method for lagsarlm() in the spdep package? Because I have a model with roughly 500?000 observations, and the running time at the moment is quite long, respectively it has not yet terminated.
> 
> What are you actually doing? Why did you choose GWR? Are you fitting a GWR with 500K observations, or have you fitted a GWR with many fewer observations, and are now rendering that fitted model with 500K fit points? GWR is only for detecting possible non-stationarity or similar mis-specification in moderately sized data sets. Trying to fit with 500K gives a dense hat matrix of 500K x 500K, which is imposssible (or were it possible would be uninformative). Think of 5K as a sensible maximum if GWR is condidered sensible at all. I would think that finding a bandwidth is impossible too.
> 
> Roger
> 
>> 
>> Thank you for your help in advance.
>> 
>> Best regards,
>> 
>> Raphael Mesaric
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> 
> 
> -- 
> Roger Bivand
> Department of Economics, Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
> https://orcid.org/0000-0003-2392-6140
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en


From Roger@B|v@nd @end|ng |rom nhh@no  Sat May 18 16:24:26 2019
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Sat, 18 May 2019 14:24:26 +0000
Subject: [R-sig-Geo] Question spdep package - extending nb object
In-Reply-To: <2481A4E4-F01D-45DF-AFED-E8EA2B4A640D@yahoo.de>
References: <401C126D-5669-4E97-ADA8-9879B42835E3.ref@yahoo.de>
 <401C126D-5669-4E97-ADA8-9879B42835E3@yahoo.de>
 <alpine.LFD.2.21.1905171409250.7805@reclus.nhh.no>,
 <2481A4E4-F01D-45DF-AFED-E8EA2B4A640D@yahoo.de>
Message-ID: <CF511784783D0B52.1b012e6c-bf9a-493c-bb40-0e84ca146772@mail.outlook.com>

Look at multilevel models, fitting iid and/or mrf to the three regular dimensions. Look at the mixed models literature. Some references in https://doi.org/10.1016/j.spasta.2017.01.002, but there is much more.

Hope this helps,

Roger

Roger Bivand
Norwegian School of Economics
Bergen, Norway



Fra: Raphael Mesaric
Sendt: fredag 17. mai, 14.58
Emne: Re: [R-sig-Geo] Question spdep package - extending nb object
Til: Roger Bivand
Kopi: r-sig-geo at r-project.org


Dear Roger,

Thank you very much for your reply.

It is kind of a spatial panel model, but I have only one time series. To describe it differently:

The dependent variable consists of twenty blocks with averaged data. Each block is related to one season and one out of five time slots (that is why I have 20 blocks - 4 seasons times 5 time slots). And each block of data refers to the very same grid, i.e. the first entry of the first block corresponds to the same call as the first entry of all the other blocks, the second entries correspond to the second cell etc. The grid is of hectare resolution, i.e. 100 x 100m (one could see this as similar to post codes).

Therefore, nb2blocknb() sounds interesting, even though I do not really have ?location-less observations?, but just observations with different attributes (season and time). Would it work if my ?ID? argument is built in such a way that it repeats 19 times the identification tags of the first block? For example:

rep(seq(from = 1, to = m, by = 1),19) , where m is the number of cells in my grid?

Best,

Raphael


Am 17.05.2019 um 14:13 schrieb Roger Bivand <Roger.Bivand at nhh.no<mailto:Roger.Bivand at nhh.no>>:

On Thu, 16 May 2019, Raphael Mesaric via R-sig-Geo wrote:

Dear all,

I am working on a spatial regression model which is built in such a way that the dependent variable consists of n blocks of multiple entries, and each block is referring to the same spatial grid. In order to run the lagsarlm() function or the errsarlm() function, I now need to extend my initial nb object from one grid to n grids. In other words, I need the nb object to be repeated n times. However, so far I did not find a way to do this properly.

I tried to just replicate the nb object by repeating the entries of the neighbours list and the weights list, respectively.

dnn800_3w$neighbours <- rep(dnn800_3w$neighbours,20)
dnn800_3w$weights <- rep(dnn800_3w$weights,20)

When I do this, I get the following error message:

Error in is.symmetric.nb(listw$neighbours, FALSE) : Not neighbours list

Which makes sense, as the matrix is not symmetric any more due to the steps described above. However, I cannot think of a correct implementation at the moment.

Not even worth trying, as you found. Do you mean a Kronecker product, as found in spatial panel models? Or do you mean that you have blocks of observations without position that belong to upper-level objects with known position (postcodes or similar)? If the latter, look at ?spdep::nb2blocknb.

Hope this clarifies,

Roger


Can you help me with this issue? Any suggestions are highly appreciated.

Thank you in advance.

Best regards,

Raphael Mesaric
[[alternative HTML version deleted]]

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org<mailto:R-sig-Geo at r-project.org>
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


--
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no<mailto:Roger.Bivand at nhh.no>
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en




	[[alternative HTML version deleted]]


From Roger@B|v@nd @end|ng |rom nhh@no  Sat May 18 23:05:44 2019
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Sat, 18 May 2019 23:05:44 +0200
Subject: [R-sig-Geo] Question spgwr package - running time gwr()
In-Reply-To: <527E9629-C122-4FD2-AB70-358B197CE434@yahoo.de>
References: <18F149CA-2275-405C-A7E2-AC67B2A6F5C3.ref@yahoo.de>
 <18F149CA-2275-405C-A7E2-AC67B2A6F5C3@yahoo.de>
 <alpine.LFD.2.21.1905171413230.7805@reclus.nhh.no>
 <527E9629-C122-4FD2-AB70-358B197CE434@yahoo.de>
Message-ID: <alpine.LFD.2.21.1905182300290.17769@reclus.nhh.no>

On Fri, 17 May 2019, Raphael Mesaric wrote:

> Dear Roger,
>
> Thank you very much for your reply.
>
> My thesis supervisor told me to use GWR to explore small-scale 
> differences and test the consistency of the SAR models.

It happens. From your problem description, I'm unsure whether GWR or SAR 
are appropriate methods, and would suggest the mixed-model and multilevel 
literatures. Mapable IID and spatially structured random effects may be 
more appropriate.

Roger

>
> So, I tried to fit the GWR model with all my observations. However, if I 
> understood you correctly, I would have to choose smaller sections of the 
> grid and try to fit a GWR there. What I am not sure about how to do this 
> in order to get informative results.
>
> As for the SAR model, the dependent variable consists n blocks where the 
> m-th entry of each block corresponds to the m-th cell of my grid. So, if 
> I have to reduce the grid to about 5K entries, I would need to take a 
> subset of roughly 250 cells and then take all the 20 observations for 
> each of these cells? And then try to fit a GWR there?
>
> Best,
>
> Raphael
>
>
>> Am 17.05.2019 um 14:20 schrieb Roger Bivand <Roger.Bivand at nhh.no>:
>>
>> On Fri, 17 May 2019, Raphael Mesaric via R-sig-Geo wrote:
>>
>>> Dear all,
>>>
>>> Is there an option to shorten the running time for the gwr() function, similar to the ?LU? method for lagsarlm() in the spdep package? Because I have a model with roughly 500?000 observations, and the running time at the moment is quite long, respectively it has not yet terminated.
>>
>> What are you actually doing? Why did you choose GWR? Are you fitting a GWR with 500K observations, or have you fitted a GWR with many fewer observations, and are now rendering that fitted model with 500K fit points? GWR is only for detecting possible non-stationarity or similar mis-specification in moderately sized data sets. Trying to fit with 500K gives a dense hat matrix of 500K x 500K, which is imposssible (or were it possible would be uninformative). Think of 5K as a sensible maximum if GWR is condidered sensible at all. I would think that finding a bandwidth is impossible too.
>>
>> Roger
>>
>>>
>>> Thank you for your help in advance.
>>>
>>> Best regards,
>>>
>>> Raphael Mesaric
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>> --
>> Roger Bivand
>> Department of Economics, Norwegian School of Economics,
>> Helleveien 30, N-5045 Bergen, Norway.
>> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
>> https://orcid.org/0000-0003-2392-6140
>> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

From m|ch|e|@v@nd|jk @end|ng |rom wur@n|  Sun May 19 22:18:41 2019
From: m|ch|e|@v@nd|jk @end|ng |rom wur@n| (Dijk, Michiel van)
Date: Sun, 19 May 2019 20:18:41 +0000
Subject: [R-sig-Geo] Dissolve only overlapping polygons in R using sf
In-Reply-To: <ae9ce9adf8e941a185170451153326e5@scomp5296.wurnet.nl>
References: <ae9ce9adf8e941a185170451153326e5@scomp5296.wurnet.nl>
Message-ID: <125011aff91a438192c245d9d91a9aba@scomp5296.wurnet.nl>

Hi,

I extracted information from open street map that contains many polygons, some of them overlapping. I want to union/dissolve all polygons that have overlap with other polygons. I am looking for an approach that uses the sf package. I posted this question on StackExchange here: https://gis.stackexchange.com/questions/323038/dissolve-only-overlapping-polygons-in-r-using-sf/323067#323067 with a reproducible simple example. With help of a reader (Spacedman), I managed to solve it for the simple case. Unfortunately, it seems the osm data is somewhat messy and the solution does not seem to work (or I do not understand it completely). For this reason I am posting it here in the hope somebody has an idea.

The reproducible examples is as follows - three clusters of rectangles of which two have overlap: 

sq = function(pt, sz = 1) st_polygon(list(rbind(c(pt - sz), c(pt[1] + sz, pt[2] - sz), c(pt + sz), c(pt[1] - sz, pt[2] + sz), c(pt - sz)))) x = st_sf(box = 1:6, st_sfc(sq(c(4.2,4.2)), sq(c(0,0)), sq(c(1, -0.8)), sq(c(0.5, 1.7)), sq(c(3,3)), sq(c(-3, -3))))
plot(x)

parts <- st_cast(st_union(x),"POLYGON")
plot(parts)

clust <- unlist(st_intersects(x, parts))

diss <- cbind(x, clust) %>%
  group_by(clust) %>%
  summarize(box = paste(box, collapse = ", ")) # I would like to preserve the names of the polygons before the dissolve hence the paste command.
plot(diss[1])

However, when I run this on my dataset from Open Street Map, which can be found here:  https://www.dropbox.com/s/4n259yhh5swqgf2/osm_data.rds?dl=0, it does not work. When I use st_intersects(x, parts) to determine the links between the features and the clusters it appears that features can be related to two (or more) clusters. I do not understand how this is possible as then these two clusters should be regarded as one cluster. Right? How can I adjust the code above so all the overlapping polygons in my dataset will be dissolved?

Thanks,
Michiel

M. (Michiel) van Dijk, PhD
Research scholar | Ecosystems Services and Management (ESM) | International Institute for Applied Systems Analysis (IIASA) Senior researcher (out of office) | International Policy Division (IB) | Wageningen Economic Research

ySchlossplatz 1 - A-2361 Laxenburg, Austria, room s-138 S +43 2236 807 537
Skype: michiel.van.dijk
S https://www.researchgate.net/profile/Michiel_Van_Dijk/
/ http://nl.linkedin.com/pub/michiel-van-dijk/1a/805/346


From dongme|c @end|ng |rom uoregon@edu  Tue May 21 18:52:20 2019
From: dongme|c @end|ng |rom uoregon@edu (Dongmei Chen)
Date: Tue, 21 May 2019 09:52:20 -0700
Subject: [R-sig-Geo] Effective number of parameters (enp)
Message-ID: <9BB72F43-E85F-42BB-ADB1-92C06FFEE067@uoregon.edu>

Hello all,

I am trying to interpret the model output from the geographically weighted regression R function ?gwr' in the package ?spgwr?. 

There are two ?effective number of parameters?:
Effective number of parameters (residual: 2traceS - traceS?S)
Effective number of parameters (model: traceS)

How do I interpret them? Do you know which one is for the calculation of adjusted p values addressed here <https://github.com/cran/GWmodel/blob/master/R/gwr.t.adjust.r>?

Thank you,
Dongmei
	[[alternative HTML version deleted]]


From r@i@1290 m@iii@g oii @im@com  Tue May 21 20:28:57 2019
From: r@i@1290 m@iii@g oii @im@com (r@i@1290 m@iii@g oii @im@com)
Date: Tue, 21 May 2019 18:28:57 +0000 (UTC)
Subject: [R-sig-Geo] Placing a world map on r plot
References: <553256810.3960384.1558463337522.ref@mail.yahoo.com>
Message-ID: <553256810.3960384.1558463337522@mail.yahoo.com>

I am trying to place a world map on my current plots made by level plot. This plot was made as follows:? 
? ? library(raster)
??? library(ncdf4)
??? library(maps)
??? library(maptools)
??? library(rasterVis)
??? library(ggplot2)
??? library(rgdal)
??? library(sp)
??? library(gridExtra)? ??
MFplot4<-levelplot(MFMeaner3,margin=F, at=Fcutpoints4,cuts=11, 
??? pretty=TRUE,par.settings=mapTheme, main="Historical five-day maximum?? 
??? precipitation (mm/day) model mean")
The object "MFMeaner3" has the following attributes:??? class?????? : RasterLayer 
??? dimensions? : 64, 128, 8192? (nrow, ncol, ncell)
??? resolution? : 2.8125, 2.789327? (x, y)
??? extent????? : -181.4062, 178.5938, -89.25846, 89.25846? (xmin, xmax, ymin, 
??? ymax)
??? coord. ref. : +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0 
??? data source : in memory
??? names?????? : layer 
??? values????? : 0.1583802, 164.2064? (min, max)
Here was my attempt to place a world map overlay on the above plot:
? ? world.outlines<-map("world", plot=FALSE) 
??? world.outlines.sp<-map2SpatialLines(world.outlines,proj4string =?? 
??? CRS("+proj=longlat"))

? ? MFplot4 + layer(sp.lines(world.outlines.sp,col="black",lwd=0.5))However, this leads to the following error:
? ? Error: Attempted to create layer with no stat.
I also tried placing a simple world map using this:
? ? MFplot4 + plot(wrld_simpl)
But I receive this error:
??? Error in UseMethod("as.layer") : 
??? no applicable method for 'as.layer' applied to an object of class "NULL"
Why would these errors occur? 

Any assistance with this would be extremely appreciated!
	[[alternative HTML version deleted]]


From je||rey@@tr@t|ord @end|ng |rom w||ke@@edu  Thu May 23 03:56:34 2019
From: je||rey@@tr@t|ord @end|ng |rom w||ke@@edu (Stratford, Jeff)
Date: Wed, 22 May 2019 21:56:34 -0400
Subject: [R-sig-Geo] focal analysis on raster
Message-ID: <CAP5kizSZya_CjHXghU=UZr1y_tkQh7+b=_85RfK=C9XzzZwf2w@mail.gmail.com>

Hi everyone,

I am looking to estimate the number of pixels to quantify different
landuses around sampling points for different projects (bird diversity,
nests, predation rates on clay caterpillars, etc). Our base map is a
Landsat 7 map.

I can plot our sample points and plot the Landsat map (using raster) but
I'm not sure

1. How to overlay the sample points onto the Landsat map
2. How to do the focal analysis using the sample points as centers in
circular buffers of 200 and 1000 m radii

Any help would be greatly appreciated.

Many thanks,

Jeff

********************************************************
Jeffrey A. Stratford, PhD
Department of Biology and Health Sciences &
Director of Study Abroad
Office: Cohen Science Center 210
Address: 84 W South Street
Wilkes University, PA 18766 USA
https://sites.google.com/a/wilkes.edu/stratford/home
Blog https://wordpress.com/posts/concreteornithology.blog
********************************************************

	[[alternative HTML version deleted]]


From b|@|ev||@t @end|ng |rom gm@||@com  Thu May 23 09:24:14 2019
From: b|@|ev||@t @end|ng |rom gm@||@com (=?UTF-8?Q?Bede-Fazekas_=c3=81kos?=)
Date: Thu, 23 May 2019 09:24:14 +0200
Subject: [R-sig-Geo] focal analysis on raster
In-Reply-To: <CAP5kizSZya_CjHXghU=UZr1y_tkQh7+b=_85RfK=C9XzzZwf2w@mail.gmail.com>
References: <CAP5kizSZya_CjHXghU=UZr1y_tkQh7+b=_85RfK=C9XzzZwf2w@mail.gmail.com>
Message-ID: <30cbb61c-59c5-bc94-d569-811a681cf820@gmail.com>

Dear Jeff,
1. raster::extract(Raster*, SpatialPoints*)
2. raster::extract(Raster*, rgeos::gBuffer(SpatialPoints*, width, byid = 
TRUE))
If your points are Simple Features, use sf::st_buffer(x, dist) instead 
of rgeos::gBuffer().

HTH,
?kos Bede-Fazekas
Hungarian Academy of Sciences

2019.05.23. 3:56 keltez?ssel, Stratford, Jeff via R-sig-Geo ?rta:
> Hi everyone,
>
> I am looking to estimate the number of pixels to quantify different
> landuses around sampling points for different projects (bird diversity,
> nests, predation rates on clay caterpillars, etc). Our base map is a
> Landsat 7 map.
>
> I can plot our sample points and plot the Landsat map (using raster) but
> I'm not sure
>
> 1. How to overlay the sample points onto the Landsat map
> 2. How to do the focal analysis using the sample points as centers in
> circular buffers of 200 and 1000 m radii
>
> Any help would be greatly appreciated.
>
> Many thanks,
>
> Jeff
>
> ********************************************************
> Jeffrey A. Stratford, PhD
> Department of Biology and Health Sciences &
> Director of Study Abroad
> Office: Cohen Science Center 210
> Address: 84 W South Street
> Wilkes University, PA 18766 USA
> https://sites.google.com/a/wilkes.edu/stratford/home
> Blog https://wordpress.com/posts/concreteornithology.blog
> ********************************************************
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From m@|k@r@ @end|ng |rom y@ndex@com  Thu May 23 14:20:01 2019
From: m@|k@r@ @end|ng |rom y@ndex@com (Fatih Kara)
Date: Thu, 23 May 2019 13:20:01 +0100
Subject: [R-sig-Geo] GRID based calculations
Message-ID: <38841871558614001@myt6-23299ba78d64.qloud-c.yandex.net>

Hi,

We are developing a grid based database which provides several types of data. One of the layers in this database will be land cover data with 30 land cover types. Our grids will cover almost 90 pixels and our purpose is that if someone click on the grid, percentage of land cover types should be seen automatically like 20% forest, 30% water, and 50% grass.
 
What should we do? Is there any related code samples? 

Thanks
-- 
Fatih Kara


From dehn@v|2300 @end|ng |rom y@hoo@com  Fri May 24 12:24:27 2019
From: dehn@v|2300 @end|ng |rom y@hoo@com (hamide dehnavi)
Date: Fri, 24 May 2019 10:24:27 +0000 (UTC)
Subject: [R-sig-Geo] nested  spatial model
References: <521691825.8706385.1558693467463.ref@mail.yahoo.com>
Message-ID: <521691825.8706385.1558693467463@mail.yahoo.com>

hello1-i'm going to work with colash data following nested spatial model that in statistical method for spatial data analysis (oliver_schabben berger? page150) .i devided data to 3 subgroups.i have fitted varigram model to every 3 subgroup. and also i have calculated covarianc matrix of them. but this matrixs? havn't same dimention .and i coud not caculate? $(4.23) of this page. what can i do ?
2-I have? regular lattic data (wheat_yield ,page 434 of cerssi 1993, statistic for spatial data) when i have calculated the kriging ,unfortunatly? the? covariance? matrix is 0 i'm going? to work following? method on the book for this data .what can i do?thank's in advance for your help and time.

	[[alternative HTML version deleted]]


From @@r@h@go@|ee @end|ng |rom gm@||@com  Fri May 24 17:20:52 2019
From: @@r@h@go@|ee @end|ng |rom gm@||@com (Sarah Goslee)
Date: Fri, 24 May 2019 11:20:52 -0400
Subject: [R-sig-Geo] GRID based calculations
In-Reply-To: <38841871558614001@myt6-23299ba78d64.qloud-c.yandex.net>
References: <38841871558614001@myt6-23299ba78d64.qloud-c.yandex.net>
Message-ID: <CAM_vjunZOdfRQgiokao7rFafA8FKzM596i1xwk_o9s+YEb+Dfg@mail.gmail.com>

Hi,

You probably haven't gotten any answers because this is an extremely
vague question, and a problem not very well suited for R.

You could do the preliminary calculations in R, but other GIS software
is more suited to the point and click model.

If you run into specific problems with R code, we can certainly help,
but with a question this general all I can really suggest are
a. Lots of time with google.
b. Looking at similar applications developed by other people.
c. Hiring a GIS programmer.

Best,
Sarah

On Thu, May 23, 2019 at 8:20 AM Fatih Kara <msfkara at yandex.com> wrote:
>
> Hi,
>
> We are developing a grid based database which provides several types of data. One of the layers in this database will be land cover data with 30 land cover types. Our grids will cover almost 90 pixels and our purpose is that if someone click on the grid, percentage of land cover types should be seen automatically like 20% forest, 30% water, and 50% grass.
>
> What should we do? Is there any related code samples?
>
> Thanks
> --
> Fatih Kara
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



-- 
Sarah Goslee (she/her)
http://www.numberwright.com


From pur@n|k@@m|th@ @end|ng |rom gm@||@com  Fri May 24 19:47:10 2019
From: pur@n|k@@m|th@ @end|ng |rom gm@||@com (Amitha Puranik)
Date: Fri, 24 May 2019 23:17:10 +0530
Subject: [R-sig-Geo] Error while using predict.sarlm
Message-ID: <CANcbSEjtyYqgjGxRsq-a79QeVPuRZBv9zFKOAe3yPZD1fO-9Yg@mail.gmail.com>

I am facing an error while using predict.sarlm to make predictions for spatial
lag model generated using lagsarlm. I used the following code:

predicted = predict(fit.lag, listw=weightmatrix, newdata=missed_data,
pred.type="TS", zero.policy = T)

For the argument newdata, I have passed the same data missed_data which I
used to fit the spatial lag model.

When I run the above code, I get the following error message: ?Error in
predict.sarlm(fit.lag, listw = weightmatrix, newdata = missed_data,  :
mismatch between newdata and spatial weights. newdata should have region.id
as row.names?

I have obtained the weight matrix from the function below

weightMat <- function(shp){

  dnb <- knearneigh(coordinates(shp), k=4)

  dnb <- knn2nb(dnb) #create nb

  lw <- nb2listw(dnb, style="W",zero.policy=TRUE) #create lw

  return(lw)

}

To cross check and make sure there are no discrepancies, I have run the
following lines

length(weightmatrix$weights)

nrow(missed_data)

nrow(coordinates(shape))

For all the codes above, the result is 182, which is the sample size of
data.

Can anyone offer me some guidance in solving this problem? Thanks for your
help.


       Thanks & regards,

*Amitha Puranik*

Assistant Professor,

Department of Statistics, PSPH

Phone:0820-2922407
Address:Department of Statistics,

Health Sciences Library, Level 6,

Manipal Academy of Higher Education,Manipal,Karnataka,India

An Institute of Eminence (Status Accorded by MHRD)

	[[alternative HTML version deleted]]


From tom@heng| @end|ng |rom gm@||@com  Sat May 25 00:25:15 2019
From: tom@heng| @end|ng |rom gm@||@com (Tomislav Hengl)
Date: Fri, 24 May 2019 23:25:15 +0100
Subject: [R-sig-Geo] Landmap package - automated mapping using Ensemble
 Machine Learning
Message-ID: <d524fa71-c63f-e60b-d07a-60474b2da787@gmail.com>


I've wrapped functions extending #SuperLearner and #subsemble R pkgs 
(Ensemble Machine Learning) which now can be used to generate Spatial 
Predictions (fully automated framework, requires no special 
geostatistical assumptions or choices). You can install the working 
package from:

https://github.com/Envirometrix/landmap

The general method is explained in https://peerj.com/articles/5518/

The package can also be used to download some of the 2TB GeoTiffs 
available via https://openlandmap.org.

Contributions and comments are welcome.

Few things I am still struggling with are:

1. Deriving prediction errors and predictions intervals 
(https://github.com/Envirometrix/landmap/blob/master/R/train.spLearner.R#L252),
2. Generating spatial simulations using EML models,
3. Building models with larger data sets e.g. >>1000 points,

Thanks in advance,

Tom Hengl
https://opengeohub.org/people/tom-hengl


From Roger@B|v@nd @end|ng |rom nhh@no  Sat May 25 18:18:50 2019
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Sat, 25 May 2019 18:18:50 +0200
Subject: [R-sig-Geo] Error while using predict.sarlm
In-Reply-To: <CANcbSEjtyYqgjGxRsq-a79QeVPuRZBv9zFKOAe3yPZD1fO-9Yg@mail.gmail.com>
References: <CANcbSEjtyYqgjGxRsq-a79QeVPuRZBv9zFKOAe3yPZD1fO-9Yg@mail.gmail.com>
Message-ID: <alpine.LFD.2.21.1905251754280.8813@reclus.nhh.no>

On Fri, 24 May 2019, Amitha Puranik wrote:

> I am facing an error while using predict.sarlm to make predictions for spatial
> lag model generated using lagsarlm. I used the following code:
>
> predicted = predict(fit.lag, listw=weightmatrix, newdata=missed_data,
> pred.type="TS", zero.policy = T)
>
> For the argument newdata, I have passed the same data missed_data which I
> used to fit the spatial lag model.
>
> When I run the above code, I get the following error message: ?Error in
> predict.sarlm(fit.lag, listw = weightmatrix, newdata = missed_data,  :
> mismatch between newdata and spatial weights. newdata should have region.id
> as row.names?

The predict method has to identify the weights applying to the newdata. So 
it uses the region.id attribute of the neighbour object, and the row.names 
of the newdata object. If they do not match, it error-exits. If shp below 
was read in the typical way, the default region.id may be the FID of the 
input file (0, ..., (n-1)), but the default row.names of newdata may be 1, 
..., n.

For example:

> library(sf)
Linking to GEOS 3.7.2, GDAL 3.0.0, PROJ 6.1.0
> boston_506 <- st_read(system.file(
+                                   "shapes/boston_tracts.shp",
+                                   package="spData")[1])
Reading layer `boston_tracts' from data source 
`/home/rsb/lib/r_libs/spData/shapes/boston_tracts.shp' using driver `ESRI 
Shapefile'
Simple feature collection with 506 features and 36 fields
geometry type:  POLYGON
dimension:      XY
bbox:           xmin: -71.52311 ymin: 42.00305 xmax: -70.63823 ymax: 
42.67307
epsg (SRID):    4267
proj4string:    +proj=longlat +datum=NAD27 +no_defs
> nb_q <- spdep::poly2nb(boston_506)
> lw_q <- spdep::nb2listw(nb_q, style="W")
> boston_489 <- boston_506[!is.na(boston_506$median),]
> nb_q_489 <- spdep::poly2nb(boston_489)
> lw_q_489 <- spdep::nb2listw(nb_q_489, style="W", zero.policy=TRUE)
> form <- formula(log(median) ~ CRIM + ZN + INDUS + CHAS +
+                 I((NOX*10)^2) + I(RM^2) + AGE + log(DIS) +
+                 log(RAD) + TAX + PTRATIO + I(BB/100) +
+                 log(I(LSTAT/100)))
> suppressPackageStartupMessages(library(spatialreg))
>
> eigs_489 <- eigenw(lw_q_489)
>
> SLM_489 <- lagsarlm(form, data=boston_489,
+           listw=lw_q_489, zero.policy=TRUE,
+           control=list(pre_eig=eigs_489))
>
> nd <- boston_506[is.na(boston_506$median),]
> t0 <- exp(predict(SLM_489, newdata=nd, listw=lw_q,
+                   pred.type="TS", zero.policy=TRUE))
> str(attr(lw_q, "region.id"))
  chr [1:506] "1" "2" "3" "4" "5" "6" "7" "8" "9" "10" "11" "12" "13" "14" 
"15" "16" ...
> str(row.names(nd))
  chr [1:17] "13" "14" "15" "17" "43" "50" "312" "313" "314" "317" "337" 
"346" "355" ...
> all(row.names(nd) %in% attr(lw_q, "region.id"))
[1] TRUE
# introduce a wrong row.name
> row.names(nd)[1] <- "0"
> all(row.names(nd) %in% attr(lw_q, "region.id"))
[1] FALSE
> t0 <- exp(predict(SLM_489, newdata=nd, listw=lw_q,
+                   pred.type="TS", zero.policy=TRUE))
Error in predict.sarlm(SLM_489, newdata = nd, listw = lw_q,
   pred.type = "TS",  :
   mismatch between newdata and spatial weights. newdata should have
   region.id as row.names

In this case, the row.names of the input object to spdep::poly2nb() and 
the region.id matched, as the newdata were subsetted from the same object. 
We don't know the values for your data, but you should be able to check 
them. It is important that they align the data with the weights correctly 
for obvious reasons.

Hope this helps,

Roger

>
> I have obtained the weight matrix from the function below
>
> weightMat <- function(shp){
>
>  dnb <- knearneigh(coordinates(shp), k=4)
>
>  dnb <- knn2nb(dnb) #create nb
>
>  lw <- nb2listw(dnb, style="W",zero.policy=TRUE) #create lw
>
>  return(lw)
>
> }
>
> To cross check and make sure there are no discrepancies, I have run the
> following lines
>
> length(weightmatrix$weights)
>
> nrow(missed_data)
>
> nrow(coordinates(shape))
>
> For all the codes above, the result is 182, which is the sample size of
> data.
>
> Can anyone offer me some guidance in solving this problem? Thanks for your
> help.
>
>
>       Thanks & regards,
>
> *Amitha Puranik*
>
> Assistant Professor,
>
> Department of Statistics, PSPH
>
> Phone:0820-2922407
> Address:Department of Statistics,
>
> Health Sciences Library, Level 6,
>
> Manipal Academy of Higher Education,Manipal,Karnataka,India
>
> An Institute of Eminence (Status Accorded by MHRD)
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

From pur@n|k@@m|th@ @end|ng |rom gm@||@com  Sun May 26 18:22:26 2019
From: pur@n|k@@m|th@ @end|ng |rom gm@||@com (Amitha Puranik)
Date: Sun, 26 May 2019 21:52:26 +0530
Subject: [R-sig-Geo] Error while using predict.sarlm
In-Reply-To: <alpine.LFD.2.21.1905251754280.8813@reclus.nhh.no>
References: <CANcbSEjtyYqgjGxRsq-a79QeVPuRZBv9zFKOAe3yPZD1fO-9Yg@mail.gmail.com>
 <alpine.LFD.2.21.1905251754280.8813@reclus.nhh.no>
Message-ID: <CANcbSEi0FR1mqEVGkVQo56-1jxSz1=JsJSTMzLtJ3WtNrTmcQw@mail.gmail.com>

Dear Prof. Roger Bivand,

Thanks a lot for providing a clarification for my query.
I used the following code and found out that the region.id in listw object
and row.names of the data do not match.
> str(attr(weightmatrix, "region.id"))
 chr [1:182] "1" "2" "3" "4" "5" "6" "7" "8" "9" "10" "11" "12" "13" "14"
"15" "16" "17" ...
> str(row.names(missed_data))
 chr [1:182] "142" "108" "149" "76" "8" "71" "45" "75" "173" "119" "22"
"32" "156" "221" ...
> all(row.names(missed_data) %in% attr(weightmatrix, "region.id"))
[1] FALSE

 How can I change the row.names of my data 'missed_data' and align to the
listw object?


       Thanks & regards,

*Amitha Puranik*















On Sat, May 25, 2019 at 9:49 PM Roger Bivand <Roger.Bivand at nhh.no> wrote:

> On Fri, 24 May 2019, Amitha Puranik wrote:
>
> > I am facing an error while using predict.sarlm to make predictions for
> spatial
> > lag model generated using lagsarlm. I used the following code:
> >
> > predicted = predict(fit.lag, listw=weightmatrix, newdata=missed_data,
> > pred.type="TS", zero.policy = T)
> >
> > For the argument newdata, I have passed the same data missed_data which I
> > used to fit the spatial lag model.
> >
> > When I run the above code, I get the following error message: ?Error in
> > predict.sarlm(fit.lag, listw = weightmatrix, newdata = missed_data,  :
> > mismatch between newdata and spatial weights. newdata should have
> region.id
> > as row.names?
>
> The predict method has to identify the weights applying to the newdata. So
> it uses the region.id attribute of the neighbour object, and the
> row.names
> of the newdata object. If they do not match, it error-exits. If shp below
> was read in the typical way, the default region.id may be the FID of the
> input file (0, ..., (n-1)), but the default row.names of newdata may be 1,
> ..., n.
>
> For example:
>
> > library(sf)
> Linking to GEOS 3.7.2, GDAL 3.0.0, PROJ 6.1.0
> > boston_506 <- st_read(system.file(
> +                                   "shapes/boston_tracts.shp",
> +                                   package="spData")[1])
> Reading layer `boston_tracts' from data source
> `/home/rsb/lib/r_libs/spData/shapes/boston_tracts.shp' using driver `ESRI
> Shapefile'
> Simple feature collection with 506 features and 36 fields
> geometry type:  POLYGON
> dimension:      XY
> bbox:           xmin: -71.52311 ymin: 42.00305 xmax: -70.63823 ymax:
> 42.67307
> epsg (SRID):    4267
> proj4string:    +proj=longlat +datum=NAD27 +no_defs
> > nb_q <- spdep::poly2nb(boston_506)
> > lw_q <- spdep::nb2listw(nb_q, style="W")
> > boston_489 <- boston_506[!is.na(boston_506$median),]
> > nb_q_489 <- spdep::poly2nb(boston_489)
> > lw_q_489 <- spdep::nb2listw(nb_q_489, style="W", zero.policy=TRUE)
> > form <- formula(log(median) ~ CRIM + ZN + INDUS + CHAS +
> +                 I((NOX*10)^2) + I(RM^2) + AGE + log(DIS) +
> +                 log(RAD) + TAX + PTRATIO + I(BB/100) +
> +                 log(I(LSTAT/100)))
> > suppressPackageStartupMessages(library(spatialreg))
> >
> > eigs_489 <- eigenw(lw_q_489)
> >
> > SLM_489 <- lagsarlm(form, data=boston_489,
> +           listw=lw_q_489, zero.policy=TRUE,
> +           control=list(pre_eig=eigs_489))
> >
> > nd <- boston_506[is.na(boston_506$median),]
> > t0 <- exp(predict(SLM_489, newdata=nd, listw=lw_q,
> +                   pred.type="TS", zero.policy=TRUE))
> > str(attr(lw_q, "region.id"))
>   chr [1:506] "1" "2" "3" "4" "5" "6" "7" "8" "9" "10" "11" "12" "13" "14"
> "15" "16" ...
> > str(row.names(nd))
>   chr [1:17] "13" "14" "15" "17" "43" "50" "312" "313" "314" "317" "337"
> "346" "355" ...
> > all(row.names(nd) %in% attr(lw_q, "region.id"))
> [1] TRUE
> # introduce a wrong row.name
> > row.names(nd)[1] <- "0"
> > all(row.names(nd) %in% attr(lw_q, "region.id"))
> [1] FALSE
> > t0 <- exp(predict(SLM_489, newdata=nd, listw=lw_q,
> +                   pred.type="TS", zero.policy=TRUE))
> Error in predict.sarlm(SLM_489, newdata = nd, listw = lw_q,
>    pred.type = "TS",  :
>    mismatch between newdata and spatial weights. newdata should have
>    region.id as row.names
>
> In this case, the row.names of the input object to spdep::poly2nb() and
> the region.id matched, as the newdata were subsetted from the same
> object.
> We don't know the values for your data, but you should be able to check
> them. It is important that they align the data with the weights correctly
> for obvious reasons.
>
> Hope this helps,
>
> Roger
>
> >
> > I have obtained the weight matrix from the function below
> >
> > weightMat <- function(shp){
> >
> >  dnb <- knearneigh(coordinates(shp), k=4)
> >
> >  dnb <- knn2nb(dnb) #create nb
> >
> >  lw <- nb2listw(dnb, style="W",zero.policy=TRUE) #create lw
> >
> >  return(lw)
> >
> > }
> >
> > To cross check and make sure there are no discrepancies, I have run the
> > following lines
> >
> > length(weightmatrix$weights)
> >
> > nrow(missed_data)
> >
> > nrow(coordinates(shape))
> >
> > For all the codes above, the result is 182, which is the sample size of
> > data.
> >
> > Can anyone offer me some guidance in solving this problem? Thanks for
> your
> > help.
> >
> >
> >       Thanks & regards,
> >
> > *Amitha Puranik*
> >
> > Assistant Professor,
> >
> > Department of Statistics, PSPH
> >
> > Phone:0820-2922407
> > Address:Department of Statistics,
> >
> > Health Sciences Library, Level 6,
> >
> > Manipal Academy of Higher Education,Manipal,Karnataka,India
> >
> > An Institute of Eminence (Status Accorded by MHRD)
> >
> >       [[alternative HTML version deleted]]
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
>
> --
> Roger Bivand
> Department of Economics, Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
> https://orcid.org/0000-0003-2392-6140
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

	[[alternative HTML version deleted]]


From pur@n|k@@m|th@ @end|ng |rom gm@||@com  Sun May 26 18:37:13 2019
From: pur@n|k@@m|th@ @end|ng |rom gm@||@com (Amitha Puranik)
Date: Sun, 26 May 2019 22:07:13 +0530
Subject: [R-sig-Geo] Error while using predict.sarlm
In-Reply-To: <CANcbSEi0FR1mqEVGkVQo56-1jxSz1=JsJSTMzLtJ3WtNrTmcQw@mail.gmail.com>
References: <CANcbSEjtyYqgjGxRsq-a79QeVPuRZBv9zFKOAe3yPZD1fO-9Yg@mail.gmail.com>
 <alpine.LFD.2.21.1905251754280.8813@reclus.nhh.no>
 <CANcbSEi0FR1mqEVGkVQo56-1jxSz1=JsJSTMzLtJ3WtNrTmcQw@mail.gmail.com>
Message-ID: <CANcbSEhFMSH3hQ8zAFTQVdXtYJ4Pkm-BC2TWOYqBLyxA5e9EBQ@mail.gmail.com>

Dear Prof. Roger Bivand,

I was able to sort the error by using the 'row.names' argument in the
knn2nb function. I extracted the ID variable from my data and passed that
as input for row.names. Now when I checked I got the following.
> str(attr(weightmatrix, "region.id"))
 int [1:182] 16144 16007 16151 15910 15785 15829 16157 15909 16223 16097 ...
> str(row.names(missed_data))
 chr [1:182] "16144" "16007" "16151" "15910" "15785" "15829" "16157"
"15909" "16223" ...
> all(row.names(missed_data) %in% attr(weightmatrix, "region.id"))
[1] TRUE

I am now successfully able to use the predict.sarlm function. Thanks a ton
for your help!!


       Thanks & regards,

*Amitha Puranik*
















On Sun, May 26, 2019 at 9:52 PM Amitha Puranik <puranik.amitha at gmail.com>
wrote:

> Dear Prof. Roger Bivand,
>
> Thanks a lot for providing a clarification for my query.
> I used the following code and found out that the region.id in listw
> object and row.names of the data do not match.
> > str(attr(weightmatrix, "region.id"))
>  chr [1:182] "1" "2" "3" "4" "5" "6" "7" "8" "9" "10" "11" "12" "13" "14"
> "15" "16" "17" ...
> > str(row.names(missed_data))
>  chr [1:182] "142" "108" "149" "76" "8" "71" "45" "75" "173" "119" "22"
> "32" "156" "221" ...
> > all(row.names(missed_data) %in% attr(weightmatrix, "region.id"))
> [1] FALSE
>
>  How can I change the row.names of my data 'missed_data' and align to the
> listw object?
>
>
>        Thanks & regards,
>
> *Amitha Puranik*
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
> On Sat, May 25, 2019 at 9:49 PM Roger Bivand <Roger.Bivand at nhh.no> wrote:
>
>> On Fri, 24 May 2019, Amitha Puranik wrote:
>>
>> > I am facing an error while using predict.sarlm to make predictions for
>> spatial
>> > lag model generated using lagsarlm. I used the following code:
>> >
>> > predicted = predict(fit.lag, listw=weightmatrix, newdata=missed_data,
>> > pred.type="TS", zero.policy = T)
>> >
>> > For the argument newdata, I have passed the same data missed_data which
>> I
>> > used to fit the spatial lag model.
>> >
>> > When I run the above code, I get the following error message: ?Error in
>> > predict.sarlm(fit.lag, listw = weightmatrix, newdata = missed_data,  :
>> > mismatch between newdata and spatial weights. newdata should have
>> region.id
>> > as row.names?
>>
>> The predict method has to identify the weights applying to the newdata.
>> So
>> it uses the region.id attribute of the neighbour object, and the
>> row.names
>> of the newdata object. If they do not match, it error-exits. If shp below
>> was read in the typical way, the default region.id may be the FID of the
>> input file (0, ..., (n-1)), but the default row.names of newdata may be
>> 1,
>> ..., n.
>>
>> For example:
>>
>> > library(sf)
>> Linking to GEOS 3.7.2, GDAL 3.0.0, PROJ 6.1.0
>> > boston_506 <- st_read(system.file(
>> +                                   "shapes/boston_tracts.shp",
>> +                                   package="spData")[1])
>> Reading layer `boston_tracts' from data source
>> `/home/rsb/lib/r_libs/spData/shapes/boston_tracts.shp' using driver `ESRI
>> Shapefile'
>> Simple feature collection with 506 features and 36 fields
>> geometry type:  POLYGON
>> dimension:      XY
>> bbox:           xmin: -71.52311 ymin: 42.00305 xmax: -70.63823 ymax:
>> 42.67307
>> epsg (SRID):    4267
>> proj4string:    +proj=longlat +datum=NAD27 +no_defs
>> > nb_q <- spdep::poly2nb(boston_506)
>> > lw_q <- spdep::nb2listw(nb_q, style="W")
>> > boston_489 <- boston_506[!is.na(boston_506$median),]
>> > nb_q_489 <- spdep::poly2nb(boston_489)
>> > lw_q_489 <- spdep::nb2listw(nb_q_489, style="W", zero.policy=TRUE)
>> > form <- formula(log(median) ~ CRIM + ZN + INDUS + CHAS +
>> +                 I((NOX*10)^2) + I(RM^2) + AGE + log(DIS) +
>> +                 log(RAD) + TAX + PTRATIO + I(BB/100) +
>> +                 log(I(LSTAT/100)))
>> > suppressPackageStartupMessages(library(spatialreg))
>> >
>> > eigs_489 <- eigenw(lw_q_489)
>> >
>> > SLM_489 <- lagsarlm(form, data=boston_489,
>> +           listw=lw_q_489, zero.policy=TRUE,
>> +           control=list(pre_eig=eigs_489))
>> >
>> > nd <- boston_506[is.na(boston_506$median),]
>> > t0 <- exp(predict(SLM_489, newdata=nd, listw=lw_q,
>> +                   pred.type="TS", zero.policy=TRUE))
>> > str(attr(lw_q, "region.id"))
>>   chr [1:506] "1" "2" "3" "4" "5" "6" "7" "8" "9" "10" "11" "12" "13"
>> "14"
>> "15" "16" ...
>> > str(row.names(nd))
>>   chr [1:17] "13" "14" "15" "17" "43" "50" "312" "313" "314" "317" "337"
>> "346" "355" ...
>> > all(row.names(nd) %in% attr(lw_q, "region.id"))
>> [1] TRUE
>> # introduce a wrong row.name
>> > row.names(nd)[1] <- "0"
>> > all(row.names(nd) %in% attr(lw_q, "region.id"))
>> [1] FALSE
>> > t0 <- exp(predict(SLM_489, newdata=nd, listw=lw_q,
>> +                   pred.type="TS", zero.policy=TRUE))
>> Error in predict.sarlm(SLM_489, newdata = nd, listw = lw_q,
>>    pred.type = "TS",  :
>>    mismatch between newdata and spatial weights. newdata should have
>>    region.id as row.names
>>
>> In this case, the row.names of the input object to spdep::poly2nb() and
>> the region.id matched, as the newdata were subsetted from the same
>> object.
>> We don't know the values for your data, but you should be able to check
>> them. It is important that they align the data with the weights correctly
>> for obvious reasons.
>>
>> Hope this helps,
>>
>> Roger
>>
>> >
>> > I have obtained the weight matrix from the function below
>> >
>> > weightMat <- function(shp){
>> >
>> >  dnb <- knearneigh(coordinates(shp), k=4)
>> >
>> >  dnb <- knn2nb(dnb) #create nb
>> >
>> >  lw <- nb2listw(dnb, style="W",zero.policy=TRUE) #create lw
>> >
>> >  return(lw)
>> >
>> > }
>> >
>> > To cross check and make sure there are no discrepancies, I have run the
>> > following lines
>> >
>> > length(weightmatrix$weights)
>> >
>> > nrow(missed_data)
>> >
>> > nrow(coordinates(shape))
>> >
>> > For all the codes above, the result is 182, which is the sample size of
>> > data.
>> >
>> > Can anyone offer me some guidance in solving this problem? Thanks for
>> your
>> > help.
>> >
>> >
>> >       Thanks & regards,
>> >
>> > *Amitha Puranik*
>> >
>> > Assistant Professor,
>> >
>> > Department of Statistics, PSPH
>> >
>> > Phone:0820-2922407
>> > Address:Department of Statistics,
>> >
>> > Health Sciences Library, Level 6,
>> >
>> > Manipal Academy of Higher Education,Manipal,Karnataka,India
>> >
>> > An Institute of Eminence (Status Accorded by MHRD)
>> >
>> >       [[alternative HTML version deleted]]
>> >
>> > _______________________________________________
>> > R-sig-Geo mailing list
>> > R-sig-Geo at r-project.org
>> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> >
>>
>> --
>> Roger Bivand
>> Department of Economics, Norwegian School of Economics,
>> Helleveien 30, N-5045 Bergen, Norway.
>> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
>> https://orcid.org/0000-0003-2392-6140
>> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>
>

	[[alternative HTML version deleted]]


From th|_ve|o@o @end|ng |rom y@hoo@com@br  Mon May 27 01:43:25 2019
From: th|_ve|o@o @end|ng |rom y@hoo@com@br (Thiago V. dos Santos)
Date: Sun, 26 May 2019 23:43:25 +0000 (UTC)
Subject: [R-sig-Geo] GDAL 3.0.0 and rgdal?
References: <1092883114.7943734.1558914205196.ref@mail.yahoo.com>
Message-ID: <1092883114.7943734.1558914205196@mail.yahoo.com>

Dear all,
Yesterday I replaced GDAL v2.4.1 with the latest v3.0.0 on my Linux server. Then, when I tried to reinstall rgdal, I got an error due to wrong system requirements: rgdal requires GDAL between versions 1.11.4 and 2.5.0.
Therefore, I am wondering: are there plans for rgdal to support GDAL 3.0.0 in the next few days? I like to be up-to-date with GIS software, but I don't really need to use GDAL 3.0.0 at all. If it is going to be a little while until it is supported by rgdal, I can happily revert back to v2.4.1.
Thanks,?-- Thiago V. dos Santos
Postdoctoral Research FellowDepartment of Climate and Space Science and EngineeringUniversity of Michigan
	[[alternative HTML version deleted]]


From edzer@pebe@m@ @end|ng |rom un|-muen@ter@de  Mon May 27 08:00:39 2019
From: edzer@pebe@m@ @end|ng |rom un|-muen@ter@de (Edzer Pebesma)
Date: Mon, 27 May 2019 08:00:39 +0200
Subject: [R-sig-Geo] GDAL 3.0.0 and rgdal?
In-Reply-To: <1092883114.7943734.1558914205196@mail.yahoo.com>
References: <1092883114.7943734.1558914205196.ref@mail.yahoo.com>
 <1092883114.7943734.1558914205196@mail.yahoo.com>
Message-ID: <94348c30-36d0-7073-8287-a3365168f1e5@uni-muenster.de>

The development version installs with GDAL 3, try

install.packages("rgdal", repos="http://R-Forge.R-project.org")


On 5/27/19 1:43 AM, Thiago V. dos Santos via R-sig-Geo wrote:
> Dear all,
> Yesterday I replaced GDAL v2.4.1 with the latest v3.0.0 on my Linux server. Then, when I tried to reinstall rgdal, I got an error due to wrong system requirements: rgdal requires GDAL between versions 1.11.4 and 2.5.0.
> Therefore, I am wondering: are there plans for rgdal to support GDAL 3.0.0 in the next few days? I like to be up-to-date with GIS software, but I don't really need to use GDAL 3.0.0 at all. If it is going to be a little while until it is supported by rgdal, I can happily revert back to v2.4.1.
> Thanks,?-- Thiago V. dos Santos
> Postdoctoral Research FellowDepartment of Climate and Space Science and EngineeringUniversity of Michigan
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics
Heisenbergstrasse 2, 48151 Muenster, Germany
Phone: +49 251 8333081

-------------- next part --------------
A non-text attachment was scrubbed...
Name: pEpkey.asc
Type: application/pgp-keys
Size: 2472 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20190527/26220800/attachment.bin>

From Roger@B|v@nd @end|ng |rom nhh@no  Mon May 27 12:31:06 2019
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Mon, 27 May 2019 12:31:06 +0200
Subject: [R-sig-Geo] GDAL 3.0.0 and rgdal?
In-Reply-To: <94348c30-36d0-7073-8287-a3365168f1e5@uni-muenster.de>
References: <1092883114.7943734.1558914205196.ref@mail.yahoo.com>
 <1092883114.7943734.1558914205196@mail.yahoo.com>
 <94348c30-36d0-7073-8287-a3365168f1e5@uni-muenster.de>
Message-ID: <alpine.LFD.2.21.1905271230420.29256@reclus.nhh.no>

On Mon, 27 May 2019, Edzer Pebesma wrote:

> The development version installs with GDAL 3, try
>
> install.packages("rgdal", repos="http://R-Forge.R-project.org")
>

I'll try to submit to CRAN this week.

Roger

>
> On 5/27/19 1:43 AM, Thiago V. dos Santos via R-sig-Geo wrote:
>> Dear all,
>> Yesterday I replaced GDAL v2.4.1 with the latest v3.0.0 on my Linux server. Then, when I tried to reinstall rgdal, I got an error due to wrong system requirements: rgdal requires GDAL between versions 1.11.4 and 2.5.0.
>> Therefore, I am wondering: are there plans for rgdal to support GDAL 3.0.0 in the next few days? I like to be up-to-date with GIS software, but I don't really need to use GDAL 3.0.0 at all. If it is going to be a little while until it is supported by rgdal, I can happily revert back to v2.4.1.
>> Thanks,?-- Thiago V. dos Santos
>> Postdoctoral Research FellowDepartment of Climate and Space Science and EngineeringUniversity of Michigan
>> 	[[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

From th|_ve|o@o @end|ng |rom y@hoo@com@br  Mon May 27 15:40:13 2019
From: th|_ve|o@o @end|ng |rom y@hoo@com@br (Thiago V. dos Santos)
Date: Mon, 27 May 2019 13:40:13 +0000 (UTC)
Subject: [R-sig-Geo] GDAL 3.0.0 and rgdal?
In-Reply-To: <alpine.LFD.2.21.1905271230420.29256@reclus.nhh.no>
References: <1092883114.7943734.1558914205196.ref@mail.yahoo.com>
 <1092883114.7943734.1558914205196@mail.yahoo.com>
 <94348c30-36d0-7073-8287-a3365168f1e5@uni-muenster.de>
 <alpine.LFD.2.21.1905271230420.29256@reclus.nhh.no>
Message-ID: <1601962525.8126669.1558964413880@mail.yahoo.com>

Thanks for the feedback Edzer and Roger. The development version indeed works fine with GDAL 3.


Sent from Yahoo Mail for iPhone


On Monday, May 27, 2019, 6:31 AM, Roger Bivand <Roger.Bivand at nhh.no> wrote:

On Mon, 27 May 2019, Edzer Pebesma wrote:

> The development version installs with GDAL 3, try
>
> install.packages("rgdal", repos="http://R-Forge.R-project.org")
>

I'll try to submit to CRAN this week.

Roger

>
> On 5/27/19 1:43 AM, Thiago V. dos Santos via R-sig-Geo wrote:
>> Dear all,
>> Yesterday I replaced GDAL v2.4.1 with the latest v3.0.0 on my Linux server. Then, when I tried to reinstall rgdal, I got an error due to wrong system requirements: rgdal requires GDAL between versions 1.11.4 and 2.5.0.
>> Therefore, I am wondering: are there plans for rgdal to support GDAL 3.0.0 in the next few days? I like to be up-to-date with GIS software, but I don't really need to use GDAL 3.0.0 at all. If it is going to be a little while until it is supported by rgdal, I can happily revert back to v2.4.1.
>> Thanks,?-- Thiago V. dos Santos
>> Postdoctoral Research FellowDepartment of Climate and Space Science and EngineeringUniversity of Michigan
>> ??? [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo




	[[alternative HTML version deleted]]


From r@ph@e|@me@| @end|ng |rom y@hoo@de  Mon May 27 21:45:04 2019
From: r@ph@e|@me@| @end|ng |rom y@hoo@de (Raphael Mesaric)
Date: Mon, 27 May 2019 21:45:04 +0200
Subject: [R-sig-Geo] Question spdep package - aliased variables and NA
 z-values
Message-ID: <4BF11DC6-71AD-4B97-8587-64E04B9C1E4A@yahoo.de>

Dear all,

My model consists of observations for all four seasons, and each of the seasons is analyzed with respect to five different time slots. All of these observations are referring to the same grid, which means that my neighborhood matrix is repeated twenty times (I took the neighborhood matrix of the original grid and modified the entries in such a way that I have a diagonal matrix where each diagonal block entry consists of the original neighborhood object, with adjusted values).

I recently run my model with the errorsarlm() and lagsarlm() functions. It worked fine, and the results coincide well with the linear regression results, which is great. However, there are a few other strange things:

In the lag-model, I have only estimates for some variables, but the z-value is indicated as NA (for the error model it works fine).
After running the SAR models, R tells me that the two dummy variables for the seasons are aliased. However, in the linear regression I did not have any problems, and the variables are not correlated.

I think the second issue might be related to the fact that the number of observations seems to correspond to the number of observations for one season, instead of all four seasons. In other words, it looks like R has realized that the neighborhood repeats itself for each season. Interestingly enough, R has not realized that the pattern repeats itself inside the seasons as well for the time slots.

Or is there another possible reason for the fact that the number of observations corresponds to only one fourth of all the observations actually included?

Has anybody experienced these issues as well? Any idea on how to resolve these problems would be greatly appreciated.

Thank you in advance!

Best regards,

Raphael Mesaric
	[[alternative HTML version deleted]]


From hugo@gco@t@ @end|ng |rom gm@||@com  Mon May 27 22:59:49 2019
From: hugo@gco@t@ @end|ng |rom gm@||@com (Hugo Costa)
Date: Mon, 27 May 2019 21:59:49 +0100
Subject: [R-sig-Geo] Reproducible results with overlay and clusterR
Message-ID: <CADvFi5oiFqffYCM4QmLEtuWD=Lj6_EgY1+XW=e10qEsGHUi2xg@mail.gmail.com>

Dear all
I need to implement a raster::overlay operation with clusterR (which
works), but don't figure out how to do it reproducible. How to set seeds in
the cluster? Please find a example below.
Thank you
Hugo

## Rasters
library(raster)
r1 <- r2 <- raster()
r1[]<-runif(ncell(r1), 1, 100)
r2[]<-1
r2[1:30000]<-2
r2[30001:35000]<-NA
plot(stack(r1,r2))


## Function
prob<-data.frame(value=1:100, r1=log(1:100), r2=max(log(1:100))-log(1:100))
f <- function(x,y,...){
  ifelse(is.na(y),NA,rbinom(n=1, size=1, prob=prob[[y]][x]))
}
f <- Vectorize(f)

## Overlay (reproducible)
set.seed(0)
result1<-overlay(stack(r1,r2), fun=f)
set.seed(0)
result2<-overlay(stack(r1,r2), fun=f)
compareRaster(result1,result2,values=TRUE)

## Cluster overlay (Not reproducible)
set.seed((0))
beginCluster(2)
result3<-clusterR(stack(r1,r2),overlay,args=list(fun=f), export="prob")
endCluster()

set.seed((0))
beginCluster(2)
result4<-clusterR(stack(r1,r2),overlay,args=list(fun=f), export="prob")
endCluster()

compareRaster(result3,result4,values=TRUE)

	[[alternative HTML version deleted]]


From @|ex@ndre@@nto@br @end|ng |rom y@hoo@com@br  Tue May 28 03:47:44 2019
From: @|ex@ndre@@nto@br @end|ng |rom y@hoo@com@br (ASANTOS)
Date: Mon, 27 May 2019 21:47:44 -0400
Subject: [R-sig-Geo] Parallel processing with extract()/randomForest() in VM
In-Reply-To: <76feef44-71ff-990d-2c5c-67cabe09a4f5@yahoo.com.br>
References: <76feef44-71ff-990d-2c5c-67cabe09a4f5@yahoo.com.br>
Message-ID: <6b32af60-2f78-96b9-d829-111090f47615@yahoo.com.br>


Dear R-Sig-Geo Members,

 ?????? I create a virtual machine (VM) in Google Cloud with Ubuntu 18.04 
with 8 CPU and 30 RAM memory and R 3.6.0 version, but I try to improve 
my spatial analysis without success or same a more faster process. If I 
use packages snow and doMC with all the 8 CPU's in an operation, but it 
use in only 12,54% of our capacity, when the objective is user 
extraction() in raster and RF with randomForest(). The gain of 18 
seconds, I think that is not so good, then my question is there are any 
way for improve that? In my test, I make:

# Take in the ubuntu terminal the number of processors
foresteyebrazil at superforettech1:~$cat/proc/cpuinfo|grepprocess|wc-l
8
#Packages
library(raster)
library(snow)
library(doMC)
library(randomForest)
registerDoMC()
#Take a raster for worldclim
r<-getData('worldclim', var='alt', res=5)
# 1) Use extract()/ randomForest() in Virtual Machine 
----------------------------
start_time<-Sys.time()
# SpatialPolygons
cds1<-rbind(c(-180,-20), c(-160,5), c(-60, 0), c(-160,-60), c(-180,-20))
cds2<-rbind(c(80,0), c(100,60), c(120,0), c(120,-55), c(80,0))
polys<-spPolygons(cds1, cds2)
# Extract
exr<-raster::extract(r, polys)
tr<-ifelse(exr[[2]]<10,c("A"),c("B"))
df<-cbind(tr,exr[[2]], sqrt(exr[[2]]))
df2<-data.frame(as.factor(df[,1]),as.numeric(as.character(df[,2])),as.numeric(as.character(df[,3])))
df2<-df2[complete.cases(df2),]
colnames(df2)<-c("res1","var1","var2")
res<-NULL
for(win1:9){
mod_RF<-randomForest(x=cbind(df2$var1,df2$var2), y=df2$res1, ntree=100, 
mtry=2)
res=rbind(res,cbind(w,mean(mod_RF$err.rate[,1])*100))
}
end_time<-Sys.time()
end_time-start_time
#
#Time difference of 38.72528 secs
# 2) Use extract() with snow and doMC packages in Virtual Machine 
----------------------------
start_time<-Sys.time()
# SpatialPolygons
cds1<-rbind(c(-180,-20), c(-160,5), c(-60, 0), c(-160,-60), c(-180,-20))
cds2<-rbind(c(80,0), c(100,60), c(120,0), c(120,-55), c(80,0))
polys<-spPolygons(cds1, cds2)
# Extract
beginCluster(n=8)
exr<-raster::extract(r, polys)
tr<-ifelse(exr[[2]]<10,c("A"),c("B"))
df<-cbind(tr,exr[[2]], sqrt(exr[[2]]))
df2<-data.frame(as.factor(df[,1]),as.numeric(as.character(df[,2])),as.numeric(as.character(df[,3])))
df2<-df2[complete.cases(df2),]
colnames(df2)<-c("res1","var1","var2")
endCluster()
res<-NULL
mod_RF2<-foreach(1:9) %dopar%{
randomForest(x=cbind(df2$var1,df2$var2), y=df2$res1, ntree=100, mtry=2)
}
res=rbind(res,cbind(mean(mod_RF2$err.rate[,1])*100))
}
end_time<-Sys.time()
end_time-start_time
#
#Time difference of 20.57027 secs

Thanks in advanced,

-- 
======================================================================
Alexandre dos Santos
Prote????o Florestal
IFMT - Instituto Federal de Educa????o, Ci??ncia e Tecnologia de Mato Grosso
Campus C??ceres
Caixa Postal 244
Avenida dos Ramires, s/n
Bairro: Distrito Industrial
C??ceres - MT                      CEP: 78.200-000
Fone: (+55) 65 99686-6970 (VIVO) (+55) 65 3221-2674 (FIXO)

         alexandre.santos at cas.ifmt.edu.br  
Lattes:http://lattes.cnpq.br/1360403201088680
OrcID: orcid.org/0000-0001-8232-6722
Researchgate:www.researchgate.net/profile/Alexandre_Santos10                        
LinkedIn: br.linkedin.com/in/alexandre-dos-santos-87961635
Mendeley:www.mendeley.com/profiles/alexandre-dos-santos6/
======================================================================






	[[alternative HTML version deleted]]


From b|@|ev||@t @end|ng |rom gm@||@com  Tue May 28 07:15:03 2019
From: b|@|ev||@t @end|ng |rom gm@||@com (=?UTF-8?Q?Bede-Fazekas_=c3=81kos?=)
Date: Tue, 28 May 2019 07:15:03 +0200
Subject: [R-sig-Geo] Reproducible results with overlay and clusterR
In-Reply-To: <CADvFi5oiFqffYCM4QmLEtuWD=Lj6_EgY1+XW=e10qEsGHUi2xg@mail.gmail.com>
References: <CADvFi5oiFqffYCM4QmLEtuWD=Lj6_EgY1+XW=e10qEsGHUi2xg@mail.gmail.com>
Message-ID: <67d3915d-073e-0335-4207-3c3651b10c3b@gmail.com>

Dear Hugo,
please find below a solution. It might be too complicated and shorter 
solutions might exist, but it works.

library(raster)
r1 <- r2 <- raster()
r1[]<-runif(ncell(r1), 1, 100)
r2[]<-1
r2[1:30000]<-2
r2[30001:35000]<-NA
plot(stack(r1,r2))


## Function
prob<-data.frame(value=1:100, r1=log(1:100), r2=max(log(1:100))-log(1:100))
f <- function(x,y,seed,...){
 ? ifelse(is.na(y),NA,rbinom(n=1, size=1, prob=prob[[y]][x]))
}
f <- Vectorize(f)

## Wrapper function
wrapper <- function(raster,seed,...){
 ??? set.seed(seed)
 ??? overlay(raster,fun=f)
}

## Overlay (reproducible)
result1<-wrapper(stack(r1,r2),seed=0)
result2<-wrapper(stack(r1,r2),seed=0)
compareRaster(result1,result2,values=TRUE)

## Cluster overlay (Not reproducible)
beginCluster(2)
result3<-clusterR(stack(r1,r2),wrapper,args=list(seed=0), 
export=c("prob", "f"))
endCluster()

beginCluster(2)
result4<-clusterR(stack(r1,r2),wrapper,args=list(seed=0), 
export=c("prob", "f"))
endCluster()

compareRaster(result3,result4,values=TRUE)

HTH,
?kos Bede-Fazekas
Hungarian Academy of Sciences

2019.05.27. 22:59 keltez?ssel, Hugo Costa ?rta:
> Dear all
> I need to implement a raster::overlay operation with clusterR (which
> works), but don't figure out how to do it reproducible. How to set seeds in
> the cluster? Please find a example below.
> Thank you
> Hugo
>
> ## Rasters
> library(raster)
> r1 <- r2 <- raster()
> r1[]<-runif(ncell(r1), 1, 100)
> r2[]<-1
> r2[1:30000]<-2
> r2[30001:35000]<-NA
> plot(stack(r1,r2))
>
>
> ## Function
> prob<-data.frame(value=1:100, r1=log(1:100), r2=max(log(1:100))-log(1:100))
> f <- function(x,y,...){
>    ifelse(is.na(y),NA,rbinom(n=1, size=1, prob=prob[[y]][x]))
> }
> f <- Vectorize(f)
>
> ## Overlay (reproducible)
> set.seed(0)
> result1<-overlay(stack(r1,r2), fun=f)
> set.seed(0)
> result2<-overlay(stack(r1,r2), fun=f)
> compareRaster(result1,result2,values=TRUE)
>
> ## Cluster overlay (Not reproducible)
> set.seed((0))
> beginCluster(2)
> result3<-clusterR(stack(r1,r2),overlay,args=list(fun=f), export="prob")
> endCluster()
>
> set.seed((0))
> beginCluster(2)
> result4<-clusterR(stack(r1,r2),overlay,args=list(fun=f), export="prob")
> endCluster()
>
> compareRaster(result3,result4,values=TRUE)
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From b|@|ev||@t @end|ng |rom gm@||@com  Tue May 28 07:25:54 2019
From: b|@|ev||@t @end|ng |rom gm@||@com (=?UTF-8?Q?Bede-Fazekas_=c3=81kos?=)
Date: Tue, 28 May 2019 07:25:54 +0200
Subject: [R-sig-Geo] 
 Parallel processing with extract()/randomForest() in VM
In-Reply-To: <6b32af60-2f78-96b9-d829-111090f47615@yahoo.com.br>
References: <76feef44-71ff-990d-2c5c-67cabe09a4f5@yahoo.com.br>
 <6b32af60-2f78-96b9-d829-111090f47615@yahoo.com.br>
Message-ID: <4b9cd7a6-8748-edaf-31ce-b19a9d9ebab1@gmail.com>

Dear Asantos,

Instead of
exr<-raster::extract(r, polys)
you can use:

beginCluster(8)
exr<-raster::clusterR(x = r, fun = function (raster) {raster::extract(x 
= raster, y = polys)}, export = "polys")
endCluster()

HTH,
?kos Bede-Fazekas
Hungarian Academy of Sciences

2019.05.28. 3:47 keltez?ssel, ASANTOS via R-sig-Geo ?rta:
> Dear R-Sig-Geo Members,
>
>   ?????? I create a virtual machine (VM) in Google Cloud with Ubuntu 18.04
> with 8 CPU and 30 RAM memory and R 3.6.0 version, but I try to improve
> my spatial analysis without success or same a more faster process. If I
> use packages snow and doMC with all the 8 CPU's in an operation, but it
> use in only 12,54% of our capacity, when the objective is user
> extraction() in raster and RF with randomForest(). The gain of 18
> seconds, I think that is not so good, then my question is there are any
> way for improve that? In my test, I make:
>
> # Take in the ubuntu terminal the number of processors
> foresteyebrazil at superforettech1:~$cat/proc/cpuinfo|grepprocess|wc-l
> 8
> #Packages
> library(raster)
> library(snow)
> library(doMC)
> library(randomForest)
> registerDoMC()
> #Take a raster for worldclim
> r<-getData('worldclim', var='alt', res=5)
> # 1) Use extract()/ randomForest() in Virtual Machine
> ----------------------------
> start_time<-Sys.time()
> # SpatialPolygons
> cds1<-rbind(c(-180,-20), c(-160,5), c(-60, 0), c(-160,-60), c(-180,-20))
> cds2<-rbind(c(80,0), c(100,60), c(120,0), c(120,-55), c(80,0))
> polys<-spPolygons(cds1, cds2)
> # Extract
> exr<-raster::extract(r, polys)
> tr<-ifelse(exr[[2]]<10,c("A"),c("B"))
> df<-cbind(tr,exr[[2]], sqrt(exr[[2]]))
> df2<-data.frame(as.factor(df[,1]),as.numeric(as.character(df[,2])),as.numeric(as.character(df[,3])))
> df2<-df2[complete.cases(df2),]
> colnames(df2)<-c("res1","var1","var2")
> res<-NULL
> for(win1:9){
> mod_RF<-randomForest(x=cbind(df2$var1,df2$var2), y=df2$res1, ntree=100,
> mtry=2)
> res=rbind(res,cbind(w,mean(mod_RF$err.rate[,1])*100))
> }
> end_time<-Sys.time()
> end_time-start_time
> #
> #Time difference of 38.72528 secs
> # 2) Use extract() with snow and doMC packages in Virtual Machine
> ----------------------------
> start_time<-Sys.time()
> # SpatialPolygons
> cds1<-rbind(c(-180,-20), c(-160,5), c(-60, 0), c(-160,-60), c(-180,-20))
> cds2<-rbind(c(80,0), c(100,60), c(120,0), c(120,-55), c(80,0))
> polys<-spPolygons(cds1, cds2)
> # Extract
> beginCluster(n=8)
> exr<-raster::extract(r, polys)
> tr<-ifelse(exr[[2]]<10,c("A"),c("B"))
> df<-cbind(tr,exr[[2]], sqrt(exr[[2]]))
> df2<-data.frame(as.factor(df[,1]),as.numeric(as.character(df[,2])),as.numeric(as.character(df[,3])))
> df2<-df2[complete.cases(df2),]
> colnames(df2)<-c("res1","var1","var2")
> endCluster()
> res<-NULL
> mod_RF2<-foreach(1:9) %dopar%{
> randomForest(x=cbind(df2$var1,df2$var2), y=df2$res1, ntree=100, mtry=2)
> }
> res=rbind(res,cbind(mean(mod_RF2$err.rate[,1])*100))
> }
> end_time<-Sys.time()
> end_time-start_time
> #
> #Time difference of 20.57027 secs
>
> Thanks in advanced,
>


From hugo@gco@t@ @end|ng |rom gm@||@com  Tue May 28 10:14:24 2019
From: hugo@gco@t@ @end|ng |rom gm@||@com (Hugo Costa)
Date: Tue, 28 May 2019 09:14:24 +0100
Subject: [R-sig-Geo] Reproducible results with overlay and clusterR
In-Reply-To: <67d3915d-073e-0335-4207-3c3651b10c3b@gmail.com>
References: <CADvFi5oiFqffYCM4QmLEtuWD=Lj6_EgY1+XW=e10qEsGHUi2xg@mail.gmail.com>
 <67d3915d-073e-0335-4207-3c3651b10c3b@gmail.com>
Message-ID: <CADvFi5pNcSsMQVuv77tjFa9ufUx9-EmpzocCx-k=AczkkCNcxA@mail.gmail.com>

Thank you very much.
I'll implement this with my real data.
Hugo

Bede-Fazekas ?kos <bfalevlist at gmail.com> escreveu no dia ter?a, 28/05/2019
?(s) 06:15:

> Dear Hugo,
> please find below a solution. It might be too complicated and shorter
> solutions might exist, but it works.
>
> library(raster)
> r1 <- r2 <- raster()
> r1[]<-runif(ncell(r1), 1, 100)
> r2[]<-1
> r2[1:30000]<-2
> r2[30001:35000]<-NA
> plot(stack(r1,r2))
>
>
> ## Function
> prob<-data.frame(value=1:100, r1=log(1:100), r2=max(log(1:100))-log(1:100))
> f <- function(x,y,seed,...){
>    ifelse(is.na(y),NA,rbinom(n=1, size=1, prob=prob[[y]][x]))
> }
> f <- Vectorize(f)
>
> ## Wrapper function
> wrapper <- function(raster,seed,...){
>      set.seed(seed)
>      overlay(raster,fun=f)
> }
>
> ## Overlay (reproducible)
> result1<-wrapper(stack(r1,r2),seed=0)
> result2<-wrapper(stack(r1,r2),seed=0)
> compareRaster(result1,result2,values=TRUE)
>
> ## Cluster overlay (Not reproducible)
> beginCluster(2)
> result3<-clusterR(stack(r1,r2),wrapper,args=list(seed=0),
> export=c("prob", "f"))
> endCluster()
>
> beginCluster(2)
> result4<-clusterR(stack(r1,r2),wrapper,args=list(seed=0),
> export=c("prob", "f"))
> endCluster()
>
> compareRaster(result3,result4,values=TRUE)
>
> HTH,
> ?kos Bede-Fazekas
> Hungarian Academy of Sciences
>
> 2019.05.27. 22:59 keltez?ssel, Hugo Costa ?rta:
> > Dear all
> > I need to implement a raster::overlay operation with clusterR (which
> > works), but don't figure out how to do it reproducible. How to set seeds
> in
> > the cluster? Please find a example below.
> > Thank you
> > Hugo
> >
> > ## Rasters
> > library(raster)
> > r1 <- r2 <- raster()
> > r1[]<-runif(ncell(r1), 1, 100)
> > r2[]<-1
> > r2[1:30000]<-2
> > r2[30001:35000]<-NA
> > plot(stack(r1,r2))
> >
> >
> > ## Function
> > prob<-data.frame(value=1:100, r1=log(1:100),
> r2=max(log(1:100))-log(1:100))
> > f <- function(x,y,...){
> >    ifelse(is.na(y),NA,rbinom(n=1, size=1, prob=prob[[y]][x]))
> > }
> > f <- Vectorize(f)
> >
> > ## Overlay (reproducible)
> > set.seed(0)
> > result1<-overlay(stack(r1,r2), fun=f)
> > set.seed(0)
> > result2<-overlay(stack(r1,r2), fun=f)
> > compareRaster(result1,result2,values=TRUE)
> >
> > ## Cluster overlay (Not reproducible)
> > set.seed((0))
> > beginCluster(2)
> > result3<-clusterR(stack(r1,r2),overlay,args=list(fun=f), export="prob")
> > endCluster()
> >
> > set.seed((0))
> > beginCluster(2)
> > result4<-clusterR(stack(r1,r2),overlay,args=list(fun=f), export="prob")
> > endCluster()
> >
> > compareRaster(result3,result4,values=TRUE)
> >
> >       [[alternative HTML version deleted]]
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From Roger@B|v@nd @end|ng |rom nhh@no  Tue May 28 11:37:20 2019
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Tue, 28 May 2019 11:37:20 +0200
Subject: [R-sig-Geo] Question spdep package - aliased variables and NA
 z-values
In-Reply-To: <4BF11DC6-71AD-4B97-8587-64E04B9C1E4A@yahoo.de>
References: <4BF11DC6-71AD-4B97-8587-64E04B9C1E4A@yahoo.de>
Message-ID: <alpine.LFD.2.21.1905281133050.3922@reclus.nhh.no>

On Mon, 27 May 2019, Raphael Mesaric via R-sig-Geo wrote:

> Dear all,
>
> My model consists of observations for all four seasons, and each of the 
> seasons is analyzed with respect to five different time slots. All of 
> these observations are referring to the same grid, which means that my 
> neighborhood matrix is repeated twenty times (I took the neighborhood 
> matrix of the original grid and modified the entries in such a way that 
> I have a diagonal matrix where each diagonal block entry consists of the 
> original neighborhood object, with adjusted values).
>
> I recently run my model with the errorsarlm() and lagsarlm() functions. 
> It worked fine, and the results coincide well with the linear regression 
> results, which is great. However, there are a few other strange things:

These are not really appropriate models, maybe look at the splm package 
for panel/longitudinal equivalents. To debug the aliasing in the model 
fitting functions in spatialreg (no longer spdep), please provide a 
reproducible example, preferably from a built-in data set.

Roger

>
> In the lag-model, I have only estimates for some variables, but the 
> z-value is indicated as NA (for the error model it works fine). After 
> running the SAR models, R tells me that the two dummy variables for the 
> seasons are aliased. However, in the linear regression I did not have 
> any problems, and the variables are not correlated.
>
> I think the second issue might be related to the fact that the number of 
> observations seems to correspond to the number of observations for one 
> season, instead of all four seasons. In other words, it looks like R has 
> realized that the neighborhood repeats itself for each season. 
> Interestingly enough, R has not realized that the pattern repeats itself 
> inside the seasons as well for the time slots.
>
> Or is there another possible reason for the fact that the number of 
> observations corresponds to only one fourth of all the observations 
> actually included?
>
> Has anybody experienced these issues as well? Any idea on how to resolve 
> these problems would be greatly appreciated.
>
> Thank you in advance!
>
> Best regards,
>
> Raphael Mesaric
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en


From Roger@B|v@nd @end|ng |rom nhh@no  Wed May 29 18:54:00 2019
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Wed, 29 May 2019 18:54:00 +0200
Subject: [R-sig-Geo] GDAL 3.0.0 and rgdal?
In-Reply-To: <1601962525.8126669.1558964413880@mail.yahoo.com>
References: <1092883114.7943734.1558914205196.ref@mail.yahoo.com>
 <1092883114.7943734.1558914205196@mail.yahoo.com>
 <94348c30-36d0-7073-8287-a3365168f1e5@uni-muenster.de>
 <alpine.LFD.2.21.1905271230420.29256@reclus.nhh.no>
 <1601962525.8126669.1558964413880@mail.yahoo.com>
Message-ID: <alpine.LFD.2.21.1905291853070.14824@reclus.nhh.no>

rgdal_1.4-4 source on CRAN, Windows and OSX binaries to follow shortly.

Roger

On Mon, 27 May 2019, Thiago V. dos Santos wrote:

> Thanks for the feedback Edzer and Roger. The development version indeed 
> works fine with GDAL 3.
>
>
> Sent from Yahoo Mail for iPhone
>
>
> On Monday, May 27, 2019, 6:31 AM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
>
> On Mon, 27 May 2019, Edzer Pebesma wrote:
>
>> The development version installs with GDAL 3, try
>>
>> install.packages("rgdal", repos="http://R-Forge.R-project.org")
>>
>
> I'll try to submit to CRAN this week.
>
> Roger
>
>>
>> On 5/27/19 1:43 AM, Thiago V. dos Santos via R-sig-Geo wrote:
>>> Dear all,
>>> Yesterday I replaced GDAL v2.4.1 with the latest v3.0.0 on my Linux server. Then, when I tried to reinstall rgdal, I got an error due to wrong system requirements: rgdal requires GDAL between versions 1.11.4 and 2.5.0.
>>> Therefore, I am wondering: are there plans for rgdal to support GDAL 3.0.0 in the next few days? I like to be up-to-date with GIS software, but I don't really need to use GDAL 3.0.0 at all. If it is going to be a little while until it is supported by rgdal, I can happily revert back to v2.4.1.
>>> Thanks,?-- Thiago V. dos Santos
>>> Postdoctoral Research FellowDepartment of Climate and Space Science and EngineeringUniversity of Michigan
>>> ??? [[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>>
>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

From Roger@B|v@nd @end|ng |rom nhh@no  Thu May 30 08:38:54 2019
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Thu, 30 May 2019 06:38:54 +0000
Subject: [R-sig-Geo] GDAL 3.0.0 and rgdal?
In-Reply-To: <619632390.1447072.1559187786448@mail.yahoo.com>
References: <1092883114.7943734.1558914205196.ref@mail.yahoo.com>
 <1092883114.7943734.1558914205196@mail.yahoo.com>
 <94348c30-36d0-7073-8287-a3365168f1e5@uni-muenster.de>
 <alpine.LFD.2.21.1905271230420.29256@reclus.nhh.no>
 <1601962525.8126669.1558964413880@mail.yahoo.com>
 <alpine.LFD.2.21.1905291853070.14824@reclus.nhh.no>,
 <619632390.1447072.1559187786448@mail.yahoo.com>
Message-ID: <CF511784783D0B52.1ca39ff7-32fb-4dfb-8746-5c9d390b82e8@mail.outlook.com>

As you should see, pkg-config is picking up your 4.9.3 PROJ. It is never a good idea to use multiple versions unless you are also willing to keep control of the runtime load path too. Here you could rename the 4.9.3 proj.pc file and point shell variable PKG_CONFIG_PATH at the 6.0.0 proj.pc, or rename both to use only the configure arguments. Using pkg-config takes precedence over configure arguments, it seems.

Roger

Roger Bivand
Norwegian School of Economics
Bergen, Norway



Fra: Thiago V. dos Santos
Sendt: torsdag 30. mai, 05.43
Emne: Re: [R-sig-Geo] GDAL 3.0.0 and rgdal?
Til: r-sig-geo at r-project.org
Kopi: Roger Bivand, Edzer Pebesma


Dear Roger and Edzer,

Many thanks for the update. The installation now passes the GDAL version check, but it fails when looking for proj_api.h. Please see the complete error message below.

# This is from the R terminal:
install.packages('rgdal', type = "source", configure.args=c(
     '--with-gdal-config=/opt/software/bin/gdal-config',
     '--with-proj-include=/opt/software/include',
     '--with-proj-lib=/opt/software/lib'))

Installing package into ?/usr/local/lib/R/site-library?
(as ?lib? is unspecified)
trying URL 'https://cran.rstudio.com/src/contrib/rgdal_1.4-4.tar.gz'
Content type 'application/x-gzip' length 1687518 bytes (1.6 MB)
==================================================
downloaded 1.6 MB

* installing *source* package ?rgdal? ...
** package ?rgdal? successfully unpacked and MD5 sums checked
** using staged installation
configure: R_HOME: /usr/lib/R
configure: CC: gcc -std=gnu99
configure: CXX: g++ -std=gnu++11
configure: C++11 support available
configure: rgdal: 1.4-4
checking for /usr/bin/svnversion... yes
configure: svn revision: 833
configure: gdal-config set to /opt/software/bin/gdal-config
checking gdal-config exists... yes
checking gdal-config executable... yes
checking gdal-config usability... yes
configure: GDAL: 3.0.0
checking GDAL version >= 1.11.4... yes
checking GDAL version <= 2.5 or >= 3.0... yes
checking gdal: linking with --libs only... yes
checking GDAL: gdal-config data directory readable... yes
checking GDAL: /opt/software/share/gdal/pcs.csv readable... no
configure: pkg-config proj exists, will use it
configure: PROJ version: 4.9.3
configure: PROJ version < 6.0.0
configure: proj CPP flags:  -I/opt/software/include
checking PROJ header API:... proj_api.h
checking proj_api.h presence and usability... yes
checking PROJ version agreement... no
configure: error: proj_api.h and pkg-config give different versions
ERROR: configuration failed for package ?rgdal?
* removing ?/usr/local/lib/R/site-library/rgdal?
* restoring previous ?/usr/local/lib/R/site-library/rgdal?

The downloaded source packages are in
?/tmp/RtmpDjAFHw/downloaded_packages?
Warning message:
In install.packages("rgdal", type = "source", configure.args = c("--with-gdal-config=/opt/software/bin/gdal-config",  :
  installation of package ?rgdal? had non-zero exit status

I do have two installations of PROJ on my system:

1) PROJ v4.9.3 supplied by Ubuntu.
2) PROJ v6.0.0 manually built by me on /opt/software. I made sure to pass that directory in the install.packages() command, but it seems to be ignored.

Perhaps I am missing a configure.args argument?

Greetings,
 -- Thiago V. dos Santos

Postdoctoral Research Fellow
Department of Climate and Space Science and Engineering
University of Michigan


On Wednesday, May 29, 2019, 12:54:22 PM EDT, Roger Bivand <Roger.Bivand at nhh.no> wrote:


rgdal_1.4-4 source on CRAN, Windows and OSX binaries to follow shortly.

Roger

On Mon, 27 May 2019, Thiago V. dos Santos wrote:

> Thanks for the feedback Edzer and Roger. The development version indeed
> works fine with GDAL 3.
>
>
> Sent from Yahoo Mail for iPhone
>
>
> On Monday, May 27, 2019, 6:31 AM, Roger Bivand <Roger.Bivand at nhh.no<mailto:Roger.Bivand at nhh.no>> wrote:
>
> On Mon, 27 May 2019, Edzer Pebesma wrote:
>
>> The development version installs with GDAL 3, try
>>
>> install.packages("rgdal", repos="http://R-Forge.R-project.org")
>>
>
> I'll try to submit to CRAN this week.
>
> Roger
>
>>
>> On 5/27/19 1:43 AM, Thiago V. dos Santos via R-sig-Geo wrote:
>>> Dear all,
>>> Yesterday I replaced GDAL v2.4.1 with the latest v3.0.0 on my Linux server. Then, when I tried to reinstall rgdal, I got an error due to wrong system requirements: rgdal requires GDAL between versions 1.11.4 and 2.5.0.
>>> Therefore, I am wondering: are there plans for rgdal to support GDAL 3.0.0 in the next few days? I like to be up-to-date with GIS software, but I don't really need to use GDAL 3.0.0 at all. If it is going to be a little while until it is supported by rgdal, I can happily revert back to v2.4.1.
>>> Thanks, -- Thiago V. dos Santos
>>> Postdoctoral Research FellowDepartment of Climate and Space Science and EngineeringUniversity of Michigan
>>>     [[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org<mailto:R-sig-Geo at r-project.org>
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>>
>
>

--
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no<mailto:Roger.Bivand at nhh.no>
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en



	[[alternative HTML version deleted]]


From k@@|m_r@||q_2005 @end|ng |rom hotm@||@co@uk  Thu May 30 14:12:12 2019
From: k@@|m_r@||q_2005 @end|ng |rom hotm@||@co@uk (Kasim Rafiq)
Date: Thu, 30 May 2019 12:12:12 +0000
Subject: [R-sig-Geo] How to calculate 3D overlap index of Brownian bridge
 movement models in adehabitatHR
Message-ID: <DB7PR04MB46514A56ECD88A7FE1A4DACD85180@DB7PR04MB4651.eurprd04.prod.outlook.com>

Hi all,

I wish to look at home range overlap using a 3D overlap index (preferably UDOI) and using utilisation distributions generated by brownian bridge movement models.

The adehabitatHR function kerneloverlaphr acts on estUDm objects to calculate overlaps.

Is there a way to ?stack? the utilisation distributions calculated from the BBMM function brownian.bridge into a single estUDm object that can then be handled by kerneloverlaphr?

Alternatively, is there another function to measure overlap of a brownian bridge generated utilisation distributions?

Thank you in advance,

Kasim

## Example code:

require(adehabitatHR)
require(BBMM)

data(locations)  ## Example dataset

BBMM <- brownian.bridge(x=locations$x, y=locations$y,
                        time.lag=locations$time.lag[-1], location.error=20,
                        cell.size=50)

locations2 <- locations
locations2$x <-locations2$x + 5000 # To create example overlapping UD

BBMM2 <- brownian.bridge(x=locations2$x, y=locations2$y,
                        time.lag=locations2$time.lag[-1], location.error=20,
                        cell.size=50)


x <- # function to stack the bbmm output as a single estUDm object that can be handled by kerneloverlaphr

kerneloverlaphr(x, method='UDOI')



	[[alternative HTML version deleted]]


From @o||nto@|@t @end|ng |rom gm@||@com  Thu May 30 16:23:42 2019
From: @o||nto@|@t @end|ng |rom gm@||@com (Antonio Silva)
Date: Thu, 30 May 2019 11:23:42 -0300
Subject: [R-sig-Geo] extract data from multilayer nc file
Message-ID: <CAE8g1gPa-Le96708b+sz-y7bogbGNEsiWd7p3yEtJtDOu-rrrw@mail.gmail.com>

Hello all,

I want to extract monthly sea water temperature and salinity (50 and 75 m
depth) for a given area.

To do so I downloaded dataset-armor-3d-rep-monthly (product
MULTIOBS_GLO_PHY_REP_015_002) from Copernicus Marine environment monitoring
service (http://marine.copernicus.eu/). A sample file can be found at
https://app.box.com/s/f8yyf3jn9kye1htqc7aktjk38jp39yrm.

I also prepared a shapefile delimiting the area of interest (
https://app.box.com/s/ciq76w7918zir3hu89l8d3y9dn3csuxp).

Some time ago I dealt with monthly salinity data files, that is, with only
one variable. I prepared a script and made it available at
https://gist.github.com/aolinto/59e43cdbac3ff3e0cd5eb2eab5efcbc4.

Now I have a nc file with several variables (so and to) and each one has 4
dimensions (time (for each month), lat, lon and depth (50 and 75 m)).

For a file with 3 dimensions per variable I write
rst.data <- stack("dataset-sss-ssd-rep-monthly_sos_2008_2017.nc",varname="sos")


But this turn I receive the message
> rst.data <- stack("dataset-armor-3d-rep-monthly_1559213337443.nc",varname="to")
# indicate the nc file
Warning messages:
1: In .stackCDF(x, varname = varname, bands = bands) :
  to has 4 dimensions, I am using the last one
2: In .rasterObjectFromCDF(x, type = objecttype, band = band, ...) :
  "level" set to 1 (there are 2 levels)

I tried several commands (bands, layers) but I couldn't make a stack to 50
and another to 75 data.

I appreciate any help.

Best regards,

Ant?nio Olinto
Instituto de Pesca (Fisheries Institute)
S?o Paulo, Brasil

	[[alternative HTML version deleted]]


From @@r@h@go@|ee @end|ng |rom gm@||@com  Thu May 30 18:12:39 2019
From: @@r@h@go@|ee @end|ng |rom gm@||@com (Sarah Goslee)
Date: Thu, 30 May 2019 12:12:39 -0400
Subject: [R-sig-Geo] extract data from multilayer nc file
In-Reply-To: <CAE8g1gPa-Le96708b+sz-y7bogbGNEsiWd7p3yEtJtDOu-rrrw@mail.gmail.com>
References: <CAE8g1gPa-Le96708b+sz-y7bogbGNEsiWd7p3yEtJtDOu-rrrw@mail.gmail.com>
Message-ID: <CAM_vjukxqSGoGyuWdKN2czf9vwOe-Gw_dzrB+cjS17DeW3vEHw@mail.gmail.com>

Hi Antonio,

I work with NetCDF files a lot, and I find it enormously easier to
split up multidimensional files before importing them into R.

I use NCO for this (http://nco.sourceforge.net/) but I'm sure there
are other options. I'm afraid I have no idea how well that works on
windows.

For your sample file, here's how you could split it by depth and by variable.

ncks -d depth,0,0 -v to dataset-armor-3d-rep-monthly_1559213337443.nc vo50.nc
ncks -d depth,0,0 -v so dataset-armor-3d-rep-monthly_1559213337443.nc so50.nc

ncks -d depth,1,1 -v to dataset-armor-3d-rep-monthly_1559213337443.nc vo75.nc
ncks -d depth,1,1 -v so dataset-armor-3d-rep-monthly_1559213337443.nc so75.nc

> library(raster)
Loading required package: sp
> vo75 <- stack("vo75.nc")
Loading required namespace: ncdf4
> dim(vo75)
[1] 29 41 12

Sarah

On Thu, May 30, 2019 at 10:24 AM Antonio Silva <aolinto.lst at gmail.com> wrote:
>
> Hello all,
>
> I want to extract monthly sea water temperature and salinity (50 and 75 m
> depth) for a given area.
>
> To do so I downloaded dataset-armor-3d-rep-monthly (product
> MULTIOBS_GLO_PHY_REP_015_002) from Copernicus Marine environment monitoring
> service (http://marine.copernicus.eu/). A sample file can be found at
> https://app.box.com/s/f8yyf3jn9kye1htqc7aktjk38jp39yrm.
>
> I also prepared a shapefile delimiting the area of interest (
> https://app.box.com/s/ciq76w7918zir3hu89l8d3y9dn3csuxp).
>
> Some time ago I dealt with monthly salinity data files, that is, with only
> one variable. I prepared a script and made it available at
> https://gist.github.com/aolinto/59e43cdbac3ff3e0cd5eb2eab5efcbc4.
>
> Now I have a nc file with several variables (so and to) and each one has 4
> dimensions (time (for each month), lat, lon and depth (50 and 75 m)).
>
> For a file with 3 dimensions per variable I write
> rst.data <- stack("dataset-sss-ssd-rep-monthly_sos_2008_2017.nc",varname="sos")
>
>
> But this turn I receive the message
> > rst.data <- stack("dataset-armor-3d-rep-monthly_1559213337443.nc",varname="to")
> # indicate the nc file
> Warning messages:
> 1: In .stackCDF(x, varname = varname, bands = bands) :
>   to has 4 dimensions, I am using the last one
> 2: In .rasterObjectFromCDF(x, type = objecttype, band = band, ...) :
>   "level" set to 1 (there are 2 levels)
>
> I tried several commands (bands, layers) but I couldn't make a stack to 50
> and another to 75 data.
>
> I appreciate any help.
>
> Best regards,
>
> Ant?nio Olinto
> Instituto de Pesca (Fisheries Institute)
> S?o Paulo, Brasil
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



-- 
Sarah Goslee (she/her)
http://www.numberwright.com


From @o||nto@|@t @end|ng |rom gm@||@com  Thu May 30 21:40:53 2019
From: @o||nto@|@t @end|ng |rom gm@||@com (Antonio Silva)
Date: Thu, 30 May 2019 16:40:53 -0300
Subject: [R-sig-Geo] extract data from multilayer nc file
In-Reply-To: <CAM_vjukxqSGoGyuWdKN2czf9vwOe-Gw_dzrB+cjS17DeW3vEHw@mail.gmail.com>
References: <CAE8g1gPa-Le96708b+sz-y7bogbGNEsiWd7p3yEtJtDOu-rrrw@mail.gmail.com>
 <CAM_vjukxqSGoGyuWdKN2czf9vwOe-Gw_dzrB+cjS17DeW3vEHw@mail.gmail.com>
Message-ID: <CAE8g1gMM73Zqy-hwhb74F_39NkraYGQuqGsouMekhNMv8-1TnQ@mail.gmail.com>

Thanks a lot Sarah. I ran your examples. Since I use Linux Ubuntu command
lines just worked fine.

I will learn more about NCO.

Once more thanks for your help.

All the best

A.O.

Em qui, 30 de mai de 2019 ?s 13:12, Sarah Goslee <sarah.goslee at gmail.com>
escreveu:

> Hi Antonio,
>
> I work with NetCDF files a lot, and I find it enormously easier to
> split up multidimensional files before importing them into R.
>
> I use NCO for this (http://nco.sourceforge.net/) but I'm sure there
> are other options. I'm afraid I have no idea how well that works on
> windows.
>
> For your sample file, here's how you could split it by depth and by
> variable.
>
> ncks -d depth,0,0 -v to dataset-armor-3d-rep-monthly_1559213337443.nc
> vo50.nc
> ncks -d depth,0,0 -v so dataset-armor-3d-rep-monthly_1559213337443.nc
> so50.nc
>
> ncks -d depth,1,1 -v to dataset-armor-3d-rep-monthly_1559213337443.nc
> vo75.nc
> ncks -d depth,1,1 -v so dataset-armor-3d-rep-monthly_1559213337443.nc
> so75.nc
>
> > library(raster)
> Loading required package: sp
> > vo75 <- stack("vo75.nc")
> Loading required namespace: ncdf4
> > dim(vo75)
> [1] 29 41 12
>
> Sarah
>
> On Thu, May 30, 2019 at 10:24 AM Antonio Silva <aolinto.lst at gmail.com>
> wrote:
> >
> > Hello all,
> >
> > I want to extract monthly sea water temperature and salinity (50 and 75 m
> > depth) for a given area.
> >
> > To do so I downloaded dataset-armor-3d-rep-monthly (product
> > MULTIOBS_GLO_PHY_REP_015_002) from Copernicus Marine environment
> monitoring
> > service (http://marine.copernicus.eu/). A sample file can be found at
> > https://app.box.com/s/f8yyf3jn9kye1htqc7aktjk38jp39yrm.
> >
> > I also prepared a shapefile delimiting the area of interest (
> > https://app.box.com/s/ciq76w7918zir3hu89l8d3y9dn3csuxp).
> >
> > Some time ago I dealt with monthly salinity data files, that is, with
> only
> > one variable. I prepared a script and made it available at
> > https://gist.github.com/aolinto/59e43cdbac3ff3e0cd5eb2eab5efcbc4.
> >
> > Now I have a nc file with several variables (so and to) and each one has
> 4
> > dimensions (time (for each month), lat, lon and depth (50 and 75 m)).
> >
> > For a file with 3 dimensions per variable I write
> > rst.data <- stack("dataset-sss-ssd-rep-monthly_sos_2008_2017.nc
> ",varname="sos")
> >
> >
> > But this turn I receive the message
> > > rst.data <- stack("dataset-armor-3d-rep-monthly_1559213337443.nc
> ",varname="to")
> > # indicate the nc file
> > Warning messages:
> > 1: In .stackCDF(x, varname = varname, bands = bands) :
> >   to has 4 dimensions, I am using the last one
> > 2: In .rasterObjectFromCDF(x, type = objecttype, band = band, ...) :
> >   "level" set to 1 (there are 2 levels)
> >
> > I tried several commands (bands, layers) but I couldn't make a stack to
> 50
> > and another to 75 data.
> >
> > I appreciate any help.
> >
> > Best regards,
> >
> > Ant?nio Olinto
> > Instituto de Pesca (Fisheries Institute)
> > S?o Paulo, Brasil
> >
> >         [[alternative HTML version deleted]]
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
>
> --
> Sarah Goslee (she/her)
> http://www.numberwright.com
>

	[[alternative HTML version deleted]]


From @o||nto@|@t @end|ng |rom gm@||@com  Thu May 30 23:46:15 2019
From: @o||nto@|@t @end|ng |rom gm@||@com (Antonio Silva)
Date: Thu, 30 May 2019 18:46:15 -0300
Subject: [R-sig-Geo] extract data from multilayer nc file
In-Reply-To: <1958716551.9979467.1559246574278@mail.yahoo.com>
References: <CAE8g1gPa-Le96708b+sz-y7bogbGNEsiWd7p3yEtJtDOu-rrrw@mail.gmail.com>
 <CAM_vjukxqSGoGyuWdKN2czf9vwOe-Gw_dzrB+cjS17DeW3vEHw@mail.gmail.com>
 <CAE8g1gMM73Zqy-hwhb74F_39NkraYGQuqGsouMekhNMv8-1TnQ@mail.gmail.com>
 <1958716551.9979467.1559246574278@mail.yahoo.com>
Message-ID: <CAE8g1gPXcCwMXvYdS5C16c0xuDTiWRwyCZjRUuHOBKMybXBDOQ@mail.gmail.com>

Thanks Thiago

Good idea to change stack to brick with level command.

Best regards,

A.O.


Em qui, 30 de mai de 2019 ?s 17:03, Thiago V. dos Santos <
thi_veloso at yahoo.com.br> escreveu:

> Alternatively, there is a "level" argument for the brick command that
> allows accessing the 4th dimension variable of the netcdf file - usually
> height for atmosphere-related variables or depth for surface- or
> ocean-related variables.
>
> Depending on your purpose, you might want to access a specific depth (say
> the first one):
>
> rst.data <- brick('~/Downloads/
> dataset-armor-3d-rep-monthly_1559213337443.nc', varname='so', level=1)
>
> Or you could loop over the depths:
>
> # Loop over depths
> for (i in 1:2){
>   rst.data <- brick('~/Downloads/
> dataset-armor-3d-rep-monthly_1559213337443.nc', varname='so', level=i)
>
>   # Do whatever you need to do with each layer
> }
>
> See ?brick
>
> Greetings,
>  -- Thiago V. dos Santos
>
> Postdoctoral Research Fellow
> Department of Climate and Space Science and Engineering
> University of Michigan
>
>
> On Thursday, May 30, 2019, 3:42:01 PM EDT, Antonio Silva <
> aolinto.lst at gmail.com> wrote:
>
>
> Thanks a lot Sarah. I ran your examples. Since I use Linux Ubuntu command
> lines just worked fine.
>
> I will learn more about NCO.
>
> Once more thanks for your help.
>
> All the best
>
> A.O.
>
> Em qui, 30 de mai de 2019 ?s 13:12, Sarah Goslee <sarah.goslee at gmail.com>
> escreveu:
>
> > Hi Antonio,
> >
> > I work with NetCDF files a lot, and I find it enormously easier to
> > split up multidimensional files before importing them into R.
> >
> > I use NCO for this (http://nco.sourceforge.net/) but I'm sure there
> > are other options. I'm afraid I have no idea how well that works on
> > windows.
> >
> > For your sample file, here's how you could split it by depth and by
> > variable.
> >
> > ncks -d depth,0,0 -v to dataset-armor-3d-rep-monthly_1559213337443.nc
> > vo50.nc
> > ncks -d depth,0,0 -v so dataset-armor-3d-rep-monthly_1559213337443.nc
> > so50.nc
> >
> > ncks -d depth,1,1 -v to dataset-armor-3d-rep-monthly_1559213337443.nc
> > vo75.nc
> > ncks -d depth,1,1 -v so dataset-armor-3d-rep-monthly_1559213337443.nc
> > so75.nc
> >
> > > library(raster)
> > Loading required package: sp
> > > vo75 <- stack("vo75.nc")
> > Loading required namespace: ncdf4
> > > dim(vo75)
> > [1] 29 41 12
> >
> > Sarah
> >
> > On Thu, May 30, 2019 at 10:24 AM Antonio Silva <aolinto.lst at gmail.com>
> > wrote:
> > >
> > > Hello all,
> > >
> > > I want to extract monthly sea water temperature and salinity (50 and
> 75 m
> > > depth) for a given area.
> > >
> > > To do so I downloaded dataset-armor-3d-rep-monthly (product
> > > MULTIOBS_GLO_PHY_REP_015_002) from Copernicus Marine environment
> > monitoring
> > > service (http://marine.copernicus.eu/). A sample file can be found at
> > > https://app.box.com/s/f8yyf3jn9kye1htqc7aktjk38jp39yrm.
> > >
> > > I also prepared a shapefile delimiting the area of interest (
> > > https://app.box.com/s/ciq76w7918zir3hu89l8d3y9dn3csuxp).
> > >
> > > Some time ago I dealt with monthly salinity data files, that is, with
> > only
> > > one variable. I prepared a script and made it available at
> > > https://gist.github.com/aolinto/59e43cdbac3ff3e0cd5eb2eab5efcbc4.
> > >
> > > Now I have a nc file with several variables (so and to) and each one
> has
> > 4
> > > dimensions (time (for each month), lat, lon and depth (50 and 75 m)).
> > >
> > > For a file with 3 dimensions per variable I write
> > > rst.data <- stack("dataset-sss-ssd-rep-monthly_sos_2008_2017.nc
> > ",varname="sos")
> > >
> > >
> > > But this turn I receive the message
> > > > rst.data <- stack("dataset-armor-3d-rep-monthly_1559213337443.nc
> > ",varname="to")
> > > # indicate the nc file
> > > Warning messages:
> > > 1: In .stackCDF(x, varname = varname, bands = bands) :
> > >  to has 4 dimensions, I am using the last one
> > > 2: In .rasterObjectFromCDF(x, type = objecttype, band = band, ...) :
> > >  "level" set to 1 (there are 2 levels)
> > >
> > > I tried several commands (bands, layers) but I couldn't make a stack to
> > 50
> > > and another to 75 data.
> > >
> > > I appreciate any help.
> > >
> > > Best regards,
> > >
> > > Ant?nio Olinto
> > > Instituto de Pesca (Fisheries Institute)
> > > S?o Paulo, Brasil
> > >
> > >        [[alternative HTML version deleted]]
> > >
> > > _______________________________________________
> > > R-sig-Geo mailing list
> > > R-sig-Geo at r-project.org
> > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
> >
> >
> > --
> > Sarah Goslee (she/her)
> > http://www.numberwright.com
>
> >
>
>     [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


