From m@p|no|@10 @end|ng |rom gm@||@com  Tue Jun  1 18:43:24 2021
From: m@p|no|@10 @end|ng |rom gm@||@com (=?UTF-8?Q?Manuel_Sp=C3=ADnola?=)
Date: Tue, 1 Jun 2021 10:43:24 -0600
Subject: [R-sig-Geo] Using facet_wrap with geom_stars for a stacked raster
Message-ID: <CABkCotSeVAqARinYtfszeaUqNrsYGOSWMc7=2g7edv+0UNA8Zg@mail.gmail.com>

Dear list members,

I am trying to use facet_wrap with geom_stars but I don't know how to
specify the variable argument in the facet_wrap function (I know is not
"band"), and also, how to change the labels of the strip names?

r <- read_stars(system.file("external/test.grd", package="raster"))

s1 <- c(r, r*2)

ggplot() +
  geom_stars(data = s1) +
  coord_equal() +
  facet_wrap(~ band)

-- 
*Manuel Sp?nola, Ph.D.*
Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
Universidad Nacional
Apartado 1350-3000
Heredia
COSTA RICA
mspinola at una.cr <mspinola at una.ac.cr>
mspinola10 at gmail.com
Tel?fono: (506) 8706 - 4662
Personal website: Lobito de r?o <https://sites.google.com/site/lobitoderio/>
Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>

	[[alternative HTML version deleted]]


From edzer@pebe@m@ @end|ng |rom un|-muen@ter@de  Tue Jun  1 18:49:44 2021
From: edzer@pebe@m@ @end|ng |rom un|-muen@ter@de (Edzer Pebesma)
Date: Tue, 1 Jun 2021 18:49:44 +0200
Subject: [R-sig-Geo] 
 Using facet_wrap with geom_stars for a stacked raster
In-Reply-To: <CABkCotSeVAqARinYtfszeaUqNrsYGOSWMc7=2g7edv+0UNA8Zg@mail.gmail.com>
References: <CABkCotSeVAqARinYtfszeaUqNrsYGOSWMc7=2g7edv+0UNA8Zg@mail.gmail.com>
Message-ID: <b04b7cfb-ba8a-61f4-d061-890852a6f77f@uni-muenster.de>



On 01/06/2021 18:43, Manuel Sp?nola wrote:
> Dear list members,
> 
> I am trying to use facet_wrap with geom_stars but I don't know how to
> specify the variable argument in the facet_wrap function (I know is not
> "band"), and also, how to change the labels of the strip names?
> 
> r <- read_stars(system.file("external/test.grd", package="raster"))
> 
> s1 <- c(r, r*2)
> 
> ggplot() +
>    geom_stars(data = s1) +
>    coord_equal() +
>    facet_wrap(~ band)
> 

Try:

ggplot() +
   geom_stars(data = merge(s1)) + f
   facet_wrap(~attributes) +
   coord_equal()


c() binds attributes, merge() merges them into a dimension.
-- 
Edzer Pebesma
Institute for Geoinformatics
Heisenbergstrasse 2, 48151 Muenster, Germany
Phone: +49 251 8333081


From m@p|no|@10 @end|ng |rom gm@||@com  Tue Jun  1 19:15:44 2021
From: m@p|no|@10 @end|ng |rom gm@||@com (=?UTF-8?Q?Manuel_Sp=C3=ADnola?=)
Date: Tue, 1 Jun 2021 11:15:44 -0600
Subject: [R-sig-Geo] 
 Using facet_wrap with geom_stars for a stacked raster
In-Reply-To: <b04b7cfb-ba8a-61f4-d061-890852a6f77f@uni-muenster.de>
References: <CABkCotSeVAqARinYtfszeaUqNrsYGOSWMc7=2g7edv+0UNA8Zg@mail.gmail.com>
 <b04b7cfb-ba8a-61f4-d061-890852a6f77f@uni-muenster.de>
Message-ID: <CABkCotTVkjtDX4A-SSO0SbPFSBQxh8VpZW8WYRM3Hdst=ZvCKw@mail.gmail.com>

Thank you very much Edzer.

What about the labels of the stripes?

If I try to change the labels, they come out as NA

r <- read_stars(system.file("external/test.grd", package="raster"))

s1 <- c(r, r*2)

s2 <- merge(s1)

n <- c("raster 01", "raster 02")

ggplot() +
   geom_stars(data = s2) +
   facet_wrap(~attributes, labeller = labeller(attributes = n)) +
   coord_equal()


El mar, 1 jun 2021 a las 10:54, Edzer Pebesma (<
edzer.pebesma at uni-muenster.de>) escribi?:

>
>
> On 01/06/2021 18:43, Manuel Sp?nola wrote:
> > Dear list members,
> >
> > I am trying to use facet_wrap with geom_stars but I don't know how to
> > specify the variable argument in the facet_wrap function (I know is not
> > "band"), and also, how to change the labels of the strip names?
> >
> > r <- read_stars(system.file("external/test.grd", package="raster"))
> >
> > s1 <- c(r, r*2)
> >
> > ggplot() +
> >    geom_stars(data = s1) +
> >    coord_equal() +
> >    facet_wrap(~ band)
> >
>
> Try:
>
> ggplot() +
>    geom_stars(data = merge(s1)) + f
>    facet_wrap(~attributes) +
>    coord_equal()
>
>
> c() binds attributes, merge() merges them into a dimension.
> --
> Edzer Pebesma
> Institute for Geoinformatics
> Heisenbergstrasse 2, 48151 Muenster, Germany
> Phone: +49 251 8333081
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


-- 
*Manuel Sp?nola, Ph.D.*
Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
Universidad Nacional
Apartado 1350-3000
Heredia
COSTA RICA
mspinola at una.cr <mspinola at una.ac.cr>
mspinola10 at gmail.com
Tel?fono: (506) 8706 - 4662
Personal website: Lobito de r?o <https://sites.google.com/site/lobitoderio/>
Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>

	[[alternative HTML version deleted]]


From edzer@pebe@m@ @end|ng |rom un|-muen@ter@de  Tue Jun  1 19:58:58 2021
From: edzer@pebe@m@ @end|ng |rom un|-muen@ter@de (Edzer Pebesma)
Date: Tue, 1 Jun 2021 19:58:58 +0200
Subject: [R-sig-Geo] 
 Using facet_wrap with geom_stars for a stacked raster
In-Reply-To: <CABkCotTVkjtDX4A-SSO0SbPFSBQxh8VpZW8WYRM3Hdst=ZvCKw@mail.gmail.com>
References: <CABkCotSeVAqARinYtfszeaUqNrsYGOSWMc7=2g7edv+0UNA8Zg@mail.gmail.com>
 <b04b7cfb-ba8a-61f4-d061-890852a6f77f@uni-muenster.de>
 <CABkCotTVkjtDX4A-SSO0SbPFSBQxh8VpZW8WYRM3Hdst=ZvCKw@mail.gmail.com>
Message-ID: <18ff6300-e848-80e9-144c-cd2c39ebd255@uni-muenster.de>




On 01/06/2021 19:15, Manuel Sp?nola wrote:
> Thank you very much Edzer.
> 
> What about the labels of the stripes?
> 
> If I try to change the labels, they come out as NA
> 
> r <- read_stars(system.file("external/test.grd", package="raster"))
> 
> s1 <- c(r, r*2)
> 
> s2 <- merge(s1)
> 
> n <- c("raster 01", "raster 02")
> 
> ggplot() +
>  ? ?geom_stars(data = s2) +
>  ? ?facet_wrap(~attributes, labeller = labeller(attributes = n)) +
>  ? ?coord_equal()
> 

s3 = st_set_dimensions(s2, "attributes",
   values = c("label_A", "label_B"))
ggplot() + geom_stars(data = s3) +
   facet_wrap(~attributes) + coord_equal()

> 
> El mar, 1 jun 2021 a las 10:54, Edzer Pebesma 
> (<edzer.pebesma at uni-muenster.de <mailto:edzer.pebesma at uni-muenster.de>>) 
> escribi?:
> 
> 
> 
>     On 01/06/2021 18:43, Manuel Sp?nola wrote:
>      > Dear list members,
>      >
>      > I am trying to use facet_wrap with geom_stars but I don't know how to
>      > specify the variable argument in the facet_wrap function (I know
>     is not
>      > "band"), and also, how to change the labels of the strip names?
>      >
>      > r <- read_stars(system.file("external/test.grd", package="raster"))
>      >
>      > s1 <- c(r, r*2)
>      >
>      > ggplot() +
>      >? ? geom_stars(data = s1) +
>      >? ? coord_equal() +
>      >? ? facet_wrap(~ band)
>      >
> 
>     Try:
> 
>     ggplot() +
>      ? ?geom_stars(data = merge(s1)) + f
>      ? ?facet_wrap(~attributes) +
>      ? ?coord_equal()
> 
> 
>     c() binds attributes, merge() merges them into a dimension.
>     -- 
>     Edzer Pebesma
>     Institute for Geoinformatics
>     Heisenbergstrasse 2, 48151 Muenster, Germany
>     Phone: +49 251 8333081
> 
>     _______________________________________________
>     R-sig-Geo mailing list
>     R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
>     https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>     <https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
> 
> 
> 
> -- 
> *Manuel Sp?nola, Ph.D.*
> Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
> Universidad Nacional
> Apartado 1350-3000
> Heredia
> COSTA RICA
> mspinola at una.cr <mailto:mspinola at una.ac.cr>
> mspinola10 at gmail.com <mailto:mspinola10 at gmail.com>
> Tel?fono: (506) 8706 - 4662
> Personal website: Lobito de r?o 
> <https://sites.google.com/site/lobitoderio/>
> Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>

-- 
Edzer Pebesma
Institute for Geoinformatics
Heisenbergstrasse 2, 48151 Muenster, Germany
Phone: +49 251 8333081


From m@p|no|@10 @end|ng |rom gm@||@com  Tue Jun  1 20:24:28 2021
From: m@p|no|@10 @end|ng |rom gm@||@com (=?UTF-8?Q?Manuel_Sp=C3=ADnola?=)
Date: Tue, 1 Jun 2021 12:24:28 -0600
Subject: [R-sig-Geo] 
 Using facet_wrap with geom_stars for a stacked raster
In-Reply-To: <18ff6300-e848-80e9-144c-cd2c39ebd255@uni-muenster.de>
References: <CABkCotSeVAqARinYtfszeaUqNrsYGOSWMc7=2g7edv+0UNA8Zg@mail.gmail.com>
 <b04b7cfb-ba8a-61f4-d061-890852a6f77f@uni-muenster.de>
 <CABkCotTVkjtDX4A-SSO0SbPFSBQxh8VpZW8WYRM3Hdst=ZvCKw@mail.gmail.com>
 <18ff6300-e848-80e9-144c-cd2c39ebd255@uni-muenster.de>
Message-ID: <CABkCotSR0Beonz=1-8bSBcfjQuggbB8UQ-h3onw=qJ4jsOh4Dw@mail.gmail.com>

Thank you very much Edzer.


El mar, 1 jun 2021 a las 11:59, Edzer Pebesma (<
edzer.pebesma at uni-muenster.de>) escribi?:

>
>
>
> On 01/06/2021 19:15, Manuel Sp?nola wrote:
> > Thank you very much Edzer.
> >
> > What about the labels of the stripes?
> >
> > If I try to change the labels, they come out as NA
> >
> > r <- read_stars(system.file("external/test.grd", package="raster"))
> >
> > s1 <- c(r, r*2)
> >
> > s2 <- merge(s1)
> >
> > n <- c("raster 01", "raster 02")
> >
> > ggplot() +
> >     geom_stars(data = s2) +
> >     facet_wrap(~attributes, labeller = labeller(attributes = n)) +
> >     coord_equal()
> >
>
> s3 = st_set_dimensions(s2, "attributes",
>    values = c("label_A", "label_B"))
> ggplot() + geom_stars(data = s3) +
>    facet_wrap(~attributes) + coord_equal()
>
> >
> > El mar, 1 jun 2021 a las 10:54, Edzer Pebesma
> > (<edzer.pebesma at uni-muenster.de <mailto:edzer.pebesma at uni-muenster.de>>)
>
> > escribi?:
> >
> >
> >
> >     On 01/06/2021 18:43, Manuel Sp?nola wrote:
> >      > Dear list members,
> >      >
> >      > I am trying to use facet_wrap with geom_stars but I don't know
> how to
> >      > specify the variable argument in the facet_wrap function (I know
> >     is not
> >      > "band"), and also, how to change the labels of the strip names?
> >      >
> >      > r <- read_stars(system.file("external/test.grd",
> package="raster"))
> >      >
> >      > s1 <- c(r, r*2)
> >      >
> >      > ggplot() +
> >      >    geom_stars(data = s1) +
> >      >    coord_equal() +
> >      >    facet_wrap(~ band)
> >      >
> >
> >     Try:
> >
> >     ggplot() +
> >         geom_stars(data = merge(s1)) + f
> >         facet_wrap(~attributes) +
> >         coord_equal()
> >
> >
> >     c() binds attributes, merge() merges them into a dimension.
> >     --
> >     Edzer Pebesma
> >     Institute for Geoinformatics
> >     Heisenbergstrasse 2, 48151 Muenster, Germany
> >     Phone: +49 251 8333081
> >
> >     _______________________________________________
> >     R-sig-Geo mailing list
> >     R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
> >     https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >     <https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
> >
> >
> >
> > --
> > *Manuel Sp?nola, Ph.D.*
> > Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
> > Universidad Nacional
> > Apartado 1350-3000
> > Heredia
> > COSTA RICA
> > mspinola at una.cr <mailto:mspinola at una.ac.cr>
> > mspinola10 at gmail.com <mailto:mspinola10 at gmail.com>
> > Tel?fono: (506) 8706 - 4662
> > Personal website: Lobito de r?o
> > <https://sites.google.com/site/lobitoderio/>
> > Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>
>
> --
> Edzer Pebesma
> Institute for Geoinformatics
> Heisenbergstrasse 2, 48151 Muenster, Germany
> Phone: +49 251 8333081
>


-- 
*Manuel Sp?nola, Ph.D.*
Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
Universidad Nacional
Apartado 1350-3000
Heredia
COSTA RICA
mspinola at una.cr <mspinola at una.ac.cr>
mspinola10 at gmail.com
Tel?fono: (506) 8706 - 4662
Personal website: Lobito de r?o <https://sites.google.com/site/lobitoderio/>
Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>

	[[alternative HTML version deleted]]


From m@p|no|@10 @end|ng |rom gm@||@com  Sat Jun  5 17:50:29 2021
From: m@p|no|@10 @end|ng |rom gm@||@com (=?UTF-8?Q?Manuel_Sp=C3=ADnola?=)
Date: Sat, 5 Jun 2021 09:50:29 -0600
Subject: [R-sig-Geo] landmap package,
 cannot get the model error following the binomial variable example
Message-ID: <CABkCotRkGortyD8rYDhzswfou=ZmLdxfvDtNDB-cAJBvT_o7=g@mail.gmail.com>

Dear list members,

I am fitting a model using the package landmap but I cannot get the model
error for the binomial variable example of the package.

data(eberg_grid)
gridded(eberg_grid) <- ~x+y
proj4string(eberg_grid) <- CRS("+init=epsg:31467")

data(eberg)
eb.s <- sample.int(nrow(eberg), 1400)
eberg <- eberg[eb.s,]
coordinates(eberg) <- ~X+Y
proj4string(eberg) <- CRS("+init=epsg:31467")

eberg$Parabraunerde <- ifelse(eberg$TAXGRSC=="Parabraunerde", 1, 0)

X <- eberg_grid[c("PRMGEO6","DEMSRT6","TWISRT6","TIRAST6")]

mB <- train.spLearner(eberg["Parabraunerde"], covariates=X,
   family=binomial(), cov.model = "nugget", parallel=FALSE)

eberg.Parabraunerde <- predict(mB)

eberg.Parabraunerde$pred


-- 
*Manuel Sp?nola, Ph.D.*
Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
Universidad Nacional
Apartado 1350-3000
Heredia
COSTA RICA
mspinola at una.cr <mspinola at una.ac.cr>
mspinola10 at gmail.com
Tel?fono: (506) 8706 - 4662
Personal website: Lobito de r?o <https://sites.google.com/site/lobitoderio/>
Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>

	[[alternative HTML version deleted]]


From m@nue|@r|be|ro @end|ng |rom tecn|co@u||@bo@@pt  Sun Jun  6 13:34:16 2021
From: m@nue|@r|be|ro @end|ng |rom tecn|co@u||@bo@@pt (mr)
Date: Sun, 6 Jun 2021 12:34:16 +0100
Subject: [R-sig-Geo] How to obtain standard errors of local regression
 coefficients in spgwr::ggwr()?
Message-ID: <mailman.28661.0.1622979875.1337.r-sig-geo@r-project.org>

Dear list,

I am using?spgwr::ggwr()?to fit generalized geographically weighted regression with Poisson model and log-link function. The results provide local coefficient estimates, but i am missing how to get their standard errors (or t statistics) to compute pseudo p-values.
Below is a toy example using?SpatialEpi::NYleukemia?dataset:

# --------

library(SpatialEpi)
library(spgwr)

## Load data
data(NYleukemia)
population <- NYleukemia$data$population
cases <- ceiling(NYleukemia$data$cases * 100)
centroids <- latlong2grid(NYleukemia$geo[, 2:3])

# data frame
nyleuk <- data.frame(centroids, cases, population) 

# set coordinates as vector
coordny <- cbind(centroids[,1],centroids[,2])

# set a kernel bandwidth
bw <- 0.5

# fit ggwr()
m_pois <- ggwr(cases ~ offset(log(population)),
               data = nyleuk, gweight = gwr.Gauss, 
               adapt = bw, family = poisson(link="log"),  
               type="working", coords = coordny) 

# returns spatial point with coefficients 
# but no standard errors :(
head(m_pois$SDF at data)

# -------

Is there any way to get standard errors of the local coefficients?
Thank you, Manuel


Sent from Mail for Windows 10


	[[alternative HTML version deleted]]


From Roger@B|v@nd @end|ng |rom nhh@no  Sun Jun  6 16:14:34 2021
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Sun, 6 Jun 2021 16:14:34 +0200
Subject: [R-sig-Geo] How to obtain standard errors of local regression
 coefficients in spgwr::ggwr()?
In-Reply-To: <20210606113436.3D049DB7@hypatia.math.ethz.ch>
References: <20210606113436.3D049DB7@hypatia.math.ethz.ch>
Message-ID: <791ae27-81dd-e25e-f98a-c6418e9a2245@reclus2.nhh.no>

Does ?spgwr::ggwr state that any such values are returned? It says:

"a SpatialPointsDataFrame (may be gridded) or SpatialPolygonsDataFrame 
object (see package "sp") with fit.points, weights, GWR coefficient 
estimates, dispersion if a "quasi"-family is used, and the residuals of 
type "type" in its "data" slot."

Nothing else is returned. You may like to try the GWmodel package, which 
may offer some further output, but this is a largely unexplored area, and 
in any case inference is not encouraged for GW output as the technique is 
exploratory.

Hope this clarifies.

Roger

PS. Please post plain text, not HTML-formatted.

On Sun, 6 Jun 2021, mr via R-sig-Geo wrote:

> Dear list,
>
> I am using?spgwr::ggwr()?to fit generalized geographically weighted regression with Poisson model and log-link function. The results provide local coefficient estimates, but i am missing how to get their standard errors (or t statistics) to compute pseudo p-values.
> Below is a toy example using?SpatialEpi::NYleukemia?dataset:
>
> # --------
>
> library(SpatialEpi)
> library(spgwr)
>
> ## Load data
> data(NYleukemia)
> population <- NYleukemia$data$population
> cases <- ceiling(NYleukemia$data$cases * 100)
> centroids <- latlong2grid(NYleukemia$geo[, 2:3])
>
> # data frame
> nyleuk <- data.frame(centroids, cases, population)
>
> # set coordinates as vector
> coordny <- cbind(centroids[,1],centroids[,2])
>
> # set a kernel bandwidth
> bw <- 0.5
>
> # fit ggwr()
> m_pois <- ggwr(cases ~ offset(log(population)),
>               data = nyleuk, gweight = gwr.Gauss,
>               adapt = bw, family = poisson(link="log"),
>               type="working", coords = coordny)
>
> # returns spatial point with coefficients
> # but no standard errors :(
> head(m_pois$SDF at data)
>
> # -------
>
> Is there any way to get standard errors of the local coefficients?
> Thank you, Manuel
>
>
> Sent from Mail for Windows 10
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Emeritus Professor
Department of Economics, Norwegian School of Economics,
Postboks 3490 Ytre Sandviken, 5045 Bergen, Norway.
e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

From m@p|no|@10 @end|ng |rom gm@||@com  Mon Jun  7 01:16:46 2021
From: m@p|no|@10 @end|ng |rom gm@||@com (=?UTF-8?Q?Manuel_Sp=C3=ADnola?=)
Date: Sun, 6 Jun 2021 17:16:46 -0600
Subject: [R-sig-Geo] stars st_transform gives NA to the offset and delta
 parameters
Message-ID: <CABkCotR0a-Sto9WZPpZzThW6uw94RS7iKYdgoUDvCwDOjABOWA@mail.gmail.com>

Dear list members,

When using st_transform in a stars object the offset and delta parameters
become NA, is this an expected behavior?


geomatrix = system.file("tif/geomatrix.tif", package = "stars")
x = read_stars(geomatrix)

new = st_crs(4326)
y = st_transform(x, new)
y




*Manuel Sp?nola, Ph.D.*
Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
Universidad Nacional
Apartado 1350-3000
Heredia
COSTA RICA
mspinola at una.cr <mspinola at una.ac.cr>
mspinola10 at gmail.com
Tel?fono: (506) 8706 - 4662
Personal website: Lobito de r?o <https://sites.google.com/site/lobitoderio/>
Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>

	[[alternative HTML version deleted]]


From edzer@pebe@m@ @end|ng |rom un|-muen@ter@de  Mon Jun  7 09:01:12 2021
From: edzer@pebe@m@ @end|ng |rom un|-muen@ter@de (Edzer Pebesma)
Date: Mon, 7 Jun 2021 09:01:12 +0200
Subject: [R-sig-Geo] stars st_transform gives NA to the offset and delta
 parameters
In-Reply-To: <CABkCotR0a-Sto9WZPpZzThW6uw94RS7iKYdgoUDvCwDOjABOWA@mail.gmail.com>
References: <CABkCotR0a-Sto9WZPpZzThW6uw94RS7iKYdgoUDvCwDOjABOWA@mail.gmail.com>
Message-ID: <d14fe558-7580-cefa-7f3c-80bc964202ed@uni-muenster.de>



On 07/06/2021 01:16, Manuel Sp?nola wrote:
> Dear list members,
> 
> When using st_transform in a stars object the offset and delta parameters
> become NA, is this an expected behavior?

Yes, it also says that you got a curvilinear grid as a result, which is 
a grid with non-constant cell size (delta) and non-constant coordinate 
of the side (offset); see 
https://keen-swartz-3146c4.netlify.app/intro.html#raster-types

If you want a regular grid in the new CRS, use st_warp(), preferably 
with the target grid template.

> 
> 
> geomatrix = system.file("tif/geomatrix.tif", package = "stars")
> x = read_stars(geomatrix)
> 
> new = st_crs(4326)
> y = st_transform(x, new)
> y
> 
> 
> 
> 
> *Manuel Sp?nola, Ph.D.*
> Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
> Universidad Nacional
> Apartado 1350-3000
> Heredia
> COSTA RICA
> mspinola at una.cr <mspinola at una.ac.cr>
> mspinola10 at gmail.com
> Tel?fono: (506) 8706 - 4662
> Personal website: Lobito de r?o <https://sites.google.com/site/lobitoderio/>
> Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics
Heisenbergstrasse 2, 48151 Muenster, Germany
Phone: +49 251 8333081


From m@nue|@r|be|ro @end|ng |rom tecn|co@u||@bo@@pt  Mon Jun  7 14:55:23 2021
From: m@nue|@r|be|ro @end|ng |rom tecn|co@u||@bo@@pt (Manuel Luis Castro Ribeiro)
Date: Mon, 07 Jun 2021 13:55:23 +0100
Subject: [R-sig-Geo] How to obtain standard errors of local regression
 coefficients in spgwr::ggwr()?
In-Reply-To: <791ae27-81dd-e25e-f98a-c6418e9a2245@reclus2.nhh.no>
References: <20210606113436.3D049DB7@hypatia.math.ethz.ch>
 <791ae27-81dd-e25e-f98a-c6418e9a2245@reclus2.nhh.no>
Message-ID: <d16956fbb6c918c9bec47faa9b06dd1e@tecnico.ulisboa.pt>

Ok, thank you for your suggestion and clarification.
Manuel


A 2021-06-06 15:14, Roger Bivand escreveu:
> Does ?spgwr::ggwr state that any such values are returned? It says:
> 
> "a SpatialPointsDataFrame (may be gridded) or SpatialPolygonsDataFrame
> object (see package "sp") with fit.points, weights, GWR coefficient
> estimates, dispersion if a "quasi"-family is used, and the residuals
> of type "type" in its "data" slot."
> 
> Nothing else is returned. You may like to try the GWmodel package,
> which may offer some further output, but this is a largely unexplored
> area, and in any case inference is not encouraged for GW output as the
> technique is exploratory.
> 
> Hope this clarifies.
> 
> Roger
> 
> PS. Please post plain text, not HTML-formatted.
> 
> On Sun, 6 Jun 2021, mr via R-sig-Geo wrote:
> 
>> Dear list,
>> 
>> I am using?spgwr::ggwr()?to fit generalized geographically weighted 
>> regression with Poisson model and log-link function. The results 
>> provide local coefficient estimates, but i am missing how to get their 
>> standard errors (or t statistics) to compute pseudo p-values.
>> Below is a toy example using?SpatialEpi::NYleukemia?dataset:
>> 
>> # --------
>> 
>> library(SpatialEpi)
>> library(spgwr)
>> 
>> ## Load data
>> data(NYleukemia)
>> population <- NYleukemia$data$population
>> cases <- ceiling(NYleukemia$data$cases * 100)
>> centroids <- latlong2grid(NYleukemia$geo[, 2:3])
>> 
>> # data frame
>> nyleuk <- data.frame(centroids, cases, population)
>> 
>> # set coordinates as vector
>> coordny <- cbind(centroids[,1],centroids[,2])
>> 
>> # set a kernel bandwidth
>> bw <- 0.5
>> 
>> # fit ggwr()
>> m_pois <- ggwr(cases ~ offset(log(population)),
>>               data = nyleuk, gweight = gwr.Gauss,
>>               adapt = bw, family = poisson(link="log"),
>>               type="working", coords = coordny)
>> 
>> # returns spatial point with coefficients
>> # but no standard errors :(
>> head(m_pois$SDF at data)
>> 
>> # -------
>> 
>> Is there any way to get standard errors of the local coefficients?
>> Thank you, Manuel
>> 
>> 
>> Sent from Mail for Windows 10
>> 
>> 
>> 	[[alternative HTML version deleted]]
>> 
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>


From m@p|no|@10 @end|ng |rom gm@||@com  Mon Jun  7 16:12:02 2021
From: m@p|no|@10 @end|ng |rom gm@||@com (=?UTF-8?Q?Manuel_Sp=C3=ADnola?=)
Date: Mon, 7 Jun 2021 08:12:02 -0600
Subject: [R-sig-Geo] stars st_transform gives NA to the offset and delta
 parameters
In-Reply-To: <d14fe558-7580-cefa-7f3c-80bc964202ed@uni-muenster.de>
References: <CABkCotR0a-Sto9WZPpZzThW6uw94RS7iKYdgoUDvCwDOjABOWA@mail.gmail.com>
 <d14fe558-7580-cefa-7f3c-80bc964202ed@uni-muenster.de>
Message-ID: <CABkCotTzDYk2ChLGvvyi+xHVCVD1aLQHjs1o+8GDAVQaHF41_A@mail.gmail.com>

Thank you very much Edzer,

I am working with a raster file of land cover from the Copernicus Global
Land Service that is 100m resolution but the file is in a regular
latitude/longitude grid (EPSG:4326).

How can I project this file to UTM keeping the 100m resolution?

You told me to go with st_warp but when I did that I got the following
error.

raster_utm <- st_warp(land_cover, crs = 5367)

Error in matrix(seq_len(prod(dims[dxy])), dims[dxy[1]], dims[dxy[2]])[xy] :
subscript out of bounds


I am missing an argument?

How can I specify the target grid template?

Manuel

El lun, 7 jun 2021 a las 1:02, Edzer Pebesma (<edzer.pebesma at uni-muenster.de>)
escribi?:

>
>
> On 07/06/2021 01:16, Manuel Sp?nola wrote:
> > Dear list members,
> >
> > When using st_transform in a stars object the offset and delta parameters
> > become NA, is this an expected behavior?
>
> Yes, it also says that you got a curvilinear grid as a result, which is
> a grid with non-constant cell size (delta) and non-constant coordinate
> of the side (offset); see
> https://keen-swartz-3146c4.netlify.app/intro.html#raster-types
>
> If you want a regular grid in the new CRS, use st_warp(), preferably
> with the target grid template.
>
> >
> >
> > geomatrix = system.file("tif/geomatrix.tif", package = "stars")
> > x = read_stars(geomatrix)
> >
> > new = st_crs(4326)
> > y = st_transform(x, new)
> > y
> >
> >
> >
> >
> > *Manuel Sp?nola, Ph.D.*
> > Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
> > Universidad Nacional
> > Apartado 1350-3000
> > Heredia
> > COSTA RICA
> > mspinola at una.cr <mspinola at una.ac.cr>
> > mspinola10 at gmail.com
> > Tel?fono: (506) 8706 - 4662
> > Personal website: Lobito de r?o <
> https://sites.google.com/site/lobitoderio/>
> > Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>
> >
> >       [[alternative HTML version deleted]]
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
>
> --
> Edzer Pebesma
> Institute for Geoinformatics
> Heisenbergstrasse 2, 48151 Muenster, Germany
> Phone: +49 251 8333081
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


-- 
*Manuel Sp?nola, Ph.D.*
Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
Universidad Nacional
Apartado 1350-3000
Heredia
COSTA RICA
mspinola at una.cr <mspinola at una.ac.cr>
mspinola10 at gmail.com
Tel?fono: (506) 8706 - 4662
Personal website: Lobito de r?o <https://sites.google.com/site/lobitoderio/>
Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>

	[[alternative HTML version deleted]]


From Geo||rey@R@w||ng @end|ng |rom nmt@edu  Thu Jun 10 21:15:26 2021
From: Geo||rey@R@w||ng @end|ng |rom nmt@edu (Rawling, Geoffrey)
Date: Thu, 10 Jun 2021 13:15:26 -0600
Subject: [R-sig-Geo] strange variance patterns in spatiotemporal kriging
Message-ID: <CAOBZqnjOZewT53ithRg4USuYMwwXZ+0kGiKRp7_=MoKBtyZ0Og@mail.gmail.com>

Hello list members

I have encountered some strange map patterns of variance when using
spatiotemporal kriging in R - gstat on water level data. I have
measurements from wells in a basin over a period of 40 years. Most
wells have 10 or fewer measurements. But 4 wells in one cluster have
from 70 to 180 measurements.

The kriged water level surfaces look fine. But the variance (shown as
std error on linked maps) is sensitive to the two parameters nmax and
buffernmax in krigeST. Below are three dropbox links to maps titled as
to the settings of these parameters in krigeST. The triangular region
of high variance persists around the cluster of wells with many
measurements (east of Silver City on the maps) in all cases.

Is there any theoretical reason for the irregular variance patterns?
And the persistence of the triangular pattern? Just an artifact of the
computation algorithm...if that is the case how best to explain it?

Many thanks for any insight

https://www.dropbox.com/s/nro53i84k3cce2x/nmax_20_buffnmax_1.jpeg?dl=0

https://www.dropbox.com/s/8k4zll7aqv3xh1k/nmax_100_buffnmax_2.jpeg?dl=0

https://www.dropbox.com/s/czg4ix70a4wzouq/nmax_200_buffnmax_2.jpeg?dl=0

-- 
*********************************************

Geoffrey Rawling

Senior Field Geologist
NM Bureau of Geology and Mineral Resources

Geoffrey.Rawling at nmt.edu

1015 Tijeras Avenue NW, Suite 200
Albuquerque, NM, 87102

505-366-2535 phone
505-999-8307 cell


From md@umner @end|ng |rom gm@||@com  Fri Jun 11 04:16:44 2021
From: md@umner @end|ng |rom gm@||@com (Michael Sumner)
Date: Fri, 11 Jun 2021 12:16:44 +1000
Subject: [R-sig-Geo] How to define a local equidistant CRS
In-Reply-To: <7e729e63-cfbd-ea04-689e-64a07b9b6d15@gmail.com>
References: <CAObswFCXUexWJotJ8+HwAHG7=mjpvrxUaWSpePoNtWrDeY0Huw@mail.gmail.com>
 <9c61fb11-48bb-6548-bd46-65c235889cf0@reclus.nhh.no>
 <fe6e5614-7438-951b-56b5-fe651efe7cc5@gmail.com>
 <1444978-f42f-fb9-b0f5-b7286a438ea5@reclus.nhh.no>
 <1ce93ae-f41e-79c3-21c-510fcdbb2f@reclus.nhh.no>
 <8a5e718f-74a8-5b6b-8941-6cb9c34caee6@gmail.com>
 <6ce77ce3-e494-d833-af3a-a97467130c4@reclus.nhh.no>
 <7e729e63-cfbd-ea04-689e-64a07b9b6d15@gmail.com>
Message-ID: <CAAcGz99h1NHJMuqz5d_FqdzHzVYc=y6kks=-GBPdCJFcO6sZdg@mail.gmail.com>

I'd do

local_aeqd <- function(lon, lat) {
  sprintf("+proj=aeqd +lat_0=%f +lon_0=%f +datum=WGS84", lat, lon)
}

local_aeqd(147, -42)

just note that the very high accuracy of distances only applies from points
to that central point  - but for a fair region around probably suits your
purposes well also and definitely a 15km region, the equidistant property
is unlikely to matter at that scale, for general use I go for laea or if I
have a definite extent and for larger regions >=1000km lcc with +lat_1
and +lat_2 set to the north/south extent.

But, do you really need a projection or just distance between points of
long-lat? (Can't tell from your description). I use geosphere or geodist
routinely, the same code (Karney) exists in the sf stack as well.

Cheers, Mike.

On Sun, Jan 24, 2021 at 2:56 AM Micha Silver <tsvibar at gmail.com> wrote:

>
> On 1/23/21 1:05 PM, Roger Bivand wrote:
>
> On Sat, 23 Jan 2021, Micha Silver wrote:
>
>
> Roger:
>
>
>
>
> Yes, but the exceptions for WGS84, NAD83 and NAD27 are just that,
> exceptions from the general rule of +datum= being dropped. The next road
> bump will occcur soon(ish) because WGS84 is an ensemble of datum
> specifications, not a unique specification, and PROJ 7.2.0 is starting to
> address this: https://proj.org/news.html (Update to EPSG 10.003 and make
> code base robust to dealing with WKT CRS with DatumEnsemble (#2370)). The
> link to https://github.com/OSGeo/PROJ/pull/2370 gives details.
>
> Unless you need sub-metre accuracy, this may not matter, but if different
> parts of the world use different WGS84 definitions (at different times),
> the s2 package may be more stable though a little less accurate.
>
> Sub meter accuracy is definitely not an issue in our use case. The
> microwave antennas are from 1-12 km apart. We need the list of antennas
> that are within a radius of about 15 km. Missing one antenna that is, on a
> sphere, a few 10's of meters too far is of no consequence here.
>
>
> This is more detail than you expected, I think, but at least it is a way
> of documenting things.
>
> Well, like you said, you can't get the sweet potatoes back after cooking
> orange vegetable soup.
>
> :-)
>
>
> Roger
>
>
>
>       If this isn't a reprex, please extend briefly.
>
>       Roger
>
>
> Thanks again,
>
> Regards, Micha
>
>
>
>
> --
> Micha Silver
> Ben Gurion Univ.
> Sde Boker, Remote Sensing Lab
> cell: +972-523-665918
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


-- 
Michael Sumner
Software and Database Engineer
Australian Antarctic Division
Hobart, Australia
e-mail: mdsumner at gmail.com

	[[alternative HTML version deleted]]


From t@v|b@r @end|ng |rom gm@||@com  Mon Jun 14 15:54:03 2021
From: t@v|b@r @end|ng |rom gm@||@com (Micha Silver)
Date: Mon, 14 Jun 2021 16:54:03 +0300
Subject: [R-sig-Geo] How to define a local equidistant CRS
In-Reply-To: <CAAcGz99h1NHJMuqz5d_FqdzHzVYc=y6kks=-GBPdCJFcO6sZdg@mail.gmail.com>
References: <CAObswFCXUexWJotJ8+HwAHG7=mjpvrxUaWSpePoNtWrDeY0Huw@mail.gmail.com>
 <9c61fb11-48bb-6548-bd46-65c235889cf0@reclus.nhh.no>
 <fe6e5614-7438-951b-56b5-fe651efe7cc5@gmail.com>
 <1444978-f42f-fb9-b0f5-b7286a438ea5@reclus.nhh.no>
 <1ce93ae-f41e-79c3-21c-510fcdbb2f@reclus.nhh.no>
 <8a5e718f-74a8-5b6b-8941-6cb9c34caee6@gmail.com>
 <6ce77ce3-e494-d833-af3a-a97467130c4@reclus.nhh.no>
 <7e729e63-cfbd-ea04-689e-64a07b9b6d15@gmail.com>
 <CAAcGz99h1NHJMuqz5d_FqdzHzVYc=y6kks=-GBPdCJFcO6sZdg@mail.gmail.com>
Message-ID: <0557ab26-7bf1-caf9-69af-bfaaf92fb530@gmail.com>

An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20210614/707d4eb9/attachment.html>

From md@umner @end|ng |rom gm@||@com  Tue Jun 15 02:43:58 2021
From: md@umner @end|ng |rom gm@||@com (Michael Sumner)
Date: Tue, 15 Jun 2021 10:43:58 +1000
Subject: [R-sig-Geo] How to define a local equidistant CRS
In-Reply-To: <0557ab26-7bf1-caf9-69af-bfaaf92fb530@gmail.com>
References: <CAObswFCXUexWJotJ8+HwAHG7=mjpvrxUaWSpePoNtWrDeY0Huw@mail.gmail.com>
 <9c61fb11-48bb-6548-bd46-65c235889cf0@reclus.nhh.no>
 <fe6e5614-7438-951b-56b5-fe651efe7cc5@gmail.com>
 <1444978-f42f-fb9-b0f5-b7286a438ea5@reclus.nhh.no>
 <1ce93ae-f41e-79c3-21c-510fcdbb2f@reclus.nhh.no>
 <8a5e718f-74a8-5b6b-8941-6cb9c34caee6@gmail.com>
 <6ce77ce3-e494-d833-af3a-a97467130c4@reclus.nhh.no>
 <7e729e63-cfbd-ea04-689e-64a07b9b6d15@gmail.com>
 <CAAcGz99h1NHJMuqz5d_FqdzHzVYc=y6kks=-GBPdCJFcO6sZdg@mail.gmail.com>
 <0557ab26-7bf1-caf9-69af-bfaaf92fb530@gmail.com>
Message-ID: <CAAcGz98-aOBizFfJZ6U=v=PbntxcYTM4ow1fVLJk6pBC92_gWQ@mail.gmail.com>

Hi again, at that kind of range - 15km - you could choose almost any
projection family and a custom centre. I don't think distance accuracy fors
those distances  would be an issue even over a continent like USA or
Australia. AEQD or LAEA or LCC , doesn't matter. What you might consider is
a single custom projection (or an actual authority one, such as Abers for
USA, or LCC for Australia (they exist)) that is suitable for all of your
sites to avoid complexity.

(I avoid UTM because it's rarely suitable, sometimes its actual properties
are of use but mostly it's a legacy from a previous age, it's only in wide
use because authorities did deploy it for local use in many many
jurisdictions, and it's easy to calculate.)

For custom use I find it simpler to pick a long-lat centre for a LAEA, it
requires less effort and is more robust *globally* that any UTM choice.

In terms of your locality, the actual region over which your sites might
be, maybe you do need a non-WGS84 datum, and perhaps a non-temporal or an
actual specific-temporal datum family  - but I don't get that impression
from your description.

Cheers, Mike



On Mon, Jun 14, 2021 at 11:54 PM Micha Silver <tsvibar at gmail.com> wrote:

> Hello Mike:
>
>
> Thanks for addressing this issue.
>
>
> A few more details might make the overall goal clearer. The RAINLINK
> package converts cellular signal attenuation between microwave towers to
> rain rate (path averaged depending on the distance between the towers).
> Typically the tower locations will be in longitude/latitude, but RAINLINK
> needs Cartesian coordinates in three functions:
>
>
> 1- An important first step in RAINLINK determines if the microwave antenna
> itself is wet (causing attenuation even before hitting any rain). The
> approach adopted in the package is to find other antennas in the time and
> space vicinity that also are experiencing attenuation. Here we need to get
> those antennas that are within, say, 15 km. This issue can be easily
> addressed with the distVincenty* functions from geosphere, or (as Roger
> suggested) using the new s2 package for calculating distances on a sphere.
> No need really for any reprojection (submeter accuracy is not an issue).
>
>
> 2- RAINLINK also produces some informative plots of the topology of the
> microwave link network.  Among them bar plots of distances between towers
> vs frequency, etc. Here, cartesian distance is needed, but again, we could
> probably get away with either of the distance on sphere functions above.
>
>
> 3- The more tricky problem (I think) is the RAINLINK interpolation
> function. Here, both IDW and kriging are used to produce precipitation
> distribution maps. A Cartesian CRS is needed/preferred, I believe, both to
> construct the variogram model, and to create the target interpolation grid.
>
>
> So, my intuition is to choose right at the start a "proper" projected CRS
> depending on the location on the earth, and use that throughout. In the
> current version of RAINLINK a hand-crafted aeqd CRS was defined from the
> middle of the distribution of antennas. But now, with proj >=6.x
> definitions like:
>
>   projstring <- paste("+proj=aeqd +R_A +lat_0=", YMiddle,
>                       " +lon_0=", XMiddle,
>                       " +x_0=0 +y_0=0 +ellps=WGS84",sep="")
>
> might not be future-proof. The second option could be a local UTM based
> CRS, getting the zone from the XMiddle, Ymiddle values.
>
>
> Any other suggestions are welcome!
>
>
> Best,
>
> Micha
>
>
>
>
>
>
>
> On 6/11/21 5:16 AM, Michael Sumner wrote:
>
> I'd do
>
> local_aeqd <- function(lon, lat) {
>   sprintf("+proj=aeqd +lat_0=%f +lon_0=%f +datum=WGS84", lat, lon)
> }
>
> local_aeqd(147, -42)
>
> just note that the very high accuracy of distances only applies from
> points to that central point  - but for a fair region around probably suits
> your purposes well also and definitely a 15km region, the equidistant
> property is unlikely to matter at that scale, for general use I go for laea
> or if I have a definite extent and for larger regions >=1000km lcc
> with +lat_1 and +lat_2 set to the north/south extent.
>
> But, do you really need a projection or just distance between points of
> long-lat? (Can't tell from your description). I use geosphere or geodist
> routinely, the same code (Karney) exists in the sf stack as well.
>
> Cheers, Mike.
>
> On Sun, Jan 24, 2021 at 2:56 AM Micha Silver <tsvibar at gmail.com> wrote:
>
>>
>> On 1/23/21 1:05 PM, Roger Bivand wrote:
>>
>> On Sat, 23 Jan 2021, Micha Silver wrote:
>>
>>
>> Roger:
>>
>>
>>
>>
>> Yes, but the exceptions for WGS84, NAD83 and NAD27 are just that,
>> exceptions from the general rule of +datum= being dropped. The next road
>> bump will occcur soon(ish) because WGS84 is an ensemble of datum
>> specifications, not a unique specification, and PROJ 7.2.0 is starting to
>> address this: https://proj.org/news.html (Update to EPSG 10.003 and make
>> code base robust to dealing with WKT CRS with DatumEnsemble (#2370)). The
>> link to https://github.com/OSGeo/PROJ/pull/2370 gives details.
>>
>> Unless you need sub-metre accuracy, this may not matter, but if different
>> parts of the world use different WGS84 definitions (at different times),
>> the s2 package may be more stable though a little less accurate.
>>
>> Sub meter accuracy is definitely not an issue in our use case. The
>> microwave antennas are from 1-12 km apart. We need the list of antennas
>> that are within a radius of about 15 km. Missing one antenna that is, on a
>> sphere, a few 10's of meters too far is of no consequence here.
>>
>>
>> This is more detail than you expected, I think, but at least it is a way
>> of documenting things.
>>
>> Well, like you said, you can't get the sweet potatoes back after cooking
>> orange vegetable soup.
>>
>> :-)
>>
>>
>> Roger
>>
>>
>>
>>       If this isn't a reprex, please extend briefly.
>>
>>       Roger
>>
>>
>> Thanks again,
>>
>> Regards, Micha
>>
>>
>>
>>
>> --
>> Micha Silver
>> Ben Gurion Univ.
>> Sde Boker, Remote Sensing Lab
>> cell: +972-523-665918
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>
> --
> Michael Sumner
> Software and Database Engineer
> Australian Antarctic Division
> Hobart, Australia
> e-mail: mdsumner at gmail.com
>
> --
> Micha Silver
> Ben Gurion Univ.
> Sde Boker, Remote Sensing Lab
> cell: +972-523-665918
>
>

-- 
Michael Sumner
Software and Database Engineer
Australian Antarctic Division
Hobart, Australia
e-mail: mdsumner at gmail.com

	[[alternative HTML version deleted]]


From rodr|gue@@m@ch@do@hugo @end|ng |rom gm@||@com  Tue Jun 15 16:25:44 2021
From: rodr|gue@@m@ch@do@hugo @end|ng |rom gm@||@com (Hugo Machado Rodrigues)
Date: Tue, 15 Jun 2021 11:25:44 -0300
Subject: [R-sig-Geo] Prediction of multi-target models on stack objects
Message-ID: <CAOdRRoZrYpc3c00+-bF9-taTxyXr52K=dSWxw2GtpZyyW3Vp4w@mail.gmail.com>

Dear,

I am trying to adjust prediction models for laboratory-measured electrical
conductivity attributes (EC lab) for depths 0-10, 10-30, and 30-50 cm as a
function of apparent electrical conductivity and apparent magnetic
susceptibility attributes (aEC and aMS) measured by the EM38 sensor using
the two coil distances (aEC 1 and 0.5 m; aMS 1 and 0.5 m) in a saline area.

As laboratory attributes have spatial and depth dependency, I would like to
perform prediction models that consider this condition, and for that, I
decided on multi-output (target) modeling methods.

I am using the Elastic Net Regression approach, and I am using the
following piece of code below:

*# Selecting target variables*
*X <- dados_train %>%  select(CE_0_10,CE_10_30,CE_30_50) %>%  scale(center
= F, scale = F) %>% as.matrix()*













*# Selecting predicting variablesY <-dados_train
%>%  select(CE_1_m,CE_0_5_m,SM_1_m,SM_0_5_m) %>% scale(center = F, scale =
F) %> as.matrix()  # Model Building : Elastic Net Regressioncontrol <-
trainControl(method = "repeatedcv", number = 5, repeats = 5, search =
"random", verboseIter = TRUE)  # Training Elastic Net Regression
modelelastic_model_glmnet <- train(CE_0_10+CE_10_30+CE_30_50 ~ .,
                 data = cbind(X, Y),                           method =
"glmnet",                           preProcess = c("center", "scale"),
                     tuneLength = 25,                           trControl =
control)*

My question is:
*How can I predict using the three output models in the stack containing
the EM38 data layers?*

For this, I am using the code below:
# covariates is a stack object containing the 4 rasters of aEC and aMS data
for the two distances (1 and 0.5 m)
*map_glmnet<-raster::predict(covariates,elastic_model_glmnet,index=c(1:3))*

But that doesn't return me a layer for each target attribute (EC lab for
each depth).

Does anyone have any suggestions?

Best Regards

Hugo

	[[alternative HTML version deleted]]


From @bo @end|ng |rom e|r|ck@de  Tue Jun 15 17:57:34 2021
From: @bo @end|ng |rom e|r|ck@de (Tim Elrick)
Date: Tue, 15 Jun 2021 11:57:34 -0400
Subject: [R-sig-Geo] Encoding of attributes in SpatVector (terra package)
Message-ID: <8bb63203-cf40-7660-a512-6d5372995b8e@elrick.de>

Hi all,

Does anyone know how to change encoding for attributes in a SpatVector 
(terra package)?

library(sf) library(terra)
# importing a geojson file as sf object url <- 
"https://data.montreal.ca/dataset/00bd85eb-23aa-4669-8f1b-ba9a000e3dd8/resource/e9b0f927-8f75-458c-8fda-b5da65cc8b73/download/limadmin.geojson" 
mtl.sf <- read_sf(url)# convert sf object to SpatVector object mtl.spv 
<- vect(mtl) # while mtl.sf$NOM # displays French letters correctly, 
mtl.spv$NOM # does not anymore Thanks, Tim


	[[alternative HTML version deleted]]


From p|etro_te|@to @end|ng |rom hotm@||@com  Tue Jun 15 20:37:07 2021
From: p|etro_te|@to @end|ng |rom hotm@||@com (Pietro Andre Telatin Paschoalino)
Date: Tue, 15 Jun 2021 18:37:07 +0000
Subject: [R-sig-Geo] 3 Questions on CRS change
In-Reply-To: <12618f45-fcf9-781-c326-f56332ec423@reclus2.nhh.no>
References: <BN8PR17MB298076B84E38F1AED8BB190282309@BN8PR17MB2980.namprd17.prod.outlook.com>,
 <12618f45-fcf9-781-c326-f56332ec423@reclus2.nhh.no>
Message-ID: <BN8PR17MB29801643E6064FB2B428F79882309@BN8PR17MB2980.namprd17.prod.outlook.com>

1-  I tried to compare the CRS OGC with my raster (stack) and I couldn't:

My raster data are CRU DATA TS 4.04 (EAST ANGLIA)

 rgdal::compare_CRS(CRS("OGC:CRS84"), slot(rasbrick, "crs"))
 Error in CRS("OGC:CRS84") :
 PROJ4 argument-value pairs must begin with +: OGC:CRS84

 I also tried it like this:

 rgdal::compare_CRS(CRS("+OGC:CRS84"), slot(rasbrick, "crs"))
 Error in showSRID(uprojargs, format = "PROJ", multiline = "NO") :
 Can't parse PROJ.4-style parameter string
 +OGC:CRS84

 could you answer me where am I wrong?

When I compare a shapefile with my raster (stack) the function runs normally.

2- using:

cat(wkt(shapebefore), "\n")

cat(wkt(rasbrick), "\n")

I saw that the order of the axis were different, but after the transformation they were the same.

Any problem making shapeafter<- spTransform(shapebefore, crs(rasbrick))

when are the axis different before the transformation?

Ex:

 cat(wkt(shapebefore), "\n")
GEOGCRS["WGS 84",
    DATUM["World Geodetic System 1984",
        ELLIPSOID["WGS 84",6378137,298.257223563,
            LENGTHUNIT["metre",1]]],
    PRIMEM["Greenwich",0,
        ANGLEUNIT["degree",0.0174532925199433]],
    CS[ellipsoidal,2],
        AXIS["latitude",north,
            ORDER[1],
            ANGLEUNIT["degree",0.0174532925199433]],
        AXIS["longitude",east,
            ORDER[2],
            ANGLEUNIT["degree",0.0174532925199433]],
    ID["EPSG",4326]]

> cat(wkt(rasbrick), "\n")
GEOGCRS["unknown",
    DATUM["World Geodetic System 1984",
        ELLIPSOID["WGS 84",6378137,298.257223563,
            LENGTHUNIT["metre",1]],
        ID["EPSG",6326]],
    PRIMEM["Greenwich",0,
        ANGLEUNIT["degree",0.0174532925199433],
        ID["EPSG",8901]],
    CS[ellipsoidal,2],
        AXIS["longitude",east,
            ORDER[1],
            ANGLEUNIT["degree",0.0174532925199433,
                ID["EPSG",9122]]],
        AXIS["latitude",north,
            ORDER[2],
            ANGLEUNIT["degree",0.0174532925199433,
                ID["EPSG",9122]]]]

The order of the axis (and other parameters) of my new shape (shapeafter) is the same as the raster (rasbrick) after transformation.

3 -  when I use:

centroids = gCentroid(shapebefore, byid=TRUE)

and

centroids = gCentroid(shapeafter, byid=TRUE)

why are the coordinates x and y values equal (and the values are exactly the same)?

(It seems to me that both are longitude=x and latitude=y) but since the order is switched in cat(wkt(), shouldn't it be latitude=x and longitude=y in the shapebefore?

if I use proj4string()
both my shapebefore and my shapeafter are like:

"+proj=longlat +datum=WGS84 +no_defs"

> sessionInfo()
R version 3.6.2 (2019-12-12)
Platform: x86_64-w64-mingw32/x64 (64-bit)
Running under: Windows 10 x64 (build 19042)

Matrix products: default

locale:
[1] LC_COLLATE=English_United States.1252  LC_CTYPE=English_United States.1252
[3] LC_MONETARY=English_United States.1252 LC_NUMERIC=C
[5] LC_TIME=English_United States.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] spdep_1.1-5    sf_0.9-5       spData_0.3.8   maptools_1.0-1 xlsx_0.6.3     rgeos_0.5-3    raster_3.3-13
[8] rgdal_1.5-10   sp_1.4-2

loaded via a namespace (and not attached):
 [1] Rcpp_1.0.5         compiler_3.6.2     pillar_1.4.4       LearnBayes_2.15.1  class_7.3-15
 [6] tools_3.6.2        boot_1.3-23        nlme_3.1-142       lifecycle_0.2.0    tibble_3.0.1
[11] lattice_0.20-41    pkgconfig_2.0.3    rlang_0.4.7        Matrix_1.2-18      DBI_1.1.0
[16] rstudioapi_0.11    expm_0.999-5       coda_0.19-3        rJava_0.9-12       e1071_1.7-3
[21] dplyr_1.0.0        gtools_3.8.2       generics_0.0.2     xlsxjars_0.6.1     vctrs_0.3.1
[26] classInt_0.4-3     grid_3.6.2         tidyselect_1.1.0   glue_1.4.1         spDataLarge_0.4.1
[31] R6_2.4.1           foreign_0.8-72     gdata_2.18.0       deldir_0.1-28      purrr_0.3.4
[36] magrittr_1.5       gmodels_2.18.1     splines_3.6.2      MASS_7.3-51.4      codetools_0.2-16
[41] ellipsis_0.3.1     units_0.6-7        KernSmooth_2.23-16 crayon_1.3.4

Thanks.

Pietro Andre Telatin Paschoalino
Doutorando em Ci?ncias Econ?micas da Universidade Estadual de Maring? - PCE.

________________________________
De: Roger Bivand <Roger.Bivand at nhh.no>
Enviado: ter?a-feira, 15 de junho de 2021 15:18
Para: Pietro Andre Telatin Paschoalino <Pietro_telato at hotmail.com>
Assunto: Re: Doubt in function compare_CRS

Please do not email me directly. For use questions, please subscribe to
R-sig-geo

https://stat.ethz.ch/mailman/listinfo/R-SIG-Geo

and post there. Your problem cannot be reproduced by me (I do not know
what your raster is) - when you post provide a minimal self-contained
example. Do also provide the output of sessionInfo(), as you may not be
using updated packages.

Roger Bivand


On Tue, 15 Jun 2021, Pietro Andre Telatin Paschoalino wrote:

> Hello Bivand,
>
> How you create the function compare_CRS and it has already exemplified
> several issues for me. I would like to know if you can help me with a
> simple issue
>
> I tried to compare the CRS OGC with my raster (stack) and I couldn't:
>
> rgdal::compare_CRS(CRS("OGC:CRS84"), slot(rasbrick, "crs"))
> Error in CRS("OGC:CRS84") :
> PROJ4 argument-value pairs must begin with +: OGC:CRS84
>
> I also tried it like this:
>
> rgdal::compare_CRS(CRS("+OGC:CRS84"), slot(rasbrick, "crs"))
> Error in showSRID(uprojargs, format = "PROJ", multiline = "NO") :
> Can't parse PROJ.4-style parameter string
> +OGC:CRS84
>
> could you answer me where am I wrong?
>
> When I compare a shapefile with my raster (stack) the function runs normally, for example:
>
> compare_CRS(slot(shape1, "proj4string"), slot(rasbrick, "crs"))
>                      strict                   equivalent equivalent_except_axis_order
>                       FALSE                         TRUE                         TRUE
>
> Thank you.
>
> Pietro Andre Telatin Paschoalino
> Doutorando em Ci?ncias Econ?micas da Universidade Estadual de Maring? - PCE.
>
> [https://ipmcdn.avast.com/images/icons/icon-envelope-tick-round-orange-animated-no-repeat-v1.gif]<https://www.avast.com/sig-email?utm_medium=email&utm_source=link&utm_campaign=sig-email&utm_content=webmail&utm_term=icon>    Virus-free. www.avast.com<https://www.avast.com/sig-email?utm_medium=email&utm_source=link&utm_campaign=sig-email&utm_content=webmail&utm_term=link>
>

--
Roger Bivand
Emeritus Professor
Department of Economics, Norwegian School of Economics,
Postboks 3490 Ytre Sandviken, 5045 Bergen, Norway.
e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

	[[alternative HTML version deleted]]


From btupper @end|ng |rom b|ge|ow@org  Wed Jun 16 00:32:00 2021
From: btupper @end|ng |rom b|ge|ow@org (Ben Tupper)
Date: Tue, 15 Jun 2021 18:32:00 -0400
Subject: [R-sig-Geo] 
 Encoding of attributes in SpatVector (terra package)
In-Reply-To: <8bb63203-cf40-7660-a512-6d5372995b8e@elrick.de>
References: <8bb63203-cf40-7660-a512-6d5372995b8e@elrick.de>
Message-ID: <CALrbzg1WrSOaOpGwVZdoucA7A4Q9LLCbzaDsojwrzpMSNFWViQ@mail.gmail.com>

Hi,

Alas, HTML mail gets mangled - try setting your email client to send plan text.

I don't know what the NOM variable contents are supposed to look like,
but I find they are identical.  Can you post to the list your evidence
that shows how they differ and what makes one right versus the other
wrong?  Also, always add the output of sessionInfo() as shown below.

library(sf)
library(terra)

url <- "https://data.montreal.ca/dataset/00bd85eb-23aa-4669-8f1b-ba9a000e3dd8/resource/e9b0f927-8f75-458c-8fda-b5da65cc8b73/download/limadmin.geojson"

mtl.sf <- read_sf(url)# convert sf object to SpatVector object

mtl.spv <- vect(mtl.sf)

identical(mtl.sf$NOM, mtl.spv$NOM)
# [1] TRUE

sessionInfo()
# R version 4.0.3 (2020-10-10)
# Platform: x86_64-apple-darwin17.0 (64-bit)
# Running under: macOS Big Sur 10.16
#
# Matrix products: default
# LAPACK: /Library/Frameworks/R.framework/Versions/4.0/Resources/lib/libRlapack.dylib
#
# locale:
#   [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
#
# attached base packages:
#   [1] stats     graphics  grDevices utils     datasets  methods   base
#
# other attached packages:
#   [1] terra_1.2-10 sf_0.9-8     dplyr_1.0.5
#
# loaded via a namespace (and not attached):
#   [1] Rcpp_1.0.6         rstudioapi_0.13    raster_3.4-5
magrittr_2.0.1     units_0.7-1        tidyselect_1.1.1
# [7] lattice_0.20-41    R6_2.5.0           rlang_0.4.11
fansi_0.4.2        blob_1.2.1         tools_4.0.3
# [13] grid_4.0.3         KernSmooth_2.23-17 utf8_1.2.1
cli_2.5.0          e1071_1.7-6        DBI_1.1.1
# [19] ellipsis_0.3.2     class_7.3-17       assertthat_0.2.1
tibble_3.1.1       lifecycle_1.0.0    crayon_1.4.1
# [25] purrr_0.3.4        codetools_0.2-16   vctrs_0.3.8
glue_1.4.2         sp_1.4-5           proxy_0.4-25
# [31] compiler_4.0.3     pillar_1.6.0       generics_0.1.0
classInt_0.4-3     pkgconfig_2.0.3

Cheers,
Ben


On Tue, Jun 15, 2021 at 11:57 AM Tim Elrick <abo at elrick.de> wrote:
>
> Hi all,
>
> Does anyone know how to change encoding for attributes in a SpatVector
> (terra package)?
>
> library(sf) library(terra)
> # importing a geojson file as sf object url <-
> "https://data.montreal.ca/dataset/00bd85eb-23aa-4669-8f1b-ba9a000e3dd8/resource/e9b0f927-8f75-458c-8fda-b5da65cc8b73/download/limadmin.geojson"
> mtl.sf <- read_sf(url)# convert sf object to SpatVector object mtl.spv
> <- vect(mtl) # while mtl.sf$NOM # displays French letters correctly,
> mtl.spv$NOM # does not anymore Thanks, Tim
>
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



-- 
Ben Tupper (he/him)
Bigelow Laboratory for Ocean Science
East Boothbay, Maine
http://www.bigelow.org/
https://eco.bigelow.org


From Roger@B|v@nd @end|ng |rom nhh@no  Wed Jun 16 09:18:37 2021
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Wed, 16 Jun 2021 09:18:37 +0200
Subject: [R-sig-Geo] 3 Questions on CRS change
In-Reply-To: <BN8PR17MB29801643E6064FB2B428F79882309@BN8PR17MB2980.namprd17.prod.outlook.com>
References: <BN8PR17MB298076B84E38F1AED8BB190282309@BN8PR17MB2980.namprd17.prod.outlook.com>,
 <12618f45-fcf9-781-c326-f56332ec423@reclus2.nhh.no>
 <BN8PR17MB29801643E6064FB2B428F79882309@BN8PR17MB2980.namprd17.prod.outlook.com>
Message-ID: <e677ca76-bfc2-5264-e8b1-d7fd58cbc4e@reclus2.nhh.no>

On Tue, 15 Jun 2021, Pietro Andre Telatin Paschoalino wrote:

> 1-  I tried to compare the CRS OGC with my raster (stack) and I couldn't:
>
> My raster data are CRU DATA TS 4.04 (EAST ANGLIA)

This is not a minimal reproducible example, perhaps

https://crudata.uea.ac.uk/cru/data/hrg/cru_ts_4.04/

is the source, but no specific (very small) file is indicated. Using the 
224MB cru_ts4.04.2011.2019.pre.dat.nc on an updated system (rgdal, raster 
and sp as CRAN, Linux, PROJ 8.0.1, GDAL 3.3.0) there is no problem.

You have rgdal 1.5-10 (CRAN has 1.5-23), sp 1.4-2 (CRAN has 1.4-5) and 
raster 3.3-13 (CRAN has 3.4-10), which I will not re-install because they 
are not the problem, and the current versions are available for R 3.6 on 
Windows. All the debugging needed is in the output of sessionInfo().

Please report back after updating at least sp, rgdal and raster (your 
raster version is also pretty outdated).

Roger Bivand

>
> rgdal::compare_CRS(CRS("OGC:CRS84"), slot(rasbrick, "crs"))
> Error in CRS("OGC:CRS84") :
> PROJ4 argument-value pairs must begin with +: OGC:CRS84
>
> I also tried it like this:
>
> rgdal::compare_CRS(CRS("+OGC:CRS84"), slot(rasbrick, "crs"))
> Error in showSRID(uprojargs, format = "PROJ", multiline = "NO") :
> Can't parse PROJ.4-style parameter string
> +OGC:CRS84
>
> could you answer me where am I wrong?
>
> When I compare a shapefile with my raster (stack) the function runs normally.
>
> 2- using:
>
> cat(wkt(shapebefore), "\n")
>
> cat(wkt(rasbrick), "\n")
>
> I saw that the order of the axis were different, but after the transformation they were the same.
>
> Any problem making shapeafter<- spTransform(shapebefore, crs(rasbrick))
>
> when are the axis different before the transformation?
>
> Ex:
>
> cat(wkt(shapebefore), "\n")
> GEOGCRS["WGS 84",
>    DATUM["World Geodetic System 1984",
>        ELLIPSOID["WGS 84",6378137,298.257223563,
>            LENGTHUNIT["metre",1]]],
>    PRIMEM["Greenwich",0,
>        ANGLEUNIT["degree",0.0174532925199433]],
>    CS[ellipsoidal,2],
>        AXIS["latitude",north,
>            ORDER[1],
>            ANGLEUNIT["degree",0.0174532925199433]],
>        AXIS["longitude",east,
>            ORDER[2],
>            ANGLEUNIT["degree",0.0174532925199433]],
>    ID["EPSG",4326]]
>
>> cat(wkt(rasbrick), "\n")
> GEOGCRS["unknown",
>    DATUM["World Geodetic System 1984",
>        ELLIPSOID["WGS 84",6378137,298.257223563,
>            LENGTHUNIT["metre",1]],
>        ID["EPSG",6326]],
>    PRIMEM["Greenwich",0,
>        ANGLEUNIT["degree",0.0174532925199433],
>        ID["EPSG",8901]],
>    CS[ellipsoidal,2],
>        AXIS["longitude",east,
>            ORDER[1],
>            ANGLEUNIT["degree",0.0174532925199433,
>                ID["EPSG",9122]]],
>        AXIS["latitude",north,
>            ORDER[2],
>            ANGLEUNIT["degree",0.0174532925199433,
>                ID["EPSG",9122]]]]
>
> The order of the axis (and other parameters) of my new shape (shapeafter) is the same as the raster (rasbrick) after transformation.
>
> 3 -  when I use:
>
> centroids = gCentroid(shapebefore, byid=TRUE)
>
> and
>
> centroids = gCentroid(shapeafter, byid=TRUE)
>
> why are the coordinates x and y values equal (and the values are exactly the same)?
>
> (It seems to me that both are longitude=x and latitude=y) but since the order is switched in cat(wkt(), shouldn't it be latitude=x and longitude=y in the shapebefore?
>
> if I use proj4string()
> both my shapebefore and my shapeafter are like:
>
> "+proj=longlat +datum=WGS84 +no_defs"
>
>> sessionInfo()
> R version 3.6.2 (2019-12-12)
> Platform: x86_64-w64-mingw32/x64 (64-bit)
> Running under: Windows 10 x64 (build 19042)
>
> Matrix products: default
>
> locale:
> [1] LC_COLLATE=English_United States.1252  LC_CTYPE=English_United States.1252
> [3] LC_MONETARY=English_United States.1252 LC_NUMERIC=C
> [5] LC_TIME=English_United States.1252
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> other attached packages:
> [1] spdep_1.1-5    sf_0.9-5       spData_0.3.8   maptools_1.0-1 xlsx_0.6.3     rgeos_0.5-3    raster_3.3-13
> [8] rgdal_1.5-10   sp_1.4-2
>
> loaded via a namespace (and not attached):
> [1] Rcpp_1.0.5         compiler_3.6.2     pillar_1.4.4       LearnBayes_2.15.1  class_7.3-15
> [6] tools_3.6.2        boot_1.3-23        nlme_3.1-142       lifecycle_0.2.0    tibble_3.0.1
> [11] lattice_0.20-41    pkgconfig_2.0.3    rlang_0.4.7        Matrix_1.2-18      DBI_1.1.0
> [16] rstudioapi_0.11    expm_0.999-5       coda_0.19-3        rJava_0.9-12       e1071_1.7-3
> [21] dplyr_1.0.0        gtools_3.8.2       generics_0.0.2     xlsxjars_0.6.1     vctrs_0.3.1
> [26] classInt_0.4-3     grid_3.6.2         tidyselect_1.1.0   glue_1.4.1         spDataLarge_0.4.1
> [31] R6_2.4.1           foreign_0.8-72     gdata_2.18.0       deldir_0.1-28      purrr_0.3.4
> [36] magrittr_1.5       gmodels_2.18.1     splines_3.6.2      MASS_7.3-51.4      codetools_0.2-16
> [41] ellipsis_0.3.1     units_0.6-7        KernSmooth_2.23-16 crayon_1.3.4
>
> Thanks.
>
> Pietro Andre Telatin Paschoalino
> Doutorando em Ci?ncias Econ?micas da Universidade Estadual de Maring? - PCE.
>
> ________________________________
> De: Roger Bivand <Roger.Bivand at nhh.no>
> Enviado: ter?a-feira, 15 de junho de 2021 15:18
> Para: Pietro Andre Telatin Paschoalino <Pietro_telato at hotmail.com>
> Assunto: Re: Doubt in function compare_CRS
>
> Please do not email me directly. For use questions, please subscribe to
> R-sig-geo
>
> https://stat.ethz.ch/mailman/listinfo/R-SIG-Geo
>
> and post there. Your problem cannot be reproduced by me (I do not know
> what your raster is) - when you post provide a minimal self-contained
> example. Do also provide the output of sessionInfo(), as you may not be
> using updated packages.
>
> Roger Bivand
>
>
> On Tue, 15 Jun 2021, Pietro Andre Telatin Paschoalino wrote:
>
>> Hello Bivand,
>>
>> How you create the function compare_CRS and it has already exemplified
>> several issues for me. I would like to know if you can help me with a
>> simple issue
>>
>> I tried to compare the CRS OGC with my raster (stack) and I couldn't:
>>
>> rgdal::compare_CRS(CRS("OGC:CRS84"), slot(rasbrick, "crs"))
>> Error in CRS("OGC:CRS84") :
>> PROJ4 argument-value pairs must begin with +: OGC:CRS84
>>
>> I also tried it like this:
>>
>> rgdal::compare_CRS(CRS("+OGC:CRS84"), slot(rasbrick, "crs"))
>> Error in showSRID(uprojargs, format = "PROJ", multiline = "NO") :
>> Can't parse PROJ.4-style parameter string
>> +OGC:CRS84
>>
>> could you answer me where am I wrong?
>>
>> When I compare a shapefile with my raster (stack) the function runs normally, for example:
>>
>> compare_CRS(slot(shape1, "proj4string"), slot(rasbrick, "crs"))
>>                      strict                   equivalent equivalent_except_axis_order
>>                       FALSE                         TRUE                         TRUE
>>
>> Thank you.
>>
>> Pietro Andre Telatin Paschoalino
>> Doutorando em Ci?ncias Econ?micas da Universidade Estadual de Maring? - PCE.
>>
>> [https://ipmcdn.avast.com/images/icons/icon-envelope-tick-round-orange-animated-no-repeat-v1.gif]<https://www.avast.com/sig-email?utm_medium=email&utm_source=link&utm_campaign=sig-email&utm_content=webmail&utm_term=icon>    Virus-free. www.avast.com<https://www.avast.com/sig-email?utm_medium=email&utm_source=link&utm_campaign=sig-email&utm_content=webmail&utm_term=link>
>>
>
> --
> Roger Bivand
> Emeritus Professor
> Department of Economics, Norwegian School of Economics,
> Postboks 3490 Ytre Sandviken, 5045 Bergen, Norway.
> e-mail: Roger.Bivand at nhh.no
> https://orcid.org/0000-0003-2392-6140
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>
> 	[[alternative HTML version deleted]]
>
>

-- 
Roger Bivand
Emeritus Professor
Department of Economics, Norwegian School of Economics,
Postboks 3490 Ytre Sandviken, 5045 Bergen, Norway.
e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

From p|etro_te|@to @end|ng |rom hotm@||@com  Wed Jun 16 13:30:05 2021
From: p|etro_te|@to @end|ng |rom hotm@||@com (Pietro Andre Telatin Paschoalino)
Date: Wed, 16 Jun 2021 08:30:05 -0300
Subject: [R-sig-Geo] 3 Questions on CRS change
In-Reply-To: <e677ca76-bfc2-5264-e8b1-d7fd58cbc4e@reclus2.nhh.no>
Message-ID: <BN8PR17MB298021CB6EC64184F19E827A820F9@BN8PR17MB2980.namprd17.prod.outlook.com>

An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20210616/85e2275b/attachment.html>

From Roger@B|v@nd @end|ng |rom nhh@no  Wed Jun 16 13:38:15 2021
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Wed, 16 Jun 2021 13:38:15 +0200
Subject: [R-sig-Geo] 3 Questions on CRS change
In-Reply-To: <BN8PR17MB298021CB6EC64184F19E827A820F9@BN8PR17MB2980.namprd17.prod.outlook.com>
References: <BN8PR17MB298021CB6EC64184F19E827A820F9@BN8PR17MB2980.namprd17.prod.outlook.com>
Message-ID: <77dba567-84fe-ac59-191a-a323eabd5c4@reclus2.nhh.no>

On Wed, 16 Jun 2021, Pietro Andre Telatin Paschoalino wrote:

> Hello Roger,
> Thank you. I'll update the packages and try again.
> 
> And about my doubts 2 and 3, you know If there is any problem?

Try them after updating as they may differ. 2 - nobody knows, 
sp/rgdal/raster try to impose GIS/visualization order. 3 - try to avoid 
using rgeos with unprojected geometries, it only provides accurate 
centroids for planar geometries.

Roger

> 
> Thanks again.
> 
> Em 16 de jun de 2021 04:18, Roger Bivand <Roger.Bivand at nhh.no> escreveu:
>
>       On Tue, 15 Jun 2021, Pietro Andre Telatin Paschoalino wrote:
>
>       > 1-? I tried to compare the CRS OGC with my raster (stack)
>       and I couldn't:
>       >
>       > My raster data are CRU DATA TS 4.04 (EAST ANGLIA)
>
>       This is not a minimal reproducible example, perhaps
>
>       https://crudata.uea.ac.uk/cru/data/hrg/cru_ts_4.04/
>
>       is the source, but no specific (very small) file is indicated.
>       Using the
>       224MB cru_ts4.04.2011.2019.pre.dat.nc on an updated system
>       (rgdal, raster
>       and sp as CRAN, Linux, PROJ 8.0.1, GDAL 3.3.0) there is no
>       problem.
>
>       You have rgdal 1.5-10 (CRAN has 1.5-23), sp 1.4-2 (CRAN has
>       1.4-5) and
>       raster 3.3-13 (CRAN has 3.4-10), which I will not re-install
>       because they
>       are not the problem, and the current versions are available
>       for R 3.6 on
>       Windows. All the debugging needed is in the output of
>       sessionInfo().
>
>       Please report back after updating at least sp, rgdal and
>       raster (your
>       raster version is also pretty outdated).
>
>       Roger Bivand
>
>       >
>       > rgdal::compare_CRS(CRS("OGC:CRS84"), slot(rasbrick, "crs"))
>       > Error in CRS("OGC:CRS84") :
>       > PROJ4 argument-value pairs must begin with +: OGC:CRS84
>       >
>       > I also tried it like this:
>       >
>       > rgdal::compare_CRS(CRS("+OGC:CRS84"), slot(rasbrick, "crs"))
>       > Error in showSRID(uprojargs, format = "PROJ", multiline =
>       "NO") :
>       > Can't parse PROJ.4-style parameter string
>       > +OGC:CRS84
>       >
>       > could you answer me where am I wrong?
>       >
>       > When I compare a shapefile with my raster (stack) the
>       function runs normally.
>       >
>       > 2- using:
>       >
>       > cat(wkt(shapebefore), "\n")
>       >
>       > cat(wkt(rasbrick), "\n")
>       >
>       > I saw that the order of the axis were different, but after
>       the transformation they were the same.
>       >
>       > Any problem making shapeafter<- spTransform(shapebefore,
>       crs(rasbrick))
>       >
>       > when are the axis different before the transformation?
>       >
>       > Ex:
>       >
>       > cat(wkt(shapebefore), "\n")
>       > GEOGCRS["WGS 84",
>       >??? DATUM["World Geodetic System 1984",
>       >??????? ELLIPSOID["WGS 84",6378137,298.257223563,
>       >??????????? LENGTHUNIT["metre",1]]],
>       >??? PRIMEM["Greenwich",0,
>       >??????? ANGLEUNIT["degree",0.0174532925199433]],
>       >??? CS[ellipsoidal,2],
>       >??????? AXIS["latitude",north,
>       >??????????? ORDER[1],
>       >??????????? ANGLEUNIT["degree",0.0174532925199433]],
>       >??????? AXIS["longitude",east,
>       >??????????? ORDER[2],
>       >??????????? ANGLEUNIT["degree",0.0174532925199433]],
>       >??? ID["EPSG",4326]]
>       >
>       >> cat(wkt(rasbrick), "\n")
>       > GEOGCRS["unknown",
>       >??? DATUM["World Geodetic System 1984",
>       >??????? ELLIPSOID["WGS 84",6378137,298.257223563,
>       >??????????? LENGTHUNIT["metre",1]],
>       >??????? ID["EPSG",6326]],
>       >??? PRIMEM["Greenwich",0,
>       >??????? ANGLEUNIT["degree",0.0174532925199433],
>       >??????? ID["EPSG",8901]],
>       >??? CS[ellipsoidal,2],
>       >??????? AXIS["longitude",east,
>       >??????????? ORDER[1],
>       >??????????? ANGLEUNIT["degree",0.0174532925199433,
>       >??????????????? ID["EPSG",9122]]],
>       >??????? AXIS["latitude",north,
>       >??????????? ORDER[2],
>       >??????????? ANGLEUNIT["degree",0.0174532925199433,
>       >??????????????? ID["EPSG",9122]]]]
>       >
>       > The order of the axis (and other parameters) of my new shape
>       (shapeafter) is the same as the raster (rasbrick) after
>       transformation.
>       >
>       > 3 -? when I use:
>       >
>       > centroids = gCentroid(shapebefore, byid=TRUE)
>       >
>       > and
>       >
>       > centroids = gCentroid(shapeafter, byid=TRUE)
>       >
>       > why are the coordinates x and y values equal (and the values
>       are exactly the same)?
>       >
>       > (It seems to me that both are longitude=x and latitude=y)
>       but since the order is switched in cat(wkt(), shouldn't it be
>       latitude=x and longitude=y in the shapebefore?
>       >
>       > if I use proj4string()
>       > both my shapebefore and my shapeafter are like:
>       >
>       > "+proj=longlat +datum=WGS84 +no_defs"
>       >
>       >> sessionInfo()
>       > R version 3.6.2 (2019-12-12)
>       > Platform: x86_64-w64-mingw32/x64 (64-bit)
>       > Running under: Windows 10 x64 (build 19042)
>       >
>       > Matrix products: default
>       >
>       > locale:
>       > [1] LC_COLLATE=English_United States.1252?
>       LC_CTYPE=English_United States.1252
>       > [3] LC_MONETARY=English_United States.1252 LC_NUMERIC=C
>       > [5] LC_TIME=English_United States.1252
>       >
>       > attached base packages:
>       > [1] stats???? graphics? grDevices utils???? datasets?
>       methods?? base
>       >
>       > other attached packages:
>       > [1] spdep_1.1-5??? sf_0.9-5?????? spData_0.3.8??
>       maptools_1.0-1 xlsx_0.6.3???? rgeos_0.5-3??? raster_3.3-13
>       > [8] rgdal_1.5-10?? sp_1.4-2
>       >
>       > loaded via a namespace (and not attached):
>       > [1] Rcpp_1.0.5???????? compiler_3.6.2???? pillar_1.4.4??????
>       LearnBayes_2.15.1? class_7.3-15
>       > [6] tools_3.6.2??????? boot_1.3-23??????? nlme_3.1-142??????
>       lifecycle_0.2.0??? tibble_3.0.1
>       > [11] lattice_0.20-41??? pkgconfig_2.0.3???
>       rlang_0.4.7??????? Matrix_1.2-18????? DBI_1.1.0
>       > [16] rstudioapi_0.11??? expm_0.999-5??????
>       coda_0.19-3??????? rJava_0.9-12?????? e1071_1.7-3
>       > [21] dplyr_1.0.0??????? gtools_3.8.2??????
>       generics_0.0.2???? xlsxjars_0.6.1???? vctrs_0.3.1
>       > [26] classInt_0.4-3???? grid_3.6.2????????
>       tidyselect_1.1.0?? glue_1.4.1???????? spDataLarge_0.4.1
>       > [31] R6_2.4.1?????????? foreign_0.8-72????
>       gdata_2.18.0?????? deldir_0.1-28????? purrr_0.3.4
>       > [36] magrittr_1.5?????? gmodels_2.18.1????
>       splines_3.6.2????? MASS_7.3-51.4????? codetools_0.2-16
>       > [41] ellipsis_0.3.1???? units_0.6-7???????
>       KernSmooth_2.23-16 crayon_1.3.4
>       >
>       > Thanks.
>       >
>       > Pietro Andre Telatin Paschoalino
>       > Doutorando em Ci?ncias Econ?micas da Universidade Estadual
>       de Maring? - PCE.
>       >
>       > ________________________________
>       > De: Roger Bivand <Roger.Bivand at nhh.no>
>       > Enviado: ter?a-feira, 15 de junho de 2021 15:18
>       > Para: Pietro Andre Telatin Paschoalino
>       <Pietro_telato at hotmail.com>
>       > Assunto: Re: Doubt in function compare_CRS
>       >
>       > Please do not email me directly. For use questions, please
>       subscribe to
>       > R-sig-geo
>       >
>       > https://stat.ethz.ch/mailman/listinfo/R-SIG-Geo
>       >
>       > and post there. Your problem cannot be reproduced by me (I
>       do not know
>       > what your raster is) - when you post provide a minimal
>       self-contained
>       > example. Do also provide the output of sessionInfo(), as you
>       may not be
>       > using updated packages.
>       >
>       > Roger Bivand
>       >
>       >
>       > On Tue, 15 Jun 2021, Pietro Andre Telatin Paschoalino wrote:
>       >
>       >> Hello Bivand,
>       >>
>       >> How you create the function compare_CRS and it has already
>       exemplified
>       >> several issues for me. I would like to know if you can help
>       me with a
>       >> simple issue
>       >>
>       >> I tried to compare the CRS OGC with my raster (stack) and I
>       couldn't:
>       >>
>       >> rgdal::compare_CRS(CRS("OGC:CRS84"), slot(rasbrick, "crs"))
>       >> Error in CRS("OGC:CRS84") :
>       >> PROJ4 argument-value pairs must begin with +: OGC:CRS84
>       >>
>       >> I also tried it like this:
>       >>
>       >> rgdal::compare_CRS(CRS("+OGC:CRS84"), slot(rasbrick,
>       "crs"))
>       >> Error in showSRID(uprojargs, format = "PROJ", multiline =
>       "NO") :
>       >> Can't parse PROJ.4-style parameter string
>       >> +OGC:CRS84
>       >>
>       >> could you answer me where am I wrong?
>       >>
>       >> When I compare a shapefile with my raster (stack) the
>       function runs normally, for example:
>       >>
>       >> compare_CRS(slot(shape1, "proj4string"), slot(rasbrick,
>       "crs"))
>       >>????????????????????? strict?????????????????? equivalent
>       equivalent_except_axis_order
>       >>?????????????????????? FALSE????????????????????????
>       TRUE???????????????????????? TRUE
>       >>
>       >> Thank you.
>       >>
>       >> Pietro Andre Telatin Paschoalino
>       >> Doutorando em Ci?ncias Econ?micas da Universidade
>       Estadual de Maring? - PCE.
>       >>
>       >>[https://ipmcdn.avast.com/images/icons/icon-envelope-tick-round-orange-an
> imated-no-repeat-v1.gif]<https://www.avast.com/sig-email?utm_medium=emai
> l&utm_source=link&utm_campaign=sig-email&utm_content=webmail&utm_term=ic
>       on>??? Virus-free.www.avast.com<https://www.avast.com/sig-email?utm_medium=email&utm_source
>       =link&utm_campaign=sig-email&utm_content=webmail&utm_term=link>
>       >>
>       >
>       > --
>       > Roger Bivand
>       > Emeritus Professor
>       > Department of Economics, Norwegian School of Economics,
>       > Postboks 3490 Ytre Sandviken, 5045 Bergen, Norway.
>       > e-mail: Roger.Bivand at nhh.no
>       > https://orcid.org/0000-0003-2392-6140
>       > https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>       >
>       > [[alternative HTML version deleted]]
>       >
>       >
>
>       --
>       Roger Bivand
>       Emeritus Professor
>       Department of Economics, Norwegian School of Economics,
>       Postboks 3490 Ytre Sandviken, 5045 Bergen, Norway.
>       e-mail: Roger.Bivand at nhh.no
>       https://orcid.org/0000-0003-2392-6140
>       https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
> 
> 
> 
>

-- 
Roger Bivand
Emeritus Professor
Department of Economics, Norwegian School of Economics,
Postboks 3490 Ytre Sandviken, 5045 Bergen, Norway.
e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

From p|etro_te|@to @end|ng |rom hotm@||@com  Wed Jun 16 14:45:19 2021
From: p|etro_te|@to @end|ng |rom hotm@||@com (Pietro Andre Telatin Paschoalino)
Date: Wed, 16 Jun 2021 12:45:19 +0000
Subject: [R-sig-Geo] 3 Questions on CRS change
In-Reply-To: <77dba567-84fe-ac59-191a-a323eabd5c4@reclus2.nhh.no>
References: <BN8PR17MB298021CB6EC64184F19E827A820F9@BN8PR17MB2980.namprd17.prod.outlook.com>,
 <77dba567-84fe-ac59-191a-a323eabd5c4@reclus2.nhh.no>
Message-ID: <BN8PR17MB2980574F27B238CB8F9986D1820F9@BN8PR17MB2980.namprd17.prod.outlook.com>

Hello Roger,

After updating the packages issue 1 was solved.

2- I keep my doubt if the order axis between the shape and raster (or 2 shapes) in cat(wkt(), "\n",  before the spTransform is a problem. But I don't think so, I tested it with another shape without spTransform and the results were similar. I believe spTransform also changes the axis order correctly. But I don't know if it's a specific case or if it won't always be a problem to apply spTransform in these cases, would you know about this?

3- In this case, as I don't know what you say by unprojected in my case, you believe it's a problem to apply gCentroid in my example:

GEOGCRS["unknown",
    DATUM["World Geodetic System 1984",
        ELLIPSOID["WGS 84",6378137,298.257223563,
            LENGTHUNIT["metre",1]],
        ID["EPSG",6326]],
    PRIMEM["Greenwich",0,
        ANGLEUNIT["degree",0.0174532925199433],
        ID["EPSG",8901]],
    CS[ellipsoidal,2],
        AXIS["longitude",east,
            ORDER[1],
            ANGLEUNIT["degree",0.0174532925199433,
                ID["EPSG",9122]]],
        AXIS["latitude",north,
            ORDER[2],
            ANGLEUNIT["degree",0.0174532925199433,
                ID["EPSG",9122]]]]

Thank you.

Pietro Andre Telatin Paschoalino
Doutorando em Ci?ncias Econ?micas da Universidade Estadual de Maring? - PCE.

________________________________
De: Roger Bivand <Roger.Bivand at nhh.no>
Enviado: quarta-feira, 16 de junho de 2021 08:38
Para: Pietro Andre Telatin Paschoalino <pietro_telato at hotmail.com>
Cc: r-sig-geo at r-project.org <r-sig-geo at r-project.org>
Assunto: Re: [R-sig-Geo] 3 Questions on CRS change

On Wed, 16 Jun 2021, Pietro Andre Telatin Paschoalino wrote:

> Hello Roger,
> Thank you. I'll update the packages and try again.
>
> And about my doubts 2 and 3, you know If there is any problem?

Try them after updating as they may differ. 2 - nobody knows,
sp/rgdal/raster try to impose GIS/visualization order. 3 - try to avoid
using rgeos with unprojected geometries, it only provides accurate
centroids for planar geometries.

Roger

>
> Thanks again.
>
> Em 16 de jun de 2021 04:18, Roger Bivand <Roger.Bivand at nhh.no> escreveu:
>
>       On Tue, 15 Jun 2021, Pietro Andre Telatin Paschoalino wrote:
>
>       > 1-  I tried to compare the CRS OGC with my raster (stack)
>       and I couldn't:
>       >
>       > My raster data are CRU DATA TS 4.04 (EAST ANGLIA)
>
>       This is not a minimal reproducible example, perhaps
>
>       https://crudata.uea.ac.uk/cru/data/hrg/cru_ts_4.04/
>
>       is the source, but no specific (very small) file is indicated.
>       Using the
>       224MB cru_ts4.04.2011.2019.pre.dat.nc on an updated system
>       (rgdal, raster
>       and sp as CRAN, Linux, PROJ 8.0.1, GDAL 3.3.0) there is no
>       problem.
>
>       You have rgdal 1.5-10 (CRAN has 1.5-23), sp 1.4-2 (CRAN has
>       1.4-5) and
>       raster 3.3-13 (CRAN has 3.4-10), which I will not re-install
>       because they
>       are not the problem, and the current versions are available
>       for R 3.6 on
>       Windows. All the debugging needed is in the output of
>       sessionInfo().
>
>       Please report back after updating at least sp, rgdal and
>       raster (your
>       raster version is also pretty outdated).
>
>       Roger Bivand
>
>       >
>       > rgdal::compare_CRS(CRS("OGC:CRS84"), slot(rasbrick, "crs"))
>       > Error in CRS("OGC:CRS84") :
>       > PROJ4 argument-value pairs must begin with +: OGC:CRS84
>       >
>       > I also tried it like this:
>       >
>       > rgdal::compare_CRS(CRS("+OGC:CRS84"), slot(rasbrick, "crs"))
>       > Error in showSRID(uprojargs, format = "PROJ", multiline =
>       "NO") :
>       > Can't parse PROJ.4-style parameter string
>       > +OGC:CRS84
>       >
>       > could you answer me where am I wrong?
>       >
>       > When I compare a shapefile with my raster (stack) the
>       function runs normally.
>       >
>       > 2- using:
>       >
>       > cat(wkt(shapebefore), "\n")
>       >
>       > cat(wkt(rasbrick), "\n")
>       >
>       > I saw that the order of the axis were different, but after
>       the transformation they were the same.
>       >
>       > Any problem making shapeafter<- spTransform(shapebefore,
>       crs(rasbrick))
>       >
>       > when are the axis different before the transformation?
>       >
>       > Ex:
>       >
>       > cat(wkt(shapebefore), "\n")
>       > GEOGCRS["WGS 84",
>       >    DATUM["World Geodetic System 1984",
>       >        ELLIPSOID["WGS 84",6378137,298.257223563,
>       >            LENGTHUNIT["metre",1]]],
>       >    PRIMEM["Greenwich",0,
>       >        ANGLEUNIT["degree",0.0174532925199433]],
>       >    CS[ellipsoidal,2],
>       >        AXIS["latitude",north,
>       >            ORDER[1],
>       >            ANGLEUNIT["degree",0.0174532925199433]],
>       >        AXIS["longitude",east,
>       >            ORDER[2],
>       >            ANGLEUNIT["degree",0.0174532925199433]],
>       >    ID["EPSG",4326]]
>       >
>       >> cat(wkt(rasbrick), "\n")
>       > GEOGCRS["unknown",
>       >    DATUM["World Geodetic System 1984",
>       >        ELLIPSOID["WGS 84",6378137,298.257223563,
>       >            LENGTHUNIT["metre",1]],
>       >        ID["EPSG",6326]],
>       >    PRIMEM["Greenwich",0,
>       >        ANGLEUNIT["degree",0.0174532925199433],
>       >        ID["EPSG",8901]],
>       >    CS[ellipsoidal,2],
>       >        AXIS["longitude",east,
>       >            ORDER[1],
>       >            ANGLEUNIT["degree",0.0174532925199433,
>       >                ID["EPSG",9122]]],
>       >        AXIS["latitude",north,
>       >            ORDER[2],
>       >            ANGLEUNIT["degree",0.0174532925199433,
>       >                ID["EPSG",9122]]]]
>       >
>       > The order of the axis (and other parameters) of my new shape
>       (shapeafter) is the same as the raster (rasbrick) after
>       transformation.
>       >
>       > 3 -  when I use:
>       >
>       > centroids = gCentroid(shapebefore, byid=TRUE)
>       >
>       > and
>       >
>       > centroids = gCentroid(shapeafter, byid=TRUE)
>       >
>       > why are the coordinates x and y values equal (and the values
>       are exactly the same)?
>       >
>       > (It seems to me that both are longitude=x and latitude=y)
>       but since the order is switched in cat(wkt(), shouldn't it be
>       latitude=x and longitude=y in the shapebefore?
>       >
>       > if I use proj4string()
>       > both my shapebefore and my shapeafter are like:
>       >
>       > "+proj=longlat +datum=WGS84 +no_defs"
>       >
>       >> sessionInfo()
>       > R version 3.6.2 (2019-12-12)
>       > Platform: x86_64-w64-mingw32/x64 (64-bit)
>       > Running under: Windows 10 x64 (build 19042)
>       >
>       > Matrix products: default
>       >
>       > locale:
>       > [1] LC_COLLATE=English_United States.1252
>       LC_CTYPE=English_United States.1252
>       > [3] LC_MONETARY=English_United States.1252 LC_NUMERIC=C
>       > [5] LC_TIME=English_United States.1252
>       >
>       > attached base packages:
>       > [1] stats     graphics  grDevices utils     datasets
>       methods   base
>       >
>       > other attached packages:
>       > [1] spdep_1.1-5    sf_0.9-5       spData_0.3.8
>       maptools_1.0-1 xlsx_0.6.3     rgeos_0.5-3    raster_3.3-13
>       > [8] rgdal_1.5-10   sp_1.4-2
>       >
>       > loaded via a namespace (and not attached):
>       > [1] Rcpp_1.0.5         compiler_3.6.2     pillar_1.4.4
>       LearnBayes_2.15.1  class_7.3-15
>       > [6] tools_3.6.2        boot_1.3-23        nlme_3.1-142
>       lifecycle_0.2.0    tibble_3.0.1
>       > [11] lattice_0.20-41    pkgconfig_2.0.3
>       rlang_0.4.7        Matrix_1.2-18      DBI_1.1.0
>       > [16] rstudioapi_0.11    expm_0.999-5
>       coda_0.19-3        rJava_0.9-12       e1071_1.7-3
>       > [21] dplyr_1.0.0        gtools_3.8.2
>       generics_0.0.2     xlsxjars_0.6.1     vctrs_0.3.1
>       > [26] classInt_0.4-3     grid_3.6.2
>       tidyselect_1.1.0   glue_1.4.1         spDataLarge_0.4.1
>       > [31] R6_2.4.1           foreign_0.8-72
>       gdata_2.18.0       deldir_0.1-28      purrr_0.3.4
>       > [36] magrittr_1.5       gmodels_2.18.1
>       splines_3.6.2      MASS_7.3-51.4      codetools_0.2-16
>       > [41] ellipsis_0.3.1     units_0.6-7
>       KernSmooth_2.23-16 crayon_1.3.4
>       >
>       > Thanks.
>       >
>       > Pietro Andre Telatin Paschoalino
>       > Doutorando em Ci?ncias Econ?micas da Universidade Estadual
>       de Maring? - PCE.
>       >
>       > ________________________________
>       > De: Roger Bivand <Roger.Bivand at nhh.no>
>       > Enviado: ter?a-feira, 15 de junho de 2021 15:18
>       > Para: Pietro Andre Telatin Paschoalino
>       <Pietro_telato at hotmail.com>
>       > Assunto: Re: Doubt in function compare_CRS
>       >
>       > Please do not email me directly. For use questions, please
>       subscribe to
>       > R-sig-geo
>       >
>       > https://stat.ethz.ch/mailman/listinfo/R-SIG-Geo
>       >
>       > and post there. Your problem cannot be reproduced by me (I
>       do not know
>       > what your raster is) - when you post provide a minimal
>       self-contained
>       > example. Do also provide the output of sessionInfo(), as you
>       may not be
>       > using updated packages.
>       >
>       > Roger Bivand
>       >
>       >
>       > On Tue, 15 Jun 2021, Pietro Andre Telatin Paschoalino wrote:
>       >
>       >> Hello Bivand,
>       >>
>       >> How you create the function compare_CRS and it has already
>       exemplified
>       >> several issues for me. I would like to know if you can help
>       me with a
>       >> simple issue
>       >>
>       >> I tried to compare the CRS OGC with my raster (stack) and I
>       couldn't:
>       >>
>       >> rgdal::compare_CRS(CRS("OGC:CRS84"), slot(rasbrick, "crs"))
>       >> Error in CRS("OGC:CRS84") :
>       >> PROJ4 argument-value pairs must begin with +: OGC:CRS84
>       >>
>       >> I also tried it like this:
>       >>
>       >> rgdal::compare_CRS(CRS("+OGC:CRS84"), slot(rasbrick,
>       "crs"))
>       >> Error in showSRID(uprojargs, format = "PROJ", multiline =
>       "NO") :
>       >> Can't parse PROJ.4-style parameter string
>       >> +OGC:CRS84
>       >>
>       >> could you answer me where am I wrong?
>       >>
>       >> When I compare a shapefile with my raster (stack) the
>       function runs normally, for example:
>       >>
>       >> compare_CRS(slot(shape1, "proj4string"), slot(rasbrick,
>       "crs"))
>       >>                      strict                   equivalent
>       equivalent_except_axis_order
>       >>                       FALSE
>       TRUE                         TRUE
>       >>
>       >> Thank you.
>       >>
>       >> Pietro Andre Telatin Paschoalino
>       >> Doutorando em Ci?ncias Econ?micas da Universidade
>       Estadual de Maring? - PCE.
>       >>
>       >>[https://ipmcdn.avast.com/images/icons/icon-envelope-tick-round-orange-an
> imated-no-repeat-v1.gif]<https://www.avast.com/sig-email?utm_medium=emai
> l&utm_source=link&utm_campaign=sig-email&utm_content=webmail&utm_term=ic
>       on>    Virus-free.www.avast.com<https://www.avast.com/sig-email?utm_medium=email&utm_source
>       =link&utm_campaign=sig-email&utm_content=webmail&utm_term=link>
>       >>
>       >
>       > --
>       > Roger Bivand
>       > Emeritus Professor
>       > Department of Economics, Norwegian School of Economics,
>       > Postboks 3490 Ytre Sandviken, 5045 Bergen, Norway.
>       > e-mail: Roger.Bivand at nhh.no
>       > https://orcid.org/0000-0003-2392-6140
>       > https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>       >
>       > [[alternative HTML version deleted]]
>       >
>       >
>
>       --
>       Roger Bivand
>       Emeritus Professor
>       Department of Economics, Norwegian School of Economics,
>       Postboks 3490 Ytre Sandviken, 5045 Bergen, Norway.
>       e-mail: Roger.Bivand at nhh.no
>       https://orcid.org/0000-0003-2392-6140
>       https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>
>
>
>

--
Roger Bivand
Emeritus Professor
Department of Economics, Norwegian School of Economics,
Postboks 3490 Ytre Sandviken, 5045 Bergen, Norway.
e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

	[[alternative HTML version deleted]]


From Roger@B|v@nd @end|ng |rom nhh@no  Wed Jun 16 17:01:07 2021
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Wed, 16 Jun 2021 17:01:07 +0200
Subject: [R-sig-Geo] 3 Questions on CRS change
In-Reply-To: <BN8PR17MB2980574F27B238CB8F9986D1820F9@BN8PR17MB2980.namprd17.prod.outlook.com>
References: <BN8PR17MB298021CB6EC64184F19E827A820F9@BN8PR17MB2980.namprd17.prod.outlook.com>,
 <77dba567-84fe-ac59-191a-a323eabd5c4@reclus2.nhh.no>
 <BN8PR17MB2980574F27B238CB8F9986D1820F9@BN8PR17MB2980.namprd17.prod.outlook.com>
Message-ID: <e9b550c6-6dc-2151-e989-2b8f2fc8f3db@reclus2.nhh.no>

On Wed, 16 Jun 2021, Pietro Andre Telatin Paschoalino wrote:

> Hello Roger,
>
> After updating the packages issue 1 was solved.
>

Many data sets in the wild declare EPSG:4326 but use eastings:northings 
contrary to the authority. sp/rgdal/raster use eastings/northings and 
rgdal changes the recorded order in the crs/CRS object (used by 
sp/raster). OGC:CRS84 is eastings/northings by definition. Caution is 
advised. Further, from PROJ 8 and EPSG version >= 10, WGS84 is a datum 
ensemble:

> sp::CRS("OGC:CRS84")
Coordinate Reference System:
Deprecated Proj.4 representation: +proj=longlat +datum=WGS84 +no_defs
WKT2 2019 representation:
GEOGCRS["WGS 84 (CRS84)",
     ENSEMBLE["World Geodetic System 1984 ensemble",
         MEMBER["World Geodetic System 1984 (Transit)"],
         MEMBER["World Geodetic System 1984 (G730)"],
         MEMBER["World Geodetic System 1984 (G873)"],
         MEMBER["World Geodetic System 1984 (G1150)"],
         MEMBER["World Geodetic System 1984 (G1674)"],
         MEMBER["World Geodetic System 1984 (G1762)"],
         ELLIPSOID["WGS 84",6378137,298.257223563,
             LENGTHUNIT["metre",1]],
         ENSEMBLEACCURACY[2.0]],
     PRIMEM["Greenwich",0,
         ANGLEUNIT["degree",0.0174532925199433]],
     CS[ellipsoidal,2],
         AXIS["geodetic longitude (Lon)",east,
             ORDER[1],
             ANGLEUNIT["degree",0.0174532925199433]],
         AXIS["geodetic latitude (Lat)",north,
             ORDER[2],
             ANGLEUNIT["degree",0.0174532925199433]],
     USAGE[
         SCOPE["Not known."],
         AREA["World."],
         BBOX[-90,-180,90,180]],
     ID["OGC","CRS84"]]
> rgdal::rgdal_extSoftVersion()
           GDAL GDAL_with_GEOS           PROJ             sp           EPSG
        "3.3.0"         "TRUE"        "8.0.1"        "1.4-6"      "v10.018"

where it is expected that current use will assume (G1762) rather than 
earlier versions. This impacts especially parts of the world with 
fast-moving tectonic plates. We don't yet know how it will play out, nor 
how to choose non-default members of the ensemble.

> 2- I keep my doubt if the order axis between the shape and raster (or 2
>    shapes) in cat(wkt(), "\n", before the spTransform is a problem. But
>    I don't think so, I tested it with another shape without spTransform
>    and the results were similar. I believe spTransform also changes the
>    axis order correctly. But I don't know if it's a specific case or if
>    it won't always be a problem to apply spTransform in these cases,
>    would you know about this?
>
> 3- In this case, as I don't know what you say by unprojected in my case,
>    you believe it's a problem to apply gCentroid in my example:

Unprojected is GEOGCRS, projected is PROJCRS (plus some other variants). 
For GEOS to work, you need planar, projected coordinates where Euclidean 
distances work, rather than distances on the surface of a sphere. The s2 
package provides s2::s2_centroid() on the surface of a sphere.

Roger

>
> GEOGCRS["unknown",
>    DATUM["World Geodetic System 1984",
>        ELLIPSOID["WGS 84",6378137,298.257223563,
>            LENGTHUNIT["metre",1]],
>        ID["EPSG",6326]],
>    PRIMEM["Greenwich",0,
>        ANGLEUNIT["degree",0.0174532925199433],
>        ID["EPSG",8901]],
>    CS[ellipsoidal,2],
>        AXIS["longitude",east,
>            ORDER[1],
>            ANGLEUNIT["degree",0.0174532925199433,
>                ID["EPSG",9122]]],
>        AXIS["latitude",north,
>            ORDER[2],
>            ANGLEUNIT["degree",0.0174532925199433,
>                ID["EPSG",9122]]]]
>
> Thank you.
>
> Pietro Andre Telatin Paschoalino
> Doutorando em Ci?ncias Econ?micas da Universidade Estadual de Maring? - PCE.
>
> ________________________________
> De: Roger Bivand <Roger.Bivand at nhh.no>
> Enviado: quarta-feira, 16 de junho de 2021 08:38
> Para: Pietro Andre Telatin Paschoalino <pietro_telato at hotmail.com>
> Cc: r-sig-geo at r-project.org <r-sig-geo at r-project.org>
> Assunto: Re: [R-sig-Geo] 3 Questions on CRS change
>
> On Wed, 16 Jun 2021, Pietro Andre Telatin Paschoalino wrote:
>
>> Hello Roger,
>> Thank you. I'll update the packages and try again.
>>
>> And about my doubts 2 and 3, you know If there is any problem?
>
> Try them after updating as they may differ. 2 - nobody knows,
> sp/rgdal/raster try to impose GIS/visualization order. 3 - try to avoid
> using rgeos with unprojected geometries, it only provides accurate
> centroids for planar geometries.
>
> Roger
>
>>
>> Thanks again.
>>
>> Em 16 de jun de 2021 04:18, Roger Bivand <Roger.Bivand at nhh.no> escreveu:
>>
>>       On Tue, 15 Jun 2021, Pietro Andre Telatin Paschoalino wrote:
>>
>>      > 1-  I tried to compare the CRS OGC with my raster (stack)
>>       and I couldn't:
>>      >
>>      > My raster data are CRU DATA TS 4.04 (EAST ANGLIA)
>>
>>       This is not a minimal reproducible example, perhaps
>>
>>       https://crudata.uea.ac.uk/cru/data/hrg/cru_ts_4.04/
>>
>>       is the source, but no specific (very small) file is indicated.
>>       Using the
>>       224MB cru_ts4.04.2011.2019.pre.dat.nc on an updated system
>>       (rgdal, raster
>>       and sp as CRAN, Linux, PROJ 8.0.1, GDAL 3.3.0) there is no
>>       problem.
>>
>>       You have rgdal 1.5-10 (CRAN has 1.5-23), sp 1.4-2 (CRAN has
>>       1.4-5) and
>>       raster 3.3-13 (CRAN has 3.4-10), which I will not re-install
>>       because they
>>       are not the problem, and the current versions are available
>>       for R 3.6 on
>>       Windows. All the debugging needed is in the output of
>>       sessionInfo().
>>
>>       Please report back after updating at least sp, rgdal and
>>       raster (your
>>       raster version is also pretty outdated).
>>
>>       Roger Bivand
>>
>>      >
>>      > rgdal::compare_CRS(CRS("OGC:CRS84"), slot(rasbrick, "crs"))
>>      > Error in CRS("OGC:CRS84") :
>>      > PROJ4 argument-value pairs must begin with +: OGC:CRS84
>>      >
>>      > I also tried it like this:
>>      >
>>      > rgdal::compare_CRS(CRS("+OGC:CRS84"), slot(rasbrick, "crs"))
>>      > Error in showSRID(uprojargs, format = "PROJ", multiline =
>>       "NO") :
>>      > Can't parse PROJ.4-style parameter string
>>      > +OGC:CRS84
>>      >
>>      > could you answer me where am I wrong?
>>      >
>>      > When I compare a shapefile with my raster (stack) the
>>       function runs normally.
>>      >
>>      > 2- using:
>>      >
>>      > cat(wkt(shapebefore), "\n")
>>      >
>>      > cat(wkt(rasbrick), "\n")
>>      >
>>      > I saw that the order of the axis were different, but after
>>       the transformation they were the same.
>>      >
>>      > Any problem making shapeafter<- spTransform(shapebefore,
>>       crs(rasbrick))
>>      >
>>      > when are the axis different before the transformation?
>>      >
>>      > Ex:
>>      >
>>      > cat(wkt(shapebefore), "\n")
>>      > GEOGCRS["WGS 84",
>>      >    DATUM["World Geodetic System 1984",
>>      >        ELLIPSOID["WGS 84",6378137,298.257223563,
>>      >            LENGTHUNIT["metre",1]]],
>>      >    PRIMEM["Greenwich",0,
>>      >        ANGLEUNIT["degree",0.0174532925199433]],
>>      >    CS[ellipsoidal,2],
>>      >        AXIS["latitude",north,
>>      >            ORDER[1],
>>      >            ANGLEUNIT["degree",0.0174532925199433]],
>>      >        AXIS["longitude",east,
>>      >            ORDER[2],
>>      >            ANGLEUNIT["degree",0.0174532925199433]],
>>      >    ID["EPSG",4326]]
>>      >
>>      >> cat(wkt(rasbrick), "\n")
>>      > GEOGCRS["unknown",
>>      >    DATUM["World Geodetic System 1984",
>>      >        ELLIPSOID["WGS 84",6378137,298.257223563,
>>      >            LENGTHUNIT["metre",1]],
>>      >        ID["EPSG",6326]],
>>      >    PRIMEM["Greenwich",0,
>>      >        ANGLEUNIT["degree",0.0174532925199433],
>>      >        ID["EPSG",8901]],
>>      >    CS[ellipsoidal,2],
>>      >        AXIS["longitude",east,
>>      >            ORDER[1],
>>      >            ANGLEUNIT["degree",0.0174532925199433,
>>      >                ID["EPSG",9122]]],
>>      >        AXIS["latitude",north,
>>      >            ORDER[2],
>>      >            ANGLEUNIT["degree",0.0174532925199433,
>>      >                ID["EPSG",9122]]]]
>>      >
>>      > The order of the axis (and other parameters) of my new shape
>>       (shapeafter) is the same as the raster (rasbrick) after
>>       transformation.
>>      >
>>      > 3 -  when I use:
>>      >
>>      > centroids = gCentroid(shapebefore, byid=TRUE)
>>      >
>>      > and
>>      >
>>      > centroids = gCentroid(shapeafter, byid=TRUE)
>>      >
>>      > why are the coordinates x and y values equal (and the values
>>       are exactly the same)?
>>      >
>>      > (It seems to me that both are longitude=x and latitude=y)
>>       but since the order is switched in cat(wkt(), shouldn't it be
>>       latitude=x and longitude=y in the shapebefore?
>>      >
>>      > if I use proj4string()
>>      > both my shapebefore and my shapeafter are like:
>>      >
>>      > "+proj=longlat +datum=WGS84 +no_defs"
>>      >
>>      >> sessionInfo()
>>      > R version 3.6.2 (2019-12-12)
>>      > Platform: x86_64-w64-mingw32/x64 (64-bit)
>>      > Running under: Windows 10 x64 (build 19042)
>>      >
>>      > Matrix products: default
>>      >
>>      > locale:
>>      > [1] LC_COLLATE=English_United States.1252
>>       LC_CTYPE=English_United States.1252
>>      > [3] LC_MONETARY=English_United States.1252 LC_NUMERIC=C
>>      > [5] LC_TIME=English_United States.1252
>>      >
>>      > attached base packages:
>>      > [1] stats     graphics  grDevices utils     datasets
>>       methods   base
>>      >
>>      > other attached packages:
>>      > [1] spdep_1.1-5    sf_0.9-5       spData_0.3.8
>>       maptools_1.0-1 xlsx_0.6.3     rgeos_0.5-3    raster_3.3-13
>>      > [8] rgdal_1.5-10   sp_1.4-2
>>      >
>>      > loaded via a namespace (and not attached):
>>      > [1] Rcpp_1.0.5         compiler_3.6.2     pillar_1.4.4
>>       LearnBayes_2.15.1  class_7.3-15
>>      > [6] tools_3.6.2        boot_1.3-23        nlme_3.1-142
>>       lifecycle_0.2.0    tibble_3.0.1
>>      > [11] lattice_0.20-41    pkgconfig_2.0.3
>>       rlang_0.4.7        Matrix_1.2-18      DBI_1.1.0
>>      > [16] rstudioapi_0.11    expm_0.999-5
>>       coda_0.19-3        rJava_0.9-12       e1071_1.7-3
>>      > [21] dplyr_1.0.0        gtools_3.8.2
>>       generics_0.0.2     xlsxjars_0.6.1     vctrs_0.3.1
>>      > [26] classInt_0.4-3     grid_3.6.2
>>       tidyselect_1.1.0   glue_1.4.1         spDataLarge_0.4.1
>>      > [31] R6_2.4.1           foreign_0.8-72
>>       gdata_2.18.0       deldir_0.1-28      purrr_0.3.4
>>      > [36] magrittr_1.5       gmodels_2.18.1
>>       splines_3.6.2      MASS_7.3-51.4      codetools_0.2-16
>>      > [41] ellipsis_0.3.1     units_0.6-7
>>       KernSmooth_2.23-16 crayon_1.3.4
>>      >
>>      > Thanks.
>>      >
>>      > Pietro Andre Telatin Paschoalino
>>      > Doutorando em Ci?ncias Econ?micas da Universidade Estadual
>>       de Maring? - PCE.
>>      >
>>      > ________________________________
>>      > De: Roger Bivand <Roger.Bivand at nhh.no>
>>      > Enviado: ter?a-feira, 15 de junho de 2021 15:18
>>      > Para: Pietro Andre Telatin Paschoalino
>>       <Pietro_telato at hotmail.com>
>>      > Assunto: Re: Doubt in function compare_CRS
>>      >
>>      > Please do not email me directly. For use questions, please
>>       subscribe to
>>      > R-sig-geo
>>      >
>>      > https://stat.ethz.ch/mailman/listinfo/R-SIG-Geo
>>      >
>>      > and post there. Your problem cannot be reproduced by me (I
>>       do not know
>>      > what your raster is) - when you post provide a minimal
>>       self-contained
>>      > example. Do also provide the output of sessionInfo(), as you
>>       may not be
>>      > using updated packages.
>>      >
>>      > Roger Bivand
>>      >
>>      >
>>      > On Tue, 15 Jun 2021, Pietro Andre Telatin Paschoalino wrote:
>>      >
>>      >> Hello Bivand,
>>      >>
>>      >> How you create the function compare_CRS and it has already
>>       exemplified
>>      >> several issues for me. I would like to know if you can help
>>       me with a
>>      >> simple issue
>>      >>
>>      >> I tried to compare the CRS OGC with my raster (stack) and I
>>       couldn't:
>>      >>
>>      >> rgdal::compare_CRS(CRS("OGC:CRS84"), slot(rasbrick, "crs"))
>>      >> Error in CRS("OGC:CRS84") :
>>      >> PROJ4 argument-value pairs must begin with +: OGC:CRS84
>>      >>
>>      >> I also tried it like this:
>>      >>
>>      >> rgdal::compare_CRS(CRS("+OGC:CRS84"), slot(rasbrick,
>>       "crs"))
>>      >> Error in showSRID(uprojargs, format = "PROJ", multiline =
>>       "NO") :
>>      >> Can't parse PROJ.4-style parameter string
>>      >> +OGC:CRS84
>>      >>
>>      >> could you answer me where am I wrong?
>>      >>
>>      >> When I compare a shapefile with my raster (stack) the
>>       function runs normally, for example:
>>      >>
>>      >> compare_CRS(slot(shape1, "proj4string"), slot(rasbrick,
>>       "crs"))
>>      >>                      strict                   equivalent
>>       equivalent_except_axis_order
>>      >>                       FALSE
>>       TRUE                         TRUE
>>      >>
>>      >> Thank you.
>>      >>
>>      >> Pietro Andre Telatin Paschoalino
>>      >> Doutorando em Ci?ncias Econ?micas da Universidade
>>       Estadual de Maring? - PCE.
>>      >>
>>      >>[https://ipmcdn.avast.com/images/icons/icon-envelope-tick-round-orange-an
>> imated-no-repeat-v1.gif]<https://www.avast.com/sig-email?utm_medium=emai
>> l&utm_source=link&utm_campaign=sig-email&utm_content=webmail&utm_term=ic
>>       on>    Virus-free.www.avast.com<https://www.avast.com/sig-email?utm_medium=email&utm_source
>>       =link&utm_campaign=sig-email&utm_content=webmail&utm_term=link>
>>      >>
>>      >
>>      > --
>>      > Roger Bivand
>>      > Emeritus Professor
>>      > Department of Economics, Norwegian School of Economics,
>>      > Postboks 3490 Ytre Sandviken, 5045 Bergen, Norway.
>>      > e-mail: Roger.Bivand at nhh.no
>>      > https://orcid.org/0000-0003-2392-6140
>>      > https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>>      >
>>      > [[alternative HTML version deleted]]
>>      >
>>      >
>>
>>       --
>>       Roger Bivand
>>       Emeritus Professor
>>       Department of Economics, Norwegian School of Economics,
>>       Postboks 3490 Ytre Sandviken, 5045 Bergen, Norway.
>>       e-mail: Roger.Bivand at nhh.no
>>       https://orcid.org/0000-0003-2392-6140
>>       https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>>
>>
>>
>>
>
> --
> Roger Bivand
> Emeritus Professor
> Department of Economics, Norwegian School of Economics,
> Postboks 3490 Ytre Sandviken, 5045 Bergen, Norway.
> e-mail: Roger.Bivand at nhh.no
> https://orcid.org/0000-0003-2392-6140
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>

-- 
Roger Bivand
Emeritus Professor
Department of Economics, Norwegian School of Economics,
Postboks 3490 Ytre Sandviken, 5045 Bergen, Norway.
e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

From p|etro_te|@to @end|ng |rom hotm@||@com  Wed Jun 16 17:38:02 2021
From: p|etro_te|@to @end|ng |rom hotm@||@com (Pietro Andre Telatin Paschoalino)
Date: Wed, 16 Jun 2021 15:38:02 +0000
Subject: [R-sig-Geo] 3 Questions on CRS change
In-Reply-To: <e9b550c6-6dc-2151-e989-2b8f2fc8f3db@reclus2.nhh.no>
References: <BN8PR17MB298021CB6EC64184F19E827A820F9@BN8PR17MB2980.namprd17.prod.outlook.com>,
 <77dba567-84fe-ac59-191a-a323eabd5c4@reclus2.nhh.no>
 <BN8PR17MB2980574F27B238CB8F9986D1820F9@BN8PR17MB2980.namprd17.prod.outlook.com>,
 <e9b550c6-6dc-2151-e989-2b8f2fc8f3db@reclus2.nhh.no>
Message-ID: <BN8PR17MB2980345C811E541D310A6795820F9@BN8PR17MB2980.namprd17.prod.outlook.com>

Thank you Roger. I think that the difference between the two will not be huge but I'll test with this s2 package.

Only a doubt, how to transform a shapefile opened by readOGR or st_read to a as_s2_geography (I can't extract the centroids in those formats in s2 package),
and when I try to transform I got a message:

Error in UseMethod("as_s2_geography") :
 no applicable method for 'as_s2_geography' applied to an object of class "c('sf', 'data.frame')"

Thanks again.

Pietro Andre Telatin Paschoalino
Doutorando em Ci?ncias Econ?micas da Universidade Estadual de Maring? - PCE.

________________________________
De: Roger Bivand <Roger.Bivand at nhh.no>
Enviado: quarta-feira, 16 de junho de 2021 12:01
Para: Pietro Andre Telatin Paschoalino <pietro_telato at hotmail.com>
Cc: r-sig-geo at r-project.org <r-sig-geo at r-project.org>
Assunto: RE: [R-sig-Geo] 3 Questions on CRS change

On Wed, 16 Jun 2021, Pietro Andre Telatin Paschoalino wrote:

> Hello Roger,
>
> After updating the packages issue 1 was solved.
>

Many data sets in the wild declare EPSG:4326 but use eastings:northings
contrary to the authority. sp/rgdal/raster use eastings/northings and
rgdal changes the recorded order in the crs/CRS object (used by
sp/raster). OGC:CRS84 is eastings/northings by definition. Caution is
advised. Further, from PROJ 8 and EPSG version >= 10, WGS84 is a datum
ensemble:

> sp::CRS("OGC:CRS84")
Coordinate Reference System:
Deprecated Proj.4 representation: +proj=longlat +datum=WGS84 +no_defs
WKT2 2019 representation:
GEOGCRS["WGS 84 (CRS84)",
     ENSEMBLE["World Geodetic System 1984 ensemble",
         MEMBER["World Geodetic System 1984 (Transit)"],
         MEMBER["World Geodetic System 1984 (G730)"],
         MEMBER["World Geodetic System 1984 (G873)"],
         MEMBER["World Geodetic System 1984 (G1150)"],
         MEMBER["World Geodetic System 1984 (G1674)"],
         MEMBER["World Geodetic System 1984 (G1762)"],
         ELLIPSOID["WGS 84",6378137,298.257223563,
             LENGTHUNIT["metre",1]],
         ENSEMBLEACCURACY[2.0]],
     PRIMEM["Greenwich",0,
         ANGLEUNIT["degree",0.0174532925199433]],
     CS[ellipsoidal,2],
         AXIS["geodetic longitude (Lon)",east,
             ORDER[1],
             ANGLEUNIT["degree",0.0174532925199433]],
         AXIS["geodetic latitude (Lat)",north,
             ORDER[2],
             ANGLEUNIT["degree",0.0174532925199433]],
     USAGE[
         SCOPE["Not known."],
         AREA["World."],
         BBOX[-90,-180,90,180]],
     ID["OGC","CRS84"]]
> rgdal::rgdal_extSoftVersion()
           GDAL GDAL_with_GEOS           PROJ             sp           EPSG
        "3.3.0"         "TRUE"        "8.0.1"        "1.4-6"      "v10.018"

where it is expected that current use will assume (G1762) rather than
earlier versions. This impacts especially parts of the world with
fast-moving tectonic plates. We don't yet know how it will play out, nor
how to choose non-default members of the ensemble.

> 2- I keep my doubt if the order axis between the shape and raster (or 2
>    shapes) in cat(wkt(), "\n", before the spTransform is a problem. But
>    I don't think so, I tested it with another shape without spTransform
>    and the results were similar. I believe spTransform also changes the
>    axis order correctly. But I don't know if it's a specific case or if
>    it won't always be a problem to apply spTransform in these cases,
>    would you know about this?
>
> 3- In this case, as I don't know what you say by unprojected in my case,
>    you believe it's a problem to apply gCentroid in my example:

Unprojected is GEOGCRS, projected is PROJCRS (plus some other variants).
For GEOS to work, you need planar, projected coordinates where Euclidean
distances work, rather than distances on the surface of a sphere. The s2
package provides s2::s2_centroid() on the surface of a sphere.

Roger

>
> GEOGCRS["unknown",
>    DATUM["World Geodetic System 1984",
>        ELLIPSOID["WGS 84",6378137,298.257223563,
>            LENGTHUNIT["metre",1]],
>        ID["EPSG",6326]],
>    PRIMEM["Greenwich",0,
>        ANGLEUNIT["degree",0.0174532925199433],
>        ID["EPSG",8901]],
>    CS[ellipsoidal,2],
>        AXIS["longitude",east,
>            ORDER[1],
>            ANGLEUNIT["degree",0.0174532925199433,
>                ID["EPSG",9122]]],
>        AXIS["latitude",north,
>            ORDER[2],
>            ANGLEUNIT["degree",0.0174532925199433,
>                ID["EPSG",9122]]]]
>
> Thank you.
>
> Pietro Andre Telatin Paschoalino
> Doutorando em Ci?ncias Econ?micas da Universidade Estadual de Maring? - PCE.
>
> ________________________________
> De: Roger Bivand <Roger.Bivand at nhh.no>
> Enviado: quarta-feira, 16 de junho de 2021 08:38
> Para: Pietro Andre Telatin Paschoalino <pietro_telato at hotmail.com>
> Cc: r-sig-geo at r-project.org <r-sig-geo at r-project.org>
> Assunto: Re: [R-sig-Geo] 3 Questions on CRS change
>
> On Wed, 16 Jun 2021, Pietro Andre Telatin Paschoalino wrote:
>
>> Hello Roger,
>> Thank you. I'll update the packages and try again.
>>
>> And about my doubts 2 and 3, you know If there is any problem?
>
> Try them after updating as they may differ. 2 - nobody knows,
> sp/rgdal/raster try to impose GIS/visualization order. 3 - try to avoid
> using rgeos with unprojected geometries, it only provides accurate
> centroids for planar geometries.
>
> Roger
>
>>
>> Thanks again.
>>
>> Em 16 de jun de 2021 04:18, Roger Bivand <Roger.Bivand at nhh.no> escreveu:
>>
>>       On Tue, 15 Jun 2021, Pietro Andre Telatin Paschoalino wrote:
>>
>>      > 1-  I tried to compare the CRS OGC with my raster (stack)
>>       and I couldn't:
>>      >
>>      > My raster data are CRU DATA TS 4.04 (EAST ANGLIA)
>>
>>       This is not a minimal reproducible example, perhaps
>>
>>       https://crudata.uea.ac.uk/cru/data/hrg/cru_ts_4.04/
>>
>>       is the source, but no specific (very small) file is indicated.
>>       Using the
>>       224MB cru_ts4.04.2011.2019.pre.dat.nc on an updated system
>>       (rgdal, raster
>>       and sp as CRAN, Linux, PROJ 8.0.1, GDAL 3.3.0) there is no
>>       problem.
>>
>>       You have rgdal 1.5-10 (CRAN has 1.5-23), sp 1.4-2 (CRAN has
>>       1.4-5) and
>>       raster 3.3-13 (CRAN has 3.4-10), which I will not re-install
>>       because they
>>       are not the problem, and the current versions are available
>>       for R 3.6 on
>>       Windows. All the debugging needed is in the output of
>>       sessionInfo().
>>
>>       Please report back after updating at least sp, rgdal and
>>       raster (your
>>       raster version is also pretty outdated).
>>
>>       Roger Bivand
>>
>>      >
>>      > rgdal::compare_CRS(CRS("OGC:CRS84"), slot(rasbrick, "crs"))
>>      > Error in CRS("OGC:CRS84") :
>>      > PROJ4 argument-value pairs must begin with +: OGC:CRS84
>>      >
>>      > I also tried it like this:
>>      >
>>      > rgdal::compare_CRS(CRS("+OGC:CRS84"), slot(rasbrick, "crs"))
>>      > Error in showSRID(uprojargs, format = "PROJ", multiline =
>>       "NO") :
>>      > Can't parse PROJ.4-style parameter string
>>      > +OGC:CRS84
>>      >
>>      > could you answer me where am I wrong?
>>      >
>>      > When I compare a shapefile with my raster (stack) the
>>       function runs normally.
>>      >
>>      > 2- using:
>>      >
>>      > cat(wkt(shapebefore), "\n")
>>      >
>>      > cat(wkt(rasbrick), "\n")
>>      >
>>      > I saw that the order of the axis were different, but after
>>       the transformation they were the same.
>>      >
>>      > Any problem making shapeafter<- spTransform(shapebefore,
>>       crs(rasbrick))
>>      >
>>      > when are the axis different before the transformation?
>>      >
>>      > Ex:
>>      >
>>      > cat(wkt(shapebefore), "\n")
>>      > GEOGCRS["WGS 84",
>>      >    DATUM["World Geodetic System 1984",
>>      >        ELLIPSOID["WGS 84",6378137,298.257223563,
>>      >            LENGTHUNIT["metre",1]]],
>>      >    PRIMEM["Greenwich",0,
>>      >        ANGLEUNIT["degree",0.0174532925199433]],
>>      >    CS[ellipsoidal,2],
>>      >        AXIS["latitude",north,
>>      >            ORDER[1],
>>      >            ANGLEUNIT["degree",0.0174532925199433]],
>>      >        AXIS["longitude",east,
>>      >            ORDER[2],
>>      >            ANGLEUNIT["degree",0.0174532925199433]],
>>      >    ID["EPSG",4326]]
>>      >
>>      >> cat(wkt(rasbrick), "\n")
>>      > GEOGCRS["unknown",
>>      >    DATUM["World Geodetic System 1984",
>>      >        ELLIPSOID["WGS 84",6378137,298.257223563,
>>      >            LENGTHUNIT["metre",1]],
>>      >        ID["EPSG",6326]],
>>      >    PRIMEM["Greenwich",0,
>>      >        ANGLEUNIT["degree",0.0174532925199433],
>>      >        ID["EPSG",8901]],
>>      >    CS[ellipsoidal,2],
>>      >        AXIS["longitude",east,
>>      >            ORDER[1],
>>      >            ANGLEUNIT["degree",0.0174532925199433,
>>      >                ID["EPSG",9122]]],
>>      >        AXIS["latitude",north,
>>      >            ORDER[2],
>>      >            ANGLEUNIT["degree",0.0174532925199433,
>>      >                ID["EPSG",9122]]]]
>>      >
>>      > The order of the axis (and other parameters) of my new shape
>>       (shapeafter) is the same as the raster (rasbrick) after
>>       transformation.
>>      >
>>      > 3 -  when I use:
>>      >
>>      > centroids = gCentroid(shapebefore, byid=TRUE)
>>      >
>>      > and
>>      >
>>      > centroids = gCentroid(shapeafter, byid=TRUE)
>>      >
>>      > why are the coordinates x and y values equal (and the values
>>       are exactly the same)?
>>      >
>>      > (It seems to me that both are longitude=x and latitude=y)
>>       but since the order is switched in cat(wkt(), shouldn't it be
>>       latitude=x and longitude=y in the shapebefore?
>>      >
>>      > if I use proj4string()
>>      > both my shapebefore and my shapeafter are like:
>>      >
>>      > "+proj=longlat +datum=WGS84 +no_defs"
>>      >
>>      >> sessionInfo()
>>      > R version 3.6.2 (2019-12-12)
>>      > Platform: x86_64-w64-mingw32/x64 (64-bit)
>>      > Running under: Windows 10 x64 (build 19042)
>>      >
>>      > Matrix products: default
>>      >
>>      > locale:
>>      > [1] LC_COLLATE=English_United States.1252
>>       LC_CTYPE=English_United States.1252
>>      > [3] LC_MONETARY=English_United States.1252 LC_NUMERIC=C
>>      > [5] LC_TIME=English_United States.1252
>>      >
>>      > attached base packages:
>>      > [1] stats     graphics  grDevices utils     datasets
>>       methods   base
>>      >
>>      > other attached packages:
>>      > [1] spdep_1.1-5    sf_0.9-5       spData_0.3.8
>>       maptools_1.0-1 xlsx_0.6.3     rgeos_0.5-3    raster_3.3-13
>>      > [8] rgdal_1.5-10   sp_1.4-2
>>      >
>>      > loaded via a namespace (and not attached):
>>      > [1] Rcpp_1.0.5         compiler_3.6.2     pillar_1.4.4
>>       LearnBayes_2.15.1  class_7.3-15
>>      > [6] tools_3.6.2        boot_1.3-23        nlme_3.1-142
>>       lifecycle_0.2.0    tibble_3.0.1
>>      > [11] lattice_0.20-41    pkgconfig_2.0.3
>>       rlang_0.4.7        Matrix_1.2-18      DBI_1.1.0
>>      > [16] rstudioapi_0.11    expm_0.999-5
>>       coda_0.19-3        rJava_0.9-12       e1071_1.7-3
>>      > [21] dplyr_1.0.0        gtools_3.8.2
>>       generics_0.0.2     xlsxjars_0.6.1     vctrs_0.3.1
>>      > [26] classInt_0.4-3     grid_3.6.2
>>       tidyselect_1.1.0   glue_1.4.1         spDataLarge_0.4.1
>>      > [31] R6_2.4.1           foreign_0.8-72
>>       gdata_2.18.0       deldir_0.1-28      purrr_0.3.4
>>      > [36] magrittr_1.5       gmodels_2.18.1
>>       splines_3.6.2      MASS_7.3-51.4      codetools_0.2-16
>>      > [41] ellipsis_0.3.1     units_0.6-7
>>       KernSmooth_2.23-16 crayon_1.3.4
>>      >
>>      > Thanks.
>>      >
>>      > Pietro Andre Telatin Paschoalino
>>      > Doutorando em Ci?ncias Econ?micas da Universidade Estadual
>>       de Maring? - PCE.
>>      >
>>      > ________________________________
>>      > De: Roger Bivand <Roger.Bivand at nhh.no>
>>      > Enviado: ter?a-feira, 15 de junho de 2021 15:18
>>      > Para: Pietro Andre Telatin Paschoalino
>>       <Pietro_telato at hotmail.com>
>>      > Assunto: Re: Doubt in function compare_CRS
>>      >
>>      > Please do not email me directly. For use questions, please
>>       subscribe to
>>      > R-sig-geo
>>      >
>>      > https://stat.ethz.ch/mailman/listinfo/R-SIG-Geo
>>      >
>>      > and post there. Your problem cannot be reproduced by me (I
>>       do not know
>>      > what your raster is) - when you post provide a minimal
>>       self-contained
>>      > example. Do also provide the output of sessionInfo(), as you
>>       may not be
>>      > using updated packages.
>>      >
>>      > Roger Bivand
>>      >
>>      >
>>      > On Tue, 15 Jun 2021, Pietro Andre Telatin Paschoalino wrote:
>>      >
>>      >> Hello Bivand,
>>      >>
>>      >> How you create the function compare_CRS and it has already
>>       exemplified
>>      >> several issues for me. I would like to know if you can help
>>       me with a
>>      >> simple issue
>>      >>
>>      >> I tried to compare the CRS OGC with my raster (stack) and I
>>       couldn't:
>>      >>
>>      >> rgdal::compare_CRS(CRS("OGC:CRS84"), slot(rasbrick, "crs"))
>>      >> Error in CRS("OGC:CRS84") :
>>      >> PROJ4 argument-value pairs must begin with +: OGC:CRS84
>>      >>
>>      >> I also tried it like this:
>>      >>
>>      >> rgdal::compare_CRS(CRS("+OGC:CRS84"), slot(rasbrick,
>>       "crs"))
>>      >> Error in showSRID(uprojargs, format = "PROJ", multiline =
>>       "NO") :
>>      >> Can't parse PROJ.4-style parameter string
>>      >> +OGC:CRS84
>>      >>
>>      >> could you answer me where am I wrong?
>>      >>
>>      >> When I compare a shapefile with my raster (stack) the
>>       function runs normally, for example:
>>      >>
>>      >> compare_CRS(slot(shape1, "proj4string"), slot(rasbrick,
>>       "crs"))
>>      >>                      strict                   equivalent
>>       equivalent_except_axis_order
>>      >>                       FALSE
>>       TRUE                         TRUE
>>      >>
>>      >> Thank you.
>>      >>
>>      >> Pietro Andre Telatin Paschoalino
>>      >> Doutorando em Ci?ncias Econ?micas da Universidade
>>       Estadual de Maring? - PCE.
>>      >>
>>      >>[https://ipmcdn.avast.com/images/icons/icon-envelope-tick-round-orange-an
>> imated-no-repeat-v1.gif]<https://www.avast.com/sig-email?utm_medium=emai
>> l&utm_source=link&utm_campaign=sig-email&utm_content=webmail&utm_term=ic
>>       on>    Virus-free.www.avast.com<https://www.avast.com/sig-email?utm_medium=email&utm_source
>>       =link&utm_campaign=sig-email&utm_content=webmail&utm_term=link>
>>      >>
>>      >
>>      > --
>>      > Roger Bivand
>>      > Emeritus Professor
>>      > Department of Economics, Norwegian School of Economics,
>>      > Postboks 3490 Ytre Sandviken, 5045 Bergen, Norway.
>>      > e-mail: Roger.Bivand at nhh.no
>>      > https://orcid.org/0000-0003-2392-6140
>>      > https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>>      >
>>      > [[alternative HTML version deleted]]
>>      >
>>      >
>>
>>       --
>>       Roger Bivand
>>       Emeritus Professor
>>       Department of Economics, Norwegian School of Economics,
>>       Postboks 3490 Ytre Sandviken, 5045 Bergen, Norway.
>>       e-mail: Roger.Bivand at nhh.no
>>       https://orcid.org/0000-0003-2392-6140
>>       https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>>
>>
>>
>>
>
> --
> Roger Bivand
> Emeritus Professor
> Department of Economics, Norwegian School of Economics,
> Postboks 3490 Ytre Sandviken, 5045 Bergen, Norway.
> e-mail: Roger.Bivand at nhh.no
> https://orcid.org/0000-0003-2392-6140
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>

--
Roger Bivand
Emeritus Professor
Department of Economics, Norwegian School of Economics,
Postboks 3490 Ytre Sandviken, 5045 Bergen, Norway.
e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

	[[alternative HTML version deleted]]


From Roger@B|v@nd @end|ng |rom nhh@no  Wed Jun 16 17:44:51 2021
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Wed, 16 Jun 2021 17:44:51 +0200
Subject: [R-sig-Geo] 3 Questions on CRS change
In-Reply-To: <BN8PR17MB2980345C811E541D310A6795820F9@BN8PR17MB2980.namprd17.prod.outlook.com>
References: <BN8PR17MB298021CB6EC64184F19E827A820F9@BN8PR17MB2980.namprd17.prod.outlook.com>,
 <77dba567-84fe-ac59-191a-a323eabd5c4@reclus2.nhh.no>
 <BN8PR17MB2980574F27B238CB8F9986D1820F9@BN8PR17MB2980.namprd17.prod.outlook.com>,
 <e9b550c6-6dc-2151-e989-2b8f2fc8f3db@reclus2.nhh.no>
 <BN8PR17MB2980345C811E541D310A6795820F9@BN8PR17MB2980.namprd17.prod.outlook.com>
Message-ID: <443d3a72-fa24-d01e-408a-8fabcf56f2bb@reclus2.nhh.no>

On Wed, 16 Jun 2021, Pietro Andre Telatin Paschoalino wrote:

> Thank you Roger. I think that the difference between the two will not be 
> huge but I'll test with this s2 package.
>
> Only a doubt, how to transform a shapefile opened by readOGR or st_read 
> to a as_s2_geography (I can't extract the centroids in those formats in 
> s2 package), and when I try to transform I got a message:

With sf 1.0-0 and sf::sf_use_s2() TRUE, sf::st_centroid() should use s2 
and convert the objects. Alternatively, use sf::st_as_s2().

Roger

>
> Error in UseMethod("as_s2_geography") : no applicable method for 
> 'as_s2_geography' applied to an object of class "c('sf', 'data.frame')"
>
> Thanks again.
>
> Pietro Andre Telatin Paschoalino
> Doutorando em Ci?ncias Econ?micas da Universidade Estadual de Maring? - PCE.
>
> ________________________________
> De: Roger Bivand <Roger.Bivand at nhh.no>
> Enviado: quarta-feira, 16 de junho de 2021 12:01
> Para: Pietro Andre Telatin Paschoalino <pietro_telato at hotmail.com>
> Cc: r-sig-geo at r-project.org <r-sig-geo at r-project.org>
> Assunto: RE: [R-sig-Geo] 3 Questions on CRS change
>
> On Wed, 16 Jun 2021, Pietro Andre Telatin Paschoalino wrote:
>
>> Hello Roger,
>>
>> After updating the packages issue 1 was solved.
>>
>
> Many data sets in the wild declare EPSG:4326 but use eastings:northings
> contrary to the authority. sp/rgdal/raster use eastings/northings and
> rgdal changes the recorded order in the crs/CRS object (used by
> sp/raster). OGC:CRS84 is eastings/northings by definition. Caution is
> advised. Further, from PROJ 8 and EPSG version >= 10, WGS84 is a datum
> ensemble:
>
>> sp::CRS("OGC:CRS84")
> Coordinate Reference System:
> Deprecated Proj.4 representation: +proj=longlat +datum=WGS84 +no_defs
> WKT2 2019 representation:
> GEOGCRS["WGS 84 (CRS84)",
>     ENSEMBLE["World Geodetic System 1984 ensemble",
>         MEMBER["World Geodetic System 1984 (Transit)"],
>         MEMBER["World Geodetic System 1984 (G730)"],
>         MEMBER["World Geodetic System 1984 (G873)"],
>         MEMBER["World Geodetic System 1984 (G1150)"],
>         MEMBER["World Geodetic System 1984 (G1674)"],
>         MEMBER["World Geodetic System 1984 (G1762)"],
>         ELLIPSOID["WGS 84",6378137,298.257223563,
>             LENGTHUNIT["metre",1]],
>         ENSEMBLEACCURACY[2.0]],
>     PRIMEM["Greenwich",0,
>         ANGLEUNIT["degree",0.0174532925199433]],
>     CS[ellipsoidal,2],
>         AXIS["geodetic longitude (Lon)",east,
>             ORDER[1],
>             ANGLEUNIT["degree",0.0174532925199433]],
>         AXIS["geodetic latitude (Lat)",north,
>             ORDER[2],
>             ANGLEUNIT["degree",0.0174532925199433]],
>     USAGE[
>         SCOPE["Not known."],
>         AREA["World."],
>         BBOX[-90,-180,90,180]],
>     ID["OGC","CRS84"]]
>> rgdal::rgdal_extSoftVersion()
>           GDAL GDAL_with_GEOS           PROJ             sp           EPSG
>        "3.3.0"         "TRUE"        "8.0.1"        "1.4-6"      "v10.018"
>
> where it is expected that current use will assume (G1762) rather than
> earlier versions. This impacts especially parts of the world with
> fast-moving tectonic plates. We don't yet know how it will play out, nor
> how to choose non-default members of the ensemble.
>
>> 2- I keep my doubt if the order axis between the shape and raster (or 2
>>    shapes) in cat(wkt(), "\n", before the spTransform is a problem. But
>>    I don't think so, I tested it with another shape without spTransform
>>    and the results were similar. I believe spTransform also changes the
>>    axis order correctly. But I don't know if it's a specific case or if
>>    it won't always be a problem to apply spTransform in these cases,
>>    would you know about this?
>>
>> 3- In this case, as I don't know what you say by unprojected in my case,
>>    you believe it's a problem to apply gCentroid in my example:
>
> Unprojected is GEOGCRS, projected is PROJCRS (plus some other variants).
> For GEOS to work, you need planar, projected coordinates where Euclidean
> distances work, rather than distances on the surface of a sphere. The s2
> package provides s2::s2_centroid() on the surface of a sphere.
>
> Roger
>
>>
>> GEOGCRS["unknown",
>>    DATUM["World Geodetic System 1984",
>>        ELLIPSOID["WGS 84",6378137,298.257223563,
>>            LENGTHUNIT["metre",1]],
>>        ID["EPSG",6326]],
>>    PRIMEM["Greenwich",0,
>>        ANGLEUNIT["degree",0.0174532925199433],
>>        ID["EPSG",8901]],
>>    CS[ellipsoidal,2],
>>        AXIS["longitude",east,
>>            ORDER[1],
>>            ANGLEUNIT["degree",0.0174532925199433,
>>                ID["EPSG",9122]]],
>>        AXIS["latitude",north,
>>            ORDER[2],
>>            ANGLEUNIT["degree",0.0174532925199433,
>>                ID["EPSG",9122]]]]
>>
>> Thank you.
>>
>> Pietro Andre Telatin Paschoalino
>> Doutorando em Ci?ncias Econ?micas da Universidade Estadual de Maring? - PCE.
>>
>> ________________________________
>> De: Roger Bivand <Roger.Bivand at nhh.no>
>> Enviado: quarta-feira, 16 de junho de 2021 08:38
>> Para: Pietro Andre Telatin Paschoalino <pietro_telato at hotmail.com>
>> Cc: r-sig-geo at r-project.org <r-sig-geo at r-project.org>
>> Assunto: Re: [R-sig-Geo] 3 Questions on CRS change
>>
>> On Wed, 16 Jun 2021, Pietro Andre Telatin Paschoalino wrote:
>>
>>> Hello Roger,
>>> Thank you. I'll update the packages and try again.
>>>
>>> And about my doubts 2 and 3, you know If there is any problem?
>>
>> Try them after updating as they may differ. 2 - nobody knows,
>> sp/rgdal/raster try to impose GIS/visualization order. 3 - try to avoid
>> using rgeos with unprojected geometries, it only provides accurate
>> centroids for planar geometries.
>>
>> Roger
>>
>>>
>>> Thanks again.
>>>
>>> Em 16 de jun de 2021 04:18, Roger Bivand <Roger.Bivand at nhh.no> escreveu:
>>>
>>>       On Tue, 15 Jun 2021, Pietro Andre Telatin Paschoalino wrote:
>>>
>>>     > 1-  I tried to compare the CRS OGC with my raster (stack)
>>>       and I couldn't:
>>>     >
>>>     > My raster data are CRU DATA TS 4.04 (EAST ANGLIA)
>>>
>>>       This is not a minimal reproducible example, perhaps
>>>
>>>       https://crudata.uea.ac.uk/cru/data/hrg/cru_ts_4.04/
>>>
>>>       is the source, but no specific (very small) file is indicated.
>>>       Using the
>>>       224MB cru_ts4.04.2011.2019.pre.dat.nc on an updated system
>>>       (rgdal, raster
>>>       and sp as CRAN, Linux, PROJ 8.0.1, GDAL 3.3.0) there is no
>>>       problem.
>>>
>>>       You have rgdal 1.5-10 (CRAN has 1.5-23), sp 1.4-2 (CRAN has
>>>       1.4-5) and
>>>       raster 3.3-13 (CRAN has 3.4-10), which I will not re-install
>>>       because they
>>>       are not the problem, and the current versions are available
>>>       for R 3.6 on
>>>       Windows. All the debugging needed is in the output of
>>>       sessionInfo().
>>>
>>>       Please report back after updating at least sp, rgdal and
>>>       raster (your
>>>       raster version is also pretty outdated).
>>>
>>>       Roger Bivand
>>>
>>>     >
>>>     > rgdal::compare_CRS(CRS("OGC:CRS84"), slot(rasbrick, "crs"))
>>>     > Error in CRS("OGC:CRS84") :
>>>     > PROJ4 argument-value pairs must begin with +: OGC:CRS84
>>>     >
>>>     > I also tried it like this:
>>>     >
>>>     > rgdal::compare_CRS(CRS("+OGC:CRS84"), slot(rasbrick, "crs"))
>>>     > Error in showSRID(uprojargs, format = "PROJ", multiline =
>>>       "NO") :
>>>     > Can't parse PROJ.4-style parameter string
>>>     > +OGC:CRS84
>>>     >
>>>     > could you answer me where am I wrong?
>>>     >
>>>     > When I compare a shapefile with my raster (stack) the
>>>       function runs normally.
>>>     >
>>>     > 2- using:
>>>     >
>>>     > cat(wkt(shapebefore), "\n")
>>>     >
>>>     > cat(wkt(rasbrick), "\n")
>>>     >
>>>     > I saw that the order of the axis were different, but after
>>>       the transformation they were the same.
>>>     >
>>>     > Any problem making shapeafter<- spTransform(shapebefore,
>>>       crs(rasbrick))
>>>     >
>>>     > when are the axis different before the transformation?
>>>     >
>>>     > Ex:
>>>     >
>>>     > cat(wkt(shapebefore), "\n")
>>>     > GEOGCRS["WGS 84",
>>>     >    DATUM["World Geodetic System 1984",
>>>     >        ELLIPSOID["WGS 84",6378137,298.257223563,
>>>     >            LENGTHUNIT["metre",1]]],
>>>     >    PRIMEM["Greenwich",0,
>>>     >        ANGLEUNIT["degree",0.0174532925199433]],
>>>     >    CS[ellipsoidal,2],
>>>     >        AXIS["latitude",north,
>>>     >            ORDER[1],
>>>     >            ANGLEUNIT["degree",0.0174532925199433]],
>>>     >        AXIS["longitude",east,
>>>     >            ORDER[2],
>>>     >            ANGLEUNIT["degree",0.0174532925199433]],
>>>     >    ID["EPSG",4326]]
>>>     >
>>>     >> cat(wkt(rasbrick), "\n")
>>>     > GEOGCRS["unknown",
>>>     >    DATUM["World Geodetic System 1984",
>>>     >        ELLIPSOID["WGS 84",6378137,298.257223563,
>>>     >            LENGTHUNIT["metre",1]],
>>>     >        ID["EPSG",6326]],
>>>     >    PRIMEM["Greenwich",0,
>>>     >        ANGLEUNIT["degree",0.0174532925199433],
>>>     >        ID["EPSG",8901]],
>>>     >    CS[ellipsoidal,2],
>>>     >        AXIS["longitude",east,
>>>     >            ORDER[1],
>>>     >            ANGLEUNIT["degree",0.0174532925199433,
>>>     >                ID["EPSG",9122]]],
>>>     >        AXIS["latitude",north,
>>>     >            ORDER[2],
>>>     >            ANGLEUNIT["degree",0.0174532925199433,
>>>     >                ID["EPSG",9122]]]]
>>>     >
>>>     > The order of the axis (and other parameters) of my new shape
>>>       (shapeafter) is the same as the raster (rasbrick) after
>>>       transformation.
>>>     >
>>>     > 3 -  when I use:
>>>     >
>>>     > centroids = gCentroid(shapebefore, byid=TRUE)
>>>     >
>>>     > and
>>>     >
>>>     > centroids = gCentroid(shapeafter, byid=TRUE)
>>>     >
>>>     > why are the coordinates x and y values equal (and the values
>>>       are exactly the same)?
>>>     >
>>>     > (It seems to me that both are longitude=x and latitude=y)
>>>       but since the order is switched in cat(wkt(), shouldn't it be
>>>       latitude=x and longitude=y in the shapebefore?
>>>     >
>>>     > if I use proj4string()
>>>     > both my shapebefore and my shapeafter are like:
>>>     >
>>>     > "+proj=longlat +datum=WGS84 +no_defs"
>>>     >
>>>     >> sessionInfo()
>>>     > R version 3.6.2 (2019-12-12)
>>>     > Platform: x86_64-w64-mingw32/x64 (64-bit)
>>>     > Running under: Windows 10 x64 (build 19042)
>>>     >
>>>     > Matrix products: default
>>>     >
>>>     > locale:
>>>     > [1] LC_COLLATE=English_United States.1252
>>>       LC_CTYPE=English_United States.1252
>>>     > [3] LC_MONETARY=English_United States.1252 LC_NUMERIC=C
>>>     > [5] LC_TIME=English_United States.1252
>>>     >
>>>     > attached base packages:
>>>     > [1] stats     graphics  grDevices utils     datasets
>>>       methods   base
>>>     >
>>>     > other attached packages:
>>>     > [1] spdep_1.1-5    sf_0.9-5       spData_0.3.8
>>>       maptools_1.0-1 xlsx_0.6.3     rgeos_0.5-3    raster_3.3-13
>>>     > [8] rgdal_1.5-10   sp_1.4-2
>>>     >
>>>     > loaded via a namespace (and not attached):
>>>     > [1] Rcpp_1.0.5         compiler_3.6.2     pillar_1.4.4
>>>       LearnBayes_2.15.1  class_7.3-15
>>>     > [6] tools_3.6.2        boot_1.3-23        nlme_3.1-142
>>>       lifecycle_0.2.0    tibble_3.0.1
>>>     > [11] lattice_0.20-41    pkgconfig_2.0.3
>>>       rlang_0.4.7        Matrix_1.2-18      DBI_1.1.0
>>>     > [16] rstudioapi_0.11    expm_0.999-5
>>>       coda_0.19-3        rJava_0.9-12       e1071_1.7-3
>>>     > [21] dplyr_1.0.0        gtools_3.8.2
>>>       generics_0.0.2     xlsxjars_0.6.1     vctrs_0.3.1
>>>     > [26] classInt_0.4-3     grid_3.6.2
>>>       tidyselect_1.1.0   glue_1.4.1         spDataLarge_0.4.1
>>>     > [31] R6_2.4.1           foreign_0.8-72
>>>       gdata_2.18.0       deldir_0.1-28      purrr_0.3.4
>>>     > [36] magrittr_1.5       gmodels_2.18.1
>>>       splines_3.6.2      MASS_7.3-51.4      codetools_0.2-16
>>>     > [41] ellipsis_0.3.1     units_0.6-7
>>>       KernSmooth_2.23-16 crayon_1.3.4
>>>     >
>>>     > Thanks.
>>>     >
>>>     > Pietro Andre Telatin Paschoalino
>>>     > Doutorando em Ci?ncias Econ?micas da Universidade Estadual
>>>       de Maring? - PCE.
>>>     >
>>>     > ________________________________
>>>     > De: Roger Bivand <Roger.Bivand at nhh.no>
>>>     > Enviado: ter?a-feira, 15 de junho de 2021 15:18
>>>     > Para: Pietro Andre Telatin Paschoalino
>>>       <Pietro_telato at hotmail.com>
>>>     > Assunto: Re: Doubt in function compare_CRS
>>>     >
>>>     > Please do not email me directly. For use questions, please
>>>       subscribe to
>>>     > R-sig-geo
>>>     >
>>>     > https://stat.ethz.ch/mailman/listinfo/R-SIG-Geo
>>>     >
>>>     > and post there. Your problem cannot be reproduced by me (I
>>>       do not know
>>>     > what your raster is) - when you post provide a minimal
>>>       self-contained
>>>     > example. Do also provide the output of sessionInfo(), as you
>>>       may not be
>>>     > using updated packages.
>>>     >
>>>     > Roger Bivand
>>>     >
>>>     >
>>>     > On Tue, 15 Jun 2021, Pietro Andre Telatin Paschoalino wrote:
>>>     >
>>>     >> Hello Bivand,
>>>     >>
>>>     >> How you create the function compare_CRS and it has already
>>>       exemplified
>>>     >> several issues for me. I would like to know if you can help
>>>       me with a
>>>     >> simple issue
>>>     >>
>>>     >> I tried to compare the CRS OGC with my raster (stack) and I
>>>       couldn't:
>>>     >>
>>>     >> rgdal::compare_CRS(CRS("OGC:CRS84"), slot(rasbrick, "crs"))
>>>     >> Error in CRS("OGC:CRS84") :
>>>     >> PROJ4 argument-value pairs must begin with +: OGC:CRS84
>>>     >>
>>>     >> I also tried it like this:
>>>     >>
>>>     >> rgdal::compare_CRS(CRS("+OGC:CRS84"), slot(rasbrick,
>>>       "crs"))
>>>     >> Error in showSRID(uprojargs, format = "PROJ", multiline =
>>>       "NO") :
>>>     >> Can't parse PROJ.4-style parameter string
>>>     >> +OGC:CRS84
>>>     >>
>>>     >> could you answer me where am I wrong?
>>>     >>
>>>     >> When I compare a shapefile with my raster (stack) the
>>>       function runs normally, for example:
>>>     >>
>>>     >> compare_CRS(slot(shape1, "proj4string"), slot(rasbrick,
>>>       "crs"))
>>>     >>                      strict                   equivalent
>>>       equivalent_except_axis_order
>>>     >>                       FALSE
>>>       TRUE                         TRUE
>>>     >>
>>>     >> Thank you.
>>>     >>
>>>     >> Pietro Andre Telatin Paschoalino
>>>     >> Doutorando em Ci?ncias Econ?micas da Universidade
>>>       Estadual de Maring? - PCE.
>>>     >>
>>>     >>[https://ipmcdn.avast.com/images/icons/icon-envelope-tick-round-orange-an
>>> imated-no-repeat-v1.gif]<https://www.avast.com/sig-email?utm_medium=emai
>>> l&utm_source=link&utm_campaign=sig-email&utm_content=webmail&utm_term=ic
>>>       on>    Virus-free.www.avast.com<https://www.avast.com/sig-email?utm_medium=email&utm_source
>>>       =link&utm_campaign=sig-email&utm_content=webmail&utm_term=link>
>>>     >>
>>>     >
>>>     > --
>>>     > Roger Bivand
>>>     > Emeritus Professor
>>>     > Department of Economics, Norwegian School of Economics,
>>>     > Postboks 3490 Ytre Sandviken, 5045 Bergen, Norway.
>>>     > e-mail: Roger.Bivand at nhh.no
>>>     > https://orcid.org/0000-0003-2392-6140
>>>     > https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>>>     >
>>>     > [[alternative HTML version deleted]]
>>>     >
>>>     >
>>>
>>>       --
>>>       Roger Bivand
>>>       Emeritus Professor
>>>       Department of Economics, Norwegian School of Economics,
>>>       Postboks 3490 Ytre Sandviken, 5045 Bergen, Norway.
>>>       e-mail: Roger.Bivand at nhh.no
>>>       https://orcid.org/0000-0003-2392-6140
>>>       https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>>>
>>>
>>>
>>>
>>
>> --
>> Roger Bivand
>> Emeritus Professor
>> Department of Economics, Norwegian School of Economics,
>> Postboks 3490 Ytre Sandviken, 5045 Bergen, Norway.
>> e-mail: Roger.Bivand at nhh.no
>> https://orcid.org/0000-0003-2392-6140
>> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>>
>
> --
> Roger Bivand
> Emeritus Professor
> Department of Economics, Norwegian School of Economics,
> Postboks 3490 Ytre Sandviken, 5045 Bergen, Norway.
> e-mail: Roger.Bivand at nhh.no
> https://orcid.org/0000-0003-2392-6140
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>

-- 
Roger Bivand
Emeritus Professor
Department of Economics, Norwegian School of Economics,
Postboks 3490 Ytre Sandviken, 5045 Bergen, Norway.
e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

From @bo @end|ng |rom e|r|ck@de  Mon Jun 21 03:36:40 2021
From: @bo @end|ng |rom e|r|ck@de (Tim Elrick)
Date: Sun, 20 Jun 2021 21:36:40 -0400
Subject: [R-sig-Geo] 
 Encoding of attributes in SpatVector (terra package)
In-Reply-To: <CALrbzg1WrSOaOpGwVZdoucA7A4Q9LLCbzaDsojwrzpMSNFWViQ@mail.gmail.com>
References: <8bb63203-cf40-7660-a512-6d5372995b8e@elrick.de>
 <CALrbzg1WrSOaOpGwVZdoucA7A4Q9LLCbzaDsojwrzpMSNFWViQ@mail.gmail.com>
Message-ID: <52059779-93d3-7952-9fd5-99ff05a9dc56@elrick.de>

Hi Ben,

Sorry, now as plain text...

Thanks for your response. I guess, that is a Windows encoding problem 
then, as I get (below I also included how they differ):

###
identical(mtl.sf$NOM, mtl.spv$NOM)
[1] FALSE
 > sessionInfo()
R version 4.1.0 (2021-05-18)
Platform: x86_64-w64-mingw32/x64 (64-bit)
Running under: Windows 10 x64 (build 17763)

Matrix products: default

locale:
[1] LC_COLLATE=English_Canada.1252  LC_CTYPE=English_Canada.1252 
LC_MONETARY=English_Canada.1252
[4] LC_NUMERIC=C                    LC_TIME=English_Canada.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
  [1] sf_1.0-0        terra_1.3-4     forcats_0.5.1   stringr_1.4.0 
dplyr_1.0.7     purrr_0.3.4     readr_1.4.0
  [8] tidyr_1.1.3     tibble_3.1.2    ggplot2_3.3.4   tidyverse_1.3.1

loaded via a namespace (and not attached):
  [1] tidyselect_1.1.1   haven_2.4.1        lattice_0.20-44 
colorspace_2.0-1   vctrs_0.3.8        generics_0.1.0
  [7] utf8_1.2.1         rlang_0.4.11       e1071_1.7-7 
pillar_1.6.1       glue_1.4.2         withr_2.4.2
[13] DBI_1.1.1          sp_1.4-5           dbplyr_2.1.1 
modelr_0.1.8       readxl_1.3.1       lifecycle_1.0.0
[19] munsell_0.5.0      gtable_0.3.0       cellranger_1.1.0 
rvest_1.0.0        raster_3.4-13      codetools_0.2-18
[25] labeling_0.4.2     class_7.3-19       fansi_0.5.0 
broom_0.7.7        Rcpp_1.0.6         KernSmooth_2.23-20
[31] scales_1.1.1       backports_1.2.1    classInt_0.4-3 
jsonlite_1.7.2     farver_2.1.0       fs_1.5.0
[37] digest_0.6.27      hms_1.1.0          stringi_1.6.2      grid_4.1.0 
         cli_2.5.0          tools_4.1.0
[43] magrittr_2.0.1     proxy_0.4-26       crayon_1.4.1 
pkgconfig_2.0.3    ellipsis_0.3.2     xml2_1.3.2
[49] reprex_2.0.0       lubridate_1.7.10   assertthat_0.2.1   httr_1.4.2 
         rstudioapi_0.13    R6_2.5.0
[55] units_0.7-2        compiler_4.1.0
###

Here is the difference:
###
 > tail(mtl.sf$NOM)
[1] "Montr?al-Est"            "Anjou" 
"Pierrefonds-Roxboro"     "Sainte-Anne-de-Bellevue"
[5] "Verdun"                  "Baie-d'Urf?"
 > tail(mtl.spv$NOM)
[1] "Montr??al-Est"           "Anjou" 
"Pierrefonds-Roxboro"     "Sainte-Anne-de-Bellevue"
[5] "Verdun"                  "Baie-d'Urf??"
###

So, basically, vect() seems to have problems to interpret non-ASCII 
characters in Windows.

Is there an easy way to fix that, e.g. by setting a parameter or is this 
a bug for the Windows edition?

Thanks,
Tim

On 2021-06-15 18:32, Ben Tupper wrote:
Hi,


Alas, HTML mail gets mangled - try setting your email client to send 
plan text.

I don't know what the NOM variable contents are supposed to look like,
but I find they are identical.  Can you post to the list your evidence
that shows how they differ and what makes one right versus the other
wrong?  Also, always add the output of sessionInfo() as shown below.

library(sf)
library(terra)

url <- 
"https://data.montreal.ca/dataset/00bd85eb-23aa-4669-8f1b-ba9a000e3dd8/resource/e9b0f927-8f75-458c-8fda-b5da65cc8b73/download/limadmin.geojson"

mtl.sf <- read_sf(url)# convert sf object to SpatVector object

mtl.spv <- vect(mtl.sf)

identical(mtl.sf$NOM, mtl.spv$NOM)
# [1] TRUE

sessionInfo()
# R version 4.0.3 (2020-10-10)
# Platform: x86_64-apple-darwin17.0 (64-bit)
# Running under: macOS Big Sur 10.16
#
# Matrix products: default
# LAPACK: 
/Library/Frameworks/R.framework/Versions/4.0/Resources/lib/libRlapack.dylib
#
# locale:
#   [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
#
# attached base packages:
#   [1] stats     graphics  grDevices utils     datasets  methods   base
#
# other attached packages:
#   [1] terra_1.2-10 sf_0.9-8     dplyr_1.0.5
#
# loaded via a namespace (and not attached):
#   [1] Rcpp_1.0.6         rstudioapi_0.13    raster_3.4-5
magrittr_2.0.1     units_0.7-1        tidyselect_1.1.1
# [7] lattice_0.20-41    R6_2.5.0           rlang_0.4.11
fansi_0.4.2        blob_1.2.1         tools_4.0.3
# [13] grid_4.0.3         KernSmooth_2.23-17 utf8_1.2.1
cli_2.5.0          e1071_1.7-6        DBI_1.1.1
# [19] ellipsis_0.3.2     class_7.3-17       assertthat_0.2.1
tibble_3.1.1       lifecycle_1.0.0    crayon_1.4.1
# [25] purrr_0.3.4        codetools_0.2-16   vctrs_0.3.8
glue_1.4.2         sp_1.4-5           proxy_0.4-25
# [31] compiler_4.0.3     pillar_1.6.0       generics_0.1.0
classInt_0.4-3     pkgconfig_2.0.3

Cheers,
Ben


On Tue, Jun 15, 2021 at 11:57 AM Tim Elrick <abo at elrick.de> wrote:
 >
 > Hi all,
 >
 > Does anyone know how to change encoding for attributes in a SpatVector
 > (terra package)?
 >
 > library(sf) library(terra)
 > # importing a geojson file as sf object url <-
 > 
"https://data.montreal.ca/dataset/00bd85eb-23aa-4669-8f1b-ba9a000e3dd8/resource/e9b0f927-8f75-458c-8fda-b5da65cc8b73/download/limadmin.geojson"
 > mtl.sf <- read_sf(url)# convert sf object to SpatVector object mtl.spv
 > <- vect(mtl) # while mtl.sf$NOM # displays French letters correctly,
 > mtl.spv$NOM # does not anymore Thanks, Tim
 >
 >
 >          [[alternative HTML version deleted]]
 >
 > _______________________________________________
 > R-sig-Geo mailing list
 > R-sig-Geo at r-project.org
 > https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From btupper @end|ng |rom b|ge|ow@org  Mon Jun 21 18:45:09 2021
From: btupper @end|ng |rom b|ge|ow@org (Ben Tupper)
Date: Mon, 21 Jun 2021 12:45:09 -0400
Subject: [R-sig-Geo] 
 Encoding of attributes in SpatVector (terra package)
In-Reply-To: <52059779-93d3-7952-9fd5-99ff05a9dc56@elrick.de>
References: <8bb63203-cf40-7660-a512-6d5372995b8e@elrick.de>
 <CALrbzg1WrSOaOpGwVZdoucA7A4Q9LLCbzaDsojwrzpMSNFWViQ@mail.gmail.com>
 <52059779-93d3-7952-9fd5-99ff05a9dc56@elrick.de>
Message-ID: <CALrbzg2Tg6tkjKKdhsGntB7eqDUkhdc-_o2i6EN=Y1uhNSjt7g@mail.gmail.com>

Hi,

This quickly gets beyond my chops.  Have you considered filing a
reproducible example in the bug tracker?   You might search old issues
there first in case this has been resolved by others.  Also, search
with RSeek.org or the like.

https://cran.r-project.org/web/packages/terra/index.html

Cheers,
Ben

On Sun, Jun 20, 2021 at 9:36 PM Tim Elrick <abo at elrick.de> wrote:
>
> Hi Ben,
>
> Sorry, now as plain text...
>
> Thanks for your response. I guess, that is a Windows encoding problem
> then, as I get (below I also included how they differ):
>
> ###
> identical(mtl.sf$NOM, mtl.spv$NOM)
> [1] FALSE
>  > sessionInfo()
> R version 4.1.0 (2021-05-18)
> Platform: x86_64-w64-mingw32/x64 (64-bit)
> Running under: Windows 10 x64 (build 17763)
>
> Matrix products: default
>
> locale:
> [1] LC_COLLATE=English_Canada.1252  LC_CTYPE=English_Canada.1252
> LC_MONETARY=English_Canada.1252
> [4] LC_NUMERIC=C                    LC_TIME=English_Canada.1252
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> other attached packages:
>   [1] sf_1.0-0        terra_1.3-4     forcats_0.5.1   stringr_1.4.0
> dplyr_1.0.7     purrr_0.3.4     readr_1.4.0
>   [8] tidyr_1.1.3     tibble_3.1.2    ggplot2_3.3.4   tidyverse_1.3.1
>
> loaded via a namespace (and not attached):
>   [1] tidyselect_1.1.1   haven_2.4.1        lattice_0.20-44
> colorspace_2.0-1   vctrs_0.3.8        generics_0.1.0
>   [7] utf8_1.2.1         rlang_0.4.11       e1071_1.7-7
> pillar_1.6.1       glue_1.4.2         withr_2.4.2
> [13] DBI_1.1.1          sp_1.4-5           dbplyr_2.1.1
> modelr_0.1.8       readxl_1.3.1       lifecycle_1.0.0
> [19] munsell_0.5.0      gtable_0.3.0       cellranger_1.1.0
> rvest_1.0.0        raster_3.4-13      codetools_0.2-18
> [25] labeling_0.4.2     class_7.3-19       fansi_0.5.0
> broom_0.7.7        Rcpp_1.0.6         KernSmooth_2.23-20
> [31] scales_1.1.1       backports_1.2.1    classInt_0.4-3
> jsonlite_1.7.2     farver_2.1.0       fs_1.5.0
> [37] digest_0.6.27      hms_1.1.0          stringi_1.6.2      grid_4.1.0
>          cli_2.5.0          tools_4.1.0
> [43] magrittr_2.0.1     proxy_0.4-26       crayon_1.4.1
> pkgconfig_2.0.3    ellipsis_0.3.2     xml2_1.3.2
> [49] reprex_2.0.0       lubridate_1.7.10   assertthat_0.2.1   httr_1.4.2
>          rstudioapi_0.13    R6_2.5.0
> [55] units_0.7-2        compiler_4.1.0
> ###
>
> Here is the difference:
> ###
>  > tail(mtl.sf$NOM)
> [1] "Montr?al-Est"            "Anjou"
> "Pierrefonds-Roxboro"     "Sainte-Anne-de-Bellevue"
> [5] "Verdun"                  "Baie-d'Urf?"
>  > tail(mtl.spv$NOM)
> [1] "Montr??al-Est"           "Anjou"
> "Pierrefonds-Roxboro"     "Sainte-Anne-de-Bellevue"
> [5] "Verdun"                  "Baie-d'Urf??"
> ###
>
> So, basically, vect() seems to have problems to interpret non-ASCII
> characters in Windows.
>
> Is there an easy way to fix that, e.g. by setting a parameter or is this
> a bug for the Windows edition?
>
> Thanks,
> Tim
>
> On 2021-06-15 18:32, Ben Tupper wrote:
> Hi,
>
>
> Alas, HTML mail gets mangled - try setting your email client to send
> plan text.
>
> I don't know what the NOM variable contents are supposed to look like,
> but I find they are identical.  Can you post to the list your evidence
> that shows how they differ and what makes one right versus the other
> wrong?  Also, always add the output of sessionInfo() as shown below.
>
> library(sf)
> library(terra)
>
> url <-
> "https://data.montreal.ca/dataset/00bd85eb-23aa-4669-8f1b-ba9a000e3dd8/resource/e9b0f927-8f75-458c-8fda-b5da65cc8b73/download/limadmin.geojson"
>
> mtl.sf <- read_sf(url)# convert sf object to SpatVector object
>
> mtl.spv <- vect(mtl.sf)
>
> identical(mtl.sf$NOM, mtl.spv$NOM)
> # [1] TRUE
>
> sessionInfo()
> # R version 4.0.3 (2020-10-10)
> # Platform: x86_64-apple-darwin17.0 (64-bit)
> # Running under: macOS Big Sur 10.16
> #
> # Matrix products: default
> # LAPACK:
> /Library/Frameworks/R.framework/Versions/4.0/Resources/lib/libRlapack.dylib
> #
> # locale:
> #   [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
> #
> # attached base packages:
> #   [1] stats     graphics  grDevices utils     datasets  methods   base
> #
> # other attached packages:
> #   [1] terra_1.2-10 sf_0.9-8     dplyr_1.0.5
> #
> # loaded via a namespace (and not attached):
> #   [1] Rcpp_1.0.6         rstudioapi_0.13    raster_3.4-5
> magrittr_2.0.1     units_0.7-1        tidyselect_1.1.1
> # [7] lattice_0.20-41    R6_2.5.0           rlang_0.4.11
> fansi_0.4.2        blob_1.2.1         tools_4.0.3
> # [13] grid_4.0.3         KernSmooth_2.23-17 utf8_1.2.1
> cli_2.5.0          e1071_1.7-6        DBI_1.1.1
> # [19] ellipsis_0.3.2     class_7.3-17       assertthat_0.2.1
> tibble_3.1.1       lifecycle_1.0.0    crayon_1.4.1
> # [25] purrr_0.3.4        codetools_0.2-16   vctrs_0.3.8
> glue_1.4.2         sp_1.4-5           proxy_0.4-25
> # [31] compiler_4.0.3     pillar_1.6.0       generics_0.1.0
> classInt_0.4-3     pkgconfig_2.0.3
>
> Cheers,
> Ben
>
>
> On Tue, Jun 15, 2021 at 11:57 AM Tim Elrick <abo at elrick.de> wrote:
>  >
>  > Hi all,
>  >
>  > Does anyone know how to change encoding for attributes in a SpatVector
>  > (terra package)?
>  >
>  > library(sf) library(terra)
>  > # importing a geojson file as sf object url <-
>  >
> "https://data.montreal.ca/dataset/00bd85eb-23aa-4669-8f1b-ba9a000e3dd8/resource/e9b0f927-8f75-458c-8fda-b5da65cc8b73/download/limadmin.geojson"
>  > mtl.sf <- read_sf(url)# convert sf object to SpatVector object mtl.spv
>  > <- vect(mtl) # while mtl.sf$NOM # displays French letters correctly,
>  > mtl.spv$NOM # does not anymore Thanks, Tim
>  >
>  >
>  >          [[alternative HTML version deleted]]
>  >
>  > _______________________________________________
>  > R-sig-Geo mailing list
>  > R-sig-Geo at r-project.org
>  > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
>
>


-- 
Ben Tupper (he/him)
Bigelow Laboratory for Ocean Science
East Boothbay, Maine
http://www.bigelow.org/
https://eco.bigelow.org


From tom@heng| @end|ng |rom gm@||@com  Mon Jun 21 19:09:29 2021
From: tom@heng| @end|ng |rom gm@||@com (Tomislav Hengl)
Date: Mon, 21 Jun 2021 19:09:29 +0200
Subject: [R-sig-Geo] OpenGeoHub Summer School / Rspatial virtual conference
 and webinars 1-3 Sept 2021
Message-ID: <fc1bcf5f-4aa9-5528-948d-b3a2c5c92688@gmail.com>


The OpenGeoHub Summer School 2021 will be held from 1st to 3rd of 
September virtually, with all training sessions being broadcasted live 
on Zoom, giving everyone the opportunity to attend and network from 
anywhere on the globe.

This is a not-for-profit event. There will be NO registration fees for 
this event. In order to participate you will, however, need to register 
using eventbrite.com (we can host up to maximum of 500 participants). 
Deadline for registrations: 15 July 2021.

The Summer School 2021 will feature:

- Live presentations and demos by leading R and OSGeo developers;
- 2 days of training sessions and R / OSGeo tutorials;
- 1 day of R-Spatial workshops;
- Discussion panels and break-out rooms;
- Networking activities & entertainment.

The programme of the Summer School and link to registrations is 
available from:

https://opengeohub.org/summer_school_2021

Lecturers / topics (unsorted):

- Edzer Pebesma (Institute for Geoinformatics, University of M?nster): 
"Spherical geometry",
- Gilberto Camara (National Institute for Space Research (INPE), 
Brazil): "Classifying remote sensing time series with SITS"
- Theresa Smith (Lecturer in Statistics, Departemen of Mathematical 
Sciences, University of Bath): "Analysing spatiotemporal disease/health 
data",
- Gerard Heuvelink (Professor, Wageningen University and Senior 
Researcher, ISRIC World Soil Information): "Design-based methods for 
assessing map accuracy",
- Judith Verstegen (Assistant Professor, Geo-information Science at 
Wageningen University and Research): "Geosimulation using agent-based 
methods",
- Ege Rubak (Associate Professor, Aalborg University): "Analyzing 
spatial point patterns with spatstat",
- Sandra de Iaco (Professor, Universit? del Salento): "Modelling 
Spatiotemporal dependence",
- Robert Hijmans (Department of Environmental Science and Policy, 
University of California, Davis): "Raster analysis in R"
- Hanna Meyer (Professor Landscape Ecology, University of M?nster): 
"Area of applicability of spatial prediction models",
- Marius Appel (Postdoctoral researcher in Geoinformatics, University of 
M?nster): "Analyzing massive amounts of EO data in the cloud with R, 
gdalcubes, and STAC",
- Veronica Andreo (Researcher, Instituto de Altos Estudios Espaciales 
"Mario Gulich" Consejo Nacional de Investigaciones Cientificas y 
Tecnicas (CONICET): "Analysis of space-time satellite data for disease 
ecology applications with GRASS GIS and R stats",
- Jakub Nowosad (Assistant Professor, Institute of Geoecology and 
Geoinformation, Adam Mickiewicz University): "Geocomputation with R/ 
spatial segmentation",
Martijn Tennekes (Data Scientist, CBS Statistics Netherlands): 
"Visualisation of spatial data",

Yours,

T. Hengl
https://opengeohub.org/about


From vero@ndreo @end|ng |rom gm@||@com  Mon Jun 21 21:30:11 2021
From: vero@ndreo @end|ng |rom gm@||@com (Veronica Andreo)
Date: Mon, 21 Jun 2021 21:30:11 +0200
Subject: [R-sig-Geo] problems installing stars and tmap in fedora 34
Message-ID: <CAAMki4EtGOitWc-iN8feW3ManriWP+v=vWKK0R3b+kYTe5ozrQ@mail.gmail.com>

Dear all,

I have just updated my laptop to fedora 34 and the only problems I've
encountered so far are related to stars and tmap updates. This is the error
I get in both cases:

Error in dyn.load(file, DLLpath = DLLpath, ...) :
  unable to load shared object
'/home/veroandreo/R/x86_64-redhat-linux-gnu-library/4.0/lwgeom/libs/lwgeom.so':
  libproj.so.15: cannot open shared object file: No such file or directory
Calls: <Anonymous> ... asNamespace -> loadNamespace -> library.dynam ->
dyn.load
Execution halted
ERROR: lazy loading failed for package ?stars?
* removing ?/home/veroandreo/R/x86_64-redhat-linux-gnu-library/4.0/stars?
Warning in install.packages :
  installation of package ?stars? had non-zero exit status

Searching around I found a (maybe related) issue reported for sf (
https://github.com/r-spatial/sf/issues/1670), but here sf installed just
fine and also rgdal. GRASS also compiles well, btw, and gdal-devel and
proj-devel are in place.

I tried the solution proposed in the issue
(`remotes::install_github("r-spatial/stars", configure.args=
'--with-proj-lib=/lib64')`), but it does not work either. I guess it's
because of this one: https://bugzilla.redhat.com/show_bug.cgi?id=1958191.
Right?

Is there anything else I could try/test/report? I really appreciate your
help :)

Best,
Vero

	[[alternative HTML version deleted]]


From edzer@pebe@m@ @end|ng |rom un|-muen@ter@de  Mon Jun 21 21:52:25 2021
From: edzer@pebe@m@ @end|ng |rom un|-muen@ter@de (Edzer Pebesma)
Date: Mon, 21 Jun 2021 21:52:25 +0200
Subject: [R-sig-Geo] problems installing stars and tmap in fedora 34
In-Reply-To: <CAAMki4EtGOitWc-iN8feW3ManriWP+v=vWKK0R3b+kYTe5ozrQ@mail.gmail.com>
References: <CAAMki4EtGOitWc-iN8feW3ManriWP+v=vWKK0R3b+kYTe5ozrQ@mail.gmail.com>
Message-ID: <916acb03-ae03-0e5d-bc3b-eec91c70fffd@uni-muenster.de>

Hi Vero, I would start with reinstalling package lwgeom.

On 21/06/2021 21:30, Veronica Andreo wrote:
> Dear all,
> 
> I have just updated my laptop to fedora 34 and the only problems I've
> encountered so far are related to stars and tmap updates. This is the error
> I get in both cases:
> 
> Error in dyn.load(file, DLLpath = DLLpath, ...) :
>    unable to load shared object
> '/home/veroandreo/R/x86_64-redhat-linux-gnu-library/4.0/lwgeom/libs/lwgeom.so':
>    libproj.so.15: cannot open shared object file: No such file or directory
> Calls: <Anonymous> ... asNamespace -> loadNamespace -> library.dynam ->
> dyn.load
> Execution halted
> ERROR: lazy loading failed for package ?stars?
> * removing ?/home/veroandreo/R/x86_64-redhat-linux-gnu-library/4.0/stars?
> Warning in install.packages :
>    installation of package ?stars? had non-zero exit status
> 
> Searching around I found a (maybe related) issue reported for sf (
> https://github.com/r-spatial/sf/issues/1670), but here sf installed just
> fine and also rgdal. GRASS also compiles well, btw, and gdal-devel and
> proj-devel are in place.
> 
> I tried the solution proposed in the issue
> (`remotes::install_github("r-spatial/stars", configure.args=
> '--with-proj-lib=/lib64')`), but it does not work either. I guess it's
> because of this one: https://bugzilla.redhat.com/show_bug.cgi?id=1958191.
> Right?
> 
> Is there anything else I could try/test/report? I really appreciate your
> help :)
> 
> Best,
> Vero
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics
Heisenbergstrasse 2, 48151 Muenster, Germany
Phone: +49 251 8333081


From vero@ndreo @end|ng |rom gm@||@com  Tue Jun 22 13:22:24 2021
From: vero@ndreo @end|ng |rom gm@||@com (Veronica Andreo)
Date: Tue, 22 Jun 2021 13:22:24 +0200
Subject: [R-sig-Geo] problems installing stars and tmap in fedora 34
In-Reply-To: <mailman.28686.5.1624356002.41410.r-sig-geo@r-project.org>
References: <mailman.28686.5.1624356002.41410.r-sig-geo@r-project.org>
Message-ID: <CAAMki4H=iz3ZZ=18bAYXGdjhtV29BonrgoC=PNtk6G6d7yiCCw@mail.gmail.com>

Hi Edzer,

El mar, 22 jun 2021 a las 12:01, <r-sig-geo-request at r-project.org> escribi?:

> From: Edzer Pebesma <edzer.pebesma at uni-muenster.de>
> To: r-sig-geo at r-project.org
> Subject: Re: [R-sig-Geo] problems installing stars and tmap in fedora 34
>
> Hi Vero, I would start with reinstalling package lwgeom.
>

That did it! Of course! (palm-face)
Thanks a lot! And sorry for the noise

Cheers,
Vero

On 21/06/2021 21:30, Veronica Andreo wrote:
> > Dear all,
> >
> > I have just updated my laptop to fedora 34 and the only problems I've
> > encountered so far are related to stars and tmap updates. This is the
> error
> > I get in both cases:
> >
> > Error in dyn.load(file, DLLpath = DLLpath, ...) :
> >    unable to load shared object
> >
> '/home/veroandreo/R/x86_64-redhat-linux-gnu-library/4.0/lwgeom/libs/lwgeom.so':
> >    libproj.so.15: cannot open shared object file: No such file or
> directory
> > Calls: <Anonymous> ... asNamespace -> loadNamespace -> library.dynam ->
> > dyn.load
> > Execution halted
> > ERROR: lazy loading failed for package ?stars?
> > * removing ?/home/veroandreo/R/x86_64-redhat-linux-gnu-library/4.0/stars?
> > Warning in install.packages :
> >    installation of package ?stars? had non-zero exit status
> >
> > Searching around I found a (maybe related) issue reported for sf (
> > https://github.com/r-spatial/sf/issues/1670), but here sf installed just
> > fine and also rgdal. GRASS also compiles well, btw, and gdal-devel and
> > proj-devel are in place.
> >
> > I tried the solution proposed in the issue
> > (`remotes::install_github("r-spatial/stars", configure.args=
> > '--with-proj-lib=/lib64')`), but it does not work either. I guess it's
> > because of this one: https://bugzilla.redhat.com/show_bug.cgi?id=1958191
> .
> > Right?
> >
> > Is there anything else I could try/test/report? I really appreciate your
> > help :)
> >
> > Best,
> > Vero
> >
> >       [[alternative HTML version deleted]]
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
>
> --
> Edzer Pebesma
> Institute for Geoinformatics
> Heisenbergstrasse 2, 48151 Muenster, Germany
> Phone: +49 251 8333081
>
>
>
>
> ------------------------------
>
> Subject: Digest Footer
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
> ------------------------------
>
> End of R-sig-Geo Digest, Vol 214, Issue 10
> ******************************************

	[[alternative HTML version deleted]]


From thebudget72 @end|ng |rom gm@||@com  Wed Jun 23 21:11:43 2021
From: thebudget72 @end|ng |rom gm@||@com (Phillips Rogfield)
Date: Wed, 23 Jun 2021 21:11:43 +0200
Subject: [R-sig-Geo] Plot NUTS regions with color
In-Reply-To: <9e5e413c-e5c3-b489-2ce6-f90341cdfffc@gmail.com>
References: <9e5e413c-e5c3-b489-2ce6-f90341cdfffc@gmail.com>
Message-ID: <6b73beae-f020-d955-31fb-cb29ad771263@gmail.com>

Dear R-SIG-Geo ML,

I have downloaded the NUTS shapefiles from here: 
https://ec.europa.eu/eurostat/web/gisco/geodata/reference-data/administrative-units-statistical-units/nuts

I can load them with the following code:

    library(rgdal)
    shp_bdir <- [PATH TO SHAPE FILE]
    layername <- "NUTS_RG_01M_2021_4326"
    shp_folder <- file.path(shp_bdir, paste0(layername,".shp"))
    EU_NUTS <- readOGR(dsn = shp_folder, layer = layername)

Then I can plot the regions with:

    plot(EU_NUTS)

Now I have a list of NUTS - 3 Level, for example:

    l <- c("AT223", "AT212", "AT212", "AT121")

I would like a plot where the NUTS regions are colored, and the more a 
particular NUTS is present is the list, the darker its color.

For example "AT212" should be darker than "AT223", because the former is 
present two times in the list.

How can I achieve that?

Thank you and best regards.


	[[alternative HTML version deleted]]


From m@p|no|@10 @end|ng |rom gm@||@com  Wed Jun 23 23:03:34 2021
From: m@p|no|@10 @end|ng |rom gm@||@com (=?UTF-8?Q?Manuel_Sp=C3=ADnola?=)
Date: Wed, 23 Jun 2021 15:03:34 -0600
Subject: [R-sig-Geo] How to avoid that st_intersection drop the empty
 polygons that do not intersect the other layer?
Message-ID: <CABkCotRvgzVD1pw78RzKoX32UuDtRUhbvE0ixVRnS-uSw3Eddg@mail.gmail.com>

Dear list members,

I am trying to calculate the road density in a grid of hexagons.

roads_hex <- st_intersection(vias, hex_cr_dm) %>%
  dplyr::mutate(len_m = sf::st_length(geom)) %>% # Find the length of each
line
  dplyr::group_by(hexagono) %>% # Here you need to insert all the columns
from your shapes
  dplyr::summarize(len_m = sum(len_m))

but the grid has 613 features and the final object has 556 because some of
the hexagons do not have roads inside.

How can I keep the 615 hexagons in the final object even those one having a
value of 0 road?


-- 
*Manuel Sp?nola, Ph.D.*
Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
Universidad Nacional
Apartado 1350-3000
Heredia
COSTA RICA
mspinola at una.cr <mspinola at una.ac.cr>
mspinola10 at gmail.com
Tel?fono: (506) 8706 - 4662
Personal website: Lobito de r?o <https://sites.google.com/site/lobitoderio/>
Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>

	[[alternative HTML version deleted]]


From m@tmo@er @end|ng |rom wu@@c@@t  Thu Jun 24 08:33:26 2021
From: m@tmo@er @end|ng |rom wu@@c@@t (Mathias Moser)
Date: Thu, 24 Jun 2021 08:33:26 +0200
Subject: [R-sig-Geo] Plot NUTS regions with color
In-Reply-To: <6b73beae-f020-d955-31fb-cb29ad771263@gmail.com>
References: <9e5e413c-e5c3-b489-2ce6-f90341cdfffc@gmail.com>
 <6b73beae-f020-d955-31fb-cb29ad771263@gmail.com>
Message-ID: <630bbfd4fa4a7ed7039913ee90b2218cf2008fc8.camel@wu.ac.at>

You need to create a frequency table from l and merge this to the shapefile.
Using sf/ggplot2 would also simplify things here:

> download.file("
> https://gisco-services.ec.europa.eu/distribution/v2/nuts/download/ref-nuts-2021-60m.geojson.zip
> ", "nuts.zip")
> unzip("nuts.zip",  exdir = tempdir())
> 
> library(dplyr)
> library(sf)
> EU_NUTS <- read_sf(paste0(tempdir(), "/NUTS_RG_60M_2021_4326_LEVL_3.geojson")
> 
> l <- c("AT223", "AT212", "AT212", "AT121")
> l_freq <- as.data.frame(table(l))
> 
> EU_NUTS <- left_join(EU_NUTS, l_freq, by = c("id" = "l"))
> 
> library(ggplot2)
> ggplot(filter(EU_NUTS, CNTR_CODE == "AT")) + geom_sf(aes(fill = Freq))

//m

On Wed, 2021-06-23 at 21:11 +0200, Phillips Rogfield wrote:
> Dear R-SIG-Geo ML,
> 
> I have downloaded the NUTS shapefiles from here: 
> https://ec.europa.eu/eurostat/web/gisco/geodata/reference-data/administrative-units-statistical-units/nuts
> 
> I can load them with the following code:
> 
> ??? library(rgdal)
> ??? shp_bdir <- [PATH TO SHAPE FILE]
> ??? layername <- "NUTS_RG_01M_2021_4326"
> ??? shp_folder <- file.path(shp_bdir, paste0(layername,".shp"))
> ??? EU_NUTS <- readOGR(dsn = shp_folder, layer = layername)
> 
> Then I can plot the regions with:
> 
> ??? plot(EU_NUTS)
> 
> Now I have a list of NUTS - 3 Level, for example:
> 
> ??? l <- c("AT223", "AT212", "AT212", "AT121")
> 
> I would like a plot where the NUTS regions are colored, and the more a 
> particular NUTS is present is the list, the darker its color.
> 
> For example "AT212" should be darker than "AT223", because the former is 
> present two times in the list.
> 
> How can I achieve that?
> 
> Thank you and best regards.
> 
> 
> ????????[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From thebudget72 @end|ng |rom gm@||@com  Sat Jun 26 03:24:50 2021
From: thebudget72 @end|ng |rom gm@||@com (Phillips Rogfield)
Date: Sat, 26 Jun 2021 03:24:50 +0200
Subject: [R-sig-Geo] Plot NUTS regions with color
In-Reply-To: <630bbfd4fa4a7ed7039913ee90b2218cf2008fc8.camel@wu.ac.at>
References: <9e5e413c-e5c3-b489-2ce6-f90341cdfffc@gmail.com>
 <6b73beae-f020-d955-31fb-cb29ad771263@gmail.com>
 <630bbfd4fa4a7ed7039913ee90b2218cf2008fc8.camel@wu.ac.at>
Message-ID: <bbf909d2-42e2-a05b-5b67-5d8576cc4105@gmail.com>

Hello Mathias,

thank you for your support.

I was able to solve it.

I fortified the Polygons and added the frequency to the dataframe.

Best regards.

On 24/06/2021 08:33, Mathias Moser wrote:
> You need to create a frequency table from l and merge this to the shapefile.
> Using sf/ggplot2 would also simplify things here:
>
>> download.file("
>> https://gisco-services.ec.europa.eu/distribution/v2/nuts/download/ref-nuts-2021-60m.geojson.zip
>> ", "nuts.zip")
>> unzip("nuts.zip",  exdir = tempdir())
>>
>> library(dplyr)
>> library(sf)
>> EU_NUTS <- read_sf(paste0(tempdir(), "/NUTS_RG_60M_2021_4326_LEVL_3.geojson")
>>
>> l <- c("AT223", "AT212", "AT212", "AT121")
>> l_freq <- as.data.frame(table(l))
>>
>> EU_NUTS <- left_join(EU_NUTS, l_freq, by = c("id" = "l"))
>>
>> library(ggplot2)
>> ggplot(filter(EU_NUTS, CNTR_CODE == "AT")) + geom_sf(aes(fill = Freq))
> //m
>
> On Wed, 2021-06-23 at 21:11 +0200, Phillips Rogfield wrote:
>> Dear R-SIG-Geo ML,
>>
>> I have downloaded the NUTS shapefiles from here:
>> https://ec.europa.eu/eurostat/web/gisco/geodata/reference-data/administrative-units-statistical-units/nuts
>>
>> I can load them with the following code:
>>
>>  ??? library(rgdal)
>>  ??? shp_bdir <- [PATH TO SHAPE FILE]
>>  ??? layername <- "NUTS_RG_01M_2021_4326"
>>  ??? shp_folder <- file.path(shp_bdir, paste0(layername,".shp"))
>>  ??? EU_NUTS <- readOGR(dsn = shp_folder, layer = layername)
>>
>> Then I can plot the regions with:
>>
>>  ??? plot(EU_NUTS)
>>
>> Now I have a list of NUTS - 3 Level, for example:
>>
>>  ??? l <- c("AT223", "AT212", "AT212", "AT121")
>>
>> I would like a plot where the NUTS regions are colored, and the more a
>> particular NUTS is present is the list, the darker its color.
>>
>> For example "AT212" should be darker than "AT223", because the former is
>> present two times in the list.
>>
>> How can I achieve that?
>>
>> Thank you and best regards.
>>
>>
>>  ????????[[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From |r@nc|@coomcborge@ @end|ng |rom gm@||@com  Mon Jun 28 20:18:01 2021
From: |r@nc|@coomcborge@ @end|ng |rom gm@||@com (Francisco Borges)
Date: Mon, 28 Jun 2021 19:18:01 +0100
Subject: [R-sig-Geo] Question concerning the SDM package in R
Message-ID: <CA+BtNgownxRVp_o47_A5p1u_2ZCjhSoK1Dv8qZemdHi2hf7_bA@mail.gmail.com>

Hello all!

I have encountered an issue with the SDM package by Babak Naimi and Miguel
Ara?jo in R. Specifically, when re-running a model which I had successfully
run a couple of months ago, I get the following error:

?Error in sdmSetting(test.percent = 30, replication = c("sub","boot",  :
methods rf and brt do not exist!?

This is the code I'm inputting:

model <-
  sdm(
    occ ~.,
    data = dalter,
    methods = c('glm','rf','brt'),
    test.p = 30,
    replication = c("sub", "boot", "cv"),
    n.folds = 4,
    n = 5
  )

This is weird. It is stating that the sdm package does not have boosted
regression tree nor random forest as an available method. I have
reinstalled the package through CRAN in R today.

Any suggestions?

Thank you in advance,

*Francisco Borges*

MARE ? Marine and Environmental Sciences Centre

Laborat?rio Mar?timo da Guia - Faculdade de Ci?ncias da Universidade de
Lisboa


Av. Nossa Senhora do Cabo, 939

2750-374 Cascais, Portugal

Tel: +351 214 869 211




publons.com/a/1504585/
orcid.org/0000-0002-3911-0421
http://www.mare-centre.pt/pt/user/8232
https://www.cienciavitae.pt//pt/B814-9E8E-F556

	[[alternative HTML version deleted]]


From n@|m|@b @end|ng |rom gm@||@com  Tue Jun 29 13:52:50 2021
From: n@|m|@b @end|ng |rom gm@||@com (Babak Naimi)
Date: Tue, 29 Jun 2021 14:52:50 +0300
Subject: [R-sig-Geo] Question concerning the SDM package in R
In-Reply-To: <mailman.28692.3.1624960801.31965.r-sig-geo@r-project.org>
References: <mailman.28692.3.1624960801.31965.r-sig-geo@r-project.org>
Message-ID: <CAGL-CGDtdU7RWEof4+=z7Men4UqUgWBf+ru7fFwnLfkYjMVf3Q@mail.gmail.com>

Hi,

It suggests you do not have the required packages for those methods on your
machine. You can first simply run the following code and then try yours:

sdm::installAll()

Hope this helps,

Best wishes,
Babak

On Tue, Jun 29, 2021 at 1:00 PM <r-sig-geo-request at r-project.org> wrote:

>
> Date: Mon, 28 Jun 2021 19:18:01 +0100
> From: Francisco Borges <franciscoomcborges at gmail.com>
> To: r-sig-geo at r-project.org
> Subject: [R-sig-Geo] Question concerning the SDM package in R
> Message-ID:
>         <
> CA+BtNgownxRVp_o47_A5p1u_2ZCjhSoK1Dv8qZemdHi2hf7_bA at mail.gmail.com>
> Content-Type: text/plain; charset="utf-8"
>
> Hello all!
>
> I have encountered an issue with the SDM package by Babak Naimi and Miguel
> Ara?jo in R. Specifically, when re-running a model which I had successfully
> run a couple of months ago, I get the following error:
>
> ?Error in sdmSetting(test.percent = 30, replication = c("sub","boot",  :
> methods rf and brt do not exist!?
>
> This is the code I'm inputting:
>
> model <-
>   sdm(
>     occ ~.,
>     data = dalter,
>     methods = c('glm','rf','brt'),
>     test.p = 30,
>     replication = c("sub", "boot", "cv"),
>     n.folds = 4,
>     n = 5
>   )
>
> This is weird. It is stating that the sdm package does not have boosted
> regression tree nor random forest as an available method. I have
> reinstalled the package through CRAN in R today.
>
> Any suggestions?
>
> Thank you in advance,
>
> *Francisco Borges*
>
> MARE ? Marine and Environmental Sciences Centre
>
> Laborat?rio Mar?timo da Guia - Faculdade de Ci?ncias da Universidade de
> Lisboa
>
>
> Av. Nossa Senhora do Cabo, 939
>
> 2750-374 Cascais, Portugal
>
> Tel: +351 214 869 211
>
>
>
>
> publons.com/a/1504585/
> orcid.org/0000-0002-3911-0421
> http://www.mare-centre.pt/pt/user/8232
> https://www.cienciavitae.pt//pt/B814-9E8E-F556
>
>         [[alternative HTML version deleted]]
>
>
>
>
> ------------------------------
>
> Subject: Digest Footer
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
> ------------------------------
>
> End of R-sig-Geo Digest, Vol 214, Issue 14
> ******************************************

	[[alternative HTML version deleted]]


From m@p|no|@10 @end|ng |rom gm@||@com  Wed Jun 30 16:52:50 2021
From: m@p|no|@10 @end|ng |rom gm@||@com (=?UTF-8?Q?Manuel_Sp=C3=ADnola?=)
Date: Wed, 30 Jun 2021 08:52:50 -0600
Subject: [R-sig-Geo] How to filter a spatial object in sf
Message-ID: <CABkCotQguhO1_1H7Ua=rON1SQrR3fxzxFJ-oE9sURK=O8-4CHQ@mail.gmail.com>

I would like to retain the information stored in a larger spatial object
for a subset of features from a smaller spatial object.  I tried a
st_filter but I cannot achieve my goal.

nc = st_read(system.file("shape/nc.shp", package="sf"))

nc_smaller <- nc %>% filter(CNTY_ID %in% c(1825, 1827, 1828))

nc_filter <- st_filter(nc, nc_smaller)

The nc_smaller has 3 features, but the nc_filter ended with 8 features.  I
was expecting to have on 3 features in the nc_filter.



Manuel





-- 
*Manuel Sp?nola, Ph.D.*
Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
Universidad Nacional
Apartado 1350-3000
Heredia
COSTA RICA
mspinola at una.cr <mspinola at una.ac.cr>
mspinola10 at gmail.com
Tel?fono: (506) 8706 - 4662
Personal website: Lobito de r?o <https://sites.google.com/site/lobitoderio/>
Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>

	[[alternative HTML version deleted]]


From g@vg712 @end|ng |rom gm@||@com  Wed Jun 30 17:05:22 2021
From: g@vg712 @end|ng |rom gm@||@com (Gabriel Gaona)
Date: Wed, 30 Jun 2021 10:05:22 -0500
Subject: [R-sig-Geo] How to filter a spatial object in sf
In-Reply-To: <CABkCotQguhO1_1H7Ua=rON1SQrR3fxzxFJ-oE9sURK=O8-4CHQ@mail.gmail.com>
References: <CABkCotQguhO1_1H7Ua=rON1SQrR3fxzxFJ-oE9sURK=O8-4CHQ@mail.gmail.com>
Message-ID: <CAD-tSQ_zu-sUsTyWPtKhrYL+DExwPj4HcYESK2RrDYdmKN96_A@mail.gmail.com>

Dear Manuel,

The spatial filtering operation depends on the type of spatial predicate.
By default it uses st_intersects, which implies that all entities that
share boundaries around the nc_smaller object will also be filtered. By
changing the predicate you can get different results. For example try with
.predicate = st_cover

Best regards
_________________________
Gabriel Gaona
Twitter/Hangouts/telegram: gavg712
https://www.researchgate.net/profile/Gabriel_Gaona

El mi?, 30 jun 2021 a las 9:53, Manuel Sp?nola (<mspinola10 at gmail.com>)
escribi?:

> I would like to retain the information stored in a larger spatial object
> for a subset of features from a smaller spatial object.  I tried a
> st_filter but I cannot achieve my goal.
>
> nc = st_read(system.file("shape/nc.shp", package="sf"))
>
> nc_smaller <- nc %>% filter(CNTY_ID %in% c(1825, 1827, 1828))
>
> nc_filter <- st_filter(nc, nc_smaller)
>
> The nc_smaller has 3 features, but the nc_filter ended with 8 features.  I
> was expecting to have on 3 features in the nc_filter.
>
>
>
> Manuel
>
>
>
>
>
> --
> *Manuel Sp?nola, Ph.D.*
> Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
> Universidad Nacional
> Apartado 1350-3000
> Heredia
> COSTA RICA
> mspinola at una.cr <mspinola at una.ac.cr>
> mspinola10 at gmail.com
> Tel?fono: (506) 8706 - 4662
> Personal website: Lobito de r?o <
> https://sites.google.com/site/lobitoderio/>
> Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From m|807 @end|ng |rom c@m@@c@uk  Wed Jun 30 17:08:15 2021
From: m|807 @end|ng |rom c@m@@c@uk (Matt Lewis)
Date: Wed, 30 Jun 2021 17:08:15 +0200
Subject: [R-sig-Geo] How to filter a spatial object in sf
In-Reply-To: <CABkCotQguhO1_1H7Ua=rON1SQrR3fxzxFJ-oE9sURK=O8-4CHQ@mail.gmail.com>
References: <CABkCotQguhO1_1H7Ua=rON1SQrR3fxzxFJ-oE9sURK=O8-4CHQ@mail.gmail.com>
Message-ID: <869bfa61915455a8b49776bae29bf2c4@cam.ac.uk>

Dear Manuel,

st_filter by default takes .predicate = st_intersects. The 3 polygons 
you filter to are adjacent to five others, so st_filter returns the 3 
you want and the 5 others which touch too. To avoid this behaviour you 
can specify the .predicate argument to another option like st_within as 
in:

nc_filter <- st_filter(nc, nc_smaller, .predicate = st_within)

Hope this helps.

All the best,

Matt

On 2021-06-30 16:52, Manuel Sp?nola wrote:

> I would like to retain the information stored in a larger spatial 
> object
> for a subset of features from a smaller spatial object.  I tried a
> st_filter but I cannot achieve my goal.
> 
> nc = st_read(system.file("shape/nc.shp", package="sf"))
> 
> nc_smaller <- nc %>% filter(CNTY_ID %in% c(1825, 1827, 1828))
> 
> nc_filter <- st_filter(nc, nc_smaller)
> 
> The nc_smaller has 3 features, but the nc_filter ended with 8 features. 
>  I
> was expecting to have on 3 features in the nc_filter.
> 
> Manuel
> 
> --
> *Manuel Sp?nola, Ph.D.*
> Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
> Universidad Nacional
> Apartado 1350-3000
> Heredia
> COSTA RICA
> mspinola at una.cr <mspinola at una.ac.cr>
> mspinola10 at gmail.com
> Tel?fono: (506) 8706 - 4662
> Personal website: Lobito de r?o 
> <https://sites.google.com/site/lobitoderio/>
> Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>
> 
> [[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
	[[alternative HTML version deleted]]


From m@p|no|@10 @end|ng |rom gm@||@com  Wed Jun 30 18:59:36 2021
From: m@p|no|@10 @end|ng |rom gm@||@com (=?UTF-8?Q?Manuel_Sp=C3=ADnola?=)
Date: Wed, 30 Jun 2021 10:59:36 -0600
Subject: [R-sig-Geo] How to filter a spatial object in sf
In-Reply-To: <869bfa61915455a8b49776bae29bf2c4@cam.ac.uk>
References: <CABkCotQguhO1_1H7Ua=rON1SQrR3fxzxFJ-oE9sURK=O8-4CHQ@mail.gmail.com>
 <869bfa61915455a8b49776bae29bf2c4@cam.ac.uk>
Message-ID: <CABkCotScAYcxBcwPULjCMrCK1Q2kC0viyiVFBx1ukAT1jYHsPw@mail.gmail.com>

Thank you very much Matt.

Manuel

El mi?, 30 jun 2021 a las 9:08, Matt Lewis (<ml807 at cam.ac.uk>) escribi?:

> Dear Manuel,
>
> st_filter by default takes .predicate = st_intersects. The 3 polygons you
> filter to are adjacent to five others, so st_filter returns the 3 you want
> and the 5 others which touch too. To avoid this behaviour you can specify
> the .predicate argument to another option like st_within as in:
>
> nc_filter <- st_filter(nc, nc_smaller, .predicate = st_within)
>
> Hope this helps.
>
> All the best,
>
> Matt
>
> On 2021-06-30 16:52, Manuel Sp?nola wrote:
>
> I would like to retain the information stored in a larger spatial object
> for a subset of features from a smaller spatial object.  I tried a
> st_filter but I cannot achieve my goal.
>
> nc = st_read(system.file("shape/nc.shp", package="sf"))
>
> nc_smaller <- nc %>% filter(CNTY_ID %in% c(1825, 1827, 1828))
>
> nc_filter <- st_filter(nc, nc_smaller)
>
> The nc_smaller has 3 features, but the nc_filter ended with 8 features.  I
> was expecting to have on 3 features in the nc_filter.
>
>
>
> Manuel
>
>
>
>
>
> --
> *Manuel Sp?nola, Ph.D.*
> Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
> Universidad Nacional
> Apartado 1350-3000
> Heredia
> COSTA RICA
> mspinola at una.cr <mspinola at una.ac.cr>
> mspinola10 at gmail.com
> Tel?fono: (506) 8706 - 4662
> Personal website: Lobito de r?o <
> https://sites.google.com/site/lobitoderio/>
> Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>
>
>     [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
>


-- 
*Manuel Sp?nola, Ph.D.*
Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
Universidad Nacional
Apartado 1350-3000
Heredia
COSTA RICA
mspinola at una.cr <mspinola at una.ac.cr>
mspinola10 at gmail.com
Tel?fono: (506) 8706 - 4662
Personal website: Lobito de r?o <https://sites.google.com/site/lobitoderio/>
Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>

	[[alternative HTML version deleted]]


