From t@v|b@r @end|ng |rom gm@||@com  Sat Oct  3 12:29:08 2020
From: t@v|b@r @end|ng |rom gm@||@com (Micha Silver)
Date: Sat, 3 Oct 2020 13:29:08 +0300
Subject: [R-sig-Geo] Count of Non-NA pixels in stars object
Message-ID: <9fb9fcfe-9cef-0bb3-48a2-2f613825f5f1@gmail.com>

An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20201003/3a263faf/attachment.html>

From v|j@y|u||@ @end|ng |rom gm@||@com  Sat Oct  3 15:32:44 2020
From: v|j@y|u||@ @end|ng |rom gm@||@com (Vijay Lulla)
Date: Sat, 3 Oct 2020 09:32:44 -0400
Subject: [R-sig-Geo] Count of Non-NA pixels in stars object
In-Reply-To: <9fb9fcfe-9cef-0bb3-48a2-2f613825f5f1@gmail.com>
References: <9fb9fcfe-9cef-0bb3-48a2-2f613825f5f1@gmail.com>
Message-ID: <CAKkiGbui-KBoBqti0k31U3gt89QM018YEXDaXjJHLGym9zg_cw@mail.gmail.com>

Micha,
I am not sure why the function works individually but not on the stars
object. IMO, a much simpler function, at least for st_apply, of what you
are trying to do might be:

cnt_pixels1 <- function(s) { sum(!is.na(s)) }
st_apply(m_stars, MARGIN="DOY", FUN=cnt_pixels1)$cnt_pixels1

And if you wish to call this individually you will have to do
cnt_pixels1(as.array(m_stars[,,,1]$Value)) .

HTH,
Vijay.

On Sat, Oct 3, 2020 at 6:29 AM Micha Silver <tsvibar at gmail.com> wrote:

> Hello:
> I'm trying to get the number of pixels with non-NA values in the 'Value'
> attrib. of a stars object.
>
> My first try was to read a list of geotiff files into raster objects, then
> use this function to get the number of pixels:
> c = raster::extract(r, site,fun=function(x, ...) length(na.omit(x)))
> This worked OK within sapply(), but was rather slow.
>
> Instead I read the files into a stars object and I'm trying to switch to
> st_apply() to gain efficiency. Here's what I've tried (my reprex):
>
>
> library(stars)
>
> # An example stars structure
> m_stars = structure(list(Value = structure(c(NA, 13458, 13315, 13381, NA,
>                                              13483, 13400, 13251, 13251,
> 13282, NA, NA, 13663, 13663, 13174,
>                                              NA, 13783, 13754, NA, NA,
> 13664, 13643, 13800, 13800, 13797,
>                                              NA, NA, 13796, 13796, NA, NA,
> 13515, 13574, 13539, NA, 13383,
>                                              13407, 13407, 13407, 13541,
> NA, NA, 13399, 13399, 13399, NA,
>                                              NA, NA, NA, NA, 12402, NA,
> NA, NA, NA, NA, NA, NA, NA, NA, NA,
>                                              13761, 13662, 13662, NA,
> 13651, 13627, 13627, 13627, 13647, NA,
>                                              NA, 13607, 13607, NA), .Dim =
> c(x = 5L, y = 3L, DOY = 5L))), dimensions = structure(list(
>                                                x = structure(list(from =
> 1L, to = 5L, offset = -3.8610742258177,
> delta = 0.01151941823202, refsys = structure(list(input = "GEOGCS[\"WGS
> 84\",DATUM[\"WGS_1984\",SPHEROID[\"WGS
> 84\",6378137,298.257223563,AUTHORITY[\"EPSG\",\"7030\"]],AUTHORITY[\"EPSG\",\"6326\"]],PRIMEM[\"Greenwich\",0],UNIT[\"degree\",0.0174532925199433],AUTHORITY[\"EPSG\",\"4326\"]]",
>
> wkt = "GEOGCS[\"WGS 84\",\n    DATUM[\"WGS_1984\",\n SPHEROID[\"WGS
> 84\",6378137,298.257223563,\n AUTHORITY[\"EPSG\",\"7030\"]],\n
> AUTHORITY[\"EPSG\",\"6326\"]],\n PRIMEM[\"Greenwich\",0],\n
> UNIT[\"degree\",0.0174532925199433],\n AUTHORITY[\"EPSG\",\"4326\"]]"),
> class = "crs"),
> point = FALSE, values = NULL), class = "dimension"),
>                                                y = structure(list(from =
> 1L, to = 3L, offset = 57.118130712839,
> delta = -0.0141360917583313, refsys = structure(list(
> input = "GEOGCS[\"WGS 84\",DATUM[\"WGS_1984\",SPHEROID[\"WGS
> 84\",6378137,298.257223563,AUTHORITY[\"EPSG\",\"7030\"]],AUTHORITY[\"EPSG\",\"6326\"]],PRIMEM[\"Greenwich\",0],UNIT[\"degree\",0.0174532925199433],AUTHORITY[\"EPSG\",\"4326\"]]",
>
> wkt = "GEOGCS[\"WGS 84\",\n    DATUM[\"WGS_1984\",\n SPHEROID[\"WGS
> 84\",6378137,298.257223563,\n AUTHORITY[\"EPSG\",\"7030\"]],\n
> AUTHORITY[\"EPSG\",\"6326\"]],\n PRIMEM[\"Greenwich\",0],\n
> UNIT[\"degree\",0.0174532925199433],\n AUTHORITY[\"EPSG\",\"4326\"]]"),
> class = "crs"),
> point = FALSE, values = NULL), class = "dimension"),
>                                                DOY = structure(list(from =
> 1L, to = 5L, offset = NA_real_,
> delta = NA_real_, refsys = NA_character_, point = NA,
> values = c("DOY_2002_001", "DOY_2002_009", "DOY_2002_017",
> "DOY_2002_025", "DOY_2002_033")), class = "dimension")), raster =
> structure(list(
> affine = c(0, 0), dimensions = c("x", "y"), curvilinear = FALSE), class =
> "stars_raster"), class = "dimensions"), class = "stars")
>
> # My count function
> cnt_pixels = function(s, na.rm = TRUE, ...) {
> # Count number of non NA values in $Value attrib
>   sdf = as.data.frame(s)
>   if (na.rm) {
>     sdf = sdf[complete.cases(sdf),]
>   }
>   return(length(sdf$Value))
> }
>
> # Using st_apply
> cnt = st_apply(m_stars,
>                MARGIN = "DOY",
>                FUN = cnt_pixels,
>                na.rm = TRUE)$cnt_pixels
>
> # The function alone seems to work...
> (cnt_pixels(m_stars[,,,1]))
> (cnt_pixels(m_stars[,,,4]))
>
> # But run thru st_apply...
> (cnt) # shows all zeros, ??
>
> Why am I getting all zeros in the resulting "cnt" list?
> Am I going about this the right way? Is there some built in method that I
> missed?
>
>
> Thanks, Micha
>
> --
> Micha Silver
> Ben Gurion Univ.
> Sde Boker, Remote Sensing Lab
> cell: +972-523-665918https://orcid.org/0000-0002-1128-1325
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


-- 
Vijay Lulla, PhD
ORCID | <https://orcid.org/0000-0002-0823-2522> Homepage
<http://vlulla.github.io> | Google Scholar
<https://scholar.google.com/citations?user=VjhJWOgAAAAJ&hl=en> | Github
<https://github.com/vlulla>

	[[alternative HTML version deleted]]


From t@v|b@r @end|ng |rom gm@||@com  Sat Oct  3 17:46:01 2020
From: t@v|b@r @end|ng |rom gm@||@com (Micha Silver)
Date: Sat, 3 Oct 2020 18:46:01 +0300
Subject: [R-sig-Geo] Count of Non-NA pixels in stars object
In-Reply-To: <CAKkiGbui-KBoBqti0k31U3gt89QM018YEXDaXjJHLGym9zg_cw@mail.gmail.com>
References: <9fb9fcfe-9cef-0bb3-48a2-2f613825f5f1@gmail.com>
 <CAKkiGbui-KBoBqti0k31U3gt89QM018YEXDaXjJHLGym9zg_cw@mail.gmail.com>
Message-ID: <734f0cbe-287f-26ca-e0b0-99a93fb2b664@gmail.com>


On 03/10/2020 16:32, Vijay Lulla wrote:
> Micha,
> I am not sure why the function works individually but not on the stars 
> object. IMO, a much simpler function, at least for st_apply, of what 
> you are trying to do might be:
>
> cnt_pixels1 <- function(s) { sum(!is.na <http://is.na>(s)) }
> st_apply(m_stars, MARGIN="DOY", FUN=cnt_pixels1)$cnt_pixels1


Excellent, thanks!



>
> And if you wish to call this individually you will have to do 
> cnt_pixels1(as.array(m_stars[,,,1]$Value)) .
>
> HTH,
> Vijay.
>
> On Sat, Oct 3, 2020 at 6:29 AM Micha Silver <tsvibar at gmail.com 
> <mailto:tsvibar at gmail.com>> wrote:
>
>     Hello:
>     I'm trying to get the number of pixels with non-NA values in the
>     'Value' attrib. of a stars object.
>
>     My first try was to read a list of geotiff files into raster
>     objects, then use this function to get the number of pixels:
>     c = raster::extract(r, site,fun=function(x, ...) length(na.omit(x)))
>     This worked OK within sapply(), but was rather slow.
>
>     Instead I read the files into a stars object and I'm trying to
>     switch to st_apply() to gain efficiency. Here's what I've tried
>     (my reprex):
>
>
>     library(stars)
>
>     # An example stars structure
>     m_stars = structure(list(Value = structure(c(NA, 13458, 13315,
>     13381, NA,
>     ???????????????????????????????????????????? 13483, 13400, 13251,
>     13251, 13282, NA, NA, 13663, 13663, 13174,
>     ???????????????????????????????????????????? NA, 13783, 13754, NA,
>     NA, 13664, 13643, 13800, 13800, 13797,
>     ???????????????????????????????????????????? NA, NA, 13796, 13796,
>     NA, NA, 13515, 13574, 13539, NA, 13383,
>     ???????????????????????????????????????????? 13407, 13407, 13407,
>     13541, NA, NA, 13399, 13399, 13399, NA,
>     ???????????????????????????????????????????? NA, NA, NA, NA,
>     12402, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,
>     ???????????????????????????????????????????? 13761, 13662, 13662,
>     NA, 13651, 13627, 13627, 13627, 13647, NA,
>     ???????????????????????????????????????????? NA, 13607, 13607,
>     NA), .Dim = c(x = 5L, y = 3L, DOY = 5L))), dimensions =
>     structure(list(
>     ?????????????????????????????????????????????? x =
>     structure(list(from = 1L, to = 5L, offset = -3.8610742258177,
>     delta = 0.01151941823202, refsys = structure(list(input =
>     "GEOGCS[\"WGS 84\",DATUM[\"WGS_1984\",SPHEROID[\"WGS
>     84\",6378137,298.257223563,AUTHORITY[\"EPSG\",\"7030\"]],AUTHORITY[\"EPSG\",\"6326\"]],PRIMEM[\"Greenwich\",0],UNIT[\"degree\",0.0174532925199433],AUTHORITY[\"EPSG\",\"4326\"]]",
>
>     wkt = "GEOGCS[\"WGS 84\",\n??? DATUM[\"WGS_1984\",\n
>     SPHEROID[\"WGS 84\",6378137,298.257223563,\n
>     AUTHORITY[\"EPSG\",\"7030\"]],\n AUTHORITY[\"EPSG\",\"6326\"]],\n
>     PRIMEM[\"Greenwich\",0],\n UNIT[\"degree\",0.0174532925199433],\n
>     AUTHORITY[\"EPSG\",\"4326\"]]"), class = "crs"),
>     point = FALSE, values = NULL), class = "dimension"),
>     ?????????????????????????????????????????????? y =
>     structure(list(from = 1L, to = 3L, offset = 57.118130712839,
>     delta = -0.0141360917583313, refsys = structure(list(
>     input = "GEOGCS[\"WGS 84\",DATUM[\"WGS_1984\",SPHEROID[\"WGS
>     84\",6378137,298.257223563,AUTHORITY[\"EPSG\",\"7030\"]],AUTHORITY[\"EPSG\",\"6326\"]],PRIMEM[\"Greenwich\",0],UNIT[\"degree\",0.0174532925199433],AUTHORITY[\"EPSG\",\"4326\"]]",
>
>     wkt = "GEOGCS[\"WGS 84\",\n??? DATUM[\"WGS_1984\",\n
>     SPHEROID[\"WGS 84\",6378137,298.257223563,\n
>     AUTHORITY[\"EPSG\",\"7030\"]],\n AUTHORITY[\"EPSG\",\"6326\"]],\n
>     PRIMEM[\"Greenwich\",0],\n UNIT[\"degree\",0.0174532925199433],\n
>     AUTHORITY[\"EPSG\",\"4326\"]]"), class = "crs"),
>     point = FALSE, values = NULL), class = "dimension"),
>     ?????????????????????????????????????????????? DOY =
>     structure(list(from = 1L, to = 5L, offset = NA_real_,
>     delta = NA_real_, refsys = NA_character_, point = NA,
>     values = c("DOY_2002_001", "DOY_2002_009", "DOY_2002_017",
>     "DOY_2002_025", "DOY_2002_033")), class = "dimension")), raster =
>     structure(list(
>     affine = c(0, 0), dimensions = c("x", "y"), curvilinear = FALSE),
>     class = "stars_raster"), class = "dimensions"), class = "stars")
>
>     # My count function
>     cnt_pixels = function(s, na.rm = TRUE, ...) {
>     # Count number of non NA values in $Value attrib
>     ? sdf = as.data.frame(s)
>     ? if (na.rm) {
>     ??? sdf = sdf[complete.cases(sdf),]
>     ? }
>     ? return(length(sdf$Value))
>     }
>
>     # Using st_apply
>     cnt = st_apply(m_stars,
>     ?????????????? MARGIN = "DOY",
>     ?????????????? FUN = cnt_pixels,
>     ?????????????? na.rm = TRUE)$cnt_pixels
>
>     # The function alone seems to work...
>     (cnt_pixels(m_stars[,,,1]))
>     (cnt_pixels(m_stars[,,,4]))
>
>     # But run thru st_apply...
>     (cnt) # shows all zeros, ??
>
>     Why am I getting all zeros in the resulting "cnt" list?
>     Am I going about this the right way? Is there some built in method
>     that I missed?
>
>
>     Thanks, Micha
>
>     -- 
>     Micha Silver
>     Ben Gurion Univ.
>     Sde Boker, Remote Sensing Lab
>     cell: +972-523-665918
>     https://orcid.org/0000-0002-1128-1325
>
>     _______________________________________________
>     R-sig-Geo mailing list
>     R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
>     https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
>
> -- 
> Vijay Lulla, PhD
> ORCID | <https://orcid.org/0000-0002-0823-2522> Homepage 
> <http://vlulla.github.io> | Google Scholar 
> <https://scholar.google.com/citations?user=VjhJWOgAAAAJ&hl=en> | 
> Github <https://github.com/vlulla>
>
-- 
Micha Silver
Ben Gurion Univ.
Sde Boker, Remote Sensing Lab
cell: +972-523-665918
https://orcid.org/0000-0002-1128-1325


From pur@n|k@@m|th@ @end|ng |rom gm@||@com  Sun Oct  4 16:42:01 2020
From: pur@n|k@@m|th@ @end|ng |rom gm@||@com (Amitha Puranik)
Date: Sun, 4 Oct 2020 20:12:01 +0530
Subject: [R-sig-Geo] Spatial data when the missing mechanism is MNAR
 (non-ignorable)
Message-ID: <CANcbSEiNw94YJim4BPR0RE5NjZc6exT+tQma2M7OX0=3YxGxKg@mail.gmail.com>

Is it possible to impute missing values in spatial data when the
missingness is *MNAR (non-ignorable)*? Can pattern mixture model or
selection model be modified to incorporate autocorrelation property and
used in this context?
Any suggestion/opinion is appreciated.

Thanks in advance,
Amitha Puranik

	[[alternative HTML version deleted]]


From Roger@B|v@nd @end|ng |rom nhh@no  Mon Oct  5 10:18:35 2020
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Mon, 5 Oct 2020 10:18:35 +0200
Subject: [R-sig-Geo] Spatial data when the missing mechanism is MNAR
 (non-ignorable)
In-Reply-To: <CANcbSEiNw94YJim4BPR0RE5NjZc6exT+tQma2M7OX0=3YxGxKg@mail.gmail.com>
References: <CANcbSEiNw94YJim4BPR0RE5NjZc6exT+tQma2M7OX0=3YxGxKg@mail.gmail.com>
Message-ID: <alpine.LFD.2.23.451.2010050949220.70746@reclus.nhh.no>

On Sun, 4 Oct 2020, Amitha Puranik wrote:

> Is it possible to impute missing values in spatial data when the
> missingness is *MNAR (non-ignorable)*? Can pattern mixture model or
> selection model be modified to incorporate autocorrelation property and
> used in this context?
> Any suggestion/opinion is appreciated.

MNAR possibly means "missing not at random". I see 
https://doi.org/10.1186/1476-072X-14-1 for point support data using INLA. 
For lattice data, see perhaps https://doi.org/10.1007/s10109-019-00316-z 
and work by Thomas Suesse https://doi.org/10.1016/j.csda.2017.11.004 
https://doi.org/10.1080/00949655.2017.1286495. This might be relevant: 
https://doi.org/10.1016/j.epsr.2020.106640, but be extremely careful of 
imputation in training/test settings with spatial data, as the spatial (or 
temporal or both) lead to information leaking between the training and 
test data because they are no longer independent.

Hope this helps,

Roger

>
> Thanks in advance,
> Amitha Puranik
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en


From pur@n|k@@m|th@ @end|ng |rom gm@||@com  Mon Oct  5 10:43:04 2020
From: pur@n|k@@m|th@ @end|ng |rom gm@||@com (Amitha Puranik)
Date: Mon, 5 Oct 2020 14:13:04 +0530
Subject: [R-sig-Geo] Spatial data when the missing mechanism is MNAR
 (non-ignorable)
In-Reply-To: <alpine.LFD.2.23.451.2010050949220.70746@reclus.nhh.no>
References: <CANcbSEiNw94YJim4BPR0RE5NjZc6exT+tQma2M7OX0=3YxGxKg@mail.gmail.com>
 <alpine.LFD.2.23.451.2010050949220.70746@reclus.nhh.no>
Message-ID: <CANcbSEgpT5f4EeAaeLH5dernYt9r4tM=hoTArfv-WjDhKyzwmg@mail.gmail.com>

Dear Roger,

Thank you for the quick response. I shall refer to the articles that
you recommended.
Thanks again!

Regards,
Amitha Puranik.

On Mon, Oct 5, 2020 at 1:48 PM Roger Bivand <Roger.Bivand at nhh.no> wrote:

> On Sun, 4 Oct 2020, Amitha Puranik wrote:
>
> > Is it possible to impute missing values in spatial data when the
> > missingness is *MNAR (non-ignorable)*? Can pattern mixture model or
> > selection model be modified to incorporate autocorrelation property and
> > used in this context?
> > Any suggestion/opinion is appreciated.
>
> MNAR possibly means "missing not at random". I see
> https://doi.org/10.1186/1476-072X-14-1 for point support data using INLA.
> For lattice data, see perhaps https://doi.org/10.1007/s10109-019-00316-z
> and work by Thomas Suesse https://doi.org/10.1016/j.csda.2017.11.004
> https://doi.org/10.1080/00949655.2017.1286495. This might be relevant:
> https://doi.org/10.1016/j.epsr.2020.106640, but be extremely careful of
> imputation in training/test settings with spatial data, as the spatial (or
> temporal or both) lead to information leaking between the training and
> test data because they are no longer independent.
>
> Hope this helps,
>
> Roger
>
> >
> > Thanks in advance,
> > Amitha Puranik
> >
> >       [[alternative HTML version deleted]]
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
>
> --
> Roger Bivand
> Department of Economics, Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
> https://orcid.org/0000-0003-2392-6140
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>

	[[alternative HTML version deleted]]


From pur@n|k@@m|th@ @end|ng |rom gm@||@com  Tue Oct  6 14:41:08 2020
From: pur@n|k@@m|th@ @end|ng |rom gm@||@com (Amitha Puranik)
Date: Tue, 6 Oct 2020 18:11:08 +0530
Subject: [R-sig-Geo] Spatial data when the missing mechanism is MNAR
 (non-ignorable)
In-Reply-To: <CANcbSEgpT5f4EeAaeLH5dernYt9r4tM=hoTArfv-WjDhKyzwmg@mail.gmail.com>
References: <CANcbSEiNw94YJim4BPR0RE5NjZc6exT+tQma2M7OX0=3YxGxKg@mail.gmail.com>
 <alpine.LFD.2.23.451.2010050949220.70746@reclus.nhh.no>
 <CANcbSEgpT5f4EeAaeLH5dernYt9r4tM=hoTArfv-WjDhKyzwmg@mail.gmail.com>
Message-ID: <CANcbSEg80=H0YSoKS9nY7BvzDUYWi7cep=JUom_q09T58K=CoQ@mail.gmail.com>

Dear Prof Roger,



This is in continuation to my previous query on spatial data imputation
with MNAR mechanism. I have gone through the references recommended by you
and have the following concerns which I request you to address.

1. The papers by Thomas Suesse, Takafumi Kato suggest likelihood based
approaches for predicting missing data in simultaneous autoregressive
models with an assumption of *missing at random* mechanism.

2. The additional reference provided by you, i.e. 'Missing Data in Wind
Farm Time Series: Properties and Effect on Forecasts' by Tawn et al.,
assume *missing not at random* mechanism in an autoregressive framework and
have applied mean imputation and multiple imputation methods.



I am presently looking for a technique to deal with MNAR in spatially
autocorrelated data. Would it be reasonable to apply the methods
recommended by Suesse or Kato in this scenario by ignoring the missing
mechanism?

>From what I understand, using conventional methods that are effective for
MAR case would produce biased estimates when data is MNAR. Can the approach
applied by Tawn et al. (i.e. mean imputation or multiple imputation) be
used on spatial data with MNAR mechanism?



Any comment/ suggestion will be appreciated.


Thanks in advance,

Amitha Puranik.












On Mon, Oct 5, 2020 at 2:13 PM Amitha Puranik <puranik.amitha at gmail.com>
wrote:

> Dear Roger,
>
> Thank you for the quick response. I shall refer to the articles that you recommended.
> Thanks again!
>
> Regards,
> Amitha Puranik.
>
> On Mon, Oct 5, 2020 at 1:48 PM Roger Bivand <Roger.Bivand at nhh.no> wrote:
>
>> On Sun, 4 Oct 2020, Amitha Puranik wrote:
>>
>> > Is it possible to impute missing values in spatial data when the
>> > missingness is *MNAR (non-ignorable)*? Can pattern mixture model or
>> > selection model be modified to incorporate autocorrelation property and
>> > used in this context?
>> > Any suggestion/opinion is appreciated.
>>
>> MNAR possibly means "missing not at random". I see
>> https://doi.org/10.1186/1476-072X-14-1 for point support data using
>> INLA.
>> For lattice data, see perhaps https://doi.org/10.1007/s10109-019-00316-z
>> and work by Thomas Suesse https://doi.org/10.1016/j.csda.2017.11.004
>> https://doi.org/10.1080/00949655.2017.1286495. This might be relevant:
>> https://doi.org/10.1016/j.epsr.2020.106640, but be extremely careful of
>> imputation in training/test settings with spatial data, as the spatial
>> (or
>> temporal or both) lead to information leaking between the training and
>> test data because they are no longer independent.
>>
>> Hope this helps,
>>
>> Roger
>>
>> >
>> > Thanks in advance,
>> > Amitha Puranik
>> >
>> >       [[alternative HTML version deleted]]
>> >
>> > _______________________________________________
>> > R-sig-Geo mailing list
>> > R-sig-Geo at r-project.org
>> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> >
>>
>> --
>> Roger Bivand
>> Department of Economics, Norwegian School of Economics,
>> Helleveien 30, N-5045 Bergen, Norway.
>> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
>> https://orcid.org/0000-0003-2392-6140
>> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>>
>

	[[alternative HTML version deleted]]


From Roger@B|v@nd @end|ng |rom nhh@no  Tue Oct  6 15:23:34 2020
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Tue, 6 Oct 2020 15:23:34 +0200
Subject: [R-sig-Geo] Spatial data when the missing mechanism is MNAR
 (non-ignorable)
In-Reply-To: <CANcbSEg80=H0YSoKS9nY7BvzDUYWi7cep=JUom_q09T58K=CoQ@mail.gmail.com>
References: <CANcbSEiNw94YJim4BPR0RE5NjZc6exT+tQma2M7OX0=3YxGxKg@mail.gmail.com>
 <alpine.LFD.2.23.451.2010050949220.70746@reclus.nhh.no>
 <CANcbSEgpT5f4EeAaeLH5dernYt9r4tM=hoTArfv-WjDhKyzwmg@mail.gmail.com>
 <CANcbSEg80=H0YSoKS9nY7BvzDUYWi7cep=JUom_q09T58K=CoQ@mail.gmail.com>
Message-ID: <alpine.LFD.2.23.451.2010061520450.92705@reclus.nhh.no>

On Tue, 6 Oct 2020, Amitha Puranik wrote:

> Dear Prof Roger,
>
> This is in continuation to my previous query on spatial data imputation
> with MNAR mechanism. I have gone through the references recommended by you
> and have the following concerns which I request you to address.
>
> 1. The papers by Thomas Suesse, Takafumi Kato suggest likelihood based
> approaches for predicting missing data in simultaneous autoregressive
> models with an assumption of *missing at random* mechanism.
>
> 2. The additional reference provided by you, i.e. 'Missing Data in Wind
> Farm Time Series: Properties and Effect on Forecasts' by Tawn et al.,
> assume *missing not at random* mechanism in an autoregressive framework and
> have applied mean imputation and multiple imputation methods.
>
>
>
> I am presently looking for a technique to deal with MNAR in spatially
> autocorrelated data. Would it be reasonable to apply the methods
> recommended by Suesse or Kato in this scenario by ignoring the missing
> mechanism?
>
> From what I understand, using conventional methods that are effective for
> MAR case would produce biased estimates when data is MNAR. Can the approach
> applied by Tawn et al. (i.e. mean imputation or multiple imputation) be
> used on spatial data with MNAR mechanism?
>

Since probably nobody knows, you may very well need to run simulations in 
the settings you need to determine which outcomes correspond to reasonable 
practice. Reviewers of you work would probably appreciate your having 
explored the robustness of your choice of method. Quite a lot will depend 
on the spatial support of your data too.

Roger

>
>
> Any comment/ suggestion will be appreciated.
>
>
> Thanks in advance,
>
> Amitha Puranik.
>
>
>
>
>
>
>
>
>
>
>
>
> On Mon, Oct 5, 2020 at 2:13 PM Amitha Puranik <puranik.amitha at gmail.com>
> wrote:
>
>> Dear Roger,
>>
>> Thank you for the quick response. I shall refer to the articles that you recommended.
>> Thanks again!
>>
>> Regards,
>> Amitha Puranik.
>>
>> On Mon, Oct 5, 2020 at 1:48 PM Roger Bivand <Roger.Bivand at nhh.no> wrote:
>>
>>> On Sun, 4 Oct 2020, Amitha Puranik wrote:
>>>
>>>> Is it possible to impute missing values in spatial data when the
>>>> missingness is *MNAR (non-ignorable)*? Can pattern mixture model or
>>>> selection model be modified to incorporate autocorrelation property and
>>>> used in this context?
>>>> Any suggestion/opinion is appreciated.
>>>
>>> MNAR possibly means "missing not at random". I see
>>> https://doi.org/10.1186/1476-072X-14-1 for point support data using
>>> INLA.
>>> For lattice data, see perhaps https://doi.org/10.1007/s10109-019-00316-z
>>> and work by Thomas Suesse https://doi.org/10.1016/j.csda.2017.11.004
>>> https://doi.org/10.1080/00949655.2017.1286495. This might be relevant:
>>> https://doi.org/10.1016/j.epsr.2020.106640, but be extremely careful of
>>> imputation in training/test settings with spatial data, as the spatial
>>> (or
>>> temporal or both) lead to information leaking between the training and
>>> test data because they are no longer independent.
>>>
>>> Hope this helps,
>>>
>>> Roger
>>>
>>>>
>>>> Thanks in advance,
>>>> Amitha Puranik
>>>>
>>>>       [[alternative HTML version deleted]]
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at r-project.org
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>
>>> --
>>> Roger Bivand
>>> Department of Economics, Norwegian School of Economics,
>>> Helleveien 30, N-5045 Bergen, Norway.
>>> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
>>> https://orcid.org/0000-0003-2392-6140
>>> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>>>
>>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en


From pur@n|k@@m|th@ @end|ng |rom gm@||@com  Tue Oct  6 17:14:01 2020
From: pur@n|k@@m|th@ @end|ng |rom gm@||@com (Amitha Puranik)
Date: Tue, 6 Oct 2020 20:44:01 +0530
Subject: [R-sig-Geo] Spatial data when the missing mechanism is MNAR
 (non-ignorable)
In-Reply-To: <alpine.LFD.2.23.451.2010061520450.92705@reclus.nhh.no>
References: <CANcbSEiNw94YJim4BPR0RE5NjZc6exT+tQma2M7OX0=3YxGxKg@mail.gmail.com>
 <alpine.LFD.2.23.451.2010050949220.70746@reclus.nhh.no>
 <CANcbSEgpT5f4EeAaeLH5dernYt9r4tM=hoTArfv-WjDhKyzwmg@mail.gmail.com>
 <CANcbSEg80=H0YSoKS9nY7BvzDUYWi7cep=JUom_q09T58K=CoQ@mail.gmail.com>
 <alpine.LFD.2.23.451.2010061520450.92705@reclus.nhh.no>
Message-ID: <CANcbSEgsyeATcLxsU0QamnuyvEtNgum9tw_sYo4GpcVDsqeffA@mail.gmail.com>

Dear Prof. Roger,

Thanks for that suggestion. I will go for a simulation approach then to
identify the appropriate method. Thanks again for your help.

Regards,
Amitha Puranik.




On Tue, 6 Oct, 2020, 6:53 PM Roger Bivand, <Roger.Bivand at nhh.no> wrote:

> On Tue, 6 Oct 2020, Amitha Puranik wrote:
>
> > Dear Prof Roger,
> >
> > This is in continuation to my previous query on spatial data imputation
> > with MNAR mechanism. I have gone through the references recommended by
> you
> > and have the following concerns which I request you to address.
> >
> > 1. The papers by Thomas Suesse, Takafumi Kato suggest likelihood based
> > approaches for predicting missing data in simultaneous autoregressive
> > models with an assumption of *missing at random* mechanism.
> >
> > 2. The additional reference provided by you, i.e. 'Missing Data in Wind
> > Farm Time Series: Properties and Effect on Forecasts' by Tawn et al.,
> > assume *missing not at random* mechanism in an autoregressive framework
> and
> > have applied mean imputation and multiple imputation methods.
> >
> >
> >
> > I am presently looking for a technique to deal with MNAR in spatially
> > autocorrelated data. Would it be reasonable to apply the methods
> > recommended by Suesse or Kato in this scenario by ignoring the missing
> > mechanism?
> >
> > From what I understand, using conventional methods that are effective for
> > MAR case would produce biased estimates when data is MNAR. Can the
> approach
> > applied by Tawn et al. (i.e. mean imputation or multiple imputation) be
> > used on spatial data with MNAR mechanism?
> >
>
> Since probably nobody knows, you may very well need to run simulations in
> the settings you need to determine which outcomes correspond to reasonable
> practice. Reviewers of you work would probably appreciate your having
> explored the robustness of your choice of method. Quite a lot will depend
> on the spatial support of your data too.
>
> Roger
>
> >
> >
> > Any comment/ suggestion will be appreciated.
> >
> >
> > Thanks in advance,
> >
> > Amitha Puranik.
> >
> >
> >
> >
> >
> >
> >
> >
> >
> >
> >
> >
> > On Mon, Oct 5, 2020 at 2:13 PM Amitha Puranik <puranik.amitha at gmail.com>
> > wrote:
> >
> >> Dear Roger,
> >>
> >> Thank you for the quick response. I shall refer to the articles that
> you recommended.
> >> Thanks again!
> >>
> >> Regards,
> >> Amitha Puranik.
> >>
> >> On Mon, Oct 5, 2020 at 1:48 PM Roger Bivand <Roger.Bivand at nhh.no>
> wrote:
> >>
> >>> On Sun, 4 Oct 2020, Amitha Puranik wrote:
> >>>
> >>>> Is it possible to impute missing values in spatial data when the
> >>>> missingness is *MNAR (non-ignorable)*? Can pattern mixture model or
> >>>> selection model be modified to incorporate autocorrelation property
> and
> >>>> used in this context?
> >>>> Any suggestion/opinion is appreciated.
> >>>
> >>> MNAR possibly means "missing not at random". I see
> >>> https://doi.org/10.1186/1476-072X-14-1 for point support data using
> >>> INLA.
> >>> For lattice data, see perhaps
> https://doi.org/10.1007/s10109-019-00316-z
> >>> and work by Thomas Suesse https://doi.org/10.1016/j.csda.2017.11.004
> >>> https://doi.org/10.1080/00949655.2017.1286495. This might be relevant:
> >>> https://doi.org/10.1016/j.epsr.2020.106640, but be extremely careful
> of
> >>> imputation in training/test settings with spatial data, as the spatial
> >>> (or
> >>> temporal or both) lead to information leaking between the training and
> >>> test data because they are no longer independent.
> >>>
> >>> Hope this helps,
> >>>
> >>> Roger
> >>>
> >>>>
> >>>> Thanks in advance,
> >>>> Amitha Puranik
> >>>>
> >>>>       [[alternative HTML version deleted]]
> >>>>
> >>>> _______________________________________________
> >>>> R-sig-Geo mailing list
> >>>> R-sig-Geo at r-project.org
> >>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >>>>
> >>>
> >>> --
> >>> Roger Bivand
> >>> Department of Economics, Norwegian School of Economics,
> >>> Helleveien 30, N-5045 Bergen, Norway.
> >>> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
> >>> https://orcid.org/0000-0003-2392-6140
> >>> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
> >>>
> >>
> >
> >       [[alternative HTML version deleted]]
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
>
> --
> Roger Bivand
> Department of Economics, Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
> https://orcid.org/0000-0003-2392-6140
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>

	[[alternative HTML version deleted]]


From v|@d@@m|h@e@e|95 @end|ng |rom gm@||@com  Wed Oct  7 19:58:40 2020
From: v|@d@@m|h@e@e|95 @end|ng |rom gm@||@com (Vlad Amihaesei)
Date: Wed, 7 Oct 2020 20:58:40 +0300
Subject: [R-sig-Geo] (no subject)
Message-ID: <CAAQaj80XEXoLeuzRHvBYCUBnWAZ8FWx+KAE4x+g_XyT0JU4HGw@mail.gmail.com>

 Hi,
I have  an  error when I want to install stars package from github

if (!require(remotes))
  install.packages("remotes")
remotes::install_github("r-spatial/stars")
library(stars)
 I have this :
ERROR: lazy loading failed for package ?stars?
* removing
?/Library/Frameworks/R.framework/Versions/3.6/Resources/library/stars?
* restoring previous
?/Library/Frameworks/R.framework/Versions/3.6/Resources/library/stars?
Error: Failed to install 'stars' from GitHub:
  (converted from warning) installation of package
?/var/folders/ym/g7mjd6cn7k3fbm0sks8qp8fr0000gn/T//RtmpxiNuRD/file6583fb9afa9/stars_0.4-4.tar.gz?
had non-zero exit status
>

Best  regards,

Vlad Alexandru AMIHAESEI

	[[alternative HTML version deleted]]


From Roger@B|v@nd @end|ng |rom nhh@no  Wed Oct  7 21:00:24 2020
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Wed, 7 Oct 2020 21:00:24 +0200
Subject: [R-sig-Geo] (no subject)
In-Reply-To: <CAAQaj80XEXoLeuzRHvBYCUBnWAZ8FWx+KAE4x+g_XyT0JU4HGw@mail.gmail.com>
References: <CAAQaj80XEXoLeuzRHvBYCUBnWAZ8FWx+KAE4x+g_XyT0JU4HGw@mail.gmail.com>
Message-ID: <alpine.LFD.2.23.451.2010072049220.111201@reclus.nhh.no>

On Wed, 7 Oct 2020, Vlad Amihaesei wrote:

> Hi,
> I have  an  error when I want to install stars package from github

Why from github? You are on your own if you do, because you must install 
all of the packages stars uses, especially sf, also from source if they 
have changed since their last releases. Unless you must use the 
development version, use the released version, or be prepared to sort out 
any difficulties yourself. You do not say what your platform is, and 
should do so (it is  MacOS, version unknown, but you do not say; your R 
version is old).

Roger

PS. Do not use html, post plain text only. Include more of the relevant 
parts of the message.

>
> if (!require(remotes))
>  install.packages("remotes")
> remotes::install_github("r-spatial/stars")
> library(stars)
> I have this :
> ERROR: lazy loading failed for package ?stars?
> * removing
> ?/Library/Frameworks/R.framework/Versions/3.6/Resources/library/stars?
> * restoring previous
> ?/Library/Frameworks/R.framework/Versions/3.6/Resources/library/stars?
> Error: Failed to install 'stars' from GitHub:
>  (converted from warning) installation of package
> ?/var/folders/ym/g7mjd6cn7k3fbm0sks8qp8fr0000gn/T//RtmpxiNuRD/file6583fb9afa9/stars_0.4-4.tar.gz?
> had non-zero exit status
>>
>
> Best  regards,
>
> Vlad Alexandru AMIHAESEI
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

From Roger@B|v@nd @end|ng |rom nhh@no  Thu Oct  8 11:15:54 2020
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Thu, 8 Oct 2020 11:15:54 +0200
Subject: [R-sig-Geo] New sp and rgdal versions on CRAN
Message-ID: <alpine.LFD.2.23.451.2010081107080.124874@reclus.nhh.no>

The source packages sp 1.4-4 and rgdal 1.5-17 are now on CRAN (thanks to 
the CRAN team). They are probably the last releases prior to turning off 
by default intrusive warnings intended to alert users and package 
maintainers to the major changes that have occurred to switch CRS 
representation from Proj4 to WKT2 (2019) strings. If you notice unexpected 
behaviour, please respond here or by email or ping @rsbivand on github if 
your package uses it; twitter @RogerBivand is also possible, but not good 
for longer messages.

Enjoy ...

Roger

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en


From ty|er@j@|r@z|er @end|ng |rom |c|oud@com  Sat Oct 10 07:32:02 2020
From: ty|er@j@|r@z|er @end|ng |rom |c|oud@com (Tyler Frazier)
Date: Sat, 10 Oct 2020 01:32:02 -0400
Subject: [R-sig-Geo] st_sample with raster
In-Reply-To: <f575da64-9887-6a21-7f6c-abffc69eff3d@uni-muenster.de>
References: <E697FE84-B258-4A29-A068-A73FB52DAC88@icloud.com>
 <f575da64-9887-6a21-7f6c-abffc69eff3d@uni-muenster.de>
Message-ID: <7D7153FF-15DD-4FC1-AC52-F04607FC47BD@icloud.com>

Hi Edzer,

Thank you for your answer (although sorry for my slow reply).  I was reading the help doc for st_sample() and noticed the type = argument.  Is it possible to do something like the following.

new_sf_points <- st_sample(sf_polygons, table(df$vector_of_values), type = as.im(raster_of_gridcell_densities))

Running just:

st_sample(sf_polygons, table(df$vector_of_values)) 

where the vector of values is equal in length to the number of polygons in the sf works fine, but I can?t seem to apply gridcell values/densities as weights.  I thought it might be possible to replicate the syntax from spatstat::rpoint() but it didn?t work.

Thanks so much for any additional insight you may have to offer!

Best wishes,
Tyler

Tyler J. Frazier, Ph.D.
Lecturer of Data Science
William & Mary
Webpage: https://tyler-frazier.github.io <https://tyler-frazier.github.io/>

> On Aug 10, 2019, at 4:38 AM, Edzer Pebesma <edzer.pebesma at uni-muenster.de> wrote:
> 
> sf::st_sample has a size argument, which can be specified as a vector to
> operate per feature. If you give that a value equal to
> 
> st_area(obj) * obj$required_density
> 
> and maybe set exact = FALSE, you should get the densities you want.
> 
> On 7/30/19 12:25 AM, Tyler Frazier via R-sig-Geo wrote:
>> Hi All,
>> 
>> Spatstat::rpoint has an argument f that accepts a pixel image object (class .im) to generate points based on the proportionate probability density of that raster.  Just wondering, does sf::st_sample or perhaps another function have a similar available method?
>> 
>> Thanks so much!
>> Ty
>> 
>> Tyler Frazier, Ph.D.
>> Lecturer of Interdisciplinary Studies
>> Data Science Program
>> College of William and Mary
>> Webpage: http://tjfrazier.people.wm.edu
>> Phone: +01 (757) 386-1269
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> 
> 
> -- 
> Edzer Pebesma
> Institute for Geoinformatics
> Heisenbergstrasse 2, 48151 Muenster, Germany
> Phone: +49 251 8333081
> <pEpkey.asc>_______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


	[[alternative HTML version deleted]]


From pur@n|k@@m|th@ @end|ng |rom gm@||@com  Mon Oct 19 08:04:32 2020
From: pur@n|k@@m|th@ @end|ng |rom gm@||@com (Amitha Puranik)
Date: Mon, 19 Oct 2020 11:34:32 +0530
Subject: [R-sig-Geo] Imputation of aggregate data for spatial analysis
Message-ID: <CANcbSEgCz0RqV9hvWG3TJGJ098U74qa=67UN1J-oKkgsu8O7kQ@mail.gmail.com>

Hello everyone!

I have data on the proportion of screening of cervical cancer at
district-level. I have about 530 data points out of the 545 districts. I
want to get a complete picture of the data in order to obtain the spatial
cluster map using LISA (local indicators of partial autocorrelation).

Would it be alright if I impute the missing values of the proportion for
the 15 districts using multiple imputation?

Or is there a better way for imputation in this case?

Any suggestion/ comment is highly appreciated!

Regards,
Amitha

	[[alternative HTML version deleted]]


From Roger@B|v@nd @end|ng |rom nhh@no  Mon Oct 19 10:21:26 2020
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Mon, 19 Oct 2020 10:21:26 +0200
Subject: [R-sig-Geo] Imputation of aggregate data for spatial analysis
In-Reply-To: <CANcbSEgCz0RqV9hvWG3TJGJ098U74qa=67UN1J-oKkgsu8O7kQ@mail.gmail.com>
References: <CANcbSEgCz0RqV9hvWG3TJGJ098U74qa=67UN1J-oKkgsu8O7kQ@mail.gmail.com>
Message-ID: <alpine.LFD.2.23.451.2010191013110.2171801@reclus.nhh.no>

On Mon, 19 Oct 2020, Amitha Puranik wrote:

> Hello everyone!
>
> I have data on the proportion of screening of cervical cancer at
> district-level. I have about 530 data points out of the 545 districts. I
> want to get a complete picture of the data in order to obtain the spatial
> cluster map using LISA (local indicators of partial autocorrelation).
>
> Would it be alright if I impute the missing values of the proportion for
> the 15 districts using multiple imputation?

Please do not even consider imputation of this kind of data, especially if 
LISA is your tools. It makes no sense at all.

If, however, you model the screening proportions at district level, and 
have a model that fits well using multiple well-observed covariates, both 
INLA and other model fitting approaches can predict for unobserved 
responses. However, in such cases, the model will have used the spatial 
autocorrelation already (for example in a BYM model, see for example here: 
http://www.paulamoraga.com/book-geospatial-info/), so putting the 
posterior distributions at unobserved locations into a LISA makes no 
sense, because the imputation alrready uses spatial autocorrelation. 
Modelling, if you have relevant covariates, and model preferably using 
Poisson reression offset by log size of age-selected female population, 
makes much more sense than LISA.

Hope this helps,

Roger

>
> Or is there a better way for imputation in this case?
>
> Any suggestion/ comment is highly appreciated!
>
> Regards,
> Amitha
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en


From pur@n|k@@m|th@ @end|ng |rom gm@||@com  Mon Oct 19 12:13:04 2020
From: pur@n|k@@m|th@ @end|ng |rom gm@||@com (Amitha Puranik)
Date: Mon, 19 Oct 2020 15:43:04 +0530
Subject: [R-sig-Geo] Imputation of aggregate data for spatial analysis
In-Reply-To: <alpine.LFD.2.23.451.2010191013110.2171801@reclus.nhh.no>
References: <CANcbSEgCz0RqV9hvWG3TJGJ098U74qa=67UN1J-oKkgsu8O7kQ@mail.gmail.com>
 <alpine.LFD.2.23.451.2010191013110.2171801@reclus.nhh.no>
Message-ID: <CANcbSEg+rXeCCT6CwnBfV6yRc5gf=xH+VmAWkOpEP+ZxS3W7SA@mail.gmail.com>

Dear Prof Roger,

Thanks a lot for that suggestion!

Kind regards,
Amitha.













On Mon, Oct 19, 2020 at 1:51 PM Roger Bivand <Roger.Bivand at nhh.no> wrote:

> On Mon, 19 Oct 2020, Amitha Puranik wrote:
>
> > Hello everyone!
> >
> > I have data on the proportion of screening of cervical cancer at
> > district-level. I have about 530 data points out of the 545 districts. I
> > want to get a complete picture of the data in order to obtain the spatial
> > cluster map using LISA (local indicators of partial autocorrelation).
> >
> > Would it be alright if I impute the missing values of the proportion for
> > the 15 districts using multiple imputation?
>
> Please do not even consider imputation of this kind of data, especially if
> LISA is your tools. It makes no sense at all.
>
> If, however, you model the screening proportions at district level, and
> have a model that fits well using multiple well-observed covariates, both
> INLA and other model fitting approaches can predict for unobserved
> responses. However, in such cases, the model will have used the spatial
> autocorrelation already (for example in a BYM model, see for example here:
> http://www.paulamoraga.com/book-geospatial-info/), so putting the
> posterior distributions at unobserved locations into a LISA makes no
> sense, because the imputation alrready uses spatial autocorrelation.
> Modelling, if you have relevant covariates, and model preferably using
> Poisson reression offset by log size of age-selected female population,
> makes much more sense than LISA.
>
> Hope this helps,
>
> Roger
>
> >
> > Or is there a better way for imputation in this case?
> >
> > Any suggestion/ comment is highly appreciated!
> >
> > Regards,
> > Amitha
> >
> >       [[alternative HTML version deleted]]
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
>
> --
> Roger Bivand
> Department of Economics, Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
> https://orcid.org/0000-0003-2392-6140
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>

	[[alternative HTML version deleted]]


From mon|c@p@|@|ovejoy @end|ng |rom gm@||@com  Wed Oct 21 16:29:38 2020
From: mon|c@p@|@|ovejoy @end|ng |rom gm@||@com (Monica Palaseanu-Lovejoy)
Date: Wed, 21 Oct 2020 10:29:38 -0400
Subject: [R-sig-Geo] sp:gIntersection warning message about projection
Message-ID: <CABnpDg3N33NXQDFR8=LKH=c9Ub+NiLYNvWVXbibQ_sJPjuukHg@mail.gmail.com>

 Hi,

I am using in my workflow gIntersection from sp package. Part of my
relevant sessionInfo is:
R version 4.0.3 (2020-10-10)
Platform: x86_64-w64-mingw32/x64 (64-bit)
Running under: Windows 10 x64 (build 17763)

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] CircStats_0.2-6 boot_1.3-25     MASS_7.3-53     stringr_1.4.0
[5] rgeos_0.5-5     maptools_1.0-2  rgdal_1.5-18    raster_3.3-13
[9] sp_1.4-4


So i am using 2  SpatialLinesDataFrame that are results of previous
computation. I am not sure i can give a viable examples, but maybe this can
be solved without. If not i will figure out how i can give you a workable
example. Or if you know if there are in R already loaded 2 different line
shapefiles with projection then i will see if i can replicate this problem.

But the main point is that my workflow was fine in R 4.0.0 and the older sp
version, and after i upgraded to the newest R and updated all packages i am
getting the projection warning.

So, first file:

 buff
class       : SpatialLinesDataFrame
features    : 1
extent      : 560525.5, 561302.4, 4698908, 4701110  (xmin, xmax, ymin, ymax)
crs         : +proj=utm +zone=16 +datum=WGS84 +units=m +no_defs
variables   : 2
names       : ID, buff_dist
value       :  2,       135

second file:

pln
class       : SpatialLinesDataFrame
features    : 1
extent      : 560615.6, 560705.4, 4698905, 4699180  (xmin, xmax, ymin, ymax)
crs         : +proj=utm +zone=16 +datum=WGS84 +units=m +no_defs
variables   : 2
names       :                x,                y
value       : 560615.564407584, 4698904.71208346

Please observe that both files have identical projections.

p1 <- gIntersection(buff, pln)
Warning message:
In RGEOSBinTopoFunc(spgeom1, spgeom2, byid, id, drop_lower_td,
unaryUnion_if_byid_false,  :
  spgeom1 and spgeom2 have different proj4 strings

This warning is baffling since both files have same projection:
crs(buff)
CRS arguments:
 +proj=utm +zone=16 +datum=WGS84 +units=m +no_defs

crs(pln)
CRS arguments:
 +proj=utm +zone=16 +datum=WGS84 +units=m +no_defs

Probably i am doing something wrong but for the life of me i cannot see it
as yet.

Thanks so much for any help, take care,
Monica

	[[alternative HTML version deleted]]


From b|@|ev||@t @end|ng |rom gm@||@com  Wed Oct 21 16:53:29 2020
From: b|@|ev||@t @end|ng |rom gm@||@com (=?UTF-8?Q?Bede-Fazekas_=c3=81kos?=)
Date: Wed, 21 Oct 2020 16:53:29 +0200
Subject: [R-sig-Geo] sp:gIntersection warning message about projection
In-Reply-To: <CABnpDg3N33NXQDFR8=LKH=c9Ub+NiLYNvWVXbibQ_sJPjuukHg@mail.gmail.com>
References: <CABnpDg3N33NXQDFR8=LKH=c9Ub+NiLYNvWVXbibQ_sJPjuukHg@mail.gmail.com>
Message-ID: <33da0968-ec27-89b3-6dc1-46d892309b93@gmail.com>

Hello Monica,

The format of CRS definition changed a lot in the last years. I saw 
similar errors thrown by package sf, and transforming or CRS 
modification solved the problem. Does rgeos::gIntersection() work if you 
run one of the following lines before intersection?:
proj4string(pln) <- proj4string(buff)
pln <- spTransform(pln, proj4string(buff))
pln <- spTransform(x = pln, CRSobj = "+proj=utm +zone=16 +datum=WGS84 
+units=m +no_defs"); buff<- spTransform(x = buff, CRSobj = "+proj=utm 
+zone=16 +datum=WGS84 +units=m +no_defs")

Have a nice week,
?kos Bede-Fazekas
Hungarian Academy of Sciences

2020.10.21. 16:29 keltez?ssel, Monica Palaseanu-Lovejoy ?rta:
>   Hi,
>
> I am using in my workflow gIntersection from sp package. Part of my
> relevant sessionInfo is:
> R version 4.0.3 (2020-10-10)
> Platform: x86_64-w64-mingw32/x64 (64-bit)
> Running under: Windows 10 x64 (build 17763)
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> other attached packages:
> [1] CircStats_0.2-6 boot_1.3-25     MASS_7.3-53     stringr_1.4.0
> [5] rgeos_0.5-5     maptools_1.0-2  rgdal_1.5-18    raster_3.3-13
> [9] sp_1.4-4
>
>
> So i am using 2  SpatialLinesDataFrame that are results of previous
> computation. I am not sure i can give a viable examples, but maybe this can
> be solved without. If not i will figure out how i can give you a workable
> example. Or if you know if there are in R already loaded 2 different line
> shapefiles with projection then i will see if i can replicate this problem.
>
> But the main point is that my workflow was fine in R 4.0.0 and the older sp
> version, and after i upgraded to the newest R and updated all packages i am
> getting the projection warning.
>
> So, first file:
>
>   buff
> class       : SpatialLinesDataFrame
> features    : 1
> extent      : 560525.5, 561302.4, 4698908, 4701110  (xmin, xmax, ymin, ymax)
> crs         : +proj=utm +zone=16 +datum=WGS84 +units=m +no_defs
> variables   : 2
> names       : ID, buff_dist
> value       :  2,       135
>
> second file:
>
> pln
> class       : SpatialLinesDataFrame
> features    : 1
> extent      : 560615.6, 560705.4, 4698905, 4699180  (xmin, xmax, ymin, ymax)
> crs         : +proj=utm +zone=16 +datum=WGS84 +units=m +no_defs
> variables   : 2
> names       :                x,                y
> value       : 560615.564407584, 4698904.71208346
>
> Please observe that both files have identical projections.
>
> p1 <- gIntersection(buff, pln)
> Warning message:
> In RGEOSBinTopoFunc(spgeom1, spgeom2, byid, id, drop_lower_td,
> unaryUnion_if_byid_false,  :
>    spgeom1 and spgeom2 have different proj4 strings
>
> This warning is baffling since both files have same projection:
> crs(buff)
> CRS arguments:
>   +proj=utm +zone=16 +datum=WGS84 +units=m +no_defs
>
> crs(pln)
> CRS arguments:
>   +proj=utm +zone=16 +datum=WGS84 +units=m +no_defs
>
> Probably i am doing something wrong but for the life of me i cannot see it
> as yet.
>
> Thanks so much for any help, take care,
> Monica
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From genovev@@gonz@|ez-m|re||@ @end|ng |rom h|@no  Thu Oct 22 10:06:44 2020
From: genovev@@gonz@|ez-m|re||@ @end|ng |rom h|@no (Gonzalez-Mirelis, Genoveva)
Date: Thu, 22 Oct 2020 08:06:44 +0000
Subject: [R-sig-Geo] 3-year position available in Norway on modelling the
 distribution of marine species and habitats
Message-ID: <e8844d6558bf41d39290640857099b7a@hi.no>

Maybe this is of interest to the folks in this list. My apologies for cross-posting!

We have an exciting, 3-year position available at the Institute of Marine Research in Norway under a new project aiming to develop coastal zone maps of species and habitats.

You will find all the information that you need on this link:

https://www.jobbnorge.no/en/available-jobs/job/194806/vacant-3-year-research-position-in-the-marine-coastal-zone-mapping-project

Thanks, and feel free to redistribute!

Genoveva Gonzalez Mirelis, Scientist
Institute of Marine Research
Nordnesgaten 50
5005 Bergen, Norway
Phone number +47 55238510


	[[alternative HTML version deleted]]


From mon|c@p@|@|ovejoy @end|ng |rom gm@||@com  Thu Oct 22 16:46:41 2020
From: mon|c@p@|@|ovejoy @end|ng |rom gm@||@com (Monica Palaseanu-Lovejoy)
Date: Thu, 22 Oct 2020 10:46:41 -0400
Subject: [R-sig-Geo] sp:gIntersection warning message about projection
Message-ID: <CABnpDg1yup9E+eWHz0cx8UbUqHYXkcrDS3Aoq+h3wmiijLZ3QA@mail.gmail.com>

Hi Akos,

Thanks for your answer. I tried your suggestion, and for:

> proj4string(pln) <- proj4string(buff)
Warning messages:
1: In proj4string(buff) : CRS object has comment, which is lost in output
2: In proj4string(obj) : CRS object has comment, which is lost in output

> pln <- spTransform(pln, proj4string(buff))
Warning message:
In proj4string(buff) : CRS object has comment, which is lost in output

> proj4string(buff)
[1] "+proj=utm +zone=16 +datum=WGS84 +units=m +no_defs"
Warning message:
In proj4string(buff) : CRS object has comment, which is lost in output

I got these warnings, which again, i don't understand. I am trying to do an
R package that uses sp, and specifically gIntersection for my project and i
cannot leave it with those warnings.

But if after i have my two objects buff and pln and use these two
transforms you specified, where crs1 is my projection string "+proj=utm
+zone=16 +datum=WGS84
+units=m +no_defs" :

pln <- spTransform(x = pln, CRSobj=crs1)
>
> buff<- spTransform(x = buff, CRSobj=crs1)
>
> p1 <- gIntersection(buff, pln)

Then, i get no warnings from the gIntersection function. I will test
further, but maybe this is the solution, although i still don't understand
why i need to transform my object with a projection when it already has
that projection.

Thanks again for your suggestion, it really helps ;-)

Take care,
Monica

##################################################################

Message: 2
Date: Wed, 21 Oct 2020 16:53:29 +0200
From: =?UTF-8?Q?Bede-Fazekas_=c3=81kos?= <bfalevlist at gmail.com>
To: r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] sp:gIntersection warning message about
        projection
Message-ID: <33da0968-ec27-89b3-6dc1-46d892309b93 at gmail.com>
Content-Type: text/plain; charset="iso-8859-2"; Format="flowed"

Hello Monica,

The format of CRS definition changed a lot in the last years. I saw
similar errors thrown by package sf, and transforming or CRS
modification solved the problem. Does rgeos::gIntersection() work if you
run one of the following lines before intersection?:
proj4string(pln) <- proj4string(buff)
pln <- spTransform(pln, proj4string(buff))
pln <- spTransform(x = pln, CRSobj = "+proj=utm +zone=16 +datum=WGS84
+units=m +no_defs"); buff<- spTransform(x = buff, CRSobj = "+proj=utm
+zone=16 +datum=WGS84 +units=m +no_defs")

Have a nice week,
?kos Bede-Fazekas
Hungarian Academy of Sciences

2020.10.21. 16:29 keltez?ssel, Monica Palaseanu-Lovejoy ?rta:
>   Hi,
>
> I am using in my workflow gIntersection from sp package. Part of my
> relevant sessionInfo is:
> R version 4.0.3 (2020-10-10)
> Platform: x86_64-w64-mingw32/x64 (64-bit)
> Running under: Windows 10 x64 (build 17763)
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> other attached packages:
> [1] CircStats_0.2-6 boot_1.3-25     MASS_7.3-53     stringr_1.4.0
> [5] rgeos_0.5-5     maptools_1.0-2  rgdal_1.5-18    raster_3.3-13
> [9] sp_1.4-4
>
>
> So i am using 2  SpatialLinesDataFrame that are results of previous
> computation. I am not sure i can give a viable examples, but maybe this
can
> be solved without. If not i will figure out how i can give you a workable
> example. Or if you know if there are in R already loaded 2 different line
> shapefiles with projection then i will see if i can replicate this
problem.
>
> But the main point is that my workflow was fine in R 4.0.0 and the older
sp
> version, and after i upgraded to the newest R and updated all packages i
am
> getting the projection warning.
>
> So, first file:
>
>   buff
> class       : SpatialLinesDataFrame
> features    : 1
> extent      : 560525.5, 561302.4, 4698908, 4701110  (xmin, xmax, ymin,
ymax)
> crs         : +proj=utm +zone=16 +datum=WGS84 +units=m +no_defs
> variables   : 2
> names       : ID, buff_dist
> value       :  2,       135
>
> second file:
>
> pln
> class       : SpatialLinesDataFrame
> features    : 1
> extent      : 560615.6, 560705.4, 4698905, 4699180  (xmin, xmax, ymin,
ymax)
> crs         : +proj=utm +zone=16 +datum=WGS84 +units=m +no_defs
> variables   : 2
> names       :                x,                y
> value       : 560615.564407584, 4698904.71208346
>
> Please observe that both files have identical projections.
>
> p1 <- gIntersection(buff, pln)
> Warning message:
> In RGEOSBinTopoFunc(spgeom1, spgeom2, byid, id, drop_lower_td,
> unaryUnion_if_byid_false,  :
>    spgeom1 and spgeom2 have different proj4 strings
>
> This warning is baffling since both files have same projection:
> crs(buff)
> CRS arguments:
>   +proj=utm +zone=16 +datum=WGS84 +units=m +no_defs
>
> crs(pln)
> CRS arguments:
>   +proj=utm +zone=16 +datum=WGS84 +units=m +no_defs
>
> Probably i am doing something wrong but for the life of me i cannot see it
> as yet.
>
> Thanks so much for any help, take care,
> Monica
>
>       [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

	[[alternative HTML version deleted]]


From rob00x @end|ng |rom gm@||@com  Mon Oct 26 18:31:30 2020
From: rob00x @end|ng |rom gm@||@com (Robin Lovelace)
Date: Mon, 26 Oct 2020 17:31:30 +0000
Subject: [R-sig-Geo] NA values in predictions from gstat::krige()
Message-ID: <CAF16KkXOLPYOZSo6W3P4bp3BwRk7zFWf5mz+5wZVKeX-P3EFiw-5652@mail.gmail.com>

Hi all,

When using the gstat package I get NA values for the majority of cells
predicted and I'm not sure what I'm doing wrong. The data is quite noisy
and I plan to do some aggregation on the input data before trying this
again with the interpolate() function from raster/terra, but thought it
worth asking as the answer may be of use to others.

# reprex
library(sf)
library(gstat)
library(stars)
u = "
https://github.com/saferactive/saferactive/releases/download/0.1.1/rnet_lnd_1pcnt.Rds
"
rnet_lnd = readRDS(url(u))
rnet_lnd
grd = st_bbox(rnet_lnd) %>%
  st_as_stars(dx = 500, dy = 500) %>%
  st_set_crs(27700) %>%
  st_crop(rnet_lnd)
grd
v = variogram(bicycle~1, rnet_lnd, cutoff = 10000)
plot(v)
vm = fit.variogram(v, vgm(psill = "Sph", model = "Exp", range = 10000,
nugget = 1))
plot(vm, cutoff = 10000)
rnet_krige = gstat::krige(bicycle~1, rnet_lnd, grd, vm, nmax = 100)
plot(rnet_lnd$geometry)
plot(rnet_krige, add = TRUE)

Outcome on my computer: predictions only in raster grid cells with
observations but I expected from the Spatial Data Science book a continuous
surface with predictions for all of the grid cells, as shown here:
https://keen-swartz-3146c4.netlify.app/interpolation.html

I've also asked this question on stack-overflow where the output from the
above commands can be found: https://stackoverflow.com/questions/64541951/

Thanks for reading and apologies if I'm missing something obvious.

Robin

	[[alternative HTML version deleted]]


From rob00x @end|ng |rom gm@||@com  Mon Oct 26 20:47:45 2020
From: rob00x @end|ng |rom gm@||@com (Robin Lovelace)
Date: Mon, 26 Oct 2020 19:47:45 +0000
Subject: [R-sig-Geo] NA values in predictions from gstat::krige()
In-Reply-To: <CAF16KkXOLPYOZSo6W3P4bp3BwRk7zFWf5mz+5wZVKeX-P3EFiw@mail.gmail.com>
References: <CAF16KkXOLPYOZSo6W3P4bp3BwRk7zFWf5mz+5wZVKeX-P3EFiw@mail.gmail.com>
Message-ID: <CAF16KkXk-vSgAHAE4EieQEO=eJH0WwAmqKJ6fv9b16eq7=FOGA-1837@mail.gmail.com>

Update, I had missed something obvious: the unnecessary st_crop. Many
thanks to Jannes, who pointed this out:
https://github.com/Robinlovelace/geocompr/issues/585#issuecomment-716780818

And apologies for 'spamming' the list, hope my next comment/question will
be more enlightening!

Robin

On Mon, Oct 26, 2020 at 5:31 PM Robin Lovelace <rob00x at gmail.com> wrote:

> Hi all,
>
> When using the gstat package I get NA values for the majority of cells
> predicted and I'm not sure what I'm doing wrong. The data is quite noisy
> and I plan to do some aggregation on the input data before trying this
> again with the interpolate() function from raster/terra, but thought it
> worth asking as the answer may be of use to others.
>
> # reprex
> library(sf)
> library(gstat)
> library(stars)
> u = "
> https://github.com/saferactive/saferactive/releases/download/0.1.1/rnet_lnd_1pcnt.Rds
> "
> rnet_lnd = readRDS(url(u))
> rnet_lnd
> grd = st_bbox(rnet_lnd) %>%
>   st_as_stars(dx = 500, dy = 500) %>%
>   st_set_crs(27700) %>%
>   st_crop(rnet_lnd)
> grd
> v = variogram(bicycle~1, rnet_lnd, cutoff = 10000)
> plot(v)
> vm = fit.variogram(v, vgm(psill = "Sph", model = "Exp", range = 10000,
> nugget = 1))
> plot(vm, cutoff = 10000)
> rnet_krige = gstat::krige(bicycle~1, rnet_lnd, grd, vm, nmax = 100)
> plot(rnet_lnd$geometry)
> plot(rnet_krige, add = TRUE)
>
> Outcome on my computer: predictions only in raster grid cells with
> observations but I expected from the Spatial Data Science book a continuous
> surface with predictions for all of the grid cells, as shown here:
> https://keen-swartz-3146c4.netlify.app/interpolation.html
>
> I've also asked this question on stack-overflow where the output from the
> above commands can be found: https://stackoverflow.com/questions/64541951/
>
> Thanks for reading and apologies if I'm missing something obvious.
>
> Robin
>

	[[alternative HTML version deleted]]


From pk@ge||z@ @end|ng |rom @tudent@@uonb|@@c@ke  Sat Oct 31 06:01:37 2020
From: pk@ge||z@ @end|ng |rom @tudent@@uonb|@@c@ke (PAMELLA KAGELIZA KILAVI)
Date: Sat, 31 Oct 2020 08:01:37 +0300
Subject: [R-sig-Geo] Probabilistic risk analysis for human health
Message-ID: <CAEQQd3+-XU9bZ7=FQf+UciTAnXAMZVRrGPuM_AMh8Y-XbVbFmQ@mail.gmail.com>

I have all the input parameters which take different forms of distribution
(Log-normal, triangular and normal distribution) for the risk analysis. I
am using R to perform the probabilistic analysis and the dry ran output
seems to be far away from the output of the R program. The graphs are also
not so good.

May someone kindly guide me on basic probabilistic risk analysis?


-- 
Pamella Kageliza Kilavi-Ndege
Ph.D. Student
Department of Physics

-- 

The University of Nairobi is ISO 9001:2015 certified.
Website: 
http://www.uonbi.ac.ke/ <http://www.uonbi.ac.ke/>
Facebook: 
https://www.facebook.com/uonbi.ac.ke <https://www.facebook.com/uonbi.ac.ke>
Twitter: @uonbi? https://twitter.com/uonb <https://twitter.com/uonb>

	[[alternative HTML version deleted]]


From nev||@@mo@ @end|ng |rom gm@||@com  Sat Oct 31 13:24:25 2020
From: nev||@@mo@ @end|ng |rom gm@||@com (nevil amos)
Date: Sat, 31 Oct 2020 23:24:25 +1100
Subject: [R-sig-Geo] raster::levels() not working in packaged function.
Message-ID: <CAN9eD7=C3jeZu9yiv4u_=FpQiaihmp3puH8n86RMKyBgXZDWtA@mail.gmail.com>

Apologies, I cannot see how to make a rero for this issue.

I have a function that uses levels(r) tor return the RAT of a raster "r"
when the function is sourced from a script
source(".\R\function.r")
it works fine.
when the function is built into a package and sourced from there
library(mypackage) using the same script file to make the package
levels(r)[[1]]
the same line throws an error, as levels(myraster returns NULL

If I modify the script to include the raster namespace:
raster::levels(r)[[1]]
Then I get the error
 Error: 'levels<-' is not an exported object from 'namespace:raster'


I have also tried just using levels(r) and putting raster as a depends
rather than an import in the DESCRIPTION file for the package, this does
not solve the error.


Any suggestions on how to overcome the problem?

many thanks

Nevil Amos

	[[alternative HTML version deleted]]


From m@rce||no@de|@cruz @end|ng |rom urjc@e@  Sat Oct 31 14:18:40 2020
From: m@rce||no@de|@cruz @end|ng |rom urjc@e@ (Marcelino de la Cruz Rot)
Date: Sat, 31 Oct 2020 14:18:40 +0100
Subject: [R-sig-Geo] raster::levels() not working in packaged function.
In-Reply-To: <CAN9eD7=C3jeZu9yiv4u_=FpQiaihmp3puH8n86RMKyBgXZDWtA@mail.gmail.com>
References: <CAN9eD7=C3jeZu9yiv4u_=FpQiaihmp3puH8n86RMKyBgXZDWtA@mail.gmail.com>
Message-ID: <312c6bc4-9d77-9521-71a2-1aad75b9ed6d@urjc.es>

Maybe including

import(raster)

or

importFrom("raster", "levels")

in the package NAMESPACE would help.

Cheers,

Marcelino

El 31/10/2020 a las 13:24, nevil amos escribi?:
> Apologies, I cannot see how to make a rero for this issue.
>
> I have a function that uses levels(r) tor return the RAT of a raster "r"
> when the function is sourced from a script
> source(".\R\function.r")
> it works fine.
> when the function is built into a package and sourced from there
> library(mypackage) using the same script file to make the package
> levels(r)[[1]]
> the same line throws an error, as levels(myraster returns NULL
>
> If I modify the script to include the raster namespace:
> raster::levels(r)[[1]]
> Then I get the error
>   Error: 'levels<-' is not an exported object from 'namespace:raster'
>
>
> I have also tried just using levels(r) and putting raster as a depends
> rather than an import in the DESCRIPTION file for the package, this does
> not solve the error.
>
>
> Any suggestions on how to overcome the problem?
>
> many thanks
>
> Nevil Amos
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> .


-- 
Marcelino de la Cruz Rot
Depto. de Biolog?a y Geolog?a
F?sica y Qu?mica Inorg?nica
Universidad Rey Juan Carlos
M?stoles Espa?a


From edzer@pebe@m@ @end|ng |rom un|-muen@ter@de  Sat Oct 31 15:05:54 2020
From: edzer@pebe@m@ @end|ng |rom un|-muen@ter@de (Edzer Pebesma)
Date: Sat, 31 Oct 2020 15:05:54 +0100
Subject: [R-sig-Geo] raster::levels() not working in packaged function.
In-Reply-To: <CAN9eD7=C3jeZu9yiv4u_=FpQiaihmp3puH8n86RMKyBgXZDWtA@mail.gmail.com>
References: <CAN9eD7=C3jeZu9yiv4u_=FpQiaihmp3puH8n86RMKyBgXZDWtA@mail.gmail.com>
Message-ID: <4e33932b-b8f7-384d-0e9b-bb3bb42a1127@uni-muenster.de>



On 10/31/20 1:24 PM, nevil amos wrote:
> Apologies, I cannot see how to make a rero for this issue.
> 
> I have a function that uses levels(r) tor return the RAT of a raster "r"
> when the function is sourced from a script
> source(".\R\function.r")
> it works fine.
> when the function is built into a package and sourced from there
> library(mypackage) using the same script file to make the package
> levels(r)[[1]]
> the same line throws an error, as levels(myraster returns NULL
> 
> If I modify the script to include the raster namespace:
> raster::levels(r)[[1]]
> Then I get the error
>   Error: 'levels<-' is not an exported object from 'namespace:raster'

The error suggests that you are trying to assign levels, rather than 
retrieve them.

> 
> 
> I have also tried just using levels(r) and putting raster as a depends
> rather than an import in the DESCRIPTION file for the package, this does
> not solve the error.
> 
> 
> Any suggestions on how to overcome the problem?
> 
> many thanks
> 
> Nevil Amos
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics
Heisenbergstrasse 2, 48149 Muenster, Germany
Phone: +49 251 8333081


