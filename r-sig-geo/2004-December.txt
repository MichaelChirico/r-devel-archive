From eda_news_letter at GISCafe.com  Wed Dec  1 08:11:53 2004
From: eda_news_letter at GISCafe.com (Bentley)
Date: Tue, 30 Nov 2004 23:11:53 -0800
Subject: [R-sig-Geo] Special Offer - Free PDF Composer With a Complimentary
	Subscription to BE Magazine
Message-ID: <200412010711.iB17Brk0025133@smtpcafe.ibsystems.com>

An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20041130/b7de87f2/attachment.html>

From menounos at unbc.ca  Tue Dec  7 07:20:19 2004
From: menounos at unbc.ca (Brian Menounos)
Date: Mon, 06 Dec 2004 22:20:19 -0800
Subject: [R-sig-Geo] longest distance in a polygon
Message-ID: <1102400419.6791.1811.camel@varve.unbc.ca>

Hello,

I'm interested in determining the longest linear distance in an
irregular polygon (and potentially ones with internal holes) and
wondering if there is R code to accomplish this? My interest is to
develop an automated procedure to calculate the effective fetch for
lakes. In a GIS one can clip line coverage based on an irregular
boundary to accomplish this task. The PBSmapping function 'clipLines'
unfortunately only works with rectangles. 

Any help would be greatly appreciated.

Thanks in advance,

Brian Menounos

-- 
Brian Menounos, Assistant Professor
Geography Program
University of Northern British Columbia
3333 University Way 
Prince George, BC, VN2 3C5
email: menounos at unbc.ca
tel: (250) 960-6266
fax: (250) 960-6533
web: http://web.unbc.ca/~menounos/



From james.muller at canberra.net.au  Tue Dec  7 09:26:51 2004
From: james.muller at canberra.net.au (James Muller)
Date: Tue, 07 Dec 2004 19:26:51 +1100
Subject: [R-sig-Geo] convert Map shapes to logical matrices - for set
	operations
Message-ID: <41B5694B.50905@canberra.net.au>

Hi, I have a little problem.  (and sorry for the cross-post of this)

I'm trying to do the following:
 Convert  _projected_ shapes from a Map object into logical matrices. 
That is, rasterize a shape into a logical "in-the-shape" and 
"out-of-the-shape" matrix.

What I'm trying to do is get an 'equal-area' estimate of the area of 
intersection between two overlapping shapes, without any concern about 
there being holes in the shapes. I know owin can deal with most of this, 
but for sure it doesn't support geographic projections, which will allow 
the 'equal-area' estimate to be equal.

An idea I had was to pipe the output of the maptools Map plotting 
function map into the matrix. But I really have no idea how to do that 
at this point in my R education.

Any suggestions are extremely welcome.

Cheers,

James



From Roger.Bivand at nhh.no  Wed Dec  8 13:09:36 2004
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 8 Dec 2004 13:09:36 +0100 (CET)
Subject: [R-sig-Geo] convert Map shapes to logical matrices - for 
	setoperations
Message-ID: <Pine.LNX.4.44.0412081308590.17157-100000@reclus.nhh.no>

On Tue, 7 Dec 2004, James Muller wrote:

> Hi, I have a little problem.  (and sorry for the cross-post of this)
> 
> I'm trying to do the following:
>  Convert  _projected_ shapes from a Map object into logical matrices. 
> That is, rasterize a shape into a logical "in-the-shape" and 
> "out-of-the-shape" matrix.
> 
> What I'm trying to do is get an 'equal-area' estimate of the area of 
> intersection between two overlapping shapes, without any concern about 
> there being holes in the shapes. I know owin can deal with most of this, 
> but for sure it doesn't support geographic projections, which will allow 
> the 'equal-area' estimate to be equal.
> 
> An idea I had was to pipe the output of the maptools Map plotting 
> function map into the matrix. But I really have no idea how to do that 
> at this point in my R education.

Do you have Shapes from the Map object in lat-long or projected 
coordinates? If they are in projected coordinates, you can generate a grid 
with the standard function expand.grid() and then use a point-in-polygon 
function, such as inside.owin() or similar, on each of the grid points. If 
your shape polygons are in geographical coordinates, then consider 
projecting them, see http://www.remotesensing.org/proj for open source 
projection software. You would then be looking for grid points in A, and 
among those, grid points in B, I think. I don't think I'd want to have to 
generate equal area grid points in lat-long, though you could do that 
using proj inversely.

Roger

> 
> Any suggestions are extremely welcome.
> 
> Cheers,
> 
> James
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Breiviksveien 40, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 93 93
e-mail: Roger.Bivand at nhh.no



From Roger.Bivand at nhh.no  Wed Dec  8 13:10:18 2004
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 8 Dec 2004 13:10:18 +0100 (CET)
Subject: [R-sig-Geo] longest distance in a polygon
Message-ID: <Pine.LNX.4.44.0412081309430.17157-100000@reclus.nhh.no>

On Mon, 6 Dec 2004, Brian Menounos wrote:

> Hello,
> 
> I'm interested in determining the longest linear distance in an
> irregular polygon (and potentially ones with internal holes) and
> wondering if there is R code to accomplish this? My interest is to
> develop an automated procedure to calculate the effective fetch for
> lakes. In a GIS one can clip line coverage based on an irregular
> boundary to accomplish this task. The PBSmapping function 'clipLines'
> unfortunately only works with rectangles. 
> 
> Any help would be greatly appreciated.

I suggest looking at the gpclib package. I don't think the functionality 
you need is there at the level of an R function, but you may find that you 
can see how the intersect() function for polygons works. The underlying 
computational geometry library in both PBSmapping and gpclib is the same.

Roger

> 
> Thanks in advance,
> 
> Brian Menounos
> 
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Breiviksveien 40, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 93 93
e-mail: Roger.Bivand at nhh.no



From Roger.Bivand at nhh.no  Thu Dec  9 12:33:28 2004
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 9 Dec 2004 12:33:28 +0100 (CET)
Subject: [R-sig-Geo] New spdep version on CRAN depends on SparseM
Message-ID: <Pine.LNX.4.44.0412091218370.18125-100000@reclus.nhh.no>

The new version of spdep on CRAN (0.3-5) depends on the SparseM package,
using its sparse determinant functions for fitting SAR models. This means
that users risk update.packages() failing if SparseM version >= 0.54 is
not installed first. This version provides robust sparse determinants, and 
thus makes it possible to retire the previous sparse matrix code, which 
has an unsolved memory bug - it will be retired at the next release.

This release also introduces the optional use of optim() rather than line 
search using optimize(), which has worked without problem for some 
BLAS/compiler combinations, but with problems for others. Use of optim() 
will become necessary when trying to fit more than one spatial 
coefficient, which is not yet possible.

Please report bugs/difficulties associated with migration to this new 
series of spdep. The Windows binary should appear before long.

For users needing previous versions, for source see:

http://cran.r-project.org/src/contrib/Archive

or for Windows binary see:

http://cran.r-project.org/bin/windows/contrib/<R version>/last/

Since recent spdep versions have depended on R 2.0, knowing that you can 
access older Windows binaries in the last/ folder is helpful for those who 
cannot easily upgrade their R installation.

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Breiviksveien 40, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 93 93
e-mail: Roger.Bivand at nhh.no



From cavallini at faunalia.it  Thu Dec  9 12:56:19 2004
From: cavallini at faunalia.it (Paolo Cavallini)
Date: Thu, 9 Dec 2004 12:56:19 +0100
Subject: [R-sig-Geo] from adehabitat to grass
Message-ID: <200412091256.22988.cavallini@faunalia.it>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hi all.

For the project AniMov [1] we are trying to export R objects of class "area" 
from adehabitat [2] for use in GRASS 5.7 (immage at: 
www.faunalia.com/animov/area.png).
We tested the following paths:
1. use dxf as an exchange format: this does not work, because the format is 
dxf, which requires a non-free library, and the recompilation of grass
2. use the modules for writing shapefiles (area2shape and export.shape) from 
Clement Calenge (the author of adehabitat). Resulting shapes can be read by 
qgis [3], but not by grass, for unknown reasons (see a sample at: 
www.faunalia.com/animov/test1.zip); there might be something wrong here, 
because also using the library "shapefiles" importing and exporting a valid 
shapefile we get the same result (sample at: 
www.faunalia.com/animov/test2.zip).

I believe it would be better to import "area" objects directly, but the module 
R-GRASS apparently cannot do that.
Is there any suggestion?

All the best.
pc
- --
Paolo Cavallini
cavallini at faunalia.it   www.faunalia.it   www.faunalia.com
Piazza Garibaldi 5 - 56025 Pontedera (PI), Italy   Tel: (+39)348-3801953
http://pkg-grass.alioth.debian.org/cgi-bin/wiki.pl
============================
[1] http://www.faunalia.com/animov/
[2] http://cran.r-project.org/src/contrib/Descriptions/adehabitat.html
[3] http://qgis.org/
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.4 (GNU/Linux)

iD8DBQFBuD1j/NedwLUzIr4RAt2TAJ0RT27MmMYSVsOiVlgi4p9O15xUoQCfbF/7
OTi8XCZOJUkzqIMTN/GvVVE=
=JAl/
-----END PGP SIGNATURE-----



From Roger.Bivand at nhh.no  Thu Dec  9 15:11:40 2004
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 9 Dec 2004 15:11:40 +0100 (CET)
Subject: [R-sig-Geo] Re: [GRASSLIST:5091] from adehabitat to grass
In-Reply-To: <200412091256.22988.cavallini@faunalia.it>
Message-ID: <Pine.LNX.4.44.0412091445230.18125-100000@reclus.nhh.no>

On Thu, 9 Dec 2004, Paolo Cavallini wrote:

> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
> 
> Hi all.
> 
> For the project AniMov [1] we are trying to export R objects of class "area" 
> from adehabitat [2] for use in GRASS 5.7 (immage at: 
> www.faunalia.com/animov/area.png).
> We tested the following paths:
> 1. use dxf as an exchange format: this does not work, because the format is 
> dxf, which requires a non-free library, and the recompilation of grass
> 2. use the modules for writing shapefiles (area2shape and export.shape) from 
> Clement Calenge (the author of adehabitat). Resulting shapes can be read by 
> qgis [3], but not by grass, for unknown reasons (see a sample at: 
> www.faunalia.com/animov/test1.zip); there might be something wrong here, 
> because also using the library "shapefiles" importing and exporting a valid 
> shapefile we get the same result (sample at: 
> www.faunalia.com/animov/test2.zip).

Neither of the R functions you mention: area2shape() and export.shape(), 
are in packages ade4 or adehabitat. Using the R maptools package, your 
test1.* and test2.* are readable (so readable with shapelib), but test1.* 
has overlapping polygons. If we could convert "area" objects to the 
current "polylist" or future package sp representations, the 
write.polylistShape() function (using shapelib) in maptools could be used.

A current effort in R is to establish foundation classes - which will let 
us have many-to-one, one-to-many converters. So a first step will be to 
convert area to some such class, then write that as a polygon shapefile. 
Which GRASS shapefile reading program are you using (which version)?

> 
> I believe it would be better to import "area" objects directly, but the
> module R-GRASS apparently cannot do that. Is there any suggestion?

No, not "area" class objects. Then we get many-to-many. It is much better 
to reduce to a single foundation class set first, then the interface would 
work for all points, lines, polygons, etc., without having to write a 
separate interface for each R class.

For vector, it will be some time before the GRASS libaries are as stable 
as raster is and sites were, so using loose coupling through files is more 
robust for now. The interface can be extended to do this using system() in 
R. Is it worth putting a "new generation" R/GRASS interface based on the 
current one on sourceforge? 

Best wishes,

Roger

> 
> All the best.
> pc
> - --
> Paolo Cavallini
> cavallini at faunalia.it   www.faunalia.it   www.faunalia.com
> Piazza Garibaldi 5 - 56025 Pontedera (PI), Italy   Tel: (+39)348-3801953
> http://pkg-grass.alioth.debian.org/cgi-bin/wiki.pl
> ============================
> [1] http://www.faunalia.com/animov/
> [2] http://cran.r-project.org/src/contrib/Descriptions/adehabitat.html
> [3] http://qgis.org/
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v1.2.4 (GNU/Linux)
> 
> iD8DBQFBuD1j/NedwLUzIr4RAt2TAJ0RT27MmMYSVsOiVlgi4p9O15xUoQCfbF/7
> OTi8XCZOJUkzqIMTN/GvVVE=
> =JAl/
> -----END PGP SIGNATURE-----
> 
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Breiviksveien 40, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 93 93
e-mail: Roger.Bivand at nhh.no



From andersm at maths.lth.se  Thu Dec  9 16:26:18 2004
From: andersm at maths.lth.se (Anders Malmberg)
Date: Thu, 09 Dec 2004 16:26:18 +0100
Subject: [R-sig-Geo] Handling realisations in geoR
Message-ID: <41B86E9A.9010707@maths.lth.se>

Hi,

I have replicates of a spatial field to which I would like fit a spatial 
covariance function
using geoR and its function likfit. My problem is that I do not know how 
to specify this in geoR.

I tried to simply rowstack my fields such that I have

       x   y   data
"1" x1 y1 d11
"2" x2 y2 d12
"3" x3 y3 d13
"4" x4 y4 d14
"1" x1 y1 d21
"2" x2 y2 d22
"3" etc...
"4"
"1"
"2"
"3"
"4" x4 y4 d34

stored in an matrix "obj" let's say. How shall I use 
as.geodata(obj,realisations=XXX)?
And how should I use likfit??? It is no problem to rearrange my matrix.

Best regards,
Anders Malmberg
andersm at maths.lth.se



From paulojus at est.ufpr.br  Thu Dec  9 20:09:51 2004
From: paulojus at est.ufpr.br (Paulo Justiniano Ribeiro Jr)
Date: Thu, 9 Dec 2004 17:09:51 -0200 (BRST)
Subject: [R-sig-Geo] Handling realisations in geoR
In-Reply-To: <41B86E9A.9010707@maths.lth.se>
References: <41B86E9A.9010707@maths.lth.se>
Message-ID: <Pine.LNX.4.58L0.0412091705050.15817@est.ufpr.br>

Hi Anders

First of all you only use the argument realisation if you have
"repetions"of the process (which is not common in practice)

>From what you write it seems all oyu need is somathing along the lines:

obj.geo <- as.geodata(x)
obj.ml <- likfit(obj.geo, ini=c(?,?)

where x is a matrix with coordinates and data values
and ini requires initial values for the covariance parameters, for which
you can use the empirical variogram (function variog()) and an rough
estimate (function eyefit()) to obtain

Hope this helps, please have a look at
?likfit

and there is the geoR intro web page at:
http://www.est.ufpr.br/geoR

and a few tutorials at
http://www.est.ufpr.br/CE714

and feell free to contact me if you have further questions

best
P.J.




On Thu, 9 Dec 2004, Anders Malmberg wrote:

> Hi,
>
> I have replicates of a spatial field to which I would like fit a spatial
> covariance function
> using geoR and its function likfit. My problem is that I do not know how
> to specify this in geoR.
>
> I tried to simply rowstack my fields such that I have
>
>        x   y   data
> "1" x1 y1 d11
> "2" x2 y2 d12
> "3" x3 y3 d13
> "4" x4 y4 d14
> "1" x1 y1 d21
> "2" x2 y2 d22
> "3" etc...
> "4"
> "1"
> "2"
> "3"
> "4" x4 y4 d34
>
> stored in an matrix "obj" let's say. How shall I use
> as.geodata(obj,realisations=XXX)?
> And how should I use likfit??? It is no problem to rearrange my matrix.
>
> Best regards,
> Anders Malmberg
> andersm at maths.lth.se
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>

Paulo Justiniano Ribeiro Jr
LEG (Laborat?rio de Estat?stica e Geoinforma??o)
Departamento de Estat?stica
Universidade Federal do Paran?
Caixa Postal 19.081
CEP 81.531-990
Curitiba, PR  -  Brasil
Tel: (+55) 41 361 3573
Fax: (+55) 41 361 3141
e-mail: paulojus at est.ufpr.br
http://www.est.ufpr.br/~paulojus



From stephane.dray at umontreal.ca  Thu Dec  9 20:04:53 2004
From: stephane.dray at umontreal.ca (Stephane DRAY)
Date: Thu, 09 Dec 2004 14:04:53 -0500
Subject: [R-sig-Geo] Re: [GRASSLIST:5091] from adehabitat to grass
In-Reply-To: <Pine.LNX.4.44.0412091445230.18125-100000@reclus.nhh.no>
References: <200412091256.22988.cavallini@faunalia.it>
Message-ID: <5.2.1.1.0.20041209135540.03576330@biomserv.univ-lyon1.fr>


>
>Neither of the R functions you mention: area2shape() and export.shape(),
>are in packages ade4 or adehabitat. Using the R maptools package, your
>test1.* and test2.* are readable (so readable with shapelib), but test1.*
>has overlapping polygons. If we could convert "area" objects to the
>current "polylist" or future package sp representations, the
>write.polylistShape() function (using shapelib) in maptools could be used.

we can do it with area2poly of ade4


>A current effort in R is to establish foundation classes - which will let
>us have many-to-one, one-to-many converters. So a first step will be to
>convert area to some such class, then write that as a polygon shapefile.
>Which GRASS shapefile reading program are you using (which version)?
>
> >
> > I believe it would be better to import "area" objects directly, but the
> > module R-GRASS apparently cannot do that. Is there any suggestion?
>
>No, not "area" class objects. Then we get many-to-many. It is much better
>to reduce to a single foundation class set first, then the interface would
>work for all points, lines, polygons, etc., without having to write a
>separate interface for each R class.
>
>For vector, it will be some time before the GRASS libaries are as stable
>as raster is and sites were, so using loose coupling through files is more
>robust for now. The interface can be extended to do this using system() in
>R. Is it worth putting a "new generation" R/GRASS interface based on the
>current one on sourceforge?
>
>Best wishes,
>
>Roger

I agree with Roger,
Different kind of spatial data classes have been implemented in R. It seems 
difficult, at the moment,  that each developper transforms its code to 
adopt a unique class for spatial objects.
area objects are an heritage from ADE-4 software and has been implemented 
in the ade4 package.
Clement calenge create a class for these objects in adehabitat, and use 
area2dxf to export data into GIS.
Export functions exist in maptools and area2poly (and poly2area) is 
available in ade4, there is no real need for an area2shape.

Sincerely.





St?phane DRAY
-------------------------------------------------------------------------------------------------- 

D?partement des Sciences Biologiques
Universit? de Montr?al, C.P. 6128, succursale centre-ville
Montr?al, Qu?bec H3C 3J7, Canada

Tel : (514) 343-6111 poste 1233         Fax : (514) 343-2293
E-mail : stephane.dray at umontreal.ca
-------------------------------------------------------------------------------------------------- 

Web                                          http://www.steph280.freesurf.fr/



From munroe.9 at osu.edu  Mon Dec 13 15:21:50 2004
From: munroe.9 at osu.edu (Darla Munroe)
Date: Mon, 13 Dec 2004 09:21:50 -0500
Subject: [R-sig-Geo] spatial 2SLS
Message-ID: <200412131423.iBDENdgu030591@defang9.net.ohio-state.edu>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20041213/26f7be78/attachment.pl>

From anselin at uiuc.edu  Mon Dec 13 15:36:21 2004
From: anselin at uiuc.edu (Luc Anselin)
Date: Mon, 13 Dec 2004 08:36:21 -0600
Subject: [R-sig-Geo] spatial 2SLS
In-Reply-To: <200412131423.iBDENdgu030591@defang9.net.ohio-state.edu>
References: <200412131423.iBDENdgu030591@defang9.net.ohio-state.edu>
Message-ID: <5B66153E-4D14-11D9-8B57-000A958F45DE@uiuc.edu>

I have some functions that implement this. We used them in last summer's
ICPSR spatial regression course. They are not (yet) very user friendly 
and
not up to official R standards yet, but they definitely work.
The functions include:
- standard 2SLS (or IV estimation)
- spatial 2SLS (using WX as instruments for Wy)
- heteroskedastic robust spatial 2SLS (White adjusted variances)
Anyone who wants them and doesn't need a lot of hand holding can e-mail
me directly.
L.


On Dec 13, 2004, at 8:21 AM, Darla Munroe wrote:

> Is the spatial 2SLS developed by Kelejian available in spdep?  If not, 
> is it
> available anywhere else at this time?  (besides in SpaceStat).
>
>
>
> Thanks,
>
> Darla Munroe
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



From m_nica at hotmail.com  Mon Dec 13 17:07:05 2004
From: m_nica at hotmail.com (Mihai Nica)
Date: Mon, 13 Dec 2004 10:07:05 -0600
Subject: [R-sig-Geo] spatial 2SLS
References: <200412131423.iBDENdgu030591@defang9.net.ohio-state.edu>
	<5B66153E-4D14-11D9-8B57-000A958F45DE@uiuc.edu>
Message-ID: <BAY18-DAV6ED7665E52CD68468182EF8AB0@phx.gbl>

Greetings:

I would like to take advantage of this thread and ask if there is a way to
"enhance" the code in spdep. I have a dataset with 3030 observations and two
independent variables. On the same old computer it runs great in GeoDa, but
fails in R. I assume it is a memory issue, but having two different ways to
check my results would be great.

Thanks,

Mihai Nica
Jackson State University
155 B Parkhurst Dr.
Jackson, MS 39202
601 914 0361

----- Original Message ----- 
From: "Luc Anselin" <anselin at uiuc.edu>
To: "Darla Munroe" <munroe.9 at osu.edu>
Cc: <r-sig-geo at stat.math.ethz.ch>
Sent: Monday, December 13, 2004 8:36 AM
Subject: Re: [R-sig-Geo] spatial 2SLS


> I have some functions that implement this. We used them in last summer's
> ICPSR spatial regression course. They are not (yet) very user friendly
> and
> not up to official R standards yet, but they definitely work.
> The functions include:
> - standard 2SLS (or IV estimation)
> - spatial 2SLS (using WX as instruments for Wy)
> - heteroskedastic robust spatial 2SLS (White adjusted variances)
> Anyone who wants them and doesn't need a lot of hand holding can e-mail
> me directly.
> L.
>
>
> On Dec 13, 2004, at 8:21 AM, Darla Munroe wrote:
>
> > Is the spatial 2SLS developed by Kelejian available in spdep?  If not,
> > is it
> > available anywhere else at this time?  (besides in SpaceStat).
> >
> >
> >
> > Thanks,
> >
> > Darla Munroe
> >
> >
> > [[alternative HTML version deleted]]
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at stat.math.ethz.ch
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



From danlinyu at csd.uwm.edu  Mon Dec 13 17:37:49 2004
From: danlinyu at csd.uwm.edu (Danlin Yu)
Date: Mon, 13 Dec 2004 10:37:49 -0600 (CST)
Subject: [R-sig-Geo] spatial 2SLS
In-Reply-To: <BAY18-DAV6ED7665E52CD68468182EF8AB0@phx.gbl>
Message-ID: <Pine.OSF.3.96.1041213102817.31185B-100000@alpha1.csd.uwm.edu>

Dear Mihai Nica:

    I think it is a memory issue, too. I ran into the same problem when
using around 3000 observations. Although I used memory.size() to increase
the memroy allocation size, spdep took too long to run.

    The problem, I think, might be due to the fact that spdep's spatial
autoregressive models use the exact method (correct me if I am wrong),
while GeoDa uses an approximatioin method (see the paper "Fast maximum
likelihood estimation of very large spatial autoregressive models: a
characteristic polynomial approach", in Computational Statistics & Data
Analysis 35 (2001) 301-319). If the method could be incorporated in R, it
will be great.

    Danlin

On Mon, 13 Dec 2004, Mihai Nica wrote:

> Greetings:
> 
> I would like to take advantage of this thread and ask if there is a way to
> "enhance" the code in spdep. I have a dataset with 3030 observations and two
> independent variables. On the same old computer it runs great in GeoDa, but
> fails in R. I assume it is a memory issue, but having two different ways to
> check my results would be great.
> 
> Thanks,
> 
> Mihai Nica
> Jackson State University
> 155 B Parkhurst Dr.
> Jackson, MS 39202
> 601 914 0361
> 
> ----- Original Message ----- 
> From: "Luc Anselin" <anselin at uiuc.edu>
> To: "Darla Munroe" <munroe.9 at osu.edu>
> Cc: <r-sig-geo at stat.math.ethz.ch>
> Sent: Monday, December 13, 2004 8:36 AM
> Subject: Re: [R-sig-Geo] spatial 2SLS
> 
> 
> > I have some functions that implement this. We used them in last summer's
> > ICPSR spatial regression course. They are not (yet) very user friendly
> > and
> > not up to official R standards yet, but they definitely work.
> > The functions include:
> > - standard 2SLS (or IV estimation)
> > - spatial 2SLS (using WX as instruments for Wy)
> > - heteroskedastic robust spatial 2SLS (White adjusted variances)
> > Anyone who wants them and doesn't need a lot of hand holding can e-mail
> > me directly.
> > L.
> >
> >
> > On Dec 13, 2004, at 8:21 AM, Darla Munroe wrote:
> >
> > > Is the spatial 2SLS developed by Kelejian available in spdep?  If not,
> > > is it
> > > available anywhere else at this time?  (besides in SpaceStat).
> > >
> > >
> > >
> > > Thanks,
> > >
> > > Darla Munroe
> > >
> > >
> > > [[alternative HTML version deleted]]
> > >
> > > _______________________________________________
> > > R-sig-Geo mailing list
> > > R-sig-Geo at stat.math.ethz.ch
> > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > >
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at stat.math.ethz.ch
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

    Sincerely,
    Danlin Yu

----------------------------------
Lecturer, Ph.D. Candidate
Department of Geography
University of Wisconsin, Milwaukee
Tel: (414)229-3943
Fax: (414)229-3981
Email: danlinyu at uwm.edu



From Roger.Bivand at nhh.no  Mon Dec 13 18:37:16 2004
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 13 Dec 2004 18:37:16 +0100 (CET)
Subject: [R-sig-Geo] Fitting SAR models in spdep (was: spatial 2SLS)
In-Reply-To: <Pine.OSF.3.96.1041213102817.31185B-100000@alpha1.csd.uwm.edu>
Message-ID: <Pine.LNX.4.44.0412131821190.31922-100000@reclus.nhh.no>

On Mon, 13 Dec 2004, Danlin Yu wrote:

> Dear Mihai Nica:
> 
>     I think it is a memory issue, too. I ran into the same problem when
> using around 3000 observations. Although I used memory.size() to increase
> the memroy allocation size, spdep took too long to run.
> 

I think you mean the two SAR fitting functions, lagsarlm() and 
errorsarlm()? The default method is "eigen", which does need plenty of 
memory with large n (because it both solves the eigenproblem for an nxn 
matrix, and later inverts an nxn matrix). There has always been a "sparse" 
method using code from Netlib called sparse from UCB, which works on some 
platforms, but not others, and has an unresolved memory bug. 

I'm pleased to report that Roger Koenker has been kind enough to add a
det() for symmetric (and similar to symmetric) sparse matrices to the
SparseM package. From spdep_0.3-5, spdep depends on SparseM, and
errorsarlm() is now pretty dependable for large n and fast. lagsarlm() is
dependable, but its fitting speed is slowed by fitting models for LR tests
dropping each of the X variables in turn, as well as the specified model,
so that it fits k models, not just 1. The function calls for the lag
models are cheaper than the error models, though.

The restriction to symmetric (and similar to symmetric) sparse matrices is
important to bear in mind. With symmetric neighbour lists (contiguity,
graphe-based and distance bands), and even symmetric inverse distances,
and all weighting styles this is OK (because "W" and "S" style are similar
to symmetric, and the others are symmetric), but absolutely not for
k-nearest-neighbours or for asymmetric general weights (say migration
tables).

I would be very interested in hearing whether this approach is helpful, 
and how this scales.

Roger

>     The problem, I think, might be due to the fact that spdep's spatial
> autoregressive models use the exact method (correct me if I am wrong),
> while GeoDa uses an approximatioin method (see the paper "Fast maximum
> likelihood estimation of very large spatial autoregressive models: a
> characteristic polynomial approach", in Computational Statistics & Data
> Analysis 35 (2001) 301-319). If the method could be incorporated in R, it
> will be great.
> 
>     Danlin
> 
> On Mon, 13 Dec 2004, Mihai Nica wrote:
> 
> > Greetings:
> > 
> > I would like to take advantage of this thread and ask if there is a way to
> > "enhance" the code in spdep. I have a dataset with 3030 observations and two
> > independent variables. On the same old computer it runs great in GeoDa, but
> > fails in R. I assume it is a memory issue, but having two different ways to
> > check my results would be great.
> > 
> > Thanks,
> > 
> > Mihai Nica
> > Jackson State University
> > 155 B Parkhurst Dr.
> > Jackson, MS 39202
> > 601 914 0361
> > 
> > ----- Original Message ----- 
> > From: "Luc Anselin" <anselin at uiuc.edu>
> > To: "Darla Munroe" <munroe.9 at osu.edu>
> > Cc: <r-sig-geo at stat.math.ethz.ch>
> > Sent: Monday, December 13, 2004 8:36 AM
> > Subject: Re: [R-sig-Geo] spatial 2SLS
> > 
> > 
> > > I have some functions that implement this. We used them in last summer's
> > > ICPSR spatial regression course. They are not (yet) very user friendly
> > > and
> > > not up to official R standards yet, but they definitely work.
> > > The functions include:
> > > - standard 2SLS (or IV estimation)
> > > - spatial 2SLS (using WX as instruments for Wy)
> > > - heteroskedastic robust spatial 2SLS (White adjusted variances)
> > > Anyone who wants them and doesn't need a lot of hand holding can e-mail
> > > me directly.
> > > L.
> > >
> > >
> > > On Dec 13, 2004, at 8:21 AM, Darla Munroe wrote:
> > >
> > > > Is the spatial 2SLS developed by Kelejian available in spdep?  If not,
> > > > is it
> > > > available anywhere else at this time?  (besides in SpaceStat).
> > > >
> > > >
> > > >
> > > > Thanks,
> > > >
> > > > Darla Munroe
> > > >
> > > >
> > > > [[alternative HTML version deleted]]
> > > >
> > > > _______________________________________________
> > > > R-sig-Geo mailing list
> > > > R-sig-Geo at stat.math.ethz.ch
> > > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > > >
> > >
> > > _______________________________________________
> > > R-sig-Geo mailing list
> > > R-sig-Geo at stat.math.ethz.ch
> > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > >
> > 
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at stat.math.ethz.ch
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > 
> 
>     Sincerely,
>     Danlin Yu
> 
> ----------------------------------
> Lecturer, Ph.D. Candidate
> Department of Geography
> University of Wisconsin, Milwaukee
> Tel: (414)229-3943
> Fax: (414)229-3981
> Email: danlinyu at uwm.edu
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Breiviksveien 40, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 93 93
e-mail: Roger.Bivand at nhh.no



From danlinyu at csd.uwm.edu  Mon Dec 13 19:03:22 2004
From: danlinyu at csd.uwm.edu (Danlin Yu)
Date: Mon, 13 Dec 2004 12:03:22 -0600 (CST)
Subject: [R-sig-Geo] Fitting SAR models in spdep (was: spatial 2SLS)
In-Reply-To: <Pine.LNX.4.44.0412131821190.31922-100000@reclus.nhh.no>
Message-ID: <Pine.OSF.3.96.1041213115724.31185C-100000@alpha1.csd.uwm.edu>

Dear Professor Roger Bivand:

    Yes, I was talking about the two SAR fitting functions. I just did a
very quick run on a dataset with 3437 observations (those are point data,
and I generate the listw object using dnearneigh() - not sure whether the
result is symmetric or asymmetric). However, I tried both "sparse" and
"SparseM" method on errorsarlm(), both failed to go through, the errors
given as follow:

    For "sparse" method:
    "Error in spwdet(sparseweights, rho = rho, debug = debug) : 
        Suspicious allocation of memory in sparse functions
         ...bailing out! Save workspace and quit R!"

    For "SparseM" method:
    "Error in .local(x, ...) : Increase tmpmax
     Error in det(chol(x)) : Unable to find the argument "x" in selecting
     a method for function "det" "

    By the way, I am still using R 2.0.0 and when I loaded the libraries,
I got warnings. I will keep trying and keep you posted as I progress.
Thanks.


On Mon, 13 Dec 2004, Roger Bivand wrote:

> On Mon, 13 Dec 2004, Danlin Yu wrote:
> 
> > Dear Mihai Nica:
> > 
> >     I think it is a memory issue, too. I ran into the same problem when
> > using around 3000 observations. Although I used memory.size() to increase
> > the memroy allocation size, spdep took too long to run.
> > 
> 
> I think you mean the two SAR fitting functions, lagsarlm() and 
> errorsarlm()? The default method is "eigen", which does need plenty of 
> memory with large n (because it both solves the eigenproblem for an nxn 
> matrix, and later inverts an nxn matrix). There has always been a "sparse" 
> method using code from Netlib called sparse from UCB, which works on some 
> platforms, but not others, and has an unresolved memory bug. 
> 
> I'm pleased to report that Roger Koenker has been kind enough to add a
> det() for symmetric (and similar to symmetric) sparse matrices to the
> SparseM package. From spdep_0.3-5, spdep depends on SparseM, and
> errorsarlm() is now pretty dependable for large n and fast. lagsarlm() is
> dependable, but its fitting speed is slowed by fitting models for LR tests
> dropping each of the X variables in turn, as well as the specified model,
> so that it fits k models, not just 1. The function calls for the lag
> models are cheaper than the error models, though.
> 
> The restriction to symmetric (and similar to symmetric) sparse matrices is
> important to bear in mind. With symmetric neighbour lists (contiguity,
> graphe-based and distance bands), and even symmetric inverse distances,
> and all weighting styles this is OK (because "W" and "S" style are similar
> to symmetric, and the others are symmetric), but absolutely not for
> k-nearest-neighbours or for asymmetric general weights (say migration
> tables).
> 
> I would be very interested in hearing whether this approach is helpful, 
> and how this scales.
> 
> Roger
> 
> >     The problem, I think, might be due to the fact that spdep's spatial
> > autoregressive models use the exact method (correct me if I am wrong),
> > while GeoDa uses an approximatioin method (see the paper "Fast maximum
> > likelihood estimation of very large spatial autoregressive models: a
> > characteristic polynomial approach", in Computational Statistics & Data
> > Analysis 35 (2001) 301-319). If the method could be incorporated in R, it
> > will be great.
> > 
> >     Danlin
> > 
> > On Mon, 13 Dec 2004, Mihai Nica wrote:
> > 
> > > Greetings:
> > > 
> > > I would like to take advantage of this thread and ask if there is a way to
> > > "enhance" the code in spdep. I have a dataset with 3030 observations and two
> > > independent variables. On the same old computer it runs great in GeoDa, but
> > > fails in R. I assume it is a memory issue, but having two different ways to
> > > check my results would be great.
> > > 
> > > Thanks,
> > > 
> > > Mihai Nica
> > > Jackson State University
> > > 155 B Parkhurst Dr.
> > > Jackson, MS 39202
> > > 601 914 0361
> > > 
> > > ----- Original Message ----- 
> > > From: "Luc Anselin" <anselin at uiuc.edu>
> > > To: "Darla Munroe" <munroe.9 at osu.edu>
> > > Cc: <r-sig-geo at stat.math.ethz.ch>
> > > Sent: Monday, December 13, 2004 8:36 AM
> > > Subject: Re: [R-sig-Geo] spatial 2SLS
> > > 
> > > 
> > > > I have some functions that implement this. We used them in last summer's
> > > > ICPSR spatial regression course. They are not (yet) very user friendly
> > > > and
> > > > not up to official R standards yet, but they definitely work.
> > > > The functions include:
> > > > - standard 2SLS (or IV estimation)
> > > > - spatial 2SLS (using WX as instruments for Wy)
> > > > - heteroskedastic robust spatial 2SLS (White adjusted variances)
> > > > Anyone who wants them and doesn't need a lot of hand holding can e-mail
> > > > me directly.
> > > > L.
> > > >
> > > >
> > > > On Dec 13, 2004, at 8:21 AM, Darla Munroe wrote:
> > > >
> > > > > Is the spatial 2SLS developed by Kelejian available in spdep?  If not,
> > > > > is it
> > > > > available anywhere else at this time?  (besides in SpaceStat).
> > > > >
> > > > >
> > > > >
> > > > > Thanks,
> > > > >
> > > > > Darla Munroe
> > > > >
> > > > >
> > > > > [[alternative HTML version deleted]]
> > > > >
> > > > > _______________________________________________
> > > > > R-sig-Geo mailing list
> > > > > R-sig-Geo at stat.math.ethz.ch
> > > > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > > > >
> > > >
> > > > _______________________________________________
> > > > R-sig-Geo mailing list
> > > > R-sig-Geo at stat.math.ethz.ch
> > > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > > >
> > > 
> > > _______________________________________________
> > > R-sig-Geo mailing list
> > > R-sig-Geo at stat.math.ethz.ch
> > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > > 
> > 
> >     Sincerely,
> >     Danlin Yu
> > 
> > ----------------------------------
> > Lecturer, Ph.D. Candidate
> > Department of Geography
> > University of Wisconsin, Milwaukee
> > Tel: (414)229-3943
> > Fax: (414)229-3981
> > Email: danlinyu at uwm.edu
> > 
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at stat.math.ethz.ch
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > 
> 
> -- 
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Breiviksveien 40, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 93 93
> e-mail: Roger.Bivand at nhh.no
> 
> 

    Sincerely,
    Danlin Yu

----------------------------------
Lecturer, Ph.D. Candidate
Department of Geography
University of Wisconsin, Milwaukee
Tel: (414)229-3943
Fax: (414)229-3981
Email: danlinyu at uwm.edu



From Roger.Bivand at nhh.no  Mon Dec 13 19:21:00 2004
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 13 Dec 2004 19:21:00 +0100 (CET)
Subject: [R-sig-Geo] Fitting SAR models in spdep (was: spatial 2SLS)
In-Reply-To: <Pine.OSF.3.96.1041213115724.31185C-100000@alpha1.csd.uwm.edu>
Message-ID: <Pine.LNX.4.44.0412131912330.31922-100000@reclus.nhh.no>

On Mon, 13 Dec 2004, Danlin Yu wrote:

> Dear Professor Roger Bivand:
> 
>     Yes, I was talking about the two SAR fitting functions. I just did a
> very quick run on a dataset with 3437 observations (those are point data,
> and I generate the listw object using dnearneigh() - not sure whether the
> result is symmetric or asymmetric). 

How many links are there in the neighbour list? Distance neighbours are 
symmetric, but if points are densely placed, there may be parts of your 
study area with many neighbours. Use print.nb() to find out how many.

> However, I tried both "sparse" and
> "SparseM" method on errorsarlm(), both failed to go through, the errors
> given as follow:
> 
>     For "sparse" method:
>     "Error in spwdet(sparseweights, rho = rho, debug = debug) : 
>         Suspicious allocation of memory in sparse functions
>          ...bailing out! Save workspace and quit R!"

Yes, this is the memory bug. It does happen on most/all GCC compiled 
versions, but I've seen BSD versions that work - it depends on the memory 
allocation code, but it has not been possible to solve. I am planning to 
drop "sparse" before long, unless the memory bug is resolved.

> 
>     For "SparseM" method:
>     "Error in .local(x, ...) : Increase tmpmax

This is the problem: tmpmax is defined in chol() for "matrix.csr" objects 
as only 10 times the number of rows. I think you have more neighbour links 
than 10*n, and that means I need to find a way of passing a better value 
through. Please let me know, this looks do-able.

Roger

>      Error in det(chol(x)) : Unable to find the argument "x" in selecting
>      a method for function "det" "
> 
>     By the way, I am still using R 2.0.0 and when I loaded the libraries,
> I got warnings. I will keep trying and keep you posted as I progress.
> Thanks.
> 
> 
> On Mon, 13 Dec 2004, Roger Bivand wrote:
> 
> > On Mon, 13 Dec 2004, Danlin Yu wrote:
> > 
> > > Dear Mihai Nica:
> > > 
> > >     I think it is a memory issue, too. I ran into the same problem when
> > > using around 3000 observations. Although I used memory.size() to increase
> > > the memroy allocation size, spdep took too long to run.
> > > 
> > 
> > I think you mean the two SAR fitting functions, lagsarlm() and 
> > errorsarlm()? The default method is "eigen", which does need plenty of 
> > memory with large n (because it both solves the eigenproblem for an nxn 
> > matrix, and later inverts an nxn matrix). There has always been a "sparse" 
> > method using code from Netlib called sparse from UCB, which works on some 
> > platforms, but not others, and has an unresolved memory bug. 
> > 
> > I'm pleased to report that Roger Koenker has been kind enough to add a
> > det() for symmetric (and similar to symmetric) sparse matrices to the
> > SparseM package. From spdep_0.3-5, spdep depends on SparseM, and
> > errorsarlm() is now pretty dependable for large n and fast. lagsarlm() is
> > dependable, but its fitting speed is slowed by fitting models for LR tests
> > dropping each of the X variables in turn, as well as the specified model,
> > so that it fits k models, not just 1. The function calls for the lag
> > models are cheaper than the error models, though.
> > 
> > The restriction to symmetric (and similar to symmetric) sparse matrices is
> > important to bear in mind. With symmetric neighbour lists (contiguity,
> > graphe-based and distance bands), and even symmetric inverse distances,
> > and all weighting styles this is OK (because "W" and "S" style are similar
> > to symmetric, and the others are symmetric), but absolutely not for
> > k-nearest-neighbours or for asymmetric general weights (say migration
> > tables).
> > 
> > I would be very interested in hearing whether this approach is helpful, 
> > and how this scales.
> > 
> > Roger
> > 
> > >     The problem, I think, might be due to the fact that spdep's spatial
> > > autoregressive models use the exact method (correct me if I am wrong),
> > > while GeoDa uses an approximatioin method (see the paper "Fast maximum
> > > likelihood estimation of very large spatial autoregressive models: a
> > > characteristic polynomial approach", in Computational Statistics & Data
> > > Analysis 35 (2001) 301-319). If the method could be incorporated in R, it
> > > will be great.
> > > 
> > >     Danlin
> > > 
> > > On Mon, 13 Dec 2004, Mihai Nica wrote:
> > > 
> > > > Greetings:
> > > > 
> > > > I would like to take advantage of this thread and ask if there is a way to
> > > > "enhance" the code in spdep. I have a dataset with 3030 observations and two
> > > > independent variables. On the same old computer it runs great in GeoDa, but
> > > > fails in R. I assume it is a memory issue, but having two different ways to
> > > > check my results would be great.
> > > > 
> > > > Thanks,
> > > > 
> > > > Mihai Nica
> > > > Jackson State University
> > > > 155 B Parkhurst Dr.
> > > > Jackson, MS 39202
> > > > 601 914 0361
> > > > 
> > > > ----- Original Message ----- 
> > > > From: "Luc Anselin" <anselin at uiuc.edu>
> > > > To: "Darla Munroe" <munroe.9 at osu.edu>
> > > > Cc: <r-sig-geo at stat.math.ethz.ch>
> > > > Sent: Monday, December 13, 2004 8:36 AM
> > > > Subject: Re: [R-sig-Geo] spatial 2SLS
> > > > 
> > > > 
> > > > > I have some functions that implement this. We used them in last summer's
> > > > > ICPSR spatial regression course. They are not (yet) very user friendly
> > > > > and
> > > > > not up to official R standards yet, but they definitely work.
> > > > > The functions include:
> > > > > - standard 2SLS (or IV estimation)
> > > > > - spatial 2SLS (using WX as instruments for Wy)
> > > > > - heteroskedastic robust spatial 2SLS (White adjusted variances)
> > > > > Anyone who wants them and doesn't need a lot of hand holding can e-mail
> > > > > me directly.
> > > > > L.
> > > > >
> > > > >
> > > > > On Dec 13, 2004, at 8:21 AM, Darla Munroe wrote:
> > > > >
> > > > > > Is the spatial 2SLS developed by Kelejian available in spdep?  If not,
> > > > > > is it
> > > > > > available anywhere else at this time?  (besides in SpaceStat).
> > > > > >
> > > > > >
> > > > > >
> > > > > > Thanks,
> > > > > >
> > > > > > Darla Munroe
> > > > > >
> > > > > >
> > > > > > [[alternative HTML version deleted]]
> > > > > >
> > > > > > _______________________________________________
> > > > > > R-sig-Geo mailing list
> > > > > > R-sig-Geo at stat.math.ethz.ch
> > > > > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > > > > >
> > > > >
> > > > > _______________________________________________
> > > > > R-sig-Geo mailing list
> > > > > R-sig-Geo at stat.math.ethz.ch
> > > > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > > > >
> > > > 
> > > > _______________________________________________
> > > > R-sig-Geo mailing list
> > > > R-sig-Geo at stat.math.ethz.ch
> > > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > > > 
> > > 
> > >     Sincerely,
> > >     Danlin Yu
> > > 
> > > ----------------------------------
> > > Lecturer, Ph.D. Candidate
> > > Department of Geography
> > > University of Wisconsin, Milwaukee
> > > Tel: (414)229-3943
> > > Fax: (414)229-3981
> > > Email: danlinyu at uwm.edu
> > > 
> > > _______________________________________________
> > > R-sig-Geo mailing list
> > > R-sig-Geo at stat.math.ethz.ch
> > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > > 
> > 
> > -- 
> > Roger Bivand
> > Economic Geography Section, Department of Economics, Norwegian School of
> > Economics and Business Administration, Breiviksveien 40, N-5045 Bergen,
> > Norway. voice: +47 55 95 93 55; fax +47 55 95 93 93
> > e-mail: Roger.Bivand at nhh.no
> > 
> > 
> 
>     Sincerely,
>     Danlin Yu
> 
> ----------------------------------
> Lecturer, Ph.D. Candidate
> Department of Geography
> University of Wisconsin, Milwaukee
> Tel: (414)229-3943
> Fax: (414)229-3981
> Email: danlinyu at uwm.edu
> ----------------------------------
> 
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Breiviksveien 40, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 93 93
e-mail: Roger.Bivand at nhh.no



From danlinyu at csd.uwm.edu  Mon Dec 13 20:52:25 2004
From: danlinyu at csd.uwm.edu (Danlin Yu)
Date: Mon, 13 Dec 2004 13:52:25 -0600 (CST)
Subject: [R-sig-Geo] Fitting SAR models in spdep (was: spatial 2SLS)
In-Reply-To: <Pine.LNX.4.44.0412131912330.31922-100000@reclus.nhh.no>
Message-ID: <Pine.OSF.3.96.1041213134719.31185F-100000@alpha1.csd.uwm.edu>

Dear Professor Roger Bivand:

   Yes, you are right, the total number of links is 686040, much more than
10*n (that is 3437) in the dataset.

   Some of the study area is really dense in data, but some is really
sparse. So the chosen distance ensuring there won't be any non-zero links
yield a large number of links. The actual reports from print.nb follows:

Neighbour list object:
Number of regions: 3437 
Number of nonzero links: 686040 
Percentage nonzero weights: 5.807515 
Average number of links: 199.6043

   Please keep me posted if the chol() problem is solved. Thanks. Danlin

On Mon, 13 Dec 2004, Roger Bivand wrote:

> On Mon, 13 Dec 2004, Danlin Yu wrote:
> 
> > Dear Professor Roger Bivand:
> > 
> >     Yes, I was talking about the two SAR fitting functions. I just did a
> > very quick run on a dataset with 3437 observations (those are point data,
> > and I generate the listw object using dnearneigh() - not sure whether the
> > result is symmetric or asymmetric). 
> 
> How many links are there in the neighbour list? Distance neighbours are 
> symmetric, but if points are densely placed, there may be parts of your 
> study area with many neighbours. Use print.nb() to find out how many.
> 
> > However, I tried both "sparse" and
> > "SparseM" method on errorsarlm(), both failed to go through, the errors
> > given as follow:
> > 
> >     For "sparse" method:
> >     "Error in spwdet(sparseweights, rho = rho, debug = debug) : 
> >         Suspicious allocation of memory in sparse functions
> >          ...bailing out! Save workspace and quit R!"
> 
> Yes, this is the memory bug. It does happen on most/all GCC compiled 
> versions, but I've seen BSD versions that work - it depends on the memory 
> allocation code, but it has not been possible to solve. I am planning to 
> drop "sparse" before long, unless the memory bug is resolved.
> 
> > 
> >     For "SparseM" method:
> >     "Error in .local(x, ...) : Increase tmpmax
> 
> This is the problem: tmpmax is defined in chol() for "matrix.csr" objects 
> as only 10 times the number of rows. I think you have more neighbour links 
> than 10*n, and that means I need to find a way of passing a better value 
> through. Please let me know, this looks do-able.
> 
> Roger
> 
> >      Error in det(chol(x)) : Unable to find the argument "x" in selecting
> >      a method for function "det" "
> > 
> >     By the way, I am still using R 2.0.0 and when I loaded the libraries,
> > I got warnings. I will keep trying and keep you posted as I progress.
> > Thanks.
> > 
> > 
> > On Mon, 13 Dec 2004, Roger Bivand wrote:
> > 
> > > On Mon, 13 Dec 2004, Danlin Yu wrote:
> > > 
> > > > Dear Mihai Nica:
> > > > 
> > > >     I think it is a memory issue, too. I ran into the same problem when
> > > > using around 3000 observations. Although I used memory.size() to increase
> > > > the memroy allocation size, spdep took too long to run.
> > > > 
> > > 
> > > I think you mean the two SAR fitting functions, lagsarlm() and 
> > > errorsarlm()? The default method is "eigen", which does need plenty of 
> > > memory with large n (because it both solves the eigenproblem for an nxn 
> > > matrix, and later inverts an nxn matrix). There has always been a "sparse" 
> > > method using code from Netlib called sparse from UCB, which works on some 
> > > platforms, but not others, and has an unresolved memory bug. 
> > > 
> > > I'm pleased to report that Roger Koenker has been kind enough to add a
> > > det() for symmetric (and similar to symmetric) sparse matrices to the
> > > SparseM package. From spdep_0.3-5, spdep depends on SparseM, and
> > > errorsarlm() is now pretty dependable for large n and fast. lagsarlm() is
> > > dependable, but its fitting speed is slowed by fitting models for LR tests
> > > dropping each of the X variables in turn, as well as the specified model,
> > > so that it fits k models, not just 1. The function calls for the lag
> > > models are cheaper than the error models, though.
> > > 
> > > The restriction to symmetric (and similar to symmetric) sparse matrices is
> > > important to bear in mind. With symmetric neighbour lists (contiguity,
> > > graphe-based and distance bands), and even symmetric inverse distances,
> > > and all weighting styles this is OK (because "W" and "S" style are similar
> > > to symmetric, and the others are symmetric), but absolutely not for
> > > k-nearest-neighbours or for asymmetric general weights (say migration
> > > tables).
> > > 
> > > I would be very interested in hearing whether this approach is helpful, 
> > > and how this scales.
> > > 
> > > Roger
> > > 
> > > >     The problem, I think, might be due to the fact that spdep's spatial
> > > > autoregressive models use the exact method (correct me if I am wrong),
> > > > while GeoDa uses an approximatioin method (see the paper "Fast maximum
> > > > likelihood estimation of very large spatial autoregressive models: a
> > > > characteristic polynomial approach", in Computational Statistics & Data
> > > > Analysis 35 (2001) 301-319). If the method could be incorporated in R, it
> > > > will be great.
> > > > 
> > > >     Danlin
> > > > 
> > > > On Mon, 13 Dec 2004, Mihai Nica wrote:
> > > > 
> > > > > Greetings:
> > > > > 
> > > > > I would like to take advantage of this thread and ask if there is a way to
> > > > > "enhance" the code in spdep. I have a dataset with 3030 observations and two
> > > > > independent variables. On the same old computer it runs great in GeoDa, but
> > > > > fails in R. I assume it is a memory issue, but having two different ways to
> > > > > check my results would be great.
> > > > > 
> > > > > Thanks,
> > > > > 
> > > > > Mihai Nica
> > > > > Jackson State University
> > > > > 155 B Parkhurst Dr.
> > > > > Jackson, MS 39202
> > > > > 601 914 0361
> > > > > 
> > > > > ----- Original Message ----- 
> > > > > From: "Luc Anselin" <anselin at uiuc.edu>
> > > > > To: "Darla Munroe" <munroe.9 at osu.edu>
> > > > > Cc: <r-sig-geo at stat.math.ethz.ch>
> > > > > Sent: Monday, December 13, 2004 8:36 AM
> > > > > Subject: Re: [R-sig-Geo] spatial 2SLS
> > > > > 
> > > > > 
> > > > > > I have some functions that implement this. We used them in last summer's
> > > > > > ICPSR spatial regression course. They are not (yet) very user friendly
> > > > > > and
> > > > > > not up to official R standards yet, but they definitely work.
> > > > > > The functions include:
> > > > > > - standard 2SLS (or IV estimation)
> > > > > > - spatial 2SLS (using WX as instruments for Wy)
> > > > > > - heteroskedastic robust spatial 2SLS (White adjusted variances)
> > > > > > Anyone who wants them and doesn't need a lot of hand holding can e-mail
> > > > > > me directly.
> > > > > > L.
> > > > > >
> > > > > >
> > > > > > On Dec 13, 2004, at 8:21 AM, Darla Munroe wrote:
> > > > > >
> > > > > > > Is the spatial 2SLS developed by Kelejian available in spdep?  If not,
> > > > > > > is it
> > > > > > > available anywhere else at this time?  (besides in SpaceStat).
> > > > > > >
> > > > > > >
> > > > > > >
> > > > > > > Thanks,
> > > > > > >
> > > > > > > Darla Munroe
> > > > > > >
> > > > > > >
> > > > > > > [[alternative HTML version deleted]]
> > > > > > >
> > > > > > > _______________________________________________
> > > > > > > R-sig-Geo mailing list
> > > > > > > R-sig-Geo at stat.math.ethz.ch
> > > > > > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > > > > > >
> > > > > >
> > > > > > _______________________________________________
> > > > > > R-sig-Geo mailing list
> > > > > > R-sig-Geo at stat.math.ethz.ch
> > > > > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > > > > >
> > > > > 
> > > > > _______________________________________________
> > > > > R-sig-Geo mailing list
> > > > > R-sig-Geo at stat.math.ethz.ch
> > > > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > > > > 
> > > > 
> > > >     Sincerely,
> > > >     Danlin Yu
> > > > 
> > > > ----------------------------------
> > > > Lecturer, Ph.D. Candidate
> > > > Department of Geography
> > > > University of Wisconsin, Milwaukee
> > > > Tel: (414)229-3943
> > > > Fax: (414)229-3981
> > > > Email: danlinyu at uwm.edu
> > > > 
> > > > _______________________________________________
> > > > R-sig-Geo mailing list
> > > > R-sig-Geo at stat.math.ethz.ch
> > > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > > > 
> > > 
> > > -- 
> > > Roger Bivand
> > > Economic Geography Section, Department of Economics, Norwegian School of
> > > Economics and Business Administration, Breiviksveien 40, N-5045 Bergen,
> > > Norway. voice: +47 55 95 93 55; fax +47 55 95 93 93
> > > e-mail: Roger.Bivand at nhh.no
> > > 
> > > 
> > 
> >     Sincerely,
> >     Danlin Yu
> > 
> > ----------------------------------
> > Lecturer, Ph.D. Candidate
> > Department of Geography
> > University of Wisconsin, Milwaukee
> > Tel: (414)229-3943
> > Fax: (414)229-3981
> > Email: danlinyu at uwm.edu
> > ----------------------------------
> > 
> > 
> 
> -- 
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Breiviksveien 40, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 93 93
> e-mail: Roger.Bivand at nhh.no
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

    Sincerely,
    Danlin Yu

----------------------------------
Lecturer, Ph.D. Candidate
Department of Geography
University of Wisconsin, Milwaukee
Tel: (414)229-3943
Fax: (414)229-3981
Email: danlinyu at uwm.edu



From Roger.Bivand at nhh.no  Mon Dec 13 21:13:12 2004
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 13 Dec 2004 21:13:12 +0100 (CET)
Subject: [R-sig-Geo] Fitting SAR models in spdep (was: spatial 2SLS)
In-Reply-To: <Pine.OSF.3.96.1041213134719.31185F-100000@alpha1.csd.uwm.edu>
Message-ID: <Pine.LNX.4.44.0412132109470.31922-100000@reclus.nhh.no>

On Mon, 13 Dec 2004, Danlin Yu wrote:

> Dear Professor Roger Bivand:
> 
>    Yes, you are right, the total number of links is 686040, much more than
> 10*n (that is 3437) in the dataset.
> 
>    Some of the study area is really dense in data, but some is really
> sparse. So the chosen distance ensuring there won't be any non-zero links
> yield a large number of links. The actual reports from print.nb follows:
> 
> Neighbour list object:
> Number of regions: 3437 
> Number of nonzero links: 686040 
> Percentage nonzero weights: 5.807515 
> Average number of links: 199.6043
> 
>    Please keep me posted if the chol() problem is solved. Thanks. Danlin

Please try pre-release version 0.3-6 - source and Windows binary packages 
on: http://spatial.nhh.no/R/spdep/

It would be good if this works. I think, though, that a graph-based 
neighbour list (SOI graph, for example) would be a more natural choice 
than distances, but for testing, this neighbour list is very suitable.

Roger

> 
> On Mon, 13 Dec 2004, Roger Bivand wrote:
> 
> > On Mon, 13 Dec 2004, Danlin Yu wrote:
> > 
> > > Dear Professor Roger Bivand:
> > > 
> > >     Yes, I was talking about the two SAR fitting functions. I just did a
> > > very quick run on a dataset with 3437 observations (those are point data,
> > > and I generate the listw object using dnearneigh() - not sure whether the
> > > result is symmetric or asymmetric). 
> > 
> > How many links are there in the neighbour list? Distance neighbours are 
> > symmetric, but if points are densely placed, there may be parts of your 
> > study area with many neighbours. Use print.nb() to find out how many.
> > 
> > > However, I tried both "sparse" and
> > > "SparseM" method on errorsarlm(), both failed to go through, the errors
> > > given as follow:
> > > 
> > >     For "sparse" method:
> > >     "Error in spwdet(sparseweights, rho = rho, debug = debug) : 
> > >         Suspicious allocation of memory in sparse functions
> > >          ...bailing out! Save workspace and quit R!"
> > 
> > Yes, this is the memory bug. It does happen on most/all GCC compiled 
> > versions, but I've seen BSD versions that work - it depends on the memory 
> > allocation code, but it has not been possible to solve. I am planning to 
> > drop "sparse" before long, unless the memory bug is resolved.
> > 
> > > 
> > >     For "SparseM" method:
> > >     "Error in .local(x, ...) : Increase tmpmax
> > 
> > This is the problem: tmpmax is defined in chol() for "matrix.csr" objects 
> > as only 10 times the number of rows. I think you have more neighbour links 
> > than 10*n, and that means I need to find a way of passing a better value 
> > through. Please let me know, this looks do-able.
> > 
> > Roger
> > 
> > >      Error in det(chol(x)) : Unable to find the argument "x" in selecting
> > >      a method for function "det" "
> > > 
> > >     By the way, I am still using R 2.0.0 and when I loaded the libraries,
> > > I got warnings. I will keep trying and keep you posted as I progress.
> > > Thanks.
> > > 
> > > 
> > > On Mon, 13 Dec 2004, Roger Bivand wrote:
> > > 
> > > > On Mon, 13 Dec 2004, Danlin Yu wrote:
> > > > 
> > > > > Dear Mihai Nica:
> > > > > 
> > > > >     I think it is a memory issue, too. I ran into the same problem when
> > > > > using around 3000 observations. Although I used memory.size() to increase
> > > > > the memroy allocation size, spdep took too long to run.
> > > > > 
> > > > 
> > > > I think you mean the two SAR fitting functions, lagsarlm() and 
> > > > errorsarlm()? The default method is "eigen", which does need plenty of 
> > > > memory with large n (because it both solves the eigenproblem for an nxn 
> > > > matrix, and later inverts an nxn matrix). There has always been a "sparse" 
> > > > method using code from Netlib called sparse from UCB, which works on some 
> > > > platforms, but not others, and has an unresolved memory bug. 
> > > > 
> > > > I'm pleased to report that Roger Koenker has been kind enough to add a
> > > > det() for symmetric (and similar to symmetric) sparse matrices to the
> > > > SparseM package. From spdep_0.3-5, spdep depends on SparseM, and
> > > > errorsarlm() is now pretty dependable for large n and fast. lagsarlm() is
> > > > dependable, but its fitting speed is slowed by fitting models for LR tests
> > > > dropping each of the X variables in turn, as well as the specified model,
> > > > so that it fits k models, not just 1. The function calls for the lag
> > > > models are cheaper than the error models, though.
> > > > 
> > > > The restriction to symmetric (and similar to symmetric) sparse matrices is
> > > > important to bear in mind. With symmetric neighbour lists (contiguity,
> > > > graphe-based and distance bands), and even symmetric inverse distances,
> > > > and all weighting styles this is OK (because "W" and "S" style are similar
> > > > to symmetric, and the others are symmetric), but absolutely not for
> > > > k-nearest-neighbours or for asymmetric general weights (say migration
> > > > tables).
> > > > 
> > > > I would be very interested in hearing whether this approach is helpful, 
> > > > and how this scales.
> > > > 
> > > > Roger
> > > > 
> > > > >     The problem, I think, might be due to the fact that spdep's spatial
> > > > > autoregressive models use the exact method (correct me if I am wrong),
> > > > > while GeoDa uses an approximatioin method (see the paper "Fast maximum
> > > > > likelihood estimation of very large spatial autoregressive models: a
> > > > > characteristic polynomial approach", in Computational Statistics & Data
> > > > > Analysis 35 (2001) 301-319). If the method could be incorporated in R, it
> > > > > will be great.
> > > > > 
> > > > >     Danlin
> > > > > 
> > > > > On Mon, 13 Dec 2004, Mihai Nica wrote:
> > > > > 
> > > > > > Greetings:
> > > > > > 
> > > > > > I would like to take advantage of this thread and ask if there is a way to
> > > > > > "enhance" the code in spdep. I have a dataset with 3030 observations and two
> > > > > > independent variables. On the same old computer it runs great in GeoDa, but
> > > > > > fails in R. I assume it is a memory issue, but having two different ways to
> > > > > > check my results would be great.
> > > > > > 
> > > > > > Thanks,
> > > > > > 
> > > > > > Mihai Nica
> > > > > > Jackson State University
> > > > > > 155 B Parkhurst Dr.
> > > > > > Jackson, MS 39202
> > > > > > 601 914 0361
> > > > > > 
> > > > > > ----- Original Message ----- 
> > > > > > From: "Luc Anselin" <anselin at uiuc.edu>
> > > > > > To: "Darla Munroe" <munroe.9 at osu.edu>
> > > > > > Cc: <r-sig-geo at stat.math.ethz.ch>
> > > > > > Sent: Monday, December 13, 2004 8:36 AM
> > > > > > Subject: Re: [R-sig-Geo] spatial 2SLS
> > > > > > 
> > > > > > 
> > > > > > > I have some functions that implement this. We used them in last summer's
> > > > > > > ICPSR spatial regression course. They are not (yet) very user friendly
> > > > > > > and
> > > > > > > not up to official R standards yet, but they definitely work.
> > > > > > > The functions include:
> > > > > > > - standard 2SLS (or IV estimation)
> > > > > > > - spatial 2SLS (using WX as instruments for Wy)
> > > > > > > - heteroskedastic robust spatial 2SLS (White adjusted variances)
> > > > > > > Anyone who wants them and doesn't need a lot of hand holding can e-mail
> > > > > > > me directly.
> > > > > > > L.
> > > > > > >
> > > > > > >
> > > > > > > On Dec 13, 2004, at 8:21 AM, Darla Munroe wrote:
> > > > > > >
> > > > > > > > Is the spatial 2SLS developed by Kelejian available in spdep?  If not,
> > > > > > > > is it
> > > > > > > > available anywhere else at this time?  (besides in SpaceStat).
> > > > > > > >
> > > > > > > >
> > > > > > > >
> > > > > > > > Thanks,
> > > > > > > >
> > > > > > > > Darla Munroe
> > > > > > > >
> > > > > > > >
> > > > > > > > [[alternative HTML version deleted]]
> > > > > > > >
> > > > > > > > _______________________________________________
> > > > > > > > R-sig-Geo mailing list
> > > > > > > > R-sig-Geo at stat.math.ethz.ch
> > > > > > > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > > > > > > >
> > > > > > >
> > > > > > > _______________________________________________
> > > > > > > R-sig-Geo mailing list
> > > > > > > R-sig-Geo at stat.math.ethz.ch
> > > > > > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > > > > > >
> > > > > > 
> > > > > > _______________________________________________
> > > > > > R-sig-Geo mailing list
> > > > > > R-sig-Geo at stat.math.ethz.ch
> > > > > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > > > > > 
> > > > > 
> > > > >     Sincerely,
> > > > >     Danlin Yu
> > > > > 
> > > > > ----------------------------------
> > > > > Lecturer, Ph.D. Candidate
> > > > > Department of Geography
> > > > > University of Wisconsin, Milwaukee
> > > > > Tel: (414)229-3943
> > > > > Fax: (414)229-3981
> > > > > Email: danlinyu at uwm.edu
> > > > > 
> > > > > _______________________________________________
> > > > > R-sig-Geo mailing list
> > > > > R-sig-Geo at stat.math.ethz.ch
> > > > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > > > > 
> > > > 
> > > > -- 
> > > > Roger Bivand
> > > > Economic Geography Section, Department of Economics, Norwegian School of
> > > > Economics and Business Administration, Breiviksveien 40, N-5045 Bergen,
> > > > Norway. voice: +47 55 95 93 55; fax +47 55 95 93 93
> > > > e-mail: Roger.Bivand at nhh.no
> > > > 
> > > > 
> > > 
> > >     Sincerely,
> > >     Danlin Yu
> > > 
> > > ----------------------------------
> > > Lecturer, Ph.D. Candidate
> > > Department of Geography
> > > University of Wisconsin, Milwaukee
> > > Tel: (414)229-3943
> > > Fax: (414)229-3981
> > > Email: danlinyu at uwm.edu
> > > ----------------------------------
> > > 
> > > 
> > 
> > -- 
> > Roger Bivand
> > Economic Geography Section, Department of Economics, Norwegian School of
> > Economics and Business Administration, Breiviksveien 40, N-5045 Bergen,
> > Norway. voice: +47 55 95 93 55; fax +47 55 95 93 93
> > e-mail: Roger.Bivand at nhh.no
> > 
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at stat.math.ethz.ch
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > 
> 
>     Sincerely,
>     Danlin Yu
> 
> ----------------------------------
> Lecturer, Ph.D. Candidate
> Department of Geography
> University of Wisconsin, Milwaukee
> Tel: (414)229-3943
> Fax: (414)229-3981
> Email: danlinyu at uwm.edu
> ----------------------------------
> 
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Breiviksveien 40, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 93 93
e-mail: Roger.Bivand at nhh.no



From danlinyu at csd.uwm.edu  Mon Dec 13 21:30:08 2004
From: danlinyu at csd.uwm.edu (Danlin Yu)
Date: Mon, 13 Dec 2004 14:30:08 -0600 (CST)
Subject: [R-sig-Geo] Fitting SAR models in spdep (was: spatial 2SLS)
In-Reply-To: <Pine.LNX.4.44.0412132109470.31922-100000@reclus.nhh.no>
Message-ID: <Pine.OSF.3.96.1041213142744.31185G-100000@alpha1.csd.uwm.edu>

Dear Professor Roger Bivand:

    Yes, it worked! The same set of data (3437), and same neighbor list
(listw), on my computer (a laptop), for the errorsarlm(), using method
"SparseM", it worked within 5 minutes, no error reported. Is the
lagsarlm() the same?

On Mon, 13 Dec 2004, Roger Bivand wrote:

> On Mon, 13 Dec 2004, Danlin Yu wrote:
> 
> > Dear Professor Roger Bivand:
> > 
> >    Yes, you are right, the total number of links is 686040, much more than
> > 10*n (that is 3437) in the dataset.
> > 
> >    Some of the study area is really dense in data, but some is really
> > sparse. So the chosen distance ensuring there won't be any non-zero links
> > yield a large number of links. The actual reports from print.nb follows:
> > 
> > Neighbour list object:
> > Number of regions: 3437 
> > Number of nonzero links: 686040 
> > Percentage nonzero weights: 5.807515 
> > Average number of links: 199.6043
> > 
> >    Please keep me posted if the chol() problem is solved. Thanks. Danlin
> 
> Please try pre-release version 0.3-6 - source and Windows binary packages 
> on: http://spatial.nhh.no/R/spdep/
> 
> It would be good if this works. I think, though, that a graph-based 
> neighbour list (SOI graph, for example) would be a more natural choice 
> than distances, but for testing, this neighbour list is very suitable.
> 
> Roger
> 
> > 
> > On Mon, 13 Dec 2004, Roger Bivand wrote:
> > 
> > > On Mon, 13 Dec 2004, Danlin Yu wrote:
> > > 
> > > > Dear Professor Roger Bivand:
> > > > 
> > > >     Yes, I was talking about the two SAR fitting functions. I just did a
> > > > very quick run on a dataset with 3437 observations (those are point data,
> > > > and I generate the listw object using dnearneigh() - not sure whether the
> > > > result is symmetric or asymmetric). 
> > > 
> > > How many links are there in the neighbour list? Distance neighbours are 
> > > symmetric, but if points are densely placed, there may be parts of your 
> > > study area with many neighbours. Use print.nb() to find out how many.
> > > 
> > > > However, I tried both "sparse" and
> > > > "SparseM" method on errorsarlm(), both failed to go through, the errors
> > > > given as follow:
> > > > 
> > > >     For "sparse" method:
> > > >     "Error in spwdet(sparseweights, rho = rho, debug = debug) : 
> > > >         Suspicious allocation of memory in sparse functions
> > > >          ...bailing out! Save workspace and quit R!"
> > > 
> > > Yes, this is the memory bug. It does happen on most/all GCC compiled 
> > > versions, but I've seen BSD versions that work - it depends on the memory 
> > > allocation code, but it has not been possible to solve. I am planning to 
> > > drop "sparse" before long, unless the memory bug is resolved.
> > > 
> > > > 
> > > >     For "SparseM" method:
> > > >     "Error in .local(x, ...) : Increase tmpmax
> > > 
> > > This is the problem: tmpmax is defined in chol() for "matrix.csr" objects 
> > > as only 10 times the number of rows. I think you have more neighbour links 
> > > than 10*n, and that means I need to find a way of passing a better value 
> > > through. Please let me know, this looks do-able.
> > > 
> > > Roger
> > > 
> > > >      Error in det(chol(x)) : Unable to find the argument "x" in selecting
> > > >      a method for function "det" "
> > > > 
> > > >     By the way, I am still using R 2.0.0 and when I loaded the libraries,
> > > > I got warnings. I will keep trying and keep you posted as I progress.
> > > > Thanks.
> > > > 
> > > > 
> > > > On Mon, 13 Dec 2004, Roger Bivand wrote:
> > > > 
> > > > > On Mon, 13 Dec 2004, Danlin Yu wrote:
> > > > > 
> > > > > > Dear Mihai Nica:
> > > > > > 
> > > > > >     I think it is a memory issue, too. I ran into the same problem when
> > > > > > using around 3000 observations. Although I used memory.size() to increase
> > > > > > the memroy allocation size, spdep took too long to run.
> > > > > > 
> > > > > 
> > > > > I think you mean the two SAR fitting functions, lagsarlm() and 
> > > > > errorsarlm()? The default method is "eigen", which does need plenty of 
> > > > > memory with large n (because it both solves the eigenproblem for an nxn 
> > > > > matrix, and later inverts an nxn matrix). There has always been a "sparse" 
> > > > > method using code from Netlib called sparse from UCB, which works on some 
> > > > > platforms, but not others, and has an unresolved memory bug. 
> > > > > 
> > > > > I'm pleased to report that Roger Koenker has been kind enough to add a
> > > > > det() for symmetric (and similar to symmetric) sparse matrices to the
> > > > > SparseM package. From spdep_0.3-5, spdep depends on SparseM, and
> > > > > errorsarlm() is now pretty dependable for large n and fast. lagsarlm() is
> > > > > dependable, but its fitting speed is slowed by fitting models for LR tests
> > > > > dropping each of the X variables in turn, as well as the specified model,
> > > > > so that it fits k models, not just 1. The function calls for the lag
> > > > > models are cheaper than the error models, though.
> > > > > 
> > > > > The restriction to symmetric (and similar to symmetric) sparse matrices is
> > > > > important to bear in mind. With symmetric neighbour lists (contiguity,
> > > > > graphe-based and distance bands), and even symmetric inverse distances,
> > > > > and all weighting styles this is OK (because "W" and "S" style are similar
> > > > > to symmetric, and the others are symmetric), but absolutely not for
> > > > > k-nearest-neighbours or for asymmetric general weights (say migration
> > > > > tables).
> > > > > 
> > > > > I would be very interested in hearing whether this approach is helpful, 
> > > > > and how this scales.
> > > > > 
> > > > > Roger
> > > > > 
> > > > > >     The problem, I think, might be due to the fact that spdep's spatial
> > > > > > autoregressive models use the exact method (correct me if I am wrong),
> > > > > > while GeoDa uses an approximatioin method (see the paper "Fast maximum
> > > > > > likelihood estimation of very large spatial autoregressive models: a
> > > > > > characteristic polynomial approach", in Computational Statistics & Data
> > > > > > Analysis 35 (2001) 301-319). If the method could be incorporated in R, it
> > > > > > will be great.
> > > > > > 
> > > > > >     Danlin
> > > > > > 
> > > > > > On Mon, 13 Dec 2004, Mihai Nica wrote:
> > > > > > 
> > > > > > > Greetings:
> > > > > > > 
> > > > > > > I would like to take advantage of this thread and ask if there is a way to
> > > > > > > "enhance" the code in spdep. I have a dataset with 3030 observations and two
> > > > > > > independent variables. On the same old computer it runs great in GeoDa, but
> > > > > > > fails in R. I assume it is a memory issue, but having two different ways to
> > > > > > > check my results would be great.
> > > > > > > 
> > > > > > > Thanks,
> > > > > > > 
> > > > > > > Mihai Nica
> > > > > > > Jackson State University
> > > > > > > 155 B Parkhurst Dr.
> > > > > > > Jackson, MS 39202
> > > > > > > 601 914 0361
> > > > > > > 
> > > > > > > ----- Original Message ----- 
> > > > > > > From: "Luc Anselin" <anselin at uiuc.edu>
> > > > > > > To: "Darla Munroe" <munroe.9 at osu.edu>
> > > > > > > Cc: <r-sig-geo at stat.math.ethz.ch>
> > > > > > > Sent: Monday, December 13, 2004 8:36 AM
> > > > > > > Subject: Re: [R-sig-Geo] spatial 2SLS
> > > > > > > 
> > > > > > > 
> > > > > > > > I have some functions that implement this. We used them in last summer's
> > > > > > > > ICPSR spatial regression course. They are not (yet) very user friendly
> > > > > > > > and
> > > > > > > > not up to official R standards yet, but they definitely work.
> > > > > > > > The functions include:
> > > > > > > > - standard 2SLS (or IV estimation)
> > > > > > > > - spatial 2SLS (using WX as instruments for Wy)
> > > > > > > > - heteroskedastic robust spatial 2SLS (White adjusted variances)
> > > > > > > > Anyone who wants them and doesn't need a lot of hand holding can e-mail
> > > > > > > > me directly.
> > > > > > > > L.
> > > > > > > >
> > > > > > > >
> > > > > > > > On Dec 13, 2004, at 8:21 AM, Darla Munroe wrote:
> > > > > > > >
> > > > > > > > > Is the spatial 2SLS developed by Kelejian available in spdep?  If not,
> > > > > > > > > is it
> > > > > > > > > available anywhere else at this time?  (besides in SpaceStat).
> > > > > > > > >
> > > > > > > > >
> > > > > > > > >
> > > > > > > > > Thanks,
> > > > > > > > >
> > > > > > > > > Darla Munroe
> > > > > > > > >
> > > > > > > > >
> > > > > > > > > [[alternative HTML version deleted]]
> > > > > > > > >
> > > > > > > > > _______________________________________________
> > > > > > > > > R-sig-Geo mailing list
> > > > > > > > > R-sig-Geo at stat.math.ethz.ch
> > > > > > > > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > > > > > > > >
> > > > > > > >
> > > > > > > > _______________________________________________
> > > > > > > > R-sig-Geo mailing list
> > > > > > > > R-sig-Geo at stat.math.ethz.ch
> > > > > > > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > > > > > > >
> > > > > > > 
> > > > > > > _______________________________________________
> > > > > > > R-sig-Geo mailing list
> > > > > > > R-sig-Geo at stat.math.ethz.ch
> > > > > > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > > > > > > 
> > > > > > 
> > > > > >     Sincerely,
> > > > > >     Danlin Yu
> > > > > > 
> > > > > > ----------------------------------
> > > > > > Lecturer, Ph.D. Candidate
> > > > > > Department of Geography
> > > > > > University of Wisconsin, Milwaukee
> > > > > > Tel: (414)229-3943
> > > > > > Fax: (414)229-3981
> > > > > > Email: danlinyu at uwm.edu
> > > > > > 
> > > > > > _______________________________________________
> > > > > > R-sig-Geo mailing list
> > > > > > R-sig-Geo at stat.math.ethz.ch
> > > > > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > > > > > 
> > > > > 
> > > > > -- 
> > > > > Roger Bivand
> > > > > Economic Geography Section, Department of Economics, Norwegian School of
> > > > > Economics and Business Administration, Breiviksveien 40, N-5045 Bergen,
> > > > > Norway. voice: +47 55 95 93 55; fax +47 55 95 93 93
> > > > > e-mail: Roger.Bivand at nhh.no
> > > > > 
> > > > > 
> > > > 
> > > >     Sincerely,
> > > >     Danlin Yu
> > > > 
> > > > ----------------------------------
> > > > Lecturer, Ph.D. Candidate
> > > > Department of Geography
> > > > University of Wisconsin, Milwaukee
> > > > Tel: (414)229-3943
> > > > Fax: (414)229-3981
> > > > Email: danlinyu at uwm.edu
> > > > ----------------------------------
> > > > 
> > > > 
> > > 
> > > -- 
> > > Roger Bivand
> > > Economic Geography Section, Department of Economics, Norwegian School of
> > > Economics and Business Administration, Breiviksveien 40, N-5045 Bergen,
> > > Norway. voice: +47 55 95 93 55; fax +47 55 95 93 93
> > > e-mail: Roger.Bivand at nhh.no
> > > 
> > > _______________________________________________
> > > R-sig-Geo mailing list
> > > R-sig-Geo at stat.math.ethz.ch
> > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > > 
> > 
> >     Sincerely,
> >     Danlin Yu
> > 
> > ----------------------------------
> > Lecturer, Ph.D. Candidate
> > Department of Geography
> > University of Wisconsin, Milwaukee
> > Tel: (414)229-3943
> > Fax: (414)229-3981
> > Email: danlinyu at uwm.edu
> > ----------------------------------
> > 
> > 
> 
> -- 
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Breiviksveien 40, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 93 93
> e-mail: Roger.Bivand at nhh.no
> 
> 

    Sincerely,
    Danlin Yu

----------------------------------
Lecturer, Ph.D. Candidate
Department of Geography
University of Wisconsin, Milwaukee
Tel: (414)229-3943
Fax: (414)229-3981
Email: danlinyu at uwm.edu



From Roger.Bivand at nhh.no  Mon Dec 13 21:43:15 2004
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 13 Dec 2004 21:43:15 +0100 (CET)
Subject: [R-sig-Geo] Fitting SAR models in spdep (was: spatial 2SLS)
In-Reply-To: <Pine.OSF.3.96.1041213142744.31185G-100000@alpha1.csd.uwm.edu>
Message-ID: <Pine.LNX.4.44.0412132137230.31922-100000@reclus.nhh.no>

On Mon, 13 Dec 2004, Danlin Yu wrote:

> Dear Professor Roger Bivand:
> 
>     Yes, it worked! The same set of data (3437), and same neighbor list
> (listw), on my computer (a laptop), for the errorsarlm(), using method
> "SparseM", it worked within 5 minutes, no error reported. Is the
> lagsarlm() the same?

Yes, I hope so, the same value is passed to tmpmax, the sum of the number 
of neighbour links (the off-diagonal non-zero values) and n (the 
diagonal). Five minutes is not fast, but it's not bad, and the results 
should be reliable. The big advantage of using SparseM is that Professors 
Roger Koenker and Pin Ng are maintaining the package actively, and using 
it for plenty of other work, so any problems are very likely to be found 
quickly.

If nobody reports serious problems, I'll submit 0.3-6 to CRAN on Tuesday.

Roger

> 
> On Mon, 13 Dec 2004, Roger Bivand wrote:
> 
> > On Mon, 13 Dec 2004, Danlin Yu wrote:
> > 
> > > Dear Professor Roger Bivand:
> > > 
> > >    Yes, you are right, the total number of links is 686040, much more than
> > > 10*n (that is 3437) in the dataset.
> > > 
> > >    Some of the study area is really dense in data, but some is really
> > > sparse. So the chosen distance ensuring there won't be any non-zero links
> > > yield a large number of links. The actual reports from print.nb follows:
> > > 
> > > Neighbour list object:
> > > Number of regions: 3437 
> > > Number of nonzero links: 686040 
> > > Percentage nonzero weights: 5.807515 
> > > Average number of links: 199.6043
> > > 
> > >    Please keep me posted if the chol() problem is solved. Thanks. Danlin
> > 
> > Please try pre-release version 0.3-6 - source and Windows binary packages 
> > on: http://spatial.nhh.no/R/spdep/
> > 
> > It would be good if this works. I think, though, that a graph-based 
> > neighbour list (SOI graph, for example) would be a more natural choice 
> > than distances, but for testing, this neighbour list is very suitable.
> > 
> > Roger
> > 
> > > 
> > > On Mon, 13 Dec 2004, Roger Bivand wrote:
> > > 
> > > > On Mon, 13 Dec 2004, Danlin Yu wrote:
> > > > 
> > > > > Dear Professor Roger Bivand:
> > > > > 
> > > > >     Yes, I was talking about the two SAR fitting functions. I just did a
> > > > > very quick run on a dataset with 3437 observations (those are point data,
> > > > > and I generate the listw object using dnearneigh() - not sure whether the
> > > > > result is symmetric or asymmetric). 
> > > > 
> > > > How many links are there in the neighbour list? Distance neighbours are 
> > > > symmetric, but if points are densely placed, there may be parts of your 
> > > > study area with many neighbours. Use print.nb() to find out how many.
> > > > 
> > > > > However, I tried both "sparse" and
> > > > > "SparseM" method on errorsarlm(), both failed to go through, the errors
> > > > > given as follow:
> > > > > 
> > > > >     For "sparse" method:
> > > > >     "Error in spwdet(sparseweights, rho = rho, debug = debug) : 
> > > > >         Suspicious allocation of memory in sparse functions
> > > > >          ...bailing out! Save workspace and quit R!"
> > > > 
> > > > Yes, this is the memory bug. It does happen on most/all GCC compiled 
> > > > versions, but I've seen BSD versions that work - it depends on the memory 
> > > > allocation code, but it has not been possible to solve. I am planning to 
> > > > drop "sparse" before long, unless the memory bug is resolved.
> > > > 
> > > > > 
> > > > >     For "SparseM" method:
> > > > >     "Error in .local(x, ...) : Increase tmpmax
> > > > 
> > > > This is the problem: tmpmax is defined in chol() for "matrix.csr" objects 
> > > > as only 10 times the number of rows. I think you have more neighbour links 
> > > > than 10*n, and that means I need to find a way of passing a better value 
> > > > through. Please let me know, this looks do-able.
> > > > 
> > > > Roger
> > > > 
> > > > >      Error in det(chol(x)) : Unable to find the argument "x" in selecting
> > > > >      a method for function "det" "
> > > > > 
> > > > >     By the way, I am still using R 2.0.0 and when I loaded the libraries,
> > > > > I got warnings. I will keep trying and keep you posted as I progress.
> > > > > Thanks.
> > > > > 
> > > > > 
> > > > > On Mon, 13 Dec 2004, Roger Bivand wrote:
> > > > > 
> > > > > > On Mon, 13 Dec 2004, Danlin Yu wrote:
> > > > > > 
> > > > > > > Dear Mihai Nica:
> > > > > > > 
> > > > > > >     I think it is a memory issue, too. I ran into the same problem when
> > > > > > > using around 3000 observations. Although I used memory.size() to increase
> > > > > > > the memroy allocation size, spdep took too long to run.
> > > > > > > 
> > > > > > 
> > > > > > I think you mean the two SAR fitting functions, lagsarlm() and 
> > > > > > errorsarlm()? The default method is "eigen", which does need plenty of 
> > > > > > memory with large n (because it both solves the eigenproblem for an nxn 
> > > > > > matrix, and later inverts an nxn matrix). There has always been a "sparse" 
> > > > > > method using code from Netlib called sparse from UCB, which works on some 
> > > > > > platforms, but not others, and has an unresolved memory bug. 
> > > > > > 
> > > > > > I'm pleased to report that Roger Koenker has been kind enough to add a
> > > > > > det() for symmetric (and similar to symmetric) sparse matrices to the
> > > > > > SparseM package. From spdep_0.3-5, spdep depends on SparseM, and
> > > > > > errorsarlm() is now pretty dependable for large n and fast. lagsarlm() is
> > > > > > dependable, but its fitting speed is slowed by fitting models for LR tests
> > > > > > dropping each of the X variables in turn, as well as the specified model,
> > > > > > so that it fits k models, not just 1. The function calls for the lag
> > > > > > models are cheaper than the error models, though.
> > > > > > 
> > > > > > The restriction to symmetric (and similar to symmetric) sparse matrices is
> > > > > > important to bear in mind. With symmetric neighbour lists (contiguity,
> > > > > > graphe-based and distance bands), and even symmetric inverse distances,
> > > > > > and all weighting styles this is OK (because "W" and "S" style are similar
> > > > > > to symmetric, and the others are symmetric), but absolutely not for
> > > > > > k-nearest-neighbours or for asymmetric general weights (say migration
> > > > > > tables).
> > > > > > 
> > > > > > I would be very interested in hearing whether this approach is helpful, 
> > > > > > and how this scales.
> > > > > > 
> > > > > > Roger
> > > > > > 
> > > > > > >     The problem, I think, might be due to the fact that spdep's spatial
> > > > > > > autoregressive models use the exact method (correct me if I am wrong),
> > > > > > > while GeoDa uses an approximatioin method (see the paper "Fast maximum
> > > > > > > likelihood estimation of very large spatial autoregressive models: a
> > > > > > > characteristic polynomial approach", in Computational Statistics & Data
> > > > > > > Analysis 35 (2001) 301-319). If the method could be incorporated in R, it
> > > > > > > will be great.
> > > > > > > 
> > > > > > >     Danlin
> > > > > > > 
> > > > > > > On Mon, 13 Dec 2004, Mihai Nica wrote:
> > > > > > > 
> > > > > > > > Greetings:
> > > > > > > > 
> > > > > > > > I would like to take advantage of this thread and ask if there is a way to
> > > > > > > > "enhance" the code in spdep. I have a dataset with 3030 observations and two
> > > > > > > > independent variables. On the same old computer it runs great in GeoDa, but
> > > > > > > > fails in R. I assume it is a memory issue, but having two different ways to
> > > > > > > > check my results would be great.
> > > > > > > > 
> > > > > > > > Thanks,
> > > > > > > > 
> > > > > > > > Mihai Nica
> > > > > > > > Jackson State University
> > > > > > > > 155 B Parkhurst Dr.
> > > > > > > > Jackson, MS 39202
> > > > > > > > 601 914 0361
> > > > > > > > 
> > > > > > > > ----- Original Message ----- 
> > > > > > > > From: "Luc Anselin" <anselin at uiuc.edu>
> > > > > > > > To: "Darla Munroe" <munroe.9 at osu.edu>
> > > > > > > > Cc: <r-sig-geo at stat.math.ethz.ch>
> > > > > > > > Sent: Monday, December 13, 2004 8:36 AM
> > > > > > > > Subject: Re: [R-sig-Geo] spatial 2SLS
> > > > > > > > 
> > > > > > > > 
> > > > > > > > > I have some functions that implement this. We used them in last summer's
> > > > > > > > > ICPSR spatial regression course. They are not (yet) very user friendly
> > > > > > > > > and
> > > > > > > > > not up to official R standards yet, but they definitely work.
> > > > > > > > > The functions include:
> > > > > > > > > - standard 2SLS (or IV estimation)
> > > > > > > > > - spatial 2SLS (using WX as instruments for Wy)
> > > > > > > > > - heteroskedastic robust spatial 2SLS (White adjusted variances)
> > > > > > > > > Anyone who wants them and doesn't need a lot of hand holding can e-mail
> > > > > > > > > me directly.
> > > > > > > > > L.
> > > > > > > > >
> > > > > > > > >
> > > > > > > > > On Dec 13, 2004, at 8:21 AM, Darla Munroe wrote:
> > > > > > > > >
> > > > > > > > > > Is the spatial 2SLS developed by Kelejian available in spdep?  If not,
> > > > > > > > > > is it
> > > > > > > > > > available anywhere else at this time?  (besides in SpaceStat).
> > > > > > > > > >
> > > > > > > > > >
> > > > > > > > > >
> > > > > > > > > > Thanks,
> > > > > > > > > >
> > > > > > > > > > Darla Munroe
> > > > > > > > > >
> > > > > > > > > >
> > > > > > > > > > [[alternative HTML version deleted]]
> > > > > > > > > >
> > > > > > > > > > _______________________________________________
> > > > > > > > > > R-sig-Geo mailing list
> > > > > > > > > > R-sig-Geo at stat.math.ethz.ch
> > > > > > > > > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > > > > > > > > >
> > > > > > > > >
> > > > > > > > > _______________________________________________
> > > > > > > > > R-sig-Geo mailing list
> > > > > > > > > R-sig-Geo at stat.math.ethz.ch
> > > > > > > > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > > > > > > > >
> > > > > > > > 
> > > > > > > > _______________________________________________
> > > > > > > > R-sig-Geo mailing list
> > > > > > > > R-sig-Geo at stat.math.ethz.ch
> > > > > > > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > > > > > > > 
> > > > > > > 
> > > > > > >     Sincerely,
> > > > > > >     Danlin Yu
> > > > > > > 
> > > > > > > ----------------------------------
> > > > > > > Lecturer, Ph.D. Candidate
> > > > > > > Department of Geography
> > > > > > > University of Wisconsin, Milwaukee
> > > > > > > Tel: (414)229-3943
> > > > > > > Fax: (414)229-3981
> > > > > > > Email: danlinyu at uwm.edu
> > > > > > > 
> > > > > > > _______________________________________________
> > > > > > > R-sig-Geo mailing list
> > > > > > > R-sig-Geo at stat.math.ethz.ch
> > > > > > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > > > > > > 
> > > > > > 
> > > > > > -- 
> > > > > > Roger Bivand
> > > > > > Economic Geography Section, Department of Economics, Norwegian School of
> > > > > > Economics and Business Administration, Breiviksveien 40, N-5045 Bergen,
> > > > > > Norway. voice: +47 55 95 93 55; fax +47 55 95 93 93
> > > > > > e-mail: Roger.Bivand at nhh.no
> > > > > > 
> > > > > > 
> > > > > 
> > > > >     Sincerely,
> > > > >     Danlin Yu
> > > > > 
> > > > > ----------------------------------
> > > > > Lecturer, Ph.D. Candidate
> > > > > Department of Geography
> > > > > University of Wisconsin, Milwaukee
> > > > > Tel: (414)229-3943
> > > > > Fax: (414)229-3981
> > > > > Email: danlinyu at uwm.edu
> > > > > ----------------------------------
> > > > > 
> > > > > 
> > > > 
> > > > -- 
> > > > Roger Bivand
> > > > Economic Geography Section, Department of Economics, Norwegian School of
> > > > Economics and Business Administration, Breiviksveien 40, N-5045 Bergen,
> > > > Norway. voice: +47 55 95 93 55; fax +47 55 95 93 93
> > > > e-mail: Roger.Bivand at nhh.no
> > > > 
> > > > _______________________________________________
> > > > R-sig-Geo mailing list
> > > > R-sig-Geo at stat.math.ethz.ch
> > > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > > > 
> > > 
> > >     Sincerely,
> > >     Danlin Yu
> > > 
> > > ----------------------------------
> > > Lecturer, Ph.D. Candidate
> > > Department of Geography
> > > University of Wisconsin, Milwaukee
> > > Tel: (414)229-3943
> > > Fax: (414)229-3981
> > > Email: danlinyu at uwm.edu
> > > ----------------------------------
> > > 
> > > 
> > 
> > -- 
> > Roger Bivand
> > Economic Geography Section, Department of Economics, Norwegian School of
> > Economics and Business Administration, Breiviksveien 40, N-5045 Bergen,
> > Norway. voice: +47 55 95 93 55; fax +47 55 95 93 93
> > e-mail: Roger.Bivand at nhh.no
> > 
> > 
> 
>     Sincerely,
>     Danlin Yu
> 
> ----------------------------------
> Lecturer, Ph.D. Candidate
> Department of Geography
> University of Wisconsin, Milwaukee
> Tel: (414)229-3943
> Fax: (414)229-3981
> Email: danlinyu at uwm.edu
> ----------------------------------
> 
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Breiviksveien 40, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 93 93
e-mail: Roger.Bivand at nhh.no



From danlinyu at csd.uwm.edu  Mon Dec 13 21:52:41 2004
From: danlinyu at csd.uwm.edu (Danlin Yu)
Date: Mon, 13 Dec 2004 14:52:41 -0600 (CST)
Subject: [R-sig-Geo] Fitting SAR models in spdep (was: spatial 2SLS)
In-Reply-To: <Pine.LNX.4.44.0412132137230.31922-100000@reclus.nhh.no>
Message-ID: <Pine.OSF.3.96.1041213144940.31185H-100000@alpha1.csd.uwm.edu>

Dear Professor Roger Bivand:

    Actually, I just tried lagsarlm() using the same dataset and same
weight list, but it did not go through for two reasons: first, the memory
is still a problem; second, it seems that det() function did not work well
on the lagsarlm(). The actually error message follows:

 Error: cannot allocate vector of size 5386 Kb
 In addition: Warning message: 
 Reached total allocation of 446Mb: see help(memory.size) 
 Error in det(chol((I - rho * W), tmpmax = tmpmax)) : 
    Unable to find the argument "x" in selecting a method for function "det"


On Mon, 13 Dec 2004, Roger Bivand wrote: 

> On Mon, 13 Dec 2004, Danlin Yu wrote:
> 
> > Dear Professor Roger Bivand:
> > 
> >     Yes, it worked! The same set of data (3437), and same neighbor list
> > (listw), on my computer (a laptop), for the errorsarlm(), using method
> > "SparseM", it worked within 5 minutes, no error reported. Is the
> > lagsarlm() the same?
> 
> Yes, I hope so, the same value is passed to tmpmax, the sum of the number 
> of neighbour links (the off-diagonal non-zero values) and n (the 
> diagonal). Five minutes is not fast, but it's not bad, and the results 
> should be reliable. The big advantage of using SparseM is that Professors 
> Roger Koenker and Pin Ng are maintaining the package actively, and using 
> it for plenty of other work, so any problems are very likely to be found 
> quickly.
> 
> If nobody reports serious problems, I'll submit 0.3-6 to CRAN on Tuesday.
> 
> Roger
> 
> > 
> > On Mon, 13 Dec 2004, Roger Bivand wrote:
> > 
> > > On Mon, 13 Dec 2004, Danlin Yu wrote:
> > > 
> > > > Dear Professor Roger Bivand:
> > > > 
> > > >    Yes, you are right, the total number of links is 686040, much more than
> > > > 10*n (that is 3437) in the dataset.
> > > > 
> > > >    Some of the study area is really dense in data, but some is really
> > > > sparse. So the chosen distance ensuring there won't be any non-zero links
> > > > yield a large number of links. The actual reports from print.nb follows:
> > > > 
> > > > Neighbour list object:
> > > > Number of regions: 3437 
> > > > Number of nonzero links: 686040 
> > > > Percentage nonzero weights: 5.807515 
> > > > Average number of links: 199.6043
> > > > 
> > > >    Please keep me posted if the chol() problem is solved. Thanks. Danlin
> > > 
> > > Please try pre-release version 0.3-6 - source and Windows binary packages 
> > > on: http://spatial.nhh.no/R/spdep/
> > > 
> > > It would be good if this works. I think, though, that a graph-based 
> > > neighbour list (SOI graph, for example) would be a more natural choice 
> > > than distances, but for testing, this neighbour list is very suitable.
> > > 
> > > Roger
> > > 
> > > > 
> > > > On Mon, 13 Dec 2004, Roger Bivand wrote:
> > > > 
> > > > > On Mon, 13 Dec 2004, Danlin Yu wrote:
> > > > > 
> > > > > > Dear Professor Roger Bivand:
> > > > > > 
> > > > > >     Yes, I was talking about the two SAR fitting functions. I just did a
> > > > > > very quick run on a dataset with 3437 observations (those are point data,
> > > > > > and I generate the listw object using dnearneigh() - not sure whether the
> > > > > > result is symmetric or asymmetric). 
> > > > > 
> > > > > How many links are there in the neighbour list? Distance neighbours are 
> > > > > symmetric, but if points are densely placed, there may be parts of your 
> > > > > study area with many neighbours. Use print.nb() to find out how many.
> > > > > 
> > > > > > However, I tried both "sparse" and
> > > > > > "SparseM" method on errorsarlm(), both failed to go through, the errors
> > > > > > given as follow:
> > > > > > 
> > > > > >     For "sparse" method:
> > > > > >     "Error in spwdet(sparseweights, rho = rho, debug = debug) : 
> > > > > >         Suspicious allocation of memory in sparse functions
> > > > > >          ...bailing out! Save workspace and quit R!"
> > > > > 
> > > > > Yes, this is the memory bug. It does happen on most/all GCC compiled 
> > > > > versions, but I've seen BSD versions that work - it depends on the memory 
> > > > > allocation code, but it has not been possible to solve. I am planning to 
> > > > > drop "sparse" before long, unless the memory bug is resolved.
> > > > > 
> > > > > > 
> > > > > >     For "SparseM" method:
> > > > > >     "Error in .local(x, ...) : Increase tmpmax
> > > > > 
> > > > > This is the problem: tmpmax is defined in chol() for "matrix.csr" objects 
> > > > > as only 10 times the number of rows. I think you have more neighbour links 
> > > > > than 10*n, and that means I need to find a way of passing a better value 
> > > > > through. Please let me know, this looks do-able.
> > > > > 
> > > > > Roger
> > > > > 
> > > > > >      Error in det(chol(x)) : Unable to find the argument "x" in selecting
> > > > > >      a method for function "det" "
> > > > > > 
> > > > > >     By the way, I am still using R 2.0.0 and when I loaded the libraries,
> > > > > > I got warnings. I will keep trying and keep you posted as I progress.
> > > > > > Thanks.
> > > > > > 
> > > > > > 
> > > > > > On Mon, 13 Dec 2004, Roger Bivand wrote:
> > > > > > 
> > > > > > > On Mon, 13 Dec 2004, Danlin Yu wrote:
> > > > > > > 
> > > > > > > > Dear Mihai Nica:
> > > > > > > > 
> > > > > > > >     I think it is a memory issue, too. I ran into the same problem when
> > > > > > > > using around 3000 observations. Although I used memory.size() to increase
> > > > > > > > the memroy allocation size, spdep took too long to run.
> > > > > > > > 
> > > > > > > 
> > > > > > > I think you mean the two SAR fitting functions, lagsarlm() and 
> > > > > > > errorsarlm()? The default method is "eigen", which does need plenty of 
> > > > > > > memory with large n (because it both solves the eigenproblem for an nxn 
> > > > > > > matrix, and later inverts an nxn matrix). There has always been a "sparse" 
> > > > > > > method using code from Netlib called sparse from UCB, which works on some 
> > > > > > > platforms, but not others, and has an unresolved memory bug. 
> > > > > > > 
> > > > > > > I'm pleased to report that Roger Koenker has been kind enough to add a
> > > > > > > det() for symmetric (and similar to symmetric) sparse matrices to the
> > > > > > > SparseM package. From spdep_0.3-5, spdep depends on SparseM, and
> > > > > > > errorsarlm() is now pretty dependable for large n and fast. lagsarlm() is
> > > > > > > dependable, but its fitting speed is slowed by fitting models for LR tests
> > > > > > > dropping each of the X variables in turn, as well as the specified model,
> > > > > > > so that it fits k models, not just 1. The function calls for the lag
> > > > > > > models are cheaper than the error models, though.
> > > > > > > 
> > > > > > > The restriction to symmetric (and similar to symmetric) sparse matrices is
> > > > > > > important to bear in mind. With symmetric neighbour lists (contiguity,
> > > > > > > graphe-based and distance bands), and even symmetric inverse distances,
> > > > > > > and all weighting styles this is OK (because "W" and "S" style are similar
> > > > > > > to symmetric, and the others are symmetric), but absolutely not for
> > > > > > > k-nearest-neighbours or for asymmetric general weights (say migration
> > > > > > > tables).
> > > > > > > 
> > > > > > > I would be very interested in hearing whether this approach is helpful, 
> > > > > > > and how this scales.
> > > > > > > 
> > > > > > > Roger
> > > > > > > 
> > > > > > > >     The problem, I think, might be due to the fact that spdep's spatial
> > > > > > > > autoregressive models use the exact method (correct me if I am wrong),
> > > > > > > > while GeoDa uses an approximatioin method (see the paper "Fast maximum
> > > > > > > > likelihood estimation of very large spatial autoregressive models: a
> > > > > > > > characteristic polynomial approach", in Computational Statistics & Data
> > > > > > > > Analysis 35 (2001) 301-319). If the method could be incorporated in R, it
> > > > > > > > will be great.
> > > > > > > > 
> > > > > > > >     Danlin
> > > > > > > > 
> > > > > > > > On Mon, 13 Dec 2004, Mihai Nica wrote:
> > > > > > > > 
> > > > > > > > > Greetings:
> > > > > > > > > 
> > > > > > > > > I would like to take advantage of this thread and ask if there is a way to
> > > > > > > > > "enhance" the code in spdep. I have a dataset with 3030 observations and two
> > > > > > > > > independent variables. On the same old computer it runs great in GeoDa, but
> > > > > > > > > fails in R. I assume it is a memory issue, but having two different ways to
> > > > > > > > > check my results would be great.
> > > > > > > > > 
> > > > > > > > > Thanks,
> > > > > > > > > 
> > > > > > > > > Mihai Nica
> > > > > > > > > Jackson State University
> > > > > > > > > 155 B Parkhurst Dr.
> > > > > > > > > Jackson, MS 39202
> > > > > > > > > 601 914 0361
> > > > > > > > > 
> > > > > > > > > ----- Original Message ----- 
> > > > > > > > > From: "Luc Anselin" <anselin at uiuc.edu>
> > > > > > > > > To: "Darla Munroe" <munroe.9 at osu.edu>
> > > > > > > > > Cc: <r-sig-geo at stat.math.ethz.ch>
> > > > > > > > > Sent: Monday, December 13, 2004 8:36 AM
> > > > > > > > > Subject: Re: [R-sig-Geo] spatial 2SLS
> > > > > > > > > 
> > > > > > > > > 
> > > > > > > > > > I have some functions that implement this. We used them in last summer's
> > > > > > > > > > ICPSR spatial regression course. They are not (yet) very user friendly
> > > > > > > > > > and
> > > > > > > > > > not up to official R standards yet, but they definitely work.
> > > > > > > > > > The functions include:
> > > > > > > > > > - standard 2SLS (or IV estimation)
> > > > > > > > > > - spatial 2SLS (using WX as instruments for Wy)
> > > > > > > > > > - heteroskedastic robust spatial 2SLS (White adjusted variances)
> > > > > > > > > > Anyone who wants them and doesn't need a lot of hand holding can e-mail
> > > > > > > > > > me directly.
> > > > > > > > > > L.
> > > > > > > > > >
> > > > > > > > > >
> > > > > > > > > > On Dec 13, 2004, at 8:21 AM, Darla Munroe wrote:
> > > > > > > > > >
> > > > > > > > > > > Is the spatial 2SLS developed by Kelejian available in spdep?  If not,
> > > > > > > > > > > is it
> > > > > > > > > > > available anywhere else at this time?  (besides in SpaceStat).
> > > > > > > > > > >
> > > > > > > > > > >
> > > > > > > > > > >
> > > > > > > > > > > Thanks,
> > > > > > > > > > >
> > > > > > > > > > > Darla Munroe
> > > > > > > > > > >
> > > > > > > > > > >
> > > > > > > > > > > [[alternative HTML version deleted]]
> > > > > > > > > > >
> > > > > > > > > > > _______________________________________________
> > > > > > > > > > > R-sig-Geo mailing list
> > > > > > > > > > > R-sig-Geo at stat.math.ethz.ch
> > > > > > > > > > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > > > > > > > > > >
> > > > > > > > > >
> > > > > > > > > > _______________________________________________
> > > > > > > > > > R-sig-Geo mailing list
> > > > > > > > > > R-sig-Geo at stat.math.ethz.ch
> > > > > > > > > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > > > > > > > > >
> > > > > > > > > 
> > > > > > > > > _______________________________________________
> > > > > > > > > R-sig-Geo mailing list
> > > > > > > > > R-sig-Geo at stat.math.ethz.ch
> > > > > > > > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > > > > > > > > 
> > > > > > > > 
> > > > > > > >     Sincerely,
> > > > > > > >     Danlin Yu
> > > > > > > > 
> > > > > > > > ----------------------------------
> > > > > > > > Lecturer, Ph.D. Candidate
> > > > > > > > Department of Geography
> > > > > > > > University of Wisconsin, Milwaukee
> > > > > > > > Tel: (414)229-3943
> > > > > > > > Fax: (414)229-3981
> > > > > > > > Email: danlinyu at uwm.edu
> > > > > > > > 
> > > > > > > > _______________________________________________
> > > > > > > > R-sig-Geo mailing list
> > > > > > > > R-sig-Geo at stat.math.ethz.ch
> > > > > > > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > > > > > > > 
> > > > > > > 
> > > > > > > -- 
> > > > > > > Roger Bivand
> > > > > > > Economic Geography Section, Department of Economics, Norwegian School of
> > > > > > > Economics and Business Administration, Breiviksveien 40, N-5045 Bergen,
> > > > > > > Norway. voice: +47 55 95 93 55; fax +47 55 95 93 93
> > > > > > > e-mail: Roger.Bivand at nhh.no
> > > > > > > 
> > > > > > > 
> > > > > > 
> > > > > >     Sincerely,
> > > > > >     Danlin Yu
> > > > > > 
> > > > > > ----------------------------------
> > > > > > Lecturer, Ph.D. Candidate
> > > > > > Department of Geography
> > > > > > University of Wisconsin, Milwaukee
> > > > > > Tel: (414)229-3943
> > > > > > Fax: (414)229-3981
> > > > > > Email: danlinyu at uwm.edu
> > > > > > ----------------------------------
> > > > > > 
> > > > > > 
> > > > > 
> > > > > -- 
> > > > > Roger Bivand
> > > > > Economic Geography Section, Department of Economics, Norwegian School of
> > > > > Economics and Business Administration, Breiviksveien 40, N-5045 Bergen,
> > > > > Norway. voice: +47 55 95 93 55; fax +47 55 95 93 93
> > > > > e-mail: Roger.Bivand at nhh.no
> > > > > 
> > > > > _______________________________________________
> > > > > R-sig-Geo mailing list
> > > > > R-sig-Geo at stat.math.ethz.ch
> > > > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > > > > 
> > > > 
> > > >     Sincerely,
> > > >     Danlin Yu
> > > > 
> > > > ----------------------------------
> > > > Lecturer, Ph.D. Candidate
> > > > Department of Geography
> > > > University of Wisconsin, Milwaukee
> > > > Tel: (414)229-3943
> > > > Fax: (414)229-3981
> > > > Email: danlinyu at uwm.edu
> > > > ----------------------------------
> > > > 
> > > > 
> > > 
> > > -- 
> > > Roger Bivand
> > > Economic Geography Section, Department of Economics, Norwegian School of
> > > Economics and Business Administration, Breiviksveien 40, N-5045 Bergen,
> > > Norway. voice: +47 55 95 93 55; fax +47 55 95 93 93
> > > e-mail: Roger.Bivand at nhh.no
> > > 
> > > 
> > 
> >     Sincerely,
> >     Danlin Yu
> > 
> > ----------------------------------
> > Lecturer, Ph.D. Candidate
> > Department of Geography
> > University of Wisconsin, Milwaukee
> > Tel: (414)229-3943
> > Fax: (414)229-3981
> > Email: danlinyu at uwm.edu
> > ----------------------------------
> > 
> > 
> 
> -- 
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Breiviksveien 40, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 93 93
> e-mail: Roger.Bivand at nhh.no
> 
> 

    Sincerely,
    Danlin Yu

----------------------------------
Lecturer, Ph.D. Candidate
Department of Geography
University of Wisconsin, Milwaukee
Tel: (414)229-3943
Fax: (414)229-3981
Email: danlinyu at uwm.edu



From Roger.Bivand at nhh.no  Mon Dec 13 22:08:14 2004
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 13 Dec 2004 22:08:14 +0100 (CET)
Subject: [R-sig-Geo] Fitting SAR models in spdep (was: spatial 2SLS)
In-Reply-To: <Pine.OSF.3.96.1041213144940.31185H-100000@alpha1.csd.uwm.edu>
Message-ID: <Pine.LNX.4.44.0412132204250.31922-100000@reclus.nhh.no>

On Mon, 13 Dec 2004, Danlin Yu wrote:

> Dear Professor Roger Bivand:
> 
>     Actually, I just tried lagsarlm() using the same dataset and same
> weight list, but it did not go through for two reasons: first, the memory
> is still a problem; second, it seems that det() function did not work well
> on the lagsarlm(). The actually error message follows:

No, because the memory limit was reached, the sparse matrix being passed 
to chol() did not exist, provoking the det() error. This is more difficult 
to debug without access to your data - could you make them available? 
Shall we take this off the list until I find a solution?

Roger

> 
>  Error: cannot allocate vector of size 5386 Kb
>  In addition: Warning message: 
>  Reached total allocation of 446Mb: see help(memory.size) 
>  Error in det(chol((I - rho * W), tmpmax = tmpmax)) : 
>     Unable to find the argument "x" in selecting a method for function "det"
> 
> 
> On Mon, 13 Dec 2004, Roger Bivand wrote: 
> 
> > On Mon, 13 Dec 2004, Danlin Yu wrote:
> > 
> > > Dear Professor Roger Bivand:
> > > 
> > >     Yes, it worked! The same set of data (3437), and same neighbor list
> > > (listw), on my computer (a laptop), for the errorsarlm(), using method
> > > "SparseM", it worked within 5 minutes, no error reported. Is the
> > > lagsarlm() the same?
> > 
> > Yes, I hope so, the same value is passed to tmpmax, the sum of the number 
> > of neighbour links (the off-diagonal non-zero values) and n (the 
> > diagonal). Five minutes is not fast, but it's not bad, and the results 
> > should be reliable. The big advantage of using SparseM is that Professors 
> > Roger Koenker and Pin Ng are maintaining the package actively, and using 
> > it for plenty of other work, so any problems are very likely to be found 
> > quickly.
> > 
> > If nobody reports serious problems, I'll submit 0.3-6 to CRAN on Tuesday.
> > 
> > Roger
> > 
> > > 
> > > On Mon, 13 Dec 2004, Roger Bivand wrote:
> > > 
> > > > On Mon, 13 Dec 2004, Danlin Yu wrote:
> > > > 
> > > > > Dear Professor Roger Bivand:
> > > > > 
> > > > >    Yes, you are right, the total number of links is 686040, much more than
> > > > > 10*n (that is 3437) in the dataset.
> > > > > 
> > > > >    Some of the study area is really dense in data, but some is really
> > > > > sparse. So the chosen distance ensuring there won't be any non-zero links
> > > > > yield a large number of links. The actual reports from print.nb follows:
> > > > > 
> > > > > Neighbour list object:
> > > > > Number of regions: 3437 
> > > > > Number of nonzero links: 686040 
> > > > > Percentage nonzero weights: 5.807515 
> > > > > Average number of links: 199.6043
> > > > > 
> > > > >    Please keep me posted if the chol() problem is solved. Thanks. Danlin
> > > > 
> > > > Please try pre-release version 0.3-6 - source and Windows binary packages 
> > > > on: http://spatial.nhh.no/R/spdep/
> > > > 
> > > > It would be good if this works. I think, though, that a graph-based 
> > > > neighbour list (SOI graph, for example) would be a more natural choice 
> > > > than distances, but for testing, this neighbour list is very suitable.
> > > > 
> > > > Roger
> > > > 
> > > > > 
> > > > > On Mon, 13 Dec 2004, Roger Bivand wrote:
> > > > > 
> > > > > > On Mon, 13 Dec 2004, Danlin Yu wrote:
> > > > > > 
> > > > > > > Dear Professor Roger Bivand:
> > > > > > > 
> > > > > > >     Yes, I was talking about the two SAR fitting functions. I just did a
> > > > > > > very quick run on a dataset with 3437 observations (those are point data,
> > > > > > > and I generate the listw object using dnearneigh() - not sure whether the
> > > > > > > result is symmetric or asymmetric). 
> > > > > > 
> > > > > > How many links are there in the neighbour list? Distance neighbours are 
> > > > > > symmetric, but if points are densely placed, there may be parts of your 
> > > > > > study area with many neighbours. Use print.nb() to find out how many.
> > > > > > 
> > > > > > > However, I tried both "sparse" and
> > > > > > > "SparseM" method on errorsarlm(), both failed to go through, the errors
> > > > > > > given as follow:
> > > > > > > 
> > > > > > >     For "sparse" method:
> > > > > > >     "Error in spwdet(sparseweights, rho = rho, debug = debug) : 
> > > > > > >         Suspicious allocation of memory in sparse functions
> > > > > > >          ...bailing out! Save workspace and quit R!"
> > > > > > 
> > > > > > Yes, this is the memory bug. It does happen on most/all GCC compiled 
> > > > > > versions, but I've seen BSD versions that work - it depends on the memory 
> > > > > > allocation code, but it has not been possible to solve. I am planning to 
> > > > > > drop "sparse" before long, unless the memory bug is resolved.
> > > > > > 
> > > > > > > 
> > > > > > >     For "SparseM" method:
> > > > > > >     "Error in .local(x, ...) : Increase tmpmax
> > > > > > 
> > > > > > This is the problem: tmpmax is defined in chol() for "matrix.csr" objects 
> > > > > > as only 10 times the number of rows. I think you have more neighbour links 
> > > > > > than 10*n, and that means I need to find a way of passing a better value 
> > > > > > through. Please let me know, this looks do-able.
> > > > > > 
> > > > > > Roger
> > > > > > 
> > > > > > >      Error in det(chol(x)) : Unable to find the argument "x" in selecting
> > > > > > >      a method for function "det" "
> > > > > > > 
> > > > > > >     By the way, I am still using R 2.0.0 and when I loaded the libraries,
> > > > > > > I got warnings. I will keep trying and keep you posted as I progress.
> > > > > > > Thanks.
> > > > > > > 
> > > > > > > 
> > > > > > > On Mon, 13 Dec 2004, Roger Bivand wrote:
> > > > > > > 
> > > > > > > > On Mon, 13 Dec 2004, Danlin Yu wrote:
> > > > > > > > 
> > > > > > > > > Dear Mihai Nica:
> > > > > > > > > 
> > > > > > > > >     I think it is a memory issue, too. I ran into the same problem when
> > > > > > > > > using around 3000 observations. Although I used memory.size() to increase
> > > > > > > > > the memroy allocation size, spdep took too long to run.
> > > > > > > > > 
> > > > > > > > 
> > > > > > > > I think you mean the two SAR fitting functions, lagsarlm() and 
> > > > > > > > errorsarlm()? The default method is "eigen", which does need plenty of 
> > > > > > > > memory with large n (because it both solves the eigenproblem for an nxn 
> > > > > > > > matrix, and later inverts an nxn matrix). There has always been a "sparse" 
> > > > > > > > method using code from Netlib called sparse from UCB, which works on some 
> > > > > > > > platforms, but not others, and has an unresolved memory bug. 
> > > > > > > > 
> > > > > > > > I'm pleased to report that Roger Koenker has been kind enough to add a
> > > > > > > > det() for symmetric (and similar to symmetric) sparse matrices to the
> > > > > > > > SparseM package. From spdep_0.3-5, spdep depends on SparseM, and
> > > > > > > > errorsarlm() is now pretty dependable for large n and fast. lagsarlm() is
> > > > > > > > dependable, but its fitting speed is slowed by fitting models for LR tests
> > > > > > > > dropping each of the X variables in turn, as well as the specified model,
> > > > > > > > so that it fits k models, not just 1. The function calls for the lag
> > > > > > > > models are cheaper than the error models, though.
> > > > > > > > 
> > > > > > > > The restriction to symmetric (and similar to symmetric) sparse matrices is
> > > > > > > > important to bear in mind. With symmetric neighbour lists (contiguity,
> > > > > > > > graphe-based and distance bands), and even symmetric inverse distances,
> > > > > > > > and all weighting styles this is OK (because "W" and "S" style are similar
> > > > > > > > to symmetric, and the others are symmetric), but absolutely not for
> > > > > > > > k-nearest-neighbours or for asymmetric general weights (say migration
> > > > > > > > tables).
> > > > > > > > 
> > > > > > > > I would be very interested in hearing whether this approach is helpful, 
> > > > > > > > and how this scales.
> > > > > > > > 
> > > > > > > > Roger
> > > > > > > > 
> > > > > > > > >     The problem, I think, might be due to the fact that spdep's spatial
> > > > > > > > > autoregressive models use the exact method (correct me if I am wrong),
> > > > > > > > > while GeoDa uses an approximatioin method (see the paper "Fast maximum
> > > > > > > > > likelihood estimation of very large spatial autoregressive models: a
> > > > > > > > > characteristic polynomial approach", in Computational Statistics & Data
> > > > > > > > > Analysis 35 (2001) 301-319). If the method could be incorporated in R, it
> > > > > > > > > will be great.
> > > > > > > > > 
> > > > > > > > >     Danlin
> > > > > > > > > 
> > > > > > > > > On Mon, 13 Dec 2004, Mihai Nica wrote:
> > > > > > > > > 
> > > > > > > > > > Greetings:
> > > > > > > > > > 
> > > > > > > > > > I would like to take advantage of this thread and ask if there is a way to
> > > > > > > > > > "enhance" the code in spdep. I have a dataset with 3030 observations and two
> > > > > > > > > > independent variables. On the same old computer it runs great in GeoDa, but
> > > > > > > > > > fails in R. I assume it is a memory issue, but having two different ways to
> > > > > > > > > > check my results would be great.
> > > > > > > > > > 
> > > > > > > > > > Thanks,
> > > > > > > > > > 
> > > > > > > > > > Mihai Nica
> > > > > > > > > > Jackson State University
> > > > > > > > > > 155 B Parkhurst Dr.
> > > > > > > > > > Jackson, MS 39202
> > > > > > > > > > 601 914 0361
> > > > > > > > > > 
> > > > > > > > > > ----- Original Message ----- 
> > > > > > > > > > From: "Luc Anselin" <anselin at uiuc.edu>
> > > > > > > > > > To: "Darla Munroe" <munroe.9 at osu.edu>
> > > > > > > > > > Cc: <r-sig-geo at stat.math.ethz.ch>
> > > > > > > > > > Sent: Monday, December 13, 2004 8:36 AM
> > > > > > > > > > Subject: Re: [R-sig-Geo] spatial 2SLS
> > > > > > > > > > 
> > > > > > > > > > 
> > > > > > > > > > > I have some functions that implement this. We used them in last summer's
> > > > > > > > > > > ICPSR spatial regression course. They are not (yet) very user friendly
> > > > > > > > > > > and
> > > > > > > > > > > not up to official R standards yet, but they definitely work.
> > > > > > > > > > > The functions include:
> > > > > > > > > > > - standard 2SLS (or IV estimation)
> > > > > > > > > > > - spatial 2SLS (using WX as instruments for Wy)
> > > > > > > > > > > - heteroskedastic robust spatial 2SLS (White adjusted variances)
> > > > > > > > > > > Anyone who wants them and doesn't need a lot of hand holding can e-mail
> > > > > > > > > > > me directly.
> > > > > > > > > > > L.
> > > > > > > > > > >
> > > > > > > > > > >
> > > > > > > > > > > On Dec 13, 2004, at 8:21 AM, Darla Munroe wrote:
> > > > > > > > > > >
> > > > > > > > > > > > Is the spatial 2SLS developed by Kelejian available in spdep?  If not,
> > > > > > > > > > > > is it
> > > > > > > > > > > > available anywhere else at this time?  (besides in SpaceStat).
> > > > > > > > > > > >
> > > > > > > > > > > >
> > > > > > > > > > > >
> > > > > > > > > > > > Thanks,
> > > > > > > > > > > >
> > > > > > > > > > > > Darla Munroe
> > > > > > > > > > > >
> > > > > > > > > > > >
> > > > > > > > > > > > [[alternative HTML version deleted]]
> > > > > > > > > > > >
> > > > > > > > > > > > _______________________________________________
> > > > > > > > > > > > R-sig-Geo mailing list
> > > > > > > > > > > > R-sig-Geo at stat.math.ethz.ch
> > > > > > > > > > > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > > > > > > > > > > >
> > > > > > > > > > >
> > > > > > > > > > > _______________________________________________
> > > > > > > > > > > R-sig-Geo mailing list
> > > > > > > > > > > R-sig-Geo at stat.math.ethz.ch
> > > > > > > > > > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > > > > > > > > > >
> > > > > > > > > > 
> > > > > > > > > > _______________________________________________
> > > > > > > > > > R-sig-Geo mailing list
> > > > > > > > > > R-sig-Geo at stat.math.ethz.ch
> > > > > > > > > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > > > > > > > > > 
> > > > > > > > > 
> > > > > > > > >     Sincerely,
> > > > > > > > >     Danlin Yu
> > > > > > > > > 
> > > > > > > > > ----------------------------------
> > > > > > > > > Lecturer, Ph.D. Candidate
> > > > > > > > > Department of Geography
> > > > > > > > > University of Wisconsin, Milwaukee
> > > > > > > > > Tel: (414)229-3943
> > > > > > > > > Fax: (414)229-3981
> > > > > > > > > Email: danlinyu at uwm.edu
> > > > > > > > > 
> > > > > > > > > _______________________________________________
> > > > > > > > > R-sig-Geo mailing list
> > > > > > > > > R-sig-Geo at stat.math.ethz.ch
> > > > > > > > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > > > > > > > > 
> > > > > > > > 
> > > > > > > > -- 
> > > > > > > > Roger Bivand
> > > > > > > > Economic Geography Section, Department of Economics, Norwegian School of
> > > > > > > > Economics and Business Administration, Breiviksveien 40, N-5045 Bergen,
> > > > > > > > Norway. voice: +47 55 95 93 55; fax +47 55 95 93 93
> > > > > > > > e-mail: Roger.Bivand at nhh.no
> > > > > > > > 
> > > > > > > > 
> > > > > > > 
> > > > > > >     Sincerely,
> > > > > > >     Danlin Yu
> > > > > > > 
> > > > > > > ----------------------------------
> > > > > > > Lecturer, Ph.D. Candidate
> > > > > > > Department of Geography
> > > > > > > University of Wisconsin, Milwaukee
> > > > > > > Tel: (414)229-3943
> > > > > > > Fax: (414)229-3981
> > > > > > > Email: danlinyu at uwm.edu
> > > > > > > ----------------------------------
> > > > > > > 
> > > > > > > 
> > > > > > 
> > > > > > -- 
> > > > > > Roger Bivand
> > > > > > Economic Geography Section, Department of Economics, Norwegian School of
> > > > > > Economics and Business Administration, Breiviksveien 40, N-5045 Bergen,
> > > > > > Norway. voice: +47 55 95 93 55; fax +47 55 95 93 93
> > > > > > e-mail: Roger.Bivand at nhh.no
> > > > > > 
> > > > > > _______________________________________________
> > > > > > R-sig-Geo mailing list
> > > > > > R-sig-Geo at stat.math.ethz.ch
> > > > > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > > > > > 
> > > > > 
> > > > >     Sincerely,
> > > > >     Danlin Yu
> > > > > 
> > > > > ----------------------------------
> > > > > Lecturer, Ph.D. Candidate
> > > > > Department of Geography
> > > > > University of Wisconsin, Milwaukee
> > > > > Tel: (414)229-3943
> > > > > Fax: (414)229-3981
> > > > > Email: danlinyu at uwm.edu
> > > > > ----------------------------------
> > > > > 
> > > > > 
> > > > 
> > > > -- 
> > > > Roger Bivand
> > > > Economic Geography Section, Department of Economics, Norwegian School of
> > > > Economics and Business Administration, Breiviksveien 40, N-5045 Bergen,
> > > > Norway. voice: +47 55 95 93 55; fax +47 55 95 93 93
> > > > e-mail: Roger.Bivand at nhh.no
> > > > 
> > > > 
> > > 
> > >     Sincerely,
> > >     Danlin Yu
> > > 
> > > ----------------------------------
> > > Lecturer, Ph.D. Candidate
> > > Department of Geography
> > > University of Wisconsin, Milwaukee
> > > Tel: (414)229-3943
> > > Fax: (414)229-3981
> > > Email: danlinyu at uwm.edu
> > > ----------------------------------
> > > 
> > > 
> > 
> > -- 
> > Roger Bivand
> > Economic Geography Section, Department of Economics, Norwegian School of
> > Economics and Business Administration, Breiviksveien 40, N-5045 Bergen,
> > Norway. voice: +47 55 95 93 55; fax +47 55 95 93 93
> > e-mail: Roger.Bivand at nhh.no
> > 
> > 
> 
>     Sincerely,
>     Danlin Yu
> 
> ----------------------------------
> Lecturer, Ph.D. Candidate
> Department of Geography
> University of Wisconsin, Milwaukee
> Tel: (414)229-3943
> Fax: (414)229-3981
> Email: danlinyu at uwm.edu
> ----------------------------------
> 
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Breiviksveien 40, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 93 93
e-mail: Roger.Bivand at nhh.no



From mgilbert at ulb.ac.be  Thu Dec 16 16:05:55 2004
From: mgilbert at ulb.ac.be (Marius Gilbert)
Date: Thu, 16 Dec 2004 16:05:55 +0100
Subject: [R-sig-Geo] Moving-window sum in a matrix
Message-ID: <41C1B263.9565.4DEC00A@localhost>

Dear colleagues,

I have a 500 by 500 matrix with presence or absence value in each cell as 
an input matrix. I am trying to create an output matrix having in each 
cell the sum of the values from neigbouring cells in the input matrix 
according to a moving-window defined as:

0 1 1 1 0
1 1 1 1 1
1 1 0 1 1
1 1 1 1 1
0 1 1 1 0

where the output cell receiving the values is located in the center. I 
have written a function that loop over the cells of the output matrix, and 
sum up the values from these neigbouring cells. It works, but it is fairly 
slow, and hangs if I try it over a larger matrix. Given that this is a 
rather basic function available in most raster GIS packages (IDRISI and AV 
Spatial Analyst) and running fairly quickly, I wondered whether anyone had 
previously come accross a similar function in an existing R-package.

Any helps  or pointer would be appreciated,

Many thanks in advance,

Marius



From dray at biomserv.univ-lyon1.fr  Thu Dec 16 16:29:32 2004
From: dray at biomserv.univ-lyon1.fr (Stephane DRAY)
Date: Thu, 16 Dec 2004 10:29:32 -0500
Subject: [R-sig-Geo] Moving-window sum in a matrix
In-Reply-To: <41C1B263.9565.4DEC00A@localhost>
Message-ID: <5.2.1.1.0.20041216101230.00bf2a18@biomserv.univ-lyon1.fr>

Hello,
I think that you could do it using spdep package. I suppose that, if you:
- construct a neighborhoord object (nb class). You can define a distance 
based neighborhood (using dnearneigh) as it seems that your definition is 
similar to say i and j neighbors if 0<dij<sqrt(cellsize^2+(2*cellsize)^2)
- then transform the nb to listw with nb2listw with style="B"
- then use lag.listw to sompute the sum

an example:
 > myvalues=rbinom(100,size=1,prob=0.5)
 > xy=expand.grid(1:10,1:10)
 > dnn1=dnearneigh(as.matrix(xy),0,sqrt(1+4))
 > plot(dnn1,as.matrix(xy))
 > nb2listw(dnn1,style="B")
 > lw1=nb2listw(dnn1,style="B")
 > sum.neigh=lag.listw(lw1,myvalues)
 > sum.neigh
   [1]  3  6  4  5  7  5  4  4  3  3  6  8  6  7  9  8  6  8  6  4  5  9 10 
11 10  7  8  9  7  5
  [31]  7 10 14 11 10  8  8  9  8  5  8 12 11 10 11 12 10 12 11  7  9 11 
12  9 13 11 10 12 12  9
  [61]  6 11 12 13 10 12 10 13  9  7  6  9 12 10 12 10 13 12  9  5  6  8  8 
10 10 11  8  9  7  5
  [91]  4  6  7  6  9  7  6  4  5  3

Roger could confirm that it is correct !



At 10:05 16/12/2004, Marius Gilbert wrote:
>Dear colleagues,
>
>I have a 500 by 500 matrix with presence or absence value in each cell as
>an input matrix. I am trying to create an output matrix having in each
>cell the sum of the values from neigbouring cells in the input matrix
>according to a moving-window defined as:
>
>0 1 1 1 0
>1 1 1 1 1
>1 1 0 1 1
>1 1 1 1 1
>0 1 1 1 0
>
>where the output cell receiving the values is located in the center. I
>have written a function that loop over the cells of the output matrix, and
>sum up the values from these neigbouring cells. It works, but it is fairly
>slow, and hangs if I try it over a larger matrix. Given that this is a
>rather basic function available in most raster GIS packages (IDRISI and AV
>Spatial Analyst) and running fairly quickly, I wondered whether anyone had
>previously come accross a similar function in an existing R-package.
>
>Any helps  or pointer would be appreciated,
>
>Many thanks in advance,
>
>Marius
>
>_______________________________________________
>R-sig-Geo mailing list
>R-sig-Geo at stat.math.ethz.ch
>https://stat.ethz.ch/mailman/listinfo/r-sig-geo

St?phane DRAY
-------------------------------------------------------------------------------------------------- 

D?partement des Sciences Biologiques
Universit? de Montr?al, C.P. 6128, succursale centre-ville
Montr?al, Qu?bec H3C 3J7, Canada

Tel : (514) 343-6111 poste 1233         Fax : (514) 343-2293
E-mail : stephane.dray at umontreal.ca
-------------------------------------------------------------------------------------------------- 

Web                                          http://www.steph280.freesurf.fr/



From e.pebesma at geog.uu.nl  Thu Dec 16 21:17:28 2004
From: e.pebesma at geog.uu.nl (Edzer J. Pebesma)
Date: Thu, 16 Dec 2004 21:17:28 +0100
Subject: [R-sig-Geo] Moving-window sum in a matrix
In-Reply-To: <5.2.1.1.0.20041216101230.00bf2a18@biomserv.univ-lyon1.fr>
References: <5.2.1.1.0.20041216101230.00bf2a18@biomserv.univ-lyon1.fr>
Message-ID: <41C1ED58.6050505@geog.uu.nl>

Stephane, have you tried how well this scales to, say, 1000x1000 
matrices? Indeed, most basic raster GIS functionality is not available 
in R packages, and would be welcome. R code is efficient for small
problems, but for cases like this scales badly as Marius noted.

We are actually working on an interface from R to the functionality of 
PCRaster (http://pcraster.geog.uu.nl -- yet another raster GIS), and 
expect to have this working within a few months. PCRaster is not open 
source, so it is unlikely to become a CRAN package straight away, but 
still it may fill a need.

This all depends on availability of sp, the long awaited package with S 
classes for spatial point, line, grid, arc/node and polygon data. We're 
working very hard on this, and most likely will announce a beta in 
January. I expect a PCRasteR package to follow that soon.
--
Edzer

Stephane DRAY wrote:
> Hello,
> I think that you could do it using spdep package. I suppose that, if you:
> - construct a neighborhoord object (nb class). You can define a distance 
> based neighborhood (using dnearneigh) as it seems that your definition 
> is similar to say i and j neighbors if 
> 0<dij<sqrt(cellsize^2+(2*cellsize)^2)
> - then transform the nb to listw with nb2listw with style="B"
> - then use lag.listw to sompute the sum
> 
> an example:
>  > myvalues=rbinom(100,size=1,prob=0.5)
>  > xy=expand.grid(1:10,1:10)
>  > dnn1=dnearneigh(as.matrix(xy),0,sqrt(1+4))
>  > plot(dnn1,as.matrix(xy))
>  > nb2listw(dnn1,style="B")
>  > lw1=nb2listw(dnn1,style="B")
>  > sum.neigh=lag.listw(lw1,myvalues)
>  > sum.neigh
>   [1]  3  6  4  5  7  5  4  4  3  3  6  8  6  7  9  8  6  8  6  4  5  9 
> 10 11 10  7  8  9  7  5
>  [31]  7 10 14 11 10  8  8  9  8  5  8 12 11 10 11 12 10 12 11  7  9 11 
> 12  9 13 11 10 12 12  9
>  [61]  6 11 12 13 10 12 10 13  9  7  6  9 12 10 12 10 13 12  9  5  6  8  
> 8 10 10 11  8  9  7  5
>  [91]  4  6  7  6  9  7  6  4  5  3
> 
> Roger could confirm that it is correct !
> 
> 
> 
> At 10:05 16/12/2004, Marius Gilbert wrote:
> 
>> Dear colleagues,
>>
>> I have a 500 by 500 matrix with presence or absence value in each cell as
>> an input matrix. I am trying to create an output matrix having in each
>> cell the sum of the values from neigbouring cells in the input matrix
>> according to a moving-window defined as:
>>
>> 0 1 1 1 0
>> 1 1 1 1 1
>> 1 1 0 1 1
>> 1 1 1 1 1
>> 0 1 1 1 0
>>
>> where the output cell receiving the values is located in the center. I
>> have written a function that loop over the cells of the output matrix, 
>> and
>> sum up the values from these neigbouring cells. It works, but it is 
>> fairly
>> slow, and hangs if I try it over a larger matrix. Given that this is a
>> rather basic function available in most raster GIS packages (IDRISI 
>> and AV
>> Spatial Analyst) and running fairly quickly, I wondered whether anyone 
>> had
>> previously come accross a similar function in an existing R-package.
>>
>> Any helps  or pointer would be appreciated,
>>
>> Many thanks in advance,
>>
>> Marius
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 
> 
> St?phane DRAY
> -------------------------------------------------------------------------------------------------- 
> 
> D?partement des Sciences Biologiques
> Universit? de Montr?al, C.P. 6128, succursale centre-ville
> Montr?al, Qu?bec H3C 3J7, Canada
> 
> Tel : (514) 343-6111 poste 1233         Fax : (514) 343-2293
> E-mail : stephane.dray at umontreal.ca
> -------------------------------------------------------------------------------------------------- 
> 
> Web                                          
> http://www.steph280.freesurf.fr/
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



From White.Denis at epamail.epa.gov  Fri Dec 17 18:18:17 2004
From: White.Denis at epamail.epa.gov (White.Denis at epamail.epa.gov)
Date: Fri, 17 Dec 2004 09:18:17 -0800
Subject: [R-sig-Geo] Hex GIS, (was) Moving-window ...
In-Reply-To: <41C1ED58.6050505@geog.uu.nl>
Message-ID: <OFE9793F91.C8D5DE07-ON88256F6D.005D4F53-88256F6D.005F2213@epamail.epa.gov>

Does anyone know of a GIS based on a regular hexagon tessellation rather
than on squares or rectangles?  (There was a project twenty some years
ago called System X developed for the Navy by Dean Lucas that started
into commercialization but never finished as far as I know.)

r-sig-geo-bounces at stat.math.ethz.ch wrote on 2004-12-16 12:17:28:

> Stephane, have you tried how well this scales to, say, 1000x1000
> matrices? Indeed, most basic raster GIS functionality is not available

> in R packages, and would be welcome. R code is efficient for small
> problems, but for cases like this scales badly as Marius noted.
>
> We are actually working on an interface from R to the functionality of

> PCRaster (http://pcraster.geog.uu.nl -- yet another raster GIS), and
> expect to have this working within a few months. PCRaster is not open
> source, so it is unlikely to become a CRAN package straight away, but
> still it may fill a need.
>
> This all depends on availability of sp, the long awaited package with
S
> classes for spatial point, line, grid, arc/node and polygon data.
We're
> working very hard on this, and most likely will announce a beta in
> January. I expect a PCRasteR package to follow that soon.
> --
> Edzer



From HardistF at gwm.sc.edu  Fri Dec 17 21:14:17 2004
From: HardistF at gwm.sc.edu (Frank Hardisty)
Date: Fri, 17 Dec 2004 15:14:17 -0500
Subject: [R-sig-Geo] Hex GIS, (was) Moving-window ...
Message-ID: <s1c2f7cf.009@gwm.sc.edu>

Denis and All,

The best thing out there is probably the "hexbin" package in R, based
on Dan Carr's work. It's not a GIS, however. Hexagons do have some very
nice properties for spatial analysis.

-Frank Hardisty

~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Frank Hardisty
Department of Geography
University of South Carolina
hardisty at sc.edu
Office -- 803-777-5729 
Fax -- 803-777-4972
http://www.cla.sc.edu/geog/faculty/hardistf/

>>> <White.Denis at epamail.epa.gov> 12/17/04 12:18PM >>>
Does anyone know of a GIS based on a regular hexagon tessellation
rather
than on squares or rectangles?  (There was a project twenty some years
ago called System X developed for the Navy by Dean Lucas that started
into commercialization but never finished as far as I know.)

r-sig-geo-bounces at stat.math.ethz.ch wrote on 2004-12-16 12:17:28:

> Stephane, have you tried how well this scales to, say, 1000x1000
> matrices? Indeed, most basic raster GIS functionality is not
available

> in R packages, and would be welcome. R code is efficient for small
> problems, but for cases like this scales badly as Marius noted.
>
> We are actually working on an interface from R to the functionality
of

> PCRaster (http://pcraster.geog.uu.nl -- yet another raster GIS), and
> expect to have this working within a few months. PCRaster is not
open
> source, so it is unlikely to become a CRAN package straight away,
but
> still it may fill a need.
>
> This all depends on availability of sp, the long awaited package
with
S
> classes for spatial point, line, grid, arc/node and polygon data.
We're
> working very hard on this, and most likely will announce a beta in
> January. I expect a PCRasteR package to follow that soon.
> --
> Edzer

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at stat.math.ethz.ch 
https://stat.ethz.ch/mailman/listinfo/r-sig-geo



From buczkowski at delta.sggw.waw.pl  Sat Dec 25 14:05:07 2004
From: buczkowski at delta.sggw.waw.pl (buczkowski at delta.sggw.waw.pl)
Date: Sat, 25 Dec 2004 14:05:07 +0100
Subject: [R-sig-Geo] Problem with lm.morantest
Message-ID: <1103979907.41cd6583cc240@poczta.wl.sggw.waw.pl>

Hello

I have a map of polygons in shapefile and a database in Access with
several 
attributes of the polygons from the shapefile. On data from the database I

am doing linear regression using function lm(). I would like to check 
whether there is spatial correlation in regresssion residuals. I loaded 
polygons using maptools, created a neighbor list using poly2nb() and then

spatial weights using nb2listw(). I made regression on data from the 
database (not from shapefile) and wanted to use lm.morantest() to
calculate 
Moran's I, and there the following error appeared "Error in 
lm.morantest(wmoddef, def_w, zero.policy = TRUE, alternative = "greater", 
:
        objects of different length" )

I realize that this is because the lists of polygons from shapefile and
records from regression are different. I was trying to match them by
sorting them in the same order but it didn't work. My question is how can
I conduct my analysis so the neighbor list and residuals from regression
would match each other in lm.morantest? 

Thanks in advance for your help

With best Christmas and New Year wishes

Rafal Buczkowski



From Roger.Bivand at nhh.no  Sat Dec 25 22:16:20 2004
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sat, 25 Dec 2004 22:16:20 +0100 (CET)
Subject: [R-sig-Geo] Problem with lm.morantest
In-Reply-To: <1103979907.41cd6583cc240@poczta.wl.sggw.waw.pl>
Message-ID: <Pine.LNX.4.44.0412252209040.5164-100000@reclus.nhh.no>

On Sat, 25 Dec 2004 buczkowski at delta.sggw.waw.pl wrote:

> Hello
> 
> I have a map of polygons in shapefile and a database in Access with
> several 
> attributes of the polygons from the shapefile. On data from the database I
> 
> am doing linear regression using function lm(). I would like to check 
> whether there is spatial correlation in regresssion residuals. I loaded 
> polygons using maptools, created a neighbor list using poly2nb() and then
> 
> spatial weights using nb2listw(). I made regression on data from the 
> database (not from shapefile) and wanted to use lm.morantest() to
> calculate 
> Moran's I, and there the following error appeared "Error in 
> lm.morantest(wmoddef, def_w, zero.policy = TRUE, alternative = "greater", 
> :
>         objects of different length" )
> 
> I realize that this is because the lists of polygons from shapefile and
> records from regression are different. I was trying to match them by
> sorting them in the same order but it didn't work. My question is how can
> I conduct my analysis so the neighbor list and residuals from regression
> would match each other in lm.morantest? 

First, maybe check whether there are no NAs in the regression:

> data(oldcol)
> COL.OLD$HOVAL[1:5] <- NA
> oldcrime.lm <- lm(CRIME ~ HOVAL + INC, data = COL.OLD)
> lm.morantest(oldcrime.lm, nb2listw(COL.nb, style = "W"))
Error in lm.morantest(oldcrime.lm, nb2listw(COL.nb, style = "W")) : 
        objects of different length

I think you need to establish where the lack of equivalence between your 
data and your shapefile is coming from - will using the spChk= argument 
help one the numbers of polygons and regression residuals agree? Does your 
data have an ID row name that can be used as the region.id= argument in 
poly2nb?

If necessary please contact me off-list; at the moment, your residuals are 
not the same length as the number of neighbours, and we need to find out 
why.

Roger

> 
> Thanks in advance for your help
> 
> With best Christmas and New Year wishes
> 
> Rafal Buczkowski
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Breiviksveien 40, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 93 93
e-mail: Roger.Bivand at nhh.no



From macq at llnl.gov  Fri Dec 31 20:48:05 2004
From: macq at llnl.gov (Don MacQueen)
Date: Fri, 31 Dec 2004 11:48:05 -0800
Subject: [R-sig-Geo] Request suggestions for R/GRASS demonstration
Message-ID: <p06110400bdfb574ffd44@[128.115.153.6]>

I have the opportunity in the next few weeks to illustrate the use of 
R to some co-workers, mostly hydrogeologists, in an informal 
seminar-like setting. I will be simultaneously showing how I use R to 
support our environmental restoration and environmental monitoring 
programs, and hoping to interest the audience in using R.

I have some material prepared already, but I think it would be a nice 
addition if I could include a short demonstration of R and GRASS 
working together. I have very little GIS experience, and it consists 
mostly of using ArcView software to do trivial mapping. So this will 
be a challenge.

The data I have available consist of chemical concentration and water 
level data from a large number of ground water monitoring wells (on 
the order of 400 wells within an area of approximately 1700 by 1700 
meters). There are also some smaller data sets of soil measurements. 
One of the illustrations I have already prepared is to simply contour 
the water level data monthly over a period of about three years.

I don't have to use local project data. For example, a simple 
statistical analysis of attribute data of California counties would 
be of interest to the audience, I think; something where the 
statistics need R but the mapping, or something requiring the 
capabilities of a GIS system, done in GRASS would suit.

I will be using unix-based computers to do this (Apple's OS X, to be 
specific) and have R 2.0.1 and GRASS 5.4 and 5.7 installed.

I realize this is a rather general request, and that I'm not giving 
r-sig-geo readers much to work with. None the less, any suggestions 
at all would be much appreciated.


Thank you
-Don
-- 
--------------------------------------
Don MacQueen
Environmental Protection Department
Lawrence Livermore National Laboratory
Livermore, CA, USA



